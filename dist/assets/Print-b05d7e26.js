import{e as d,b as Ze,K as Te,y as x,f as he,aq as we,a as A,l as H,bz as q,bA as ke,bB as Ie,bC as ge,bD as Ye,bE as Qe,bF as k,af as z,bG as Xe,_ as et,a8 as tt,aa as Ce,bH as at,bI as R,bJ as rt,bK as st,bL as it,bM as lt,bN as Le,I as Q,bO as nt,a_ as ot,bP as ut,bQ as X,bR as ct,bS as pt,bT as xe,bU as ae,ad as dt,ag as yt,b4 as mt,aV as ft,bV as ht,g as gt,r as L,R as xt,k as b,m as bt,o as Oe,b6 as St,p as Me,q as _,$ as De,bW as ce,bX as pe,bY as Tt,bZ as Ne,b_ as de,b7 as Ee,b$ as wt,c0 as vt}from"./index-7753bab1.js";import{o as Pt}from"./floorFilterUtils-080a7cd2.js";import{a as Ue}from"./GPMessage-5defb3e1.js";let E=class extends Te{constructor(){super(...arguments),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}};d([x({type:he})],E.prototype,"outSpatialReference",void 0),d([x({type:we})],E.prototype,"processExtent",void 0),d([x({type:he})],E.prototype,"processSpatialReference",void 0),d([x({nonNullable:!0})],E.prototype,"returnFeatureCollection",void 0),d([x({nonNullable:!0})],E.prototype,"returnM",void 0),d([x({nonNullable:!0})],E.prototype,"returnZ",void 0),E=d([A("esri.rest.geoprocessor.GPOptions")],E),E.from=Ze(E);const ve=E;let $=class extends H{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};d([x({type:we})],$.prototype,"extent",void 0),d([x()],$.prototype,"height",void 0),d([x()],$.prototype,"href",void 0),d([x()],$.prototype,"opacity",void 0),d([x()],$.prototype,"rotation",void 0),d([x()],$.prototype,"scale",void 0),d([x()],$.prototype,"visible",void 0),d([x()],$.prototype,"width",void 0),$=d([A("esri.layer.support.MapImage")],$);const $e=$;let K=class extends H{constructor(a){super(a),this.itemId=null,this.url=null}};d([x({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],K.prototype,"itemId",void 0),d([x({type:String,json:{write:!0}})],K.prototype,"url",void 0),K=d([A("esri.rest.support.DataFile")],K);const ye=K,_e=new q({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let W=class extends H{constructor(a){super(a),this.distance=0,this.units=null}};d([x({json:{write:!0}})],W.prototype,"distance",void 0),d([x({json:{read:_e.read,write:_e.write}})],W.prototype,"units",void 0),W=d([A("esri.rest.support.LinearUnit")],W);const Fe=W,It=new q({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"});let Z=class extends H{constructor(a){super(a),this.dataType=null,this.value=null}};d([ke(It,{ignoreUnknown:!1})],Z.prototype,"dataType",void 0),d([x()],Z.prototype,"value",void 0),Z=d([A("esri.rest.support.ParameterValue")],Z);const Ct=Z;let U=class extends H{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};d([x()],U.prototype,"format",void 0),d([x({json:{read:{source:"itemID"},write:{target:"itemID"}}})],U.prototype,"itemId",void 0),d([x()],U.prototype,"url",void 0),U=d([A("esri.rest.support.RasterData")],U);const Ge=U;async function Je(e,a,t,r,s){const i={},n={},u=[];return Lt(r,u,i),Qe(u).then(l=>{const{outSpatialReference:o,processExtent:y,processSpatialReference:c,returnFeatureCollection:m,returnM:T,returnZ:p}=t,{path:g}=k(e);for(const I in i){const w=i[I];n[I]=l.slice(w[0],w[1])}const v=o?o.wkid||o:null,P=c?c.wkid||c:null,f=a==="execute"?{returnFeatureCollection:m||void 0,returnM:T||void 0,returnZ:p||void 0}:null,h=le({...y?{context:{extent:y,outSR:v,processSR:P}}:{"env:outSR":v,"env:processSR":P},...r,...f,f:"json"},null,n),C={...s,query:h};return z(`${g}/${a}`,C)})}function Lt(e,a,t){for(const r in e){const s=e[r];if(s&&typeof s=="object"&&s instanceof ge){const{features:i}=s;t[r]=[a.length,a.length+i.length],i.forEach(n=>{a.push(n.geometry)})}}}function be(e){const a=e.dataType,t=Ct.fromJSON(e);switch(a){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return t;case"GPDate":t.value=new Date(t.value);break;case"GPDataFile":t.value=ye.fromJSON(t.value);break;case"GPLinearUnit":t.value=Fe.fromJSON(t.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const r=e.value.url;t.value=r?ye.fromJSON(t.value):ge.fromJSON(t.value);break}case"GPRasterData":case"GPRasterDataLayer":{const r=e.value.mapImage;t.value=r?$e.fromJSON(r):Ge.fromJSON(t.value);break}case"GPField":t.value=Ie.fromJSON(t.value);break;case"GPMultiValue:GPDate":{const r=t.value;t.value=r.map(s=>new Date(s));break}case"GPMultiValue:GPDataFile":t.value=t.value.map(r=>ye.fromJSON(r));break;case"GPMultiValue:GPLinearUnit":t.value=t.value.map(r=>Fe.fromJSON(r));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":t.value=t.value.map(r=>ge.fromJSON(r));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":t.value=t.value.map(r=>r?$e.fromJSON(r):Ge.fromJSON(t.value));break;case"GPMultiValue:GPField":t.value=t.value.map(r=>Ie.fromJSON(r))}return t}function le(e,a,t){for(const r in e){const s=e[r];Array.isArray(s)?e[r]=JSON.stringify(s.map(i=>le({item:i},!0).item)):s instanceof Date&&(e[r]=s.getTime())}return Ye(e,a,t)}async function Ot(e,a,t,r){return t=ve.from(t||{}),Je(e,"execute",t,a??{},r).then(s=>{const i=s.data.results||[],n=s.data.messages||[];return{results:i.map(be),messages:n.map(u=>Ue.fromJSON(u))}})}var re;const Mt=Xe()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let F=re=class extends H{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:a,sourceUrl:t}=this,{path:r}=k(t),s={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const i=`${r}/jobs/${a}/cancel`,{data:n}=await z(i,s),{messages:u,jobStatus:l,progress:o}=re.fromJSON(n);return this.set({messages:u,jobStatus:l,progress:o}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:a}=k(this.sourceUrl),t={...this.requestOptions,...e,query:{f:"json"}},r=`${a}/jobs/${this.jobId}`,{data:s}=await z(r,t),{messages:i,jobStatus:n,progress:u}=re.fromJSON(s);return this.set({messages:i,jobStatus:n,progress:u}),this}async fetchResultData(e,a,t){a=ve.from(a||{});const{returnFeatureCollection:r,returnM:s,returnZ:i,outSpatialReference:n}=a,{path:u}=k(this.sourceUrl),l=le({returnFeatureCollection:r,returnM:s,returnZ:i,outSR:n,returnType:"data",f:"json"},null),o={...this.requestOptions,...t,query:l},y=`${u}/jobs/${this.jobId}/results/${e}`,{data:c}=await z(y,o);return be(c)}async fetchResultImage(e,a,t){const{path:r}=k(this.sourceUrl),s={...a.toJSON(),f:"json"},i=le(s),n={...this.requestOptions,...t,query:i},u=`${r}/jobs/${this.jobId}/results/${e}`,{data:l}=await z(u,n);return be(l)}async fetchResultMapImageLayer(){const{path:e}=k(this.sourceUrl),a=e.indexOf("/GPServer/"),t=`${e.substring(0,a)}/MapServer/jobs/${this.jobId}`;return new(await et(()=>import("./MapImageLayer-fc33cbd2.js"),["assets/MapImageLayer-fc33cbd2.js","assets/index-7753bab1.js","assets/index-0be7f32f.css","assets/SublayersOwner-c8d26dfc.js","assets/QueryTask-57bcfcce.js","assets/executeForIds-c2a2abd3.js","assets/sublayerUtils-2efb8cde.js","assets/ExportImageParameters-435aace7.js","assets/floorFilterUtils-080a7cd2.js","assets/imageBitmapUtils-e80e32e9.js"])).default({url:t})}async waitForJobCompletion(e={}){const{interval:a=1e3,signal:t,statusCallback:r}=e;return new Promise((s,i)=>{tt(t,()=>{this._clearTimer(),i(Ce())}),this._clearTimer();const n=setInterval(()=>{this._timer||i(Ce()),this.checkJobStatus(this.requestOptions).then(u=>{const{jobStatus:l}=u;switch(this.jobStatus=l,l){case"job-succeeded":this._clearTimer(),s(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":r&&r(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),i(this)}})},a);this._timer=n})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};d([x()],F.prototype,"jobId",void 0),d([ke(Mt,{ignoreUnknown:!1})],F.prototype,"jobStatus",void 0),d([x({type:[Ue]})],F.prototype,"messages",void 0),d([x()],F.prototype,"progress",void 0),d([x()],F.prototype,"requestOptions",void 0),d([x({json:{write:!0}})],F.prototype,"sourceUrl",void 0),F=re=d([A("esri.rest.support.JobInfo")],F);const Dt=F;async function Nt(e,a,t,r){return t=ve.from(t||{}),Je(e,"submitJob",t,a??{},r).then(s=>{const i=Dt.fromJSON(s.data);return i.sourceUrl=e,i})}const ne=new q({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"});ne.fromJSON.bind(ne);const Et=ne.toJSON.bind(ne),oe=new q({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"});oe.fromJSON.bind(oe);const $t=oe.toJSON.bind(oe),me="simple-marker",_t="picture-marker",je="simple-line",Ft="simple-fill",Gt="shield-label-symbol",jt="text";function At(e,a){const{graphic:t,renderer:r,symbol:s}=a,i=s.type;if(i===jt||i===Gt||!("visualVariables"in r)||!r.visualVariables)return;const n=r.getVisualVariablesForType("size"),u=r.getVisualVariablesForType("color"),l=r.getVisualVariablesForType("opacity"),o=r.getVisualVariablesForType("rotation"),y=n[0],c=u[0],m=l[0],T=o[0];if(y){const p=i===me?s.style:null,g=at(y,t,{shape:p});g!=null&&(i===me?e.size=R(g):i===_t?(e.width=R(g),e.height=R(g)):i===je?e.width=R(g):e.outline&&(e.outline.width=R(g)))}if(c){const p=rt(c,t);(p&&i===me||i===je||i===Ft)&&(e.color=p?p.toJSON():void 0)}if(m){const p=st(m,t);p!=null&&e.color&&(e.color[3]=Math.round(255*p))}T&&(e.angle=-it(r,t))}function Vt(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function zt(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function Ae(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Rt(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function kt(e,a=15){const t=e.canvas.width,r=e.canvas.height,s=e.getImageData(0,0,t,r).data;let i,n,u,l,o,y;e:for(n=r;n--;)for(i=t;i--;)if(s[4*(t*n+i)+3]>a){y=n;break e}if(!y)return null;e:for(i=t;i--;)for(n=y+1;n--;)if(s[4*(t*n+i)+3]>a){o=i;break e}e:for(i=0;i<=o;++i)for(n=y+1;n--;)if(s[4*(t*n+i)+3]>a){u=i;break e}e:for(n=0;n<=y;++n)for(i=u;i<=o;++i)if(s[4*(t*n+i)+3]>a){l=n;break e}return{x:u,y:l,width:o-u,height:y-l}}function Ut(e,a){const t=e.allLayerViews.items;if(a===e.scale)return t.filter(s=>!s.suspended);const r=new Array;for(const s of t)qt(s.parent)&&!r.includes(s.parent)||!s.visible||a&&"isVisibleAtScale"in s&&!s.isVisibleAtScale(a)||r.push(s);return r}function Jt(e){return(e==null?void 0:e.type)==="bing-maps"}function He(e){return e&&"blendMode"in e&&"effect"in e}function Ht(e){return(e==null?void 0:e.type)==="csv"}function qt(e){return(e==null?void 0:e.declaredClass)==="esri.views.2d.layers.GroupLayerView2D"}function Bt(e){const a=e.layer;if(He(a)){const t=a.blendMode;if((!t||t==="normal")&&(a.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let D=class extends Te{constructor(a){super(a),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.scalePreserved=!0,this.showLabels=!0}};d([x()],D.prototype,"attributionVisible",void 0),d([x()],D.prototype,"exportOptions",void 0),d([x()],D.prototype,"forceFeatureAttributes",void 0),d([x()],D.prototype,"format",void 0),d([x()],D.prototype,"label",void 0),d([x()],D.prototype,"layout",void 0),d([x({type:lt})],D.prototype,"layoutItem",void 0),d([x()],D.prototype,"layoutOptions",void 0),d([x()],D.prototype,"outScale",void 0),d([x()],D.prototype,"scalePreserved",void 0),d([x()],D.prototype,"showLabels",void 0),D=d([A("esri.rest.support.PrintTemplate")],D);const qe=D,Ve={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},ze=new q({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Kt=new q({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Se=new Map;async function Wt(e,a,t){const r=Qt(e);let s=Se.get(r);return Promise.resolve().then(()=>s?{data:s.gpMetadata}:(s={gpServerUrl:r,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},z(r,{query:{f:"json"}}))).then(i=>(s.gpMetadata=i.data,s.cimVersion=s.gpMetadata.cimVersion,s.is11xService=!!s.cimVersion,Se.set(r,s),Zt(a,s))).then(i=>{const n=xa(s);let u;const l=o=>n==="sync"?o.results&&o.results[0]&&o.results[0].value:u.fetchResultData("Output_File",null,t).then(y=>y.value);return n==="async"?Nt(e,i,void 0,t).then(o=>(u=o,o.waitForJobCompletion({interval:a.updateDelay}).then(l))):Ot(e,i,void 0,t).then(l)})}async function Zt(e,a){a=a||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const t=e.template||new qe;t.showLabels==null&&(t.showLabels=!0);const r=t.exportOptions;let s;const i=$t(t.layout);if(r&&(s={dpi:r.dpi},i.toLowerCase()==="map_only"||i==="")){const c=r.width,m=r.height;s.outputSize=c!=null&&m!=null?[c,m]:void 0}const n=t.layoutOptions;let u;if(n){let c,m;n.scalebarUnit==="Miles"||n.scalebarUnit==="Kilometers"?(c="Kilometers",m="Miles"):n.scalebarUnit!=="Meters"&&n.scalebarUnit!=="Feet"||(c="Meters",m="Feet"),u={titleText:n.titleText,authorText:n.authorText,copyrightText:n.copyrightText,customTextElements:n.customTextElements,elementOverrides:n.elementOverrides,scaleBarOptions:{metricUnit:ze.toJSON(c),metricLabel:c?Ve[c]:void 0,nonMetricUnit:ze.toJSON(m),nonMetricLabel:m?Ve[m]:void 0}}}let l=null;n!=null&&n.legendLayers&&(l=n.legendLayers.map(c=>{const m=c.layerId;a.legendLayerNameMap[m]=c.title;const T={id:m};return c.subLayerIds&&(T.subLayerIds=c.subLayerIds),T}));const o=await Yt(e,t,a);if(o.operationalLayers){const c=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),m=/[\u0600-\u06FF]/,T=g=>{const v=g.text,P=g.font,f=P&&P.family&&P.family.toLowerCase();v&&P&&(f==="arial"||f==="arial unicode ms")&&(P.family=c.test(v)?"Arial Unicode MS":"Arial",P.style!=="normal"&&m.test(v)&&(P.family="Arial Unicode MS"))},p=()=>{throw new dt("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};o.operationalLayers.forEach(g=>{var v,P,f;(v=g.featureCollection)!=null&&v.layers?g.featureCollection.layers.forEach(h=>{var C,I,w,O;if((w=(I=(C=h.layerDefinition)==null?void 0:C.drawingInfo)==null?void 0:I.renderer)!=null&&w.symbol){const N=h.layerDefinition.drawingInfo.renderer;N.symbol.type==="esriTS"?T(N.symbol):N.symbol.type!=="CIMSymbolReference"||a.is11xService||p()}(O=h.featureSet)!=null&&O.features&&h.featureSet.features.forEach(N=>{N.symbol&&(N.symbol.type==="esriTS"?T(N.symbol):N.symbol.type!=="CIMSymbolReference"||a.is11xService||p())})}):!a.is11xService&&((f=(P=g.layerDefinition)==null?void 0:P.drawingInfo)!=null&&f.renderer)&&JSON.stringify(g.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&p()})}e.outSpatialReference&&(o.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(o,{exportOptions:s,layoutOptions:u||{}}),Object.assign(o.layoutOptions,{legendOptions:{operationalLayers:l??a.legendLayers.slice()}}),a.legendLayers.length=0,Se.set(a.gpServerUrl,a);const y={Web_Map_as_JSON:JSON.stringify(o),Format:Et(t.format),Layout_Template:i,Layout_Item_ID:void 0};if(t.layoutItem){delete y.Layout_Template;const c=t.layoutItem;await c.load(),c.access!=="public"&&Le&&await Le.getCredential(a.gpServerUrl),y.Layout_Item_ID=JSON.stringify({id:c.id})}return e.extraParameters&&Object.assign(y,e.extraParameters),y}async function Yt(e,a,t){const r=e.view;let s=r.spatialReference;const i={operationalLayers:await Xt(r,a,t)};a.includeTables&&(i.tables=await da(r));let n=t.ssExtent||e.extent||r.extent;if(s&&s.isWrappable&&(n=n.clone()._normalize(!0),s=n.spatialReference),i.mapOptions={extent:n&&n.toJSON(),spatialReference:s&&s.toJSON(),showAttribution:a.attributionVisible},t.ssExtent=null,r.background&&(i.background=r.background.toJSON()),r.rotation&&(i.mapOptions.rotation=-r.rotation),a.scalePreserved&&(i.mapOptions.scale=a.outScale||r.scale),Q(r.timeExtent)){const u=Q(r.timeExtent.start)?r.timeExtent.start.getTime():null,l=Q(r.timeExtent.end)?r.timeExtent.end.getTime():null;i.mapOptions.time=[u,l]}return i}function Qt(e){let a=e;const t=a.lastIndexOf("/GPServer/");return t>0&&(a=a.slice(0,t+9)),a}async function Xt(e,a,t){const r=[],s={layerView:null,printTemplate:a,view:e};let i=0;a.scalePreserved&&(i=a.outScale||e.scale);const n=Ut(e,i);for(const u of n){const l=u.layer;if(!l.loaded||(l==null?void 0:l.type)==="group")continue;let o;s.layerView=u,o=Bt(u)?await J(l,s,t):Jt(l)?ea(l):Ht(l)?await ta(l,s,t):(l==null?void 0:l.type)==="feature"?await aa(l,s,t):(l==null?void 0:l.type)==="geojson"?await ra(l,s,t):(l==null?void 0:l.type)==="graphics"?await sa(l,s,t):(l==null?void 0:l.type)==="imagery"?ia(l,t):(l==null?void 0:l.type)==="imagery-tile"?await la(l,s,t):(l==null?void 0:l.type)==="kml"?await na(l,s,t):(l==null?void 0:l.type)==="map-image"?oa(l,s,t):(l==null?void 0:l.type)==="map-notes"?await ua(s,t):(l==null?void 0:l.type)==="open-street-map"?ca():(l==null?void 0:l.type)==="stream"?await pa(l,s,t):(l==null?void 0:l.type)==="tile"?ya(l,t):(l==null?void 0:l.type)==="vector-tile"?await ma(l,s,t):(l==null?void 0:l.type)==="web-tile"?fa(l):(l==null?void 0:l.type)==="wms"?ha(l):(l==null?void 0:l.type)==="wmts"?ga(l):await J(l,s,t),o&&(Array.isArray(o)?r.push(...o):(o.id=l.id,o.title=t.legendLayerNameMap[l.id]||l.title,o.opacity=l.opacity,o.minScale=l.minScale||0,o.maxScale=l.maxScale||0,He(l)&&l.blendMode&&l.blendMode!=="normal"&&(o.blendMode=l.blendMode),r.push(o)))}if(i&&r.forEach(u=>{u.minScale=0,u.maxScale=0}),e.graphics&&e.graphics.length){const u=await j(null,e.graphics,a,t);u&&r.push(u)}return r}function ea(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function ta(e,a,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const r=a.layerView,s=a.printTemplate;let i;return!t.is11xService||r.filter?j(e,await ue(r),s,t):(i={type:"CSV"},e.write(i,{origin:"web-map"}),delete i.popupInfo,delete i.layerType,i.showLabels=s.showLabels&&e.labelsVisible,i)}async function j(e,a,t,r){var v,P;let s;const i=zt(),n=Rt(),u=Ae(),l=Vt(),o=Ae();if(o.layerDefinition.name="textLayer",delete o.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?i.layerDefinition.name=n.layerDefinition.name=u.layerDefinition.name=l.layerDefinition.name=r.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(a=e.graphics.items),e.renderer){const f=e.renderer.toJSON(),h=i.layerDefinition.drawingInfo;h&&(h.renderer=f);const C=n.layerDefinition.drawingInfo;C&&(C.renderer=f);const I=u.layerDefinition.drawingInfo;I&&(I.renderer=f);const w=l.layerDefinition.drawingInfo;w&&(w.renderer=f)}if(t.showLabels&&e.labelsVisible&&typeof e.write=="function"){const f=(P=(v=e.write({},{origin:"web-map"}).layerDefinition)==null?void 0:v.drawingInfo)==null?void 0:P.labelingInfo;if(f){s=!0;const h=i.layerDefinition.drawingInfo;h&&(h.labelingInfo=f);const C=n.layerDefinition.drawingInfo;C&&(C.labelingInfo=f);const I=u.layerDefinition.drawingInfo;I&&(I.labelingInfo=f);const w=l.layerDefinition.drawingInfo;w&&(w.labelingInfo=f)}}}let y;e!=null&&e.renderer||s||(delete i.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo);const c=e==null?void 0:e.fieldsIndex,m=e==null?void 0:e.renderer;if(c){const f=new Set;s&&await nt(f,e),m&&typeof m.collectRequiredFields=="function"&&await m.collectRequiredFields(f,c),y=Array.from(f);const h=c.fields.map(C=>C.toJSON());i.layerDefinition.fields=h,n.layerDefinition.fields=h,u.layerDefinition.fields=h,l.layerDefinition.fields=h}const T=a&&a.length;let p;for(let f=0;f<T;f++){const h=a[f]||a.getItemAt(f);if(h.visible===!1||!h.geometry||(p=h.toJSON(),p.hasOwnProperty("popupTemplate")&&delete p.popupTemplate,p.geometry&&p.geometry.z&&delete p.geometry.z,p.symbol&&p.symbol.outline&&p.symbol.outline.type==="esriCLS"&&!r.is11xService))continue;!r.is11xService&&p.symbol&&p.symbol.outline&&p.symbol.outline.color&&p.symbol.outline.color[3]&&(p.symbol.outline.color[3]=255);const C=e&&e.renderer&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!p.symbol&&e&&e.renderer&&C&&!r.is11xService){const I=e.renderer,w=await I.getSymbolAsync(h);if(!w)continue;p.symbol=w.toJSON(),"hasVisualVariables"in I&&I.hasVisualVariables()&&At(p.symbol,{renderer:I,graphic:h,symbol:w})}if(p.symbol&&(p.symbol.angle||delete p.symbol.angle,ie(p.symbol)?p.symbol=await se(p.symbol,r):p.symbol.text&&delete p.attributes),(!t||!t.forceFeatureAttributes)&&(y==null?void 0:y.length)){const I={};y.forEach(w=>{p.attributes&&p.attributes.hasOwnProperty(w)&&(I[w]=p.attributes[w])}),p.attributes=I}h.geometry.type==="polygon"?i.featureSet.features.push(p):h.geometry.type==="polyline"?n.featureSet.features.push(p):h.geometry.type==="point"?p.symbol&&p.symbol.text?o.featureSet.features.push(p):u.featureSet.features.push(p):h.geometry.type==="multipoint"?l.featureSet.features.push(p):h.geometry.type==="extent"&&(p.geometry=ot.fromExtent(h.geometry).toJSON(),i.featureSet.features.push(p))}const g=[i,n,l,u,o].filter(f=>f.featureSet.features.length>0);for(const f of g){const h=f.featureSet.features.every(C=>C.symbol);!h||t&&t.forceFeatureAttributes||f.featureSet.features.forEach(C=>{delete C.attributes}),h&&delete f.layerDefinition.drawingInfo,f.layerDefinition.drawingInfo&&f.layerDefinition.drawingInfo.renderer&&await Be(f.layerDefinition.drawingInfo.renderer,r)}return g.length?{featureCollection:{layers:g},showLabels:s}:null}async function aa(e,a,t){var m,T,p,g,v,P;let r;const s=e.renderer,i=parseFloat(t.cimVersion);if(((m=e.featureReduction)==null?void 0:m.type)==="binning"||((T=e.featureReduction)==null?void 0:T.type)==="cluster"&&(!t.is11xService||i<2.9)||(s==null?void 0:s.type)==="pie-chart"||(s==null?void 0:s.type)==="dot-density"&&(!t.is11xService||i<2.6))return J(e,a,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const n=a.layerView,{printTemplate:u,view:l}=a,o=s&&("valueExpression"in s&&s.valueExpression||"hasVisualVariables"in s&&s.hasVisualVariables()),y=((p=e.source)==null?void 0:p.type)!=="feature-layer"&&((g=e.source)==null?void 0:g.type)!=="ogc-feature";if(!t.is11xService&&o||n.filter||y||!s||"field"in s&&s.field!=null&&(typeof s.field!="string"||!e.getField(s.field))){const f=await ue(n);r=await j(e,f,u,t)}else{if(r={id:(c=e.write()).id,title:c.title,opacity:c.opacity,minScale:c.minScale,maxScale:c.maxScale,url:c.url,layerType:c.layerType,customParameters:c.customParameters,layerDefinition:c.layerDefinition},r.showLabels=u.showLabels&&e.labelsVisible,B(r,e),((P=(v=r.layerDefinition)==null?void 0:v.drawingInfo)==null?void 0:P.renderer)&&(delete r.layerDefinition.minScale,delete r.layerDefinition.maxScale,await Be(r.layerDefinition.drawingInfo.renderer,t),"visualVariables"in s&&s.visualVariables&&s.visualVariables[0])){const h=s.visualVariables[0];if(h.type==="size"&&h.maxSize&&typeof h.maxSize!="number"&&h.minSize&&typeof h.minSize!="number"){const C=ut(h,l.scale);r.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=C.minSize,r.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=C.maxSize}}const f=Pt(n);f&&(r.layerDefinition||(r.layerDefinition={}),r.layerDefinition.definitionExpression=r.layerDefinition.definitionExpression?`(${r.layerDefinition.definitionExpression}) AND (${f})`:f)}var c;return r}async function ra(e,a,t){var r,s;return((r=e.featureReduction)==null?void 0:r.type)==="binning"||((s=e.featureReduction)==null?void 0:s.type)==="cluster"?J(e,a,t):(e.legendEnabled&&t.legendLayers.push({id:e.id}),j(e,await ue(a.layerView),a.printTemplate,t))}async function sa(e,{printTemplate:a},t){return j(e,null,a,t)}function ia(e,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const t={layerType:(r=e.write()).layerType,customParameters:r.customParameters};var r;if(t.bandIds=e.bandIds,t.compressionQuality=e.compressionQuality,t.format=e.format,t.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(a.is11xService)e.renderingRule&&(t.renderingRule=e.renderingRule.toJSON()),e.renderer&&(t.layerDefinition=t.layerDefinition||{},t.layerDefinition.drawingInfo=t.layerDefinition.drawingInfo||{},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const s=e.exportImageServiceParameters.combineRendererWithRenderingRule();s&&(t.renderingRule=s.toJSON())}return B(t,e),t}async function la(e,a,t){var i;if(((i=e.renderer)==null?void 0:i.type)==="flow")return J(e,a,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const r={bandIds:(s=e.write()||{}).bandIds,customParameters:s.customParameters,interpolation:s.interpolation,layerDefinition:s.layerDefinition};var s;return r.layerType="ArcGISImageServiceLayer",B(r,e),r}async function na(e,a,t){const r=a.printTemplate;if(t.is11xService){const s={type:"kml"};return e.write(s,{origin:"web-map"}),delete s.layerType,s.url=X(e.url),s}{const s=[],i=a.layerView;i.allVisibleMapImages.forEach((l,o)=>{const y={id:`${e.id}_image${o}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:l.extent};l.href.substr(0,22)==="data:image/png;base64,"?y.imageData=l.href.substr(22):y.url=l.href,s.push(y)});const n=[...i.allVisiblePoints.items,...i.allVisiblePolylines.items,...i.allVisiblePolygons.items],u={id:e.id,...await j(null,n,r,t)};return s.push(u),s}}function oa(e,{view:a},t){var o,y;let r;const s={id:e.id,subLayerIds:[]};let i=[];const n=a.scale,u=c=>{const m=n===0,T=c.minScale===0||n<=c.minScale,p=c.maxScale===0||n>=c.maxScale;if(c.visible&&(m||T&&p))if(c.sublayers)c.sublayers.forEach(u);else{const g=c.toExportImageJSON(),v={id:c.id,name:c.title,layerDefinition:{drawingInfo:g.drawingInfo,definitionExpression:g.definitionExpression,source:g.source}};i.unshift(v),s.subLayerIds.push(c.id)}};var l;return e.sublayers&&e.sublayers.forEach(u),i.length&&(i=i.map(({id:c,name:m,layerDefinition:T})=>({id:c,name:m,layerDefinition:T})),r={layerType:(l=e.write()).layerType,customParameters:l.customParameters},r.layers=i,r.visibleLayers=(y=(o=e.capabilities)==null?void 0:o.exportMap)!=null&&y.supportsDynamicLayers?void 0:s.subLayerIds,B(r,e),e.legendEnabled&&t.legendLayers.push(s)),r}async function ua({layerView:e,printTemplate:a},t){const r=[],s=e.layer;if(Q(s.featureCollections))for(const i of s.featureCollections){const n=await j(i,i.source,a,t);n&&r.push(...n.featureCollection.layers)}else if(Q(s.sublayers))for(const i of s.sublayers){const n=await j(null,i.graphics,a,t);n&&r.push(...n.featureCollection.layers)}return{featureCollection:{layers:r}}}function ca(){return{type:"OpenStreetMap"}}async function J(e,{printTemplate:a,view:t},r){var c;const s={type:"image"},i={format:"png",ignoreBackground:!0,layers:[e],rotation:0},n=r.ssExtent||t.extent.clone();let u=96,l=!0,o=!0;if(a.exportOptions){const m=a.exportOptions;m.dpi!=null&&m.dpi>0&&(u=m.dpi),m.width!=null&&m.width>0&&(l=m.width%2==t.width%2),m.height!=null&&m.height>0&&(o=m.height%2==t.height%2)}if(a.layout==="map-only"&&a.scalePreserved&&(!a.outScale||a.outScale===t.scale)&&u===96&&(!l||!o)&&(i.area={x:0,y:0,width:t.width,height:t.height},l||(i.area.width-=1),o||(i.area.height-=1),!r.ssExtent)){const m=t.toMap(ct(i.area.width,i.area.height));n.ymin=m.y,n.xmax=m.x,r.ssExtent=n}s.extent=n.clone()._normalize(!0).toJSON();const y=await t.takeScreenshot(i);return s.imageData=(c=pt(y.dataUrl))==null?void 0:c.data,s}async function pa(e,{layerView:a,printTemplate:t},r){return e.legendEnabled&&r.legendLayers.push({id:e.id}),j(e,await ue(a),t,r)}async function da(e){var s,i;const a=[],t=[];for(const n of e.map.allTables)n.type!=="feature"||n.loaded||t.push(n.load());t.length&&await Promise.allSettled(t);for(const n of e.map.allTables)if(n.type==="feature"&&n.loaded&&n.isTable&&((s=n.source)==null?void 0:s.type)==="feature-layer"){const u={id:(r=n.write()).id,title:r.title,customParameters:r.customParameters,layerDefinition:{definitionExpression:(i=r.layerDefinition)==null?void 0:i.definitionExpression}};B(u,n),a.push(u)}var r;return a.length?a:void 0}function ya(e,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const t={layerType:(r=e.write()).layerType,customParameters:r.customParameters};var r;return B(t,e),t}async function ma(e,a,t){if(t.is11xService&&e.serviceUrl&&e.styleUrl){const r=xe(e.styleUrl,e.apiKey),s=xe(e.serviceUrl,e.apiKey);if(!r&&!s||t.cimVersion!=="2.1.0"){const i={type:"VectorTileLayer"};return i.styleUrl=X(e.styleUrl),i.token=r,s!==r&&(i.additionalTokens=[{url:e.serviceUrl,token:s}]),i}}return J(e,a,t)}function fa(e){var r;const a=(r=e.urlTemplate)==null?void 0:r.replace(/\${/g,"{"),t={type:"WebTiledLayer",urlTemplate:a,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function ha(e){let a;const t=[],r=s=>{s.visible&&(s.sublayers?s.sublayers.forEach(r):s.name&&t.unshift(s.name))};return e.sublayers&&e.sublayers.forEach(r),t.length&&(a={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:t,url:X(e.url),version:e.version}),a}function ga(e){const a=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:a.imageFormat,layer:a.id,style:a.styleId,tileMatrixSet:a.tileMatrixSetId,url:X(e.url)}}function B(e,a){a.url&&(e.url=X(e.url||a.url),e.token=xe(e.url,a.apiKey))}async function se(e,a){var n;a.canvas||(a.canvas=document.createElement("canvas"));const t=1024;a.canvas.width=t,a.canvas.height=t;const r=a.canvas.getContext("2d");let s,i;if(e.path){const u=new Path2D(e.path);u.closePath(),r.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",r.fill(u);const l=kt(r);if(!l)return null;r.clearRect(0,0,t,t);const o=ae(e.size)/Math.max(l.width,l.height);r.scale(o,o);const y=t/o,c=y/2-l.width/2-l.x,m=y/2-l.height/2-l.y;if(r.translate(c,m),Array.isArray(e.color)&&r.fill(u),((n=e.outline)==null?void 0:n.width)&&Array.isArray(e.outline.color)){const p=e.outline;r.lineWidth=ae(p.width)/o,r.lineJoin="round",r.strokeStyle=`rgba(${p.color[0]},${p.color[1]},${p.color[2]},${p.color[3]/255})`,r.stroke(u),l.width+=r.lineWidth,l.height+=r.lineWidth}l.width*=o,l.height*=o;const T=r.getImageData(t/2-l.width/2,t/2-l.height/2,Math.ceil(l.width),Math.ceil(l.height));s=T.width,i=T.height,r.canvas.width=s,r.canvas.height=i,r.putImageData(T,0,0)}else{const u=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,l=(await z(u,{responseType:"image"})).data;s=ae(e.width),i=ae(e.height),r.canvas.width=s,r.canvas.height=i,r.drawImage(l,0,0,r.canvas.width,r.canvas.height)}return{type:"esriPMS",imageData:r.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:R(i),width:R(s),xoffset:e.xoffset,yoffset:e.yoffset}}async function Be(e,a){const t=e.type;if(t==="simple"&&ie(e.symbol))e.symbol=await se(e.symbol,a);else if(t==="uniqueValue"||t==="classBreaks"){ie(e.defaultSymbol)&&(e.defaultSymbol=await se(e.defaultSymbol,a));const r=e[t==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(r)for(const s of r)ie(s.symbol)&&(s.symbol=await se(s.symbol,a))}}async function ue(e){return e.queryFeatures(e.createQuery()).then(a=>a.features)}function xa(e){return e.gpMetadata&&e.gpMetadata.executionType?Kt.fromJSON(e.gpMetadata.executionType):"sync"}function ie(e){return e&&(e.path||e.contentType==="image/svg+xml"||e.url&&e.url.endsWith(".svg"))}let G=class extends Te{constructor(e){super(e),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};d([x()],G.prototype,"extent",void 0),d([x()],G.prototype,"extraParameters",void 0),d([x()],G.prototype,"outSpatialReference",void 0),d([x()],G.prototype,"template",void 0),d([x()],G.prototype,"updateDelay",void 0),d([x()],G.prototype,"view",void 0),G=d([A("esri.rest.support.PrintParameters")],G);const ba=G,Ke={results:[{paramName:"Output_JSON",dataType:"GPString",value:[{layoutTemplate:"85x11_landscape",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[10,6.7],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"85x11_landscape_attributes",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"85x11_landscape_attributes_legend",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"85x11_landscape_legend",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[10,6.7],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"85x11_portrait",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"85x11_portrait_attributes",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"},{PropertyInfo:""}]}},{layoutTemplate:"85x11_portrait_attributes_legend",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"},{PropertyInfo:""}]}},{layoutTemplate:"85x11_portrait_legend",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"11x17_landscape",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[16,9],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_landscape_attributes",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[13,10],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_landscape_attributes_legend",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[13,10],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_landscape_legend",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[16,9],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_portrait",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_portrait_attributes",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"},{PropertyInfo:" "}]}},{layoutTemplate:"11x17_portrait_attributes_legend",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"},{PropertyInfo:" "}]}},{layoutTemplate:"11x17_portrait_legend",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"24x36_landscape",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[35,21],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_landscape_attributes",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[28,23],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:"Text"},{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_landscape_attributes_legend",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[28,23],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:"Text"},{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_landscape_legend",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[35,21],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_portrait",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_portrait_attributes",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"24x36_portrait_attributes_legend",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"24x36_portrait_legend",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[47,32.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape_attributes",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[38,35],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape_attributes_legend",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[38,35],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape_legend",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[47,32.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_portrait",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_portrait_attributes",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!1,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"36x48_portrait_attributes_legend",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!1,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"36x48_portrait_legend",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}}]}],messages:[]},Sa=async e=>{try{const t=(await z(e,{query:{f:"json"}})).data.parameters.find(r=>r.name==="Format");return t==null?void 0:t.choiceList}catch(a){return console.log(a),[]}},Pe=e=>{const a=Math.round(e*600/564.248588);return a<=75?75:a>75&&a<=150?150:a>150&&a<=300?300:a>300&&a<=600?600:a>600&&a<=1200?1200:a>1200&&a<=2400?2400:a>2400&&a<=4800?4800:a>4800&&a<=9600?9600:a>9600&&a<=19200?19200:a>19200&&a<=38400?38400:a>38400&&a<=76800?76800:a>76800&&a<=153600?153600:a>153600&&a<=307200?307200:a>307200&&a<=614400?614400:a>614400&&a<=1228800?1228800:0},Ta=e=>{var t;const a=(t=yt.create().lods.filter(r=>r.scale>=300&&r.scale<614400).map(r=>{const s=Pe(r.scale);return{scale:s,label:`1" = ${(s/12).toLocaleString("en")}'`}}))==null?void 0:t.reverse();return a.push({scale:"custom",label:"User Defined"}),a},wa=(e,a,t,r)=>{let s=e==="current"?a:t;return t==="custom"&&r&&(s=r*12),Pe(s)},va=async()=>{const e=[],a=[];return Ke.results[0].value.forEach(t=>{const r=t.pageSize[0],s=t.pageSize[1];let i=`${r}"x${s}"`,n="Portrait",u=r,l=`${r}x${s}_${n.toLowerCase()}`;r>s&&(i=`${s}"x${r}"`,n="Landscape",l=`${s}x${r}_${n.toLowerCase()}`,u=s),i+=` ${n}`;const o={label:i,template:l,size:u};a.includes(o.template)||(e.push(o),a.push(o.template))}),e.sort((t,r)=>t.size-r.size),e},Pa=(e,a,t)=>{let r=e.template?e.template.replace(".",""):JSON.parse(e).template.replace(".","");return a&&(r+="_attributes"),t&&(r+="_legend"),r},Ia=(e,a,t,r,s,i)=>new qe({attributionVisible:!1,outScale:e,showLabels:!0,format:a,scalePreserved:!0,exportOptions:{dpi:200},layoutOptions:{titleText:t,scalebarUnit:"Feet",customTextElements:r,legendLayers:[]},layout:i}),Ca=e=>{let a="";return e.layer.popupTemplate.fieldInfos.forEach(t=>{if(!["OBJECTID","PARCEL_PK","PARCEL_STATUS"].includes(t.fieldName)&&e.getAttribute(t.fieldName)&&e.getAttribute(t.fieldName)!==null)if(t.fieldName.includes("DATE")){const r=new Date(e.getAttribute(t.fieldName));a+=`${t.label}: ${r.getUTCMonth()+1}/${r.getUTCDate()}/${r.getUTCFullYear()}
`}else t.fieldName.includes("PRICE")||t.fieldName.includes("VAL")?a+=`${t.label}: $${e.getAttribute(t.fieldName)}
`:a+=`${t.label}: ${e.getAttribute(t.fieldName)}
`}),a},La=(e,a,t,r)=>{const s=[];if(s.push({Scale:(a/12).toString()}),e<24?(s.push({HalfScale:(a/12/2).toString()}),s.push({"2xScale":a/12*2+" ft"})):e<36?(s.push({"2xScale":a/12*2}),s.push({"4xScale":a/12*4+" ft"})):(s.push({"2xScale":a/12*2}),s.push({"4xScale":a/12*4}),s.push({"6xScale":a/12*6+" ft"})),t){const i=Ca(r);s.push({PropertyInfo:i})}return s},Oa=(e,a,t,r,s,i,n,u,l,o,y,c,m,T)=>{if(e){const p=wa(t,e==null?void 0:e.scale,r,s?parseInt(s.value):void 0),g=e==null?void 0:e.map.findLayerById("print-graphic");g&&(g.visible=!1);const v=La(i.size,p,o,u),P=Pa(i,o,y),f=Ia(p,n,l,v,e,P),h={title:l,loading:!0,submitted:new Date().getTime().toString(),href:null};T([...m,h]),c.current=[...c.current,h];const C=e.scale;setTimeout(async()=>{try{const I=await Ma(a,f,e,C,n);setTimeout(()=>{g&&(g.visible=!0);const w=c.current.indexOf(h);c.current[w]={...c.current[w],url:I==null?void 0:I.url,loading:!1},T([...c.current])})}catch(I){console.log(I),g&&(g.visible=!0);const w=c.current.indexOf(h);c.current[w]={...c.current[w],error:!0,loading:!1},T([...c.current])}},1e3)}},Ma=async(e,a,t,r,s)=>{try{return a.format=s,await Wt(e,new ba({template:a,view:t,outSpatialReference:new he({wkid:3632})}),{timeout:12e4,headers:{"Content-Type":"application/json;charset=UTF-8"}})}catch(i){console.log(i)}};let fe=null;const Y=(e,a,t,r,s)=>{let i=a.map.findLayerById("print-graphic");i||(i=new mt({id:"print-graphic",listMode:"hide"}),a.map.add(i)),i.removeAll();let n=null;s.current&&(n=s.current.value),e?(Re(i,a,t,r,n),fe=a.watch("stationary",u=>{i.removeAll(),s.current&&(n=s.current.value),Re(i,a,t,r,n)})):fe&&fe.remove()},Re=(e,a,t,r,s)=>{setTimeout(async()=>{var v,P;await ft();const i=ht(a.extent.center,{wkid:2264}),u=(t.template?t:JSON.parse(t)).template.replace(".",""),l=Ke.results[0].value.filter(f=>f.layoutTemplate===u);let o=r==="current"?Pe(a.scale):parseInt(s);o=o/12;const y=((v=l[0])==null?void 0:v.webMapFrameSize[0])*o,c=((P=l[0])==null?void 0:P.webMapFrameSize[1])*o,m=i.x+y/2,T=i.y+c/2,p=i.x-y/2,g=i.y-c/2;e.removeAll(),e.add(new gt({symbol:{type:"simple-fill",style:"cross",outline:{width:2,color:[149,149,149,1]}},geometry:new we({xmax:m,xmin:p,ymax:T,ymin:g,spatialReference:{wkid:2264}})}))})},Da={title:"Print Tips",tips:[]},Na=e=>{const a=L.useRef(!1),[t,r]=L.useState(!1),s=L.useRef(null),i=L.useRef(null),n=L.useRef(null),u=L.useRef(null),l=L.useRef(null),o=L.useRef([]),y=L.useRef(null),c=L.useRef(null),[m,T]=L.useState([]),[p,g]=L.useState([]),[v,P]=L.useState("current"),[f,h]=L.useState(),[C,I]=L.useState(),[w,O]=L.useState(),[N,S]=L.useState(),[M,ee]=L.useState([]);L.useEffect(()=>{a.current||(a.current=!0,va().then(V=>{T(V),O(V[0])}),Sa(e.exportUrl).then(V=>{g(V),S(V[0])}))},[]);const te=L.useCallback(V=>{e.showTips(Da)},[]);L.useEffect(()=>{I(e.selectedProperty)},[e.selectedProperty]),L.useEffect(()=>{r(e.isActive)},[e.isActive]);const We=L.useCallback(V=>{Y(V.target.checked,e.view,w,v,s)},[w,v,f]);return{isActive:t,title:l,setSelectedLayout:O,layouts:m,selectedFormat:N,setSelectedFormat:S,formats:p,setScaleType:P,scaleType:v,customScaleSelect:s,setCustomScale:h,customScale:f,userDefined:u,selectedProperty:C,selectedLayout:w,attributes:i,legend:n,setJobs:ee,jobs:M,jobRef:o,tipsClicked:te,showFrameChanged:We,frame:y,scale:c}},Ea=e=>{const{isActive:a,title:t,setSelectedLayout:r,layouts:s,selectedFormat:i,setSelectedFormat:n,formats:u,setScaleType:l,scaleType:o,customScaleSelect:y,setCustomScale:c,customScale:m,userDefined:T,selectedProperty:p,selectedLayout:g,attributes:v,legend:P,setJobs:f,jobs:h,jobRef:C,tipsClicked:I,showFrameChanged:w,frame:O}=Na(e),N=L.useCallback(S=>{e.toolDismissed()},[]);return b.jsxs(bt,{id:"print-panel",heading:"Print","data-panel":"print",hidden:!a,closed:a?void 0:!0,closable:!0,onCalcitePanelClose:N,children:[b.jsx(Oe,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:I}),b.jsx(Oe,{id:"collapseTool",icon:"chevron-up",text:"",slot:"header-actions-end",onClick:St}),b.jsx(Me,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),b.jsx(Me,{label:"Collapse",referenceElement:"collapseTool",closeOnClick:!0,children:"Collapse"}),b.jsxs("div",{id:"print-container",children:[b.jsxs(_,{children:["Title",b.jsx(De,{ref:t,maxLength:50})]}),b.jsxs(_,{children:["Page size",b.jsx(ce,{label:"",onCalciteSelectChange:S=>{r(S.target.selectedOption.value),O.current&&Y(O.current.checked,e.view,g,o,y)},children:s.map((S,M)=>b.jsx(pe,{label:S.label,value:JSON.stringify(S)},M))})]}),b.jsxs(_,{children:["File format",b.jsx(ce,{label:"",onCalciteSelectChange:S=>n(S.target.selectedOption.value),children:u.map((S,M)=>b.jsx(pe,{label:S,value:S},M))})]}),b.jsxs(Tt,{name:"scale-radio",children:[b.jsxs(_,{layout:"inline",children:[b.jsx(Ne,{checked:o==="current"?!0:void 0,value:"current",onCalciteRadioButtonChange:S=>{l(S.target.value),O.current&&Y(O.current.checked,e.view,g,o,y)}}),"Current Scale"]}),b.jsxs(_,{layout:"inline",children:[b.jsx(Ne,{checked:o==="custom"?!0:void 0,value:"custom",onCalciteRadioButtonChange:S=>{l(S.target.value),O.current&&Y(O.current.checked,e.view,g,o,y)}}),"Custom Scale"]})]}),o==="custom"&&b.jsxs(_,{children:["Scale",b.jsx(ce,{ref:y,label:"",onCalciteSelectChange:S=>{c(S.target.selectedOption.value),O.current&&Y(O.current.checked,e.view,g,o,y)},children:(e==null?void 0:e.view)&&Ta(e==null?void 0:e.view).map((S,M)=>b.jsx(pe,{label:S.label,value:S.scale},M))})]}),o==="custom"&&m==="custom"&&b.jsx(De,{ref:T,type:"number",prefixText:'1" = ',suffixText:"'",min:1,max:5e4}),b.jsx("br",{}),p&&b.jsxs(_,{layout:"inline",children:[b.jsx(de,{ref:v,value:"attributes"}),"Include attributes?"]}),b.jsxs(_,{layout:"inline",children:[b.jsx(de,{ref:P,value:"legend"}),"Include Legend?"]}),b.jsxs(_,{layout:"inline",children:[b.jsx(de,{ref:O,value:"frameChecked",onCalciteCheckboxChange:w}),"Show map frame?"]}),b.jsx(Ee,{width:"full",onClick:()=>{var S,M,ee,te;Oa(e.view,e.exportUrl,o,m,(S=T==null?void 0:T.current)==null?void 0:S.value,g,i,p,(M=t.current)==null?void 0:M.value,(ee=v.current)==null?void 0:ee.checked,(te=P.current)==null?void 0:te.checked,C,h,f)},children:"Export"}),b.jsx("hr",{}),b.jsx("h4",{children:"Exported files"}),h.length<=0&&b.jsx("p",{children:"Your exported files will appear here"}),b.jsx("div",{id:"printJobs",children:h.map(S=>b.jsxs("div",{className:"print-job",children:[S.loading&&b.jsxs("div",{children:[b.jsx(wt,{scale:"s",inline:!0,label:""}),b.jsx("span",{className:"loader-text",children:`${S.title!==""?S.title:"untitled"}`})]}),S.url&&!S.loading&&b.jsxs("div",{children:[b.jsx(vt,{target:"_blank","icon-start":"download",href:S.url,children:`${S.title!==""?S.title:"untitled"}`}),b.jsx(Ee,{appearance:"transparent","icon-start":"x",scale:"s",onClick:()=>{C.current=h.filter(M=>M.title!==S.title),f(h.filter(M=>M!==S))}})]})]},`printjob_${S.submitted}`))})]})]})},ka=xt.memo(Ea);export{ka as default};
