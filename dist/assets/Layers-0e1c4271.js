import{e as d,y as c,u as re,a as N,v as de,w as G,x as f,z as u,A as Q,_ as U,B as A,W as ce,D as T,E as Le,F as z,G as Se,I as he,J as ue,K as Ee,L as $e,M as ee,N as xe,O as k,P as Me,Q as Te,T as ke,U as Pe,r as I,k as C,V as Re,X as pe,Y as Oe,Z as ge,m as Ve,o as te,p as Ne,$ as Fe,a0 as De}from"./index-7753bab1.js";import{S as Ue}from"./sortable.esm-be94e56d.js";var X;let x=X=class extends re{constructor(e){super(e),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new X({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};d([c()],x.prototype,"displayValueEnabled",void 0),d([c()],x.prototype,"max",void 0),d([c()],x.prototype,"min",void 0),d([c()],x.prototype,"step",void 0),d([c()],x.prototype,"value",void 0),x=X=d([N("esri.support.Action.ActionSlider")],x);const je=x,ye={hide:"hide",hideChildren:"hide-children"};function j(e){if(e)return e.listMode!=null?e.listMode:void 0}function Be(e){if(e)return e.minScale!=null?e.minScale:void 0}function Ye(e){if(e)return e.maxScale!=null?e.maxScale:void 0}function He(e){if(!e)return"inherited";const t=e.get("layer.capabilities.exportMap.supportsSublayerVisibility");if(typeof t=="boolean")return t?"independent":"inherited";const i=e.get("capabilities.exportMap.supportsSublayerVisibility");return typeof i=="boolean"?i?"independent":"inherited":e.visibilityMode!=null?e.visibilityMode:"independent"}function me(e){if(e&&(!("type"in e)||e.type!=="wmts")&&e.listMode!==ye.hideChildren)return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function We(e){const t=e&&(e.get("layer.layer")||e.layer);if(!t)return!1;const i=t.get("capabilities.exportMap.supportsDynamicLayers");return typeof i!="boolean"||i}function ze(e){return j(e)!==ye.hide}function Xe(e,t){if(!e||isNaN(t))return!1;const i=Be(e),s=Ye(e),n=!isNaN(i)&&i>0&&t>i,l=!isNaN(s)&&s>0&&t<s;return n||l}function be(e,t){e&&e.sort((i,s)=>{const n=t.indexOf(i.uid),l=t.indexOf(s.uid);return n>l?-1:n<l?1:0})}function Ge(e,t){const i=e==null?void 0:e.layer;if(!i)return;const s=me(i);s&&be(i.get(s),t)}function ie(e){const t=e==null?void 0:e.layer;return t&&"layers"in t?t.layers:null}function B(e,t){var s;const i=(s=e.layer)==null?void 0:s.uid;return i&&t.find(n=>{var l;return((l=n.layer)==null?void 0:l.uid)===i})}function Ke(e){const t=Ze(e)?e:null,i=e==null?void 0:e.parent,s=(i==null?void 0:i.type)==="map-image"&&t.source,n="";return s&&i?{layer:i,title:n,sublayerIds:[s.mapLayerId]}:{layer:e,title:n}}function Ze(e){return!!(e!=null&&e.layer)}const _e="esri-layer-list-panel",R=`${_e}__content`,$={base:_e,content:R,contentLegend:`${R}--legend`,contentString:`${R}--string`,contentElement:`${R}--html-element`,contentWidget:`${R}--widget`},qe="legends";let S=class extends de(ce){constructor(e,t){super(e,t),this._legend=null,this._handles=new G,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles(f(()=>this.content,e=>this._createLegend(e),A))}destroy(){const{_legend:e}=this;e&&e.destroy(),this._legend=null}get className(){const{image:e}=this,t=this._getFirstWidget();return this._get("className")||!e&&t?t.iconClass:""}set className(e){this._override("className",e)}get disabled(){var s;const{listItem:e,_legend:t,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!t&&(!((s=t.activeLayerInfos)!=null&&s.length)||!e.visibleAtCurrentScale)}set disabled(e){this._overrideIfSome("disabled",e)}get title(){const e=this._getFirstWidget();return this._get("title")||e?e.label:""}set title(e){this._override("title",e)}render(){return u("div",{class:$.base},this._renderContents())}_renderContent(e){const{_legend:t,disabled:i}=this;return!e||i?null:e==="legend"&&t?u("div",{class:this.classes($.content,$.contentLegend),key:t},t.render()):typeof e=="string"?u("div",{class:this.classes($.content,$.contentString),key:e,innerHTML:e}):Q(e)?u("div",{class:this.classes($.content,$.contentWidget),key:e},e.render()):e instanceof HTMLElement?u("div",{class:this.classes($.content,$.contentElement),key:e,bind:e,afterCreate:this._attachToNode}):null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map(t=>this._renderContent(t)):this._renderContent(e)}_getLegendOptions(){const{listItem:e}=this;if(!e)return{};const{layer:t,view:i}=e;return t&&i?{view:i,layerInfos:[Ke(t)]}:{}}_createLegend(e){this._hasLegend(e)&&!this._legend&&U(()=>import("./Legend-f235c298.js"),["assets/Legend-f235c298.js","assets/index-7753bab1.js","assets/index-0be7f32f.css","assets/EffectView-9a9cc65b.js","assets/ExportImageParameters-435aace7.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-2efb8cde.js","assets/pixelRangeUtils-03719dd8.js","assets/rendererConversion-50e438d4.js"]).then(({default:t})=>{const{_handles:i,listItem:s}=this,n=new t(this._getLegendOptions());this._legend=n,this.notifyChange("className"),this.notifyChange("title");const l=f(()=>{var o,r;return[s==null?void 0:s.view,s==null?void 0:s.layer,(o=s==null?void 0:s.layer)==null?void 0:o.source,(r=s==null?void 0:s.layer)==null?void 0:r.parent]},()=>this._updateLegend(n),A);i.add(l,qe),this.scheduleRender()})}_hasLegend(e){const t="legend";return e===t||!!Array.isArray(e)&&e.includes(t)}_attachToNode(e){e.appendChild(this)}_updateLegend(e){e.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(e){return e==="legend"?this._legend:Q(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let t=null;return e.some(i=>{const s=this._getWidget(i);return s&&(t=s),!!s}),t}return this._getWidget(e)}};d([c()],S.prototype,"_legend",void 0),d([c()],S.prototype,"className",null),d([c()],S.prototype,"content",void 0),d([c()],S.prototype,"disabled",null),d([c()],S.prototype,"image",void 0),d([c()],S.prototype,"listItem",void 0),d([c()],S.prototype,"title",null),d([c()],S.prototype,"open",void 0),d([c()],S.prototype,"visible",void 0),S=d([N("esri.widgets.LayerList.ListItemPanel")],S);const ve=S;var V;const Je=T.ofType({key:"type",defaultKeyValue:"button",base:re,typeMap:{button:Le,toggle:z,slider:je}}),fe=T.ofType(Je),F="layer",Y="child-list-mode",Qe="hide",et="esri.widgets.LayerList.ListItem";let g=V=class extends de(Se(Ee)){constructor(e){super(e),this.actionsSections=new fe,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(T.ofType(V)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null}initialize(){if(this.handles.add([f(()=>this.layer,e=>this._watchLayerProperties(e),A),f(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),A),f(()=>this.view,e=>this._updateChildrenView(e),A),f(()=>this.panel,e=>this._setListItemOnPanel(e),A),f(()=>[this.layer,this.view],()=>this._getLayerView(),A)]),typeof this.listItemCreatedFunction=="function"){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){var e;return(e=this.layer)==null?void 0:e.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e))&&!e.spatialReferenceSupported}castPanel(e){return this.get("panel.open")&&!e.hasOwnProperty("open")&&(e.open=!0),e?new ve(e):null}get title(){const e=this.get("layer.layer");return(!e||e&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){var i;const{layer:e,checkPublishStatusEnabled:t}=this;return t&&e&&"publishingInfo"in e&&((i=e.publishingInfo)==null?void 0:i.status)==="publishing"}get updating(){const{layerView:e,connectionStatus:t,layer:i,publishing:s}=this;return!s&&!t&&(e?e.updating:(i==null?void 0:i.loadStatus)==="loading"||!1)}get visible(){var e;return(e=this.layer)==null?void 0:e.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return!Xe(this.layer,this.get("view.scale"))}get visibilityMode(){return He(this.layer)}clone(){return new V({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){const t=this.children;t&&t.forEach(i=>i.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(i=>i.view=e)}_addChildren(e){if(this.handles.remove(Y),this.children.removeAll(),!e)return;e.forEach(i=>{this.handles.add(f(()=>i.listMode,()=>this._addChildren(e)),Y)});const t=e.filter(i=>j(i)!==Qe);this.children.addMany(this._makeChildren(t))}_watchSublayerChanges(e){e&&this.handles.add(e.on("change",()=>{this._addChildren(e)}),F)}_initializeChildLayers(e){this._addChildren(e),this._watchSublayerChanges(e)}_makeChildren(e){return e.map(t=>ze(t)?new V({layer:t,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null).filter(he).reverse()}_watchLayerProperties(e){if(!this.handles||(this.handles.remove(F),this.handles.remove(Y),!e))return;if(this.handles.add(f(()=>e.listMode,()=>this._watchLayerProperties(e)),F),j(e)==="hide-children")return void this.children.removeAll();const t=me(e);t&&this.handles.add(f(()=>e[t],()=>{e.hasOwnProperty(t)&&this._initializeChildLayers(e[t])},A),F)}async _getLayerView(){const{layer:e,view:t}=this;if(e&&t)try{const i=await t.whenLayerView(e);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}};d([c({type:fe})],g.prototype,"actionsSections",void 0),d([c()],g.prototype,"actionsOpen",void 0),d([c()],g.prototype,"checkPublishStatusEnabled",void 0),d([c({type:T})],g.prototype,"children",void 0),d([c()],g.prototype,"childrenSortable",void 0),d([c({readOnly:!0})],g.prototype,"connectionStatus",null),d([c({readOnly:!0})],g.prototype,"error",null),d([c()],g.prototype,"hidden",void 0),d([c({readOnly:!0})],g.prototype,"incompatible",null),d([c()],g.prototype,"layer",void 0),d([c({readOnly:!0})],g.prototype,"layerView",void 0),d([c()],g.prototype,"listItemCreatedFunction",void 0),d([c()],g.prototype,"open",void 0),d([c({type:ve})],g.prototype,"panel",void 0),d([ue("panel")],g.prototype,"castPanel",null),d([c()],g.prototype,"parent",void 0),d([c()],g.prototype,"sortable",void 0),d([c()],g.prototype,"title",null),d([c({readOnly:!0})],g.prototype,"publishing",null),d([c({readOnly:!0})],g.prototype,"updating",null),d([c()],g.prototype,"view",void 0),d([c()],g.prototype,"visible",null),d([c({readOnly:!0})],g.prototype,"visibleAtCurrentScale",null),d([c({readOnly:!0})],g.prototype,"visibilityMode",null),g=V=d([N(et)],g);const K=g,L={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode",children:"children"},tt="hide",Ie=T.ofType(K);let M=class extends $e.EventedAccessor{constructor(e){super(e),this._handles=new G,this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new Ie,this.view=null}initialize(){this._handles.add([f(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready]},()=>this._viewHandles(),A),f(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],L.view)}destroy(){this._handles.destroy(),this._handles=null,this.view=null,this.operationalItems.removeAll()}get state(){const e=this.get("view");return this.get("view.ready")?"ready":e?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,s){var w,E;const n=e==null?void 0:e.layer;if(!n)return;const l=(E=(w=this.view)==null?void 0:w.map)==null?void 0:E.layers,o=t?ie(t):l,r=i?ie(i):l;if(!o||!r)return;const{operationalItems:h}=this,p=(t==null?void 0:t.children)||h,y=(i==null?void 0:i.children)||h,b=r.length-s;e.parent=i||null,p.includes(e)&&p.remove(e),o.includes(n)&&o.remove(n),y.includes(e)||y.add(e,b),r.includes(n)||r.add(n,b)}_createLayerViewHandles(e){const{_handles:t}=this;t.remove(L.layerViews),this._compileList(),e&&t.add(e.on("change",()=>this._compileList()),L.layerViews)}_createMapLayerHandles(e){const{_handles:t}=this;t.remove(L.mapLayers),this._compileList(),e&&t.add(e.on("change",()=>this._compileList()),L.mapLayers)}_createListItem(e){const{view:t,listItemCreatedFunction:i,checkPublishStatusEnabled:s}=this;return new K({checkPublishStatusEnabled:s,layer:e,listItemCreatedFunction:i,view:t})}_removeAllItems(){const{_handles:e,operationalItems:t}=this;t.forEach(i=>{e.remove(`${L.children}-${i.uid}`)}),t.removeAll()}_getViewableLayers(e){if(e)return e.filter(t=>j(t)!==tt)}_watchLayersListMode(e){const{_handles:t}=this;t.remove(L.layerListMode),e&&e.forEach(i=>{"listMode"in i&&t.add(f(()=>i.listMode,()=>this._compileList()),L.layerListMode)})}_compileList(){const e=this.get("view.map.layers");this._watchLayersListMode(e);const t=this._getViewableLayers(e);t&&t.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(i=>{t.find(s=>s.layer===i)||t.add(this._createListItem(i))})}_removeItems(e){const{_handles:t,operationalItems:i}=this,s=[];i.forEach(n=>{n&&e&&e.includes(n.layer)||(t.remove(`${L.children}-${n.uid}`),s.push(n))}),i.removeMany(s)}_sortItems(e){const{operationalItems:t}=this;t.sort((i,s)=>{const n=e.indexOf(i.layer),l=e.indexOf(s.layer);return n>l?-1:n<l?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{_handles:e,view:t}=this;e.remove([L.mapLayers,L.layerViews,L.viewLayers]),this._compileList(),t&&t.ready&&e.add([f(()=>{var i,s;return(s=(i=this.view)==null?void 0:i.map)==null?void 0:s.allLayers},i=>this._createMapLayerHandles(i),A),f(()=>{var i;return(i=this.view)==null?void 0:i.allLayerViews},i=>this._createLayerViewHandles(i),A)],L.viewLayers)}};d([c()],M.prototype,"checkPublishStatusEnabled",void 0),d([c()],M.prototype,"listItemCreatedFunction",void 0),d([c({type:Ie})],M.prototype,"operationalItems",void 0),d([c({readOnly:!0})],M.prototype,"state",null),d([c()],M.prototype,"view",void 0),M=d([N("esri.widgets.LayerList.LayerListViewModel")],M);const we=M;function se(e,t,i){e.splice(i,0,e.splice(t,1)[0])}const it="esri-layerlist-new-ui",st=T.ofType(K),ne="data-sort-filter",le="data-layer-uid",nt="layerUid",v="esri-layer-list",_=`${v}__item`,a={base:`${v} esri-widget esri-widget--panel`,newUI:`${v}--new-ui`,noItems:`${v}__no-items`,list:`${v}__list`,listRoot:`${v}__list--root`,listExclusive:`${v}__list--exclusive`,listInherited:`${v}__list--inherited`,listIndependent:`${v}__list--independent`,item:_,itemContent:`${_}-content`,itemMessage:`${_}--has-message`,itemInvisible:`${_}--invisible`,itemInvisibleAtScale:`${_}--invisible-at-scale`,itemChildren:`${_}--has-children`,itemSelectable:`${_}--selectable`,itemContainer:`${_}-container`,actionsMenu:`${_}-actions-menu`,actionsMenuItem:`${_}-actions-menu-item`,actionsMenuItemActive:`${_}-actions-menu-item--active`,actions:`${_}-actions`,actionsList:`${_}-actions-list`,action:`${_}-action`,actionIcon:`${_}-action-icon`,actionImage:`${_}-action-image`,actionTitle:`${_}-action-title`,actionToggle:`${v}__action-toggle`,actionToggleOn:`${v}__action-toggle--on`,label:`${_}-label`,message:`${_}-message`,title:`${_}-title`,statusIndicator:`${v}__status-indicator`,publishing:`${v}__publishing`,updating:`${v}__updating`,connectionStatus:`${v}__connection-status`,connectionStatusConnected:`${v}__connection-status--connected`,toggleVisible:`${_}-toggle`,toggleVisibleIcon:`${_}-toggle-icon`,toggleIcon:`${_}-toggle-icon`,radioIcon:`${_}-radio-icon`,childToggle:`${v}__child-toggle`,childToggleOpen:`${v}__child-toggle--open`,childOpened:`${v}__child-toggle-icon--opened`,childClosed:`${v}__child-toggle-icon--closed`,childClosed_RTL:`${v}__child-toggle-icon--closed-rtl`,sortableChosen:`${v}--chosen`,disabled:"esri-disabled",disabledElement:"esri-disabled-element",hidden:"esri-hidden",rotating:"esri-rotating",iconEllipses:"esri-icon-handle-horizontal",iconVisible:"esri-icon-visible",iconInvisible:"esri-icon-non-visible",iconRadioSelected:"esri-icon-radio-checked",iconRadioUnselected:"esri-icon-radio-unchecked",iconNoticeTriangle:"esri-icon-notice-triangle",iconChildrenOpen:"esri-icon-down-arrow",iconDownArrow:"esri-icon-down-arrow",iconRightArrow:"esri-icon-right-triangle-arrow",iconLeftArrow:"esri-icon-left-triangle-arrow",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",widgetIcon:"esri-icon-layers"},H={actions:"actions",actionSection:"action-section",items:"items"},O={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function Ce(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach(s=>Ce(s))}const W="root",oe={statusIndicators:!0,errors:!1};let m=class extends ce{constructor(e,t){super(e,t),this._handles=new G,this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._newUI=Me(it),this._tooltipReferenceMap=new Map,this.visibleItems=null,this.iconClass=a.widgetIcon,this.listItemCanGiveFunction=null,this.listItemCanReceiveFunction=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.selectionEnabled=!1,this.selectedItems=new st,this.viewModel=new we,this.visibleElements={...oe},this._onSortableSort=({to:i,from:s,item:n,newIndex:l})=>{s&&i&&(s===i?this._sortLayers(this._sortableMap.get(s.dataset.group)):this._moveLayerFromChildList({to:i,from:s,item:n,newIndex:l}))},this._sortableCanSort=(i,s)=>!(!i.el.dataset.group||!s.el.dataset.group),this._sortableCanPull=(i,s,n)=>{const{listItemCanGiveFunction:l}=this,o={selected:n["data-item"],from:s.el["data-item"],to:i.el["data-item"]};return!this._sortableCanSort(i,s)||typeof l!="function"||l.call(null,o)},this._sortableCanPut=(i,s,n)=>{const{listItemCanReceiveFunction:l}=this,o={selected:n["data-item"],from:s.el["data-item"],to:i.el["data-item"]};return!this._sortableCanSort(i,s)||typeof l!="function"||l.call(null,o)},this._onSortableEnd=({oldIndex:i,from:s,to:n,item:l})=>{s!==n&&s.insertBefore(l,s.children[i])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.addHandles([Te(()=>this.operationalItems,"change",()=>this._itemsChanged(e)),f(()=>this.visibleElements,()=>this._itemsChanged(e)),f(()=>this.selectionEnabled,()=>this._toggleAllSorting(),A)])}loadDependencies(){return Promise.all([U(()=>import("./calcite-icon-3ff9fa96.js"),["assets/calcite-icon-3ff9fa96.js","assets/index-7753bab1.js","assets/index-0be7f32f.css"]),U(()=>import("./calcite-tooltip-192d0ae3.js"),["assets/calcite-tooltip-192d0ae3.js","assets/index-7753bab1.js","assets/index-0be7f32f.css"])])}destroy(){this._destroySortables(),this._tooltipReferenceMap.clear(),this._handles.destroy(),this._handles=null}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get listItemCreatedFunction(){return this.viewModel.listItemCreatedFunction}set listItemCreatedFunction(e){this.viewModel.listItemCreatedFunction=e}get operationalItems(){return this.viewModel.operationalItems}set operationalItems(e){this.viewModel.operationalItems=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...oe,...e}}triggerAction(e,t){return this.viewModel.triggerAction(e,t)}render(){var o;const{visibleItems:e,_newUI:t}=this,i=(o=this.viewModel)==null?void 0:o.state,s={[a.newUI]:t,[a.hidden]:i==="loading",[a.disabled]:i==="disabled"},n=this.renderItemTooltips(),l=this.renderItems();return u("div",{class:this.classes(a.base,s)},e!=null&&e.length?[n,l]:this.renderNoItems())}renderItemTooltip(e){const{_tooltipReferenceMap:t,messages:i}=this;return e?u("calcite-tooltip",{label:i.layerIncompatible,referenceElement:t.get(e.uid)},i.layerIncompatibleTooltip):null}renderItemTooltipNodes(e){const{incompatible:t,children:i}=e;return[t?this.renderItemTooltip(e):null,...t?[]:i==null?void 0:i.toArray().map(s=>this.renderItemTooltipNodes(s))]}renderItemTooltips(){return this.visibleItems.toArray().map(e=>this.renderItemTooltipNodes(e))}renderNoItems(){return u("div",{class:a.noItems},this.messages.noItemsToDisplay)}renderItems(){const{visibleItems:e,selectionEnabled:t,messages:i}=this;return u("ul",{"aria-label":i.widgetLabel,role:t?"listbox":void 0,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,"data-group":W,bind:this,class:this.classes(a.list,a.listRoot,a.listIndependent)},e==null?void 0:e.map(s=>this.renderItem(s,null)).toArray())}renderActionsMenuIcon(e,t){const{messagesCommon:i}=this,s={[a.actionsMenuItemActive]:e.actionsOpen};return u("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(a.actionsMenuItem,s),tabindex:"0",role:"button","aria-controls":t,"aria-label":i.options,title:i.options},u("span",{"aria-hidden":"true",class:a.iconEllipses}))}renderActionsMenu(e,t,i,s){const{panel:n}=e,l=n&&n.visible?this.renderPanelButton(n):null,o=i===1&&this._getSingleActionButton(t),r=o?this.renderAction({item:e,action:o,singleAction:!0}):null,h=!o&&i?this.renderActionsMenuIcon(e,s):null;return h||l||o?u("div",{key:"actions-menu",class:a.actionsMenu},l,r,h):null}renderChildList(e,t){var y;const{selectionEnabled:i}=this,{visibilityMode:s,children:n}=e,l=this._hasChildren(e),o=!l&&i&&((y=e.layer)==null?void 0:y.type)==="group",{exclusive:r,inherited:h}=O,p={[a.listExclusive]:s===r,[a.listInherited]:s===h,[a.listIndependent]:s!==h&&s!==r};return l||o?u("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,class:this.classes(a.list,p),"aria-expanded":e.open?"true":"false",role:i?"listbox":s===r?"radiogroup":"group",hidden:!e.open&&!o||null},n==null?void 0:n.map(b=>this.renderItem(b,e)).toArray()):null}renderChildrenToggle(e,t){const{messagesCommon:i}=this,s=this._hasChildren(e),n={[a.childToggleOpen]:e.open},l=e.open?i.collapse:i.expand;return s?u("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(a.childToggle,n),tabindex:"0",role:"button","aria-controls":t,"aria-label":l,title:l},u("span",{"aria-hidden":"true",class:this.classes(a.childClosed,a.iconRightArrow)}),u("span",{"aria-hidden":"true",class:this.classes(a.childOpened,a.iconDownArrow)}),u("span",{"aria-hidden":"true",class:this.classes(a.childClosed_RTL,a.iconLeftArrow)})):null}renderItemMessage(e){return e.error?u("div",{key:"esri-layer-list__error",class:a.message,role:"alert"},u("span",{"aria-hidden":"true",class:a.iconNoticeTriangle}),this.messages.layerError):e.incompatible?u("div",{key:"esri-layer-list__incompatible",class:a.message,role:"alert"},u("span",{bind:this,tabIndex:0,"aria-hidden":"true",class:a.iconNoticeTriangle,afterCreate:t=>this._setTooltipReference(t,e)}),this.messages.layerIncompatible):null}renderItemContent(e,t,i){const{id:s}=this,n=`${s}_${e.uid}`,l=`${n}_actions`,o=`${n}__list`,{panel:r}=e,h=this._filterActions(e.actionsSections),p=this._countActions(h);return[u("div",{key:"list-item-container",class:a.itemContainer},this.renderChildrenToggle(e,o),this.renderLabel(e,t,i),this.renderActionsMenu(e,h,p,l)),this.renderItemMessage(e),p?this.renderActionsSections(e,h,l):null,r&&r.open&&!r.disabled?r.render():null,this.renderChildList(e,o)]}renderItem(e,t){var y;const{_newUI:i,id:s,selectionEnabled:n,selectedItems:l}=this,o=`${`${s}_${e.uid}`}__title`,r=this._hasMessage(e),h=this._hasChildren(e),p={[a.itemChildren]:h,[a.itemMessage]:!!r,[a.itemInvisible]:i&&!e.visible,[a.itemInvisibleAtScale]:!e.visibleAtCurrentScale,[a.itemSelectable]:n};if(n){const b={[le]:(y=e.layer)==null?void 0:y.uid,[ne]:(!e.sortable).toString()};return u("li",{key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(a.item,p),"aria-labelledby":o,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":e,"data-group":t?t.uid:W,tabIndex:0,"aria-selected":B(e,l)?"true":"false",role:"option",...b},this.renderItemContent(e,t,o))}return u("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(a.item,p),"aria-labelledby":o},this.renderItemContent(e,t,o))}renderConnectionIcon(e){const{connectionStatus:t}=e;return he(t)?u("calcite-icon",{icon:t==="connected"?"check-circle":"offline",scale:"s"}):null}renderItemStatus(e,t){const{visibleElements:i}=this;if(!i.statusIndicators)return null;const{connectionStatus:s,publishing:n,updating:l}=e,o=l&&!t,r=!!s;return u("span",{class:this.classes({[a.statusIndicator]:!0,[a.publishing]:n,[a.updating]:o,[a.connectionStatus]:r,[a.connectionStatusConnected]:r&&s==="connected"}),key:"layer-item-status"},this.renderConnectionIcon(e))}renderItemTitle(e,t){const{messages:i}=this;if(!e)return null;const s=e.title||i.untitledLayer,n=e.visibleAtCurrentScale?s:`${s} (${i.layerInvisibleAtScale})`;return u("span",{key:"layer-title-container",id:t,title:n,"aria-label":n,class:a.title},s)}renderItemToggleIcon(e,t){const{_newUI:i}=this,{exclusive:s}=O,n=t&&t.visibilityMode,l={[a.toggleVisibleIcon]:i,[a.toggleIcon]:i&&n!==s,[a.radioIcon]:i&&n===s,[a.iconRadioSelected]:n===s&&e.visible,[a.iconRadioUnselected]:n===s&&!e.visible,[a.iconVisible]:n!==s&&e.visible,[a.iconInvisible]:n!==s&&!e.visible};return u("span",{key:"item-toggle-icon",class:this.classes(l),"aria-hidden":"true"})}renderItemToggle(e,t,i){const{selectionEnabled:s,messages:n}=this,{exclusive:l}=O,o=t&&t.visibilityMode,r=o===l?"radio":"switch";return u("span",s?{key:"item-toggle-selection-enabled",class:a.toggleVisible,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":o,tabIndex:0,title:e.visible?n.hideLayer:n.showLayer,"aria-checked":e.visible?"true":"false",role:r,"aria-labelledby":i}:{key:"item-toggle",class:a.toggleVisible},this.renderItemToggleIcon(e,t))}renderLabel(e,t,i){const{selectionEnabled:s,_newUI:n,messages:l}=this,{inherited:o,exclusive:r}=O,h=t==null?void 0:t.visibilityMode,p=h===r?"radio":"switch",y=n?[this.renderItemTitle(e,i),this.renderItemStatus(e,t),this.renderItemToggle(e,t,i)]:[this.renderItemToggle(e,t,i),this.renderItemTitle(e,i),this.renderItemStatus(e,t)],b=u("div",s?{key:`item-label-no-selection-${e.uid}`,class:a.label}:{key:`item-label-with-selection-${e.uid}`,class:a.label,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":h,tabIndex:0,"aria-checked":e.visible?"true":"false",title:e.visible?l.hideLayer:l.showLayer,role:p,"aria-labelledby":i},y);return h===o||e.error?u("div",{key:`item-label-container-${e.uid}`,class:a.label},this.renderItemTitle(e,i),this.renderItemStatus(e,t)):b}renderPanelButton(e){const{className:t,open:i,title:s,image:n}=e,l=n||t?t:a.iconDefaultAction,o=this._getIconImageStyles(e),r={[a.actionsMenuItemActive]:i},h={[a.actionImage]:!!o["background-image"],[a.disabledElement]:e.disabled};return l&&(h[l]=!!l),u("div",{"aria-disabled":e.disabled.toString(),key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(a.actionsMenuItem,r),role:"button",tabindex:e.disabled?null:0,title:s,"aria-label":s},u("span",{class:this.classes(h),styles:o}))}renderActionsSections(e,t,i){const s=t.toArray().map((n,l)=>u("ul",{key:`${e}-action-section-${l}`,class:a.actionsList},this.renderActionSection(e,n)));return u("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:a.actions,hidden:!e.actionsOpen||null},s)}renderActionSection(e,t){return(t&&t.toArray()).map(i=>this.renderAction({item:e,action:i}))}renderActionIcon(e){const{active:t,className:i}=e,s=this._getIconImageStyles(e),n=e.type!=="button"||e.image||i?i:a.iconDefaultAction,l={[a.actionImage]:!t&&!!s["background-image"],[a.iconLoading]:t,[a.rotating]:t};return n&&!t&&(l[n]=!0),u("span",{key:"action-icon","aria-hidden":"true",class:this.classes(a.actionIcon,l),styles:s})}renderActionTitle(e,t){return t?null:u("span",{key:"action-title",class:a.actionTitle},e)}renderAction(e){const{item:t,action:i,singleAction:s}=e,{active:n,disabled:l,title:o}=i,r={[a.actionsMenuItem]:s&&i.type==="button",[a.action]:n||!s&&i.type!=="toggle",[a.actionToggle]:!n&&i.type==="toggle",[a.actionToggleOn]:!n&&i.type==="toggle"&&i.value,[a.disabledElement]:l},h=[this.renderActionIcon(i),this.renderActionTitle(o,s)];return s?u("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:r,tabindex:"0",title:o,"aria-label":o},h):u("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:r,tabindex:"0",role:"button",title:o,"aria-label":o},h)}_setTooltipReference(e,t){this._tooltipReferenceMap.set(t.uid,e),this.scheduleRender()}_hasMessage(e){return!!e.error||e.incompatible}_hasChildren(e){return!!e.children.length&&!this._hasMessage(e)}_sortNodeRemoved(e){const{_sortableMap:t}=this,i=e.dataset.group,s=t.get(i);s&&s.destroy(),t.delete(i)}_destroySortables(){const{_sortableMap:e,_sortableNodes:t}=this;e.forEach(i=>i&&i.destroy()),e.clear(),t.clear()}_moveLayerFromChildList({to:e,from:t,item:i,newIndex:s}){const n=i["data-item"],l=e["data-item"],o=t["data-item"];this.viewModel.moveListItem(n,o,l,s)}_sortLayers(e){var s,n;if(!e)return;const t=e.el["data-item"],i=e.toArray();t?Ge(t,i):be((n=(s=this.view)==null?void 0:s.map)==null?void 0:n.layers,i)}_toggleSorting(e,t){const{_sortableMap:i,selectionEnabled:s}=this,n=i.get(t),l=e["data-item"],o=(t===W||l.childrenSortable&&We(l))&&s;if(n)n.option("disabled",!o);else if(o){const r=Ue.create(e,{dataIdAttr:le,group:{name:t,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${ne}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!o,chosenClass:a.sortableChosen});i.set(t,r)}}_toggleAllSorting(){this._sortableNodes.forEach((e,t)=>this._toggleSorting(e,t))}_sortNodeCreated(e){const t=e.dataset.group;t&&(this._sortableNodes.set(t,e),this._toggleSorting(e,t))}_setVisibleItems(e){this.visibleItems=e==null?void 0:e.filter(t=>!t.hidden&&(this.visibleElements.errors||!t.error))}_getSingleActionButton(e){return e.reduce(t=>t).filter(t=>t&&t.type==="button").getItemAt(0)}_focusListItem(e){var i;const{_focusSortUid:t}=this;!e||!t||((i=e["data-item"].layer)==null?void 0:i.uid)===t&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e,t){const i=H.actionSection+t;this._handles.add(e.on("change",this.scheduleRender.bind(this)),i),e.forEach(s=>this._renderOnActionChanges(s,t))}_renderOnActionChanges(e,t){const i=H.actions+t;e.type!=="toggle"?e.type!=="slider"?this._handles.add(f(()=>[e==null?void 0:e.className,e==null?void 0:e.image,e==null?void 0:e.id,e==null?void 0:e.title,e==null?void 0:e.visible],()=>this.scheduleRender(),A),i):this._handles.add(f(()=>[e==null?void 0:e.className,e==null?void 0:e.id,e==null?void 0:e.title,e==null?void 0:e.visible,e==null?void 0:e.value,e==null?void 0:e.displayValueEnabled,e==null?void 0:e.max,e==null?void 0:e.min,e==null?void 0:e.step],()=>this.scheduleRender(),A),i):this._handles.add(f(()=>[e==null?void 0:e.className,e==null?void 0:e.image,e==null?void 0:e.id,e==null?void 0:e.title,e==null?void 0:e.visible,e==null?void 0:e.value],()=>this.scheduleRender(),A),i)}_renderOnItemChanges(e){const t=e.uid,i=H.items+t;this._handles.add([f(()=>{var s,n,l;return[e==null?void 0:e.actionsOpen,e==null?void 0:e.visible,e==null?void 0:e.open,e==null?void 0:e.updating,e==null?void 0:e.connectionStatus,e==null?void 0:e.publishing,e==null?void 0:e.title,e==null?void 0:e.visibleAtCurrentScale,e==null?void 0:e.error,e==null?void 0:e.visibilityMode,e==null?void 0:e.panel,(s=e==null?void 0:e.panel)==null?void 0:s.title,(n=e==null?void 0:e.panel)==null?void 0:n.content,(l=e==null?void 0:e.panel)==null?void 0:l.className,e==null?void 0:e.sortable,e==null?void 0:e.childrenSortable]},()=>this.scheduleRender(),ke),f(()=>[e==null?void 0:e.hidden,e==null?void 0:e.error],()=>this._setVisibleItems(this.operationalItems)),e.actionsSections.on("change",()=>this.scheduleRender()),e.children.on("change",()=>this.scheduleRender())],i),e.children.forEach(s=>this._renderOnItemChanges(s)),e.actionsSections.forEach(s=>this._watchActionSectionChanges(s,t))}_itemsChanged(e){this._handles.removeAll(),e.forEach(t=>this._renderOnItemChanges(t)),this._tooltipReferenceMap.clear(),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map(t=>t.filter(i=>i.visible))}_countActions(e){return e.reduce((t,i)=>t+i.length,0)}_getIconImageStyles(e){const t=e.declaredClass==="esri.widgets.LayerList.ListItemPanel"||e.declaredClass==="esri.support.Action.ActionButton"||e.declaredClass==="esri.support.Action.ActionToggle"?e.image:null;return{"background-image":t?`url("${t}")`:null}}_selectionKeydown(e){var E,Z,q,J;const t=["ArrowDown","ArrowUp"],i=Pe(e);if(!t.includes(i))return void this._toggleSelection(e);e.stopPropagation();const s=e.currentTarget,n=s["data-item"],{_sortableMap:l,selectedItems:o}=this,r=s.dataset.group,h=l.get(r);if(!h)return;const p=B(n,o),y=h.toArray(),b=e.target,w=y.indexOf(b.dataset[nt]);if(w!==-1){if(i==="ArrowDown"){const P=w+1;if(P>=y.length)return;p?(se(y,w,P),h.sort(y),this._sortLayers(h),this._focusSortUid=(E=n.layer)==null?void 0:E.uid):(this._focusSortUid=(Z=n.layer)==null?void 0:Z.uid,this.scheduleRender())}if(i==="ArrowUp"){const P=w-1;if(P<=-1)return;p?(se(y,w,P),h.sort(y),this._sortLayers(h),this._focusSortUid=(q=n.layer)==null?void 0:q.uid):(this._focusSortUid=(J=n.layer)==null?void 0:J.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const t=e.currentTarget["data-item"],{actionsOpen:i}=t,s=!i;s&&this.operationalItems.forEach(n=>Ce(n)),t.actionsOpen=s,e.stopPropagation()}_triggerPanel(e){const t=e.currentTarget["data-panel"];e.stopPropagation(),t&&!t.disabled&&(t.open=!t.open)}_triggerAction(e){const t=e.currentTarget,i=t["data-action"],s=t["data-item"];i.type==="toggle"&&(i.value=!i.value),this.triggerAction(i,s),e.stopPropagation()}_toggleVisibility(e){const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),s=t["data-item"];i===O.exclusive&&s.visible||(s.visible=!s.visible),e.stopPropagation()}_toggleChildrenClick(e){const t=e.currentTarget["data-item"];t.open=!t.open,e.stopPropagation()}_toggleSelection(e){var o,r;e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,s=e.currentTarget["data-item"],n=B(s,i),{length:l}=i;if(!t)return l&&!(n&&l===1)?(i.removeAll(),void i.add(s)):void(n?(o=i.remove)==null?void 0:o.call(i,n):i.add(s));n?(r=i.remove)==null||r.call(i,n):i.add(s)}};d([c()],m.prototype,"visibleItems",void 0),d([c()],m.prototype,"iconClass",void 0),d([c()],m.prototype,"label",null),d([c()],m.prototype,"listItemCanGiveFunction",void 0),d([c()],m.prototype,"listItemCanReceiveFunction",void 0),d([c()],m.prototype,"listItemCreatedFunction",null),d([c(),ee("esri/widgets/LayerList/t9n/LayerList")],m.prototype,"messages",void 0),d([c(),ee("esri/t9n/common")],m.prototype,"messagesCommon",void 0),d([c()],m.prototype,"multipleSelectionEnabled",void 0),d([c()],m.prototype,"operationalItems",null),d([c()],m.prototype,"selectionEnabled",void 0),d([c()],m.prototype,"selectedItems",void 0),d([c()],m.prototype,"view",null),d([xe("trigger-action"),c({type:we})],m.prototype,"viewModel",void 0),d([c()],m.prototype,"visibleElements",void 0),d([ue("visibleElements")],m.prototype,"castVisibleElements",null),d([k()],m.prototype,"_toggleActionsOpen",null),d([k()],m.prototype,"_triggerPanel",null),d([k()],m.prototype,"_triggerAction",null),d([k()],m.prototype,"_toggleVisibility",null),d([k()],m.prototype,"_toggleChildrenClick",null),d([k()],m.prototype,"_toggleSelection",null),m=d([N("esri.widgets.LayerList")],m);const lt=m;const ot=e=>{const t=I.useRef(!1),[i,s]=I.useState(0),[n,l]=I.useState(0),o=async(r,h)=>{const p=await e.layer.queryFeatures({where:`EXTRACT(YEAR,${h}) >= 2010`,returnGeometry:!1,outStatistics:[{statisticType:"max",onStatisticField:h,outStatisticFieldName:"MAX_DATE"},{statisticType:"min",onStatisticField:h,outStatisticFieldName:"MIN_DATE"}],outFields:["MAX_DATE","MIN_DATE"]});if(p!=null&&p.features.length){const y=new Date(p.features[0].getAttribute("MAX_DATE")).getFullYear(),b=new Date(p.features[0].getAttribute("MIN_DATE")).getFullYear();r.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${b}
            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${y}
            `,r.refresh(),s(y),l(b)}};return I.useEffect(()=>{e.layer&&e.datefield&&!t.current&&(t.current=!0,o(e.layer,e.datefield))},[]),C.jsx("div",{children:C.jsx(Re,{labelHandles:!0,labelTicks:!0,min:n,max:i,maxValue:i,minValue:i-1,minLabel:n.toString(),maxLabel:i.toString(),onCalciteSliderChange:r=>{e.layer.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${r.target.minValue}
            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${r.target.maxValue}
            `,e.layer.refresh()}})})},at=I.lazy(()=>U(()=>import("./OpacitySlider-2ac8811b.js"),["assets/OpacitySlider-2ac8811b.js","assets/index-7753bab1.js","assets/index-0be7f32f.css"]));let D;const rt=async(e,t)=>{await ct(t);const i=new URL(window.location);return i.searchParams.get("config")&&i.searchParams.get("config")==="puma"&&await dt(t),D=new lt({view:t,container:e,listItemCreatedFunction:mt}),D.on("trigger-action",s=>{s.item.layer.title==="Property"&&pt(s)}),D},dt=async(e,t)=>{const i=new pe({portalItem:{id:"a07528d1d37542b79fade50370f2305f"}});await i.loadAll().catch(s=>{console.log(s)}).then(async()=>{if(i.layers.length){const s=e.map.layers.find(n=>{var l;return n.id===((l=i.layers.getItemAt(0))==null?void 0:l.id)});if(s){await i.layers.getItemAt(0).load();const n=i.allLayers.find(l=>l.type==="group"&&l.title===s.title);if(n){const l=n.layers.slice(),o=n.layers.filter(r=>{const h=s.findLayerById(r.id);return h!==void 0&&h.type==="feature"&&(h.popupTemplate=r.popupTemplate,h.renderer=r.renderer),s.findLayerById(r.id)===void 0});s.addMany(o.toArray()),s.layers.forEach(r=>{let h=l.findIndex(p=>r.id===p.id);s.reorder(r,h)}),l.destroy()}}else e.map.addMany(i.layers.toArray())}})},ct=async e=>{const t=new pe({portalItem:{id:"95092428774c4b1fb6a3b6f5fed9fbc4"}});await t.loadAll().catch(i=>{console.log(i)}).then(()=>(e.map.allLayers.filter(s=>s.type==="group").toArray().forEach(s=>{const n=t.allLayers.find(l=>l.type==="group"&&l.title===s.title);if(n){const l=n.layers.slice(),o=n.layers.filter(r=>{const h=s.findLayerById(r.id);return h!==void 0&&h.type==="feature"&&(h.popupTemplate=r.popupTemplate,h.renderer=r.renderer),s.findLayerById(r.id)===void 0});s.addMany(o.toArray()),s.layers.forEach(r=>{if(r.title==="Raleigh Zoning")debugger;let h=l.findIndex(p=>r.id===p.id);r.title==="Raleigh Zoning"&&console.log(h),s.reorder(r,h)}),l.destroy()}}),!0))},ht=(e,t)=>{const i=e.renderer.clone();t?(i.symbol.outline.color.r=0,i.symbol.outline.color.g=0,i.symbol.outline.color.b=0):(i.symbol.outline.color.r=255,i.symbol.outline.color.g=255,i.symbol.outline.color.b=255),e.renderer=i},ut=(e,t)=>{t.length>1&&ht(e,!t.getItemAt(1).getItemAt(0).value)},pt=e=>{if(e.item.layer.title==="Property"){ut(e.item.layer,e.item.actionsSections),e.item.layer.labelsVisible||(e.item.layer.labelsVisible=!0);const i=e.item.actionsSections.getItemAt(0).filter(o=>o.value).map(o=>o.title),l=Ae.filter(o=>i.includes(o.title)).map(o=>o.expression).join("+ TextFormatting.NewLine+");e.item.layer.labelingInfo=[],e.item.layer.labelingInfo=[{symbol:{type:"text",color:"black",haloColor:"white",haloSize:1,font:{family:"AvenirNext LT Pro Regular",style:"normal",weight:"bold"}},labelExpressionInfo:{expression:l},maxScale:0,minScale:5e3}]}},Ae=[{expression:"First(Split($feature['SITE_ADDRESS'], ' '))",title:"Address"},{expression:"$feature['PIN_NUM']",title:"PIN"},{expression:"$feature['REID']",title:"REID"},{expression:`When(IsEmpty($feature["SALE_DATE"]),null, Concatenate(Month($feature["SALE_DATE"])+1, '/',Day($feature["SALE_DATE"]), '/',Year($feature["SALE_DATE"])))`,title:"Sale Date"},{expression:"Text($feature.TOTSALPRICE,'$#,###')",title:"Sale Price"}],gt=e=>{if(e.layer.title==="Property"&&e.layer.type!=="group"&&e.actionsSections.length===0){let t=new T;t.addMany(Ae.map(i=>{var s;return new z({value:(s=e.layer.labelingInfo)==null?void 0:s.find(n=>{var l;return((l=n.labelExpressionInfo)==null?void 0:l.expression.includes(i.expression))&&e.layer.labelsVisible}),title:i.title,visible:!0})})),e.actionsSections.push(t),t=new T,t.add(new z({value:e.layer.renderer.symbol.outline.color.isBright,title:"Light Outline",visible:!0})),e.actionsSections.push(t),e.actionsOpen=!0,setTimeout(()=>{const i=document.createElement("h4");i.id="labels-actions-title",i.textContent="Labels",i.setAttribute("style","padding: 0.5em;margin: 0;");const s=document.querySelector(".esri-layer-list__item-actions");s!=null&&s.parentElement&&!document.getElementById("labels-actions-title")&&s.prepend(i)},500)}},yt=e=>{if(e.layer.title.includes("Development Plans")&&e.layer.type!=="group"&&e.actionsSections.length===0){const t=document.createElement("filter-container");ge(t).render(C.jsx(I.Suspense,{fallback:"",children:C.jsx(ot,{datefield:"apply_date",layer:e.layer})})),e.panel.content.push(t)}},ae=e=>{if(e.visible&&!e.panel&&e.layer.type!=="group"&&e.layer.type!==void 0){const t=document.createElement("slider-container");ge(t).render(C.jsx(I.Suspense,{fallback:"",children:C.jsx(at,{value:e.layer.opacity,layer:e.layer})})),e.panel={content:[t,"legend"],open:!1},yt(e)}},mt=e=>{const t=e.item;ae(t),t.open=t.layer.visible,t.layer.watch("visible",i=>{Oe(D.view),t.open=i,ae(t),i&&(t.layer.parent&&t.layer.parent.type==="group"&&(t.layer.parent.visible=!0),t.layer.parent.parent&&t.layer.parent.parent.type==="group"&&(t.layer.parent.parent.visible=!0))}),gt(t)},bt=(e,t)=>{e||(e=""),t.operationalItems.forEach(i=>{var s,n,l,o,r,h,p,y;if(i.layer.type==="group"){let b=!1;i.layer.layers.forEach(w=>{w.title.toLowerCase().includes(e.toLowerCase())?(w.listMode="show",b=!0):w.listMode="hide",w.type==="group"&&w.layers.forEach(E=>{E.title.toLowerCase().includes(e.toLowerCase())?(w.listMode="show",E.listMode="show",b=!0):E.listMode="hide"})}),i.open=e.length>0&&b,(!e.length||b)&&((o=(l=(n=(s=document.getElementById(`${t.id}_${i.uid}__title`))==null?void 0:s.parentElement)==null?void 0:n.parentElement)==null?void 0:l.parentElement)==null||o.removeAttribute("hidden")),b||(y=(p=(h=(r=document.getElementById(`${t.id}_${i.uid}__title`))==null?void 0:r.parentElement)==null?void 0:h.parentElement)==null?void 0:p.parentElement)==null||y.setAttribute("hidden","")}})},_t=e=>{(e==null?void 0:e.view.map.allLayers.filter(i=>i.type==="group")).forEach(i=>{i.visible=i.title==="Property",i.layers.forEach(s=>{s.visible=s.title==="Property"})})},vt={title:"Layer List Tips",tips:[{title:"Group Layers",text:"Layers in the layer list are now grouped based on category, making it easier to find layers."}]},ft=e=>{const t=I.useRef(),i=I.useRef(!1),[s,n]=I.useState(),[l,o]=I.useState(!0),[r,h]=I.useState(!1);I.useEffect(()=>(i.current||(i.current=!0,rt(t.current,e.view).then(b=>{n(b),b.when(()=>{o(!1)})})),()=>{s&&(s==null||s.destroy())}),[]),I.useEffect(()=>{h(e.isActive)},[e.isActive]);const p=I.useCallback(b=>{e.panelDismissed()},[]),y=I.useCallback(b=>{e.showTips(vt)},[]);return{ref:t,layerList:s,isLoading:l,isActive:r,panelDismissed:p,tipsClicked:y}},Ct=e=>{const{ref:t,layerList:i,isLoading:s,isActive:n,panelDismissed:l,tipsClicked:o}=ft(e);return C.jsxs(Ve,{id:"layers-panel",heading:"Layers",hidden:!n,closed:n?void 0:!0,closable:!0,onCalcitePanelClose:l,children:[C.jsx(te,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:o}),C.jsx(Ne,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),C.jsxs("div",{className:"layers",children:[i&&C.jsxs("div",{className:"row sticky",children:[C.jsx(Fe,{clearable:!0,placeholder:"Filter by layer name",scale:"m",onCalciteInputInput:r=>{i&&bt(r.target.value,i)}}),C.jsx(te,{text:"clear",icon:"viewHide",scale:"s",onClick:()=>_t(i)})]}),C.jsx("div",{ref:t}),C.jsx(De,{loading:!0,hidden:s?void 0:!0})]})]})};export{Ct as Layers,Ct as default};
