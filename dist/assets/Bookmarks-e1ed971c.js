import{e as n,y as d,a as M,K,D as J,bq as V,br as Q,L as Y,ad as y,I as x,bs as q,bt as X,J as j,M as C,N as Z,W as ee,w as te,x as T,B as N,_ as O,bu as $,bv as oe,z as a,aY as ie,as as se,bw as D,bx as ae,Q as re,U as ne,by as R,r as B,R as de,k as w,m as le,o as H,b6 as ue,p as L}from"./index-7753bab1.js";import{S as ke}from"./sortable.esm-be94e56d.js";const me={title:"Bookmarks Tips",tips:[{title:"Saving Bookmarks",text:"Bookmarks are automatically saved to your local storage in your browser.  Next time you open iMAPS in the same browser you will see the bookmarks from your last session."}]};let f=class extends K{constructor(e){super(e)}get editedBookmark(){const{bookmark:e}=this;return e?this._get("editedBookmark")||e.clone():null}get state(){return this._get("state")}set state(e){this.validationState=void 0,this.loading=void 0,this._set("state",e)}};n([d()],f.prototype,"bookmark",void 0),n([d({readOnly:!0})],f.prototype,"editedBookmark",null),n([d()],f.prototype,"state",null),n([d()],f.prototype,"validationState",void 0),n([d()],f.prototype,"loading",void 0),f=n([M("esri.widgets.Bookmarks.UserState")],f);const U=f,z=J.ofType(V),ce={width:128,height:128,format:"png"},S={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},F={time:!0};let b=class extends Q(Y.EventedAccessor){constructor(e){super(e),this.abilities={...F},this.activeBookmark=null,this.view=null}destroy(){this.view=null,this._set("activeBookmark",null)}castAbilities(e){return{...F,...e}}get bookmarks(){var e,t;return((t=(e=this.view)==null?void 0:e.map)==null?void 0:t.bookmarks)??new z}set bookmarks(e){this._overrideIfSome("bookmarks",e)}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...S,...e})}get defaultCreateOptions(){return S}set defaultEditOptions(e){this._set("defaultEditOptions",{...S,...e})}get defaultEditOptions(){return S}get state(){const e=this.get("view");return e&&!e.ready?"loading":"ready"}async createBookmark(e){const{view:t,defaultCreateOptions:o,abilities:s}=this;if(!t)throw new y("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const{takeScreenshot:r,screenshotSettings:l,captureViewpoint:k,captureRotation:m,captureScale:p,captureTimeExtent:_}={...o,...e},g=r?await this._createThumbnail(l):void 0,G=s.time&&_&&x(t.timeExtent)?t.timeExtent.clone():void 0;return new V({...g&&{thumbnail:g},..._&&{timeExtent:G},...k&&{viewpoint:this._createViewpoint({view:t,captureScale:p,captureRotation:m})}})}async editBookmark(e,t){const{view:o,defaultEditOptions:s}=this;if(!o)throw new y("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const{takeScreenshot:r,screenshotSettings:l,captureViewpoint:k,captureRotation:m,captureScale:p,captureTimeExtent:_}={...s,...t},g=r?await this._createThumbnail(l):void 0;return g&&(e.thumbnail=g),k&&(e.viewpoint=this._createViewpoint({view:o,captureScale:p,captureRotation:m})),_&&x(o.timeExtent)&&(e.timeExtent=o.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:e}),e}goTo(e){const{abilities:t,view:o}=this;if(!o)throw new y("go-to:invalid-view","Cannot go to a bookmark without a view");const s=e==null?void 0:e.viewpoint;if(!s)throw new y("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:e});this._set("activeBookmark",e);const r={target:s},l=this.callGoTo(r),k=e==null?void 0:e.timeExtent;return t.time&&k&&(o.timeExtent=k),this.emit("bookmark-select",{bookmark:e}),l.catch(()=>{}).then(()=>this._set("activeBookmark",null)),l}async _createThumbnail(e){const t=await this.view.takeScreenshot({...ce,...e});return new q({url:t.dataUrl})}_createViewpoint({view:e,captureRotation:t,captureScale:o}){var r,l;const s=(r=e.viewpoint)==null?void 0:r.clone();return new X({targetGeometry:(l=e.extent)==null?void 0:l.clone(),rotation:t&&(s==null?void 0:s.rotation)||0,scale:o&&(s==null?void 0:s.scale)||0})}};n([d()],b.prototype,"abilities",void 0),n([j("abilities")],b.prototype,"castAbilities",null),n([d({readOnly:!0})],b.prototype,"activeBookmark",void 0),n([d({type:z})],b.prototype,"bookmarks",null),n([d()],b.prototype,"defaultCreateOptions",null),n([d()],b.prototype,"defaultEditOptions",null),n([d({readOnly:!0})],b.prototype,"state",null),n([d()],b.prototype,"view",void 0),b=n([M("esri.widgets.Bookmarks.BookmarksViewModel")],b);const W=b,c="esri-bookmarks",v=`${c}__authoring`,h=`${c}__bookmark`,I=`${c}__time-extent`,i={base:`${c} esri-widget--panel`,loaderContainer:`${c}__loader-container`,loader:`${c}__loader`,fadeIn:`${c}--fade-in`,bookmarkList:`${c}__list`,bookmarkListSortable:`${c}__list--sortable`,bookmark:h,bookmarkButton:`${h}-button`,bookmarkImageContainer:`${h}-image-container`,bookmarkImageContainerHasImage:`${h}-image-container--has-image`,bookmarkEditButtonContainer:`${h}-edit-button-container`,bookmarkEditButton:`${h}-edit-button`,bookmarkDragHandle:`${c}_bookmark-drag-handle`,bookmarkDragHandleIcon:`${c}_bookmark-drag-handle-icon`,bookmarkIcon:`${h}-icon`,bookmarkImage:`${c}__image`,bookmarkLabel:`${h}-label`,bookmarkName:`${h}-name`,bookmarkTimeExtent:`${h}-time-extent`,bookmarkActive:`${h}--active`,noBookmarksContainer:"esri-widget__content--empty",noBookmarksHeader:`${c}__no-bookmarks-heading`,noBookmarksIcon:"esri-widget__no-bookmark-icon",noBookmarksDescription:`${c}__no-bookmarks-description`,addingBookmark:`${c}__adding-bookmark`,addBookmark:`${c}__add-bookmark`,addBookmarkButton:`${c}__add-bookmark-button`,addBookmarkIcon:`${c}__add-bookmark-icon`,authoringCard:`${v}-card`,authoringContainer:`${v}-container`,authoringForm:`${v}-form`,authoringLabel:`${v}-label`,authoringActions:`${v}-actions`,authoringInputInvalid:`${v}-input--invalid`,authoringDeleteButton:`${v}-delete-button`,authoringCancelButton:`${v}-cancel-button`,timeExtentContainer:`${I}-container`,timeExtent:I,timeExtentGroup:`${I}-group`,timeExtentDate:`${I}-date`,timeExtentTime:`${I}-time`,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",esriButton:"esri-button",esriButtonTertiary:"esri-button--tertiary",esriInput:"esri-input",iconHandle:"esri-icon-handle-vertical",iconPlus:"esri-icon-plus",iconEdit:"esri-icon-edit",iconHandleHorizontal:"esri-icon-handle-horizontal",iconRefresh:"esri-icon-refresh",iconLink:"esri-icon-link",iconRemove:"esri-icon-erase",widgetIcon:"esri-icon-bookmark",header:"esri-widget__heading",loading:"esri-icon-loading-indicator",rotating:"esri-rotating"};function he(e,t,o){e.splice(o,0,e.splice(t,1)[0])}const be="bookmarks",E="data-bookmark-uid",P={addBookmark:!0,thumbnail:!0,time:!0},A=/^https:\/\/.*/i,pe="esri.widgets.Bookmarks";let u=class extends ee{constructor(e,t){super(e,t),this._handles=new te,this._addInputNode=null,this._editInputNode=null,this._urlEditInputNode=null,this._addBookmarkButtonNode=null,this._focusAddBookmarkButton=!1,this._focusEditInputBox=!1,this._focusAddInputBox=!1,this._focusUrlEditInputBox=!1,this._sortable=null,this._sortableNode=null,this._focusSortUid=null,this._selectedSortUid=null,this._sortableSavedItems=null,this._editIncludeTimeExtent=null,this._userState=null,this.disabled=!1,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=i.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new W,this.visibleElements={...P}}initialize(){this.addHandles([T(()=>{var e;return(e=this.viewModel)==null?void 0:e.bookmarks},()=>this._bookmarksInitialized(),N),T(()=>this.editingEnabled,()=>this._toggleSorting(),N)])}destroy(){this._destroySortable(),this._handles.destroy(),this._handles=null,this._editMenu.destroy()}loadDependencies(){return Promise.all([O(()=>import("./calcite-label-a1d0f416.js"),["assets/calcite-label-a1d0f416.js","assets/index-7753bab1.js","assets/index-0be7f32f.css"]),O(()=>import("./calcite-switch-2c022936.js"),["assets/calcite-switch-2c022936.js","assets/index-7753bab1.js","assets/index-0be7f32f.css"])])}get _editMenuItems(){var s,r;const{messages:e,_userState:t}=this,o=(r=(s=t==null?void 0:t.editedBookmark)==null?void 0:s.thumbnail)==null?void 0:r.url;return[new $({label:e==null?void 0:e.menu.refreshThumbnail,iconClass:i.iconRefresh,clickFunction:()=>this._refreshThumbnail()}),new $({label:A.test(o)?e==null?void 0:e.menu.editImageUrl:e==null?void 0:e.menu.useImageUrl,iconClass:i.iconLink,clickFunction:()=>this._startUseImageUrl()}),o?new $({label:e==null?void 0:e.menu.removeThumbnail,iconClass:i.iconRemove,clickFunction:()=>this._removeThumbnail()}):null].filter(Boolean)}get _editMenu(){const{_editMenuItems:e,messages:t,disabled:o}=this,s=this._get("_editMenu");s&&s.destroy();const r=new oe({disabled:o,iconClass:i.iconHandleHorizontal,label:t==null?void 0:t.menu.label});return r.items=e,r}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultEditOptions(){return this.viewModel.defaultEditOptions}set defaultEditOptions(e){this.viewModel.defaultEditOptions=e}get bookmarks(){return this.viewModel.bookmarks}set bookmarks(e){this.viewModel.bookmarks=e}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...P,...e}}endAddBookmark(){this._userState=null}goTo(e){return this.viewModel.goTo(e)}render(){const{state:e}=this.viewModel,t=e==="loading"?this.renderLoading():this.renderBookmarks();return a("div",{class:this.classes(i.base,i.esriWidget,{[i.esriWidgetDisabled]:this.disabled})},t)}startAddBookmark(){this._userState=new U({state:"add"}),this._focusAddInputBox=!0,this.scheduleRender()}renderLoading(){return a("div",{class:i.loaderContainer,key:"loader",tabIndex:this.disabled?-1:null},a("div",{class:i.loader}))}renderNoBookmarksContainer(){const{messages:e,disabled:t}=this;return a("div",{class:i.noBookmarksContainer,key:"no-bookmarks",tabIndex:t?-1:null},a("span",{"aria-hidden":"true",class:this.classes(i.noBookmarksIcon,i.widgetIcon)}),a(ie,{level:this.headingLevel,class:this.classes(i.header,i.noBookmarksHeader)},e==null?void 0:e.noBookmarksHeading),a("p",{class:i.noBookmarksDescription},e==null?void 0:e.noBookmarksDescription))}renderAddBookmarkLoading(){var e;return a("div",{key:"adding-bookmark",class:i.addingBookmark},a("span",{"aria-hidden":"true",class:this.classes(i.loading,i.rotating)}),(e=this.messages)==null?void 0:e.addingBookmark)}renderBookmarkItems(e){if(!e)return null;const{_userState:t,editingEnabled:o}=this;return e.map(s=>o&&s&&t&&(t.state==="edit"||t.state==="edit-thumbnail")&&t.bookmark===s?t.state==="edit-thumbnail"?this.renderEditingBookmarkUrl(t.editedBookmark):this.renderEditingBookmark(t.editedBookmark):this.renderBookmark(s)).toArray()}renderBookmarksContainer(e){var m;const{_userState:t,editingEnabled:o,disabled:s}=this,r=(t==null?void 0:t.state)==="add",l=o&&!r?this.renderAddBookmarkButton():null,k=o?r&&t.loading?this.renderAddBookmarkLoading():(t==null?void 0:t.state)==="add"?this.renderAddingBookmark():null:null;return[a("ul",{key:"bookmark-list","aria-label":(m=this.messages)==null?void 0:m.widgetLabel,class:this.classes(i.bookmarkList,{[i.bookmarkListSortable]:this.editingEnabled}),afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",bind:this,tabIndex:s?-1:null},this.renderBookmarkItems(e)),l,k]}renderAddBookmarkButton(){var e;return this.visibleElements.addBookmark?a("div",{key:"add-bookmark-item",class:i.addBookmark},a("button",{class:this.classes(i.esriButton,i.esriButtonTertiary,i.addBookmarkButton),disabled:this.disabled,onclick:this.startAddBookmark,afterCreate:this._storeAddBookmarkButton,afterUpdate:this._storeAddBookmarkButton,"data-node-ref":"_addBookmarkButtonNode",bind:this,type:"button"},a("span",{"aria-hidden":"true",class:this.classes(i.addBookmarkIcon,i.iconPlus)}),(e=this.messages)==null?void 0:e.addBookmark)):null}renderBookmarks(){const{bookmarks:e}=this.viewModel,t=e&&e.filter(Boolean),o=t&&t.length,s=o||this.editingEnabled?this.renderBookmarksContainer(t):null;return[o?null:this.renderNoBookmarksContainer(),s]}renderEditContainer(e){const{messagesCommon:t,disabled:o}=this,s=this._getBookmarkTitle(e);return a("div",{class:i.bookmarkEditButtonContainer,key:"edit-container"},a("button",{disabled:o,title:`${t==null?void 0:t.edit} ${s}`,"aria-label":`${t==null?void 0:t.edit} ${s}`,"data-bookmark":e,onclick:this._showEditBookmarkForm,bind:this,class:i.bookmarkEditButton,type:"button"},a("span",{"aria-hidden":"true",class:i.iconEdit})))}renderDragHandle(e){const{messagesCommon:t,disabled:o}=this,s=this._getBookmarkTitle(e),r={[E]:e.uid};return a("div",{role:"button",tabIndex:o?-1:0,key:"drag-handle",bind:this,class:i.bookmarkDragHandle,onkeydown:this._dragHandleKeydown,afterCreate:this._focusDragHandle,afterUpdate:this._focusDragHandle,onblur:this._dragHandleBlur,"aria-pressed":this._selectedSortUid===e.uid?"true":"false","aria-label":`${t==null?void 0:t.dragHandleTitle} ${s}`,title:`${t==null?void 0:t.dragHandleTitle} ${s}`,...r},a("span",{"aria-hidden":"true",class:this.classes(i.bookmarkDragHandleIcon,i.iconHandle)}))}renderBookmarkImageIcon(){return a("span",{"aria-hidden":"true",class:this.classes(i.bookmarkIcon,i.widgetIcon)})}renderBookmarkImage(e){const{visibleElements:t}=this,{thumbnail:o}=e,s=o&&o.url||"";return t.thumbnail&&s?a("img",{src:s,alt:"",class:i.bookmarkImage}):null}renderBookmarkTimeSwitch(e){const{messages:t,disabled:o}=this,{timeExtent:s}=e,{view:r}=this.viewModel;return r.timeExtent||s?a("calcite-label",{layout:"inline-space-between"},t.includeTimeExtent,a("calcite-switch",{scale:"s",disabled:o,checked:!!s,onCalciteSwitchChange:l=>{const k=l.currentTarget;this._editIncludeTimeExtent=!!k.checked}})):null}renderBookmarkTimeExtent(e){const{visibleElements:t}=this,{timeExtent:o}=e;return o?a("span",{class:i.timeExtent},[x(o.start)&&a("span",{key:"start-date-group",class:i.timeExtentGroup},a("span",{key:"start-date",class:i.timeExtentDate},this._formatDate(o.start)),t.time&&a("span",{key:"start-time",class:i.timeExtentTime},this._formatTime(o.start))),x(o.end)&&(se(o.start)||o.start.getTime()!==o.end.getTime())&&a("span",{key:"end-date-group",class:i.timeExtentGroup},a("span",{key:"end-date",class:i.timeExtentDate},this._formatDate(o.end)),t.time&&a("span",{key:"end-time",class:i.timeExtentTime},this._formatTime(o.end)))]):null}renderBookmarkButton(e){const{disabled:t}=this,{timeExtent:o}=e,{abilities:s}=this.viewModel,r=this._getBookmarkTitle(e),{thumbnail:l}=e,k=a("div",{class:this.classes(i.bookmarkImageContainer,l&&l.url?i.bookmarkImageContainerHasImage:null)},this.renderBookmarkImage(e)||this.renderBookmarkImageIcon()),m=s.time&&o?a("span",{key:"time-extent",class:i.bookmarkTimeExtent},this.renderBookmarkTimeExtent(e)):null;return a("button",{disabled:t,key:"bookmark-button",class:i.bookmarkButton,bind:this,"data-bookmark":e,onclick:this._goToBookmark,type:"button"},k,a("div",{class:i.bookmarkLabel},a("span",{key:"bookmark-title",class:i.bookmarkName},r),m))}renderBookmark(e){const{activeBookmark:t}=this.viewModel,o={[i.bookmarkActive]:t===e},s=this.editingEnabled?this.renderEditContainer(e):null,r={[E]:e.uid},l=this.editingEnabled?this.renderDragHandle(e):null;return a("li",{key:e,class:this.classes(i.bookmark,o),...r},l,this.renderBookmarkButton(e),s)}renderEditingBookmarkName(e){const{messages:t,_userState:o,disabled:s}=this,r=o.validationState==="name-required";return a("label",{class:i.authoringLabel},t==null?void 0:t.title,r?a("strong",null,t==null?void 0:t.invalidTitle):null,a("input",{required:!0,disabled:s,bind:this,class:this.classes(i.esriInput,r?i.authoringInputInvalid:null),type:"text",value:e.name,afterCreate:this._storeEditInput,afterUpdate:this._focusEditInput,"data-bookmark":e,"data-node-ref":"_editInputNode",placeholder:t==null?void 0:t.titlePlaceholder}))}renderEditingBookmarkUrlActions(){const{messagesCommon:e,disabled:t}=this;return a("div",{class:i.authoringActions},a("input",{type:"button",disabled:t,value:e==null?void 0:e.back,class:this.classes(i.esriButton,i.esriButtonTertiary),onclick:this._closeUrlEditBookmarkForm,bind:this}),a("input",{class:i.esriButton,disabled:t,type:"submit",value:e==null?void 0:e.add}))}renderEditingBookmarkActions(){const{messagesCommon:e,disabled:t}=this,{bookmark:o}=this._userState;return a("div",{class:i.authoringActions},a("input",{type:"button",disabled:t,value:e==null?void 0:e.delete,class:this.classes(i.esriButton,i.esriButtonTertiary,i.authoringDeleteButton),"data-bookmark":o,onclick:this._deleteBookmark,bind:this}),a("input",{disabled:t,type:"button",value:e==null?void 0:e.cancel,class:this.classes(i.esriButton,i.esriButtonTertiary),onclick:this._closeEditBookmarkForm,bind:this}),a("input",{class:i.esriButton,disabled:t,type:"submit",value:e==null?void 0:e.save}))}renderEditingBookmarkUrlInput(e){var m;const{messages:t,_userState:o,disabled:s}=this,r=(m=e.thumbnail)==null?void 0:m.url,l=A.test(r)?r:null,k=o.validationState==="absolute-url-required";return a("label",{class:i.authoringLabel},k?a("strong",null,t==null?void 0:t.invalidImageUrl):null,a("input",{required:!0,disabled:s,bind:this,class:this.classes(i.esriInput,k?i.authoringInputInvalid:null),type:"text",value:l,afterCreate:this._storeUrlEditInput,afterUpdate:this._focusUrlEditInput,"data-bookmark":e,"data-node-ref":"_urlEditInputNode",title:t==null?void 0:t.imageUrlTooltip,placeholder:t&&`https://<${t.imageUrlPlaceholder}>`}))}renderEditingBookmarkUrl(e){const t={[E]:e.uid};return a("li",{key:"edit-bookmark-url-form",class:i.authoringCard,...t},a("form",{class:i.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkUrlSubmit,bind:this},this.renderEditingBookmarkUrlInput(e),this.renderEditingBookmarkUrlActions()))}renderEditingBookmark(e){const t={[E]:e.uid},{abilities:o}=this.viewModel,s=o.time?a("div",{key:"edit-bookmark-time-container",class:i.timeExtentContainer},this.renderBookmarkTimeSwitch(e),this._editIncludeTimeExtent&&this.renderBookmarkTimeExtent(e)):null;return a("li",{key:"edit-bookmark-form",class:i.authoringCard,...t},a("form",{class:i.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkSubmit,bind:this},a("div",{class:i.authoringContainer},a("div",{class:i.bookmarkImageContainer},this.renderBookmarkImage(e),this._editMenu.render()),this.renderEditingBookmarkName(e)),s,this.renderEditingBookmarkActions()))}renderAddingBookmarkName(){const{_userState:e,messages:t,disabled:o}=this,s=e.validationState==="name-required";return a("label",{class:i.authoringLabel},t==null?void 0:t.title,s?a("strong",null,t==null?void 0:t.invalidTitle):null,a("input",{required:!0,disabled:o,bind:this,class:this.classes(i.esriInput,s?i.authoringInputInvalid:null),type:"text",afterCreate:this._storeAddInput,afterUpdate:this._focusAddInput,"data-node-ref":"_addInputNode",value:"",placeholder:t==null?void 0:t.titlePlaceholder}))}renderAddingBookmarkActions(){const{messagesCommon:e,disabled:t}=this;return a("div",{class:this.classes(i.authoringActions)},a("input",{type:"button",disabled:t,value:e==null?void 0:e.cancel,class:this.classes(i.esriButton,i.esriButtonTertiary,i.authoringCancelButton),onclick:this._endAddBookmark.bind(this),bind:this}),a("input",{class:i.esriButton,disabled:t,type:"submit",value:e==null?void 0:e.add}))}renderAddingBookmark(){return a("div",{key:"add-bookmark-form",class:i.authoringCard},a("form",{class:i.authoringForm,onsubmit:this._addBookmarkSubmit,bind:this},this.renderAddingBookmarkName(),this.renderAddingBookmarkActions()))}_getBookmarkTitle(e){var t;return e.name||((t=this.messagesCommon)==null?void 0:t.untitled)}_formatDate(e){return e?D(e,R("short-date")):null}_formatTime(e){return e?D(e,R("long-time")):null}_dragHandleBlur(){this._selectedSortUid=null,this.scheduleRender()}_dragHandleKeydown(e){const{_sortableSavedItems:t}=this,o=["ArrowDown","ArrowUp","Escape","Tab"," ","Enter"],s=ne(e);if(!o.includes(s))return;const{_sortable:r,_selectedSortUid:l}=this,k=r.toArray(),m=e.target.getAttribute(E),p=k.indexOf(m);if(ae(s)){const g=l&&l===m;return this._selectedSortUid=g?null:m,this._sortableSavedItems=g?null:this._sortable.toArray(),void this.scheduleRender()}if(s==="Tab")return this._selectedSortUid=null,void this.scheduleRender();if(s==="Escape"&&t)return e.stopPropagation(),this._selectedSortUid=null,this._updateSortItems(t,r,m),void this.scheduleRender();if(p===-1||!l)return;const _=s==="ArrowUp"?p-1:p+1;_>=k.length||_<=-1||(he(k,p,_),this._updateSortItems(k,r,m))}_updateSortItems(e,t,o){t.sort(e),this._sortBookmarks(t),this._focusSortUid=o,this._selectedSortUid=o}_focusDragHandle(e){const{_focusSortUid:t}=this;!e||!t||e.getAttribute(E)===t&&(e.focus(),this._focusSortUid=null)}_toggleSorting(){const{_sortable:e,_sortableNode:t,editingEnabled:o,disabled:s}=this;if(t)if(e)e.option("disabled",s||!o);else{const r=ke.create(t,{dataIdAttr:E,handle:`.${i.bookmarkDragHandle}`,group:be,disabled:s||!o,onSort:()=>this._sortBookmarks(r)});this._sortable=r}}_sortNodeCreated(e){this._sortableNode=e,this._toggleSorting()}_sortBookmarks(e){const{bookmarks:t}=this.viewModel;if(!t)return;const o=e.toArray();t.sort((s,r)=>{const l=o.indexOf(s.uid),k=o.indexOf(r.uid);return l>k?1:l<k?-1:0})}_destroySortable(){const{_sortable:e}=this;e&&e.destroy(),this._sortable=null}_endAddBookmark(){this._focusAddBookmarkButton=!0,this.endAddBookmark()}_bookmarksInitialized(){const e="bookmarks-init",{_handles:t}=this;t.remove(e),t.add(re(()=>{var o;return(o=this.viewModel)==null?void 0:o.bookmarks},"change",()=>this._bookmarksChanged()),e)}_bookmarksChanged(){const e="bookmarks-change",{bookmarks:t}=this.viewModel,{_handles:o}=this;o.remove(e);const s=t.map(r=>T(()=>{var l;return[r==null?void 0:r.name,(l=r==null?void 0:r.thumbnail)==null?void 0:l.url]},()=>this.scheduleRender()));o.add(s,e),this.scheduleRender()}_showEditBookmarkForm(e){const t=e.currentTarget["data-bookmark"];this._editIncludeTimeExtent=!!t.timeExtent,this._focusEditInputBox=!0,this._userState=new U({bookmark:t,state:"edit"}),this.viewModel.goTo(t),this.scheduleRender()}_closeUrlEditBookmarkForm(){this._focusEditInputBox=!0,this._userState.state="edit"}_closeEditBookmarkForm(){this._userState=null}_addBookmarkSubmit(e){e.preventDefault();const{_addInputNode:t,_userState:o}=this,s=t&&t.value.trim();s?(o.loading=!0,this.viewModel.createBookmark().then(r=>{r.name=s,this.viewModel.bookmarks.add(r),this._endAddBookmark()})):o.validationState="name-required"}async _editBookmarkAndClose(e,t){const{viewModel:o}=this;await o.editBookmark(e,{...o.defaultEditOptions,...t}),this._closeEditBookmarkForm()}_editBookmarkSubmit(e){e.preventDefault();const{_editInputNode:t,_userState:o,_editIncludeTimeExtent:s}=this,r=t&&t.value.trim();r?(o.bookmark.name=r,o.bookmark.thumbnail=o.editedBookmark.thumbnail,s||(o.bookmark.timeExtent=null),this._editBookmarkAndClose(o.bookmark,{takeScreenshot:!1,captureTimeExtent:s})):o.validationState="name-required"}_storeAddBookmarkButton(e){this._addBookmarkButtonNode=e,this._focusAddBookmark()}_storeEditInput(e){this._editInputNode=e,this._focusEditInput()}_storeAddInput(e){this._addInputNode=e,this._focusAddInput()}_storeUrlEditInput(e){this._urlEditInputNode=e,this._focusUrlEditInput()}_focusUrlEditInput(){this._urlEditInputNode&&this._focusUrlEditInputBox&&(this._focusUrlEditInputBox=!1,this._urlEditInputNode.focus())}_focusAddInput(){this._addInputNode&&this._focusAddInputBox&&(this._focusAddInputBox=!1,this._addInputNode.focus())}_focusAddBookmark(){this._addBookmarkButtonNode&&this._focusAddBookmarkButton&&(this._focusAddBookmarkButton=!1,this._addBookmarkButtonNode.focus())}_focusEditInput(){this._editInputNode&&this._focusEditInputBox&&(this._focusEditInputBox=!1,this._editInputNode.focus())}_deleteBookmark(e){const t=e.currentTarget["data-bookmark"];this.viewModel.bookmarks.remove(t)}_goToBookmark(e){const t=e.currentTarget["data-bookmark"];this.endAddBookmark(),this._closeEditBookmarkForm(),this.viewModel.goTo(t)}async _refreshThumbnail(){const{_userState:e,_editMenu:t,viewModel:o}=this;e.validationState=void 0,await o.editBookmark(this._userState.editedBookmark,{takeScreenshot:!0,captureViewpoint:!1,captureRotation:!1,captureScale:!1,captureTimeExtent:!1}),t.open=!1,this._focusEditInputBox=!0,this.scheduleRender()}_removeThumbnail(){const{_userState:e,_editMenu:t}=this;e.editedBookmark.thumbnail=null,e.validationState=void 0,t.open=!1,this._focusEditInputBox=!0,this.scheduleRender()}_startUseImageUrl(){this._userState.state="edit-thumbnail",this._editMenu.open=!1,this._focusUrlEditInputBox=!0,this.scheduleRender()}_editBookmarkUrlSubmit(e){e.preventDefault();const{_urlEditInputNode:t,_userState:o}=this,s=t.value;A.test(s)?(s&&(o.editedBookmark.thumbnail=new q({url:s})),this._closeUrlEditBookmarkForm()):o.validationState="absolute-url-required"}};n([d()],u.prototype,"_editIncludeTimeExtent",void 0),n([d({type:U})],u.prototype,"_userState",void 0),n([d({readOnly:!0})],u.prototype,"_editMenuItems",null),n([d({readOnly:!0})],u.prototype,"_editMenu",null),n([d()],u.prototype,"defaultCreateOptions",null),n([d()],u.prototype,"defaultEditOptions",null),n([d()],u.prototype,"bookmarks",null),n([d()],u.prototype,"disabled",void 0),n([d()],u.prototype,"editingEnabled",void 0),n([d()],u.prototype,"headingLevel",void 0),n([d()],u.prototype,"goToOverride",null),n([d()],u.prototype,"iconClass",void 0),n([d()],u.prototype,"label",null),n([d(),C("esri/widgets/Bookmarks/t9n/Bookmarks")],u.prototype,"messages",void 0),n([d(),C("esri/t9n/common")],u.prototype,"messagesCommon",void 0),n([d(),C("esri/core/t9n/Units")],u.prototype,"messagesUnits",void 0),n([d()],u.prototype,"uiStrings",void 0),n([d()],u.prototype,"view",null),n([d({type:W}),Z(["select-bookmark","bookmark-edit","bookmark-select"])],u.prototype,"viewModel",void 0),n([d()],u.prototype,"visibleElements",void 0),n([j("visibleElements")],u.prototype,"castVisibleElements",null),n([d()],u.prototype,"endAddBookmark",null),n([d()],u.prototype,"startAddBookmark",null),u=n([M(pe)],u);const _e=u,ge=(e,t)=>new _e({view:t,container:e,editingEnabled:!0}),Be=e=>{const t=B.useRef(),o=B.useRef(!1),[s,r]=B.useState(),[l,k]=B.useState(!1);B.useEffect(()=>(o.current||(o.current=!0,r(ge(t.current,e.view))),()=>{s&&s.destroy()}),[]),B.useEffect(()=>{k(e.isActive)},[e.isActive]);const m=B.useCallback(_=>{e.toolDismissed()},[]),p=B.useCallback(_=>{e.showTips(me)},[]);return{bookmarkRef:t,isActive:l,toolDismissed:m,tipsClicked:p}},ve=e=>{const{bookmarkRef:t,isActive:o,toolDismissed:s,tipsClicked:r}=Be(e);return w.jsxs(le,{id:"bookmarks-panel",heading:"Bookmarks","data-panel":"bookmarks",hidden:!o,closed:o?void 0:!0,closable:!0,onCalcitePanelClose:s,children:[w.jsx(H,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:r}),w.jsx(H,{id:"collapseTool",icon:"chevron-up",text:"",slot:"header-actions-end",onClick:ue}),w.jsx(L,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),w.jsx(L,{label:"Collapse",referenceElement:"collapseTool",closeOnClick:!0,children:"Collapse"}),w.jsx("div",{ref:t})]})},we=de.memo(ve);export{ve as Bookmarks,we as default};
