import{e as n,y as m,a as E,b4 as J,cm as K,id as he,x as T,B as V,a6 as I,aU as pe,ah as Q,a1 as de,g as x,S as ve,bb as ye,bc as _e,qA as we,c1 as X,dl as Y,gy as z,qB as M,bV as w,f as q,a_ as ge,gD as U,gc as G,gf as Z,gi as F,gt as be,go as fe,gp as $e,gk as Me,w as Le,av as P,I as S,as as Se,b8 as W,aM as ke,aV as Ae,M as ee,O as te,W as De,z as p,qC as qe,ba as Oe}from"./index-84d82762.js";import{e as Te}from"./Measure-2905fddd.js";import{i as C,c as xe,s as Ie}from"./analysisThemeUtils-87a2a438.js";import{geodesicDensify as R,planarLength as se,simplify as A,geodesicLength as Ue,geodesicArea as Ge,planarArea as We}from"./geometryEngine-6532c452.js";import{l as Re}from"./Draw-334d8b6a.js";import{p as Ve,x as ze,v as Ce,E as Ee}from"./SnappingDragPipelineStep-65a01c0a.js";import{j as Be}from"./GraphicManipulator-46045986.js";import{v as je}from"./InteractiveToolViewModel-775975b5.js";import"./getDefaultUnitForView-ffc28897.js";import"./colorUtils-4cb63d9e.js";import"./geometryEngineBase-e1a33b0a.js";import"./hydrated-09767936.js";import"./SnappingVisualizer2D-467a88c5.js";import"./enums-55085e26.js";import"./settings-668e9680.js";import"./SnappingContext-910a0375.js";import"./PointSnappingHint-78f462a1.js";import"./plane-1f295e9f.js";import"./sphere-52f8f52c.js";import"./mat3f64-221ce671.js";import"./mat4f64-65d35099.js";import"./quatf64-3363c48e.js";import"./SnappingOperation-d3c0deb2.js";import"./drawSurfaces-d53a61a0.js";import"./quat-125beff5.js";import"./hydratedFeatures-872b9f3f.js";import"./drawUtils-154f4205.js";import"./drapedUtils-18c61329.js";const g=1e5;let b=class extends Ve{constructor(t){super(t),this._drawActive=!1,this._measurementLayer=new J({internal:!0,listMode:"hide",visible:!1}),this._manipulatorLayer=new J({internal:!0,listMode:"hide",visible:!1}),this._vertices=[],this.geodesicDistanceThreshold=1e5,this.measurement=null,this.measurementLabel=null}initialize(){K("esri/core/t9n/Units").then(e=>{this.messages=e}),this.addHandles(he(async()=>{this.messages=await K("esri/core/t9n/Units")}));const t=this.view;this._draw=new Re({view:t}),t.map.addMany([this._measurementLayer,this._manipulatorLayer]),t.focus(),this.addHandles(T(()=>[this.unit,this.geodesicDistanceThreshold,this.messages],()=>{this._updateGraphics()},V))}destroy(){const{map:t}=this.view;this._draw.view=null,this._draw=I(this._draw),t.removeMany([this._measurementLayer,this._manipulatorLayer]),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._measurementLayer=I(this._measurementLayer),this._manipulatorLayer=I(this._manipulatorLayer),this._resetVertices()}get cursor(){return this._drawActive?"crosshair":null}set editable(t){this._set("editable",t),t||this._draw.reset()}onActivate(){this._drawActive||this._vertices.length!==0||this._startSketch()}onShow(){this._measurementLayer.visible=!0,this._manipulatorLayer.visible=!0}onHide(){this._measurementLayer.visible=!1,this._manipulatorLayer.visible=!1}reset(){this.manipulators.removeAll(),this._resetVertices(),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1}_resetVertices(){for(const{handle:t}of this._vertices)t.remove();this._vertices=[]}_startSketch(){this._drawActive=!0;const t=this._draw.create("polyline",{mode:"click"});t.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],e=>this._updateSketch(e.vertices)),t.on("draw-complete",()=>this._stopSketch())}_stopSketch(){if(this._vertices.length<3)return this.reset(),void this._startSketch();this.manipulators.forEach(({manipulator:t})=>{t.interactive=!0}),this._drawActive=!1,this.finishToolCreation()}_updateSketch(t){const e=this.view.spatialReference;if(e&&(!ie(e)||pe())){for(;this._vertices.length>t.length;){const{handle:r,manipulator:i}=this._vertices.pop();r.remove(),this.manipulators.remove(i)}for(let r=this._vertices.length;r<t.length;r++){const[i,u]=t[r],a=He(new Q({x:i,y:u,spatialReference:e}),this.view,this._manipulatorLayer);this.manipulators.add(a);const o=ze(a,(l,s)=>{s.next(Ce(this.view)).next(Ee(l.graphic,de.Local)).next(()=>{const h=l.graphic.geometry;this._vertices[r].coord=[h.x,h.y],this._updateGraphics()})});this._vertices.push({manipulator:a,coord:[i,u],handle:o})}if(this._vertices.length){const r=this._vertices.length-1,i=this._vertices[r],[u,a]=t[r];i.coord[0]===u&&i.coord[1]===a||(i.coord=[u,a],i.manipulator.graphic.geometry=new Q({x:u,y:a,spatialReference:e}));const o=this._drawActive?this._vertices[r].manipulator:null;this.manipulators.forEach(({manipulator:l})=>{l.interactive=o==null||l!==o})}this._updateGraphics()}}_updateGraphics(){if(this._vertices.length<2)return void this._measurementLayer.removeAll();const t=Ne(this._vertices.map(({coord:h})=>h),this.view.spatialReference,this.geodesicDistanceThreshold);if(!t)return;const{measurement:e,fillGeometry:r,outlineGeometry:i}=t;this._set("measurement",e);const u=e?Ke(this.messages,e,this.unit):null;if(this._set("measurementLabel",u),!r&&!i)return;let a,o,l;const{graphics:s}=this._measurementLayer;s.length===3?(a=s.at(0),o=s.at(1),l=s.at(2)):(a=new x({symbol:new ve({color:C(.3),outline:null})}),o=new x({symbol:new ye({color:C(),width:2})}),l=new x({symbol:new _e({color:xe(),font:new we({size:14,family:"sans-serif"}),haloColor:Ie(.5),haloSize:2})}),s.removeAll(),s.addMany([a,o,l])),a.geometry=r,o.geometry=i,l.geometry=r==null?void 0:r.centroid,l.symbol.text=(u==null?void 0:u.area)??""}};function He(t,e,r){const u={style:"circle",color:C(.5),outline:{type:"simple-line",width:0}},a=new X({...u,size:8}),o=new X({...u,size:1.5*8}),l=new x({geometry:t,symbol:a});return new Be({view:e,layer:r,graphic:l,focusedSymbol:o})}function Ne(t,e,r){if(t.length===2){const h=new Y({paths:t,spatialReference:e});let y;if(e!=null&&e.isGeographic)if(z(e))y=M(h,g);else{const _=w(h,q.WGS84),v=M(_,g);y=w(v,e)}else if(e!=null&&e.isWebMercator)y=R(h,g,"meters");else if(se(h,"meters")>=r){const _=w(h,q.WGS84),v=M(_,g);y=w(v,e)}else y=h;return{measurement:null,fillGeometry:null,outlineGeometry:y}}t.push(t[0]);const i=new Y({paths:[t],spatialReference:e}),u=new ge({rings:[t],spatialReference:e});let a,o,l=null,s=null;if(e!=null&&e.isGeographic)if(z(e)){if(l=M(i,g),s=M(u,g),s=A(s),!s)return null;a=U([i],"meters")[0],o=G([s],"square-meters")[0]}else{const h=q.WGS84,y=w(i,h),_=w(u,h);if(l=M(y,g),s=M(_,g),s=A(s),!s)return null;a=U([y],"meters")[0],o=G([s],"square-meters")[0],l=w(l,e),s=w(s,e)}else if(e!=null&&e.isWebMercator){if(l=R(i,g,"meters"),s=R(u,g,"meters"),s=A(s),!s)return null;a=Ue(i,"meters"),o=Ge(s,"square-meters")}else{const h=se(i,"meters");if(h>=r){const y=q.WGS84,_=w(i,y),v=w(u,y);if(l=M(_,g),s=M(v,g),s=A(s),!s)return null;a=U([_],"meters")[0],o=G([s],"square-meters")[0],l=w(l,e),s=w(s,e)}else{if(l=i,s=A(u),!s)return null;a=h,o=We(s,"square-meters")}}return{measurement:{geometry:s,area:o,perimeter:a},fillGeometry:s,outlineGeometry:l}}function Je(t){return t!=null}function ie(t){if(!t)return!1;const{isGeographic:e,isWebMercator:r,isWGS84:i}=t;return e&&!i&&!z(t)||!e&&!r}function Ke(t,e,r){if(!e||!t)return null;const i={area:null,perimeter:null},{area:u,perimeter:a}=e;switch(r){case"metric":i.area=fe(t,u,"square-meters");break;case"imperial":i.area=be(t,u,"square-meters");break;default:{const l=Z(u,"square-meters",r);i.area=F(t,l,r);break}}const o=Qe(r);if(o)switch(o){case"metric":i.perimeter=Me(t,a,"meters");break;case"imperial":i.perimeter=$e(t,a,"meters");break;default:{const l=Z(a,"meters",o);i.perimeter=F(t,l,o);break}}else i.perimeter="";return i}function Qe(t){switch(t){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";default:return null}}n([m()],b.prototype,"_drawActive",void 0),n([m({readOnly:!0})],b.prototype,"cursor",null),n([m({value:!0})],b.prototype,"editable",null),n([m({type:Number})],b.prototype,"geodesicDistanceThreshold",void 0),n([m({readOnly:!0})],b.prototype,"measurement",void 0),n([m({readOnly:!0})],b.prototype,"measurementLabel",void 0),n([m()],b.prototype,"messages",void 0),n([m()],b.prototype,"unit",void 0),n([m({constructOnly:!0})],b.prototype,"view",void 0),b=n([E("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],b);let f=class extends je{constructor(e){super(e),this.supportedViewType="2d",this.unsupportedErrorMessage="AreaMeasurement2DViewModel is only supported in 2D views.",this._handles=new Le,this.geodesicDistanceThreshold=1e5}initialize(){this._handles.add([T(()=>{var e;return(e=P(this.view))==null?void 0:e.spatialReference},()=>this.clear()),T(()=>this.unit,e=>{S(this.tool)&&(this.tool.unit=e)},V),T(()=>this.geodesicDistanceThreshold,e=>{S(this.tool)&&(this.tool.geodesicDistanceThreshold=e)},V)])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get measurement(){return S(this.tool)?this.tool.measurement:null}get measurementLabel(){return S(this.tool)?this.tool.measurementLabel:null}get state(){return this.disabled||Se(this.view)||!Je(this.view.spatialReference)?"disabled":S(this.tool)&&this.tool.measurement?this.tool.active?"measuring":"measured":"ready"}get unit(){return this._validateUnit(this.defaultUnit)}set unit(e){this._overrideIfSome("unit",this._validateUnit(e))}get unitOptions(){return W}set unitOptions(e){this._overrideIfSome("unitOptions",this._validateUnits(e))}async start(){const e=this.view;S(e)&&(await ke(()=>e.ready),ie(e.spatialReference)&&await Ae()),this.createTool({interactive:!0})}clear(){this.removeTool()}constructTool(){return new b({view:P(this.view),visible:this.visible,geodesicDistanceThreshold:this.geodesicDistanceThreshold,unit:this.unit})}_validateUnit(e){return this.unitOptions.includes(e)?e:this.unitOptions.includes(this.defaultUnit)?this.defaultUnit:this.unitOptions[0]}_validateUnits(e=[]){const r=e.filter(i=>W.includes(i));return r.length===0?W.slice():r}};n([m(Te)],f.prototype,"defaultUnit",void 0),n([m({type:Number})],f.prototype,"geodesicDistanceThreshold",void 0),n([m({readOnly:!0})],f.prototype,"measurement",null),n([m({readOnly:!0})],f.prototype,"measurementLabel",null),n([m({readOnly:!0})],f.prototype,"state",null),n([m({type:String})],f.prototype,"unit",null),n([m({type:[String]})],f.prototype,"unitOptions",null),f=n([E("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel")],f);const re=f,$="esri-area-measurement-2d",O=`${$}__units`,D=`${$}__measurement`,c={buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-measure-area",base:`${$} esri-widget esri-widget--panel`,container:`${$}__container`,hint:`${$}__hint`,hintText:`${$}__hint-text`,panelError:`${$}__panel--error`,measurement:D,measurementItem:`${D}-item`,measurementItemDisabled:`${D}-item--disabled`,measurementItemTitle:`${D}-item-title`,measurementItemValue:`${D}-item-value`,settings:`${$}__settings`,units:O,unitsLabel:`${O}-label`,unitsSelect:`${O}-select esri-select`,unitsSelectWrapper:`${O}-select-wrapper`,actionSection:`${$}__actions`,newMeasurementButton:`${$}__clear-button esri-button esri-button--primary`};let d=class extends De{constructor(t,e){super(t,e),this.iconClass=c.widgetIcon,this.messages=null,this.messagesUnits=null,this.viewModel=new re}get active(){return this.viewModel.active}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}render(){const{id:t,viewModel:e,visible:r}=this,{active:i,supported:u,measurementLabel:a,state:o,unit:l,unitOptions:s}=e,h=o==="disabled",y=o==="ready",_=o==="measuring"||o==="measured",{messages:v,messagesUnits:B}=this,ae=i&&y?p("section",{key:"hint",class:c.hint},p("p",{class:c.hintText},v.hint)):null,ne=u?null:p("section",{key:"unsupported",class:c.panelError},p("p",null,v.unsupported)),j=(L,k,N)=>k?p("div",{key:`${N}-enabled`,class:c.measurementItem},p("span",{class:c.measurementItemTitle},L),p("span",{"aria-live":"polite",class:c.measurementItemValue},k)):p("div",{key:`${N}-disabled`,class:this.classes(c.measurementItem,c.measurementItemDisabled),"aria-disabled":"true"},p("span",{class:c.measurementItemTitle},L)),le=_?p("section",{key:"measurement",class:c.measurement},j(v.area,a==null?void 0:a.area,"area"),j(v.perimeter,a==null?void 0:a.perimeter,"perimeter")):null,H=`${t}__units`,oe=p("section",{key:"units",class:c.units},p("label",{class:c.unitsLabel,for:H},v.unit),p("div",{class:c.unitsSelectWrapper},p("select",{class:c.unitsSelect,id:H,onchange:this._changeUnit,bind:this,value:l},s.map(L=>{var k;return p("option",{key:L,value:L},qe(L)?B.systems[L]:(k=B.units[L])==null?void 0:k.pluralCapitalized)})))),ue=_?p("div",{key:"settings",class:c.settings},oe):null,me=!u||i&&!_?null:p("div",{class:c.actionSection},p("button",{"aria-label":v.newMeasurement,bind:this,class:this.classes(c.newMeasurementButton,h&&c.buttonDisabled),disabled:h,onclick:this._newMeasurement,title:v.newMeasurement,type:"button"},v.newMeasurement)),ce=r?p("div",{class:c.container},ne,ae,ue,le,me):null;return p("div",{"aria-label":v.widgetLabel,class:c.base,role:"region"},ce)}_newMeasurement(){Oe(this.viewModel.start())}_changeUnit(t){const e=t.target,r=e.options[e.selectedIndex];r&&(this.viewModel.unit=r.value)}};n([m({readOnly:!0})],d.prototype,"active",null),n([m()],d.prototype,"iconClass",void 0),n([m()],d.prototype,"label",null),n([m(),ee("esri/widgets/AreaMeasurement2D/t9n/AreaMeasurement2D")],d.prototype,"messages",void 0),n([m(),ee("esri/core/t9n/Units")],d.prototype,"messagesUnits",void 0),n([m()],d.prototype,"uiStrings",void 0),n([m()],d.prototype,"unit",null),n([m()],d.prototype,"unitOptions",null),n([m()],d.prototype,"view",null),n([m({type:re})],d.prototype,"viewModel",void 0),n([m({type:Boolean})],d.prototype,"visible",null),n([te()],d.prototype,"_newMeasurement",null),n([te()],d.prototype,"_changeUnit",null),d=n([E("esri.widgets.AreaMeasurement2D")],d);const Lt=d;export{Lt as default};
