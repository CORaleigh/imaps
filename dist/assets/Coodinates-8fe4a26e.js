import{hf as le,hg as ce,hh as R,ah as x,f as $,hi as ne,hj as Z,ad as L,hk as oe,n as de,b4 as ue,r as o,aU as ee,aV as te,bV as ae,R as fe,k as s,hl as ve,bW as he,bX as ge,q as we,$ as pe,b7 as me,hm as Ce,o as W,p as D}from"./index-7753bab1.js";function O(){return le()}function U(){return ce()}function xe(e,n){const t=[];e=(e=(e=e.replace(/[\u00B0\u00BA]/g,"^")).replace(/\u2032/g,"'")).replace(/\u2033/g,'"');const l=A(n);return R.dmsToGeog(l,1,[e],t)?new x(t[0][0],t[0][1],n||$.WGS84):null}function be(e,n){const t=[];!n&&/\(.+27/.test(e)&&(n=$.GCS_NAD_1927);const l=A(n);return ne.usngToGeog(l,1,[e],t)?new x(t[0][0],t[0][1],n||$.WGS84):null}function ie(e,n,t=0){const l=[[e.x,e.y]],v=[],g=A(e.spatialReference);let w=0;switch(n){case"dd":w=R.geogToDd(g,1,l,t,v);break;case"ddm":w=R.geogToDdm(g,1,l,t,v);break;case"dms":w=R.geogToDms(g,1,l,t,v);break;default:return console.warn(`invalid format: ${n}`),null}return w?v[0]:null}function ke(e,n=0,t=!1){const l=[[e.x,e.y]],v=[],g=A(e.spatialReference);return ne.geogToUsng(g,1,l,n,!1,t,v)?v[0]:null}function A(e){let n=null;if(e||(e=$.WGS84),e.wkid){if(n=Z.geogcs(e.wkid),!n)throw new L("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt)throw new L("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(n=Z.fromString(oe.PE_TYPE_GEOGCS,e.wkt),!n)throw new L("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return n}let m,C;const Se=new de({url:"assets/pin.svg",height:36,width:36}),_=new ue({id:"coordinate-widget"}),Ne=e=>{const n=o.useRef(!1),t=o.useRef(null),l=o.useRef(null),[v,g]=o.useState(!1),[w,N]=o.useState(!1),y=o.useRef(null),b=o.useRef(null),p=[{value:"dd",label:"Decimal Degrees",placeholder:"35.7582196 -78.8079653"},{value:"dms",label:"Degrees Minutes Seconds",placeholder:`35째 45' 29.7116777"N 78째 48' 31.524W`},{value:"spft",label:"Stateplane Feet",placeholder:"731166.165 2056872.973"},{value:"usng",label:"US National Grid",placeholder:"17S PV 98178 59368"}],[F,T]=o.useState(p[0]),u=o.useRef(p[0]),E=o.useCallback(r=>{g(a=>!a)},[]),M=o.useCallback(r=>{N(a=>!a)},[]),j=o.useCallback(r=>{var a;r.target.active=!r.target.active,r.target.active?(m==null||m.remove(),B(e.view,e.clickActivated)):(C==null||C.remove(),e.view.popup.autoOpenEnabled=!0,(a=document.querySelector(".identify-widget"))==null||a.classList.add("active"),I())},[]),k=o.useCallback(r=>{t.current&&(t.current.value="");const a=p.find(h=>h.value===r.target.value);a&&(T(a),u.current.value=a.value)},[u]),re=o.useCallback(r=>{if(r.currentTarget.value===""){const a=e.view.map.findLayerById("coordinate-widget");a&&a.removeAll()}},[]),se=o.useCallback(async r=>{var h,d,c,V,q,P,H,X,Y,z,J,K;if(((h=t.current)==null?void 0:h.value)===""){(d=t.current)==null||d.setAttribute("status","invalid");return}O()||await U(),ee()||await te();let a=new x;if(u.current.value==="dd"){let i=(c=t.current)==null?void 0:c.value.replace(","," ").split(" ");if((i==null?void 0:i.length)!==2&&(i=(V=t.current)==null?void 0:V.value.split(", ")),(i==null?void 0:i.length)===2){let f=!isNaN(parseFloat(i[1]))&&parseFloat(i[1])<0?parseFloat(i[1]):!isNaN(parseFloat(i[0]))&&parseFloat(i[0])<0?parseFloat(i[0]):NaN,S=!isNaN(parseFloat(i[0]))&&parseFloat(i[0])>0?parseFloat(i[0]):!isNaN(parseFloat(i[1]))&&parseFloat(i[1])>0?parseFloat(i[1]):NaN;isNaN(f)||isNaN(S)?(q=t.current)==null||q.setAttribute("status","invalid"):(a=new x({x:f,y:S,spatialReference:{wkid:4326}}),(P=t.current)==null||P.setAttribute("status","valid"))}}if(u.current.value==="dms"&&t.current&&(a=xe((H=t.current)==null?void 0:H.value.replace(/\s\s+/g," ")),a||(X=t.current)==null||X.setAttribute("status","invalid")),u.current.value==="spft"){const i=(Y=t.current)==null?void 0:Y.value.replace(/\s\s+/g," ");let f=i==null?void 0:i.split(" ");if((f==null?void 0:f.length)!==2&&(f=i==null?void 0:i.split(","),(f==null?void 0:f.length)!==2)){(z=t.current)==null||z.setAttribute("status","invalid");return}const S=parseFloat(f[1]),Q=parseFloat(f[2]);if(isNaN(S)||isNaN(Q)){(J=t.current)==null||J.setAttribute("status","invalid");return}a=new x({x:S,y:Q,spatialReference:{wkid:4326}}),a=ae(a,e.view.spatialReference)}t.current&&u.current.value==="usng"&&(a=be(t.current.value)),e.view.constraints.geometry.contains(a)||((K=b.current)==null||K.setAttribute("open",!0),setTimeout(()=>{var i;(i=b.current)==null||i.removeAttribute("open")},3e3)),e.view.map.findLayerById("coordinate-widget")||e.view.map.add(_),_.removeAll(),_.add({geometry:a,attributes:null,symbol:Se}),e.view.goTo(a)},[]),G=async r=>{O()||await U(),ee()||await te();let a;r.type==="point"?a=r:a=e.view.toMap({x:r.x,y:r.y});const h=new x({x:a.longitude,y:a.latitude,spatialReference:{wkid:4326}});if(u.current.value==="dd"){let c=ie(h,"dd",7).replaceAll("078.","78.").split(" ");c[0].includes("S")&&(c[0]=`-${c[0].replace("S","")}`),c[0].includes("N")&&(c[0]=`${c[0].replace("N","")}`),c[1].includes("W")&&(c[1]=`-${c[1].replace("W","")}`),c[1].includes("E")&&(c[1]=`${c[1].replace("N","")}`),l.current.innerHTML=c.join(" ")}else if(u.current.value==="dms"){const d=ie(h,"dms",7).split(" "),c=`${d[0]}째 ${d[1]}' ${d[2].replace("N",'"N')} ${d[3].substring(1)}째 ${d[4]}' ${d[5].replace("W",'"W')}`;l.current.innerHTML=c}else if(u.current.value==="usng")l.current.innerHTML=ke(h,5,!0);else if(u.current.value==="spft"){const d=ae(a,{wkid:2264});l.current.innerHTML=`${d.y.toFixed(3)}N ${d.x.toFixed(3)}E`}},B=(r,a)=>{var h;a(r),e.view.popup.autoOpenEnabled=!1,(h=document.querySelector(".identify-widget"))==null||h.classList.remove("active"),C=e.view.on("click",d=>{G(d)})},I=async()=>{O()||await U(),G(e.view.extent.center),m=e.view.on("pointer-move",r=>{G(r)})};return o.useEffect(()=>{if(!n.current&&e.view)return n.current=!0,e.expand&&(e.expand.hasHandles()||e.expand.watch("expanded",r=>{r?y.current.getAttribute("active")?I():B(e.view,e.clickActivated):(m==null||m.remove(),C==null||C.remove())})),I(),()=>{}},[]),{loaded:n,settingsClicked:E,showSettings:v,formats:p,formatChanged:k,searchClicked:M,showSearch:w,selectedFormat:F,searchCoordinates:se,coordInput:t,modeClicked:j,coordinateRef:l,modeActionRef:y,noticeRef:b,coordinateInputChanged:re}};function ye(e){var j;const{loaded:n,settingsClicked:t,showSettings:l,formats:v,formatChanged:g,searchClicked:w,showSearch:N,selectedFormat:y,searchCoordinates:b,coordInput:p,modeClicked:F,coordinateRef:T,modeActionRef:u,noticeRef:E,coordinateInputChanged:M}=Ne(e);return s.jsxs("div",{id:"coordinatesWidget",children:[s.jsx(ve,{scale:"s",ref:E,kind:"danger",closable:!0,children:s.jsx("div",{slot:"message",children:"Location outside of county"})}),s.jsx("div",{hidden:l?void 0:!0,children:s.jsx(he,{scale:"m",label:"Coordinate Systems",onCalciteSelectChange:g,children:v.map(k=>s.jsx(ge,{value:k.value,children:k.label},k.value))})}),s.jsx("div",{hidden:N?void 0:!0,children:s.jsxs(we,{children:[s.jsxs("div",{className:"coordinate-input",children:[s.jsx(pe,{scale:"m",ref:p,id:"coordInput",placeholder:y.placeholder,clearable:!0,onCalciteInputChange:M}),s.jsx(me,{onClick:b,appearance:"transparent",kind:"neutral",width:"full",scale:"m",iconEnd:"search"})]}),s.jsx(Ce,{hidden:((j=p.current)==null?void 0:j.getAttribute("status"))==="invalid"?void 0:!0,status:"invalid",children:"Value is not valid"})]})}),s.jsxs("div",{className:"coordinates-row",children:[s.jsx("div",{ref:T,className:"coordinates-text"}),s.jsx(W,{id:"coordinateSearch",text:"",icon:"search",active:N?!0:void 0,onClick:w}),s.jsx(D,{closeOnClick:!0,label:"Search Coordinates",referenceElement:"coordinateSearch",children:"Search Coordinates"}),s.jsx(W,{id:"coordinateUnits",text:"",icon:"gear",onClick:t,active:l?!0:void 0}),s.jsx(D,{closeOnClick:!0,label:"Set Units",referenceElement:"coordinateUnits",children:"Set Units"}),s.jsx(W,{id:"coordinateMode",ref:u,text:"",icon:"pin",onClick:F}),s.jsx(D,{closeOnClick:!0,label:"Set Mode",referenceElement:"coordinateMode",children:"Set Mode"})]})]})}const Re=fe.memo(ye);export{Re as default};
