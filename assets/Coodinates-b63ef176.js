import{hg as ce,hh as oe,hi as F,ai as b,f as $,hj as re,hk as ee,ae as D,hl as de,n as ue,b5 as fe,r as c,aV as te,aW as ae,bW as ie,R as ve,k as A,o,hm as he,bX as ge,bY as we,s as pe,a0 as me,b8 as Ce,hn as be,p as O,q as U}from"./index-056c54a4.js";function _(){return ce()}function B(){return oe()}function ke(e,n){const t=[];e=(e=(e=e.replace(/[\u00B0\u00BA]/g,"^")).replace(/\u2032/g,"'")).replace(/\u2033/g,'"');const l=T(n);return F.dmsToGeog(l,1,[e],t)?new b(t[0][0],t[0][1],n||$.WGS84):null}function Se(e,n){const t=[];!n&&/\(.+27/.test(e)&&(n=$.GCS_NAD_1927);const l=T(n);return re.usngToGeog(l,1,[e],t)?new b(t[0][0],t[0][1],n||$.WGS84):null}function ne(e,n,t=0){const l=[[e.x,e.y]],v=[],g=T(e.spatialReference);let w=0;switch(n){case"dd":w=F.geogToDd(g,1,l,t,v);break;case"ddm":w=F.geogToDdm(g,1,l,t,v);break;case"dms":w=F.geogToDms(g,1,l,t,v);break;default:return console.warn(`invalid format: ${n}`),null}return w?v[0]:null}function Ne(e,n=0,t=!1){const l=[[e.x,e.y]],v=[],g=T(e.spatialReference);return re.geogToUsng(g,1,l,n,!1,t,v)?v[0]:null}function T(e){let n=null;if(e||(e=$.WGS84),e.wkid){if(n=ee.geogcs(e.wkid),!n)throw new D("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt)throw new D("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(n=ee.fromString(de.PE_TYPE_GEOGCS,e.wkt),!n)throw new D("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return n}let m,C;const ye=new ue({url:"assets/pin.svg",height:36,width:36}),j=new fe({id:"coordinate-widget"}),xe=e=>{const n=c.useRef(!1),t=c.useRef(null),l=c.useRef(null),[v,g]=c.useState(!1),[w,y]=c.useState(!1),x=c.useRef(null),k=c.useRef(null),p=[{value:"dd",label:"Decimal Degrees",placeholder:"35.7582196 -78.8079653"},{value:"dms",label:"Degrees Minutes Seconds",placeholder:`35째 45' 29.7116777"N 78째 48' 31.524W`},{value:"spft",label:"Stateplane Feet",placeholder:"731166.165 2056872.973"},{value:"usng",label:"US National Grid",placeholder:"17S PV 98178 59368"}],[E,M]=c.useState(p[0]),u=c.useRef(p[0]),W=c.useCallback(r=>{g(a=>!a)},[]),G=c.useCallback(r=>{y(a=>!a)},[]),R=c.useCallback(r=>{var a;r.target.active=!r.target.active,r.target.active?(m==null||m.remove(),q(e.view,e.clickActivated)):(C==null||C.remove(),e.view.popup.autoOpenEnabled=!0,(a=document.querySelector(".identify-widget"))==null||a.classList.add("active"),L())},[]),S=c.useCallback(r=>{t.current&&(t.current.value="");const a=p.find(h=>h.value===r.target.value);a&&(M(a),u.current.value=a.value)},[u]),le=c.useCallback(r=>{if(r.currentTarget.value===""){const a=e.view.map.findLayerById("coordinate-widget");a&&a.removeAll()}},[]),se=c.useCallback(async r=>{var h,d,s,P,V,Y,H,X,z,J,K,Q;if(((h=t.current)==null?void 0:h.value)===""){(d=t.current)==null||d.setAttribute("status","invalid");return}_()||await B(),te()||await ae();let a=new b;if(u.current.value==="dd"){let i=(s=t.current)==null?void 0:s.value.replace(","," ").split(" ");if((i==null?void 0:i.length)!==2&&(i=(P=t.current)==null?void 0:P.value.split(", ")),(i==null?void 0:i.length)===2){let f=!isNaN(parseFloat(i[1]))&&parseFloat(i[1])<0?parseFloat(i[1]):!isNaN(parseFloat(i[0]))&&parseFloat(i[0])<0?parseFloat(i[0]):NaN,N=!isNaN(parseFloat(i[0]))&&parseFloat(i[0])>0?parseFloat(i[0]):!isNaN(parseFloat(i[1]))&&parseFloat(i[1])>0?parseFloat(i[1]):NaN;isNaN(f)||isNaN(N)?(V=t.current)==null||V.setAttribute("status","invalid"):(a=new b({x:f,y:N,spatialReference:{wkid:4326}}),(Y=t.current)==null||Y.setAttribute("status","valid"))}}if(u.current.value==="dms"&&t.current&&(a=ke((H=t.current)==null?void 0:H.value.replace(/\s\s+/g," ")),a||(X=t.current)==null||X.setAttribute("status","invalid")),u.current.value==="spft"){const i=(z=t.current)==null?void 0:z.value.replace(/\s\s+/g," ");let f=i==null?void 0:i.split(" ");if((f==null?void 0:f.length)!==2&&(f=i==null?void 0:i.split(","),(f==null?void 0:f.length)!==2)){(J=t.current)==null||J.setAttribute("status","invalid");return}const N=parseFloat(f[1]),Z=parseFloat(f[2]);if(isNaN(N)||isNaN(Z)){(K=t.current)==null||K.setAttribute("status","invalid");return}a=new b({x:N,y:Z,spatialReference:{wkid:4326}}),a=ie(a,e.view.spatialReference)}t.current&&u.current.value==="usng"&&(a=Se(t.current.value)),e.view.constraints.geometry.contains(a)||((Q=k.current)==null||Q.setAttribute("open",!0),setTimeout(()=>{var i;(i=k.current)==null||i.removeAttribute("open")},3e3)),e.view.map.findLayerById("coordinate-widget")||e.view.map.add(j),j.removeAll(),j.add({geometry:a,attributes:null,symbol:ye}),e.view.goTo(a)},[]),I=async r=>{_()||await B(),te()||await ae();let a;r.type==="point"?a=r:a=e.view.toMap({x:r.x,y:r.y});const h=new b({x:a.longitude,y:a.latitude,spatialReference:{wkid:4326}});if(u.current.value==="dd"){let s=ne(h,"dd",7).replaceAll("078.","78.").split(" ");s[0].includes("S")&&(s[0]=`-${s[0].replace("S","")}`),s[0].includes("N")&&(s[0]=`${s[0].replace("N","")}`),s[1].includes("W")&&(s[1]=`-${s[1].replace("W","")}`),s[1].includes("E")&&(s[1]=`${s[1].replace("N","")}`),l.current.innerHTML=s.join(" ")}else if(u.current.value==="dms"){const d=ne(h,"dms",7).split(" "),s=`${d[0]}째 ${d[1]}' ${d[2].replace("N",'"N')} ${d[3].substring(1)}째 ${d[4]}' ${d[5].replace("W",'"W')}`;l.current.innerHTML=s}else if(u.current.value==="usng")l.current.innerHTML=Ne(h,5,!0);else if(u.current.value==="spft"){const d=ie(a,{wkid:2264});l.current.innerHTML=`${d.y.toFixed(3)}N ${d.x.toFixed(3)}E`}},q=(r,a)=>{var h;a(r),e.view.popup.autoOpenEnabled=!1,(h=document.querySelector(".identify-widget"))==null||h.classList.remove("active"),C=e.view.on("click",d=>{I(d)})},L=async()=>{_()||await B(),I(e.view.extent.center),m=e.view.on("pointer-move",r=>{I(r)})};return c.useEffect(()=>{if(!n.current&&e.view)return n.current=!0,e.expand&&(e.expand.hasHandles()||e.expand.watch("expanded",r=>{r?x.current.getAttribute("active")?L():q(e.view,e.clickActivated):(m==null||m.remove(),C==null||C.remove())})),L(),()=>{}},[]),{loaded:n,settingsClicked:W,showSettings:v,formats:p,formatChanged:S,searchClicked:G,showSearch:w,selectedFormat:E,searchCoordinates:se,coordInput:t,modeClicked:R,coordinateRef:l,modeActionRef:x,noticeRef:k,coordinateInputChanged:le}};function Re(e){var R;const{loaded:n,settingsClicked:t,showSettings:l,formats:v,formatChanged:g,searchClicked:w,showSearch:y,selectedFormat:x,searchCoordinates:k,coordInput:p,modeClicked:E,coordinateRef:M,modeActionRef:u,noticeRef:W,coordinateInputChanged:G}=xe(e);return A("div",{id:"coordinatesWidget",children:[o(he,{scale:"s",ref:W,kind:"danger",closable:!0,children:o("div",{slot:"message",children:"Location outside of county"})}),o("div",{hidden:l?void 0:!0,children:o(ge,{scale:"m",label:"Coordinate Systems",onCalciteSelectChange:g,children:v.map(S=>o(we,{value:S.value,children:S.label},S.value))})}),o("div",{hidden:y?void 0:!0,children:A(pe,{children:[A("div",{className:"coordinate-input",children:[o(me,{scale:"m",ref:p,id:"coordInput",placeholder:x.placeholder,clearable:!0,onCalciteInputChange:G}),o(Ce,{onClick:k,appearance:"transparent",kind:"neutral",width:"full",scale:"m",iconEnd:"search"})]}),o(be,{hidden:((R=p.current)==null?void 0:R.getAttribute("status"))==="invalid"?void 0:!0,status:"invalid",children:"Value is not valid"})]})}),A("div",{className:"coordinates-row",children:[o("div",{ref:M,className:"coordinates-text"}),o(O,{id:"coordinateSearch",text:"",icon:"search",active:y?!0:void 0,onClick:w}),o(U,{closeOnClick:!0,label:"Search Coordinates",referenceElement:"coordinateSearch",children:"Search Coordinates"}),o(O,{id:"coordinateUnits",text:"",icon:"gear",onClick:t,active:l?!0:void 0}),o(U,{closeOnClick:!0,label:"Set Units",referenceElement:"coordinateUnits",children:"Set Units"}),o(O,{id:"coordinateMode",ref:u,text:"",icon:"pin",onClick:E}),o(U,{closeOnClick:!0,label:"Set Mode",referenceElement:"coordinateMode",children:"Set Mode"})]})]})}const Fe=ve.memo(Re);export{Fe as default};
