import{hx as f,bv as b,n as h,hy as y,H as m,hz as E,hA as p,R as w,r as c,o as g}from"./index-056c54a4.js";let r;const T=async(a,t)=>{const e=await v(t);return r=new f({container:a,view:t,editingEnabled:!1,multiSortEnabled:!0,visibleElements:{selectionColumn:!1,menuItems:{refreshData:!1,toggleColumns:!1}},menuConfig:{items:[new b({label:"Export",iconClass:"esri-icon-download",clickFunction:()=>{S(r)}})]},tableTemplate:R(),layer:e}),await(r==null?void 0:r.when()),r.on("selection-change",A),F(r),r},A=async a=>{if(a.added.length){const t=await r.layer.queryFeatures({objectIds:[a.added[0].feature.getObjectId()],returnGeometry:!0});if(t.features.length){const e=t.features[0];e.setAttribute("type","address"),e.symbol=new h({url:"assets/pin.svg",height:24,width:24}),y(r.view),r.view.graphics.add(e),r.view.goTo({target:e,zoom:18},{easing:"ease-in-out",duration:1e3})}}},F=a=>{a.findColumn("ADDRESS").width=150,a.findColumn("FEATURETYPE").width=150,setTimeout(()=>{const t=a.container.querySelector("vaadin-grid");t==null||t.addEventListener("click",e=>{var s;if(e.target.nodeName==="VAADIN-GRID-CELL-CONTENT"){a.highlightIds.removeAll();const d=((s=t.getEventContext(e))==null?void 0:s.item).feature;a.highlightIds.add(d.getAttribute("OBJECTID"))}})},2e3)};let o;const v=async a=>{const t=new m({portalItem:{id:"318be24592ea4dcba042511b3125fd53"},layerId:2});o=t;const e=await t.load(),s=new m({source:[],fields:e.fields,geometryType:"point",spatialReference:a.spatialReference,popupTemplate:e.popupTemplate,objectIdField:e.objectIdField,displayField:e.displayField,id:"feature-table"});s.fields.forEach(l=>{l.nullable=!0,l.name==="DEED_DATE"&&(l.type="string")}),a.map.allTables.add(s);try{return await s.load(),s}catch(l){console.log(l)}},R=()=>new E({columnTemplates:[new p({label:"Address",fieldName:"ADDRESS",editable:!1,initialSortPriority:0,direction:"asc"}),new p({label:"Type",fieldName:"FEATURETYPE",editable:!1,initialSortPriority:1,direction:"asc"})]}),D=async(a,t)=>{if(t)try{y(t.view);const e=await(o==null?void 0:o.queryFeatures({geometry:a.geometry,outFields:["ADDRESS","FEATURETYPE"],returnGeometry:!0,where:"1=1"})),s=await t.layer.queryFeatures({where:"1=1",returnGeometry:!0});await t.layer.applyEdits({deleteFeatures:s.features}),await t.layer.applyEdits({addFeatures:e.features}),t.refresh()}catch(e){console.log(e)}},S=async a=>{const t=await a.layer.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["ADDRESS","FEATURETYPE"]});let e="";a.tableTemplate.columnTemplates.forEach(n=>{e+=`${n.label},`}),e+=`\r
`,t.features.forEach(n=>{a.tableTemplate.columnTemplates.forEach(u=>{n.attributes[u.fieldName]?e+=`"${n.attributes[u.fieldName]}",`:e+='"",'}),e+=`\r
`});let s=new Date().toISOString();s=s.replaceAll(":","").replaceAll("-","");const l=`imaps_addresses_export_${s}.csv`,d=new Blob([e],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(i.download!==void 0){const n=URL.createObjectURL(d);i.setAttribute("href",n),i.setAttribute("download",l),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}};function C(a){const t=c.useRef(),e=c.useRef(!1);return c.useEffect(()=>(e.current||(e.current=!0,T(t.current,a.view).then(s=>{D(a.property,s)})),()=>{}),[]),g("div",{id:"address-table",ref:t})}const x=w.memo(C);export{x as default};
