import{r as x}from"./earcut-61f7b102.js";import{cp as E}from"./index-056c54a4.js";import{r as _}from"./deduplicate-37ec4dbf.js";import{a as O,n as L}from"./DoubleArray-60426e22.js";function F(n){const f=N(n.rings,n.hasZ,w.CCW_IS_HOLE),p=new Array;let o=0,r=0;for(const e of f.polygons){const c=e.count,s=e.index,y=O(f.position,3*s,3*c),u=e.holeIndices.map(h=>h-s),l=new Uint32Array(x(y,u,3));p.push({position:y,faces:l}),o+=y.length,r+=l.length}const t=H(p,o,r),g=Array.isArray(t.position)?_(t.position,3,{originalIndices:t.faces}):_(t.position.buffer,6,{originalIndices:t.faces});return t.position=new Float64Array(g.buffer),t.faces=g.indices,t}function H(n,f,p){if(n.length===1)return n[0];const o=L(f),r=new Uint32Array(p);let t=0,g=0,e=0;for(const c of n){for(let s=0;s<c.position.length;s++)o[t++]=c.position[s];for(let s=0;s<c.faces.length;s++)r[g++]=c.faces[s]+e;e=t/3}return{position:o,faces:r}}function N(n,f,p){const o=n.length,r=new Array(o),t=new Array(o),g=new Array(o);let e=0,c=0,s=0,y=0;for(let h=0;h<o;++h)y+=n[h].length;const u=L(3*y);let l=0;for(let h=o-1;h>=0;h--){const i=n[h],I=p===w.CCW_IS_HOLE&&S(i);if(I&&o!==1)r[e++]=i;else{let C=i.length;for(let a=0;a<e;++a)C+=r[a].length;const d={index:l,pathLengths:new Array(e+1),count:C,holeIndices:new Array(e)};d.pathLengths[0]=i.length,i.length>0&&(g[s++]={index:l,count:i.length}),l=I?m(i,i.length-1,-1,u,l,i.length,f):m(i,0,1,u,l,i.length,f);for(let a=0;a<e;++a){const A=r[a];d.holeIndices[a]=l,d.pathLengths[a+1]=A.length,A.length>0&&(g[s++]={index:l,count:A.length}),l=m(A,0,1,u,l,A.length,f)}e=0,d.count>0&&(t[c++]=d)}}for(let h=0;h<e;++h){const i=r[h];i.length>0&&(g[s++]={index:l,count:i.length}),l=m(i,0,1,u,l,i.length,f)}return t.length=c,g.length=s,{position:u,polygons:t,outlines:g}}function m(n,f,p,o,r,t,g){r*=3;for(let e=0;e<t;++e){const c=n[f];o[r++]=c[0],o[r++]=c[1],o[r++]=g?c[2]:0,f+=p}return r/3}function S(n){return!E(n,!1,!1)}var w;(function(n){n[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(w||(w={}));export{w as f,F as i,N as l};
