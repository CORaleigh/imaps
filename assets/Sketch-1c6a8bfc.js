import{S as ee,bc as te,bd as le,be as W,ag as J,bf as ne,bg as ie,bh as oe,b6 as ce,bi as ae,R as w,r as a,c as g,k as d,s as x,o as n,b8 as K,bj as re,bk as se,m as Q,p as f,bl as de,X as Z,a0 as O,b4 as ue,bm as he,bn as me,bo as X,bp as ye,b7 as pe,q as C,bq as Y}from"./index-056c54a4.js";import be from"./MapNotesLayer-3b2f5f8c.js";import"./objectIdUtils-789e911a.js";let B,V,M,j,m,q="",L=new ee({color:[255,0,0,.5],style:"solid",outline:{width:2,color:[255,0,0,1]}}),E=new te({width:1,color:[255,0,0,1],style:"solid",cap:"round",join:"round"}),T=new le({color:[255,0,0,1],haloColor:[255,255,255,1],haloSize:"1px",text:"",xoffset:3,yoffset:3,font:{size:10,family:"Aerial",weight:"bold"}}),P,v,p,S,k;const Se=async(e,t,i,l)=>{m=new be({listMode:"hide",id:"notes-layer"}),e.map.add(m),await e.whenLayerView(m),B=m.pointLayer,V=m.polylineLayer,M=m.polygonLayer,j=m.textLayer,v=N(B,e),p=N(V,e),S=N(M,e),S.activeFillSymbol=L,p.activeLineSymbol=E,k=N(j,e),[v,p,S,k].forEach(o=>{o==null||o.on("create",h=>{h.state==="cancel"&&o.activeTool!==null&&t("select")}),o==null||o.on("update",h=>{(h.state==="start"||h.state==="active")&&l([...h.graphics])})})},N=(e,t,i)=>{const l=new ce({view:t,layer:e,updateOnGraphicClick:!0});return l.on("create",fe),l},fe=e=>{e.state==="complete"&&(e.graphic.geometry.type==="polygon"&&(e.graphic.symbol=L,m.polygonLayer.add(e.graphic),S.create(e.tool)),e.graphic.geometry.type==="polyline"&&(e.graphic.symbol=E,m.polylineLayer.add(e.graphic),p.create(e.tool)),q==="text"&&(e.graphic.symbol=T,m.textLayer.add(e.graphic),k.create("point")),q==="point"&&(e.graphic.symbol=P,m.pointLayer.add(e.graphic),v.create("point")))},ge=()=>{try{v.updateOnGraphicClick=!0,S.updateOnGraphicClick=!0,p.updateOnGraphicClick=!0,k.updateOnGraphicClick=!0}catch{}},I=(e,t,i)=>{debugger;ge(),q=e,i(e===t?"":e),t===""&&D(),["polygon","rectangle","circle"].includes(e)&&S.create(e),["polyline"].includes(e)&&p.create(e),e==="text"&&p.create("point"),e==="point"&&p.create("point")};let H=!1;const Ce=async(e,t,i)=>{const l=document.getElementById("polygon-preview");l&&!H&&(L.color=e,L.outline.color=t,L.outline.width=i,S&&(S.activeFillSymbol=L,m.polygonLayer&&R(m.polygonLayer,L,S)),H=!0,l.innerHTML="",await W(L,{node:l,size:24}),H=!1)},R=(e,t,i)=>{if(i.updateGraphics.length){const l=i.updateGraphics.getItemAt(0);e.remove(l),l.symbol=t;const s=l.clone();e.add(s),setTimeout(()=>{i.cancel(),i.update(s)})}},ve=async(e,t,i)=>{const l=await J(`${e.url}${e.cimRef.replace(".","")}`);P=new ne({data:{type:"CIMSymbolReference",symbol:l==null?void 0:l.data}}),ie(P,t),oe(P,i),m.pointLayer&&R(m.pointLayer,P,v),v.pointSymbol=P;const s=document.getElementById("icon-preview");s&&(s.innerHTML="",W(P,{node:s,size:i}))},ke=(e,t)=>{E.color=e,E.width=t,p&&(p.polylineSymbol=E,p.updateGraphics.forEach(l=>{l.symbol=E}),m.polylineLayer&&R(m.polylineLayer,E,p));const i=document.getElementById("line-preview");i&&(i.innerHTML="",W(E,{node:i,size:t}))},xe=(e,t,i,l,s,o)=>{T.color=t,T.font.size=e,T.haloColor=l,T.haloSize=s?i:0,T.text=o,k.pointSymbol=T,m.textLayer&&R(m.textLayer,T,k)},D=()=>{v.cancel(),p.cancel(),S.cancel(),k.cancel(),v.updateOnGraphicClick=!1,S.updateOnGraphicClick=!1,p.updateOnGraphicClick=!1,k.updateOnGraphicClick=!1},we=(e,t)=>{e(""),t([]),v.cancel(),S.cancel(),p.cancel(),k.cancel(),m.polygonLayer.graphics.removeAll(),m.pointLayer.graphics.removeAll(),m.polylineLayer.graphics.removeAll(),m.textLayer.graphics.removeAll()},Te=(e,t)=>new Promise((i,l)=>{const s=[];e.forEach(h=>{const c=new ae({styleUrl:`${t}/${h}/data`,name:"Pins"});s.push(J(c.styleUrl))});const o=[];Promise.all(s).then(h=>{h.forEach(c=>{c.data.items.forEach(u=>{u.url=c.url.replace("data",""),o.push(u)})}),i(o)})}),Le=()=>{v.cancel(),S.cancel(),p.cancel(),k.cancel()},Ee=(e,t)=>{B.removeMany(e),M.removeMany(e),V.removeMany(e),j.removeMany(e),requestAnimationFrame(()=>{t(i=>[])})};function Ie(e){const t=a.useRef(null),i=a.useRef(null),[l,s]=a.useState(),[o,h]=a.useState(0);return a.useEffect(()=>{!l&&e.color&&(s(new g(e.color)),h((1-e.color[3])*100))},[e.color]),d("div",{id:e.id,children:[d(x,{children:[e.label," Color",n(K,{id:`${e.id}-popover-button`,width:"half",iconEnd:"pencil",kind:"neutral",appearance:"outline",children:n(re,{color:l==null?void 0:l.toHex()})})]}),n(se,{ref:t,overlayPositioning:"fixed",placement:"top-start",label:"",referenceElement:`${e.id}-popover-button`,children:d(Q,{heading:"Color",children:[n(f,{icon:"x",text:"",slot:"header-actions-end",onClick:()=>{t.current&&(t.current.open=!t.current.open);const c=new g(l);c.a=1-o/100,e.colorSet(c)}}),n(de,{ref:i,hideSaved:!0,hideHex:!0,hideChannels:!0,value:l?l.toHex():"#FF0000",onCalciteColorPickerInput:c=>s(new g(c.target.value))})]})}),!e.hideTransparency&&d(x,{children:[e.label," Transparency",d("div",{className:"slider-input",children:[n(Z,{max:100,min:0,value:o,onCalciteSliderInput:c=>{let u=c.target.value;u>100&&(u=100),u<0&&(u=0),h(u);const y=new g(l);y.a=1-o/100,e.colorSet(y)}}),n(O,{max:100,min:0,type:"number",numberButtonType:"none",suffixText:"%",value:o,onCalciteInputInput:c=>{let u=parseInt(c.target.value);u>100&&(u=100),u<0&&(u=0),h(u);const y=new g(l);y.a=1-o/100,e.colorSet(y)}})]})]})]})}const $=w.memo(Ie);function Pe(e){const[t,i]=a.useState();return a.useEffect(()=>{i(e.value)},[e.value]),d(x,{children:[e.label,d("div",{className:"slider-input",children:[n(Z,{max:e.max,min:e.min,value:t,onCalciteSliderInput:l=>{i(l.target.value),e.sizeSet(l.target.value)}}),n(O,{type:"number",numberButtonType:"none",min:e.min,max:e.max,value:t,suffixText:"px",onCalciteInputInput:l=>{i(parseFloat(l.target.value)),e.sizeSet(parseFloat(l.target.value))}})]})]})}const _=w.memo(Pe);function Oe(e){const[t,i]=a.useState(new g([255,0,0,1])),[l,s]=a.useState(2);return a.useEffect(()=>{t&&l&&e.polylineSymbolUpdated(t,l)},[t,l]),d("div",{id:"line-symbols",children:[n("div",{id:"line-preview",className:"preview"}),n($,{id:"line",label:"Line",color:t.toRgba(),colorSet:o=>{i(o),e.polylineSymbolUpdated(o,l)}}),n(_,{value:l,min:.1,max:18,label:"Width",sizeSet:o=>{s(o),e.polylineSymbolUpdated(t,l)}})]})}const $e=w.memo(Oe);function ze(e){const[t,i]=a.useState(new g([255,0,0,.5])),[l,s]=a.useState(new g([255,0,0,1])),[o,h]=a.useState(2);return a.useEffect(()=>{t&&l&&o&&e.polygonSymbolUpdated(t,l,o)},[t,l,o]),d("div",{id:"polygon-symbols",children:[n("div",{id:"polygon-preview",className:"preview"}),n($,{id:"polygon-fill",color:t.toRgba(),label:"Fill",colorSet:c=>{i(c),e.polygonSymbolUpdated(c,l,o)}}),n($,{id:"polygon-outline",color:l.toRgba(),label:"Outline",colorSet:c=>{s(c),e.polygonSymbolUpdated(t,c,o)}}),n(_,{label:"Outline Width",min:.1,max:18,value:o,sizeSet:c=>{h(c),e.polygonSymbolUpdated(t,l,o)}})]})}const Ue=w.memo(ze);function Fe(e){const[t,i]=a.useState(new g([255,0,0,1])),[l,s]=a.useState(10),[o,h]=a.useState(!1),[c,u]=a.useState(1),[y,z]=a.useState(new g([255,255,255,1])),[b,U]=a.useState("");return d("div",{id:"text-symbols",children:[d(x,{children:["Text",n(O,{type:"textarea",scale:"m",value:b,onCalciteInputInput:r=>{U(r.target.value),requestAnimationFrame(()=>{e.textSymbolUpdated(l,t,c,y,o,r.target.value)})},onCalciteInputChange:r=>{}})]}),n($,{id:"font",label:"Font",color:t.toRgba(),hideTransparency:!0,colorSet:r=>{i(r),e.textSymbolUpdated(l,r,c,y,o,b)}}),d(x,{children:["Font Size",n(O,{type:"number",min:5,max:125,value:l.toString(),onCalciteInputInput:r=>{s(parseFloat(r.target.value)),e.textSymbolUpdated(l,t,c,y,o,b)}})]}),d(x,{layout:"inline",children:["Halo",n(ue,{checked:o?!0:void 0,onCalciteSwitchChange:r=>{h(r.target.checked),e.textSymbolUpdated(l,t,c,y,o,b)}})]}),d("div",{id:"halo",hidden:o?void 0:!0,children:[n($,{id:"halo",label:"",color:y.toRgba(),hideTransparency:!0,colorSet:r=>{z(r),e.textSymbolUpdated(l,t,c,r,o,b)}}),d(x,{children:["Size",n(O,{type:"number",min:1,max:10,value:c.toString(),onCalciteInputInput:r=>{u(parseFloat(r.target.value)),e.textSymbolUpdated(l,t,c,y,o,b)}})]})]})]})}const Ge=w.memo(Fe);function Ae(e){return d("div",{id:"icon-picker",children:[n("div",{id:"icon-preview",className:"preview"}),n(x,{alignment:"start",scale:"m",layout:"default",children:n("button",{className:"change-symbol-trigger",type:"button",onClick:()=>{e.pickerClicked()},children:d("div",{className:"container",children:[e.symbol&&n("div",{className:"icon-symbol",children:n("img",{src:`${e.symbol.url}${e.symbol.thumbnail.href.replace(".","")}`,alt:e.symbol.title,width:50,height:50})}),n("div",{className:"icon-label",children:e.symbol.title}),n(he,{icon:"chevron-right"})]})})})]})}const Ne=w.memo(Ae);function Re(e){const[t,i]=a.useState([]);return a.useEffect(()=>{t&&e.symbols&&i(e.symbols)},[]),n("div",{id:"icon-selection",children:d(me,{children:[n(X,{}),n(X,{heading:"Change Symbol",onCalciteFlowItemBack:()=>{e.backClicked()},children:n(ye,{heading:"",children:n("div",{className:"palette",children:t&&t.map((l,s)=>n("img",{onClick:()=>{e.iconSelected(l),e.backClicked()},className:"item",alt:l.title,src:`${l.url}${l.thumbnail.href.replace(".","")}`},`icon-${s}`))})})})]})})}const He=w.memo(Re);function Be(e){const[t,i]=a.useState([]),[l,s]=a.useState(),[o,h]=a.useState(16),c="https://www.arcgis.com/sharing/rest/content/items/",u=["a63b3a4631ae41d4a1bc3ba6d9c85bfe","70ccf6bcbd304773a164be896e76edd3"],[y,z]=a.useState("main"),[b,U]=a.useState(new g([255,0,0,1]));return a.useEffect(()=>{Te(u,c).then(r=>{i(r),r.length&&(s(r[0]),e.pointSymbolUpdated(r[0],b,o))})},[]),n("div",{id:"point-symbols",children:t.length&&d("div",{children:[y==="main"&&d(Q,{children:[n(Ne,{pickerClicked:()=>z("icon"),symbol:l}),n($,{id:"point",label:"Point",color:b.toRgba(),colorSet:r=>{U(r),e.pointSymbolUpdated(l,r,o)}}),d(x,{children:["Size",n(O,{type:"number",min:6,max:72,value:o.toString(),onCalciteInputChange:r=>{h(parseFloat(r.target.value)),e.pointSymbolUpdated(l,b,parseFloat(r.target.value))}})]})]}),y==="icon"&&n(He,{iconSelected:r=>{s(r),e.pointSymbolUpdated(r,b,o)},backClicked:()=>z("main"),symbols:t})]})})}const Ve=w.memo(Be),Me={title:"Sketch Tips",tips:[{title:"Custom Symbols",text:"You can now specify custom symbols in the sketch tool by changing the fill color, outline color, size, etc. of your graphics."}]},je=e=>{const t=a.useRef(!1),[i,l]=a.useState(""),[s,o]=a.useState(!1),[h,c]=a.useState([]);a.useEffect(()=>{t.current||Se(e.view,l,h,c)},[]),a.useEffect(()=>{o(e.isActive),e.isActive?e.view.popup.autoOpenEnabled=!1:(e.toolDismissed(),D(),l(""),c([]))},[e.isActive]);const u=a.useCallback(()=>{e.toolDismissed(),D(),l(""),c([])},[]),y=a.useCallback(b=>{e.showTips(Me)},[]);return{activeSketchTool:i,setActiveSketchTool:l,selectedGraphics:h,setSelectedGraphics:c,isActive:s,toolDismissed:u,tipsClicked:y,checkGeometryType:(b,U)=>{const r=b.map(G=>{let A=G.geometry.type;return G.symbol.type==="text"&&(A="text"),A}),F=r.filter((G,A)=>r.indexOf(G)===A);if(F.length>1||F.length<1||b.length!==1)return!1;if(F.length===1&&F[0]===U)return!0}}};function qe(e){const{activeSketchTool:t,setActiveSketchTool:i,selectedGraphics:l,setSelectedGraphics:s,isActive:o,toolDismissed:h,tipsClicked:c,checkGeometryType:u}=je(e);return d(Q,{id:"sketch-panel",heading:"Sketch","data-panel":"sketch",hidden:!o,closed:o?void 0:!0,closable:!0,onCalcitePanelClose:h,children:[n(f,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:c}),n(f,{id:"collapseTool",icon:"chevron-up",text:"",slot:"header-actions-end",onClick:pe}),n(C,{closeOnClick:!0,label:"Show Tip",referenceElement:"tip",children:"Show Tip"}),n(C,{closeOnClick:!0,label:"Collapse",referenceElement:"collapseTool",children:"Collapse"}),d("div",{id:"sketch-tools",children:[d("div",{className:"sticky",children:[d(Y,{layout:"horizontal",children:[n(f,{id:"point",active:t==="point"?!0:void 0,icon:"pin",text:"",onClick:()=>I("point",t,i)}),n(C,{closeOnClick:!0,label:"Point",referenceElement:"point",children:"Point"}),n(f,{id:"line",active:t==="polyline"?!0:void 0,icon:"line",text:"",onClick:()=>I("polyline",t,i)}),n(C,{closeOnClick:!0,label:"Line",referenceElement:"line",children:"Line"}),n(f,{id:"polygon",active:t==="polygon"?!0:void 0,icon:"polygon",text:"",onClick:()=>I("polygon",t,i)}),n(C,{closeOnClick:!0,label:"Polygon",referenceElement:"polygon",children:"Polygon"}),n(f,{id:"rectangle",active:t==="rectangle"?!0:void 0,icon:"rectangle",text:"",onClick:()=>I("rectangle",t,i)}),n(C,{closeOnClick:!0,label:"Rectangle",referenceElement:"rectangle",children:"Rectangle"}),n(f,{id:"circle",active:t==="circle"?!0:void 0,icon:"circle",text:"",onClick:()=>I("circle",t,i)}),n(C,{closeOnClick:!0,label:"Circle",referenceElement:"circle",children:"Circle"}),n(f,{id:"text",active:t==="text"?!0:void 0,icon:"text",text:"",onClick:()=>I("text",t,i)}),n(C,{closeOnClick:!0,label:"Text",referenceElement:"text",children:"Text"})]}),d(Y,{layout:"horizontal",children:[n(f,{id:"selectSketch",icon:"cursor",text:"",active:t==="select"?!0:void 0,onClick:()=>{Le(),I("select",t,i),setTimeout(()=>{e.view.popup.autoOpenEnabled=!1},1e3)}}),n(C,{closeOnClick:!0,label:"Select Sketch",referenceElement:"selectSketch",children:"Select Sketch"}),n(f,{id:"clearSketch",icon:"trash",text:"",onClick:()=>we(i,s)}),n(C,{closeOnClick:!0,label:"Clear Sketches",referenceElement:"clearSketch",children:"Clear Sketches"})]})]}),n("div",{id:"point-symbols",className:"symbol",hidden:t==="point"||u(l,"point")&&t==="select"?void 0:!0,children:n(Ve,{pointSymbolUpdated:ve})}),n("div",{id:"line-symbols",className:"symbol",hidden:t==="polyline"||u(l,"polyline")&&t==="select"?void 0:!0,children:n($e,{polylineSymbolUpdated:ke})}),n("div",{id:"polygon-symbols",className:"symbol",hidden:["polygon","rectangle","circle"].includes(t)||u(l,"polygon")&&t==="select"?void 0:!0,children:n(Ue,{polygonSymbolUpdated:Ce})}),n("div",{id:"text-symbols",className:"symbol",hidden:t==="text"||u(l,"text")&&t==="select"?void 0:!0,children:n(Ge,{textSymbolUpdated:xe})}),l.length>0&&d(K,{onClick:()=>Ee(l,s),alignment:"center",kind:"danger",appearance:"transparent","icon-end":"trash",children:[l.length," ",l.length>1?"features":"feature"]})]})]})}const Xe=w.memo(qe);export{Xe as default};
