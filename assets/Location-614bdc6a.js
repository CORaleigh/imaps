import{e as p,b as E,l as x,y as g,f as $,a as j,d as k,g as w,n as A,S as D,c as C,h as G,H as M,i as O,j as N,C as z,r as i,R as F,k as v,m as P,o as d,p as q,q as B,s as H,t as J,u as K}from"./index-056c54a4.js";let u=class extends x{constructor(e){super(e),this.addresses=null,this.categories=null,this.countryCode=null,this.locationType=null,this.outSpatialReference=null}};p([g({type:[Object],json:{read:{reader:e=>e&&e.records?e.records.map(t=>t.attributes):null},write:{writer:(e,t)=>{const r=[];Array.isArray(e)&&e.forEach(a=>{r.push({attributes:a})}),t.addresses={records:r}}}}})],u.prototype,"addresses",void 0),p([g({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],u.prototype,"categories",void 0),p([g({type:String,json:{read:{source:"sourceCountry"},write:{target:"sourceCountry"}}})],u.prototype,"countryCode",void 0),p([g({type:String,json:{write:!0}})],u.prototype,"locationType",void 0),p([g({type:$,json:{read:{source:"outSR"},write:{target:"outSR"}}})],u.prototype,"outSpatialReference",void 0),u=p([j("esri.rest.support.AddressesToLocationsParameters")],u),u.from=E(u);const Q=async(e,t)=>{const r=[],a=await V();r.push(a);const c=await U();r.push(c);const n=new G({view:e,maxSuggestions:30,searchAllEnabled:!0,popupEnabled:!1,container:t,goToOverride:(s,o)=>{s.goTo({target:o.target.target,zoom:17},{duration:1e3,easing:"ease"})}});return n.sources.addMany(r),n.allSources.on("after-add",s=>{if(s.item.layer){const o=s.item;o.name=s.item.layer.title,o.placeholder=s.item.layer.title}s.item.name.includes("World Geocoding")&&n.allSources.remove(s.item)}),n},U=async()=>{const e=new M({portalItem:{id:"edb2153e06c2477995f95b27e5c24661"},title:"Intersection",layerId:0});return await e.load(),new O({name:"Intersection",placeholder:"Enter first street name",layer:e,autoNavigate:!1,resultGraphicEnabled:!1})},V=()=>new N({name:"Street Address",placeholder:"Enter an address",url:"https://maps.raleighnc.gov/arcgis/rest/services/Locators/Locator/GeocodeServer",autoNavigate:!0,resultSymbol:new A({url:"assets/pin.svg",height:36,width:36})}),W=(e,t,r,a,c,n)=>{e.on("search-complete",async s=>{if(n.graphic=null,c(s.searchTerm),r(s.results[0].source.name==="Intersection"),s.results[0].source.name==="Intersection"){const o=await s.results[0].source.layer.queryFeatures({geometry:s.results[0].results[0].feature.geometry,returnGeometry:!1,outFields:["CARTONAME"],orderByFields:["CARTONAME"]});a(o.features.map(l=>l.getAttribute("CARTONAME")))}else{L(e.view);const o=[];s.results[0].results.forEach(l=>{T(e.view,l.feature.geometry),o.push(l.feature),n.graphic=l.feature})}})},X=async(e,t,r)=>{const a=`${e} & ${t}`,c=await k("https://maps.raleighnc.gov/arcgis/rest/services/Locators/Locator/GeocodeServer",{address:{outSpatialReference:r.spatialReference,SingleLine:a}});c.length&&(L(r),T(r,c[0].location),r.goTo({target:c[0].location,zoom:17},{duration:1e3,easing:"ease"}))},T=(e,t)=>{t.type==="point"?e.graphics.add(new w({geometry:t,attributes:{type:"location"},symbol:new A({url:"assets/pin.svg",height:36,width:36})})):e.graphics.add(new w({geometry:t,attributes:{type:"location"},symbol:new D({color:new C([0,255,255,.25]),outline:{color:new C([0,255,255,1]),width:2}})}))},L=e=>{e.graphics.removeMany(e.graphics.filter(t=>t.getAttribute("type")==="location"))},Y=(e,t)=>new z({view:e,container:t});const Z={title:"Location Search Tips",tips:[{title:"Search By Place",text:"Search for places of interest such as schools and parks by typing the name of the school or park you are looking for."}]},_=e=>{const t=i.useRef(null),r=i.useRef(null),a=i.useRef(!1),c=i.useRef(),n=i.useRef(),[s,o]=i.useState(!1),[l,y]=i.useState([]),[h,S]=i.useState(""),[b,f]=i.useState(!1);i.useEffect(()=>{!a.current&&t.current&&(a.current=!0,Q(e.view,t.current).then(m=>{c.current=m,W(m,e.view,o,y,S,n.current)}),n.current=Y(e.view,r.current))}),i.useEffect(()=>{f(e.isActive)},[e.isActive]);const I=i.useCallback(m=>{e.panelDismissed()},[]),R=i.useCallback(m=>{e.showTips(Z)},[]);return{searchDiv:t,featureDiv:r,search:c,isIntersection:s,intersections:l,searchTerm:h,isActive:b,panelDismissed:I,tipsClicked:R}},ee=e=>{const{searchDiv:t,featureDiv:r,search:a,isIntersection:c,intersections:n,searchTerm:s,isActive:o,panelDismissed:l,tipsClicked:y}=_(e);return v(P,{id:"location-panel",heading:"Location Search",hidden:!o,closed:o?void 0:!0,closable:!0,onCalcitePanelClose:l,children:[d(q,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:y}),d(B,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),v("div",{id:"location-search",children:[d("div",{ref:t}),c&&d("div",{id:"intersection-search",children:v(H,{children:["Intersections",d(J,{label:"",selectionMode:"single",scale:"l",children:n.map((h,S)=>d(K,{textLabel:h,value:h,onCalciteComboboxItemChange:b=>{var f;b.target.selected&&X(h,s,(f=a==null?void 0:a.current)==null?void 0:f.view)}},S))})]})}),d("div",{id:"location-feature",ref:r})]})]})},se=F.memo(ee);export{se as default};
