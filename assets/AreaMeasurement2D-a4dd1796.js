import{e as n,y as m,a as C,b5 as J,cn as K,ie as he,z as T,D as z,a7 as G,aV as pe,ai as P,a2 as de,g as x,S as ve,bc as ye,bd as _e,qB as we,c2 as Q,dm as X,gz as V,qC as M,bW as w,f as q,a$ as ge,gE as I,gd as U,gg as Y,gj as Z,gu as be,gp as fe,gq as $e,gl as Me,x as Le,aw as F,J as S,at as Se,b9 as W,aN as Ae,aW as De,N as ee,P as te,W as ke,A as p,qD as qe,bb as Oe}from"./index-056c54a4.js";import{e as Te}from"./Measure-c1bb6472.js";import{i as E,c as xe,s as Ge}from"./analysisThemeUtils-87c5d5ce.js";import{geodesicDensify as R,planarLength as se,simplify as D,geodesicLength as Ie,geodesicArea as Ue,planarArea as We}from"./geometryEngine-d3b24b56.js";import{l as Re}from"./Draw-69394f5f.js";import{p as ze,x as Ve,v as Ee,E as Ce}from"./SnappingDragPipelineStep-53254785.js";import{j as je}from"./GraphicManipulator-a454be56.js";import{v as Ne}from"./InteractiveToolViewModel-fe6f77c2.js";import"./getDefaultUnitForView-7806ca44.js";import"./colorUtils-14347c9c.js";import"./geometryEngineBase-e1a33b0a.js";import"./hydrated-e67bc681.js";import"./SnappingVisualizer2D-5966049f.js";import"./enums-55085e26.js";import"./settings-f7d68114.js";import"./SnappingContext-ecb67583.js";import"./PointSnappingHint-f32d61d8.js";import"./plane-163fe497.js";import"./sphere-3ae2d2df.js";import"./mat3f64-221ce671.js";import"./mat4f64-65d35099.js";import"./quatf64-3363c48e.js";import"./SnappingOperation-470d0ac7.js";import"./drawSurfaces-e8a20056.js";import"./quat-b06529da.js";import"./hydratedFeatures-cb62cc9c.js";import"./drawUtils-b49928b5.js";import"./drapedUtils-476a1deb.js";const g=1e5;let b=class extends ze{constructor(t){super(t),this._drawActive=!1,this._measurementLayer=new J({internal:!0,listMode:"hide",visible:!1}),this._manipulatorLayer=new J({internal:!0,listMode:"hide",visible:!1}),this._vertices=[],this.geodesicDistanceThreshold=1e5,this.measurement=null,this.measurementLabel=null}initialize(){K("esri/core/t9n/Units").then(e=>{this.messages=e}),this.addHandles(he(async()=>{this.messages=await K("esri/core/t9n/Units")}));const t=this.view;this._draw=new Re({view:t}),t.map.addMany([this._measurementLayer,this._manipulatorLayer]),t.focus(),this.addHandles(T(()=>[this.unit,this.geodesicDistanceThreshold,this.messages],()=>{this._updateGraphics()},z))}destroy(){const{map:t}=this.view;this._draw.view=null,this._draw=G(this._draw),t.removeMany([this._measurementLayer,this._manipulatorLayer]),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._measurementLayer=G(this._measurementLayer),this._manipulatorLayer=G(this._manipulatorLayer),this._resetVertices()}get cursor(){return this._drawActive?"crosshair":null}set editable(t){this._set("editable",t),t||this._draw.reset()}onActivate(){this._drawActive||this._vertices.length!==0||this._startSketch()}onShow(){this._measurementLayer.visible=!0,this._manipulatorLayer.visible=!0}onHide(){this._measurementLayer.visible=!1,this._manipulatorLayer.visible=!1}reset(){this.manipulators.removeAll(),this._resetVertices(),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1}_resetVertices(){for(const{handle:t}of this._vertices)t.remove();this._vertices=[]}_startSketch(){this._drawActive=!0;const t=this._draw.create("polyline",{mode:"click"});t.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],e=>this._updateSketch(e.vertices)),t.on("draw-complete",()=>this._stopSketch())}_stopSketch(){if(this._vertices.length<3)return this.reset(),void this._startSketch();this.manipulators.forEach(({manipulator:t})=>{t.interactive=!0}),this._drawActive=!1,this.finishToolCreation()}_updateSketch(t){const e=this.view.spatialReference;if(e&&(!ie(e)||pe())){for(;this._vertices.length>t.length;){const{handle:r,manipulator:i}=this._vertices.pop();r.remove(),this.manipulators.remove(i)}for(let r=this._vertices.length;r<t.length;r++){const[i,u]=t[r],a=Be(new P({x:i,y:u,spatialReference:e}),this.view,this._manipulatorLayer);this.manipulators.add(a);const o=Ve(a,(l,s)=>{s.next(Ee(this.view)).next(Ce(l.graphic,de.Local)).next(()=>{const h=l.graphic.geometry;this._vertices[r].coord=[h.x,h.y],this._updateGraphics()})});this._vertices.push({manipulator:a,coord:[i,u],handle:o})}if(this._vertices.length){const r=this._vertices.length-1,i=this._vertices[r],[u,a]=t[r];i.coord[0]===u&&i.coord[1]===a||(i.coord=[u,a],i.manipulator.graphic.geometry=new P({x:u,y:a,spatialReference:e}));const o=this._drawActive?this._vertices[r].manipulator:null;this.manipulators.forEach(({manipulator:l})=>{l.interactive=o==null||l!==o})}this._updateGraphics()}}_updateGraphics(){if(this._vertices.length<2)return void this._measurementLayer.removeAll();const t=He(this._vertices.map(({coord:h})=>h),this.view.spatialReference,this.geodesicDistanceThreshold);if(!t)return;const{measurement:e,fillGeometry:r,outlineGeometry:i}=t;this._set("measurement",e);const u=e?Ke(this.messages,e,this.unit):null;if(this._set("measurementLabel",u),!r&&!i)return;let a,o,l;const{graphics:s}=this._measurementLayer;s.length===3?(a=s.at(0),o=s.at(1),l=s.at(2)):(a=new x({symbol:new ve({color:E(.3),outline:null})}),o=new x({symbol:new ye({color:E(),width:2})}),l=new x({symbol:new _e({color:xe(),font:new we({size:14,family:"sans-serif"}),haloColor:Ge(.5),haloSize:2})}),s.removeAll(),s.addMany([a,o,l])),a.geometry=r,o.geometry=i,l.geometry=r==null?void 0:r.centroid,l.symbol.text=(u==null?void 0:u.area)??""}};function Be(t,e,r){const u={style:"circle",color:E(.5),outline:{type:"simple-line",width:0}},a=new Q({...u,size:8}),o=new Q({...u,size:1.5*8}),l=new x({geometry:t,symbol:a});return new je({view:e,layer:r,graphic:l,focusedSymbol:o})}function He(t,e,r){if(t.length===2){const h=new X({paths:t,spatialReference:e});let y;if(e!=null&&e.isGeographic)if(V(e))y=M(h,g);else{const _=w(h,q.WGS84),v=M(_,g);y=w(v,e)}else if(e!=null&&e.isWebMercator)y=R(h,g,"meters");else if(se(h,"meters")>=r){const _=w(h,q.WGS84),v=M(_,g);y=w(v,e)}else y=h;return{measurement:null,fillGeometry:null,outlineGeometry:y}}t.push(t[0]);const i=new X({paths:[t],spatialReference:e}),u=new ge({rings:[t],spatialReference:e});let a,o,l=null,s=null;if(e!=null&&e.isGeographic)if(V(e)){if(l=M(i,g),s=M(u,g),s=D(s),!s)return null;a=I([i],"meters")[0],o=U([s],"square-meters")[0]}else{const h=q.WGS84,y=w(i,h),_=w(u,h);if(l=M(y,g),s=M(_,g),s=D(s),!s)return null;a=I([y],"meters")[0],o=U([s],"square-meters")[0],l=w(l,e),s=w(s,e)}else if(e!=null&&e.isWebMercator){if(l=R(i,g,"meters"),s=R(u,g,"meters"),s=D(s),!s)return null;a=Ie(i,"meters"),o=Ue(s,"square-meters")}else{const h=se(i,"meters");if(h>=r){const y=q.WGS84,_=w(i,y),v=w(u,y);if(l=M(_,g),s=M(v,g),s=D(s),!s)return null;a=I([_],"meters")[0],o=U([s],"square-meters")[0],l=w(l,e),s=w(s,e)}else{if(l=i,s=D(u),!s)return null;a=h,o=We(s,"square-meters")}}return{measurement:{geometry:s,area:o,perimeter:a},fillGeometry:s,outlineGeometry:l}}function Je(t){return t!=null}function ie(t){if(!t)return!1;const{isGeographic:e,isWebMercator:r,isWGS84:i}=t;return e&&!i&&!V(t)||!e&&!r}function Ke(t,e,r){if(!e||!t)return null;const i={area:null,perimeter:null},{area:u,perimeter:a}=e;switch(r){case"metric":i.area=fe(t,u,"square-meters");break;case"imperial":i.area=be(t,u,"square-meters");break;default:{const l=Y(u,"square-meters",r);i.area=Z(t,l,r);break}}const o=Pe(r);if(o)switch(o){case"metric":i.perimeter=Me(t,a,"meters");break;case"imperial":i.perimeter=$e(t,a,"meters");break;default:{const l=Y(a,"meters",o);i.perimeter=Z(t,l,o);break}}else i.perimeter="";return i}function Pe(t){switch(t){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";default:return null}}n([m()],b.prototype,"_drawActive",void 0),n([m({readOnly:!0})],b.prototype,"cursor",null),n([m({value:!0})],b.prototype,"editable",null),n([m({type:Number})],b.prototype,"geodesicDistanceThreshold",void 0),n([m({readOnly:!0})],b.prototype,"measurement",void 0),n([m({readOnly:!0})],b.prototype,"measurementLabel",void 0),n([m()],b.prototype,"messages",void 0),n([m()],b.prototype,"unit",void 0),n([m({constructOnly:!0})],b.prototype,"view",void 0),b=n([C("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],b);let f=class extends Ne{constructor(e){super(e),this.supportedViewType="2d",this.unsupportedErrorMessage="AreaMeasurement2DViewModel is only supported in 2D views.",this._handles=new Le,this.geodesicDistanceThreshold=1e5}initialize(){this._handles.add([T(()=>{var e;return(e=F(this.view))==null?void 0:e.spatialReference},()=>this.clear()),T(()=>this.unit,e=>{S(this.tool)&&(this.tool.unit=e)},z),T(()=>this.geodesicDistanceThreshold,e=>{S(this.tool)&&(this.tool.geodesicDistanceThreshold=e)},z)])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get measurement(){return S(this.tool)?this.tool.measurement:null}get measurementLabel(){return S(this.tool)?this.tool.measurementLabel:null}get state(){return this.disabled||Se(this.view)||!Je(this.view.spatialReference)?"disabled":S(this.tool)&&this.tool.measurement?this.tool.active?"measuring":"measured":"ready"}get unit(){return this._validateUnit(this.defaultUnit)}set unit(e){this._overrideIfSome("unit",this._validateUnit(e))}get unitOptions(){return W}set unitOptions(e){this._overrideIfSome("unitOptions",this._validateUnits(e))}async start(){const e=this.view;S(e)&&(await Ae(()=>e.ready),ie(e.spatialReference)&&await De()),this.createTool({interactive:!0})}clear(){this.removeTool()}constructTool(){return new b({view:F(this.view),visible:this.visible,geodesicDistanceThreshold:this.geodesicDistanceThreshold,unit:this.unit})}_validateUnit(e){return this.unitOptions.includes(e)?e:this.unitOptions.includes(this.defaultUnit)?this.defaultUnit:this.unitOptions[0]}_validateUnits(e=[]){const r=e.filter(i=>W.includes(i));return r.length===0?W.slice():r}};n([m(Te)],f.prototype,"defaultUnit",void 0),n([m({type:Number})],f.prototype,"geodesicDistanceThreshold",void 0),n([m({readOnly:!0})],f.prototype,"measurement",null),n([m({readOnly:!0})],f.prototype,"measurementLabel",null),n([m({readOnly:!0})],f.prototype,"state",null),n([m({type:String})],f.prototype,"unit",null),n([m({type:[String]})],f.prototype,"unitOptions",null),f=n([C("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel")],f);const re=f,$="esri-area-measurement-2d",O=`${$}__units`,k=`${$}__measurement`,c={buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-measure-area",base:`${$} esri-widget esri-widget--panel`,container:`${$}__container`,hint:`${$}__hint`,hintText:`${$}__hint-text`,panelError:`${$}__panel--error`,measurement:k,measurementItem:`${k}-item`,measurementItemDisabled:`${k}-item--disabled`,measurementItemTitle:`${k}-item-title`,measurementItemValue:`${k}-item-value`,settings:`${$}__settings`,units:O,unitsLabel:`${O}-label`,unitsSelect:`${O}-select esri-select`,unitsSelectWrapper:`${O}-select-wrapper`,actionSection:`${$}__actions`,newMeasurementButton:`${$}__clear-button esri-button esri-button--primary`};let d=class extends ke{constructor(t,e){super(t,e),this.iconClass=c.widgetIcon,this.messages=null,this.messagesUnits=null,this.viewModel=new re}get active(){return this.viewModel.active}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get unit(){return this.viewModel.unit}set unit(t){this.viewModel.unit=t}get unitOptions(){return this.viewModel.unitOptions}set unitOptions(t){this.viewModel.unitOptions=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}get visible(){return this.viewModel.visible}set visible(t){this.viewModel.visible=t}render(){const{id:t,viewModel:e,visible:r}=this,{active:i,supported:u,measurementLabel:a,state:o,unit:l,unitOptions:s}=e,h=o==="disabled",y=o==="ready",_=o==="measuring"||o==="measured",{messages:v,messagesUnits:j}=this,ae=i&&y?p("section",{key:"hint",class:c.hint},p("p",{class:c.hintText},v.hint)):null,ne=u?null:p("section",{key:"unsupported",class:c.panelError},p("p",null,v.unsupported)),N=(L,A,H)=>A?p("div",{key:`${H}-enabled`,class:c.measurementItem},p("span",{class:c.measurementItemTitle},L),p("span",{"aria-live":"polite",class:c.measurementItemValue},A)):p("div",{key:`${H}-disabled`,class:this.classes(c.measurementItem,c.measurementItemDisabled),"aria-disabled":"true"},p("span",{class:c.measurementItemTitle},L)),le=_?p("section",{key:"measurement",class:c.measurement},N(v.area,a==null?void 0:a.area,"area"),N(v.perimeter,a==null?void 0:a.perimeter,"perimeter")):null,B=`${t}__units`,oe=p("section",{key:"units",class:c.units},p("label",{class:c.unitsLabel,for:B},v.unit),p("div",{class:c.unitsSelectWrapper},p("select",{class:c.unitsSelect,id:B,onchange:this._changeUnit,bind:this,value:l},s.map(L=>{var A;return p("option",{key:L,value:L},qe(L)?j.systems[L]:(A=j.units[L])==null?void 0:A.pluralCapitalized)})))),ue=_?p("div",{key:"settings",class:c.settings},oe):null,me=!u||i&&!_?null:p("div",{class:c.actionSection},p("button",{"aria-label":v.newMeasurement,bind:this,class:this.classes(c.newMeasurementButton,h&&c.buttonDisabled),disabled:h,onclick:this._newMeasurement,title:v.newMeasurement,type:"button"},v.newMeasurement)),ce=r?p("div",{class:c.container},ne,ae,ue,le,me):null;return p("div",{"aria-label":v.widgetLabel,class:c.base,role:"region"},ce)}_newMeasurement(){Oe(this.viewModel.start())}_changeUnit(t){const e=t.target,r=e.options[e.selectedIndex];r&&(this.viewModel.unit=r.value)}};n([m({readOnly:!0})],d.prototype,"active",null),n([m()],d.prototype,"iconClass",void 0),n([m()],d.prototype,"label",null),n([m(),ee("esri/widgets/AreaMeasurement2D/t9n/AreaMeasurement2D")],d.prototype,"messages",void 0),n([m(),ee("esri/core/t9n/Units")],d.prototype,"messagesUnits",void 0),n([m()],d.prototype,"uiStrings",void 0),n([m()],d.prototype,"unit",null),n([m()],d.prototype,"unitOptions",null),n([m()],d.prototype,"view",null),n([m({type:re})],d.prototype,"viewModel",void 0),n([m({type:Boolean})],d.prototype,"visible",null),n([te()],d.prototype,"_newMeasurement",null),n([te()],d.prototype,"_changeUnit",null),d=n([C("esri.widgets.AreaMeasurement2D")],d);const Lt=d;export{Lt as default};
