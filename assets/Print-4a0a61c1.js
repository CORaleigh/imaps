import{e as d,b as Ye,L as we,y as b,f as ge,ar as ve,a as z,l as q,bA as B,bB as Je,bC as Ce,bD as be,bE as Qe,bF as Xe,bG as J,ag as k,bH as et,_ as tt,a9 as at,ab as Le,bI as rt,bJ as U,bK as it,bL as st,bM as lt,bN as nt,bO as Oe,J as X,bP as ot,a$ as ut,bQ as ct,bR as ee,bS as pt,bT as dt,bU as Se,bV as re,ae as yt,ah as mt,b5 as ft,aW as ht,bW as gt,g as bt,r as L,R as St,k as M,m as xt,o as C,p as Me,b7 as Tt,q as De,s as F,a0 as Ne,bX as pe,bY as de,bZ as wt,b_ as Ee,b$ as ye,b8 as $e,c0 as vt,c1 as Pt}from"./index-056c54a4.js";import{o as It}from"./floorFilterUtils-080a7cd2.js";import{a as je}from"./GPMessage-992ebbbd.js";let $=class extends we{constructor(){super(...arguments),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}};d([b({type:ge})],$.prototype,"outSpatialReference",void 0),d([b({type:ve})],$.prototype,"processExtent",void 0),d([b({type:ge})],$.prototype,"processSpatialReference",void 0),d([b({nonNullable:!0})],$.prototype,"returnFeatureCollection",void 0),d([b({nonNullable:!0})],$.prototype,"returnM",void 0),d([b({nonNullable:!0})],$.prototype,"returnZ",void 0),$=d([z("esri.rest.geoprocessor.GPOptions")],$),$.from=Ye($);const Pe=$;let _=class extends q{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};d([b({type:ve})],_.prototype,"extent",void 0),d([b()],_.prototype,"height",void 0),d([b()],_.prototype,"href",void 0),d([b()],_.prototype,"opacity",void 0),d([b()],_.prototype,"rotation",void 0),d([b()],_.prototype,"scale",void 0),d([b()],_.prototype,"visible",void 0),d([b()],_.prototype,"width",void 0),_=d([z("esri.layer.support.MapImage")],_);const _e=_;let W=class extends q{constructor(a){super(a),this.itemId=null,this.url=null}};d([b({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],W.prototype,"itemId",void 0),d([b({type:String,json:{write:!0}})],W.prototype,"url",void 0),W=d([z("esri.rest.support.DataFile")],W);const me=W,Fe=new B({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let Z=class extends q{constructor(a){super(a),this.distance=0,this.units=null}};d([b({json:{write:!0}})],Z.prototype,"distance",void 0),d([b({json:{read:Fe.read,write:Fe.write}})],Z.prototype,"units",void 0),Z=d([z("esri.rest.support.LinearUnit")],Z);const Ge=Z,Ct=new B({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"});let Y=class extends q{constructor(a){super(a),this.dataType=null,this.value=null}};d([Je(Ct,{ignoreUnknown:!1})],Y.prototype,"dataType",void 0),d([b()],Y.prototype,"value",void 0),Y=d([z("esri.rest.support.ParameterValue")],Y);const Lt=Y;let j=class extends q{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};d([b()],j.prototype,"format",void 0),d([b({json:{read:{source:"itemID"},write:{target:"itemID"}}})],j.prototype,"itemId",void 0),d([b()],j.prototype,"url",void 0),j=d([z("esri.rest.support.RasterData")],j);const Ae=j;async function He(e,a,t,r,i){const s={},n={},u=[];return Ot(r,u,s),Xe(u).then(l=>{const{outSpatialReference:o,processExtent:y,processSpatialReference:c,returnFeatureCollection:m,returnM:x,returnZ:p}=t,{path:g}=J(e);for(const P in s){const T=s[P];n[P]=l.slice(T[0],T[1])}const w=o?o.wkid||o:null,v=c?c.wkid||c:null,f=a==="execute"?{returnFeatureCollection:m||void 0,returnM:x||void 0,returnZ:p||void 0}:null,h=ne({...y?{context:{extent:y,outSR:w,processSR:v}}:{"env:outSR":w,"env:processSR":v},...r,...f,f:"json"},null,n),I={...i,query:h};return k(`${g}/${a}`,I)})}function Ot(e,a,t){for(const r in e){const i=e[r];if(i&&typeof i=="object"&&i instanceof be){const{features:s}=i;t[r]=[a.length,a.length+s.length],s.forEach(n=>{a.push(n.geometry)})}}}function xe(e){const a=e.dataType,t=Lt.fromJSON(e);switch(a){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return t;case"GPDate":t.value=new Date(t.value);break;case"GPDataFile":t.value=me.fromJSON(t.value);break;case"GPLinearUnit":t.value=Ge.fromJSON(t.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const r=e.value.url;t.value=r?me.fromJSON(t.value):be.fromJSON(t.value);break}case"GPRasterData":case"GPRasterDataLayer":{const r=e.value.mapImage;t.value=r?_e.fromJSON(r):Ae.fromJSON(t.value);break}case"GPField":t.value=Ce.fromJSON(t.value);break;case"GPMultiValue:GPDate":{const r=t.value;t.value=r.map(i=>new Date(i));break}case"GPMultiValue:GPDataFile":t.value=t.value.map(r=>me.fromJSON(r));break;case"GPMultiValue:GPLinearUnit":t.value=t.value.map(r=>Ge.fromJSON(r));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":t.value=t.value.map(r=>be.fromJSON(r));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":t.value=t.value.map(r=>r?_e.fromJSON(r):Ae.fromJSON(t.value));break;case"GPMultiValue:GPField":t.value=t.value.map(r=>Ce.fromJSON(r))}return t}function ne(e,a,t){for(const r in e){const i=e[r];Array.isArray(i)?e[r]=JSON.stringify(i.map(s=>ne({item:s},!0).item)):i instanceof Date&&(e[r]=i.getTime())}return Qe(e,a,t)}async function Mt(e,a,t,r){return t=Pe.from(t||{}),He(e,"execute",t,a??{},r).then(i=>{const s=i.data.results||[],n=i.data.messages||[];return{results:s.map(xe),messages:n.map(u=>je.fromJSON(u))}})}var ie;const Dt=et()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let G=ie=class extends q{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:a,sourceUrl:t}=this,{path:r}=J(t),i={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const s=`${r}/jobs/${a}/cancel`,{data:n}=await k(s,i),{messages:u,jobStatus:l,progress:o}=ie.fromJSON(n);return this.set({messages:u,jobStatus:l,progress:o}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:a}=J(this.sourceUrl),t={...this.requestOptions,...e,query:{f:"json"}},r=`${a}/jobs/${this.jobId}`,{data:i}=await k(r,t),{messages:s,jobStatus:n,progress:u}=ie.fromJSON(i);return this.set({messages:s,jobStatus:n,progress:u}),this}async fetchResultData(e,a,t){a=Pe.from(a||{});const{returnFeatureCollection:r,returnM:i,returnZ:s,outSpatialReference:n}=a,{path:u}=J(this.sourceUrl),l=ne({returnFeatureCollection:r,returnM:i,returnZ:s,outSR:n,returnType:"data",f:"json"},null),o={...this.requestOptions,...t,query:l},y=`${u}/jobs/${this.jobId}/results/${e}`,{data:c}=await k(y,o);return xe(c)}async fetchResultImage(e,a,t){const{path:r}=J(this.sourceUrl),i={...a.toJSON(),f:"json"},s=ne(i),n={...this.requestOptions,...t,query:s},u=`${r}/jobs/${this.jobId}/results/${e}`,{data:l}=await k(u,n);return xe(l)}async fetchResultMapImageLayer(){const{path:e}=J(this.sourceUrl),a=e.indexOf("/GPServer/"),t=`${e.substring(0,a)}/MapServer/jobs/${this.jobId}`;return new(await tt(()=>import("./MapImageLayer-717f938a.js"),["assets/MapImageLayer-717f938a.js","assets/index-056c54a4.js","assets/index-0be7f32f.css","assets/SublayersOwner-c4e1a28b.js","assets/QueryTask-db764d68.js","assets/executeForIds-34d9b873.js","assets/sublayerUtils-01d185f7.js","assets/ExportImageParameters-1aee1bfb.js","assets/floorFilterUtils-080a7cd2.js","assets/imageBitmapUtils-5d5c16ff.js"])).default({url:t})}async waitForJobCompletion(e={}){const{interval:a=1e3,signal:t,statusCallback:r}=e;return new Promise((i,s)=>{at(t,()=>{this._clearTimer(),s(Le())}),this._clearTimer();const n=setInterval(()=>{this._timer||s(Le()),this.checkJobStatus(this.requestOptions).then(u=>{const{jobStatus:l}=u;switch(this.jobStatus=l,l){case"job-succeeded":this._clearTimer(),i(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":r&&r(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),s(this)}})},a);this._timer=n})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};d([b()],G.prototype,"jobId",void 0),d([Je(Dt,{ignoreUnknown:!1})],G.prototype,"jobStatus",void 0),d([b({type:[je]})],G.prototype,"messages",void 0),d([b()],G.prototype,"progress",void 0),d([b()],G.prototype,"requestOptions",void 0),d([b({json:{write:!0}})],G.prototype,"sourceUrl",void 0),G=ie=d([z("esri.rest.support.JobInfo")],G);const Nt=G;async function Et(e,a,t,r){return t=Pe.from(t||{}),He(e,"submitJob",t,a??{},r).then(i=>{const s=Nt.fromJSON(i.data);return s.sourceUrl=e,s})}const oe=new B({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"});oe.fromJSON.bind(oe);const $t=oe.toJSON.bind(oe),ue=new B({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"});ue.fromJSON.bind(ue);const _t=ue.toJSON.bind(ue),fe="simple-marker",Ft="picture-marker",Ve="simple-line",Gt="simple-fill",At="shield-label-symbol",Vt="text";function zt(e,a){const{graphic:t,renderer:r,symbol:i}=a,s=i.type;if(s===Vt||s===At||!("visualVariables"in r)||!r.visualVariables)return;const n=r.getVisualVariablesForType("size"),u=r.getVisualVariablesForType("color"),l=r.getVisualVariablesForType("opacity"),o=r.getVisualVariablesForType("rotation"),y=n[0],c=u[0],m=l[0],x=o[0];if(y){const p=s===fe?i.style:null,g=rt(y,t,{shape:p});g!=null&&(s===fe?e.size=U(g):s===Ft?(e.width=U(g),e.height=U(g)):s===Ve?e.width=U(g):e.outline&&(e.outline.width=U(g)))}if(c){const p=it(c,t);(p&&s===fe||s===Ve||s===Gt)&&(e.color=p?p.toJSON():void 0)}if(m){const p=st(m,t);p!=null&&e.color&&(e.color[3]=Math.round(255*p))}x&&(e.angle=-lt(r,t))}function Rt(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function kt(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function ze(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function Ut(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function Jt(e,a=15){const t=e.canvas.width,r=e.canvas.height,i=e.getImageData(0,0,t,r).data;let s,n,u,l,o,y;e:for(n=r;n--;)for(s=t;s--;)if(i[4*(t*n+s)+3]>a){y=n;break e}if(!y)return null;e:for(s=t;s--;)for(n=y+1;n--;)if(i[4*(t*n+s)+3]>a){o=s;break e}e:for(s=0;s<=o;++s)for(n=y+1;n--;)if(i[4*(t*n+s)+3]>a){u=s;break e}e:for(n=0;n<=y;++n)for(s=u;s<=o;++s)if(i[4*(t*n+s)+3]>a){l=n;break e}return{x:u,y:l,width:o-u,height:y-l}}function jt(e,a){const t=e.allLayerViews.items;if(a===e.scale)return t.filter(i=>!i.suspended);const r=new Array;for(const i of t)Bt(i.parent)&&!r.includes(i.parent)||!i.visible||a&&"isVisibleAtScale"in i&&!i.isVisibleAtScale(a)||r.push(i);return r}function Ht(e){return(e==null?void 0:e.type)==="bing-maps"}function qe(e){return e&&"blendMode"in e&&"effect"in e}function qt(e){return(e==null?void 0:e.type)==="csv"}function Bt(e){return(e==null?void 0:e.declaredClass)==="esri.views.2d.layers.GroupLayerView2D"}function Kt(e){const a=e.layer;if(qe(a)){const t=a.blendMode;if((!t||t==="normal")&&(a.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let N=class extends we{constructor(a){super(a),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.scalePreserved=!0,this.showLabels=!0}};d([b()],N.prototype,"attributionVisible",void 0),d([b()],N.prototype,"exportOptions",void 0),d([b()],N.prototype,"forceFeatureAttributes",void 0),d([b()],N.prototype,"format",void 0),d([b()],N.prototype,"label",void 0),d([b()],N.prototype,"layout",void 0),d([b({type:nt})],N.prototype,"layoutItem",void 0),d([b()],N.prototype,"layoutOptions",void 0),d([b()],N.prototype,"outScale",void 0),d([b()],N.prototype,"scalePreserved",void 0),d([b()],N.prototype,"showLabels",void 0),N=d([z("esri.rest.support.PrintTemplate")],N);const Be=N,Re={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},ke=new B({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),Wt=new B({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Te=new Map;async function Zt(e,a,t){const r=Xt(e);let i=Te.get(r);return Promise.resolve().then(()=>i?{data:i.gpMetadata}:(i={gpServerUrl:r,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},k(r,{query:{f:"json"}}))).then(s=>(i.gpMetadata=s.data,i.cimVersion=i.gpMetadata.cimVersion,i.is11xService=!!i.cimVersion,Te.set(r,i),Yt(a,i))).then(s=>{const n=Sa(i);let u;const l=o=>n==="sync"?o.results&&o.results[0]&&o.results[0].value:u.fetchResultData("Output_File",null,t).then(y=>y.value);return n==="async"?Et(e,s,void 0,t).then(o=>(u=o,o.waitForJobCompletion({interval:a.updateDelay}).then(l))):Mt(e,s,void 0,t).then(l)})}async function Yt(e,a){a=a||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const t=e.template||new Be;t.showLabels==null&&(t.showLabels=!0);const r=t.exportOptions;let i;const s=_t(t.layout);if(r&&(i={dpi:r.dpi},s.toLowerCase()==="map_only"||s==="")){const c=r.width,m=r.height;i.outputSize=c!=null&&m!=null?[c,m]:void 0}const n=t.layoutOptions;let u;if(n){let c,m;n.scalebarUnit==="Miles"||n.scalebarUnit==="Kilometers"?(c="Kilometers",m="Miles"):n.scalebarUnit!=="Meters"&&n.scalebarUnit!=="Feet"||(c="Meters",m="Feet"),u={titleText:n.titleText,authorText:n.authorText,copyrightText:n.copyrightText,customTextElements:n.customTextElements,elementOverrides:n.elementOverrides,scaleBarOptions:{metricUnit:ke.toJSON(c),metricLabel:c?Re[c]:void 0,nonMetricUnit:ke.toJSON(m),nonMetricLabel:m?Re[m]:void 0}}}let l=null;n!=null&&n.legendLayers&&(l=n.legendLayers.map(c=>{const m=c.layerId;a.legendLayerNameMap[m]=c.title;const x={id:m};return c.subLayerIds&&(x.subLayerIds=c.subLayerIds),x}));const o=await Qt(e,t,a);if(o.operationalLayers){const c=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),m=/[\u0600-\u06FF]/,x=g=>{const w=g.text,v=g.font,f=v&&v.family&&v.family.toLowerCase();w&&v&&(f==="arial"||f==="arial unicode ms")&&(v.family=c.test(w)?"Arial Unicode MS":"Arial",v.style!=="normal"&&m.test(w)&&(v.family="Arial Unicode MS"))},p=()=>{throw new yt("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};o.operationalLayers.forEach(g=>{var w,v,f;(w=g.featureCollection)!=null&&w.layers?g.featureCollection.layers.forEach(h=>{var I,P,T,O;if((T=(P=(I=h.layerDefinition)==null?void 0:I.drawingInfo)==null?void 0:P.renderer)!=null&&T.symbol){const E=h.layerDefinition.drawingInfo.renderer;E.symbol.type==="esriTS"?x(E.symbol):E.symbol.type!=="CIMSymbolReference"||a.is11xService||p()}(O=h.featureSet)!=null&&O.features&&h.featureSet.features.forEach(E=>{E.symbol&&(E.symbol.type==="esriTS"?x(E.symbol):E.symbol.type!=="CIMSymbolReference"||a.is11xService||p())})}):!a.is11xService&&((f=(v=g.layerDefinition)==null?void 0:v.drawingInfo)!=null&&f.renderer)&&JSON.stringify(g.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&p()})}e.outSpatialReference&&(o.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(o,{exportOptions:i,layoutOptions:u||{}}),Object.assign(o.layoutOptions,{legendOptions:{operationalLayers:l??a.legendLayers.slice()}}),a.legendLayers.length=0,Te.set(a.gpServerUrl,a);const y={Web_Map_as_JSON:JSON.stringify(o),Format:$t(t.format),Layout_Template:s,Layout_Item_ID:void 0};if(t.layoutItem){delete y.Layout_Template;const c=t.layoutItem;await c.load(),c.access!=="public"&&Oe&&await Oe.getCredential(a.gpServerUrl),y.Layout_Item_ID=JSON.stringify({id:c.id})}return e.extraParameters&&Object.assign(y,e.extraParameters),y}async function Qt(e,a,t){const r=e.view;let i=r.spatialReference;const s={operationalLayers:await ea(r,a,t)};a.includeTables&&(s.tables=await ya(r));let n=t.ssExtent||e.extent||r.extent;if(i&&i.isWrappable&&(n=n.clone()._normalize(!0),i=n.spatialReference),s.mapOptions={extent:n&&n.toJSON(),spatialReference:i&&i.toJSON(),showAttribution:a.attributionVisible},t.ssExtent=null,r.background&&(s.background=r.background.toJSON()),r.rotation&&(s.mapOptions.rotation=-r.rotation),a.scalePreserved&&(s.mapOptions.scale=a.outScale||r.scale),X(r.timeExtent)){const u=X(r.timeExtent.start)?r.timeExtent.start.getTime():null,l=X(r.timeExtent.end)?r.timeExtent.end.getTime():null;s.mapOptions.time=[u,l]}return s}function Xt(e){let a=e;const t=a.lastIndexOf("/GPServer/");return t>0&&(a=a.slice(0,t+9)),a}async function ea(e,a,t){const r=[],i={layerView:null,printTemplate:a,view:e};let s=0;a.scalePreserved&&(s=a.outScale||e.scale);const n=jt(e,s);for(const u of n){const l=u.layer;if(!l.loaded||(l==null?void 0:l.type)==="group")continue;let o;i.layerView=u,o=Kt(u)?await H(l,i,t):Ht(l)?ta(l):qt(l)?await aa(l,i,t):(l==null?void 0:l.type)==="feature"?await ra(l,i,t):(l==null?void 0:l.type)==="geojson"?await ia(l,i,t):(l==null?void 0:l.type)==="graphics"?await sa(l,i,t):(l==null?void 0:l.type)==="imagery"?la(l,t):(l==null?void 0:l.type)==="imagery-tile"?await na(l,i,t):(l==null?void 0:l.type)==="kml"?await oa(l,i,t):(l==null?void 0:l.type)==="map-image"?ua(l,i,t):(l==null?void 0:l.type)==="map-notes"?await ca(i,t):(l==null?void 0:l.type)==="open-street-map"?pa():(l==null?void 0:l.type)==="stream"?await da(l,i,t):(l==null?void 0:l.type)==="tile"?ma(l,t):(l==null?void 0:l.type)==="vector-tile"?await fa(l,i,t):(l==null?void 0:l.type)==="web-tile"?ha(l):(l==null?void 0:l.type)==="wms"?ga(l):(l==null?void 0:l.type)==="wmts"?ba(l):await H(l,i,t),o&&(Array.isArray(o)?r.push(...o):(o.id=l.id,o.title=t.legendLayerNameMap[l.id]||l.title,o.opacity=l.opacity,o.minScale=l.minScale||0,o.maxScale=l.maxScale||0,qe(l)&&l.blendMode&&l.blendMode!=="normal"&&(o.blendMode=l.blendMode),r.push(o)))}if(s&&r.forEach(u=>{u.minScale=0,u.maxScale=0}),e.graphics&&e.graphics.length){const u=await V(null,e.graphics,a,t);u&&r.push(u)}return r}function ta(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function aa(e,a,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const r=a.layerView,i=a.printTemplate;let s;return!t.is11xService||r.filter?V(e,await ce(r),i,t):(s={type:"CSV"},e.write(s,{origin:"web-map"}),delete s.popupInfo,delete s.layerType,s.showLabels=i.showLabels&&e.labelsVisible,s)}async function V(e,a,t,r){var w,v;let i;const s=kt(),n=Ut(),u=ze(),l=Rt(),o=ze();if(o.layerDefinition.name="textLayer",delete o.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?s.layerDefinition.name=n.layerDefinition.name=u.layerDefinition.name=l.layerDefinition.name=r.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(a=e.graphics.items),e.renderer){const f=e.renderer.toJSON(),h=s.layerDefinition.drawingInfo;h&&(h.renderer=f);const I=n.layerDefinition.drawingInfo;I&&(I.renderer=f);const P=u.layerDefinition.drawingInfo;P&&(P.renderer=f);const T=l.layerDefinition.drawingInfo;T&&(T.renderer=f)}if(t.showLabels&&e.labelsVisible&&typeof e.write=="function"){const f=(v=(w=e.write({},{origin:"web-map"}).layerDefinition)==null?void 0:w.drawingInfo)==null?void 0:v.labelingInfo;if(f){i=!0;const h=s.layerDefinition.drawingInfo;h&&(h.labelingInfo=f);const I=n.layerDefinition.drawingInfo;I&&(I.labelingInfo=f);const P=u.layerDefinition.drawingInfo;P&&(P.labelingInfo=f);const T=l.layerDefinition.drawingInfo;T&&(T.labelingInfo=f)}}}let y;e!=null&&e.renderer||i||(delete s.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo,delete u.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo);const c=e==null?void 0:e.fieldsIndex,m=e==null?void 0:e.renderer;if(c){const f=new Set;i&&await ot(f,e),m&&typeof m.collectRequiredFields=="function"&&await m.collectRequiredFields(f,c),y=Array.from(f);const h=c.fields.map(I=>I.toJSON());s.layerDefinition.fields=h,n.layerDefinition.fields=h,u.layerDefinition.fields=h,l.layerDefinition.fields=h}const x=a&&a.length;let p;for(let f=0;f<x;f++){const h=a[f]||a.getItemAt(f);if(h.visible===!1||!h.geometry||(p=h.toJSON(),p.hasOwnProperty("popupTemplate")&&delete p.popupTemplate,p.geometry&&p.geometry.z&&delete p.geometry.z,p.symbol&&p.symbol.outline&&p.symbol.outline.type==="esriCLS"&&!r.is11xService))continue;!r.is11xService&&p.symbol&&p.symbol.outline&&p.symbol.outline.color&&p.symbol.outline.color[3]&&(p.symbol.outline.color[3]=255);const I=e&&e.renderer&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!p.symbol&&e&&e.renderer&&I&&!r.is11xService){const P=e.renderer,T=await P.getSymbolAsync(h);if(!T)continue;p.symbol=T.toJSON(),"hasVisualVariables"in P&&P.hasVisualVariables()&&zt(p.symbol,{renderer:P,graphic:h,symbol:T})}if(p.symbol&&(p.symbol.angle||delete p.symbol.angle,le(p.symbol)?p.symbol=await se(p.symbol,r):p.symbol.text&&delete p.attributes),(!t||!t.forceFeatureAttributes)&&(y==null?void 0:y.length)){const P={};y.forEach(T=>{p.attributes&&p.attributes.hasOwnProperty(T)&&(P[T]=p.attributes[T])}),p.attributes=P}h.geometry.type==="polygon"?s.featureSet.features.push(p):h.geometry.type==="polyline"?n.featureSet.features.push(p):h.geometry.type==="point"?p.symbol&&p.symbol.text?o.featureSet.features.push(p):u.featureSet.features.push(p):h.geometry.type==="multipoint"?l.featureSet.features.push(p):h.geometry.type==="extent"&&(p.geometry=ut.fromExtent(h.geometry).toJSON(),s.featureSet.features.push(p))}const g=[s,n,l,u,o].filter(f=>f.featureSet.features.length>0);for(const f of g){const h=f.featureSet.features.every(I=>I.symbol);!h||t&&t.forceFeatureAttributes||f.featureSet.features.forEach(I=>{delete I.attributes}),h&&delete f.layerDefinition.drawingInfo,f.layerDefinition.drawingInfo&&f.layerDefinition.drawingInfo.renderer&&await Ke(f.layerDefinition.drawingInfo.renderer,r)}return g.length?{featureCollection:{layers:g},showLabels:i}:null}async function ra(e,a,t){var m,x,p,g,w,v;let r;const i=e.renderer,s=parseFloat(t.cimVersion);if(((m=e.featureReduction)==null?void 0:m.type)==="binning"||((x=e.featureReduction)==null?void 0:x.type)==="cluster"&&(!t.is11xService||s<2.9)||(i==null?void 0:i.type)==="pie-chart"||(i==null?void 0:i.type)==="dot-density"&&(!t.is11xService||s<2.6))return H(e,a,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const n=a.layerView,{printTemplate:u,view:l}=a,o=i&&("valueExpression"in i&&i.valueExpression||"hasVisualVariables"in i&&i.hasVisualVariables()),y=((p=e.source)==null?void 0:p.type)!=="feature-layer"&&((g=e.source)==null?void 0:g.type)!=="ogc-feature";if(!t.is11xService&&o||n.filter||y||!i||"field"in i&&i.field!=null&&(typeof i.field!="string"||!e.getField(i.field))){const f=await ce(n);r=await V(e,f,u,t)}else{if(r={id:(c=e.write()).id,title:c.title,opacity:c.opacity,minScale:c.minScale,maxScale:c.maxScale,url:c.url,layerType:c.layerType,customParameters:c.customParameters,layerDefinition:c.layerDefinition},r.showLabels=u.showLabels&&e.labelsVisible,K(r,e),((v=(w=r.layerDefinition)==null?void 0:w.drawingInfo)==null?void 0:v.renderer)&&(delete r.layerDefinition.minScale,delete r.layerDefinition.maxScale,await Ke(r.layerDefinition.drawingInfo.renderer,t),"visualVariables"in i&&i.visualVariables&&i.visualVariables[0])){const h=i.visualVariables[0];if(h.type==="size"&&h.maxSize&&typeof h.maxSize!="number"&&h.minSize&&typeof h.minSize!="number"){const I=ct(h,l.scale);r.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=I.minSize,r.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=I.maxSize}}const f=It(n);f&&(r.layerDefinition||(r.layerDefinition={}),r.layerDefinition.definitionExpression=r.layerDefinition.definitionExpression?`(${r.layerDefinition.definitionExpression}) AND (${f})`:f)}var c;return r}async function ia(e,a,t){var r,i;return((r=e.featureReduction)==null?void 0:r.type)==="binning"||((i=e.featureReduction)==null?void 0:i.type)==="cluster"?H(e,a,t):(e.legendEnabled&&t.legendLayers.push({id:e.id}),V(e,await ce(a.layerView),a.printTemplate,t))}async function sa(e,{printTemplate:a},t){return V(e,null,a,t)}function la(e,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const t={layerType:(r=e.write()).layerType,customParameters:r.customParameters};var r;if(t.bandIds=e.bandIds,t.compressionQuality=e.compressionQuality,t.format=e.format,t.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(t.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(a.is11xService)e.renderingRule&&(t.renderingRule=e.renderingRule.toJSON()),e.renderer&&(t.layerDefinition=t.layerDefinition||{},t.layerDefinition.drawingInfo=t.layerDefinition.drawingInfo||{},t.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const i=e.exportImageServiceParameters.combineRendererWithRenderingRule();i&&(t.renderingRule=i.toJSON())}return K(t,e),t}async function na(e,a,t){var s;if(((s=e.renderer)==null?void 0:s.type)==="flow")return H(e,a,t);e.legendEnabled&&t.legendLayers.push({id:e.id});const r={bandIds:(i=e.write()||{}).bandIds,customParameters:i.customParameters,interpolation:i.interpolation,layerDefinition:i.layerDefinition};var i;return r.layerType="ArcGISImageServiceLayer",K(r,e),r}async function oa(e,a,t){const r=a.printTemplate;if(t.is11xService){const i={type:"kml"};return e.write(i,{origin:"web-map"}),delete i.layerType,i.url=ee(e.url),i}{const i=[],s=a.layerView;s.allVisibleMapImages.forEach((l,o)=>{const y={id:`${e.id}_image${o}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:l.extent};l.href.substr(0,22)==="data:image/png;base64,"?y.imageData=l.href.substr(22):y.url=l.href,i.push(y)});const n=[...s.allVisiblePoints.items,...s.allVisiblePolylines.items,...s.allVisiblePolygons.items],u={id:e.id,...await V(null,n,r,t)};return i.push(u),i}}function ua(e,{view:a},t){var o,y;let r;const i={id:e.id,subLayerIds:[]};let s=[];const n=a.scale,u=c=>{const m=n===0,x=c.minScale===0||n<=c.minScale,p=c.maxScale===0||n>=c.maxScale;if(c.visible&&(m||x&&p))if(c.sublayers)c.sublayers.forEach(u);else{const g=c.toExportImageJSON(),w={id:c.id,name:c.title,layerDefinition:{drawingInfo:g.drawingInfo,definitionExpression:g.definitionExpression,source:g.source}};s.unshift(w),i.subLayerIds.push(c.id)}};var l;return e.sublayers&&e.sublayers.forEach(u),s.length&&(s=s.map(({id:c,name:m,layerDefinition:x})=>({id:c,name:m,layerDefinition:x})),r={layerType:(l=e.write()).layerType,customParameters:l.customParameters},r.layers=s,r.visibleLayers=(y=(o=e.capabilities)==null?void 0:o.exportMap)!=null&&y.supportsDynamicLayers?void 0:i.subLayerIds,K(r,e),e.legendEnabled&&t.legendLayers.push(i)),r}async function ca({layerView:e,printTemplate:a},t){const r=[],i=e.layer;if(X(i.featureCollections))for(const s of i.featureCollections){const n=await V(s,s.source,a,t);n&&r.push(...n.featureCollection.layers)}else if(X(i.sublayers))for(const s of i.sublayers){const n=await V(null,s.graphics,a,t);n&&r.push(...n.featureCollection.layers)}return{featureCollection:{layers:r}}}function pa(){return{type:"OpenStreetMap"}}async function H(e,{printTemplate:a,view:t},r){var c;const i={type:"image"},s={format:"png",ignoreBackground:!0,layers:[e],rotation:0},n=r.ssExtent||t.extent.clone();let u=96,l=!0,o=!0;if(a.exportOptions){const m=a.exportOptions;m.dpi!=null&&m.dpi>0&&(u=m.dpi),m.width!=null&&m.width>0&&(l=m.width%2==t.width%2),m.height!=null&&m.height>0&&(o=m.height%2==t.height%2)}if(a.layout==="map-only"&&a.scalePreserved&&(!a.outScale||a.outScale===t.scale)&&u===96&&(!l||!o)&&(s.area={x:0,y:0,width:t.width,height:t.height},l||(s.area.width-=1),o||(s.area.height-=1),!r.ssExtent)){const m=t.toMap(pt(s.area.width,s.area.height));n.ymin=m.y,n.xmax=m.x,r.ssExtent=n}i.extent=n.clone()._normalize(!0).toJSON();const y=await t.takeScreenshot(s);return i.imageData=(c=dt(y.dataUrl))==null?void 0:c.data,i}async function da(e,{layerView:a,printTemplate:t},r){return e.legendEnabled&&r.legendLayers.push({id:e.id}),V(e,await ce(a),t,r)}async function ya(e){var i,s;const a=[],t=[];for(const n of e.map.allTables)n.type!=="feature"||n.loaded||t.push(n.load());t.length&&await Promise.allSettled(t);for(const n of e.map.allTables)if(n.type==="feature"&&n.loaded&&n.isTable&&((i=n.source)==null?void 0:i.type)==="feature-layer"){const u={id:(r=n.write()).id,title:r.title,customParameters:r.customParameters,layerDefinition:{definitionExpression:(s=r.layerDefinition)==null?void 0:s.definitionExpression}};K(u,n),a.push(u)}var r;return a.length?a:void 0}function ma(e,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const t={layerType:(r=e.write()).layerType,customParameters:r.customParameters};var r;return K(t,e),t}async function fa(e,a,t){if(t.is11xService&&e.serviceUrl&&e.styleUrl){const r=Se(e.styleUrl,e.apiKey),i=Se(e.serviceUrl,e.apiKey);if(!r&&!i||t.cimVersion!=="2.1.0"){const s={type:"VectorTileLayer"};return s.styleUrl=ee(e.styleUrl),s.token=r,i!==r&&(s.additionalTokens=[{url:e.serviceUrl,token:i}]),s}}return H(e,a,t)}function ha(e){var r;const a=(r=e.urlTemplate)==null?void 0:r.replace(/\${/g,"{"),t={type:"WebTiledLayer",urlTemplate:a,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function ga(e){let a;const t=[],r=i=>{i.visible&&(i.sublayers?i.sublayers.forEach(r):i.name&&t.unshift(i.name))};return e.sublayers&&e.sublayers.forEach(r),t.length&&(a={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:t,url:ee(e.url),version:e.version}),a}function ba(e){const a=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:a.imageFormat,layer:a.id,style:a.styleId,tileMatrixSet:a.tileMatrixSetId,url:ee(e.url)}}function K(e,a){a.url&&(e.url=ee(e.url||a.url),e.token=Se(e.url,a.apiKey))}async function se(e,a){var n;a.canvas||(a.canvas=document.createElement("canvas"));const t=1024;a.canvas.width=t,a.canvas.height=t;const r=a.canvas.getContext("2d");let i,s;if(e.path){const u=new Path2D(e.path);u.closePath(),r.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",r.fill(u);const l=Jt(r);if(!l)return null;r.clearRect(0,0,t,t);const o=re(e.size)/Math.max(l.width,l.height);r.scale(o,o);const y=t/o,c=y/2-l.width/2-l.x,m=y/2-l.height/2-l.y;if(r.translate(c,m),Array.isArray(e.color)&&r.fill(u),((n=e.outline)==null?void 0:n.width)&&Array.isArray(e.outline.color)){const p=e.outline;r.lineWidth=re(p.width)/o,r.lineJoin="round",r.strokeStyle=`rgba(${p.color[0]},${p.color[1]},${p.color[2]},${p.color[3]/255})`,r.stroke(u),l.width+=r.lineWidth,l.height+=r.lineWidth}l.width*=o,l.height*=o;const x=r.getImageData(t/2-l.width/2,t/2-l.height/2,Math.ceil(l.width),Math.ceil(l.height));i=x.width,s=x.height,r.canvas.width=i,r.canvas.height=s,r.putImageData(x,0,0)}else{const u=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,l=(await k(u,{responseType:"image"})).data;i=re(e.width),s=re(e.height),r.canvas.width=i,r.canvas.height=s,r.drawImage(l,0,0,r.canvas.width,r.canvas.height)}return{type:"esriPMS",imageData:r.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:U(s),width:U(i),xoffset:e.xoffset,yoffset:e.yoffset}}async function Ke(e,a){const t=e.type;if(t==="simple"&&le(e.symbol))e.symbol=await se(e.symbol,a);else if(t==="uniqueValue"||t==="classBreaks"){le(e.defaultSymbol)&&(e.defaultSymbol=await se(e.defaultSymbol,a));const r=e[t==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(r)for(const i of r)le(i.symbol)&&(i.symbol=await se(i.symbol,a))}}async function ce(e){return e.queryFeatures(e.createQuery()).then(a=>a.features)}function Sa(e){return e.gpMetadata&&e.gpMetadata.executionType?Wt.fromJSON(e.gpMetadata.executionType):"sync"}function le(e){return e&&(e.path||e.contentType==="image/svg+xml"||e.url&&e.url.endsWith(".svg"))}let A=class extends we{constructor(e){super(e),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};d([b()],A.prototype,"extent",void 0),d([b()],A.prototype,"extraParameters",void 0),d([b()],A.prototype,"outSpatialReference",void 0),d([b()],A.prototype,"template",void 0),d([b()],A.prototype,"updateDelay",void 0),d([b()],A.prototype,"view",void 0),A=d([z("esri.rest.support.PrintParameters")],A);const xa=A,We={results:[{paramName:"Output_JSON",dataType:"GPString",value:[{layoutTemplate:"85x11_landscape",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[10,6.7],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"85x11_landscape_attributes",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"85x11_landscape_attributes_legend",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"85x11_landscape_legend",pageSize:[11,8.5],pageUnits:"INCH",webMapFrameSize:[10,6.7],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"85x11_portrait",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"85x11_portrait_attributes",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"},{PropertyInfo:""}]}},{layoutTemplate:"85x11_portrait_attributes_legend",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"},{PropertyInfo:""}]}},{layoutTemplate:"85x11_portrait_legend",pageSize:[8.5,11],pageUnits:"INCH",webMapFrameSize:[7.5,7.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"100"},{"2xScale":"200"},{HalfScale:"50"}]}},{layoutTemplate:"11x17_landscape",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[16,9],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_landscape_attributes",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[13,10],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_landscape_attributes_legend",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[13,10],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_landscape_legend",pageSize:[17,11],pageUnits:"INCH",webMapFrameSize:[16,9],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_portrait",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"11x17_portrait_attributes",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"},{PropertyInfo:" "}]}},{layoutTemplate:"11x17_portrait_attributes_legend",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"},{PropertyInfo:" "}]}},{layoutTemplate:"11x17_portrait_legend",pageSize:[11,17],pageUnits:"INCH",webMapFrameSize:[10,13],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{Scale:"800"},{"2xScale":"1,600"},{HalfScale:"400"}]}},{layoutTemplate:"24x36_landscape",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[35,21],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_landscape_attributes",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[28,23],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:"Text"},{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_landscape_attributes_legend",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[28,23],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:"Text"},{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_landscape_legend",pageSize:[36,24],pageUnits:"INCH",webMapFrameSize:[35,21],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_portrait",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"24x36_portrait_attributes",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"24x36_portrait_attributes_legend",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"24x36_portrait_legend",pageSize:[24,36],pageUnits:"INCH",webMapFrameSize:[23,29],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[47,32.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape_attributes",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[38,35],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape_attributes_legend",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[38,35],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{PropertyInfo:" "},{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_landscape_legend",pageSize:[48,36],pageUnits:"INCH",webMapFrameSize:[47,32.5],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_portrait",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}},{layoutTemplate:"36x48_portrait_attributes",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!1,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"36x48_portrait_attributes_legend",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!1,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!1,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"},{PropertyInfo:" "}]}},{layoutTemplate:"36x48_portrait_legend",pageSize:[36,48],pageUnits:"INCH",webMapFrameSize:[35,39],layoutOptions:{hasTitleText:!0,hasAuthorText:!1,hasCopyrightText:!1,hasLegend:!0,customTextElements:[{"2xScale":"200"},{"4xScale":"400"},{"6xScale":"600"},{Scale:"100"}]}}]}],messages:[]},Ta=async e=>{try{const t=(await k(e,{query:{f:"json"}})).data.parameters.find(r=>r.name==="Format");return t==null?void 0:t.choiceList}catch(a){return console.log(a),[]}},Ie=e=>{const a=Math.round(e*600/564.248588);return a<=75?75:a>75&&a<=150?150:a>150&&a<=300?300:a>300&&a<=600?600:a>600&&a<=1200?1200:a>1200&&a<=2400?2400:a>2400&&a<=4800?4800:a>4800&&a<=9600?9600:a>9600&&a<=19200?19200:a>19200&&a<=38400?38400:a>38400&&a<=76800?76800:a>76800&&a<=153600?153600:a>153600&&a<=307200?307200:a>307200&&a<=614400?614400:a>614400&&a<=1228800?1228800:0},wa=e=>{var t;const a=(t=mt.create().lods.filter(r=>r.scale>=300&&r.scale<614400).map(r=>{const i=Ie(r.scale);return{scale:i,label:`1" = ${(i/12).toLocaleString("en")}'`}}))==null?void 0:t.reverse();return a.push({scale:"custom",label:"User Defined"}),a},va=(e,a,t,r)=>{let i=e==="current"?a:t;return t==="custom"&&r&&(i=r*12),Ie(i)},Pa=async()=>{const e=[],a=[];return We.results[0].value.forEach(t=>{const r=t.pageSize[0],i=t.pageSize[1];let s=`${r}"x${i}"`,n="Portrait",u=r,l=`${r}x${i}_${n.toLowerCase()}`;r>i&&(s=`${i}"x${r}"`,n="Landscape",l=`${i}x${r}_${n.toLowerCase()}`,u=i),s+=` ${n}`;const o={label:s,template:l,size:u};a.includes(o.template)||(e.push(o),a.push(o.template))}),e.sort((t,r)=>t.size-r.size),e},Ia=(e,a,t)=>{let r=e.template?e.template.replace(".",""):JSON.parse(e).template.replace(".","");return a&&(r+="_attributes"),t&&(r+="_legend"),r},Ca=(e,a,t,r,i,s)=>new Be({attributionVisible:!1,outScale:e,showLabels:!0,format:a,scalePreserved:!0,exportOptions:{dpi:200},layoutOptions:{titleText:t,scalebarUnit:"Feet",customTextElements:r,legendLayers:[]},layout:s}),La=e=>{let a="";return e.layer.popupTemplate.fieldInfos.forEach(t=>{if(!["OBJECTID","PARCEL_PK","PARCEL_STATUS"].includes(t.fieldName)&&e.getAttribute(t.fieldName)&&e.getAttribute(t.fieldName)!==null)if(t.fieldName.includes("DATE")){const r=new Date(e.getAttribute(t.fieldName));a+=`${t.label}: ${r.getUTCMonth()+1}/${r.getUTCDate()}/${r.getUTCFullYear()}
`}else t.fieldName.includes("PRICE")||t.fieldName.includes("VAL")?a+=`${t.label}: $${e.getAttribute(t.fieldName)}
`:a+=`${t.label}: ${e.getAttribute(t.fieldName)}
`}),a},Oa=(e,a,t,r)=>{const i=[];if(i.push({Scale:(a/12).toString()}),e<24?(i.push({HalfScale:(a/12/2).toString()}),i.push({"2xScale":a/12*2+" ft"})):e<36?(i.push({"2xScale":a/12*2}),i.push({"4xScale":a/12*4+" ft"})):(i.push({"2xScale":a/12*2}),i.push({"4xScale":a/12*4}),i.push({"6xScale":a/12*6+" ft"})),t){const s=La(r);i.push({PropertyInfo:s})}return i},Ma=(e,a,t,r,i,s,n,u,l,o,y,c,m,x)=>{if(e){const p=va(t,e==null?void 0:e.scale,r,i?parseInt(i.value):void 0),g=e==null?void 0:e.map.findLayerById("print-graphic");g&&(g.visible=!1);const w=Oa(s.size,p,o,u),v=Ia(s,o,y),f=Ca(p,n,l,w,e,v),h={title:l,loading:!0,submitted:new Date().getTime().toString(),href:null};x([...m,h]),c.current=[...c.current,h];const I=e.scale;setTimeout(async()=>{try{const P=await Da(a,f,e,I,n);setTimeout(()=>{g&&(g.visible=!0);const T=c.current.indexOf(h);c.current[T]={...c.current[T],url:P==null?void 0:P.url,loading:!1},x([...c.current])})}catch(P){console.log(P),g&&(g.visible=!0);const T=c.current.indexOf(h);c.current[T]={...c.current[T],error:!0,loading:!1},x([...c.current])}},1e3)}},Da=async(e,a,t,r,i)=>{try{return a.format=i,await Zt(e,new xa({template:a,view:t,outSpatialReference:new ge({wkid:3632})}),{timeout:12e4,headers:{"Content-Type":"application/json;charset=UTF-8"}})}catch(s){console.log(s)}};let he=null;const Q=(e,a,t,r,i)=>{let s=a.map.findLayerById("print-graphic");s||(s=new ft({id:"print-graphic",listMode:"hide"}),a.map.add(s)),s.removeAll();let n=null;i.current&&(n=i.current.value),e?(Ue(s,a,t,r,n),he=a.watch("stationary",u=>{s.removeAll(),i.current&&(n=i.current.value),Ue(s,a,t,r,n)})):he&&he.remove()},Ue=(e,a,t,r,i)=>{setTimeout(async()=>{var w,v;await ht();const s=gt(a.extent.center,{wkid:2264}),u=(t.template?t:JSON.parse(t)).template.replace(".",""),l=We.results[0].value.filter(f=>f.layoutTemplate===u);let o=r==="current"?Ie(a.scale):parseInt(i);o=o/12;const y=((w=l[0])==null?void 0:w.webMapFrameSize[0])*o,c=((v=l[0])==null?void 0:v.webMapFrameSize[1])*o,m=s.x+y/2,x=s.y+c/2,p=s.x-y/2,g=s.y-c/2;e.removeAll(),e.add(new bt({symbol:{type:"simple-fill",style:"cross",outline:{width:2,color:[149,149,149,1]}},geometry:new ve({xmax:m,xmin:p,ymax:x,ymin:g,spatialReference:{wkid:2264}})}))})},Na={title:"Print Tips",tips:[]},Ea=e=>{const a=L.useRef(!1),[t,r]=L.useState(!1),i=L.useRef(null),s=L.useRef(null),n=L.useRef(null),u=L.useRef(null),l=L.useRef(null),o=L.useRef([]),y=L.useRef(null),c=L.useRef(null),[m,x]=L.useState([]),[p,g]=L.useState([]),[w,v]=L.useState("current"),[f,h]=L.useState(),[I,P]=L.useState(),[T,O]=L.useState(),[E,S]=L.useState(),[D,te]=L.useState([]);L.useEffect(()=>{a.current||(a.current=!0,Pa().then(R=>{x(R),O(R[0])}),Ta(e.exportUrl).then(R=>{g(R),S(R[0])}))},[]);const ae=L.useCallback(R=>{e.showTips(Na)},[]);L.useEffect(()=>{P(e.selectedProperty)},[e.selectedProperty]),L.useEffect(()=>{r(e.isActive)},[e.isActive]);const Ze=L.useCallback(R=>{Q(R.target.checked,e.view,T,w,i)},[T,w,f]);return{isActive:t,title:l,setSelectedLayout:O,layouts:m,selectedFormat:E,setSelectedFormat:S,formats:p,setScaleType:v,scaleType:w,customScaleSelect:i,setCustomScale:h,customScale:f,userDefined:u,selectedProperty:I,selectedLayout:T,attributes:s,legend:n,setJobs:te,jobs:D,jobRef:o,tipsClicked:ae,showFrameChanged:Ze,frame:y,scale:c}},$a=e=>{const{isActive:a,title:t,setSelectedLayout:r,layouts:i,selectedFormat:s,setSelectedFormat:n,formats:u,setScaleType:l,scaleType:o,customScaleSelect:y,setCustomScale:c,customScale:m,userDefined:x,selectedProperty:p,selectedLayout:g,attributes:w,legend:v,setJobs:f,jobs:h,jobRef:I,tipsClicked:P,showFrameChanged:T,frame:O}=Ea(e),E=L.useCallback(S=>{e.toolDismissed()},[]);return M(xt,{id:"print-panel",heading:"Print","data-panel":"print",hidden:!a,closed:a?void 0:!0,closable:!0,onCalcitePanelClose:E,children:[C(Me,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:P}),C(Me,{id:"collapseTool",icon:"chevron-up",text:"",slot:"header-actions-end",onClick:Tt}),C(De,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),C(De,{label:"Collapse",referenceElement:"collapseTool",closeOnClick:!0,children:"Collapse"}),M("div",{id:"print-container",children:[M(F,{children:["Title",C(Ne,{ref:t,maxLength:50})]}),M(F,{children:["Page size",C(pe,{label:"",onCalciteSelectChange:S=>{r(S.target.selectedOption.value),O.current&&Q(O.current.checked,e.view,g,o,y)},children:i.map((S,D)=>C(de,{label:S.label,value:JSON.stringify(S)},D))})]}),M(F,{children:["File format",C(pe,{label:"",onCalciteSelectChange:S=>n(S.target.selectedOption.value),children:u.map((S,D)=>C(de,{label:S,value:S},D))})]}),M(wt,{name:"scale-radio",children:[M(F,{layout:"inline",children:[C(Ee,{checked:o==="current"?!0:void 0,value:"current",onCalciteRadioButtonChange:S=>{l(S.target.value),O.current&&Q(O.current.checked,e.view,g,o,y)}}),"Current Scale"]}),M(F,{layout:"inline",children:[C(Ee,{checked:o==="custom"?!0:void 0,value:"custom",onCalciteRadioButtonChange:S=>{l(S.target.value),O.current&&Q(O.current.checked,e.view,g,o,y)}}),"Custom Scale"]})]}),o==="custom"&&M(F,{children:["Scale",C(pe,{ref:y,label:"",onCalciteSelectChange:S=>{c(S.target.selectedOption.value),O.current&&Q(O.current.checked,e.view,g,o,y)},children:(e==null?void 0:e.view)&&wa(e==null?void 0:e.view).map((S,D)=>C(de,{label:S.label,value:S.scale},D))})]}),o==="custom"&&m==="custom"&&C(Ne,{ref:x,type:"number",prefixText:'1" = ',suffixText:"'",min:1,max:5e4}),C("br",{}),p&&M(F,{layout:"inline",children:[C(ye,{ref:w,value:"attributes"}),"Include attributes?"]}),M(F,{layout:"inline",children:[C(ye,{ref:v,value:"legend"}),"Include Legend?"]}),M(F,{layout:"inline",children:[C(ye,{ref:O,value:"frameChecked",onCalciteCheckboxChange:T}),"Show map frame?"]}),C($e,{width:"full",onClick:()=>{var S,D,te,ae;Ma(e.view,e.exportUrl,o,m,(S=x==null?void 0:x.current)==null?void 0:S.value,g,s,p,(D=t.current)==null?void 0:D.value,(te=w.current)==null?void 0:te.checked,(ae=v.current)==null?void 0:ae.checked,I,h,f)},children:"Export"}),C("hr",{}),C("h4",{children:"Exported files"}),h.length<=0&&C("p",{children:"Your exported files will appear here"}),C("div",{id:"printJobs",children:h.map(S=>M("div",{className:"print-job",children:[S.loading&&M("div",{children:[C(vt,{scale:"s",inline:!0,label:""}),C("span",{className:"loader-text",children:`${S.title!==""?S.title:"untitled"}`})]}),S.url&&!S.loading&&M("div",{children:[C(Pt,{target:"_blank","icon-start":"download",href:S.url,children:`${S.title!==""?S.title:"untitled"}`}),C($e,{appearance:"transparent","icon-start":"x",scale:"s",onClick:()=>{I.current=h.filter(D=>D.title!==S.title),f(h.filter(D=>D!==S))}})]})]},`printjob_${S.submitted}`))})]})]})},Ja=St.memo($a);export{Ja as default};
