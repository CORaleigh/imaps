import{e as p,y as c,a as U,L as hi,c as rt,cm as Zn,cn as Bn,ac as jn,z as G,J as d,T as Wn,c4 as Kt,at as f,co as qn,cp as Jn,cq as Qn,cr as dn,cd as Vt,ce as Ti,cs as Kn,ct as ts,cu as es,cv as $i,ca as we,cw as pi,cx as is,aC as z,cy as ne,cz as as,cA as ns,cB as un,cC as Le,M as xt,cD as Oe,cE as Je,cF as ss,cG as J,aG as lt,aH as mt,cH as gn,cI as pa,cJ as os,cK as rs,cL as _n,cM as ls,cN as hs,cO as et,cP as ca,D as Dt,a7 as L,cQ as k,cR as Ht,aq as ci,cS as mn,cT as da,cU as ps,cV as cs,cW as vn,aw as R,x as _e,cX as ua,cY as w,cZ as Wi,c_ as Ut,c$ as fn,d0 as V,d1 as Qe,d2 as ds,d3 as us,aE as B,ch as ie,aF as Di,d4 as de,d5 as Ri,d6 as yn,d7 as di,d8 as gs,d9 as Gi,Q as Mn,aY as ue,I as bn,E as _s,da as Ft,db as ms,dc as Sn,dd as vs,U as qi,de as xn,df as ga,dg as fs,dh as Ji,di as ys,a5 as Pt,dj as _a,cf as Yt,aa as Ms,ci as bs,dk as ma,av as Ii,f as Ss,dl as nt,dm as xs,dn as wn,dp as ws,dq as Os,dr as Ke,ds as Es,c3 as gt,dt as va,du as On,dv as As,c9 as $e,dw as Ts,dx as $s,a2 as Ci,ai as En,dy as Ds,dz as Rs,K as fa,dA as ya,dB as Ma,l as Gs,dC as Qi,_ as Is,aD as Ee,dD as ba,dE as Sa,dF as Cs,cg as Ps,cc as Xe,dG as zs,dH as Ls}from"./index-53e0d3f6.js";import{d as Vs,x as Ns,v as ti,a as Rt,y as ei,j as De,m as Ve,t as ui,b as Hs,c as Us,l as ks,e as Re,f as bi,D as Xs}from"./automaticLengthMeasurementUtils-bbfb1cc8.js";import{i as Ys}from"./getDefaultUnitForView-90cd4f9d.js";import{W as An,t as Fs,d as ii,a as Zs,v as xa,x as Ge,b as Ki,i as it,S as Bs,N as ta,e as x,G as Tn,R as $t,h as js,z as Pi,L as fe,T as Ws,F as qs,c as $n,P as Js,C as zi,f as Dn,V as Qs,g as Ks,U as to,s as eo}from"./dragEventPipeline3D-2490561d.js";import{c as C,o as io,v as ao,e as wa,a as no,t as so,b as oo,d as ro,E as lo,G as ho}from"./VertexColor.glsl-cd8180c5.js";import{r as Li,c as po,b as Oa,p as co}from"./line-2d468772.js";import{r as Ea,t as uo}from"./vec4f32-0d1b2306.js";import{z as Vi,h as go,a as Ne,l as _o,C as mo,x as vo,c as fo,n as xe,d as ea,p as ai,O as Rn,f as Jt,u as yo,b as Mo,e as Ni,g as Gn,q as In,i as Ae}from"./NativeLineMaterial-ab15b5f5.js";import{n as Hi}from"./DoubleArray-7611e074.js";import{O as Ui}from"./VertexAttribute-15d1866a.js";import{e as kt,t as bo,o as So}from"./mat4f64-65d35099.js";import{n as Gt}from"./basicInterfaces-04e01328.js";import{H as xo,B as wo,M as Aa,A as Oo,G as Eo,S as Ye,Y as Ta}from"./editPlaneUtils-c8277f6b.js";import{k as Ao,c as To,o as $o}from"./drawSurfaces-71648678.js";import{c as A,f as q,p as $a,b as Da,d as Cn,i as Do,o as Ra,t as Ro}from"./sphere-ca10ea93.js";import{E as Go,M as Io,x as vt,C as Te,g as Co,b as me,U as Pn,D as he,p as gi,R as Po,q as zo,m as ni,X as Ga,Z as Lo}from"./SnappingDragPipelineStep-a9d439cd.js";import{j as Vo}from"./GraphicManipulator-733c1a9f.js";import{a as si,V as _i,A as Ia,P as No,E as Tt,e as Ca}from"./SnappingContext-266fe79c.js";import{r as Ie,p as mi,a as ia,l as Ho,c as Uo,n as ko}from"./TranslateTooltipInfos-62aa02c8.js";import{Y as He,_ as aa,p as na,J as Xo,x as Pa}from"./plane-54a1816b.js";import{i as Yo}from"./automaticAreaMeasurementUtils-c7621a8f.js";import{g as Fo,l as Zo}from"./axisAngleDegrees-50b88615.js";import{W as Fe,Z as ye}from"./boundedPlane-93226d35.js";import{g as Me}from"./persistable-b822258e.js";import{Q as za}from"./quat-d5f88513.js";import"./Octree-eb5534e6.js";import"./triangle-cbb245f7.js";import"./Indices-9b814586.js";import{o as La,W as Bo,l as jo,_ as Wo}from"./OrderIndependentTransparency-92d1201d.js";import"./BufferView-abbd0a70.js";import{R as Ze,I as qo}from"./enums-64ab819c.js";import"./spatialReferenceEllipsoidUtils-3b8ad13e.js";import{i as Jo,p as Qo}from"./ExtentTooltipInfos-fddba124.js";let Ko=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),zn=(e,t,i)=>{for(let a=0,n=t.length;a<n;a++){let s=t[a];Array.isArray(s)?zn(e,s,i):s!=null&&s!==!1&&(typeof s=="string"&&(s=Ko(s)),i.push(s))}};function tr(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector"))||i&&(typeof i=="string"||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,n;return i&&i.length===1&&typeof i[0]=="string"?a=i[0]:i&&(n=[],zn(e,i,n),n.length===0&&(n=void 0)),{vnodeSelector:e,properties:t,children:n,text:a===""?void 0:a,domNode:null}}const Va={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let F=class extends hi{get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const t=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${t}`}get _padding(){return .5*this.fontSize}get _borderRadius(){return this._padding}constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new rt([0,0,0,.6]),this.textColor=new rt([255,255,255]),this._textShadowSize=1}render(){return tr("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(t){if(!this.visible)return;const i=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${i}`;const a=this._padding,n=this._borderRadius,s=t.measureText(this.text).width,o=this.fontSize,l=er[this.anchor];t.textAlign="center",t.textBaseline="middle";const r=s+2*a,h=o+2*a,u=this.x+l.x*r,g=this.y+l.y*h;this._roundedRect(t,u,g,r,h,n),t.fillStyle=this.backgroundColor.toCss(!0),t.fill();const _=this.x+(l.x+.5)*r,y=this.y+(l.y+.5)*h;this._renderTextShadow(t,this.text,_,y),t.fillStyle=this.textColor.toCss(!0),t.fillText(this.text,_,y)}_renderTextShadow(t,i,a,n){t.lineJoin="miter",t.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/ki.length})`;const s=this._textShadowSize;for(const[o,l]of ki)t.fillText(i,a+s*o,n+s*l)}_roundedRect(t,i,a,n,s,o){t.beginPath(),t.moveTo(i,a+o),t.arcTo(i,a,i+o,a,o),t.lineTo(i+n-o,a),t.arcTo(i+n,a,i+n,a+o,o),t.lineTo(i+n,a+s-o),t.arcTo(i+n,a+s,i+n-o,a+s,o),t.lineTo(i+o,a+s),t.arcTo(i,a+s,i,a+s-o,o),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};for(const i in Va)t[Va[i]]=this.anchor===i;return t}};p([c()],F.prototype,"x",void 0),p([c()],F.prototype,"y",void 0),p([c()],F.prototype,"position",null),p([c()],F.prototype,"text",void 0),p([c()],F.prototype,"fontSize",void 0),p([c()],F.prototype,"anchor",void 0),p([c()],F.prototype,"visible",void 0),p([c()],F.prototype,"backgroundColor",void 0),p([c()],F.prototype,"textColor",void 0),p([c()],F.prototype,"_textShadowSize",void 0),p([c()],F.prototype,"_textShadowColor",null),p([c()],F.prototype,"_textShadow",null),p([c()],F.prototype,"_padding",null),p([c()],F.prototype,"_borderRadius",null),F=p([U("esri.views.overlay.TextOverlayItem")],F);const er={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},ki=[];for(let t=0;t<360;t+=360/16)ki.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);const ir=F,ar=3025,nr={default:15,far:25};let Mt=class extends hi{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const t=Zn(async a=>{const n=await Bn("esri/core/t9n/Units");jn(a),this._messagesUnits=n}),i=()=>$i(this.context,a=>a.editGeometryOperations);this.addHandles([G(()=>[d(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(a=>Wn(i,a,()=>this._update())),Kt(()=>t.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return f(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(t=>t.label.text)}}get _edgeDistancePixels(){return nr[this.edgeDistance]}_update(){this._nextLabelIndex=0;const t=this.context;if(f(t))return void this._destroyUnusedLabels();const{components:i,geometry:a,coordinateHelper:n}=t.editGeometryOperations.data;if(!a)return void this._destroyUnusedLabels();const s=i.length;for(let o=0;o<s;++o){const l=[];if(i[o].iterateVertices(y=>{l.push(n.toXYZ(y.pos))}),o===0&&d(this.stagedVertex)&&l.push(n.toXYZ(this.stagedVertex)),l.length<2)continue;const r=l[0],h=l[l.length-1];a.type==="polygon"&&l.length>2&&!qn(r,h)&&l.push(r);const u=s===1&&!Jn(l,!1,!1);let g=sr,_=or;this.toScreenPointArray(t,r,g);for(let y=1;y<l.length;++y){const M=l[y-1],v=l[y];this.toScreenPointArray(t,v,_),this._addLabel(t,M,g,v,_,u),[g,_]=[_,g]}}this._destroyUnusedLabels()}_addLabel(t,i,a,n,s,o){const{label:l}=this._getOrCreateLabel(t);if(!this.visible||Qn(a,s)<ar)return void(l.visible=!1);const r=d(t.graphicState)?t.graphicState.isDraped?"on-the-ground":"absolute-height":dn(t.editGeometryOperations.data.geometry,t.elevationInfo),{spatialReference:h}=t.editGeometryOperations.data,u=Vs(i,n,h,r),g=this._messagesUnits,_=Ys(t.view);l.text=d(g)&&d(u)?Ns(g,u,_):"",l.visible=!0;const y=s[0]-a[0],M=s[1]-a[1];o?Vt(ct,-M,y):Vt(ct,M,-y),Ti(ct,ct),Kn(ct,ct,this._edgeDistancePixels),ts(be,a,s,.5),es(be,be,ct),l.position=[be[0],be[1]],Math.abs(ct[0])>Math.abs(ct[1])?l.anchor=ct[0]>0?"left":"right":l.anchor=-ct[1]<0?"top":"bottom"}_getOrCreateLabel(t){var n;if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const i=new ir({fontSize:10,anchor:"center"});(n=t.view.overlay)==null||n.items.add(i);const a={label:i};return this._labelInfos.push(a),this._nextLabelIndex=this._labelInfos.length,a}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:t}){$i(this.context,i=>{var a;return(a=i.view.overlay)==null?void 0:a.items.remove(t)}),t.destroy()}};p([c()],Mt.prototype,"context",void 0),p([c()],Mt.prototype,"stagedVertex",void 0),p([c()],Mt.prototype,"visible",void 0),p([c()],Mt.prototype,"edgeDistance",void 0),p([c()],Mt.prototype,"updating",null),p([c()],Mt.prototype,"_messagesUnits",void 0),p([c()],Mt.prototype,"_edgeDistancePixels",null),Mt=p([U("esri.views.interactive")],Mt);const ct=we(),be=we(),sr=pi(),or=pi();let oi=class extends Mt{getCameraOrExtent({view:t}){return t.state.camera}toScreenPointArray({view:t,elevationInfo:i,editGeometryOperations:a},n,s=pi()){const{spatialReference:o}=a.data.coordinateHelper;return is(n,o,i,t,Na),t.state.camera.projectToScreen(Na,s),s}};oi=p([U("esri.views.3d.interactive.SegmentLabels3D")],oi);const Na=z(),E={main:new rt([255,127,0]),selected:new rt([255,255,255]),staged:new rt([12,207,255]),outline:new rt([0,0,0,.5]),selectedOutline:new rt([255,255,255])},ce=.3;function Ce(e,t){const i=e.clone();return i.a*=t,i}function rr(e,t){const i=e.clone(),a=as(i);a.s*=t;const n=ns(a);return i.r=n.r,i.g=n.g,i.b=n.b,i}function ht(e,t){if(t)for(const i in t)e[i]=t[i]}let lr=class{constructor(t){this.color=E.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=C.Opaque,ht(this,t)}},Si=class{constructor(t){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=E.main,this.outlineColor=E.outline,this.renderOccluded=C.Opaque,this.hoverOutlineColor=E.selectedOutline,ht(this,t)}apply(t,i){const a=this[t];i.setParameters({color:Xt(a),transparent:t!=="color"||a.a<1,renderOccluded:this.renderOccluded})}},hr=class{constructor(t){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ce(E.main,.5),this.hoverColor=E.main,this.renderOccluded=C.Transparent,this.minSquaredEdgeLength=900,ht(this,t)}apply(t,i){const a=this[t];i.setParameters({color:Xt(a),transparent:a.a<1,renderOccluded:this.renderOccluded})}},pr=class{constructor(t){this.vertex=new Si({color:E.main,outlineColor:E.outline}),this.edge=new Si({color:rr(Ce(E.main,2/3),.5),outlineColor:Ce(E.outline,.5),size:8,collisionPadding:8}),this.selected=new Si({color:E.selected,outlineColor:E.outline}),this.edgeOffset=new hr,ht(this,t)}},Xi=class{constructor(t){this.color=E.selected,this.width=1.5,this.stipplePattern=Li(5),this.stippleOffColor=E.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=E.selected,this.renderOccluded=C.OccludeAndTransparent,ht(this,t)}apply(t){t.color=Xt(this.color),t.width=this.width,t.stipplePattern=this.stipplePattern,t.stippleOffColor=Xt(this.stippleOffColor),t.falloff=this.falloff,t.innerWidth=this.innerWidth,t.innerColor=Xt(this.innerColor),t.renderOccluded=this.renderOccluded}},cr=class{constructor(t){this.color=E.selected,this.size=4,this.outlineSize=1,this.outlineColor=E.outline,this.shape="square",ht(this,t)}apply(t){t.color=Xt(this.color),t.size=this.size,t.outlineSize=this.outlineSize,t.outlineColor=Xt(this.outlineColor),t.primitive=this.shape}},ri=class{constructor(t){this.innerColor=E.selected,this.innerWidth=1,this.glowColor=E.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=ce,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=E.main,ht(this,t)}apply(t,i=1){const a={glowColor:rt.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:rt.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*i,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in t?t.style=a:t.laserlineStyle=a}};class dr{constructor(t){this.outline=new Xi({color:E.outline,renderOccluded:C.OccludeAndTransparentStencil,stippleOffColor:E.selected,stipplePattern:Li(5),width:1.5,innerWidth:0}),this.staged=new Xi({color:E.selected,renderOccluded:C.OccludeAndTransparentStencil,innerColor:E.staged,stippleOffColor:E.outline,stipplePattern:Li(5),width:1.5}),this.shadowStyle=new ri({globalAlpha:ce,glowColor:E.main,glowFalloff:8,glowWidth:8,innerColor:E.selected,innerWidth:1}),ht(this,t)}}let ur=class{constructor(t){this.outline=new cr({color:E.selected,outlineColor:E.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ri({globalAlpha:ce,glowColor:E.main,glowFalloff:1.5,glowWidth:6,innerColor:E.selected,innerWidth:1,radius:2}),ht(this,t)}};class gr extends Xi{constructor(t){super(),this.extensionType=An.GROUND_RAY,ht(this,t)}}let _r=class{constructor(t){this.lineGraphics=new dr,this.pointGraphics=new ur,this.heightPlane=new ri({globalAlpha:ce,glowColor:E.main,glowFalloff:8,glowWidth:8,innerColor:E.selected,innerWidth:1}),this.heightBox=new ri({globalAlpha:ce,glowColor:E.main,glowFalloff:8,glowWidth:8,innerColor:E.selected,innerWidth:0,heightFillColor:E.main}),this.zVerticalLine=new gr({color:Ce(E.main,5*ce/3),falloff:2,innerColor:Ce(E.selected,0),renderOccluded:C.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:An.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,ht(this,t)}},mr=class{constructor(t){this.visualElements=new _r,this.reshapeManipulators=new pr,this.zManipulator=new lr,ht(this,t)}colorToVec4(t){return Xt(t)}};function Xt(e){return ne(rt.toUnitRGBA(e))}const m=new mr;let ae=class extends Fs{constructor(t){super(t),this._attachmentOrigin=Le(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new xt,this._geometry=null,this._width=1,this._color=Ea(1,0,1,1),this._innerWidth=0,this._innerColor=Ea(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=C.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=t.view.spatialReference,this._laserline=new ii({view:t.view}),this.applyProps(t),this.attached=t.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(t){return{view:t,createResources:i=>this._createObject3DResources(i),destroyResources:i=>this._destroyExternalResources(i),recreateGeometry:(i,a)=>{i.geometries.length=0,this._recreateGeometry(a,i.material,i.geometries)}}}createDrapedResourceFactory(t){return{view:t,createResources:()=>this._createDrapedResources(),destroyResources:i=>this._destroyExternalResources(i),recreateGeometry:i=>{i.geometries=this._createRenderGeometriesDraped(i.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&d(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(t){this._laserline.attached=this._laserlineAttached,t&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){Oe(t,this._color)||(Je(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){Oe(t,this._innerColor)||(Je(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const i=d(t)!==d(this._stipplePattern);this._stipplePattern=t,i?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&Oe(t,this._stippleOffColor)||(this._stippleOffColor=t?uo(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this._laserlineAttached,d(t)&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){var a;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=(a=ss(this.object3dResources.resources))==null?void 0:a.geometries;if(!t||t.length===0)return null;J(se,0,0,0);let i=0;for(const n of t)n.computeAttachmentOrigin(Ha)&&(lt(se,se,Ha),i++);return i===0?null:(mt(se,se,1/i),this.view.renderCoordsHelper.fromRenderCoords(se,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){d(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters),d(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return d(this.geometry)&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===C.OccludeAndTransparentStencil?C.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,i,a){this._createRenderGeometries(i,a);for(const n of a)t.addGeometry(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(t){t.geometries=[],t.material.dispose()}_createObject3DResources(t){const i=new Vi(this._materialParameters),a=new Array;return this._recreateGeometry(t,i,a),{material:i,geometries:a,forEach:n=>{n(i),a.forEach(n)}}}_createDrapedResources(){const t=new Vi(this._materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){const i=this.geometry;if(f(i)||f(this.view.basemapTerrain.spatialReference))return[];const a=po(i,this.view.basemapTerrain.spatialReference),n=[];for(const{position:s}of a.lines){const o={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this._isClosed},l=new go(Oa(t,o)),r=gn(vr);pa(r,s),os(l.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1]))),n.push(l)}return n}calculateMapBounds(t){if(f(this.object3dResources.resources))return!1;const i=this.view.renderCoordsHelper;for(const a of this.object3dResources.resources.geometries){const n=a.vertexAttributes.get(Ui.POSITION),s=Hi(n.data.length);rs(n.data,i.spatialReference,0,s,this.view.spatialReference,0,n.data.length/3),pa(t,s)}return!0}_createRenderGeometries(t,i){const a=this.geometry;if(f(a))return;const n=co(a,this.view.elevationProvider,this.view.renderCoordsHelper,Ne.fromElevationInfo(this.elevationInfo??new _n({mode:dn(a,null)}))),s=new Array;for(const{position:o,mapPositions:l}of n.lines){const r={mapPositions:l,attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};i.push(Oa(t,r)),s.push(o)}this._laserline.pathVerticalPlane=s}};const vr=un(),Ha=z(),se=z();let fr=class extends Zs{constructor(t){super(t.view),this._resources=null,this._transform=kt()}get object(){return d(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(t){ls(this._transform,t),d(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(f(this._resources))return;const t=this._resources.object,i=this.view._stage;i.removeMany(t.geometries),t.removeAllGeometries(),this.createGeometries(t),t.visible=this.visible,i.addMany(t.geometries)}createResources(){this.destroyResources();const t=this.view._stage;if(!t)return;const i=new _o({pickable:!1,updatePolicy:mo.SYNC});t.add(i);const a=new vo({castShadow:!1});a.transformation=this._transform,this.createExternalResources(),this.createGeometries(a),t.addMany(a.geometries),this.forEachExternalMaterial(n=>t.add(n)),t.add(a),i.add(a),a.visible=this.visible,this._resources={layer:i,object:a}}destroyResources(){const t=this.view._stage;!f(this._resources)&&t&&(t.remove(this._resources.object),t.remove(this._resources.layer),this.forEachExternalMaterial(i=>{t.remove(i),i.dispose()}),t.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(t){f(this._resources)||(this._resources.object.visible=t)}};function yr(e,t,i,a,n){const s=Hi(3*e.length),o=Hi(s.length);e.forEach((h,u)=>{s[3*u+0]=h[0],s[3*u+1]=h[1],s[3*u+2]=h.length>2?h[2]:0});const l=fo(s,t,0,o,0,s,0,s.length/3,i,a,n),r=l!=null;return{numVertices:e.length,position:s,mapPositions:o,projectionSuccess:r,sampledElevation:l}}class Ua extends fr{constructor(t){super(t),this.view=null,this._renderOccluded=C.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=m.colorToVec4(m.reshapeManipulators.vertex.color),this._size=m.reshapeManipulators.vertex.size,this._outlineColor=m.colorToVec4(m.reshapeManipulators.vertex.outlineColor),this._outlineSize=m.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){Oe(t,this._color)||(Je(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){Oe(t,this._outlineColor)||(Je(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if(f(t)||t.length===0)return[];const i=.5,a=.5,n=yr(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ne.fromElevationInfo(this.elevationInfo)),s=[],o=n.numVertices,l=n.position;for(let r=0;r<o;++r){const h=J(Mr,l[3*r+0],l[3*r+1],l[3*r+2]),u=ka(this._vertexMaterial,i,h),g=ka(this._vertexOutlineMaterial,a,h);s.push({vertexGeometry:u,vertexOutlineGeometry:g})}return s}createGeometries(t){const i=this._createRenderGeometries();for(const{vertexGeometry:a,vertexOutlineGeometry:n}of i)t.addGeometry(a),t.addGeometry(n)}createExternalResources(){this._vertexMaterial=new xa({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Gt.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new xa({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:Gt.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(t){t(this._vertexMaterial),t(this._vertexOutlineMaterial)}}const Mr=z();function ka(e,t,i){return xe(e,t,16,16,{offset:i})}let st=class extends xt.EventedAccessor{constructor(t){super(t),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};p([c({constructOnly:!0})],st.prototype,"graphic",void 0),p([c()],st.prototype,"tracking",void 0),p([c()],st.prototype,"displaying",void 0),p([c()],st.prototype,"isDraped",void 0),st=p([U("esri.views.3d.layers.graphics.GraphicState")],st);let Wt=class extends xo{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:i}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new _n({mode:t,offset:i})}normalizeCtorArgs(t){if(!t.elevationInfo){const i=t.hasZ??!0;return{...t,elevationInfo:hs(i)}}return t}initializeGraphic(t){const i=this._createGraphicState=new st({graphic:t});return et([this.view.maskOccludee(t),this.view.trackGraphicState(i),G(()=>({element:this._outlineVisualElement,isDraped:i.isDraped}),({element:a,isDraped:n})=>{$i(a,s=>s.isDraped=n)},Dt)])}makeDrawOperation(){const{geometryType:t}=this,i=t!=="circle"&&t!=="rectangle";return new Ao({view:this.view,manipulators:this.manipulators,geometryType:wo(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new To(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new $o(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Ge,segmentLabels:i?new oi:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:d(this._createGraphicState)?this._createGraphicState.isDraped:ca(this.hasZ,this.elevationInfo)==="on-the-ground"})}onActiveVertexChanged(t){const{view:i}=this;return d(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[t],this._updateVerticalLineVisualElement(t),null):(this._activeVertexVisualElement=new Ua({view:i,spatialReference:i.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:m.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=m.colorToVec4(m.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new Ki({view:i,extensionType:m.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:C.OccludeAndTransparent}),m.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),Kt(()=>{this._activeVertexVisualElement=L(this._activeVertexVisualElement),this._verticalLineVisualElement=L(this._verticalLineVisualElement)}))}_updateVerticalLineVisualElement(t){const i=this._verticalLineVisualElement;if(f(i))return;const{renderCoordsHelper:a,elevationProvider:n}=this.view;J(oe,t[0],t[1],t[2]),Xa.setFromElevationInfo(this.elevationInfo),oe[2]=ea(oe,n,Xa,a),a.toRenderCoords(oe,this.view.spatialReference,oe)?(i.setStartEndFromWorldDownAtLocation(oe),i.attached=!0):i.attached=!1}onOutlineChanged(t){if(d(this._outlineVisualElement))return this._outlineVisualElement.geometry=t,null;const i=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new ae({view:this.view,geometry:t,elevationInfo:i,isDraped:d(this._createGraphicState)?this._createGraphicState.isDraped:ca(this.hasZ,i)==="on-the-ground",attached:!1}),m.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),m.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Kt(()=>{this._outlineVisualElement=L(this._outlineVisualElement)})}onRegularVerticesChanged(t){return d(this._verticesVisualElement)?(this._verticesVisualElement.vertices=t,null):(this._verticesVisualElement=new Ua({view:this.view,spatialReference:this.view.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:m.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Kt(()=>{this._verticesVisualElement=L(this._verticesVisualElement)}))}};p([c({constructOnly:!0})],Wt.prototype,"elevationInfo",void 0),p([c({constructOnly:!0})],Wt.prototype,"geometryType",void 0),p([c()],Wt.prototype,"type",void 0),p([c({constructOnly:!0})],Wt.prototype,"view",void 0),Wt=p([U("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Wt);const Xa=new Ne,oe=z();function te(e,t=k(e)){return t.mode!=="on-the-ground"&&!(f(e.geometry)||!e.geometry.hasZ)}var _t;(function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"})(_t||(_t={}));var D;(function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"})(D||(D={}));let Ln=class{constructor(){this.grabbingState=_t.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=_t.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator((i,a)=>{if(a===D.TRANSLATE_Z&&(this.zManipulator=i),i instanceof it&&(i.selected&&(this.numSelected===0&&(this.firstSelected=i),this.numSelected++),f(this.firstGrabbedXY)&&i.grabbing&&a===D.TRANSLATE_XY&&(this.firstGrabbedXY=i)),i.grabbing)switch(this.grabbingState|=_t.ANY,a){case D.TRANSLATE_Z:this.grabbingState|=_t.Z;break;case D.TRANSLATE_XY:this.grabbingState|=_t.XY}})}};function br(e){const{view:t,graphic:i}=e,a=new st({graphic:i}),n=Sr(e,a),s=[n,xr(e,n.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:n.visualElement,remove:()=>et(s).remove()}}function Sr(e,t){const{view:i,graphic:a}=e,n=new ae({view:i,geometry:Yi(a)?a.geometry:null,elevationInfo:k(a),attached:!1});m.visualElements.lineGraphics.shadowStyle.apply(n);const s=()=>{n.attached=t.displaying};m.visualElements.lineGraphics.outline.apply(n);const o=[G(()=>t.displaying,s),G(()=>t.isDraped,l=>{n.isDraped=l}),t.on("changed",()=>n.geometry=Yi(a)?a.geometry:null),Ht(n)];return s(),{visualElement:n,remove:()=>et(o).remove()}}function xr(e,t,i){const{graphic:a,view:n}=e,s=[],o=k(a),l=o.mode==="on-the-ground"||!o.offset&&o.mode!=="absolute-height",r=new Ln,h=new Ki({view:n,extensionType:m.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:C.OccludeAndTransparent});m.visualElements.pointGraphics.shadowStyle.apply(h);const u=ci(m.visualElements.heightPlaneAngleCutoff),g=new ii({view:n,attached:!1,angleCutoff:u});m.visualElements.heightPlane.apply(g);let _=1,y=1;const M=()=>{if(r.update(e),!i.displaying||l&&(i.isDraped||!Yi(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(g.attached=!1);t.laserlineEnabled=!0;const S=r.grabbingState&_t.XY?m.visualElements.laserlineAlphaMultiplier:1;S!==_&&(_=S,m.visualElements.lineGraphics.shadowStyle.apply(t,S),m.visualElements.pointGraphics.shadowStyle.apply(h,S));const I=r.grabbingState&_t.Z?m.visualElements.laserlineAlphaMultiplier:1;I!==y&&(y=I,m.visualElements.heightPlane.apply(g,I)),wr(h,r),Or(e,t,g,r)};m.visualElements.zVerticalLine.apply(h),s.push(i.on("changed",M),G(()=>i.displaying,M),t.events.on("attachment-origin-changed",M),Ht(h),Ht(g));const v=[],b=()=>{et(v).remove(),v.length=0,e.forEachManipulator(S=>v.push(S.events.on("grab-changed",M))),e.forEachManipulator(S=>v.push(S.events.on("select-changed",M))),M()};return b(),s.push(e.onManipulatorsChanged(b),mn(()=>et(v))),et(s)}function wr(e,t){const i=t.numSelected===1?t.firstSelected:t.numSelected>1&&d(t.firstGrabbedXY)?t.firstGrabbedXY:null;d(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}function Or(e,t,i,a){if(a.numSelected>0){J(Bt,0,0,0);let n=0;e.forEachManipulator((s,o)=>{o===D.TRANSLATE_XY&&s.selected&&s instanceof it&&(lt(Bt,Bt,s.renderLocation),n++)}),n>0?(i.heightManifoldTarget=mt(Bt,Bt,1/n),i.attached=!0):i.attached=!1}else{const n=t.attachmentOrigin;d(n)&&e.view.renderCoordsHelper.toRenderCoords(n,Bt)?(i.heightManifoldTarget=Bt,i.attached=!0):i.attached=!1}}function Yi(e){return d(e.geometry)&&(e.geometry.type==="polygon"||e.geometry.type==="polyline")}const Bt=z();function Er(e){const{view:t,graphic:i}=e,a=new st({graphic:i}),n=[],s=Tr(e,a,n);return Ar(e,a,n,s),n.push(t.trackGraphicState(a)),{visualElement:s,remove(){et(n).remove()}}}function Ar(e,t,i,a){const{view:n,graphic:s}=e,o=new Ki({view:n,extensionType:m.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:C.OccludeAndTransparent});m.visualElements.zVerticalLine.apply(o);const l=new ii({view:n,intersectsLineInfinite:!0,attached:!1});m.visualElements.pointGraphics.shadowStyle.apply(l);const r=ci(m.visualElements.heightPlaneAngleCutoff),h=new ii({view:n,attached:!1,angleCutoff:r});m.visualElements.heightPlane.apply(h);const u=k(e.graphic),g=Ne.fromElevationInfo(u),_=u.mode==="on-the-ground"||!u.offset&&u.mode!=="absolute-height",y=new Ln;let M=1,v=1;const b=()=>{y.update(e);const S=sa(s),I=_&&(t.isDraped||f(S)||!S.hasZ);let N=!0;if(!I&&d(S)){const T=ea(S,n.elevationProvider,g,n.renderCoordsHelper);J(ut,S.x,S.y,T),da(ut,S.spatialReference,ut,n.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(ut),l.intersectsWorldUpAtLocation=ut}else N=!1;const pt=y.grabbingState&_t.Z?m.visualElements.laserlineAlphaMultiplier:1;pt!==M&&(M=pt,m.visualElements.heightPlane.apply(h,pt));const X=gn(Gr);!I&&t.displaying&&a.calculateMapBounds(X)&&da(ps(X,ut),n.spatialReference,ut,n.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=ut,h.attached=!0):h.attached=!1;const Y=y.grabbingState&_t.XY?m.visualElements.laserlineAlphaMultiplier:1;Y!==v&&(v=Y,m.visualElements.pointGraphics.shadowStyle.apply(l,Y));const ft=N&&t.displaying&&!I;l.attached=ft,o.attached=ft};i.push(G(()=>[t.displaying,t.isDraped],b),t.on("changed",b)),e.forEachManipulator(S=>{i.push(S.events.on("grab-changed",b))}),i.push(Ht(l)),i.push(Ht(o)),i.push(Ht(h)),b()}function Tr(e,t,i){const{view:a,graphic:n}=e,s=new Bs({view:a,geometry:sa(n),elevationInfo:k(n),attached:!1});return $r(e,s,t,i),i.push(Ht(s)),s}function sa(e){const t=e.geometry;return f(t)?null:t.type==="point"?t:t.type==="mesh"?t.anchor.clone():null}function $r(e,t,i,a){const n=()=>t.attached=i.displaying;Dr(e,t,i,a),m.visualElements.pointGraphics.outline.apply(t),a.push(G(()=>i.displaying,n,Dt))}function Dr(e,t,i,a){const{view:n,graphic:s}=e;let o=null;const l=h=>{d(o)&&(o.remove(),o=null),i.isDraped&&d(h)&&(o=Rr(n,h,()=>{t.geometry=h}))},r=()=>{const h=sa(s);l(h),t.geometry=h};a.push(i.on("changed",r),mn(()=>o)),r()}function Rr(e,t,i){const a=e.elevationProvider.spatialReference;cs(t,ut,a);const n=ut[0],s=ut[1];return e.elevationProvider.on("elevation-change",o=>{vn(o.extent,n,s)&&i()})}const ut=z(),Gr=un();function vi(e){switch(R(e.graphic.geometry).type){case"point":case"mesh":return Er(e);case"polygon":case"polyline":return br(e);default:return null}}const Ir=[1,.5,0],Vn=128,St=70,Cr=80,Nn=.02,Pr=54,zr=100,Hn=Math.ceil(St/3*2),qt=160,xi=.5,wi=24,re=9,Lr=qt+30,Ya=qt+53,Vr=60,Nr=23,Hr=5*Math.PI/12,Ur=1*Math.PI/3,Fa=10,Za=.2,Ba=30,ja=53,Wa=.2,qa=.3,kr=200,Xr=3,Yr=1e6;let Ue=class{constructor(){this._available=!0}set location(t){this._forEachManipulator3D(i=>i.location=t)}set elevationAlignedLocation(t){this._forEachManipulator3D(i=>i.elevationAlignedLocation=t)}set elevationInfo(t){this._forEachManipulator3D(i=>i.elevationInfo=t)}get renderLocation(){let t;return this._forEachManipulator3D(i=>{t||(t=i.renderLocation)}),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D(i=>i.available=t)}get hovering(){return this.someManipulator(t=>t.hovering)}get grabbing(){return this.someManipulator(t=>t.grabbing)}get dragging(){return this.someManipulator(t=>t.dragging)}hasManipulator(t){return this.someManipulator(i=>i===t)}someManipulator(t){let i=!1;return this.forEachManipulator(a=>{!i&&t(a)&&(i=!0)}),i}_forEachManipulator3D(t){this.forEachManipulator((i,a)=>{i instanceof it&&t(i,a)})}};function fi(e,t,i,a){const n=e.graphic,s=(o,l)=>t({action:o,graphic:n,dxScreen:l.screenDeltaX,dyScreen:l.screenDeltaY});return i((o,l,r)=>(l.next(h=>(h.action==="start"&&s("start",h),h)).next(Go(n,a)).next(h=>{switch(h.action){case"start":case"update":(h.translationX||h.translationY||h.translationZ)&&s("update",h);break;case"end":s("end",h)}return h}),{steps:l,cancel:r=r.next(Io(n)).next(h=>(s("end",{screenDeltaX:0,screenDeltaY:0}),h))}))}function Un(e){if(f(e)||e.type!=="polyline"&&e.type!=="polygon")return 0;const t=(e.type==="polyline"?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}function li(e){if(f(e)||f(e.axis))return 1;const{mapStart:t,mapEnd:i,axis:a}=e,n=[i.x-t.x,i.y-t.y];return n[0]*a[0]+n[1]*a[1]>0?1:-1}let Fr=class extends Ue{constructor(t){super(),this._handles=new _e,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=St,this._updateAfterDrag=!1,this.events=new xt,this._tool=t.tool,this._view=t.view,t.radius!=null&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this._handles=L(this._handles),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:i}of this._arrowManipulatorInfos)t(i,D.TRANSLATE_XY)}createGraphicDragPipeline(t,i,a){const n=i.graphic,s=k(n),o=R(n.geometry).spatialReference;return fi(i,a,l=>this.createDragPipeline((r,h,u,g,_)=>({steps:h,cancel:u}=t(r,h,u,g,_),l(r,h,u)),s,o,n),this._view.state.viewingMode)}createDragPipeline(t,i,a,n){return et(this._arrowManipulatorInfos.map(({manipulator:s},o)=>vt(s,(l,r,h,u,g)=>{const _=r.next(y=>({...y,manipulatorType:D.TRANSLATE_XY})).next(Te(this._view,l.elevationAlignedLocation)).next(ta(this._view,l.elevationAlignedLocation,i,a,n)).next(Co(l.location,this.angle+(o+1)*Math.PI*.5)).next(me());t(l,_,h,u,g)})))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:t,transform:i},a){const n=this._radius/St,s=Pr*n,o=s*Math.sqrt(3)/2,l=ai(this._opaqueMaterial,o,s/2,s/2,Nn);Rn(l,ua(q.get(),J(A.get(),0,-o/3,0))),t.renderObjects=[new x(l,w.Focused),new x(l.instantiate({material:this._transparentMaterial}),w.Unfocused)],t.radius=o/3*2*1.2;const r=Wi(q.get(),a*Math.PI/2),h=ua(q.get(),J(A.get(),0,zr*n,0));Ut(i,r,h)}_createManipulators(){for(let t=0;t<4;t++){const i=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(i)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,i=fn(q.get(),t,V(0,0,1));if(f(i))return;const a=Qe(q.get(),J(A.get(),this.displayScale,this.displayScale,this.displayScale)),n=Ut(q.get(),a,i);for(const s of this._arrowManipulatorInfos){const o=Ut(q.get(),n,s.transform);s.manipulator.modelTransform=o}}_createArrowManipulator(t){const i=new it({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:V(0,0,1)}}),a={manipulator:i,transform:kt()};return this._updateArrowManipulator(a,t),this._handles.add(i.events.on("drag",n=>{this._updateAfterDrag&&n.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}_createMaterial(t=1){const i=rt.toUnitRGBA(E.main);return i[3]*=t,new Jt({color:i,transparent:t!==1,cullFace:Gt.Back,renderOccluded:C.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:t})=>t)}}},Zr=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&d(this._lastDragEvent)&&d(this._next)){const i=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(d(a)){const n={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:t===!0?a:i,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(n)}}this._enabled=t}_snap(t){const i=d(this._view)?this._view.toMap(t,{exclude:[]}):null;return d(i)&&d(this._view)&&(i.z=ds(i,this._view,this._elevationInfo)),i}createDragEventPipelineStep(t,i){this._view=t,this._elevationInfo=i,this._lastDragEvent=null;const a=new Pn;return this._next=a,[n=>{if(this._lastDragEvent=n.action!=="end"?{...n}:null,this._enabled){const s=this._snap(n.screenEnd);return d(s)?{action:n.action,mapStart:n.mapStart,mapEnd:s,screenStart:n.screenStart,screenEnd:n.screenEnd}:null}return{action:n.action,mapStart:n.mapStart,mapEnd:n.mapEnd,screenStart:n.screenStart,screenEnd:n.screenEnd}},a]}},Br=class extends Ue{constructor(t){super(),this._snapToScene=new Zr,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=St,this._view=t.view,this._tool=t.tool,t.snapToScene!=null&&(this.snapToScene=t.snapToScene),t.radius!=null&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,D.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,i,a){const n=i.graphic,s=k(n),o=R(n.geometry).spatialReference;return fi(i,a,l=>this.createDragPipeline((r,h,u,g,_)=>({steps:h,cancel:u}=t(r,h,u,g,_),l(r,h,u)),s,o,n),this._view.state.viewingMode)}createDragPipeline(t,i,a,n){const s=this._view;return vt(this._manipulator,(o,l,r,h,u)=>{const g=l.next(Te(s,o.elevationAlignedLocation)).next(ta(s,o.elevationAlignedLocation,i,a,n)).next(...this._snapToScene.createDragEventPipelineStep(s,i)).next(_=>({..._,manipulatorType:D.TRANSLATE_XY})).next(me());t(o,g,r,h,u)})}_updateManipulatorTransform(){const t=Qe(q.get(),J(A.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new it({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:V(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=yo(this._discMaterial,Nn,1,Vn,V(0,0,1),V(0,0,0));t.transformation=Qe(kt(),V(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new x(t,w.Focused),new x(t.instantiate({material:this._discMaterialTransparent}),w.Unfocused)],this._manipulator.radius=Cr*(this._radius/St)}_createMaterial(t=1){const i=rt.toUnitRGBA(E.main);return i[3]*=t,new Jt({color:i,transparent:t!==1,cullFace:Gt.Back,renderOccluded:C.Transparent})}get test(){return{discManipulator:this._manipulator}}},jr=class extends Ue{constructor(t){super(),this._radius=St,this.events=new xt,this._tool=t.tool,this._view=t.view,t.radius!=null&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()})}forEachManipulator(t){t(this._manipulator,D.TRANSLATE_Z)}createGraphicDragPipeline(t,i,a){const n=R(i.graphic.geometry).spatialReference;return fi(i,a,s=>this.createDragPipeline((o,l,r,h,u)=>({steps:l,cancel:r}=t(o,l,r,h,u),s(o,l,r)),n),this._view.state.viewingMode)}createDragPipeline(t,i){const a=this._view;return vt(this._manipulator,(n,s,o,l,r)=>{const h=s.next(u=>({...u,manipulatorType:D.TRANSLATE_Z})).next(Tn(a,n.renderLocation,i)).next(me());t(n,h,o,l,r)})}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/St,i=m.zManipulator.height*t,a=m.zManipulator.coneHeight*t,n=m.zManipulator.coneWidth*t,s=m.zManipulator.width*t,o=[V(0,0,0),V(0,0,i)],l=[V(0,0,0),V(0,0,i+a)],r=S=>{const I=kt();if(Ri(I,I,[0,0,i]),yn(I,I,Math.PI/2),S){const N=1+2*S/n;di(I,I,[N,N,N])}return I},h=r(0),u=(S,I)=>{const N=gs(m.zManipulator.color,I);return[N.r/255,N.g/255,N.b/255,m.zManipulator.color.a*S]},g=$t(u(1,.25),C.Occlude),_=$t(u(1,0),C.Occlude),y=$t(u(.7,0),m.zManipulator.renderOccluded),M=$t(u(.85,0),m.zManipulator.renderOccluded),v=Mo(g,o,s/2,16,!1),b=Ni(g,a,n/2,16,!1);b.transformation=h,this._manipulator.renderObjects=[new x(b,w.Unfocused),new x(v,w.Unfocused),new x(b.instantiate({material:_}),w.Focused),new x(v.instantiate({material:_}),w.Focused),new x(b.instantiate({material:y}),w.Unfocused),new x(v.instantiate({material:y}),w.Unfocused),new x(b.instantiate({material:M}),w.Focused),new x(v.instantiate({material:M}),w.Focused)],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const t=new it({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=i=>{const a=this._view.state.camera,n=Ja;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,n);const s=us(a.eye,n),o=a.computeRenderPixelSizeAtDist(s),l=B(le,n,a.eye);ie(l,l);const r=Wr;this._view.renderCoordsHelper.worldUpAtPosition(Ja,r);const h=Math.abs(Di(l,r)),u=de(le,l,r),g=de(le,u,r),_=Gi(h,.01,1),y=1-Math.sqrt(1-_*_)/_/a.fullWidth,M=this._radius/St,v=m.zManipulator.width*M;mt(g,ie(g,g),(1/y-1)*s+o*v),i[12]-=le[0],i[13]-=le[1],i[14]-=le[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}};const Ja=z(),le=z(),Wr=z();let ee=class extends Ue{constructor(t){super(),this._handles=new _e,this._interactive=!0;const{tool:i,view:a,snapToScene:n,radius:s}=t;this._view=a,this.xyManipulation=new Br({tool:i,view:a,snapToScene:n,radius:s}),this.xyAxisManipulation=new Fr({tool:i,view:a,radius:s}),this.zManipulation=new jr({tool:i,view:a,radius:s}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(o=>this._handles.add(o.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,i,a){return et([this.xyManipulation.createGraphicDragPipeline((n,s,o,l,r)=>t(O.XY,n,s,o,l,r),i,a),this.xyAxisManipulation.createGraphicDragPipeline((n,s,o,l,r)=>t(O.XY_AXIS,n,s,o,l,r),i,a),this.zManipulation.createGraphicDragPipeline((n,s,o,l,r)=>t(O.Z,n,s,o,l,r),i,a)])}createDragPipeline(t,i,a,n){return et([this.xyManipulation.createDragPipeline((s,o,l,r,h)=>t(O.XY,s,o,l,r,h),i,a,n),this.xyAxisManipulation.createDragPipeline((s,o,l,r,h)=>t(O.XY_AXIS,s,o,l,r,h),i,a,n),this.zManipulation.createDragPipeline((s,o,l,r,h)=>t(O.Z,s,o,l,r,h),a)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator(i=>t(i,D.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(i=>t(i,D.TRANSLATE_XY)),this.zManipulation.forEachManipulator(i=>t(i,D.TRANSLATE_Z))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator(i=>i.focused)||this.xyAxisManipulation.someManipulator(i=>i.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,i=this.xyManipulation;if(Mn("esri-mobile"))return;const a=[];i.forEachManipulator(s=>a.push(s)),t.forEachManipulator(s=>a.push(s));const n=()=>{const s=[];this._xyAxisVisible||t.forEachManipulator(o=>s.push(o.disableDisplay())),this._handles.remove(Qa),this._handles.add(s,Qa)};for(const s of a)this._handles.add(s.events.on("focus-changed",n));this._view.inputManager&&this._handles.add(ue(()=>{var s;return(s=this._view.inputManager)==null?void 0:s.latestPointerType},n)),n()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator(i=>{i.interactive=!t&&this._interactive||i.grabbing})}static radiusForSymbol(t){const i=d(t)&&t.type==="point-3d"&&t.symbolLayers;return i&&i.length>0&&i.some(a=>a.type==="icon")?Hn:St}};const Qa="disable-xy-axis-display";var O;(function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"})(O||(O={}));let oa=class extends Ue{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,D.TRANSLATE_XY)}createGraphicDragPipeline(t){return fi(this._graphicState,t,i=>this.createDragPipeline(i),this._view.state.viewingMode)}createDragPipeline(t){const i=this._view,a=this._graphicState.graphic,n=d(a.geometry)?a.geometry.spatialReference:null;return vt(this._manipulator,(s,o,l,r,h)=>{const u=o.next(js(h,i,a,n)).next(he()).next(me());t(s,u,l,r,h)})}_createManipulator(){const t=this._view,i=this._graphicState.graphic;this._manipulator=new Vo({graphic:i,view:t,selectable:!0,cursor:"move"})}};class qr{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class Jr{constructor(t,i,a){this.dx=t,this.dy=i,this.allGraphics=a,this.type="graphic-move"}}let Ka=class{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}},bt=class extends bn(xt.EventedMixin(gi)){constructor(t){super(t),this.graphics=new _s,this.enableZ=!0,this.tooltipOptions=new Ft,this.type="move-3d",this._tooltip=null}initialize(){const{graphics:t,view:i}=this;this.addHandles([t.on("change",()=>this._refreshManipulators()),G(()=>this.tooltipOptions.enabled,a=>{this._tooltip=a?new Ve({view:i}):L(this._tooltip)},qi)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=L(this._tooltip),this._moveManipulation=L(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){var i;this.handles.removeAll(),(i=this._moveManipulation)==null||i.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter(a=>ms(a)===Sn.SUPPORTED).map(a=>new Qr(a));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map(a=>this.view.trackGraphicState(a.state))),this._updateMoveManipulation(t))}_createManipulators(t){for(const i of t){const a=i.state;i.manipulationXY=new oa({tool:this,view:this.view,graphicState:a}),i.manipulationXY.forEachManipulator(n=>this.handles.add([n.events.on("immediate-click",s=>{this.emit("immediate-click",{...s,graphic:a.graphic}),s.stopPropagation()}),n.events.on("grab-changed",({action:s})=>{const{tooltipOptions:o,_tooltip:l}=this;f(l)||(s==="start"?l.info=new Ie({tooltipOptions:o}):l.clear())})])),this.handles.add(i.manipulationXY.createDragPipeline((n,s,o,l)=>this._buildDragEventPipeline(t,O.XY,n,s,o,l)))}this._createMoveManipulation(t)}_createMoveManipulation(t){const i=new ee({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:t.length===1?ee.radiusForSymbol(t[0].graphic.symbol):St});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator(o=>{this.handles.add(o.events.on("immediate-click",l=>{i.zManipulation.hasManipulator(o)||this.graphics.length!==1||this.emit("immediate-click",{...l,graphic:this.graphics.getItemAt(0)}),l.stopPropagation()}))});const a=o=>l=>{this.handles.add(l.events.on("focus-changed",({action:r})=>{const h=this._tooltip;f(h)||(r==="focus"?this._updateMoveTooltip(t,o):h.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(a(O.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(O.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(O.Z));const n=()=>this._updateMoveManipulation(t);for(const o of t)this.handles.add([o.state.on("changed",n),G(()=>o.state.displaying,n)]);const s=t[t.length-1];this.handles.add(s.state.on("changed",()=>this._updateMoveManipulationAngle(s))),this.handles.add(i.createDragPipeline((o,l,r,h,u)=>this._buildDragEventPipeline(t,o,l,r,h,u),k(s.graphic),R(s.graphic.geometry).spatialReference,s.graphic)),this._updateMoveManipulationAngle(s)}_createVisualElements(t){for(const i of t){const a=i.graphic,n=vi({view:this.view,graphic:a,forEachManipulator:s=>{var o;(o=i.manipulationXY)==null||o.forEachManipulator(s),this._moveManipulation.forEachManipulator(s)},onManipulatorsChanged:()=>Kt()});f(n)||(i.geometryRepresentation=n.visualElement,i.geometryRepresentation instanceof ae&&this.handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",()=>{i.state.isDraped||this._updateMoveManipulation(t)}),G(()=>i.state.isDraped,()=>this._updateMoveManipulation(t))]),this.handles.add(n))}}_updateMoveManipulationAngle(t){this._moveManipulation.angle=Un(t.graphic.geometry)}_updateMoveManipulation(t){const i=Le(0,0,0,this.view.spatialReference);let a=0,n=!1;const s=this._moveManipulation;for(const o of t){if(!o.state.displaying)continue;const l=o.state.graphic;this.enableZ&&te(l)&&(n=!0);const r=o.geometryRepresentation instanceof ae&&!o.state.isDraped?o.geometryRepresentation.attachmentOrigin:Pi(this.view,l);if(d(r)){const{x:h,y:u,z:g}=r;i.x+=h,i.y+=u,g&&(i.z??(i.z=0),i.z+=g),a++}}a>0?(i.x/=a,i.y/=a,i.z??(i.z=0),i.z/=a,s.location=i,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=n):s.available=!1}_buildDragEventPipeline(t,i,a,n,s,o){const l=[],r=[];let h=null,u=null;const g=()=>{for(const _ of l)_.dragging=!1;l.length=0,r.length=0,h=null,u=null,this._moveManipulation.interactive=!0};if(t.length===1&&i===O.XY){const _=t[0].graphic;({steps:n,cancel:s}=this._buildSnappingPipelineSteps(_,k(_),n,s,o))}return s=s.next(_=>u==null?void 0:u(_)).next(()=>(this.emit("graphic-move-stop",new Ka(r)),this.destroyed||g(),null)),{steps:n=n.next(_=>{var y,M;if(_.action==="start"){l.length=0,r.length=0;for(const v of t)v.dragging||!((y=v.manipulationXY)!=null&&y.hasManipulator(a))&&((M=v.manipulationXY)!=null&&M.grabbing)||(l.push(v),r.push(v.graphic),v.dragging=!0);if(r.length!==0&&(this._moveManipulation.interactive=!1,h=Po(r,this.view.state.viewingMode),u=zo(r),this.emit("graphic-move-start",new qr(r)),this.destroyed))return null}return r.length!==0?_:null}).next(_=>h==null?void 0:h(_)).next(_=>(this._updateMoveTooltip(t,i,_),_)).next(_=>{switch(_.action){case"start":case"update":if(_.translationX||_.translationY||_.translationZ){const y=this.view.toScreen(_.mapStart),M=this.view.toScreen(_.mapEnd),v=M.x-y.x,b=M.y-y.y;if(this.emit("graphic-move",new Jr(v,b,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Ka(r)),this.destroyed)return null;g()}return null}),cancel:s}}_updateMoveTooltip(t,i,a){const{tooltipOptions:n,_tooltip:s}=this;if(f(s))return;s.clear();const o=t.length===0?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(i){case O.XY:s.info=new Ie({tooltipOptions:n}),this._updateMoveTooltipDistance(s.info,a,(l,r)=>Rt(l,r,o));break;case O.XY_AXIS:s.info=new ia({tooltipOptions:n}),this._updateMoveTooltipDistance(s.info,a,(l,r)=>{const h=Rt(l,r,o);return ei(h,li(a))});break;case O.Z:s.info=new mi({tooltipOptions:n}),this._updateMoveTooltipDistance(s.info,a,ti)}}_updateMoveTooltipDistance(t,i,a){if(d(i)&&i.action!=="end"){const{mapStart:n,mapEnd:s}=i,o=a(n,s);t.distance=d(o)?o:De}}_buildSnappingPipelineSteps(t,i,a,n,s){const o=t.geometry;if(f(o)||o.type!=="point"&&o.type!=="mesh")return{steps:a,cancel:n};const l=(o.type==="point"?o:o.anchor).clone(),r=new si({elevationInfo:i,pointer:s,editGeometryOperations:_i.fromGeometry(l,this.view.state.viewingMode),visualizer:new Ge,excludeFeature:t}),h=this.snappingManager,{snappingStep:u,cancelSnapping:g}=ni({snappingContext:r,snappingManager:h,updatingHandles:this.updatingHandles});return n=n.next(g),{steps:a=a.next(_=>(l.z=vs(this.view,l,k(t),{mode:"absolute-height",offset:0}),{..._,snapOrigin:r.coordinateHelper.pointToVector(l)})).next(...u),cancel:n}}get test(){return{tooltip:this._tooltip}}};p([c({constructOnly:!0,nonNullable:!0})],bt.prototype,"view",void 0),p([c()],bt.prototype,"graphics",void 0),p([c({constructOnly:!0,nonNullable:!0})],bt.prototype,"enableZ",void 0),p([c({constructOnly:!0,type:Ft})],bt.prototype,"tooltipOptions",void 0),p([c({constructOnly:!0})],bt.prototype,"snappingManager",void 0),p([c()],bt.prototype,"type",void 0),p([c()],bt.prototype,"updating",null),bt=p([U("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],bt);let Qr=class{constructor(t){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new st({graphic:t})}get graphic(){return this.state.graphic}};function tn(e,t,i){const a=i.mode==="on-the-ground"?Ia.XY:Ia.XYZ;return new No(e,a,t,0)}function en(e,t,i){const a=z();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;const n=an(e,t,He(i.plane)),s=an(e,t,i.edgeDirection);if(f(n)||f(s))return null;const o=de(z(),n,s);return aa(a,o,na())}function an(e,t,i){const a=Le(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=z(),s=z();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(a,s)?xn(s,n,s):null}function Kr(e,t,i){const a=He(e),n=xn(z(),t,i),s=de(z(),n,a),o=de(z(),n,s);return bo(n[0],n[1],n[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,0,0,0,1)}function tl(e,t,i){const a=i.projectToRenderScreen(e,ga()),n=i.projectToRenderScreen(t,ga());return d(a)&&d(n)?fs(B(a,a,n)):0}let Nt=class extends ui{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=De,this.area=null,this.totalLength=null}};p([c()],Nt.prototype,"type",void 0),p([c()],Nt.prototype,"distance",void 0),p([c()],Nt.prototype,"area",void 0),p([c()],Nt.prototype,"totalLength",void 0),Nt=p([U("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],Nt);let H=class extends xt.EventedMixin(Ji){constructor(e){super(e),this._vertexManipulatorMaterial=$t(m.colorToVec4(m.reshapeManipulators.vertex.color),m.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=fe(m.colorToVec4(m.reshapeManipulators.vertex.outlineColor),m.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=fe(m.colorToVec4(m.reshapeManipulators.vertex.hoverOutlineColor),m.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=$t(m.colorToVec4(m.reshapeManipulators.edge.color),m.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=fe(m.colorToVec4(m.reshapeManipulators.edge.outlineColor),m.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=$t(m.colorToVec4(m.reshapeManipulators.edgeOffset.color),m.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=$t(m.colorToVec4(m.reshapeManipulators.edgeOffset.hoverColor),m.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=$t(m.colorToVec4(m.reshapeManipulators.selected.color),m.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=fe(m.colorToVec4(m.reshapeManipulators.selected.outlineColor),m.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=fe(m.colorToVec4(m.reshapeManipulators.selected.hoverOutlineColor),m.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._manipulatorHandles=new _e,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=P.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new st({graphic:e});this._tooltip=new Ve({view:t}),this.addHandles([G(()=>i.displaying,a=>{for(const n of this._manipulatorInfos)n.manipulator.available=a}),G(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:a,enabled:n,edgeOffsetEnabled:s})=>{d(a)&&(a.visible=n,a.edgeDistance=s?"far":"default")},Dt),ue(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),Dt),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=L(this._segmentLabels),this._tooltip=L(this._tooltip),this._removeManipulators()}get inputGeometry(){return d(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter(t=>t.manipulator.selected&&t.type==="vertex");this._removeVertices(e)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=L(this._moveManipulation),this._graphicMoveManipulation=L(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(f(this._editGeometryOperations))return;const t=k(this.graphic);for(const i of this._editGeometryOperations.data.components){const a=e==null?void 0:e.byComponentIndex.get(i.index);for(const n of i.vertices){const s=a==null?void 0:a.has(n.index);this._createVertexOrEdgeManipulator(n,t,s)}for(const n of i.edges)this._createVertexOrEdgeManipulator(n,t)}this._createGraphicMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}get canRedo(){return d(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return d(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(f(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return d(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(f(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return d(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(e){const t={byComponentIndex:new Map};if(d(e)&&d(this.inputGeometry)&&ys(e,this.inputGeometry)){for(const i of this._manipulatorInfos)if(i.type==="vertex"&&i.manipulator.selected){const{index:a,component:{index:n}}=i.handle,{byComponentIndex:s}=t,o=s.get(n)||new Set;o.add(a),s.set(n,o)}}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=L(this._editGeometryOperations),this._segmentLabels=L(this._segmentLabels),f(e)||(this._editGeometryOperations=_i.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(t),this._segmentLabels=new oi({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:k(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(e,t){if(t.action==="end")return t;let i=0;const a=[],n=this._manipulatorInfos.some(o=>o.type==="vertex"&&o.manipulator.selected),s=e===pe.SELECTED_OR_ALL&&n;for(const o of this._manipulatorInfos)o.type==="vertex"&&(o.manipulator.grabbing||s&&!o.manipulator.selected||a.push(o),i++);if(a.length===0)return t;if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(P.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(P.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((e,t)=>t.type==="vertex"&&t.manipulator.selected?e+1:e,0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(P.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const n=[];for(const s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&n.push(s);this._moveVertices(n,e,Tt.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case P.NONE:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case P.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case P.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case P.MOVING:switch(this._reshapeEventState){case P.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case P.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case P.RESHAPING:switch(this._reshapeEventState){case P.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case P.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulation(){const{tool:e,view:t}=this,i=this._graphicState;if(this._graphicMoveManipulation=new oa({tool:e,view:t,graphicState:i}),this.enableMoveGraphic){let a=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((n,s,o)=>{s.next(l=>this._trackNumDragging(l)).next(l=>(l.action==="start"&&(a=R(this._editGeometryOperations).createUndoGroup()),l)).next(l=>this._perGraphicManipulatorDragAction(pe.ALL,l)).next(l=>(this._updateTranslateGraphicTooltip(O.XY,l),l)).next(l=>{l.action==="end"&&(this._tooltip.clear(),a=Pt(a))}),o.next(()=>this._onDragCancel(!0,()=>a=Pt(a)))})),this._graphicMoveManipulation.forEachManipulator(n=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(n,!1)))}else this._graphicMoveManipulation.forEachManipulator(a=>{a.grabbable=!1,a.cursor=null});this._graphicMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add(a.events.on("immediate-click",n=>{this._manipulatorInfos.some(s=>s.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...n,graphic:this.graphic}),n.stopPropagation()})))}_createMoveManipulation(e){const{graphic:t,handles:i,tool:a,view:n}=this,s=this._graphicState;this._moveManipulation=new ee({tool:a,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&te(t),snapToScene:!1,radius:ee.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator(r=>i.add([r.events.on("immediate-click",h=>{this._moveManipulation.zManipulation.hasManipulator(r)||this._manipulatorInfos.some(u=>u.manipulator.selected)||this.emit("immediate-click",{...h,graphic:t}),h.stopPropagation()}),this._watchAndUpdateGrabState(r,!1)]));const o=r=>h=>{i.add(h.events.on("focus-changed",({action:u})=>{u==="focus"&&this._tooltipOptions.enabled?this._updateTranslateTooltip(r):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(o(O.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(o(O.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(o(O.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const l=R(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline((r,h,u,g,_)=>{const{snappingStep:y,cancelSnapping:M}=ni({predicate:v=>!!v.info,snappingManager:a.snappingManager,snappingContext:new si({editGeometryOperations:R(this._editGeometryOperations),elevationInfo:e,pointer:_,excludeFeature:t,visualizer:new Ge}),updatingHandles:this.updatingHandles,useZ:!1});return g=g.next(v=>(this._onDragCancel(),v)).next(M),{steps:u=u.next(v=>this._trackNumDragging(v)).next(v=>{const b=this._manipulatorInfos.filter(S=>S.type==="vertex"&&S.manipulator.selected);return v.manipulatorType===D.TRANSLATE_XY&&b.length===1?{...v,info:b[0],snapOrigin:b[0].handle.pos}:v}).next(Ga(this.view,e,t)).next(...y).next(he()).next(v=>this._perGraphicManipulatorDragAction(pe.SELECTED_OR_ALL,v)).next(v=>(this._updateTranslateTooltip(r,v),v)),cancel:g}},e,l,t),G(()=>s.displaying,()=>this._updateMoveManipulationPosition(),Dt),s.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),G(()=>s.isDraped,r=>{this._updateMoveManipulationPosition();const h="align-move-manipulation";r?i.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),h):i.remove(h)},Dt)])}_createVisualElements(){const{graphic:e,view:t}=this,i=vi({view:t,graphic:e,forEachManipulator:a=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(a),this._moveManipulation.forEachManipulator(a);for(const n of this._manipulatorInfos)a(n.manipulator,D.TRANSLATE_XY)}},onManipulatorsChanged:a=>this.on("manipulators-changed",a)});d(i)&&(this._outlineVisualElement=i.visualElement instanceof ae?i.visualElement:null),d(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=k(this.graphic)){var y,M;const i=m.reshapeManipulators.edgeOffset,a=i.size/2,n=a+i.collisionPadding,s=a/n,o=s*Math.sqrt(3)/2;f(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=ai(this._edgeOffsetManipulatorMaterial,o,s/2,s/2,i.height,i.offset)),f(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=ai(this._edgeOffsetManipulatorMaterial,-o,s/2,s/2,i.height,-i.offset));const l=[new x(this._edgeOffsetManipulatorGeometryInside.instantiate(),w.Unfocused),new x(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),w.Focused),new x(this._edgeOffsetManipulatorGeometryOutside.instantiate(),w.Unfocused),new x(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),w.Focused)],r=new it({view:this.view,renderObjects:l,elevationInfo:t.mode!=="on-the-ground"||_a(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:n,available:!(!this.graphic.visible||!((y=this.graphic.layer)!=null&&y.visible)),collisionType:{type:"disc",direction:V(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),h=new it({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!((M=this.graphic.layer)!=null&&M.visible)),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),u={manipulator:r,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(u,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(u);const g=[];for(const v of[u.handle.leftVertex,u.handle.rightVertex]){const b=this._getManipulatorInfoFromHandle(v);d(b)&&g.push(b.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(u)))}u.locationUpdateHandle=et(g),this._manipulatorHandles.add(u.locationUpdateHandle,r),this._manipulatorHandles.add([this._watchAndUpdateGrabState(r,!0),this._watchAndUpdateGrabState(h,!0)],r),this._manipulatorHandles.add(vt(r,this._createEdgeOffsetPipeline(u,t)),r),this._manipulatorHandles.add(vt(h,(v,b,S,I)=>{if(I==="touch")this._createEdgeOffsetPipeline(u,t)(v,b,S);else if(this.enableMoveGraphic){const N=this.graphic,pt=d(N.geometry)?N.geometry.spatialReference:null;b.next(X=>this._trackNumDragging(X)).next(Te(this.view,v.elevationAlignedLocation)).next(ta(this.view,v.elevationAlignedLocation,t,pt,N)).next(me()).next(he()).next(X=>this._perGraphicManipulatorDragAction(pe.ALL,X)).next(X=>(this._updateTranslateGraphicTooltip(O.XY,X),X)).next(X=>{X.action==="end"&&this._tooltip.clear()}),S.next(()=>this._onDragCancel(!v.metadata.deleting))}}),r);const _=v=>{this._manipulatorInfos.some(b=>b.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...v,graphic:this.graphic}),v.stopPropagation()};return this._manipulatorHandles.add([r.events.on("immediate-click",_),h.events.on("immediate-click",_),r.events.on("focus-changed",({action:v})=>{const b=this._tooltipOptions;if(v==="focus"&&b.enabled){const S=this._tooltip.info=new Nt({tooltipOptions:b});this._updateTooltipAreaOrTotalLength(S)}else this._tooltip.clear()})],r),this._manipulatorInfos.push(u),this.manipulators.add(r),this.manipulators.add(h),this.emit("manipulators-changed"),u}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,n=()=>{e.visibilityHandle=Pt(e.visibilityHandle);const s=this._getManipulatorInfoFromHandle(e.handle.leftVertex),o=this._getManipulatorInfoFromHandle(e.handle.rightVertex),l=d(s)&&d(o)&&tl(s.manipulator.renderLocation,o.manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||l)&&(i.grabbable=!l,a.grabbable=!l,e.visibilityHandle=et([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",n),a.events.on("focus-changed",n),{remove:()=>{Pt(e.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],i),n()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const{coordinateHelper:t}=R(this._editGeometryOperations).data,i=en(this.view,e.manipulator.elevationAlignedLocation,tn(t,e.handle,R(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex),n=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(f(a)||f(n))return;const s=a.manipulator.renderLocation,o=n.manipulator.renderLocation,l=d(i)?Kr(i,s,o):So;e.manipulator.modelTransform=l,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=l;const r=Yt(B(Be,s,o))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-r,0,0],[r,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,n)=>{this._clearSelection();const{step:s,cleanup:o}=this._initializeEdgeOffset(e,t);a.next(l=>this._trackNumDragging(l)).next(Te(this.view,i.elevationAlignedLocation)).next(s).next(Ws(this.view)).next(qs(this.view,R(this._editGeometryOperations).data.spatialReference)).next(he()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next(l=>{l.action==="end"&&o()}),n.next(()=>{i.metadata.deleting||(o(),this._onDragCancel())})}}_initializeEdgeOffset(e,t){const i=R(this._editGeometryOperations),a=tn(i.data.coordinateHelper,e.handle,t),n=i.createUndoGroup(),s=en(this.view,e.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const g=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge);d(g)&&this._splitEdgeManipulator(g,1)}if(a.requiresSplitEdgeRight){const g=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge);d(g)&&this._splitEdgeManipulator(g,0)}const o=()=>new xs({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),l=new ae({view:this.view,isDraped:this._graphicState.isDraped,geometry:o(),elevationInfo:e.elevationInfo,width:m.visualElements.lineGraphics.outline.width,color:m.colorToVec4(E.main),attached:!0});let r;const h=()=>{this._cleanEdgeOffsetCollapsedEdges(e),r=Pt(r)},u=this.on("undo",h);return r=et([Ht(l),G(()=>this._graphicState.isDraped,g=>l.isDraped=g),this._graphicState.on("changed",()=>l.geometry=o()),n,u]),{step:g=>f(a)||f(s)?(h(),null):{...g,operation:a,plane:s},cleanup:h}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||f(t.operation))return t;this._updateEventState(P.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=t;return(i||a||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;return f(t)||f(i)?e:(e.action==="start"&&t.selectArrowFromStartPoint(i),{...e,signedDistance:t.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:a}=e,n=this._tooltip,s=this._tooltipOptions;if(!s.enabled||f(i))return n.clear(),e;let o=n.info;(f(o)||o.type!=="reshape-edge-offset")&&(o=n.info=new Nt({tooltipOptions:s}));const{coordinateHelper:l}=R(this._editGeometryOperations).data;return o.distance=e.action==="end"?De:el(this._graphicState.isDraped,i*a.selectedArrow,t,a.plane,l),this._updateTooltipAreaOrTotalLength(o),e}}_cleanEdgeOffsetCollapsedEdges(e){var l,r;const t=(l=e.handle.leftVertex.leftEdge)==null?void 0:l.leftVertex,i=e.handle.leftVertex,a=(r=e.handle.rightVertex.rightEdge)==null?void 0:r.rightVertex,n=e.handle.rightVertex,s=R(this._editGeometryOperations).data.coordinateHelper,o=[];if(t&&s.distance(t.pos,i.pos)<Oi){const h=this._getManipulatorInfoFromHandle(i);d(h)&&o.push(h)}if(s.distance(i.pos,n.pos)<Oi||a&&s.distance(a.pos,n.pos)<Oi){const h=this._getManipulatorInfoFromHandle(n);d(h)&&o.push(h)}o.length&&this._removeVertices(o)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=k(this.graphic),i=!1){var l;if(e.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(f(this._vertexManipulatorGeometry)||f(this._vertexManipulatorOutlineGeometry)){const{size:r,outlineSize:h}=this._computeVertexManipulatorSizeAndOutline(m.reshapeManipulators.vertex);this._vertexManipulatorGeometry=xe(this._vertexManipulatorMaterial,r,16,16),this._vertexManipulatorOutlineGeometry=xe(this._vertexManipulatorOutlineMaterial,h,16,16)}if(f(this._edgeManipulatorGeometry)||f(this._edgeManipulatorOutlineGeometry)){const{size:r,outlineSize:h}=this._computeVertexManipulatorSizeAndOutline(m.reshapeManipulators.edge);this._edgeManipulatorGeometry=xe(this._edgeManipulatorMaterial,r,16,16),this._edgeManipulatorOutlineGeometry=xe(this._edgeManipulatorOutlineMaterial,h,16,16)}const a=d(this.graphic.geometry)&&this.graphic.geometry.type==="point"?[]:[new x(this._vertexManipulatorGeometry.instantiate(),dt.Vertex|w.Unselected),new x(this._vertexManipulatorOutlineGeometry.instantiate(),dt.Vertex|w.Unfocused|w.Unselected),new x(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),dt.Vertex|w.Focused|w.Unselected),new x(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),w.Selected),new x(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),w.Selected|w.Unfocused),new x(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),w.Selected|w.Focused)];this.enableMidpoints&&a.push(new x(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),dt.Edge|w.Focused|w.Unselected),new x(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),dt.Edge|w.Focused|w.Unselected),new x(this._edgeManipulatorGeometry.instantiate(),dt.Edge|w.Unfocused|w.Unselected),new x(this._edgeManipulatorOutlineGeometry.instantiate(),dt.Edge|w.Unfocused|w.Unselected));const n=new it({view:this.view,renderObjects:a,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!((l=this.graphic.layer)!=null&&l.visible)),metadata:{deleting:!1}});n.selected=i,this._setTypeSpecificManipulatorSettings(n,e,t);const s=e.type==="edge"?{manipulator:n,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:n,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(n),this._updateManipulatorPosition(s),s.type==="edge"){const r=[];for(const h of[s.handle.leftVertex,s.handle.rightVertex]){const u=this._getManipulatorInfoFromHandle(h);d(u)&&r.push(u.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s)))}s.locationUpdateHandle=et(r),this._manipulatorHandles.add(s.locationUpdateHandle,n)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(n,!0),n);const o=vt(n,(r,h,u,g)=>{let _=null;const{snappingStep:y,cancelSnapping:M}=ni({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new si({editGeometryOperations:R(this._editGeometryOperations),elevationInfo:t,pointer:g,excludeFeature:this.graphic,visualizer:new Ge}),updatingHandles:this.updatingHandles,useZ:!1});u=u.next(v=>(this._onDragCancel(!r.metadata.deleting,()=>_=Pt(_)),v)).next(M),h.next(v=>this._trackNumDragging(v)).next(v=>{if(v.action==="start"&&(_=R(this._editGeometryOperations).createUndoGroup()),s.type==="edge"){const b=this._splitEdgeManipulator(s);return{...v,info:b,snapOrigin:b.handle.pos}}return{...v,info:s,snapOrigin:s.handle.pos}}).next(Te(this.view,r.elevationAlignedLocation)).next(Js(this.view,this.graphic,r.elevationAlignedLocation,r.location.spatialReference,this.graphic)).next(Ga(this.view,t,this.graphic)).next(...y).next(he()).next(v=>{this._perVertexManipulatorDragAction(v),v.action==="end"&&(_=Pt(_)),this._updateTranslateVertexTooltip(r,O.XY,v)})});return this._manipulatorHandles.add([o,n.events.on("immediate-click",r=>this._manipulatorClickCallback(r,s)),n.events.on("select-changed",()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),n.events.on("focus-changed",({action:r})=>{r==="focus"&&s.type!=="edge"?this._updateTranslateVertexTooltip(n,O.XY):this._tooltip.clear()})],n),this.emit("manipulators-changed"),s}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&(this.undo(),this.outputGeometry=d(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),d(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case P.NONE:break;case P.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case P.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}t&&t(),this.destroyed||this._updateEventState(P.NONE)}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=dt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=m.reshapeManipulators.vertex.size/2+m.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=d(this.graphic.geometry)&&this.graphic.geometry.type!=="point";break;case"edge":e.state=dt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=m.reshapeManipulators.edge.size/2+m.reshapeManipulators.edge.collisionPadding,e.elevationInfo=i.mode!=="on-the-ground"||_a(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",i=>this._onGrabStateChanged(e,t,i.action,i.pointerType))}_onGrabStateChanged(e,t,i,a="mouse"){if(!this._recreatingManipulators){if(i==="start")t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(P.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(a!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(n=>{n.manipulator.interactive=n.manipulator.grabbing||!this._numGrabbing&&d(this.graphic.geometry)&&this.graphic.geometry.type!=="point","edgeManipulator"in n&&(n.edgeManipulator.interactive=n.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(n=>{n.interactive=n.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){f(e)||(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),Ms(this._manipulatorInfos,e),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e){for(const t of this._manipulatorInfos)if(e===t.handle)return t}return null}_updateManipulatorPosition(e){if(f(e))return;const t=R(this._editGeometryOperations);if(e.type==="vertex")e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Se),e.manipulator.grabbing&&d(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if(e.type==="edge"){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(f(i)||f(a))return;const n=i.manipulator,s=a.manipulator;if(d(e.manipulator.elevationInfo)&&e.manipulator.elevationInfo.mode==="on-the-ground"){const o=n.location,l=s.location,r=.5,h=o.x+r*(l.x-o.x),u=o.y+r*(l.y-o.y),g=o.hasZ&&l.hasZ?0:void 0;e.manipulator.location=Le(h,u,g,t.data.spatialReference)}else bs(Be,n.renderLocation,s.renderLocation,.5),e.manipulator.renderLocation=Be}}_splitEdgeManipulator(e,t=.5){const i=R(this._editGeometryOperations),a=R(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle=Pt(e.locationUpdateHandle);const n=k(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(a)):(s=e,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,O.XY),this._updateSelection(e.manipulator);const o=this._updateEventState(P.RESHAPING),l=i.data.coordinateHelper.vectorToArray(s.handle.pos),r=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:r,vertexIndex:R(a.index)}],added:l}),o&&this._updateEventState(P.NONE),s}_updateMoveManipulationPosition(){const e=J(Be,0,0,0);let t=0,i=!1,a=null,n=null;for(const s of this._manipulatorInfos)s.type==="vertex"&&(s.manipulator.selected?(t++,lt(e,e,s.manipulator.renderLocation),f(a)||s.selectedIndex>a.selectedIndex?(n=a,a=s):(f(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(t===0){const s=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s,this._moveManipulation.zManipulation.available=s&&this.enableZShape&&te(this.graphic),this._moveManipulation.angle=Un(R(this.graphic.geometry)),this._moveManipulation.radius=ee.radiusForSymbol(this.graphic.symbol)}else{const s=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.zManipulation.available=s&&this.enableZVertex&&te(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s&&t!==1;let o=0;if(d(a)){const l=a.handle.pos,r=d(n)?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,h=f(n)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;r&&h?this._moveManipulation.xyAxisManipulation.available=!1:r?o=nn(r,l):h&&(o=nn(l,h))}this._moveManipulation.angle=o,this._moveManipulation.radius=Hn}t!==0&&i?(mt(e,e,1/t),Se.spatialReference=R(this._editGeometryOperations).data.spatialReference,Se.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Se),this._moveManipulation.elevationAlignedLocation=Se):d(this._outlineVisualElement)&&!this._graphicState.isDraped&&d(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:$n(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){var a;const t=new Array,i=R(this._editGeometryOperations);for(const n of e)if(n.type==="vertex"&&i.canRemoveVertex()){t.push(n.handle),this._removeManipulator(n),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(n.handle.rightEdge));const s=i.removeVertices([n.handle]),o=R((a=s.removedVertices)==null?void 0:a[0].createdEdge);o&&this._createVertexOrEdgeManipulator(o)}if(t.length>0){const n=t.map(o=>{const l=i.data.components.indexOf(o.component);return{coordinates:i.data.coordinateHelper.vectorToArray(o.pos),componentIndex:l,vertexIndex:R(o.index)}});this.outputGeometry=i.data.geometry;const s=this._updateEventState(P.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:n.map(o=>o.coordinates),vertices:n}),this.destroyed)||s&&(this._updateEventState(P.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=t.action==="start"?Tt.NEW_STEP:Tt.ACCUMULATE_STEPS){const a=R(this._editGeometryOperations);a.moveVertices(e.map(n=>n.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if(f(t.operation)||f(t.signedDistance))return;const i=R(this._editGeometryOperations),a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),t.type==="vertex"&&(t.manipulator.selected=!t.manipulator.selected,e.button===ma.Right&&this._removeVertices([t])),t.type==="edge"&&e.button===ma.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter(a=>a.type==="vertex"&&a.manipulator.selected);i.length===1?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case O.XY:this._tooltip.info=new Ie({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,(n,s)=>Rt(n,s,a));break;case O.XY_AXIS:this._tooltip.info=new ia({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,(n,s)=>{const o=Rt(n,s,a);return ei(o,li(t))});break;case O.Z:this._tooltip.info=new mi({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,t,ti)}}_updateTranslateVertexTooltip(e,t,i){const a=this._tooltipOptions;if(!a.enabled)return;let n;const s=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case O.XY:n=new ko({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,(l,r)=>Rt(l,r,s)),this._updateTooltipAreaOrTotalLength(n);break;case O.XY_AXIS:n=new Uo({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,(l,r)=>{const h=Rt(l,r,s);return ei(h,li(i))}),this._updateTooltipAreaOrTotalLength(n);break;case O.Z:n=new Ho({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,ti)}const o=Hs(e.elevationAlignedLocation);d(o)&&(n.elevation={mode:"absolute-height",...o}),this._tooltip.info=n}_updateTranslateTooltipDistance(e,t,i){if(d(t)&&t.action!=="end"){const{mapStart:a,mapEnd:n}=t,s=i(a,n);e.distance=d(s)?s:De}}_updateTooltipAreaOrTotalLength(e){const{geometry:t}=this.graphic;if(f(t))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";e.area=t.type==="polygon"?Yo(t,i):null,e.totalLength=t.type==="polyline"?Us(t,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function nn(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function el(e,t,i,a,n){if(e){const s=n.toXYZ(n.pointToVector(i)),o=Xo(a,s,A.get()),l=ks(o,s,n.spatialReference);if(d(l))return Re(l.value*Math.sign(t),l.unit)}return Re(t*Ii(i.spatialReference),"meters")}p([c()],H.prototype,"_editGeometryOperations",void 0),p([c()],H.prototype,"_segmentLabels",void 0),p([c({constructOnly:!0})],H.prototype,"tool",void 0),p([c()],H.prototype,"_tooltip",void 0),p([c()],H.prototype,"inputGeometry",null),p([c()],H.prototype,"outputGeometry",void 0),p([c({readOnly:!0})],H.prototype,"updating",null),p([c()],H.prototype,"manipulators",null),p([c()],H.prototype,"view",null),p([c()],H.prototype,"graphic",null),p([c()],H.prototype,"enableZShape",null),p([c()],H.prototype,"enableZVertex",null),p([c()],H.prototype,"enableMoveGraphic",null),p([c()],H.prototype,"enableMidpoints",null),p([c()],H.prototype,"enableEdgeOffset",null),p([c()],H.prototype,"_labelOptions",null),p([c()],H.prototype,"_tooltipOptions",null),H=p([U("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],H);const Se=Le(0,0,void 0,Ss.WGS84),Be=z(),Oi=1e-6;var dt,P,pe;(function(e){e.Vertex=nt.Custom1,e.Edge=nt.Custom2})(dt||(dt={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(P||(P={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(pe||(pe={}));let Z=class extends xt.EventedMixin(gi){constructor(e){super(e),this._handles=new _e,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new wn,this.tooltipOptions=new Ft,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new H({tool:this});this.addHandles([e.on("reshape",t=>{t.type==="reshape"&&this._onReshapeGeometryChanged(),this.emit("reshape",t)}),e.on("move",t=>{t.type==="move"&&this._onReshapeGeometryChanged(),this.emit("move",t)}),e.on("vertex-add",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)}),e.on("vertex-remove",t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)}),e.on("immediate-click",t=>this.emit("immediate-click",t)),this.view.on("pointer-down",["Shift"],t=>t.stopPropagation()),G(()=>this.graphic,()=>this._updateGraphic(),qi)]),this.finishToolCreation()}destroy(){this._handles=L(this._handles),this._reshapeOperation=L(this._reshapeOperation)}get updating(){var e;return((e=this._reshapeOperation)==null?void 0:e.updating)??!1}_updateGeometry(){const e=ws(this.graphic);this._reshapeOperation.inputGeometry=d(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),Os(this.graphic)!==Sn.SUPPORTED)return;const e=G(()=>{var t;return(t=this.graphic)==null?void 0:t.geometry},()=>{this._internalGeometryUpdate===!1&&this._updateGeometry()},Ke);this._handles.add(e,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:e}=this._reshapeOperation;!f(this.graphic)&&e&&this._updateGeometryInternally(e.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){d(this.snappingManager)&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.undo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){d(this.snappingManager)&&this.snappingManager.doneSnapping();const e=this._reshapeOperation.redo(),{outputGeometry:t}=this._reshapeOperation;e&&t&&this._updateGeometryInternally(t.clone())}onInputEvent(e){e.type!=="key-down"||e.key!=="Delete"&&e.key!=="Backspace"||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};p([c()],Z.prototype,"_reshapeOperation",void 0),p([c({constructOnly:!0,nonNullable:!0})],Z.prototype,"view",void 0),p([c({constructOnly:!0})],Z.prototype,"graphic",void 0),p([c({constructOnly:!0,nonNullable:!0})],Z.prototype,"enableZShape",void 0),p([c({constructOnly:!0,nonNullable:!0})],Z.prototype,"enableZVertex",void 0),p([c({constructOnly:!0,nonNullable:!0})],Z.prototype,"enableMoveGraphic",void 0),p([c({constructOnly:!0,nonNullable:!0})],Z.prototype,"enableMidpoints",void 0),p([c({constructOnly:!0,nonNullable:!0})],Z.prototype,"enableEdgeOffset",void 0),p([c()],Z.prototype,"type",void 0),p([c({constructOnly:!0,type:wn})],Z.prototype,"labelOptions",void 0),p([c({constructOnly:!0,type:Ft})],Z.prototype,"tooltipOptions",void 0),p([c({constructOnly:!0})],Z.prototype,"snappingManager",void 0),p([c()],Z.prototype,"updating",null),p([c()],Z.prototype,"automaticManipulatorSelection",void 0),Z=p([U("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Z);let wt=class extends ui{constructor(t){super(t),this.type="transform-rotate",this.rotationType="geographic"}};p([c()],wt.prototype,"type",void 0),p([c()],wt.prototype,"rotation",void 0),p([c()],wt.prototype,"rotationPrecision",void 0),p([c()],wt.prototype,"orientation",void 0),p([c()],wt.prototype,"orientationPrecision",void 0),p([c()],wt.prototype,"rotationType",void 0),wt=p([U("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],wt);let Lt=class extends ui{constructor(t){super(t),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};p([c()],Lt.prototype,"type",void 0),p([c()],Lt.prototype,"scale",void 0),p([c()],Lt.prototype,"size",void 0),p([c()],Lt.prototype,"sizeUnit",void 0),p([c()],Lt.prototype,"sizePrecision",void 0),Lt=p([U("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Lt);let ot=class extends ui{constructor(e){super(e),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};p([c()],ot.prototype,"type",void 0),p([c()],ot.prototype,"orientation",void 0),p([c()],ot.prototype,"orientationEnabled",void 0),p([c()],ot.prototype,"orientationPrecision",void 0),p([c()],ot.prototype,"rotationType",void 0),p([c()],ot.prototype,"size",void 0),p([c()],ot.prototype,"sizeUnit",void 0),p([c()],ot.prototype,"sizeEnabled",void 0),p([c()],ot.prototype,"sizePrecision",void 0),ot=p([U("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],ot);var $,ge;(function(e){e.ScaleIn=nt.Custom2,e.ScaleOut=nt.Custom3,e.RotateLeft=nt.Custom4,e.RotateRight=nt.Custom5,e.Unlocked=nt.Custom7,e.DelayedFocused=nt.Custom8,e.TouchInput=nt.Custom12})($||($={}));class il{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}constructor({adapter:t,tooltipOptions:i,mode:a,tool:n}){this._mode=null,this._handles=new _e,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=kr,this.events=new xt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>d(this._scaleRotateDragData)&&this._scaleRotateDragData.mode==="scale"?this._adapter.scale:1,this.tool=n,this._mode=a,this._adapter=t,this._tooltipOptions=i,this._tooltip=new Ve({view:n.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(ue(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),Dt))}destroy(){d(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=L(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=L(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const i=Es({update:({deltaTime:a})=>{t.update(a)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:i}}cancelActiveAnimation(){d(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=L(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,D.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const i=this.tool.graphicState.graphic,a=vt(t,(n,s,o)=>{this._scaleRotateDragData=null;const l=this._adapter.startInteraction(),r={mode:"none",origin:On(n.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=r,this._updateDragState();const h=A.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(n.renderLocation,h),s.next(zi(this.tool.view,aa(n.renderLocation,h,na()))).next(u=>{const g=He(u.plane),_=Dn(u.renderStart,u.renderEnd,r.origin,g),y=As.shortestSignedDiff(r.angle,_);r.angleDir=Gi(r.angleDir+y,-qa,qa),r.angle=_;const M=al(r,u),v=M-this._adapter.scale;if(r.scaleDir=Gi(r.scaleDir+v,-Wa,Wa),this._onScaleChanged(),r.mode==="none"){const b=this._mode||nl(u,u.plane,r.origin,this.tool.view.state.camera);if(d(b)){switch(b){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:i,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:i,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}r.mode=b}}switch(r.mode){case"rotate":l.state.angle=r.initialAngle+_;break;case"scale":l.state.scale=M,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),u.action){case"start":case"update":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:i,angle:$e(r.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:i,xScale:M,yScale:M})}break;case"end":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:$e(r.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:M,yScale:M})}}return u.action==="end"&&(this.startAnimation(sn(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),l.done()),u}).next(this._updateTooltipPipelineStep(r)),o.next(()=>{if(l.cancel(),d(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:i,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}this.startAnimation(sn(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([a,t.events.on("focus-changed",n=>{n.action==="focus"?this.startAnimation(sl(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),t.events.on("immediate-click",n=>{n.stopPropagation()}),G(()=>{var n;return(n=this.tool.graphicState)==null?void 0:n.displaying},n=>this._ringManipulator.available=n,Dt)])}_updateTooltipPipelineStep(t){return i=>{const a=this._tooltipOptions;if(!a.enabled)return i;if(i.action==="end")return this._updateFocusTooltip(),i;const n=this._tooltip,s=this._tooltipOptions.visualVariables,o=d(s)?s.size:null,l=d(s)?s.rotation:null;switch(t.mode){case"scale":n.info=new Lt({tooltipOptions:a,scale:{value:this._adapter.scale},size:Re(gt(this._adapter.size,-1),"meters"),sizeUnit:d(o)?o.unit:null,sizePrecision:d(o)?We(o.valueType):null});break;case"rotate":{const r=d(l)?We(l.valueType):null,h=d(l)?l.rotationType:"geographic";n.info=new wt({tooltipOptions:a,rotation:bi(gt(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:r,orientation:bi(-this._adapter.angle,"radians","geographic"),orientationPrecision:r,rotationType:h})}}return i}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,i=d(t)?t.rotation:null,a=d(t)?t.size:null;this._tooltip.info=new ot({tooltipOptions:this._tooltipOptions,orientation:bi(-this._adapter.angle,"radians","geographic"),orientationEnabled:this._mode==null||this._mode==="rotate",orientationPrecision:d(i)?We(i.valueType):null,rotationType:d(i)?i.rotationType:"geographic",size:Re(gt(this._adapter.size,-1),"meters"),sizeUnit:d(a)?a.unit:null,sizeEnabled:this._mode==null||this._mode==="scale",sizePrecision:d(a)?We(a.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled($.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled($.Unlocked,!(d(this._scaleRotateDragData)&&this._scaleRotateDragData.mode!=="none")),d(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled($.ScaleIn|$.ScaleOut,!1),this._ringManipulator.updateStateEnabled($.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled($.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled($.RotateLeft|$.RotateRight,!1),this._ringManipulator.updateStateEnabled($.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled($.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled($.ScaleIn|$.ScaleOut|$.RotateLeft|$.RotateRight,!1)}_updateManipulatorTransform(){const t=fn(q.get(),this._adapter.angle,V(0,0,1));if(f(t))return;const i=this.getScale(),a=Qe(q.get(),J(A.get(),i,i,i));this._ringManipulator.modelTransform=Ut(q.get(),a,t)}_createRingManipulator(){const t=(T,Q,yt)=>{const It=[],Ct=Math.ceil(Vn*(Q-T)/(2*Math.PI));for(let j=0;j<Ct+1;j++){const ve=T+j*(Q-T)/Ct;It.push(V(yt*Math.cos(ve),yt*Math.sin(ve),0))}return It},i=T=>t(0,2*Math.PI,T),a=T=>[[-T/2,0],[T/2,0],[T/2,xi/2],[-T/2,xi/2]],n=this._createMaterial(1),s=(T,Q,yt=n)=>Gn(yt,a(Q),T,[],[],!1),o=i(qt),l=s(o,wi),r={left:new Array,right:new Array},h=[];for(let T=0;T<2;T++){const Q=T*Math.PI-Math.PI/4,yt=Math.PI/2-Hr,It=Q+yt,Ct=Q+Math.PI/2-yt,j=t(It,Ct,Lr),ve=s(j,re);h.push(j),h.push(t(It,Ct,Ya-wi/2)),r.left.push(ve),r.right.push(ve.instantiate());for(let Mi=0;Mi<2;Mi++){const la=Mi===0,at=kt();if(la){di(at,at,[1,-1,1]),va(at,at,-It,[0,0,1]);const Zt=Math.round(Za*(j.length-1));at[12]=j[Zt][0],at[13]=j[Zt][1],at[14]=j[Zt][2]}else{va(at,at,Ct,[0,0,1]);const Zt=Math.round((1-Za)*(j.length-1));at[12]=j[Zt][0],at[13]=j[Zt][1],at[14]=j[Zt][2]}const ha=ai(n,Vr,0,Nr,xi);Rn(ha,at),(la?r.left:r.right).push(ha)}}const u=[];for(let T=0;T<2;T++){const Q=T*Math.PI-Math.PI/4,yt=Math.PI/2-Ur,It=Q+yt,Ct=Q+Math.PI/2-yt,j=t(It,Ct,Ya);u.push(s(j,re))}const g=this._createMaterial(.66),_=this._createMaterial(.5),y=this._createMaterial(.33),M=i(qt+Ba),v=i(qt+ja),b=s(M,re,g),S=s(v,re,y),I=i(qt-Ba),N=i(qt-ja),pt=s(I,re,g),X=s(N,re,y);let Y=[new x(l,$.DelayedFocused),new x(l.instantiate({material:_}),w.None)];this._mode&&this._mode!=="scale"||(Y=Y.concat([...u.map(T=>new x(T,$.DelayedFocused|$.Unlocked)),new x(b,$.DelayedFocused|$.ScaleIn),new x(S,$.DelayedFocused|$.ScaleIn),new x(pt,$.DelayedFocused|$.ScaleOut),new x(X,$.DelayedFocused|$.ScaleOut)])),this._mode&&this._mode!=="rotate"||(Y=Y.concat([...r.right.map(T=>new x(T.instantiate(),$.DelayedFocused|$.Unlocked)),...r.left.map(T=>new x(T,$.DelayedFocused|$.RotateLeft)),...r.right.map(T=>new x(T,$.DelayedFocused|$.RotateRight))]));const ft=[o,...h];return new it({view:this.tool.view,renderObjects:Y,autoScaleRenderObjects:!1,worldOriented:!0,radius:wi,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:k(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:ft,direction:V(0,0,1)}})}_createMaterial(t){const i=ne([...Ir,t]);return new Jt({color:i,transparent:t!==1,cullFace:Gt.Back,renderOccluded:C.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:t=>this._ringIndicatorDelayMs=t,tooltip:this._tooltip}}}function al(e,t){const i=B(A.get(),t.renderStart,e.origin),a=B(A.get(),t.renderEnd,e.origin),n=Yt(i),s=Yt(a);return n===0?0:s/n}function nl(e,t,i,a){const{renderStart:n,renderEnd:s}=e,o=je(n,a,A.get()),l=je(s,a,A.get());if(Ts(o,l)<Fa*Fa)return null;const r=B(A.get(),n,i),h=de(A.get(),r,He(t)),u=n,g=lt(A.get(),u,h),_=je(i,a,A.get()),y=o,M=je(g,a,A.get()),v=B(A.get(),M,y),b=B(A.get(),o,_),S=$a(y,v),I=$a(_,b);return Da(S,l)<Da(I,l)?"rotate":"scale"}function je(e,t,i){return t.projectToScreen(e,Ei),J(i,Ei[0],Ei[1],0)}function sn(e,t){let i=null,a=1;const n=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=n,t()},update:s=>(a+=((a+1)/2-a)*Math.min(s*Xr,1),t(),Math.abs(a-1)<.01?ge.STOP:ge.CONTINUE),destroy:()=>{i&&(e.getScale=i),t()}}}function sl(e,t,i){let a=0,n=null;const s=()=>!1;return{start:()=>{n=e.getFocused,e.getFocused=s,a=0,t()},update:o=>(a+=o,!(n!=null&&n())||a>=i.delayMs?ge.STOP:ge.CONTINUE),destroy:()=>{n&&(e.getFocused=n),t()}}}function We(e){switch(e){case"integer":case"long":return 0;default:return null}}(function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"})(ge||(ge={}));const Ei=pi();function kn(e){return d(e.geometry)&&e.geometry.type==="mesh"?ol(e.geometry):rl(e)}function ol(e){return d(e.transform)?ll(e,e.transform):hl(e)}function rl(e){let t=e.geometry,i=$s;return{undo(a){i=a.geometry,a.geometry=t},redo(a){t=a.geometry,a.geometry=i}}}function ll(e,t){let i=t.clone(),a=null;return{undo:n=>{a=d(e.transform)?e.transform.clone():null,e.transform=i,n.notifyGeometryChanged()},redo:n=>{i=d(e.transform)?e.transform.clone():null,e.transform=a,n.notifyGeometryChanged()}}}function hl(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}let Ot=class extends Ji{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([ue(()=>d(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null,({interactionState:t})=>{this._updateMeshRotation(t)},Ke),ue(()=>d(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null,({interactionState:t})=>{this._updateMeshSize(t)},Ke)])}get angle(){const t=this.geometry.transform;if(f(t))return 0;const i=Fo(t.rotation)[2];return Math.abs(i)>.999999?ci(Zo(t.rotation))*Math.sign(i):0}get scale(){return d(this._interactionState)?this._interactionState.scale:1}startInteraction(){const t=new Et({angle:this.angle});this._interactionState=t;const i=()=>{this._interactionState=null};return{state:t,done:i,cancel:()=>{t.cancel(),i()}}}createUndoRecord(){return kn(this.graphic)}_updateMeshRotation(t){const i=this.geometry.anchor,a=this.viewingMode===Ci.Global,{angle:n,previousAngle:s}=t;this.geometry.rotate(0,0,$e(n-s),{origin:i,geographic:a}),t.previousAngle=n,d(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(t){const i=this.geometry.anchor,a=this.viewingMode===Ci.Global,{scale:n,previousScale:s}=t;this.geometry.scale(n/s,{origin:i,geographic:a}),t.previousScale=n,d(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};p([c({constructOnly:!0})],Ot.prototype,"graphic",void 0),p([c({constructOnly:!0})],Ot.prototype,"geometry",void 0),p([c({constructOnly:!0})],Ot.prototype,"viewingMode",void 0),p([c()],Ot.prototype,"angle",null),p([c()],Ot.prototype,"scale",null),p([c()],Ot.prototype,"_interactionState",void 0),Ot=p([U("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ot);let Et=class extends hi{get state(){const{angle:t,scale:i}=this;return{angle:t,scale:i}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};p([c()],Et.prototype,"angle",void 0),p([c()],Et.prototype,"initialAngle",void 0),p([c()],Et.prototype,"previousAngle",void 0),p([c()],Et.prototype,"previousScale",void 0),p([c()],Et.prototype,"scale",void 0),p([c()],Et.prototype,"state",null),Et=p([U("InteractionState")],Et);let W=class extends Ji{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(ue(()=>d(this._interactionState)?this._interactionState.state:null,t=>{this._updateSymbol(t)},Ke))}get angle(){return d(this._interactionState)?this._interactionState.angle:d(this._orientationReferenceSymbolLayer)?pl(this._orientationReferenceSymbolLayer.heading??0):0}get scale(){return d(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return d(this._interactionState)?this._interactionState.initialAngle:0}get size(){const t=this._sizeReferenceSymbolLayer;if(f(t))return null;const i=this.findLayerView(),a=this._graphicSymbol;if(f(i)||f(a)||a.type!=="point-3d")return null;const n=i.getSymbolLayerSize(a,t);if("size"in n&&d(n.size))return n.size;const s=this.sizeAxis;return"width"in n&&d(n.width)&&(f(s)||s==="width"||s==="all"||s==="width-and-depth")?n.width:"depth"in n&&d(t.depth)&&(f(s)||s==="depth"||s==="all"||s==="width-and-depth")?n.depth:"height"in n&&d(t.height)&&(f(s)||s==="height"||s==="all")?n.height:null}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return f(t)||t.symbolLayers.length===0?null:t.symbolLayers.find(i=>i.type==="object")}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return f(t)||t.symbolLayers.length===0?null:t.symbolLayers.find(i=>i.type==="object"&&d(i.heading))}get _graphicSymbol(){return d(this.graphic)&&d(this.graphic.symbol)&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,i=this.findLayerView();if(d(this._interactionState)||f(t)||f(i))return cl;const a=t.symbolLayers.map(r=>r.type==="object"?i.getSymbolLayerSize(t,r):null).toArray(),n=t.clone(),s=this.angle,o=new At({originalSymbol:n,angle:s,initialSizes:a});this._interactionState=o;const l=()=>{this._interactionState=null};return{state:o,done:l,cancel:()=>{this._graphicSymbol=n,l()}}}createUndoRecord(){let t=this.graphic.symbol,i=null;return{undo:a=>{i=a.symbol,a.symbol=t},redo:a=>{t=a.symbol,a.symbol=i}}}_updateSymbol({scale:t,angle:i,originalSymbol:a,initialSizes:n}){const s=this._graphicSymbol;if(f(s)||s.type!=="point-3d")return;const o=s.clone(),l=-$e(i-this.initialAngle);let r=!1;this._forEachObjectSymbolLayerPair(a,o,(h,u,g)=>{const _=gt(h.heading,0)+l;u.heading!==_&&(u.heading=_,r=!0);const y=n[g];if(d(y)&&"width"in y){y.width=this.sizeFilter(y.width),y.height=this.sizeFilter(y.height),y.depth=this.sizeFilter(y.depth);const M=y.width*t;u.width!==M&&(u.width=M,r=!0);const v=y.depth*t;u.depth!==v&&(u.depth=v,r=!0);const b=y.height*t;u.height!==b&&(u.height=b,r=!0)}}),r&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(t,i,a){t.symbolLayers.forEach((n,s)=>{const o=i.symbolLayers.getItemAt(s);n.type==="object"&&o.type==="object"&&a(n,o,s)})}};function pl(e){return-ci(e)}p([c()],W.prototype,"angle",null),p([c()],W.prototype,"scale",null),p([c()],W.prototype,"relativeAngle",null),p([c()],W.prototype,"initialAngle",null),p([c()],W.prototype,"size",null),p([c()],W.prototype,"sizeAxis",void 0),p([c({constructOnly:!0})],W.prototype,"graphic",void 0),p([c()],W.prototype,"_interactionState",void 0),p([c({constructOnly:!0})],W.prototype,"findLayerView",void 0),p([c({constructOnly:!0})],W.prototype,"sizeFilter",void 0),p([c()],W.prototype,"_sizeReferenceSymbolLayer",null),p([c()],W.prototype,"_orientationReferenceSymbolLayer",null),p([c()],W.prototype,"_graphicSymbol",null),W=p([U("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],W);const cl={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let At=class extends hi{get state(){const{originalSymbol:t,angle:i,initialAngle:a,scale:n,initialSizes:s}=this;return{originalSymbol:t,angle:i,initialAngle:a,scale:n,initialSizes:s}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};p([c()],At.prototype,"originalSymbol",void 0),p([c()],At.prototype,"angle",void 0),p([c()],At.prototype,"initialAngle",void 0),p([c()],At.prototype,"initialSizes",void 0),p([c()],At.prototype,"scale",void 0),p([c()],At.prototype,"state",null),At=p([U("InteractionState")],At);let K=class extends bn(xt.EventedMixin(gi)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Ft,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:t,view:i}=this;this.graphicState=new st({graphic:t}),this.addHandles(G(()=>this.tooltipOptions.enabled,o=>{this._tooltip=o?new Ve({view:i}):L(this._tooltip)},qi)),this._moveManipulation=new ee({tool:this,view:i,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&te(t),radius:ee.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator(o=>this.handles.add(o.events.on("immediate-click",l=>{this.emit("immediate-click",{...l,graphic:t}),l.stopPropagation()})));const a=o=>l=>{this.handles.add(l.events.on("focus-changed",({action:r})=>{const h=this._tooltip;f(h)||(r==="focus"?this._updateMoveTooltip(o):h.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(a(O.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(O.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(O.Z));const n=k(t);this._moveManipulation.elevationInfo=n;const s=t.geometry;if(this._moveManipulation.createGraphicDragPipeline((o,l,r,h,u)=>{if(d(s)&&o===O.XY){const{snappingStep:g,cancelSnapping:_}=ni({snappingContext:new si({elevationInfo:n,pointer:u,editGeometryOperations:_i.fromGeometry(new En({spatialReference:s.spatialReference}),i.state.viewingMode),visualizer:new Ge,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});h=h.next(_),r=r.next(Lo(this.view,n)).next(...g)}return{steps:r=r.next(g=>(this._updateMoveTooltip(o,g),g)),cancel:h}},this.graphicState,o=>{const{action:l,graphic:r,dxScreen:h,dyScreen:u}=o,g={graphic:r,dxScreen:h,dyScreen:u};switch(l){case"start":this.emit("graphic-translate-start",g),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",g);break;case"end":this.emit("graphic-translate-stop",g)}}),this._moveManipulation.angle=d(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(G(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){const o=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new il({tool:this,mode:o,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.handles.add([vi({view:this.view,graphic:this.graphic,forEachManipulator:o=>this._forEachManipulator(o),onManipulatorsChanged:()=>Kt()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),G(()=>i.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(o=>{o instanceof it&&this.handles.add(o.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=L(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=L(this._scaleRotate),this._scaleRotateAdapter=L(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){f(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return d(this.graphic.geometry)&&this.graphic.geometry.type==="mesh"?new Ot({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new W({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find(t=>t.layer===this.graphic.layer),sizeAxis:d(this.tooltipOptions.visualVariables)&&d(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(t){this._moveManipulation.forEachManipulator(t),d(this._scaleRotate)&&this._scaleRotate.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return G(()=>this.graphicState.displaying,t=>{this._forEachManipulator(i=>i.available=t),this._moveManipulation.zManipulation.available=t&&this.enableZ&&te(this.graphic)})}_createGeometryUndoRecord(){return kn(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,d(this._scaleRotate)&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,d(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){d(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(f(this._scaleRotate))return;const t=this._scaleRotate.getScale();this._moveManipulation.displayScale=t}_updateMoveAngle(){this.view.state.viewingMode===Ci.Local||this.view.scale<Yr?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){$n(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,i){const{tooltipOptions:a,_tooltip:n}=this;if(f(n))return;n.clear();const s=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case O.XY:n.info=new Ie({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,(o,l)=>Rt(o,l,s));break;case O.XY_AXIS:n.info=new ia({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,(o,l)=>{const r=Rt(o,l,s);return ei(r,li(i))});break;case O.Z:n.info=new mi({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,ti)}}_updateMoveTooltipDistance(t,i,a){if(d(i)&&i.action!=="end"){const{mapStart:n,mapEnd:s}=i,o=a(n,s);t.distance=d(o)?o:De}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:d(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:t=>d(this._scaleRotate)?this._scaleRotate.test.setRingIndicatorDelayMs(t):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};p([c({constructOnly:!0,nonNullable:!0})],K.prototype,"view",void 0),p([c({constructOnly:!0,nonNullable:!0})],K.prototype,"graphic",void 0),p([c({constructOnly:!0,nonNullable:!0})],K.prototype,"enableZ",void 0),p([c()],K.prototype,"enableRotation",void 0),p([c()],K.prototype,"enableScaling",void 0),p([c({constructOnly:!0,type:Ft})],K.prototype,"tooltipOptions",void 0),p([c()],K.prototype,"graphicState",void 0),p([c({value:!1})],K.prototype,"snapToScene",null),p([c({constructOnly:!0})],K.prototype,"snappingManager",void 0),p([c({readOnly:!0})],K.prototype,"type",void 0),p([c({readOnly:!0})],K.prototype,"updating",null),K=p([U("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],K);let zt=class extends Ds(Gs){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Rs(this.position,e.position)&&this.width===e.width&&this.height===e.height}};p([c({readOnly:!0,json:{read:!1,write:!0}})],zt.prototype,"type",void 0),p([c({type:En}),Me()],zt.prototype,"position",void 0),p([c({type:Number,nonNullable:!0,range:{min:0,max:360}}),Me(),fa(e=>ya.normalize(Ma(e),0,!0))],zt.prototype,"heading",void 0),p([c({type:Number,nonNullable:!0,range:{min:0,max:360}}),Me(),fa(e=>ya.normalize(Ma(e),0,!0))],zt.prototype,"tilt",void 0),p([c({type:Number,nonNullable:!0}),Me()],zt.prototype,"width",void 0),p([c({type:Number,nonNullable:!0}),Me()],zt.prototype,"height",void 0),zt=p([U("esri.analysis.SlicePlane")],zt);Mn("mac");const dl=2,ul=1.15,gl=1.15,_l=.7,ke=V(1,.5,0);ne([...ke,_l]);ne([...ke,.5]);const ml=Qi(1,1,1,1),vl=Qi(1,.8,.6,1),fl=Qi(1,.93,.86,1),yl=ne([...ke,1]),Ml=ne([...ke,1]),bl=3,Xn=11,Fi=22.5,Ai=40,on=48,Sl=2.25,xl=ne([...ke,1]),wl=4,rn=1,Ol=.3,El=6,Al=4;function Tl(e){const t=new io;t.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:a,attributes:n,varyings:s}=t;return ao(i,e),n.add(Ui.POSITION,"vec3"),n.add(Ui.UV0,"vec2"),s.add("vUV","vec2"),i.code.add(La`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),a.uniforms.add([new wa("backgroundColor",o=>o.backgroundColor),new wa("gridColor",o=>o.gridColor),new no("gridWidth",o=>o.gridWidth)]),a.code.add(La`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const $l=Object.freeze(Object.defineProperty({__proto__:null,build:Tl},Symbol.toStringTag,{value:"Module"}));class ra extends oo{initializeProgram(t){return new ro(t.rctx,ra.shader.get().build(this.configuration),lo)}initializePipeline(){return Bo({blending:jo(Ze.ONE,Ze.ONE,Ze.ONE_MINUS_SRC_ALPHA,Ze.ONE_MINUS_SRC_ALPHA),depthTest:{func:qo.LESS},colorWrite:Wo})}}ra.shader=new so($l,()=>Is(()=>import("./SlicePlaneMaterial.glsl-1e4d23a7.js"),["assets/SlicePlaneMaterial.glsl-1e4d23a7.js","assets/VertexColor.glsl-cd8180c5.js","assets/index-53e0d3f6.js","assets/index-0be7f32f.css","assets/requestImageUtils-0386f73f.js","assets/OrderIndependentTransparency-92d1201d.js","assets/enums-64ab819c.js","assets/basicInterfaces-04e01328.js","assets/Texture-0787b5b8.js","assets/VertexArrayObject-d229d289.js","assets/Util-5a607d58.js","assets/mat4f64-65d35099.js","assets/triangle-cbb245f7.js","assets/sphere-ca10ea93.js","assets/mat3f64-221ce671.js","assets/quatf64-3363c48e.js","assets/lineSegment-4948db8a.js","assets/Indices-9b814586.js","assets/VertexAttribute-15d1866a.js","assets/doublePrecisionUtils-e3c3d0d8.js","assets/quat-d5f88513.js","assets/vec3f32-ad1dc57f.js","assets/BufferView-abbd0a70.js","assets/VertexElementDescriptor-2925c6af.js","assets/automaticLengthMeasurementUtils-bbfb1cc8.js","assets/getDefaultUnitForView-90cd4f9d.js","assets/spatialReferenceEllipsoidUtils-3b8ad13e.js","assets/geometryEngine-f8f9b56c.js","assets/geometryEngineBase-e1a33b0a.js","assets/hydrated-bb19bc58.js","assets/dragEventPipeline3D-2490561d.js","assets/vec4f32-0d1b2306.js","assets/Octree-eb5534e6.js","assets/plane-54a1816b.js","assets/NativeLineMaterial-ab15b5f5.js","assets/interfaces-736d93d7.js","assets/NestedMap-1b5db22e.js","assets/InterleavedLayout-2fc52edc.js","assets/types-e1c0a5bf.js","assets/boundedPlane-93226d35.js","assets/glUtil-7a9be557.js","assets/DoubleArray-7611e074.js","assets/hydratedFeatures-fee269f9.js","assets/floatRGBA-f56adbe1.js","assets/SnappingContext-266fe79c.js","assets/PointSnappingHint-a0e510e5.js","assets/SnappingDragPipelineStep-a9d439cd.js","assets/drawUtils-e1157c45.js","assets/line-2d468772.js","assets/triangulationUtils-9c43d69d.js","assets/earcut-61f7b102.js","assets/deduplicate-825c1841.js","assets/editPlaneUtils-c8277f6b.js","assets/drawSurfaces-71648678.js","assets/SnappingOperation-9d4d0ee4.js","assets/automaticAreaMeasurementUtils-c7621a8f.js","assets/GraphicManipulator-733c1a9f.js","assets/drapedUtils-4cc70c1d.js","assets/TranslateTooltipInfos-62aa02c8.js","assets/axisAngleDegrees-50b88615.js","assets/persistable-b822258e.js","assets/resourceExtension-7eeae841.js","assets/ExtentTooltipInfos-fddba124.js"]));function Dl(e,t){return Qs(e.basis1,e.basis2,e.origin,t)}function Rl(e,t,i,a){const n=t.worldUpAtPosition(e.origin,A.get()),s=A.get();switch(i){case Pe.HEADING:Ee(s,n);break;case Pe.TILT:Ee(s,e.basis1)}return aa(e.origin,s,a)}function Gl(e,t,i,a){const n=Yt(a.basis1),s=Yt(a.basis2),o=Yn(a),l=Zi(a),r=J(A.get(),0,0,0);lt(r,mt(A.get(),a.basis1,t.direction[0]),mt(A.get(),a.basis2,t.direction[1])),lt(r,a.origin,r);let h=0,u=1;if(yi(t))t.direction[0]===1&&t.direction[1]===-1?h=ji:t.direction[0]===1&&t.direction[1]===1?h=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(h=3*Math.PI/2),u=l;else{const _=t.direction[0]!==0?1:2;h=_===1?ji:0,u=(_===1?s:n)-o}const g=Wi(q.get(),h);di(g,g,J(A.get(),u,u,u)),Ut(g,i,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=r}function Il(e,t,i,a){const n=a.worldUpAtPosition(i.origin,A.get()),s=Cl(i,Qt.POSITIVE_X),o=Wi(q.get(),s.edge*Math.PI/2);yn(o,o,-Hl(i,n)),Ut(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=s.position}var Qt;function Cl(e,t){switch(t){case Qt.POSITIVE_X:return{basis:e.basis1,direction:1,position:lt(A.get(),e.origin,e.basis1),edge:t};case Qt.POSITIVE_Y:return{basis:e.basis2,direction:1,position:lt(A.get(),e.origin,e.basis2),edge:t};case Qt.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:B(A.get(),e.origin,e.basis1),edge:t};case Qt.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:B(A.get(),e.origin,e.basis2),edge:t}}}function Yn(e){const t=Yt(e.basis1),i=Yt(e.basis2);return Ol*Math.min(t,i)}function Zi(e){return Yn(e)}function yi(e){return e.direction[0]!==0&&e.direction[1]!==0}function Pl(e,t=ze.CENTER_ON_ARROW){const i=t===ze.CENTER_ON_CALLOUT?Ai:0,a=[V(i,0,-on/2),V(i,0,on/2)],n=Nl(a,!0),s=(g,_)=>Ll(a,g,_),o=s(0,!1),l=s(Sl,!0),r=new In({color:yl,renderOccluded:C.OccludeAndTransparent}),h=Ae(r,[[i,0,0],[i-Ai,0,0]]),u=Ae(r,[[i,0,0],[i-Ai,0,0]]);return new it({view:e,renderObjects:[...o.normal.map(g=>new x(g,w.Unfocused|jt)),...l.normal.map(g=>new x(g,w.Unfocused|jt)),new x(h,w.Unfocused|jt|Bi),...o.focused.map(g=>new x(g,w.Focused|jt)),...l.focused.map(g=>new x(g,w.Focused|jt)),new x(u,w.Focused|jt|Bi)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:Xn,state:jt})}function zl(e,t){const i=yi(t),a=i?[V(1,0,0),V(0,0,0),V(0,1,0)]:[V(1,0,0),V(-1,0,0)],n=xl,s=y=>new Vi({color:n,width:y,renderOccluded:C.OccludeAndTransparent}),o=()=>new In({color:n,renderOccluded:C.OccludeAndTransparent}),l=i?wl:rn,r=l*dl,h=rn,u=y=>y>1?s(y):o(),g=[new x(Ae(u(l),a),w.Unfocused|qe),new x(Ae(u(r),a),w.Focused|qe),new x(Ae(u(h),a),Fn)],_=new it({view:e,renderObjects:g,collisionType:{type:"line",paths:[a]},radius:i?El:Al,...Ks});return _.state=qe,_}function Ll(e,t,i){const a=new Jt({color:ml,cullFace:Gt.Back,renderOccluded:C.Opaque}),n=new Jt({color:vl,cullFace:Gt.Back,renderOccluded:C.Opaque}),s=new Jt({color:fl,cullFace:Gt.Back,renderOccluded:C.Opaque}),o=new Jt({color:Ml,transparent:!0,writeDepth:!1,cullFace:Gt.Front,renderOccluded:C.Transparent}),l=r=>{e=e.slice(0);const h=B(A.get(),e[0],e[1]);ie(h,h);const u=B(A.get(),e[e.length-1],e[e.length-2]);if(ie(u,u),t>0){const ft=mt(z(),u,-t);e[e.length-1]=lt(ft,ft,e[e.length-1]);const T=mt(z(),h,-t);e[0]=lt(T,T,e[0])}const g=r?gl:1,_=Fi*g,y=Xn*g,M=ba(q.get());if(t>0){const ft=_/4,T=J(A.get(),0,ft,0),Q=1+t/ft;Ri(M,M,T),di(M,M,J(A.get(),Q,Q,Q)),Ri(M,M,mt(T,T,-1/Q))}const v=ba(kt()),b=V(0,1,0),S=Sa(kt(),za(Ra.get(),b,u));S[12]=e[e.length-1][0],S[13]=e[e.length-1][1],S[14]=e[e.length-1][2],Ut(S,S,M);const I=Vl(bl*(r?ul:1)+t,e,i?o:s);I.transformation=v;const N=[I],pt=Ni(i?o:a,_,y,24,!1,!1,!0);pt.transformation=S,N.push(pt);const X=Ni(i?o:n,_,y,24,!1,!0,!1);X.transformation=S,N.push(X);const Y=Sa(kt(),za(Ra.get(),b,h));return Y[12]=e[0][0],Y[13]=e[0][1],Y[14]=e[0][2],Ut(Y,Y,M),N.push(pt.instantiate({transformation:Y})),N.push(X.instantiate({transformation:Y})),N};return{normal:l(!1),focused:l(!0)}}function Vl(e,t,i){const a=[];for(let s=0;s<12;s++){const o=s/12*2*Math.PI;a.push([Math.cos(o)*e,Math.sin(o)*e])}return Gn(i,a,t,[],[],!1)}function Nl(e,t){const i=B(z(),e[e.length-1],e[e.length-2]);if(ie(i,i),mt(i,i,Fi),lt(i,i,e[e.length-1]),t){const a=B(z(),e[0],e[1]);return ie(a,a),mt(a,a,Fi),lt(a,a,e[0]),[a,...e,i]}return[...e,i]}function Hl(e,t){return Do(t,e.basis2,e.basis1)+ji}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(Qt||(Qt={}));const jt=nt.Custom1;var Pe,ln;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(Pe||(Pe={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(ln||(ln={}));const Bi=nt.Custom2;Cn();const ji=Math.PI/2,qe=nt.Custom1,Fn=nt.Custom2;var ze;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ze||(ze={}));const hn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",Ul={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function kl(e){return e.fromData(hn,()=>new ho(hn,Ul))}class Xl{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&d(this._lastDragEvent)&&d(this._next)){const i={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(i),this._next.execute(i)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new Pn;return this._next=t,[i=>(this._lastDragEvent=i.action!=="end"?{...i}:null,this._enabled&&this._adjustScaleFactors(i),i),t]}_adjustScaleFactors(t){const i=yi(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):t.handle.direction[0]===0?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-i:i,t.factor2=t.factor2<0?-i:i}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}let tt=class extends xt.EventedMixin(gi){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Ft,this._preserveAspectRatio=new Xl,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new _e,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=Fe(),this._mapBoundsStart=Fe(),this._zmax=0,this._sizeStart=null,this._displayBounds=Fe(),this._displayBoundsStart=Fe(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=we(),this._endScale=we()}initialize(){const{view:e,graphic:t,manipulators:i,_handles:a}=this,n=this._graphicState=new st({graphic:t}),s=t.geometry;this._editGeometryOperations=_i.fromGeometry(s,e.state.viewingMode),this._graphicMoveManipulation=new oa({tool:this,view:e,graphicState:n}),this._moveZManipulator=Pl(e,ze.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Bi,a.add([this._createMoveXYGraphicDragPipeline(),G(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._moveZManipulator,D.TRANSLATE_Z)),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map(u=>{const g=zl(e,u);return a.add([G(()=>this.enableScaling,()=>this._updateManipulatorAvailability(g,D.SCALE)),g.events.on("grab-changed",_=>this._onResizeGrab(_)),this._createResizeDragPipeline(g,u)]),g}),i.addMany(this._resizeManipulators),this._rotateManipulatorTexture=kl(e.toolViewManager.textures),this._rotateManipulator=to(e,{texture:this._rotateManipulatorTexture.texture}),a.add([G(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._rotateManipulator,D.ROTATE)),this._rotateManipulator.events.on("grab-changed",u=>{this._onRotateGrab(u)}),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const o=vi({view:e,graphic:t,forEachManipulator:u=>this._forEachManipulator(u),onManipulatorsChanged:()=>Kt()});d(o)&&(this._outlineVisualElement=o.visualElement instanceof ae?o.visualElement:null),d(this._outlineVisualElement)&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),a.add(o),a.add([n.on("changed",()=>this._onGeometryChanged()),G(()=>n.displaying,()=>this._updateAllManipulatorAvailability()),G(()=>n.isDraped,()=>this._graphicDrapedChanged(),Dt),e.trackGraphicState(n)]);const l=e.pointsOfInterest;a.add(G(()=>l==null?void 0:l.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds()));const r=u=>{a.add(u.events.on("grab-changed",()=>{this.grabbing=u.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(r);const h=(u,g)=>{a.add(u.events.on("immediate-click",_=>{g===D.TRANSLATE_XY&&this.emit("immediate-click",{..._,graphic:t}),_.stopPropagation()}))};this._forEachManipulator(h),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:e,view:t}=this,i=this._tooltip=new Ve({view:t}),a=()=>{i.info=this._getUpdatedTooltipInfo()};e.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",n=>{this._startAngle=n.angle,a()}),this.on("graphic-rotate",n=>{this._endAngle=n.angle,a()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,a()}),this.on("graphic-scale-start",n=>{Vt(this._startScale,n.xScale,n.yScale),Vt(this._endScale,n.xScale,n.yScale),a()}),this.on("graphic-scale",n=>{Vt(this._endScale,n.xScale,n.yScale),a()}),this.on("graphic-scale-stop",()=>{Vt(this._startScale,0,0),Vt(this._endScale,0,0),a()})]),this._forEachManipulator(n=>{e.add([n.events.on("focus-changed",a),n.events.on("grab-changed",a),n.events.on("drag",s=>{s.action==="cancel"?this._tooltip.clear():a()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some(e=>e.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=gt(this._moveXYTooltipInfo,()=>new Ie({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const e=this._moveZTooltipInfo=gt(this._moveZTooltipInfo,()=>new mi({tooltipOptions:this.tooltipOptions})),t=this._moveUnit;if(this._moveZManipulator.dragging){const i=this._mapBoundsStart.origin,a=this._mapBounds.origin,n=Xs(i,a,this.view.spatialReference);if(f(n))return null;e.distance=n}else e.distance=Re(0,t);return e}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo=gt(this._rotateTooltipInfo,()=>new Jo({tooltipOptions:this.tooltipOptions}));return e.angle=this._startAngle-this._endAngle,e}_computeScaleTooltipInfo(){const e=this.graphic.geometry;if(f(e))return null;const t=this._scaleTooltipInfo=gt(this._scaleTooltipInfo,()=>new Qo({tooltipOptions:this.tooltipOptions})),i=Aa(this._mapBounds,this._zmax,e.spatialReference,this._graphicState.isDraped);return f(i)?null:(t.xSize=i[0],t.ySize=i[1],d(this._sizeStart)&&this._resizeManipulators.some(a=>a.dragging)?(t.xScale=i[0].value/this._sizeStart[0].value,t.yScale=i[1].value/this._sizeStart[1].value):(t.xScale=1,t.yScale=1),t)}_graphicDrapedChanged(){this._handles.remove(pn),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",e=>{d(this._attachmentOrigin)&&vn(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()}),pn)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof it){const a=this._graphicState.displaying,n=this.enableZ&&te(this.graphic);switch(t){case D.ROTATE:e.available=a&&this.enableRotation;break;case D.SCALE:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?qe:Fn;break;case D.TRANSLATE_Z:e.available=a&&n;break;default:e.available=a}}}_forEachManipulator(e){this._graphicMoveManipulation.forEachManipulator(e),this._resizeManipulators.forEach(t=>e(t,D.SCALE)),e(this._rotateManipulator,D.ROTATE),e(this._moveZManipulator,D.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get _moveUnit(){return gt(Cs(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this._editGeometryOperations.data,i=t.components[0].edges[0],a=Ps(Ro.get(),i.leftVertex.pos,i.rightVertex.pos);Ti(a,a);const n=gt(Pi(this.view,this.graphic),()=>{var r;return(r=e.extent)==null?void 0:r.center});let s=n?Fl*this.view.pixelSizeAt(n):0;const o=this.view.spatialReference,l=e.spatialReference;o.equals(l)||(s*=Ii(o)/Ii(l)),Oo(a,t,s,this._mapBounds),this._updateZMax()}_updateZMax(){const e=this._editGeometryOperations.data;if(!e.geometry.hasZ)return void(this._zmax=0);const t=e.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of e.components)for(const n of a.vertices){const s=t.getZ(n.pos)??0;i=Math.max(s,i)}this._zmax=i}_updateDisplayBounds(){const{geometry:e}=this.graphic;if(f(e))return;const{extent:t}=e;if(!t)return;const i=d(this._outlineVisualElement)&&!this._graphicState.isDraped&&d(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:Pi(this.view,this.graphic);this._attachmentOrigin=gt(i,t.center);const a=d(i)?i.z:ea(this._mapBounds.origin,this.view.elevationProvider,Ne.fromElevationInfo(k(this.graphic)),this.view.renderCoordsHelper),n=ye(this._mapBounds);n.origin[2]=a??0,Eo(n,this.view.renderCoordsHelper,e.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){var i;const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:(i=this._editGeometryOperations.data.geometry.extent)==null?void 0:i.center;return t?Yl*this.view.pixelSizeAt(t):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline((e,t,i)=>this._applyGraphicMoveSteps(t,i,O.XY))}_createMoveZDragPipeline(){const e=this.view,t=this._editGeometryOperations.data.spatialReference;return vt(this._moveZManipulator,(i,a,n)=>{const s=On(i.renderLocation),o=a.next(Tn(e,s,t)).next(me());this._applyGraphicMoveSteps(o,n,O.Z)})}_applyGraphicMoveSteps(e,t,i){const a=e.next(n=>(n.action==="start"&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY})),n)).next(he()).next(this._moveDragUpdateGeometry()).next(n=>{const s={graphic:this.graphic,dxScreen:n.screenDeltaX,dyScreen:n.screenDeltaY};switch(n.action){case"start":case"update":(n.mapEnd.x-n.mapStart.x||n.mapEnd.y-n.mapStart.y||(n.mapEnd.z??0)-(n.mapStart.z??0))&&this.emit("graphic-translate",s);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",s)}return n}).next(n=>this._updateMoveTooltip(n,i));return t.next(()=>{d(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),a}_updateOperationStartProperties(){ye(this._displayBounds,this._displayBoundsStart),ye(this._mapBounds,this._mapBoundsStart),f(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=Aa(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return e=>{if(f(this.inputState)||this.inputState.type!=="move")return e;const t=[];for(const n of this._editGeometryOperations.data.components)t.push(...n.vertices);const i=e.action==="start"?Tt.NEW_STEP:Tt.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i);return Ye(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_updateMoveTooltip(e,t){if(t===O.XY||t===O.XY_AXIS){const i=Rt(e.mapStart,e.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");d(i)&&d(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=i)}return e}_onResizeGrab({action:e,screenPoint:t}){if(e!=="start"||!t)return;const i=this._calculatePickRay(t);Pa(this._displayBounds.plane,i,A.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return vt(e,(i,a,n)=>{f(this.inputState)||(a.next(s=>(s.action==="start"&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),s)).next(zi(this.view,this._displayBoundsStart.plane)).next(s=>({...s,handle:t})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next(s=>{const o={graphic:this.graphic,xScale:s.factor1,yScale:s.factor2};switch(s.action){case"start":case"update":this.emit("graphic-scale",o);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",o)}return s}),n.next(()=>{d(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return e=>{const t=this._displayBoundsStart,i=e.handle.direction,a=this._displayBoundsMargin,n=this._displayBoundsMarginStart,s=Ee(A.get(),t.origin);Xe(s,s,t.basis1,-i[0]),Xe(s,s,t.basis2,-i[1]);const o=B(A.get(),e.renderEnd,s),l=B(A.get(),e.renderStart,s),r=yi(e.handle),h=Zi(t),u=Zi(this._displayBounds)/h,g=(_,y)=>{if(_===0)return 1;let M=Yt(y),v=.5*_*Di(y,o)/M;const b=v<0?-1:1;r&&(v+=(M-.5*_*Di(y,l)/M)*b*u);const S=M<1.5*n?1:cn;return M=Math.max(M-n,cn),b>0&&(v-=a),b*Math.max(b*(v/M),S)};return{...e,factor1:g(i[0],t.basis1),factor2:g(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=Ee(z(),this._mapBoundsStart.origin);Xe(t,t,this._mapBoundsStart.basis1,-e.handle.direction[0]),Xe(t,t,this._mapBoundsStart.basis2,-e.handle.direction[1]);const i=Vt(we(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);Ti(i,i);const a=[];for(const o of this._editGeometryOperations.data.components)a.push(...o.vertices);const n=e.action==="start"?Tt.NEW_STEP:Tt.ACCUMULATE_STEPS,s=this._editGeometryOperations.scaleVertices(a,t,i,e.factor1,e.factor2,n,Ca.REPLACE);return ye(this._mapBoundsStart,this._mapBounds),Ye(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_onRotateGrab({action:e,screenPoint:t}){if(e!=="start"||!t)return;const i=Rl(this._displayBounds,this.view.renderCoordsHelper,Pe.HEADING,na()),a=this._calculatePickRay(t);Pa(i,a,A.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:i})}_createRotateDragPipeline(e){return vt(e,(t,i,a)=>{const n=this.inputState;f(n)||(i.next(s=>(s.action==="start"&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),s)).next(zi(this.view,n.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(n)).next(this._rotateDragUpdateGeometry()).next(s=>{const o={graphic:this.graphic,angle:$e(s.rotateAngle)};switch(s.action){case"start":case"update":this.emit("graphic-rotate",o);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",o)}return s}),a.next(()=>{d(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(e){return t=>{const i=He(e.rotatePlane),a=Dn(t.renderStart,t.renderEnd,this._displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return e=>{const t=Ee(z(),this._mapBoundsStart.origin),i=[];for(const s of this._editGeometryOperations.data.components)i.push(...s.vertices);const a=e.action==="start"?Tt.NEW_STEP:Tt.ACCUMULATE_STEPS,n=this._editGeometryOperations.rotateVertices(i,t,e.rotateAngle,a,Ca.REPLACE);return ye(this._mapBoundsStart,this._mapBounds),Ye(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=Cn(),i=zs(e);return eo(this.view.state.camera,i,t),ie(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=Dl(this._displayBounds,q.get());Il(this._rotateManipulator,e,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,e),this._resizeManipulators.forEach((t,i)=>{Gl(t,this._resizeHandles[i],e,this._displayBounds)})}_updateZMoveHandle(e,t){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:B(A.get(),i.origin,i.basis1),edge:2},n=q.get();Ls(n,t,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}_cancel(){const e=this._editGeometryOperations.lastOperation;f(e)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,Ta(e,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(d(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ta(R(e),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,Ye(R(e),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};p([c({constructOnly:!0,nonNullable:!0})],tt.prototype,"view",void 0),p([c({constructOnly:!0,nonNullable:!0})],tt.prototype,"graphic",void 0),p([c({constructOnly:!0,nonNullable:!0})],tt.prototype,"enableZ",void 0),p([c()],tt.prototype,"enableRotation",void 0),p([c()],tt.prototype,"enableScaling",void 0),p([c({constructOnly:!0,type:Ft})],tt.prototype,"tooltipOptions",void 0),p([c()],tt.prototype,"preserveAspectRatio",null),p([c()],tt.prototype,"grabbing",void 0),p([c()],tt.prototype,"inputState",void 0),p([c({readOnly:!0})],tt.prototype,"type",void 0),p([c()],tt.prototype,"_moveUnit",null),tt=p([U("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],tt);const pn="draped-elevation-changes",Yl=10,Fl=80,cn=1e-6,rp=Object.freeze(Object.defineProperty({__proto__:null,get DrawGraphicTool3D(){return Wt},get ExtentTransformTool(){return tt},get GraphicMoveTool(){return bt},get GraphicReshapeTool(){return Z},get GraphicTransformTool(){return K}},Symbol.toStringTag,{value:"Module"}));export{rp as e,Tl as t};
