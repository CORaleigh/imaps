(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[50],{1006:function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var r,a,o,i,s,c,l,u,d,f,p,m,v,h,b,g,x,O,y=n(33),j=n(35),w=n(558),T=n(915),C=n(943),S=n(969);function M(e,t){var n=e.fragment,s=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===s?(n.uniforms.add("lightingAmbientSH0","vec3"),n.code.add(Object(j.a)(r||(r=Object(y.a)(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===s?(n.uniforms.add("lightingAmbientSH_R","vec4"),n.uniforms.add("lightingAmbientSH_G","vec4"),n.uniforms.add("lightingAmbientSH_B","vec4"),n.code.add(Object(j.a)(a||(a=Object(y.a)(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 = vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight = vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===s&&(n.uniforms.add("lightingAmbientSH0","vec3"),n.uniforms.add("lightingAmbientSH_R1","vec4"),n.uniforms.add("lightingAmbientSH_G1","vec4"),n.uniforms.add("lightingAmbientSH_B1","vec4"),n.uniforms.add("lightingAmbientSH_R2","vec4"),n.uniforms.add("lightingAmbientSH_G2","vec4"),n.uniforms.add("lightingAmbientSH_B2","vec4"),n.code.add(Object(j.a)(o||(o=Object(y.a)(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 = vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 = vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight += vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),1!==t.pbrMode&&2!==t.pbrMode||n.code.add(Object(j.a)(i||(i=Object(y.a)(["\n        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))}function _(e){var t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.code.add(Object(j.a)(s||(s=Object(y.a)(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))}function A(e,t){var n=e.fragment;e.include(_),e.include(S.a,t),0!==t.pbrMode&&e.include(C.a,t),e.include(M,t),t.receiveShadows&&e.include(T.a,t),n.uniforms.add("lightingGlobalFactor","float"),n.uniforms.add("ambientBoostFactor","float"),e.include(w.a),n.code.add(Object(j.a)(c||(c=Object(y.a)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),0===t.pbrMode?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),t.useOldSceneLightInterface?n.code.add(Object(j.a)(l||(l=Object(y.a)(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot = -0.5;\n        float dotRange = 1.0 - minDot;\n        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight = mainLight + ambientLight + additionalLight;\n      totalLight = min(totalLight, vec3(PI));\n      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "])))):(1===t.viewingMode?n.code.add(Object(j.a)(u||(u=Object(y.a)(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld = normalize(vPosWorld);\n        float vndl = -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))):n.code.add(Object(j.a)(d||(d=Object(y.a)(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),n.code.add(Object(j.a)(f||(f=Object(y.a)(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),0===t.pbrMode||4===t.pbrMode?n.code.add(Object(j.a)(p||(p=Object(y.a)(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight = mainLighting + ambientLighting + additionalLight;\n        totalLight = min(totalLight, vec3(PI));\n        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "])))):1!==t.pbrMode&&2!==t.pbrMode||(n.code.add(Object(j.a)(m||(m=Object(y.a)(["\n      const float fillLightIntensity = 0.25;\n      const float horizonLightDiffusion = 0.4;\n      const float additionalAmbientIrradianceFactor = 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection = -viewDir;\n        vec3 mainLightDirection = -lightingMainDirection;\n        vec3 h = normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView = normalize(reflect(viewDirection, normal));\n        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao = ssao;\n\n        inputs.metalness = mrr[0];\n        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "])))),n.code.add(Object(j.a)(v||(v=Object(y.a)(["\n        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0\n        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),n.code.add(Object(j.a)(h||(h=Object(y.a)(["\n        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir = abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),n.code.add(Object(j.a)(b||(b=Object(y.a)(["\n        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon = dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "])))),n.code.add(Object(j.a)(g||(g=Object(y.a)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),2===t.pbrMode?Object(j.a)(x||(x=Object(y.a)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):Object(j.a)(O||(O=Object(y.a)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"])))))))}},1015:function(e,t,n){"use strict";n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return w}));var r,a,o=n(33),i=n(14),s=n(35),c=n(2),l=n(3),u=n(6),d=(n(46),n(26)),f=n(247),p=n(79),m=n(138),v=n(218),h=n(587),b=n(352),g=n(1039),x=function(){function e(t){var n=this;Object(c.a)(this,e),this.context=t,this.svgAlwaysPremultipliesAlpha=!1,this._doublePrecisionRequiresObfuscation=null,Object(g.a)(t).then((function(e){n.svgAlwaysPremultipliesAlpha=!e}))}return Object(l.a)(e,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(Object(u.j)(this._doublePrecisionRequiresObfuscation)){var e=y(this.context,!1),t=y(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}}]),e}(),O=null;function y(e,t){var n=new b.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});var r=m.a.createVertex(e,35044,new Uint16Array([0,0,1,0,0,1,1,1])),a=new v.a(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:r}),o=Object(d.g)(5633261.287538229,2626832.878767164,1434988.0495278358),i=Object(d.g)(5633271.46742708,2626873.6381334523,1434963.231608387),s=function(n,r){var a=new f.a(e,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",{a_pos:0}),o=new Float32Array(6);Object(h.a)(n,o,3);var i=new Float32Array(6);return Object(h.a)(r,i,3),e.bindProgram(a),a.setUniform3f("u_highA",o[0],o[2],o[4]),a.setUniform3f("u_lowA",o[1],o[3],o[5]),a.setUniform3f("u_highB",i[0],i[2],i[4]),a.setUniform3f("u_lowB",i[1],i[3],i[5]),a}(o,i),c=e.getBoundFramebufferObject(),l=e.getViewport(),u=l.x,g=l.y,x=l.width,O=l.height;e.bindFramebuffer(n),e.setViewport(0,0,1,1),e.bindVAO(a),e.drawArrays(5,0,4);var y=new Uint8Array(4);n.readPixels(0,0,1,1,6408,5121,y),s.dispose(),a.dispose(!1),r.dispose(),n.dispose(),e.setViewport(u,g,x,O),e.bindFramebuffer(c);var j=(o[2]-i[2])/25,w=Object(p.k)(y);return Math.abs(j-w)}function j(e,t){var n=e.code;t.doublePrecisionRequiresObfuscation?n.add(Object(s.a)(r||(r=Object(o.a)(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = dpPlusFrc(hiA, hiB);\n        vec3 e = dpMinusFrc(t1, hiA);\n        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "])))):n.add(Object(s.a)(a||(a=Object(o.a)(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 = hiA + hiB;\n        vec3 e = t1 - hiA;\n        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))}function w(e){return!!Object(i.a)("force-double-precision-obfuscation")||(t=e,(Object(u.j)(O)||O.context!==t)&&(O=new x(t)),O).doublePrecisionRequiresObfuscation;var t}},1016:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,a,o,i=n(33),s=n(35);function c(e){e.vertex.code.add(Object(s.a)(r||(r=Object(i.a)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),s.a.int(1),s.a.int(3),s.a.int(4),s.a.int(1)))}function l(e,t){t.symbolColor?(e.include(c),e.attributes.add("symbolColor","vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add(Object(s.a)(a||(a=Object(i.a)(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode = float(symbolColorMixMode) + 0.5;\n    }\n  "])))):e.vertex.code.add(Object(s.a)(o||(o=Object(i.a)(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))}},1039:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(7),a=n.n(r),o=n(16),i=(n(14),n(247)),s=n(138),c=n(100),l=n(218),u=n(352);function d(e){return f.apply(this,arguments)}function f(){return(f=Object(o.a)(a.a.mark((function e(t){var n,r,o,d,f,p,m,v,h,b,g,x,O;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",n.width=5,n.height=5,e.next=6,n.decode();case 6:if(t.gl){e.next=8;break}return e.abrupt("return",!0);case 8:return r=new u.a(t,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),o=s.a.createVertex(t,35044,new Uint16Array([0,0,1,0,0,1,1,1])),d=new l.a(t,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:o}),f=new i.a(t,"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",{a_pos:0}),t.bindProgram(f),p=new c.a(t,{dataType:5121,pixelFormat:6408,preMultiplyAlpha:!1,wrapMode:33071,samplingMode:9729},n),t.bindTexture(p,0),f.setUniform1i("u_texture",0),m=t.getBoundFramebufferObject(),v=t.getViewport(),h=v.x,b=v.y,g=v.width,x=v.height,t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.bindVAO(d),t.drawArrays(5,0,4),O=new Uint8Array(4),e.abrupt("return",(r.readPixels(0,0,1,1,6408,5121,O),f.dispose(),d.dispose(!1),o.dispose(),r.dispose(),p.dispose(),t.setViewport(h,b,g,x),t.bindFramebuffer(m),n.src="",255===O[0]));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},1074:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y})),n.d(t,"b",(function(){return $}));var r,a,o,i,s,c,l,u,d,f,p,m,v,h,b,g,x,O,y,j=n(33),w=n(35),T=n(541),C=n(246),S=n(201),M=n(298),_=n(356),A=n(248),k=n(551),R=n(296),P=n(915),I=n(939),L=n(943),B=n(966),F=n(947),E=n(967),N=n(994),D=n(950),z=n(968),V=n(1016),U=n(547),G=n(1088),H=n(995),q=n(1112),W=n(969),X=n(1006),J=n(1113),Q=n(1114),K=n(996);function $(e){var t=new C.a,n=t.vertex.code,$=t.fragment.code;return t.include(Q.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(z.a),t.varyings.add("vpos","vec3"),t.include(_.a,e),t.include(B.a,e),t.include(k.a,e),0!==e.output&&7!==e.output||(t.include(D.a,e),t.include(T.a,{linearDepth:!1}),0===e.normalType&&e.offsetBackfaces&&t.include(N.a),t.include(q.a,e),t.include(G.a,e),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("localvpos","vec3"),t.include(F.a,e),t.include(I.a,e),t.include(V.a,e),t.include(U.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),n.add(Object(w.a)(r||(r=Object(j.a)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",w.a.float(A.c),0===e.normalType?Object(w.a)(a||(a=Object(j.a)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangets?"vTangent = dpTransformVertexTangent(tangent);":"",0===e.normalType&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),7===e.output&&(t.include(S.a,e),t.include(A.a,e),e.multipassTerrainEnabled&&(t.fragment.include(M.a),t.include(R.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(K.a),$.add(Object(w.a)(o||(o=Object(j.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(w.a)(i||(i=Object(j.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(w.a)(s||(s=Object(j.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(w.a)(c||(c=Object(j.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(w.a)(l||(l=Object(j.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(S.a,e),t.include(X.a,e),t.include(W.a,e),t.include(A.a,e),e.receiveShadows&&t.include(P.a,e),e.multipassTerrainEnabled&&(t.fragment.include(M.a),t.include(R.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(E.a,e),t.include(L.a,e),t.fragment.include(K.a),t.include(J.a,e),$.add(Object(w.a)(u||(u=Object(j.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - camPos);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?Object(w.a)(d||(d=Object(j.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(w.a)(f||(f=Object(j.a)(["vec4 texColor = vec4(1.0);"]))),3===e.normalType?Object(w.a)(p||(p=Object(j.a)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):Object(w.a)(m||(m=Object(j.a)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(w.a)(v||(v=Object(j.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(w.a)(h||(h=Object(j.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?Object(w.a)(b||(b=Object(j.a)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(w.a)(g||(g=Object(j.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(w.a)(x||(x=Object(j.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(w.a)(O||(O=Object(j.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(w.a)(y||(y=Object(j.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(H.a,e),t}var Y=Object.freeze({__proto__:null,build:$})},1075:function(e,t,n){"use strict";n.d(t,"a",(function(){return J})),n.d(t,"b",(function(){return X}));var r,a,o,i,s,c,l,u,d,f,p,m,v,h,b,g,x,O,y,j=n(33),w=n(35),T=n(541),C=n(246),S=n(201),M=n(298),_=n(356),A=n(248),k=n(551),R=n(296),P=n(915),I=n(939),L=n(943),B=n(966),F=n(947),E=n(967),N=n(994),D=n(950),z=n(968),V=n(1016),U=n(547),G=n(995),H=n(969),q=n(1006),W=n(996);function X(e){var t=new C.a,n=t.vertex.code,X=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3"),t.include(z.a),t.varyings.add("vpos","vec3"),t.include(_.a,e),t.include(B.a,e),t.include(k.a,e),0!==e.output&&7!==e.output||(t.include(D.a,e),t.include(T.a,{linearDepth:!1}),e.offsetBackfaces&&t.include(N.a),e.instancedColor&&t.attributes.add("instanceColor","vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(F.a,e),t.include(I.a,e),t.include(V.a,e),t.include(U.a,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),n.add(Object(w.a)(r||(r=Object(j.a)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",w.a.float(A.c),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"",e.multipassTerrainEnabled?Object(w.a)(a||(a=Object(j.a)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),7===e.output&&(t.include(S.a,e),t.include(A.a,e),e.multipassTerrainEnabled&&(t.fragment.include(M.a),t.include(R.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(W.a),X.add(Object(w.a)(o||(o=Object(j.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?Object(w.a)(i||(i=Object(j.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(w.a)(s||(s=Object(j.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(w.a)(c||(c=Object(j.a)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?Object(w.a)(l||(l=Object(j.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(w.a)(u||(u=Object(j.a)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),0===e.output&&(t.include(S.a,e),t.include(q.a,e),t.include(H.a,e),t.include(A.a,e),e.receiveShadows&&t.include(P.a,e),e.multipassTerrainEnabled&&(t.fragment.include(M.a),t.include(R.b,e)),t.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(E.a,e),t.include(L.a,e),t.fragment.include(W.a),X.add(Object(w.a)(d||(d=Object(j.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - camPos);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?Object(w.a)(f||(f=Object(j.a)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?Object(w.a)(p||(p=Object(j.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):Object(w.a)(m||(m=Object(j.a)(["vec4 texColor = vec4(1.0);"]))),1===e.pbrMode?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":1===e.viewingMode?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?Object(w.a)(v||(v=Object(j.a)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):Object(w.a)(h||(h=Object(j.a)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),Object(w.a)(b||(b=Object(j.a)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),1===e.pbrMode||2===e.pbrMode?1===e.viewingMode?Object(w.a)(g||(g=Object(j.a)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):Object(w.a)(x||(x=Object(j.a)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):Object(w.a)(O||(O=Object(j.a)([""]))),1===e.pbrMode||2===e.pbrMode?Object(w.a)(y||(y=Object(j.a)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(G.a,e),t}var J=Object.freeze({__proto__:null,build:X})},1088:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r,a,o,i,s,c,l,u=n(33),d=n(35),f=n(950),p=n(2),m=n(26),v=n(278),h=n(110),b=n(1015),g=n(968);function x(e,t){e.include(g.a),e.vertex.include(b.a,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3"),e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3"),e.vertex.uniforms.add("uTransform_ProjFromView","mat4"),e.vertex.code.add(Object(d.a)(r||(r=Object(u.a)(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel = dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative = positionWorldCameraRelative();\n      vPosition_view = position_view();\n      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "])))),e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3"),e.fragment.code.add(Object(d.a)(a||(a=Object(u.a)(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}function O(e,t){0===t.normalType||1===t.normalType?(e.include(f.a,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),e.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),e.vertex.code.add(Object(d.a)(o||(o=Object(u.a)(["\n      void forwardNormal() {\n        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):2===t.normalType?(e.include(x,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(Object(d.a)(i||(i=Object(u.a)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),1===t.viewingMode?Object(d.a)(s||(s=Object(u.a)(["normalize(vPositionWorldCameraRelative);"]))):Object(d.a)(c||(c=Object(u.a)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add(Object(d.a)(l||(l=Object(u.a)(["\n      void forwardNormal() {}\n    "]))))}!function(e){e.ModelTransform=function e(){Object(p.a)(this,e),this.worldFromModel_RS=Object(v.a)(),this.worldFromModel_TH=Object(m.e)(),this.worldFromModel_TL=Object(m.e)()};e.ViewProjectionTransform=function e(){Object(p.a)(this,e),this.worldFromView_TH=Object(m.e)(),this.worldFromView_TL=Object(m.e)(),this.viewFromCameraRelative_RS=Object(v.a)(),this.projFromView=Object(h.b)()},e.bindModelTransform=function(e,t){e.setUniformMatrix3fv("uTransform_WorldFromModel_RS",t.worldFromModel_RS),e.setUniform3fv("uTransform_WorldFromModel_TH",t.worldFromModel_TH),e.setUniform3fv("uTransform_WorldFromModel_TL",t.worldFromModel_TL)},e.bindViewProjTransform=function(e,t){e.setUniform3fv("uTransform_WorldFromView_TH",t.worldFromView_TH),e.setUniform3fv("uTransform_WorldFromView_TL",t.worldFromView_TL),e.setUniformMatrix4fv("uTransform_ProjFromView",t.projFromView),e.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",t.viewFromCameraRelative_RS)}}(x||(x={})),(O||(O={})).bindUniforms=function(e,t){e.setUniformMatrix4fv("viewNormal",t)}},1112:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,a,o,i,s=n(33),c=n(35),l=n(1124);function u(e,t){var n=e.fragment;n.uniforms.add("normalTexture","sampler2D"),n.uniforms.add("normalTextureSize","vec2"),t.vertexTangets?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===t.doubleSidedMode?n.code.add(Object(c.a)(r||(r=Object(s.a)(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "])))):n.code.add(Object(c.a)(a||(a=Object(s.a)(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(e.extensions.add("GL_OES_standard_derivatives"),n.code.add(Object(c.a)(o||(o=Object(s.a)(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 = dFdx(pos);\n      vec3 Q2 = dFdy(pos);\n\n      vec2 stx = dFdx(st);\n      vec2 sty = dFdy(st);\n\n      float det = stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent\n      T = T - normal * dot(normal, T); // orthogonalize tangent\n      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  ']))))),0!==t.attributeTextureCoordinates&&(e.include(l.a,t),n.code.add(Object(c.a)(i||(i=Object(s.a)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},1113:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,a,o,i,s=n(33),c=n(35);function l(e,t){var n=e.fragment;n.code.add(Object(c.a)(r||(r=Object(s.a)(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "])))),1===t.doubleSidedMode?n.code.add(Object(c.a)(a||(a=Object(s.a)(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "])))):2===t.doubleSidedMode?n.code.add(Object(c.a)(o||(o=Object(s.a)(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "])))):n.code.add(Object(c.a)(i||(i=Object(s.a)(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))}},1114:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r,a=n(33),o=(n(14),n(35));function i(e,t){Object(o.a)(r||(r=Object(a.a)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,0===t.output?"RenderOutput: Color":1===t.output?"RenderOutput: Depth":3===t.output?"RenderOutput: Shadow":2===t.output?"RenderOutput: Normal":4===t.output?"RenderOutput: Highlight":"")}},1124:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,a,o,i,s=n(33),c=n(35),l=n(947);function u(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(c.a)(r||(r=Object(s.a)(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      // clamp the derivatives to avoid discoloring when zooming out.\n      float maxdUV = 0.125; // Emprirically tuned compromise between discoloring and aliasing noise.\n      vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n      vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto = dFdx(uvAtlas);\n        vec2 dUVdyAuto = dFdy(uvAtlas);\n        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))}function d(e,t){e.include(l.a,t),e.fragment.code.add(Object(c.a)(a||(a=Object(s.a)(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),t.supportsTextureAtlas?"vec2 size;":"")),1===t.attributeTextureCoordinates&&e.fragment.code.add(Object(c.a)(o||(o=Object(s.a)(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "])))),2===t.attributeTextureCoordinates&&(e.include(u),e.fragment.code.add(Object(c.a)(i||(i=Object(s.a)(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))}},1232:function(e,t,n){"use strict";n.r(t),n.d(t,"fetch",(function(){return Wt})),n.d(t,"gltfToEngineResources",(function(){return Qt})),n.d(t,"parseUrl",(function(){return Jt}));var r=n(7),a=n.n(r),o=n(15),i=n(10),s=n(16),c=n(6),l=n(26),u=n(13),d=n(493),f=n(82),p=n(278),m=n(110),v=n(145),h=n(115),b=n(12),g=b.a.getLogger("esri.views.3d.support.buffer.math");function x(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[4],c=n[5],l=n[6],u=n[8],d=n[9],f=n[10],p=n[12],m=n[13],v=n[14],h=e.typedBuffer,b=e.typedBufferStride,x=t.typedBuffer,O=t.typedBufferStride,y=0;y<r;y++){var j=y*b,w=y*O,T=x[w],C=x[w+1],S=x[w+2];h[j]=a*T+s*C+u*S+p,h[j+1]=o*T+c*C+d*S+m,h[j+2]=i*T+l*C+f*S+v}else g.error("source and destination buffers need to have the same number of elements")}function O(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[3],c=n[4],l=n[5],u=n[6],d=n[7],f=n[8],p=e.typedBuffer,m=e.typedBufferStride,v=t.typedBuffer,h=t.typedBufferStride,b=0;b<r;b++){var x=b*m,O=b*h,y=v[O],j=v[O+1],w=v[O+2];p[x]=a*y+s*j+u*w,p[x+1]=o*y+c*j+d*w,p[x+2]=i*y+l*j+f*w}else g.error("source and destination buffers need to have the same number of elements")}function y(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var l=c*o,u=c*s;a[l]=n*i[u],a[l+1]=n*i[u+1],a[l+2]=n*i[u+2]}}Object.freeze({__proto__:null,transformMat4:x,transformMat3:O,scale:y,shiftRight:function(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var l=c*o,u=c*s;a[l]=i[u]>>n,a[l+1]=i[u+1]>>n,a[l+2]=i[u+2]>>n}}});var j=n(161),w=n(156),T=n(2),C=n(3),S=n(30),M=n(28),_=n(4),A=n(5),k=n(255),R=n(960),P=n(591),I=n(195),L=n(277),B=n(311),F=n(248),E=n(154),N=n(0),D=n(249),z=n(252),V=n(66),U=n(251),G=n(247),H=n(109),q=n(223),W=n(201),X=n(250),J=n(356),Q=n(551),K=n(296),$=n(169),Y=n(915),Z=n(1015),ee=n(966),te=n(967),ne=n(1074),re=function(e){Object(_.a)(n,e);var t=Object(A.a)(n);function n(){return Object(T.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,a=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:r.usePBR?r.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:r.hasMetalnessAndRoughnessTexture,hasEmissionTexture:r.hasEmissionTexture,hasOcclusionTexture:r.hasOcclusionTexture,hasNormalTexture:r.hasNormalTexture,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:r.normalsTypeDerivate?3:0,doubleSidedMode:r.doubleSidedMode,vertexTangets:r.vertexTangents,attributeTextureCoordinates:r.hasMetalnessAndRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture||r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(Z.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new G.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),U.a)}},{key:"bindPass",value:function(e,t,n){q.a.bindProjectionMatrix(this.program,n.camera.projectionMatrix);var r=this.configuration.output;(1===this.configuration.output||n.multipassTerrainEnabled||3===r)&&this.program.setUniform2fv("cameraNearFar",n.camera.nearFar),n.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",n.inverseViewport),Object(K.a)(this.program,e,n)),7===r&&(this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",I.b[t.colorMixMode])),0===r?(n.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",t.ambient),this.program.setUniform3fv("diffuse",t.diffuse),this.program.setUniform4fv("externalColor",t.externalColor),this.program.setUniform1i("colorMixMode",I.b[t.colorMixMode]),this.program.setUniform1f("opacity",t.opacity),this.program.setUniform1f("layerOpacity",t.layerOpacity),this.configuration.usePBR&&te.a.bindUniforms(this.program,t,this.configuration.isSchematic)):4===r&&X.a.bindOutputHighlight(e,this.program,n),J.a.bindUniformsForSymbols(this.program,t),Q.a.bindUniforms(this.program,t,n),Object(I.a)(t.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),2!==t.textureAlphaMode&&3!==t.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",t.textureAlphaCutoff)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?Object(l.g)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;q.a.bindViewCustomOrigin(this.program,t,e.camera.viewMatrix),(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&q.a.bindCamPosition(this.program,t,e.camera.viewInverseTransposeMatrix),2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&ee.a.bindCustomOrigin(this.program,t),W.a.bindUniforms(this.program,this.configuration,e.slicePlane,t),0===this.configuration.output&&Y.a.bindViewCustomOrigin(this.program,e,t)}},{key:"setPipeline",value:function(e,t){var n=this.configuration,r=3===e,a=2===e;return Object(H.d)({blending:0!==n.output&&7!==n.output||!n.transparent?null:r?E.f:Object(E.a)(e),culling:ae(n),depthTest:{func:Object(E.b)(e)},depthWrite:r||a?n.writeDepth&&H.c:null,colorWrite:H.b,stencilWrite:n.sceneHasOcludees?$.h:null,stencilTest:n.sceneHasOcludees?t?$.d:$.c:null,polygonOffset:r||a?null:Object(E.g)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipeline(this.configuration.transparencyPassType,!0),this.setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),n}(z.a);re.shader=new D.a(ne.a,(function(){return n.e(232).then(n.bind(null,1226))}));var ae=function(e){return function(e){return e.cullFace?0!==e.cullFace:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}(e)&&{face:1===e.cullFace?1028:1029,mode:2305}},oe=function(e){Object(_.a)(n,e);var t=Object(A.a)(n);function n(){var e;return Object(T.a)(this,n),(e=t.apply(this,arguments)).output=0,e.alphaDiscardMode=1,e.doubleSidedMode=0,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=0,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return n}(V.a);Object(N.a)([Object(V.b)({count:8})],oe.prototype,"output",void 0),Object(N.a)([Object(V.b)({count:4})],oe.prototype,"alphaDiscardMode",void 0),Object(N.a)([Object(V.b)({count:3})],oe.prototype,"doubleSidedMode",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"isSchematic",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"vertexColors",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"offsetBackfaces",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"symbolColors",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"vvSize",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"vvColor",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"verticalOffset",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"receiveShadows",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"slicePlaneEnabled",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"sliceHighlightDisabled",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"receiveAmbientOcclusion",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"screenSizePerspective",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"textureAlphaPremultiplied",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"hasColorTexture",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"usePBR",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"hasMetalnessAndRoughnessTexture",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"hasEmissionTexture",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"hasOcclusionTexture",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"hasNormalTexture",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"instanced",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"instancedColor",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"instancedDoublePrecision",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"vertexTangents",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"normalsTypeDerivate",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"writeDepth",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"sceneHasOcludees",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"transparent",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"enableOffset",void 0),Object(N.a)([Object(V.b)({count:3})],oe.prototype,"cullFace",void 0),Object(N.a)([Object(V.b)({count:4})],oe.prototype,"transparencyPassType",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"multipassTerrainEnabled",void 0),Object(N.a)([Object(V.b)()],oe.prototype,"cullAboveGround",void 0);var ie=n(1075),se=function(e){Object(_.a)(n,e);var t=Object(A.a)(n);function n(){return Object(T.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,a=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,receiveShadows:r.receiveShadows,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:r.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:r.symbolColors,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!0,instanced:r.instanced,instancedColor:r.instancedColor,instancedDoublePrecision:r.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:r.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:r.hasColorTexture,receiveAmbientOcclusion:r.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:r.hasColorTexture?1:0,textureAlphaPremultiplied:r.textureAlphaPremultiplied,attributeColor:r.vertexColors,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,offsetBackfaces:r.offsetBackfaces,doublePrecisionRequiresObfuscation:Object(Z.b)(e.rctx),alphaDiscardMode:r.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new G.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),U.a)}}]),n}(re);se.shader=new D.a(ie.a,(function(){return n.e(228).then(n.bind(null,1227))}));var ce=function(e){Object(_.a)(n,e);var t=Object(A.a)(n);function n(e){var r;return Object(T.a)(this,n),(r=t.call(this,e,de)).supportsEdges=!0,r.techniqueConfig=new oe,r.vertexBufferLayout=n.getVertexBufferLayout(r.params),r.instanceBufferLayout=e.instanced?n.getInstanceBufferLayout(r.params):null,r}return Object(C.a)(n,[{key:"isVisibleInPass",value:function(e){return 4!==e&&6!==e&&7!==e||this.params.castShadows}},{key:"isVisible",value:function(){var e=this.params;if(!Object(S.a)(Object(M.a)(n.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,r=e.vertexColors,a=e.symbolColors,o=!!t&&t.indexOf("color")>-1,i=e.vvColorEnabled,s="replace"===e.colorMixMode,c=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return r&&(o||i||a)?!!s||c:r?s?l:c:o||i||a?!!s||c:s?l:c}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.params.textureId,this.techniqueConfig.vertexTangents=this.params.vertexTangents,this.techniqueConfig.instanced=!!this.params.instanced,this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.cullFace=null!=this.params.cullFace?this.params.cullFace:0,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,0!==e&&7!==e||(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering?this.techniqueConfig.doubleSidedMode=2:this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&this.params.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!(!t||!t.ssaoEnabled)&&this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<E.e),this.techniqueConfig}},{key:"intersect",value:function(e,t,n,r,a,o,i){if(null!==this.params.verticalOffset){var s=r.camera;Object(u.v)(ge,n[12],n[13],n[14]);var c=null;switch(r.viewingMode){case 1:c=Object(u.q)(he,ge);break;case 2:c=Object(u.j)(he,ve)}var l=0;if(null!==this.params.verticalOffset){var d=Object(u.i)(xe,ge,s.eye),f=Object(u.o)(d),p=Object(u.d)(d,d,1/f),m=null;this.params.screenSizePerspective&&(m=Object(u.g)(c,p)),l+=Object(I.g)(s,f,this.params.verticalOffset,m,this.params.screenSizePerspective)}Object(u.d)(c,c,l),Object(u.w)(be,c,r.transform.inverseRotation),a=Object(u.i)(pe,a,be),o=Object(u.i)(me,o,be)}Object(I.e)(e,t,r,a,o,Object(R.f)(r.verticalOffset),i)}},{key:"getGLMaterial",value:function(e){if(0===e.output||7===e.output||1===e.output||2===e.output||3===e.output||4===e.output)return new le(e)}},{key:"createBufferWriter",value:function(){return new fe(this.vertexBufferLayout,this.instanceBufferLayout)}}],[{key:"getVertexBufferLayout",value:function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,n=Object(k.a)().vec3f("position").vec3f("normal");return e.vertexTangents&&n.vec4f("tangent"),t&&n.vec2f("uv0"),e.vertexColors&&n.vec4u8("color"),e.symbolColors&&n.vec4u8("symbolColor"),n}},{key:"getInstanceBufferLayout",value:function(e){var t=Object(k.a)();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t}}]),n}(L.a),le=function(e){Object(_.a)(n,e);var t=Object(A.a)(n);function n(e){var r;Object(T.a)(this,n);var a=e.material;return(r=t.call(this,Object(i.a)(Object(i.a)({},e),a.params))).updateParameters(),r}return Object(C.a)(n,[{key:"updateParameters",value:function(e){var t=this.material.params;this.updateTexture(t.textureId),this.technique=t.treeRendering?this.techniqueRep.acquireAndReleaseExisting(se,this.material.getTechniqueConfig(this.output,e),this.technique):this.techniqueRep.acquireAndReleaseExisting(re,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"selectPipelines",value:function(){}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this.material.params.shadowMappingEnabled&&this.material.setParameterValues({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:e.hasOccludees})}},{key:"ensureParameters",value:function(e){0!==this.output&&7!==this.output||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t),this.bindTexture(e,this.technique.program)}},{key:"beginSlot",value:function(e){return e===(this.material.params.transparent?this.material.params.writeDepth?5:8:3)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),n}(P.a),ue=2.1,de=Object(i.a)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(p.a)(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:F.b,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},L.b),fe=function(){function e(t,n){Object(T.a)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=n}return Object(C.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,r){Object(B.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)}}]),e}(),pe=Object(l.e)(),me=Object(l.e)(),ve=Object(l.g)(0,0,1),he=Object(l.e)(),be=Object(l.e)(),ge=Object(l.e)(),xe=Object(l.e)(),Oe=n(578),ye=n(20),je=n(11),we=n(24),Te=n(54),Ce=n(279),Se=function(){function e(t){Object(T.a)(this,e),this.streamDataRequester=t}return Object(C.a)(e,[{key:"loadJSON",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load("json",t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadBinary",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(je.u)(t)?(Object(we.u)(n),Object(je.j)(t)):this.load("binary",t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadImage",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.load("image",t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,r){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(c.j)(this.streamDataRequester)){e.next=4;break}return e.next=3,Object(Te.default)(n,{responseType:Me[t]});case 3:return e.abrupt("return",e.sent.data);case 4:return e.next=6,Object(Ce.c)(this.streamDataRequester.request(n,t,r));case 6:if(!0!==(o=e.sent).ok){e.next=9;break}return e.abrupt("return",o.value);case 9:throw Object(we.t)(o.error),new ye.a("","Request for resource failed: ".concat(o.error));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),Me={image:"image",binary:"array-buffer",json:"json"},_e=n(586);function Ae(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<s;++u)r[c]=o[l],r[c+1]=o[l+1],c+=a,l+=i}function ke(e,t,n){var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i;if(Object(_e.b)(t.elementType)){var u=Object(_e.d)(t.elementType);if(Object(_e.c)(t.elementType))for(var d=0;d<s;++d)r[c]=Math.max(o[l]/u,-1),r[c+1]=Math.max(o[l+1]/u,-1),c+=a,l+=i;else for(var f=0;f<s;++f)r[c]=o[l]/u,r[c+1]=o[l+1]/u,c+=a,l+=i}else Ae(e,t,n);return e}Object.freeze({__proto__:null,copy:Ae,normalizeIntegerBuffer:ke});function Re(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<s;++u)r[c]=o[l],r[c+1]=o[l+1],r[c+2]=o[l+2],c+=a,l+=i}Object.freeze({__proto__:null,copy:Re});function Pe(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<s;++u)r[c]=o[l],r[c+1]=o[l+1],r[c+2]=o[l+2],r[c+3]=o[l+3],c+=a,l+=i}function Ie(e,t,n,r,a,o){for(var i=e.typedBuffer,s=e.typedBufferStride,c=o?o.count:e.count,l=(o&&o.dstIndex?o.dstIndex:0)*s,u=0;u<c;++u)i[l]=t,i[l+1]=n,i[l+2]=r,i[l+3]=a,l+=s}Object.freeze({__proto__:null,copy:Pe,fill:Ie});Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<s;++u){for(var d=0;d<9;++d)r[c+d]=o[l+d];c+=a,l+=i}}});Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<s;++u){for(var d=0;d<16;++d)r[c+d]=o[l+d];c+=a,l+=i}}});function Le(e,t){var n=e.count;t||(t=new e.TypedArrayConstructor(n));for(var r=0;r<n;r++)t[r]=e.get(r);return t}Object.freeze({__proto__:null,copy:function(e,t,n){for(var r=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,i=t.typedBufferStride,s=n?n.count:t.count,c=(n&&n.dstIndex?n.dstIndex:0)*a,l=(n&&n.srcIndex?n.srcIndex:0)*i,u=0;u<s;++u)r[c]=o[l],c+=a,l+=i},makeDense:Le});function Be(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Object(_e.a)(e.ElementType)))}var Fe=n(32),Ee=b.a.getLogger("esri.views.3d.glTF"),Ne=function(){function e(){Object(T.a)(this,e)}return Object(C.a)(e,[{key:"error",value:function(e){throw new ye.a("gltf-loader-error",e)}},{key:"errorUnsupported",value:function(e){throw new ye.a("gltf-loader-unsupported-feature",e)}},{key:"errorUnsupportedIf",value:function(e,t){e&&this.errorUnsupported(t)}},{key:"assert",value:function(e,t){e||this.error(t)}},{key:"warn",value:function(e){Ee.warn(e)}},{key:"warnUnsupported",value:function(e){this.warn("[Unsupported Feature] "+e)}},{key:"warnUnsupportedIf",value:function(e,t){e&&this.warnUnsupported(t)}}]),e}();var De=n(183),ze=n(447),Ve=n(307),Ue=n(514),Ge=function(){function e(t){Object(T.a)(this,e),this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}return Object(C.a)(e,[{key:"readUint32",value:function(){var e=this.offset4;return this.offset4+=1,this.dataUint32[e]}},{key:"readUint8Array",value:function(e){var t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)}},{key:"remainingBytes",value:function(){return this.data.byteLength-4*this.offset4}}]),e}(),He={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},qe={pbrMetallicRoughness:He,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},We={ESRI_externalColorMixMode:"tint"},Xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(i.a)(Object(i.a)({},He),e.pbrMetallicRoughness),n=Je(Object(i.a)(Object(i.a)({},We),e.extras));return Object(i.a)(Object(i.a)(Object(i.a)({},qe),e),{},{pbrMetallicRoughness:t,extras:n})};function Je(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:Object(De.a)(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return e}var Qe={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},Ke=function(e){return Object(i.a)(Object(i.a)({},Qe),e)};var $e=1179937895,Ye=1313821514,Ze=5130562,et=function(){function e(t,n,r,a,o){Object(T.a)(this,e),this.context=t,this.errorContext=n,this.uri=r,this.json=a,this.glbBuffer=o,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=function(e){var t,n;return e.replace(/^(.*\/)?([^/]*)$/,(function(e,r,a){return t=r||"",n=a||"",""})),{dirPart:t,filePart:n}}(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),n.errorUnsupportedIf(null==a.scenes,"Scenes must be defined."),n.errorUnsupportedIf(null==a.meshes,"Meshes must be defined"),n.errorUnsupportedIf(null==a.nodes,"Nodes must be defined."),this.computeNodeParents()}return Object(C.a)(e,[{key:"getBuffer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.json.buffers[t],o=this.errorContext,null!=r.uri){e.next=3;break}return e.abrupt("return",(o.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer));case 3:if(i=this.bufferCache.get(t)){e.next=9;break}return e.next=7,this.context.loadBinary(this.resolveUri(r.uri),n);case 7:s=e.sent,i=new Uint8Array(s),this.bufferCache.set(t,i),o.assert(i.byteLength===r.byteLength,"Buffer byte lengths should match.");case 9:return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAccessor",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o,i,s,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.json.accessors[t],(o=this.errorContext).errorUnsupportedIf(null==r.bufferView,"Some accessor does not specify a bufferView."),o.errorUnsupportedIf(r.type in["MAT2","MAT3","MAT4"],"AttributeType ".concat(r.type," is not supported")),i=this.json.bufferViews[r.bufferView],e.next=5,this.getBuffer(i.buffer,n);case 5:return s=e.sent,c=at[r.type],l=ot[r.componentType],u=c*l,d=i.byteStride||u,e.abrupt("return",{raw:s.buffer,byteStride:d,byteOffset:s.byteOffset+(i.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:d===u,componentCount:c,componentByteSize:l,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIndexData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.indices){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.getAccessor(t.indices,n);case 4:if(!(r=e.sent).isDenselyPacked){e.next=14;break}e.t0=r.componentType,e.next=5121===e.t0?9:5123===e.t0?10:5125===e.t0?11:12;break;case 9:return e.abrupt("return",new Uint8Array(r.raw,r.byteOffset,r.entryCount));case 10:return e.abrupt("return",new Uint16Array(r.raw,r.byteOffset,r.entryCount));case 11:return e.abrupt("return",new Uint32Array(r.raw,r.byteOffset,r.entryCount));case 12:e.next=20;break;case 14:e.t1=r.componentType,e.next=5121===e.t1?17:5123===e.t1?18:5125===e.t1?19:20;break;case 17:return e.abrupt("return",Le(this.wrapAccessor(h.l,r)));case 18:return e.abrupt("return",Le(this.wrapAccessor(h.j,r)));case 19:return e.abrupt("return",Le(this.wrapAccessor(h.k,r)));case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getPositionData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).errorUnsupportedIf(null==t.attributes.POSITION,"No POSITION vertex data found."),e.next=4,this.getAccessor(t.attributes.POSITION,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==o.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+dt[o.componentType]),r.errorUnsupportedIf(3!==o.componentCount,"POSITION vertex attribute must have 3 components, but found "+o.componentCount.toFixed()),this.wrapAccessor(h.u,o)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNormalData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.NORMAL,"No NORMAL vertex data found."),e.next=4,this.getAccessor(t.attributes.NORMAL,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==o.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+dt[o.componentType]),r.errorUnsupportedIf(3!==o.componentCount,"NORMAL vertex attribute must have 3 components, but found "+o.componentCount.toFixed()),this.wrapAccessor(h.u,o)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTangentData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.TANGENT,"No TANGENT vertex data found."),e.next=4,this.getAccessor(t.attributes.TANGENT,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(5126!==o.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+dt[o.componentType]),r.errorUnsupportedIf(4!==o.componentCount,"TANGENT vertex attribute must have 4 components, but found "+o.componentCount.toFixed()),new h.C(o.raw,o.byteOffset,o.byteStride,o.byteOffset+o.byteStride*o.entryCount)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTextureCoordinates",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),e.next=4,this.getAccessor(t.attributes.TEXCOORD_0,n);case 4:return o=e.sent,e.abrupt("return",(r.errorUnsupportedIf(2!==o.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+o.componentCount.toFixed()),5126===o.componentType?this.wrapAccessor(h.m,o):(r.errorUnsupportedIf(!o.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),it(o))));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getVertexColors",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=this.errorContext).assert(null!=t.attributes.COLOR_0,"No COLOR_0 vertex data found."),e.next=4,this.getAccessor(t.attributes.COLOR_0,n);case 4:if(o=e.sent,r.errorUnsupportedIf(4!==o.componentCount&&3!==o.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+o.componentCount.toFixed()),4!==o.componentCount){e.next=14;break}if(5126!==o.componentType){e.next=8;break}return e.abrupt("return",this.wrapAccessor(h.C,o));case 8:if(5121!==o.componentType){e.next=10;break}return e.abrupt("return",this.wrapAccessor(h.J,o));case 10:if(5123!==o.componentType){e.next=12;break}return e.abrupt("return",this.wrapAccessor(h.H,o));case 12:e.next=21;break;case 14:if(3!==o.componentCount){e.next=21;break}if(5126!==o.componentType){e.next=17;break}return e.abrupt("return",this.wrapAccessor(h.u,o));case 17:if(5121!==o.componentType){e.next=19;break}return e.abrupt("return",this.wrapAccessor(h.B,o));case 19:if(5123!==o.componentType){e.next=21;break}return e.abrupt("return",this.wrapAccessor(h.z,o));case 21:r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+dt[o.componentType]);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"hasPositions",value:function(e){return void 0!==e.attributes.POSITION}},{key:"hasNormals",value:function(e){return void 0!==e.attributes.NORMAL}},{key:"hasVertexColors",value:function(e){return void 0!==e.attributes.COLOR_0}},{key:"hasTextureCoordinates",value:function(e){return void 0!==e.attributes.TEXCOORD_0}},{key:"hasTangents",value:function(e){return void 0!==e.attributes.TANGENT}},{key:"getMaterial",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,r){var o,i,s,c,l,u,d,f,p,m,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.errorContext,i=this.materialCache.get(t.material)){e.next=48;break}if(s=null!=t.material?Xe(this.json.materials[t.material]):Xe(),c=s.pbrMetallicRoughness,l=this.hasVertexColors(t),e.t0=c.baseColorTexture,!e.t0){e.next=10;break}return o.errorUnsupportedIf(0!==(c.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),e.next=9,this.getTexture(c.baseColorTexture.index,n);case 9:u=e.sent;case 10:if(e.t1=s.normalTexture,!e.t1){e.next=19;break}if(0===(s.normalTexture.texCoord||0)){e.next=16;break}o.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."),e.next=19;break;case 16:return e.next=18,this.getTexture(s.normalTexture.index,n);case 18:d=e.sent;case 19:if(e.t2=s.occlusionTexture&&r,!e.t2){e.next=28;break}if(0===(s.occlusionTexture.texCoord||0)){e.next=25;break}o.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."),e.next=28;break;case 25:return e.next=27,this.getTexture(s.occlusionTexture.index,n);case 27:f=e.sent;case 28:if(e.t3=s.emissiveTexture&&r,!e.t3){e.next=37;break}if(0===(s.emissiveTexture.texCoord||0)){e.next=34;break}o.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."),e.next=37;break;case 34:return e.next=36,this.getTexture(s.emissiveTexture.index,n);case 36:p=e.sent;case 37:if(e.t4=c.metallicRoughnessTexture&&r,!e.t4){e.next=46;break}if(0===(c.metallicRoughnessTexture.texCoord||0)){e.next=43;break}o.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."),e.next=46;break;case 43:return e.next=45,this.getTexture(c.metallicRoughnessTexture.index,n);case 45:m=e.sent;case 46:v=null!=t.material?t.material:-1,i={alphaMode:s.alphaMode,alphaCutoff:s.alphaCutoff,color:c.baseColorFactor,doubleSided:!!s.doubleSided,colorTexture:u,normalTexture:d,name:s.name,id:v,occlusionTexture:f,emissiveTexture:p,emissiveFactor:s.emissiveFactor,metallicFactor:c.metallicFactor,roughnessFactor:c.roughnessFactor,metallicRoughnessTexture:m,vertexColors:l,ESRI_externalColorMixMode:s.extras.ESRI_externalColorMixMode};case 48:return e.abrupt("return",i);case 49:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getTexture",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o,i,s,c,l,u,d;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.errorContext,o=this.json.textures[t],i=Ke(null!=o.sampler?this.json.samplers[o.sampler]:{}),r.errorUnsupportedIf(null==o.source,"Source is expected to be defined for a texture."),s=this.json.images[o.source],c=this.textureCache.get(t)){e.next=21;break}if(!s.uri){e.next=11;break}return e.next=8,this.context.loadImage(this.resolveUri(s.uri),n);case 8:l=e.sent,e.next=20;break;case 11:return r.errorUnsupportedIf(null==s.bufferView,"Image bufferView must be defined."),r.errorUnsupportedIf(null==s.mimeType,"Image mimeType must be defined."),u=this.json.bufferViews[s.bufferView],e.next=15,this.getBuffer(u.buffer,n);case 15:return d=e.sent,r.errorUnsupportedIf(null!=u.byteStride,"byteStride not supported for image buffer"),e.next=19,lt(new Uint8Array(d.buffer,d.byteOffset+(u.byteOffset||0),u.byteLength),s.mimeType);case 19:l=e.sent;case 20:c={data:l,wrapS:i.wrapS,wrapT:i.wrapT,minFilter:i.minFilter,name:s.name,id:t},this.textureCache.set(t,c);case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNodeTransform",value:function(e){if(void 0===e)return nt;var t=this.nodeTransformCache.get(e);if(!t){var n=this.getNodeTransform(this.getNodeParent(e)),r=this.json.nodes[e];r.matrix?t=Object(f.l)(Object(m.b)(),n,r.matrix):r.translation||r.rotation||r.scale?(t=Object(m.c)(n),r.translation&&Object(f.s)(t,t,r.translation),r.rotation&&(rt[3]=Object(Ue.b)(rt,r.rotation),Object(f.q)(t,t,rt[3],rt)),r.scale&&Object(f.r)(t,t,r.scale)):t=n,this.nodeTransformCache.set(e,t)}return t}},{key:"wrapAccessor",value:function(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}},{key:"resolveUri",value:function(e){return Object(je.z)(e,this.baseUri)}},{key:"getNodeParent",value:function(e){return this.nodeParentMap.get(e)}},{key:"checkVersionSupported",value:function(){var e=ze.a.parse(this.json.asset.version,"glTF");tt.validate(e)}},{key:"checkRequiredExtensionsSupported",value:function(){var e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}},{key:"computeNodeParents",value:function(){var e=this;this.json.nodes.forEach((function(t,n){t.children&&t.children.forEach((function(t){e.nodeParentMap.set(t,n)}))}))}}],[{key:"load",value:function(){var t=Object(s.a)(a.a.mark((function t(n,r,o,i){var s,c,l,u,d,f;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(je.u)(o)){t.next=13;break}if("model/gltf-binary"===(s=Object(je.i)(o)).mediaType){t.next=10;break}return t.prev=3,c=JSON.parse(s.isBase64?atob(s.data):s.data),t.abrupt("return",new e(n,r,o,c));case 8:t.prev=8,t.t0=t.catch(3);case 10:if(l=Object(je.j)(o),!e.isGLBData(l)){t.next=13;break}return t.abrupt("return",this.fromGLBData(n,r,o,l));case 13:if(!o.endsWith(".gltf")){t.next=18;break}return t.next=16,n.loadJSON(o,i);case 16:return u=t.sent,t.abrupt("return",new e(n,r,o,u));case 18:return t.next=20,n.loadBinary(o,i);case 20:if(d=t.sent,!e.isGLBData(d)){t.next=23;break}return t.abrupt("return",this.fromGLBData(n,r,o,d));case 23:return t.next=25,n.loadJSON(o,i);case 25:return f=t.sent,t.abrupt("return",new e(n,r,o,f));case 27:case"end":return t.stop()}}),t,this,[[3,8]])})));return function(e,n,r,a){return t.apply(this,arguments)}}()},{key:"isGLBData",value:function(e){var t=new Ge(e);return t.remainingBytes()>=4&&t.readUint32()===$e}},{key:"fromGLBData",value:function(){var t=Object(s.a)(a.a.mark((function t(n,r,o,i){var s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.parseGLBData(r,i);case 2:return s=t.sent,t.abrupt("return",new e(n,r,o,s.json,s.binaryData));case 4:case"end":return t.stop()}}),t)})));return function(e,n,r,a){return t.apply(this,arguments)}}()},{key:"parseGLBData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o,i,s,c,l,u,d,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Ge(n),t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large."),o=r.readUint32(),i=r.readUint32(),s=r.readUint32(),t.assert(o===$e,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(n.byteLength>=s,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(2!==i,"An unsupported GLB container version was detected. Only version 2 is supported."),u=0;case 5:if(!(r.remainingBytes()>=8)){e.next=19;break}if(d=r.readUint32(),f=r.readUint32(),0!==u){e.next=15;break}return t.assert(f===Ye,"First GLB chunk must be JSON."),t.assert(d>=0,"No JSON data found."),e.next=12,st(r.readUint8Array(d));case 12:c=e.sent,e.next=16;break;case 15:1===u?(t.errorUnsupportedIf(f!==Ze,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(d)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping.");case 16:u+=1;case 17:e.next=5;break;case 19:return e.abrupt("return",(c||t.error("No GLB JSON chunk detected."),{json:c,binaryData:l}));case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),tt=new ze.a(2,0,"glTF"),nt=Object(f.j)(Object(m.b)(),Math.PI/2),rt=Object(Ve.a)(),at={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},ot={5120:1,5121:1,5122:2,5123:2,5126:4,5125:4};function it(e){switch(e.componentType){case 5120:return new h.q(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new h.t(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new h.o(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new h.r(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new h.s(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new h.m(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void Object(De.a)(e.componentType)}}function st(e){return ct.apply(this,arguments)}function ct(){return(ct=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new Blob([t]),a=new FileReader;a.onload=function(){var t=a.result;e(JSON.parse(t))},a.onerror=function(e){n(e)},a.readAsText(r)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lt(e,t){return ut.apply(this,arguments)}function ut(){return(ut=Object(s.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var a=new Blob([t],{type:n}),o=URL.createObjectURL(a),i=new Image;i.addEventListener("load",(function(){URL.revokeObjectURL(o),"decode"in i?i.decode().then((function(){return e(i)}),(function(){return e(i)})):e(i)})),i.addEventListener("error",(function(e){URL.revokeObjectURL(o),r(e)})),i.src=o})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var dt={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"},ft=0;function pt(e,t){return mt.apply(this,arguments)}function mt(){return(mt=Object(s.a)(a.a.mark((function e(t,n){var r,o,i,l,u,d,f=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]?f[2]:{},o=!(f.length>3&&void 0!==f[3])||f[3],e.next=4,et.load(t,jt,n,r);case 4:return i=e.sent,l="gltf_"+ft++,u={lods:[],materials:new Map,textures:new Map,meta:ht(i)},d=!(!i.json.asset.extras||"symbolResource"!==i.json.asset.extras.ESRI_type),e.next=10,bt(i,function(){var e=Object(s.a)(a.a.mark((function e(t,n,s,d){var f,p,v,h,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=void 0!==t.mode?t.mode:4,p=vt(f),!Object(c.j)(p)){e.next=3;break}return e.abrupt("return",void jt.warnUnsupported("Unsupported primitive mode ("+Tt[f]+"). Skipping primitive."));case 3:if(i.hasPositions(t)){e.next=5;break}return e.abrupt("return",void jt.warn("Skipping primitive without POSITION vertex attribute."));case 5:return e.next=7,i.getMaterial(t,r,o);case 7:return v=e.sent,e.t0=Object(m.c)(n),e.next=11,i.getPositionData(t,r);case 11:return e.t1=e.sent,e.t2={position:e.t1,normal:null,texCoord0:null,color:null,tangent:null},e.next=15,i.getIndexData(t,r);case 15:if(e.t3=e.sent,e.t4=p,e.t5=Ot(u,v,l),h={transform:e.t0,attributes:e.t2,indices:e.t3,primitiveType:e.t4,material:e.t5},e.t6=i.hasNormals(t),!e.t6){e.next=24;break}return e.next=23,i.getNormalData(t,r);case 23:h.attributes.normal=e.sent;case 24:if(e.t7=i.hasTangents(t),!e.t7){e.next=29;break}return e.next=28,i.getTangentData(t,r);case 28:h.attributes.tangent=e.sent;case 29:if(e.t8=i.hasTextureCoordinates(t),!e.t8){e.next=34;break}return e.next=33,i.getTextureCoordinates(t,r);case 33:h.attributes.texCoord0=e.sent;case 34:if(e.t9=i.hasVertexColors(t),!e.t9){e.next=39;break}return e.next=38,i.getVertexColors(t,r);case 38:h.attributes.color=e.sent;case 39:b=null,Object(c.k)(u.meta)&&Object(c.k)(u.meta.ESRI_lod)&&"screenSpaceRadius"===u.meta.ESRI_lod.metric&&(b=u.meta.ESRI_lod.thresholds[s]),u.lods[s]=u.lods[s]||{parts:[],name:d,lodThreshold:b},u.lods[s].parts.push(h);case 41:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}());case 10:return e.abrupt("return",{model:u,meta:{isEsriSymbolResource:d,uri:i.uri},customMeta:{}});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vt(e){switch(e){case 4:case 5:case 6:return e;default:return null}}function ht(e){var t=e.json,n=null;return t.nodes.forEach((function(e){var t=e.extras;Object(c.k)(t)&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(n=t)})),n}function bt(e,t){return gt.apply(this,arguments)}function gt(){return(gt=Object(s.a)(a.a.mark((function e(t,n){var r,i,c,l,u,d,f,p,m,v,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h=function(){return(h=Object(s.a)(a.a.mark((function e(i,s){var c,l,u,d,f,p,m,h,b;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r.nodes[i],l=t.getNodeTransform(i),jt.warnUnsupportedIf(null!=c.weights,"Morph targets are not supported."),null==c.mesh){e.next=20;break}u=r.meshes[c.mesh],d=Object(o.a)(u.primitives),e.prev=4,d.s();case 6:if((f=d.n()).done){e.next=12;break}return p=f.value,e.next=10,n(p,l,s,u.name);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),d.e(e.t0);case 17:return e.prev=17,d.f(),e.finish(17);case 20:m=Object(o.a)(c.children||[]),e.prev=21,m.s();case 23:if((h=m.n()).done){e.next=29;break}return b=h.value,e.next=27,v(b,s);case 27:e.next=23;break;case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(21),m.e(e.t1);case 34:return e.prev=34,m.f(),e.finish(34);case 37:case"end":return e.stop()}}),e,null,[[4,14,17,20],[21,31,34,37]])})))).apply(this,arguments)},v=function(e,t){return h.apply(this,arguments)},r=t.json,i=r.scenes[r.scene||0].nodes,c=i.length>1,l=Object(o.a)(i),e.prev=4,l.s();case 6:if((u=l.n()).done){e.next=14;break}return d=u.value,f=r.nodes[d],p=[v(d,0)],xt(f)&&!c&&(m=f.extensions.MSFT_lod.ids,p.push.apply(p,Object(Fe.a)(m.map((function(e,t){return v(e,t+1)}))))),e.next=12,Promise.all(p);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),l.e(e.t0);case 19:return e.prev=19,l.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[4,16,19,22]])})))).apply(this,arguments)}function xt(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Ot(e,t,n){var r=function(t){var r="".concat(n,"_tex_").concat(t&&t.id).concat(t&&t.name?"_"+t.name:"");if(t&&!e.textures.has(r)){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{data:e,parameters:Object(i.a)({wrap:Object(i.a)({s:10497,t:10497},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}(t.data,{wrap:{s:yt(t.wrapS),t:yt(t.wrapT)},mipmap:wt.some((function(e){return e===t.minFilter})),noUnpackFlip:!0});e.textures.set(r,a)}return r},a="".concat(n,"_mat_").concat(t.id,"_").concat(t.name);if(!e.materials.has(a)){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(i.a)({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(a,o)}return a}function yt(e){if(33071===e||33648===e||10497===e)return e;jt.error("Unexpected TextureSampler WrapMode: ".concat(e))}var jt=new Ne,wt=[9987,9985],Tt=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"],Ct=n(101),St=n(226);var Mt=n(593),_t=b.a.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function At(e,t){return kt.apply(this,arguments)}function kt(){return(kt=Object(s.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rt(t,n);case 2:return r=e.sent,e.t0=r,e.next=6,Dt(r.textureDefinitions,n);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rt(e,t){return Pt.apply(this,arguments)}function Pt(){return(Pt=Object(s.a)(a.a.mark((function e(t,n){var r,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=Object(c.k)(n)&&n.streamDataRequester)){e.next=3;break}return e.abrupt("return",It(t,r,n));case 3:return e.next=5,Object(Ce.c)(Object(Te.default)(t,Object(c.q)(n)));case 5:if(!0!==(o=e.sent).ok){e.next=8;break}return e.abrupt("return",o.value.data);case 8:Object(we.t)(o.error),Bt(o.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e,t,n){return Lt.apply(this,arguments)}function Lt(){return(Lt=Object(s.a)(a.a.mark((function e(t,n,r){var o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Ce.c)(n.request(t,"json",r));case 2:if(!0!==(o=e.sent).ok){e.next=5;break}return e.abrupt("return",o.value);case 5:Object(we.t)(o.error),Bt(o.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bt(e){throw new ye.a("","Request for object resource failed: ".concat(e))}function Ft(e){var t=e.params,n=t.topology,r=!0;switch(t.vertexAttributes||(_t.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var a=t.faces;if(a){if(t.vertexAttributes)for(var o in t.vertexAttributes){var i=a[o];i&&i.values?(null!=i.valueType&&"UInt32"!==i.valueType&&(_t.warn("Unsupported indexed geometry indices type '".concat(i.valueType,"', only UInt32 is currently supported")),r=!1),null!=i.valuesPerElement&&1!==i.valuesPerElement&&(_t.warn("Unsupported indexed geometry values per element '".concat(i.valuesPerElement,"', only 1 is currently supported")),r=!1)):(_t.warn("Indexed geometry does not specify face indices for '".concat(o,"' attribute")),r=!1)}}else _t.warn("Indexed geometries must specify faces"),r=!1;break;default:_t.warn("Unsupported topology '".concat(n,"'")),r=!1}e.params.material||(_t.warn("Geometry requires material"),r=!1);var s=e.params.vertexAttributes;for(var c in s)s[c].values||(_t.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Et(e,t){var n=[],r=[],a=[],o=[],i=e.resource,s=ze.a.parse(i.version||"1.0","wosr");Gt.validate(s);for(var u=i.model.name,d=i.model.geometries,f=i.materialDefinitions,p=e.textures,m=0,v=new Map,h=0;h<d.length;h++){var b=d[h];if(Ft(b)){var g=Ut(b),x=b.params.vertexAttributes,O=[];for(var y in x){var j=x[y],T=j.values;O.push([y,{data:T,size:j.valuesPerElement,exclusive:!0}])}var C=[];if("PerAttributeArray"!==b.params.topology){var S=b.params.faces;for(var M in S)C.push([M,new Uint32Array(S[M].values)])}var _=p&&p[g.texture];if(_&&!v.has(g.texture)){var A=_.image,k=_.params,R=new Oe.a(A,k);o.push(R),v.set(g.texture,R)}var P=v.get(g.texture),I=P?P.id:void 0,L=a[g.material]?a[g.material][g.texture]:null;if(!L){var B=f[g.material.substring(g.material.lastIndexOf("/")+1)].params;1===B.transparency&&(B.transparency=0);var F=_&&_.alphaChannelUsage,E=B.transparency>0||"transparency"===F||"maskAndTransparency"===F,N={ambient:Object(l.f)(B.diffuse),diffuse:Object(l.f)(B.diffuse),opacity:1-(B.transparency||0),transparent:E,textureAlphaMode:_?Vt(_.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:B.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};Object(c.k)(t)&&t.materialParamsMixin&&Object.assign(N,t.materialParamsMixin),L=new ce(N),a[g.material]||(a[g.material]={}),a[g.material][g.texture]=L}r.push(L);var D=new w.a(O,C);m+=C.position?C.position.length:0,n.push(D)}}return{name:u,stageResources:{textures:o,materials:r,geometries:n},pivotOffset:i.model.pivotOffset,boundingBox:Nt(n),numberOfVertices:m,lodThreshold:null}}function Nt(e){var t=Object(j.e)();return e.forEach((function(e){var n=e.boundingInfo;Object(c.k)(n)&&(Object(j.j)(t,n.getBBMin()),Object(j.j)(t,n.getBBMax()))})),t}function Dt(e,t){return zt.apply(this,arguments)}function zt(){return(zt=Object(s.a)(a.a.mark((function e(t,n){var r,i,s,l,u,d,f,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=function(e){var a=t[e],o=a.images[0].data;if(!o)return _t.warn("Externally referenced texture data is not yet supported"),"continue";var i=a.encoding+";base64,"+o,s="/textureDefinitions/"+e,l={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},u=Object(c.k)(n)&&n.disableTextures?Promise.resolve(null):Object(Mt.a)(i,n);r.push(u.then((function(e){return{refId:s,image:e,params:l,alphaChannelUsage:"rgba"===a.channels?a.alphaChannelUsage||"transparency":"none"}})))},e.t0=a.a.keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,"continue"!==i(s)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(r);case 12:l=e.sent,u={},d=Object(o.a)(l);try{for(d.s();!(f=d.n()).done;)p=f.value,u[p.refId]=p}catch(m){d.e(m)}finally{d.f()}return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vt(e){switch(e){case"mask":return 2;case"maskAndTransparency":return 3;case"none":return 1;case"transparency":default:return 0}}function Ut(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var Gt=new ze.a(1,2,"wosr");function Ht(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[3],c=n[4],l=n[5],u=n[6],d=n[7],f=n[8],p=e.typedBuffer,m=e.typedBufferStride,v=t.typedBuffer,h=t.typedBufferStride,b=0;b<r;b++){var x=b*m,O=b*h,y=v[O],j=v[O+1],w=v[O+2],T=v[O+3];p[x]=a*y+s*j+u*w,p[x+1]=o*y+c*j+d*w,p[x+2]=i*y+l*j+f*w,p[x+3]=T}else g.error("source and destination buffers need to have the same number of elements")}function qt(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var l=c*o,u=c*s;a[l]=n*i[u],a[l+1]=n*i[u+1],a[l+2]=n*i[u+2],a[l+3]=n*i[u+3]}}Object.freeze({__proto__:null,transformMat4:function(e,t,n){if(e.count===t.count)for(var r=e.count,a=n[0],o=n[1],i=n[2],s=n[3],c=n[4],l=n[5],u=n[6],d=n[7],f=n[8],p=n[9],m=n[10],v=n[11],h=n[12],b=n[13],x=n[14],O=n[15],y=e.typedBuffer,j=e.typedBufferStride,w=t.typedBuffer,T=t.typedBufferStride,C=0;C<r;C++){var S=C*j,M=C*T,_=w[M],A=w[M+1],k=w[M+2],R=w[M+3];y[S]=a*_+c*A+f*k+h*R,y[S+1]=o*_+l*A+p*k+b*R,y[S+2]=i*_+u*A+m*k+x*R,y[S+3]=s*_+d*A+v*k+O*R}else g.error("source and destination buffers need to have the same number of elements")},transformMat3:Ht,scale:qt,shiftRight:function(e,t,n){for(var r=Math.min(e.count,t.count),a=e.typedBuffer,o=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,c=0;c<r;c++){var l=c*o,u=c*s;a[l]=i[u]>>n,a[l+1]=i[u+1]>>n,a[l+2]=i[u+2]>>n,a[l+3]=i[u+3]>>n}}});function Wt(e,t){return Xt.apply(this,arguments)}function Xt(){return(Xt=Object(s.a)(a.a.mark((function e(t,n){var r,o,s,l,u,f,p,m,v,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(r=Jt(Object(d.a)(t))).fileType){e.next=7;break}return e.next=4,n.cache?n.cache.loadWOSR(r.url,n):At(r.url,n);case 4:return o=e.sent,s=Et(o,n),e.abrupt("return",{lods:[s],referenceBoundingBox:s.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:o.remove});case 7:return e.next=9,n.cache?n.cache.loadGLTF(r.url,n,n.usePBR):pt(new Se(n.streamDataRequester),r.url,n,n.usePBR);case 9:if(l=e.sent,u=Object(c.i)(l.model.meta,"ESRI_proxyEllipsoid"),l.meta.isEsriSymbolResource&&Object(c.k)(u)&&-1!==l.meta.uri.indexOf("/RealisticTrees/")&&$t(l,u),f=l.meta.isEsriSymbolResource?{usePBR:n.usePBR,isSchematic:!1,treeRendering:l.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:n.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},p=Object(i.a)(Object(i.a)({},n.materialParamsMixin),{},{treeRendering:l.customMeta.esriTreeRendering}),null==r.specifiedLodIndex){e.next=18;break}return m=Qt(l,f,p,r.specifiedLodIndex),v=m[0].boundingBox,0!==r.specifiedLodIndex&&(v=Qt(l,f,p,0)[0].boundingBox),e.abrupt("return",{lods:m,referenceBoundingBox:v,isEsriSymbolResource:l.meta.isEsriSymbolResource,isWosr:!1,remove:l.remove});case 18:return h=Qt(l,f,p),e.abrupt("return",{lods:h,referenceBoundingBox:h[0].boundingBox,isEsriSymbolResource:l.meta.isEsriSymbolResource,isWosr:!1,remove:l.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function Qt(e,t,n,r){var a=e.model,o=Object(p.a)(),s=new Array,l=new Map,u=new Map;return a.lods.forEach((function(e,d){if(void 0===r||d===r){var f={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:Object(c.k)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Object(j.e)()};s.push(f),e.parts.forEach((function(e){var r=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=a.materials.get(e.material),d=Object(c.k)(e.attributes.texCoord0),p=Object(c.k)(e.attributes.normal);if(!l.has(r)){if(d){if(Object(c.k)(s.textureColor)&&!u.has(s.textureColor)){var m=a.textures.get(s.textureColor),b=Object(i.a)(Object(i.a)({},m.parameters),{},{preMultiplyAlpha:!0});u.set(s.textureColor,new Oe.a(m.data,b))}if(Object(c.k)(s.textureNormal)&&!u.has(s.textureNormal)){var g=a.textures.get(s.textureNormal),T=Object(i.a)(Object(i.a)({},g.parameters),{},{preMultiplyAlpha:!0});u.set(s.textureNormal,new Oe.a(g.data,T))}if(Object(c.k)(s.textureOcclusion)&&!u.has(s.textureOcclusion)){var C=a.textures.get(s.textureOcclusion),S=Object(i.a)(Object(i.a)({},C.parameters),{},{preMultiplyAlpha:!0});u.set(s.textureOcclusion,new Oe.a(C.data,S))}if(Object(c.k)(s.textureEmissive)&&!u.has(s.textureEmissive)){var M=a.textures.get(s.textureEmissive),_=Object(i.a)(Object(i.a)({},M.parameters),{},{preMultiplyAlpha:!0});u.set(s.textureEmissive,new Oe.a(M.data,_))}if(Object(c.k)(s.textureMetallicRoughness)&&!u.has(s.textureMetallicRoughness)){var A=a.textures.get(s.textureMetallicRoughness),k=Object(i.a)(Object(i.a)({},A.parameters),{},{preMultiplyAlpha:!0});u.set(s.textureMetallicRoughness,new Oe.a(A.data,k))}}var R=Math.pow(s.color[0],1/ue),P=Math.pow(s.color[1],1/ue),I=Math.pow(s.color[2],1/ue),L=Math.pow(s.emissiveFactor[0],1/ue),B=Math.pow(s.emissiveFactor[1],1/ue),F=Math.pow(s.emissiveFactor[2],1/ue);l.set(r,new ce(Object(i.a)(Object(i.a)({},t),{},{transparent:"BLEND"===s.alphaMode,textureAlphaMode:Kt(s.alphaMode),textureAlphaCutoff:s.alphaCutoff,diffuse:[R,P,I],ambient:[R,P,I],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?0:2,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:p?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:Object(c.k)(s.textureColor)&&d?u.get(s.textureColor).id:void 0,colorMixMode:s.colorMixMode,normalTextureId:Object(c.k)(s.textureNormal)&&d?u.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:Object(c.k)(s.textureOcclusion)&&d?u.get(s.textureOcclusion).id:void 0,emissiveTextureId:Object(c.k)(s.textureEmissive)&&d?u.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:Object(c.k)(s.textureMetallicRoughness)&&d?u.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[L,B,F],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},n)))}var E=function(e,t){switch(t){case 4:return function(e){return"number"==typeof e?Object(St.d)(e):Object(Ct.i)(e)||Object(Ct.k)(e)?new Uint32Array(e):e}(e);case 5:return function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);var n=t-2,r=n<=65536?new Uint16Array(3*n):new Uint32Array(3*n);if("number"==typeof e)for(var a=0,o=0;o<n;o+=1)o%2==0?(r[a++]=o,r[a++]=o+1,r[a++]=o+2):(r[a++]=o+1,r[a++]=o,r[a++]=o+2);else for(var i=0,s=0;s<n;s+=1)if(s%2==0){var c=e[s],l=e[s+1],u=e[s+2];r[i++]=c,r[i++]=l,r[i++]=u}else{var d=e[s+1],f=e[s],p=e[s+2];r[i++]=d,r[i++]=f,r[i++]=p}return r}(e);case 6:return function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint16Array(0);var n=t-2,r=n<=65536?new Uint16Array(3*n):new Uint32Array(3*n);if("number"==typeof e){for(var a=0,o=0;o<n;++o)r[a++]=0,r[a++]=o+1,r[a++]=o+2;return r}for(var i=e[0],s=e[1],c=0,l=0;l<n;++l){var u=e[l+2];r[c++]=i,r[c++]=s,r[c++]=u,s=u}return r}(e)}}(e.indices||e.attributes.position.count,e.primitiveType),N=e.attributes.position.count,D=Be(h.u,N);x(D,e.attributes.position,e.transform);var z=[["position",{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]],V=[["position",E]];if(Object(c.k)(e.attributes.normal)){var U=Be(h.u,N);Object(v.h)(o,e.transform),O(U,e.attributes.normal,o),z.push(["normal",{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),V.push(["normal",E])}if(Object(c.k)(e.attributes.tangent)){var G=Be(h.C,N);Object(v.h)(o,e.transform),Ht(G,e.attributes.tangent,o),z.push(["tangent",{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),V.push(["tangent",E])}if(Object(c.k)(e.attributes.texCoord0)){var H=Be(h.m,N);ke(H,e.attributes.texCoord0),z.push(["uv0",{data:H.typedBuffer,size:H.elementCount,exclusive:!0}]),V.push(["uv0",E])}if(Object(c.k)(e.attributes.color)){var q=Be(h.J,N);if(4===e.attributes.color.elementCount)e.attributes.color instanceof h.C?qt(q,e.attributes.color,255):e.attributes.color instanceof h.J?Pe(q,e.attributes.color):e.attributes.color instanceof h.H&&qt(q,e.attributes.color,1/256);else{Ie(q,255,255,255,255);var W=new h.B(q.buffer,0,4);e.attributes.color instanceof h.u?y(W,e.attributes.color,255):e.attributes.color instanceof h.B?Re(W,e.attributes.color):e.attributes.color instanceof h.z&&y(W,e.attributes.color,1/256)}z.push(["color",{data:q.typedBuffer,size:q.elementCount,exclusive:!0}]),V.push(["color",E])}var X=new w.a(z,V);f.stageResources.geometries.push(X),f.stageResources.materials.push(l.get(r)),d&&(Object(c.k)(s.textureColor)&&f.stageResources.textures.push(u.get(s.textureColor)),Object(c.k)(s.textureNormal)&&f.stageResources.textures.push(u.get(s.textureNormal)),Object(c.k)(s.textureOcclusion)&&f.stageResources.textures.push(u.get(s.textureOcclusion)),Object(c.k)(s.textureEmissive)&&f.stageResources.textures.push(u.get(s.textureEmissive)),Object(c.k)(s.textureMetallicRoughness)&&f.stageResources.textures.push(u.get(s.textureMetallicRoughness))),f.numberOfVertices+=N;var J=X.boundingInfo;Object(c.k)(J)&&(Object(j.j)(f.boundingBox,J.getBBMin()),Object(j.j)(f.boundingBox,J.getBBMax()))}))}})),s}function Kt(e){switch(e){case"BLEND":return 0;case"MASK":return 2;case"OPAQUE":return 1;default:return 0}}function $t(e,t){for(var n=0;n<e.model.lods.length;++n){var r=e.model.lods[n];e.customMeta.esriTreeRendering=!0;var a,i=Object(o.a)(r.parts);try{for(i.s();!(a=i.n()).done;){var s=a.value,d=s.attributes.normal;if(Object(c.j)(d))return;for(var p=s.attributes.position,v=p.count,b=Object(l.e)(),g=Object(l.e)(),x=Object(l.e)(),O=Be(h.J,v),y=Be(h.u,v),j=Object(f.a)(Object(m.b)(),s.transform),w=0;w<v;w++){p.getVec(w,g),d.getVec(w,b),Object(u.l)(g,g,s.transform),Object(u.i)(x,g,t.center),Object(u.a)(x,x,t.radius);var T=x[2],C=Object(u.o)(x),S=Math.min(.45+.55*C*C,1);Object(u.a)(x,x,t.radius),Object(u.l)(x,x,j),Object(u.q)(x,x),n+1!==e.model.lods.length&&e.model.lods.length>1&&Object(u.h)(x,x,b,T>-1?.2:Math.min(-4*T-3.8,1)),y.setVec(w,x),O.set(w,0,255*S),O.set(w,1,255*S),O.set(w,2,255*S),O.set(w,3,255)}s.attributes.normal=y,s.attributes.color=O}}catch(M){i.e(M)}finally{i.f()}}}},915:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r,a,o=n(33),i=n(35),s=n(369);function c(e){e.fragment.include(s.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(Object(i.a)(r||(r=Object(o.a)(["\n    int chooseCascade(float _linearDepth, out mat4 mat) {\n      vec4 distance = uShadowMapDistance;\n      float depth = _linearDepth;\n\n      //choose correct cascade\n      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n      mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];\n\n      return i;\n    }\n\n    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {\n      vec4 lv = mat * vec4(_vpos, 1.0);\n      lv.xy /= lv.w;\n      return 0.5 * lv.xyz + vec3(0.5);\n    }\n\n    vec2 cascadeCoordinates(int i, vec3 lvpos) {\n      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n    }\n\n    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {\n      return rgba2float(texture2D(_depthTex, uv));\n    }\n\n    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {\n      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;\n    }\n\n    float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {\n      float texSize = 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);\n      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);\n      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);\n      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      mat4 mat;\n      int i = chooseCascade(_linearDepth, mat);\n\n      if (i >= uShadowMapNum) { return 0.0; }\n\n      vec3 lvpos = lightSpacePosition(_vpos, mat);\n\n      // vertex completely outside? -> no shadow\n      if (lvpos.z >= 1.0) { return 0.0; }\n      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv = cascadeCoordinates(i, lvpos);\n\n      return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);\n    }\n  "]))))}(a=c||(c={})).bindUniforms=function(e,t,n){t.shadowMappingEnabled&&(t.shadowMap.bind(e,n),t.shadowMap.bindView(e,t.origin))},a.bindViewCustomOrigin=function(e,t,n){t.shadowMappingEnabled&&t.shadowMap.bindView(e,n)},a.bindView=function(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},939:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r,a,o,i=n(33),s=n(35);function c(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(Object(s.a)(r||(r=Object(i.a)(["\n      void forwardLinearDepth() { linearDepth = gl_Position.w; }\n    "]))))):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(Object(s.a)(a||(a=Object(i.a)(["\n      void forwardLinearDepth() {\n        linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n      }\n    "]))))):e.vertex.code.add(Object(s.a)(o||(o=Object(i.a)(["\n      void forwardLinearDepth() {}\n    "]))))}},943:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r,a,o,i,s,c,l,u,d,f,p,m,v,h,b=n(33),g=n(35),x=n(558);function O(e){var t=e.fragment.code;t.add(Object(g.a)(r||(r=Object(b.a)(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "])))),t.add(Object(g.a)(a||(a=Object(b.a)(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "])))),t.add(Object(g.a)(o||(o=Object(b.a)(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 = 1.0 - RdotNG * RdotNG;\n      float intRadTheta = integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky = 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))}function y(e,t){var n=e.fragment.code;e.include(x.a),3===t.pbrMode||4===t.pbrMode?(n.add(Object(g.a)(i||(i=Object(b.a)(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent = ",";\n    "])),t.useCustomDTRExponentForWater?"2.2":"2.0")),n.add(Object(g.a)(s||(s=Object(b.a)(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),n.add(Object(g.a)(c||(c=Object(b.a)(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 = roughness * roughness;\n      float NdotH2 = NdotH * NdotH;\n      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),n.add(Object(g.a)(l||(l=Object(b.a)(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),n.add(Object(g.a)(u||(u=Object(b.a)(["\n    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);\n      float dSun = normalDistributionWater(props.NdotH, roughness);\n      float V = geometricOcclusionKelemen(props.LdotH);\n\n      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);\n      float strengthSunHaze  = 1.2;\n      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;\n\n      return ((dSun + dSunHaze) * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):1!==t.pbrMode&&2!==t.pbrMode||(e.include(O),n.add(Object(g.a)(d||(d=Object(b.a)(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),n.add(Object(g.a)(f||(f=Object(b.a)(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a = NdotH * roughness;\n        float b = roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),n.add(Object(g.a)(p||(p=Object(b.a)(["\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 = vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r = roughness * c0 + c1;\n        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),n.add(Object(g.a)(m||(m=Object(b.a)(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent = specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),n.add(Object(g.a)(v||(v=Object(b.a)(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),n.add(Object(g.a)(h||(h=Object(b.a)(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x = gamutMapChanel(inColor.x, p) ;\n      outColor.y = gamutMapChanel(inColor.y, p) ;\n      outColor.z = gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "])))))}},947:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r,a,o,i=n(33),s=n(35);function c(e,t){1===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(Object(s.a)(r||(r=Object(i.a)(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n      }\n    "]))))),2===t.attributeTextureCoordinates&&(e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(Object(s.a)(a||(a=Object(i.a)(["\n      void forwardTextureCoordinates() {\n        vuv0 = uv0;\n        vuvRegion = uvRegion;\n      }\n    "]))))),0===t.attributeTextureCoordinates&&e.vertex.code.add(Object(s.a)(o||(o=Object(i.a)(["\n      void forwardTextureCoordinates() {}\n    "]))))}},950:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r,a,o,i,s=n(33),c=n(35);function l(e){var t=Object(c.a)(r||(r=Object(s.a)(["\n    vec3 decodeNormal(vec2 f) {\n      float z = 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));e.fragment.code.add(t),e.vertex.code.add(t)}function u(e,t){0===t.normalType&&(e.attributes.add("normal","vec3"),e.vertex.code.add(Object(c.a)(a||(a=Object(s.a)(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "]))))),1===t.normalType&&(e.include(l),e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(Object(c.a)(o||(o=Object(s.a)(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "]))))),3===t.normalType&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(Object(c.a)(i||(i=Object(s.a)(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))}},960:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return T})),n.d(t,"c",(function(){return w})),n.d(t,"d",(function(){return y})),n.d(t,"e",(function(){return R})),n.d(t,"f",(function(){return k}));var r=n(3),a=n(2),o=n(6),i=n(26),s=n(13),c=n(82),l=n(278),u=n(110),d=n(307),f=n(92),p=n(145),m=n(83),v=n(514),h=n(76),b=n(310),g=(n(585),n(55)),x=n(444);var O=function e(){Object(a.a)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2},y=function(){function e(){Object(a.a)(this,e),this._transform=Object(u.b)(),this._transformInverse=new j({value:this._transform},c.a,u.b),this._transformInverseTranspose=new j(this._transformInverse,c.b,u.b),this._transformTranspose=new j({value:this._transform},c.b,u.b),this._transformInverseRotation=new j({value:this._transform},p.b,l.a)}return Object(r.a)(e,[{key:"invalidateLazyTransforms",value:function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}},{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}},{key:"setTransformMatrix",value:function(e){Object(c.c)(this._transform,e)}},{key:"multiplyTransform",value:function(e){Object(c.l)(this._transform,this._transform,e)}},{key:"set",value:function(e){Object(c.c)(this._transform,e),this.invalidateLazyTransforms()}},{key:"setAndInvalidateLazyTransforms",value:function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}]),e}(),j=function(){function e(t,n,r){Object(a.a)(this,e),this.original=t,this.update=n,this.dirty=!0,this.transform=r()}return Object(r.a)(e,[{key:"invalidate",value:function(){this.dirty=!0}},{key:"value",get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}]),e}(),w=function(){function e(){Object(a.a)(this,e),this.min=new T,this.max=new T,this.hud=new T,this.ground=new T}return Object(r.a)(e,[{key:"init",value:function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}]),e}(),T=function(){function e(t){Object(a.a)(this,e),this.normal=Object(i.e)(),this.transformation=Object(u.b)(),this._ray=g.f.create(),this.init(t)}return Object(r.a)(e,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return Object(s.d)(P,this.ray.direction,this.dist),Object(s.o)(P)}},{key:"getIntersectionPoint",value:function(e){return!!this.hasIntersectionPoint&&(Object(s.d)(P,this.ray.direction,this.dist),Object(s.e)(e,this.ray.origin,P),!0)}},{key:"getTransformedNormal",value:function(e){return Object(s.j)(I,this.normal),I[3]=0,Object(m.m)(I,I,this.transformation),Object(s.j)(e,I),Object(s.q)(e,e),e}},{key:"init",value:function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?g.f.copy(e,this._ray):this._ray=g.f.create()}},{key:"set",value:function(e,t,n,r,a,o,l,u,d,f){e instanceof x.a&&(e={type:"stage",obj:e}),this.dist=n,Object(s.j)(this.normal,r),Object(c.c)(this.transformation,a),this.target=e,this.name=t,this.drapedLayerOrder=o,this.center=l?Object(i.d)(l):null,this.geometryId=u,this.triangleNr=d,this.drapedLayerGraphicOrder=f}},{key:"copyFrom",value:function(e){g.f.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(i.d)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s.j)(this.normal,e.normal),Object(c.c)(this.transformation,e.transformation)}},{key:"toOwner",value:function(e){if(!this.target)return null;switch(this.target.type){case"stage":return C(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var n=e.metadata.layerUid;return null!=n?t.map.findLayerByUid(n):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return C(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null}},{key:"toGraphic",value:function(e){if(!this.target)return null;switch(this.target.type){case"stage":return S(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e){return e.metadata.createGraphic()}(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return S(this.target.metadata,e)}}return null}}]),e}();function C(e,t){return Object(o.j)(e)||null==e.layerUid?null:Object(o.k)(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function S(e,t){if(Object(o.j)(e))return null;var n=C(e,t);if(Object(o.j)(n))return null;if(n===t.graphics)return Object(o.k)(t.graphicsView)?Object(o.q)(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var r,a,i=t.allLayerViews.find((function(e){return e.layer===n}));return i?(a=e,!(r=i)||r.suspended?null:"getGraphicFromIntersectorMetadata"in r&&a?r.getGraphicFromIntersectorMetadata(a):"getGraphicFromGraphicUid"in r&&null!=a.graphicUid?r.getGraphicFromGraphicUid(a.graphicUid):null):null}var M=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(a.a)(this,e),this.offset=t,this.tmpVertex=Object(i.e)()}return Object(r.a)(e,[{key:"applyToVertex",value:function(e,t,n){var r=e+this.localOrigin[0],a=t+this.localOrigin[1],o=n+this.localOrigin[2],i=this.offset/Math.sqrt(r*r+a*a+o*o);return this.tmpVertex[0]=e+r*i,this.tmpVertex[1]=t+a*i,this.tmpVertex[2]=n+o*i,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0]+this.localOrigin[0],n=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],a=e[3]+this.localOrigin[0],o=e[4]+this.localOrigin[1],i=e[5]+this.localOrigin[2],s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var c=this.offset/Math.sqrt(a*a+o*o+i*i);return e[3]+=a*c,e[4]+=o*c,e[5]+=i*c,e}}]),e}(),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(a.a)(this,e),this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(i.e)(),this.mbs=Object(f.c)(),this.obb={center:Object(i.e)(),halfSize:Object(h.b)(),quaternion:null}}return Object(r.a)(e,[{key:"localOrigin",set:function(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}},{key:"applyToVertex",value:function(e,t,n){var r=e,a=t,o=n+this.componentLocalOriginLength,i=this.offset/Math.sqrt(r*r+a*a+o*o);return this.tmpVertex[0]=e+r*i,this.tmpVertex[1]=t+a*i,this.tmpVertex[2]=n+o*i,this.tmpVertex}},{key:"applyToAabb",value:function(e){var t=e[0],n=e[1],r=e[2]+this.componentLocalOriginLength,a=e[3],o=e[4],i=e[5]+this.componentLocalOriginLength,s=this.offset/Math.sqrt(t*t+n*n+r*r);e[0]+=t*s,e[1]+=n*s,e[2]+=r*s;var c=this.offset/Math.sqrt(a*a+o*o+i*i);return e[3]+=a*c,e[4]+=o*c,e[5]+=i*c,e}},{key:"applyToMbs",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.mbs[0]=e[0]+e[0]*n,this.mbs[1]=e[1]+e[1]*n,this.mbs[2]=e[2]+e[2]*n,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}},{key:"applyToObb",value:function(e){var t=e.center,n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*n,this.obb.center[1]=t[1]+t[1]*n,this.obb.center[2]=t[2]+t[2]*n,Object(s.t)(this.obb.halfSize,e.halfSize,e.quaternion),Object(s.e)(this.obb.halfSize,this.obb.halfSize,e.center);var r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(s.i)(this.obb.halfSize,this.obb.halfSize,e.center),Object(v.a)(L,e.quaternion),Object(s.t)(this.obb.halfSize,this.obb.halfSize,L),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}}]),e}(),A=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(a.a)(this,e),this.offset=t,this.sphere=Object(b.b)(),this.tmpVertex=Object(i.e)()}return Object(r.a)(e,[{key:"applyToVertex",value:function(e,t,n){var r=this.objectTransform.transform,a=r[0]*e+r[4]*t+r[8]*n+r[12],o=r[1]*e+r[5]*t+r[9]*n+r[13],i=r[2]*e+r[6]*t+r[10]*n+r[14],s=this.offset/Math.sqrt(a*a+o*o+i*i);a+=a*s,o+=o*s,i+=i*s;var c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*a+c[4]*o+c[8]*i+c[12],this.tmpVertex[1]=c[1]*a+c[5]*o+c[9]*i+c[13],this.tmpVertex[2]=c[2]*a+c[6]*o+c[10]*i+c[14],this.tmpVertex}},{key:"applyToMinMax",value:function(e,t){var n=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*n,e[1]+=e[1]*n,e[2]+=e[2]*n;var r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}},{key:"applyToAabb",value:function(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var n=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*n,e[4]+=e[4]*n,e[5]+=e[5]*n,e}},{key:"applyToBoundingSphere",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),n=this.offset/t;return this.sphere[0]=e[0]+e[0]*n,this.sphere[1]=e[1]+e[1]*n,this.sphere[2]=e[2]+e[2]*n,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}]),e}());function k(e){return Object(o.k)(e)?(A.offset=e,A):null}new _;new M;var R="terrain",P=(Object(i.e)(),Object(i.e)()),I=Object(f.c)(),L=Object(d.a)()},966:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r,a,o,i,s,c,l,u,d=n(2),f=n(33),p=n(26),m=n(35),v=n(587),h=n(1015);function b(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3")),t.instancedDoublePrecision&&(e.vertex.include(h.a,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var n=[Object(m.a)(r||(r=Object(f.a)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),Object(m.a)(a||(a=Object(f.a)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?Object(m.a)(o||(o=Object(f.a)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),Object(m.a)(i||(i=Object(f.a)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),Object(m.a)(s||(s=Object(f.a)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangets?Object(m.a)(c||(c=Object(f.a)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):Object(m.a)(l||(l=Object(f.a)([""])))];e.vertex.code.add(n[0]),e.vertex.code.add(n[1]),e.vertex.code.add(n[2]),2===t.output&&e.vertex.code.add(n[3]),e.vertex.code.add(n[4])}(u=b||(b={})).Uniforms=function e(){Object(d.a)(this,e)},u.bindCustomOrigin=function(e,t){Object(v.b)(t,g,x,3),e.setUniform3fv("viewOriginHi",g),e.setUniform3fv("viewOriginLo",x)};var g=Object(p.e)(),x=Object(p.e)()},967:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r,a,o,i,s,c,l,u,d=n(33),f=n(35),p=n(76),m=n(1124);Object(p.c)(0,.6,.2);function v(e,t){var n=e.fragment,p=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;1===t.pbrMode&&p&&e.include(m.a,t),2!==t.pbrMode?(0===t.pbrMode&&n.code.add(Object(f.a)(r||(r=Object(d.a)(["\n      float getBakedOcclusion() { return 1.0; }\n  "])))),1===t.pbrMode&&(n.uniforms.add("emissionFactor","vec3"),n.uniforms.add("mrrFactors","vec3"),n.code.add(Object(f.a)(a||(a=Object(d.a)(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "])))),t.hasMetalnessAndRoughnessTexture&&(n.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texMetallicRoughnessSize","vec2"),n.code.add(Object(f.a)(o||(o=Object(d.a)(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *= metallicRoughness.b;\n        mrr[1] *= metallicRoughness.g;\n      }"]))))),t.hasEmissionTexture&&(n.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texEmissionSize","vec2"),n.code.add(Object(f.a)(i||(i=Object(d.a)(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *= textureLookup(texEmission, params).rgb;\n      }"]))))),t.hasOcclusionTexture?(n.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&n.uniforms.add("texOcclusionSize","vec2"),n.code.add(Object(f.a)(s||(s=Object(d.a)(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *= textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]))))):n.code.add(Object(f.a)(c||(c=Object(d.a)(["\n      float getBakedOcclusion() { return 1.0; }\n      "])))),n.code.add(Object(f.a)(l||(l=Object(d.a)(["\n    void applyPBRFactors() {\n      mrr = mrrFactors;\n      emission = emissionFactor;\n      occlusion = 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),p?"vtc.uv = vuv0;":"",t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":"")))):n.code.add(Object(f.a)(u||(u=Object(d.a)(["\n      const vec3 mrr = vec3(0.0, 0.6, 0.2);\n      const vec3 emission = vec3(0.0);\n      float occlusion = 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "]))))}(v||(v={})).bindUniforms=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}},968:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r,a=n(33),o=n(35);function i(e){e.attributes.add("position","vec3"),e.vertex.code.add(Object(o.a)(r||(r=Object(a.a)(["\n    vec3 positionModel() { return position; }\n  "]))))}},969:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r,a,o=n(33),i=n(35);function s(e,t){var n=e.fragment;t.receiveAmbientOcclusion?(n.uniforms.add("ssaoTex","sampler2D"),n.uniforms.add("viewportPixelSz","vec4"),n.code.add(Object(i.a)(r||(r=Object(o.a)(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n      }\n    "]))))):n.code.add(Object(i.a)(a||(a=Object(o.a)(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))}},994:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r,a=n(33),o=n(35);function i(e){e.vertex.code.add(Object(o.a)(r||(r=Object(a.a)(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert = posWorld - camPosWorld;\n\n      bool isBackface = dot(camToVert, normalWorld) > 0.0;\n      if (isBackface) {\n        posClip.z += 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))}},995:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r,a,o,i,s,c,l,u,d,f,p,m,v=n(33),h=n(35),b=n(541),g=n(201),x=n(250),O=n(356),y=n(248),j=n(446),w=n(947),T=n(950),C=n(1088);function S(e,t){var n=e.vertex.code,S=e.fragment.code;1!==t.output&&3!==t.output||(e.include(b.a,{linearDepth:!0}),e.include(w.a,t),e.include(O.a,t),e.include(j.a,t),e.include(g.a,t),e.vertex.uniforms.add("cameraNearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(Object(h.a)(r||(r=Object(v.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, vpos, cameraNearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),e.include(y.a,t),S.add(Object(h.a)(a||(a=Object(v.a)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?Object(h.a)(o||(o=Object(v.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),2===t.output&&(e.include(b.a,{linearDepth:!1}),e.include(T.a,t),e.include(C.a,t),e.include(w.a,t),e.include(O.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),n.add(Object(h.a)(i||(i=Object(v.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===t.normalType?Object(h.a)(s||(s=Object(v.a)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"")),e.include(g.a,t),e.include(y.a,t),S.add(Object(h.a)(c||(c=Object(v.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?Object(h.a)(l||(l=Object(v.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===t.normalType?Object(h.a)(u||(u=Object(v.a)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):Object(h.a)(d||(d=Object(v.a)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),4===t.output&&(e.include(b.a,{linearDepth:!1}),e.include(w.a,t),e.include(O.a,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),n.add(Object(h.a)(f||(f=Object(v.a)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),e.include(g.a,t),e.include(y.a,t),e.include(x.a),S.add(Object(h.a)(p||(p=Object(v.a)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?Object(h.a)(m||(m=Object(v.a)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},996:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r,a=n(33),o=n(35),i=n(354);function s(e){e.include(i.a),e.code.add(Object(o.a)(r||(r=Object(a.a)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),o.a.int(1),o.a.int(2),o.a.int(3),o.a.int(2),o.a.int(3)))}}}]);
//# sourceMappingURL=50.6c442420.chunk.js.map