(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[128],{122:function(e,t,r){"use strict";r.d(t,"a",(function(){return C})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return n})),r.d(t,"j",(function(){return M})),r.d(t,"k",(function(){return c})),r.d(t,"l",(function(){return f})),r.d(t,"m",(function(){return s})),r.d(t,"n",(function(){return o})),r.d(t,"o",(function(){return h})),r.d(t,"p",(function(){return b})),r.d(t,"q",(function(){return O})),r.d(t,"r",(function(){return l})),r.d(t,"s",(function(){return m}));r(78),r(87);var i=r(99);function n(e=v){return[e[0],e[1],e[2],e[3]]}function a(e){return[e[0],e[1],e[2],e[3]]}function o(e,t,r,i,a=n()){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a}function s(e,t=n()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function l(e,t){return new i.a({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function c(e,t,r=e){if("length"in t)S(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}return r}function f(e,t,r=e){const i=t.length;let n=e[0],a=e[1],o=e[2],s=e[3];for(let l=0;l<i;l++){const e=t[l];n=Math.min(n,e[0]),a=Math.min(a,e[1]),o=Math.max(o,e[0]),s=Math.max(s,e[1])}return r[0]=n,r[1]=a,r[2]=o,r[3]=s,r}function m(e){return e[0]>=e[2]?0:e[2]-e[0]}function h(e){return e[1]>=e[3]?0:e[3]-e[1]}function u(e){return m(e)*h(e)}function y(e,t){return d(e,t[0],t[1])}function g(e,t){return d(e,t.x,t.y)}function d(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function p(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function b(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function x(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function O(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(e){return e?O(e,C):n(C)}function S(e){return 4===e.length}const C=[1/0,1/0,-1/0,-1/0],v=[0,0,0,0]},303:function(e,t,r){"use strict";r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return d})),r.d(t,"c",(function(){return s})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return M})),r.d(t,"f",(function(){return S})),r.d(t,"g",(function(){return C}));var i=r(96);const n=(e,t,r)=>[t,r],a=(e,t,r)=>[t,r,e[2]],o=(e,t,r)=>[t,r,e[2],e[3]];function s(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function c({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function f(e,t,r){const i=[];let n,a,o,s;for(let f=0;f<r.length;f++){const m=r[f];f>0?(o=l(e,m[0]),s=c(e,m[1]),o===n&&s===a||(i.push(t(m,o-n,s-a)),n=o,a=s)):(n=l(e,m[0]),a=c(e,m[1]),i.push(t(m,n,a)))}return i.length>0?i:null}function m({scale:e,translate:t},r){return r*e[0]+t[0]}function h({scale:e,translate:t},r){return t[1]-r*e[1]}function u(e,t,r){const i=new Array(r.length);if(!r.length)return i;const[n,a]=e.scale;let o=m(e,r[0][0]),s=h(e,r[0][1]);i[0]=t(r[0],o,s);for(let l=1;l<r.length;l++){const e=r[l];o+=e[0]*n,s-=e[1]*a,i[l]=t(e,o,s)}return i}function y(e,t,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=u(e,t,r[n]);return i}function g(e,t,r,i,s){return t.points=function(e,t,r,i){return f(e,r?i?o:a:i?a:n,t)}(e,r.points,i,s),t}function d(e,t,r,i,n){return t.x=l(e,r.x),t.y=c(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function p(e,t,r,i,s){const l=function(e,t,r,i){const s=[],l=r?i?o:a:i?a:n;for(let n=0;n<t.length;n++){const r=f(e,l,t[n]);r&&r.length>=3&&s.push(r)}return s.length?s:null}(e,r.rings,i,s);return l?(t.rings=l,t):null}function b(e,t,r,i,s){const l=function(e,t,r,i){const s=[],l=r?i?o:a:i?a:n;for(let n=0;n<t.length;n++){const r=f(e,l,t[n]);r&&r.length>=2&&s.push(r)}return s.length?s:null}(e,r.paths,i,s);return l?(t.paths=l,t):null}function x(e,t){return e&&t?Object(i.f)(t)?d(e,{},t,!1,!1):Object(i.h)(t)?b(e,{},t,!1,!1):Object(i.g)(t)?p(e,{},t,!1,!1):Object(i.e)(t)?g(e,{},t,!1,!1):Object(i.d)(t)?(o=!1,s=!1,(n={}).xmin=l(r=e,(a=t).xmin),n.ymin=c(r,a.ymin),n.xmax=l(r,a.xmax),n.ymax=c(r,a.ymax),n!==a&&(o&&(n.zmin=a.zmin,n.zmax=a.zmax),s&&(n.mmin=a.mmin,n.mmax=a.mmax)),n):null:null;var r,n,a,o,s}function O(e,t,r,i,s){return t.points=function(e,t,r,i){return u(e,r?i?o:a:i?a:n,t)}(e,r.points,i,s),t}function M(e,t,r,i,n){return t.x=m(e,r.x),t.y=h(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t}function S(e,t,r,i,s){return t.rings=function(e,t,r,i){return y(e,r?i?o:a:i?a:n,t)}(e,r.rings,i,s),t}function C(e,t,r,i,s){return t.paths=function(e,t,r,i){return y(e,r?i?o:a:i?a:n,t)}(e,r.paths,i,s),t}},416:function(e,t,r){"use strict";r.d(t,"a",(function(){return A})),r.d(t,"b",(function(){return x}));var i=r(137),n=r(79),a=r(147),o=r(105),s=r(102),l=r(319),c=r(417),f=r(352),m=r(490);const h=n.a.getLogger("esri.symbols.cim.cimAnalyzer");function u(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function y(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function g(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function d(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function p(e,t,r,i){let n;e[t]?n=e[t]:(n={},e[t]=n),n[r]=i}function b(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}async function x(e,t,r,i){const n=r||[];if(!e)return n;let o,s;const l={};if("CIMSymbolReference"!==e.type)return h.error("Expect cim type to be 'CIMSymbolReference'"),n;if(o=e.symbol,s=e.primitiveOverrides,s){const e=[];for(const r of s){const i=r.valueExpressionInfo;if(i&&t){const n=i.expression,o=Object(a.d)(n,t.spatialReference,t.fields).then((e=>{e&&p(l,r.primitiveName,r.propertyName,e)}));e.push(o)}else null!=r.value&&p(l,r.primitiveName,r.propertyName,r.value)}await Promise.all(e)}switch(o.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(e,t,r,i,n,a){if(!e)return;const o=e.symbolLayers;if(!o)return;let s;const l=f.a.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(s=1);let c=o.length;for(;c--;){const m=o[c];if(!m||!1===m.enable)continue;const u=[];switch(f.b.findApplicableOverrides(m,t,u),m.type){case"CIMSolidFill":O(m,r,u,i,n);break;case"CIMPictureFill":M(m,r,u,i,n);break;case"CIMHatchFill":S(m,r,u,i,n);break;case"CIMGradientFill":C(m,r,u,i,n);break;case"CIMSolidStroke":v(m,r,u,i,n,"CIMPolygonSymbol"===e.type,l);break;case"CIMPictureStroke":k(m,r,u,i,n,"CIMPolygonSymbol"===e.type,l);break;case"CIMGradientStroke":P(m,r,u,i,n,"CIMPolygonSymbol"===e.type,l);break;case"CIMCharacterMarker":if(w(m,r,u,i,n))break;break;case"CIMPictureMarker":if(w(m,r,u,i,n))break;"CIMLineSymbol"===e.type&&(s=b(m)),z(m,r,u,i,n,s,l);break;case"CIMVectorMarker":if(w(m,r,u,i,n))break;"CIMLineSymbol"===e.type&&(s=b(m)),I(m,r,u,i,n,s,l,a);break;default:h.error("Cannot analyze CIM layer",m.type)}}}(o,s,l,t,n,i)}return n}function O(e,t,r,n,a){const o=e.primitiveName,s=Object(l.e)(e.color),c=Object(i.b)(JSON.stringify(e)).toString();a.push({type:"fill",templateHash:c,materialHash:0===r.length?c:()=>c,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:H(o,t,"Color",n,s,_),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function M(e,t,r,n,a){const o=e.primitiveName,s=e.tintColor?Object(l.e)(e.tintColor):{r:255,g:255,b:255,a:1},c=Object(i.b)(JSON.stringify(e)).toString(),f=Object(i.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();a.push({type:"fill",templateHash:c,materialHash:0===r.length?f:()=>f,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:H(o,t,"TintColor",n,s,_),height:H(o,t,"Height",n,e.height),scaleX:H(o,t,"ScaleX",n,e.scaleX),angle:H(o,t,"Rotation",n,e.rotation),offsetX:H(o,t,"OffsetX",n,e.offsetX),offsetY:H(o,t,"OffsetY",n,e.offsetY)})}function S(e,t,r,n,a){const o=["Rotation","OffsetX","OffsetY"],s=r.filter((t=>t.primitiveName!==e.primitiveName&&-1===o.indexOf(t.propertyName))),l=e.primitiveName,c=Object(i.b)(JSON.stringify(e)).toString(),f=Object(i.b)(`${e.separation}${JSON.stringify(e.lineSymbol)}`).toString();a.push({type:"fill",templateHash:c,materialHash:0===r.length?f:X(f,t,s,n),cim:e,materialOverrides:s,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:H(l,t,"Separation",n,e.separation),scaleX:1,angle:H(l,t,"Rotation",n,e.rotation),offsetX:H(l,t,"OffsetX",n,e.offsetX),offsetY:H(l,t,"OffsetY",n,e.offsetY)})}function C(e,t,r,n,a){const o=Object(i.b)(JSON.stringify(e)).toString();a.push({type:"fill",templateHash:o,materialHash:0===r.length?o:X(o,t,r,n),cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function v(e,t,r,n,a,o,s){const c=Object(i.b)(JSON.stringify(e)).toString(),f=e.primitiveName,m=Object(l.e)(e.color),h=void 0!==e.width?e.width:4,g=u(e.capStyle),d=y(e.joinStyle),p=e.miterLimit;a.push({type:"line",templateHash:c,materialHash:0===r.length?c:()=>c,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:H(f,t,"Color",n,m,_),width:H(f,t,"Width",n,h),cap:H(f,t,"CapStyle",n,g),join:H(f,t,"JoinStyle",n,d),miterLimit:H(f,t,"MiterLimit",n,p),referenceWidth:s,zOrder:R(e.name),isDashed:!1})}function k(e,t,r,n,a,o,s){const c=Object(i.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString(),f=e.primitiveName,m=Object(l.e)(e.tintColor),h=void 0!==e.width?e.width:4,g=u(e.capStyle),d=y(e.joinStyle),p=e.miterLimit,b=Object(i.b)(JSON.stringify(e)).toString();a.push({type:"line",templateHash:b,materialHash:0===r.length?c:()=>c,cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:H(f,t,"TintColor",n,m,_),width:H(f,t,"Width",n,h),cap:H(f,t,"CapStyle",n,g),join:H(f,t,"JoinStyle",n,d),miterLimit:H(f,t,"MiterLimit",n,p),referenceWidth:s,zOrder:R(e.name),isDashed:!1})}function P(e,t,r,n,a,o,s){const l=e.primitiveName,c=void 0!==e.width?e.width:4,f=u(e.capStyle),m=y(e.joinStyle),h=e.miterLimit,g=Object(i.b)(JSON.stringify(e)).toString();a.push({type:"line",templateHash:g,materialHash:0===r.length?g:X(g,t,r,n),cim:e,materialOverrides:null,isOutline:o,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:H(l,t,"Width",n,c),cap:H(l,t,"CapStyle",n,f),join:H(l,t,"JoinStyle",n,m),miterLimit:H(l,t,"MiterLimit",n,h),referenceWidth:s,zOrder:R(e.name),isDashed:!1})}function w(e,t,r,n,a){const o=e.markerPlacement;if(!o||"CIMMarkerPlacementInsidePolygon"!==o.type)return!1;const s=o,l=["Rotation","OffsetX","OffsetY"],c=r.filter((t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName))),f=Object(i.b)(JSON.stringify(e)).toString();return a.push({type:"fill",templateHash:f,materialHash:0===r.length?f:X(f,t,c,n),cim:e,materialOverrides:c,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:H(s.primitiveName,t,"StepY",n,s.stepY),scaleX:1,angle:H(s.primitiveName,t,"GridAngle",n,s.gridAngle),offsetX:H(s.primitiveName,t,"OffsetX",n,s.offsetX),offsetY:H(s.primitiveName,t,"OffsetY",n,s.offsetY)}),!0}function z(e,t,r,n,a,o,s){const c=e.primitiveName,f=e.size,m=e.scaleX,h=e.rotation,u=e.offsetX,y=e.offsetY,g=Object(l.e)(e.tintColor),d=Object(i.b)(`${e.url}${JSON.stringify(e.colorSubstitutions)}`).toString();let p=!1,b="";for(const i of r)i.primitiveName===c&&(void 0!==i.value?b+=`-${i.primitiveName}-${i.propertyName}-${JSON.stringify(i.value)}`:i.valueExpressionInfo&&(p=!0));a.push({type:"marker",templateHash:Object(i.b)(JSON.stringify(e)+b).toString(),materialHash:p?()=>d:d,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:o,size:H(c,t,"Size",n,f),scaleX:H(c,t,"ScaleX",n,m),rotation:H(c,t,"Rotation",n,h),offsetX:H(c,t,"OffsetX",n,u),offsetY:H(c,t,"OffsetY",n,y),color:H(c,t,"TintColor",n,g,_),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:e.markerPlacement})}function I(e,t,r,i,n,a,o,s){const l=e.markerGraphics;if(!l)return;let c=0;if(e.scaleSymbolsProportionally){const t=e.frame;t&&(c=t.ymax-t.ymin)}for(const f of l)if(f){const l=f.symbol;if(!l)continue;switch(l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":N(e,f,r,t,i,n,a,o,c,s);break;case"CIMTextSymbol":j(e,f,t,r,i,n,a,o,c)}}}function j(e,t,r,n,a,o,s,c,m){f.b.findApplicableOverrides(t,n,[]);const h=t.geometry;if(!("x"in h)||!("y"in h))return;const u=t.symbol,y=(b=u).underline?"underline":b.strikethrough?"line-through":"none",p=function(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();-1!==i.indexOf("italic")?t="italic":-1!==i.indexOf("oblique")&&(t="oblique"),-1!==i.indexOf("bold")?r="bold":-1!==i.indexOf("light")&&(r="lighter")}return{style:t,weight:r}}(u.fontStyleName);var b;u.font={family:u.fontFamilyName,decoration:y,...p};const x=e.frame,O=h.x-.5*(x.xmin+x.xmax),M=h.y-.5*(x.ymin+x.ymax),S=e.size/m,C=e.primitiveName,v=(u.height||0)*S,k=u.angle||0,P=((u.offsetX||0)+O)*S,w=((u.offsetY||0)+M)*S,z=Object(l.e)(f.a.getFillColor(u));let I=Object(l.e)(f.a.getStrokeColor(u)),j=f.a.getStrokeWidth(u);j||(I=Object(l.e)(f.a.getFillColor(u.haloSymbol)),j=u.haloSize*S);let N="";for(const i of n)i.primitiveName===C&&void 0!==i.value&&(N+=`-${i.primitiveName}-${i.propertyName}-${JSON.stringify(i.value)}`);const L=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),R=Object(i.b)(JSON.stringify(t)+L+N).toString();o.push({type:"text",templateHash:R,materialHash:()=>Object(i.b)(JSON.stringify(u.font)).toString(),cim:u,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:s,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:u.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:H(C,r,"Size",a,v),angle:H(C,r,"Rotation",a,k),offsetX:H(C,r,"OffsetX",a,P),offsetY:H(C,r,"OffsetY",a,w),horizontalAlignment:g(u.horizontalAlignment),verticalAlignment:d(u.verticalAlignment),text:H(t.primitiveName,r,"TextString",a,t.textString,l.a,u.textCase),color:z,outlineColor:I,outlineSize:j,referenceSize:c,sizeRatio:1,markerPlacement:e.markerPlacement})}function N(e,t,r,n,a,o,s,c,h,u){const y=t.symbol,g=t.geometry;if(!g)return;const d=y.symbolLayers;if(!d)return;if(u)return void L(e,t,n,r,a,o,s,c,h);let p=d.length;for(;p--;){const u=d[p];if(u&&!1!==u.enable)switch(u.type){case"CIMSolidFill":case"CIMSolidStroke":{const y=Object(m.b)(g);if(!y)continue;const[d,p,b]=Object(m.d)(y,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),x="CIMSolidFill"===u.type,O={type:"sdf",geom:g,asFill:x},M=e.primitiveName,S=e.size,C=e.rotation||0,v=e.offsetX,k=e.offsetY,P=u.primitiveName,w=Object(l.e)(x?f.a.getFillColor(u):f.a.getStrokeColor(u)),z=x?{r:0,g:0,b:0,a:0}:Object(l.e)(f.a.getStrokeColor(u)),I=f.a.getStrokeWidth(u);if(!x&&!I)break;let j=!1,N="";for(const e of r)e.primitiveName!==P&&e.primitiveName!==M||(void 0!==e.value?N+=`-${e.primitiveName}-${e.propertyName}-${JSON.stringify(e.value)}`:e.valueExpressionInfo&&(j=!0));const L=JSON.stringify({...e,markerGraphics:null}),R=Object(i.b)(JSON.stringify(O)).toString(),X={type:"marker",templateHash:Object(i.b)(JSON.stringify(t)+JSON.stringify(u)+L+N).toString(),materialHash:j?()=>R:R,cim:O,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:p,y:b},isAbsoluteAnchorPoint:!1,size:H(e.primitiveName,n,"Size",a,S),rotation:H(e.primitiveName,n,"Rotation",a,C),offsetX:H(e.primitiveName,n,"OffsetX",a,v),offsetY:H(e.primitiveName,n,"OffsetY",a,k),scaleX:1,frameHeight:h,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:d,color:H(P,n,"Color",a,w,_),outlineColor:H(P,n,"Color",a,z,_),outlineWidth:H(P,n,"Width",a,I),markerPlacement:e.markerPlacement};o.push(X);break}default:L(e,t,n,r,a,o,s,c,h)}}}function L(e,t,r,n,a,o,l,c,m){const h=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,t);let u=[];const y=["Rotation","OffsetX","OffsetY"];u=n.filter((t=>t.primitiveName!==e.primitiveName||-1===y.indexOf(t.propertyName)));let g="";for(const i of n)void 0!==i.value&&(g+=`-${i.primitiveName}-${i.propertyName}-${JSON.stringify(i.value)}`);const[d,p,b]=f.a.getTextureAnchor(h),x=e.primitiveName,O=e.rotation||0,M=e.offsetX||0,S=e.offsetY||0,C=Object(i.b)(JSON.stringify(h)+g).toString(),v={type:"marker",templateHash:C,materialHash:0===u.length?C:X(C,r,u,a),cim:h,materialOverrides:u,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:d,y:p},isAbsoluteAnchorPoint:!1,size:e.size,rotation:H(x,r,"Rotation",a,O),offsetX:H(x,r,"OffsetX",a,M),offsetY:H(x,r,"OffsetY",a,S),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:e.rotateClockwise,referenceSize:c,sizeRatio:b/Object(s.h)(e.size),markerPlacement:e.markerPlacement};o.push(v)}function R(e){if(e&&0===e.indexOf("Level_")){const t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function _(e){if(!e||0===e.length)return null;const t=new o.a(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function H(e,t,r,i,n,o,s){const l=t[e];if(l){const e=l[r];if("string"==typeof e||"number"==typeof e||e instanceof Array)return o?o.call(null,e,s):e;if(null!=e&&e instanceof a.a)return(t,r,a)=>{let l=Object(c.a)(e,t,{$view:a},i.geometryType,r);return null!==l&&o&&(l=o.call(null,l,s)),null!==l?l:n}}return n}function X(e,t,r,n){for(const i of r)if(i.valueExpressionInfo){const e=t[i.primitiveName]&&t[i.primitiveName][i.propertyName];e instanceof a.a&&(i.fn=(t,r,i)=>Object(c.a)(e,t,{$view:i},n.geometryType,r))}return(t,n,a)=>{for(const e of r)e.fn&&(e.value=e.fn(t,n,a));return Object(i.b)(e+f.b.buildOverrideKey(r)).toString()}}function A(e,t){if(!t||0===t.length)return e;const r=JSON.parse(JSON.stringify(e));return f.b.applyOverrides(r,t),r}},417:function(e,t,r){"use strict";var i=r(79),n=r(89),a=r(303);const o=new Map;function s(e,t,r){const{transform:s,hasZ:l,hasM:c}=r;o.has(t)||o.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>Object(a.e)(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>Object(a.f)(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>Object(a.g)(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>Object(a.d)(r,t,e,i,n);default:return i.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new n.a("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const f=o.get(t)(e.geometry,s,l,c);return{...e,geometry:f}}t.a=function(e,t,r,n,a){const o=e.referencesGeometry()&&a?s(t,n,a):t,l=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:l})}catch(c){return i.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}},490:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return c}));var i=r(96),n=r(350),a=r(425);function o(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":{const t=e.symbolLayers;return t&&1===t.length?o(t[0]):null}case"CIMVectorMarker":{const t=e.markerGraphics;if(!t||1!==t.length)return null;const r=t[0];if(!r)return null;const i=r.geometry;if(!i)return null;const n=r.symbol;return!n||"CIMPolygonSymbol"!==n.type&&"CIMLineSymbol"!==n.type?null:{geom:i,asFill:"CIMPolygonSymbol"===n.type}}case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function s(e){let t=1/0,r=-1/0,i=1/0,n=-1/0;for(const a of e)for(const e of a)e[0]<t&&(t=e[0]),e[0]>r&&(r=e[0]),e[1]<i&&(i=e[1]),e[1]>n&&(n=e[1]);return[t,i,r,n]}function l(e){return e?e.rings?s(e.rings):e.paths?s(e.paths):Object(i.d)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function c(e,t,r,i,n){const[a,o,s,l]=e;if(s<a||l<o)return[0,0,0];const c=s-a,f=l-o,m=Math.floor(31.5),h=(128-2*(m+1))/Math.max(c,f),u=Math.round(c*h)+2*m,y=Math.round(f*h)+2*m;let g=1;t&&(g=y/h/(t.ymax-t.ymin));let d=0,p=0;if(i)if(n){if(t&&r&&t.ymax-t.ymin>0){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin);d=i.x/(r*e),p=i.y/r}}else d=i.x,p=i.y;return d=.5*(t.xmax+t.xmin)+d*(t.xmax-t.xmin),p=.5*(t.ymax+t.ymin)+p*(t.ymax-t.ymin),d-=a,p-=o,d*=h,p*=h,d+=m,p+=m,[g,d/u-.5,-(p/y-.5)]}function f(e){const t=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),r=function(e){let t=1/0,r=-1/0,i=1/0,a=-1/0;for(const n of e)for(const e of n)e[0]<t&&(t=e[0]),e[0]>r&&(r=e[0]),e[1]<i&&(i=e[1]),e[1]>a&&(a=e[1]);return new n.a(t,i,r-t,a-i)}(t),i=Math.floor(31.5),a=(128-2*(i+1))/Math.max(r.width,r.height),o=Math.round(r.width*a)+2*i,s=Math.round(r.height*a)+2*i,l=[];for(const n of t)if(n&&n.length>1){const t=[];for(const e of n){let[n,o]=e;n-=r.x,o-=r.y,n*=a,o*=a,n+=i-.5,o+=i-.5,t.push([n,o])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}l.push(t)}const c=function(e,t,r,i){const n=t*r,a=new Array(n),o=i*i+1;for(let s=0;s<n;++s)a[s]=o;for(const s of e){const e=s.length;for(let n=1;n<e;++n){const e=s[n-1],o=s[n];let l,c,f,m;e[0]<o[0]?(l=e[0],c=o[0]):(l=o[0],c=e[0]),e[1]<o[1]?(f=e[1],m=o[1]):(f=o[1],m=e[1]);let h=Math.floor(l)-i,u=Math.floor(c)+i,y=Math.floor(f)-i,g=Math.floor(m)+i;h<0&&(h=0),u>t&&(u=t),y<0&&(y=0),g>r&&(g=r);const d=o[0]-e[0],p=o[1]-e[1],b=d*d+p*p;for(let i=h;i<u;i++)for(let n=y;n<g;n++){let s,l,c=(i-e[0])*d+(n-e[1])*p;c<0?(s=e[0],l=e[1]):c>b?(s=o[0],l=o[1]):(c/=b,s=e[0]+c*d,l=e[1]+c*p);const f=(i-s)*(i-s)+(n-l)*(n-l),m=(r-n-1)*t+i;f<a[m]&&(a[m]=f)}}}for(let s=0;s<n;++s)a[s]=Math.sqrt(a[s]);return a}(l,o,s,i);return e.asFill&&function(e,t,r,i,n){for(const a of e){const e=a.length;for(let o=1;o<e;++o){const e=a[o-1],s=a[o];let l,c,f,m;e[0]<s[0]?(l=e[0],c=s[0]):(l=s[0],c=e[0]),e[1]<s[1]?(f=e[1],m=s[1]):(f=s[1],m=e[1]);let h=Math.floor(l),u=Math.floor(c)+1,y=Math.floor(f),g=Math.floor(m)+1;h<i&&(h=i),u>t-i&&(u=t-i),y<i&&(y=i),g>r-i&&(g=r-i);for(let a=y;a<g;++a){if(e[1]>a==s[1]>a)continue;const o=(r-a-1)*t;for(let t=h;t<u;++t)t<(s[0]-e[0])*(a-e[1])/(s[1]-e[1])+e[0]&&(n[o+t]=-n[o+t]);for(let e=i;e<h;++e)n[o+e]=-n[o+e]}}}}(l,o,s,i,c),[m(c,i),o,s]}function m(e,t){const r=2*t,i=e.length,n=new Uint8Array(4*i);for(let o=0;o<i;++o){const t=.5-e[o]/r;Object(a.a)(t,n,4*o)}return n}},704:function(e,t,r){"use strict";r.r(t),r.d(t,"previewCIMSymbol",(function(){return M}));var i=r(102),n=r(421),a=r(137),o=r(91),s=r(96),l=r(1069),c=r(100),f=r(319),m=r(416),h=r(950);class u{constructor(){}rasterizeText(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d");this.setFontProperties(i,t),this.parameters=t,this.textLines=e.split(/\r?\n/),this.lineHeight=this.computeLineHeight();const n=this.computeTextWidth(i,t),a=this.lineHeight*this.textLines.length;r.width=n,r.height=a,this.renderedLineHeight=Math.round(this.lineHeight*t.pixelRatio),this.renderedHaloSize=t.halo.size*t.pixelRatio,this.renderedWidth=n*t.pixelRatio,this.renderedHeight=a*t.pixelRatio,this.fillStyle=function(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}(t.color),this.haloStyle=function(e){return`rgb(${e.slice(0,3).toString()})`}(t.halo.color);const o=this.renderedLineHeight,s=this.renderedHaloSize;this.setFontProperties(i,t);const l=function(e,t){return"center"===e?.5*t:"right"===e?t:0}(i.textAlign,this.renderedWidth)+s,c=s;let f=0,m=0;s>0&&this.renderHalo(i,l,c,f,m,t),m+=c,f+=l;for(const y of this.textLines)i.globalCompositeOperation="destination-out",i.fillStyle="rgb(0, 0, 0)",i.fillText(y,f,m),i.globalCompositeOperation="source-over",i.fillStyle=this.fillStyle,i.fillText(y,f,m),m+=o;const h=i.getImageData(0,0,this.renderedWidth,this.renderedHeight),u=new Uint8Array(h.data);if(t.premultiplyColors){let e;for(let t=0;t<u.length;t+=4)e=u[t+3]/255,u[t]=u[t]*e,u[t+1]=u[t+1]*e,u[t+2]=u[t+2]*e}return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(u.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}renderHalo(e,t,r,i,n,a){const o=this.renderedWidth,s=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas")),this._haloRasterizationCanvas.width=o,this._haloRasterizationCanvas.height=s;const l=this._haloRasterizationCanvas,c=l.getContext("2d");c.clearRect(0,0,o,s),this.setFontProperties(c,a),c.fillStyle=this.haloStyle,c.strokeStyle=this.haloStyle;const f=this.renderedHaloSize<3;c.lineJoin=f?"miter":"round",f?this.renderHaloEmulated(c,t,r):this.renderHaloNative(c,t,r),e.globalAlpha=this.parameters.halo.color[3],e.drawImage(l,0,0,o,s,i,n,o,s),e.globalAlpha=1}renderHaloEmulated(e,t,r){const i=this.renderedLineHeight,n=this.renderedHaloSize;for(const a of this.textLines){for(const[i,o]of y)e.fillText(a,t+n*i,r+n*o);r+=i}}renderHaloNative(e,t,r){const i=this.renderedLineHeight,n=this.renderedHaloSize;for(const a of this.textLines){const o=2*n,s=5,l=.1;for(let i=0;i<s;i++){const n=1-(s-1)*l+i*l;e.lineWidth=n*o,e.strokeText(a,t,r)}r+=i}}setFontProperties(e,t){const r=t.font,n=`${r.style} ${r.weight} ${Object(i.h)(t.size*t.pixelRatio)}px ${r.family}, sans-serif`;let a;switch(e.font=n,e.textBaseline="top",t.horizontalAlignment){case"left":a="left";break;case"right":a="right";break;case"center":a="center";break;default:a="left"}e.textAlign=a}computeTextWidth(e,t){let r=0;for(const n of this.textLines)r=Math.max(r,e.measureText(n).width);const i=t.font;return("italic"===i.style||"oblique"===i.style||"string"==typeof i.weight&&("bold"===i.weight||"bolder"===i.weight)||"number"==typeof i.weight&&i.weight>600)&&(r+=.3*e.measureText("A").width),r+=2*this.parameters.halo.size,Math.round(r)}computeLineHeight(){const e=1.275*this.parameters.size;return Math.round(e+2*this.parameters.halo.size)}}const y=[];{const e=16;for(let t=0;t<360;t+=360/e)y.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}var g,d;(d=g||(g={})).Legend="legend",d.Preview="preview";const p=(e,t,r)=>{if(e&&e.targetSize){let n;if(r){const t=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);n=e.targetSize/Object(i.h)(t)}else n=e.targetSize/t.referenceSize;return n}return e&&e.scaleFactor?e.scaleFactor:1},b={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};function x(e,t,r,i){let n,a;return"function"==typeof e.materialHash?(n=(0,e.materialHash)(t,r,i),a=Object(m.a)(e.cim,e.materialOverrides)):(n=e.materialHash,a=e.cim),{analyzedCIM:a,hash:n}}const O=new class{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new h.a,this._textRasterizer=new u,this._pictureMarkerCache=new Map}async rasterizeCIMSymbolAsync(e,t,r,i,n,a,o,l){i=i||(t?null!=t.centroid?"esriGeometryPolygon":Object(s.c)(t.geometry):null)||function(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}(e);const c=await this.analyzeCIMSymbol(e,t?function(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"})))}(t.attributes):null,r,i,l);return this.rasterizeCIMSymbol(c,t,i,n,a,o)}async analyzeCIMSymbol(e,t,r,i,n){const a=[],s=t?{geometryType:i,spatialReference:this._spatialReference,fields:t}:null;let l;await Object(m.b)(e.data,s,a,this._avoidSDF),Object(o.u)(n);for(const o of a)"CIMPictureMarker"!==o.cim.type&&"CIMPictureFill"!==o.cim.type&&"CIMPictureStroke"!==o.cim.type||(l||(l=[]),l.push(this.fetchPictureMarkerResource(o,n))),r&&"text"===o.type&&"string"==typeof o.text&&o.text.indexOf("[")>-1&&(o.text=Object(f.c)(r,o.text,o.cim.textCase));return l&&await Promise.all(l),a}async fetchPictureMarkerResource(e,t){const r=e.materialHash;if(!this._pictureMarkerCache.get(r)){const i=(await Object(c.default)(e.cim.url,{responseType:"image",signal:t&&t.signal})).data;this._pictureMarkerCache.set(r,i)}}rasterizeCIMSymbol(e,t,r,i,n,a){const o=[];for(const s of e){i&&"function"==typeof i.scaleFactor&&(i.scaleFactor=i.scaleFactor(t,n,a));const e=this._getRasterizedResource(s,t,r,i,n,a);if(!e)continue;let l=0,c=e.anchorX||0,m=e.anchorY||0,h=!1,u=0,y=0;if("esriGeometryPoint"===r){const e=p(i,s,null);if(u=Object(f.d)(s.offsetX,t,n,a)*e||0,y=Object(f.d)(s.offsetY,t,n,a)*e||0,"marker"===s.type)l=Object(f.d)(s.rotation,t,n,a)||0,h=!!s.rotateClockwise&&s.rotateClockwise;else if("text"===s.type){if(l=Object(f.d)(s.angle,t,n,a)||0,void 0!==s.horizontalAlignment)switch(s.horizontalAlignment){case"left":c=-.5;break;case"right":c=.5;break;default:c=0}if(void 0!==s.verticalAlignment)switch(s.verticalAlignment){case"top":m=.5;break;case"bottom":m=-.5;break;case"baseline":m=-.25;break;default:m=0}}}null!=e&&o.push({angle:l,rotateClockWise:h,anchorX:c,anchorY:m,offsetX:u,offsetY:y,rasterizedResource:e})}return this.getSymbolImage(o)}getSymbolImage(e){const t=document.createElement("canvas"),r=t.getContext("2d");let n=0,a=0,o=0,s=0;const c=[];for(let l=0;l<e.length;l++){const t=e[l],f=t.rasterizedResource;if(!f)continue;const m=f.size,h=t.offsetX,u=t.offsetY,y=t.anchorX,g=t.anchorY,d=t.rotateClockWise||!1;let p=t.angle,b=Object(i.h)(h)-m[0]*(.5+y),x=Object(i.h)(u)-m[1]*(.5+g),O=b+m[0],M=x+m[1];if(p){d&&(p=-p);const e=Math.sin(p*Math.PI/180),t=Math.cos(p*Math.PI/180),r=b*t-x*e,i=b*e+x*t,n=b*t-M*e,a=b*e+M*t,o=O*t-M*e,s=O*e+M*t,l=O*t-x*e,c=O*e+x*t;b=Math.min(r,n,o,l),x=Math.min(i,a,s,c),O=Math.max(r,n,o,l),M=Math.max(i,a,s,c)}n=b<n?b:n,a=x<a?x:a,o=O>o?O:o,s=M>s?M:s;const S=r.createImageData(f.size[0],f.size[1]);S.data.set(new Uint8ClampedArray(f.image.buffer));const C={offsetX:h,offsetY:u,rotateClockwise:d,angle:p,rasterizedImage:S,anchorX:y,anchorY:g};c.push(C)}t.width=o-n,t.height=s-a;const f=-n,m=s;for(let l=0;l<c.length;l++){const e=c[l],t=this._imageDataToCanvas(e.rasterizedImage),n=e.rasterizedImage.width,a=e.rasterizedImage.height,o=f-n*(.5+e.anchorX),s=m-a*(.5-e.anchorY);if(e.angle){const n=(360-e.angle)*Math.PI/180;r.save(),r.translate(Object(i.h)(e.offsetX),-Object(i.h)(e.offsetY)),r.translate(f,m),r.rotate(n),r.translate(-f,-m),r.drawImage(t,o,s),r.restore()}else r.drawImage(t,o+Object(i.h)(e.offsetX),s-Object(i.h)(e.offsetY))}const h=new l.b({x:f/t.width-.5,y:m/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:h}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const t=this._imageDataCanvas,r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t}_imageTo32Array(e,t,r){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));const i=this._imageDataCanvas,n=i.getContext("2d");return i.width=t,i.height=r,n.drawImage(e,0,0,t,r),new Uint32Array(n.getImageData(0,0,t,r).data.buffer)}_getRasterizedResource(e,t,r,i,o,s){let l,c,m,h;if("esriGeometryPolyline"===r||"esriGeometryPolygon"===r){const n=i&&i.style?i.style:g.Legend,h="esriGeometryPolyline"===r?b.stroke[n]:b.fill[n];if("line"===e.type){if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){const r=Object(f.d)(e.width,t,o,s),{image:i,width:n,height:a}=this._getPictureResource(e,r);return this._rasterizePictureResource(e,i,n,a,h,r)}return null}({analyzedCIM:l,hash:m}=x(e,t,o,s)),c=this._embedCIMLayerInVectorMarker(l,h)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type)return null;if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=Object(f.d)(e.offsetX,t,o,s),e.cim.offsetY=Object(f.d)(e.offsetY,t,o,s),e.cim.rotation=Object(f.d)(e.rotation,t,o,s),e.cim.markerPlacement=e.markerPlacement,({analyzedCIM:l}=x(e,t,o,s)),m=Object(a.b)(JSON.stringify(l)).toString(),c=this._embedCIMLayerInVectorMarker(l,h)}else{if("text"===e.type)return null;if("fill"===e.type){if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){const r=e.cim.size||e.cim.height;let i,n,a;if("CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type)({image:i,width:n,height:a}=this._getPictureResource(e,r));else{({analyzedCIM:l,hash:m}=x(e,t,o,s));const r=this._rasterizer.rasterizeJSONResource(l,1,this._avoidSDF);i=r.image,n=r.size[0],a=r.size[1]}return this._rasterizePictureResource(e,i,n,a,h,null)}if("CIMSolidFill"!==e.cim.type)return null;({analyzedCIM:l,hash:m}=x(e,t,o,s)),c=this._embedCIMLayerInVectorMarker(l,h)}}}else{if("text"===e.type)return h=this._rasterizeTextResource(e,t,i,o,s),h;({analyzedCIM:l,hash:m}=x(e,t,o,s));const r=p(i,e,null);if("CIMPictureMarker"===e.cim.type){const i=Object(f.d)(e.size,t,o,s)*r,{image:n,width:a,height:l}=this._getPictureResource(e,i);return h={image:n,size:[a,l],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0},h}Object(n.d)(l,r,{preserveOutlineWidth:!1}),c=l}m+=r,i&&(m+=JSON.stringify(i));const u=this._resourceCache;return u.has(m)?u.get(m):(h=this._rasterizer.rasterizeJSONResource(c,window.devicePixelRatio||1,this._avoidSDF),u.set(m,h),h)}_rasterizeTextResource(e,t,r,i,n){const a=p(r,e,null),o=Object(f.d)(e.text,t,i,n);if(!o||0===o.length)return null;const s=Object(f.d)(e.fontName,t,i,n),l=Object(f.d)(e.style,t,i,n),c=Object(f.d)(e.weight,t,i,n),m=Object(f.d)(e.decoration,t,i,n),h=Object(f.d)(e.size,t,i,n)*a,u=Object(f.d)(e.horizontalAlignment,t,i,n),y=Object(f.d)(e.verticalAlignment,t,i,n),g=Object(f.b)(Object(f.d)(e.color,t,i,n)),d=Object(f.b)(Object(f.d)(e.outlineColor,t,i,n)),b={color:g,size:h,horizontalAlignment:u,verticalAlignment:y,font:{family:s,style:l,weight:c,decoration:m},halo:{size:Object(f.d)(e.outlineSize,t,i,n)||0,color:d,style:l},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(o,b)}_rasterizePictureResource(e,t,r,n,a,o){const l=document.createElement("canvas"),c=l.getContext("2d");l.height=Object(i.h)(Math.max(Math.abs(a.frame.ymax-a.frame.ymin),o)),l.width=Object(i.h)(Math.abs(a.frame.xmax-a.frame.xmin));const f=c.createImageData(r,n);f.data.set(new Uint8ClampedArray(t.buffer));const m=this._imageDataToCanvas(f),h=c.createPattern(m,"repeat"),u=Math.cos((-e.cim.rotation||0)*Math.PI/180),y=Math.sin((-e.cim.rotation||0)*Math.PI/180);h.setTransform({m11:u,m12:y,m21:-y,m22:u,m41:Object(i.h)(e.cim.offsetX)||0,m42:Object(i.h)(e.cim.offsetY)||0});const g=a.canvasPaths;let d,p,b;Object(s.g)(g)?(d=g.rings,c.fillStyle=h,p=c.fill,b=["evenodd"]):Object(s.h)(g)&&(d=g.paths,c.strokeStyle=h,c.lineWidth=o,p=c.stroke,d[0][0][1]=l.height/2,d[0][1][1]=l.height/2),c.beginPath();for(const s of d){const e=s?s.length:0;if(e>1){let t=s[0];c.moveTo(Object(i.h)(t[0]),Object(i.h)(t[1]));for(let r=1;r<e;++r)t=s[r],c.lineTo(Object(i.h)(t[0]),Object(i.h)(t[1]));c.closePath()}}p.apply(c,b);const x=c.getImageData(0,0,l.width,l.height),O=new Uint8Array(x.data);return{size:[l.width,l.height],image:new Uint32Array(O.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t){const r=this._pictureMarkerCache.get(e.materialHash);if(!r)return null;const n=r.height/r.width,a=t?n>1?Object(i.h)(t):Object(i.h)(t)/n:r.width,o=t?n>1?Object(i.h)(t)*n:Object(i.h)(t):r.height;return{image:this._imageTo32Array(r,a,o),width:a,height:o}}_embedCIMLayerInVectorMarker(e,t){const r=Object(s.g)(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol";return{type:"CIMVectorMarker",frame:t.frame,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}}}(null,!0);async function M(e,t={}){const{size:r,maxSize:a,node:o,opacity:s}=t,l=t.cimOptions||t,{feature:c,fieldMap:f,geometryType:m,style:h}=l,u=Object(n.c)(e),y=Math.min(null!=r?r:u,null!=a?a:Object(i.i)(120));y!==u&&(e=e.clone(),Object(n.e)(e,y,{preserveOutlineWidth:!0}));let g=3;e&&e.data&&e.data.symbol&&"CIMPointSymbol"!==e.data.symbol.type&&(g=1);const d=await O.rasterizeCIMSymbolAsync(e,c,f,m,{scaleFactor:g,style:h}),p=document.createElement("canvas");p.width=d.imageData.width,p.height=d.imageData.height,p.getContext("2d").putImageData(d.imageData,0,0);let b=p.width/g,x=p.height/g;if(null!=r&&(null==(null==t?void 0:t.scale)||(null==t?void 0:t.scale))){const e=b/x;b=e<=1?Math.ceil(y*e):y,x=e<=1?y:Math.ceil(y/e)}const M=new Image(b,x);return M.src=p.toDataURL(),null!=s&&(M.style.opacity=`${s}`),o&&o.appendChild(M),M}},950:function(e,t,r){"use strict";var i=r(319),n=r(350),a=r(352),o=r(490);t.a=class{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,t,r){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){const[r,i,n]=a.c.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t);return{size:[i,n],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type){const[t,r,i]=a.c.rasterizeSimpleLine(e.style,e.cap);return{size:[r,i],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let i,s,l;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(i=a.a.fromSimpleMarker(e),l=Object(o.c)(i)):"CIMHatchFill"===e.type?(i=a.a.fromCIMHatchFill(e),s=new n.a(i.frame.xmin,-i.frame.ymax,i.frame.xmax-i.frame.xmin,i.frame.ymax-i.frame.ymin)):e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type?(i=a.a.fromCIMInsidePolygon(e),s=new n.a(i.frame.xmin,-i.frame.ymax,i.frame.xmax-i.frame.xmin,i.frame.ymax-i.frame.ymin)):(i=e,l=Object(o.c)(i)),l&&!r){const[e,t,r]=Object(o.a)(l);return e?{size:[t,r],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,f,m,h,u]=a.a.rasterize(this._rasterizationCanvas,i,s,!r);return c?{size:[f,m],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:h,anchorY:u}:null}rasterizeImageResource(e,t,r,n){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;const a=this._rasterizationCanvas.getContext("2d");r instanceof ImageData?a.putImageData(r,0,0):(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`),a.drawImage(r,0,0,e,t));const o=a.getImageData(0,0,e,t),s=new Uint8Array(o.data);if(n)for(const i of n)if(i&&i.oldColor&&4===i.oldColor.length&&i.newColor&&4===i.newColor.length){const[e,t,r,n]=i.oldColor,[a,o,l,c]=i.newColor;if(e===a&&t===o&&r===l&&n===c)continue;for(let i=0;i<s.length;i+=4)e===s[i]&&t===s[i+1]&&r===s[i+2]&&n===s[i+3]&&(s[i]=a,s[i+1]=o,s[i+2]=l,s[i+3]=c)}let l;for(let i=0;i<s.length;i+=4)l=s[i+3]/255,s[i]=s[i]*l,s[i+1]=s[i+1]*l,s[i+2]=s[i+2]*l;let c=s,f=e,m=t;const h=512;if(f>=h||m>=h){const r=f/m;r>1?(f=h,m=Math.round(h/r)):(m=h,f=Math.round(h*r)),c=new Uint8Array(4*f*m);const n=new Uint8ClampedArray(c.buffer);Object(i.j)(s,e,t,n,f,m,!1)}return{size:[e,t],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}}}]);
//# sourceMappingURL=128.826a2ffd.chunk.js.map