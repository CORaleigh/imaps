(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[15,198,265,280],{1034:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));var a=i(110),r=i(246);function n(){const e=new r.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(a.a`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(a.a`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}var s=Object.freeze({__proto__:null,build:n})},1035:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d}));var a=i(235),r=i(384),n=i(278),s=i(257),o=i(326),c=i(335),l=i(110),h=i(246);function d(e){const t=new h.a;return t.include(r.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(l.a`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(a.a,e),e.multipassTerrainEnabled&&(t.fragment.include(n.a),t.include(s.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(l.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${l.a.float(o.b)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(c.a),t.fragment.code.add(l.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${l.a.float(o.b)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}var u=Object.freeze({__proto__:null,build:d})},1148:function(e,t,i){"use strict";i.r(t),i.d(t,"createCircle",(function(){return M})),i.d(t,"createEllipse",(function(){return w})),i.d(t,"createMultipoint",(function(){return O})),i.d(t,"createPoint",(function(){return f})),i.d(t,"createPolygon",(function(){return j})),i.d(t,"createPolyline",(function(){return v})),i.d(t,"createRectangle",(function(){return _})),i.d(t,"createSquare",(function(){return y})),i.d(t,"makeMapPoint",(function(){return m}));i(95);var a=i(172),r=i(86),n=i(83),s=i(111),o=i(878),c=i(509),l=i(259),h=i(102),d=i(674),u=i(105),p=i(193),g=i(127),b=i(119);function m(e,t,i=null){return Object(n.k)(i)?[e,t,i]:[e,t]}function f(e,t){const i=new u.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function O(e,t){return new p.a({points:e,spatialReference:t})}function v(e,t,i){const a=new g.a({paths:e,spatialReference:t});return i&&Object(l.i)(a),a}function j(e,t,i,n=!0){const s=Object(r.a)(e);s.forEach((e=>{const t=e[0],i=e[e.length-1];Object(a.c)(t,i)&&1!==e.length||e.push(e[0])}));let o=new b.a({rings:s,spatialReference:t});return o.rings.forEach((e=>{Object(l.g)(e,!1,!1)||e.reverse()})),i&&Object(l.i)(o),n&&o.isSelfIntersecting&&Object(h.j)(t)&&(o=Object(c.simplify)(o)),o}function y(e,t,i){const a=t.mapToLocalMultiple(e),r=[],s={x:a[0].x,y:a[0].y},o=a[1].x,c=a[1].y,l=Math.round(o-s.x),h=Math.round(c-s.y),u=Math.max(Math.abs(l),Math.abs(h));if(i){const e={x:s.x+u,y:s.y+u},t={x:s.x-u,y:s.y-u};r.push(Object(d.b)(e.x,t.y),Object(d.b)(t.x,t.y),Object(d.b)(t.x,e.y),Object(d.b)(e.x,e.y))}else{const e={x:l>0?s.x+u:s.x-u,y:h>0?s.y+u:s.y-u};r.push(Object(d.b)(s.x,s.y),Object(d.b)(e.x,s.y),Object(d.b)(e.x,e.y),Object(d.b)(s.x,e.y))}return j([Object(n.g)(r.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function _(e,t,i){let a=t.mapToLocalMultiple(e);if(1===a.length){const e=48,t=a[0];a=[Object(d.b)(t.x-e,t.y+e),Object(d.b)(t.x+e,t.y-e),Object(d.b)(t.x+e,t.y-e),Object(d.b)(t.x-e,t.y+e)]}const r=[],s={x:a[0].x,y:a[0].y},o={x:a[1].x,y:a[1].y};if(i){const e=Math.round(o.x-s.x),t=Math.round(o.y-s.y);r.push(Object(d.b)(s.x-e,s.y-t),Object(d.b)(o.x,s.y-t),Object(d.b)(o.x,o.y),Object(d.b)(s.x-e,o.y))}else r.push(Object(d.b)(s.x,s.y),Object(d.b)(o.x,s.y),Object(d.b)(o.x,o.y),Object(d.b)(s.x,o.y));return j([Object(n.g)(r.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function M(e,t,i,a){const r=t.mapToLocalMultiple(e);let u=null,p=null;if(i)u=r[0],p=r[1];else{const e=r[0],t=r[1],i=Math.round(t.x-e.x),a=Math.round(t.y-e.y),n=Math.max(Math.abs(i),Math.abs(a));u=Object(d.b)(i>0?e.x+n/2:e.x-n/2,a>0?e.y+n/2:e.y-n/2),p=Object(d.b)(Math.abs(i)>Math.abs(a)?u.x-n/2:u.x,Math.abs(i)>Math.abs(a)?u.y:u.y-n/2)}const g=t.localToMap(u),b=t.localToMap(p);if(Object(n.j)(g)||Object(n.j)(b))return null;t.doUnnormalization&&Object(l.j)([[g,b]],t.spatialReference);const m=f(g,t.spatialReference),O=f(b,t.spatialReference),v=Object(s.f)(t.spatialReference);let y=0;if(Object(h.j)(t.spatialReference))y=v*Object(c.distance)(m,O,null);else{const e=u.x-p.x,t=u.y-p.y;y=v*Math.sqrt(e*e+t*t)*(a||1)}const _=new o.a({center:m,radius:y,radiusUnit:"meters",spatialReference:t.spatialReference});return j(_.rings,_.spatialReference,!1)}function w(e,t,i){const a=t.mapToLocalMultiple(e),r=a[0],s=a[1],o=Math.round(s.x-r.x),c=Math.round(s.y-r.y),l=Object(d.b)(i?r.x:r.x+o/2,i?r.y:r.y+c/2),h=i?o:o/2,u=i?c:c/2,p=[],g=2*Math.PI/60;for(let n=0;n<60;n++){const e=Math.cos(n*g),t=Math.sin(n*g),i=Object(d.b)(h*e+l.x,u*t+l.y);p.push(i)}return p.push(p[0]),j([Object(n.g)(p.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}},1298:function(e,t,i){"use strict";i.r(t),i.d(t,"DrawGraphicTool",(function(){return je})),i.d(t,"DrawOperation",(function(){return H.a})),i.d(t,"GraphicMoveTool",(function(){return xt})),i.d(t,"GraphicReshapeTool",(function(){return qt})),i.d(t,"GraphicTransformTool",(function(){return ci})),i.d(t,"ExtentTransformTool",(function(){return Ea}));var a=i(79),r=i(116),n=i(77),s=i(122),o=i(152),c=i(83),l=i(109),h=i(81),d=i(82),u=i(78),p=i(80),g=i(436),b=i(340),m=i(104),f=i(482),O=i(181),v=i(791);const j={main:new m.a([255,127,0]),selected:new m.a([255,255,255]),staged:new m.a([12,207,255]),outline:new m.a([0,0,0,.5]),selectedOutline:new m.a([255,255,255])},y=.3;function _(e,t){const i=e.clone();return i.a*=t,i}function M(e,t){const i=e.clone(),a=Object(f.b)(i);a.s*=t;const r=Object(f.e)(a);return i.r=r.r,i.g=r.g,i.b=r.b,i}function w(e,t){if(t)for(const i in t)e[i]=t[i]}class x{constructor(e){this.color=j.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,w(this,e)}}class S{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=j.main,this.outlineColor=j.outline,this.renderOccluded=16,this.hoverOutlineColor=j.selectedOutline,w(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:I(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class E{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=_(j.main,.5),this.hoverColor=j.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,w(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:I(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class D{constructor(e){this.vertex=new S({color:j.main,outlineColor:j.outline}),this.edge=new S({color:M(_(j.main,2/3),.5),outlineColor:_(j.outline,.5),size:8,collisionPadding:8}),this.selected=new S({color:j.selected,outlineColor:j.outline}),this.edgeOffset=new E,w(this,e)}}class G{constructor(e){this.color=j.selected,this.width=1.5,this.stipplePattern=Object(v.a)([5,5]),this.stippleOffColor=j.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=j.selected,this.renderOccluded=4,w(this,e)}apply(e){e.color=I(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=I(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=I(this.innerColor),e.renderOccluded=this.renderOccluded}}class A{constructor(e){this.color=j.selected,this.size=4,this.outlineSize=1,this.outlineColor=j.outline,this.shape="square",w(this,e)}apply(e){e.color=I(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=I(this.outlineColor),e.primitive=this.shape}}class R{constructor(e){this.innerColor=j.selected,this.innerWidth=1,this.glowColor=j.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=y,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=j.main,w(this,e)}apply(e,t=1){const i={glowColor:m.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:m.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class P{constructor(e){this.outline=new G({color:j.outline,renderOccluded:8,stippleOffColor:j.selected,stipplePattern:Object(v.a)([5,5]),width:1.5,innerWidth:0}),this.staged=new G({color:j.selected,renderOccluded:8,innerColor:j.staged,stippleOffColor:j.outline,stipplePattern:Object(v.a)([5,5]),width:1.5}),this.shadowStyle=new R({globalAlpha:y,glowColor:j.main,glowFalloff:8,glowWidth:8,innerColor:j.selected,innerWidth:1}),w(this,e)}}class C{constructor(e){this.outline=new A({color:j.selected,outlineColor:j.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new R({globalAlpha:y,glowColor:j.main,glowFalloff:1.5,glowWidth:6,innerColor:j.selected,innerWidth:1,radius:2}),w(this,e)}}class k extends G{constructor(e){super(),this.extensionType=2,w(this,e)}}class T{constructor(e){this.lineGraphics=new P,this.pointGraphics=new C,this.heightPlane=new R({globalAlpha:y,glowColor:j.main,glowFalloff:8,glowWidth:8,innerColor:j.selected,innerWidth:1}),this.heightBox=new R({globalAlpha:y,glowColor:j.main,glowFalloff:8,glowWidth:8,innerColor:j.selected,innerWidth:0,heightFillColor:j.main}),this.zVerticalLine=new k({color:_(j.main,.5),falloff:2,innerColor:_(j.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,w(this,e)}}function I(e){return Object(O.d)(m.a.toUnitRGBA(e))}const z=new class{constructor(e){this.visualElements=new T,this.reshapeManipulators=new D,this.zManipulator=new x,w(this,e)}colorToVec4(e){return I(e)}};var H=i(689),V=i(743),L=i(101),F=i(99),U=i(189),B=i(420),q=i(173),W=i(234),Z=i(347),N=i(374),Y=i(91),X=i(166);class Q{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(c.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(c.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(c.j)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new K({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(Object(c.j)(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!Object(c.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){Object(c.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let K=class extends(Object(X.a)(Y.a)){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1}};Object(a.a)([Object(h.b)({constructOnly:!0})],K.prototype,"view",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],K.prototype,"drapeSourceType",void 0),K=Object(a.a)([Object(p.a)("DrapedVisualElementLayerView")],K);var J=i(623),$=i(740),ee=i(500),te=i(751),ie=i(365),ae=i(897),re=i(432);class ne{constructor(e){this.view=null,this._attachmentOrigin=Object(Z.g)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new s.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(B.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(B.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new $.a({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new Q({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new J.a({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(c.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(U.g)(e,this._color)||(Object(U.c)(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(U.g)(e,this._innerColor)||(Object(U.c)(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(c.k)(e)!==Object(c.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(U.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(B.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(c.k)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(c.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(L.w)(ce,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get("position"),a=i.indices.get("position"),r=Object(c.s)(this.resources.resources).material.isClosed(e.data,a);Object(ie.a)(e,a,r,oe)&&(Object(L.f)(ce,ce,oe),t++)}return 0===t?null:(Object(L.e)(ce,ce,1/t),this.view.renderCoordsHelper.fromRenderCoords(ce,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){Object(c.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(c.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return Object(c.k)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const a=this.createRenderGeometries();for(const r of a)e.addGeometry(r,t),i.push(r);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new re.a(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){const e=new re.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if(Object(c.j)(t))return[];const i=Object(te.c)(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:r}of i.lines){const t={attributeData:{position:r},removeDuplicateStartEnd:this.isClosed?1:0},i=new ae.a(Object(te.a)(t),e),n=Object(W.h)(se);Object(W.k)(n,r),Object(U.l)(i.boundingSphere,.5*(n[0]+n[3]),.5*(n[1]+n[4]),0,.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]))),a.push(i)}return a}calculateMapBounds(e){if(Object(c.j)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const a=i.vertexAttributes.get("position"),r=new Float64Array(a.data.length);Object(q.m)(a.data,t.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),Object(W.k)(e,r)}return!0}createRenderGeometries(){var e;const t=this.geometry;if(Object(c.j)(t))return[];const i=Object(te.b)(t,this.view.elevationProvider,this.view.renderCoordsHelper,ee.a.fromElevationInfo(null!=(e=this.elevationInfo)?e:new N.a({mode:Object(b.d)(t,null)}))),a=[],r=[];for(const{position:n,mapPosition:s}of i.lines){const e={attributeData:{position:n,mapPosition:s},removeDuplicateStartEnd:this.isClosed?1:0};a.push(Object(te.a)(e)),r.push(n)}return this._laserline.pathVerticalPlane=r,a}}const se=Object(W.f)(),oe=Object(F.e)(),ce=Object(F.e)();var le=i(472),he=i(898),de=i(349),ue=i(856);class pe extends le.a{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=z.colorToVec4(z.reshapeManipulators.vertex.color),this._size=z.reshapeManipulators.vertex.size,this._outlineColor=z.colorToVec4(z.reshapeManipulators.vertex.outlineColor),this._outlineSize=z.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(U.g)(e,this._color)||(Object(U.c)(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(U.g)(e,this._outlineColor)||(Object(U.c)(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(Object(c.j)(e)||0===e.length)return[];const t=Object(he.c)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ee.a.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,r=t.position;for(let n=0;n<a;++n){const e=Object(L.w)(ge,r[3*n+0],r[3*n+1],r[3*n+2]),t=be(.5,e),a=be(.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:a})}return i}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new ue.a({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new ue.a({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const ge=Object(F.e)();function be(e,t){return de.a.createSphereGeometry(e,16,16,{offset:t})}let me=class extends s.a.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(a.a)([Object(h.b)({constructOnly:!0})],me.prototype,"graphic",void 0),Object(a.a)([Object(h.b)()],me.prototype,"tracking",void 0),Object(a.a)([Object(h.b)()],me.prototype,"displaying",void 0),Object(a.a)([Object(h.b)()],me.prototype,"isDraped",void 0),me=Object(a.a)([Object(p.a)("esri.views.3d.layers.graphics.GraphicState")],me);var fe=i(1148),Oe=i(674),ve=i(551);let je=class extends(Object(o.b)(s.a.EventedMixin(ve.a))){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._activeVertexVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingManager=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}initialize(){const e=Object(c.t)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new g.a({elevationInfo:e,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new H.a({view:this.view,manipulators:this.manipulators,geometryType:ye(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,sceneDrawSurface:new V.b(this.view,e,[this._internalGraphicsLayer]),elevationDrawSurface:new V.a(e,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:e,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e))),this.complete()}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,a=i.slice();Object(c.k)(t)&&a.push(this.drawOperation.coordinateHelper.pointToArray(t));const r=Object(c.k)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],n={regularVertices:null,activeVertex:null,full:null,outline:null},s=a.length,o=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":n.regularVertices=i,n.activeVertex=r,n.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case"polyline":n.regularVertices=i,n.activeVertex=r,s>0&&(n.full=Object(fe.createPolyline)([a],o,l));break;case"polygon":n.regularVertices=i,n.activeVertex=r,s>0&&(n.full=Object(fe.createPolygon)([a],o,l,!0));break;case"circle":if(s>0){const t=Object(Oe.a)(this.view,a[0]);if(1===s&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+_e*this.view.resolution,e[1]);n.full=Object(fe.createCircle)([e,i],t,!0)}else 2===s&&(n.full=this.forceUniformSize?Object(fe.createCircle)(a,t,this.centered):Object(fe.createEllipse)(a,t,this.centered))}break;case"rectangle":if(s>0){const t=Object(Oe.a)(this.view,a[0]);if(1===s&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+_e*this.view.resolution,e[1]);n.full=Object(fe.createSquare)([e,i],t,!0)}else 2===s&&(n.full=this.forceUniformSize?Object(fe.createSquare)(a,t,this.centered):Object(fe.createRectangle)(a,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":case"polygon":s>1&&(n.outline=Object(fe.createPolyline)([a],o,l));break;case"circle":case"rectangle":Object(c.k)(n.full)&&"polygon"===n.full.type&&(n.outline=Object(fe.createPolygon)(n.full.rings,o,l))}return n}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){Object(c.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic=Object(c.e)(this._createGraphic)),this._createGraphicState=null,this.handles.remove(Me)}_destroyOutlineVisualElement(){this._outlineVisualElement=Object(c.e)(this._outlineVisualElement)}_destroyVerticesVisualElement(){this._verticesVisualElement=Object(c.e)(this._verticesVisualElement)}_destroyStagedVerticesVisualElement(){this._activeVertexVisualElement=Object(c.e)(this._activeVertexVisualElement)}_updateCreateGraphic(){const e=this._getCreateGeometry();if(Object(c.j)(e))return void this._destroyAllVisualisations();const t=this._internalGraphicsLayer.elevationInfo;Object(c.k)(e.outline)?Object(c.j)(this._outlineVisualElement)?(this._outlineVisualElement=new ne({view:this.view,geometry:e.outline,elevationInfo:t,isDraped:Object(c.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(b.c)(this.hasZ,t),attached:!1}),z.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),z.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=e.outline:this._destroyOutlineVisualElement(),Object(c.k)(e.regularVertices)?Object(c.j)(this._verticesVisualElement)?(this._verticesVisualElement=new pe({view:this.view,spatialReference:this.view.spatialReference,vertices:e.regularVertices,elevationInfo:t,renderOccluded:z.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=e.regularVertices:this._destroyVerticesVisualElement(),Object(c.k)(e.activeVertex)?Object(c.j)(this._activeVertexVisualElement)?(this._activeVertexVisualElement=new pe({view:this.view,spatialReference:this.view.spatialReference,vertices:[e.activeVertex],elevationInfo:t,renderOccluded:z.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=z.colorToVec4(z.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0):this._activeVertexVisualElement.vertices=[e.activeVertex]:this._destroyStagedVerticesVisualElement(),Object(c.k)(e.full)?Object(c.j)(this._createGraphic)?(this._createGraphic=new r.a({geometry:e.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer,...this.graphicProperties}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new me({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(l.a)(this._createGraphicState,"isDraped",(e=>{Object(c.k)(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)}))],Me),this.notifyChange("createGraphic")):this._createGraphic.geometry=e.full:this._destroyCreateGraphic()}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateGeometry({operationComplete:!0});Object(c.k)(e)&&(t=new r.a({geometry:e.full,symbol:this.createGraphicSymbol,sourceLayer:this._internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:t,...e})}};function ye(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(a.a)([Object(h.b)()],je.prototype,"drawOperation",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],je.prototype,"updating",null),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],je.prototype,"view",void 0),Object(a.a)([Object(h.b)()],je.prototype,"createGraphicSymbol",void 0),Object(a.a)([Object(h.b)()],je.prototype,"createGraphic",null),Object(a.a)([Object(h.b)({value:!0})],je.prototype,"enabled",null),Object(a.a)([Object(h.b)({value:!0})],je.prototype,"centered",null),Object(a.a)([Object(h.b)({value:!0})],je.prototype,"forceUniformSize",null),Object(a.a)([Object(h.b)({constructOnly:!0})],je.prototype,"graphicProperties",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],je.prototype,"hasZ",void 0),Object(a.a)([Object(h.b)({nonNullable:!0})],je.prototype,"defaultZ",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],je.prototype,"elevationInfo",void 0),Object(a.a)([Object(h.b)()],je.prototype,"snapToScene",void 0),Object(a.a)([Object(h.b)()],je.prototype,"snappingManager",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],je.prototype,"mode",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],je.prototype,"geometryType",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],je.prototype,"type",void 0),je=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],je);const _e=48,Me="create-graphic";var we=i(103),xe=i(112),Se=i(180),Ee=i(659),De=i(671),Ge=i(690);function Ae(e,t=Object(b.e)(e)){return"on-the-ground"!==t.mode&&!(Object(c.j)(e.geometry)||!e.geometry.hasZ)}var Re=i(107),Pe=i(605);class Ce{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof Pe.a&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(c.j)(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}}))}}var ke=i(707);function Te(e){const{view:t,graphic:i}=e,a=new me({graphic:i}),r=function(e,t){const{view:i,graphic:a}=e,r=new ne({view:i,geometry:ze(a)?a.geometry:null,elevationInfo:Object(b.e)(a),attached:!1});z.visualElements.lineGraphics.shadowStyle.apply(r);const n=()=>{r.attached=t.displaying};z.visualElements.lineGraphics.outline.apply(r);const s=[t.watch("displaying",n),t.watch("isDraped",(e=>r.isDraped=e)),t.on("changed",(()=>r.geometry=ze(a)?a.geometry:null)),Object(Se.a)(r)];return n(),{visualElement:r,remove:()=>Object(Se.b)(s).remove()}}(e,a),n=[r,Ie(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>Object(Se.b)(n).remove()}}function Ie(e,t,i){const{graphic:a,view:r}=e,n=[],s=Object(b.e)(a),o="on-the-ground"===s.mode||!s.offset&&"absolute-height"!==s.mode,l=new Ce,h=new ke.a({view:r,extensionType:z.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});z.visualElements.pointGraphics.shadowStyle.apply(h);const d=Object(Re.g)(z.visualElements.heightPlaneAngleCutoff),u=new J.a({view:r,attached:!1,angleCutoff:d});z.visualElements.heightPlane.apply(u);let p=1,g=1;const m=()=>{if(l.update(e),!i.displaying||o&&(i.isDraped||!ze(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(u.attached=!1);t.laserlineEnabled=!0;{const e=4&l.grabbingState?z.visualElements.laserlineAlphaMultiplier:1;e!==p&&(p=e,z.visualElements.lineGraphics.shadowStyle.apply(t,e),z.visualElements.pointGraphics.shadowStyle.apply(h,e))}{const e=2&l.grabbingState?z.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,z.visualElements.heightPlane.apply(u,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(c.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(c.k)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(h,l),function(e,t,i,a){if(a.numSelected>0){Object(L.w)(He,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{1===i&&e.selected&&e instanceof Pe.a&&(Object(L.f)(He,He,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=Object(L.e)(He,He,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;Object(c.k)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,He)?(i.heightManifoldTarget=He,i.attached=!0):i.attached=!1}}(e,t,u,l)};z.visualElements.zVerticalLine.apply(h),n.push(i.on("changed",m),i.watch("displaying",m),t.events.on("attachment-origin-changed",m),Object(Se.a)(h),Object(Se.a)(u));const f=[],O=()=>{Object(Se.b)(f).remove(),f.length=0,e.forEachManipulator((e=>f.push(e.events.on("grab-changed",m)))),e.forEachManipulator((e=>f.push(e.events.on("select-changed",m)))),m()};return O(),n.push(e.onManipulatorsChanged(O),Object(Se.d)((()=>Object(Se.b)(f)))),Object(Se.b)(n)}function ze(e){return Object(c.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const He=Object(F.e)();var Ve=i(121),Le=i(739),Fe=i(428);function Ue(e){const{view:t,graphic:i}=e,a=new me({graphic:i}),r=[],n=function(e,t,i){const{view:a,graphic:r}=e,n=new Le.a({view:a,geometry:Be(r),elevationInfo:Object(b.e)(r),attached:!1});return function(e,t,i,a){const r=()=>t.attached=i.displaying;(function(e,t,i,a){const{view:r,graphic:n}=e;let s=null;const o=e=>{Object(c.k)(s)&&(s.remove(),s=null),i.isDraped&&Object(c.k)(e)&&(s=function(e,t,i){const a=e.elevationProvider.spatialReference;Object(q.q)(t,qe,a);const r=qe[0],n=qe[1];return e.elevationProvider.on("elevation-change",(e=>{Object(Ve.j)(e.extent,r,n)&&i()}))}(r,e,(()=>{t.geometry=e})))},l=()=>{const e=Be(n);o(e),t.geometry=e};a.push(i.on("changed",l),Object(Se.d)((()=>s))),l()})(e,t,i,a),z.visualElements.pointGraphics.outline.apply(t),a.push(Object(l.a)(i,"displaying",r))}(e,n,t,i),i.push(Object(Se.a)(n)),n}(e,a,r);return function(e,t,i,a){const{view:r,graphic:n}=e,s=new ke.a({view:r,extensionType:z.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});z.visualElements.zVerticalLine.apply(s);const o=new J.a({view:r,intersectsLineInfinite:!0,attached:!1});z.visualElements.pointGraphics.shadowStyle.apply(o);const l=Object(Re.g)(z.visualElements.heightPlaneAngleCutoff),h=new J.a({view:r,attached:!1,angleCutoff:l});z.visualElements.heightPlane.apply(h);const d=Object(b.e)(e.graphic),u=ee.a.fromElevationInfo(d),p="on-the-ground"===d.mode||!d.offset&&"absolute-height"!==d.mode,g=new Ce;let m=1,f=1;const O=()=>{g.update(e);const i=Be(n),l=p&&(t.isDraped||Object(c.j)(i)||!i.hasZ);let d=!0;if(!l&&Object(c.k)(i)){const e=Object(Fe.e)(i,r.elevationProvider,u,r.renderCoordsHelper);Object(L.w)(qe,i.x,i.y,e),Object(q.u)(qe,i.spatialReference,qe,r.renderCoordsHelper.spatialReference),s.setStartEndFromWorldDownAtLocation(qe),o.intersectsWorldUpAtLocation=qe}else d=!1;const b=2&g.grabbingState?z.visualElements.laserlineAlphaMultiplier:1;b!==m&&(m=b,z.visualElements.heightPlane.apply(h,b));const O=Object(W.h)(We);!l&&t.displaying&&a.calculateMapBounds(O)&&Object(q.u)(Object(W.q)(O,qe),r.spatialReference,qe,r.renderCoordsHelper.spatialReference)?(h.heightManifoldTarget=qe,h.attached=!0):h.attached=!1;const v=4&g.grabbingState?z.visualElements.laserlineAlphaMultiplier:1;v!==f&&(f=v,z.visualElements.pointGraphics.shadowStyle.apply(o,v));const j=d&&t.displaying&&!l;o.attached=j,s.attached=j};i.push(t.watch(["displaying","isDraped"],O),t.on("changed",O)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",O))})),i.push(Object(Se.a)(o)),i.push(Object(Se.a)(s)),i.push(Object(Se.a)(h)),O()}(e,a,r,n),r.push(t.trackGraphicState(a)),{visualElement:n,remove(){Object(Se.b)(r).remove()}}}function Be(e){const t=e.geometry;return Object(c.j)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const qe=Object(F.e)(),We=Object(W.f)();function Ze(e){switch(Object(c.s)(e.graphic.geometry).type){case"point":case"mesh":return Ue(e);case"polygon":case"polyline":return Te(e);default:return null}}const Ne=[1,.5,0],Ye=70,Xe=Math.ceil(Ye/3*2),Qe=160,Ke=5*Math.PI/12,Je=1*Math.PI/3;class $e{constructor(){this._available=!0}set location(e){this.forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this.forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this.forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this.forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof Pe.a&&e(t,i)}))}}var et=i(140),tt=i(150),it=i(206),at=i(646),rt=i(398);function nt(e,t,i,a){const r=e.graphic,n=(e,i)=>t({action:e,graphic:r,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{const s=t.next((e=>("start"===e.action&&n("start",e),e))).next(Object(rt.g)(r,a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&n("update",e);break;case"end":n("end",e)}return e}));return i.next(Object(rt.i)(r)).next((()=>{n("end",{screenDeltaX:0,screenDeltaY:0})})),s}))}function st(e){if(Object(c.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}var ot=i(561);class ct extends $e{constructor(e){super(),this._handles=new xe.a,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=Ye,this._updateAfterDrag=!1,this.events=new s.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map((({manipulator:t})=>e(t,1)))}createGraphicDragPipeline(e,t,i){const a=t.graphic,r=Object(b.e)(a),n=Object(c.s)(a.geometry).spatialReference;return nt(t,i,(t=>this.createDragPipeline(((i,a,r,n,s)=>t(i,e(i,a,r,n,s),r)),r,n,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){return Object(Se.b)(this._arrowManipulatorInfos.map((({manipulator:r},n)=>Object(rt.e)(r,((r,s,o,c,l)=>{const h=s.next((e=>({...e,manipulatorType:1}))).next(Object(rt.f)(this._view,r.elevationAlignedLocation)).next(Object(at.d)(this._view,r.elevationAlignedLocation,t,i,a)).next(Object(rt.d)(r.location,this.angle+(n+1)*Math.PI*.5)).next(Object(rt.c)());e(r,h,o,c,l)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const a=this._radius/Ye,r=54*a,n=r*Math.sqrt(3)/2,s=de.a.createExtrudedTriangle(n,r/2,r/2,.02);de.a.transformInPlace(s,Object(et.q)(it.a.get(),Object(L.w)(it.d.get(),0,-n/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],e.radius=n/3*2*1.2;const o=Object(et.i)(it.a.get());Object(et.x)(o,i*Math.PI/2);const c=Object(et.i)(it.a.get());Object(et.q)(c,Object(L.w)(it.d.get(),0,100*a,0)),Object(et.m)(t,o,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(et.i)(it.a.get());Object(et.c)(t,t,e,Object(F.g)(0,0,1));const i=Object(et.v)(it.a.get(),Object(L.w)(it.d.get(),this.displayScale,this.displayScale,this.displayScale)),a=Object(et.i)(it.a.get());Object(et.m)(a,i,t);for(const r of this._arrowManipulatorInfos){const e=Object(et.m)(it.a.get(),a,r.transform);r.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new Pe.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(F.g)(0,0,1)}}),i={manipulator:t,transform:Object(tt.d)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}createMaterial(e=1){const t=m.a.toUnitRGBA(j.main);return t[3]*=e,new ot.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class lt{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new rt.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(c.k)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(Object(c.k)(i)){const a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}snap(e){const t=Object(c.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(c.k)(t)&&Object(c.k)(this.view)&&(t.z=Object(b.g)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return Object(c.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class ht extends $e{constructor(e){super(),this._handles=new xe.a,this._snapToScene=new lt,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Ye,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const a=t.graphic,r=Object(b.e)(a),n=Object(c.s)(a.geometry).spatialReference;return nt(t,i,(t=>this.createDragPipeline(((i,a,r,n,s)=>t(i,e(i,a,r,n,s),r)),r,n,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){const r=this._view;return Object(rt.e)(this._manipulator,((n,s,o,c,l)=>{const h=s.next(Object(rt.f)(r,n.elevationAlignedLocation)).next(Object(at.d)(r,n.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(r,t),this._snapToScene.next).next((e=>({...e,manipulatorType:1}))).next(Object(rt.c)());e(n,h,o,c,l)}))}_updateManipulatorTransform(){const e=Object(et.v)(it.a.get(),Object(L.w)(it.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Pe.a({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(F.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=de.a.createCylinderGeometry(.02,1,128,Object(F.g)(0,0,1),Object(F.g)(0,0,0)),t=Object(et.v)(Object(tt.d)(),Object(F.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/Ye*80}_createMaterial(e=1){const t=m.a.toUnitRGBA(j.main);return t[3]*=e,new ot.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class dt extends $e{constructor(e){super(),this._handles=new xe.a,this._radius=Ye,this.events=new s.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){const a=Object(c.s)(t.graphic.geometry).spatialReference;return nt(t,i,(t=>this.createDragPipeline(((i,a,r,n,s)=>t(i,e(i,a,r,n,s),r)),a)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return Object(rt.e)(this._manipulator,((a,r,n,s,o)=>{const c=r.next((e=>({...e,manipulatorType:0}))).next(Object(at.i)(i,a.renderLocation,t)).next(Object(rt.c)());e(a,c,n,s,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/Ye,t=z.zManipulator.height*e,i=z.zManipulator.coneHeight*e,a=z.zManipulator.coneWidth*e,r=z.zManipulator.width*e,n=[Object(F.g)(0,0,0),Object(F.g)(0,0,t)],s=de.a.createTubeGeometry(n,r/2,16,!1),o=de.a.createConeGeometry(i,a/2,16,!1),c=[Object(F.g)(0,0,0),Object(F.g)(0,0,t+i)],l=(e=>{const i=Object(tt.d)();return Object(et.t)(i,i,[0,0,t]),Object(et.b)(i,i,Math.PI/2),i})(),h=(e,t)=>{const i=Object(f.a)(z.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,z.zManipulator.color.a*e]},d=Object(Ee.c)(h(1,.25),1),u=Object(Ee.c)(h(1,0),1),p=Object(Ee.c)(h(.7,0),z.zManipulator.renderOccluded),g=Object(Ee.c)(h(.85,0),z.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:l,material:d,stateMask:1},{geometry:s,material:d,stateMask:1},{geometry:o,transform:l,material:u,stateMask:2},{geometry:s,material:u,stateMask:2},{geometry:o,transform:l,material:p,stateMask:1},{geometry:s,material:p,stateMask:1},{geometry:o,transform:l,material:g,stateMask:2},{geometry:s,material:g,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}createManipulator(){const e=new Pe.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=ut;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=Object(L.n)(t.eye,i),r=t.computeRenderPixelSizeAtDist(a),n=Object(L.j)(pt,i,t.eye);Object(L.r)(n,n);const s=gt;this._view.renderCoordsHelper.worldUpAtPosition(ut,s);const o=Math.abs(Object(L.h)(n,s)),c=Object(L.g)(pt,n,s),l=Object(L.g)(pt,c,s),h=Object(Re.e)(o,.01,1),d=1-Math.sqrt(1-h*h)/h/t.fullWidth,u=this._radius/Ye,p=z.zManipulator.width*u;Object(L.e)(l,Object(L.r)(l,l),(1/d-1)*a+r*p),e[12]-=pt[0],e[13]-=pt[1],e[14]-=pt[2]},this._manipulator=e,this.updateManipulator()}get test(){return{manipulator:this._manipulator}}}const ut=Object(F.e)(),pt=Object(F.e)(),gt=Object(F.e)();class bt extends $e{constructor(e){super(),this._handles=new xe.a,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:r}=e;this._view=i,this.xyManipulation=new ht({tool:t,view:i,snapToScene:a,radius:r}),this.xyAxisManipulation=new ct({tool:t,view:i,radius:r}),this.zManipulation=new dt({tool:t,view:i,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(Se.b)([this.xyManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>e(0,t,i,a,r,n)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>e(1,t,i,a,r,n)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>e(2,t,i,a,r,n)),t,i)])}createDragPipeline(e,t,i,a){return Object(Se.b)([this.xyManipulation.createDragPipeline(((t,i,a,r,n)=>e(0,t,i,a,r,n)),t,i,a),this.xyAxisManipulation.createDragPipeline(((t,i,a,r,n)=>e(1,t,i,a,r,n)),t,i,a),this.zManipulation.createDragPipeline(((t,i,a,r,n)=>e(2,t,i,a,r,n)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,1))),this.xyAxisManipulation.forEachManipulator((t=>e(t,1))),this.zManipulation.forEachManipulator((t=>e(t,0)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(n.a)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const a=()=>{const t=[];this.xyAxisVisible?Object(c.k)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(mt),this._handles.add(t,mt)};for(const r of i)this._handles.add(r.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=Object(c.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?Xe:Ye}}const mt="disable-xy-axis-display";var ft=i(660);class Ot extends $e{constructor(e){super(),this._handles=new xe.a,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return nt(this._graphicState,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=Object(c.k)(i.geometry)?i.geometry.spatialReference:null;return Object(rt.e)(this._manipulator,((r,n,s,o,c)=>{const l=n.next(Object(at.e)(c,t,i,a)).next(Object(rt.b)()).next(Object(rt.c)());e(r,l,s,o,c)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new ft.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}var vt=i(957),jt=i(521),yt=i(531);class _t{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Mt{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class wt{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let xt=class extends(Object(o.b)(s.a.EventedMixin(ve.a))){constructor(e){super(e),this.graphics=new we.a,this.enableZ=!0,this.type="move-3d",this._toolHandles=new xe.a,this.snappingPipeline=new De.a}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators(),this.complete()}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>0===Object(vt.a)(e))).map((e=>new St(e)));e.length&&(this.createManipulators(e),this.createVisualElements(e),this.handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Ot({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))))),this.handles.add(t.manipulationXY.createDragPipeline(((t,i,a,r)=>this.buildDragEventPipeline(e,0,t,i,a,r))))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new bt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?bt.radiusForSymbol(e[0].graphic.symbol):Ye});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=()=>this.updateMoveManipulation(e);for(const r of e)this.handles.add([r.state.on("changed",i),r.state.watch("displaying",i)]);const a=e[e.length-1];this.handles.add(a.state.on("changed",(()=>this.updateMoveManipulationAngle(a)))),this.handles.add(t.createDragPipeline(((t,i,a,r,n)=>this.buildDragEventPipeline(e,t,i,a,r,n)),Object(b.e)(a.graphic),Object(c.s)(a.graphic.geometry).spatialReference,a.graphic)),this.updateMoveManipulationAngle(a)}createVisualElements(e){for(const t of e){const i=t.graphic,a=Ze({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(Se.c)()});Object(c.j)(a)||(t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof ne&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this.updateMoveManipulation(e)})),t.state.watch("isDraped",(()=>this.updateMoveManipulation(e)))]),this.handles.add(a))}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>st(e.graphic.geometry)}updateMoveManipulation(e){const t=Object(Z.g)(0,0,0,this.view.spatialReference);let i=0,a=!1;const r=this._moveManipulation;for(const n of e){if(!n.state.displaying)continue;const e=n.state.graphic;this.enableZ&&Ae(e)&&(a=!0);const r=n.geometryRepresentation instanceof ne&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:Object(Ee.f)(this.view,e);Object(c.k)(r)&&(t.x+=r.x,t.y+=r.y,t.z+=r.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}buildDragEventPipeline(e,t,i,a,r,n){const s=[],o=[];let c=null,l=null;const h=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){const t=e[0].graphic;a=this.buildSnappingPipelineSteps(t,Object(b.e)(t),a,r,n)}const d=a.next((t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(rt.h)(o,this.view.state.viewingMode),l=Object(rt.j)(o),this.emit("graphic-move-start",new _t(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>c(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,r=i.y-t.y;if(this.emit("graphic-move",new Mt(a,r,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new wt(o)),this.destroyed)return null;h()}}));return r.next((e=>l(e))).next((()=>{if(this.emit("graphic-move-stop",new wt(o)),this.destroyed)return null;h()})),d}buildSnappingPipelineSteps(e,t,i,a,r){const n=e.geometry;if(Object(c.j)(n)||"point"!==n.type&&"mesh"!==n.type)return i;const s=("point"===n.type?n:n.anchor).clone(),o=new yt.a({elevationInfo:t,pointer:r,geometry:jt.a.fromGeometry(s,this.view.viewingMode),visualizer:new Ge.a,excludeFeature:e}),l=this.snappingManager;return i.next((t=>(s.z=Object(b.a)(this.view,s,Object(b.e)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:o.coordinateHelper.fromPoint(s)}))).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:o,snappingManager:l,cancel:a,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],xt.prototype,"view",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],xt.prototype,"graphics",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],xt.prototype,"enableZ",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],xt.prototype,"snappingManager",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],xt.prototype,"type",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],xt.prototype,"updating",null),xt=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],xt);class St{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new me({graphic:e})}get graphic(){return this.state.graphic}}var Et=i(958),Dt=i(127),Gt=i(409),At=i(100),Rt=i(298),Pt=i(736);function Ct(e,t,i){const a="on-the-ground"===i.mode?1:0;return new Pt.a(e,a,t,0)}function kt(e,t,i){const a=Object(F.e)();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;const r=Tt(e,t,Object(Rt.r)(i.plane)),n=Tt(e,t,i.edgeDirection);if(Object(c.j)(r)||Object(c.j)(n))return null;const s=Object(L.g)(Object(F.e)(),r,n);return Object(Rt.g)(a,s,Object(Rt.d)())}function Tt(e,t,i){const a=Object(Z.g)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),r=Object(F.e)(),n=Object(F.e)();return e.renderCoordsHelper.toRenderCoords(t,r)&&e.renderCoordsHelper.toRenderCoords(a,n)?Object(L.v)(n,r,n):null}let It=class extends(s.a.EventedMixin(o.a)){constructor(e){super(e),this._vertexManipulatorMaterial=Object(Ee.c)(z.colorToVec4(z.reshapeManipulators.vertex.color),z.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Object(Ee.d)(z.colorToVec4(z.reshapeManipulators.vertex.outlineColor),z.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Object(Ee.d)(z.colorToVec4(z.reshapeManipulators.vertex.hoverOutlineColor),z.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Object(Ee.c)(z.colorToVec4(z.reshapeManipulators.edge.color),z.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Object(Ee.d)(z.colorToVec4(z.reshapeManipulators.edge.outlineColor),z.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=Object(Ee.c)(z.colorToVec4(z.reshapeManipulators.edgeOffset.color),z.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Object(Ee.c)(z.colorToVec4(z.reshapeManipulators.edgeOffset.hoverColor),z.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=Object(Ee.c)(z.colorToVec4(z.reshapeManipulators.selected.color),z.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Object(Ee.d)(z.colorToVec4(z.reshapeManipulators.selected.outlineColor),z.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Object(Ee.d)(z.colorToVec4(z.reshapeManipulators.selected.hoverOutlineColor),z.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new xe.a,this._manipulatorInfos=[],this._editGeometryHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new De.a,this._snappingPipelineHandle=new De.a,this._vertexLaserLineVisualElement=null}initialize(){const e=new me({graphic:this.graphic});this._graphicState=e,this.handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._clear()}get inputGeometry(){return Object(c.k)(this._editGeometryHelper)?this._editGeometryHelper.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._removeManipulators(),this._resetGrabbingDragging(),this._editGeometryHelper=Object(c.e)(this._editGeometryHelper)}_removeManipulators(){this._moveManipulation=Object(c.e)(this._moveManipulation),this._graphicMoveManipulation=Object(c.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(Object(c.j)(this._editGeometryHelper))return;const e=Object(b.e)(this.graphic);for(const t of this._editGeometryHelper.editGeometry.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return Object(c.k)(this._editGeometryHelper)&&this._editGeometryHelper.canRedo}get canUndo(){return Object(c.k)(this._editGeometryHelper)&&this._editGeometryHelper.canUndo}redo(){if(Object(c.j)(this._editGeometryHelper))return null;const e=this._editGeometryHelper.redo();return Object(c.k)(e)&&(this.outputGeometry=this._editGeometryHelper.geometry,this._recreateManipulators()),e}undo(){if(Object(c.j)(this._editGeometryHelper))return null;this.emit("undo");const e=this._editGeometryHelper.undo();return Object(c.k)(e)&&(this.outputGeometry=this._editGeometryHelper.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._clear(),Object(c.j)(e)||(Object(c.e)(this._editGeometryHelper),this._editGeometryHelper=jt.a.fromGeometry(e,this.view.viewingMode),this._createManipulators())}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;let i=0;const a=[],r=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),n=1===e&&r;for(const s of this._manipulatorInfos)Ht(s)&&(s.manipulator.grabbing||n&&!s.manipulator.selected||a.push(s),i++);if(0!==a.length)if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)Ht(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const r=[];for(const n of this._manipulatorInfos)Ht(n)&&(n.manipulator.selected&&!n.manipulator.grabbing||n===e.info)&&r.push(n);this._moveVertices(r,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){if(this._graphicMoveManipulation=new Ot({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=Object(c.s)(this._editGeometryHelper).createUndoGroup()),t))).next((t=>{this._perGraphicManipulatorDragAction(0,t),"end"===t.action&&(e=Object(c.r)(e))})),a.next(this._cancelDragOperation((()=>e=Object(c.r)(e))))})))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))]))),this._moveManipulation=new bt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Ae(this.graphic),snapToScene:!1,radius:bt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this.handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=Object(c.s)(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline(((t,i,a,r,n)=>{const s=a.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>Ht(e)&&e.manipulator.selected));return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new yt.a({geometry:Object(c.s)(this._editGeometryHelper),elevationInfo:e,pointer:n,excludeFeature:this.graphic,visualizer:new Ge.a}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(Object(rt.b)()).next((e=>(this._perGraphicManipulatorDragAction(1,e),e)));return r.next(this._cancelDragOperation()),s}),e,t,this.graphic),Object(l.a)(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),Object(l.a)(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this.handles.remove(e)}))]),this._updateMoveManipulationPosition();const i=Ze({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){Object(c.k)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});Object(c.k)(i)&&(this._outlineVisualElement=i.visualElement instanceof ne?i.visualElement:null),Object(c.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=Object(b.e)(this.graphic)){const i=z.reshapeManipulators.edgeOffset,a=i.size/2,r=a+i.collisionPadding;if(Object(c.j)(this._edgeOffsetManipulatorGeometryInside)||Object(c.j)(this._edgeOffsetManipulatorGeometryOutside)){const e=a/r,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=de.a.createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=de.a.createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset)}const n=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],s=new Pe.a({view:this.view,renderObjects:n,elevationInfo:"on-the-ground"!==t.mode||Object(Gt.h)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,touchMultiplier:1,radius:r,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(F.g)(0,0,1)},collisionPriority:1}),o=new Pe.a({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:"default"});o.grabbable=!1;const l={manipulator:s,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,visibilityManipulator:o,elevationInfo:t,visibilityHandle:null},h=()=>{Object(c.r)(l.visibilityHandle);(!s.focused&&!o.focused||(()=>function(e,t,i){const a=i.projectToRenderScreen(e,Object(At.e)()),r=i.projectToRenderScreen(t,Object(At.e)());return Object(L.t)(Object(L.j)(a,a,r))}(this._getManipulatorInfoFromHandle(l.handle.left).manipulator.renderLocation,this._getManipulatorInfoFromHandle(l.handle.right).manipulator.renderLocation,this.view.state.camera)<i.minSquaredEdgeLength)())&&(s.grabbable=!1,l.visibilityHandle=Object(Se.b)([s.disableDisplay(),{remove:()=>{s.grabbable=!0}}]))};this._manipulatorHandles.add([s.events.on("focus-changed",(()=>h())),o.events.on("focus-changed",(()=>h())),{remove:()=>{Object(c.r)(l.visibilityHandle),this.manipulators.remove(l.visibilityManipulator)}}],s),h(),this._updateEdgeOffsetManipulator(l);const d=this._getManipulatorInfoFromHandle(l.handle.left).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(l))),u=this._getManipulatorInfoFromHandle(l.handle.right).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(l)));l.locationUpdateHandle=Object(Se.b)([d,u]),this._manipulatorHandles.add(l.locationUpdateHandle,s),this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!0),s);const p=Object(rt.e)(s,((e,i,a)=>{this._clearSelection();const{step:r,cleanup:n}=this._initializeEdgeOffset(l,t);i.next((e=>this._trackNumDragging(e))).next(Object(rt.f)(this.view,e.elevationAlignedLocation)).next(r).next(Object(at.h)(this.view)).next(Object(at.a)(this.view,Object(c.s)(this._editGeometryHelper).editGeometry.coordinateHelper.spatialReference)).next(Object(rt.b)()).next(this._applyEdgeOffsetStep(l)).next((e=>{"end"===e.action&&n()})),a.next((e=>(n(),e))).next(this._cancelDragOperation())}));return this._manipulatorHandles.add(p,s),this._manipulatorHandles.add([s.events.on("immediate-click",(e=>{e.shiftKey||this._clearSelection(),e.stopPropagation()})),o.events.on("immediate-click",(e=>this.emit("immediate-click",{...e,graphic:this.graphic})))],s),this._manipulatorInfos.push(l),this.manipulators.add(s),this.manipulators.add(o),this.emit("manipulators-changed"),l}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=Object(c.s)(this._editGeometryHelper).editGeometry.coordinateHelper,i=kt(this.view,e.manipulator.elevationAlignedLocation,Ct(t,e.handle,Object(c.s)(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator.renderLocation,r=this._getManipulatorInfoFromHandle(e.handle.right).manipulator.renderLocation,n=Object(c.k)(i)?function(e,t,i){const a=Object(Rt.r)(e),r=Object(L.v)(Object(F.e)(),t,i),n=Object(L.g)(Object(F.e)(),r,a),s=Object(L.g)(Object(F.e)(),r,n);return Object(tt.e)(r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1)}(i,a,r):tt.a;e.manipulator.modelTransform=n,e.visibilityManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.visibilityManipulator.modelTransform=n;const s=Object(L.p)(Object(L.j)(Ft,a,r))/2;e.visibilityManipulator.collisionType={type:"line",paths:[[[-s,0,0],[s,0,0]]]}}_initializeEdgeOffset(e,t){const i=Object(c.s)(this._editGeometryHelper),a=Ct(i.editGeometry.coordinateHelper,e.handle,t),r=i.createUndoGroup(),n=kt(this.view,e.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.left.left),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.right.right),0);const s=()=>new Dt.a({paths:[[e.handle.left.pos,e.handle.right.pos]],spatialReference:Object(c.s)(this._editGeometryHelper).editGeometry.coordinateHelper.spatialReference}),o=new ne({view:this.view,isDraped:this._graphicState.isDraped,geometry:s(),elevationInfo:e.elevationInfo,width:z.visualElements.lineGraphics.outline.width,color:z.colorToVec4(j.main),attached:!0});let l;const h=()=>{this._cleanEdgeOffsetCollapsedEdges(e),l=Object(c.r)(l)},d=this.on("undo",h);return l=Object(Se.b)([Object(Se.a)(o),this._graphicState.watch("isDraped",(e=>o.isDraped=e)),this._graphicState.on("changed",(()=>o.geometry=s())),r,d]),{step:e=>Object(c.j)(a)||Object(c.j)(n)?(h(),null):{...e,operation:a,plane:n},cleanup:h}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||Object(c.j)(t.operation))return t;this._updateEventState(2);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:r}=t;return(i||a||r)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const a=null==(t=e.handle.left.left)?void 0:t.left,r=e.handle.left,n=null==(i=e.handle.right.right)?void 0:i.right,s=e.handle.right,o=Object(c.s)(this._editGeometryHelper).editGeometry.coordinateHelper,l=1e-6,h=[];a&&o.distance(a.pos,r.pos)<l&&h.push(this._getManipulatorInfoFromHandle(r)),(o.distance(r.pos,s.pos)<l||n&&o.distance(n.pos,s.pos)<l)&&h.push(this._getManipulatorInfoFromHandle(s)),h.length&&this._removeVertices(h)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=Object(b.e)(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(Object(c.j)(this._vertexManipulatorGeometry)||Object(c.j)(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(z.reshapeManipulators.vertex);this._vertexManipulatorGeometry=de.a.createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=de.a.createSphereGeometry(t,16,16)}if(Object(c.j)(this._edgeManipulatorGeometry)||Object(c.j)(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(z.reshapeManipulators.edge);this._edgeManipulatorGeometry=de.a.createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=de.a.createSphereGeometry(t,16,16)}const i=Object(c.k)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Ut.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Ut.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Ut.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Ut.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Ut.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Ut.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Ut.Edge});const a=new Pe.a({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(a,e,t);const r="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(r),this.manipulators.add(a),this._updateManipulatorPosition(r),"edge"===r.type){const e=this._getManipulatorInfoFromHandle(r.handle.left).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r))),t=this._getManipulatorInfoFromHandle(r.handle.right).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r)));r.locationUpdateHandle=Object(Se.b)([e,t]),this._manipulatorHandles.add(r.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const n=Object(rt.e)(a,((e,i,a,n)=>{let s=null;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(s=Object(c.s)(this._editGeometryHelper).createUndoGroup()),Vt(r)){const t=this._splitEdgeManipulator(r);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:r,snapOrigin:r.handle.pos}})).next(Object(rt.f)(this.view,e.elevationAlignedLocation)).next(Object(at.f)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this.isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new yt.a({geometry:Object(c.s)(this._editGeometryHelper),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new Ge.a}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(Object(rt.b)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(s=Object(c.r)(s))})),a.next(this._cancelDragOperation((()=>s=Object(c.r)(s))))}));return this._manipulatorHandles.add(n,a),this._manipulatorHandles.add([a.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,r))),a.events.on("select-changed",(()=>{r.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))],a),this.emit("manipulators-changed"),r}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=Object(c.k)(this._editGeometryHelper)?this._editGeometryHelper.geometry:null,Object(c.k)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Ut.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=z.reshapeManipulators.vertex.size/2+z.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=Object(c.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=Ut.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=z.reshapeManipulators.edge.size/2+z.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||Object(Gt.h)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(c.s)(this._editGeometryHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,Lt),e.manipulator.grabbing&&Object(c.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(c.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const r=i.location,n=a.location,s=.5,o=r.x+s*(n.x-r.x),c=r.y+s*(n.y-r.y),l=r.hasZ&&n.hasZ?0:void 0;e.manipulator.location=Object(Z.g)(o,c,l,t.geometry.spatialReference)}else Object(L.i)(Ft,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=Ft}}_splitEdgeManipulator(e,t=.5){const i=Object(c.s)(this._editGeometryHelper),a=Object(c.s)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const r=Object(b.e)(this.graphic);let n;this.enableEdgeOffset?(this._removeManipulator(e),n=this._createVertexOrEdgeManipulator(a)):(n=e,n.handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),a.left&&this._createVertexOrEdgeManipulator(a.left),a.right&&this._createVertexOrEdgeManipulator(a.right),this.outputGeometry=i.geometry,this._updateManipulatorPosition(n),this._updateSelection(e.manipulator);const s=this._updateEventState(2),o=i.editGeometry.coordinateHelper.toArray(n.handle.pos),l=i.editGeometry.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:Object(c.s)(a.index)}],added:o}),s&&this._updateEventState(0),n}_updateMoveManipulationPosition(){const e=Object(L.w)(Ft,0,0,0);let t=0,i=!1,a=null,r=null;for(const n of this._manipulatorInfos)Ht(n)&&(n.manipulator.selected?(t++,Object(L.f)(e,e,n.manipulator.renderLocation),Object(c.j)(a)||n.selectedIndex>a.selectedIndex?(r=a,a=n):(Object(c.j)(r)||n.selectedIndex>r.selectedIndex)&&(r=n)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Ae(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Ae(this.graphic)}if(0!==t){let e=0;if(Object(c.k)(a)){const t=a.handle.pos,i=Object(c.k)(r)?r.handle.pos:a.handle.left&&a.handle.left.left?a.handle.left.left.pos:null,n=!Object(c.k)(r)&&a.handle.right&&a.handle.right.right?a.handle.right.right.pos:null;i&&n?this._moveManipulation.xyAxisManipulation.available=!1:i?e=zt(i,t):n&&(e=zt(t,n))}this._moveManipulation.angle=e,this._moveManipulation.radius=Xe}else this._moveManipulation.angleDeferred=()=>st(Object(c.s)(this.graphic.geometry)),this._moveManipulation.radius=bt.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(L.e)(e,e,1/t),Lt.spatialReference=Object(c.s)(this._editGeometryHelper).geometry.spatialReference,Lt.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Lt),this._moveManipulation.elevationAlignedLocation=Lt):Object(c.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(c.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(Ee.g)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(c.s)(this._editGeometryHelper);for(const a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));const e=Object(c.s)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(c.s)(e.index)}}));this.outputGeometry=i.geometry;const a=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?0:1)){const a=Object(c.s)(this._editGeometryHelper);a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.geometry;for(const r of e)this._updateManipulatorPosition(r)}_offsetEdge(e,t){if(Object(c.j)(t.operation))return;const i=Object(c.s)(this._editGeometryHelper),a=t.operation.clone();a.distance=t.operation.signedDistanceToPoint(t.mapEnd),i.updateVertices([e.handle.left,e.handle.right],a),this.outputGeometry=i.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.left)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.right))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Vt(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function zt(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Ht(e){return"vertex"===e.handle.type}function Vt(e){return"edge"===e.handle.type}Object(a.a)([Object(h.b)({constructOnly:!0})],It.prototype,"tool",void 0),Object(a.a)([Object(h.b)()],It.prototype,"inputGeometry",null),Object(a.a)([Object(h.b)()],It.prototype,"outputGeometry",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],It.prototype,"updating",null),It=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],It);const Lt=Object(Z.g)(0,0,null,null),Ft=Object(F.e)();var Ut,Bt;(Bt=Ut||(Ut={})).Vertex=16,Bt.Edge=32;let qt=class extends(s.a.EventedMixin(ve.a)){constructor(e){super(e),this._handles=new xe.a,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null}destroy(){this._handles.removeAll(),this._reshapeOperation=Object(c.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=Object(Et.a)(this.graphic);this._reshapeOperation.inputGeometry=Object(c.k)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==Object(Et.b)(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){Object(c.j)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new It({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),Object(l.a)(this,"graphic",(()=>{this._updateGraphic()}),!0)]),this.complete()}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){Object(c.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(c.k)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){Object(c.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(c.k)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(a.a)([Object(h.b)()],qt.prototype,"_reshapeOperation",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"view",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],qt.prototype,"graphic",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableZShape",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableZVertex",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableMoveGraphic",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableMidpoints",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],qt.prototype,"enableEdgeOffset",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],qt.prototype,"type",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],qt.prototype,"snappingManager",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],qt.prototype,"updating",null),qt=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],qt);var Wt,Zt,Nt=i(105),Yt=i(216),Xt=i(254),Qt=i(466);(Zt=Wt||(Wt={})).ScaleIn=32,Zt.ScaleOut=64,Zt.RotateLeft=128,Zt.RotateRight=256,Zt.Unlocked=1024,Zt.DelayedFocused=2048,Zt.TouchInput=32768;class Kt{constructor(e){this.mode=null,this._handles=new xe.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new s.a,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(c.k)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this.ringManipulator.location=e}set elevationAlignedLocation(e){this.ringManipulator.elevationAlignedLocation=e}get grabbing(){return this.ringManipulator.grabbing}set interactive(e){this.ringManipulator.interactive=e}destroy(){Object(c.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object(Yt.a)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(c.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(rt.e)(e,((e,i,a)=>{this._scaleRotateDragData=null,this.adapter.restart();const r={mode:"none",origin:Object(F.c)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=r,this.updateDragState();const n=it.d.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,n),i.next(Object(at.g)(this.tool.view,Object(Rt.g)(e.renderLocation,n,Object(Rt.d)()))).next((e=>{const i=Object(Rt.r)(e.plane),a=Object(Ee.a)(e.renderStart,e.renderEnd,r.origin,i),n=Qt.b.shortestSignedDiff(r.angle,a);r.angleDir=Object(Re.e)(r.angleDir+n,-.3,.3),r.angle=a;const s=function(e,t){const i=Object(L.j)(it.d.get(),t.renderStart,e.origin),a=Object(L.j)(it.d.get(),t.renderEnd,e.origin),r=Object(L.p)(i),n=Object(L.p)(a);return 0===r?0:n/r}(r,e),o=s-this.adapter.scale;if(r.scaleDir=Object(Re.e)(r.scaleDir+o,-.2,.2),this.onScaleChanged(),"none"===r.mode){const i=this.mode||function(e,t,i,a){const{renderStart:r,renderEnd:n}=e,s=Jt(r,a,it.d.get()),o=Jt(n,a,it.d.get());if(Object(L.l)(s,o)<100)return null;const c=Object(L.j)(it.d.get(),r,i),l=Object(L.g)(it.d.get(),c,Object(Rt.r)(t)),h=r,d=Object(L.f)(it.d.get(),h,l),u=Jt(i,a,it.d.get()),p=s,g=Jt(d,a,it.d.get()),b=Object(L.j)(it.d.get(),g,p),m=Object(L.j)(it.d.get(),s,u),f=Object(Xt.g)(p,b),O=Object(Xt.g)(u,m);return Object(Xt.d)(f,o)<Object(Xt.d)(O,o)?"rotate":"scale"}(e,e.plane,r.origin,this.tool.view.state.camera);if(Object(c.k)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}r.mode=i}}switch(r.mode){case"rotate":this.adapter.angle=r.initialAngle+a;break;case"scale":this.adapter.scale=s,this.onScaleChanged()}switch(this.updateDragState(),this.updateManipulatorTransform(),e.action){case"start":case"update":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(Re.r)(r.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:s,yScale:s})}break;case"end":switch(r.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(Re.r)(r.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:s,yScale:s});break;default:case"none":}}"end"===e.action&&(this.startAnimation($t(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState())})),a.next((()=>{if(this.adapter.cancel(),Object(c.k)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation($t(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState()}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,i=0,t()},update:e=>(i+=e,!a()||i>200?1:0),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),Object(l.a)(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e))])}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Wt.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Wt.Unlocked,!(Object(c.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(c.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Wt.ScaleIn|Wt.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Wt.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Wt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Wt.RotateLeft|Wt.RotateRight,!1),this.ringManipulator.updateStateEnabled(Wt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Wt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Wt.ScaleIn|Wt.ScaleOut|Wt.RotateLeft|Wt.RotateRight,!1)}updateManipulatorTransform(){const e=Object(et.i)(it.a.get()),t=this.adapter.angle;Object(et.c)(e,e,t,Object(F.g)(0,0,1));const i=this.getScale(),a=Object(et.v)(it.a.get(),Object(L.w)(it.d.get(),i,i,i)),r=Object(et.i)(it.a.get());Object(et.m)(r,a,e),this.ringManipulator.modelTransform=r}createRingManipulator(){const e=(e,t,i)=>{const a=[],r=Math.ceil(128*(t-e)/(2*Math.PI));for(let n=0;n<r+1;n++){const s=e+n*(t-e)/r;a.push(Object(F.g)(i*Math.cos(s),i*Math.sin(s),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>de.a.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(Qe),r=i(a,24),n={left:[],right:[]},s=[];for(let b=0;b<2;b++){const t=b*Math.PI-Math.PI/4,a=Math.PI/2-Ke,r=t+a,o=t+Math.PI/2-a,c=e(r,o,190),l=i(c,9);s.push(c),s.push(e(r,o,201)),n.left.push(l),n.right.push(l);for(let e=0;e<2;e++){const t=0===e,i=Object(tt.d)();if(t){Object(et.s)(i,i,[1,-1,1]),Object(et.c)(i,i,-r,[0,0,1]);const e=Math.round(.2*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{Object(et.c)(i,i,o,[0,0,1]);const e=Math.round(.8*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const a=de.a.createExtrudedTriangle(60,0,23,.5);de.a.transformInPlace(a,i),(t?n.left:n.right).push(a)}}const o=[];for(let b=0;b<2;b++){const t=b*Math.PI-Math.PI/4,a=Math.PI/2-Je,r=t+a,n=t+Math.PI/2-a,s=e(r,n,213);o.push(i(s,9))}const c=t(190),l=t(213),h=i(c,9),d=i(l,9),u=t(130),p=t(107),g=i(u,9),m=i(p,9),f=this.createMaterial(),O=this.createMaterial(.66),v=this.createMaterial(.5),j=this.createMaterial(.33);let y=[{geometry:r,material:f,stateMask:Wt.DelayedFocused},{geometry:r,material:v,stateMask:0}];this.mode&&"scale"!==this.mode||(y=y.concat([{geometry:o,material:f,stateMask:Wt.DelayedFocused|Wt.Unlocked},{geometry:h,material:O,stateMask:Wt.DelayedFocused|Wt.ScaleIn},{geometry:d,material:j,stateMask:Wt.DelayedFocused|Wt.ScaleIn},{geometry:g,material:O,stateMask:Wt.DelayedFocused|Wt.ScaleOut},{geometry:m,material:j,stateMask:Wt.DelayedFocused|Wt.ScaleOut}])),this.mode&&"rotate"!==this.mode||(y=y.concat([{geometry:n.right,material:f,stateMask:Wt.DelayedFocused|Wt.Unlocked},{geometry:n.left,material:f,stateMask:Wt.DelayedFocused|Wt.RotateLeft},{geometry:n.right,material:f,stateMask:Wt.DelayedFocused|Wt.RotateRight}]));const _=[a,...s];return new Pe.a({view:this.tool.view,renderObjects:y,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(b.e)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:_,direction:Object(F.g)(0,0,1)}})}createMaterial(e=1){const t=[...Ne,e];return new ot.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{ringManipulator:this.ringManipulator}}}function Jt(e,t,i){return t.projectToScreen(e,ei),Object(L.w)(i,ei[0],ei[1],0)}function $t(e,t){let i=null,a=1;const r=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=r,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}const ei=Object(At.g)();var ti=i(258),ii=i(830);function ai(e){return Object(c.k)(e.geometry)&&"mesh"===e.geometry.type?function(e){return Object(c.k)(e.transform)?function(e,t){let i=t.clone(),a=null;return{undo:t=>{a=Object(c.k)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=Object(c.k)(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()}}}(e,e.transform):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=c.o;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let ri=class extends o.a{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(ni);const e=this.geometry.transform;if(this.scale=1,Object(c.k)(e)){const t=Object(ii.c)(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=Object(Re.g)(Object(ii.a)(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Object(ti.b)((()=>({angle:this.angle,scale:this.scale})),(e=>this.update(e))),ni)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return ai(this.graphic)}update({scale:e,angle:t}){const i=this.geometry.anchor,a=1===this.viewingMode;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:i,geographic:a}),this.previousScale=e,this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,Object(Re.r)(t-this.previousAngle),{origin:i,geographic:a}),this.previousAngle=t,this.graphic.notifyGeometryChanged())}};Object(a.a)([Object(h.b)({constructOnly:!0})],ri.prototype,"graphic",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],ri.prototype,"geometry",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],ri.prototype,"viewingMode",void 0),Object(a.a)([Object(h.b)()],ri.prototype,"angle",void 0),Object(a.a)([Object(h.b)()],ri.prototype,"scale",void 0),ri=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],ri);const ni="scale-heading-update-key";let si=class extends o.a{constructor(e){super(e),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(oi);const e=Object(c.k)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:c.o;if(this.symbol=Object(c.k)(e)?e.clone():null,this.initialSizes=[],Object(c.k)(e)){const t=this.findLayerView();Object(c.k)(t)&&(this.initialSizes=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray())}this.angle=0,Object(c.k)(e)&&e.symbolLayers.some((e=>!("object"!==e.type||!Object(c.k)(e.heading))&&(this.angle=-Object(Re.g)(e.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(Object(ti.b)((()=>({angle:this.angle,scale:this.scale})),(e=>this.updateSymbol(e))),oi)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e,this.restart()},redo:i=>{e=i.symbol,i.symbol=t,this.restart()}}}updateSymbol({scale:e,angle:t}){const i=this.graphic.symbol;if(Object(c.j)(this.symbol)||Object(c.j)(i)||"point-3d"!==i.type)return;const a=i.clone(),r=-Object(Re.r)(t-this.initialAngle);let n=!1;this.forEachObjectSymbolLayerPair(this.symbol,a,((t,i,a)=>{const s=Object(c.t)(t.heading,0)+r;i.heading!==s&&(i.heading=s,n=!0);const o=this.initialSizes[a];if(Object(c.k)(o)&&"width"in o){o.width=this.sizeFilter(o.width),o.height=this.sizeFilter(o.height),o.depth=this.sizeFilter(o.depth);const t=o.width*e;i.width!==t&&(i.width=t,n=!0);const a=o.depth*e;i.depth!==a&&(i.depth=a,n=!0);const r=o.height*e;i.height!==r&&(i.height=r,n=!0)}})),n&&(this.graphic.symbol=a)}forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,a)=>{const r=t.symbolLayers.getItemAt(a);"object"===e.type&&"object"===r.type&&i(e,r,a)}))}};Object(a.a)([Object(h.b)()],si.prototype,"angle",void 0),Object(a.a)([Object(h.b)()],si.prototype,"scale",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],si.prototype,"graphic",void 0),Object(a.a)([Object(h.b)()],si.prototype,"symbol",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],si.prototype,"findLayerView",void 0),Object(a.a)([Object(h.b)({constructOnly:!0})],si.prototype,"sizeFilter",void 0),si=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],si);const oi="scale-heading-update-key";let ci=class extends(Object(o.b)(s.a.EventedMixin(ve.a))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new De.a}initialize(){this.graphicState=new me({graphic:this.graphic}),this.moveManipulation=new bt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ae(this.graphic),radius:bt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:this.graphicState.graphic}),e.stopPropagation()}))))),this.moveManipulation.elevationInfo=Object(b.e)(this.graphic);const e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>(Object(c.k)(e)&&0===t&&(a=a.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new yt.a({elevationInfo:Object(b.e)(this.graphic),pointer:n,geometry:jt.a.fromGeometry(new Nt.a({spatialReference:e.spatialReference}),this.view.viewingMode),visualizer:new Ge.a,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:r}),this.snappingPipeline.next)),a)),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:r}=e,n={graphic:i,dxScreen:a,dyScreen:r};switch(t){case"start":this.emit("graphic-translate-start",n),this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n)}})),this.moveManipulation.angle=Object(c.k)(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(()=>this.updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Kt({tool:this,mode:e,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())))}this.handles.add([Ze({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Se.c)()}),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((e=>{e instanceof Pe.a&&this.handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorsInteractive())))})),this.complete()}updateManipulatorsInteractive(){Object(c.j)(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}createScaleRotateAdapter(){return Object(c.k)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new ri({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new si({graphic:this.graphic,sizeFilter:e=>this.enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer))})}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(c.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Ae(this.graphic)}))}createGeometryUndoRecord(){return ai(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=Object(c.e)(this.scaleRotate),this.scaleRotateAdapter=Object(c.e)(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this.moveManipulation.location=e,Object(c.k)(this.scaleRotate)&&(this.scaleRotate.location=e)}set elevationAlignedLocation(e){this.moveManipulation.elevationAlignedLocation=e,Object(c.k)(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}reset(){}onDetach(){Object(c.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){Object(c.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(Object(c.j)(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}onGeometryChanged(){Object(Ee.g)(this.view,this,this.graphic)}enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(c.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],ci.prototype,"view",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],ci.prototype,"graphic",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],ci.prototype,"enableZ",void 0),Object(a.a)([Object(h.b)()],ci.prototype,"enableRotation",void 0),Object(a.a)([Object(h.b)()],ci.prototype,"enableScaling",void 0),Object(a.a)([Object(h.b)({value:!1})],ci.prototype,"snapToScene",null),Object(a.a)([Object(h.b)({constructOnly:!0})],ci.prototype,"snappingManager",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],ci.prototype,"type",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],ci.prototype,"updating",null),ci=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],ci);var li=i(111),hi=i(131),di=i(175),ui=i(685),pi=(i(95),i(184),i(494)),gi=i(427);Object(n.a)("mac"),Math.cos(Object(Re.g)(45)),Math.cos(Object(Re.g)(5));const bi=[1,.5,0],mi=[...bi,1],fi=[1,1,1,1],Oi=[1,.8,.6,1],vi=[1,.93,.86,1],ji=[...bi,1],yi=[...bi,1];i(899);var _i=i(568),Mi=i(371),wi=i(343),xi=i(571),Si=i(310),Ei=i(364),Di=i(292),Gi=i(299),Ai=i(300),Ri=i(293),Pi=i(1034),Ci=i(277);class ki extends Gi.a{initializeProgram(e){const t=ki.shader.get().build();return new Ri.a(e.rctx,t,Ai.a)}bindPass(e,t){Object(Ei.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){Object(Ei.d)(this.program,e),this.program.rebindTextures()}initializePipeline(){return Object(Ci.f)({blending:Object(Ci.g)(1,1,771,771),depthTest:{func:513},colorWrite:Ci.c})}}ki.shader=new Di.a(Pi.a,(()=>i.e(313).then(i.bind(null,1286))));wi.a;class Ti extends Mi.a{constructor(e){super(e),this._technique=new ki(this._techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(e){return 8===e}bind(e){this._technique.bindPass(this._material.params,e)}}Object(a.a)([Object(_i.c)()],Ti.prototype,"_technique",void 0);wi.b;le.a;var Ii=i(686),zi=i(395),Hi=i(672),Vi=i(331),Li=i(235),Fi=i(257),Ui=i(303),Bi=i(493),qi=i(1035);class Wi extends Gi.a{initializeProgram(e){const t=Wi.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Ri.a(e.rctx,a,Ai.a)}bindPass(e,t){Object(Ei.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Fi.a)(this.program,t))}bindDraw(e){Object(Ei.d)(this.program,e),Object(Li.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,a=3===e,r=2===e;return Object(Ci.f)({blending:0!==i.output&&7!==i.output||!i.transparent?null:a?Zi:Object(Vi.a)(e),culling:Object(Ci.b)(i.cullFace),depthTest:{func:Object(Vi.b)(e)},depthWrite:a?i.writeDepth&&Ci.d:Object(Vi.c)(e),colorWrite:Ci.c,stencilWrite:i.sceneHasOcludees?Bi.h:null,stencilTest:i.sceneHasOcludees?t?Bi.d:Bi.c:null,polygonOffset:a||r?null:Object(Vi.g)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}Wi.shader=new Di.a(qi.a,(()=>i.e(303).then(i.bind(null,1287))));const Zi=Object(Ci.h)(1,771);class Ni extends Ui.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(a.a)([Object(Ui.b)({count:8})],Ni.prototype,"output",void 0),Object(a.a)([Object(Ui.b)({count:3})],Ni.prototype,"cullFace",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"slicePlaneEnabled",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"transparent",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"enableOffset",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"writeDepth",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"sceneHasOcludees",void 0),Object(a.a)([Object(Ui.b)({count:4})],Ni.prototype,"transparencyPassType",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"multipassTerrainEnabled",void 0),Object(a.a)([Object(Ui.b)()],Ni.prototype,"cullAboveGround",void 0);class Yi extends wi.a{constructor(e){super(e,Qi),this.supportsEdges=!0,this.techniqueConfig=new Ni}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<Vi.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,r,n,s){Object(Si.f)(e,t,a,r,n,void 0,s)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new Xi(e):void 0}createBufferWriter(){return new xi.a(xi.d)}}class Xi extends Hi.a{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(Wi,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const Qi={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...wi.b};var Ki,Ji=i(1127),$i=i(84),ea=i(86),ta=i(108),ia=i(990);let aa=Ki=class extends $i.a{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new Ki({position:Object(ea.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(c.k)(this.position)&&Object(c.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};Object(a.a)([Object(h.b)({readOnly:!0,json:{read:!1,write:!0}})],aa.prototype,"type",void 0),Object(a.a)([Object(h.b)({type:Nt.a}),Object(ia.a)()],aa.prototype,"position",void 0),Object(a.a)([Object(h.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ia.a)(),Object(ta.a)((e=>Qt.a.normalize(Object(d.i)(e),0,!0)))],aa.prototype,"heading",void 0),Object(a.a)([Object(h.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(ia.a)(),Object(ta.a)((e=>Qt.a.normalize(Object(d.i)(e),0,!0)))],aa.prototype,"tilt",void 0),Object(a.a)([Object(h.b)({type:Number,nonNullable:!0}),Object(ia.a)()],aa.prototype,"width",void 0),Object(a.a)([Object(h.b)({type:Number,nonNullable:!0}),Object(ia.a)()],aa.prototype,"height",void 0),aa=Ki=Object(a.a)([Object(p.a)("esri.widgets.Slice.SlicePlane")],aa);u.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function ra(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(L.f)(it.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(L.f)(it.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(L.j)(it.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(L.j)(it.d.get(),e.origin,e.basis2),edge:t}}}function na(e){const t=Object(L.p)(e.basis1),i=Object(L.p)(e.basis2);return.3*Math.min(t,i)}function sa(e){return na(e)}function oa(e){return 0!==e.direction[0]&&0!==e.direction[1]}function ca(e,t=1){const i=0===t?40:0,a=[Object(F.g)(i,0,-24),Object(F.g)(i,0,24)],r=function(e,t){const i=Object(L.j)(Object(F.e)(),e[e.length-1],e[e.length-2]);if(Object(L.r)(i,i),Object(L.e)(i,i,12),Object(L.f)(i,i,e[e.length-1]),t){const t=Object(L.j)(Object(F.e)(),e[0],e[1]);return Object(L.r)(t,t),Object(L.e)(t,t,12),Object(L.f)(t,t,e[0]),[t,...e,i]}return[...e,i]}(a,!0),n=(e,t)=>function(e,t,i){const a=a=>{const r=(a?t:e).slice(0),n=Object(L.j)(it.d.get(),r[0],r[1]);Object(L.r)(n,n);const s=Object(L.j)(it.d.get(),r[r.length-1],r[r.length-2]);if(Object(L.r)(s,s),i.padding>0){const e=Object(L.e)(Object(F.e)(),s,-i.padding);if(r[r.length-1]=Object(L.f)(e,e,r[r.length-1]),i.bothEnds){const e=Object(L.e)(Object(F.e)(),n,-i.padding);r[0]=Object(L.f)(e,e,r[0])}}const o=a?i.tipFocusMultiplier:1,l=i.tipLength*(i.focusTipLength?o:1),h=i.tipRadius*o,d=Object(et.i)(it.a.get());if(i.padding>0){const e=l/4,t=Object(L.w)(it.d.get(),0,e,0),a=1+i.padding/e;Object(et.t)(d,d,t),Object(et.s)(d,d,Object(L.w)(it.d.get(),a,a,a)),Object(et.t)(d,d,Object(L.e)(t,t,-1/a))}const u=Object(et.i)(Object(tt.d)()),p=Object(F.g)(0,1,0),g=Object(et.w)(Object(tt.d)(),Object(pi.g)(it.b.get(),p,s));g[12]=r[r.length-1][0],g[13]=r[r.length-1][1],g[14]=r[r.length-1][2],Object(et.m)(g,g,d);const b=[{part:"tube",geometry:ha(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,r),transform:u}];let m,f;if(Object(c.k)(i.flat)?m=de.a.createExtrudedTriangle(l,h,h,i.flat.thickness):(m=de.a.createConeGeometry(l,h,24,!1,!1,!0),f=de.a.createConeGeometry(l,h,24,!1,!0,!1)),b.push({part:"tip",geometry:m,transform:g}),f&&b.push({part:"cap",geometry:f,transform:g}),i.bothEnds){const e=Object(et.w)(Object(tt.d)(),Object(pi.g)(it.b.get(),p,n));e[12]=r[0][0],e[13]=r[0][1],e[14]=r[0][2],Object(et.m)(e,e,d),b.push({part:"tip",geometry:m,transform:e}),f&&b.push({part:"cap",geometry:f,transform:e})}return b};return{normal:a(!1),focused:a(!0)}}(a,a,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),s=n(0,!1),o=n(2.25,!0),l=new ot.a({color:fi,cullFace:2,renderOccluded:16}),h=new ot.a({color:Oi,cullFace:2,renderOccluded:16}),d=new ot.a({color:vi,cullFace:2,renderOccluded:16}),u=new ot.a({color:yi,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),p=de.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),g=de.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),b=new Ji.a({color:ji,renderOccluded:4});return new Pe.a({view:e,renderObjects:[...s.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?h:d,transform:i,stateMask:1|ua}))),...o.normal.map((({geometry:e,transform:t})=>({geometry:e,material:u,transform:t,stateMask:1|ua}))),{geometry:p,material:b,stateMask:1|ua|pa},...s.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?h:d,transform:i,stateMask:2|ua}))),...o.focused.map((({geometry:e,transform:t})=>({geometry:e,material:u,transform:t,stateMask:2|ua}))),{geometry:g,material:b,stateMask:2|ua|pa}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[r]},collisionPriority:1,radius:11,state:ua})}function la(e,t){const i=oa(t),a=i?[Object(F.g)(1,0,0),Object(F.g)(0,0,0),Object(F.g)(0,1,0)]:[Object(F.g)(1,0,0),Object(F.g)(-1,0,0)],r=de.a.createPolylineGeometry(a),n=[...bi,1],s=i?4:1,o=2*s,c=e=>e>1?(e=>new re.a({color:n,width:e,renderOccluded:4}))(e):new Ji.a({color:n,renderOccluded:4}),l=[{geometry:r,material:c(s),stateMask:1|ba},{geometry:r,material:c(o),stateMask:2|ba},{geometry:r,material:c(1),stateMask:ma}],h=new Pe.a({view:e,renderObjects:l,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4,idHint:i?1:2});return h.state=ba,h}function ha(e,t,i){const a=[];if(Object(c.k)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const r=i/t*2*Math.PI;a.push([Math.cos(r)*e,Math.sin(r)*e])}}return de.a.createPathExtrusionGeometry(a,i,[],[],!1)}function da(e,t){return Object(gi.b)(t,e.basis2,e.basis1)+ga}const ua=16,pa=32,ga=(Object(Xt.c)(),Math.PI/2),ba=16,ma=32;class fa{constructor(){this.lastDragEvent=null,this.next=new rt.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(c.k)(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const t=oa(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}var Oa=i(637),va=i(735),ja=i(737),ya=i(738),_a=i(483);function Ma(e,t){return xa(e,t,!1)}function wa(e,t){return xa(e,t,!0)}function xa(e,t,i){if(e instanceof _a.b){if(e.operation instanceof va.a)return function(e,t,i=!1){const a=i?-1:1,r=Object(F.g)(a*e.dx,a*e.dy,a*e.dz);Object(L.f)(t.origin,t.origin,r)}(e.operation,t,i),!0;if(e.operation instanceof ja.a)return function(e,t,i=!1){const a=i?-e.angle:e.angle;Object(L.d)(t.basis1,t.basis1,F.b,a),Object(L.d)(t.basis2,t.basis2,F.b,a)}(e.operation,t,i),!0;if(e.operation instanceof ya.a)return function(e,t,i=!1){const a=i?1/e.factor1:e.factor1,r=i?1/e.factor2:e.factor2;Object(L.e)(t.basis1,t.basis1,a),Object(L.e)(t.basis2,t.basis2,r),Sa(t.origin,e.origin,e.axis1,a),Sa(t.origin,e.origin,e.axis2,r)}(e.operation,t,i),!0}return!1}function Sa(e,t,i,a){const r=it.c.get(),n=Object(hi.a)(r,e,t),s=Object(hi.b)(r,i,Object(hi.h)(i,n));Object(hi.p)(e,e,s,a-1)}let Ea=class extends(s.a.EventedMixin(ve.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new fa,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new xe.a,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Object(ui.a)(),this.mapBoundsStart=Object(ui.a)(),this.displayBounds=Object(ui.a)(),this.displayBoundsStart=Object(ui.a)(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new me({graphic:this.graphic});const e=this.graphic.geometry;this.editGeometryHelper=jt.a.fromGeometry(e,this.view.viewingMode),this.graphicMoveManipulation=new Ot({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=ca(this.view,0),this.moveZManipulator.state|=pa,this.handles.add(this.watch("enableZ",(()=>this.updateManipulatorAvailability(this.moveZManipulator,0)))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((e=>{const t=la(this.view,e);return this.handles.add(this.watch("enableScaling",(()=>this.updateManipulatorAvailability(t,2)))),t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this.handles.add(this._createResizeDragPipeline(t,e)),t})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new Oa.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/fAD/gAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/fAD/gAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/fgD/gAL/gAT/gAb/gQj/gwr/hAz/hA7/hxH/iBP/iRf/ixn/jBz/jR7/jyP/kCX/kyr/lCz/lS7/li//mTT/mTf/mjn/nDr/nTz/nT//n0H/oEL/oET/oEX/okf/o0r/o0v/pU3/pU//plH/qFL/qFP/qFX/qVb/q1n/rFz/rV3/rl7/rmD/rmH/sGL/s2v/tW3/tW7/tW//tnD/t3L/uHT/unb/unf/unn/vHv/vX3/vX7/v4D/w4n/xIv/xY3/xY3/x4//x5H/x5H/yZP/yJP/yZX/y5f/y5n/zZv/zJv/zZ3/z5//z6D/z6H/0KP/0aT/0qb/06j/06r/1av/1q3/1q//17H/2rb/2rb/2rj/3bz/38D/4MH/38H/4MT/4sX/4sb/48f/4sf/5Mr/5cz/5s3/5s3/59D/59D/6dP/6dT/6dT/6tX/6tb/6tf/69j/69n/7Nn/7dr/7dv/7dz/7t3/7t3/7t7/7+H/8eL/8eP/8uX/8+f/8+j/8+j/9On/9Or/9ez/9ez/9e3/9e3/9+7/9+//9+//+PD/+PD/+PH/+PH/+fL/+fT/+fT/+vX/+vX/+vb/+vb/+/b/+/j/+/j//Pn//Pr//fv//fv//fz//vz//v3//fz//v3//v3//v7///////9yfVyKAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADsUlEQVQYGZXBiUMUZRgH4JfW5fRosegCVoG10lVRgWUNBt39IUKSmAZdYpeVZYdm2Z2VpdGhkZ0WqWVSGVlWdtJNKWaUBZUlpcj7b7TfLDvfN8ssO/M8lEhG9oSppUEtFNKCpX5vdgY5Ms4XCMMkHPCNJZvceeWwVJ7npuTSCjQkpE1MoyRyKjAi7awUGkHWTCQ1I4sS8lTBhjmnkLWUSbDJl0IWXH7Y5nfRMK7pGNKI5Ka5KN65iPlwNZLzp5DZJMQsH/xyHpIrIpPxMLzOvB7C1Y+3dXR2ftHx8qPLYeFUUmRVIaapn/nXBixt289S19ZmxKvKJGkmDC9xxLb2ATYb2NmMOMVkOAOG+t854r9/eZjjz9fA7DQaklYJQwvrutjCJxfDpCKVogpgqP6Oo/5g3c89fYNsOLgUJl7SuTUY7uEhPcyft16/AMAFK7d08pBDy6DS3CTkQdrHMR+vhHTz+xz1YwNUuSQEYFjBhr7FUK3rY91bUJVTxDhIb7D0Kkyau1m3HqoxROSDoamfpYFrYXJZNws99VAUEVEAhmWb2978rPsYR+2D2Y39LDwDRRlRRhhxqi+64e6WF1/b+81amLWycHg+pHA6ZcO2uv0s3AmFhybCvsdY2AmFl6bCvkVHOaIHiilUAgf2sLAE0iyaDQdeYOEOSEHS4MA6Fh6GVEkhOHA7Cy2Q5lIIDqxmYTOkuaTBgftY2AipkmbDgSdZuAtSkErgwC4WroE0i/ywr/oXjjhyPqTJNAEmCx/66BYksoaFDijyKRtSzdpdfzPvRiJ7WXgCCg9lhGG49DhHnFgFa2tYONoIKZxOFIDUzsL3C2Bl4QEWtkNRSkQ+SCsGWXi7BsPV7mHhxJVQFBLRWCi2s27HfMSra2fdK1CNpogApIafWPfBhTBb8inruuqhKCchD4rbjrHu8CPzINW09LLun1uhyiXBrUHx4CBH/dB6CaIuf/YARw3cD5XmJl0BVJsGOebg7m1bd7xziGMGNsDES1FpFVA9cISt/XUvTM5LpSGnw+S6r9nKV1fBLIcMM2BSu+lPjtfbUgOzYpKyqmC2+OkuVn371CLEqcokRTbiVa967r1eFn57d8tN1RjGQyY+WKlruqKxFpYKKc45cMSfQnFc0+HANBcNc9LZsG2yi6wUwZ5wISVwsgYb5oynhDKLkVRxJo0kpwIj0s6kJFK9GhKq9KZScqNyA7AUyB1FNo0pKgvDJFxWOJocSffk+0uCWiikBUum5HvSKYH/AUiSxpA/XUvpAAAAAElFTkSuQmCC",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){const i=new Yi({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),a=40,r=27*1.1,n=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new zi.a([["position",{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},s=de.a.createPolylineGeometry([[0,0,0],[13,0,0]]),o=de.a.createPolylineGeometry([[0,0,0],[a-r,0,0]]),c=new Ji.a({color:mi,renderOccluded:4}),l=[{geometry:n(27),material:i,stateMask:1|ua},{geometry:s,material:c,stateMask:1|ua},{geometry:n(r),material:i,stateMask:2|ua},{geometry:o,material:c,stateMask:2|ua}];return new Pe.a({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:13.5,state:ua})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(()=>this.updateManipulatorAvailability(this.rotateManipulator,3)))),this.rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);const t=Ze({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Se.c)()});Object(c.k)(t)&&(this.outlineVisualElement=t.visualElement instanceof ne?t.visualElement:null),Object(c.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this.updateDisplayBounds(this.mapBounds)))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.graphicState.watch("displaying",(()=>this.updateAllManipulatorAvailability())),Object(l.a)(this.graphicState,"isDraped",(()=>this.graphicDrapedChanged())),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",(()=>this.updateDisplayBounds(this.mapBounds))));const a=e=>{this.handles.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()})))};this.forEachManipulator(a),this.graphicMoveManipulation.forEachManipulator(a);const r=(e,t)=>{this.handles.add(e.events.on("immediate-click",(e=>{1===t&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}graphicDrapedChanged(){this.handles.remove(Da),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(e=>{Object(c.k)(this.attachmentOrigin)&&Object(Ve.j)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds(this.mapBounds)})),Da)}updateAllManipulatorAvailability(){this.forEachManipulator(((e,t)=>this.updateManipulatorAvailability(e,t)))}updateManipulatorAvailability(e,t){const i=this.graphicState.displaying,a=this.grabbing&&!e.grabbing;e.interactive=!a;const r=this.enableZ&&Ae(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!a&&this.enableScaling,e.state=this.enableScaling?ba:ma;break;case 0:e.available=i&&r;break;default:e.available=i}}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,2))),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryHelper.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds(this.mapBounds)}calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryHelper.editGeometry,i=t.components[0].edges[0],a=Object(hi.a)(it.c.get(),i.left.pos,i.right.pos);Object(hi.f)(a,a);const r=Object(c.t)(Object(Ee.f)(this.view,this.graphic),e.extent.center);let n=Aa*this.view.pixelSizeAt(r);const s=this.view.spatialReference;s!==e.spatialReference&&(n*=Object(li.f)(s)/Object(li.f)(e.spatialReference)),function(e,t,i,a){a||(a=Object(ui.a)());const r=Object(hi.s)(it.c.get(),e[1],-e[0]),n=Object(hi.s)(it.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(hi.s)(it.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=it.c.get();t.components.forEach((t=>t.vertices.forEach((t=>{const i=t.pos;Object(hi.s)(o,Object(hi.h)(e,i),Object(hi.h)(r,i)),Object(hi.u)(n,n,o),Object(hi.v)(s,s,o)}))));const c=1e-6,l=Object(hi.s)(it.c.get(),s[0]-n[0]<c?i/2:0,s[1]-n[1]<c?i/2:0);Object(hi.a)(n,n,l),Object(hi.i)(s,s,l),Object(hi.b)(a.basis1,e,(s[0]-n[0])/2),Object(hi.b)(a.basis2,r,(s[1]-n[1])/2),Object(hi.s)(a.origin,n[0]*e[0]+n[1]*r[0],n[0]*e[1]+n[1]*r[1]),Object(hi.i)(a.origin,a.origin,a.basis1),Object(hi.i)(a.origin,a.origin,a.basis2)}(a,t,n,this.mapBounds)}updateDisplayBounds(e){const t=this.graphic.geometry,i=Object(c.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(c.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(Ee.f)(this.view,this.graphic);this.attachmentOrigin=Object(c.t)(i,t.extent.center);const a=Object(c.k)(i)?i.z:Object(Fe.e)(e.origin,this.view.elevationProvider,ee.a.fromElevationInfo(Object(b.e)(this.graphic)),this.view.renderCoordsHelper),r=Object(ui.b)(e);Object(L.w)(r.origin,e.origin[0],e.origin[1],a),function(e,t,i,a=0,r){r||(r=Object(ui.a)()),t.toRenderCoords(e.origin,i,r.origin);const n=it.d.get();Object(L.f)(n,e.origin,e.basis1),Object(L.f)(n,n,e.basis2),t.toRenderCoords(n,i,n);const s=it.d.get();Object(L.f)(s,e.origin,e.basis1),Object(L.j)(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=it.d.get();Object(L.j)(o,e.origin,e.basis1),Object(L.j)(o,o,e.basis2),t.toRenderCoords(o,i,o);const c=it.d.get();Object(L.j)(c,e.origin,e.basis1),Object(L.f)(c,c,e.basis2),t.toRenderCoords(c,i,c);const l=Object(L.i)(it.d.get(),n,s,.5);Object(L.j)(l,l,r.origin);const h=Object(L.i)(it.d.get(),o,c,.5);Object(L.j)(h,r.origin,h),Object(L.i)(r.basis1,l,h,.5);const d=Object(L.i)(it.d.get(),c,n,.5);Object(L.j)(d,d,r.origin);const u=Object(L.i)(it.d.get(),s,o,.5);Object(L.j)(u,r.origin,u),Object(L.i)(r.basis2,d,u,.5);const p=Object(L.g)(it.d.get(),r.basis1,r.basis2),g=Object(L.g)(p,p,r.basis1);Object(L.r)(g,g),Object(L.e)(r.basis2,g,Object(L.h)(r.basis2,g)),Object(L.e)(r.basis1,r.basis1,1+a/Object(L.p)(r.basis1)),Object(L.e)(r.basis2,r.basis2,1+a/Object(L.p)(r.basis2)),Object(ui.j)(r)}(r,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.focus.location:this.editGeometryHelper.geometry.extent.center;return Ga*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((e,t,i)=>this.applyGraphicMoveSteps(t,i)))}_createMoveZDragPipeline(){const e=this.view,t=this.editGeometryHelper.geometry.spatialReference;return Object(rt.e)(this.moveZManipulator,((i,a,r)=>{const n=Object(F.c)(i.renderLocation),s=a.next(Object(at.i)(e,n,t)).next(Object(rt.c)());this.applyGraphicMoveSteps(s,r)}))}applyGraphicMoveSteps(e,t){const i=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},Object(ui.b)(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next(Object(rt.b)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e}));return t.next((()=>{Object(c.k)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()})),i}_moveDragUpdateGeometry(){return e=>{if(Object(c.j)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const a of this.editGeometryHelper.editGeometry.components)t.push(...a.vertices);const i="start"===e.action?0:1;return Ma(this.editGeometryHelper.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.mapBounds),this.graphic.geometry=this.editGeometryHelper.geometry,e}}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);Object(Rt.m)(this.displayBounds.plane,t,it.d.get())&&(Object(ui.b)(this.displayBounds,this.displayBoundsStart),Object(ui.b)(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return Object(rt.e)(e,((e,i,a)=>{Object(c.j)(this.inputState)||(i.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next(Object(at.g)(this.view,this.displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),a.next((()=>{Object(c.k)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()})))}))}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin(),r=this.displayBoundsMarginStart,n=Object(L.k)(it.d.get(),t.origin);Object(L.c)(n,n,t.basis1,-i[0]),Object(L.c)(n,n,t.basis2,-i[1]);const s=Object(L.j)(it.d.get(),e.renderEnd,n),o=Object(L.j)(it.d.get(),e.renderStart,n),c=oa(e.handle),l=sa(t),h=sa(this.displayBounds)/l,d=(e,t)=>{if(0===e)return 1;let i=Object(L.p)(t),n=.5*e*Object(L.h)(t,s)/i;const l=n<0?-1:1;c&&(n+=(i-.5*e*Object(L.h)(t,o)/i)*l*h);const d=i<1.5*r?1:Ra;return i=Math.max(i-r,Ra),l>0&&(n-=a),l*Math.max(l*(n/i),d)};return{...e,factor1:d(i[0],t.basis1),factor2:d(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=Object(L.k)(Object(F.e)(),this.mapBoundsStart.origin);Object(L.c)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(L.c)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(hi.s)(Object(di.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(hi.f)(i,i);const a=[];for(const s of this.editGeometryHelper.editGeometry.components)a.push(...s.vertices);const r="start"===e.action?0:1,n=this.editGeometryHelper.scaleVertices(a,this.editGeometryHelper.editGeometry.coordinateHelper.fromXYZ(t),i,e.factor1,e.factor2,r,1);return Object(ui.b)(this.mapBoundsStart,this.mapBounds),Ma(n,this.mapBounds),this.graphic.geometry=this.editGeometryHelper.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=function(e,t,i,a){const r=t.worldUpAtPosition(e.origin,it.d.get()),n=it.d.get();switch(i){case 1:Object(L.k)(n,r);break;case 2:Object(L.k)(n,e.basis1)}return Object(Rt.g)(e.origin,n,a)}(this.displayBounds,this.view.renderCoordsHelper,1,Object(Rt.d)()),i=this._calculatePickRay(e.screenPoint);Object(Rt.m)(t,i,it.d.get())&&(Object(ui.b)(this.displayBounds,this.displayBoundsStart),Object(ui.b)(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return Object(rt.e)(e,((e,t,i)=>{const a=this.inputState;Object(c.j)(a)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next(Object(at.g)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,angle:Object(Re.r)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),i.next((()=>{Object(c.k)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=Object(Rt.r)(e.rotatePlane),a=Object(Ee.a)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return e=>{const t=Object(L.k)(Object(F.e)(),this.mapBoundsStart.origin),i=[];for(const n of this.editGeometryHelper.editGeometry.components)i.push(...n.vertices);const a="start"===e.action?0:1,r=this.editGeometryHelper.rotateVertices(i,this.editGeometryHelper.editGeometry.coordinateHelper.fromXYZ(t),e.rotateAngle,a,1);return Object(ui.b)(this.mapBoundsStart,this.mapBounds),Ma(r,this.mapBounds),this.graphic.geometry=this.editGeometryHelper.geometry,e}}_calculatePickRay(e){const t=Object(Xt.c)(),i=Object(At.j)(e);return Object(Ii.b)(this.view.state.camera,i,t),Object(L.r)(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;const e=function(e,t){return Object(Ee.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,it.a.get());(function(e,t,i,a){const r=a.worldUpAtPosition(i.origin,it.d.get()),n=ra(i,0),s=Object(et.i)(it.a.get());Object(et.r)(s,s,n.edge*Math.PI/2),Object(et.b)(s,s,-da(i,r)),Object(et.m)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach(((t,i)=>{!function(e,t,i,a){const r=Object(L.p)(a.basis1),n=Object(L.p)(a.basis2),s=na(a),o=sa(a),c=Object(L.w)(it.d.get(),0,0,0);Object(L.f)(c,Object(L.e)(it.d.get(),a.basis1,t.direction[0]),Object(L.e)(it.d.get(),a.basis2,t.direction[1])),Object(L.f)(c,a.origin,c);let l=0,h=1;if(oa(t))1===t.direction[0]&&-1===t.direction[1]?l=ga:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;l=1===e?ga:0,h=(1===e?n:r)-s}const d=Object(et.i)(it.a.get());Object(et.r)(d,d,l),Object(et.s)(d,d,Object(L.w)(it.d.get(),h,h,h)),Object(et.m)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}(t,this.resizeHandles[i],e,this.displayBounds)}))}updateZMoveHandle(e,t){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:Object(L.j)(it.d.get(),i.origin,i.basis1),edge:2},r=it.a.get();Object(et.r)(r,t,a.edge*Math.PI/2),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}cancel(){const e=this.editGeometryHelper.editGeometry.lastOperation;Object(c.j)(e)||(this.editGeometryHelper.undo(),this.graphic.geometry=this.editGeometryHelper.geometry,wa(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}get canUndo(){return this.editGeometryHelper.canUndo}undo(){if(Object(c.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryHelper.undo();this.graphic.geometry=this.editGeometryHelper.geometry,wa(Object(c.s)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}get canRedo(){return this.editGeometryHelper.canRedo}redo(){if(this.canRedo){const e=this.editGeometryHelper.redo();this.graphic.geometry=this.editGeometryHelper.geometry,Ma(Object(c.s)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Ea.prototype,"view",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Ea.prototype,"graphic",void 0),Object(a.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Ea.prototype,"enableZ",void 0),Object(a.a)([Object(h.b)()],Ea.prototype,"enableRotation",void 0),Object(a.a)([Object(h.b)()],Ea.prototype,"enableScaling",void 0),Object(a.a)([Object(h.b)()],Ea.prototype,"preserveAspectRatio",null),Object(a.a)([Object(h.b)()],Ea.prototype,"grabbing",void 0),Object(a.a)([Object(h.b)()],Ea.prototype,"inputState",void 0),Object(a.a)([Object(h.b)({readOnly:!0})],Ea.prototype,"type",void 0),Ea=Object(a.a)([Object(p.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Ea);const Da="draped-elevation-changes",Ga=10,Aa=80,Ra=1e-6},482:function(e,t,i){"use strict";function a(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function n(e){return"l"in e&&"c"in e&&"h"in e}function s(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return O}));const o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],c=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){const i=[];let a,r;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,s=e[0].length;let o=0;for(a=0;a<n;a++){for(o=0,r=0;r<s;r++)o+=e[a][r]*t[r];i.push(o)}return i}function h(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=l(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function d(e){const t=l(c,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function u(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function g(e){return u(h(e))}function b(e){return d(p(e))}function m(e){return function(e){const t=e.l,i=e.a,a=e.b,r=Math.sqrt(i*i+a*a);let n=Math.atan2(a,i);return n=n>0?n:n+2*Math.PI,{l:t,c:r,h:n}}(u(h(e)))}function f(e){return d(p(function(e){const t=e.l,i=e.c,a=e.h;return{l:t,a:i*Math.cos(a),b:i*Math.sin(a)}}(e)))}function O(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:n(e)?f(e):r(e)?b(e):s(e)?d(e):a(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,a=e.v/100*255,r=a*i,n=r*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:r,g:n,b:0};break;case 1:s={r:n,g:r,b:0};break;case 2:s={r:0,g:r,b:n};break;case 3:s={r:0,g:n,b:r};break;case 4:s={r:n,g:0,b:r};break;case 5:case 6:s={r:r,g:0,b:n};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+a-r),s.g=Math.round(s.g+a-r),s.b=Math.round(s.b+a-r),s}(e):e}function v(e){return a(e)?e:function(e){const t=e.r,i=e.g,a=e.b,r=Math.max(t,i,a),n=r-Math.min(t,i,a);let s=r,o=0===n?0:r===t?(i-a)/n%6:r===i?(a-t)/n+2:(t-i)/n+4,c=0===n?0:n/s;return o<0&&(o+=6),o*=60,c*=100,s*=100/255,{h:o,s:c,v:s}}(O(e))}function j(e){return r(e)?e:g(O(e))}function y(e){return n(e)?e:m(O(e))}function _(e,t){const i=g(e);return i.l*=1-t,b(i)}},499:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var a=i(96),r=i(193),n=i(105),s=i(119),o=i(127);const c={convertToGEGeometry:function(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){const a=e.hasZ(t),r=e.hasM(t),s=new n.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return a&&(s.z=e.getPointZ(t)),r&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s},exportPolygon:function(e,t,i){const a=new s.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return a.cache._geVersion=t,a},exportPolyline:function(e,t,i){const a=new o.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return a.cache._geVersion=t,a},exportMultipoint:function(e,t,i){const a=new r.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return a.cache._geVersion=t,a},exportExtent:function(e,t,i){const r=e.hasZ(t),n=e.hasM(t),s=new a.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(r){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(n){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s.cache._geVersion=t,s}}},505:function(e,t,i){"use strict";function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const r=e[a].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function n(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(r(i,e)+r(a,e))/2}));let a=0;const n=i.length;if(0===n)return e;for(let r=0;r<n;r++)a+=i[r];const s=Math.floor(a/n);return Math.max(s,e)}function s(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const r="visualVariables"in t?n(i,t.visualVariables):i;if("simple"===t.type)return a(r,t.symbol);if("unique-value"===t.type){let e=r;return t.uniqueValueInfos.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=r;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return t.type,r}i.d(t,"a",(function(){return s}))},509:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return E})),i.d(t,"clip",(function(){return o})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return y})),i.d(t,"crosses",(function(){return h})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return z})),i.d(t,"difference",(function(){return _})),i.d(t,"disjoint",(function(){return m})),i.d(t,"distance",(function(){return d})),i.d(t,"equals",(function(){return u})),i.d(t,"extendedSpatialReferenceInfo",(function(){return s})),i.d(t,"flipHorizontal",(function(){return k})),i.d(t,"flipVertical",(function(){return T})),i.d(t,"generalize",(function(){return I})),i.d(t,"geodesicArea",(function(){return F})),i.d(t,"geodesicBuffer",(function(){return D})),i.d(t,"geodesicDensify",(function(){return H})),i.d(t,"geodesicLength",(function(){return U})),i.d(t,"intersect",(function(){return w})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return v})),i.d(t,"nearestCoordinate",(function(){return G})),i.d(t,"nearestVertex",(function(){return A})),i.d(t,"nearestVertices",(function(){return R})),i.d(t,"offset",(function(){return S})),i.d(t,"overlaps",(function(){return f})),i.d(t,"planarArea",(function(){return V})),i.d(t,"planarLength",(function(){return L})),i.d(t,"relate",(function(){return O})),i.d(t,"rotate",(function(){return C})),i.d(t,"simplify",(function(){return j})),i.d(t,"symmetricDifference",(function(){return M})),i.d(t,"touches",(function(){return g})),i.d(t,"union",(function(){return x})),i.d(t,"within",(function(){return b}));var a=i(529),r=i(499);function n(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return a.G.extendedSpatialReferenceInfo(e)}function o(e,t){return a.G.clip(r.hydratedAdapter,n(e),e,t)}function c(e,t){return a.G.cut(r.hydratedAdapter,n(e),e,t)}function l(e,t){return a.G.contains(r.hydratedAdapter,n(e),e,t)}function h(e,t){return a.G.crosses(r.hydratedAdapter,n(e),e,t)}function d(e,t,i){return a.G.distance(r.hydratedAdapter,n(e),e,t,i)}function u(e,t){return a.G.equals(r.hydratedAdapter,n(e),e,t)}function p(e,t){return a.G.intersects(r.hydratedAdapter,n(e),e,t)}function g(e,t){return a.G.touches(r.hydratedAdapter,n(e),e,t)}function b(e,t){return a.G.within(r.hydratedAdapter,n(e),e,t)}function m(e,t){return a.G.disjoint(r.hydratedAdapter,n(e),e,t)}function f(e,t){return a.G.overlaps(r.hydratedAdapter,n(e),e,t)}function O(e,t,i){return a.G.relate(r.hydratedAdapter,n(e),e,t,i)}function v(e){return a.G.isSimple(r.hydratedAdapter,n(e),e)}function j(e){return a.G.simplify(r.hydratedAdapter,n(e),e)}function y(e,t=!1){return a.G.convexHull(r.hydratedAdapter,n(e),e,t)}function _(e,t){return a.G.difference(r.hydratedAdapter,n(e),e,t)}function M(e,t){return a.G.symmetricDifference(r.hydratedAdapter,n(e),e,t)}function w(e,t){return a.G.intersect(r.hydratedAdapter,n(e),e,t)}function x(e,t=null){return a.G.union(r.hydratedAdapter,n(e),e,t)}function S(e,t,i,s,o,c){return a.G.offset(r.hydratedAdapter,n(e),e,t,i,s,o,c)}function E(e,t,i,s=!1){return a.G.buffer(r.hydratedAdapter,n(e),e,t,i,s)}function D(e,t,i,s,o,c){return a.G.geodesicBuffer(r.hydratedAdapter,n(e),e,t,i,s,o,c)}function G(e,t,i=!0){return a.G.nearestCoordinate(r.hydratedAdapter,n(e),e,t,i)}function A(e,t){return a.G.nearestVertex(r.hydratedAdapter,n(e),e,t)}function R(e,t,i,s){return a.G.nearestVertices(r.hydratedAdapter,n(e),e,t,i,s)}function P(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function C(e,t,i){var r;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(i=null!=(r=i)?r:P(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(a.G.rotate(e,t,i));return s.spatialReference=n,s}function k(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const r=e.spatialReference;if(null==(t=null!=(i=t)?i:P(e)))throw new Error("Illegal Argument Exception");const n=e.constructor.fromJSON(a.G.flipHorizontal(e,t));return n.spatialReference=r,n}function T(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const r=e.spatialReference;if(null==(t=null!=(i=t)?i:P(e)))throw new Error("Illegal Argument Exception");const n=e.constructor.fromJSON(a.G.flipVertical(e,t));return n.spatialReference=r,n}function I(e,t,i,s){return a.G.generalize(r.hydratedAdapter,n(e),e,t,i,s)}function z(e,t,i){return a.G.densify(r.hydratedAdapter,n(e),e,t,i)}function H(e,t,i,s=0){return a.G.geodesicDensify(r.hydratedAdapter,n(e),e,t,i,s)}function V(e,t){return a.G.planarArea(r.hydratedAdapter,n(e),e,t)}function L(e,t){return a.G.planarLength(r.hydratedAdapter,n(e),e,t)}function F(e,t,i){return a.G.geodesicArea(r.hydratedAdapter,n(e),e,t,i)}function U(e,t,i){return a.G.geodesicLength(r.hydratedAdapter,n(e),e,t,i)}},539:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));i(95);var a=i(83),r=i(111),n=i(505),s=i(96);function o(e,t,i,n=new s.a){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;o=Object(a.k)(s)&&!s.equals(i.spatialReference)?Object(r.f)(s)/Object(r.f)(i.spatialReference):t*n}const c=e.x-o,l=e.y-o,h=e.x+o,d=e.y+o,{spatialReference:u}=i;return n.xmin=Math.min(c,h),n.ymin=Math.min(l,d),n.xmax=Math.max(c,h),n.ymax=Math.max(l,d),n.spatialReference=u,n}function c(e,t,i){const r=i.toMap(e);return!Object(a.j)(r)&&o(r,Object(n.a)(),i,l).intersects(t)}const l=new s.a},605:function(e,t,i){"use strict";i.d(t,"a",(function(){return A}));i(95);var a=i(184),r=i(122),n=i(107),s=i(83),o=i(100),c=i(130),l=i(276),h=i(281),d=i(140),u=i(150),p=i(131),g=i(101),b=i(99),m=i(173),f=i(158),O=i(121),v=i(318),j=i(298),y=i(254),_=i(206),M=i(474),w=i(570),x=i(686),S=i(635),E=i(401),D=i(506),G=i(105);class A{constructor(e){this.idHint=0,this.camera=new S.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(u.d)(),this._worldFrame=null,this._renderLocation=Object(b.e)(),this._renderLocationDirty=!0,this._location=new G.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new G.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new r.a.EventEmitter,this._screenLocation={screenPointArray:Object(o.g)(),renderScreenPointArray:Object(o.e)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(c.d)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){R(e)&&(this._screenLocationDirty=!0),Object(d.d)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(u.d)()),function(e,t,i){switch(e.viewingMode){case"local":return Object(d.i)(i),!0;case"global":{const a=Object(f.e)(e.renderCoordsHelper.spatialReference);Object(m.x)(t,0,V,0,a.radius),Object(m.c)(Object(n.g)(V[1]),Object(n.g)(V[0]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(M.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(M.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=Object(s.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,R(this._modelTransform)){const t=this._calculateModelTransformOffset(q);e=Object(g.f)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=Object(o.j)(e,P),r=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(p.j)(this.screenLocation.screenPointArray,i)<r*r)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(t,z),c=r*this.screenLocation.pixelSize,l=Object(x.b)(this.camera,i,k);if(Object(s.j)(l))return null;for(const i of e){if(0===i.length)continue;const e=Object(g.q)(V,i[0],a);for(let t=1;t<i.length;t++){const r=Object(g.q)(L,i[t],a),s=Object(v.b)(Object(v.f)(e,r,C),l);if(null!=s&&s<c*c){const t=Object(g.f)(_.d.get(),e,r);Object(g.e)(t,t,.5);const i=Object(o.a)(_.d.get());return this.camera.projectToRenderScreen(t,i),i[2]+n}Object(g.k)(e,r)}}break}case"disc":{var c;const e=this.collisionType.direction,t=null!=(c=this.collisionType.offset)?c:b.b,a=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(a,z),h=r*this.screenLocation.pixelSize,d=Object(x.b)(this.camera,i,k);if(Object(s.j)(d))return null;const u=Object(l.f)(T,o),p=Object(g.x)(U,e,u),m=Object(g.q)(B,t,o);Object(j.g)(m,p,H);const f=F;if(Object(j.m)(H,d,f)&&Object(g.l)(f,m)<h*h)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,a=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(a,z),h=r*this.camera.computeScreenPixelSizeAt(this.renderLocation),d=Object(x.b)(this.camera,i,k);if(Object(s.j)(d))return null;const u=Object(l.f)(T,c),p=Object(g.x)(U,t,u),b=this._calculateModelTransformPosition(B);Object(j.g)(b,p,H);const m=F;if(!Object(j.m)(H,d,m))break;for(const i of e){if(0===i.length)continue;const e=Object(g.q)(V,i[0],c);for(let t=1;t<i.length;t++){const a=Object(g.q)(L,i[t],c),r=Object(v.e)(Object(v.f)(e,a,C),m);if(null!=r&&r<h*h){const t=Object(g.f)(_.d.get(),e,a);Object(g.e)(t,t,.5);const i=Object(o.a)(_.d.get());return this.camera.projectToRenderScreen(t,i),i[2]+n}Object(g.k)(e,a)}}break}default:Object(a.a)(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(Object(s.j)(i.engineLayerId)){const e=new D.a({isPickable:!1,updatePolicy:1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(s.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(m.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new G.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(m.p)(this.location,W,e.spatialReference),Object(O.h)(e.extent,W)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(s.j)(this.elevationInfo))return!1;let t=null,i=0;const a=Object(s.t)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(s.t)(Object(w.b)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(s.t)(Object(w.b)(this.view.elevationProvider,e,"ground"),0)+a;break;case"relative-to-scene":i=Object(s.t)(Object(w.b)(this.view.elevationProvider,e,"scene"),0)+a;break;case"absolute-height":i=a}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=z;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),a=(this.focused?2:1)|(this.selected?8:4),r=this._noDisplayCount>0;for(const{stateMask:n,objects:s}of i){if(r){for(const e of s)e.setVisible(!1);continue}const e=!(0!=(15&n))||(a&n)==(15&n),i=!(0!=(65520&n))||(this.state&n)==(65520&n);if(e&&i)for(const a of s)a.setVisible(!0),a.transformation=t;else for(const t of s)t.setVisible(!1)}}_ensureEngineResources(){if(Object(s.j)(this._engineResources)){const e=Object(s.s)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));const a=(e,t)=>{const{geometry:i,material:a,transform:r}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,a,r))):e.addGeometry(i,a,r)},r=new Map;this._renderObjects.forEach((e=>{const t=new E.a({castShadow:!1});a(t,e);const i=e.stateMask||0,n=r.get(i)||[];n.push(t),r.set(i,n)}));const n=[];r.forEach(((e,t)=>n.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=Object(s.s)(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:t,layer:i,materials:a}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),a.forEach((e=>{const t=Object(s.s)(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,I);return Object(g.w)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Object(g.j)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(d.h)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(d.m)(t,t,this._worldFrame),Object(d.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(s.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(Object(s.k)(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function R(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const P=Object(o.g)(),C=Object(v.d)(),k=Object(y.c)(),T=Object(h.b)(),I=Object(u.d)(),z=Object(u.d)(),H=Object(j.d)(),V=Object(b.e)(),L=Object(b.e)(),F=Object(b.e)(),U=Object(b.e)(),B=Object(b.e)(),q=Object(b.e)(),W=new G.a({x:0,y:0,z:0,spatialReference:null})},646:function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return S})),i.d(t,"c",(function(){return E})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return M})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return O})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return w}));var a=i(107),r=i(83),n=i(100),s=i(101),o=i(99),c=i(173),l=i(298),h=i(254),d=i(427),u=i(206),p=i(340),g=i(686),b=i(757),m=i(687),f=i(398);function O(e,t){return j(e,(()=>t))}function v(e){return j(e,(e=>e.plane))}function j(e,t){const i=Object(o.e)(),a=Object(o.e)();let s=!1;return o=>{const c=t(o);if("start"===o.action){const t=Object(n.j)(o.screenStart,Object(n.c)(u.c.get())),a=Object(g.b)(e.state.camera,t,A);Object(r.k)(a)&&(s=Object(l.m)(c,a,i))}if(!s)return null;const h=Object(n.j)(o.screenEnd,Object(n.c)(u.c.get())),d=Object(g.b)(e.state.camera,h,A);return Object(r.j)(d)?null:Object(l.m)(c,d,a)?{...o,renderStart:i,renderEnd:a,plane:c,ray:d}:null}}function y(e,t,i,a=null,s=null){return function(e,t,i,a=null,s=null){let o=null;return l=>{if("start"===l.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.g)(l.screenStart.x,l.screenStart.y),t,i,s),Object(r.k)(o)&&Object(r.k)(a)&&!Object(c.p)(o,o,a)))return null;if(Object(r.j)(o))return null;const h=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.g)(l.screenEnd.x,l.screenEnd.y),t,i,s);return Object(r.k)(h)?Object(r.k)(a)&&!Object(c.p)(h,h,a)?null:{...l,mapStart:o,mapEnd:h}:null}}(e,i,Object(p.g)(t,e,i),a,s)}function _(e,t,i,a=null,r=null){return y(e,i,Object(p.e)(t),a,r)}function M(e,t,i,a){const n=t.toMap(e.screenStart,{include:[i]});return Object(r.k)(n)?_(t,i,n,a):null}function w(e,t,i){let r=null;const n=new f.a;return n.next(O(e,function(e,t){const i=D,a=G,r=Object(l.d)();e.renderCoordsHelper.worldUpAtPosition(t,i);const n=Object(s.g)(r,i,Object(s.j)(a,t,e.state.camera.eye));return Object(s.g)(n,n,i),Object(l.g)(t,n,r)}(e,t))).next(function(e,t){const i=Object(o.e)(),r=Object(s.p)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const n=Object(o.e)(),c=Object(o.e)(),l=n=>(Object(s.j)(n,n,t),Object(d.c)(i,n,n),"global"===e.viewingMode&&Object(s.p)(n)*Object(a.t)(Object(s.h)(i,n))<.001-r&&Object(s.j)(n,Object(s.e)(n,i,.001),t),Object(s.f)(n,n,t),n);return e=>(e.renderStart=l(Object(s.k)(n,e.renderStart)),e.renderEnd=l(Object(s.k)(c,e.renderEnd)),e)}(e,t)).next(x(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e})),e=>(r=null,n.execute(e),r)}function x(e,t){const i=e.renderCoordsHelper;return e=>{const a=i.fromRenderCoords(e.renderStart,t),n=i.fromRenderCoords(e.renderEnd,t);return Object(r.k)(a)&&Object(r.k)(n)?{...e,mapStart:a,mapEnd:n}:null}}function S(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":Object(r.k)(t)&&(t.remove(),t=null)}return i}}function E(e,t=null){const i=new b.a(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=0,i.options.hud=!1;const a=Object(n.g)(),s={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=Object(o.e)(),l=Object(r.t)(t,e.spatialReference),h=t=>{e.map.ground&&e.map.ground.opacity<1?s.exclude.add(m.b):s.exclude.delete(m.b),e.sceneIntersectionHelper.intersectIntersectorScreen(Object(n.j)(t,a),i,s);const r=i.results.min;let o;if(r.getIntersectionPoint(c))o="TerrainRenderer"===r.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(c))return null;o=0}return{location:e.renderCoordsHelper.fromRenderCoords(c,l),surfaceType:o}};let d;return e=>{if("start"===e.action){const t=h(e.screenStart);d=Object(r.k)(t)?t.location:null}if(Object(r.j)(d))return null;const t=h(e.screenEnd);return Object(r.k)(t)&&Object(r.k)(t.location)?{...e,mapStart:d,mapEnd:t.location,surfaceType:t.surfaceType}:null}}const D=Object(o.e)(),G=Object(o.e)(),A=Object(h.c)()},659:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return j}));var a=i(83),r=i(140),n=i(101),s=i(181),o=i(206),c=i(474),l=i(605),h=i(412),d=i(349),u=i(561),p=i(856);function g(e,t=4,i=!0){const a=Object(s.g)(e[0],e[1],e[2],e.length>3?e[3]:1),r=e[3]<1;return i?new p.a({color:a,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t}):new u.a({color:a,transparent:r,writeDepth:!0,cullFace:2,renderOccluded:t})}function b(e,t=4){const i=Object(s.g)(e[0],e[1],e[2],4===e.length?e[3]:1);return new u.a({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function m(e,t,i){return new l.a({view:e,renderObjects:[{geometry:d.a.createSphereGeometry(1,32,32),material:g(Object(s.g)(t[0],t[1],t[2],null!=i?i:1))}]})}function f(e,t,i,a){const s=Object(n.j)(o.d.get(),e,i),c=O(s,Object(n.g)(o.d.get(),a,s),i,o.a.get());Object(r.a)(c,c);const l=Object(n.q)(o.d.get(),t,c);return Math.atan2(l[1],l[0])}function O(e,t,i,a){const r=Object(n.r)(o.d.get(),e),s=Object(n.r)(o.d.get(),t),c=Object(n.g)(o.d.get(),r,s);return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=c[0],a[9]=c[1],a[10]=c[2],a[11]=0,a[12]=i[0],a[13]=i[1],a[14]=i[2],a[15]=1,a}function v(e,t){const i=e.getViewForGraphic(t);return Object(a.k)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function j(e,t,i){const r=v(e,i);Object(a.k)(r)?t.elevationAlignedLocation=r:function(e,t){if(Object(a.j)(t))return;const i="mesh"===t.type?t.anchor:Object(h.a)(t);Object(a.j)(i)||(e.location=Object(c.b)(i))}(t,i.geometry)}},660:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var a=i(79),r=i(91),n=i(122),s=i(83),o=i(100),c=i(81),l=(i(77),i(82),i(78),i(80)),h=i(131),d=i(101),u=i(99),p=i(173),g=i(340),b=i(248),m=i(374),f=i(539);let O=class extends r.a{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new n.a.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(g.f)(this.graphic),i=e?e.offset:0;return new m.a({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(Object(s.j)(i))return null;const a=this._get("focusedSymbol"),r=Object(s.k)(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,r):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(s.k)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(s.k)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(e=>{Object(s.k)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(s.k)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){Object(s.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(s.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||Object(b.h)(i),Object(s.j)(a))return null;let r=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return Object(f.b)(t,i,e)?1:null;if(Object(s.j)(r)||!r.originalPoint.equals(i)){const t=i,n=e.spatialReference;if(Object(p.b)(t.spatialReference,n)){const e=Object(p.k)(t,n);r={originalPoint:t.clone(),mapPoint:e,radiusPx:Object(o.h)(a.size)},this._circleCollisionCache=r}}if(Object(s.k)(r)){const i=Object(o.j)(t,j),n=e.toScreen(r.mapPoint),s=r.radiusPx,c=n.x+Object(o.h)(a.xoffset),l=n.y-Object(o.h)(a.yoffset);return Object(h.j)(i,[c,l])<s*s?1:null}return null}_intersectDistance3D(e,t,i){const a=e.toMap(t,{include:[i]});return a&&Object(p.q)(a,v,e.renderSpatialReference)?Object(d.m)(v,e.state.camera.eye):null}};Object(a.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],O.prototype,"graphic",null),Object(a.a)([Object(c.b)({readOnly:!0})],O.prototype,"elevationInfo",null),Object(a.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],O.prototype,"view",void 0),Object(a.a)([Object(c.b)({value:null})],O.prototype,"focusedSymbol",null),Object(a.a)([Object(c.b)({constructOnly:!0})],O.prototype,"layer",void 0),Object(a.a)([Object(c.b)()],O.prototype,"interactive",void 0),Object(a.a)([Object(c.b)()],O.prototype,"selectable",void 0),Object(a.a)([Object(c.b)()],O.prototype,"grabbable",void 0),Object(a.a)([Object(c.b)({value:!1})],O.prototype,"grabbing",null),Object(a.a)([Object(c.b)()],O.prototype,"dragging",void 0),Object(a.a)([Object(c.b)()],O.prototype,"hovering",null),Object(a.a)([Object(c.b)({value:!1})],O.prototype,"selected",null),Object(a.a)([Object(c.b)()],O.prototype,"cursor",void 0),O=Object(a.a)([Object(l.a)("esri.views.interactive.GraphicManipulator")],O);const v=Object(u.e)(),j=Object(o.g)()},664:function(e,t,i){"use strict";function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return a}))},686:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l}));var a=i(83),r=i(100),n=i(131),s=i(101),o=i(254),c=i(206);function l(e,t,i=Object(o.c)()){return h(e,e.screenToRender(t,Object(r.b)(c.d.get())),i)}function h(e,t,i=Object(o.c)()){const l=Object(r.b)(Object(n.c)(c.d.get(),t));if(l[2]=0,!e.unprojectFromRenderScreen(l,i.origin))return null;const h=Object(r.b)(Object(n.c)(c.d.get(),t));h[2]=1;const d=e.unprojectFromRenderScreen(h,c.d.get());return Object(a.j)(d)?null:(Object(s.j)(i.direction,d,i.origin),i)}},722:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));var a=i(110);function r(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(a.a`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function n(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},795:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return u}));var a=i(722),r=i(235),n=i(384),s=i(278),o=i(257),c=i(326),l=i(335),h=i(110),d=i(246);function u(e){const t=new d.a;return t.include(n.a,{linearDepth:!1}),t.include(a.a,{}),t.include(r.a,e),t.fragment.include(l.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(h.a`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(h.a`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),t.vertex.code.add(h.a`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(o.b,e)),t.fragment.code.add(h.a`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(h.a`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):t.fragment.code.add(h.a`vec4 finalColor = color;`),t.fragment.code.add(h.a`
      if (finalColor.a < ${h.a.float(c.c)}) {
        discard;
      }
      ${7===e.output?h.a`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?h.a`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}var p=Object.freeze({__proto__:null,build:u})},830:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return c}));var a=i(107),r=i(494),n=i(357),s=i(101);function o(e=p){return[e[0],e[1],e[2],e[3]]}function c(e,t,i=o()){return Object(s.k)(i,e),i[3]=t,i}function l(e,t,i=o()){return Object(r.h)(g,e,u(e)),Object(r.h)(b,t,u(t)),Object(r.f)(g,b,g),function(e,t){return e[3]=t,e}(i,Object(a.r)(Object(r.b)(i,g)))}function h(e){return e}function d(e){return e[3]}function u(e){return Object(a.g)(e[3])}const p=[0,0,1,0],g=Object(n.b)(),b=Object(n.b)();o()},856:function(e,t,i){"use strict";i.d(t,"a",(function(){return A}));var a=i(101),r=i(99),n=i(234),s=i(336),o=i(342),c=i(371),l=i(343),h=i(176),d=i(485),u=i(310),p=i(79),g=i(181),b=i(722),m=i(235),f=i(257),O=i(364),v=i(292),j=i(299),y=i(303),_=i(331),M=i(293),w=i(795),x=i(277);class S extends j.a{initializeProgram(e){const t=S.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new M.a(e.rctx,a,D)}bindPass(e,t){const{screenSizeEnabled:i,shadingEnabled:a}=this.configuration,{color:r,shadingTint:n,shadingDirection:s}=e;Object(O.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",r),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(f.a)(this.program,t)),a&&(this.program.setUniform4fv("shadedColor",this.blendColor(G,n,r)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(b.b)(this.program,e,t)}bindDraw(e){Object(O.d)(this.program,e),Object(O.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(m.c)(this.program,this.configuration,e),this.program.rebindTextures()}blendColor(e,t,i){const a=1-t[3],r=t[3]+i[3]*a;return 0===r?(e[3]=r,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*a)/r,e[1]=(t[1]*t[3]+i[1]*i[3]*a)/r,e[2]=(t[2]*t[3]+i[2]*i[3]*a)/r,e[3]=i[3],e)}setPipelineState(e){const t=this.configuration,i=3===e,a=2===e;return Object(x.f)({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?_.f:Object(_.a)(e),culling:Object(x.b)(t.cullFace),depthTest:{func:a?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&x.d:Object(_.c)(e),colorWrite:x.c,polygonOffset:i||a?null:_.d})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}S.shader=new v.a(w.a,(()=>i.e(312).then(i.bind(null,1285))));class E extends y.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(p.a)([Object(y.b)({count:8})],E.prototype,"output",void 0),Object(p.a)([Object(y.b)({count:3})],E.prototype,"cullFace",void 0),Object(p.a)([Object(y.b)()],E.prototype,"slicePlaneEnabled",void 0),Object(p.a)([Object(y.b)()],E.prototype,"transparent",void 0),Object(p.a)([Object(y.b)()],E.prototype,"writeDepth",void 0),Object(p.a)([Object(y.b)()],E.prototype,"screenSizeEnabled",void 0),Object(p.a)([Object(y.b)()],E.prototype,"shadingEnabled",void 0),Object(p.a)([Object(y.b)({count:4})],E.prototype,"transparencyPassType",void 0),Object(p.a)([Object(y.b)()],E.prototype,"multipassTerrainEnabled",void 0),Object(p.a)([Object(y.b)()],E.prototype,"cullAboveGround",void 0);const D=new Map([["position",0],["normal",1],["offset",2]]),G=Object(g.e)();class A extends l.a{constructor(e){super(e,P),this.supportsEdges=!0,this.techniqueConfig=new E,this._vertexAttributeLocations=D}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,r,s,o,c){if(this.params.screenSizeEnabled){const i=e.vertexAttributes.get("offset"),l={applyToVertex:(e,t,n,s)=>{const o=Object(a.w)(k,i.data[3*s+0],i.data[3*s+1],i.data[3*s+2]),c=Object(a.w)(T,e,t,n);return Object(a.e)(o,o,this.params.screenSize*r.camera.computeRenderPixelSizeAt(o)),Object(a.f)(c,c,o),[c[0],c[1],c[2]]},applyToAabb:e=>{const t=Object(n.d)(e,k);return Object(n.v)(e,this.params.screenSize*r.camera.computeRenderPixelSizeAt(t))}};Object(u.f)(e,t,r,s,o,l,c)}else Object(u.f)(e,t,r,s,o,void 0,c)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new R(e):void 0}createBufferWriter(){return new C(this.params.screenSizeEnabled)}}class R extends c.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(S,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(4===this._output)return 3===e;let t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const P={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(a.r)(Object(r.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...l.b};class C{constructor(e){this.screenSizeEnabled=e;const t=Object(o.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,a){if(Object(d.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const r=t.vertexAttributes.get("offset"),n=t.indices.get("offset");Object(h.a)(3===r.size);const o=i.getField("offset",s.u);if(!o)throw new Error("unable to acquire view for offset");Object(d.e)(n,r.data,e.invTranspTransformation,o,a)}}}}const k=Object(r.e)(),T=Object(r.e)()},899:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var a=i(83),r=i(140),n=i(150),s=i(101),o=i(99),c=i(189),l=i(420),h=i(472),d=i(751),u=i(432);class p extends h.a{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=Object(l.c)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromExtent(e){const t=this.view.spatialReference,i=Object(o.e)(),a=Object(o.e)(),r=100,n=[];Object(s.w)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,a),n.push([a[0],a[1],a[2]]),Object(s.w)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,a),n.push([a[0],a[1],a[2]]),Object(s.w)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,a),n.push([a[0],a[1],a[2]]),Object(s.w)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,a),n.push([a[0],a[1],a[2]]),Object(s.w)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,a),n.push([a[0],a[1],a[2]]),Object(s.w)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,a),n.push([a[0],a[1],a[2]]),this.geometry=[n]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,a=e.basis1,r=e.basis2,n=.5,s=Object(o.e)(),c=Object(o.e)(),l=Object(o.e)(),h=Object(o.e)();s[0]=i[0]-a[0]*n-r[0]*n,s[1]=i[1]-a[1]*n-r[1]*n,s[2]=i[2]-a[2]*n-r[2]*n,c[0]=i[0]-a[0]*n+r[0]*n,c[1]=i[1]-a[1]*n+r[1]*n,c[2]=i[2]-a[2]*n+r[2]*n,l[0]=i[0]+a[0]*n+r[0]*n,l[1]=i[1]+a[1]*n+r[1]*n,l[2]=i[2]+a[2]*n+r[2]*n,h[0]=i[0]+a[0]*n-r[0]*n,h[1]=i[1]+a[1]*n-r[1]*n,h[2]=i[2]+a[2]*n-r[2]*n,t.push([s[0],s[1],s[2]]),t.push([c[0],c[1],c[2]]),t.push([l[0],l[1],l[2]]),t.push([h[0],h[1],h[2]]),t.push([s[0],s[1],s[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;Object(r.i)(g),Object(r.t)(g,g,t),this.transform=g;const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=o.b){Object(r.i)(g),Object(r.t)(g,g,t),this.transform=g,this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(c.g)(e,this._color)||(Object(c.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(a.k)(e)?!Object(a.j)(this._innerColor)&&Object(c.g)(e,this._innerColor)||(this._innerColor=Object(c.c)(Object(l.b)(),e),this._updateMaterial()):Object(a.k)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a.k)(e)!==Object(a.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(a.j)(e)||Object(a.j)(this._stippleOffColor)||!Object(c.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(a.k)(e)?Object(l.a)(e):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new u.a(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const a=Object(d.a)(t[i]);e.addGeometry(a,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameterValues(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if(Object(a.j)(e)||0===e.length)return[];const t=[];return e.forEach((e=>{const i=e.length,a=new Float64Array(3*i);e.forEach(((e,t)=>{a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e[2]}));const r={attributeData:{position:a},removeDuplicateStartEnd:0};t.push(r)})),t}}const g=Object(n.d)()},990:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var a=i(83),r=i(664),n=i(94),s=i(497),o=i(223),c=i(231),l=i(81);function h(e){return d[function(e){return e instanceof Blob?e.type:function(e){const t=Object(n.n)(e);return g[t]||u}(e.url)}(e)]||p}const d={},u="text/plain",p=d[u],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const j in g)d[g[j]]=j;var b=i(268);function m(e){const t=Object(a.k)(e)&&e.origins?e.origins:[void 0];return(i,s)=>{const d=function(e,t,i){if(Object(a.k)(e)&&"resource"===e.type)return function(e,t,i){const s=Object(o.b)(t,i);return{type:String,read:(e,t,i)=>{const a=Object(b.d)(e,t,i);return s.type===String?a:"function"==typeof s.type?new s.type({url:a}):void 0},write:{writer(t,o,l,d){if(!d||!d.resources)return"string"==typeof t?void(o[l]=Object(b.e)(t,d)):void(o[l]=t.write({},d));const u=function(e){return Object(a.j)(e)?null:"string"==typeof e?e:e.url}(t),p=u?Object(b.e)(u,{...d,verifyItemRelativeUrls:d&&d.verifyItemRelativeUrls?{writtenUrls:d.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,g=s.type!==String&&(!Object(r.a)(this)||d&&d.origin&&this.originIdOf(i)>Object(c.d)(d.origin));d&&d.portalItem&&Object(a.k)(p)&&!Object(n.s)(p)?g?function(e,t,i,a,r,s,o,c){const l=o.portalItem.resourceFromPath(a),d=v(i,a,o);h(d)===Object(n.n)(l.path)?(O(e,t,l,d,o.resources.toUpdate),r[s]=a):f(e,t,i,a,r,s,o,c)}(this,i,t,p,o,l,d,e):function(e,t,i,a){a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(e)}),t[i]=e}(p,o,l,d):d&&d.portalItem&&(Object(a.j)(p)||Object(a.k)(Object(b.b)(p))||Object(n.t)(p)||g)?f(this,i,t,p,o,l,d,e):o[l]=p}}}}(e,t,i);switch(Object(a.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=b.c;return{read:e,write:t}}}}(e,i,s);for(const e of t){const t=Object(l.c)(i,e,s);for(const e in d)t[e]=d[e]}}}function f(e,t,r,o,c,l,d,u){const p=Object(s.a)(),g=v(r,o,d),b=Object(n.z)(Object(a.i)(u,"prefix"),p),m=`${b}.${h(g)}`,f=d.portalItem.resourceFromPath(m);Object(n.t)(o)&&d.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(null,98))).default,{data:a}=await t(e,{responseType:"blob"});return a}(o).then((e=>{f.path=`${b}.${h(e)}`,c[l]=f.itemRelativeUrl})).catch((()=>{}))),O(e,t,f,g,d.resources.toAdd),c[l]=f.itemRelativeUrl}function O(e,t,i,a,r){r.push({resource:i,content:a,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function v(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}}}]);
//# sourceMappingURL=15.3747f6b4.chunk.js.map