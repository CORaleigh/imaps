(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[15,198,276],{1083:function(e,t,i){"use strict";i.r(t),i.d(t,"createCircle",(function(){return w})),i.d(t,"createEllipse",(function(){return M})),i.d(t,"createMultipoint",(function(){return f})),i.d(t,"createPoint",(function(){return m})),i.d(t,"createPolygon",(function(){return j})),i.d(t,"createPolyline",(function(){return O})),i.d(t,"createRectangle",(function(){return _})),i.d(t,"createSquare",(function(){return y})),i.d(t,"makeMapPoint",(function(){return v}));var a=i(92),r=i(89),n=i(209),s=i(112),o=i(113),c=i(225),l=i(276),h=i(130),u=i(141),d=(i(101),i(117)),p=i(826),b=i(502),g=i(665);function v(e,t,i=null){return Object(r.k)(i)?[e,t,i]:[e,t]}function m(e,t){var i=new o.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function f(e,t){return new c.a({points:e,spatialReference:t})}function O(e,t,i){var a=new u.a({paths:e,spatialReference:t});return i&&Object(l.i)(a),a}function j(e,t,i,r=!0){var o=Object(a.a)(e);o.forEach((e=>{var t=e[0],i=e[e.length-1];Object(n.c)(t,i)&&1!==e.length||e.push(e[0])}));var c=new h.a({rings:o,spatialReference:t});return c.rings.forEach((e=>{Object(l.g)(e,!1,!1)||e.reverse()})),i&&Object(l.i)(c),r&&c.isSelfIntersecting&&Object(s.i)(t)&&(c=Object(b.simplify)(c)),c}function y(e,t,i){var a=t.mapToLocalMultiple(e),n=[],s={x:a[0].x,y:a[0].y},o=a[1].x,c=a[1].y,l=Math.round(o-s.x),h=Math.round(c-s.y),u=Math.max(Math.abs(l),Math.abs(h));if(i){var d={x:s.x+u,y:s.y+u},p={x:s.x-u,y:s.y-u};n.push(Object(g.b)(d.x,p.y),Object(g.b)(p.x,p.y),Object(g.b)(p.x,d.y),Object(g.b)(d.x,d.y))}else{var b={x:l>0?s.x+u:s.x-u,y:h>0?s.y+u:s.y-u};n.push(Object(g.b)(s.x,s.y),Object(g.b)(b.x,s.y),Object(g.b)(b.x,b.y),Object(g.b)(s.x,b.y))}return j([Object(r.g)(n.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function _(e,t,i){var a=t.mapToLocalMultiple(e);if(1===a.length){var n=48,s=a[0];a=[Object(g.b)(s.x-n,s.y+n),Object(g.b)(s.x+n,s.y-n),Object(g.b)(s.x+n,s.y-n),Object(g.b)(s.x-n,s.y+n)]}var o=[],c={x:a[0].x,y:a[0].y},l={x:a[1].x,y:a[1].y};if(i){var h=Math.round(l.x-c.x),u=Math.round(l.y-c.y);o.push(Object(g.b)(c.x-h,c.y-u),Object(g.b)(l.x,c.y-u),Object(g.b)(l.x,l.y),Object(g.b)(c.x-h,l.y))}else o.push(Object(g.b)(c.x,c.y),Object(g.b)(l.x,c.y),Object(g.b)(l.x,l.y),Object(g.b)(c.x,l.y));return j([Object(r.g)(o.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function w(e,t,i,a){var n=t.mapToLocalMultiple(e),o=null,c=null;if(i)o=n[0],c=n[1];else{var h=n[0],u=n[1],v=Math.round(u.x-h.x),f=Math.round(u.y-h.y),O=Math.max(Math.abs(v),Math.abs(f));o=Object(g.b)(v>0?h.x+O/2:h.x-O/2,f>0?h.y+O/2:h.y-O/2),c=Object(g.b)(Math.abs(v)>Math.abs(f)?o.x-O/2:o.x,Math.abs(v)>Math.abs(f)?o.y:o.y-O/2)}var y=t.localToMap(o),_=t.localToMap(c);if(Object(r.j)(y)||Object(r.j)(_))return null;t.doUnnormalization&&Object(l.j)([[y,_]],t.spatialReference);var w=m(y,t.spatialReference),M=m(_,t.spatialReference),x=Object(d.f)(t.spatialReference),S=0;if(Object(s.i)(t.spatialReference))S=x*Object(b.distance)(w,M,null);else{var P=o.x-c.x,E=o.y-c.y;S=x*Math.sqrt(P*P+E*E)*(a||1)}var A=new p.a({center:w,radius:S,radiusUnit:"meters",spatialReference:t.spatialReference});return j(A.rings,A.spatialReference,!1)}function M(e,t,i){for(var a=t.mapToLocalMultiple(e),n=a[0],s=a[1],o=Math.round(s.x-n.x),c=Math.round(s.y-n.y),l=Object(g.b)(i?n.x:n.x+o/2,i?n.y:n.y+c/2),h=i?o:o/2,u=i?c:c/2,d=[],p=2*Math.PI/60,b=0;b<60;b++){var v=Math.cos(b*p),m=Math.sin(b*p),f=Object(g.b)(h*v+l.x,u*m+l.y);d.push(f)}return d.push(d[0]),j([Object(r.g)(d.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}},1221:function(e,t,i){"use strict";i.r(t),i.d(t,"DrawOperation",(function(){return a.a})),i.d(t,"DrawGraphicTool",(function(){return Me})),i.d(t,"GraphicMoveTool",(function(){return Pt})),i.d(t,"GraphicReshapeTool",(function(){return Lt})),i.d(t,"GraphicTransformTool",(function(){return Jt})),i.d(t,"ExtentTransformTool",(function(){return Ua}));var a=i(672),r=i(91),n=i(82),s=i(80),o=i(89),c=i(81),l=i(88),h=i(85),u=i(84),d=(i(83),i(86),i(87),i(131)),p=i(123),b=i(108),g=i(167),v=i(514),m=i(340),f=i(720),O=i(532),j=i(665),y=i(109),_=i(466),w=i(200),M=i(786),x={main:new y.a([255,127,0]),selected:new y.a([255,255,255]),staged:new y.a([12,207,255]),outline:new y.a([0,0,0,.5]),selectedOutline:new y.a([255,255,255])},S=.3;function P(e,t){var i=e.clone();return i.a*=t,i}function E(e,t){var i=e.clone(),a=Object(_.b)(i);a.s*=t;var r=Object(_.e)(a);return i.r=r.r,i.g=r.g,i.b=r.b,i}function A(e,t){if(t)for(var i in t)e[i]=t[i]}class D{constructor(e){this.color=x.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,A(this,e)}}class R{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=x.main,this.outlineColor=x.outline,this.renderOccluded=16,this.hoverOutlineColor=x.selectedOutline,A(this,e)}apply(e,t){var i=this[e];t.setParameterValues({color:F(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class T{constructor(e){this.vertex=new R({color:x.main,outlineColor:x.outline}),this.edge=new R({color:E(P(x.main,2/3),.5),outlineColor:P(x.outline,.5),size:8,collisionPadding:8}),this.selected=new R({color:x.selected,outlineColor:x.outline}),A(this,e)}}class C{constructor(e){this.color=x.selected,this.width=1.5,this.stipplePattern=Object(M.b)([5,5]),this.stippleOffColor=x.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=x.selected,this.renderOccluded=4,A(this,e)}apply(e){e.color=F(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=F(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=F(this.innerColor),e.renderOccluded=this.renderOccluded}}class G{constructor(e){this.color=x.selected,this.size=4,this.outlineSize=1,this.outlineColor=x.outline,this.shape="square",A(this,e)}apply(e){e.color=F(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=F(this.outlineColor),e.primitive=this.shape}}class k{constructor(e){this.innerColor=x.selected,this.innerWidth=1,this.glowColor=x.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=S,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=x.main,A(this,e)}apply(e,t=1){var i={glowColor:y.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:y.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class I{constructor(e){this.outline=new C({color:x.outline,renderOccluded:8,stippleOffColor:x.selected,stipplePattern:Object(M.b)([5,5]),width:1.5,innerWidth:0}),this.staged=new C({color:x.selected,renderOccluded:8,innerColor:x.staged,stippleOffColor:x.outline,stipplePattern:Object(M.b)([5,5]),width:1.5}),this.shadowStyle=new k({globalAlpha:S,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:1}),A(this,e)}}class V{constructor(e){this.outline=new G({color:x.selected,outlineColor:x.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new k({globalAlpha:S,glowColor:x.main,glowFalloff:1.5,glowWidth:6,innerColor:x.selected,innerWidth:1,radius:2}),A(this,e)}}class z extends C{constructor(e){super(),this.extensionType=2,A(this,e)}}class L{constructor(e){this.lineGraphics=new I,this.pointGraphics=new V,this.heightPlane=new k({globalAlpha:S,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:1}),this.heightBox=new k({globalAlpha:S,glowColor:x.main,glowFalloff:8,glowWidth:8,innerColor:x.selected,innerWidth:0,heightFillColor:x.main}),this.zVerticalLine=new z({color:P(x.main,.5),falloff:2,innerColor:P(x.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,A(this,e)}}function F(e){return Object(w.g)(y.a.toUnitRGBA(e))}var q=new class{constructor(e){this.visualElements=new L,this.reshapeManipulators=new T,this.zManipulator=new D,A(this,e)}colorToVec4(e){return F(e)}},H=i(104),U=i(111),B=i(223),N=i(191),W=i(279),Z=i(373),Y=i(327),X=i(378),Q=i(654),J=i(471),K=i(330),$=i(157),ee=i(174),te=i(600),ie=i(357);class ae{constructor(e,t,i=null,a=null,r,n,s,o,c){this.data=e,this.material=t,this.layerUid=i,this.graphicUid=a,this.boundingSphere=Object(w.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=r,this.material=t,this.origin=null,this.transformation=null,this.calculateShaderTransformation=s,n&&this.updateTransformation(n,o),this.castShadow=c}updateTransformation(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}shaderTransformationChanged(){this.shaderTransformationDirty=!0}computeBoundingSphere(e,t,i){Object(o.j)(this.boundingInfo)||(t=t||Object(K.f)(e),Object(U.l)(i,this.boundingInfo.getCenter(),e),i[3]=this.boundingInfo.getBSRadius()*t)}get hasShaderTransformation(){return Object(o.k)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(o.j)(this.calculateShaderTransformation)?Object(o.r)(this.transformation,ee.a):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=Object(ee.b)()),Object($.c)(this.shaderTransformation,this.calculateShaderTransformation(Object(o.r)(this.transformation,ee.a))),this.shaderTransformationDirty=!1),this.shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(o.k)(this.transformation)&&Object(U.l)(e,e,this.transformation),!0);var t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!Object(X.c)(i,t,e)&&(Object(o.k)(this.transformation)&&Object(U.l)(e,e,this.transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){var e=new te.a(0),t=this.instanceParameters;return t.highlights=Object(ie.b)(t.highlights,e),e}removeHighlight(e){var t=this.instanceParameters;t.highlights=Object(ie.f)(t.highlights,e)}}var re=i(920),ne=i(606),se=i(719),oe=i(97),ce=i(266);class le{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(o.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(o.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(o.j)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new he({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(!Object(o.j)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!Object(o.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){Object(o.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}var he=class extends(Object(ce.a)(oe.a)){constructor(e){super(e),this.drapeSourceType=1}};Object(n.a)([Object(h.b)({constructOnly:!0})],he.prototype,"view",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],he.prototype,"drapeSourceType",void 0),he=Object(n.a)([Object(u.a)("DrapedVisualElementLayerView")],he);class ue{constructor(e){this.view=null,this._attachmentOrigin=Object(Y.d)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new d.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(Z.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(Z.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new se.a({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new le({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});var t=!0;for(var i in this._laserline=new ne.a({view:e.view}),e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(o.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(N.g)(e,this._color)||(Object(N.c)(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(N.g)(e,this._innerColor)||(Object(N.c)(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){var t=Object(o.k)(e)!==Object(o.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(N.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(Z.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(o.k)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=Object(o.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(U.v)(be,0,0,0);var t=0;for(var i of e){var a=i.vertexAttributes.get("position"),r=i.indices.get("position"),n=Object(o.q)(this.resources.resources).material.isClosed(a.data,r);Object(X.a)(a,r,n,pe)&&(Object(U.e)(be,be,pe),t++)}return 0===t?null:(Object(U.d)(be,be,1/t),this.view.renderCoordsHelper.fromRenderCoords(be,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){Object(o.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(o.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return Object(o.k)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){var a=this.createRenderGeometries();for(var r of a)e.addGeometry(r,t),i.push(r);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){var t=new J.a(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){var e=new J.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){var t=this.geometry;if(Object(o.j)(t))return[];var i=Object(re.c)(t,this.view.basemapTerrain.spatialReference),a=[];for(var{position:r}of i.lines){var n={attributeData:{position:r},removeDuplicateStartEnd:this.isClosed?1:0},s=new ae(Object(re.a)(n),e),c=Object(W.e)(de);Object(W.h)(c,r),Object(N.l)(s.boundingSphere,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0,.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1]))),a.push(s)}return a}calculateMapBounds(e){if(Object(o.j)(this.resources.resources))return!1;var t=this.view.renderCoordsHelper;for(var i of this.resources.resources.geometries){var a=i.vertexAttributes.get("position"),r=new Float64Array(a.data.length);Object(B.k)(a.data,t.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),Object(W.h)(e,r)}return!0}createRenderGeometries(){var e=this.geometry;if(Object(o.j)(e))return[];var t=Object(re.b)(e,this.view.elevationProvider,this.view.renderCoordsHelper,Q.a.fromElevationInfo(this.elevationInfo)),i=[],a=[];for(var{position:r,mapPosition:n}of t.lines){var s={attributeData:{position:r,mapPosition:n},removeDuplicateStartEnd:this.isClosed?1:0};i.push(Object(re.a)(s)),a.push(r)}return this._laserline.pathVerticalPlane=a,i}}var de=Object(W.d)(),pe=Object(H.e)(),be=Object(H.e)(),ge=i(370),ve=(i(276),i(453),i(584),i(601));Object(H.e)();var me=i(468),fe=i(802);class Oe extends me.a{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=q.colorToVec4(q.reshapeManipulators.vertex.color),this._size=q.reshapeManipulators.vertex.size,this._outlineColor=q.colorToVec4(q.reshapeManipulators.vertex.outlineColor),this._outlineSize=q.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(N.g)(e,this._color)||(Object(N.c)(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(N.g)(e,this._outlineColor)||(Object(N.c)(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){var e=this.vertices;if(Object(o.j)(e)||0===e.length)return[];for(var t=function(e,t,i,a,r){var n=new Float64Array(3*e.length),s=new Float64Array(n.length);e.forEach(((e,t)=>{n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e.length>2?e[2]:0}));var o=Object(ve.b)(n,t,0,s,0,n,0,n.length/3,i,a,r),c=null!=o;return{numVertices:e.length,position:n,mapPosition:s,projectionSuccess:c,sampledElevation:o}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Q.a.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,r=t.position,n=0;n<a;++n){var s=Object(U.v)(je,r[3*n+0],r[3*n+1],r[3*n+2]),c=ye(.5,s),l=ye(.5,s);i.push({vertexGeometry:c,vertexOutlineGeometry:l})}return i}createGeometries(e){var t=this.createRenderGeometries();for(var{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new fe.a(Object(r.a)(Object(r.a)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new fe.a(Object(r.a)(Object(r.a)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}var je=Object(H.e)();function ye(e,t){return ge.a.createSphereGeometry(e,16,16,{offset:t})}var _e=class extends d.a.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(n.a)([Object(h.b)({constructOnly:!0})],_e.prototype,"graphic",void 0),Object(n.a)([Object(h.b)()],_e.prototype,"tracking",void 0),Object(n.a)([Object(h.b)()],_e.prototype,"displaying",void 0),Object(n.a)([Object(h.b)()],_e.prototype,"isDraped",void 0),_e=Object(n.a)([Object(u.a)("esri.views.3d.layers.graphics.GraphicState")],_e);var we=i(1083),Me=class extends(Object(g.b)(d.a.EventedMixin(O.a))){constructor(e){super(e),this.drawOperation=null,this._createGraphic=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._stagedVerticesVisualElement=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=!1,this.snappingManager=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}initialize(){var e=Object(o.r)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new v.a({elevationInfo:e,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new a.a({view:this.view,manipulators:this.manipulators,geometryType:xe(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new f.b(this.view,e,[this._internalGraphicsLayer]),elevationDrawSurface:new f.a(e,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:e,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}_getCreateGeometry(e,t=!1){if(null==this.drawOperation)return null;var i=Object(o.k)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,a=this.drawOperation.vertices;if(0===a.length)return null;var r=this.drawOperation.spatialReference,n=a,s=n.slice(),c=[];Object(o.k)(i)&&(s.splice(i,1),c.push(n[i]));var l={regularVertices:null,stagedVertices:null,full:null,outline:null},h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":l.regularVertices=s,l.stagedVertices=c,l.full=this.drawOperation.coordinateHelper.createPointFromArray(a[0]);break;case"polyline":l.regularVertices=s,l.stagedVertices=c,n.length>0&&(l.full=Object(we.createPolyline)([n],r,h));break;case"polygon":l.regularVertices=s,l.stagedVertices=c,n.length>0&&(l.full=Object(we.createPolygon)([n],r,h,!0));break;case"circle":if(n.length>0){var u=Object(j.a)(this.view,a[0]);if(1===n.length&&t){var d=n[0],p=u.makeMapPoint(d[0]+Se*this.view.resolution,d[1]);l.full=Object(we.createCircle)([d,p],u,!0)}else 2===n.length&&(l.full=this.forceUniformSize?Object(we.createCircle)(a,u,this.centered):Object(we.createEllipse)(a,u,this.centered))}break;case"rectangle":if(n.length>0){var b=Object(j.a)(this.view,a[0]);if(1===n.length&&t){var g=n[0],v=b.makeMapPoint(g[0]+Se*this.view.resolution,g[1]);l.full=Object(we.createSquare)([g,v],b,!0)}else 2===n.length&&(l.full=this.forceUniformSize?Object(we.createSquare)(a,b,this.centered):Object(we.createRectangle)(a,b,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":n.length>1&&(l.outline=Object(we.createPolyline)([n],r,h));break;case"polygon":n.length>1&&(l.outline=Object(we.createPolygon)([n],r,h));break;case"circle":case"rectangle":Object(o.k)(l.full)&&"polygon"===l.full.type&&(l.outline=Object(we.createPolygon)(l.full.rings,r,h))}return l}_destroyAllVisualisations(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}_destroyCreateGraphic(){Object(o.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null),this._createGraphicState=null,this.handles.remove(Pe)}_destroyOutlineVisualElement(){Object(o.k)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}_destroyVerticesVisualElement(){Object(o.k)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}_destroyStagedVerticesVisualElement(){Object(o.k)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}_updateCreateGraphic(e=null){var t=this._getCreateGeometry(e);if(Object(o.j)(t))this._destroyAllVisualisations();else{var i=this._internalGraphicsLayer.elevationInfo;Object(o.k)(t.outline)?Object(o.j)(this._outlineVisualElement)?(this._outlineVisualElement=new ue({view:this.view,geometry:t.outline,elevationInfo:Object(o.q)(i),isDraped:Object(o.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(m.c)(this.hasZ,i),attached:!1}),q.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),q.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=t.outline:this._destroyOutlineVisualElement(),Object(o.k)(t.regularVertices)?Object(o.j)(this._verticesVisualElement)?(this._verticesVisualElement=new Oe({view:this.view,spatialReference:this.view.spatialReference,vertices:t.regularVertices,elevationInfo:Object(o.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:q.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=t.regularVertices:this._destroyVerticesVisualElement(),Object(o.k)(t.stagedVertices)?Object(o.j)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new Oe({view:this.view,spatialReference:this.view.spatialReference,vertices:t.stagedVertices,elevationInfo:Object(o.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:q.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=q.colorToVec4(q.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=t.stagedVertices:this._destroyStagedVerticesVisualElement(),Object(o.k)(t.full)?Object(o.j)(this._createGraphic)?(this._createGraphic=new p.a({geometry:t.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new _e({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(b.a)(this._createGraphicState,"isDraped",(e=>{Object(o.k)(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)}))],Pe),this.notifyChange("createGraphic")):this._createGraphic.geometry=t.full:this._destroyCreateGraphic()}}get createGraphic(){return this._createGraphic}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set centered(e){this._set("centered",e),this._updateCreateGraphic()}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}onCursorUpdate(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}onComplete(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var i=this._getCreateGeometry(null,!0);Object(o.k)(i)&&(t=new p.a({geometry:i.full,symbol:this.createGraphicSymbol}))}this.emit("complete",Object(r.a)({graphic:t},e))}};function xe(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Me.prototype,"view",void 0),Object(n.a)([Object(h.b)()],Me.prototype,"createGraphicSymbol",void 0),Object(n.a)([Object(h.b)()],Me.prototype,"createGraphic",null),Object(n.a)([Object(h.b)({value:!0})],Me.prototype,"enabled",null),Object(n.a)([Object(h.b)({value:!0})],Me.prototype,"centered",null),Object(n.a)([Object(h.b)({value:!0})],Me.prototype,"forceUniformSize",null),Object(n.a)([Object(h.b)({constructOnly:!0})],Me.prototype,"hasZ",void 0),Object(n.a)([Object(h.b)({nonNullable:!0})],Me.prototype,"defaultZ",void 0),Object(n.a)([Object(h.b)({constructOnly:!0})],Me.prototype,"elevationInfo",void 0),Object(n.a)([Object(h.b)()],Me.prototype,"snapToScene",void 0),Object(n.a)([Object(h.b)()],Me.prototype,"snappingManager",void 0),Object(n.a)([Object(h.b)({constructOnly:!0})],Me.prototype,"mode",void 0),Object(n.a)([Object(h.b)({constructOnly:!0})],Me.prototype,"geometryType",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],Me.prototype,"type",void 0),Me=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],Me);var Se=48,Pe="create-graphic",Ee=i(217),Ae=i(107),De=i(115),Re=i(264),Te=i(522),Ce=i(516),Ge=i(397),ke=i(663),Ie=i(673),Ve=i(651),ze=i(898);function Le(e,t=Object(m.d)(e)){return"on-the-ground"!==t.mode&&!(Object(o.j)(e.geometry)||!e.geometry.hasZ)}var Fe=i(110),qe=i(689),He=i(605);class Ue{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof He.a&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(o.j)(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}}))}}function Be(e){var{view:t,graphic:i}=e,a=new _e({graphic:i}),r=function(e,t){var{view:i,graphic:a}=e,r=new ue({view:i,geometry:We(a)?a.geometry:null,elevationInfo:Object(m.d)(a),attached:!1});q.visualElements.lineGraphics.shadowStyle.apply(r);var n=()=>{r.attached=t.displaying};q.visualElements.lineGraphics.outline.apply(r);var s=[t.watch("displaying",n),t.watch("isDraped",(e=>r.isDraped=e)),t.on("changed",(()=>r.geometry=We(a)?a.geometry:null)),Object(Ee.a)(r)];return n(),{visualElement:r,remove:()=>Object(Ee.b)(s).remove()}}(e,a),n=[r,Ne(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>Object(Ee.b)(n).remove()}}function Ne(e,t,i){var{graphic:a,view:r}=e,n=[],s=Object(m.d)(a),c="on-the-ground"===s.mode||!s.offset&&"absolute-height"!==s.mode,l=new Ue,h=new qe.a({view:r,extensionType:q.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});q.visualElements.pointGraphics.shadowStyle.apply(h);var u=Object(Fe.f)(q.visualElements.heightPlaneAngleCutoff),d=new ne.a({view:r,attached:!1,angleCutoff:u});q.visualElements.heightPlane.apply(d);var p=1,b=1,g=()=>{if(l.update(e),!i.displaying||c&&(i.isDraped||!We(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,h.attached=!1,void(d.attached=!1);t.laserlineEnabled=!0;var r=4&l.grabbingState?q.visualElements.laserlineAlphaMultiplier:1;r!==p&&(p=r,q.visualElements.lineGraphics.shadowStyle.apply(t,r),q.visualElements.pointGraphics.shadowStyle.apply(h,r));var n=2&l.grabbingState?q.visualElements.laserlineAlphaMultiplier:1;n!==b&&(b=n,q.visualElements.heightPlane.apply(d,n)),function(e,t){var i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(o.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(o.k)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(h,l),function(e,t,i,a){if(a.numSelected>0){Object(U.v)(Ze,0,0,0);var r=0;e.forEachManipulator(((e,t)=>{1===t&&e.selected&&e instanceof He.a&&(Object(U.e)(Ze,Ze,e.renderLocation),r++)})),r>0?(i.heightManifoldTarget=Object(U.d)(Ze,Ze,1/r),i.attached=!0):i.attached=!1}else{var n=t.attachmentOrigin;Object(o.k)(n)&&e.view.renderCoordsHelper.toRenderCoords(n,Ze)?(i.heightManifoldTarget=Ze,i.attached=!0):i.attached=!1}}(e,t,d,l)};q.visualElements.zVerticalLine.apply(h),n.push(i.on("changed",g),i.watch("displaying",g),t.events.on("attachment-origin-changed",g),Object(Ee.a)(h),Object(Ee.a)(d));var v=[],f=()=>{Object(Ee.b)(v).remove(),v.length=0,e.forEachManipulator((e=>v.push(e.events.on("grab-changed",g)))),e.forEachManipulator((e=>v.push(e.events.on("select-changed",g)))),g()};return f(),n.push(e.onManipulatorsChanged(f),Object(Ee.d)((()=>Object(Ee.b)(v)))),Object(Ee.b)(n)}function We(e){return Object(o.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var Ze=Object(H.e)(),Ye=i(125),Xe=i(724);function Qe(e){var{view:t,graphic:i}=e,a=new _e({graphic:i}),r=[],n=function(e,t,i){var{view:a,graphic:r}=e,n=new Xe.a({view:a,geometry:Je(r)?r.geometry:null,elevationInfo:Object(m.d)(r),attached:!1});return function(e,t,i,a){var r=()=>t.attached=i.displaying;(function(e,t,i,a){var{view:r,graphic:n}=e,s=null,c=()=>{Object(o.k)(s)&&(s.remove(),s=null),i.isDraped&&Je(n)&&(s=function(e,t,i){var a=e.elevationProvider.spatialReference;Object(B.o)(t,Ke,a);var r=Ke[0],n=Ke[1];return e.elevationProvider.on("elevation-change",(e=>{Object(Ye.h)(e.extent,r,n)&&i()}))}(r,n.geometry,(()=>{t.geometry=n.geometry})))},l=()=>{c(),t.geometry=Je(n)?n.geometry:null};a.push(i.on("changed",l),Object(Ee.d)((()=>s))),l()})(e,t,i,a),q.visualElements.pointGraphics.outline.apply(t),a.push(Object(b.a)(i,"displaying",r))}(e,n,t,i),i.push(Object(Ee.a)(n)),n}(e,a,r);return function(e,t,i,a){var{view:r,graphic:n}=e,s=new qe.a({view:r,extensionType:q.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});q.visualElements.zVerticalLine.apply(s);var o=new ne.a({view:r,intersectsLineInfinite:!0,attached:!1});q.visualElements.pointGraphics.shadowStyle.apply(o);var c=Object(Fe.f)(q.visualElements.heightPlaneAngleCutoff),l=new ne.a({view:r,attached:!1,angleCutoff:c});q.visualElements.heightPlane.apply(l);var h=Object(m.d)(e.graphic),u=Q.a.fromElevationInfo(h),d="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,p=new Ue,b=1,g=1,v=()=>{p.update(e);var i=d&&(t.isDraped||!Je(n)||!n.geometry.hasZ),c=!0;if(!i&&Je(n)){var h=n.geometry,v=Object(ve.c)(n.geometry,r.elevationProvider,u,r.renderCoordsHelper);Object(U.v)(Ke,h.x,h.y,v),Object(B.r)(Ke,h.spatialReference,Ke,r.renderCoordsHelper.spatialReference),s.setStartEndFromWorldDownAtLocation(Ke),o.intersectsWorldUpAtLocation=Ke}else c=!1;var m=2&p.grabbingState?q.visualElements.laserlineAlphaMultiplier:1;m!==b&&(b=m,q.visualElements.heightPlane.apply(l,m));var f=Object(W.e)($e);!i&&t.displaying&&a.calculateMapBounds(f)&&Object(B.r)(Object(W.m)(f,Ke),r.spatialReference,Ke,r.renderCoordsHelper.spatialReference)?(l.heightManifoldTarget=Ke,l.attached=!0):l.attached=!1;var O=4&p.grabbingState?q.visualElements.laserlineAlphaMultiplier:1;O!==g&&(g=O,q.visualElements.pointGraphics.shadowStyle.apply(o,O));var j=c&&t.displaying&&!i;o.attached=j,s.attached=j};i.push(t.watch(["displaying","isDraped"],v),t.on("changed",v)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",v))})),i.push(Object(Ee.a)(o)),i.push(Object(Ee.a)(s)),i.push(Object(Ee.a)(l)),v()}(e,a,r,n),r.push(t.trackGraphicState(a)),{visualElement:n,remove(){Object(Ee.b)(r).remove()}}}function Je(e){return Object(o.k)(e.geometry)&&"point"===e.geometry.type}var Ke=Object(H.e)(),$e=Object(W.d)();function et(e){switch(Object(o.q)(e.graphic.geometry).type){case"point":return Qe(e);case"polygon":case"polyline":return Be(e);default:return null}}var tt=[1,.5,0],it=70,at=Math.ceil(it/3*2),rt=160,nt=5*Math.PI/12,st=1*Math.PI/3;function ot(e,t,i){var a=e.graphic,r=(e,i)=>t({action:e,graphic:a,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{var n=t.next((e=>("start"===e.action&&r("start",e),e))).next(Object(Ge.g)(a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e}));return i.next(Object(Ge.i)(a)).next((()=>{r("end",{screenDeltaX:0,screenDeltaY:0})})),n}))}function ct(e){if(Object(o.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}class lt{constructor(){this._available=!0}set location(e){this.forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this.forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this.forEachManipulator3D((t=>t.elevationInfo=e))}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){var t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof He.a&&e(t,i)}))}}var ht=i(177),ut=i(560),dt=i(635);class pt extends lt{constructor(e){super(),this._handles=new De.a,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=it,this._updateAfterDrag=!1,this.events=new d.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map((({manipulator:t})=>e(t,1)))}createGraphicDragPipeline(e,t,i){var a=t.graphic,r=Object(m.d)(a),n=Object(o.q)(a.geometry).spatialReference;return ot(t,i,(t=>this.createDragPipeline(((i,a,r,n,s)=>t(i,e(i,a,r,n,s),r)),r,n,a)))}createDragPipeline(e,t,i,a){return Object(Ee.b)(this._arrowManipulatorInfos.map((({manipulator:n},s)=>Object(Ge.e)(n,((n,o,c,l,h)=>{var u=o.next((e=>Object(r.a)(Object(r.a)({},e),{},{manipulatorType:1}))).next(Object(Ge.f)(this._view,n.elevationAlignedLocation)).next(Object(dt.c)(this._view,n.elevationAlignedLocation,t,i,a)).next(Object(Ge.d)(n.location,this.angle+(s+1)*Math.PI*.5)).next(Object(Ge.c)());e(n,u,c,l,h)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){var a=this._radius/it,r=54*a,n=Math.sqrt(r*r*3/4),s=ge.a.createExtrudedTriangle(n,r/2,r/2,.02);ge.a.transformInPlace(s,Object($.t)(ht.a.get(),Object(U.v)(ht.d.get(),0,-n/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],e.radius=n/3*2*1.2;var o=Object($.i)(ht.a.get());Object($.u)(o,i*Math.PI/2);var c=Object($.i)(ht.a.get());Object($.t)(c,Object(U.v)(ht.d.get(),0,100*a,0)),Object($.l)(t,o,c)}_createManipulators(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){var e=this.angle,t=Object($.i)(ht.a.get());Object($.q)(t,t,e,Object(H.g)(0,0,1));var i=Object($.o)(ht.a.get(),Object(U.v)(ht.d.get(),this.displayScale,this.displayScale,this.displayScale)),a=Object($.i)(ht.a.get());for(var r of(Object($.l)(a,i,t),this._arrowManipulatorInfos)){var n=Object($.l)(ht.a.get(),a,r.transform);r.manipulator.modelTransform=n}}_createArrowManipulator(e){var t=new He.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(H.g)(0,0,1)}}),i={manipulator:t,transform:Object(ee.b)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}createMaterial(e=1){var t=y.a.toUnitRGBA(x.main);return t[3]*=e,new ut.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class bt{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Ge.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(o.k)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(Object(o.k)(i)){var a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}snap(e){var t=Object(o.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(o.k)(t)&&Object(o.k)(this.view)&&(t.z=Object(m.f)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?Object(r.a)({},e):null,this._enabled){var t=this.snap(e.screenEnd);return Object(o.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class gt extends lt{constructor(e){super(),this._handles=new De.a,this._snapToScene=new bt,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=it,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){var a=t.graphic,r=Object(m.d)(a),n=Object(o.q)(a.geometry).spatialReference;return ot(t,i,(t=>this.createDragPipeline(((i,a,r,n,s)=>t(i,e(i,a,r,n,s),r)),r,n,a)))}createDragPipeline(e,t,i,a){var n=this._view;return Object(Ge.e)(this._manipulator,((s,o,c,l,h)=>{var u=o.next(Object(Ge.f)(n,s.elevationAlignedLocation)).next(Object(dt.c)(n,s.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(n,t),this._snapToScene.next).next((e=>Object(r.a)(Object(r.a)({},e),{},{manipulatorType:1}))).next(Object(Ge.c)());e(s,u,c,l,h)}))}_updateManipulatorTransform(){var e=Object($.o)(ht.a.get(),Object(U.v)(ht.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){var e=this._view;this._manipulator=new He.a({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(H.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){var e=ge.a.createCylinderGeometry(.02,1,128,Object(H.g)(0,0,1),Object(H.g)(0,0,0)),t=Object($.o)(Object(ee.b)(),Object(H.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/it*80}_createMaterial(e=1){var t=y.a.toUnitRGBA(x.main);return t[3]*=e,new ut.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class vt extends lt{constructor(e){super(),this._handles=new De.a,this._radius=it,this.events=new d.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){var a=Object(o.q)(t.graphic.geometry).spatialReference;return ot(t,i,(t=>this.createDragPipeline(((i,a,r,n,s)=>t(i,e(i,a,r,n,s),r)),a)))}createDragPipeline(e,t){var i=this._view;return Object(Ge.e)(this._manipulator,((a,n,s,o,c)=>{var l=n.next((e=>Object(r.a)(Object(r.a)({},e),{},{manipulatorType:0}))).next(Object(dt.g)(i,a.renderLocation,t)).next(Object(Ge.c)());e(a,l,s,o,c)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){var e=this._radius/it,t=q.zManipulator.height*e,i=q.zManipulator.coneHeight*e,a=q.zManipulator.coneWidth*e,r=q.zManipulator.width*e,n=[Object(H.g)(0,0,0),Object(H.g)(0,0,t)],s=ge.a.createTubeGeometry(n,r/2,16,!1),o=ge.a.createConeGeometry(i,a/2,16,!1),c=[Object(H.g)(0,0,0),Object(H.g)(0,0,t+i)],l=(e=>{var i=Object(ee.b)();return Object($.s)(i,i,[0,0,t]),Object($.e)(i,i,Math.PI/2),i})(),h=(e,t)=>{var i=Object(_.a)(q.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,q.zManipulator.color.a*e]},u=Object(Ve.c)(h(1,.25),1),d=Object(Ve.c)(h(1,0),1),p=Object(Ve.c)(h(.7,0),q.zManipulator.renderOccluded),b=Object(Ve.c)(h(.85,0),q.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:l,material:u,stateMask:1},{geometry:s,material:u,stateMask:1},{geometry:o,transform:l,material:d,stateMask:2},{geometry:s,material:d,stateMask:2},{geometry:o,transform:l,material:p,stateMask:1},{geometry:s,material:p,stateMask:1},{geometry:o,transform:l,material:b,stateMask:2},{geometry:s,material:b,stateMask:2}],this._manipulator.radius=r/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}createManipulator(){var e=new He.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{var t=this._view.state.camera,i=mt;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);var a=Object(U.z)(t.eye,i),r=t.computeRenderPixelSizeAtDist(a),n=Object(U.i)(ft,i,t.eye);Object(U.q)(n,n);var s=Ot;this._view.renderCoordsHelper.worldUpAtPosition(mt,s);var o=Math.abs(Object(U.g)(n,s)),c=Object(U.f)(ft,n,s),l=Object(U.f)(ft,c,s),h=Object(Fe.d)(o,.01,1),u=1-Math.sqrt(1-h*h)/h/t.fullWidth,d=this._radius/it,p=q.zManipulator.width*d;Object(U.d)(l,Object(U.q)(l,l),(1/u-1)*a+r*p),e[12]-=ft[0],e[13]-=ft[1],e[14]-=ft[2]},this._manipulator=e,this.updateManipulator()}}var mt=Object(H.e)(),ft=Object(H.e)(),Ot=Object(H.e)();class jt extends lt{constructor(e){super(),this._handles=new De.a,this._angleDeferred=null,this._interactive=!0;var{tool:t,view:i,snapToScene:a,radius:r}=e;this._view=i,this.xyManipulation=new gt({tool:t,view:i,snapToScene:a,radius:r}),this.xyAxisManipulation=new pt({tool:t,view:i,radius:r}),this.zManipulation=new vt({tool:t,view:i,radius:r}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(Ee.b)([this.xyManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>e(0,t,i,a,r,n)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>e(1,t,i,a,r,n)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>e(2,t,i,a,r,n)),t,i)])}createDragPipeline(e,t,i,a){return Object(Ee.b)([this.xyManipulation.createDragPipeline(((t,i,a,r,n)=>e(0,t,i,a,r,n)),t,i,a),this.xyAxisManipulation.createDragPipeline(((t,i,a,r,n)=>e(1,t,i,a,r,n)),t,i,a),this.zManipulation.createDragPipeline(((t,i,a,r,n)=>e(2,t,i,a,r,n)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,1))),this.xyAxisManipulation.forEachManipulator((t=>e(t,1))),this.zManipulation.forEachManipulator((t=>e(t,0)))}get xyAxisVisible(){var e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){var e=this.xyAxisManipulation,t=this.xyManipulation;if(!Object(s.a)("esri-mobile")){var i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));var a=()=>{var t=[];this.xyAxisVisible?Object(o.k)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(yt),this._handles.add(t,yt)};for(var r of i)this._handles.add(r.events.on("focus-changed",a));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",a)),a()}}updateManipulatorInteractivity(){var e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){var t=Object(o.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?at:it}}var yt="disable-xy-axis-display",_t=i(652);class wt extends lt{constructor(e){super(),this._handles=new De.a,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return ot(this._graphicState,e,(e=>this.createDragPipeline(e)))}createDragPipeline(e){var t=this._view,i=this._graphicState.graphic,a=Object(o.k)(i.geometry)?i.geometry.spatialReference:null;return Object(Ge.e)(this._manipulator,((r,n,s,o,c)=>{var l=n.next(Object(dt.d)(c,t,i,a)).next(Object(Ge.b)()).next(Object(Ge.c)());e(r,l,s,o,c)}))}_createManipulator(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new _t.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}class Mt{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class xt{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class St{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}var Pt=class extends(d.a.EventedMixin(O.a)){constructor(e){super(e),this.graphics=new Ae.a,this.enableZ=!0,this.type="move-3d",this._toolHandles=new De.a,this._handles=new De.a,this.snappingPipeline=new ke.a}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators()}destroy(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}reset(){}_refreshManipulators(){this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var e=this.graphics.toArray().filter((e=>0===Object(ze.a)(e))).map((e=>new Et(e)));e.length&&(this.createManipulators(e),this.createVisualElements(e),this._handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this.updateMoveManipulation(e))}createManipulators(e){var t=this,i=function(i){var a=i.state;i.manipulationXY=new wt({tool:t,view:t.view,graphicState:a}),i.manipulationXY.forEachManipulator((e=>t._handles.add(e.events.on("immediate-click",(e=>{t.emit("immediate-click",Object(r.a)(Object(r.a)({},e),{},{graphic:a.graphic})),e.stopPropagation()}))))),t._handles.add(i.manipulationXY.createDragPipeline(((i,a,r,n)=>t.buildDragEventPipeline(e,0,i,a,r,n))))};for(var a of e)i(a);this.createMoveManipulation(e)}createMoveManipulation(e){var t=new jt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?jt.radiusForSymbol(e[0].graphic.symbol):it});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this._handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",Object(r.a)(Object(r.a)({},i),{},{graphic:this.graphics.getItemAt(0)})),i.stopPropagation()})))}));var i=()=>this.updateMoveManipulation(e);for(var a of e)this._handles.add([a.state.on("changed",i),a.state.watch("displaying",i)]);var n=e[e.length-1];this._handles.add(n.state.on("changed",(()=>this.updateMoveManipulationAngle(n)))),this._handles.add(t.createDragPipeline(((t,i,a,r,n)=>this.buildDragEventPipeline(e,t,i,a,r,n)),Object(m.d)(n.graphic),Object(o.q)(n.graphic.geometry).spatialReference,n.graphic)),this.updateMoveManipulationAngle(n)}createVisualElements(e){var t=this,i=function(i){var a=i.graphic,r=et({view:t.view,graphic:a,forEachManipulator:e=>{i.manipulationXY.forEachManipulator(e),t._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(Ee.c)()});i.geometryRepresentation=r.visualElement,i.geometryRepresentation instanceof ue&&t._handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(()=>{i.state.isDraped||t.updateMoveManipulation(e)})),i.state.watch("isDraped",(()=>t.updateMoveManipulation(e)))]),t._handles.add(r)};for(var a of e)i(a)}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>ct(e.graphic.geometry)}updateMoveManipulation(e){var t=Object(Y.d)(0,0,0,this.view.spatialReference),i=0,a=!1,r=this._moveManipulation;for(var n of e)if(n.state.displaying){var s=n.state.graphic;this.enableZ&&Le(s)&&(a=!0);var c=n.geometryRepresentation instanceof ue&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:Object(Ve.f)(this.view,s);Object(o.k)(c)&&(t.x+=c.x,t.y+=c.y,t.z+=c.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,r.location=t,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}buildDragEventPipeline(e,t,i,a,r,n){var s=[],o=[],c=null,l=null,h=()=>{for(var e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){var u=e[0].graphic;a=this.buildSnappingPipelineSteps(u,Object(m.d)(u),a,r,n)}var d=a.next((t=>{if("start"===t.action){for(var a of(s.length=0,o.length=0,e))a.dragging||!a.manipulationXY.hasManipulator(i)&&a.manipulationXY.grabbing||(s.push(a),o.push(a.graphic),a.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(Ge.h)(o),l=Object(Ge.j)(o),this.emit("graphic-move-start",new Mt(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>c(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,r=i.y-t.y;if(this.emit("graphic-move",new xt(a,r,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new St(o)),this.destroyed)return null;h()}}));return r.next((e=>l(e))).next((()=>{if(this.emit("graphic-move-stop",new St(o)),this.destroyed)return null;h()})),d}buildSnappingPipelineSteps(e,t,i,a,n){var s=e.geometry;if(Object(o.j)(s)||"point"!==s.type)return i;var c=new Ce.a({elevationInfo:t,pointer:n,geometry:new Te.a(Re.c.fromGeometry(s,this.view.viewingMode),"point"),visualizer:new Ie.a,excludeFeature:e}),l=this.snappingManager;return i.next((t=>{var i=s.clone();return i.z=Object(m.a)(this.view,i,Object(m.d)(e),{mode:"absolute-height",offset:0}),Object(r.a)(Object(r.a)({},t),{},{snapOrigin:c.coordinateHelper.fromPoint(i)})})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:a}),this.snappingPipeline.next)}};Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Pt.prototype,"view",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],Pt.prototype,"graphics",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Pt.prototype,"enableZ",void 0),Object(n.a)([Object(h.b)({constructOnly:!0})],Pt.prototype,"snappingManager",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],Pt.prototype,"type",void 0),Pt=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Pt);class Et{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new _e({graphic:e})}get graphic(){return this.state.graphic}}var At=i(899),Dt=class extends d.a.EventedAccessor{constructor(e){super(e),this._vertexManipulatorMaterial=Object(Ve.c)(q.colorToVec4(q.reshapeManipulators.vertex.color),q.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Object(Ve.d)(q.colorToVec4(q.reshapeManipulators.vertex.outlineColor),q.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Object(Ve.d)(q.colorToVec4(q.reshapeManipulators.vertex.hoverOutlineColor),q.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Object(Ve.c)(q.colorToVec4(q.reshapeManipulators.edge.color),q.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Object(Ve.d)(q.colorToVec4(q.reshapeManipulators.edge.outlineColor),q.reshapeManipulators.edge.renderOccluded),this._selectedManipulatorMaterial=Object(Ve.c)(q.colorToVec4(q.reshapeManipulators.selected.color),q.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Object(Ve.d)(q.colorToVec4(q.reshapeManipulators.selected.outlineColor),q.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Object(Ve.d)(q.colorToVec4(q.reshapeManipulators.selected.hoverOutlineColor),q.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._handles=new De.a,this._manipulatorHandles=new De.a,this._manipulatorInfos=[],this._reshapeHelper=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new ke.a,this._snappingPipelineHandle=new ke.a,this._vertexLaserLineVisualElement=null}initialize(){var e=new _e({graphic:this.graphic});this._graphicState=e,this._handles.add([e.watch("displaying",(e=>{for(var t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._clear(),this._handles.destroy()}get inputGeometry(){return Object(o.k)(this._reshapeHelper)?this._reshapeHelper.geometry:null}set inputGeometry(e){this._recreateManipulators(e)}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZ(){return this.tool.enableZ}get enableMoveGraphic(){return this.tool.enableMoveGraphic}removeSelectedVertices(){var e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_clear(){this._moveManipulation=Object(o.e)(this._moveManipulation),this._graphicMoveManipulation=Object(o.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=Object(o.e)(this._reshapeHelper),this._numGrabbing=0,this._numDragging=0}_recreateManipulators(e=this.inputGeometry){if(this._clear(),!Object(o.j)(e)){Object(o.e)(this._reshapeHelper),this._reshapeHelper=new zt(Re.c.fromGeometry(e,this.view.viewingMode),e.type);var t=Object(m.d)(this.graphic);for(var i of this._reshapeHelper.editGeometry.components){for(var a of i.vertices)this._createPerVertexManipulator(a,t);for(var r of i.edges)this._createPerVertexManipulator(r,t)}this._createGraphicMoveManipulators(t)}}_perGraphicManipulatorDragAction(e,t){if("end"!==t.action){var i=[],a=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),r=1===e&&a,n=Object(o.q)(this._reshapeHelper);for(var s of this._manipulatorInfos)"vertex"===s.handle.type&&(s.manipulator.grabbing||r&&!s.manipulator.selected||(Object(o.q)(n).moveVertices([s.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(s.handle.pos),this._updateManipulatorPosition(s)));if(0!==i.length){var c=0;for(var l of this._manipulatorInfos)"vertex"===l.handle.type&&c++;if(this.outputGeometry=n.geometry,i.length===c){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}}isMultiVertexSelection(){var e=0;for(var t of this._manipulatorInfos)Tt(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,i=e.mapDeltaY,a=e.mapDeltaZ;if(t||i||a){var r=[];for(var n of this._manipulatorInfos)Tt(n)&&(n.manipulator.selected&&!n.manipulator.grabbing||n===e.info)&&r.push(n);var s=Object(o.q)(this._reshapeHelper);for(var c of r)s.moveVertices([c.handle],t,i,a);for(var l of(this.outputGeometry=s.geometry,r))this._updateManipulatorPosition(l);this.emit("reshape",{type:"reshape",mover:this.graphic})}}}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){this._graphicMoveManipulation=new wt({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,t,i)=>{t.next((e=>this._trackNumDragging(e))).next((e=>{this._perGraphicManipulatorDragAction(0,e)})),i.next(this._cancelDragOperation())}))):this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null})),this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",Object(r.a)(Object(r.a)({},e),{},{graphic:this.graphic})),e.stopPropagation()}))]))),this._moveManipulation=new jt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Le(this.graphic),snapToScene:!1,radius:jt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this._handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",Object(r.a)(Object(r.a)({},t),{},{graphic:this.graphic})),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var t=Object(o.q)(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline(((t,i,a,n,s)=>{var c=a.next((e=>this._trackNumDragging(e))).next((e=>{var t=this._manipulatorInfos.filter((e=>Tt(e)&&e.manipulator.selected));return 1===e.manipulatorType&&1===t.length?Object(r.a)(Object(r.a)({},e),{},{info:t[0],snapOrigin:t[0].handle.pos}):Object(r.a)(Object(r.a)({},e),{},{info:null})})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:n,snappingManager:this.tool.snappingManager,snappingContext:new Ce.a({geometry:Object(o.q)(this._reshapeHelper),elevationInfo:e,pointer:s,excludeFeature:this.graphic,visualizer:new Ie.a})}),this._snappingPipelineHandle.next).next(Object(Ge.b)()).next((e=>(this._perGraphicManipulatorDragAction(1,e),e)));return n.next(this._cancelDragOperation()),c}),e,t,this.graphic),Object(b.a)(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),Object(b.a)(this._graphicState,"isDraped",(()=>{var e="align-move-manipulation";this._graphicState.isDraped?this._handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this._handles.remove(e)}))]),this._updateMoveManipulationPosition();var i=et({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){for(var t of(Object(o.k)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e),this._manipulatorInfos))e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});this._outlineVisualElement=i.visualElement instanceof ue?i.visualElement:null,Object(o.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i)}_createPerVertexManipulator(e,t=Object(m.d)(this.graphic)){if(Object(o.j)(this._vertexManipulatorGeometry)||Object(o.j)(this._vertexManipulatorOutlineGeometry)){var i=q.reshapeManipulators.vertex,a=i.size/2,n=a+i.collisionPadding,s=a/n;this._vertexManipulatorGeometry=ge.a.createSphereGeometry(s,16,16);var c=(a+i.outlineSize)/n;this._vertexManipulatorOutlineGeometry=ge.a.createSphereGeometry(c,16,16)}if(Object(o.j)(this._edgeManipulatorGeometry)||Object(o.j)(this._edgeManipulatorOutlineGeometry)){var l=q.reshapeManipulators.edge,h=l.size/2,u=h+l.collisionPadding,d=h/u;this._edgeManipulatorGeometry=ge.a.createSphereGeometry(d,16,16);var p=(h+l.outlineSize)/u;this._edgeManipulatorOutlineGeometry=ge.a.createSphereGeometry(p,16,16)}var b=new He.a({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Gt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Gt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Gt.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Gt.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Gt.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Gt.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Gt.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(b,e,t);var g="edge"===e.type?{manipulator:b,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:b,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(g),this.manipulators.add(b),this._updateManipulatorPosition(g),"edge"===g.type){var v=this._getManipulatorInfoFromHandle(g.handle.left).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(g))),f=this._getManipulatorInfoFromHandle(g.handle.right).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(g)));g.locationUpdateHandle=Object(Ee.b)([v,f]),this._manipulatorHandles.add(g.locationUpdateHandle,b)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(b,!0),b);var O=Object(Ge.e)(b,((e,i,a,n)=>{i.next((e=>this._trackNumDragging(e))).next((e=>{if(Ct(g)){var t=this._splitEdgeManipulator(g);return Object(r.a)(Object(r.a)({},e),{},{info:t,snapOrigin:t.handle.pos})}return Object(r.a)(Object(r.a)({},e),{},{info:g,snapOrigin:g.handle.pos})})).next(Object(Ge.f)(this.view,e.elevationAlignedLocation)).next(Object(dt.e)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this.isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new Ce.a({geometry:Object(o.q)(this._reshapeHelper),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new Ie.a})}),this._snappingPipeline.next).next(Object(Ge.b)()).next((e=>{this._perVertexManipulatorDragAction(e)})),a.next(this._cancelDragOperation())}));return this._manipulatorHandles.add(O,b),this._manipulatorHandles.add([b.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,g))),b.events.on("select-changed",(()=>{g.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),b}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(){var e=Object(o.k)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return()=>{switch(this._numDragging--,this.inputGeometry=e,this.outputGeometry=e,Object(o.k)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Gt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=q.reshapeManipulators.vertex.size/2+q.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i;break;case"edge":e.state=Gt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=q.reshapeManipulators.edge.size/2+q.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===i.mode?i:{mode:"absolute-height",offset:0}}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing}))}_clearSelection(){for(var e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(var t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(e){var t=Object(o.q)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,It),e.manipulator.grabbing&&Object(o.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var i=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(o.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var r=i.location,n=a.location,s=r.x+.5*(n.x-r.x),c=r.y+.5*(n.y-r.y),l=r.hasZ&&n.hasZ?0:void 0;e.manipulator.location=Object(Y.d)(s,c,l,t.geometry.spatialReference)}else Object(U.h)(Vt,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=Vt}}}_splitEdgeManipulator(e){var t=Object(o.q)(this._reshapeHelper),i=Object(o.q)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var a=e;a.handle=i,a.type="vertex";var r=Object(m.d)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r),i.left&&this._createPerVertexManipulator(i.left),i.right&&this._createPerVertexManipulator(i.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(a),this._updateSelection(e.manipulator);var n=this._updateEventState(2),s=t.editGeometry.coordinateHelper.toArray(a.handle.pos),c=t.editGeometry.components.indexOf(i.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:c,vertexIndex:Object(o.q)(i.index)}],added:s}),n&&this._updateEventState(0),a}_updateMoveManipulationPosition(){var e=ht.d.get();Object(U.v)(e,0,0,0);var t=0,i=!1,a=null,r=null;for(var n of this._manipulatorInfos)Tt(n)&&(n.manipulator.selected?(t++,Object(U.e)(e,e,n.manipulator.renderLocation),Object(o.j)(a)||n.selectedIndex>a.selectedIndex?(r=a,a=n):(Object(o.j)(r)||n.selectedIndex>r.selectedIndex)&&(r=n)):i=!0);if(0!==t){var s=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=s,this._moveManipulation.xyAxisManipulation.available=s,this._moveManipulation.zManipulation.available=s&&this.enableZ&&Le(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=s&&1!==t}else{var c=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=c,this._moveManipulation.xyAxisManipulation.available=c,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=c,this._moveManipulation.zManipulation.available=c&&this.enableZ&&Le(this.graphic)}if(0!==t){var l=0;if(Object(o.k)(a)){var h=a.handle.pos,u=Object(o.k)(r)?r.handle.pos:a.handle.left&&a.handle.left.left?a.handle.left.left.pos:null,d=!Object(o.k)(r)&&a.handle.right&&a.handle.right.right?a.handle.right.right.pos:null;u&&d?this._moveManipulation.xyAxisManipulation.available=!1:u?l=Rt(u,h):d&&(l=Rt(h,d))}this._moveManipulation.angle=l,this._moveManipulation.radius=at}else this._moveManipulation.angleDeferred=()=>ct(Object(o.q)(this.graphic.geometry)),this._moveManipulation.radius=jt.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(U.d)(e,e,1/t),It.spatialReference=Object(o.q)(this._reshapeHelper).geometry.spatialReference,It.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,It),this._moveManipulation.elevationAlignedLocation=It):Object(o.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(o.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(Ve.g)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){var t=[],i=Object(o.q)(this._reshapeHelper);for(var a of e)if("vertex"===a.handle.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.right));var r=Object(o.q)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);r&&this._createPerVertexManipulator(r)}if(t.length>0){var n=t.map((e=>{var t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(o.q)(e.index)}}));this.outputGeometry=i.geometry;var s=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:n.map((e=>e.coordinates)),vertices:n}),this.destroyed)return;if(s&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Ct(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function Rt(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Tt(e){return"vertex"===e.handle.type}function Ct(e){return"edge"===e.handle.type}Object(n.a)([Object(h.b)({constructOnly:!0})],Dt.prototype,"tool",void 0),Object(n.a)([Object(h.b)()],Dt.prototype,"inputGeometry",null),Object(n.a)([Object(h.b)()],Dt.prototype,"outputGeometry",void 0),Dt=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Dt);var Gt,kt,It=Object(Y.d)(0,0,null,null),Vt=Object(H.e)();(kt=Gt||(Gt={})).Vertex=16,kt.Edge=32;class zt extends Te.a{constructor(e,t){super(e,t),this.type=t,this._geometry=null}get geometry(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}var Lt=class extends(d.a.EventedMixin(O.a)){constructor(e){super(e),this._handles=new De.a,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingManager=null}destroy(){this._handles.removeAll(),this._reshapeOperation=Object(o.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){var e=this.graphic.geometry;0!==Object(At.a)(this.graphic)||!Object(o.k)(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===Object(At.a)(this.graphic)){var e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){Object(o.j)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new Dt({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),Object(b.a)(this,"graphic",(()=>{this._updateGraphic()}),!0)])}beforeUndo(){Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"view",void 0),Object(n.a)([Object(h.b)({constructOnly:!0})],Lt.prototype,"graphic",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"enableZ",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"enableMoveGraphic",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],Lt.prototype,"type",void 0),Object(n.a)([Object(h.b)({constructOnly:!0})],Lt.prototype,"snappingManager",void 0),Lt=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Lt);var Ft,qt,Ht=i(184),Ut=i(241),Bt=i(105),Nt=i(255);(qt=Ft||(Ft={})).ScaleIn=32,qt.ScaleOut=64,qt.RotateLeft=128,qt.RotateRight=256,qt.Unlocked=1024,qt.DelayedFocused=2048,qt.TouchInput=32768;class Wt{constructor(e){this.mode=null,this._handles=new De.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new d.a,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(o.k)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._scaleRotateDragData.scale:1,this.tool=e.tool,this.mode=e.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}destroy(){Object(o.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();var t=Object(Ut.a)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation=Object(r.a)(Object(r.a)({},e),{},{frameTask:t})}cancelActiveAnimation(){Object(o.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(Ge.e)(e,((e,i,a)=>{this._scaleRotateDragData=null;var r=function(e,t){var i=e.allLayerViews.find((e=>e.layer===t.layer));if(Object(o.j)(t.symbol))return null;var a=t.symbol;return{symbolLayers:a.symbolLayers.map((e=>{var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:i.getSymbolLayerSize(a,e)}})).toArray()}}(this.tool.view,t);if(Object(o.j)(r))return this.updateDragState(),null;var n={mode:"none",origin:Object(H.d)(e.renderLocation),angle:0,startAngle:this.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};this._scaleRotateDragData=n,this.updateDragState();var s=ht.d.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,s),i.next(Object(dt.f)(this.tool.view,Nt.e.fromPositionAndNormal(e.renderLocation,s))).next((e=>{var i=Nt.e.normal(e.plane),a=Object(Ve.a)(e.renderStart,e.renderEnd,n.origin,i),r=K.c.shortestSignedDiff(n.angle,a);n.angleDir=Object(Fe.d)(n.angleDir+r,-.3,.3),n.angle=a;var s=function(e,t){var i=Object(U.i)(ht.d.get(),t.renderStart,e.origin),a=Object(U.i)(ht.d.get(),t.renderEnd,e.origin),r=Object(U.o)(i),n=Object(U.o)(a);return 0===r?0:n/r}(n,e),c=s-n.scale;if(n.scaleDir=Object(Fe.d)(n.scaleDir+c,-.2,.2),n.scale=s,this.onScaleChanged(),"none"===n.mode){var l=this.mode||function(e,t,i,a){var{renderStart:r,renderEnd:n}=e,s=Zt(r,a,ht.d.get()),o=Zt(n,a,ht.d.get());if(Object(U.k)(s,o)<100)return null;var c=Object(U.i)(ht.d.get(),r,i),l=Object(U.f)(ht.d.get(),c,t),h=r,u=Object(U.e)(ht.d.get(),h,l),d=Zt(i,a,ht.d.get()),p=s,b=Zt(u,a,ht.d.get()),g=Object(U.i)(ht.d.get(),b,p),v=Object(U.i)(ht.d.get(),s,d),m=Nt.f.wrap(p,g),f=Nt.f.wrap(d,v);return Nt.f.distance2(m,o)<Nt.f.distance2(f,o)?"rotate":"scale"}(e,e.plane,n.origin,this.tool.view.state.camera);if(Object(o.k)(l)){switch(l){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:Object(Fe.q)(n.angle)});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:n.scale,yScale:n.scale})}n.mode=l}}if(this.updateDragState(),Object(o.k)(t.symbol)){var h=t.symbol.clone(),u=0,d=1;switch(n.mode){default:case"none":break;case"scale":d=n.scale;break;case"rotate":u=n.angle}this.applySymbolData(h,n.startSymbolData,u,d),t.symbol=h,this.updateManipulatorTransform()}switch(e.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(Fe.q)(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:n.scale,yScale:n.scale})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(Fe.q)(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:n.scale,yScale:n.scale});break;default:case"none":}}"end"===e.action&&(this.startAnimation(Yt(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState())})),a.next(Object(Ge.l)(t)).next((()=>{if(Object(o.k)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(Fe.q)(this._scaleRotateDragData.startAngle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Yt(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){var i=0,a=null,r=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=r,i=0,t()},update:e=>(i+=e,!a()||i>200?1:0),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),Object(b.a)(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e)),this.tool.graphicState.on("changed",(()=>Object(Ve.g)(this.tool.view,this.ringManipulator,t)))]),Object(Ve.g)(this.tool.view,this.ringManipulator,t)}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Ft.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(Ft.Unlocked,!(Object(o.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(o.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Ft.ScaleIn|Ft.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Ft.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Ft.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Ft.RotateLeft|Ft.RotateRight,!1),this.ringManipulator.updateStateEnabled(Ft.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Ft.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Ft.ScaleIn|Ft.ScaleOut|Ft.RotateLeft|Ft.RotateRight,!1)}updateManipulatorTransform(){var e=Object($.i)(ht.a.get()),t=this.tool.symbolRotationAngle;Object($.q)(e,e,t,Object(H.g)(0,0,1));var i=this.getScale(),a=Object($.o)(ht.a.get(),Object(U.v)(ht.d.get(),i,i,i)),r=Object($.i)(ht.a.get());Object($.l)(r,a,e),this.ringManipulator.modelTransform=r}createRingManipulator(){for(var e=(e,t,i)=>{for(var a=[],r=Math.ceil(128*(t-e)/(2*Math.PI)),n=0;n<r+1;n++){var s=e+n*(t-e)/r;a.push(Object(H.g)(i*Math.cos(s),i*Math.sin(s),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>ge.a.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(rt),r=i(a,24),n={left:[],right:[]},s=[],o=0;o<2;o++){var c=o*Math.PI-Math.PI/4,l=Math.PI/2-nt,h=c+l,u=c+Math.PI/2-l,d=e(h,u,190),p=i(d,9);s.push(d),s.push(e(h,u,201)),n.left.push(p),n.right.push(p);for(var b=0;b<2;b++){var g=0===b,v=Object(ee.b)();if(g){Object($.r)(v,v,[1,-1,1]),Object($.q)(v,v,-h,[0,0,1]);var f=Math.round(.2*(d.length-1));v[12]=d[f][0],v[13]=d[f][1],v[14]=d[f][2]}else{Object($.q)(v,v,u,[0,0,1]);var O=Math.round(.8*(d.length-1));v[12]=d[O][0],v[13]=d[O][1],v[14]=d[O][2]}var j=ge.a.createExtrudedTriangle(60,0,23,.5);ge.a.transformInPlace(j,v),(g?n.left:n.right).push(j)}}for(var y=[],_=0;_<2;_++){var w=_*Math.PI-Math.PI/4,M=Math.PI/2-st,x=w+M,S=w+Math.PI/2-M,P=e(x,S,213);y.push(i(P,9))}var E=t(190),A=t(213),D=i(E,9),R=i(A,9),T=t(130),C=t(107),G=i(T,9),k=i(C,9),I=this.createMaterial(),V=this.createMaterial(.66),z=this.createMaterial(.5),L=this.createMaterial(.33),F=[{geometry:r,material:I,stateMask:Ft.DelayedFocused},{geometry:r,material:z,stateMask:0}];this.mode&&"scale"!==this.mode||(F=F.concat([{geometry:y,material:I,stateMask:Ft.DelayedFocused|Ft.Unlocked},{geometry:D,material:V,stateMask:Ft.DelayedFocused|Ft.ScaleIn},{geometry:R,material:L,stateMask:Ft.DelayedFocused|Ft.ScaleIn},{geometry:G,material:V,stateMask:Ft.DelayedFocused|Ft.ScaleOut},{geometry:k,material:L,stateMask:Ft.DelayedFocused|Ft.ScaleOut}])),this.mode&&"rotate"!==this.mode||(F=F.concat([{geometry:n.right,material:I,stateMask:Ft.DelayedFocused|Ft.Unlocked},{geometry:n.left,material:I,stateMask:Ft.DelayedFocused|Ft.RotateLeft},{geometry:n.right,material:I,stateMask:Ft.DelayedFocused|Ft.RotateRight}]));var q=[a,...s];return new He.a({view:this.tool.view,renderObjects:F,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(m.d)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:q,direction:Object(H.g)(0,0,1)}})}createMaterial(e=1){var t=[...tt,e];return new ut.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}applySymbolData(e,t,i,a){e.symbolLayers.forEach(((e,r)=>{var{heading:n,size:s}=t.symbolLayers[r];"object"===e.type&&(e.heading=(Object(o.k)(n)?n:0)-Object(Ht.c)(i),Object(o.k)(s)&&"width"in s&&(s.width=this.enforceNonZeroSize(s.width),s.height=this.enforceNonZeroSize(s.height),s.depth=this.enforceNonZeroSize(s.depth),e.width=s.width*a,e.depth=s.depth*a,e.height=s.height*a))}))}enforceNonZeroSize(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}get test(){return{ringManipulator:this.ringManipulator}}}function Zt(e,t,i){var a=t.projectToRenderScreen(e,Object(Bt.a)(Xt)),r=t.renderToScreen(a,Qt);return Object(U.v)(i,r[0],r[1],0)}function Yt(e,t){var i=null,a=1,r=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=r,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}var Xt=Object(H.e)(),Qt=Object(Bt.g)(),Jt=class extends(d.a.EventedMixin(O.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.handles=new De.a,this.scaleRotate=null,this.snappingPipeline=new ke.a}initialize(){this.graphicState=new _e({graphic:this.graphic}),this.moveManipulation=new jt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Le(this.graphic),radius:jt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>e.stopPropagation()))))),this.moveManipulation.elevationInfo=Object(m.d)(this.graphic);var e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline(((t,i,a,r,n)=>(Object(o.k)(e)&&"point"===e.type&&0===t&&(a=a.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Ce.a({elevationInfo:Object(m.d)(this.graphic),pointer:n,geometry:new Te.a(Re.c.fromGeometry(e,this.view.viewingMode),"point"),visualizer:new Ie.a,excludeFeature:this.graphic}),snappingManager:this.snappingManager,cancel:r}),this.snappingPipeline.next)),a)),this.graphicState,(e=>{var{action:t,graphic:i,dxScreen:a,dyScreen:r}=e,n={graphic:i,dxScreen:a,dyScreen:r};switch(t){case"start":this.emit("graphic-translate-start",n);break;case"update":this.emit("graphic-translate",n);break;case"end":this.emit("graphic-translate-stop",n)}})),this.moveManipulation.angle=this.symbolRotationAngle,this.enableScaling||this.enableRotation){var t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new Wt({tool:this,mode:t}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())))}this.handles.add([et({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Ee.c)()}),this.graphic.watch("symbol",(()=>this.updateMoveAngle())),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(o.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&Le(this.graphic)}))}destroy(){this.handles.destroy(),this.moveManipulation.destroy(),this.scaleRotate=Object(o.e)(this.scaleRotate),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get symbolRotationAngle(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((e=>"object"===e.type)),i=t&&t.heading||0;return Object(Ht.d)(-i)}return 0}reset(){}onDetach(){Object(o.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){Object(o.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(!Object(o.j)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}updateMoveAngle(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.symbolRotationAngle:this.moveManipulation.angle=0}onGeometryChanged(){Object(Ve.g)(this.view,this.moveManipulation,this.graphic)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:Object(o.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Jt.prototype,"view",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Jt.prototype,"graphic",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Jt.prototype,"enableZ",void 0),Object(n.a)([Object(h.b)()],Jt.prototype,"enableRotation",void 0),Object(n.a)([Object(h.b)()],Jt.prototype,"enableScaling",void 0),Object(n.a)([Object(h.b)({value:!1})],Jt.prototype,"snapToScene",null),Object(n.a)([Object(h.b)({constructOnly:!0})],Jt.prototype,"snappingManager",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],Jt.prototype,"type",void 0),Jt=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Jt);var Kt=i(117),$t=i(202),ei=i(135),ti=i(653),ii=(i(180),i(113)),ai=(i(101),i(533)),ri=i(347),ni=i(463),si=i(434),oi=i(179),ci=i(388),li=i(328),hi=i(379),ui=i(491),di=i(585),pi=i(300),bi=i(307),gi=i(313),vi=i(306),mi=i(286),fi=i(267),Oi=i(380),ji=i(249),yi=i(322),_i=i(489),wi=i(974);class Mi extends bi.a{constructor(e,t){super(e,t),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){var t=Mi.shader.get(),i=this.configuration,a=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new mi.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),vi.a)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t,i){if(Oi.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){var a=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,a),this.stipplePattern=a}if(this.configuration.stippleEnabled){var r=Object(o.k)(this.stippleTextureBind)?this.stippleTextureBind(e,0)*i.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r),this.program.setUniform2f("ndcToPixel",i.camera.fullViewport[2]/2,i.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*i.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var n=Object(o.q)(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",n[0],n[1],n[2],n.length>3?n[3]:1)}4===this.configuration.output&&yi.a.bindOutputHighlight(e,this.program,i)}bindDraw(e){Oi.a.bindView(this.program,e),ji.a.bindUniformsWithOrigin(this.program,this.configuration,e)}initializePipeline(){var e=this.configuration,t=Object(fi.e)(770,1,771,771),i=(t,i=null,a=null)=>Object(fi.d)({blending:i,depthTest:_i.b,depthWrite:a,colorWrite:fi.b,stencilWrite:e.sceneHasOcludees?_i.h:null,stencilTest:e.sceneHasOcludees?t?_i.d:_i.c:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,fi.c),i(!1,e.transparent||e.stippleEnabled?t:null,fi.c)):i(!1)}get primitiveType(){return 1}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}Mi.shader=new pi.a(wi.a,(()=>i.e(300).then(i.bind(null,1212))));class xi extends gi.a{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.sceneHasOcludees=!1}}Object(n.a)([Object(gi.b)({count:8})],xi.prototype,"output",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"slicePlaneEnabled",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"vertexColors",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"transparent",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"stippleEnabled",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"stippleOffColorEnabled",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(n.a)([Object(gi.b)()],xi.prototype,"sceneHasOcludees",void 0);var Si=c.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class Pi extends hi.a{constructor(e){super(e,Di),this.techniqueConfig=new xi}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;var t=Object(o.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(o.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,a,r,n,s,o,c){c?Object(li.d)(e,a,n,1,s):this.intersectLineGeometry(e,t,i,a,s)}intersectLineGeometry(e,t,i,a,r){if(a.options.selectionMode&&!Object(ie.d)(t))if(Object(oi.g)(i)){var n=e.vertexAttributes.get("position").data,s=a.camera,o=qi;Object(ei.c)(o,a.point);Object(U.v)(Hi[0],o[0]-2,o[1]+2,0),Object(U.v)(Hi[1],o[0]+2,o[1]+2,0),Object(U.v)(Hi[2],o[0]+2,o[1]-2,0),Object(U.v)(Hi[3],o[0]-2,o[1]-2,0);for(var c=0;c<4;c++)if(!s.unprojectFromRenderScreen(Hi[c],Ui[c]))return;Nt.e.fromPoints(s.eye,Ui[0],Ui[1],Bi),Nt.e.fromPoints(s.eye,Ui[1],Ui[2],Ni),Nt.e.fromPoints(s.eye,Ui[2],Ui[3],Wi),Nt.e.fromPoints(s.eye,Ui[3],Ui[0],Zi);for(var l=Number.MAX_VALUE,h=0;h<n.length-5;h+=3)if(Ri[0]=n[h]+i[12],Ri[1]=n[h+1]+i[13],Ri[2]=n[h+2]+i[14],Ti[0]=n[h+3]+i[12],Ti[1]=n[h+4]+i[13],Ti[2]=n[h+5]+i[14],!(Nt.e.signedDistance(Bi,Ri)<0&&Nt.e.signedDistance(Bi,Ti)<0||Nt.e.signedDistance(Ni,Ri)<0&&Nt.e.signedDistance(Ni,Ti)<0||Nt.e.signedDistance(Wi,Ri)<0&&Nt.e.signedDistance(Wi,Ti)<0||Nt.e.signedDistance(Zi,Ri)<0&&Nt.e.signedDistance(Zi,Ti)<0)){if(s.projectToRenderScreen(Ri,ki),s.projectToRenderScreen(Ti,Ii),ki[2]<0&&Ii[2]>0){Object(U.i)(Ci,Ri,Ti);var u=s.frustum,d=-Nt.e.signedDistance(u[4],Ri)/Object(U.g)(Ci,Nt.e.normal(u[4]));Object(U.d)(Ci,Ci,d),Object(U.e)(Ri,Ri,Ci),s.projectToRenderScreen(Ri,ki)}else if(ki[2]>0&&Ii[2]<0){Object(U.i)(Ci,Ti,Ri);var p=s.frustum,b=-Nt.e.signedDistance(p[4],Ti)/Object(U.g)(Ci,Nt.e.normal(p[4]));Object(U.d)(Ci,Ci,b),Object(U.e)(Ti,Ti,Ci),s.projectToRenderScreen(Ti,Ii)}else if(ki[2]<0&&Ii[2]<0)continue;ki[2]=0,Ii[2]=0;var g=Nt.d.distance2(Nt.d.fromPoints(ki,Ii,Li),o);g<l&&(l=g,Object(U.j)(Vi,Ri),Object(U.j)(zi,Ti))}var v=a.rayBeginPoint,m=a.rayEndPoint;if(l<4){var f=Number.MAX_VALUE;if(Nt.d.closestLineSegmentPoint(Nt.d.fromPoints(Vi,zi,Li),Nt.d.fromPoints(v,m,Fi),Gi)){Object(U.i)(Gi,Gi,v);var O=Object(U.o)(Gi);Object(U.d)(Gi,Gi,1/O),f=O/Object(U.n)(v,m)}r(f,Gi)}}else Si.error("intersection assumes a translation-only matrix")}computeAttachmentOrigin(e,t){var i=e.vertexAttributes;if(!i)return!1;var a=i.get("position");return Object(X.a)(a,null,!1,t)}createBufferWriter(){var e=this.params.vertexColors?di.b:di.c;return Object(o.j)(this.params.stipplePattern)?new di.a(e):new Ai(e.clone().vec3f("auxpos1"))}getGLMaterial(e){return 0===e.output||4===e.output?new Ei(e):void 0}}class Ei extends ci.a{constructor(e){super(e),this.updateParameters()}updateParameters(){this.technique=this.techniqueRep.acquireAndReleaseExisting(Mi,this.material.getTechniqueConfig(this.output),this.technique)}beginSlot(e){return 3===e}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this.output&&this._updateOccludeeState(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}class Ai{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,a){Object(ui.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a),this.writeAuxpos1(e,t,i,a)}writeAuxpos1(e,t,i,a){var r=i.getField("auxpos1",si.u),n=t.indices.get("position"),s=t.vertexAttributes.get("position").data,o=e.transformation,c=r.typedBufferStride,l=r.typedBuffer;a*=c;for(var h=0;h<n.length;h+=2)for(var u=3*n[h],d=s[u],p=s[u+1],b=s[u+2],g=o[0]*d+o[4]*p+o[8]*b+o[12],v=o[1]*d+o[5]*p+o[9]*b+o[13],m=o[2]*d+o[6]*p+o[10]*b+o[14],f=0;f<2;++f)l[a]=g,l[a+1]=v,l[a+2]=m,a+=c}}var Di=Object(r.a)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},hi.b),Ri=Object(H.e)(),Ti=Object(H.e)(),Ci=Object(H.e)(),Gi=Object(H.e)(),ki=Object(Bt.e)(),Ii=Object(Bt.e)(),Vi=Object(H.e)(),zi=Object(H.e)(),Li=Nt.d.create(),Fi=Nt.d.create(),qi=Object(H.e)(),Hi=[Object(Bt.e)(),Object(Bt.e)(),Object(Bt.e)(),Object(Bt.e)()],Ui=[Object(H.e)(),Object(H.e)(),Object(H.e)(),Object(H.e)()],Bi=Nt.e.create(),Ni=Nt.e.create(),Wi=Nt.e.create(),Zi=Nt.e.create(),Yi=(i(907),Object(s.a)("mac"),Math.cos(Object(Fe.f)(45)),Math.cos(Object(Fe.f)(5)),[1,.5,0]),Xi=[...Yi,1],Qi=[1,1,1,1],Ji=[1,.8,.6,1],Ki=[1,.93,.86,1],$i=[...Yi,1],ea=[...Yi,1],ta=i(569),ia=i(975);class aa extends bi.a{initializeProgram(e){var t=aa.shader.get().build();return new mi.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),vi.a)}bindPass(e,t,i){Oi.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}bindDraw(e){Oi.a.bindView(this.program,e)}initializePipeline(){return Object(fi.d)({blending:Object(fi.e)(1,1,771,771),depthTest:{func:513},colorWrite:fi.b})}}aa.shader=new pi.a(ia.a,(()=>i.e(303).then(i.bind(null,1213))));hi.a;class ra extends ci.a{constructor(e){super(e),this.technique=new aa(this.techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(e){return 8===e}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t)}}Object(n.a)([Object(ta.c)()],ra.prototype,"technique",void 0);Object(r.a)({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},hi.b);me.a;var na=i(664),sa=i(349),oa=i(280),ca=i(976);class la extends bi.a{initializeProgram(e){var t=la.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new mi.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),vi.a)}bindPass(e,t,i){Oi.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(oa.a)(this.program,e,i))}bindDraw(e){Oi.a.bindView(this.program,e),ji.a.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){var i=this.configuration,a=3===e,r=2===e;return Object(fi.d)({blending:0!==i.output&&7!==i.output||!i.transparent?null:a?ha:Object(sa.a)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(i.cullFace),depthTest:{func:Object(sa.b)(e)},depthWrite:a?i.writeDepth&&fi.c:Object(sa.c)(e),colorWrite:fi.b,stencilWrite:i.sceneHasOcludees?_i.h:null,stencilTest:i.sceneHasOcludees?t?_i.d:_i.c:null,polygonOffset:a||r?null:Object(sa.g)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}la.shader=new pi.a(ca.a,(()=>i.e(296).then(i.bind(null,1214))));var ha=Object(fi.f)(1,771);class ua extends gi.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(n.a)([Object(gi.b)({count:8})],ua.prototype,"output",void 0),Object(n.a)([Object(gi.b)({count:3})],ua.prototype,"cullFace",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"slicePlaneEnabled",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"transparent",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"enableOffset",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"writeDepth",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"sceneHasOcludees",void 0),Object(n.a)([Object(gi.b)({count:4})],ua.prototype,"transparencyPassType",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"multipassTerrainEnabled",void 0),Object(n.a)([Object(gi.b)()],ua.prototype,"cullAboveGround",void 0);class da extends hi.a{constructor(e){super(e,ga),this.supportsEdges=!0,this.techniqueConfig=new ua}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<sa.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,r,n,s){Object(li.e)(e,t,a,r,n,void 0,s)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new pa(e):void 0}createBufferWriter(){return new di.a(di.d)}}class pa extends na.a{constructor(e){super(Object(r.a)(Object(r.a)({},e),e.material.params)),this.updateParameters()}updateParameters(e){var t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(la,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}getPipelineState(e,t){return this.technique.getPipelineState(t)}}var ba,ga=Object(r.a)({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},hi.b),va=i(92),ma=i(116),fa=i(908),Oa=i(90),ja=ba=class extends Oa.a{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new ba({position:Object(va.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(o.k)(this.position)&&Object(o.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};Object(n.a)([Object(h.b)({readOnly:!0,json:{read:!1,write:!0}})],ja.prototype,"type",void 0),Object(n.a)([Object(h.b)({type:ii.a}),Object(fa.a)()],ja.prototype,"position",void 0),Object(n.a)([Object(h.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(fa.a)(),Object(ma.a)((e=>K.b.normalize(Object(l.i)(e),0,!0)))],ja.prototype,"heading",void 0),Object(n.a)([Object(h.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(fa.a)(),Object(ma.a)((e=>K.b.normalize(Object(l.i)(e),0,!0)))],ja.prototype,"tilt",void 0),Object(n.a)([Object(h.b)({type:Number,nonNullable:!0}),Object(fa.a)()],ja.prototype,"width",void 0),Object(n.a)([Object(h.b)({type:Number,nonNullable:!0}),Object(fa.a)()],ja.prototype,"height",void 0);ja=ba=Object(n.a)([Object(u.a)("esri.widgets.Slice.SlicePlane")],ja),c.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function ya(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(U.e)(ht.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(U.e)(ht.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(U.i)(ht.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(U.i)(ht.d.get(),e.origin,e.basis2),edge:t}}}function _a(e){var t=Object(U.o)(e.basis1),i=Object(U.o)(e.basis2);return.3*Math.min(t,i)}function wa(e){return _a(e)}function Ma(e){return 0!==e.direction[0]&&0!==e.direction[1]}function xa(e,t=1){var i=0===t?40:0,a=[Object(H.g)(i,0,-24),Object(H.g)(i,0,24)],r=function(e,t){var i=Object(U.i)(Object(H.e)(),e[e.length-1],e[e.length-2]);if(Object(U.q)(i,i),Object(U.d)(i,i,12),Object(U.e)(i,i,e[e.length-1]),t){var a=Object(U.i)(Object(H.e)(),e[0],e[1]);return Object(U.q)(a,a),Object(U.d)(a,a,12),Object(U.e)(a,a,e[0]),[a,...e,i]}return[...e,i]}(a,!0),n=(e,t)=>function(e,t,i){var a=a=>{var r=(a?t:e).slice(0),n=Object(U.i)(ht.d.get(),r[0],r[1]);Object(U.q)(n,n);var s=Object(U.i)(ht.d.get(),r[r.length-1],r[r.length-2]);if(Object(U.q)(s,s),i.padding>0){var c=Object(U.d)(Object(H.e)(),s,-i.padding);if(r[r.length-1]=Object(U.e)(c,c,r[r.length-1]),i.bothEnds){var l=Object(U.d)(Object(H.e)(),n,-i.padding);r[0]=Object(U.e)(l,l,r[0])}}var h=a?i.tipFocusMultiplier:1,u=i.tipLength*(i.focusTipLength?h:1),d=i.tipRadius*h,p=Object($.i)(ht.a.get());if(i.padding>0){var b=u/4,g=Object(U.v)(ht.d.get(),0,b,0),v=1+i.padding/b;Object($.s)(p,p,g),Object($.r)(p,p,Object(U.v)(ht.d.get(),v,v,v)),Object($.s)(p,p,Object(U.d)(g,g,-1/v))}var m=Object($.i)(Object(ee.b)()),f=Object(H.g)(0,1,0),O=Object($.p)(Object(ee.b)(),Object(ai.d)(ht.b.get(),f,s));O[12]=r[r.length-1][0],O[13]=r[r.length-1][1],O[14]=r[r.length-1][2],Object($.l)(O,O,p);var j,y,_=[{part:"tube",geometry:Pa(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,r),transform:m}];if(Object(o.k)(i.flat)?j=ge.a.createExtrudedTriangle(u,d,d,i.flat.thickness):(j=ge.a.createConeGeometry(u,d,24,!1,!1,!0),y=ge.a.createConeGeometry(u,d,24,!1,!0,!1)),_.push({part:"tip",geometry:j,transform:O}),y&&_.push({part:"cap",geometry:y,transform:O}),i.bothEnds){var w=Object($.p)(Object(ee.b)(),Object(ai.d)(ht.b.get(),f,n));w[12]=r[0][0],w[13]=r[0][1],w[14]=r[0][2],Object($.l)(w,w,p),_.push({part:"tip",geometry:j,transform:w}),y&&_.push({part:"cap",geometry:y,transform:w})}return _};return{normal:a(!1),focused:a(!0)}}(a,a,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),s=n(0,!1),c=n(2.25,!0),l=new ut.a({color:Qi,cullFace:2,renderOccluded:16}),h=new ut.a({color:Ji,cullFace:2,renderOccluded:16}),u=new ut.a({color:Ki,cullFace:2,renderOccluded:16}),d=new ut.a({color:ea,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),p=ge.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),b=ge.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),g=new Pi({color:$i,renderOccluded:4});return new He.a({view:e,renderObjects:[...s.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?h:u,transform:i,stateMask:1|Aa}))),...c.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:1|Aa}))),{geometry:p,material:g,stateMask:1|Aa|Da},...s.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?h:u,transform:i,stateMask:2|Aa}))),...c.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:2|Aa}))),{geometry:b,material:g,stateMask:2|Aa|Da}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[r]},collisionPriority:1,radius:11,state:Aa})}function Sa(e,t){var i=Ma(t),a=i?[Object(H.g)(1,0,0),Object(H.g)(0,0,0),Object(H.g)(0,1,0)]:[Object(H.g)(1,0,0),Object(H.g)(-1,0,0)],r=ge.a.createPolylineGeometry(a),n=[...Yi,1],s=i?4:1,o=2*s,c=e=>e>1?(e=>new J.a({color:n,width:e,renderOccluded:4}))(e):new Pi({color:n,renderOccluded:4}),l=[{geometry:r,material:c(s),stateMask:1|Ta},{geometry:r,material:c(o),stateMask:2|Ta},{geometry:r,material:c(1),stateMask:Ca}],h=new He.a({view:e,renderObjects:l,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4,idHint:i?1:2});return h.state=Ta,h}function Pa(e,t,i){var a=[];if(Object(o.k)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var r=0;r<12;r++){var n=r/12*2*Math.PI;a.push([Math.cos(n)*e,Math.sin(n)*e])}return ge.a.createPathExtrusionGeometry(a,i,[],[],!1)}function Ea(e,t){return Object(ri.b)(t,e.basis2,e.basis1)+Ra}var Aa=16,Da=32,Ra=(Nt.f.create(),Math.PI/2),Ta=16,Ca=32;class Ga{constructor(){this.lastDragEvent=null,this.next=new Ge.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(o.k)(this.lastDragEvent)){var t=Object(r.a)(Object(r.a)({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?Object(r.a)({},e):null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){var t=Ma(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}var ka=i(504),Ia=i(715),Va=i(716),za=i(717);function La(e,t){return qa(e,t,!1)}function Fa(e,t){return qa(e,t,!0)}function qa(e,t,i){if(e instanceof ka.b){if(e.operation instanceof Ia.a)return function(e,t,i=!1){var a=i?-1:1,r=Object(H.g)(a*e.dx,a*e.dy,a*e.dz);Object(U.e)(t.origin,t.origin,r)}(e.operation,t,i),!0;if(e.operation instanceof Va.a)return function(e,t,i=!1){var a=i?-e.angle:e.angle;Object(U.c)(t.basis1,t.basis1,H.b,a),Object(U.c)(t.basis2,t.basis2,H.b,a)}(e.operation,t,i),!0;if(e.operation instanceof za.a)return function(e,t,i=!1){var a=i?1/e.factor1:e.factor1,r=i?1/e.factor2:e.factor2;Object(U.d)(t.basis1,t.basis1,a),Object(U.d)(t.basis2,t.basis2,r),Ha(t.origin,e.origin,e.axis1,a),Ha(t.origin,e.origin,e.axis2,r)}(e.operation,t,i),!0}return!1}function Ha(e,t,i,a){var r=ht.c.get(),n=Object(ei.d)(r,e,t),s=Object(ei.a)(r,i,Object(ei.g)(i,n));Object(ei.o)(e,e,s,a-1)}var Ua=class extends(d.a.EventedMixin(O.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new Ga,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new De.a,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Nt.a.create(),this.mapBoundsStart=Nt.a.create(),this.displayBounds=Nt.a.create(),this.displayBoundsStart=Nt.a.create(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new _e({graphic:this.graphic});var e=this.graphic.geometry;this.reshapeHelper=new zt(Re.c.fromGeometry(e,this.view.viewingMode),e.type),this.graphicMoveManipulation=new wt({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=xa(this.view,0),this.moveZManipulator.state|=Da,this.handles.add(this.watch("enableZ",(()=>this.updateManipulatorAvailability(this.moveZManipulator,0)))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((e=>{var t=Sa(this.view,e);return this.handles.add(this.watch("enableScaling",(()=>this.updateManipulatorAvailability(t,2)))),t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this.handles.add(this._createResizeDragPipeline(t,e)),t})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new ti.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAK4UExURUdwTP9+AP9tAP9+AP99AP9VAP99AP99AP9+AP9+AP99AP99AP98AP8AAP99AP/9/P+ABf9/Af/Jlf////9/AP9/AP99AP9xAP9/AP94AP9+AP9+AP/16//38f9/AP97AP99AP99AP99AP9zAP9+AP9/AP/o0v/w4v+IE//PoP/59f+DCf99AP98AP+EC/+eQP/kyf/27//at/+VLf/59f+WL//8+/+LHP9+AP9/AP99AP/38P/nz//48/+dPv/7+P/NnP+HEf/8+v/9/f/8+//ewf+SKv/WsP+MHv98AP/27//17P/hxf++f//27v9+AP99AP+1bP98AP9+AP/o0/9+AP+BB/97AP/QpP98AP+uYP9/AP+AA/+QJP+rWP/q1v/Fjf+fQf/hx//Onv/fwP/9/P99AP/ev/+kTP+KGP+vYv/s2v9/AP+oU/+1b/98AP98AP96AP97AP9+AP9/AP9/AP96AP9/AP99AP/Ztf+rW/+mUP98AP+1b//48v/38f98AP+cO//38P99AP/nz//Pov99AP/HkP+fQ/+tX/99AP/69//v4P+6eP/DiP/z6P+TK/+JFv+EDf/s2//lzP+8ev96AP+8ff+YNP9/AP/Tqv+iSf96AP+tXv9/AP/Lm/98AP/lzP/Uq/+tXf/9/P/06f/Hk/+9fv/u3f/Klv/Spf+oVv+za/+jSv/Lmf/q1f/Gjv+1bf/69//Sp/+bOv/PoP+3c//z5/9/AP/Ikv/r1/+hRv/FjP/Mmv+ZN//06v/59P/69f/q1v/x5P9/AP+PI/+3cf/9+//8+v+gRP/16//o0//Ztf+nUv/17P/Hkf/ixv/s2v/59P/48//Di/+lT//ky//hxf/Wrv+oVf/u3f/w4//Wrf+5dv/gxP/7+f/z6P/dvP+6d//u3v+aOP/r2f/r2f///9a+uZsAAADndFJOUwB9B29qA1OAd38/RykBeP6BgLX+KhJ2CQgRdWHt8zpGOUVmC2sK2uaFu/aCQS+DktPwyIz3jfyHZz5o8tf1kvq4hPz+/c6LxIhi8e/RqvBjfKJaedtbgki8K54GgYqb3bGT0rnN/XDNloae30CZpFJUG0BlGhgZUjPHnJgto/PyUJHxUdi8dLKTnU/55aev64yGg+DWqDipjizAlTCdArgx1cCc/Ou0quG1vZqilrfcsaP4vpC6peoos96UsLeP7PX33OcyiaT8+5Tu2saY7rPR4Pb0sJfV0MKZ4ufBptD66sun4pDf3qyDniQAAAO+SURBVFjDpVf1WxRBGF7gYO64A+5OJKU7lFRaSlLARlBpsEVFwu7u7u7u7u7ubt1/w7vZPXZmd/bYffx+geed731vZme+oigR83NsGBNvpbSwUFrF29g6+lGybKxaoQKYqRTqRqlsS09/QDR/T0sJdOdwJRA15Ujntvgd3YBZU661M0dv3wO0aXntxfkaeyDB+mwQodv1BxJNTTyGtQ2QbDbWBH4/02qMBIXeQoVZrYt/h0vZA/8U3PmHtvs0SIKCF84v5Vbe0XQl/GfTgejAoKDFgY/nDSUpTMbun7u/zl1o+lUc6BrdneasQ06EQMDeFRFA3s97I2FIpAONm0OBQMKd49/m0OCXRvfd92iB1W3U8hQ2t8aPEwfq2T3TBFu1Hhdwc2EFwjlMt4d1vsH8meYR245TyO+KK9iy8Y/E70+TrwdN/wp5km6AVpSXBJnQpCo8NJn84IlAI1p/7UU5Au+6yaJP4zAFbyig4IBR3HZjyzDXwlgG3oHnKJj/EOA58sl+4OeNiGLgSgxtNgioAfaIuJt/gyucZhQ8gvkPGjlBVU30249R3ViFEbxrP8TIz0GxREP+V/FfmG75hy/6z18rvtfzFkKgQEoxmu0DKEfpaaQTEx53UUxDjZQuAPZCgQL8LY2RIZCbAT8jCrVQvjIEQF+4hWwEGUcNliOwEwpMQRArSilHoBAKXEYQJ8pCjsAJKKBHkJ7yBIZDgRpMQNYR1kCBC9gRZH3EK1DgLPYRZV1jNRQ4gl2jjIoIdFON/NSVCDSaasB9hr3+s0VUoBfcQCAKJWDBpK2v/kbTyaICFVDgKB5MaDj/rjM6ZA4wu4GMGDyc0YQCIqHLtXQif1gRXK1FsXg8pYFRTBFYrSXww5hIynyAgj4GgUYUqGWyWVaxMJswu6MnYGgTL62DuJmM28U7PH72frbmBQvSOlZYwGE2paYcR7sMrT6Uge8vIBQWSywclppq4cOQqyw042CRKdWvI5U2tLgaLI2rpvnJQ3KyZidxpeIZsbhSznh7uy+VJtuiJTh/rqm8U9vxhUnniPxbl3gftiPXouTxrjztpIAeqteKtzhok8VY2Rm8R1m2Lddsk0WoT7oBp44xd3f9UclEnfBlavBGUU0uZp3nx4SRI8uH3+pOB7JM0OoizbYUIzTb1NaF0vmjrYkTh5dEuspHbOQ5L6lI9CkVH5pc3dvmu7v+39g3vq3B0cXWzDmcbF0kzK4DvRVkusJ7oNTxudkrkT98J/o0yRvgAzQJNr7M+O/bkqAJEPP7B6FvZpCHDcaFAAAAAElFTkSuQmCC",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){var i=new da({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),a=40,r=27*1.1,n=e=>{var t=new Uint32Array([0,1,2,2,3,0]);return new ni.a([["position",{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},s=ge.a.createPolylineGeometry([[0,0,0],[13,0,0]]),o=ge.a.createPolylineGeometry([[0,0,0],[a-r,0,0]]),c=new Pi({color:Xi,renderOccluded:4}),l=[{geometry:n(27),material:i,stateMask:1|Aa},{geometry:s,material:c,stateMask:1|Aa},{geometry:n(r),material:i,stateMask:2|Aa},{geometry:o,material:c,stateMask:2|Aa}];return new He.a({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:13.5,state:Aa})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(()=>this.updateManipulatorAvailability(this.rotateManipulator,3)))),this.rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);var t=et({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(Ee.c)()});this.outlineVisualElement=t.visualElement instanceof ue?t.visualElement:null,Object(o.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this.updateDisplayBounds(this.mapBounds)))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.graphicState.watch("displaying",(()=>this.updateAllManipulatorAvailability())),Object(b.a)(this.graphicState,"isDraped",(()=>this.graphicDrapedChanged())),this.view.trackGraphicState(this.graphicState)]);var i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",(()=>this.updateDisplayBounds(this.mapBounds))));var a=e=>{this.handles.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()})))};this.forEachManipulator(a),this.graphicMoveManipulation.forEachManipulator(a);var n=(e,t)=>{this.handles.add(e.events.on("immediate-click",(e=>{1===t&&this.emit("immediate-click",Object(r.a)(Object(r.a)({},e),{},{graphic:this.graphic})),e.stopPropagation()})))};this.forEachManipulator(n),this.graphicMoveManipulation.forEachManipulator(n),this.onGeometryChanged(),this.updateAllManipulatorAvailability()}graphicDrapedChanged(){this.handles.remove(Ba),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(e=>{Object(o.k)(this.attachmentOrigin)&&Object(Ye.h)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds(this.mapBounds)})),Ba)}updateAllManipulatorAvailability(){this.forEachManipulator(((e,t)=>this.updateManipulatorAvailability(e,t)))}updateManipulatorAvailability(e,t){var i=this.graphicState.displaying,a=this.grabbing&&!e.grabbing;e.interactive=!a;var r=this.enableZ&&Le(this.graphic);switch(t){case 3:e.available=i&&this.enableRotation;break;case 2:e.available=i&&(this.enableScaling||this.enableRotation||r),e.interactive=!a&&this.enableScaling,e.state=this.enableScaling?Ta:Ca;break;case 0:e.available=i&&r;break;default:e.available=i}}forEachManipulator(e){this.resizeManipulators.forEach((t=>e(t,2))),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.reshapeHelper.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds(this.mapBounds)}calculateMapBounds(){var e=this.graphic.geometry,t=this.reshapeHelper.editGeometry,i=t.components[0].edges[0],a=Object(ei.d)(ht.c.get(),i.left.pos,i.right.pos);Object(ei.e)(a,a);var r=Object(o.r)(Object(Ve.f)(this.view,this.graphic),e.extent.center),n=Wa*this.view.pixelSizeAt(r),s=this.view.spatialReference;s!==e.spatialReference&&(n*=Object(Kt.f)(s)/Object(Kt.f)(e.spatialReference)),function(e,t,i,a){a||(a=Nt.a.create());var r=Object(ei.r)(ht.c.get(),e[1],-e[0]),n=Object(ei.r)(ht.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(ei.r)(ht.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=ht.c.get();t.components.forEach((t=>t.vertices.forEach((t=>{var i=t.pos;Object(ei.r)(o,Object(ei.g)(e,i),Object(ei.g)(r,i)),Object(ei.t)(n,n,o),Object(ei.u)(s,s,o)}))));var c=1e-6,l=Object(ei.r)(ht.c.get(),s[0]-n[0]<c?i/2:0,s[1]-n[1]<c?i/2:0);Object(ei.d)(n,n,l),Object(ei.h)(s,s,l),Object(ei.a)(a.basis1,e,(s[0]-n[0])/2),Object(ei.a)(a.basis2,r,(s[1]-n[1])/2),Object(ei.r)(a.origin,n[0]*e[0]+n[1]*r[0],n[0]*e[1]+n[1]*r[1]),Object(ei.h)(a.origin,a.origin,a.basis1),Object(ei.h)(a.origin,a.origin,a.basis2)}(a,t,n,this.mapBounds)}updateDisplayBounds(e){var t=this.graphic.geometry,i=Object(o.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(o.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(Ve.f)(this.view,this.graphic);this.attachmentOrigin=Object(o.r)(i,t.extent.center);var a=Object(o.k)(i)?i.z:Object(ve.c)(e.origin,this.view.elevationProvider,Q.a.fromElevationInfo(Object(m.d)(this.graphic)),this.view.renderCoordsHelper),r=Nt.a.copy(e);Object(U.v)(r.origin,e.origin[0],e.origin[1],a),function(e,t,i,a=0,r){r||(r=Nt.a.create()),t.toRenderCoords(e.origin,i,r.origin);var n=ht.d.get();Object(U.e)(n,e.origin,e.basis1),Object(U.e)(n,n,e.basis2),t.toRenderCoords(n,i,n);var s=ht.d.get();Object(U.e)(s,e.origin,e.basis1),Object(U.i)(s,s,e.basis2),t.toRenderCoords(s,i,s);var o=ht.d.get();Object(U.i)(o,e.origin,e.basis1),Object(U.i)(o,o,e.basis2),t.toRenderCoords(o,i,o);var c=ht.d.get();Object(U.i)(c,e.origin,e.basis1),Object(U.e)(c,c,e.basis2),t.toRenderCoords(c,i,c);var l=Object(U.h)(ht.d.get(),n,s,.5);Object(U.i)(l,l,r.origin);var h=Object(U.h)(ht.d.get(),o,c,.5);Object(U.i)(h,r.origin,h),Object(U.h)(r.basis1,l,h,.5);var u=Object(U.h)(ht.d.get(),c,n,.5);Object(U.i)(u,u,r.origin);var d=Object(U.h)(ht.d.get(),s,o,.5);Object(U.i)(d,r.origin,d),Object(U.h)(r.basis2,u,d,.5);var p=Object(U.f)(ht.d.get(),r.basis1,r.basis2),b=Object(U.f)(p,p,r.basis1);Object(U.q)(b,b),Object(U.d)(r.basis2,b,Object(U.g)(r.basis2,b)),Object(U.d)(r.basis1,r.basis1,1+a/Object(U.o)(r.basis1)),Object(U.d)(r.basis2,r.basis2,1+a/Object(U.o)(r.basis2)),Nt.a.updateUnboundedPlane(r)}(r,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}displayBoundsMargin(){var e=this.view.pointsOfInterest,t=e?e.focus.location:this.reshapeHelper.geometry.extent.center;return Na*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((e,t,i)=>this.applyGraphicMoveSteps(t,i)))}_createMoveZDragPipeline(){var e=this.view,t=this.reshapeHelper.geometry.spatialReference;return Object(Ge.e)(this.moveZManipulator,((i,a,r)=>{var n=Object(H.d)(i.renderLocation),s=a.next(Object(dt.g)(e,n,t)).next(Object(Ge.c)());this.applyGraphicMoveSteps(s,r)}))}applyGraphicMoveSteps(e,t){var i=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},Nt.a.copy(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next(Object(Ge.b)()).next(this._moveDragUpdateGeometry()).next((e=>{var t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e}));return t.next((()=>{Object(o.k)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()})),i}_moveDragUpdateGeometry(){return e=>{if(Object(o.j)(this.inputState)||"move"!==this.inputState.type)return e;var t=[];for(var i of this.reshapeHelper.editGeometry.components)t.push(...i.vertices);var a="start"===e.action?0:1;return La(this.reshapeHelper.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,a),this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onResizeGrab(e){if("start"===e.action){var t=this._calculatePickRay(e.screenPoint);Nt.e.intersectRay(this.displayBounds.plane,t,ht.d.get())&&(Nt.a.copy(this.displayBounds,this.displayBoundsStart),Nt.a.copy(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}}_createResizeDragPipeline(e,t){return Object(Ge.e)(e,((e,i,a)=>{Object(o.j)(this.inputState)||(i.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next(Object(dt.f)(this.view,this.displayBoundsStart.plane)).next((e=>Object(r.a)(Object(r.a)({},e),{},{handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((e=>{var t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),a.next((()=>{Object(o.k)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()})))}))}_resizeDragRenderPlaneToFactors(){return e=>{var t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin(),n=this.displayBoundsMarginStart,s=Object(U.j)(ht.d.get(),t.origin);Object(U.b)(s,s,t.basis1,-i[0]),Object(U.b)(s,s,t.basis2,-i[1]);var o=Object(U.i)(ht.d.get(),e.renderEnd,s),c=Object(U.i)(ht.d.get(),e.renderStart,s),l=Ma(e.handle),h=wa(t),u=wa(this.displayBounds)/h,d=(e,t)=>{if(0===e)return 1;var i=Object(U.o)(t),r=.5*e*Object(U.g)(t,o)/i,s=r<0?-1:1;l&&(r+=(i-.5*e*Object(U.g)(t,c)/i)*s*u);var h=i<1.5*n?1:Za;return i=Math.max(i-n,Za),s>0&&(r-=a),s*Math.max(s*(r/i),h)};return Object(r.a)(Object(r.a)({},e),{},{factor1:d(i[0],t.basis1),factor2:d(i[1],t.basis2)})}}_resizeDragUpdateGeometry(){return e=>{var t=Object(U.j)(Object(H.e)(),this.mapBoundsStart.origin);Object(U.b)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(U.b)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);var i=Object(ei.r)(Object($t.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(ei.e)(i,i);var a=[];for(var r of this.reshapeHelper.editGeometry.components)a.push(...r.vertices);var n="start"===e.action?0:1,s=this.reshapeHelper.scaleVertices(a,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(t),i,e.factor1,e.factor2,n,1);return Nt.a.copy(this.mapBoundsStart,this.mapBounds),La(s,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_onRotateGrab(e){if("start"===e.action){var t=function(e,t,i,a){var r=t.worldUpAtPosition(e.origin,ht.d.get()),n=ht.d.get();switch(i){case 1:Object(U.j)(n,r);break;case 2:Object(U.j)(n,e.basis1)}return Nt.e.fromPositionAndNormal(e.origin,n,a)}(this.displayBounds,this.view.renderCoordsHelper,1,Nt.e.create()),i=this._calculatePickRay(e.screenPoint);Nt.e.intersectRay(t,i,ht.d.get())&&(Nt.a.copy(this.displayBounds,this.displayBoundsStart),Nt.a.copy(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}_createRotateDragPipeline(e){return Object(Ge.e)(e,((e,t,i)=>{var a=this.inputState;Object(o.j)(a)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next(Object(dt.f)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((e=>{var t={graphic:this.graphic,angle:Object(Fe.q)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),i.next((()=>{Object(o.k)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{var i=Nt.e.normal(e.rotatePlane),a=Object(Ve.a)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return Object(r.a)(Object(r.a)({},t),{},{rotateAxis:i,rotateAngle:a})}}_rotateDragUpdateGeometry(){return e=>{var t=Object(U.j)(Object(H.e)(),this.mapBoundsStart.origin),i=[];for(var a of this.reshapeHelper.editGeometry.components)i.push(...a.vertices);var r="start"===e.action?0:1,n=this.reshapeHelper.rotateVertices(i,this.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(t),e.rotateAngle,r,1);return Nt.a.copy(this.mapBoundsStart,this.mapBounds),La(n,this.mapBounds),this.graphic.geometry=this.reshapeHelper.geometry,e}}_calculatePickRay(e){var t=Nt.f.create(),i=Object(Bt.j)(e);return Nt.f.fromScreen(this.view.state.camera,i,t),Object(U.q)(t.direction,t.direction),t}updateManipulators(){if(this.visible){var e=function(e,t){return Object(Ve.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,ht.a.get());(function(e,t,i,a){var r=a.worldUpAtPosition(i.origin,ht.d.get()),n=ya(i,0),s=Object($.i)(ht.a.get());Object($.g)(s,s,n.edge*Math.PI/2),Object($.e)(s,s,-Ea(i,r)),Object($.l)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach(((t,i)=>{!function(e,t,i,a){var r=Object(U.o)(a.basis1),n=Object(U.o)(a.basis2),s=_a(a),o=wa(a),c=Object(U.v)(ht.d.get(),0,0,0);Object(U.e)(c,Object(U.d)(ht.d.get(),a.basis1,t.direction[0]),Object(U.d)(ht.d.get(),a.basis2,t.direction[1])),Object(U.e)(c,a.origin,c);var l=0,h=1;if(Ma(t))1===t.direction[0]&&-1===t.direction[1]?l=Ra:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),h=o;else{var u=0!==t.direction[0]?1:2;l=1===u?Ra:0,h=(1===u?n:r)-s}var d=Object($.i)(ht.a.get());Object($.g)(d,d,l),Object($.r)(d,d,Object(U.v)(ht.d.get(),h,h,h)),Object($.l)(d,i,d),d[12]=0,d[13]=0,d[14]=0,e.modelTransform=d,e.renderLocation=c}(t,this.resizeHandles[i],e,this.displayBounds)}))}}updateZMoveHandle(e,t){var i=this.displayBounds,a={basis:i.basis1,direction:-1,position:Object(U.i)(ht.d.get(),i.origin,i.basis1),edge:2},r=ht.a.get();Object($.g)(r,t,a.edge*Math.PI/2),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}cancel(){var e=this.reshapeHelper.editGeometry.lastOperation;Object(o.j)(e)||(this.reshapeHelper.undo(),this.graphic.geometry=this.reshapeHelper.geometry,Fa(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}canUndo(){return this.reshapeHelper.canUndo}undo(){if(Object(o.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo()){var e=this.reshapeHelper.undo();this.graphic.geometry=this.reshapeHelper.geometry,Fa(Object(o.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}canRedo(){return this.reshapeHelper.canRedo}redo(){if(this.canRedo()){var e=this.reshapeHelper.redo();this.graphic.geometry=this.reshapeHelper.geometry,La(Object(o.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}};Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Ua.prototype,"view",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Ua.prototype,"graphic",void 0),Object(n.a)([Object(h.b)({constructOnly:!0,nonNullable:!0})],Ua.prototype,"enableZ",void 0),Object(n.a)([Object(h.b)()],Ua.prototype,"enableRotation",void 0),Object(n.a)([Object(h.b)()],Ua.prototype,"enableScaling",void 0),Object(n.a)([Object(h.b)()],Ua.prototype,"preserveAspectRatio",null),Object(n.a)([Object(h.b)()],Ua.prototype,"grabbing",void 0),Object(n.a)([Object(h.b)()],Ua.prototype,"inputState",void 0),Object(n.a)([Object(h.b)({readOnly:!0})],Ua.prototype,"type",void 0),Ua=Object(n.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Ua);var Ba="draped-elevation-changes",Na=10,Wa=80,Za=1e-6},421:function(e,t,i){"use strict";function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,i=0,a=0;a<e.length;a++){var r=e[a].size;"number"==typeof r&&(t+=r,i++)}return t/i}(e.stops):t}function n(e,t){if(!t)return e;var i=t.filter((e=>"size"===e.type)).map((t=>{var{maxSize:i,minSize:a}=t;return(r(i,e)+r(a,e))/2})),a=0,n=i.length;if(0===n)return e;for(var s=0;s<n;s++)a+=i[s];var o=Math.floor(a/n);return Math.max(o,e)}function s(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var r="visualVariables"in t?n(i,t.visualVariables):i;if("simple"===t.type)return a(r,t.symbol);if("unique-value"===t.type){var s=r;return t.uniqueValueInfos.forEach((e=>{s=a(s,e.symbol)})),s}if("class-breaks"===t.type){var o=r;return t.classBreakInfos.forEach((e=>{o=a(o,e.symbol)})),o}return t.type,r}i.d(t,"a",(function(){return s}))},466:function(e,t,i){"use strict";function a(e){return"h"in e&&"s"in e&&"v"in e}function r(e){return"l"in e&&"a"in e&&"b"in e}function n(e){return"l"in e&&"c"in e&&"h"in e}function s(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return f}));var o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],c=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){var i,a,r=[];if(e[0].length!==t.length)throw"dimensions do not match";var n=e.length,s=e[0].length,o=0;for(i=0;i<n;i++){for(o=0,a=0;a<s;a++)o+=e[i][a]*t[a];r.push(o)}return r}function h(e){var t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4))),i=l(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function u(e){var t=l(c,[e.x/100,e.y/100,e.z/100]).map((e=>{var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function d(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){var t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function b(e){return d(h(e))}function g(e){return u(p(e))}function v(e){return function(e){var t=e.l,i=e.a,a=e.b,r=Math.sqrt(i*i+a*a),n=Math.atan2(a,i);return{l:t,c:r,h:n=n>0?n:n+2*Math.PI}}(d(h(e)))}function m(e){return u(p(function(e){var t=e.l,i=e.c,a=e.h;return{l:t,a:i*Math.cos(a),b:i*Math.sin(a)}}(e)))}function f(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:n(e)?m(e):r(e)?g(e):s(e)?u(e):a(e)?function(e){var t,i=(e.h+360)%360/60,a=e.s/100,r=e.v/100*255,n=r*a,s=n*(1-Math.abs(i%2-1));switch(Math.floor(i)){case 0:t={r:n,g:s,b:0};break;case 1:t={r:s,g:n,b:0};break;case 2:t={r:0,g:n,b:s};break;case 3:t={r:0,g:s,b:n};break;case 4:t={r:s,g:0,b:n};break;case 5:case 6:t={r:n,g:0,b:s};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+r-n),t.g=Math.round(t.g+r-n),t.b=Math.round(t.b+r-n),t}(e):e}function O(e){return a(e)?e:function(e){var t=e.r,i=e.g,a=e.b,r=Math.max(t,i,a),n=r-Math.min(t,i,a),s=r,o=0===n?0:r===t?(i-a)/n%6:r===i?(a-t)/n+2:(t-i)/n+4,c=0===n?0:n/s;return o<0&&(o+=6),{h:o*=60,s:c*=100,v:s*=100/255}}(f(e))}function j(e){return r(e)?e:b(f(e))}function y(e){return n(e)?e:v(f(e))}function _(e,t){var i=b(e);return i.l*=1-t,g(i)}},482:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var a=i(89),r=i(103),n=(i(101),i(117)),s=i(421);function o(e,t,i,s=new r.a){var o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){var c=i.overlayPixelSizeInMapUnits(e),l=i.basemapSpatialReference;o=Object(a.k)(l)&&!l.equals(i.spatialReference)?Object(n.f)(l)/Object(n.f)(i.spatialReference):t*c}var h=e.x-o,u=e.y-o,d=e.x+o,p=e.y+o,{spatialReference:b}=i;return s.xmin=Math.min(h,d),s.ymin=Math.min(u,p),s.xmax=Math.max(h,d),s.ymax=Math.max(u,p),s.spatialReference=b,s}function c(e,t,i){var r=i.toMap(e);return!Object(a.j)(r)&&o(r,Object(s.a)(),i,l).intersects(t)}var l=new r.a},485:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var a=i(113),r=i(103),n=i(225),s=i(130),o=i(141),c={convertToGEGeometry:function(e,t){if(null==t)return null;var i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){var r=e.hasZ(t),n=e.hasM(t),s=new a.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(s.z=e.getPointZ(t)),n&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s},exportPolygon:function(e,t,i){var a=new s.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return a.cache._geVersion=t,a},exportPolyline:function(e,t,i){var a=new o.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return a.cache._geVersion=t,a},exportMultipoint:function(e,t,i){var a=new n.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return a.cache._geVersion=t,a},exportExtent:function(e,t,i){var a=e.hasZ(t),n=e.hasM(t),s=new r.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(a){var o=e.getZExtent(t);s.zmin=o.vmin,s.zmax=o.vmax}if(n){var c=e.getMExtent(t);s.mmin=c.vmin,s.mmax=c.vmax}return s.cache._geVersion=t,s}}},502:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return P})),i.d(t,"clip",(function(){return o})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return y})),i.d(t,"crosses",(function(){return h})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return V})),i.d(t,"difference",(function(){return _})),i.d(t,"disjoint",(function(){return v})),i.d(t,"distance",(function(){return u})),i.d(t,"equals",(function(){return d})),i.d(t,"extendedSpatialReferenceInfo",(function(){return s})),i.d(t,"flipHorizontal",(function(){return G})),i.d(t,"flipVertical",(function(){return k})),i.d(t,"generalize",(function(){return I})),i.d(t,"geodesicArea",(function(){return q})),i.d(t,"geodesicBuffer",(function(){return E})),i.d(t,"geodesicDensify",(function(){return z})),i.d(t,"geodesicLength",(function(){return H})),i.d(t,"intersect",(function(){return M})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return O})),i.d(t,"nearestCoordinate",(function(){return A})),i.d(t,"nearestVertex",(function(){return D})),i.d(t,"nearestVertices",(function(){return R})),i.d(t,"offset",(function(){return S})),i.d(t,"overlaps",(function(){return m})),i.d(t,"planarArea",(function(){return L})),i.d(t,"planarLength",(function(){return F})),i.d(t,"relate",(function(){return f})),i.d(t,"rotate",(function(){return C})),i.d(t,"simplify",(function(){return j})),i.d(t,"symmetricDifference",(function(){return w})),i.d(t,"touches",(function(){return b})),i.d(t,"union",(function(){return x})),i.d(t,"within",(function(){return g}));var a=i(503),r=i(485);function n(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return a.a.extendedSpatialReferenceInfo(e)}function o(e,t){return a.a.clip(r.hydratedAdapter,n(e),e,t)}function c(e,t){return a.a.cut(r.hydratedAdapter,n(e),e,t)}function l(e,t){return a.a.contains(r.hydratedAdapter,n(e),e,t)}function h(e,t){return a.a.crosses(r.hydratedAdapter,n(e),e,t)}function u(e,t,i){return a.a.distance(r.hydratedAdapter,n(e),e,t,i)}function d(e,t){return a.a.equals(r.hydratedAdapter,n(e),e,t)}function p(e,t){return a.a.intersects(r.hydratedAdapter,n(e),e,t)}function b(e,t){return a.a.touches(r.hydratedAdapter,n(e),e,t)}function g(e,t){return a.a.within(r.hydratedAdapter,n(e),e,t)}function v(e,t){return a.a.disjoint(r.hydratedAdapter,n(e),e,t)}function m(e,t){return a.a.overlaps(r.hydratedAdapter,n(e),e,t)}function f(e,t,i){return a.a.relate(r.hydratedAdapter,n(e),e,t,i)}function O(e){return a.a.isSimple(r.hydratedAdapter,n(e),e)}function j(e){return a.a.simplify(r.hydratedAdapter,n(e),e)}function y(e,t=!1){return a.a.convexHull(r.hydratedAdapter,n(e),e,t)}function _(e,t){return a.a.difference(r.hydratedAdapter,n(e),e,t)}function w(e,t){return a.a.symmetricDifference(r.hydratedAdapter,n(e),e,t)}function M(e,t){return a.a.intersect(r.hydratedAdapter,n(e),e,t)}function x(e,t=null){return a.a.union(r.hydratedAdapter,n(e),e,t)}function S(e,t,i,s,o,c){return a.a.offset(r.hydratedAdapter,n(e),e,t,i,s,o,c)}function P(e,t,i,s=!1){return a.a.buffer(r.hydratedAdapter,n(e),e,t,i,s)}function E(e,t,i,s,o,c){return a.a.geodesicBuffer(r.hydratedAdapter,n(e),e,t,i,s,o,c)}function A(e,t,i=!0){return a.a.nearestCoordinate(r.hydratedAdapter,n(e),e,t,i)}function D(e,t){return a.a.nearestVertex(r.hydratedAdapter,n(e),e,t)}function R(e,t,i,s){return a.a.nearestVertices(r.hydratedAdapter,n(e),e,t,i,s)}function T(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function C(e,t,i){var r;if(null==e)throw new Error("Illegal Argument Exception");var n=e.spatialReference;if(null==(i=null!=(r=i)?r:T(e)))throw new Error("Illegal Argument Exception");var s=e.constructor.fromJSON(a.a.rotate(e,t,i));return s.spatialReference=n,s}function G(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");var r=e.spatialReference;if(null==(t=null!=(i=t)?i:T(e)))throw new Error("Illegal Argument Exception");var n=e.constructor.fromJSON(a.a.flipHorizontal(e,t));return n.spatialReference=r,n}function k(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");var r=e.spatialReference;if(null==(t=null!=(i=t)?i:T(e)))throw new Error("Illegal Argument Exception");var n=e.constructor.fromJSON(a.a.flipVertical(e,t));return n.spatialReference=r,n}function I(e,t,i,s){return a.a.generalize(r.hydratedAdapter,n(e),e,t,i,s)}function V(e,t,i){return a.a.densify(r.hydratedAdapter,n(e),e,t,i)}function z(e,t,i,s=0){return a.a.geodesicDensify(r.hydratedAdapter,n(e),e,t,i,s)}function L(e,t){return a.a.planarArea(r.hydratedAdapter,n(e),e,t)}function F(e,t){return a.a.planarLength(r.hydratedAdapter,n(e),e,t)}function q(e,t,i){return a.a.geodesicArea(r.hydratedAdapter,n(e),e,t,i)}function H(e,t,i){return a.a.geodesicLength(r.hydratedAdapter,n(e),e,t,i)}},605:function(e,t,i){"use strict";i.d(t,"a",(function(){return P}));var a=i(180),r=i(89),n=i(126),s=i(113),o=(i(101),i(131)),c=i(110),l=i(105),h=i(104),u=i(111),d=i(173),p=i(157),b=i(125),g=i(223),v=i(332),m=i(174),f=i(305),O=i(135),j=i(583),y=i(177),_=i(255),w=i(453),M=i(698),x=i(480),S=i(509);class P{constructor(e){for(var t in this.idHint=0,this.camera=new M.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(m.b)(),this._worldFrame=null,this._renderLocation=Object(h.e)(),this._renderLocationDirty=!0,this._location=new s.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new s.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new o.a.EventEmitter,this._screenLocation={screenPointArray:Object(l.g)(),renderScreenPointArray:Object(l.e)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference,e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(n.d)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){E(e)&&(this._screenLocationDirty=!0),Object(p.c)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(m.b)()),function(e,t,i){switch(e.viewingMode){case"local":return Object(p.i)(i),!0;case"global":var a=Object(d.e)(e.renderCoordsHelper.spatialReference);Object(g.t)(t,0,I,0,a.radius),Object(g.c)(Object(c.f)(I[1]),Object(c.f)(I[0]),i)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(x.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(x.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=Object(r.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,E(this._modelTransform)){var t=this._calculateModelTransformOffset(q);e=Object(u.e)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;var i=Object(l.j)(e,A),n=this._getCollisionRadius(t),s=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(O.j)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+s;break;case"line":var o=this.collisionType.paths,c=this._getWorldToScreenObjectScale(),d=this._calculateObjectTransform(c,G),p=n*this.screenLocation.pixelSize,b=_.f.fromScreen(this.camera,i,R);if(Object(r.j)(b))return null;for(var g of o)if(0!==g.length)for(var v=Object(u.l)(I,g[0],d),m=1;m<g.length;m++){var j=Object(u.l)(V,g[m],d),w=_.d.closestRayDistance2(_.d.fromPoints(v,j,D),b);if(null!=w&&w<p*p){var M=Object(u.e)(y.d.get(),v,j);Object(u.d)(M,M,.5);var x=Object(l.a)(y.d.get());return this.camera.projectToRenderScreen(M,x),x[2]+s}Object(u.j)(v,j)}break;case"disc":var S,P=this.collisionType.direction,E=null!=(S=this.collisionType.offset)?S:h.b,C=this._getWorldToScreenObjectScale(),q=this._calculateObjectTransform(C,G),H=n*this.screenLocation.pixelSize,U=_.f.fromScreen(this.camera,i,R);if(Object(r.j)(U))return null;var B=Object(f.d)(T,q),N=Object(u.w)(L,P,B),W=Object(u.l)(F,E,q);_.e.fromPositionAndNormal(W,N,k);var Z=z;if(_.e.intersectRay(k,U,Z)&&Object(u.k)(Z,W)<H*H)return this.screenLocation.renderScreenPointArray[2]+s;break;case"ribbon":var{paths:Y,direction:X}=this.collisionType,Q=this._getWorldToScreenObjectScale(),J=this._calculateObjectTransform(Q,G),K=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),$=_.f.fromScreen(this.camera,i,R);if(Object(r.j)($))return null;var ee=Object(f.d)(T,J),te=Object(u.w)(L,X,ee),ie=this._calculateModelTransformPosition(F);_.e.fromPositionAndNormal(ie,te,k);var ae=z;if(!_.e.intersectRay(k,$,ae))break;for(var re of Y)if(0!==re.length)for(var ne=Object(u.l)(I,re[0],J),se=1;se<re.length;se++){var oe=Object(u.l)(V,re[se],J),ce=_.d.distance2(_.d.fromPoints(ne,oe,D),ae);if(null!=ce&&ce<K*K){var le=Object(u.e)(y.d.get(),ne,oe);Object(u.d)(le,le,.5);var he=Object(l.a)(y.d.get());return this.camera.projectToRenderScreen(le,he),he[2]+s}Object(u.j)(ne,oe)}break;default:Object(a.a)(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(this.view._stage){var i=e.manipulator3D;if(Object(r.j)(i.engineLayerId)){var a=new S.a({isPickable:!1});this.view._stage.add(a),i.engineLayerId=a.id,this._engineLayer=a}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(r.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(g.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new s.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}detach(e={manipulator3D:{}}){var t=e.manipulator3D;t.engineLayerReferences--;var i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(g.n)(this.location,H,e.spatialReference),Object(b.f)(e.extent,H)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(r.j)(this.elevationInfo))return!1;var t=null,i=0,a=Object(r.r)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(r.r)(Object(j.a)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(r.r)(Object(j.a)(this.view.elevationProvider,e,"ground"),0)+a;break;case"relative-to-scene":i=Object(r.r)(Object(j.a)(this.view.elevationProvider,e,"scene"),0)+a;break;case"absolute-height":i=a}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=G;if(!0===this.autoScaleRenderObjects){var i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);var{objectsByState:a}=this._ensureEngineResources(),n=(this.focused?2:1)|(this.selected?8:4),s=this._noDisplayCount>0;for(var{stateMask:o,objects:c}of a)if(s)for(var l of c)l.setVisible(!1);else{var h=!(0!=(15&o))||(n&o)==(15&o),u=!(0!=(65520&o))||(this.state&o)==(65520&o);if(h&&u)for(var d of c)d.setVisible(!0),d.transformation=t;else for(var p of c)p.setVisible(!1)}Object(r.k)(this._engineLayer)&&this._engineLayer.commit()}else this._removeResourcesFromStage()}_ensureEngineResources(){if(Object(r.j)(this._engineResources)){var e=Object(r.q)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));var a=new Map;this._renderObjects.forEach((e=>{var t=new w.a({castShadow:!1});((e,t)=>{var{geometry:i,material:a,transform:r}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,a,r))):e.addGeometry(i,a,r)})(t,e);var i=e.stateMask||0,r=a.get(i)||[];r.push(t),a.set(i,r)}));var n=[];a.forEach(((e,t)=>n.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(!this._engineResourcesAddedToStage&&!Object(r.j)(this._engineResources)){var{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{var t=Object(r.q)(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>e.forEach((e=>{t.add(e),this.view._stage.add(e)})))),this._engineResourcesAddedToStage=!0}}_removeResourcesFromStage(e=!1){if(this._engineResourcesAddedToStage&&!Object(r.j)(this._engineResources)){var{objectsByState:t,layer:i,materials:a}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),a.forEach((e=>{var t=Object(r.q)(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){var t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,C);return Object(u.v)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){var t=this._calculateModelTransformPosition(e);return Object(u.i)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(p.d)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(p.l)(t,t,this._worldFrame),Object(p.l)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(r.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){var e=!1;if(Object(r.k)(this._engineResources))for(var t in this._engineResources.objectsByState){var i=this._engineResources.objectsByState[t];for(var a of i.objects)if(a.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function E(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var A=Object(l.g)(),D=_.d.create(),R=_.f.create(),T=Object(v.a)(),C=Object(m.b)(),G=Object(m.b)(),k=_.e.create(),I=Object(h.e)(),V=Object(h.e)(),z=Object(h.e)(),L=Object(h.e)(),F=Object(h.e)(),q=Object(h.e)(),H=new s.a({x:0,y:0,z:0,spatialReference:null})},624:function(e,t,i){"use strict";function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return a}))},634:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return P})),i.d(t,"f",(function(){return S}));var a=i(89),r=i(104),n=i(111),s=i(157),o=i(332),c=i(174),l=i(396),h=i(200),u=i(305),d=i(191),p=i(533),b=i(461),g=i(398),v=(i(549),i(255)),m=i(453);class f{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}class O{constructor(){this._transform=Object(c.b)(),this._transformInverse=new j({value:this._transform},s.a,c.b),this._transformInverseTranspose=new j(this._transformInverse,s.b,c.b),this._transformTranspose=new j({value:this._transform},s.b,c.b),this._transformInverseRotation=new j({value:this._transform},u.b,o.a)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s.c)(this._transform,e)}multiplyTransform(e){Object(s.l)(this._transform,this._transform,e)}set(e){Object(s.c)(this._transform,e),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}class j{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class y{constructor(){this.min=new _,this.max=new _,this.hud=new _,this.ground=new _}init(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}class _{constructor(e){this.normal=Object(r.e)(),this.transformation=Object(c.b)(),this._ray=v.f.create(),this.init(e)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return Object(n.d)(E,this.ray.direction,this.dist),Object(n.o)(E)}getIntersectionPoint(e){return!!this.hasIntersectionPoint&&(Object(n.d)(E,this.ray.direction,this.dist),Object(n.e)(e,this.ray.origin,E),!0)}getTransformedNormal(e){return Object(n.j)(A,this.normal),A[3]=0,Object(d.m)(A,A,this.transformation),Object(n.j)(e,A),Object(n.q)(e,e),e}init(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?v.f.copy(e,this._ray):this._ray=v.f.create()}set(e,t,i,a,o,c,l,h,u,d){e instanceof m.a&&(e={type:"stage",obj:e}),this.dist=i,Object(n.j)(this.normal,a),Object(s.c)(this.transformation,o),this.target=e,this.name=t,this.drapedLayerOrder=c,this.center=l?Object(r.d)(l):null,this.geometryId=h,this.triangleNr=u,this.drapedLayerGraphicOrder=d}copyFrom(e){v.f.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(r.d)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(n.j)(this.normal,e.normal),Object(s.c)(this.transformation,e.transformation)}toOwner(e){if(!this.target)return null;switch(this.target.type){case"stage":return w(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e,t){var i=e.metadata.layerUid;return null!=i?t.map.findLayerByUid(i):null}(this.target,e);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return w(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null}toGraphic(e){if(!this.target)return null;switch(this.target.type){case"stage":return M(this.target.obj.metadata,e);case"external":switch(this.intersector){case"PointRenderer":return function(e){return e.metadata.createGraphic()}(this.target);case"I3S":case"IM":case"LodRenderer":case"OverlayRenderer":return M(this.target.metadata,e)}}return null}}function w(e,t){return Object(a.j)(e)||null==e.layerUid?null:Object(a.k)(t.graphicsView)&&e.layerUid===t.graphicsView.graphics3d.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function M(e,t){if(Object(a.j)(e))return null;var i=w(e,t);if(Object(a.j)(i))return null;if(i===t.graphics)return Object(a.k)(t.graphicsView)?Object(a.q)(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var r,n,s=t.allLayerViews.find((e=>e.layer===i));return s?(n=e,!(r=s)||r.suspended?null:"getGraphicFromIntersectorMetadata"in r&&n?r.getGraphicFromIntersectorMetadata(n):"getGraphicFromGraphicUid"in r&&null!=n.graphicUid?r.getGraphicFromGraphicUid(n.graphicUid):null):null}var x=new class{constructor(e=0){this.offset=e,this.sphere=Object(g.b)(),this.tmpVertex=Object(r.e)()}applyToVertex(e,t,i){var a=this.objectTransform.transform,r=a[0]*e+a[4]*t+a[8]*i+a[12],n=a[1]*e+a[5]*t+a[9]*i+a[13],s=a[2]*e+a[6]*t+a[10]*i+a[14],o=this.offset/Math.sqrt(r*r+n*n+s*s);r+=r*o,n+=n*o,s+=s*o;var c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*r+c[4]*n+c[8]*s+c[12],this.tmpVertex[1]=c[1]*r+c[5]*n+c[9]*s+c[13],this.tmpVertex[2]=c[2]*r+c[6]*n+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){var i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;var a=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*a,t[1]+=t[1]*a,t[2]+=t[2]*a}applyToAabb(e){var t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;var i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function S(e){return Object(a.k)(e)?(x.offset=e,x):null}new class{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(r.e)(),this.mbs=Object(h.c)(),this.obb={center:Object(r.e)(),halfSize:Object(b.b)(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){var a=e,r=t,n=i+this.componentLocalOriginLength,s=this.offset/Math.sqrt(a*a+r*r+n*n);return this.tmpVertex[0]=e+a*s,this.tmpVertex[1]=t+r*s,this.tmpVertex[2]=i+n*s,this.tmpVertex}applyToAabb(e){var t=e[0],i=e[1],a=e[2]+this.componentLocalOriginLength,r=e[3],n=e[4],s=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+i*i+a*a);e[0]+=t*o,e[1]+=i*o,e[2]+=a*o;var c=this.offset/Math.sqrt(r*r+n*n+s*s);return e[3]+=r*c,e[4]+=n*c,e[5]+=s*c,e}applyToMbs(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){var t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(n.t)(this.obb.halfSize,e.halfSize,e.quaternion),Object(n.e)(this.obb.halfSize,this.obb.halfSize,e.center);var a=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*a,this.obb.halfSize[1]+=this.obb.halfSize[1]*a,this.obb.halfSize[2]+=this.obb.halfSize[2]*a,Object(n.i)(this.obb.halfSize,this.obb.halfSize,e.center),Object(p.a)(D,e.quaternion),Object(n.t)(this.obb.halfSize,this.obb.halfSize,D),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}};new class{constructor(e=0){this.offset=e,this.tmpVertex=Object(r.e)()}applyToVertex(e,t,i){var a=e+this.localOrigin[0],r=t+this.localOrigin[1],n=i+this.localOrigin[2],s=this.offset/Math.sqrt(a*a+r*r+n*n);return this.tmpVertex[0]=e+a*s,this.tmpVertex[1]=t+r*s,this.tmpVertex[2]=i+n*s,this.tmpVertex}applyToAabb(e){var t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],a=e[2]+this.localOrigin[2],r=e[3]+this.localOrigin[0],n=e[4]+this.localOrigin[1],s=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+i*i+a*a);e[0]+=t*o,e[1]+=i*o,e[2]+=a*o;var c=this.offset/Math.sqrt(r*r+n*n+s*s);return e[3]+=r*c,e[4]+=n*c,e[5]+=s*c,e}};var P="terrain",E=(Object(r.e)(),Object(r.e)()),A=Object(h.c)(),D=Object(l.a)()},635:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return O})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return j}));var a=i(91),r=i(89),n=i(110),s=i(105),o=i(104),c=i(111),l=i(223),h=i(340),u=i(177),d=i(255),p=i(634),b=i(758),g=i(397);function v(e,t){var i=Object(o.e)(),n=Object(o.e)(),c=!1;return o=>{if("start"===o.action){var l=Object(s.j)(o.screenStart,Object(s.c)(u.c.get())),h=d.f.fromScreen(e.state.camera,l,x);Object(r.k)(h)&&(c=d.e.intersectRay(t,h,i))}if(!c)return null;var p=Object(s.j)(o.screenEnd,Object(s.c)(u.c.get())),b=d.f.fromScreen(e.state.camera,p,x);return Object(r.j)(b)?null:d.e.intersectRay(t,b,n)?Object(a.a)(Object(a.a)({},o),{},{renderStart:i,renderEnd:n,plane:t,ray:b}):null}}function m(e,t,i,n=null,o=null){return function(e,t,i,n=null,o=null){var c=null;return h=>{if("start"===h.action&&(c=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(s.g)(h.screenStart.x,h.screenStart.y),t,i,o),Object(r.k)(c)&&Object(r.k)(n)&&!Object(l.n)(c,c,n)))return null;if(Object(r.j)(c))return null;var u=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(s.g)(h.screenEnd.x,h.screenEnd.y),t,i,o);return Object(r.k)(u)?Object(r.k)(n)&&!Object(l.n)(u,u,n)?null:Object(a.a)(Object(a.a)({},h),{},{mapStart:c,mapEnd:u}):null}}(e,i,Object(h.f)(t,e,i),n,o)}function f(e,t,i,a=null,r=null){return m(e,i,Object(h.d)(t),a,r)}function O(e,t,i,a){var n=t.toMap(e.screenStart,{include:[i]});return Object(r.k)(n)?f(t,i,n,a):null}function j(e,t,i){var s=null,l=new g.a;return l.next(v(e,function(e,t){var i=w,a=M,r=d.e.create();e.renderCoordsHelper.worldUpAtPosition(t,i);var n=Object(c.f)(r,i,Object(c.i)(a,t,e.state.camera.eye));return Object(c.f)(n,n,i),d.e.fromPositionAndNormal(t,n,r)}(e,t))).next(function(e,t){var i=Object(o.e)(),a=Object(c.o)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);var r=Object(o.e)(),s=Object(o.e)(),l=r=>(Object(c.i)(r,r,t),d.h.projectPoint(i,r,r),"global"===e.viewingMode&&Object(c.o)(r)*Object(n.r)(Object(c.g)(i,r))<.001-a&&Object(c.i)(r,Object(c.d)(r,i,.001),t),Object(c.e)(r,r,t),r);return e=>(e.renderStart=l(Object(c.j)(r,e.renderStart)),e.renderEnd=l(Object(c.j)(s,e.renderEnd)),e)}(e,t)).next(function(e,t){var i=e.renderCoordsHelper;return e=>{var n=i.fromRenderCoords(e.renderStart,t),s=i.fromRenderCoords(e.renderEnd,t);return Object(r.k)(n)&&Object(r.k)(s)?Object(a.a)(Object(a.a)({},e),{},{mapStart:n,mapEnd:s}):null}}(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,s=e})),e=>(s=null,l.execute(e),s)}function y(e){var t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":Object(r.k)(t)&&(t.remove(),t=null)}return i}}function _(e,t=null){var i=new b.a(e.state.mode);i.options.selectionMode=!0,i.options.store=0;var n,c=Object(s.g)(),l={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},h=Object(o.e)(),u=Object(r.r)(t,e.spatialReference),d=t=>{e.map.ground&&e.map.ground.opacity<1?l.exclude.add(p.e):l.exclude.delete(p.e),e.sceneIntersectionHelper.intersectIntersectorScreen(Object(s.j)(t,c),i,l);var a,r=i.results.min;if(r.getIntersectionPoint(h))a="TerrainRenderer"===r.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(h))return null;a=0}return{location:e.renderCoordsHelper.fromRenderCoords(h,u),surfaceType:a}};return e=>{if("start"===e.action){var t=d(e.screenStart);n=Object(r.k)(t)?t.location:null}if(Object(r.j)(n))return null;var i=d(e.screenEnd);return Object(r.k)(i)&&Object(r.k)(i.location)?Object(a.a)(Object(a.a)({},e),{},{mapStart:n,mapEnd:i.location,surfaceType:i.surfaceType}):null}}var w=Object(o.e)(),M=Object(o.e)(),x=d.f.create()},651:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return f})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return O})),i.d(t,"g",(function(){return j}));var a=i(89),r=i(111),n=i(157),s=i(200),o=i(177),c=i(370),l=i(480),h=i(584),u=i(560),d=i(605),p=i(802);function b(e,t=4){var i=Object(s.d)(e[0],e[1],e[2],e.length>3?e[3]:1),a=e[3]<1;return new p.a({color:i,transparent:a,writeDepth:!0,cullFace:2,renderOccluded:t})}function g(e,t=4){var i=Object(s.d)(e[0],e[1],e[2],4===e.length?e[3]:1);return new u.a({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function v(e,t,i){return new d.a({view:e,renderObjects:[{geometry:c.a.createSphereGeometry(1,32,32),material:b(Object(s.d)(t[0],t[1],t[2],null!=i?i:1))}]})}function m(e,t,i,a){var s=Object(r.i)(o.d.get(),e,i),c=f(s,Object(r.f)(o.d.get(),a,s),i,o.a.get());Object(n.a)(c,c);var l=Object(r.l)(o.d.get(),t,c);return Math.atan2(l[1],l[0])}function f(e,t,i,a){var n=Object(r.q)(o.d.get(),e),s=Object(r.q)(o.d.get(),t),c=Object(r.f)(o.d.get(),n,s);return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=0,a[4]=s[0],a[5]=s[1],a[6]=s[2],a[7]=0,a[8]=c[0],a[9]=c[1],a[10]=c[2],a[11]=0,a[12]=i[0],a[13]=i[1],a[14]=i[2],a[15]=1,a}function O(e,t){var i=e.getViewForGraphic(t);return Object(a.k)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function j(e,t,i){var r=O(e,i);Object(a.k)(r)?t.elevationAlignedLocation=r:function(e,t){if(Object(a.j)(t))return;var i=Object(h.a)(t);Object(a.j)(i)||(e.location=Object(l.b)(i))}(t,i.geometry)}},652:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var a=i(82),r=(i(80),i(89)),n=i(81),s=(i(88),i(85)),o=i(84),c=(i(83),i(86),i(87),i(97)),l=i(131),h=i(105),u=i(104),d=i(111),p=i(223),b=i(359),g=i(234),v=i(135),m=i(340),f=i(482),O=n.a.getLogger("esri.views.interactive.GraphicManipulator"),j=class extends c.a{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new l.a.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){"mesh"!==Object(r.i)(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):O.error("Mesh geometries are not supported")}get elevationInfo(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(m.e)(this.graphic),i=e?e.offset:0;return new b.a({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){var t=this.graphic;if(!1===t.visible)return null;var i=t.geometry;if(Object(r.j)(i))return null;var a=this._get("focusedSymbol"),n=Object(r.k)(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(r.k)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(r.k)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(e=>{Object(r.k)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(r.k)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){Object(r.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(r.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||Object(g.e)(i),Object(r.j)(a))return null;var n=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return Object(f.b)(t,i,e)?1:null;if(Object(r.j)(n)||!n.originalPoint.equals(i)){var s=i,o=e.spatialReference;if(Object(p.b)(s.spatialReference,o)){var c=Object(p.j)(s,o);n={originalPoint:s.clone(),mapPoint:c,radiusPx:Object(h.h)(a.size)},this._circleCollisionCache=n}}if(Object(r.k)(n)){var l=Object(h.j)(t,_),u=e.toScreen(n.mapPoint),d=n.radiusPx,b=u.x+Object(h.h)(a.xoffset),m=u.y-Object(h.h)(a.yoffset);return Object(v.j)(l,[b,m])<d*d?1:null}return null}_intersectDistance3D(e,t,i){var a=e.toMap(t,{include:[i]});return a&&Object(p.o)(a,y,e.renderSpatialReference)?Object(d.n)(y,e.state.camera.eye):null}};Object(a.a)([Object(s.b)({constructOnly:!0,nonNullable:!0})],j.prototype,"graphic",null),Object(a.a)([Object(s.b)({readOnly:!0})],j.prototype,"elevationInfo",null),Object(a.a)([Object(s.b)({constructOnly:!0,nonNullable:!0})],j.prototype,"view",void 0),Object(a.a)([Object(s.b)({value:null})],j.prototype,"focusedSymbol",null),Object(a.a)([Object(s.b)({constructOnly:!0})],j.prototype,"layer",void 0),Object(a.a)([Object(s.b)()],j.prototype,"interactive",void 0),Object(a.a)([Object(s.b)()],j.prototype,"selectable",void 0),Object(a.a)([Object(s.b)()],j.prototype,"grabbable",void 0),Object(a.a)([Object(s.b)({value:!1})],j.prototype,"grabbing",null),Object(a.a)([Object(s.b)()],j.prototype,"dragging",void 0),Object(a.a)([Object(s.b)()],j.prototype,"hovering",null),Object(a.a)([Object(s.b)({value:!1})],j.prototype,"selected",null),Object(a.a)([Object(s.b)()],j.prototype,"cursor",void 0),j=Object(a.a)([Object(o.a)("esri.views.interactive.GraphicManipulator")],j);var y=Object(u.e)(),_=Object(h.g)()},698:function(e,t,i){"use strict";var a=i(89),r=i(110),n=i(105),s=i(104),o=i(111),c=i(330),l=i(157),h=i(174),u=i(202),d=i(200),p=i(135),b=i(191),g=i(347),v=i(255),m=i(179);class f{constructor(e=null,t=null,i=null){this._viewUp=Object(s.e)(),this._viewForward=Object(s.e)(),this._viewRight=Object(s.e)(),this._ray=v.f.createWrapper(),this._viewport=Object(d.d)(0,0,1,1),this._padding=Object(d.d)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(u.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(h.b)(),this._projectionDirty=!0,this._projectionMatrix=Object(h.b)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(h.b)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(h.b)(),this._frustumDirty=!0,this._frustum=v.c.create(),this._fullViewport=Object(d.c)(),this.pixelRatio=1,this.relativeElevation=0,this._eye=Object(a.k)(e)?Object(s.d)(e):Object(s.e)(),this._center=Object(a.k)(t)?Object(s.d)(t):Object(s.e)(),this._up=Object(a.k)(i)?Object(s.d)(i):Object(s.g)(0,0,1)}get eye(){return this._eye}set eye(e){this._compareAndSetView(e,this._eye)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=Object(s.e)()),Object(o.i)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(l.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(b.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(l.l)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){var e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),a=i*this.aspect;Object(l.h)(this._projectionMatrix,-a*(1+2*this._padding[3]/e),a*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(l.c)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(m.b)(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(m.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(m.c)(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(m.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(o.n)(this._center,this._eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(l.a)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(l.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){var t=e;return Object(o.j)(this._eye,t._eye),Object(o.j)(this._center,t._center),Object(o.j)(this._up,t._up),Object(b.c)(this._viewport,t._viewport),Object(b.c)(this._padding,t._padding),Object(p.c)(this._nearFar,t._nearFar),this._fov=t._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=t._viewDirty,this._viewDirty||(Object(l.c)(this._viewMatrix,t._viewMatrix),Object(o.j)(this._viewRight,t._viewRight),Object(o.j)(this._viewUp,t._viewUp),Object(o.j)(this._viewForward,t._viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(l.c)(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(v.c.copy(t._frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(l.c)(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(b.c)(this._fullViewport,t._fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new f).copyFrom(this)}equals(e){return Object(o.p)(this._eye,e._eye)&&Object(o.p)(this._center,e._center)&&Object(o.p)(this._up,e._up)&&Object(b.g)(this._viewport,e._viewport)&&Object(b.g)(this._padding,e._padding)&&Object(p.k)(this._nearFar,e._nearFar)&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;Object(o.u)(y,e.eye,e.center),Object(o.u)(_,this._eye,this._center);var i=Object(o.g)(y,_),a=Object(o.x)(y),r=Object(o.x)(_);return i*i>=(1-1e-10)*a*r&&Object(o.y)(e.eye,this._eye)<Math.max(a,r)*t*t&&Object(b.i)(e.padding,this._padding)<.5&&Object(b.i)(e.viewport,this._viewport)<.5}markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(g.c)(this.viewForward,Object(o.i)(y,e,this._eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(n.g)()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e||(e=Object(n.e)()),e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e.length>2&&(e[2]=.5),e}setGLViewport(e){var t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t,i=!1){e!==O&&Object(o.j)(O,e),O[3]=1,i&&(t[2]=-O[2]),Object(b.m)(O,O,this.projectionMatrix),Object(o.d)(O,O,1/Math.abs(O[3]));var a=this.fullViewport;return t[0]=Object(r.l)(0,a[0]+a[2],.5+.5*O[0]),t[1]=Object(r.l)(0,a[1]+a[3],.5+.5*O[1]),i||(t[2]=.5*(O[2]+1)),t}projectToScreen(e,t){return this.projectToRenderScreen(e,w),this.renderToScreen(w,t)}projectToRenderScreen(e,t){if(O[0]=e[0],O[1]=e[1],O[2]=e[2],O[3]=1,Object(b.m)(O,O,this.viewProjectionMatrix),0===O[3])return null;Object(o.d)(O,O,1/Math.abs(O[3]));var i=this.fullViewport;return"x"in t?(t.x=Object(r.l)(0,i[0]+i[2],.5+.5*O[0]),t.y=Object(r.l)(0,i[1]+i[3],.5+.5*O[1])):(t[0]=Object(r.l)(0,i[0]+i[2],.5+.5*O[0]),t[1]=Object(r.l)(0,i[1]+i[3],.5+.5*O[1]),t.length>2&&(t[2]=.5*(O[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,w),t)}unprojectFromRenderScreen(e,t){if(Object(l.l)(j,this.projectionMatrix,this.viewMatrix),!Object(l.a)(j,j))return null;var i=this.fullViewport;return O[0]=2*(e[0]-i[0])/i[2]-1,O[1]=2*(e[1]-i[1])/i[3]-1,O[2]=2*e[2]-1,O[3]=1,Object(b.m)(O,O,j),0===O[3]?null:(t[0]=O[0]/O[3],t[1]=O[1]/O[3],t[2]=O[2]/O[3],t)}constrainWindowSize(e,t,i,a=1){var r=e*this.pixelRatio,n=t*this.pixelRatio,s=Math.max(r-i*a/2,0),o=Math.max(this.fullHeight-n-i/2,0),c=-Math.min(r-i*a/2,0),l=-Math.min(this.fullHeight-n-i/2,0);return[s,o,i*a-c- -Math.min(this.fullWidth-r-i*a/2,0),i-l- -Math.min(n-i/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){var i=e[0]*this.pixelRatio,a=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=a,t}renderToScreen(e,t){var i=e[0]/this.pixelRatio,a=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=i,t[1]=a,t}computeUpGlobal(){Object(o.i)(y,this.center,this.eye);var e=Object(o.o)(this.center);e<1?(Object(o.v)(this.up,0,0,1),this.markViewDirty()):Math.abs(Object(o.g)(y,this.center))>.9999*Object(o.o)(y)*e||(Object(o.f)(this.up,y,this.center),Object(o.f)(this.up,this.up,y),Object(o.q)(this.up,this.up),this.markViewDirty())}computeUpLocal(){Object(c.d)(y,this.eye,this.center),Math.abs(y[2])<=.9999&&(Object(o.d)(y,y,y[2]),Object(o.v)(this.up,-y[0],-y[1],1-y[2]),Object(o.q)(this.up,this.up),this.markViewDirty())}_compareAndSetView(e,t){Object(o.p)(e,t)||(Object(o.j)(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)}_recomputeFrustum(){this._frustumDirty&&(v.c.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(l.k)(this._viewMatrix,this._eye,this._center,this._up),Object(o.v)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(o.v)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(o.v)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}var O=Object(d.c)(),j=Object(h.b)(),y=Object(s.e)(),_=Object(s.e)(),w=Object(n.e)();t.a=f},700:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a,r,n=i(120),s=i(119);!function(e){e.builder=function(e,t){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(Object(s.a)(a||(a=Object(n.a)(["\n    float computeRenderPixelSizeAt( vec3 pWorld ){\n      vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n      float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));\n      return viewDirectionDistance*perScreenPixelRatio;\n    }\n\n    vec3 screenSizeScaling(vec3 position, vec3 anchor){\n      return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;\n    }\n  "]))))},e.bindPassUniforms=function(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}}(r||(r={}))},757:function(e,t,i){"use strict";i.d(t,"a",(function(){return w})),i.d(t,"b",(function(){return _}));var a,r,n,s,o,c,l,h,u,d=i(120),p=i(119),b=i(413),g=i(254),v=i(358),m=i(249),f=i(308),O=i(333),j=i(280),y=i(700);function _(e){var t=new g.a;return t.include(b.a,{linearDepth:!1}),t.include(y.a.builder,{}),t.include(m.a,e),t.fragment.include(v.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(Object(p.a)(a||(a=Object(d.a)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&t.vertex.code.add(Object(p.a)(r||(r=Object(d.a)(["\n      vec3 worldNormal = normal;\n      vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;\n    "])))),t.vertex.code.add(Object(p.a)(n||(n=Object(d.a)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),e.multipassTerrainEnabled&&(t.fragment.include(f.a),t.include(j.b,e)),t.fragment.code.add(Object(p.a)(s||(s=Object(d.a)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?t.fragment.code.add(Object(p.a)(o||(o=Object(d.a)(["\n      vec3 viewNormalNorm = normalize(vViewNormal);\n      float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 finalColor = mix(color, shadedColor, shadingFactor);\n    "])))):t.fragment.code.add(Object(p.a)(c||(c=Object(d.a)(["\n      vec4 finalColor = color;\n    "])))),t.fragment.code.add(Object(p.a)(l||(l=Object(d.a)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),p.a.float(O.c),7===e.output?Object(p.a)(h||(h=Object(d.a)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?Object(p.a)(u||(u=Object(d.a)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}var w=Object.freeze({__proto__:null,build:_})},758:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));i(80);var a=i(89),r=i(104),n=i(111),s=i(174),o=i(255),c=i(357),l=i(634),h=1e-5;class u{constructor(e){this.options=new l.a,this.results=new l.c,this.transform=new l.d,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=h,this.verticalOffset=null,this._ray={origin:Object(r.e)(),direction:Object(r.e)()},this._rayEndPoint=Object(r.e)(),this._rayStartPointTransformed=Object(r.e)(),this._rayEndPointTransformed=Object(r.e)(),this.viewingMode=null==e?1:e}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(e,t){this.resetWithRay(o.f.fromPoints(e,t,this._ray))}resetWithRay(e){e!==this._ray&&o.f.copy(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(n.e)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(e,t,i,r,n,s){this.point=t,this.camera=i,this.filterPredicate=n,this.tolerance=null==r?h:r;var o=Object(l.f)(this.verticalOffset),c=s?e=>{s(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};if(e&&e.length>0)for(var u of e){var d=u.getSpatialQueryAccelerator&&u.getSpatialQueryAccelerator();Object(a.k)(d)?(Object(a.k)(o)?d.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,c,o):d.forEachAlongRay(this._ray.origin,this._ray.direction,c),this.options.selectionMode&&this.options.hud&&d.forEachDegenerateObject(c)):u.getObjects().forAll((e=>c(e)))}this.sortResults()}intersectObject(e){var t=this;this._numObjectsTested++;var i=e.geometryRecords;if(i){var r,o=e.id,h=e.transformation,u=Object(l.f)(this.verticalOffset),d=function(i){var{geometry:d,material:p,instanceParameters:b}=i;if(Object(c.d)(b))return"continue";r=d.id,t.transform.setAndInvalidateLazyTransforms(h,i.getShaderTransformation()),Object(n.l)(t._rayStartPointTransformed,t._ray.origin,t.transform.inverse),Object(n.l)(t._rayEndPointTransformed,t._rayEndPoint,t.transform.inverse);var g=t.transform.transform;Object(a.k)(u)&&(u.objectTransform=t.transform),p.intersect(d,b,t.transform.transform,t,t._rayStartPointTransformed,t._rayEndPointTransformed,((i,n,c,h,u,d)=>{if(i>=0){if(Object(a.k)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEndPoint,i))return;var p="Object3D ".concat(o);if(u)return void((null==t.results.hud.dist||i<t.results.hud.dist)&&t.results.hud.set(e,p,i,n,s.a,h,d,r,c));var b=t=>t.set(e,p,i,n,g,h,null,r,c);if((null==t.results.min.drapedLayerOrder||h>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||i<t.results.min.dist)&&b(t.results.min),0!==t.options.store&&(null==t.results.max.drapedLayerOrder||h<t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||i>t.results.max.dist)&&b(t.results.max),2===t.options.store){var v=new l.b(t._ray);b(v),t.results.all.push(v)}}}),i.shaderTransformation)};for(var p of i)d(p)}}sortResults(){this.results.all.sort(((e,t)=>e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)))}}u.DEFAULT_TOLERANCE=h},802:function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var a=i(91),r=i(104),n=i(111),s=i(434),o=i(279),c=i(368),l=i(179),h=i(388),u=i(328),d=i(379),p=i(491),b=i(82),g=i(200),v=i(300),m=i(307),f=i(313),O=i(286),j=i(267),y=i(380),_=i(249),w=i(349),M=i(280),x=i(700),S=i(757);class P extends m.a{initializeProgram(e){var t=P.shader.get(),i=this.configuration,a=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new O.a(e.rctx,a.generateSource("vertex"),a.generateSource("fragment"),A)}bindPass(e,t,i){var{screenSizeEnabled:a,shadingEnabled:r}=this.configuration,{color:n,shadingTint:s,shadingDirection:o}=t;y.a.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",n),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),Object(M.a)(this.program,e,i)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(D,s,n)),this.program.setUniform3fv("shadingDirection",o),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),a&&x.a.bindPassUniforms(this.program,t,i)}blendColor(e,t,i){var a=1-t[3],r=t[3]+i[3]*a;return 0===r?(e[3]=r,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*a)/r,e[1]=(t[1]*t[3]+i[1]*i[3]*a)/r,e[2]=(t[2]*t[3]+i[2]*i[3]*a)/r,e[3]=i[3],e)}bindDraw(e){y.a.bindView(this.program,e),y.a.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),_.a.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){var t=this.configuration,i=3===e,a=2===e;return Object(j.d)({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?w.f:Object(w.a)(e),culling:(e=>0!==e&&{face:1===e?1028:1029,mode:2305})(t.cullFace),depthTest:{func:a?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&j.c:Object(w.c)(e),colorWrite:j.b,polygonOffset:i||a?null:w.d})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}P.shader=new v.a(S.a,(()=>i.e(302).then(i.bind(null,1211))));class E extends f.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}Object(b.a)([Object(f.b)({count:8})],E.prototype,"output",void 0),Object(b.a)([Object(f.b)({count:3})],E.prototype,"cullFace",void 0),Object(b.a)([Object(f.b)()],E.prototype,"slicePlaneEnabled",void 0),Object(b.a)([Object(f.b)()],E.prototype,"transparent",void 0),Object(b.a)([Object(f.b)()],E.prototype,"writeDepth",void 0),Object(b.a)([Object(f.b)()],E.prototype,"screenSizeEnabled",void 0),Object(b.a)([Object(f.b)()],E.prototype,"shadingEnabled",void 0),Object(b.a)([Object(f.b)({count:4})],E.prototype,"transparencyPassType",void 0),Object(b.a)([Object(f.b)()],E.prototype,"multipassTerrainEnabled",void 0),Object(b.a)([Object(f.b)()],E.prototype,"cullAboveGround",void 0);var A={position:0,normal:1,offset:2},D=Object(g.c)();class R extends d.a{constructor(e){super(e,C),this.supportsEdges=!0,this.techniqueConfig=new E,this._vertexAttributeLocations=A}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,a,r,s,c){if(this.params.screenSizeEnabled){var l=e.vertexAttributes.get("offset"),h={applyToVertex:(e,t,i,r)=>{var s=Object(n.v)(k,l.data[3*r+0],l.data[3*r+1],l.data[3*r+2]),o=Object(n.v)(I,e,t,i);return Object(n.d)(s,s,this.params.screenSize*a.camera.computeRenderPixelSizeAt(s)),Object(n.e)(o,o,s),[o[0],o[1],o[2]]},applyToAabb:e=>{var t=Object(o.b)(e,k);return Object(o.p)(e,this.params.screenSize*a.camera.computeRenderPixelSizeAt(t))}};Object(u.e)(e,t,a,r,s,h,c)}else Object(u.e)(e,t,a,r,s,void 0,c)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new T(e):void 0}createBufferWriter(){return new G(this.params.screenSizeEnabled)}}class T extends h.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this.technique=this.techniqueRep.acquireAndReleaseExisting(P,this.material.getTechniqueConfig(this.output,e),this.technique)}beginSlot(e){if(4===this.output)return 3===e;var t=3;return this.technique.configuration.transparent&&(t=this.technique.configuration.writeDepth?5:8),e===t}ensureParameters(e){this.updateParameters(e)}bind(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}}var C=Object(a.a)({color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(n.q)(Object(r.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0},d.b);class G{constructor(e){this.screenSizeEnabled=e;var t=Object(c.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,a){if(Object(p.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,a),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");var r=t.vertexAttributes.get("offset"),n=t.indices.get("offset");Object(l.a)(3===r.size);var o=i.getField("offset",s.u);if(!o)throw new Error("unable to acquire view for offset");Object(p.e)(n,r.data,e.invTranspTransformation,o,a)}}}var k=Object(r.e)(),I=Object(r.e)()},908:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var a=i(7),r=i(91),n=i(89),s=i(294),o=i(85),c=i(624),l=i(83),h=i(86),u=i(144),d=i(87),p=i(258);function b(e){var t=Object(n.k)(e)&&e.origins?e.origins:[void 0];return(i,a)=>{var h=function(e,t,i){if(Object(n.k)(e)&&"resource"===e.type)return function(e,t,i){var a=Object(s.b)(t,i);return{type:String,read:(e,t,i)=>{var r=Object(p.d)(e,t,i);return a.type===String?r:"function"==typeof a.type?new a.type({url:r}):void 0},write:{writer(t,s,o,h){if(!h||!h.resources)return"string"==typeof t?void(s[o]=Object(p.e)(t,h)):void(s[o]=t.write({},h));var b=function(e){return Object(n.j)(e)?null:"string"==typeof e?e:e.url}(t),f=b?Object(p.e)(b,Object(r.a)(Object(r.a)({},h),{},{verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),1):null,O=a.type!==String&&(!Object(c.a)(this)||h&&h.origin&&this.originIdOf(i)>Object(u.d)(h.origin));h&&h.portalItem&&Object(n.k)(f)&&!Object(l.s)(f)?O?function(e,t,i,a,r,n,s,o){var c=s.portalItem.resourceFromPath(a),h=m(i,a,s);Object(d.a)(h)===Object(l.n)(c.path)?(v(e,t,c,h,s.resources.toUpdate),r[n]=a):g(e,t,i,a,r,n,s,o)}(this,i,t,f,s,o,h,e):function(e,t,i,a){a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(e)}),t[i]=e}(f,s,o,h):h&&h.portalItem&&(Object(n.j)(f)||Object(n.k)(Object(p.b)(f))||Object(l.t)(f)||O)?g(this,i,t,f,s,o,h,e):s[o]=f}}}}(e,t,i);switch(Object(n.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":var{read:a,write:o}=p.c;return{read:a,write:o}}}(e,i,a);for(var b of t){var f=Object(o.c)(i,b,a);for(var O in h)f[O]=h[O]}}}function g(e,t,i,a,r,s,o,c){var u=Object(h.a)(),p=m(i,a,o),b=Object(l.y)(Object(n.i)(c,"prefix"),u),g="".concat(b,".").concat(Object(d.a)(p)),O=o.portalItem.resourceFromPath(g);Object(l.t)(a)&&o.resources.pendingOperations.push(function(e){return f.apply(this,arguments)}(a).then((e=>{O.path="".concat(b,".").concat(Object(d.a)(e)),r[s]=O.itemRelativeUrl})).catch((()=>{}))),v(e,t,O,p,o.resources.toAdd),r[s]=O.itemRelativeUrl}function v(e,t,i,a,r){r.push({resource:i,content:a,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function m(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}function f(){return(f=Object(a.a)((function*(e){var t=(yield Promise.resolve().then(i.bind(null,106))).default,{data:a}=yield t(e,{responseType:"blob"});return a}))).apply(this,arguments)}},974:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return f}));var a,r,n,s,o,c,l=i(120),h=i(119),u=i(413),d=i(254),p=i(249),b=i(322),g=i(333),v=i(599),m=i(518);function f(e){var t=new d.a;return t.include(u.a,{linearDepth:!1}),t.include(m.a,e),t.include(v.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(h.a)(a||(a=Object(l.a)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n  "])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(Object(h.a)(r||(r=Object(l.a)(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(Object(h.a)(n||(n=Object(l.a)(["\n  }\n  "])))),4===e.output&&t.include(b.a),t.include(p.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(Object(h.a)(s||(s=Object(l.a)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",h.a.float(g.c),0===e.output?Object(h.a)(o||(o=Object(l.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?Object(h.a)(c||(c=Object(l.a)(["outputHighlight();"]))):"")),t}var O=Object.freeze({__proto__:null,build:f})},975:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var a,r,n=i(120),s=i(119),o=i(254);function c(){var e=new o.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(Object(s.a)(a||(a=Object(n.a)(["\n    void main(void) {\n      vUV = uv0;\n      gl_Position = proj * view * vec4(position, 1.0);\n    }\n  "])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(Object(s.a)(r||(r=Object(n.a)(["\n    void main() {\n      const float LINE_WIDTH = 1.0;\n\n      vec2 uvScaled = vUV * gridWidth;\n      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n\n      // mask aliasing along edges\n      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n\n      float gridFade = max(grid.x, grid.y);\n\n      float gridAlpha = gridColor.a * gridFade;\n\n      // premultiply alpha in output\n      gl_FragColor =\n        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n        vec4(gridColor.rgb, 1.0) * gridAlpha;\n    }\n  "])))),e}var l=Object.freeze({__proto__:null,build:c})},976:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return g}));var a,r,n,s=i(120),o=i(119),c=i(413),l=i(254),h=i(358),u=i(249),d=i(308),p=i(333),b=i(280);function g(e){var t=new l.a;return t.include(c.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(Object(o.a)(a||(a=Object(s.a)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(u.a,e),e.multipassTerrainEnabled&&(t.fragment.include(d.a),t.include(b.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(Object(o.a)(r||(r=Object(s.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",o.a.float(p.b))):(t.fragment.include(h.a),t.fragment.code.add(Object(o.a)(n||(n=Object(s.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",o.a.float(p.b),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var v=Object.freeze({__proto__:null,build:g})}}]);
//# sourceMappingURL=15.844557f2.chunk.js.map