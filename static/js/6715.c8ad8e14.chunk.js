"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[6715,4397],{62044:(e,t,i)=>{i.d(t,{Z:()=>f});var s,r=i(27366),n=i(46784),o=i(92026),a=i(86710),l=i(49861),u=(i(63780),i(93169),i(25243),i(38511)),h=i(69912),c=i(31201);let d=s=class extends n.wq{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return p}static get empty(){return m}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(s.allTime)}get isEmpty(){return this.equals(s.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new s({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=(0,o.pC)(this.start)?this.start.getTime():this.start,i=(0,o.pC)(this.end)?this.end.getTime():this.end,s=(0,o.pC)(e.start)?e.start.getTime():e.start,r=(0,o.pC)(e.end)?e.end.getTime():e.end;return t===s&&i===r}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=(0,o.yw)(this.start,(t=>(0,a.JE)(t,e))),i=(0,o.yw)(this.end,(t=>(0,a.Nm)((0,a.JE)(t,e),1,e)));return new s({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return s.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=(0,o.R2)(this.start,-1/0,(e=>e.getTime())),i=(0,o.R2)(this.end,1/0,(e=>e.getTime())),r=(0,o.R2)(e.start,-1/0,(e=>e.getTime())),n=(0,o.R2)(e.end,1/0,(e=>e.getTime()));let a,l;if(r>=t&&r<=i?a=r:t>=r&&t<=n&&(a=t),i>=r&&i<=n?l=i:n>=t&&n<=i&&(l=n),!isNaN(a)&&!isNaN(l)){const e=new s;return e.start=a===-1/0?null:new Date(a),e.end=l===1/0?null:new Date(l),e}return s.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new s,{start:r,end:n}=this;return(0,o.pC)(r)&&(i.start=(0,a.Nm)(r,e,t)),(0,o.pC)(n)&&(i.end=(0,a.Nm)(n,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return p.clone();const t=(0,o.pC)(this.start)&&(0,o.pC)(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=(0,o.pC)(this.end)&&(0,o.pC)(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new s({start:t,end:i})}};(0,r._)([(0,l.Cb)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"end",void 0),(0,r._)([(0,u.r)("end")],d.prototype,"readEnd",null),(0,r._)([(0,c.c)("end")],d.prototype,"writeEnd",null),(0,r._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],d.prototype,"isAllTime",null),(0,r._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],d.prototype,"isEmpty",null),(0,r._)([(0,l.Cb)({type:Date,json:{write:{allowNull:!0}}})],d.prototype,"start",void 0),(0,r._)([(0,u.r)("start")],d.prototype,"readStart",null),(0,r._)([(0,c.c)("start")],d.prototype,"writeStart",null),d=s=(0,r._)([(0,h.j)("esri.TimeExtent")],d);const p=new d,m=new d({start:void 0,end:void 0}),f=d},12355:(e,t,i)=>{i.d(t,{Z:()=>c});var s,r=i(27366),n=i(46784),o=i(86710),a=i(49861),l=(i(63780),i(93169),i(25243),i(69912)),u=i(58359);let h=s=class extends n.wq{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return(0,o.rJ)(this.value,this.unit,"milliseconds")}clone(){return new s({value:this.value,unit:this.unit})}};(0,r._)([(0,a.Cb)({type:Number,json:{write:!0},nonNullable:!0})],h.prototype,"value",void 0),(0,r._)([(0,a.Cb)({type:u.v.apiValues,json:{type:u.v.jsonValues,read:u.v.read,write:u.v.write},nonNullable:!0})],h.prototype,"unit",void 0),h=s=(0,r._)([(0,l.j)("esri.TimeInterval")],h);const c=h},84397:(e,t,i)=>{i.d(t,{a:()=>n,c:()=>s,g:()=>r});var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}},53283:(e,t,i)=>{i.d(t,{M:()=>m,e:()=>d,f:()=>n,i:()=>c,p:()=>g,r:()=>a,t:()=>o,w:()=>l});var s=i(92026),r=i(35995);function n(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=(0,r.hF)(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=(0,r.PF)(e,t.portalItem.itemUrl);h.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return p(e,t&&t.portal)}function o(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.YES;if(!e)return e;!(0,r.YP)(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let s=(0,r.hF)(e);if(t){const i=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(i){const n=p(i,t.portal);s=(0,r.PF)(p(s,t.portal),n,n),s!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(s)}}return s=d(s,t&&t.portal),(0,r.YP)(s)&&(s=(0,r.Fv)(s)),t?.resources&&t?.portalItem&&!(0,r.YP)(s)&&!(0,r.HK)(s)&&i===m.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(s)}),s}function a(e,t,i){return n(e,i)}function l(e,t,i,s){const r=o(e,s);void 0!==r&&(t[i]=r)}const u=/\/items\/([^\/]+)\/resources\//,h=/^\.\/resources\//;function c(e){const t=(0,s.pC)(e)?e.match(u):null;return(0,s.pC)(t)?t[1]:null}function d(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?(0,r.Ie)(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function p(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,s=(0,r.TI)();return(0,r.D6)(s,`${s.scheme}://${i}`)?(0,r.Ie)(e,t.portalHostname,i):(0,r.Ie)(e,i,t.portalHostname)}var m,f;(f=m||(m={}))[f.YES=0]="YES",f[f.NO=1]="NO";const g=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:n,toJSON:o,read:a,write:l,itemIdFromResourceUrl:c,ensureMainOnlineDomain:d,get MarkKeep(){return m}},Symbol.toStringTag,{value:"Module"}))},41691:(e,t,i)=>{i.d(t,{p:()=>u,r:()=>h});var s=i(27366),r=i(85015),n=i(100),o=i(49861),a=i(69912),l=i(61826);const u=e=>{let t=class extends e{destroy(){this.destroyed||(this._get("handles")?.destroy(),this._get("updatingHandles")?.destroy())}get handles(){return this._get("handles")||new n.Z}get updatingHandles(){return this._get("updatingHandles")||new l.t}};return(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"handles",null),(0,s._)([(0,o.Cb)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,s._)([(0,a.j)("esri.core.HandleOwner")],t),t};let h=class extends(u(r.Z)){};h=(0,s._)([(0,a.j)("esri.core.HandleOwner")],h)},59026:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(18759);class r{constructor(e,t){this._storage=new s.WJ,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},18759:(e,t,i)=>{i.d(t,{WJ:()=>u,Xq:()=>l,an:()=>n,lN:()=>o});var s=i(92026),r=i(27546);const n=-3;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{constructor(e,t,i){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,i,s)}get(e){const t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){const t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new r.Z,this._users=new r.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,i,s){const r=this._db.get(e);if(r&&(this._size-=r.size,this._db.delete(e),r.entry!==t&&this._notifyRemove(e,r.entry,o.ALL)),i>this._maxSize)return void this._notifyRemove(e,t,o.ALL);if(void 0===t)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const a=1+Math.max(s,n)-n;this._db.set(e,{entry:t,size:i,lifetime:a,lives:a}),this._size+=i,this._checkSizeLimit()}updateSize(e,t,i){const r=this._db.get(e);if(r&&r.entry===t){for(this._size-=r.size;i>this._maxSize;){const r=this._notifyRemove(e,t,o.SOME);if(!((0,s.pC)(r)&&r>0))return void this._db.delete(e);i=r}r.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){const t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,s)=>{const r=e.lifetime;i[r]=(i[r]||0)+e.size,this._users.forAll((i=>{const r=i.namespace;if(s.startsWith(r)){const i=t[r]||0;t[r]=i+e.size}}))}));const s={};this._users.forAll((e=>{const i=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){const r=t[i]||0;t[i]=r,s[i]=Math.round(100*e.hitRate)+"%"}else s[i]="0%"}));const r=Object.keys(t);r.sort(((e,i)=>t[i]-t[e])),r.forEach((i=>e[i]=Math.round(t[i]/2**20)+"MB / "+s[i]));for(let o=i.length-1;o>=0;--o){const t=i[o];t&&(e["Priority "+(o+n-1)]=Math.round(t/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){this._db.forEach(((t,i)=>{i.startsWith(e)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,o.ALL))}))}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,o.ALL))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i){let s;return this._removeFuncs.some((r=>{if(e.startsWith(r[0])){const e=r[1](t,i);return"number"==typeof e&&(s=e),!0}return!1})),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,t]of this._db){if(this._db.delete(e),t.lives<=1){this._size-=t.size;const i=this._notifyRemove(e,t.entry,o.SOME);(0,s.pC)(i)&&i>0&&(this._size+=i,t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t);if(this._size<=.9*this.maxSize)return}}}},14921:(e,t,i)=>{i.d(t,{Ed:()=>n,UI:()=>o,mt:()=>l,q6:()=>a});var s=i(92026),r=i(66978);function n(e,t,i){return(0,r.as)(e.map(((e,s)=>t.apply(i,[e,s]))))}async function o(e,t,i){return(await(0,r.as)(e.map(((e,s)=>t.apply(i,[e,s]))))).map((e=>e.value))}async function a(e){if((0,s.Wi)(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function l(e){try{return{ok:!0,value:await e}}catch(t){return(0,r.r9)(t),{ok:!1,error:t}}}},59896:(e,t,i)=>{function s(e){return 32+e.length}function r(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=s(r);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function n(e,t){return 32+e.length*t}var o;i.d(t,{Y8:()=>o,do:()=>n,f2:()=>r}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(o||(o={}))},61826:(e,t,i)=>{i.d(t,{t:()=>c});var s=i(27366),r=i(85015),n=i(100),o=i(92026),a=i(94172),l=i(99346),u=i(49861),h=i(69912);let c=class extends r.Z{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new n.Z,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,i,a.YP)}addWhen(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,i,a.gx)}addOnCollectionChange(e,t){let{initial:i=!1,final:s=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=++this.handleId;return this.handles.add([(0,a.on)(e,"after-changes",this._createSyncUpdatingCallback(),a.Z_),(0,a.on)(e,"change",t,{onListenerAdd:i?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:s?e=>t({added:[],removed:e.toArray()}):void 0})],r),{remove:()=>this.handles.remove(r)}}addPromise(e){if((0,o.Wi)(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(d)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const r=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,r);const n=s(e,t,i);return this.handles.add(n,r),{remove:()=>this.handles.remove(r)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),s=(0,a.YP)(e,i,{sync:!0,equals:()=>!1});return this.handles.add(s,t),s}_createSyncUpdatingCallback(){return()=>{this.handles.remove(d),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add((0,l.Os)((()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(d))})),d)}}};(0,s._)([(0,u.Cb)({readOnly:!0})],c.prototype,"updating",void 0),c=(0,s._)([(0,h.j)("esri.core.support.WatchUpdatingTracking")],c);const d=-42;var p,m;(m=p||(p={}))[m.NONE=0]="NONE",m[m.SYNC=1]="SYNC",m[m.INIT=2]="INIT"},86710:(e,t,i)=>{i.d(t,{JE:()=>o,Nm:()=>n,rJ:()=>a});i(93169);const s={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},r={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function n(e,t,i){const s=new Date(e.getTime());if(t&&i){const e=r[i],{getter:n,setter:o,multiplier:a}=e;if("months"===i){const e=function(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}(s.getFullYear(),s.getMonth()+t);s.getDate()>e&&s.setDate(e)}s[o](s[n]()+t*a)}return s}function o(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function a(e,t,i){return 0===e?0:e*s[t]/s[i]}},40237:(e,t,i)=>{i.d(t,{N:()=>s});const s={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const s=new r(e.getPointX(t),e.getPointY(t),i),n=e.hasZ(t),o=e.hasM(t);return n&&(s.z=e.getPointZ(t)),o&&(s.m=e.getPointM(t)),s},exportPolygon:function(e,t,i){return new n(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,i){return new o(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,i){return new a(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,i){const s=e.hasZ(t),r=e.hasM(t),n=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(s){const i=e.getZExtent(t);n.zmin=i.vmin,n.zmax=i.vmax}if(r){const i=e.getMExtent(t);n.mmin=i.vmin,n.mmax=i.vmax}return n}};class r{constructor(e,t,i){this.x=e,this.y=t,this.spatialReference=i,this.z=void 0,this.m=void 0}}class n{constructor(e,t,i,s){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class o{constructor(e,t,i,s){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class a{constructor(e,t,i,s){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),s&&(this.hasM=s)}}class l{constructor(e,t,i,s,r){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=s,this.spatialReference=r,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},41414:(e,t,i)=>{i.d(t,{BD:()=>b,G1:()=>d,Gv:()=>j,HH:()=>l,JR:()=>D,KE:()=>E,TC:()=>u,Tn:()=>I,Ue:()=>o,VK:()=>h,Wi:()=>p,Zp:()=>T,aO:()=>C,al:()=>a,bA:()=>F,be:()=>v,cS:()=>O,cv:()=>S,dp:()=>w,fS:()=>A,op:()=>x,pp:()=>c,sU:()=>m,t8:()=>M,wp:()=>N,wz:()=>_,xE:()=>P,y8:()=>R});var s=i(92026),r=i(53866),n=i(65156);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P;return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,i,s,r,n){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o();return a[0]=e,a[1]=t,a[2]=i,a[3]=s,a[4]=r,a[5]=n,a}function l(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new r.Z(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function u(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function h(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length/3,r=e[0],n=e[1],o=e[2],a=e[3],l=e[4],u=e[5];for(let h=0;h<s;h++)r=Math.min(r,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),u=Math.max(u,t[i+3*h+2]);e[0]=r,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=u}function p(e,t,i){const s=t.length;let r=e[0],n=e[1],o=e[2],a=e[3],l=e[4],u=e[5];if(i)for(let h=0;h<s;h++){const e=t[h];r=Math.min(r,e[0]),n=Math.min(n,e[1]),o=Math.min(o,e[2]),a=Math.max(a,e[0]),l=Math.max(l,e[1]),u=Math.max(u,e[2])}else for(let h=0;h<s;h++){const e=t[h];r=Math.min(r,e[0]),n=Math.min(n,e[1]),a=Math.max(a,e[0]),l=Math.max(l,e[1])}e[0]=r,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=u}function m(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function f(e){return e[0]>=e[3]?0:e[3]-e[0]}function g(e){return e[1]>=e[4]?0:e[4]-e[1]}function y(e){return e[2]>=e[5]?0:e[5]-e[2]}function _(e){const t=f(e),i=y(e),s=g(e);return Math.sqrt(t*t+i*i+s*s)}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=e[0]+f(e)/2,t[1]=e[1]+g(e)/2,t[2]=e[2]+y(e)/2,t}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=f(e),t[1]=g(e),t[2]=y(e),t}function C(e){return Math.max(f(e),y(e),g(e))}function b(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function T(e,t){return!!(0,s.Wi)(t)||function(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}(e,t)}function S(e,t,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+s,r[3]=e[3]+t,r[4]=e[4]+i,r[5]=e[5]+s,r}function F(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const s=e[0]+f(e)/2,r=e[1]+g(e)/2,n=e[2]+y(e)/2;return i[0]=s+(e[0]-s)*t,i[1]=r+(e[1]-r)*t,i[2]=n+(e[2]-n)*t,i[3]=s+(e[3]-s)*t,i[4]=r+(e[4]-r)*t,i[5]=n+(e[5]-n)*t,i}function E(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function x(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function I(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function M(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function O(e){return e?M(e,j):o(j)}function R(e,t){return t||(t=(0,n.Ue)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function D(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function z(e){return 6===e.length}function N(e){return 0===f(e)&&0===g(e)&&0===y(e)}function A(e,t,i){if((0,s.Wi)(e)||(0,s.Wi)(t))return e===t;if(!z(e)||!z(t))return!1;if(i){for(let s=0;s<e.length;s++)if(!i(e[s],t[s]))return!1}else for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}const j=[1/0,1/0,1/0,-1/0,-1/0,-1/0],P=[0,0,0,0,0,0];o()},19995:(e,t,i)=>{i.d(t,{_W:()=>d,iV:()=>f,oj:()=>y});var s=i(92026),r=i(79803),n=i(40237),o=i(92975),a=i(81753);const l=[0,0];function u(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,l),null!=t.z&&(i.z=t.z),null!=t.m&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,l),[i.xmax,i.ymax]=e(t.xmax,t.ymax,l),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:h(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:h(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function h(e,t){const i=[];for(const s of e)i.push(c(s,t));return i}function c(e,t){const i=[];for(const s of e){const e=t(s[0],s[1],[0,0]);i.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return i}async function d(e,t){if(!t)return;const i=Array.isArray(e)?e.map((e=>(0,s.pC)(e.geometry)&&e.geometry.spatialReference)):[e];await(0,r.iQ)(i.map((e=>({source:e,dest:t}))))}const p=u.bind(null,a.hG),m=u.bind(null,a.R6);function f(e,t,i,s){if(!e)return e;if(i||(i=t,t=e.spatialReference),!(0,o.JY)(t)||!(0,o.JY)(i)||(0,o.fS)(t,i))return e;if((0,a.Q8)(t,i)){const t=(0,o.sS)(i)?p(e):m(e);return t.spatialReference=i,t}return(0,r.oj)(n.N,[e],t,i,null,s)[0]}const g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i){if(!e||!e.length||!t||!i||(0,o.fS)(t,i))return e;const s={geometries:e,inSpatialReference:t,outSpatialReference:i,resolve:null};return this._jobs.push(s),new Promise((e=>{s.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:i,outSpatialReference:s,resolve:l}=e;(0,a.Q8)(i,s)?(0,o.sS)(s)?l(t.map(p)):l(t.map(m)):l((0,r.oj)(n.N,t,i,s,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(e,t,i){return g.push(e,t,i)}},22528:(e,t,i)=>{i.d(t,{Z:()=>m});var s,r=i(27366),n=i(84652),o=i(49861),a=(i(25243),i(27135)),l=i(69912),u=i(46784);i(63780),i(93169);let h=s=class extends u.wq{constructor(e){super(e),this.name=null,this.code=null}clone(){return new s({name:this.name,code:this.code})}};(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"name",void 0),(0,r._)([(0,o.Cb)({type:[String,Number],json:{write:!0}})],h.prototype,"code",void 0),h=s=(0,r._)([(0,l.j)("esri.layers.support.CodedValue")],h);var c,d=i(64538);let p=c=class extends d.Z{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some((e=>(String(e.code)===i&&(t=e.name),!!t)))}return t}clone(){return new c({codedValues:(0,n.d9)(this.codedValues),name:this.name})}};(0,r._)([(0,o.Cb)({type:[h],json:{write:!0}})],p.prototype,"codedValues",void 0),(0,r._)([(0,a.J)({codedValue:"coded-value"})],p.prototype,"type",void 0),p=c=(0,r._)([(0,l.j)("esri.layers.support.CodedValueDomain")],p);const m=p},64538:(e,t,i)=>{i.d(t,{Z:()=>c});var s=i(27366),r=i(43404),n=i(46784),o=i(49861),a=(i(63780),i(93169),i(25243),i(27135)),l=i(69912);const u=new r.X({inherited:"inherited",codedValue:"coded-value",range:"range"});let h=class extends n.wq{constructor(e){super(e),this.name=null,this.type=null}};(0,s._)([(0,o.Cb)({type:String,json:{write:!0}})],h.prototype,"name",void 0),(0,s._)([(0,a.J)(u)],h.prototype,"type",void 0),h=(0,s._)([(0,l.j)("esri.layers.support.Domain")],h);const c=h},83040:(e,t,i)=>{i.d(t,{Z:()=>g});var s,r=i(27366),n=i(43404),o=i(46784),a=i(49861),l=(i(63780),i(93169),i(25243)),u=i(27135),h=i(38511),c=i(69912),d=i(67755),p=i(85249);const m=new n.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let f=s=class extends o.wq{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,t){let i,{description:s}=t;try{i=JSON.parse(s)}catch(r){}return i?i.value:null}readValueType(e,t){let i,{description:s}=t;try{i=JSON.parse(s)}catch(r){}return i?m.fromJSON(i.fieldValueType):null}clone(){return new s({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"alias",void 0),(0,r._)([(0,a.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],f.prototype,"defaultValue",void 0),(0,r._)([(0,a.Cb)()],f.prototype,"description",void 0),(0,r._)([(0,h.r)("description")],f.prototype,"readDescription",null),(0,r._)([(0,a.Cb)({types:d.V5,json:{read:{reader:d.im},write:!0}})],f.prototype,"domain",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],f.prototype,"editable",void 0),(0,r._)([(0,a.Cb)({type:l.z8,json:{write:!0}})],f.prototype,"length",void 0),(0,r._)([(0,a.Cb)({type:String,json:{write:!0}})],f.prototype,"name",void 0),(0,r._)([(0,a.Cb)({type:Boolean,json:{write:!0}})],f.prototype,"nullable",void 0),(0,r._)([(0,u.J)(p.v)],f.prototype,"type",void 0),(0,r._)([(0,a.Cb)()],f.prototype,"valueType",void 0),(0,r._)([(0,h.r)("valueType",["description"])],f.prototype,"readValueType",null),f=s=(0,r._)([(0,c.j)("esri.layers.support.Field")],f);const g=f},56754:(e,t,i)=>{i.d(t,{Z:()=>u});var s,r=i(27366),n=(i(32718),i(25243),i(63780),i(93169),i(75366),i(27135)),o=i(69912),a=i(64538);let l=s=class extends a.Z{constructor(e){super(e),this.type="inherited"}clone(){return new s}};(0,r._)([(0,n.J)({inherited:"inherited"})],l.prototype,"type",void 0),l=s=(0,r._)([(0,o.j)("esri.layers.support.InheritedDomain")],l);const u=l},59068:(e,t,i)=>{i.d(t,{Z:()=>h});var s,r=i(27366),n=i(46784),o=i(49861),a=(i(63780),i(93169),i(25243)),l=i(69912);let u=s=class extends n.wq{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new s({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,r._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"cols",void 0),(0,r._)([(0,o.Cb)({type:a.z8,json:{write:!0}})],u.prototype,"level",void 0),(0,r._)([(0,o.Cb)({type:String,json:{write:!0}})],u.prototype,"levelValue",void 0),(0,r._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"origin",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{write:!0}})],u.prototype,"resolution",void 0),(0,r._)([(0,o.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],u.prototype,"rows",void 0),(0,r._)([(0,o.Cb)({type:Number,json:{write:!0}})],u.prototype,"scale",void 0),u=s=(0,r._)([(0,l.j)("esri.layers.support.LOD")],u);const h=u},30539:(e,t,i)=>{i.d(t,{Z:()=>h});var s,r=i(27366),n=i(49861),o=(i(63780),i(93169),i(25243),i(27135)),a=i(69912),l=i(64538);let u=s=class extends l.Z{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new s({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,r._)([(0,n.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],u.prototype,"maxValue",void 0),(0,r._)([(0,n.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],u.prototype,"minValue",void 0),(0,r._)([(0,o.J)({range:"range"})],u.prototype,"type",void 0),u=s=(0,r._)([(0,a.j)("esri.layers.support.RangeDomain")],u);const h=u},22824:(e,t,i)=>{i.d(t,{Z:()=>b});var s,r=i(27366),n=i(43404),o=i(46784),a=i(92026),l=i(68860),u=i(49861),h=(i(63780),i(93169),i(25243)),c=i(38511),d=i(69912),p=i(31201),m=i(7882),f=i(78952),g=i(65156),y=i(92975),_=i(81753),v=i(59068);const w=new n.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let C=s=class extends o.wq{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:n=f.Z.WebMercator,numLODs:o=24}=e;if(!(0,y.JY)(n)){const e=[];if(i)for(let t=0;t<i.length;t++){const s=i[t];e.push({level:t,scale:s,resolution:s})}else{let t=5e-4;for(let i=o-1;i>=0;i--)e.unshift({level:i,scale:t,resolution:t}),t*=2}return new s({dpi:96,lods:e,origin:new m.Z(0,0,n),size:[r,r],spatialReference:n})}const a=(0,y.C5)(n),u=e.origin?new m.Z({x:e.origin.x,y:e.origin.y,spatialReference:n}):new m.Z(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),h=1/(39.37*(0,l.c9)(n)*96),c=[];if(i)for(let s=0;s<i.length;s++){const e=i[s],t=e*h;c.push({level:s,scale:e,resolution:t})}else{let e=(0,y.sT)(n)?512/r*591657527.5917094:256/r*591657527.591555;const i=Math.ceil(o/t);c.push({level:0,scale:e,resolution:e*h});for(let s=1;s<i;s++){const i=e/2**t,r=i*h;c.push({level:s,scale:i,resolution:r}),e=i}}return new s({dpi:96,lods:c,origin:u,size:[r,r],spatialReference:n})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=(0,y.C5)(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return m.Z.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const s=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach((e=>{s.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,this._levelToLOD[e.level]=e}))),this._set("scales",s),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),s=i+1;return t[i]/(t[i]/t[s])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let s=0;for(;s<i;s++){const i=t[s],r=t[s+1];if(i<=e)return s;if(r===e)return s+1;if(i>e&&r<e)return s+Math.log(i/e)/Math.log(i/r)}return s}snapScale(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95;const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,s){const r=this.lodAt(e);if(!r)return null;let n,o;if("number"==typeof t)n=t,o=i;else if((0,y.fS)(t.spatialReference,this.spatialReference))n=t.x,o=t.y,s=i;else{const e=(0,_.iV)(t,this.spatialReference);if((0,a.Wi)(e))return null;n=e.x,o=e.y,s=i}const l=r.resolution*this.size[0],u=r.resolution*this.size[1];return s||(s={id:null,level:0,row:0,col:0,extent:(0,g.Ue)()}),s.level=e,s.row=Math.floor((this.origin.y-o)/u+.001),s.col=Math.floor((n-this.origin.x)/l+.001),this.updateTileInfo(s),s}updateTileInfo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.ExtrapolateOptions.NONE,i=this.lodAt(e.level);if(!i&&t===s.ExtrapolateOptions.POWER_OF_TWO){const t=this.lods[this.lods.length-1];t.level<e.level&&(i=t)}if(!i)return;const r=e.level-i.level,n=i.resolution*this.size[0]/2**r,o=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=(0,g.Ue)()),e.extent[0]=this.origin.x+e.col*n,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+n,e.extent[3]=e.extent[1]+o}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),s=i*this.size[0],r=i*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*r,e[2]=e[0]+s,e[3]=e[1]+r,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return s.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(256===this.size[0]&&256===this.size[1])return 256===e?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const e=this.lods[s],r=e.resolution*t;i.push(new v.Z({level:e.level,scale:e.scale,resolution:r}))}return new s({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const s=e[i];this._upsampleLevels[s.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/s.resolution:0},t=s}}};(0,r._)([(0,u.Cb)({type:Number,json:{write:!0}})],C.prototype,"compressionQuality",void 0),(0,r._)([(0,u.Cb)({type:Number,json:{write:!0}})],C.prototype,"dpi",void 0),(0,r._)([(0,u.Cb)({type:String,json:{read:w.read,write:w.write,origins:{"web-scene":{read:!1,write:!1}}}})],C.prototype,"format",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],C.prototype,"isWrappable",null),(0,r._)([(0,u.Cb)({type:m.Z,json:{write:!0}})],C.prototype,"origin",void 0),(0,r._)([(0,c.r)("origin")],C.prototype,"readOrigin",null),(0,r._)([(0,u.Cb)({type:[v.Z],value:null,json:{write:!0}})],C.prototype,"lods",null),(0,r._)([(0,u.Cb)({readOnly:!0})],C.prototype,"minScale",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],C.prototype,"maxScale",void 0),(0,r._)([(0,u.Cb)({readOnly:!0})],C.prototype,"scales",void 0),(0,r._)([(0,u.Cb)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],C.prototype,"size",void 0),(0,r._)([(0,c.r)("size",["rows","cols"])],C.prototype,"readSize",null),(0,r._)([(0,p.c)("size",{cols:{type:h.z8},rows:{type:h.z8}})],C.prototype,"writeSize",null),(0,r._)([(0,u.Cb)({type:f.Z,json:{write:!0}})],C.prototype,"spatialReference",void 0),C=s=(0,r._)([(0,d.j)("esri.layers.support.TileInfo")],C),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(C||(C={}));const b=C},43957:(e,t,i)=>{i.d(t,{Z:()=>v});var s,r=i(27366),n=i(62044),o=i(12355),a=i(46784),l=i(84652),u=i(92026),h=i(49861),c=(i(25243),i(38511)),d=i(69912),p=i(31201);i(63780),i(93169);let m=s=class extends a.wq{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new s({respectsDaylightSaving:e,timezone:t})}};(0,r._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],m.prototype,"respectsDaylightSaving",void 0),(0,r._)([(0,c.r)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],m.prototype,"readRespectsDaylightSaving",null),(0,r._)([(0,h.Cb)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],m.prototype,"timezone",void 0),m=s=(0,r._)([(0,d.j)("esri.layers.support.TimeReference")],m);const f=m;var g,y=i(58359);let _=g=class extends a.wq{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const i=new Date(t.timeExtent[0]),s=new Date(t.timeExtent[1]);return new n.Z({start:i,end:s})}writeFullTimeExtent(e,t){e&&(0,u.pC)(e.start)&&(0,u.pC)(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new o.Z({value:t.timeInterval,unit:y.v.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new o.Z({value:t.defaultTimeInterval,unit:y.v.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:s,startField:r,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:u}=this;return new g({cumulative:e,endField:t,hasLiveData:i,interval:s,startField:r,timeReference:(0,l.d9)(n),fullTimeExtent:(0,l.d9)(o),trackIdField:a,useTime:u})}};(0,r._)([(0,h.Cb)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],_.prototype,"cumulative",void 0),(0,r._)([(0,h.Cb)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],_.prototype,"endField",void 0),(0,r._)([(0,h.Cb)({type:n.Z,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"fullTimeExtent",void 0),(0,r._)([(0,c.r)("fullTimeExtent",["timeExtent"])],_.prototype,"readFullTimeExtent",null),(0,r._)([(0,p.c)("fullTimeExtent")],_.prototype,"writeFullTimeExtent",null),(0,r._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],_.prototype,"hasLiveData",void 0),(0,r._)([(0,h.Cb)({type:o.Z,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"interval",void 0),(0,r._)([(0,c.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],_.prototype,"readInterval",null),(0,r._)([(0,p.c)("interval")],_.prototype,"writeInterval",null),(0,r._)([(0,h.Cb)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],_.prototype,"startField",void 0),(0,r._)([(0,h.Cb)({type:f,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"timeReference",void 0),(0,r._)([(0,h.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],_.prototype,"trackIdField",void 0),(0,r._)([(0,h.Cb)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],_.prototype,"useTime",void 0),_=g=(0,r._)([(0,d.j)("esri.layers.support.TimeInfo")],_);const v=_},25899:(e,t,i)=>{i.d(t,{B5:()=>c,DR:()=>p,G:()=>w,M8:()=>g,Nm:()=>y,Qc:()=>d,XG:()=>_,a7:()=>f,h3:()=>C,ld:()=>m,wH:()=>v});var s=i(92026),r=i(35995),n=i(53283);const o={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},a=Object.values(o),l=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),u=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${a.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),h=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function c(e){return!!l.test(e)}function d(e){if((0,s.Wi)(e))return null;const t=(0,r.mN)(e),i=t.path.match(l)||t.path.match(u);if(!i)return null;const[,n,a,h,c]=i,d=a.indexOf("/");return{title:m(-1!==d?a.slice(d+1):a),serverType:o[h.toLowerCase()],sublayer:null!=c&&""!==c?parseInt(c,10):null,url:{path:n}}}function p(e){const t=(0,r.mN)(e).path.match(h);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function m(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function f(e,t){const i=[];if(e){const t=d(e);(0,s.pC)(t)&&t.title&&i.push(t.title)}if(t){const e=m(t);i.push(e)}if(2===i.length){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function g(e){if(!e)return!1;const t=(e=e.toLowerCase()).includes(".arcgis.com/"),i=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return t&&i}function y(e,t){return e?(0,r.Qj)((0,r.Hu)(e,t)):e}function _(e){let{url:t}=e;if(!t)return{url:t};t=(0,r.Hu)(t,e.logger);const i=(0,r.mN)(t),n=d(i.path);let o;if((0,s.pC)(n))null!=n.sublayer&&null==e.layer.layerId&&(o=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){const e=p(i.path);(0,s.pC)(e)&&(t=e.serviceUrl,o=e.sublayerId)}return{url:(0,r.Qj)(t),layerId:o}}function v(e,t,i,s,o){(0,n.w)(t,s,"url",o),s.url&&null!=e.layerId&&(s.url=(0,r.v_)(s.url,i,e.layerId.toString()))}function w(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),s=t.includes("/mapserver/wmsserver"),r=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(s||r||n)}function C(e){if(!e)return!1;const t=new r.R9((0,r.hF)(e)).authority.toLowerCase();return"server.arcgisonline.com"===t||"services.arcgisonline.com"===t}},67755:(e,t,i)=>{i.d(t,{V5:()=>a,im:()=>l});i(93169);var s=i(22528),r=i(64538),n=i(56754),o=i(30539);const a={key:"type",base:r.Z,typeMap:{range:o.Z,"coded-value":s.Z,inherited:n.Z}};function l(e){if(!e||!e.type)return null;switch(e.type){case"range":return o.Z.fromJSON(e);case"codedValue":return s.Z.fromJSON(e);case"inherited":return n.Z.fromJSON(e)}return null}},85249:(e,t,i)=>{i.d(t,{v:()=>s});const s=new(i(43404).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},58359:(e,t,i)=>{i.d(t,{v:()=>s});const s=(0,i(43404).w)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},68620:(e,t,i)=>{i.d(t,{p:()=>n});var s=i(92026),r=i(93501);function n(e,t,i){if(!i||!i.features||!i.hasZ)return;const n=(0,r.k)(i.geometryType,t,e.outSpatialReference);if(!(0,s.Wi)(n))for(const s of i.features)n(s.geometry)}},32970:(e,t,i)=>{i.d(t,{Z:()=>p});var s,r=i(27366),n=i(51995),o=i(84652),a=i(49861),l=i(25243),u=i(27135),h=i(69912),c=i(55661);let d=s=class extends c.Z{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new s({fromColor:(0,o.d9)(this.fromColor),toColor:(0,o.d9)(this.toColor),algorithm:this.algorithm})}};(0,r._)([(0,u.J)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],d.prototype,"algorithm",void 0),(0,r._)([(0,a.Cb)({type:n.Z,json:{type:[l.z8],write:!0}})],d.prototype,"fromColor",void 0),(0,r._)([(0,a.Cb)({type:n.Z,json:{type:[l.z8],write:!0}})],d.prototype,"toColor",void 0),(0,r._)([(0,a.Cb)({type:["algorithmic"]})],d.prototype,"type",void 0),d=s=(0,r._)([(0,h.j)("esri.rest.support.AlgorithmicColorRamp")],d);const p=d},55661:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(27366),r=i(46784),n=i(49861),o=(i(63780),i(93169),i(25243),i(69912));let a=class extends r.wq{constructor(e){super(e),this.type=null}};(0,s._)([(0,n.Cb)({readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=(0,s._)([(0,o.j)("esri.rest.support.ColorRamp")],a);const l=a},58169:(e,t,i)=>{i.d(t,{Z:()=>c});var s,r=i(27366),n=i(84652),o=i(49861),a=(i(25243),i(69912)),l=i(32970),u=i(55661);let h=s=class extends u.Z{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new s({colorRamps:(0,n.d9)(this.colorRamps)})}};(0,r._)([(0,o.Cb)({type:[l.Z],json:{write:!0}})],h.prototype,"colorRamps",void 0),(0,r._)([(0,o.Cb)({type:["multipart"]})],h.prototype,"type",void 0),h=s=(0,r._)([(0,a.j)("esri.rest.support.MultipartColorRamp")],h);const c=h},57634:(e,t,i)=>{i.d(t,{V:()=>o,i:()=>a});var s=i(32970),r=i(55661),n=i(58169);const o={key:"type",base:r.Z,typeMap:{algorithmic:s.Z,multipart:n.Z}};function a(e){return e&&e.type?"algorithmic"===e.type?s.Z.fromJSON(e):"multipart"===e.type?n.Z.fromJSON(e):null:null}},77658:(e,t,i)=>{i.r(t),i.d(t,{FeatureServiceSnappingSourceWorker:()=>K,default:()=>X});var s=i(27366),r=i(91505),n=i(100),o=i(92026),a=i(66978),l=i(94172),u=i(49861),h=i(63780),c=(i(93169),i(25243),i(69912)),d=i(61826),p=i(78952),m=i(68928),f=i(14e3),g=i(22824),y=i(43957),_=i(21149),v=i(85015);let w=class extends v.Z{constructor(){super(...arguments),this.updating=!1,this.pending=[]}push(e,t){this.pending.push({promise:e,callback:t}),1===this.pending.length&&this._process()}_process(){if(!this.pending.length)return void(this.updating=!1);this.updating=!0;const e=this.pending[0];e.promise.then((t=>e.callback(t))).catch((()=>{})).then((()=>{this.pending.shift(),this._process()}))}};(0,s._)([(0,u.Cb)()],w.prototype,"updating",void 0),w=(0,s._)([(0,c.j)("esri.core.AsyncSequence")],w);var C,b=i(41691),T=i(42537),S=i(32718),F=i(53866),E=i(65156),x=i(83406),I=i(25899),M=i(70436),O=i(5192),R=i(14921);class D{constructor(e,t){this.data=e,this.resolution=t,this.state={type:C.CREATED},this.alive=!0}process(e){switch(this.state.type){case C.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case C.FETCH_COUNT:break;case C.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case C.FETCH_FEATURES:break;case C.FETCHED_FEATURES:this.state=this._goToDone(this.state,e);case C.DONE:}return null}get debugInfo(){return{data:this.data,featureCount:this.featureCount,state:this.stateToString}}get featureCount(){switch(this.state.type){case C.CREATED:case C.FETCH_COUNT:return 0;case C.FETCHED_COUNT:return this.state.featureCount;case C.FETCH_FEATURES:return this.state.previous.featureCount;case C.FETCHED_FEATURES:return this.state.features.length;case C.DONE:return this.state.previous.features.length}}get stateToString(){switch(this.state.type){case C.CREATED:return"created";case C.FETCH_COUNT:return"fetch-count";case C.FETCHED_COUNT:return"fetched-count";case C.FETCH_FEATURES:return"fetch-features";case C.FETCHED_FEATURES:return"fetched-features";case C.DONE:return"done"}}_gotoFetchCount(e,t){return{type:C.FETCH_COUNT,previous:e,task:(0,a.vr)((async e=>{const i=await(0,R.mt)(t.fetchCount(this,e));this.state.type===C.FETCH_COUNT&&(this.state=this._gotoFetchedCount(this.state,i.ok?i.value:1/0))}))}}_gotoFetchedCount(e,t){return{type:C.FETCHED_COUNT,featureCount:t,previous:e}}_gotoFetchFeatures(e,t){return{type:C.FETCH_FEATURES,previous:e,task:(0,a.vr)((async i=>{const s=await(0,R.mt)(t.fetchFeatures(this,e.featureCount,i));this.state.type===C.FETCH_FEATURES&&(this.state=this._gotoFetchedFeatures(this.state,s.ok?s.value:[]))}))}}_gotoFetchedFeatures(e,t){return{type:C.FETCHED_FEATURES,previous:e,features:t}}_goToDone(e,t){return t.finish(this,e.features),{type:C.DONE,previous:e}}reset(){const e=this.state;switch(this.state={type:C.CREATED},e.type){case C.CREATED:case C.FETCHED_COUNT:case C.FETCHED_FEATURES:case C.DONE:break;case C.FETCH_COUNT:case C.FETCH_FEATURES:e.task.abort()}}intersects(e){return!(!(0,o.Wi)(e)&&this.data.extent)||((0,E.oJ)(e,z),(0,E.kK)(this.data.extent,z))}}!function(e){e[e.CREATED=0]="CREATED",e[e.FETCH_COUNT=1]="FETCH_COUNT",e[e.FETCHED_COUNT=2]="FETCHED_COUNT",e[e.FETCH_FEATURES=3]="FETCH_FEATURES",e[e.FETCHED_FEATURES=4]="FETCHED_FEATURES",e[e.DONE=5]="DONE"}(C||(C={}));const z=(0,E.Ue)(),N=S.Z.getLogger("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher");let A=class extends b.r{constructor(e){super(e),this.tilesOfInterest=[],this.availability=0,this.pendingTiles=new Map,this.pendingEdits=new w,this.pendingEditsAbortController=new AbortController}get minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}set filter(e){const t=this._get("filter"),i=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(i)&&this._set("filter",i)}set customParameters(e){const t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}get configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get("tileInfo");t!==e&&((0,o.pC)(e)&&(0,o.pC)(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}set tileSize(e){this._get("tileSize")!==e&&this._set("tileSize",e)}get updating(){return this.updatingHandles.updating||this.pendingEdits.updating}initialize(){this._initializeFetchExtent(),this.updatingHandles.add((()=>this.configuration),(()=>this.refresh())),this.updatingHandles.add((()=>this.tilesOfInterest),((e,t)=>{(0,h.fS)(e,t,((e,t)=>{let{id:i}=e,{id:s}=t;return i===s}))||this._process()}),l.Z_)}destroy(){this.pendingTiles.forEach((e=>this._deletePendingTile(e))),this.pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this.pendingEditsAbortController.abort(),this.pendingEditsAbortController=null}refresh(){this.store.refresh(),this.pendingTiles.forEach((e=>this._deletePendingTile(e))),this._process()}applyEdits(e){this.pendingEdits.push(e,(async e=>{if(0===e.addedFeatures.length&&0===e.updatedFeatures.length&&0===e.deletedFeatures.length)return;for(const[,i]of this.pendingTiles)i.reset();const t={...e,deletedFeatures:e.deletedFeatures.map((e=>{let{objectId:t,globalId:i}=e;return t&&-1!==t?t:this._lookupObjectIdByGlobalId(i)}))};await this.updatingHandles.addPromise(this.store.processEdits(t,((e,t)=>this._queryFeaturesById(e,t)),this.pendingEditsAbortController.signal)),this._processPendingTiles()}))}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!(0,I.M8)(this.url))return;const e=(0,a.vr)((async e=>{try{const t=await(0,O.executeQueryForExtent)(this.url,new _.Z({where:"1=1",outSpatialReference:this.spatialReference,cacheHint:!!this.capabilities.query.supportsCacheHint||void 0}),{query:this.configuration.customParameters,signal:e});this.store.extent=F.Z.fromJSON(t.data?.extent)}catch(V){(0,a.r9)(V),N.warn("Failed to fetch data extent",V)}}));this.updatingHandles.addPromise(e.promise.then((()=>this._process()))),this.handles.add((0,T.kB)((()=>e.abort())))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this.pendingTiles.values()).map((e=>e.debugInfo)),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,e]of this.pendingTiles)e.alive=!1}_createPendingTiles(){const e=this._collectMissingTilesInfo();if(this._setAvailability((0,o.Wi)(e)?1:e.coveredArea/e.fullArea),!(0,o.Wi)(e))for(const{data:t,resolution:i}of e.missingTiles){const e=this.pendingTiles.get(t.id);e?(e.resolution=i,e.alive=!0):this._createPendingTile(t,i)}}_collectMissingTilesInfo(){let e=null;for(let t=this.tilesOfInterest.length-1;t>=0;t--){const i=this.tilesOfInterest[t],s=this.store.process(i,((e,t)=>this._verifyTileComplexity(e,t)));(0,o.Wi)(e)?e=s:e.prepend(s)}return e}_deletePendingTiles(){for(const[,e]of this.pendingTiles)e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,i)=>this._fetchFeatures(e,t,i),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const[,t]of this.pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this.updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this.minimumVerticesPerFeature<Z}_verifyFeatureDensity(e,t){if((0,o.Wi)(this.tileInfo))return!1;const i=this.tileSize*t;return e*(U/(i*i))<H}_ensureFetchAllCounts(e){let t=!0;for(const[,i]of this.pendingTiles)i.state.type<C.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(e)),i.state.type<=C.FETCH_COUNT&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability((0,o.Wi)(e)?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set("availability",e)}_createPendingTile(e,t){const i=new D(e,t);return this.pendingTiles.set(e.id,i),i}_deletePendingTile(e){e.reset(),this.pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:P,signal:t})}async _fetchFeatures(e,t,i){let s,r=0,n=0,a=t;for(;;){const l=this._createFeaturesQuery(e),u=this._setPagingParameters(l,r,a),{features:h,exceededTransferLimit:c}=await this._queryFeatures(l,i);if(u&&(r+=(0,o.Wg)(l.num)),n+=h.length,s=s?s.concat(h):h,a=t-n,!u||!c||a<=0)return s}}_filterProperties(e){return(0,o.Wi)(e)?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,i=this.objectIdField;if((0,o.Wi)(t))throw new Error("Expected globalIdField to be defined");let s=null;if(this.store.featureStore.forEach((r=>{e===r.attributes[t]&&(s=r.objectId??r.attributes[i])})),(0,o.Wi)(s))throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const i=this._createFeaturesQuery(null);return i.objectIds=e,this._queryFeatures(i,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:i}=this,{data:s}=await(0,O.executeQueryPBF)(this.url,e,new M.J({sourceSpatialReference:i}),{query:this.configuration.customParameters,timeout:P,signal:t});return(0,x.lM)(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:i}=this,{data:s}=await(0,O.executeQuery)(this.url,e,i,{query:this.configuration.customParameters,timeout:P,signal:t});return(0,x.h_)(s,this.objectIdField)}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e){const t=this._createBaseQuery(e);return t.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],t.returnGeometry=!0,(0,o.pC)(e)&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new _.Z({returnZ:!1,returnM:!1,geometry:(0,o.pC)(this.tileInfo)&&(0,o.pC)(e)?(0,E.HH)(e.data.extent,this.tileInfo.spatialReference):void 0}),i=this.configuration.filter;return(0,o.pC)(i)&&(t.where=i.where,t.gdbVersion=i.gdbVersion,t.timeExtent=i.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:r,tileMaxRecordCount:n,maxRecordCount:o,supportsResultType:a}=this.capabilities.query,l=s?_.Z.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||r)&&n?n:o||j);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(i/u)),e.num=Math.min(i,e.maxRecordCountFactor*u)):e.num=Math.min(i,u),!0}};(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"url",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"objectIdField",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"globalIdField",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"capabilities",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"sourceSpatialReference",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"spatialReference",void 0),(0,s._)([(0,u.Cb)({constructOnly:!0})],A.prototype,"store",void 0),(0,s._)([(0,u.Cb)({readOnly:!0})],A.prototype,"minimumVerticesPerFeature",null),(0,s._)([(0,u.Cb)()],A.prototype,"filter",null),(0,s._)([(0,u.Cb)()],A.prototype,"customParameters",null),(0,s._)([(0,u.Cb)({readOnly:!0})],A.prototype,"configuration",null),(0,s._)([(0,u.Cb)()],A.prototype,"tileInfo",null),(0,s._)([(0,u.Cb)()],A.prototype,"tileSize",null),(0,s._)([(0,u.Cb)()],A.prototype,"tilesOfInterest",void 0),(0,s._)([(0,u.Cb)({readOnly:!0})],A.prototype,"updating",null),(0,s._)([(0,u.Cb)({readOnly:!0})],A.prototype,"availability",void 0),A=(0,s._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],A);const j=2e3,P=6e5,Z=1e6,U=25,H=1;var k=i(59896),L=i(66020);class V{constructor(){this._store=new Map,this._byteSize=0}set(e,t){this.delete(e),this._store.set(e,t),this._byteSize+=t.byteSize}delete(e){const t=this._store.get(e);return!!this._store.delete(e)&&(this._byteSize-=t.byteSize,!0)}get(e){return this._used(e),this._store.get(e)}has(e){return this._used(e),this._store.has(e)}clear(){this._store.clear()}applyByteSizeLimit(e,t){for(const[i,s]of this._store){if(this._byteSize<=e)break;this.delete(i),t(s)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}_used(e){const t=this._store.get(e);t&&(this._store.delete(e),this._store.set(e,t))}}let W=class extends v.Z{constructor(e){super(e),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*k.Y8.MEGABYTES,this.tileBounds=new L.H,this.tiles=new V,this.refCounts=new Map,this.tileFeatureCounts=new Map,this.tmpBoundingRect=(0,E.Ue)()}add(e,t){const i=[];for(const s of t)this._referenceFeature(s.objectId)===Q.ADDED&&i.push(s);this._addTileStorage(e,new Set(t.map((e=>{let{objectId:t}=e;return t}))),function(e){return e.reduce(((e,t)=>e+function(e){return 32+function(e){if((0,o.Wi)(e))return 0;const t=(0,k.do)(e.lengths,4);return 32+(0,k.do)(e.coords,8)+t}(e.geometry)+(0,k.f2)(e.attributes)}(t)),0)}(t)),this.featureStore.addMany(i),this.tiles.applyByteSizeLimit(this.maximumByteSize,(e=>this._removeTileStorage(e)))}destroy(){this.clear(),this.tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this.tileBounds.clear(),this.tiles.clear(),this.refCounts.clear()}refresh(){this.clear(),this.tileFeatureCounts.clear()}processEdits(e,t,i){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,i)}_addTileStorage(e,t,i){this.tiles.set(e.id,new B(e,t,i)),this.tileBounds.set(e.id,e.extent),this.tileFeatureCounts.set(e.id,t.size)}_remove(e){let{id:t}=e;const i=this.tiles.get(t);i&&this._removeTileStorage(i)}_removeTileStorage(e){const t=[];for(const s of e.objectIds)this._unreferenceFeature(s)===Q.REMOVED&&t.push(s);this.featureStore.removeManyById(t);const i=e.data.id;this.tiles.delete(i),this.tileBounds.delete(i)}_processEditsDelete(e){this.featureStore.removeManyById(e);for(const[,t]of this.tiles){for(const i of e)t.objectIds.delete(i);this.tileFeatureCounts.set(t.data.id,t.objectIds.size)}for(const t of e)this.refCounts.delete(t)}async _processEditsRefetch(e,t,i){const s=(await t(e,i)).features,{hasZ:r,hasM:n}=this.featureStore;for(const a of s){const e=(0,x.$)(this.tmpBoundingRect,a.geometry,r,n);(0,o.Wi)(e)||this.tileBounds.forEachInBounds(e,(e=>{const t=this.tiles.get(e);this.featureStore.add(a),t.objectIds.has(a.objectId)||(t.objectIds.add(a.objectId),this._referenceFeature(a.objectId),this.tileFeatureCounts.set(t.data.id,t.objectIds.size))}))}}process(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;if((0,o.Wi)(this.tileInfo)||!e.extent||(0,o.pC)(this.extent)&&!(0,E.kK)((0,E.oJ)(this.extent,this.tmpBoundingRect),e.extent))return new q(e);if(this.tiles.has(e.id))return new q(e);const i=this._createTileTree(e,this.tileInfo);return this._simplify(i,t,null,0,1),this._collectMissingTiles(e,i,this.tileInfo)}get debugInfo(){return Array.from(this.tiles.values()).map((e=>{let{data:t}=e;return{data:t,featureCount:this.tileFeatureCounts.get(t.id)||0}}))}getFeatureCount(e){return this.tileFeatureCounts.get(e.id)??0}async fetchCount(e,t,i,s){const r=this.tileFeatureCounts.get(e.id);if(null!=r)return r;const n=await(0,O.executeQueryForCount)(t,i,s);return this.tileFeatureCounts.set(e.id,n.data.count),n.data.count}_createTileTree(e,t){const i=new J(e.level,e.row,e.col);return t.updateTileInfo(i,g.Z.ExtrapolateOptions.POWER_OF_TWO),this.tileBounds.forEachInBounds(e.extent,(s=>{const r=this.tiles.get(s).data;this._tilesAreRelated(e,r)&&this._populateChildren(i,r,t,this.tileFeatureCounts.get(r.id)||0)})),i}_tilesAreRelated(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;const i=e.level<t.level,s=i?e:t,r=i?t:e,n=1<<r.level-s.level;return Math.floor(r.row/n)===s.row&&Math.floor(r.col/n)===s.col}_populateChildren(e,t,i,s){const r=t.level-e.level-1;if(r<0)return void(e.isLeaf=!0);const n=t.row>>r,a=t.col>>r,l=e.row<<1,u=a-(e.col<<1)+(n-l<<1),h=e.children[u];if((0,o.pC)(h))this._populateChildren(h,t,i,s);else{const r=new J(e.level+1,n,a);i.updateTileInfo(r,g.Z.ExtrapolateOptions.POWER_OF_TWO),e.children[u]=r,this._populateChildren(r,t,i,s)}}_simplify(e,t,i,s,r){const n=r*r;if(e.isLeaf)return t(this.getFeatureCount(e),r)?0:(this._remove(e),(0,o.pC)(i)&&(i.children[s]=null),n);const a=r/2,l=a*a;let u=0;for(let h=0;h<e.children.length;h++){const i=e.children[h];u+=(0,o.pC)(i)?this._simplify(i,t,e,h,a):l}return 0===u?this._mergeChildren(e):1-u/n<G&&(this._purge(e),(0,o.pC)(i)&&(i.children[s]=null),u=n),u}_mergeChildren(e){const t=new Set;let i=0;this._forEachLeaf(e,(e=>{const s=this.tiles.get(e.id);if(s){i+=s.byteSize;for(const e of s.objectIds)t.has(e)||(t.add(e),this._referenceFeature(e));this._remove(e)}})),this._addTileStorage(e,t,i),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this.tileFeatureCounts.set(e.id,t.size)}_forEachLeaf(e,t){for(const i of e.children)(0,o.Wi)(i)||(i.isLeaf?t(i):this._forEachLeaf(i,t))}_purge(e){if(!(0,o.Wi)(e))if(e.isLeaf)this._remove(e);else for(let t=0;t<e.children.length;t++){const i=e.children[t];this._purge(i),e.children[t]=null}}_collectMissingTiles(e,t,i){const s=new Y(i,e,this.extent);return this._collectMissingTilesRecurse(t,s,1),s.info}_collectMissingTilesRecurse(e,t,i){if(e.isLeaf)return;if(!e.hasChildren)return void t.addMissing(e.level,e.row,e.col,i);const s=i/2;for(let r=0;r<e.children.length;r++){const i=e.children[r];(0,o.Wi)(i)?t.addMissing(e.level+1,(e.row<<1)+((2&r)>>1),(e.col<<1)+(1&r),s):this._collectMissingTilesRecurse(i,t,s)}}_referenceFeature(e){const t=(this.refCounts.get(e)||0)+1;return this.refCounts.set(e,t),1===t?Q.ADDED:Q.UNCHANGED}_unreferenceFeature(e){const t=(this.refCounts.get(e)||0)-1;return 0===t?(this.refCounts.delete(e),Q.REMOVED):(t>0&&this.refCounts.set(e,t),Q.UNCHANGED)}get test(){return{tiles:Array.from(this.tiles.values()).map((e=>`${e.data.id}:[${Array.from(e.objectIds)}]`)),featureReferences:Array.from(this.refCounts.keys()).map((e=>`${e}:${this.refCounts.get(e)}`))}}};(0,s._)([(0,u.Cb)({constructOnly:!0})],W.prototype,"featureStore",void 0),(0,s._)([(0,u.Cb)()],W.prototype,"tileInfo",void 0),(0,s._)([(0,u.Cb)()],W.prototype,"extent",void 0),(0,s._)([(0,u.Cb)()],W.prototype,"maximumByteSize",void 0),W=(0,s._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],W);class B{constructor(e,t,i){this.data=e,this.objectIds=t,this.byteSize=i}}class J{constructor(e,t,i){this.level=e,this.row=t,this.col=i,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&((0,o.pC)(this.children[0])||(0,o.pC)(this.children[1])||(0,o.pC)(this.children[2])||(0,o.pC)(this.children[3]))}}class q{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.missingTiles=t,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,E.SO)(e.extent),this.coveredArea=this.fullArea}prepend(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}class Y{constructor(e,t,i){this.tileInfo=e,this.extent=null,this.info=new q(t),(0,o.pC)(i)&&(this.extent=(0,E.oJ)(i))}addMissing(e,t,i,s){const r={id:null,level:e,row:t,col:i};this.tileInfo.updateTileInfo(r,g.Z.ExtrapolateOptions.POWER_OF_TWO),(0,o.Wi)(r.extent)||(0,o.pC)(this.extent)&&!(0,E.kK)(this.extent,r.extent)||(this.info.missingTiles.push({data:r,resolution:s}),this.info.coveredArea-=(0,E.SO)(r.extent))}}const G=.18751;var Q,$;($=Q||(Q={}))[$.ADDED=0]="ADDED",$[$.REMOVED=1]="REMOVED",$[$.UNCHANGED=2]="UNCHANGED";let K=class extends r.Z.EventedAccessor{constructor(){super(...arguments),this.isInitializing=!0,this.whenSetup=(0,a.dD)(),this.handles=new n.Z,this.updatingHandles=new d.t,this.pendingApplyEdits=new Map}get updating(){return this.featureFetcher.updating||this.isInitializing||this.updatingHandles.updating}destroy(){this.featureFetcher.destroy(),this.queryEngine.destroy(),this.featureStore.clear(),this.handles.destroy()}async setup(e){const{geometryType:t,objectIdField:i,timeInfo:s,fields:r}=e.serviceInfo;return this.featureStore=new m.Z({...e.serviceInfo,hasZ:!1,hasM:!1}),this.queryEngine=new f.q({spatialReference:e.spatialReference,featureStore:this.featureStore,geometryType:t,fields:r,hasZ:!1,hasM:!1,objectIdField:i,timeInfo:s?y.Z.fromJSON(s):null}),this.featureFetcher=new A({store:new W({featureStore:this.featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:p.Z.fromJSON(e.spatialReference),sourceSpatialReference:p.Z.fromJSON(e.serviceInfo.spatialReference)}),this.handles.add([(0,l.YP)((()=>this.featureFetcher.availability),(e=>this.emit("notify-availability",{availability:e})),l.Z_),(0,l.YP)((()=>this.updating),(()=>this._notifyUpdating()))]),this.whenSetup.resolve(),this.isInitializing=!1,this.configure(e.configuration)}async configure(e){return await this.updatingHandles.addPromise(this.whenSetup.promise),this._updateFeatureFetcherConfiguration(e),{result:{}}}async fetchCandidates(e,t){return await this.whenSetup.promise,(0,a.k_)(t),{result:await this.queryEngine.executeQueryForSnapping({point:e.point,distance:e.distance,types:e.types,query:(0,o.pC)(e.filter)?e.filter:{where:"1=1"}},(0,o.pC)(t)?t.signal:null)}}async updateTiles(e,t){return await this.updatingHandles.addPromise(this.whenSetup.promise),(0,a.k_)(t),this.featureFetcher.tileSize=e.tileSize,this.featureFetcher.tilesOfInterest=e.tiles,this.featureFetcher.tileInfo=(0,o.pC)(e.tileInfo)?g.Z.fromJSON(e.tileInfo):null,{result:{}}}async refresh(e,t){return await this.updatingHandles.addPromise(this.whenSetup.promise),(0,a.k_)(t),this.featureFetcher.refresh(),{result:{}}}async whenNotUpdating(e,t){return await this.updatingHandles.addPromise(this.whenSetup.promise),(0,a.k_)(t),await(0,l.N1)((()=>!this.updating),t),(0,a.k_)(t),{result:{}}}async getDebugInfo(e,t){return(0,a.k_)(t),{result:this.featureFetcher.debugInfo}}async beginApplyEdits(e,t){this.updatingHandles.addPromise(this.whenSetup.promise),(0,a.k_)(t);const i=(0,a.dD)();return this.pendingApplyEdits.set(e.id,i),this.featureFetcher.applyEdits(i.promise),this.updatingHandles.addPromise(i.promise),{result:{}}}async endApplyEdits(e,t){const i=this.pendingApplyEdits.get(e.id);return i&&i.resolve(e.edits),(0,a.k_)(t),{result:{}}}_updateFeatureFetcherConfiguration(e){this.featureFetcher.filter=(0,o.pC)(e.filter)?_.Z.fromJSON(e.filter):null,this.featureFetcher.customParameters=e.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};function X(){return new K}(0,s._)([(0,u.Cb)({readOnly:!0})],K.prototype,"updating",null),(0,s._)([(0,u.Cb)()],K.prototype,"isInitializing",void 0),K=(0,s._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],K)}}]);
//# sourceMappingURL=6715.c8ad8e14.chunk.js.map