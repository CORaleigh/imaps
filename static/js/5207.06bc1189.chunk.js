"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[5207],{11316:(t,e,i)=>{i.d(e,{S:()=>p,b:()=>h});var a=i(82552),n=i(95276),o=i(58406),s=i(98634),r=i(64201),l=i(4760);function h(t){const e=new r.kG;e.extensions.add("GL_OES_standard_derivatives");const{vertex:i,fragment:h,attributes:p,varyings:c}=e;return(0,a.Sv)(i,t),p.add(l.T.POSITION,"vec3"),p.add(l.T.UV0,"vec2"),c.add("vUV","vec2"),i.code.add(s.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),h.uniforms.add([new n.N("backgroundColor",(t=>t.backgroundColor)),new n.N("gridColor",(t=>t.gridColor)),new o.p("gridWidth",(t=>t.gridWidth))]),h.code.add(s.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const p=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},96866:(t,e,i)=>{i.d(e,{B:()=>c});var a=i(80292),n=i(35995),o=i(71907),s=i(33397),r=i(25265),l=i(49861),h=i(22892),p=i(53283);function c(t){const e=t?.origins??[void 0];return(i,o)=>{const c=function(t,e,i){if("resource"===t?.type)return function(t,e,i){const o=(0,s.Oe)(e,i);return{type:String,read:(t,e,i)=>{const a=(0,p.r)(t,e,i);return o.type===String?a:"function"==typeof o.type?new o.type({url:a}):void 0},write:{writer(e,s,l,c){if(!c||!c.resources)return"string"==typeof e?void(s[l]=(0,p.t)(e,c)):void(s[l]=e.write({},c));const _=function(t){return null==t?null:"string"==typeof t?t:t.url}(e),m=(0,p.t)(_,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},p.M.NO),v=o.type!==String&&(!(0,a.l)(this)||c&&c.origin&&this.originIdOf(i)>(0,r.M9)(c.origin)),f={object:this,propertyName:i,value:e,targetUrl:m,dest:s,targetPropertyName:l,context:c,params:t};c&&c.portalItem&&m&&!(0,n.YP)(m)?v?function(t){const{context:e,targetUrl:i,params:a,value:o,dest:s,targetPropertyName:r}=t;if(!e.portalItem)return;const l=e.portalItem.resourceFromPath(i),p=g(o,i,e),c=(0,h.B)(p),_=(0,n.Ml)(l.path),m=a?.compress??!1;c===_?(e.resources&&u({...t,resource:l,content:p,compress:m,updates:e.resources.toUpdate}),s[r]=i):d(t)}(f):function(t){let{context:e,targetUrl:i,dest:a,targetPropertyName:n}=t;e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),a[n]=i)}(f):c&&c.portalItem&&(null==m||null!=(0,p.i)(m)||(0,n.jc)(m)||v)?d(f):s[l]=m}}}}(t,e,i);switch(t?.type??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:t,write:e}=p.a;return{read:t,write:e}}}}(t,i,o);for(const t of e){const e=(0,l.CJ)(i,t,o);for(const t in c)e[t]=c[t]}}}function d(t){const{targetUrl:e,params:a,value:s,context:r,dest:l,targetPropertyName:c}=t;if(!r.portalItem)return;const d=(0,p.p)(e),_=d?.filename??(0,o.D)(),m=a?.prefix??d?.prefix,v=g(s,e,r),f=(0,n.v_)(m,_),y=`${f}.${(0,h.B)(v)}`,M=r.portalItem.resourceFromPath(y);(0,n.jc)(e)&&r.resources&&r.resources.pendingOperations.push(async function(t){const e=(await Promise.resolve().then(i.bind(i,76200))).default,{data:a}=await e(t,{responseType:"blob"});return a}(e).then((t=>{M.path=`${f}.${(0,h.B)(t)}`,l[c]=M.itemRelativeUrl})).catch((()=>{})));const b=a?.compress??!1;r.resources&&u({...t,resource:M,content:v,compress:b,updates:r.resources.toAdd}),l[c]=M.itemRelativeUrl}function u(t){let{object:e,propertyName:i,updates:a,resource:n,content:o,compress:s}=t;a.push({resource:n,content:o,compress:s,finish:t=>{!function(t,e,i){"string"==typeof t[e]?t[e]=i.url:t[e].url=i.url}(e,i,t)}})}function g(t,e,i){return"string"==typeof t?{url:e}:new Blob([JSON.stringify(t.toJSON(i))],{type:"application/json"})}},45238:(t,e,i)=>{i.d(e,{EU:()=>c,Ue:()=>r,WH:()=>d,ZZ:()=>p,qC:()=>h,uT:()=>l});var a=i(16889),n=i(48976),o=i(98131),s=i(11186);function r(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;return[t[0],t[1],t[2],t[3]]}function l(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();return(0,s.c)(i,t),i[3]=e,i}function h(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r();return(0,n.s)(_,t,d(t)),(0,n.s)(m,e,d(e)),(0,n.m)(_,m,_),u(i,(0,a.BV)((0,n.g)(i,_)))}function p(t){return t}function c(t){return t[3]}function d(t){return(0,a.Vl)(t[3])}function u(t,e){return t[3]=e,t}const g=[0,0,1,0],_=(0,o.a)(),m=(0,o.a)();r()},35888:(t,e,i)=>{i.d(e,{d:()=>o});var a=i(16889),n=i(72838);function o(t,e,i){const o=Array.isArray(t),p=o?t.length/e:t.byteLength/(4*e),c=o?t:new Uint32Array(t,0,p*e),d=i?.minReduction??0,u=i?.originalIndices||null,g=u?u.length:0,_=i?.componentOffsets||null;let m=0;if(_)for(let a=0;a<_.length-1;a++){const t=_[a+1]-_[a];t>m&&(m=t)}else m=p;const v=Math.floor(1.1*m)+1;(null==h||h.length<2*v)&&(h=new Uint32Array((0,a.Sf)(2*v)));for(let a=0;a<2*v;a++)h[a]=0;let f=0;const y=!!_&&!!u,M=y?g:p;let b=(0,n.$z)(p/3);const S=new Uint32Array(g),w=1.96;let x=0!==d?Math.ceil(4*w*w/(d*d)*d*(1-d)):M,C=1,O=_?_[1]:M;for(let a=0;a<M;a++){if(a===x){const t=1-f/a;if(t+w*Math.sqrt(t*(1-t)/a)<d)return null;x*=2}if(a===O){for(let t=0;t<2*v;t++)h[t]=0;if(u)for(let t=_[C-1];t<_[C];t++)S[t]=b[u[t]];O=_[++C]}const t=y?u[a]:a,i=t*e,n=l(c,i,e);let o=n%v,r=f;for(;0!==h[2*o+1];){if(h[2*o]===n){const t=h[2*o+1]-1;if(s(c,i,t*e,e)){r=b[t];break}}o++,o>=v&&(o-=v)}r===f&&(h[2*o]=n,h[2*o+1]=t+1,f++),b[t]=r}if(0!==d&&1-f/p<d)return null;if(y){for(let t=_[C-1];t<S.length;t++)S[t]=b[u[t]];b=(0,n.mi)(S)}const E=o?new Array(f):new Uint32Array(f*e);f=0;for(let a=0;a<M;a++)b[a]===f&&(r(c,(y?u[a]:a)*e,E,f*e,e),f++);if(u&&!y){const t=new Uint32Array(g);for(let e=0;e<t.length;e++)t[e]=b[u[e]];b=(0,n.mi)(t)}return{buffer:Array.isArray(E)?E:E.buffer,indices:b,uniqueCount:f}}function s(t,e,i,a){for(let n=0;n<a;n++)if(t[e+n]!==t[i+n])return!1;return!0}function r(t,e,i,a,n){for(let o=0;o<n;o++)i[a+o]=t[e+o]}function l(t,e,i){let a=0;for(let n=0;n<i;n++)a=t[e+n]+a|0,a=a+(a<<11)+(a>>>2)|0;return a>>>0}let h=null},91320:(t,e,i)=>{i.d(e,{Mk:()=>h,ZI:()=>a,bT:()=>l});var a,n=i(79347),o=i(69662),s=i(35888),r=i(88699);function l(t){const e=h(t.rings,t.hasZ,a.CCW_IS_HOLE),i=new Array;let o=0,l=0;for(const a of e.polygons){const t=a.count,s=a.index,h=(0,r.Rq)(e.position,3*s,3*t),p=a.holeIndices.map((t=>t-s)),c=new Uint32Array((0,n.e)(h,p,3));i.push({position:h,faces:c}),o+=h.length,l+=c.length}const p=function(t,e,i){if(1===t.length)return t[0];const a=(0,r.bg)(e),n=new Uint32Array(i);let o=0,s=0,l=0;for(const r of t){for(let t=0;t<r.position.length;t++)a[o++]=r.position[t];for(let t=0;t<r.faces.length;t++)n[s++]=r.faces[t]+l;l=o/3}return{position:a,faces:n}}(i,o,l),c=Array.isArray(p.position)?(0,s.d)(p.position,3,{originalIndices:p.faces}):(0,s.d)(p.position.buffer,6,{originalIndices:p.faces});return p.position=new Float64Array(c.buffer),p.faces=c.indices,p}function h(t,e,i){const n=t.length,o=new Array(n),s=new Array(n),l=new Array(n);let h=0,d=0,u=0,g=0;for(let a=0;a<n;++a)g+=t[a].length;const _=(0,r.bg)(3*g);let m=0;for(let r=n-1;r>=0;r--){const g=t[r],v=i===a.CCW_IS_HOLE&&c(g);if(v&&1!==n)o[h++]=g;else{let t=g.length;for(let e=0;e<h;++e)t+=o[e].length;const i={index:m,pathLengths:new Array(h+1),count:t,holeIndices:new Array(h)};i.pathLengths[0]=g.length,g.length>0&&(l[u++]={index:m,count:g.length}),m=v?p(g,g.length-1,-1,_,m,g.length,e):p(g,0,1,_,m,g.length,e);for(let a=0;a<h;++a){const t=o[a];i.holeIndices[a]=m,i.pathLengths[a+1]=t.length,t.length>0&&(l[u++]={index:m,count:t.length}),m=p(t,0,1,_,m,t.length,e)}h=0,i.count>0&&(s[d++]=i)}}for(let a=0;a<h;++a){const t=o[a];t.length>0&&(l[u++]={index:m,count:t.length}),m=p(t,0,1,_,m,t.length,e)}return s.length=d,l.length=u,{position:_,polygons:s,outlines:l}}function p(t,e,i,a,n,o,s){n*=3;for(let r=0;r<o;++r){const o=t[e];a[n++]=o[0],a[n++]=o[1],a[n++]=s?o[2]:0,e+=i}return n/3}function c(t){return!(0,o.bu)(t,!1,!1)}!function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(a||(a={}))},22892:(t,e,i)=>{i.d(e,{B:()=>n});var a=i(35995);function n(t){return o[function(t){return t instanceof Blob?t.type:function(t){const e=(0,a.Ml)(t);return l[e]||s}(t.url)}(t)]||r}const o={},s="text/plain",r=o[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const h in l)o[l[h]]=h},65207:(t,e,i)=>{i.r(e),i.d(e,{DrawGraphicTool3D:()=>Jt,ExtentTransformTool:()=>nn,GraphicMoveTool:()=>hi,GraphicReshapeTool:()=>zi,GraphicTransformTool:()=>oa});var a=i(27366),n=i(42537),o=i(92026),s=i(94172),r=i(49861),l=i(25243),h=i(63780),p=i(69912),c=i(11186),d=i(71353),u=i(74509),g=i(64575),_=i(17842),m=(i(32718),i(10064),i(93169)),v=i(85015),f=i(14921),y=i(66978),M=i(58935),b=i(88396),S=i(6394),w=i(69662),x=i(41201),C=i(74177),O=i(51995);i(42877);let E=t=>({vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}),A=(t,e,i)=>{for(let a=0,n=e.length;a<n;a++){let n=e[a];Array.isArray(n)?A(t,n,i):null!=n&&!1!==n&&("string"==typeof n&&(n=E(n)),i.push(n))}};i(88367);const T={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let R=class extends v.Z{get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const t=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${t}`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new O.Z([0,0,0,.6]),this.textColor=new O.Z([255,255,255]),this._textShadowSize=1}render(){return function(t,e,i){if(Array.isArray(e))i=e,e=void 0;else if(e&&("string"==typeof e||e.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,n;return i&&1===i.length&&"string"==typeof i[0]?a=i[0]:i&&(n=[],A(t,i,n),0===n.length&&(n=void 0)),{vnodeSelector:t,properties:e,children:n,text:""===a?void 0:a,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;const i=this._padding,a=this._borderRadius,n=t.measureText(this.text).width,o=this.fontSize,s=D[this.anchor];t.textAlign="center",t.textBaseline="middle";const r=n+2*i,l=o+2*i,h=this.x+s.x*r,p=this.y+s.y*l;this._roundedRect(t,h,p,r,l,a),t.fillStyle=this.backgroundColor.toCss(!0),t.fill();const c=this.x+(s.x+.5)*r,d=this.y+(s.y+.5)*l;this._renderTextShadow(t,this.text,c,d),t.fillStyle=this.textColor.toCss(!0),t.fillText(this.text,c,d)}_renderTextShadow(t,e,i,a){t.lineJoin="miter",t.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/I.length})`;const n=this._textShadowSize;for(const[o,s]of I)t.fillText(e,i+n*o,a+n*s)}_roundedRect(t,e,i,a,n,o){t.beginPath(),t.moveTo(e,i+o),t.arcTo(e,i,e+o,i,o),t.lineTo(e+a-o,i),t.arcTo(e+a,i,e+a,i+o,o),t.lineTo(e+a,i+n-o),t.arcTo(e+a,i+n,e+a-o,i+n,o),t.lineTo(e+o,i+n),t.arcTo(e,i+n,e,i+n-o,o),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};for(const e in T)t[T[e]]=this.anchor===e;return t}};(0,a._)([(0,r.Cb)()],R.prototype,"x",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"y",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"position",null),(0,a._)([(0,r.Cb)()],R.prototype,"text",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"fontSize",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"anchor",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"visible",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"backgroundColor",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"textColor",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"_textShadowSize",void 0),(0,a._)([(0,r.Cb)()],R.prototype,"_textShadowColor",null),(0,a._)([(0,r.Cb)()],R.prototype,"_textShadow",null),(0,a._)([(0,r.Cb)()],R.prototype,"_padding",null),(0,a._)([(0,r.Cb)()],R.prototype,"_borderRadius",null),R=(0,a._)([(0,p.j)("esri.views.overlay.TextOverlayItem")],R);const D={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},I=[];{const t=16;for(let e=0;e<360;e+=360/t)I.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}const G=R;var P=i(59418);const L={default:15,far:25};let z=class extends v.Z{constructor(t){super(t),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const t=(0,f.vr)((async t=>{const e=await(0,x.ME)("esri/core/t9n/Units");(0,y.k_)(t),this._messagesUnits=e})),e=()=>(0,o.yw)(this.context,(t=>t.editGeometryOperations));this.addHandles([(0,s.YP)((()=>[(0,o.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((t=>(0,s.on)(e,t,(()=>this._update())))),(0,n.kB)((()=>t.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,o.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((t=>t.label.text))}}get _edgeDistancePixels(){return L[this.edgeDistance]}_update(){this._nextLabelIndex=0;const t=this.context;if((0,o.Wi)(t))return void this._destroyUnusedLabels();const{components:e,geometry:i,coordinateHelper:a}=t.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const n=e.length;for(let s=0;s<n;++s){const r=[];if(e[s].iterateVertices((t=>{r.push(a.toXYZ(t.pos))})),0===s&&(0,o.pC)(this.stagedVertex)&&r.push(a.toXYZ(this.stagedVertex)),r.length<2)continue;const l=r[0],h=r[r.length-1];"polygon"===i.type&&r.length>2&&!(0,c.F)(l,h)&&r.push(l);const p=1===n&&!(0,w.bu)(r,!1,!1);let d=N,u=Z;this.toScreenPointArray(t,l,d);for(let e=1;e<r.length;++e){const i=r[e-1],a=r[e];this.toScreenPointArray(t,a,u),this._addLabel(t,i,d,a,u,p),[d,u]=[u,d]}}this._destroyUnusedLabels()}_addLabel(t,e,i,a,n,s){const{label:r}=this._getOrCreateLabel(t);if(!this.visible||(0,b.k)(i,n)<3025)return void(r.visible=!1);const l=(0,o.pC)(t.graphicState)?t.graphicState.isDraped?"on-the-ground":"absolute-height":(0,u.VW)(t.editGeometryOperations.data.geometry,t.elevationInfo),{spatialReference:h}=t.editGeometryOperations.data,p=(0,P.MU)(e,a,h,l),c=this._messagesUnits,d=(0,C.R)(t.view);r.text=(0,o.pC)(c)&&(0,o.pC)(p)?(0,M.N9)(c,p,d):"",r.visible=!0;const g=n[0]-i[0],_=n[1]-i[1];s?(0,b.s)(V,-_,g):(0,b.s)(V,_,-g),(0,b.f)(V,V),(0,b.b)(V,V,this._edgeDistancePixels),(0,b.l)(W,i,n,.5),(0,b.j)(W,W,V),r.position=[W[0],W[1]],Math.abs(V[0])>Math.abs(V[1])?r.anchor=V[0]>0?"left":"right":r.anchor=-V[1]<0?"top":"bottom"}_getOrCreateLabel(t){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const e=new G({fontSize:10,anchor:"center"});t.view.overlay?.items.add(e);const i={label:e};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel(t){let{label:e}=t;(0,o.yw)(this.context,(t=>t.view.overlay?.items.remove(e))),e.destroy()}};(0,a._)([(0,r.Cb)()],z.prototype,"context",void 0),(0,a._)([(0,r.Cb)()],z.prototype,"stagedVertex",void 0),(0,a._)([(0,r.Cb)()],z.prototype,"visible",void 0),(0,a._)([(0,r.Cb)()],z.prototype,"edgeDistance",void 0),(0,a._)([(0,r.Cb)()],z.prototype,"updating",null),(0,a._)([(0,r.Cb)()],z.prototype,"_messagesUnits",void 0),(0,a._)([(0,r.Cb)()],z.prototype,"_edgeDistancePixels",null),z=(0,a._)([(0,p.j)("esri.views.interactive")],z);const V=(0,S.a)(),W=(0,S.a)(),N=(0,_.s1)(),Z=(0,_.s1)();var U=i(11208);let Y=class extends z{getCameraOrExtent(t){let{view:e}=t;return e.state.camera}toScreenPointArray(t,e){let{view:i,elevationInfo:a,editGeometryOperations:n}=t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,_.s1)();const{spatialReference:s}=n.data.coordinateHelper;return(0,U.RS)(e,s,a,i,H),i.state.camera.projectToScreen(H,o),o}};Y=(0,a._)([(0,p.j)("esri.views.3d.interactive.SegmentLabels3D")],Y);const H=(0,d.c)();var k=i(45134),B=i(86950),F=i(67077),X=i(97411),j=i(56529),Q=i(86700);const q={main:new O.Z([255,127,0]),selected:new O.Z([255,255,255]),staged:new O.Z([12,207,255]),outline:new O.Z([0,0,0,.5]),selectedOutline:new O.Z([255,255,255])},J=.3;function $(t,e){const i=t.clone();return i.a*=e,i}function K(t,e){const i=t.clone(),a=(0,B._Y)(i);a.s*=e;const n=(0,B.xr)(a);return i.r=n.r,i.g=n.g,i.b=n.b,i}function tt(t,e){if(e)for(const i in e)t[i]=e[i]}class et{constructor(t){this.color=q.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=j.yD.Opaque,tt(this,t)}}class it{constructor(t){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=q.main,this.outlineColor=q.outline,this.renderOccluded=j.yD.Opaque,this.hoverOutlineColor=q.selectedOutline,tt(this,t)}apply(t,e){const i=this[t];e.setParameters({color:dt(i),transparent:"color"!==t||i.a<1,renderOccluded:this.renderOccluded})}}class at{constructor(t){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=$(q.main,.5),this.hoverColor=q.main,this.renderOccluded=j.yD.Transparent,this.minSquaredEdgeLength=900,tt(this,t)}apply(t,e){const i=this[t];e.setParameters({color:dt(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class nt{constructor(t){this.vertex=new it({color:q.main,outlineColor:q.outline}),this.edge=new it({color:K($(q.main,2/3),.5),outlineColor:$(q.outline,.5),size:8,collisionPadding:8}),this.selected=new it({color:q.selected,outlineColor:q.outline}),this.edgeOffset=new at,tt(this,t)}}class ot{constructor(t){this.color=q.selected,this.width=1.5,this.stipplePattern=(0,Q.z5)(5),this.stippleOffColor=q.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=q.selected,this.renderOccluded=j.yD.OccludeAndTransparent,tt(this,t)}apply(t){t.color=dt(this.color),t.width=this.width,t.stipplePattern=this.stipplePattern,t.stippleOffColor=dt(this.stippleOffColor),t.falloff=this.falloff,t.innerWidth=this.innerWidth,t.innerColor=dt(this.innerColor),t.renderOccluded=this.renderOccluded}}class st{constructor(t){this.color=q.selected,this.size=4,this.outlineSize=1,this.outlineColor=q.outline,this.shape="square",tt(this,t)}apply(t){t.color=dt(this.color),t.size=this.size,t.outlineSize=this.outlineSize,t.outlineColor=dt(this.outlineColor),t.primitive=this.shape}}class rt{constructor(t){this.innerColor=q.selected,this.innerWidth=1,this.glowColor=q.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=J,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=q.main,tt(this,t)}apply(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i={glowColor:O.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:O.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*e,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in t?t.style=i:t.laserlineStyle=i}}class lt{constructor(t){this.outline=new ot({color:q.outline,renderOccluded:j.yD.OccludeAndTransparentStencil,stippleOffColor:q.selected,stipplePattern:(0,Q.z5)(5),width:1.5,innerWidth:0}),this.staged=new ot({color:q.selected,renderOccluded:j.yD.OccludeAndTransparentStencil,innerColor:q.staged,stippleOffColor:q.outline,stipplePattern:(0,Q.z5)(5),width:1.5}),this.shadowStyle=new rt({globalAlpha:J,glowColor:q.main,glowFalloff:8,glowWidth:8,innerColor:q.selected,innerWidth:1}),tt(this,t)}}class ht{constructor(t){this.outline=new st({color:q.selected,outlineColor:q.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new rt({globalAlpha:J,glowColor:q.main,glowFalloff:1.5,glowWidth:6,innerColor:q.selected,innerWidth:1,radius:2}),tt(this,t)}}class pt extends ot{constructor(t){super(),this.extensionType=X.n.GROUND_RAY,tt(this,t)}}class ct{constructor(t){this.lineGraphics=new lt,this.pointGraphics=new ht,this.heightPlane=new rt({globalAlpha:J,glowColor:q.main,glowFalloff:8,glowWidth:8,innerColor:q.selected,innerWidth:1}),this.heightBox=new rt({globalAlpha:J,glowColor:q.main,glowFalloff:8,glowWidth:8,innerColor:q.selected,innerWidth:0,heightFillColor:q.main}),this.zVerticalLine=new pt({color:$(q.main,.5),falloff:2,innerColor:$(q.selected,0),renderOccluded:j.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:X.n.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,tt(this,t)}}function dt(t){return(0,F.b)(O.Z.toUnitRGBA(t))}const ut=new class{constructor(t){this.visualElements=new ct,this.reshapeManipulators=new nt,this.zManipulator=new et,tt(this,t)}colorToVec4(t){return dt(t)}};var gt=i(91505),_t=i(90045),mt=i(151),vt=i(79803),ft=i(41414),yt=i(65618),Mt=i(62921),bt=i(62389),St=i(78935),wt=i(79685),xt=i(78081),Ct=i(88699),Ot=i(39077),Et=i(4760),At=i(58901);class Tt extends Mt.i{constructor(t){super(t),this._attachmentOrigin=(0,yt.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new gt.Z,this._geometry=null,this._width=1,this._color=(0,mt.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,mt.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=j.yD.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=t.view.spatialReference,this._laserline=new bt.W({view:t.view}),this.applyProps(t),this.attached=t.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(t){return{view:t,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,e)=>{t.geometries.length=0,this._recreateGeometry(e,t.material,t.geometries)}}}createDrapedResourceFactory(t){return{view:t,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>{t.geometries=this._createRenderGeometriesDraped(t.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&(0,o.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(t){this._laserline.attached=this._laserlineAttached,t&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get width(){return this._width}set width(t){t!==this._width&&(this._width=t,this._updateMaterial())}get color(){return this._color}set color(t){(0,_t.g)(t,this._color)||((0,_t.c)(this._color,t),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(t){t!==this._innerWidth&&(this._innerWidth=t,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(t){(0,_t.g)(t,this._innerColor)||((0,_t.c)(this._innerColor,t),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const e=(0,o.pC)(t)!==(0,o.pC)(this._stipplePattern);this._stipplePattern=t,e?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(t){t&&this._stippleOffColor&&(0,_t.g)(t,this._stippleOffColor)||(this._stippleOffColor=t?(0,mt.c)(t):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(t){t!==this._falloff&&(this._falloff=t,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(t){this._laserlineStyle=t,this._laserline.attached=this._laserlineAttached,(0,o.pC)(t)&&(this._laserline.style=t)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(t){this._laserlineEnabled!==t&&(this._laserlineEnabled=t,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const t=(0,o.WG)(this.object3dResources.resources)?.geometries;if(!t||0===t.length)return null;(0,c.s)(It,0,0,0);let e=0;for(const i of t)i.computeAttachmentOrigin(Dt)&&((0,c.a)(It,It,Dt),e++);return 0===e?null:((0,c.g)(It,It,1/e),this.view.renderCoordsHelper.fromRenderCoords(It,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,o.pC)(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters),(0,o.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return(0,o.pC)(this.geometry)&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===j.yD.OccludeAndTransparentStencil?j.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(t,e,i){this._createRenderGeometries(e,i);for(const a of i)t.addGeometry(a);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(t){t.geometries=[],t.material.dispose()}_createObject3DResources(t){const e=new At.U(this._materialParameters),i=new Array;return this._recreateGeometry(t,e,i),{material:e,geometries:i,forEach:t=>{t(e),i.forEach(t)}}}_createDrapedResources(){const t=new At.U(this._materialParameters);return{material:t,geometries:this._createRenderGeometriesDraped(t)}}_createRenderGeometriesDraped(t){const e=this.geometry;if((0,o.Wi)(e)||(0,o.Wi)(this.view.basemapTerrain.spatialReference))return[];const i=(0,xt.r)(e,this.view.basemapTerrain.spatialReference),a=[];for(const{position:n}of i.lines){const e={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this._isClosed},i=new Ot.z((0,wt.Y)(t,e)),o=(0,ft.cS)(Rt);(0,ft.G1)(o,n),(0,_t.s)(i.boundingSphere,.5*(o[0]+o[3]),.5*(o[1]+o[4]),0,.5*Math.sqrt((o[3]-o[0])*(o[3]-o[0])+(o[4]-o[1])*(o[4]-o[1]))),a.push(i)}return a}calculateMapBounds(t){if((0,o.Wi)(this.object3dResources.resources))return!1;const e=this.view.renderCoordsHelper;for(const i of this.object3dResources.resources.geometries){const a=i.vertexAttributes.get(Et.T.POSITION),n=(0,Ct.bg)(a.data.length);(0,vt.CM)(a.data,e.spatialReference,0,n,this.view.spatialReference,0,a.data.length/3),(0,ft.G1)(t,n)}return!0}_createRenderGeometries(t,e){const i=this.geometry;if((0,o.Wi)(i))return;const a=(0,xt.V)(i,this.view.elevationProvider,this.view.renderCoordsHelper,St.o.fromElevationInfo(this.elevationInfo??new g.Z({mode:(0,u.VW)(i,null)}))),n=new Array;for(const{position:o,mapPositions:s}of a.lines){const i={mapPositions:s,attributeData:{position:o},removeDuplicateStartEnd:this._isClosed};e.push((0,wt.Y)(t,i)),n.push(o)}this._laserline.pathVerticalPlane=n}}const Rt=(0,ft.Ue)(),Dt=(0,d.c)(),It=(0,d.c)();var Gt=i(14226),Pt=i(81949),Lt=i(86244),zt=i(66327),Vt=i(78485),Wt=i(97882);class Nt extends Lt.l{constructor(t){super(t.view),this._resources=null,this._transform=(0,Pt.c)()}get object(){return(0,o.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(t){(0,Gt.c)(this._transform,t),(0,o.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,o.Wi)(this._resources))return;const t=this._resources.object,e=this.view._stage;e.removeMany(t.geometries),t.removeAllGeometries(),this.createGeometries(t),t.visible=this.visible,e.addMany(t.geometries)}createResources(){this.destroyResources();const t=this.view._stage;if(!t)return;const e=new Wt.F({pickable:!1,updatePolicy:Vt.j.SYNC});t.add(e);const i=new zt.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),t.addMany(i.geometries),this.forEachExternalMaterial((e=>t.add(e))),t.add(i),e.add(i),i.visible=this.visible,this._resources={layer:e,object:i}}destroyResources(){const t=this.view._stage;!(0,o.Wi)(this._resources)&&t&&(t.remove(this._resources.object),t.remove(this._resources.layer),this.forEachExternalMaterial((e=>{t.remove(e),e.dispose()})),t.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(t){(0,o.Wi)(this._resources)||(this._resources.object.visible=t)}}var Zt=i(69691);var Ut=i(68401),Yt=i(70619),Ht=i(11606);class kt extends Nt{constructor(t){super(t),this.view=null,this._renderOccluded=j.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=ut.colorToVec4(ut.reshapeManipulators.vertex.color),this._size=ut.reshapeManipulators.vertex.size,this._outlineColor=ut.colorToVec4(ut.reshapeManipulators.vertex.outlineColor),this._outlineSize=ut.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){(0,_t.g)(t,this._color)||((0,_t.c)(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){(0,_t.g)(t,this._outlineColor)||((0,_t.c)(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if((0,o.Wi)(t)||0===t.length)return[];const e=function(t,e,i,a,n){const o=(0,Ct.bg)(3*t.length),s=(0,Ct.bg)(o.length);t.forEach(((t,e)=>{o[3*e+0]=t[0],o[3*e+1]=t[1],o[3*e+2]=t.length>2?t[2]:0}));const r=(0,Zt.rR)(o,e,0,s,0,o,0,o.length/3,i,a,n),l=null!=r;return{numVertices:t.length,position:o,mapPositions:s,projectionSuccess:l,sampledElevation:r}}(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,St.o.fromElevationInfo(this.elevationInfo)),i=[],a=e.numVertices,n=e.position;for(let o=0;o<a;++o){const t=(0,c.s)(Bt,n[3*o+0],n[3*o+1],n[3*o+2]),e=Ft(this._vertexMaterial,.5,t),a=Ft(this._vertexOutlineMaterial,.5,t);i.push({vertexGeometry:e,vertexOutlineGeometry:a})}return i}createGeometries(t){const e=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of e)t.addGeometry(i),t.addGeometry(a)}createExternalResources(){this._vertexMaterial=new Ht.Q({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Ut.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Ht.Q({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:Ut.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(t){t(this._vertexMaterial),t(this._vertexOutlineMaterial)}}const Bt=(0,d.c)();function Ft(t,e,i){return(0,Yt.PI)(t,e,16,16,{offset:i})}let Xt=class extends gt.Z.EventedAccessor{constructor(t){super(t),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,a._)([(0,r.Cb)({constructOnly:!0})],Xt.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)()],Xt.prototype,"tracking",void 0),(0,a._)([(0,r.Cb)()],Xt.prototype,"displaying",void 0),(0,a._)([(0,r.Cb)()],Xt.prototype,"isDraped",void 0),Xt=(0,a._)([(0,p.j)("esri.views.3d.layers.graphics.GraphicState")],Xt);var jt=i(15820),Qt=i(66038),qt=i(46640);let Jt=class extends jt.T{constructor(t){super(t),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:t,offset:e}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new g.Z({mode:t,offset:e})}normalizeCtorArgs(t){if(!t.elevationInfo){const e=t.hasZ??!0;return{...t,elevationInfo:(0,u.mF)(e)}}return t}initializeGraphic(t){const e=this._createGraphicState=new Xt({graphic:t});return(0,n.AL)([this.view.maskOccludee(t),this.view.trackGraphicState(e),(0,s.YP)((()=>({element:this._outlineVisualElement,isDraped:e.isDraped})),(t=>{let{element:e,isDraped:i}=t;(0,o.yw)(e,(t=>t.isDraped=i))}),s.nn)])}makeDrawOperation(){const{geometryType:t}=this,e="circle"!==t&&"rectangle"!==t;return new Qt.w({view:this.view,manipulators:this.manipulators,geometryType:(0,jt.I)(t),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new qt.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new qt.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new k._,segmentLabels:e?new Y:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,o.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,u.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(t){const{view:e}=this;return(0,o.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[t],this._updateVerticalLineVisualElement(t),null):(this._activeVertexVisualElement=new kt({view:e,spatialReference:e.spatialReference,vertices:[t],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:ut.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=ut.colorToVec4(ut.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new X.V({view:e,extensionType:ut.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:j.yD.OccludeAndTransparent}),ut.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),(0,n.kB)((()=>{this._activeVertexVisualElement=(0,o.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,o.SC)(this._verticalLineVisualElement)})))}_updateVerticalLineVisualElement(t){const e=this._verticalLineVisualElement;if((0,o.Wi)(e))return;const{renderCoordsHelper:i,elevationProvider:a}=this.view;(0,c.s)(Kt,t[0],t[1],t[2]),$t.setFromElevationInfo(this.elevationInfo),Kt[2]=(0,Zt.w7)(Kt,a,$t,i),i.toRenderCoords(Kt,this.view.spatialReference,Kt)?(e.setStartEndFromWorldDownAtLocation(Kt),e.attached=!0):e.attached=!1}onOutlineChanged(t){if((0,o.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=t,null;const e=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Tt({view:this.view,geometry:t,elevationInfo:e,isDraped:(0,o.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,u.Zz)(this.hasZ,e),attached:!1}),ut.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),ut.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,n.kB)((()=>{this._outlineVisualElement=(0,o.SC)(this._outlineVisualElement)}))}onRegularVerticesChanged(t){return(0,o.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=t,null):(this._verticesVisualElement=new kt({view:this.view,spatialReference:this.view.spatialReference,vertices:t,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:ut.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,n.kB)((()=>{this._verticesVisualElement=(0,o.SC)(this._verticesVisualElement)})))}};(0,a._)([(0,r.Cb)({constructOnly:!0})],Jt.prototype,"elevationInfo",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Jt.prototype,"geometryType",void 0),(0,a._)([(0,r.Cb)()],Jt.prototype,"type",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Jt.prototype,"view",void 0),Jt=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Jt);const $t=new St.o,Kt=(0,d.c)();var te=i(40281),ee=i(41691),ie=i(47898),ae=i(30036),ne=i(77498);function oe(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.RL)(t);return"on-the-ground"!==e.mode&&!((0,o.Wi)(t.geometry)||!t.geometry.hasZ)}var se,re,le=i(16889),he=i(35284);!function(t){t[t.NONE=0]="NONE",t[t.ANY=1]="ANY",t[t.Z=2]="Z",t[t.XY=4]="XY"}(se||(se={})),function(t){t[t.TRANSLATE_Z=0]="TRANSLATE_Z",t[t.TRANSLATE_XY=1]="TRANSLATE_XY",t[t.SCALE=2]="SCALE",t[t.ROTATE=3]="ROTATE",t[t.SCALE_ROTATE=4]="SCALE_ROTATE"}(re||(re={}));class pe{constructor(){this.grabbingState=se.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(t){this.grabbingState=se.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,t.forEachManipulator(((t,e)=>{if(e===re.TRANSLATE_Z&&(this.zManipulator=t),t instanceof he.Z&&(t.selected&&(0===this.numSelected&&(this.firstSelected=t),this.numSelected++),(0,o.Wi)(this.firstGrabbedXY)&&t.grabbing&&e===re.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=se.ANY,e){case re.TRANSLATE_Z:this.grabbingState|=se.Z;break;case re.TRANSLATE_XY:this.grabbingState|=se.XY}}))}}function ce(t){const{view:e,graphic:i}=t,a=new Xt({graphic:i}),o=function(t,e){const{view:i,graphic:a}=t,o=new Tt({view:i,geometry:ue(a)?a.geometry:null,elevationInfo:(0,u.RL)(a),attached:!1});ut.visualElements.lineGraphics.shadowStyle.apply(o);const r=()=>{o.attached=e.displaying};ut.visualElements.lineGraphics.outline.apply(o);const l=[(0,s.YP)((()=>e.displaying),r),(0,s.YP)((()=>e.isDraped),(t=>{o.isDraped=t})),e.on("changed",(()=>o.geometry=ue(a)?a.geometry:null)),(0,n.ed)(o)];return r(),{visualElement:o,remove:()=>(0,n.AL)(l).remove()}}(t,a),r=[o,de(t,o.visualElement,a),e.maskOccludee(i),e.trackGraphicState(a)];return{visualElement:o.visualElement,remove:()=>(0,n.AL)(r).remove()}}function de(t,e,i){const{graphic:a,view:r}=t,l=[],h=(0,u.RL)(a),p="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,d=new pe,g=new X.V({view:r,extensionType:ut.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:j.yD.OccludeAndTransparent});ut.visualElements.pointGraphics.shadowStyle.apply(g);const _=(0,le.Vl)(ut.visualElements.heightPlaneAngleCutoff),m=new bt.W({view:r,attached:!1,angleCutoff:_});ut.visualElements.heightPlane.apply(m);let v=1,f=1;const y=()=>{if(d.update(t),!i.displaying||p&&(i.isDraped||!ue(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,g.attached=!1,void(m.attached=!1);e.laserlineEnabled=!0;const n=d.grabbingState&se.XY?ut.visualElements.laserlineAlphaMultiplier:1;n!==v&&(v=n,ut.visualElements.lineGraphics.shadowStyle.apply(e,n),ut.visualElements.pointGraphics.shadowStyle.apply(g,n));const s=d.grabbingState&se.Z?ut.visualElements.laserlineAlphaMultiplier:1;s!==f&&(f=s,ut.visualElements.heightPlane.apply(m,s)),function(t,e){const i=1===e.numSelected?e.firstSelected:e.numSelected>1&&(0,o.pC)(e.firstGrabbedXY)?e.firstGrabbedXY:null;(0,o.pC)(i)?(t.setStartEndFromWorldDownAtLocation(i.renderLocation),t.attached=!0):t.attached=!1}(g,d),function(t,e,i,a){if(a.numSelected>0){(0,c.s)(ge,0,0,0);let e=0;t.forEachManipulator(((t,i)=>{i===re.TRANSLATE_XY&&t.selected&&t instanceof he.Z&&((0,c.a)(ge,ge,t.renderLocation),e++)})),e>0?(i.heightManifoldTarget=(0,c.g)(ge,ge,1/e),i.attached=!0):i.attached=!1}else{const a=e.attachmentOrigin;(0,o.pC)(a)&&t.view.renderCoordsHelper.toRenderCoords(a,ge)?(i.heightManifoldTarget=ge,i.attached=!0):i.attached=!1}}(t,e,m,d)};ut.visualElements.zVerticalLine.apply(g),l.push(i.on("changed",y),(0,s.YP)((()=>i.displaying),y),e.events.on("attachment-origin-changed",y),(0,n.ed)(g),(0,n.ed)(m));const M=[],b=()=>{(0,n.AL)(M).remove(),M.length=0,t.forEachManipulator((t=>M.push(t.events.on("grab-changed",y)))),t.forEachManipulator((t=>M.push(t.events.on("select-changed",y)))),y()};return b(),l.push(t.onManipulatorsChanged(b),(0,n.iU)((()=>(0,n.AL)(M)))),(0,n.AL)(l)}function ue(t){return(0,o.pC)(t.geometry)&&("polygon"===t.geometry.type||"polyline"===t.geometry.type)}const ge=(0,d.c)();var _e=i(65156),me=i(66730);function ve(t){const{view:e,graphic:i}=t,a=new Xt({graphic:i}),r=[],l=function(t,e,i){const{view:a,graphic:r}=t,l=new me.L({view:a,geometry:fe(r),elevationInfo:(0,u.RL)(r),attached:!1});return function(t,e,i,a){const r=()=>e.attached=i.displaying;(function(t,e,i,a){const{view:s,graphic:r}=t;let l=null;const h=t=>{(0,o.pC)(l)&&(l.remove(),l=null),i.isDraped&&(0,o.pC)(t)&&(l=function(t,e,i){const a=t.elevationProvider.spatialReference;(0,vt.KC)(e,ye,a);const n=ye[0],o=ye[1];return t.elevationProvider.on("elevation-change",(t=>{(0,_e.jE)(t.extent,n,o)&&i()}))}(s,t,(()=>{e.geometry=t})))},p=()=>{const t=fe(r);h(t),e.geometry=t};a.push(i.on("changed",p),(0,n.iU)((()=>l))),p()})(t,e,i,a),ut.visualElements.pointGraphics.outline.apply(e),a.push((0,s.YP)((()=>i.displaying),r,s.nn))}(t,l,e,i),i.push((0,n.ed)(l)),l}(t,a,r);return function(t,e,i,a){const{view:r,graphic:l}=t,h=new X.V({view:r,extensionType:ut.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:j.yD.OccludeAndTransparent});ut.visualElements.zVerticalLine.apply(h);const p=new bt.W({view:r,intersectsLineInfinite:!0,attached:!1});ut.visualElements.pointGraphics.shadowStyle.apply(p);const d=(0,le.Vl)(ut.visualElements.heightPlaneAngleCutoff),g=new bt.W({view:r,attached:!1,angleCutoff:d});ut.visualElements.heightPlane.apply(g);const _=(0,u.RL)(t.graphic),m=St.o.fromElevationInfo(_),v="on-the-ground"===_.mode||!_.offset&&"absolute-height"!==_.mode,f=new pe;let y=1,M=1;const b=()=>{f.update(t);const i=fe(l),n=v&&(e.isDraped||(0,o.Wi)(i)||!i.hasZ);let s=!0;if(!n&&(0,o.pC)(i)){const t=(0,Zt.w7)(i,r.elevationProvider,m,r.renderCoordsHelper);(0,c.s)(ye,i.x,i.y,t),(0,vt.SH)(ye,i.spatialReference,ye,r.renderCoordsHelper.spatialReference),h.setStartEndFromWorldDownAtLocation(ye),p.intersectsWorldUpAtLocation=ye}else s=!1;const d=f.grabbingState&se.Z?ut.visualElements.laserlineAlphaMultiplier:1;d!==y&&(y=d,ut.visualElements.heightPlane.apply(g,d));const u=(0,ft.cS)(Me);!n&&e.displaying&&a.calculateMapBounds(u)&&(0,vt.SH)((0,ft.KE)(u,ye),r.spatialReference,ye,r.renderCoordsHelper.spatialReference)?(g.heightManifoldTarget=ye,g.attached=!0):g.attached=!1;const _=f.grabbingState&se.XY?ut.visualElements.laserlineAlphaMultiplier:1;_!==M&&(M=_,ut.visualElements.pointGraphics.shadowStyle.apply(p,_));const b=s&&e.displaying&&!n;p.attached=b,h.attached=b};i.push((0,s.YP)((()=>[e.displaying,e.isDraped]),b),e.on("changed",b)),t.forEachManipulator((t=>{i.push(t.events.on("grab-changed",b))})),i.push((0,n.ed)(p)),i.push((0,n.ed)(h)),i.push((0,n.ed)(g)),b()}(t,a,r,l),r.push(e.trackGraphicState(a)),{visualElement:l,remove(){(0,n.AL)(r).remove()}}}function fe(t){const e=t.geometry;return(0,o.Wi)(e)?null:"point"===e.type?e:"mesh"===e.type?e.anchor.clone():null}const ye=(0,d.c)(),Me=(0,ft.Ue)();function be(t){switch((0,o.Wg)(t.graphic.geometry).type){case"point":case"mesh":return ve(t);case"polygon":case"polyline":return ce(t);default:return null}}const Se=[1,.5,0],we=70,xe=Math.ceil(we/3*2),Ce=160,Oe=5*Math.PI/12,Ee=1*Math.PI/3;var Ae=i(100);class Te{constructor(){this._available=!0}set location(t){this._forEachManipulator3D((e=>e.location=t))}set elevationAlignedLocation(t){this._forEachManipulator3D((e=>e.elevationAlignedLocation=t))}set elevationInfo(t){this._forEachManipulator3D((e=>e.elevationInfo=t))}get renderLocation(){let t;return this._forEachManipulator3D((e=>{t||(t=e.renderLocation)})),t}get available(){return this._available}set available(t){this._available=t,this._forEachManipulator3D((e=>e.available=t))}get hovering(){return this.someManipulator((t=>t.hovering))}get grabbing(){return this.someManipulator((t=>t.grabbing))}get dragging(){return this.someManipulator((t=>t.dragging))}hasManipulator(t){return this.someManipulator((e=>e===t))}someManipulator(t){let e=!1;return this.forEachManipulator((i=>{!e&&t(i)&&(e=!0)})),e}_forEachManipulator3D(t){this.forEachManipulator(((e,i)=>{e instanceof he.Z&&t(e,i)}))}}var Re=i(11185),De=i(40508),Ie=i(51328),Ge=i(74229);function Pe(t,e,i,a){const n=t.graphic,o=(t,i)=>e({action:t,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((t,e,i)=>(e.next((t=>("start"===t.action&&o("start",t),t))).next((0,Ge.a9)(n,a)).next((t=>{switch(t.action){case"start":case"update":(t.translationX||t.translationY||t.translationZ)&&o("update",t);break;case"end":o("end",t)}return t})),{steps:e,cancel:i=i.next((0,Ge.bD)(n)).next((t=>(o("end",{screenDeltaX:0,screenDeltaY:0}),t)))})))}function Le(t){if((0,o.Wi)(t)||"polyline"!==t.type&&"polygon"!==t.type)return 0;const e=("polyline"===t.type?t.paths:t.rings)[0];if(!e||e.length<2)return 0;const i=e[0],a=e[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}function ze(t){if((0,o.Wi)(t)||(0,o.Wi)(t.axis))return 1;const{mapStart:e,mapEnd:i,axis:a}=t,n=[i.x-e.x,i.y-e.y];return n[0]*a[0]+n[1]*a[1]>0?1:-1}var Ve=i(66832),We=i(99034);class Ne extends Te{constructor(t){super(),this._handles=new Ae.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=we,this._updateAfterDrag=!1,this.events=new gt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulators(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}set orthogonalAvailable(t){this._arrowManipulatorInfos[1].manipulator.available=t,this._arrowManipulatorInfos[3].manipulator.available=t}destroy(){this._handles=(0,o.SC)(this._handles),this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(t){for(const{manipulator:e}of this._arrowManipulatorInfos)t(e,re.TRANSLATE_XY)}createGraphicDragPipeline(t,e,i){const a=e.graphic,n=(0,u.RL)(a),s=(0,o.Wg)(a.geometry).spatialReference;return Pe(e,i,(e=>this.createDragPipeline(((i,a,n,o,s)=>(({steps:a,cancel:n}=t(i,a,n,o,s)),e(i,a,n))),n,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){return(0,n.AL)(this._arrowManipulatorInfos.map(((n,o)=>{let{manipulator:s}=n;return(0,Ge.Xd)(s,((n,s,r,l,h)=>{const p=s.next((t=>({...t,manipulatorType:re.TRANSLATE_XY}))).next((0,Ge.kY)(this._view,n.elevationAlignedLocation)).next((0,Ie.G)(this._view,n.elevationAlignedLocation,e,i,a)).next((0,Ge.M2)(n.location,this.angle+(o+1)*Math.PI*.5)).next((0,Ge.zh)());t(n,p,r,l,h)}))})))}get angle(){return this._angle}set angle(t){this._angle=t,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(t){this._radius!==t&&(this._radius=t,this._updateManipulators())}_updateManipulators(){for(let t=0;t<this._arrowManipulatorInfos.length;t++)this._updateArrowManipulator(this._arrowManipulatorInfos[t],t);this._updateManipulatorTransform()}_updateArrowManipulator(t,e){let{manipulator:i,transform:a}=t;const n=this._radius/we,o=54*n,s=o*Math.sqrt(3)/2,r=(0,Yt.DA)(this._opaqueMaterial,s,o/2,o/2,.02);(0,Yt.mx)(r,(0,Gt.f)(Re.MP.get(),(0,c.s)(Re.WM.get(),0,-s/3,0))),i.renderObjects=[new De.r(r,We.Q9.Focused),new De.r(r.instantiate({material:this._transparentMaterial}),We.Q9.Unfocused)],i.radius=s/3*2*1.2;const l=(0,Gt.b)(Re.MP.get(),e*Math.PI/2),h=(0,Gt.f)(Re.MP.get(),(0,c.s)(Re.WM.get(),0,100*n,0));(0,Gt.m)(a,l,h)}_createManipulators(){for(let t=0;t<4;t++){const e=this._createArrowManipulator(t);this._arrowManipulatorInfos.push(e)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const t=this.angle,e=(0,Gt.d)(Re.MP.get(),t,(0,d.f)(0,0,1));if((0,o.Wi)(e))return;const i=(0,Gt.E)(Re.MP.get(),(0,c.s)(Re.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,Gt.m)(Re.MP.get(),i,e);for(const n of this._arrowManipulatorInfos){const t=(0,Gt.m)(Re.MP.get(),a,n.transform);n.manipulator.modelTransform=t}}_createArrowManipulator(t){const e=new he.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.f)(0,0,1)}}),i={manipulator:e,transform:(0,Pt.c)()};return this._updateArrowManipulator(i,t),this._handles.add(e.events.on("drag",(t=>{this._updateAfterDrag&&"end"===t.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=O.Z.toUnitRGBA(q.main);return e[3]*=t,new Ve.E({color:e,transparent:1!==t,cullFace:Ut.Vr.Back,renderOccluded:j.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((t=>{let{manipulator:e}=t;return e}))}}}class Ze{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,o.pC)(this._lastDragEvent)&&(0,o.pC)(this._next)){const e=this._lastDragEvent.mapEnd,i=this._snap(this._lastDragEvent.screenEnd);if((0,o.pC)(i)){const a={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===t?i:e,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(a)}}this._enabled=t}_snap(t){const e=(0,o.pC)(this._view)?this._view.toMap(t,{exclude:[]}):null;return(0,o.pC)(e)&&(0,o.pC)(this._view)&&(e.z=(0,u.Ou)(e,this._view,this._elevationInfo)),e}createDragEventPipelineStep(t,e){this._view=t,this._elevationInfo=e,this._lastDragEvent=null;const i=new Ge.hM;return this._next=i,[t=>{if(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled){const e=this._snap(t.screenEnd);return(0,o.pC)(e)?{action:t.action,mapStart:t.mapStart,mapEnd:e,screenStart:t.screenStart,screenEnd:t.screenEnd}:null}return{action:t.action,mapStart:t.mapStart,mapEnd:t.mapEnd,screenStart:t.screenStart,screenEnd:t.screenEnd}},i]}}class Ue extends Te{constructor(t){super(),this._snapToScene=new Ze,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=we,this._view=t.view,this._tool=t.tool,null!=t.snapToScene&&(this.snapToScene=t.snapToScene),null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(t){t(this._manipulator,re.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(t){this._scale=t,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(t){this._snapToScene.enabled=t}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}createGraphicDragPipeline(t,e,i){const a=e.graphic,n=(0,u.RL)(a),s=(0,o.Wg)(a.geometry).spatialReference;return Pe(e,i,(e=>this.createDragPipeline(((i,a,n,o,s)=>(({steps:a,cancel:n}=t(i,a,n,o,s)),e(i,a,n))),n,s,a)),this._view.state.viewingMode)}createDragPipeline(t,e,i,a){const n=this._view;return(0,Ge.Xd)(this._manipulator,((o,s,r,l,h)=>{const p=s.next((0,Ge.kY)(n,o.elevationAlignedLocation)).next((0,Ie.G)(n,o.elevationAlignedLocation,e,i,a)).next(...this._snapToScene.createDragEventPipelineStep(n,e)).next((t=>({...t,manipulatorType:re.TRANSLATE_XY}))).next((0,Ge.zh)());t(o,p,r,l,h)}))}_updateManipulatorTransform(){const t=(0,Gt.E)(Re.MP.get(),(0,c.s)(Re.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=t}_createManipulator(){const t=this._view;this._manipulator=new he.Z({view:t,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,d.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const t=(0,Yt.nb)(this._discMaterial,.02,1,128,(0,d.f)(0,0,1),(0,d.f)(0,0,0));t.transformation=(0,Gt.E)((0,Pt.c)(),(0,d.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new De.r(t,We.Q9.Focused),new De.r(t.instantiate({material:this._discMaterialTransparent}),We.Q9.Unfocused)],this._manipulator.radius=this._radius/we*80}_createMaterial(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=O.Z.toUnitRGBA(q.main);return e[3]*=t,new Ve.E({color:e,transparent:1!==t,cullFace:Ut.Vr.Back,renderOccluded:j.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}class Ye extends Te{constructor(t){super(),this._radius=we,this.events=new gt.Z,this._tool=t.tool,this._view=t.view,null!=t.radius&&(this._radius=t.radius),this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()}))}forEachManipulator(t){t(this._manipulator,re.TRANSLATE_Z)}createGraphicDragPipeline(t,e,i){const a=(0,o.Wg)(e.graphic.geometry).spatialReference;return Pe(e,i,(e=>this.createDragPipeline(((i,a,n,o,s)=>(({steps:a,cancel:n}=t(i,a,n,o,s)),e(i,a,n))),a)),this._view.state.viewingMode)}createDragPipeline(t,e){const i=this._view;return(0,Ge.Xd)(this._manipulator,((a,n,o,s,r)=>{const l=n.next((t=>({...t,manipulatorType:re.TRANSLATE_Z}))).next((0,Ie.Sp)(i,a.renderLocation,e)).next((0,Ge.zh)());t(a,l,o,s,r)}))}get radius(){return this._radius}set radius(t){t!==this._radius&&(this._radius=t,this._updateManipulator())}_updateManipulator(){const t=this._radius/we,e=ut.zManipulator.height*t,i=ut.zManipulator.coneHeight*t,a=ut.zManipulator.coneWidth*t,n=ut.zManipulator.width*t,o=[(0,d.f)(0,0,0),(0,d.f)(0,0,e)],s=[(0,d.f)(0,0,0),(0,d.f)(0,0,e+i)],r=(t=>{const i=(0,Pt.c)();if((0,Gt.w)(i,i,[0,0,e]),(0,Gt.r)(i,i,Math.PI/2),t){const e=1+2*t/a;(0,Gt.k)(i,i,[e,e,e])}return i})(0),l=(t,e)=>{const i=(0,B._j)(ut.zManipulator.color,e);return[i.r/255,i.g/255,i.b/255,ut.zManipulator.color.a*t]},h=(0,ae.EA)(l(1,.25),j.yD.Occlude),p=(0,ae.EA)(l(1,0),j.yD.Occlude),c=(0,ae.EA)(l(.7,0),ut.zManipulator.renderOccluded),u=(0,ae.EA)(l(.85,0),ut.zManipulator.renderOccluded),g=(0,Yt.PD)(h,o,n/2,16,!1),_=(0,Yt.QL)(h,i,a/2,16,!1);_.transformation=r,this._manipulator.renderObjects=[new De.r(_,We.Q9.Unfocused),new De.r(g,We.Q9.Unfocused),new De.r(_.instantiate({material:p}),We.Q9.Focused),new De.r(g.instantiate({material:p}),We.Q9.Focused),new De.r(_.instantiate({material:c}),We.Q9.Unfocused),new De.r(g.instantiate({material:c}),We.Q9.Unfocused),new De.r(_.instantiate({material:u}),We.Q9.Focused),new De.r(g.instantiate({material:u}),We.Q9.Focused)],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[s]}}_createManipulator(){const t=new he.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{const e=this._view.state.camera,i=He;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=(0,c.j)(e.eye,i),n=e.computeRenderPixelSizeAtDist(a),o=(0,c.b)(ke,i,e.eye);(0,c.n)(o,o);const s=Be;this._view.renderCoordsHelper.worldUpAtPosition(He,s);const r=Math.abs((0,c.e)(o,s)),l=(0,c.f)(ke,o,s),h=(0,c.f)(ke,l,s),p=(0,le.uZ)(r,.01,1),d=1-Math.sqrt(1-p*p)/p/e.fullWidth,u=this._radius/we,g=ut.zManipulator.width*u;(0,c.g)(h,(0,c.n)(h,h),(1/d-1)*a+n*g),t[12]-=ke[0],t[13]-=ke[1],t[14]-=ke[2]},this._manipulator=t,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const He=(0,d.c)(),ke=(0,d.c)(),Be=(0,d.c)();class Fe extends Te{constructor(t){super(),this._handles=new Ae.Z,this._interactive=!0;const{tool:e,view:i,snapToScene:a,radius:n}=t;this._view=i,this.xyManipulation=new Ue({tool:e,view:i,snapToScene:a,radius:n}),this.xyAxisManipulation=new Ne({tool:e,view:i,radius:n}),this.zManipulation=new Ye({tool:e,view:i,radius:n}),this.xyManipulation.available=t.xyAvailable,this.xyAxisManipulation.available=t.xyAxisAvailable,this.zManipulation.available=t.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((t=>this._handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(t,e,i){return(0,n.AL)([this.xyManipulation.createGraphicDragPipeline(((e,i,a,n,o)=>t(je.XY,e,i,a,n,o)),e,i),this.xyAxisManipulation.createGraphicDragPipeline(((e,i,a,n,o)=>t(je.XY_AXIS,e,i,a,n,o)),e,i),this.zManipulation.createGraphicDragPipeline(((e,i,a,n,o)=>t(je.Z,e,i,a,n,o)),e,i)])}createDragPipeline(t,e,i,a){return(0,n.AL)([this.xyManipulation.createDragPipeline(((e,i,a,n,o)=>t(je.XY,e,i,a,n,o)),e,i,a),this.xyAxisManipulation.createDragPipeline(((e,i,a,n,o)=>t(je.XY_AXIS,e,i,a,n,o)),e,i,a),this.zManipulation.createDragPipeline(((e,i,a,n,o)=>t(je.Z,e,i,a,n,o)),i)])}set snapToScene(t){this.xyManipulation.snapToScene=t}set angle(t){this.xyAxisManipulation.angle=t}set interactive(t){this._interactive!==t&&(this._interactive=t,this._updateManipulatorInteractivity())}set radius(t){this.xyAxisManipulation.radius=t,this.xyManipulation.radius=t,this.zManipulation.radius=t}set displayScale(t){this.xyManipulation.displayScale=t,this.xyAxisManipulation.displayScale=t}forEachManipulator(t){this.xyManipulation.forEachManipulator((e=>t(e,re.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((e=>t(e,re.TRANSLATE_XY))),this.zManipulation.forEachManipulator((e=>t(e,re.TRANSLATE_Z)))}get _xyAxisVisible(){const t=this.xyManipulation.someManipulator((t=>t.focused))||this.xyAxisManipulation.someManipulator((t=>t.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||t}_autoHideXYAxis(){const t=this.xyAxisManipulation,e=this.xyManipulation;if((0,m.Z)("esri-mobile"))return;const i=[];e.forEachManipulator((t=>i.push(t))),t.forEachManipulator((t=>i.push(t)));const a=()=>{const e=[];this._xyAxisVisible||t.forEachManipulator((t=>e.push(t.disableDisplay()))),this._handles.remove(Xe),this._handles.add(e,Xe)};for(const n of i)this._handles.add(n.events.on("focus-changed",a));this._view.inputManager&&this._handles.add((0,s.gx)((()=>this._view.inputManager?.latestPointerType),a)),a()}_updateManipulatorInteractivity(){const t=this.grabbing;this.forEachManipulator((e=>{e.interactive=!t&&this._interactive||e.grabbing}))}static radiusForSymbol(t){const e=(0,o.pC)(t)&&"point-3d"===t.type&&t.symbolLayers;return e&&e.length>0&&e.some((t=>"icon"===t.type))?xe:we}}const Xe="disable-xy-axis-display";var je;!function(t){t[t.XY=0]="XY",t[t.XY_AXIS=1]="XY_AXIS",t[t.Z=2]="Z"}(je||(je={}));var Qe=i(2346);class qe extends Te{constructor(t){super(),this._view=t.view,this._tool=t.tool,this._graphicState=t.graphicState,this._createManipulator(),this.forEachManipulator((t=>this._tool.manipulators.add(t)))}destroy(){this.forEachManipulator((t=>{this._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(t){t(this._manipulator,re.TRANSLATE_XY)}createGraphicDragPipeline(t){return Pe(this._graphicState,t,(t=>this.createDragPipeline(t)),this._view.state.viewingMode)}createDragPipeline(t){const e=this._view,i=this._graphicState.graphic,a=(0,o.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,Ge.Xd)(this._manipulator,((n,o,s,r,l)=>{const h=o.next((0,Ie._y)(l,e,i,a)).next((0,Ge.AN)()).next((0,Ge.zh)());t(n,h,s,r,l)}))}_createManipulator(){const t=this._view,e=this._graphicState.graphic;this._manipulator=new Qe.L({graphic:e,view:t,selectable:!0,cursor:"move"})}}var Je=i(57889),$e=i(45900),Ke=i(87268),ti=i(77560),ei=i(34019),ii=i(80151),ai=i(12494),ni=i(40524),oi=i(4914);class si{constructor(t){this.allGraphics=t,this.type="graphic-move-start"}}class ri{constructor(t,e,i){this.dx=t,this.dy=e,this.allGraphics=i,this.type="graphic-move"}}class li{constructor(t){this.allGraphics=t,this.type="graphic-move-stop"}}let hi=class extends((0,ee.p)(gt.Z.EventedMixin($e.m))){constructor(t){super(t),this.graphics=new te.Z,this.enableZ=!0,this.tooltipOptions=new ti.Z,this.type="move-3d",this._tooltip=null}initialize(){const{graphics:t,view:e}=this;this.addHandles([t.on("change",(()=>this._refreshManipulators())),(0,s.YP)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new ai.u({view:e}):(0,o.SC)(this._tooltip)}),s.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,o.SC)(this._tooltip),this._moveManipulation=(0,o.SC)(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation?.destroy(),this.manipulators.removeAll();const t=this.graphics.toArray().filter((t=>(0,Je.P)(t)===ne.e.SUPPORTED)).map((t=>new pi(t)));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map((t=>this.view.trackGraphicState(t.state)))),this._updateMoveManipulation(t))}_createManipulators(t){for(const e of t){const i=e.state;e.manipulationXY=new qe({tool:this,view:this.view,graphicState:i}),e.manipulationXY.forEachManipulator((t=>this.handles.add([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:i.graphic}),t.stopPropagation()})),t.events.on("grab-changed",(t=>{let{action:e}=t;const{tooltipOptions:i,_tooltip:a}=this;(0,o.Wi)(a)||("start"===e?a.info=new ni.$E({tooltipOptions:i}):a.clear())}))]))),this.handles.add(e.manipulationXY.createDragPipeline(((e,i,a,n)=>this._buildDragEventPipeline(t,je.XY,e,i,a,n))))}this._createMoveManipulation(t)}_createMoveManipulation(t){const e=new Fe({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===t.length?Fe.radiusForSymbol(t[0].graphic.symbol):we});this._moveManipulation=e,e.elevationInfo={mode:"absolute-height",offset:0},e.forEachManipulator((t=>{this.handles.add(t.events.on("immediate-click",(i=>{e.zManipulation.hasManipulator(t)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=e=>i=>{this.handles.add(i.events.on("focus-changed",(i=>{let{action:a}=i;const n=this._tooltip;(0,o.Wi)(n)||("focus"===a?this._updateMoveTooltip(t,e):n.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(je.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(je.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(je.Z));const a=()=>this._updateMoveManipulation(t);for(const o of t)this.handles.add([o.state.on("changed",a),(0,s.YP)((()=>o.state.displaying),a)]);const n=t[t.length-1];this.handles.add(n.state.on("changed",(()=>this._updateMoveManipulationAngle(n)))),this.handles.add(e.createDragPipeline(((e,i,a,n,o)=>this._buildDragEventPipeline(t,e,i,a,n,o)),(0,u.RL)(n.graphic),(0,o.Wg)(n.graphic.geometry).spatialReference,n.graphic)),this._updateMoveManipulationAngle(n)}_createVisualElements(t){for(const e of t){const i=e.graphic,a=be({view:this.view,graphic:i,forEachManipulator:t=>{e.manipulationXY?.forEachManipulator(t),this._moveManipulation.forEachManipulator(t)},onManipulatorsChanged:()=>(0,n.kB)()});(0,o.Wi)(a)||(e.geometryRepresentation=a.visualElement,e.geometryRepresentation instanceof Tt&&this.handles.add([e.geometryRepresentation.events.on("attachment-origin-changed",(()=>{e.state.isDraped||this._updateMoveManipulation(t)})),(0,s.YP)((()=>e.state.isDraped),(()=>this._updateMoveManipulation(t)))]),this.handles.add(a))}}_updateMoveManipulationAngle(t){this._moveManipulation.angle=Le(t.graphic.geometry)}_updateMoveManipulation(t){const e=(0,yt.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const n=this._moveManipulation;for(const s of t){if(!s.state.displaying)continue;const t=s.state.graphic;this.enableZ&&oe(t)&&(a=!0);const n=s.geometryRepresentation instanceof Tt&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:(0,ae.du)(this.view,t);if((0,o.pC)(n)){const{x:t,y:a,z:o}=n;e.x+=t,e.y+=a,o&&(e.z??(e.z=0),e.z+=o),i++}}i>0?(e.x/=i,e.y/=i,e.z??(e.z=0),e.z/=i,n.location=e,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=a):n.available=!1}_buildDragEventPipeline(t,e,i,a,n,o){const s=[],r=[];let l=null,h=null;const p=()=>{for(const t of s)t.dragging=!1;s.length=0,r.length=0,l=null,h=null,this._moveManipulation.interactive=!0};if(1===t.length&&e===je.XY){const e=t[0].graphic;({steps:a,cancel:n}=this._buildSnappingPipelineSteps(e,(0,u.RL)(e),a,n,o))}return n=n.next((t=>h?.(t))).next((()=>(this.emit("graphic-move-stop",new li(r)),this.destroyed||p(),null))),{steps:a=a.next((e=>{if("start"===e.action){s.length=0,r.length=0;for(const e of t)e.dragging||!e.manipulationXY?.hasManipulator(i)&&e.manipulationXY?.grabbing||(s.push(e),r.push(e.graphic),e.dragging=!0);if(0!==r.length&&(this._moveManipulation.interactive=!1,l=(0,Ge.oq)(r,this.view.state.viewingMode),h=(0,Ge.QY)(r),this.emit("graphic-move-start",new si(r)),this.destroyed))return null}return 0!==r.length?e:null})).next((t=>l?.(t))).next((i=>(this._updateMoveTooltip(t,e,i),i))).next((t=>{switch(t.action){case"start":case"update":if(t.translationX||t.translationY||t.translationZ){const e=this.view.toScreen(t.mapStart),i=this.view.toScreen(t.mapEnd),a=i.x-e.x,n=i.y-e.y;if(this.emit("graphic-move",new ri(a,n,r)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new li(r)),this.destroyed)return null;p()}return null})),cancel:n}}_updateMoveTooltip(t,e,i){const{tooltipOptions:a,_tooltip:n}=this;if((0,o.Wi)(n))return;n.clear();const s=0===t.length?"absolute-height":t[0].state.isDraped?"on-the-ground":"absolute-height";switch(e){case je.XY:n.info=new ni.$E({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,((t,e)=>(0,P.GQ)(t,e,s)));break;case je.XY_AXIS:n.info=new ni.in({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,((t,e)=>{const a=(0,P.GQ)(t,e,s);return(0,ie.bA)(a,ze(i))}));break;case je.Z:n.info=new ni.QW({tooltipOptions:a}),this._updateMoveTooltipDistance(n.info,i,oi._e)}}_updateMoveTooltipDistance(t,e,i){if((0,o.pC)(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,s=i(a,n);t.distance=(0,o.pC)(s)?s:ie.yP}}_buildSnappingPipelineSteps(t,e,i,a,n){const s=t.geometry;if((0,o.Wi)(s)||"point"!==s.type&&"mesh"!==s.type)return{steps:i,cancel:a};const r=("point"===s.type?s:s.anchor).clone(),l=new ei.N({elevationInfo:e,pointer:n,editGeometryOperations:Ke.c.fromGeometry(r,this.view.state.viewingMode),visualizer:new k._,excludeFeature:t}),h=this.snappingManager,{snappingStep:p,cancelSnapping:c}=(0,ii.W)({snappingContext:l,snappingManager:h,updatingHandles:this.updatingHandles});return a=a.next(c),{steps:i=i.next((e=>(r.z=(0,u.vQ)(this.view,r,(0,u.RL)(t),{mode:"absolute-height",offset:0}),{...e,snapOrigin:l.coordinateHelper.pointToVector(r)}))).next(...p),cancel:a}}get test(){return{tooltip:this._tooltip}}};(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],hi.prototype,"view",void 0),(0,a._)([(0,r.Cb)()],hi.prototype,"graphics",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],hi.prototype,"enableZ",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:ti.Z})],hi.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],hi.prototype,"snappingManager",void 0),(0,a._)([(0,r.Cb)()],hi.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],hi.prototype,"updating",null),hi=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],hi);class pi{constructor(t){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Xt({graphic:t})}get graphic(){return this.state.graphic}}var ci=i(46684),di=(i(59486),i(68860)),ui=i(29909),gi=i(55652),_i=i(74579),mi=i(3711);function vi(t,e,i){const a="on-the-ground"===i.mode?mi.v.XY:mi.v.XYZ;return new mi.A(t,a,e,0)}function fi(t,e,i){const a=(0,d.c)();if(!t.renderCoordsHelper.toRenderCoords(e,a))return null;const n=yi(t,e,(0,gi.mJ)(i.plane)),s=yi(t,e,i.edgeDirection);if((0,o.Wi)(n)||(0,o.Wi)(s))return null;const r=(0,c.f)((0,d.c)(),n,s);return(0,gi.Yq)(a,r,(0,gi.Ue)())}function yi(t,e,i){const a=(0,yt.Tx)(e.x+i[0],e.y+i[1],e.z+i[2],e.spatialReference),n=(0,d.c)(),o=(0,d.c)();return t.renderCoordsHelper.toRenderCoords(e,n)&&t.renderCoordsHelper.toRenderCoords(a,o)?(0,c.r)(o,n,o):null}var Mi=i(63920),bi=i(153),Si=i(4943);let wi=class extends Si.h{constructor(t){super(t),this.type="reshape-edge-offset",this.distance=ie.yP,this.area=null,this.totalLength=null}};(0,a._)([(0,r.Cb)()],wi.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],wi.prototype,"distance",void 0),(0,a._)([(0,r.Cb)()],wi.prototype,"area",void 0),(0,a._)([(0,r.Cb)()],wi.prototype,"totalLength",void 0),wi=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],wi);var xi=i(9856),Ci=i(13615),Oi=i(78952);let Ei=class extends(gt.Z.EventedMixin(ee.r)){constructor(t){super(t),this._vertexManipulatorMaterial=(0,ae.EA)(ut.colorToVec4(ut.reshapeManipulators.vertex.color),ut.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,ae.qJ)(ut.colorToVec4(ut.reshapeManipulators.vertex.outlineColor),ut.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,ae.qJ)(ut.colorToVec4(ut.reshapeManipulators.vertex.hoverOutlineColor),ut.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,ae.EA)(ut.colorToVec4(ut.reshapeManipulators.edge.color),ut.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,ae.qJ)(ut.colorToVec4(ut.reshapeManipulators.edge.outlineColor),ut.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=(0,ae.EA)(ut.colorToVec4(ut.reshapeManipulators.edgeOffset.color),ut.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,ae.EA)(ut.colorToVec4(ut.reshapeManipulators.edgeOffset.hoverColor),ut.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=(0,ae.EA)(ut.colorToVec4(ut.reshapeManipulators.selected.color),ut.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,ae.qJ)(ut.colorToVec4(ut.reshapeManipulators.selected.outlineColor),ut.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,ae.qJ)(ut.colorToVec4(ut.reshapeManipulators.selected.hoverOutlineColor),ut.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._manipulatorHandles=new Ae.Z,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Gi.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:t,view:e}=this,i=this._graphicState=new Xt({graphic:t});this._tooltip=new ai.u({view:e}),this.addHandles([(0,s.YP)((()=>i.displaying),(t=>{for(const e of this._manipulatorInfos)e.manipulator.available=t})),(0,s.YP)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(t=>{let{labels:e,enabled:i,edgeOffsetEnabled:a}=t;(0,o.pC)(e)&&(e.visible=i,e.edgeDistance=a?"far":"default")}),s.nn),(0,s.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),s.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,o.SC)(this._segmentLabels),this._tooltip=(0,o.SC)(this._tooltip),this._removeManipulators()}get inputGeometry(){return(0,o.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(t){this._recreateEditGeometryAndManipulators(t)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const t=this._manipulatorInfos.filter((t=>t.manipulator.selected&&"vertex"===t.type));this._removeVertices(t)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,o.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,o.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(t){if((0,o.Wi)(this._editGeometryOperations))return;const e=(0,u.RL)(this.graphic);for(const i of this._editGeometryOperations.data.components){const a=t?.byComponentIndex.get(i.index);for(const t of i.vertices){const i=a?.has(t.index);this._createVertexOrEdgeManipulator(t,e,i)}for(const t of i.edges)this._createVertexOrEdgeManipulator(t,e)}this._createGraphicMoveManipulation(),this._createMoveManipulation(e),this._createVisualElements()}get canRedo(){return(0,o.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,o.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,o.Wi)(this._editGeometryOperations))return null;const t=this._editGeometryOperations.redo();return(0,o.pC)(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}undo(){if((0,o.Wi)(this._editGeometryOperations))return null;this.emit("undo");const t=this._editGeometryOperations.undo();return(0,o.pC)(t)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),t}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(t){const e={byComponentIndex:new Map};if((0,o.pC)(t)&&(0,o.pC)(this.inputGeometry)&&(0,w.Pt)(t,this.inputGeometry))for(const i of this._manipulatorInfos)if("vertex"===i.type&&i.manipulator.selected){const{index:t,component:{index:a}}=i.handle,{byComponentIndex:n}=e,o=n.get(a)||new Set;o.add(t),n.set(a,o)}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,o.SC)(this._editGeometryOperations),this._segmentLabels=(0,o.SC)(this._segmentLabels),(0,o.Wi)(t)||(this._editGeometryOperations=Ke.c.fromGeometry(t,this.view.state.viewingMode),this._createManipulators(e),this._segmentLabels=new Y({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,u.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(t,e){if("end"===e.action)return e;let i=0;const a=[],n=this._manipulatorInfos.some((t=>"vertex"===t.type&&t.manipulator.selected)),o=t===Pi.SELECTED_OR_ALL&&n;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.grabbing||o&&!s.manipulator.selected||a.push(s),i++);if(0===a.length)return e;if(this._moveVertices(a,e),a.length===i){if(this._updateEventState(Gi.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Gi.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){return this._manipulatorInfos.reduce(((t,e)=>"vertex"===e.type&&e.manipulator.selected?t+1:t),0)>1}_perVertexManipulatorDragAction(t){if(this._updateEventState(Gi.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:i,mapDeltaZ:a}=t;if(!e&&!i&&!a)return;const n=[];for(const o of this._manipulatorInfos)"vertex"===o.type&&(o.manipulator.selected&&!o.manipulator.grabbing||o===t.info)&&n.push(o);this._moveVertices(n,t,bi.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(t){if(t===this._reshapeEventState)return!1;switch(t){case Gi.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Gi.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Gi.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Gi.MOVING:switch(this._reshapeEventState){case Gi.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Gi.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Gi.RESHAPING:switch(this._reshapeEventState){case Gi.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Gi.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==t;return this._reshapeEventState=t,e}_createGraphicMoveManipulation(){const{tool:t,view:e}=this,i=this._graphicState;if(this._graphicMoveManipulation=new qe({tool:t,view:e,graphicState:i}),this.enableMoveGraphic){let t=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((e,i,a)=>{i.next((t=>this._trackNumDragging(t))).next((e=>("start"===e.action&&(t=(0,o.Wg)(this._editGeometryOperations).createUndoGroup()),e))).next((t=>this._perGraphicManipulatorDragAction(Pi.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(je.XY,t),t))).next((e=>{"end"===e.action&&(this._tooltip.clear(),t=(0,o.hw)(t))})),a.next((()=>this._onDragCancel(!0,(()=>t=(0,o.hw)(t)))))}))),this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(t,!1))))}else this._graphicMoveManipulation.forEachManipulator((t=>{t.grabbable=!1,t.cursor=null}));this._graphicMoveManipulation.forEachManipulator((t=>this._manipulatorHandles.add(t.events.on("immediate-click",(t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()})))))}_createMoveManipulation(t){const{graphic:e,handles:i,tool:a,view:n}=this,r=this._graphicState;this._moveManipulation=new Fe({tool:a,view:n,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&oe(e),snapToScene:!1,radius:Fe.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator((t=>i.add([t.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(t)||this._manipulatorInfos.some((t=>t.manipulator.selected))||this.emit("immediate-click",{...i,graphic:e}),i.stopPropagation()})),this._watchAndUpdateGrabState(t,!1)])));const l=t=>e=>{i.add(e.events.on("focus-changed",(e=>{let{action:i}=e;"focus"===i&&this._tooltipOptions.enabled?this._updateTranslateTooltip(t):this._tooltip.clear()})))};this._moveManipulation.xyManipulation.forEachManipulator(l(je.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(l(je.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(l(je.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const h=(0,o.Wg)(e.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,n,s,r,l)=>{const{snappingStep:h,cancelSnapping:p}=(0,ii.W)({predicate:t=>!!t.info,snappingManager:a.snappingManager,snappingContext:new ei.N({editGeometryOperations:(0,o.Wg)(this._editGeometryOperations),elevationInfo:t,pointer:l,excludeFeature:e,visualizer:new k._}),updatingHandles:this.updatingHandles,useZ:!1});return r=r.next((t=>(this._onDragCancel(),t))).next(p),{steps:s=s.next((t=>this._trackNumDragging(t))).next((t=>{const e=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));return t.manipulatorType===re.TRANSLATE_XY&&1===e.length?{...t,info:e[0],snapOrigin:e[0].handle.pos}:t})).next((0,Ge.BS)(this.view,t,e)).next(...h).next((0,Ge.AN)()).next((t=>this._perGraphicManipulatorDragAction(Pi.SELECTED_OR_ALL,t))).next((t=>(this._updateTranslateTooltip(i,t),t))),cancel:r}}),t,h,e),(0,s.YP)((()=>r.displaying),(()=>this._updateMoveManipulationPosition()),s.nn),r.on("changed",(()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()})),(0,s.YP)((()=>r.isDraped),(t=>{this._updateMoveManipulationPosition();const e="align-move-manipulation";t?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):i.remove(e)}),s.nn)])}_createVisualElements(){const{graphic:t,view:e}=this,i=be({view:e,graphic:t,forEachManipulator:t=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(t),this._moveManipulation.forEachManipulator(t);for(const e of this._manipulatorInfos)t(e.manipulator,re.TRANSLATE_XY)}},onManipulatorsChanged:t=>this.on("manipulators-changed",t)});(0,o.pC)(i)&&(this._outlineVisualElement=i.visualElement instanceof Tt?i.visualElement:null),(0,o.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()}))),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.RL)(this.graphic);const i=ut.reshapeManipulators.edgeOffset,a=i.size/2,s=a+i.collisionPadding,r=a/s,l=r*Math.sqrt(3)/2;(0,o.Wi)(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=(0,Yt.DA)(this._edgeOffsetManipulatorMaterial,l,r/2,r/2,i.height,i.offset)),(0,o.Wi)(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=(0,Yt.DA)(this._edgeOffsetManipulatorMaterial,-l,r/2,r/2,i.height,-i.offset));const h=[new De.r(this._edgeOffsetManipulatorGeometryInside.instantiate(),We.Q9.Unfocused),new De.r(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),We.Q9.Focused),new De.r(this._edgeOffsetManipulatorGeometryOutside.instantiate(),We.Q9.Unfocused),new De.r(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),We.Q9.Focused)],p=new he.Z({view:this.view,renderObjects:h,elevationInfo:"on-the-ground"!==e.mode||(0,_i.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:(0,d.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),c=new he.Z({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),g={manipulator:p,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:c,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(g,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(g);const _=[];for(const n of[g.handle.leftVertex,g.handle.rightVertex]){const t=this._getManipulatorInfoFromHandle(n);(0,o.pC)(t)&&_.push(t.manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(g))))}g.locationUpdateHandle=(0,n.AL)(_),this._manipulatorHandles.add(g.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(c,!0)],p),this._manipulatorHandles.add((0,Ge.Xd)(p,this._createEdgeOffsetPipeline(g,e)),p),this._manipulatorHandles.add((0,Ge.Xd)(c,((t,i,a,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(g,e)(t,i,a);else if(this.enableMoveGraphic){const n=this.graphic,s=(0,o.pC)(n.geometry)?n.geometry.spatialReference:null;i.next((t=>this._trackNumDragging(t))).next((0,Ge.kY)(this.view,t.elevationAlignedLocation)).next((0,Ie.G)(this.view,t.elevationAlignedLocation,e,s,n)).next((0,Ge.zh)()).next((0,Ge.AN)()).next((t=>this._perGraphicManipulatorDragAction(Pi.ALL,t))).next((t=>(this._updateTranslateGraphicTooltip(je.XY,t),t))).next((t=>{"end"===t.action&&this._tooltip.clear()})),a.next((()=>this._onDragCancel(!t.metadata.deleting)))}})),p);const m=t=>{this._manipulatorInfos.some((t=>t.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()};return this._manipulatorHandles.add([p.events.on("immediate-click",m),c.events.on("immediate-click",m),p.events.on("focus-changed",(t=>{let{action:e}=t;const i=this._tooltipOptions;if("focus"===e&&i.enabled){const t=this._tooltip.info=new wi({tooltipOptions:i});this._updateTooltipAreaOrTotalLength(t)}else this._tooltip.clear()}))],p),this._manipulatorInfos.push(g),this.manipulators.add(p),this.manipulators.add(c),this.emit("manipulators-changed"),g}_autoHideEdgeOffsetManipulator(t,e){const i=t.manipulator,a=t.edgeManipulator,s=()=>{t.visibilityHandle=(0,o.hw)(t.visibilityHandle);const s=this._getManipulatorInfoFromHandle(t.handle.leftVertex),r=this._getManipulatorInfoFromHandle(t.handle.rightVertex),l=(0,o.pC)(s)&&(0,o.pC)(r)&&function(t,e,i){const a=i.projectToRenderScreen(t,(0,_.J$)()),n=i.projectToRenderScreen(e,(0,_.J$)());return(0,o.pC)(a)&&(0,o.pC)(n)?(0,c.p)((0,c.b)(a,a,n)):0}(s.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!i.focused&&!a.focused||l)&&(i.grabbable=!l,a.grabbable=!l,t.visibilityHandle=(0,n.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),a.events.on("focus-changed",s),{remove:()=>{(0,o.hw)(t.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],i),s()}_updateEdgeOffsetManipulator(t){this._updateManipulatorPosition(t);const{coordinateHelper:e}=(0,o.Wg)(this._editGeometryOperations).data,i=fi(this.view,t.manipulator.elevationAlignedLocation,vi(e,t.handle,(0,o.Wg)(t.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(t.handle.leftVertex),n=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if((0,o.Wi)(a)||(0,o.Wi)(n))return;const s=a.manipulator.renderLocation,r=n.manipulator.renderLocation,l=(0,o.pC)(i)?function(t,e,i){const a=(0,gi.mJ)(t),n=(0,c.r)((0,d.c)(),e,i),o=(0,c.f)((0,d.c)(),n,a),s=(0,c.f)((0,d.c)(),n,o);return(0,Pt.f)(n[0],n[1],n[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1)}(i,s,r):Pt.I;t.manipulator.modelTransform=l,t.edgeManipulator.elevationAlignedLocation=t.manipulator.elevationAlignedLocation,t.edgeManipulator.modelTransform=l;const h=(0,c.l)((0,c.b)(Ri,s,r))/2;t.edgeManipulator.collisionType={type:"line",paths:[[[-h,0,0],[h,0,0]]]}}_createEdgeOffsetPipeline(t,e){return(i,a,n)=>{this._clearSelection();const{step:s,cleanup:r}=this._initializeEdgeOffset(t,e);a.next((t=>this._trackNumDragging(t))).next((0,Ge.kY)(this.view,i.elevationAlignedLocation)).next(s).next((0,Ie.bB)(this.view)).next((0,Ie.zP)(this.view,(0,o.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,Ge.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(t)).next(this._showEdgeOffsetTooltip()).next((t=>{"end"===t.action&&r()})),n.next((()=>{i.metadata.deleting||(r(),this._onDragCancel())}))}}_initializeEdgeOffset(t,e){const i=(0,o.Wg)(this._editGeometryOperations),a=vi(i.data.coordinateHelper,t.handle,e),r=i.createUndoGroup(),l=fi(this.view,t.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const e=this._getManipulatorInfoFromHandle(t.handle.leftVertex.leftEdge);(0,o.pC)(e)&&this._splitEdgeManipulator(e,1)}if(a.requiresSplitEdgeRight){const e=this._getManipulatorInfoFromHandle(t.handle.rightVertex.rightEdge);(0,o.pC)(e)&&this._splitEdgeManipulator(e,0)}const h=()=>new ui.Z({paths:[[t.handle.leftVertex.pos,t.handle.rightVertex.pos]],spatialReference:i.data.spatialReference}),p=new Tt({view:this.view,isDraped:this._graphicState.isDraped,geometry:h(),elevationInfo:t.elevationInfo,width:ut.visualElements.lineGraphics.outline.width,color:ut.colorToVec4(q.main),attached:!0});let c;const d=()=>{this._cleanEdgeOffsetCollapsedEdges(t),c=(0,o.hw)(c)},u=this.on("undo",d);return c=(0,n.AL)([(0,n.ed)(p),(0,s.YP)((()=>this._graphicState.isDraped),(t=>p.isDraped=t)),this._graphicState.on("changed",(()=>p.geometry=h())),r,u]),{step:t=>(0,o.Wi)(a)||(0,o.Wi)(l)?(d(),null):{...t,operation:a,plane:l},cleanup:d}}_applyEdgeOffsetStep(t){return e=>{if(this.destroyed||(0,o.Wi)(e.operation))return e;this._updateEventState(Gi.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:n}=e;return(i||a||n)&&(this._offsetEdge(t,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return t=>{const{operation:e,mapEnd:i}=t;return(0,o.Wi)(e)||(0,o.Wi)(i)?t:("start"===t.action&&e.selectArrowFromStartPoint(i),{...t,signedDistance:e.signedDistanceToPoint(i)})}}_showEdgeOffsetTooltip(){return t=>{const{mapEnd:e,signedDistance:i,operation:a}=t,n=this._tooltip,s=this._tooltipOptions;if(!s.enabled||(0,o.Wi)(i))return n.clear(),t;let r=n.info;((0,o.Wi)(r)||"reshape-edge-offset"!==r.type)&&(r=n.info=new wi({tooltipOptions:s}));const{coordinateHelper:l}=(0,o.Wg)(this._editGeometryOperations).data;return r.distance="end"===t.action?ie.yP:function(t,e,i,a,n){if(t){const t=n.toXYZ(n.pointToVector(i)),s=(0,gi.nF)(a,t,Re.WM.get()),r=(0,Ci.FB)(s,t,n.spatialReference);if((0,o.pC)(r))return(0,ie.yG)(r.value*Math.sign(e),r.unit)}return(0,ie.yG)(e*(0,di.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,i*a.selectedArrow,e,a.plane,l),this._updateTooltipAreaOrTotalLength(r),t}}_cleanEdgeOffsetCollapsedEdges(t){const e=t.handle.leftVertex.leftEdge?.leftVertex,i=t.handle.leftVertex,a=t.handle.rightVertex.rightEdge?.rightVertex,n=t.handle.rightVertex,s=(0,o.Wg)(this._editGeometryOperations).data.coordinateHelper,r=[];if(e&&s.distance(e.pos,i.pos)<Di){const t=this._getManipulatorInfoFromHandle(i);(0,o.pC)(t)&&r.push(t)}if(s.distance(i.pos,n.pos)<Di||a&&s.distance(a.pos,n.pos)<Di){const t=this._getManipulatorInfoFromHandle(n);(0,o.pC)(t)&&r.push(t)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(t){const e=t.size/2,i=e+t.collisionPadding;return{size:e/i,outlineSize:(e+t.outlineSize)/i}}_createVertexOrEdgeManipulator(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,u.RL)(this.graphic),i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("edge"===t.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(t,e);if(!this.enableMidpoints)return null}if((0,o.Wi)(this._vertexManipulatorGeometry)||(0,o.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(ut.reshapeManipulators.vertex);this._vertexManipulatorGeometry=(0,Yt.PI)(this._vertexManipulatorMaterial,t,16,16),this._vertexManipulatorOutlineGeometry=(0,Yt.PI)(this._vertexManipulatorOutlineMaterial,e,16,16)}if((0,o.Wi)(this._edgeManipulatorGeometry)||(0,o.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:t,outlineSize:e}=this._computeVertexManipulatorSizeAndOutline(ut.reshapeManipulators.edge);this._edgeManipulatorGeometry=(0,Yt.PI)(this._edgeManipulatorMaterial,t,16,16),this._edgeManipulatorOutlineGeometry=(0,Yt.PI)(this._edgeManipulatorOutlineMaterial,e,16,16)}const a=(0,o.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[new De.r(this._vertexManipulatorGeometry.instantiate(),Ii.Vertex|We.Q9.Unselected),new De.r(this._vertexManipulatorOutlineGeometry.instantiate(),Ii.Vertex|We.Q9.Unfocused|We.Q9.Unselected),new De.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Ii.Vertex|We.Q9.Focused|We.Q9.Unselected),new De.r(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),We.Q9.Selected),new De.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),We.Q9.Selected|We.Q9.Unfocused),new De.r(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),We.Q9.Selected|We.Q9.Focused)];this.enableMidpoints&&a.push(new De.r(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),Ii.Edge|We.Q9.Focused|We.Q9.Unselected),new De.r(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),Ii.Edge|We.Q9.Focused|We.Q9.Unselected),new De.r(this._edgeManipulatorGeometry.instantiate(),Ii.Edge|We.Q9.Unfocused|We.Q9.Unselected),new De.r(this._edgeManipulatorOutlineGeometry.instantiate(),Ii.Edge|We.Q9.Unfocused|We.Q9.Unselected));const s=new he.Z({view:this.view,renderObjects:a,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});s.selected=i,this._setTypeSpecificManipulatorSettings(s,t,e);const r="edge"===t.type?{manipulator:s,handle:t,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:s,handle:t,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(r),this.manipulators.add(s),this._updateManipulatorPosition(r),"edge"===r.type){const t=[];for(const e of[r.handle.leftVertex,r.handle.rightVertex]){const i=this._getManipulatorInfoFromHandle(e);(0,o.pC)(i)&&t.push(i.manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(r))))}r.locationUpdateHandle=(0,n.AL)(t),this._manipulatorHandles.add(r.locationUpdateHandle,s)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!0),s);const l=(0,Ge.Xd)(s,((t,i,a,n)=>{let s=null;const{snappingStep:l,cancelSnapping:h}=(0,ii.W)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ei.N({editGeometryOperations:(0,o.Wg)(this._editGeometryOperations),elevationInfo:e,pointer:n,excludeFeature:this.graphic,visualizer:new k._}),updatingHandles:this.updatingHandles,useZ:!1});a=a.next((e=>(this._onDragCancel(!t.metadata.deleting,(()=>s=(0,o.hw)(s))),e))).next(h),i.next((t=>this._trackNumDragging(t))).next((t=>{if("start"===t.action&&(s=(0,o.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===r.type){const e=this._splitEdgeManipulator(r);return{...t,info:e,snapOrigin:e.handle.pos}}return{...t,info:r,snapOrigin:r.handle.pos}})).next((0,Ge.kY)(this.view,t.elevationAlignedLocation)).next((0,Ie.VG)(this.view,this.graphic,t.elevationAlignedLocation,t.location.spatialReference,this.graphic)).next((0,Ge.BS)(this.view,e,this.graphic)).next(...l).next((0,Ge.AN)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(s=(0,o.hw)(s)),this._updateTranslateVertexTooltip(t,je.XY,e)}))}));return this._manipulatorHandles.add([l,s.events.on("immediate-click",(t=>this._manipulatorClickCallback(t,r))),s.events.on("select-changed",(()=>{r.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),s.events.on("focus-changed",(t=>{let{action:e}=t;"focus"===e&&"edge"!==r.type?this._updateTranslateVertexTooltip(s,je.XY):this._tooltip.clear()}))],s),this.emit("manipulators-changed"),r}_trackNumDragging(t){switch(t.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return t}_onDragCancel(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;switch(this._numDragging--,t&&(this.undo(),this.outputGeometry=(0,o.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),(0,o.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case Gi.NONE:break;case Gi.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Gi.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(Gi.NONE)}_setTypeSpecificManipulatorSettings(t,e,i){switch(e.type){case"vertex":t.state=Ii.Vertex,t.selectable=!0,t.cursor="move",t.collisionPriority=2,t.radius=ut.reshapeManipulators.vertex.size/2+ut.reshapeManipulators.vertex.collisionPadding,t.elevationInfo=i,t.interactive=(0,o.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":t.state=Ii.Edge,t.selectable=!1,t.cursor="copy",t.collisionPriority=-1,t.radius=ut.reshapeManipulators.edge.size/2+ut.reshapeManipulators.edge.collisionPadding,t.elevationInfo="on-the-ground"!==i.mode||(0,_i.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(t,e){return t.events.on("grab-changed",(i=>this._onGrabStateChanged(t,e,i.action,i.pointerType)))}_onGrabStateChanged(t,e,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if(!this._recreatingManipulators){if("start"===i)e&&this._updateSelection(t),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Gi.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((t=>{t.manipulator.interactive=t.manipulator.grabbing||!this._numGrabbing&&(0,o.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in t&&(t.edgeManipulator.interactive=t.edgeManipulator.grabbing||!this._numGrabbing)})),this._graphicMoveManipulation.forEachManipulator((t=>{t.interactive=t.grabbing||!this._numGrabbing})))}}_clearSelection(){for(const t of this._manipulatorInfos)t.manipulator.grabbing||(t.manipulator.selected=!1)}_updateSelection(t){t.grabbing&&!t.selected&&t.selectable&&(this._clearSelection(),t.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(t){(0,o.Wi)(t)||(t.manipulator.metadata.deleting=!0,this.manipulators.remove(t.manipulator),this._manipulatorHandles.remove(t.manipulator),(0,h.e$)(this._manipulatorInfos,t),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(t){if(t)for(const e of this._manipulatorInfos)if(t===e.handle)return e;return null}_updateManipulatorPosition(t){if((0,o.Wi)(t))return;const e=(0,o.Wg)(this._editGeometryOperations);if("vertex"===t.type)t.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(t.handle.pos,Ti),t.manipulator.grabbing&&(0,o.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=t.manipulator.renderLocation);else if("edge"===t.type){const i=this._getManipulatorInfoFromHandle(t.handle.leftVertex),a=this._getManipulatorInfoFromHandle(t.handle.rightVertex);if((0,o.Wi)(i)||(0,o.Wi)(a))return;const n=i.manipulator,s=a.manipulator;if((0,o.pC)(t.manipulator.elevationInfo)&&"on-the-ground"===t.manipulator.elevationInfo.mode){const i=n.location,a=s.location,o=.5,r=i.x+o*(a.x-i.x),l=i.y+o*(a.y-i.y),h=i.hasZ&&a.hasZ?0:void 0;t.manipulator.location=(0,yt.Tx)(r,l,h,e.data.spatialReference)}else(0,c.h)(Ri,n.renderLocation,s.renderLocation,.5),t.manipulator.renderLocation=Ri}}_splitEdgeManipulator(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const i=(0,o.Wg)(this._editGeometryOperations),a=(0,o.Wg)(i.splitEdge(t.handle,e).createdVertex);t.locationUpdateHandle=(0,o.hw)(t.locationUpdateHandle);const n=(0,u.RL)(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(t),s=this._createVertexOrEdgeManipulator(a)):(s=t,s.handle=a,s.type="vertex",this._setTypeSpecificManipulatorSettings(t.manipulator,t.handle,n)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this.enableEdgeOffset||this._updateTranslateVertexTooltip(s.manipulator,je.XY),this._updateSelection(t.manipulator);const r=this._updateEventState(Gi.RESHAPING),l=i.data.coordinateHelper.vectorToArray(s.handle.pos),h=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:h,vertexIndex:(0,o.Wg)(a.index)}],added:l}),r&&this._updateEventState(Gi.NONE),s}_updateMoveManipulationPosition(){const t=(0,c.s)(Ri,0,0,0);let e=0,i=!1,a=null,n=null;for(const s of this._manipulatorInfos)"vertex"===s.type&&(s.manipulator.selected?(e++,(0,c.a)(t,t,s.manipulator.renderLocation),(0,o.Wi)(a)||s.selectedIndex>a.selectedIndex?(n=a,a=s):((0,o.Wi)(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(0===e){const t=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t,this._moveManipulation.zManipulation.available=t&&this.enableZShape&&oe(this.graphic),this._moveManipulation.angle=Le((0,o.Wg)(this.graphic.geometry)),this._moveManipulation.radius=Fe.radiusForSymbol(this.graphic.symbol)}else{const t=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=t,this._moveManipulation.xyAxisManipulation.available=t,this._moveManipulation.zManipulation.available=t&&this.enableZVertex&&oe(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=t&&1!==e;let i=0;if((0,o.pC)(a)){const t=a.handle.pos,e=(0,o.pC)(n)?n.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,s=(0,o.Wi)(n)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;e&&s?this._moveManipulation.xyAxisManipulation.available=!1:e?i=Ai(e,t):s&&(i=Ai(t,s))}this._moveManipulation.angle=i,this._moveManipulation.radius=xe}0!==e&&i?((0,c.g)(t,t,1/e),Ti.spatialReference=(0,o.Wg)(this._editGeometryOperations).data.spatialReference,Ti.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,Ti),this._moveManipulation.elevationAlignedLocation=Ti):(0,o.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,o.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,ae.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(t){const e=new Array,i=(0,o.Wg)(this._editGeometryOperations);for(const a of t)if("vertex"===a.type&&i.canRemoveVertex()){e.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const t=i.removeVertices([a.handle]),n=(0,o.Wg)(t.removedVertices?.[0].createdEdge);n&&this._createVertexOrEdgeManipulator(n)}if(e.length>0){const t=e.map((t=>{const e=i.data.components.indexOf(t.component);return{coordinates:i.data.coordinateHelper.vectorToArray(t.pos),componentIndex:e,vertexIndex:(0,o.Wg)(t.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(Gi.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:t.map((t=>t.coordinates)),vertices:t}),this.destroyed)return;if(a&&(this._updateEventState(Gi.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===e.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS;const a=(0,o.Wg)(this._editGeometryOperations);a.moveVertices(t.map((t=>t.handle)),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const n of t)this._updateManipulatorPosition(n)}_offsetEdge(t,e){if((0,o.Wi)(e.operation)||(0,o.Wi)(e.signedDistance))return;const i=(0,o.Wg)(this._editGeometryOperations),a=e.operation.clone();a.distance=e.signedDistance,i.updateVertices([t.handle.leftVertex,t.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t.handle.rightVertex))}_manipulatorClickCallback(t,e){t.shiftKey||this._clearSelection(),"vertex"===e.type&&(e.manipulator.selected=!e.manipulator.selected,t.button===Mi.t.Right&&this._removeVertices([e])),"edge"===e.type&&t.button===Mi.t.Left&&this._splitEdgeManipulator(e),t.stopPropagation()}_updateTranslateTooltip(t,e){const i=this._manipulatorInfos.filter((t=>"vertex"===t.type&&t.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,t,e):this._updateTranslateGraphicTooltip(t,e)}_updateTranslateGraphicTooltip(t,e){const i=this._tooltipOptions;if(!i.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case je.XY:this._tooltip.info=new ni.$E({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,e)=>(0,P.GQ)(t,e,a)));break;case je.XY_AXIS:this._tooltip.info=new ni.in({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,((t,i)=>{const n=(0,P.GQ)(t,i,a);return(0,ie.bA)(n,ze(e))}));break;case je.Z:this._tooltip.info=new ni.QW({tooltipOptions:i}),this._updateTranslateTooltipDistance(this._tooltip.info,e,oi._e)}}_updateTranslateVertexTooltip(t,e,i){const a=this._tooltipOptions;if(!a.enabled)return;let n;const s=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case je.XY:n=new ni.nk({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,((t,e)=>(0,P.GQ)(t,e,s))),this._updateTooltipAreaOrTotalLength(n);break;case je.XY_AXIS:n=new ni.c1({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,((t,e)=>{const a=(0,P.GQ)(t,e,s);return(0,ie.bA)(a,ze(i))})),this._updateTooltipAreaOrTotalLength(n);break;case je.Z:n=new ni.j({tooltipOptions:a}),this._updateTranslateTooltipDistance(n,i,oi._e)}const r=(0,oi.g1)(t.elevationAlignedLocation);(0,o.pC)(r)&&(n.elevation={mode:"absolute-height",...r}),this._tooltip.info=n}_updateTranslateTooltipDistance(t,e,i){if((0,o.pC)(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,s=i(a,n);t.distance=(0,o.pC)(s)?s:ie.yP}}_updateTooltipAreaOrTotalLength(t){const{geometry:e}=this.graphic;if((0,o.Wi)(e))return;const i=this._graphicState.isDraped?"on-the-ground":"absolute-height";t.area="polygon"===e.type?(0,xi.k)(e,i):null,t.totalLength="polyline"===e.type?(0,P.Ul)(e,i):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Ai(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])+Math.PI/2}(0,a._)([(0,r.Cb)()],Ei.prototype,"_editGeometryOperations",void 0),(0,a._)([(0,r.Cb)()],Ei.prototype,"_segmentLabels",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],Ei.prototype,"tool",void 0),(0,a._)([(0,r.Cb)()],Ei.prototype,"_tooltip",void 0),(0,a._)([(0,r.Cb)()],Ei.prototype,"inputGeometry",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"outputGeometry",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],Ei.prototype,"updating",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"manipulators",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"view",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"graphic",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"enableZShape",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"enableZVertex",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"enableMoveGraphic",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"enableMidpoints",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"enableEdgeOffset",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"_labelOptions",null),(0,a._)([(0,r.Cb)()],Ei.prototype,"_tooltipOptions",null),Ei=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Ei);const Ti=(0,yt.Tx)(0,0,void 0,Oi.Z.WGS84),Ri=(0,d.c)(),Di=1e-6;var Ii,Gi,Pi;!function(t){t.Vertex=We.jg.Custom1,t.Edge=We.jg.Custom2}(Ii||(Ii={})),function(t){t[t.NONE=0]="NONE",t[t.MOVING=1]="MOVING",t[t.RESHAPING=2]="RESHAPING"}(Gi||(Gi={})),function(t){t[t.ALL=0]="ALL",t[t.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Pi||(Pi={}));var Li=i(52349);let zi=class extends(gt.Z.EventedMixin($e.m)){constructor(t){super(t),this._handles=new Ae.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Li.Z,this.tooltipOptions=new ti.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const t=this._reshapeOperation=new Ei({tool:this});this.addHandles([t.on("reshape",(t=>{"reshape"===t.type&&this._onReshapeGeometryChanged(),this.emit("reshape",t)})),t.on("move",(t=>{"move"===t.type&&this._onReshapeGeometryChanged(),this.emit("move",t)})),t.on("vertex-add",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",t)})),t.on("vertex-remove",(t=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",t)})),t.on("immediate-click",(t=>this.emit("immediate-click",t))),this.view.on("pointer-down",["Shift"],(t=>t.stopPropagation())),(0,s.YP)((()=>this.graphic),(()=>this._updateGraphic()),s.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,o.SC)(this._handles),this._reshapeOperation=(0,o.SC)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const t=(0,ci.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,o.pC)(t)?t.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,ci.P)(this.graphic)!==ne.e.SUPPORTED)return;const t=(0,s.YP)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),s.Z_);this._handles.add(t,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(t){this._internalGeometryUpdate=!0,this.graphic.geometry=t,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:t}=this._reshapeOperation;!(0,o.Wi)(this.graphic)&&t&&this._updateGeometryInternally(t.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();const t=this._reshapeOperation.undo(),{outputGeometry:e}=this._reshapeOperation;t&&e&&this._updateGeometryInternally(e.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();const t=this._reshapeOperation.redo(),{outputGeometry:e}=this._reshapeOperation;t&&e&&this._updateGeometryInternally(e.clone())}onInputEvent(t){"key-down"!==t.type||"Delete"!==t.key&&"Backspace"!==t.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,a._)([(0,r.Cb)()],zi.prototype,"_reshapeOperation",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],zi.prototype,"view",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],zi.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableZShape",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableZVertex",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableMoveGraphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableMidpoints",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],zi.prototype,"enableEdgeOffset",void 0),(0,a._)([(0,r.Cb)()],zi.prototype,"type",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:Li.Z})],zi.prototype,"labelOptions",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:ti.Z})],zi.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],zi.prototype,"snappingManager",void 0),(0,a._)([(0,r.Cb)()],zi.prototype,"updating",null),(0,a._)([(0,r.Cb)()],zi.prototype,"automaticManipulatorSelection",void 0),zi=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],zi);var Vi=i(585),Wi=i(50951),Ni=i(17768),Zi=i(99346),Ui=i(40885);let Yi=class extends Si.h{constructor(t){super(t),this.type="transform-rotate",this.rotationType="geographic"}};(0,a._)([(0,r.Cb)()],Yi.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],Yi.prototype,"rotation",void 0),(0,a._)([(0,r.Cb)()],Yi.prototype,"rotationPrecision",void 0),(0,a._)([(0,r.Cb)()],Yi.prototype,"orientation",void 0),(0,a._)([(0,r.Cb)()],Yi.prototype,"orientationPrecision",void 0),(0,a._)([(0,r.Cb)()],Yi.prototype,"rotationType",void 0),Yi=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Yi);let Hi=class extends Si.h{constructor(t){super(t),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,a._)([(0,r.Cb)()],Hi.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],Hi.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],Hi.prototype,"size",void 0),(0,a._)([(0,r.Cb)()],Hi.prototype,"sizeUnit",void 0),(0,a._)([(0,r.Cb)()],Hi.prototype,"sizePrecision",void 0),Hi=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Hi);let ki=class extends Si.h{constructor(t){super(t),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var Bi,Fi;(0,a._)([(0,r.Cb)()],ki.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"orientation",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"orientationEnabled",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"orientationPrecision",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"rotationType",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"size",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"sizeUnit",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"sizeEnabled",void 0),(0,a._)([(0,r.Cb)()],ki.prototype,"sizePrecision",void 0),ki=(0,a._)([(0,p.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],ki),function(t){t.ScaleIn=We.jg.Custom2,t.ScaleOut=We.jg.Custom3,t.RotateLeft=We.jg.Custom4,t.RotateRight=We.jg.Custom5,t.Unlocked=We.jg.Custom7,t.DelayedFocused=We.jg.Custom8,t.TouchInput=We.jg.Custom12}(Bi||(Bi={}));class Xi{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(t){this._ringManipulator.location=t}set elevationAlignedLocation(t){this._ringManipulator.elevationAlignedLocation=t}get grabbing(){return this._ringManipulator.grabbing}set interactive(t){this._ringManipulator.interactive=t}constructor(t){let{adapter:e,tooltipOptions:i,mode:a,tool:n}=t;this._mode=null,this._handles=new Ae.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new gt.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,o.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=n,this._mode=a,this._adapter=e,this._tooltipOptions=i,this._tooltip=new ai.u({view:n.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,s.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),s.nn))}destroy(){(0,o.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,o.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,o.SC)(this._tooltip)}startAnimation(t){this.cancelActiveAnimation(),t.start();const e=(0,Zi.A)({update:e=>{let{deltaTime:i}=e;t.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation={...t,frameTask:e}}cancelActiveAnimation(){(0,o.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,o.SC)(this._activeAnimation))}forEachManipulator(t){t(this._ringManipulator,re.SCALE_ROTATE)}_createManipulator(){const t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);const e=this.tool.graphicState.graphic,i=(0,Ge.Xd)(t,((t,i,a)=>{this._scaleRotateDragData=null;const n=this._adapter.startInteraction(),s={mode:"none",origin:(0,d.a)(t.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=s,this._updateDragState();const r=Re.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,r),i.next((0,Ie._N)(this.tool.view,(0,gi.Yq)(t.renderLocation,r,(0,gi.Ue)()))).next((t=>{const i=(0,gi.mJ)(t.plane),a=(0,ae.Gd)(t.renderStart,t.renderEnd,s.origin,i),r=Ni.Q4.shortestSignedDiff(s.angle,a);s.angleDir=(0,le.uZ)(s.angleDir+r,-.3,.3),s.angle=a;const l=function(t,e){const i=(0,c.b)(Re.WM.get(),e.renderStart,t.origin),a=(0,c.b)(Re.WM.get(),e.renderEnd,t.origin),n=(0,c.l)(i),o=(0,c.l)(a);return 0===n?0:o/n}(s,t),h=l-this._adapter.scale;if(s.scaleDir=(0,le.uZ)(s.scaleDir+h,-.2,.2),this._onScaleChanged(),"none"===s.mode){const i=this._mode||function(t,e,i,a){const{renderStart:n,renderEnd:o}=t,s=ji(n,a,Re.WM.get()),r=ji(o,a,Re.WM.get());if((0,c.d)(s,r)<100)return null;const l=(0,c.b)(Re.WM.get(),n,i),h=(0,c.f)(Re.WM.get(),l,(0,gi.mJ)(e)),p=n,d=(0,c.a)(Re.WM.get(),p,h),u=ji(i,a,Re.WM.get()),g=s,_=ji(d,a,Re.WM.get()),m=(0,c.b)(Re.WM.get(),_,g),v=(0,c.b)(Re.WM.get(),s,u),f=(0,Ui.re)(g,m),y=(0,Ui.re)(u,v);return(0,Ui.Jk)(f,r)<(0,Ui.Jk)(y,r)?"rotate":"scale"}(t,t.plane,s.origin,this.tool.view.state.camera);if((0,o.pC)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:e,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:e,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}s.mode=i}}switch(s.mode){case"rotate":n.state.angle=s.initialAngle+a;break;case"scale":n.state.scale=l,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),t.action){case"start":case"update":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:e,angle:(0,le.BV)(s.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:e,xScale:l,yScale:l})}break;case"end":switch(s.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:(0,le.BV)(s.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:l,yScale:l})}}return"end"===t.action&&(this.startAnimation(Qi(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),n.done()),t})).next(this._updateTooltipPipelineStep(s)),a.next((()=>{if(n.cancel(),(0,o.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:e,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:e,xScale:1,yScale:1})}this.startAnimation(Qi(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([i,t.events.on("focus-changed",(t=>{"focus"===t.action?this.startAnimation(function(t,e,i){let a=0,n=null;const o=()=>!1;return{start:()=>{n=t.getFocused,t.getFocused=o,a=0,e()},update:t=>(a+=t,!n?.()||a>=i.delayMs?Fi.STOP:Fi.CONTINUE),destroy:()=>{n&&(t.getFocused=n),e()}}}(this,(()=>this._updateDelayedFocusedState()),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()})),t.events.on("immediate-click",(t=>{t.stopPropagation()})),(0,s.YP)((()=>this.tool.graphicState?.displaying),(t=>this._ringManipulator.available=t),s.nn)])}_updateTooltipPipelineStep(t){return e=>{const i=this._tooltipOptions;if(!i.enabled)return e;if("end"===e.action)return this._updateFocusTooltip(),e;const a=this._tooltip,n=this._tooltipOptions.visualVariables,s=(0,o.pC)(n)?n.size:null,r=(0,o.pC)(n)?n.rotation:null;switch(t.mode){case"scale":a.info=new Hi({tooltipOptions:i,scale:{value:this._adapter.scale},size:(0,ie.yG)((0,o.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,o.pC)(s)?s.unit:null,sizePrecision:(0,o.pC)(s)?qi(s.valueType):null});break;case"rotate":{const t=(0,o.pC)(r)?qi(r.valueType):null,e=(0,o.pC)(r)?r.rotationType:"geographic";a.info=new Yi({tooltipOptions:i,rotation:(0,ie.GJ)((0,o.Pt)(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:t,orientation:(0,ie.GJ)(-this._adapter.angle,"radians","geographic"),orientationPrecision:t,rotationType:e})}}return e}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const t=this._tooltipOptions.visualVariables,e=(0,o.pC)(t)?t.rotation:null,i=(0,o.pC)(t)?t.size:null;this._tooltip.info=new ki({tooltipOptions:this._tooltipOptions,orientation:(0,ie.GJ)(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:(0,o.pC)(e)?qi(e.valueType):null,rotationType:(0,o.pC)(e)?e.rotationType:"geographic",size:(0,ie.yG)((0,o.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,o.pC)(i)?i.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:(0,o.pC)(i)?qi(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Bi.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Bi.Unlocked,!((0,o.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,o.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(Bi.ScaleIn|Bi.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Bi.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Bi.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(Bi.RotateLeft|Bi.RotateRight,!1),this._ringManipulator.updateStateEnabled(Bi.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Bi.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Bi.ScaleIn|Bi.ScaleOut|Bi.RotateLeft|Bi.RotateRight,!1)}_updateManipulatorTransform(){const t=(0,Gt.d)(Re.MP.get(),this._adapter.angle,(0,d.f)(0,0,1));if((0,o.Wi)(t))return;const e=this.getScale(),i=(0,Gt.E)(Re.MP.get(),(0,c.s)(Re.WM.get(),e,e,e));this._ringManipulator.modelTransform=(0,Gt.m)(Re.MP.get(),i,t)}_createRingManipulator(){const t=(t,e,i)=>{const a=[],n=Math.ceil(128*(e-t)/(2*Math.PI));for(let o=0;o<n+1;o++){const s=t+o*(e-t)/n;a.push((0,d.f)(i*Math.cos(s),i*Math.sin(s),0))}return a},e=e=>t(0,2*Math.PI,e),i=t=>[[-t/2,0],[t/2,0],[t/2,.25],[-t/2,.25]],a=this._createMaterial(1),n=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a;return(0,Yt.x2)(n,i(e),t,[],[],!1)},o=e(Ce),s=n(o,24),r={left:new Array,right:new Array},l=[];for(let d=0;d<2;d++){const e=d*Math.PI-Math.PI/4,i=Math.PI/2-Oe,o=e+i,s=e+Math.PI/2-i,h=t(o,s,190),p=n(h,9);l.push(h),l.push(t(o,s,201)),r.left.push(p),r.right.push(p.instantiate());for(let t=0;t<2;t++){const e=0===t,i=(0,Pt.c)();if(e){(0,Gt.k)(i,i,[1,-1,1]),(0,Gt.e)(i,i,-o,[0,0,1]);const t=Math.round(.2*(h.length-1));i[12]=h[t][0],i[13]=h[t][1],i[14]=h[t][2]}else{(0,Gt.e)(i,i,s,[0,0,1]);const t=Math.round(.8*(h.length-1));i[12]=h[t][0],i[13]=h[t][1],i[14]=h[t][2]}const n=(0,Yt.DA)(a,60,0,23,.5);(0,Yt.mx)(n,i),(e?r.left:r.right).push(n)}}const h=[];for(let d=0;d<2;d++){const e=d*Math.PI-Math.PI/4,i=Math.PI/2-Ee,a=e+i,o=e+Math.PI/2-i,s=t(a,o,213);h.push(n(s,9))}const p=this._createMaterial(.66),c=this._createMaterial(.5),g=this._createMaterial(.33),_=e(190),m=e(213),v=n(_,9,p),f=n(m,9,g),y=e(130),M=e(107),b=n(y,9,p),S=n(M,9,g);let w=[new De.r(s,Bi.DelayedFocused),new De.r(s.instantiate({material:c}),We.Q9.None)];this._mode&&"scale"!==this._mode||(w=w.concat([...h.map((t=>new De.r(t,Bi.DelayedFocused|Bi.Unlocked))),new De.r(v,Bi.DelayedFocused|Bi.ScaleIn),new De.r(f,Bi.DelayedFocused|Bi.ScaleIn),new De.r(b,Bi.DelayedFocused|Bi.ScaleOut),new De.r(S,Bi.DelayedFocused|Bi.ScaleOut)])),this._mode&&"rotate"!==this._mode||(w=w.concat([...r.right.map((t=>new De.r(t.instantiate(),Bi.DelayedFocused|Bi.Unlocked))),...r.left.map((t=>new De.r(t,Bi.DelayedFocused|Bi.RotateLeft))),...r.right.map((t=>new De.r(t,Bi.DelayedFocused|Bi.RotateRight)))]));const x=[o,...l];return new he.Z({view:this.tool.view,renderObjects:w,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,u.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:(0,d.f)(0,0,1)}})}_createMaterial(t){const e=(0,F.b)([...Se,t]);return new Ve.E({color:e,transparent:1!==t,cullFace:Ut.Vr.Back,renderOccluded:j.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:t=>this._ringIndicatorDelayMs=t,tooltip:this._tooltip}}}function ji(t,e,i){return e.projectToScreen(t,Ji),(0,c.s)(i,Ji[0],Ji[1],0)}function Qi(t,e){let i=null,a=1;const n=()=>a;return{start:()=>{a=t.getScale(),i=t.getScale,t.getScale=n,e()},update:t=>(a+=((a+1)/2-a)*Math.min(3*t,1),e(),Math.abs(a-1)<.01?Fi.STOP:Fi.CONTINUE),destroy:()=>{i&&(t.getScale=i),e()}}}function qi(t){switch(t){case"integer":case"long":return 0;default:return null}}!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.STOP=1]="STOP"}(Fi||(Fi={}));const Ji=(0,_.s1)();var $i=i(45238);function Ki(t){return(0,o.pC)(t.geometry)&&"mesh"===t.geometry.type?function(t){return(0,o.pC)(t.transform)?function(t,e){let i=e.clone(),a=null;return{undo:e=>{a=(0,o.pC)(t.transform)?t.transform.clone():null,t.transform=i,e.notifyGeometryChanged()},redo:e=>{i=(0,o.pC)(t.transform)?t.transform.clone():null,t.transform=a,e.notifyGeometryChanged()}}}(t,t.transform):function(t){let e,i=t.vertexAttributes.clonePositional();return{undo:a=>{e=t.vertexAttributes.clonePositional(),t.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=t.vertexAttributes.clonePositional(),t.vertexAttributes=e,a.notifyGeometryChanged()}}}(t)}(t.geometry):function(t){let e=t.geometry,i=o.YP;return{undo(t){i=t.geometry,t.geometry=e},redo(t){e=t.geometry,t.geometry=i}}}(t)}let ta=class extends ee.r{constructor(t){super(t),this._interactionState=null}initialize(){this.addHandles([(0,s.gx)((()=>(0,o.pC)(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null),(t=>{let{interactionState:e}=t;this._updateMeshRotation(e)}),s.Z_),(0,s.gx)((()=>(0,o.pC)(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null),(t=>{let{interactionState:e}=t;this._updateMeshSize(e)}),s.Z_)])}get angle(){const t=this.geometry.transform;if((0,o.Wi)(t))return 0;const e=(0,$i.ZZ)(t.rotation)[2];return Math.abs(e)>.999999?(0,le.Vl)((0,$i.EU)(t.rotation))*Math.sign(e):0}get scale(){return(0,o.pC)(this._interactionState)?this._interactionState.scale:1}startInteraction(){const t=new ea({angle:this.angle});this._interactionState=t;const e=()=>{this._interactionState=null};return{state:t,done:e,cancel:()=>{t.cancel(),e()}}}createUndoRecord(){return Ki(this.graphic)}_updateMeshRotation(t){const e=this.geometry.anchor,i=this.viewingMode===Wi.JY.Global,{angle:a,previousAngle:n}=t;this.geometry.rotate(0,0,(0,le.BV)(a-n),{origin:e,geographic:i}),t.previousAngle=a,(0,o.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(t){const e=this.geometry.anchor,i=this.viewingMode===Wi.JY.Global,{scale:a,previousScale:n}=t;this.geometry.scale(a/n,{origin:e,geographic:i}),t.previousScale=a,(0,o.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,a._)([(0,r.Cb)({constructOnly:!0})],ta.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],ta.prototype,"geometry",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],ta.prototype,"viewingMode",void 0),(0,a._)([(0,r.Cb)()],ta.prototype,"angle",null),(0,a._)([(0,r.Cb)()],ta.prototype,"scale",null),(0,a._)([(0,r.Cb)()],ta.prototype,"_interactionState",void 0),ta=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],ta);let ea=class extends v.Z{get state(){const{angle:t,scale:e}=this;return{angle:t,scale:e}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=t.angle,this.previousAngle=t.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,a._)([(0,r.Cb)()],ea.prototype,"angle",void 0),(0,a._)([(0,r.Cb)()],ea.prototype,"initialAngle",void 0),(0,a._)([(0,r.Cb)()],ea.prototype,"previousAngle",void 0),(0,a._)([(0,r.Cb)()],ea.prototype,"previousScale",void 0),(0,a._)([(0,r.Cb)()],ea.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],ea.prototype,"state",null),ea=(0,a._)([(0,p.j)("InteractionState")],ea);let ia=class extends ee.r{constructor(t){super(t),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,s.gx)((()=>(0,o.pC)(this._interactionState)?this._interactionState.state:null),(t=>{this._updateSymbol(t)}),s.Z_))}get angle(){return(0,o.pC)(this._interactionState)?this._interactionState.angle:(0,o.pC)(this._orientationReferenceSymbolLayer)?function(t){return-(0,le.Vl)(t)}(this._orientationReferenceSymbolLayer.heading??0):0}get scale(){return(0,o.pC)(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,o.pC)(this._interactionState)?this._interactionState.initialAngle:0}get size(){const t=this._sizeReferenceSymbolLayer;if((0,o.Wi)(t))return null;const e=this.findLayerView(),i=this._graphicSymbol;if((0,o.Wi)(e)||(0,o.Wi)(i)||"point-3d"!==i.type)return null;const a=e.getSymbolLayerSize(i,t);if("size"in a&&(0,o.pC)(a.size))return a.size;const n=this.sizeAxis;return"width"in a&&(0,o.pC)(a.width)&&((0,o.Wi)(n)||"width"===n||"all"===n||"width-and-depth"===n)?a.width:"depth"in a&&(0,o.pC)(t.depth)&&((0,o.Wi)(n)||"depth"===n||"all"===n||"width-and-depth"===n)?a.depth:"height"in a&&(0,o.pC)(t.height)&&((0,o.Wi)(n)||"height"===n||"all"===n)?a.height:null}get _sizeReferenceSymbolLayer(){const t=this._graphicSymbol;return(0,o.Wi)(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type))}get _orientationReferenceSymbolLayer(){const t=this._graphicSymbol;return(0,o.Wi)(t)||0===t.symbolLayers.length?null:t.symbolLayers.find((t=>"object"===t.type&&(0,o.pC)(t.heading)))}get _graphicSymbol(){return(0,o.pC)(this.graphic)&&(0,o.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(t){this.graphic.symbol=t}startInteraction(){const t=this._graphicSymbol,e=this.findLayerView();if((0,o.pC)(this._interactionState)||(0,o.Wi)(t)||(0,o.Wi)(e))return aa;const i=t.symbolLayers.map((i=>"object"===i.type?e.getSymbolLayerSize(t,i):null)).toArray(),a=t.clone(),n=this.angle,s=new na({originalSymbol:a,angle:n,initialSizes:i});this._interactionState=s;const r=()=>{this._interactionState=null};return{state:s,done:r,cancel:()=>{this._graphicSymbol=a,r()}}}createUndoRecord(){let t=this.graphic.symbol,e=null;return{undo:i=>{e=i.symbol,i.symbol=t},redo:i=>{t=i.symbol,i.symbol=e}}}_updateSymbol(t){let{scale:e,angle:i,originalSymbol:a,initialSizes:n}=t;const s=this._graphicSymbol;if((0,o.Wi)(s)||"point-3d"!==s.type)return;const r=s.clone(),l=-(0,le.BV)(i-this.initialAngle);let h=!1;this._forEachObjectSymbolLayerPair(a,r,((t,i,a)=>{const s=(0,o.Pt)(t.heading,0)+l;i.heading!==s&&(i.heading=s,h=!0);const r=n[a];if((0,o.pC)(r)&&"width"in r){r.width=this.sizeFilter(r.width),r.height=this.sizeFilter(r.height),r.depth=this.sizeFilter(r.depth);const t=r.width*e;i.width!==t&&(i.width=t,h=!0);const a=r.depth*e;i.depth!==a&&(i.depth=a,h=!0);const n=r.height*e;i.height!==n&&(i.height=n,h=!0)}})),h&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(t,e,i){t.symbolLayers.forEach(((t,a)=>{const n=e.symbolLayers.getItemAt(a);"object"===t.type&&"object"===n.type&&i(t,n,a)}))}};(0,a._)([(0,r.Cb)()],ia.prototype,"angle",null),(0,a._)([(0,r.Cb)()],ia.prototype,"scale",null),(0,a._)([(0,r.Cb)()],ia.prototype,"relativeAngle",null),(0,a._)([(0,r.Cb)()],ia.prototype,"initialAngle",null),(0,a._)([(0,r.Cb)()],ia.prototype,"size",null),(0,a._)([(0,r.Cb)()],ia.prototype,"sizeAxis",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],ia.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)()],ia.prototype,"_interactionState",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],ia.prototype,"findLayerView",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0})],ia.prototype,"sizeFilter",void 0),(0,a._)([(0,r.Cb)()],ia.prototype,"_sizeReferenceSymbolLayer",null),(0,a._)([(0,r.Cb)()],ia.prototype,"_orientationReferenceSymbolLayer",null),(0,a._)([(0,r.Cb)()],ia.prototype,"_graphicSymbol",null),ia=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],ia);const aa={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let na=class extends v.Z{get state(){const{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:n}=this;return{originalSymbol:t,angle:e,initialAngle:i,scale:a,initialSizes:n}}constructor(t){super(t),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=t.angle}};(0,a._)([(0,r.Cb)()],na.prototype,"originalSymbol",void 0),(0,a._)([(0,r.Cb)()],na.prototype,"angle",void 0),(0,a._)([(0,r.Cb)()],na.prototype,"initialAngle",void 0),(0,a._)([(0,r.Cb)()],na.prototype,"initialSizes",void 0),(0,a._)([(0,r.Cb)()],na.prototype,"scale",void 0),(0,a._)([(0,r.Cb)()],na.prototype,"state",null),na=(0,a._)([(0,p.j)("InteractionState")],na);let oa=class extends((0,ee.p)(gt.Z.EventedMixin($e.m))){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new ti.Z,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:t,view:e}=this;this.graphicState=new Xt({graphic:t}),this.addHandles((0,s.YP)((()=>this.tooltipOptions.enabled),(t=>{this._tooltip=t?new ai.u({view:e}):(0,o.SC)(this._tooltip)}),s.tX)),this._moveManipulation=new Fe({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&oe(t),radius:Fe.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))));const i=t=>e=>{this.handles.add(e.events.on("focus-changed",(e=>{let{action:i}=e;const a=this._tooltip;(0,o.Wi)(a)||("focus"===i?this._updateMoveTooltip(t):a.clear())})))};this._moveManipulation.xyManipulation.forEachManipulator(i(je.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(i(je.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(i(je.Z));const a=(0,u.RL)(t);this._moveManipulation.elevationInfo=a;const r=t.geometry;if(this._moveManipulation.createGraphicDragPipeline(((i,n,s,l,h)=>{if((0,o.pC)(r)&&i===je.XY){const{snappingStep:i,cancelSnapping:n}=(0,ii.W)({snappingContext:new ei.N({elevationInfo:a,pointer:h,editGeometryOperations:Ke.c.fromGeometry(new Vi.Z({spatialReference:r.spatialReference}),e.state.viewingMode),visualizer:new k._,excludeFeature:t}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});l=l.next(n),s=s.next((0,Ge.Mz)(this.view,a)).next(...i)}return{steps:s=s.next((t=>(this._updateMoveTooltip(i,t),t))),cancel:l}}),this.graphicState,(t=>{const{action:e,graphic:i,dxScreen:a,dyScreen:n}=t,o={graphic:i,dxScreen:a,dyScreen:n};switch(e){case"start":this.emit("graphic-translate-start",o),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",o);break;case"end":this.emit("graphic-translate-stop",o)}})),this._moveManipulation.angle=(0,o.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,s.YP)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const t=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Xi({tool:this,mode:t,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([be({view:this.view,graphic:this.graphic,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,n.kB)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,s.YP)((()=>e.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((t=>{t instanceof he.Z&&this.handles.add(t.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,o.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,o.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,o.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,o.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,o.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new ta({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new ia({graphic:this.graphic,sizeFilter:t=>this._enforceNonZeroSize(t),findLayerView:()=>this.view.allLayerViews.find((t=>t.layer===this.graphic.layer)),sizeAxis:(0,o.pC)(this.tooltipOptions.visualVariables)&&(0,o.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(t){this._moveManipulation.forEachManipulator(t),(0,o.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(t)}_hideManipulatorsForGraphicState(){return(0,s.YP)((()=>this.graphicState.displaying),(t=>{this._forEachManipulator((e=>e.available=t)),this._moveManipulation.zManipulation.available=t&&this.enableZ&&oe(this.graphic)}))}_createGeometryUndoRecord(){return Ki(this.graphic)}set snapToScene(t){this._moveManipulation&&(this._moveManipulation.snapToScene=t),this._set("snapToScene",t)}get updating(){return this.updatingHandles.updating}set location(t){this._moveManipulation.location=t,(0,o.pC)(this._scaleRotate)&&(this._scaleRotate.location=t)}set elevationAlignedLocation(t){this._moveManipulation.elevationAlignedLocation=t,(0,o.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=t)}reset(){}onHide(){(0,o.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,o.Wi)(this._scaleRotate))return;const t=this._scaleRotate.getScale();this._moveManipulation.displayScale=t}_updateMoveAngle(){this.view.state.viewingMode===Wi.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){(0,ae.u2)(this.view,this,this.graphic)}_enforceNonZeroSize(t){return t||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(t,e){const{tooltipOptions:i,_tooltip:a}=this;if((0,o.Wi)(a))return;a.clear();const n=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(t){case je.XY:a.info=new ni.$E({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,e)=>(0,P.GQ)(t,e,n)));break;case je.XY_AXIS:a.info=new ni.in({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,((t,i)=>{const a=(0,P.GQ)(t,i,n);return(0,ie.bA)(a,ze(e))}));break;case je.Z:a.info=new ni.QW({tooltipOptions:i}),this._updateMoveTooltipDistance(a.info,e,oi._e)}}_updateMoveTooltipDistance(t,e,i){if((0,o.pC)(e)&&"end"!==e.action){const{mapStart:a,mapEnd:n}=e,s=i(a,n);t.distance=(0,o.pC)(s)?s:ie.yP}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,o.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:t=>(0,o.pC)(this._scaleRotate)?this._scaleRotate.test.setRingIndicatorDelayMs(t):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],oa.prototype,"view",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],oa.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],oa.prototype,"enableZ",void 0),(0,a._)([(0,r.Cb)()],oa.prototype,"enableRotation",void 0),(0,a._)([(0,r.Cb)()],oa.prototype,"enableScaling",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:ti.Z})],oa.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)()],oa.prototype,"graphicState",void 0),(0,a._)([(0,r.Cb)({value:!1})],oa.prototype,"snapToScene",null),(0,a._)([(0,r.Cb)({constructOnly:!0})],oa.prototype,"snappingManager",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],oa.prototype,"type",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],oa.prototype,"updating",null),oa=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],oa);var sa=i(82218),ra=i(11582),la=i(46784),ha=i(89125),pa=i(96866);let ca=class extends((0,ra.J)(la.wq)){constructor(t){super(t),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(t){return this.heading===t.heading&&this.tilt===t.tilt&&(0,o._W)(this.position,t.position)&&this.width===t.width&&this.height===t.height}};(0,a._)([(0,r.Cb)({readOnly:!0,json:{read:!1,write:!0}})],ca.prototype,"type",void 0),(0,a._)([(0,r.Cb)({type:Vi.Z}),(0,pa.B)()],ca.prototype,"position",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,pa.B)(),(0,ha.p)((t=>Ni.BV.normalize((0,l.q9)(t),0,!0)))],ca.prototype,"heading",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,pa.B)(),(0,ha.p)((t=>Ni.BV.normalize((0,l.q9)(t),0,!0)))],ca.prototype,"tilt",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0}),(0,pa.B)()],ca.prototype,"width",void 0),(0,a._)([(0,r.Cb)({type:Number,nonNullable:!0}),(0,pa.B)()],ca.prototype,"height",void 0),ca=(0,a._)([(0,p.j)("esri.analysis.SlicePlane")],ca);var da=i(48976),ua=(i(14320),i(40927));(0,m.Z)("mac"),Math.cos((0,le.Vl)(45)),Math.cos((0,le.Vl)(5));const ga=(0,d.f)(1,.5,0),_a=((0,F.b)([...ga,.7]),(0,F.b)([...ga,.5]),(0,F.f)(1,1,1,1)),ma=(0,F.f)(1,.8,.6,1),va=(0,F.f)(1,.93,.86,1),fa=(0,F.b)([...ga,1]),ya=(0,F.b)([...ga,1]),Ma=22.5,ba=40,Sa=(0,F.b)([...ga,1]);(0,Pt.c)();i(37081),i(33559),i(23620),i(93822),i(12594),i(64642),i(11983),i(98634);var wa=i(82144),xa=i(31132),Ca=i(7566),Oa=i(27627),Ea=i(11316),Aa=i(8548),Ta=i(36207);class Ra extends xa.A{initializeProgram(t){return new Oa.$(t.rctx,Ra.shader.get().build(this.configuration),Ca.i)}initializePipeline(){return(0,Ta.sm)({blending:(0,Ta.wK)(Aa.zi.ONE,Aa.zi.ONE,Aa.zi.ONE_MINUS_SRC_ALPHA,Aa.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Aa.wb.LESS},colorWrite:Ta.BK})}}Ra.shader=new wa.J(Ea.S,(()=>i.e(8492).then(i.bind(i,18492))));i(83448),i(29691),i(23470);(0,d.c)();(0,d.c)();i(92028);var Da,Ia=i(81703),Ga=i(24231);i(53866);function Pa(t,e){switch(e){case Da.POSITIVE_X:return{basis:t.basis1,direction:1,position:(0,c.a)(Re.WM.get(),t.origin,t.basis1),edge:e};case Da.POSITIVE_Y:return{basis:t.basis2,direction:1,position:(0,c.a)(Re.WM.get(),t.origin,t.basis2),edge:e};case Da.NEGATIVE_X:return{basis:t.basis1,direction:-1,position:(0,c.b)(Re.WM.get(),t.origin,t.basis1),edge:e};case Da.NEGATIVE_Y:return{basis:t.basis2,direction:-1,position:(0,c.b)(Re.WM.get(),t.origin,t.basis2),edge:e}}}function La(t){const e=(0,c.l)(t.basis1),i=(0,c.l)(t.basis2);return.3*Math.min(e,i)}function za(t){return La(t)}function Va(t){return 0!==t.direction[0]&&0!==t.direction[1]}function Wa(t,e){const i=Va(e),a=i?[(0,d.f)(1,0,0),(0,d.f)(0,0,0),(0,d.f)(0,1,0)]:[(0,d.f)(1,0,0),(0,d.f)(-1,0,0)],n=Sa,o=i?4:1,s=2*o,r=t=>t>1?(t=>new At.U({color:n,width:t,renderOccluded:j.yD.OccludeAndTransparent}))(t):new Ga.Y({color:n,renderOccluded:j.yD.OccludeAndTransparent}),l=[new De.r((0,Yt.rh)(r(o),a),We.Q9.Unfocused|Xa),new De.r((0,Yt.rh)(r(s),a),We.Q9.Focused|Xa),new De.r((0,Yt.rh)(r(1),a),ja)],h=new he.Z({view:t,renderObjects:l,collisionType:{type:"line",paths:[a]},radius:i?6:4,...ae.X9});return h.state=Xa,h}function Na(t,e,i){const a=new Ve.E({color:_a,cullFace:Ut.Vr.Back,renderOccluded:j.yD.Opaque}),n=new Ve.E({color:ma,cullFace:Ut.Vr.Back,renderOccluded:j.yD.Opaque}),o=new Ve.E({color:va,cullFace:Ut.Vr.Back,renderOccluded:j.yD.Opaque}),s=new Ve.E({color:ya,transparent:!0,writeDepth:!1,cullFace:Ut.Vr.Front,renderOccluded:j.yD.Transparent}),r=r=>{t=t.slice(0);const l=(0,c.b)(Re.WM.get(),t[0],t[1]);(0,c.n)(l,l);const h=(0,c.b)(Re.WM.get(),t[t.length-1],t[t.length-2]);if((0,c.n)(h,h),e>0){const i=(0,c.g)((0,d.c)(),h,-e);t[t.length-1]=(0,c.a)(i,i,t[t.length-1]);const a=(0,c.g)((0,d.c)(),l,-e);t[0]=(0,c.a)(a,a,t[0])}const p=r?1.15:1,u=Ma*p,g=11*p,_=(0,Gt.i)(Re.MP.get());if(e>0){const t=u/4,i=(0,c.s)(Re.WM.get(),0,t,0),a=1+e/t;(0,Gt.w)(_,_,i),(0,Gt.k)(_,_,(0,c.s)(Re.WM.get(),a,a,a)),(0,Gt.w)(_,_,(0,c.g)(i,i,-1/a))}const m=(0,Gt.i)((0,Pt.c)()),v=(0,d.f)(0,1,0),f=(0,Gt.F)((0,Pt.c)(),(0,da.r)(Re.vD.get(),v,h));f[12]=t[t.length-1][0],f[13]=t[t.length-1][1],f[14]=t[t.length-1][2],(0,Gt.m)(f,f,_);const y=function(t,e,i){const a=[],n=12;for(let o=0;o<n;o++){const e=o/n*2*Math.PI;a.push([Math.cos(e)*t,Math.sin(e)*t])}return(0,Yt.x2)(i,a,e,[],[],!1)}(3*(r?1.15:1)+e,t,i?s:o);y.transformation=m;const M=[y],b=(0,Yt.QL)(i?s:a,u,g,24,!1,!1,!0);b.transformation=f,M.push(b);const S=(0,Yt.QL)(i?s:n,u,g,24,!1,!0,!1);S.transformation=f,M.push(S);const w=(0,Gt.F)((0,Pt.c)(),(0,da.r)(Re.vD.get(),v,l));return w[12]=t[0][0],w[13]=t[0][1],w[14]=t[0][2],(0,Gt.m)(w,w,_),M.push(b.instantiate({transformation:w})),M.push(S.instantiate({transformation:w})),M};return{normal:r(!1),focused:r(!0)}}function Za(t,e){const i=(0,c.b)((0,d.c)(),t[t.length-1],t[t.length-2]);if((0,c.n)(i,i),(0,c.g)(i,i,Ma),(0,c.a)(i,i,t[t.length-1]),e){const e=(0,c.b)((0,d.c)(),t[0],t[1]);return(0,c.n)(e,e),(0,c.g)(e,e,Ma),(0,c.a)(e,e,t[0]),[e,...t,i]}return[...t,i]}function Ua(t,e){return(0,ua.cp)(e,t.basis2,t.basis1)+Fa}!function(t){t[t.POSITIVE_X=0]="POSITIVE_X",t[t.POSITIVE_Y=1]="POSITIVE_Y",t[t.NEGATIVE_X=2]="NEGATIVE_X",t[t.NEGATIVE_Y=3]="NEGATIVE_Y"}(Da||(Da={}));const Ya=We.jg.Custom1;var Ha,ka;!function(t){t[t.HEADING=1]="HEADING",t[t.TILT=2]="TILT"}(Ha||(Ha={})),function(t){t[t.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.TILTED=3]="TILTED"}(ka||(ka={}));const Ba=We.jg.Custom2,Fa=((0,Ui.Ue)(),Math.PI/2),Xa=We.jg.Custom1,ja=We.jg.Custom2;var Qa;!function(t){t[t.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",t[t.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Qa||(Qa={}));const qa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC";var Ja=i(76873);const $a={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};class Ka{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&(0,o.pC)(this._lastDragEvent)&&(0,o.pC)(this._next)){const e={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(e),this._next.execute(e)}this._enabled=t}createDragEventPipelineStep(){this._lastDragEvent=null;const t=new Ge.hM;return this._next=t,[t=>(this._lastDragEvent="end"!==t.action?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t),t]}_adjustScaleFactors(t){const e=Va(t.handle)?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):0===t.handle.direction[0]?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-e:e,t.factor2=t.factor2<0?-e:e}get test(){return{_adjustScaleFactors:t=>this._adjustScaleFactors(t)}}}var tn=i(34778),en=i(92583),an=i(7068);let nn=class extends(gt.Z.EventedMixin($e.m)){constructor(t){super(t),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new ti.Z,this._preserveAspectRatio=new Ka,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new Ae.Z,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=(0,sa.a)(),this._mapBoundsStart=(0,sa.a)(),this._zmax=0,this._sizeStart=null,this._displayBounds=(0,sa.a)(),this._displayBoundsStart=(0,sa.a)(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,S.a)(),this._endScale=(0,S.a)()}initialize(){const{view:t,graphic:e,manipulators:i,_handles:a}=this,r=this._graphicState=new Xt({graphic:e}),l=e.geometry;this._editGeometryOperations=Ke.c.fromGeometry(l,t.state.viewingMode),this._graphicMoveManipulation=new qe({tool:this,view:t,graphicState:r}),this._moveZManipulator=function(t){const e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qa.CENTER_ON_ARROW)===Qa.CENTER_ON_CALLOUT?ba:0,i=[(0,d.f)(e,0,-24),(0,d.f)(e,0,24)],a=Za(i,!0),n=(t,e)=>Na(i,t,e),o=n(0,!1),s=n(2.25,!0),r=new Ga.Y({color:fa,renderOccluded:j.yD.OccludeAndTransparent}),l=(0,Yt.rh)(r,[[e,0,0],[e-ba,0,0]]),h=(0,Yt.rh)(r,[[e,0,0],[e-ba,0,0]]);return new he.Z({view:t,renderObjects:[...o.normal.map((t=>new De.r(t,We.Q9.Unfocused|Ya))),...s.normal.map((t=>new De.r(t,We.Q9.Unfocused|Ya))),new De.r(l,We.Q9.Unfocused|Ya|Ba),...o.focused.map((t=>new De.r(t,We.Q9.Focused|Ya))),...s.focused.map((t=>new De.r(t,We.Q9.Focused|Ya))),new De.r(h,We.Q9.Focused|Ya|Ba)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[a]},collisionPriority:1,radius:11,state:Ya})}(t,Qa.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Ba,a.add([this._createMoveXYGraphicDragPipeline(),(0,s.YP)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this._moveZManipulator,re.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map((e=>{const i=Wa(t,e);return a.add([(0,s.YP)((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,re.SCALE))),i.events.on("grab-changed",(t=>this._onResizeGrab(t))),this._createResizeDragPipeline(i,e)]),i})),i.addMany(this._resizeManipulators),this._rotateManipulatorTexture=function(t){return t.fromData(qa,(()=>new Ja.x(qa,$a)))}(t.toolViewManager.textures),this._rotateManipulator=(0,ae.Ju)(t,{texture:this._rotateManipulatorTexture.texture}),a.add([(0,s.YP)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this._rotateManipulator,re.ROTATE))),this._rotateManipulator.events.on("grab-changed",(t=>{this._onRotateGrab(t)})),this._createRotateDragPipeline(this._rotateManipulator)]),i.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const h=be({view:t,graphic:e,forEachManipulator:t=>this._forEachManipulator(t),onManipulatorsChanged:()=>(0,n.kB)()});(0,o.pC)(h)&&(this._outlineVisualElement=h.visualElement instanceof Tt?h.visualElement:null),(0,o.pC)(this._outlineVisualElement)&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),a.add(h),a.add([r.on("changed",(()=>this._onGeometryChanged())),(0,s.YP)((()=>r.displaying),(()=>this._updateAllManipulatorAvailability())),(0,s.YP)((()=>r.isDraped),(()=>this._graphicDrapedChanged()),s.nn),t.trackGraphicState(r)]);const p=t.pointsOfInterest;a.add((0,s.YP)((()=>p?.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));this._forEachManipulator((t=>{a.add(t.events.on("grab-changed",(()=>{this.grabbing=t.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((t,i)=>{a.add(t.events.on("immediate-click",(t=>{i===re.TRANSLATE_XY&&this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:t,view:e}=this,i=this._tooltip=new ai.u({view:e}),a=()=>{i.info=this._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(t=>{this._startAngle=t.angle,a()})),this.on("graphic-rotate",(t=>{this._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(t=>{(0,b.s)(this._startScale,t.xScale,t.yScale),(0,b.s)(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(t=>{(0,b.s)(this._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(()=>{(0,b.s)(this._startScale,0,0),(0,b.s)(this._endScale,0,0),a()}))]),this._forEachManipulator((e=>{t.add([e.events.on("focus-changed",a),e.events.on("grab-changed",a),e.events.on("drag",(t=>{"cancel"===t.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some((t=>t.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,o.Pt)(this._moveXYTooltipInfo,(()=>new ni.$E({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const t=this._moveZTooltipInfo=(0,o.Pt)(this._moveZTooltipInfo,(()=>new ni.QW({tooltipOptions:this.tooltipOptions}))),e=this._moveUnit;if(this._moveZManipulator.dragging){const e=this._mapBoundsStart.origin,i=this._mapBounds.origin,a=(0,oi.Cr)(e,i,this.view.spatialReference);if((0,o.Wi)(a))return null;t.distance=a}else t.distance=(0,ie.yG)(0,e);return t}_computeRotateTooltipInfo(){const t=this._rotateTooltipInfo=(0,o.Pt)(this._rotateTooltipInfo,(()=>new an.c({tooltipOptions:this.tooltipOptions})));return t.angle=this._startAngle-this._endAngle,t}_computeScaleTooltipInfo(){const t=this.graphic.geometry;if((0,o.Wi)(t))return null;const e=this._scaleTooltipInfo=(0,o.Pt)(this._scaleTooltipInfo,(()=>new an.p({tooltipOptions:this.tooltipOptions}))),i=(0,en.NI)(this._mapBounds,this._zmax,t.spatialReference,this._graphicState.isDraped);return(0,o.Wi)(i)?null:(e.xSize=i[0],e.ySize=i[1],(0,o.pC)(this._sizeStart)&&this._resizeManipulators.some((t=>t.dragging))?(e.xScale=i[0].value/this._sizeStart[0].value,e.yScale=i[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(on),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",(t=>{(0,o.pC)(this._attachmentOrigin)&&(0,_e.jE)(t.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()})),on)}_updateAllManipulatorAvailability(){this._forEachManipulator(((t,e)=>this._updateManipulatorAvailability(t,e)))}_updateManipulatorAvailability(t,e){const i=this.grabbing&&!t.grabbing;if(t.interactive=!i,t instanceof he.Z){const a=this._graphicState.displaying,n=this.enableZ&&oe(this.graphic);switch(e){case re.ROTATE:t.available=a&&this.enableRotation;break;case re.SCALE:t.available=a&&(this.enableScaling||this.enableRotation||n),t.interactive=!i&&this.enableScaling,t.state=this.enableScaling?Xa:ja;break;case re.TRANSLATE_Z:t.available=a&&n;break;default:t.available=a}}}_forEachManipulator(t){this._graphicMoveManipulation.forEachManipulator(t),this._resizeManipulators.forEach((e=>t(e,re.SCALE))),t(this._rotateManipulator,re.ROTATE),t(this._moveZManipulator,re.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(t){this._preserveAspectRatio.enabled=t,this._set("preserveAspectRatio",t)}get _moveUnit(){return(0,o.Pt)((0,di.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const t=this.graphic.geometry,e=this._editGeometryOperations.data,i=e.components[0].edges[0],a=(0,b.a)(Re.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,b.f)(a,a);const n=(0,o.Pt)((0,ae.du)(this.view,this.graphic),(()=>t.extent?.center));let s=n?rn*this.view.pixelSizeAt(n):0;const r=this.view.spatialReference,l=t.spatialReference;r.equals(l)||(s*=(0,di.c9)(r)/(0,di.c9)(l)),(0,en.lv)(a,e,s,this._mapBounds),this._updateZMax()}_updateZMax(){const t=this._editGeometryOperations.data;if(!t.geometry.hasZ)return void(this._zmax=0);const e=t.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of t.components)for(const t of a.vertices){const a=e.getZ(t.pos)??0;i=Math.max(a,i)}this._zmax=i}_updateDisplayBounds(){const{geometry:t}=this.graphic;if((0,o.Wi)(t))return;const{extent:e}=t;if(!e)return;const i=(0,o.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,o.pC)(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:(0,ae.du)(this.view,this.graphic);this._attachmentOrigin=(0,o.Pt)(i,e.center);const a=(0,o.pC)(i)?i.z:(0,Zt.w7)(this._mapBounds.origin,this.view.elevationProvider,St.o.fromElevationInfo((0,u.RL)(this.graphic)),this.view.renderCoordsHelper),n=(0,sa.c)(this._mapBounds);n.origin[2]=a??0,(0,en.ny)(n,this.view.renderCoordsHelper,t.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const t=this.view.pointsOfInterest,e=t?t.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent?.center;return e?sn*this.view.pixelSizeAt(e):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline(((t,e,i)=>this._applyGraphicMoveSteps(e,i,je.XY)))}_createMoveZDragPipeline(){const t=this.view,e=this._editGeometryOperations.data.spatialReference;return(0,Ge.Xd)(this._moveZManipulator,((i,a,n)=>{const o=(0,d.a)(i.renderLocation),s=a.next((0,Ie.Sp)(t,o,e)).next((0,Ge.zh)());this._applyGraphicMoveSteps(s,n,je.Z)}))}_applyGraphicMoveSteps(t,e,i){const a=t.next((t=>("start"===t.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY})),t))).next((0,Ge.AN)()).next(this._moveDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,dxScreen:t.screenDeltaX,dyScreen:t.screenDeltaY};switch(t.action){case"start":case"update":(t.mapEnd.x-t.mapStart.x||t.mapEnd.y-t.mapStart.y||(t.mapEnd.z??0)-(t.mapStart.z??0))&&this.emit("graphic-translate",e);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",e)}return t})).next((t=>this._updateMoveTooltip(t,i)));return e.next((()=>{(0,o.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_updateOperationStartProperties(){(0,sa.c)(this._displayBounds,this._displayBoundsStart),(0,sa.c)(this._mapBounds,this._mapBoundsStart),(0,o.Wi)(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=(0,en.NI)(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return t=>{if((0,o.Wi)(this.inputState)||"move"!==this.inputState.type)return t;const e=[];for(const n of this._editGeometryOperations.data.components)e.push(...n.vertices);const i="start"===t.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i);return(0,en.nn)(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_updateMoveTooltip(t,e){if(e===je.XY||e===je.XY_AXIS){const e=(0,P.GQ)(t.mapStart,t.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");(0,o.pC)(e)&&(0,o.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=e)}return t}_onResizeGrab(t){let{action:e,screenPoint:i}=t;if("start"!==e||!i)return;const a=this._calculatePickRay(i);(0,gi.BR)(this._displayBounds.plane,a,Re.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(t,e){return(0,Ge.Xd)(t,((t,i,a)=>{(0,o.Wi)(this.inputState)||(i.next((t=>("start"===t.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),t))).next((0,Ie._N)(this.view,this._displayBoundsStart.plane)).next((t=>({...t,handle:e}))).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,xScale:t.factor1,yScale:t.factor2};switch(t.action){case"start":case"update":this.emit("graphic-scale",e);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",e)}return t})),a.next((()=>{(0,o.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return t=>{const e=this._displayBoundsStart,i=t.handle.direction,a=this._displayBoundsMargin,n=this._displayBoundsMarginStart,o=(0,c.c)(Re.WM.get(),e.origin);(0,c.z)(o,o,e.basis1,-i[0]),(0,c.z)(o,o,e.basis2,-i[1]);const s=(0,c.b)(Re.WM.get(),t.renderEnd,o),r=(0,c.b)(Re.WM.get(),t.renderStart,o),l=Va(t.handle),h=za(e),p=za(this._displayBounds)/h,d=(t,e)=>{if(0===t)return 1;let i=(0,c.l)(e),o=.5*t*(0,c.e)(e,s)/i;const h=o<0?-1:1;l&&(o+=(i-.5*t*(0,c.e)(e,r)/i)*h*p);const d=i<1.5*n?1:ln;return i=Math.max(i-n,ln),h>0&&(o-=a),h*Math.max(h*(o/i),d)};return{...t,factor1:d(i[0],e.basis1),factor2:d(i[1],e.basis2)}}}_resizeDragUpdateGeometry(){return t=>{const e=(0,c.c)((0,d.c)(),this._mapBoundsStart.origin);(0,c.z)(e,e,this._mapBoundsStart.basis1,-t.handle.direction[0]),(0,c.z)(e,e,this._mapBoundsStart.basis2,-t.handle.direction[1]);const i=(0,b.s)((0,S.a)(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);(0,b.f)(i,i);const a=[];for(const s of this._editGeometryOperations.data.components)a.push(...s.vertices);const n="start"===t.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS,o=this._editGeometryOperations.scaleVertices(a,e,i,t.factor1,t.factor2,n,tn.w.REPLACE);return(0,sa.c)(this._mapBoundsStart,this._mapBounds),(0,en.nn)(o,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_onRotateGrab(t){let{action:e,screenPoint:i}=t;if("start"!==e||!i)return;const a=function(t,e,i,a){const n=e.worldUpAtPosition(t.origin,Re.WM.get()),o=Re.WM.get();switch(i){case Ha.HEADING:(0,c.c)(o,n);break;case Ha.TILT:(0,c.c)(o,t.basis1)}return(0,gi.Yq)(t.origin,o,a)}(this._displayBounds,this.view.renderCoordsHelper,Ha.HEADING,(0,gi.Ue)()),n=this._calculatePickRay(i);(0,gi.BR)(a,n,Re.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:a})}_createRotateDragPipeline(t){return(0,Ge.Xd)(t,((t,e,i)=>{const a=this.inputState;(0,o.Wi)(a)||(e.next((t=>("start"===t.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),t))).next((0,Ie._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((t=>{const e={graphic:this.graphic,angle:(0,le.BV)(t.rotateAngle)};switch(t.action){case"start":case"update":this.emit("graphic-rotate",e);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",e)}return t})),i.next((()=>{(0,o.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(t){return e=>{const i=(0,gi.mJ)(t.rotatePlane),a=(0,ae.Gd)(e.renderStart,e.renderEnd,this._displayBounds.origin,i);return{...e,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return t=>{const e=(0,c.c)((0,d.c)(),this._mapBoundsStart.origin),i=[];for(const o of this._editGeometryOperations.data.components)i.push(...o.vertices);const a="start"===t.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS,n=this._editGeometryOperations.rotateVertices(i,e,t.rotateAngle,a,tn.w.REPLACE);return(0,sa.c)(this._mapBoundsStart,this._mapBounds),(0,en.nn)(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,t}}_calculatePickRay(t){const e=(0,Ui.Ue)(),i=(0,_.md)(t);return(0,Ia.u4)(this.view.state.camera,i,e),(0,c.n)(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const t=function(t,e){return(0,ae.Aq)(t.basis1,t.basis2,t.origin,e)}(this._displayBounds,Re.MP.get());(function(t,e,i,a){const n=a.worldUpAtPosition(i.origin,Re.WM.get()),o=Pa(i,Da.POSITIVE_X),s=(0,Gt.b)(Re.MP.get(),o.edge*Math.PI/2);(0,Gt.r)(s,s,-Ua(i,n)),(0,Gt.m)(s,e,s),s[12]=0,s[13]=0,s[14]=0,t.modelTransform=s,t.renderLocation=o.position})(this._rotateManipulator,t,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,t),this._resizeManipulators.forEach(((e,i)=>{!function(t,e,i,a){const n=(0,c.l)(a.basis1),o=(0,c.l)(a.basis2),s=La(a),r=za(a),l=(0,c.s)(Re.WM.get(),0,0,0);(0,c.a)(l,(0,c.g)(Re.WM.get(),a.basis1,e.direction[0]),(0,c.g)(Re.WM.get(),a.basis2,e.direction[1])),(0,c.a)(l,a.origin,l);let h=0,p=1;if(Va(e))1===e.direction[0]&&-1===e.direction[1]?h=Fa:1===e.direction[0]&&1===e.direction[1]?h=Math.PI:-1===e.direction[0]&&1===e.direction[1]&&(h=3*Math.PI/2),p=r;else{const t=0!==e.direction[0]?1:2;h=1===t?Fa:0,p=(1===t?o:n)-s}const d=(0,Gt.b)(Re.MP.get(),h);(0,Gt.k)(d,d,(0,c.s)(Re.WM.get(),p,p,p)),(0,Gt.m)(d,i,d),d[12]=0,d[13]=0,d[14]=0,t.modelTransform=d,t.renderLocation=l}(e,this._resizeHandles[i],t,this._displayBounds)}))}_updateZMoveHandle(t,e){const i=this._displayBounds,a={basis:i.basis1,direction:-1,position:(0,c.b)(Re.WM.get(),i.origin,i.basis1),edge:2},n=Re.MP.get();(0,Gt.o)(n,e,a.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,t.modelTransform=n,t.renderLocation=a.position}_cancel(){const t=this._editGeometryOperations.lastOperation;(0,o.Wi)(t)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,en.mO)(t,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if((0,o.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const t=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,en.mO)((0,o.Wg)(t),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const t=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,en.nn)((0,o.Wg)(t),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],nn.prototype,"view",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],nn.prototype,"graphic",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,nonNullable:!0})],nn.prototype,"enableZ",void 0),(0,a._)([(0,r.Cb)()],nn.prototype,"enableRotation",void 0),(0,a._)([(0,r.Cb)()],nn.prototype,"enableScaling",void 0),(0,a._)([(0,r.Cb)({constructOnly:!0,type:ti.Z})],nn.prototype,"tooltipOptions",void 0),(0,a._)([(0,r.Cb)()],nn.prototype,"preserveAspectRatio",null),(0,a._)([(0,r.Cb)()],nn.prototype,"grabbing",void 0),(0,a._)([(0,r.Cb)()],nn.prototype,"inputState",void 0),(0,a._)([(0,r.Cb)({readOnly:!0})],nn.prototype,"type",void 0),(0,a._)([(0,r.Cb)()],nn.prototype,"_moveUnit",null),nn=(0,a._)([(0,p.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],nn);const on="draped-elevation-changes",sn=10,rn=80,ln=1e-6},79685:(t,e,i)=>{i.d(e,{Y:()=>v});var a=i(92026),n=i(88396),o=i(11186),s=i(71353),r=i(67077),l=i(83448),h=i(79803),p=i(50951),c=i(91526),d=i(79100),u=i(88699),g=i(73840),_=i(95774),m=i(4760);function v(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=[],n=[],o=e.mapPositions;f(e,n,a);const s=n[0][1].data,r=a[0][1].length,l=new Array(r).fill(0);return y(e,n,a,l),S(e,n,a,l),M(e,n,a,l),b(e,n,a,l),w(e,n,a,l),x(e,n,a,l),C(e,n,a,s),new _.Z(t,n,a,o,d.U.Line,i)}function f(t,e,i){const{attributeData:{position:a},removeDuplicateStartEnd:n}=t,o=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(a)&&n,s=a.length/3-(o?1:0),r=new Array(2*(s-1)),l=o?a.slice(0,a.length-3):a;let h=0;for(let p=0;p<s-1;p++)r[h++]=p,r[h++]=p+1;e.push([m.T.POSITION,new c.a(l,3,o)]),i.push([m.T.POSITION,r])}function y(t,e,i,n){if((0,a.pC)(t.attributeData.colorFeature))return;const o=t.attributeData.color;e.push([m.T.COLOR,new c.a((0,a.Pt)(o,r.O),4)]),i.push([m.T.COLOR,n])}function M(t,e,i,n){if(!(0,a.pC)(t.attributeData.normal))return;const o=t.attributeData.normal;e.push([m.T.NORMAL,new c.a(o,3)]),i.push([m.T.NORMAL,n])}function b(t,e,i,n){const o=t.attributeData.colorFeature;(0,a.Wi)(o)||(e.push([m.T.COLORFEATUREATTRIBUTE,new c.a([o],1,!0)]),i.push([m.T.COLOR,n]))}function S(t,e,i,n){if((0,a.pC)(t.attributeData.sizeFeature))return;const o=t.attributeData.size;e.push([m.T.SIZE,new c.a([(0,a.Pt)(o,1)],1,!0)]),i.push([m.T.SIZE,n])}function w(t,e,i,n){const o=t.attributeData.sizeFeature;(0,a.Wi)(o)||(e.push([m.T.SIZEFEATUREATTRIBUTE,new c.a([o],1,!0)]),i.push([m.T.SIZEFEATUREATTRIBUTE,n]))}function x(t,e,i,n){const o=t.attributeData.opacityFeature;(0,a.Wi)(o)||(e.push([m.T.OPACITYFEATUREATTRIBUTE,new c.a([o],1,!0)]),i.push([m.T.OPACITYFEATUREATTRIBUTE,n]))}function C(t,e,i,s){if((0,a.Wi)(t.overlayInfo)||t.overlayInfo.renderCoordsHelper.viewingMode!==p.JY.Global||!t.overlayInfo.spatialReference.isGeographic)return;const r=(0,u.bg)(s.length),d=(0,l.Iu)(t.overlayInfo.spatialReference);for(let a=0;a<r.length;a+=3)(0,h.gH)(s,a,r,a,d);const _=s.length/3,v=(0,g.xx)(_+1);let f=O,y=E,M=0,b=0;(0,o.s)(f,r[b++],r[b++],r[b++]),v[0]=0;for(let a=1;a<_+1;++a)a===_&&(b=0),(0,o.s)(y,r[b++],r[b++],r[b++]),M+=(0,n.p)(f,y),v[a]=M,[f,y]=[y,f];e.push([m.T.DISTANCETOSTART,new c.a(v,1,!0)]),i.push([m.T.DISTANCETOSTART,i[0][1]])}const O=(0,s.c)(),E=(0,s.c)()},78081:(t,e,i)=>{i.d(e,{V:()=>h,r:()=>p});var a=i(92026),n=i(79803),o=i(91320),s=i(69691),r=i(19653),l=i(88699);function h(t,e,i,a){const n="polygon"===t.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,r="polygon"===t.type?t.rings:t.paths,{position:h,outlines:p}=(0,o.Mk)(r,!!t.hasZ,n),d=(0,l.bg)(h.length),u=(0,s.rR)(h,t.spatialReference,0,d,0,h,0,h.length/3,e,i,a),g=null!=u;return{lines:g?c(p,h,d):[],projectionSuccess:g,sampledElevation:u}}function p(t,e){const i="polygon"===t.type?o.ZI.CCW_IS_HOLE:o.ZI.NONE,a="polygon"===t.type?t.rings:t.paths,{position:s,outlines:l}=(0,o.Mk)(a,!1,i),h=(0,n.CM)(s,t.spatialReference,0,s,e,0,s.length/3);for(let n=2;n<s.length;n+=3)s[n]=r.Rn;return{lines:h?c(l,s):[],projectionSuccess:h}}function c(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=new Array;for(const{index:o,count:s}of t){if(s<=1)continue;const t=3*o,r=3*s;n.push({position:(0,l.Rq)(e,3*o,3*s),mapPositions:(0,a.pC)(i)?(0,l.Rq)(i,t,r):void 0})}return n}},86700:(t,e,i)=>{i.d(e,{Dp:()=>r,z5:()=>s});var a=i(92026);const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null};function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return{pattern:[t,t],pixelRatio:e}}function r(t){return(0,a.pC)(t)&&"style"===t.type?function(t){return(0,a.pC)(t)?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(0,a.Wi)(t)?t:{pattern:t.slice(),pixelRatio:e}}(o[t],8):null}(t.style):null}},7068:(t,e,i)=>{i.d(e,{c:()=>l,p:()=>h});var a=i(27366),n=i(47898),o=i(49861),s=i(69912),r=i(4943);let l=class extends r.h{constructor(t){super(t),this.type="extent-rotate",this.angle=0}};(0,a._)([(0,o.Cb)()],l.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],l.prototype,"angle",void 0),l=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],l);let h=class extends r.h{constructor(t){super(t),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=n.yP,this.ySize=n.yP}};(0,a._)([(0,o.Cb)()],h.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],h.prototype,"xScale",void 0),(0,a._)([(0,o.Cb)()],h.prototype,"yScale",void 0),(0,a._)([(0,o.Cb)()],h.prototype,"xSize",void 0),(0,a._)([(0,o.Cb)()],h.prototype,"ySize",void 0),h=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],h)},40524:(t,e,i)=>{i.d(e,{$E:()=>l,QW:()=>h,c1:()=>u,in:()=>p,j:()=>d,nk:()=>c});var a=i(27366),n=i(47898),o=i(49861),s=i(69912),r=i(4943);let l=class extends r.h{constructor(t){super(t),this.type="translate-graphic",this.distance=n.yP}};(0,a._)([(0,o.Cb)()],l.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],l.prototype,"distance",void 0),l=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],l);let h=class extends r.h{constructor(t){super(t),this.type="translate-graphic-z",this.distance=n.yP}};(0,a._)([(0,o.Cb)()],h.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],h.prototype,"distance",void 0),h=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.TranslateGraphicZTooltipInfo")],h);let p=class extends r.h{constructor(t){super(t),this.type="translate-graphic-xy",this.distance=n.yP}};(0,a._)([(0,o.Cb)()],p.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],p.prototype,"distance",void 0),p=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.TranslateGraphicXYTooltipInfo")],p);let c=class extends r.h{constructor(t){super(t),this.type="translate-vertex",this.distance=n.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,o.Cb)()],c.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],c.prototype,"distance",void 0),(0,a._)([(0,o.Cb)()],c.prototype,"elevation",void 0),(0,a._)([(0,o.Cb)()],c.prototype,"area",void 0),(0,a._)([(0,o.Cb)()],c.prototype,"totalLength",void 0),c=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],c);let d=class extends r.h{constructor(t){super(t),this.type="translate-vertex-z",this.distance=n.yP,this.elevation=null}};(0,a._)([(0,o.Cb)()],d.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],d.prototype,"distance",void 0),(0,a._)([(0,o.Cb)()],d.prototype,"elevation",void 0),d=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.TranslateVertexZTooltipInfo")],d);let u=class extends r.h{constructor(t){super(t),this.type="translate-vertex-xy",this.distance=n.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,o.Cb)()],u.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],u.prototype,"distance",void 0),(0,a._)([(0,o.Cb)()],u.prototype,"elevation",void 0),(0,a._)([(0,o.Cb)()],u.prototype,"area",void 0),(0,a._)([(0,o.Cb)()],u.prototype,"totalLength",void 0),u=(0,a._)([(0,s.j)("esri.views.interactive.tooltip.TranslateVertexXYTooltipInfo")],u)},92028:(t,e,i)=>{i.d(e,{D:()=>o});var a=i(72619),n=i(50951);function o(t,e){return null!=t&&(null==e||(e===n.JY.Local?!t.isGeographic||t.isWGS84||t.wkid===a.W.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===a.W.CGCS2000||t.wkid===a.W.GCSMARS2000||t.wkid===a.W.GCSMARS2000_SPHERE||t.wkid===a.W.GCSMOON2000))}}}]);
//# sourceMappingURL=5207.06bc1189.chunk.js.map