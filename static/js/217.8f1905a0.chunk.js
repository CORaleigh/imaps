(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[217],{1181:function(e,t,i){},1395:function(e,t,i){"use strict";i.r(t),i.d(t,"PropertyPanel",(function(){return d}));var r=i(1),l=i(91);const n=e=>{const t=e.map((e=>e.getAttribute("PIN_NUM"))),i=new URL(window.location.toString());if(t){i.searchParams.set("pin",t.toString());const e={pin:t.toString()};history.state?history.state.pin!=e.pin&&history.pushState({pin:t.toString()},"",i.href):history.pushState({pin:t.toString()},"",i.href)}else history.replaceState(history.state,"",i.href)};i(1181);var o=i(0);const s=Object(r.lazy)((()=>Promise.all([i.e(3),i.e(4),i.e(13),i.e(19),i.e(93)]).then(i.bind(null,1400)))),a=Object(r.lazy)((()=>Promise.all([i.e(1),i.e(2),i.e(3),i.e(4),i.e(67)]).then(i.bind(null,1401)))),c=Object(r.lazy)((()=>Promise.all([i.e(3),i.e(4),i.e(13),i.e(19),i.e(106)]).then(i.bind(null,1382)))),d=e=>{const t=Object(r.useRef)({pin:""}),i=Object(r.useRef)(null),d=Object(r.useRef)(null),[u,p]=Object(r.useState)(!1),[b,v]=Object(r.useState)(!0),[f,h]=Object(r.useState)(),y=Object(r.useRef)(),[j,m]=Object(r.useState)("OBJECTID IS NULL"),[g,O]=Object(r.useState)("OBJECTID IS NULL"),[S,I]=Object(r.useState)(),[N,E]=Object(r.useState)("list"),[P,w]=Object(r.useState)(!1),[U,T]=Object(r.useState)(),C=Object(r.useRef)(),[A,M]=Object(r.useState)(),[R,x]=Object(r.useState)(!1),L=e=>{const t=document.querySelector(`calcite-tab-title[tab=${e}]`),i=new KeyboardEvent("keydown",{altKey:!1,bubbles:!0,cancelable:!0,charCode:0,code:"Enter",composed:!0,ctrlKey:!1,detail:0,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1});t.dispatchEvent(i),w(!0)},k=()=>{v(!0),y.current=void 0,e.featureSelected(void 0),m("OBJECTID IS NULL"),L("list"),E("list"),e.propertiesSelected([]);const t=null===f||void 0===f?void 0:f.graphics.filter((e=>"buffer"===e.getAttribute("type")));(null===t||void 0===t?void 0:t.length)&&(null===f||void 0===f||f.graphics.removeMany(t))};return Object(r.useEffect)((()=>{if(!u){(e=>{I(e.map.allTables.find((e=>e.title.includes("Condo")&&"feature"===e.type))),T(e.map.allTables.find((e=>e.title.includes("Address")&&"feature"===e.type))),M(e.map.allLayers.find((e=>e.title.includes("Property")&&"feature"===e.type))),p(!0),h(e)})(e.view),document.querySelectorAll("calcite-tab-nav").forEach((e=>{e.addEventListener("calciteTabChange",(e=>{w(0===e.detail.tab||"list"===e.detail.tab)}))})),document.querySelectorAll("calcite-tab").forEach((e=>{const t=new MutationObserver((e=>{if(e.length){var i;const r=null===(i=e[0].target)||void 0===i?void 0:i.shadowRoot;r&&(r.innerHTML+="<style>:host([active]) section { display: block !important; visibility: visible !important;} section {display: block !important; visiblity: hidden !important;}</style>"),t.disconnect()}else t.disconnect()}));e.innerHTML="<style>:host([active]) {display: block !important; visibility: visible !important;} :host { display: block; visibility: hidden !important;} calcite-tab {display: block !important; z-index: 1; visibility: hidden !important;} calcite-tab[active] { z-index: 100; visibility: visible !important;;} </style>",t.observe(e,{attributes:!0})})),window.addEventListener("popstate",(e=>{var i,r,l,n,o;(null===(i=e.state)||void 0===i?void 0:i.pin)===(null===(r=t.current)||void 0===r?void 0:r.pin)?history.back():(null===(l=e.state)||void 0===l?void 0:l.pin.length)>0&&(O(`PIN_NUM in ('${decodeURIComponent(null===(n=history.state)||void 0===n?void 0:n.pin.split(",").join("','"))}')`),m(`PIN_NUM in ('${decodeURIComponent(null===(o=history.state)||void 0===o?void 0:o.pin.split(",").join("','"))}')`));t.current=e.state}));const i=new URL(document.URL).searchParams.get("pin");i&&i.length>0&&(O(`PIN_NUM in ('${decodeURIComponent(i.split(",").join("','"))}')`),m(`PIN_NUM in ('${decodeURIComponent(i.split(",").join("','"))}')`))}}),[]),Object(r.useEffect)((()=>{((e,t,i)=>l.c(((r,l)=>{void 0!=i&&(null===t||void 0===t||t.queryFeatures({geometry:i,outFields:["OBJECTID","REID","PIN_NUM"],returnGeometry:!0,outSpatialReference:null===e||void 0===e?void 0:e.spatialReference}).then((e=>{const i=e.features.map((e=>e.getObjectId()));t.queryRelatedFeatures({relationshipId:0,objectIds:i,outFields:["*"]}).then((t=>{const n=[],o=[];i.forEach((e=>{var i;null===(i=t[e])||void 0===i||i.features.forEach((e=>{n.push(e.getAttribute("OBJECTID")),o.push(e)}))})),n.length?r({where:`OBJECTID in (${n.toString()})`,features:o,properties:e.features}):l()}))})))})))(f,A,e.geometry).then((t=>{if(void 0!=e.geometry){if(x(!0),m(t.where),C.current=t.properties,1===t.features.length){var i,r;const l=t.features[0];l.layer=S,l.popupTemplate=null===S||void 0===S?void 0:S.popupTemplate;const o=t.features[0];o.geometry=null===(i=t.properties)||void 0===i||null===(r=i.find((e=>e.getAttribute("PIN_NUM")===o.getAttribute("PIN_NUM"))))||void 0===r?void 0:r.geometry,y.current=o,e.featureSelected(o),v(!1),n([o]),L("info"),E("info")}else n([]),v(!0),y.current=void 0,L("list"),E("list");e.propertiesSelected(t.properties)}else k()})).catch((()=>{k()}))}),[e.geometry,e.propertiesSelected,e.featureSelected,e.selectedProperties]),Object(o.jsxs)("div",{className:"panel",id:"propertyPanel",children:[u&&Object(o.jsx)(r.Suspense,{fallback:"",children:Object(o.jsx)(s,{view:f,condosTable:S,addressTable:U,propertyLayer:A,where:g,clear:k,searchComplete:t=>{var i;t.feature||1===t.features.length?(y.current=t.features[0],e.featureSelected(t.features[0]),v(!1),n([t.features[0]]),L("info"),E("info")):(n([]),v(!0),y.current=void 0,L("list"),E("list"));const r=null===t||void 0===t?void 0:t.features.map((e=>e.getAttribute("OBJECTID")));m(`OBJECTID in (${r.toString()})`),C.current=t.properties,null===(i=e.selectedProperties)||void 0===i||i.forEach((e=>{e.setAttribute("selected",0)})),e.propertiesSelected(C.current);const l=e.view.graphics.filter((e=>"buffer"===e.getAttribute("type")));e.view.graphics.removeMany(l)}})}),Object(o.jsxs)("calcite-tabs",{position:"below",layout:"center",children:[Object(o.jsxs)("calcite-tab-nav",{slot:"tab-nav",children:[Object(o.jsx)("calcite-tab-title",{tab:"list",active:!0,ref:d,children:"List"}),Object(o.jsx)("calcite-tab-title",{tab:"info",ref:i,disabled:b?"true":null,children:"Info"})]}),Object(o.jsx)("calcite-tab",{tab:"list",children:u&&Object(o.jsx)(r.Suspense,{fallback:"",children:Object(o.jsx)(c,{view:f,layer:S,filter:j,loading:R,reloadTable:P,selectedTab:N,featureSelected:t=>{if(t){var i,r,l,o,s;null===(i=C.current)||void 0===i||i.forEach((e=>{(null===e||void 0===e?void 0:e.getAttribute("PIN_NUM"))!=(null===t||void 0===t?void 0:t.getAttribute("PIN_NUM"))&&(null===e||void 0===e||e.setAttribute("selected",0))}));const a=null===(r=C.current)||void 0===r?void 0:r.find((e=>(null===e||void 0===e?void 0:e.getAttribute("PIN_NUM"))===(null===t||void 0===t?void 0:t.getAttribute("PIN_NUM"))));null===a||void 0===a||a.setAttribute("selected",1),null===(l=C.current)||void 0===l||l.splice(null===(o=C.current)||void 0===o?void 0:o.indexOf(a),1),null===(s=C.current)||void 0===s||s.push(a),t.geometry=null===a||void 0===a?void 0:a.geometry,null===f||void 0===f||f.goTo(t.geometry,{duration:1e3,easing:"ease"}),y.current=t,e.featureSelected(t),v(!1),e.propertiesSelected(C.current),n([t]),L("info"),E("info")}}})})}),Object(o.jsx)("calcite-tab",{tab:"info",children:u&&Object(o.jsx)(r.Suspense,{fallback:"",children:Object(o.jsx)(a,{view:f,feature:y.current})})})]})]})};t.default=d}}]);
//# sourceMappingURL=217.8f1905a0.chunk.js.map