"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[9212],{32500:(e,t,i)=>{i.d(t,{I:()=>b,b:()=>y});var r=i(92026),s=i(6394),n=i(37081),a=i(33280),o=i(94951),c=i(15226),l=i(26461),d=i(116),h=i(82552),u=i(82999),p=i(58406),_=i(98634),g=i(64201),f=i(19253),m=i(25920),v=i(4760);function y(e){const t=new g.kG,{vertex:i,fragment:y}=t;return(0,h.Sv)(i,e),t.include(o.w,e),t.attributes.add(v.T.POSITION,"vec3"),t.attributes.add(v.T.UV0,"vec2"),t.varyings.add("vpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.uniforms.add(new u.A("textureCoordinateScaleFactor",(e=>(0,r.pC)(e.texture)&&(0,r.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:s.O))),i.code.add(_.H`
    void main(void) {
      vpos = position;
      ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(a.f5,e),t.include(c.l,e),y.uniforms.add([new f.A("tex",(e=>e.texture)),new p.p("opacity",(e=>e.opacity))]),t.varyings.add("vTexCoord","vec2"),e.output===n.H.Alpha?y.code.add(_.H`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${_.H.float(l.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(y.include(d.Y),y.code.add(_.H`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${_.H.float(l.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.transparencyPassType===m.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const b=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}))},18300:(e,t,i)=>{i.d(t,{L:()=>m,b:()=>_});var r=i(14226),s=i(81949),n=i(88396),a=i(6394),o=i(8084),c=i(82999),l=i(58406),d=i(98634),h=i(8654),u=i(64201),p=i(4760);function _(e){const t=new u.kG;t.include(o.j,e);const{vertex:i,fragment:s}=t;return i.uniforms.add([new h.g("modelView",((e,t)=>(0,r.w)(f,t.camera.viewMatrix,e.origin))),new h.g("proj",((e,t)=>t.camera.projectionMatrix)),new l.p("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new c.A("pixelToNDC",((e,t)=>(0,n.s)(g,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])))]),t.attributes.add(p.T.START,"vec3"),t.attributes.add(p.T.END,"vec3"),t.attributes.add(p.T.UP,"vec3"),t.attributes.add(p.T.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add(d.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),s.uniforms.add(new l.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),s.code.add(d.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const g=(0,a.a)(),f=(0,s.c)(),m=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},83671:(e,t,i)=>{i.d(t,{L:()=>M,b:()=>P,d:()=>w});var r=i(16889),s=i(88396),n=i(6394),a=i(11186),o=i(71353),c=i(90045),l=i(67077),d=i(85981),h=i(55652),u=i(23470),p=i(8084),_=i(24967),g=i(82999),f=i(49450),m=i(95276),v=i(58406),y=i(98634),b=i(64201);const w=(0,r.Vl)(6);function P(e){const t=new b.kG;t.extensions.add("GL_OES_standard_derivatives"),t.include(_.k),t.include(p.j,e);const i=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(i.uniforms.add(new v.p("maxPixelDistance",((t,i)=>e.heightManifoldEnabled?2*i.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*i.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),i.code.add(y.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.spherical){const e=(e,t,i)=>(0,a.m)(e,t.heightManifoldTarget,i.camera.viewMatrix),t=(e,t)=>(0,a.m)(e,[0,0,0],t.camera.viewMatrix);i.uniforms.add([new m.N("heightManifoldOrigin",((i,r)=>(e(E,i,r),t(x,r),(0,a.b)(x,x,E),(0,a.n)(O,x),O[3]=(0,a.l)(x),O))),new f.J("globalOrigin",((e,i)=>t(E,i))),new v.p("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,a.i)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,a.l)(e.heightManifoldTarget)))]),i.code.add(y.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else i.code.add(y.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(e.pointDistanceEnabled&&(i.uniforms.add(new v.p("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),i.code.add(y.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),e.intersectsLineEnabled&&(i.uniforms.add(new v.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),i.code.add(y.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add(y.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),i.code.add(y.H`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled){i.uniforms.add([new g.A("angleCutoff",(e=>S(e))),new m.N("heightPlane",((e,t)=>R(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,E),t.camera.viewMatrix)))]);const t=e.spherical?y.H`normalize(globalOrigin - pos)`:y.H`heightPlane.xyz`;i.code.add(y.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${t})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return e.pointDistanceEnabled&&(i.uniforms.add([new g.A("angleCutoff",(e=>S(e))),new m.N("pointDistanceSphere",((e,t)=>function(e,t){return(0,a.m)(L,e.pointDistanceOrigin,t.camera.viewMatrix),L[3]=(0,a.i)(e.pointDistanceOrigin,e.pointDistanceTarget),L}(e,t)))]),i.code.add(y.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),e.lineVerticalPlaneEnabled&&(i.uniforms.add([new g.A("angleCutoff",(e=>S(e))),new m.N("lineVerticalPlane",((e,t)=>function(e,t){const i=(0,d.KU)(e.lineVerticalPlaneSegment,.5,E),r=e.renderCoordsHelper.worldUpAtPosition(i,T),s=(0,a.n)(x,e.lineVerticalPlaneSegment.vector),n=(0,a.f)(O,r,s);return(0,a.n)(n,n),R(e.lineVerticalPlaneSegment.origin,n,t.camera.viewMatrix)}(e,t))),new f.J("lineVerticalStart",((e,t)=>function(e,t){const i=(0,a.c)(E,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(i,0),(0,a.m)(i,i,t.camera.viewMatrix)}(e,t))),new f.J("lineVerticalEnd",((e,t)=>function(e,t){const i=(0,a.a)(E,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(i,0),(0,a.m)(i,i,t.camera.viewMatrix)}(e,t)))]),i.code.add(y.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),e.intersectsLineEnabled&&(i.uniforms.add([new g.A("angleCutoff",(e=>S(e))),new f.J("intersectsLineStart",((e,t)=>(0,a.m)(E,e.lineStartWorld,t.camera.viewMatrix))),new f.J("intersectsLineEnd",((e,t)=>(0,a.m)(E,e.lineEndWorld,t.camera.viewMatrix))),new f.J("intersectsLineDirection",((e,t)=>((0,a.c)(O,e.intersectsLineSegment.vector),O[3]=0,(0,a.n)(E,(0,c.t)(O,O,t.camera.viewMatrix))))),new v.p("intersectsLineRadius",(e=>e.intersectsLineRadius))]),i.code.add(y.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),i.code.add(y.H`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}function S(e){return(0,s.s)(D,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,r.Vl)(2))))}function R(e,t,i){return(0,a.m)(A,e,i),(0,a.c)(O,t),O[3]=0,(0,c.t)(O,O,i),(0,h.Yq)(A,O,C)}const D=(0,n.a)(),E=(0,o.c)(),O=(0,l.c)(),T=(0,o.c)(),x=(0,o.c)(),A=(0,o.c)(),C=(0,h.Ue)(),L=(0,u.c)(),M=Object.freeze(Object.defineProperty({__proto__:null,build:P,defaultAngleCutoff:w},Symbol.toStringTag,{value:"Module"}))},72511:(e,t,i)=>{i.d(t,{S:()=>w,b:()=>v});var r=i(67077),s=i(43505),n=i(37081),a=i(33280),o=i(94951),c=i(15226),l=i(26461),d=i(116),h=i(82552),u=i(49450),p=i(95276),_=i(98634),g=i(64201),f=i(25920),m=i(4760);function v(e){const t=new g.kG,i=e.hasMultipassTerrain&&(e.output===n.H.Color||e.output===n.H.Alpha);t.include(o.w,e),t.include(s.A,e),t.include(a.f5,e);const{vertex:r,fragment:v}=t;return v.include(d.Y),(0,h.Sv)(r,e),v.uniforms.add(new p.N("uColor",(e=>e.color))),t.attributes.add(m.T.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(m.T.OFFSET,"vec3"),e.shadingEnabled&&((0,h._8)(r),t.attributes.add(m.T.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),r.code.add(_.H`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&r.code.add(_.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),r.code.add(_.H`
    ${i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),i&&t.include(c.l,e),v.code.add(_.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?(v.uniforms.add(new u.J("shadingDirection",(e=>e.shadingDirection))),v.uniforms.add(new p.N("shadedColor",(e=>y(e.shadingTint,e.color)))),v.code.add(_.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):v.code.add(_.H`vec4 finalColor = uColor;`),v.code.add(_.H`
      ${e.output===n.H.ObjectAndLayerIdColor?_.H`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${_.H.float(l.b)}) {
        discard;
      }
      ${e.output===n.H.Alpha?_.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===n.H.Color?_.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.transparencyPassType===f.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}function y(e,t){const i=1-e[3],r=e[3]+t[3]*i;return 0===r?(b[3]=r,b):(b[0]=(e[0]*e[3]+t[0]*t[3]*i)/r,b[1]=(e[1]*e[3]+t[1]*t[3]*i)/r,b[2]=(e[2]*e[3]+t[2]*t[3]*i)/r,b[3]=t[3],b)}const b=(0,r.c)(),w=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},151:(e,t,i)=>{function r(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function a(){return r()}function o(){return n(1,1,1,1)}function c(){return n(1,0,0,0)}function l(){return n(0,1,0,0)}function d(){return n(0,0,1,0)}function h(){return n(0,0,0,1)}i.d(t,{c:()=>s,f:()=>n});const u=a(),p=o(),_=c(),g=l(),f=d(),m=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:m,UNIT_X:_,UNIT_Y:g,UNIT_Z:f,ZEROS:u,clone:s,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:n,ones:o,unitW:h,unitX:c,unitY:l,unitZ:d,zeros:a},Symbol.toStringTag,{value:"Module"}))},35284:(e,t,i)=>{i.d(t,{Z:()=>L});i(59486);var r=i(41644),s=i(91505),n=i(16889),a=i(92026),o=i(17842),c=i(23879),l=i(22753),d=i(11873),h=i(14226),u=i(81949),p=i(88396),_=i(11186),g=i(71353),f=i(83448),m=i(79803),v=i(65156),y=i(85981),b=i(55652),w=i(40885),P=i(11185),S=i(37818),R=i(77648),D=i(81703),E=i(86755),O=i(66327),T=i(78485),x=i(97882),A=i(99034),C=i(585);class L{constructor(e){this.metadata=void 0,this._camera=new E.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,u.c)(),this._worldFrame=null,this._renderLocation=(0,g.c)(),this._renderLocationDirty=!0,this._location=new C.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new C.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=A.jg.None,this._focused=!1,this.events=new s.Z.EventEmitter,this._screenLocation={screenPointArray:(0,o.s1)(),renderScreenPointArray:(0,o.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference;for(const i in e)this[i]=e[i];const t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,c.IH)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){M(e)&&(this._screenLocationDirty=!0),(0,h.c)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,u.c)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,h.i)(i),!0;case"global":{const r=(0,f.Iu)(e.renderCoordsHelper.spatialReference);(0,m.PR)(t,0,H,0,r.radius),(0,m.yH)((0,n.Vl)(H[0]),(0,n.Vl)(H[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,S.WG)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,S.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=(0,a.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,S.D)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,M(this._modelTransform)){const t=this._calculateModelTransformOffset(k);e=(0,_.a)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=(0,o.md)(e,V),s=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,p.k)(this.screenLocation.screenPointArray,i)<s*s)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,F),c=s*this.screenLocation.pixelSize,l=(0,D.u4)(this._camera,i,z);if((0,a.Wi)(l))return null;for(const i of e){if(0===i.length)continue;const e=(0,_.m)(H,i[0],r);for(let t=1;t<i.length;t++){const s=(0,_.m)(N,i[t],r),a=(0,y.Gr)((0,y.zk)(e,s,j),l);if(null!=a&&a<c*c){const t=(0,_.a)(P.WM.get(),e,s);(0,_.g)(t,t,.5);const i=(0,o.So)(P.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+n}(0,_.c)(e,s)}}break}case"disc":{const e=this.collisionType.direction,t=this.collisionType.offset??g.Z,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,F),c=s*this.screenLocation.pixelSize,d=(0,D.u4)(this._camera,i,z);if((0,a.Wi)(d))return null;const h=(0,l.f)(G,o),u=(0,_.t)(q,e,h),p=(0,_.m)(B,t,o);(0,b.Yq)(p,u,I);const f=U;if((0,b.BR)(I,d,f)&&(0,_.d)(f,p)<c*c)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(r,F),d=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),h=(0,D.u4)(this._camera,i,z);if((0,a.Wi)(h))return null;const u=(0,l.f)(G,c),p=(0,_.t)(q,t,u),g=this._calculateModelTransformPosition(B);(0,b.Yq)(g,p,I);const f=U;if(!(0,b.BR)(I,h,f))break;for(const i of e){if(0===i.length)continue;const e=(0,_.m)(H,i[0],c);for(let t=1;t<i.length;t++){const r=(0,_.m)(N,i[t],c),s=(0,y.Jk)((0,y.zk)(e,r,j),f);if(null!=s&&s<d*d){const t=(0,_.a)(P.WM.get(),e,r);(0,_.g)(t,t,.5);const i=(0,o.So)(P.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+n}(0,_.c)(e,r)}}break}default:(0,r.Bg)(this.collisionType)}return null}attach(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};const t=this._stage;if(!t)return;const i=e.manipulator3D;if((0,a.Wi)(i.engineLayerId)){const e=new x.F({pickable:!1,updatePolicy:T.j.SYNC});t.add(e),i.engineLayerId=e.id,this._engineLayer=e}else t?.getObject&&(this._engineLayer=t.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,(0,a.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,m.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new C.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}}).manipulator3D;e.engineLayerReferences--;const t=0===e.engineLayerReferences;t&&(e.engineLayerId=null),this._removeResourcesFromStage(t),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,m.nF)(this.location,Z,e.spatialReference)&&(0,v.Qn)(e.extent,Z)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if((0,a.Wi)(this.elevationInfo))return;let e=null,t=0;const i=(0,a.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":e=(0,a.Pt)((0,R.KO)(this.view.elevationProvider,this.location,"ground"),0);break;case"relative-to-ground":t=(0,a.Pt)((0,R.KO)(this.view.elevationProvider,this.location,"ground"),0)+i;break;case"relative-to-scene":t=(0,a.Pt)((0,R.KO)(this.view.elevationProvider,this.location,"scene"),0)+i;break;case"absolute-height":t=i}return t!==this._elevation.offset||e!==this._elevation.override?(this._elevation.offset=t,void(this._elevation.override=e)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=F;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?A.Q9.Focused:A.Q9.Unfocused)|(this.selected?A.Q9.Selected:A.Q9.Unselected),s=this._noDisplayCount>0;for(const{stateMask:n,objects:a}of i){if(s){for(const e of a)e.visible=!1;continue}const e=(n&A.Q9.All)!==A.Q9.None,i=(n&A.jg.All)!==A.jg.None,o=!e||(r&n)==(n&A.Q9.All),c=!i||(this.state&n)==(n&A.jg.All);if(o&&c)for(const r of a)r.visible=!0,r.transformation=t;else for(const t of a)t.visible=!1}}_ensureEngineResources(){if((0,a.Wi)(this._engineResources)){const e=(0,a.Wg)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((e=>{let{geometry:{material:r}}=e;i.has(r)||(t.push(r),i.add(r))}));const r=new Map;this._renderObjects.forEach((e=>{const t=new O.T({castShadow:!1,geometries:[e.geometry]}),i=r.get(e.stateMask)||[];i.push(t),r.set(e.stateMask,i)}));const s=[];r.forEach(((e,t)=>s.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:s,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||(0,a.Wi)(this._engineResources)||!e)return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;r.forEach((t=>{const i=(0,a.Wg)(this._materialIdReferences),r=i.get(t.id)||0;0===r&&e.add(t),i.set(t.id,r+1)})),t.forEach((t=>{let{objects:r}=t;i.addMany(r),e.addMany(r)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this._stage;if(!this._engineResourcesAddedToStage||(0,a.Wi)(this._engineResources)||!t)return;const{objectsByState:i,layer:r,materials:s}=this._engineResources;i.forEach((e=>{let{objects:i}=e;r.removeMany(i),t.removeMany(i)})),s.forEach((e=>{const i=(0,a.Wg)(this._materialIdReferences),r=i.get(e.id);1===r?(t.remove(e),i.delete(e.id)):i.set(e.id,r-1)})),e&&t.remove(r),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,W);return(0,_.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,_.b)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,h.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,h.m)(t,t,this._worldFrame),(0,h.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,(0,a.pC)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if((0,a.pC)(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function M(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const V=(0,o.s1)(),j=(0,y.Ue)(),z=(0,w.Ue)(),G=(0,d.c)(),W=(0,u.c)(),F=(0,u.c)(),I=(0,b.Ue)(),H=(0,g.c)(),N=(0,g.c)(),U=(0,g.c)(),q=(0,g.c)(),B=(0,g.c)(),k=(0,g.c)(),Z=new C.Z({x:0,y:0,z:0,spatialReference:null})},40508:(e,t,i)=>{i.d(t,{r:()=>s});var r=i(99034);class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.Q9.None;this.geometry=e,this.stateMask=t}}},45134:(e,t,i)=>{i.d(t,{_:()=>K});var r=i(51995),s=(i(93169),i(42537)),n=i(92026),a=i(11186),o=i(71353),c=i(79803),l=i(74509),d=i(97411),h=i(94172),u=i(17842),p=i(88396),_=i(6394),g=i(90045),f=i(151),m=i(65618),v=i(62921),y=i(19653),b=i(70619),w=i(56529),P=i(39077),S=i(4760),R=i(58901);class D extends v.i{constructor(e){super(e),this._location=(0,o.c)(),this._direction=(0,o.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,f.f)(1,0,1,1),this._renderOccluded=w.yD.OccludeAndTransparent,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,a.k)(this._location,e)||((0,a.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,a.k)(this._direction,e)||((0,a.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,a.n)(this._direction,(0,a.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,g.g)(e,this._color)||((0,g.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new R.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0,e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[r,s]=this._createGeometries(e);t.addGeometry(r),t.addGeometry(s),i.push(r),i.push(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new R.U(this.materialParameters),t=(0,h.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.material.dispose()}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);this._updateVerticesDraped(t);const i=t.map((e=>new P.z(e,{boundingInfo:e.boundingInfo})));for(const r of i)r.computeBoundingSphere(r.transformation,r.boundingSphere);return i}_createGeometries(e){return[(0,b.rh)(e,[(0,o.c)(),(0,o.c)()]),(0,b.rh)(e,[(0,o.c)(),(0,o.c)()])]}_updateMaterial(){const{materialParameters:e}=this;(0,n.WG)(this.object3dResources.resources)?.material.setParameters(e),(0,n.WG)(this.drapedResources.resources)?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=(0,n.WG)(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,A),(0,a.a)(E,this.location,this.direction),t.projectToScreen(E,C),(0,p.f)(C,(0,p.a)(C,C,A)),this._updateVertexAttributesObject3D(t,e,0,A,C,1),this._updateVertexAttributesObject3D(t,e,1,A,C,-1)}_updateVertexAttributesObject3D(e,t,i,r,s,n){const a=t.geometries[i],o=a.getMutableAttribute(S.T.POSITION)?.data;if(!o)return;const{start:c,end:l}=this._computeStartEnd(s,r,n,this.offset,this.width,this.length);e.unprojectFromScreen((0,u.c$)(c),E),o[0]=E[0],o[1]=E[1],o[2]=E[2],e.unprojectFromScreen((0,u.c$)(l),E),o[3]=E[0],o[4]=E[1],o[5]=E[2],t.geometryVertexAttrsUpdated(a)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:r,width:s,length:a,offset:o}=this,c=L;c.spatialReference=(0,n.Wg)(t.renderer.spatialReference),c.x=r[0],c.y=r[1];const l=t.overlayPixelSizeInMapUnits(c)*i,d=s*l,h=a*l,u=o*l;this._updateVertexAttributesDraped(e[0],d,h,u,-1),this._updateVertexAttributesDraped(e[1],d,h,u,1)}_updateVertexAttributesDraped(e,t,i,r,s){const n=e.getMutableAttribute(S.T.POSITION)?.data;if(!n)return;const{location:a,direction:o}=this,{start:c,end:l}=this._computeStartEnd(o,a,s,r,t,i);n[0]=c[0],n[1]=c[1],n[2]=y.Rn,n[3]=l[0],n[4]=l[1],n[5]=y.Rn,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,r,s,n){const a=(0,p.b)(O,(0,p.s)(O,e[1]*i,e[0]*-i),r+s/2),o=(0,p.j)(T,(0,p.j)(T,(0,p.j)(T,t,(0,p.b)(T,e,n/2)),a),a);return{start:o,end:(0,p.j)(x,o,(0,p.b)(x,e,-n))}}}const E=(0,o.c)(),O=(0,_.a)(),T=(0,_.a)(),x=(0,_.a)(),A=(0,u.s1)(),C=(0,u.s1)(),L=(0,m.Tx)(0,0,void 0,null);var M=i(66730),V=i(14226),j=i(81949),z=i(67077),G=i(11185),W=i(91526),F=i(95774),I=i(66832);class H extends v.i{constructor(e){super(e),this._maxSize=0,this._position=(0,o.c)(),this._up=(0,o.c)(),this._right=(0,o.c)(),this._renderOccluded=w.yD.OccludeAndTransparent,this._color=(0,z.f)(1,0,0,1),this._outlineColor=(0,z.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=w.yD.Opaque,this.applyProps(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,g.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,g.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:r}=e;this._maxSize=Math.min((0,a.i)(i,t),(0,a.i)(i,r))/3,(0,a.n)(this._up,(0,a.b)(this._up,t,i)),(0,a.n)(this._right,(0,a.b)(this._right,r,i)),(0,a.c)(this._position,i),this.recreateGeometry()}_createObject3DResources(e){const t=new I.E(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new R.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_destroyObject3DResources(e){e.quadMaterial.dispose(),e.outlineMaterial?.dispose()}_createObject3DGeometries(e,t,i){if((0,a.k)(this._up,o.Z)&&(0,a.k)(this._right,o.Z))return;const r=this._createGeometries(t,i);for(const s of r)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new I.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new R.U(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new P.z(e,{boundingInfo:e.boundingInfo})));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,h.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[],e.outlineMaterial?.dispose(),e.quadMaterial.dispose()}_createGeometries(e,t){const{up:i,right:r,corner:s}=this._getVertices(),n=this._quadGeometryData(i,r,s,e);return t?[n,(0,b.rh)(t,[i,s,r])]:[n]}_getVertices(){let e=this._up,t=this._right;const i=(0,a.a)(G.WM.get(),e,t);return this.isDraped&&(e=(0,a.c)(G.WM.get(),e),t=(0,a.c)(G.WM.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.WG)(this.object3dResources.object);if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);(0,V.f)(N,this._position),(0,V.k)(N,N,[r,r,r]),e.transformation=N}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:r,_size:s}=this,o=(0,a.c)(G.WM.get(),r);o[2]=y.Rn;const c=U;c.spatialReference=(0,n.Wg)(t.renderer.spatialReference),c.x=o[0],c.y=o[1];const l=s*(t.overlayPixelSizeInMapUnits(c)*i),d=Math.min(this._maxSize,l);(0,V.f)(N,o),(0,V.k)(N,N,[d,d,1]);for(const n of e)n.updateTransformation((e=>{(0,V.c)(e,N)}))}_quadGeometryData(e,t,i,r){return new F.Z(r,[[S.T.POSITION,new W.a([0,0,0,...t,...e,...i],3,!0)]],[[S.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){(0,n.WG)(this.object3dResources.resources)?.quadMaterial.setParameters(this._quadMaterialParameters),(0,n.WG)(this.drapedResources.resources)?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){(0,n.WG)(this.object3dResources.resources)?.outlineMaterial?.setParameters(this._outlineMaterialParameters),(0,n.WG)(this.drapedResources.resources)?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const N=(0,j.c)(),U=(0,m.Tx)(0,0,void 0,null);var q=i(26279),B=i(76014),k=i(80371),Z=i(1700),$=i(64674),Y=i(38561),J=i(53397),Q=i(11208);class K extends Y.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof J.w?t.length:0)-(e instanceof J.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:n}=t;return(0,s.ed)(new M.L({view:n,primitive:"circle",geometry:(0,Z.SH)(e.intersectionPoint,i),elevationInfo:e.isDraped?l.tR:l.jG,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:r.Z.toUnitRGBA(B.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:i,spatialReference:n}=t,a=this._alignPoint(e.point,e.domain,t);return(0,s.ed)(new M.L({view:i,primitive:"circle",geometry:(0,Z.SH)(a,n),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:r.Z.toUnitRGBA(B.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:i,spatialReference:r}=t,n=this._alignPoint(e.lineStart,e.domain,t),a=this._alignPoint(e.lineEnd,e.domain,t);return(0,s.ed)(this._createLineSegmentHint(e.type,n,a,r,this._hintElevationInfo(e,t),i,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:n}=t,{isDraped:o}=e,c=this._hintElevationInfo(e,t),l=this._alignPoint(e.lineStart,e.domain,t),d=this._alignPoint(e.lineEnd,e.domain,t),h=X(l,n,c,i,o),u=X(d,n,c,i,o),p=(0,a.h)(u,h,u,.5),_=new D({view:i,attached:!1,offset:B.c.parallelLineHintOffset,length:B.c.parallelLineHintLength,width:B.c.parallelLineHintWidth,color:r.Z.toUnitRGBA(B.c.orange),location:p,renderOccluded:o?w.yD.OccludeAndTransparent:w.yD.Opaque,isDraped:o,renderGroup:q.eZ.SnappingHint});return _.setDirectionFromPoints(h,p),_.attached=!0,(0,s.ed)(_)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:n}=t,a=this._hintElevationInfo(e,t),{isDraped:o}=e,c=this._alignPoint(e.previousVertex,e.domain,t),l=this._alignPoint(e.centerVertex,e.domain,t),d=this._alignPoint(e.nextVertex,e.domain,t),h=X(c,n,a,i,o),u=X(l,n,a,i,o),p=X(d,n,a,i,o);return(0,s.ed)(new H({view:i,attached:!0,color:o?r.Z.toUnitRGBA(B.c.orangeTransparent):r.Z.toUnitRGBA(B.c.orange),renderOccluded:o?w.yD.OccludeAndTransparent:w.yD.Transparent,outlineRenderOccluded:o?w.yD.OccludeAndTransparent:w.yD.Opaque,outlineColor:r.Z.toUnitRGBA(B.c.orange),outlineSize:B.c.rightAngleHintOutlineSize,size:B.c.rightAngleHintSize,isDraped:o,geometry:{previous:h,center:u,next:p},renderGroup:q.eZ.SnappingHint}))}_createLineSegmentHint(e,t,i,s,n,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];const h=X(t,s,n,a,o),u=X(i,s,n,a,o),p=new d.V({view:a,extensionType:d.n.FADED,start:h,end:u,isDraped:o,color:r.Z.toUnitRGBA(B.c.orange),renderOccluded:o?w.yD.OccludeAndTransparent:w.yD.Opaque,renderGroup:q.eZ.SnappingHint});switch(e){case $.ze.TARGET:p.width=B.c.lineHintWidthTarget,p.fadedExtensions={start:0,end:B.c.lineHintFadedExtensions};break;case $.ze.REFERENCE_EXTENSION:p.width=B.c.lineHintWidthReference,p.fadedExtensions={start:0,end:0};break;case $.ze.REFERENCE:p.width=B.c.lineHintWidthReference,p.fadedExtensions={start:c?B.c.lineHintFadedExtensions:0,end:l?B.c.lineHintFadedExtensions:0}}return p.attached=!0,p}_alignPoint(e,t,i){const r=this._getSelfSnappingZ(t,i);return(0,n.Wi)(r)?e:(0,Z.$G)(e[0],e[1],r)}_hintElevationInfo(e,t){return(0,n.pC)(this._getSelfSnappingZ(e.domain,t))?(0,n.Wg)(t.selfSnappingZ).elevationInfo:e.isDraped?l.tR:l.jG}_getSelfSnappingZ(e,t){let{selfSnappingZ:i}=t;return e===k.B.SELF&&(0,n.pC)(i)?i.value:null}}function X(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,o.c)();if(s){const i=r.basemapTerrain.overlayManager.renderer.spatialReference;(0,c.SH)(e,t,n,i)}else(0,Q.RS)(e,t,i,r,n);return n}},51328:(e,t,i)=>{i.d(t,{G:()=>S,J4:()=>T,Sp:()=>E,VG:()=>R,_N:()=>y,_y:()=>D,bB:()=>b,cx:()=>r,gv:()=>x,zP:()=>O});var r,s=i(92026),n=i(17842),a=i(11186),o=i(71353),c=i(79803),l=i(55652),d=i(40885),h=i(40927),u=i(11185),p=i(74509),_=i(81703),g=i(88153),f=i(54463),m=i(76783),v=i(74229);function y(e,t){return w(e,(()=>t))}function b(e){return w(e,(e=>e.plane))}function w(e,t){const i=(0,o.c)(),r=(0,o.c)();let a=!1;return o=>{const c=t(o);if("start"===o.action){const t=(0,n.md)(o.screenStart,(0,n.c$)(u.qW.get())),r=(0,_.u4)(e.state.camera,t,L);(0,s.pC)(r)&&(a=(0,l.BR)(c,r,i))}if(!a)return null;const d=(0,n.md)(o.screenEnd,(0,n.c$)(u.qW.get())),h=(0,_.u4)(e.state.camera,d,L);return(0,s.Wi)(h)?null:(0,l.BR)(c,h,r)?{...o,renderStart:i,renderEnd:r,plane:c,ray:h}:null}}function P(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null;return l=>{if("start"===l.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen((0,n.s1)(l.screenStart.x,l.screenStart.y),t,i,a),(0,s.pC)(o)&&(0,s.pC)(r)&&!(0,c.nF)(o,o,r)))return null;if((0,s.Wi)(o))return null;const d=e.sceneIntersectionHelper.intersectElevationFromScreen((0,n.s1)(l.screenEnd.x,l.screenEnd.y),t,i,a);return(0,s.pC)(d)?(0,s.pC)(r)&&!(0,c.nF)(d,d,r)?null:{...l,mapStart:o,mapEnd:d}:null}}function S(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return P(e,i,(0,p.Ou)(t,e,i),r,s)}function R(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return S(e,i,(0,p.RL)(t),r,s)}function D(e,t,i,r){const n=t.toMap(e.screenStart,{include:[i]});return(0,s.pC)(n)?R(t,i,n,r):null}function E(e,t,i){let r=null;const s=new v.hM;return s.next(y(e,function(e,t){const i=A,r=C,s=(0,l.Ue)();e.renderCoordsHelper.worldUpAtPosition(t,i);const n=(0,a.f)(s,i,(0,a.b)(r,t,e.state.camera.eye));return(0,a.f)(n,n,i),(0,l.Yq)(t,n,s)}(e,t))).next(function(e,t){const i=(0,o.c)(),r=(0,a.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const s=(0,o.c)(),n=(0,o.c)(),c=s=>((0,a.b)(s,s,t),(0,h.nF)(i,s,s),"global"===e.viewingMode&&(0,a.l)(s)*Math.sign((0,a.e)(i,s))<.001-r&&(0,a.b)(s,(0,a.g)(s,i,.001),t),(0,a.a)(s,s,t),s);return e=>(e.renderStart=c((0,a.c)(s,e.renderStart)),e.renderEnd=c((0,a.c)(n,e.renderEnd)),e)}(e,t)).next(O(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e})),e=>(r=null,s.execute(e),r)}function O(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,t),n=i.fromRenderCoords(e.renderEnd,t);return(0,s.pC)(r)&&(0,s.pC)(n)?{...e,mapStart:r,mapEnd:n}:null}}function T(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,s.pC)(t)&&(t.remove(),t=null)}return i}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=(0,g.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=f.eC.MIN,i.options.hud=!1;const a=(0,n.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,o.c)(),d=(0,s.Pt)(t,e.spatialReference),h=t=>{e.map.ground&&e.map.ground.opacity<1?c.exclude.add(m.cy):c.exclude.delete(m.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,n.md)(t,a),i,c);const s=i.results.min;let o;if(s.getIntersectionPoint(l))o=s.intersector===f.q7.TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(l))return null;o=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,d),surfaceType:o}};let u;return e=>{if("start"===e.action){const t=h(e.screenStart);u=(0,s.pC)(t)?t.location:null}if((0,s.Wi)(u))return null;const t=h(e.screenEnd);return(0,s.pC)(t)&&(0,s.pC)(t.location)?{...e,mapStart:u,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(r||(r={}));const A=(0,o.c)(),C=(0,o.c)(),L=(0,d.Ue)()},30036:(e,t,i)=>{i.d(t,{Gd:()=>te,Aq:()=>ie,EA:()=>Y,qJ:()=>J,Ju:()=>K,aD:()=>X,du:()=>re,u2:()=>se,X9:()=>ee});var r=i(92026),s=i(14226),n=i(11186),a=i(71353),o=i(67077),c=i(11185),l=i(37818),d=i(35284),h=i(40508),u=i(96387),p=i(91526),_=i(68401),g=i(95774),f=i(70619),m=i(56529),v=i(4760),y=i(66832),b=i(37081),w=i(17363),P=i(78041),S=i(93822),R=i(12594),D=i(64642),E=i(11983),O=i(27366),T=(i(98634),i(82144)),x=i(31132),A=i(33559),C=i(7566),L=i(27627),M=i(50411),V=i(25920),j=i(8883),z=i(32500),G=i(8548),W=i(36207);class F extends x.A{initializeProgram(e){return new L.$(e.rctx,F.shader.get().build(this.configuration),C.i)}_setPipelineState(e,t){const i=this.configuration,r=e===V.A.NONE,s=e===V.A.FrontFace;return(0,W.sm)({blending:i.output!==b.H.Color&&i.output!==b.H.Alpha||!i.transparent?null:r?I:(0,P.j7)(e),culling:(0,W.zp)(i.cullFace),depthTest:{func:(0,P.Bh)(e)},depthWrite:r?i.writeDepth?W.LZ:null:(0,P.K5)(e),colorWrite:W.BK,stencilWrite:i.hasOccludees?M.s3:null,stencilTest:i.hasOccludees?t?M.eD:M.RY:null,polygonOffset:r||s?null:(0,P.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}F.shader=new T.J(z.I,(()=>i.e(8957).then(i.bind(i,18957))));const I=(0,W.if)(G.zi.ONE,G.zi.ONE_MINUS_SRC_ALPHA);class H extends j.W{constructor(){super(...arguments),this.output=b.H.Color,this.cullFace=_.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=V.A.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,O._)([(0,A.o)({count:b.H.COUNT})],H.prototype,"output",void 0),(0,O._)([(0,A.o)({count:_.Vr.COUNT})],H.prototype,"cullFace",void 0),(0,O._)([(0,A.o)()],H.prototype,"hasSlicePlane",void 0),(0,O._)([(0,A.o)()],H.prototype,"transparent",void 0),(0,O._)([(0,A.o)()],H.prototype,"enableOffset",void 0),(0,O._)([(0,A.o)()],H.prototype,"writeDepth",void 0),(0,O._)([(0,A.o)()],H.prototype,"hasOccludees",void 0),(0,O._)([(0,A.o)({count:V.A.COUNT})],H.prototype,"transparencyPassType",void 0),(0,O._)([(0,A.o)()],H.prototype,"hasMultipassTerrain",void 0),(0,O._)([(0,A.o)()],H.prototype,"cullAboveGround",void 0);class N extends E.c{constructor(e){super(e,new q),this.supportsEdges=!0,this._configuration=new H}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<P.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,t){return(t===b.H.Color||t===b.H.Alpha||t===b.H.Highlight)&&(e===S.r.DRAPED_MATERIAL||(t===b.H.Highlight?e===S.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?S.r.TRANSPARENT_MATERIAL:S.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:S.r.OPAQUE_MATERIAL)))}createGLMaterial(e){return new U(e)}createBufferWriter(){return new R.G(D.W1)}}class U extends w.F{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(F,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==b.H.Color&&this._output!==b.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class q extends m.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=_.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}var B=i(24231),k=i(58901),Z=i(11606),$=i(99034);function Y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.yD.OccludeAndTransparent,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=(0,o.f)(e[0],e[1],e[2],e.length>3?e[3]:1),s=e[3]<1;return i?new Z.Q({color:r,transparent:s,writeDepth:!0,cullFace:_.Vr.Back,renderOccluded:t}):new y.E({color:r,transparent:s,writeDepth:!0,cullFace:_.Vr.Back,renderOccluded:t})}function J(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.yD.OccludeAndTransparent;const i=(0,o.f)(e[0],e[1],e[2],4===e.length?e[3]:1);return new y.E({color:i,transparent:!0,writeDepth:!0,cullFace:_.Vr.Front,renderOccluded:t})}const Q=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:(0,a.f)(1,.5,0)});function K(e,t){const i=new d.Z({view:e,autoScaleRenderObjects:!1,collisionPriority:1,metadata:t.metadata});return function(e,t){const i=t.material??new N({transparent:!0,writeDepth:!1,textureId:t.texture?.id,renderOccluded:m.yD.Opaque}),r=t.focusMultiplier??Q.focusMultiplier,s=t.calloutLength??Q.calloutLength,n=Q.discRadius*(t.discScale??1),a=n*r,c=(e,t)=>{const i=[0,1,2,2,3,0];return new g.Z(t,[[v.T.POSITION,new p.a([s-e,-e,0,s+e,-e,0,s+e,e,0,s-e,e,0],3,!0)],[v.T.UV0,new p.a([0,0,1,0,1,1,0,1],2,!0)]],[[v.T.POSITION,i],[v.T.UV0,i]])},l=Q.calloutColor,d=t.calloutWidth??Q.calloutWidth,u=new(d>1?k.U:B.Y)({width:d,color:(0,o.f)(l[0],l[1],l[2],t.calloutOpacity??1),renderOccluded:m.yD.OccludeAndTransparent}),_=(0,f.rh)(u,[[0,0,0],[s-n,0,0]]),y=(0,f.rh)(u,[[0,0,0],[s-a,0,0]]),b=t.customStateMask??$.jg.None;e.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},e.focusMultiplier=r,e.metadata=t.metadata,e.radius=n,e.renderObjects=[new h.r(c(n,i),$.Q9.Unfocused|b),new h.r(_,$.Q9.Unfocused|b),new h.r(c(a,i),$.Q9.Focused|b),new h.r(y,$.Q9.Focused|b)]}(i,t),i}function X(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$.jg.None;const s=Y((0,o.f)(t[0],t[1],t[2],null!=i?i:1)),n=[new h.r((0,f.PI)(s,1,32,32),r)];return new d.Z({view:e,renderObjects:n})}const ee=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function te(e,t,i,r){const a=(0,n.b)(c.WM.get(),e,i),o=ie(a,(0,n.f)(c.WM.get(),r,a),i,c.MP.get());(0,s.a)(o,o);const l=(0,n.m)(c.WM.get(),t,o);return Math.atan2(l[1],l[0])}function ie(e,t,i,r){const s=(0,n.n)(c.WM.get(),e),a=(0,n.n)(c.WM.get(),t),o=(0,n.f)(c.WM.get(),s,a);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=o[0],r[9]=o[1],r[10]=o[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function re(e,t){const i=e.getViewForGraphic(t);return(0,r.pC)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function se(e,t,i){const s=re(e,i);(0,r.pC)(s)?t.elevationAlignedLocation=s:function(e,t){if((0,r.Wi)(t))return;const i="mesh"===t.type?t.anchor:(0,u.zE)(t);(0,r.Wi)(i)||(e.location=(0,l.kB)(i))}(t,i.geometry)}},62921:(e,t,i)=>{i.d(t,{i:()=>f});var r=i(27366),s=i(85015),n=i(79056),a=i(92026),o=i(49861),c=(i(25243),i(63780),i(69912)),l=i(26279),d=i(78289),h=i(78485);class u{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=l.eZ.Outline}destroy(){this._destroyResources()}get resources(){return(0,a.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;const t=(0,a.WG)(this._resources)?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?(0,a.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,a.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory.createResources(),t=new p({view:this._resourceFactory.view,renderGroup:this._renderGroup}),i=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new p({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if((0,a.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const e=this._resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,a.Wi)(this._resources)||(0,a.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,d.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,a.Wi)(this._resources)||(0,a.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,d.T.UPDATE),this._resources.geometriesAdded=!0)}}let p=class extends((0,n.IG)(s.Z)){constructor(e){super(e),this.drapeSourceType=l.Lw.Features,this.updatePolicy=h.j.SYNC,this.renderGroup=l.eZ.Outline}};(0,r._)([(0,o.Cb)({constructOnly:!0})],p.prototype,"view",void 0),(0,r._)([(0,o.Cb)({readOnly:!0})],p.prototype,"drapeSourceType",void 0),(0,r._)([(0,o.Cb)()],p.prototype,"renderGroup",void 0),p=(0,r._)([(0,c.j)("DrapedVisualElementLayerView")],p);var _=i(86244),g=i(63825);class f extends _.l{constructor(e){let{view:t,isDraped:i}=e;super(t),this._isDraped=!1,this.object3dResources=new g.O(this.createObject3DResourceFactory(t)),this.drapedResources=new u(this.createDrapedResourceFactory(t)),this.isDraped=i??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},97411:(e,t,i)=>{i.d(t,{V:()=>b,n:()=>D});i(93169);var r=i(92026),s=i(11186),n=i(71353),a=i(90045),o=i(151),c=i(70444),l=i(95773),d=i(85981),h=i(40885),u=i(62921),p=i(62389),_=i(19653),g=i(70619),f=i(56529),m=i(39077),v=i(4760),y=i(58901);class b extends u.i{constructor(e){super(e),this._ray=(0,h.Ue)(),this._isWorldDown=!1,this._start=(0,n.c)(),this._end=(0,n.f)(1,0,0),this._width=1,this._color=(0,o.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,o.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=D.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=f.yD.OccludeAndTransparent,this._fadedExtensions=O,this._laserline=new p.W({view:this.view}),this.applyProps(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,s.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,s.b)(this._end,e,this._end),(0,h.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,s.k)(this._start,e)||((0,s.c)(this._start,e),(0,h.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,s.k)(this._end,e)||((0,s.c)(this._end,e),(0,h.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,a.g)(e,this._color)||((0,a.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,a.g)(e,this._innerColor)||((0,a.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,r.pC)(e)!==(0,r.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,r.Wi)(e)||(0,r.Wi)(this._stippleOffColor)||!(0,a.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,r.pC)(e)?(0,o.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,r.pC)(this._laserlineStyle)&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,(0,r.pC)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===f.yD.OccludeAndTransparentStencil?f.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,r.Pt)(e,O),this.recreateGeometry()}_updateMaterial(){const{materialParameters:e}=this;(0,r.WG)(this.object3dResources.resources)?.material.setParameters(e),(0,r.WG)(this.drapedResources.resources)?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new y.U(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[],e.material.dispose()}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const r=this._createGeometry(e);i.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new y.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);this._updateVerticesDraped(t);const i=new m.z(t,{boundingInfo:t.boundingInfo});return i.computeBoundingSphere(i.transformation,i.boundingSphere),i}_createGeometry(e){const t=this.extensionType===D.FADED,i=t?[(0,n.c)(),(0,n.c)(),(0,n.c)(),(0,n.c)()]:[(0,n.c)(),(0,n.c)()];return(0,g.rh)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=(0,r.WG)(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===D.FADED?this._updateLineSegmentFinite(R):this._updateLineSegmentInfinite(this._extensionType,R)}_updateLineSegmentFinite(e){return(0,d.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,c.iL)(this._ray,w),e){case D.LINE:w.c0=-Number.MAX_VALUE;break;case D.RAY:case D.GROUND_RAY:{const e=this._ray.origin,t=(0,r.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,s.o)(w.ray.direction,w.ray.direction),this._extensionType===D.GROUND_RAY&&null!=t&&(w.c1=Math.abs(i-t));break}}if(!(0,l.zq)(i.frustum,w))return this._updateLineSegmentFinite(t);const n=(0,c.Ws)(w,P),a=(0,c.S$)(w,S);return(0,d.zk)(n,a,t)}_updateVertexAttributesObject3D(e,t){const i=e.geometries[0].getMutableAttribute(v.T.POSITION)?.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=s[2];e.geometryVertexAttrsUpdated(e.geometries[0])}_updateVertexAttributesDraped(e,t){const i=e.getMutableAttribute(v.T.POSITION)?.data;if(!i)return;let r=0;for(const s of this._lineVertices(t))i[r++]=s[0],i[r++]=s[1],i[r++]=_.Rn;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===D.FADED?(yield(0,d.KU)(e,-this.fadedExtensions.start,P),yield(0,d.KU)(e,0,P),yield(0,d.KU)(e,1,P),yield(0,d.KU)(e,1+this.fadedExtensions.end,P)):(yield(0,d.KU)(e,0,P),yield(0,d.KU)(e,1,P))}}const w=(0,c.Ue)(),P=(0,n.c)(),S=(0,n.c)(),R=(0,d.Ue)();var D;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(D||(D={}));const E=1/3,O={start:E,end:E}},62389:(e,t,i)=>{i.d(t,{W:()=>B});var r=i(92026),s=i(11186),n=i(71353),a=i(85981),o=i(86244),c=i(70444),l=i(95773),d=i(40885),h=i(50951),u=i(50256),p=i(55158),_=i(88699),g=i(80658),f=i(4760),m=i(82144),v=i(31132),y=i(27627),b=i(18300),w=i(8548),P=i(36207);class S extends v.A{initializeProgram(e){return new y.$(e.rctx,S.shader.get().build(this.configuration),R)}initializePipeline(){return(0,P.sm)({blending:(0,P.if)(w.zi.ONE,w.zi.ONE_MINUS_SRC_ALPHA),colorWrite:P.BK})}}S.shader=new m.J(b.L,(()=>i.e(7515).then(i.bind(i,97515))));const R=new Map([[f.T.START,0],[f.T.END,1],[f.T.UP,2],[f.T.EXTRUDE,3]]);var D=i(44070);class E{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,n.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,_.bg)(3*e.length);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1],t[i++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,s.s)(this._origin,e[t+0],e[t+1],e[t+2])}else(0,s.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);(0,r.pC)(t)&&(e.bindVAO(t),e.drawArrays(w.MX.TRIANGLES,0,this._count))}dispose(){(0,r.pC)(this._vao)&&this._vao.dispose()}_ensureVAO(e){return(0,r.Wi)(this._buffers)?null:((0,r.Wi)(this._vao)&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new g.U(e,R,{data:(0,u.K)(x)},{data:D.f.createVertex(e,w.l1.STATIC_DRAW,i)})}_ensureVertexData(e,t){if(!this._dirty)return;const i=this._createDataBuffer(t);e.vertexBuffers.data?.setData(i),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const i=x.createBuffer(t),r=this._origin;let n=0,a=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=(0,s.s)(T,o[e+0],o[e+1],o[e+2]);0===e?a=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,a);const c=this._renderCoordsHelper.worldUpAtPosition(t,O),l=n+2*e,d=(0,s.b)(T,t,r);if(e<o.length-3){i.up.setVec(l,c),i.up.setVec(l+3,c),i.up.setVec(l+5,c);for(let e=0;e<6;e++)i.start.setVec(l+e,d);i.extrude.setValues(l+0,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,c),i.up.setVec(l-4,c),i.up.setVec(l-5,c);for(let e=-6;e<0;e++)i.end.setVec(l+e,d)}}n+=this._numberOfRenderVertices(o)}return i.buffer}}const O=(0,n.c)(),T=(0,n.c)(),x=(0,p.U$)().vec3f(f.T.START).vec3f(f.T.END).vec3f(f.T.UP).vec2f(f.T.EXTRUDE);var A=i(32534),C=i(93822),L=i(22909),M=i(27366),V=i(33559);class j extends V.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,M._)([(0,V.o)()],j.prototype,"contrastControlEnabled",void 0);var z=i(16889),G=i(98634),W=i(7566),F=i(83671);class I extends G.K{constructor(){super(...arguments),this.innerColor=(0,n.f)(1,1,1),this.innerWidth=1,this.glowColor=(0,n.f)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,z.Vl)(6),this.pointDistanceOrigin=(0,n.c)(),this.pointDistanceTarget=(0,n.c)(),this.lineVerticalPlaneSegment=(0,a.Ue)(),this.intersectsLineSegment=(0,a.Ue)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,n.c)(),this.lineStartWorld=(0,n.c)(),this.lineEndWorld=(0,n.c)()}}class H extends v.A{initializeProgram(e){return new y.$(e.rctx,H.shader.get().build(this.configuration),W.i)}initializePipeline(){return(0,P.sm)({blending:(0,P.if)(w.zi.ONE,w.zi.ONE_MINUS_SRC_ALPHA),colorWrite:P.BK})}}H.shader=new m.J(F.L,(()=>i.e(5693).then(i.bind(i,45693))));class N extends j{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,M._)([(0,V.o)()],N.prototype,"heightManifoldEnabled",void 0),(0,M._)([(0,V.o)()],N.prototype,"pointDistanceEnabled",void 0),(0,M._)([(0,V.o)()],N.prototype,"lineVerticalPlaneEnabled",void 0),(0,M._)([(0,V.o)()],N.prototype,"intersectsLineEnabled",void 0),(0,M._)([(0,V.o)()],N.prototype,"spherical",void 0);class U{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{contrastControlEnabled:!1};this._config=t,this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=h.JY.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._passParameters=(0,L.Uf)(e,new I)}get renderSlots(){return[this._config.contrastControlEnabled?C.r.LASERLINES_CONTRAST_CONTROL:C.r.LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,s.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,s.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,s.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,a.JG)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,a.JG)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,(0,r.pC)(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){(0,r.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new E(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){(0,r.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new E(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,L.LO)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=(0,A.ow)(t),this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new N;const i=new j;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(S,i)}uninitializeRenderContext(){this._quadVAO=(0,r.M2)(this._quadVAO),this._technique=(0,r.RY)(this._technique),this._pathVerticalPlaneData=(0,r.M2)(this._pathVerticalPlaneData),this._pathTechnique=(0,r.RY)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===h.JY.Global,this._technique=this._techniqueRepository.releaseAndAcquire(H,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx;this._updatePassParameters(e),i.bindTechnique(t,this._passParameters,e.bindParameters),i.bindVAO(this._quadVAO),i.drawArrays(w.MX.TRIANGLE_STRIP,0,4)}_renderPath(e){if((0,r.Wi)(this._pathVerticalPlaneData)||(0,r.Wi)(this._pathTechnique))return;const t=e.rctx,i=this._pathTechnique;t.bindTechnique(i,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,c.iL)((0,d.re)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),q),q.c0=-Number.MAX_VALUE,!(0,l.zq)(t.frustum,q))return;(0,c.Ws)(q,this._passParameters.lineStartWorld),(0,c.S$)(q,this._passParameters.lineEndWorld)}else(0,s.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,s.a)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}}const q=(0,c.Ue)();class B extends o.l{constructor(e){super(e.view),this._angleCutoff=F.d,this._style={},this._heightManifoldTarget=(0,n.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,a.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){(0,r.pC)(e)?((0,s.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if((0,r.Wi)(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,k);this.intersectsLine=(0,a.al)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){(0,r.pC)(e)?((0,a.JG)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=(0,r.pC)(e)?(0,a.JG)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=(0,r.pC)(e)?{origin:(0,n.a)(e.origin),target:e.target?(0,n.a)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||(0,r.pC)(this._pointDistanceLine)||(0,r.pC)(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){(0,r.pC)(this._renderer)||(this._renderer=new U({renderCoordsHelper:this.view.renderCoordsHelper},{contrastControlEnabled:!0}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer.renderSlots,this._renderer))}_syncStyle(){(0,r.Wi)(this._renderer)||(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){(0,r.Wi)(this._renderer)||this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){(0,r.Wi)(this._renderer)||(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){(0,r.Wi)(this._renderer)||(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){(0,r.Wi)(this._renderer)||(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){(0,r.Wi)(this._renderer)||(this._renderer.pathVerticalPlaneEnabled=(0,r.pC)(this._pathVerticalPlaneBuffers)&&this.visible,(0,r.pC)(this._pathVerticalPlaneBuffers)&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){(0,r.Wi)(this._renderer)||(this._renderer.lineVerticalPlaneEnabled=(0,r.pC)(this._lineVerticalPlaneSegment)&&this.visible,(0,r.pC)(this._lineVerticalPlaneSegment)&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if((0,r.Wi)(this._renderer))return;const e=this._pointDistanceLine,t=(0,r.pC)(e);this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){(0,r.pC)(this._renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const k=(0,n.c)()},66730:(e,t,i)=>{i.d(t,{L:()=>y});var r=i(16889),s=i(92026),n=i(11186),a=i(71353),o=i(90045),c=i(67077),l=i(79803),d=i(41414),h=i(11185),u=i(63825),p=i(69691),_=i(78935),g=i(67794),f=i(70619),m=i(4760),v=i(48800);class y{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=(0,c.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,c.f)(1,1,1,1),this._elevationInfo=null,this._resources=new u.O({view:e.view,createResources:e=>this._createResources(e),destroyResources:e=>this._destroyResources(e),recreateGeometry:(e,t)=>{e.geometry=this._recreateGeometry(t,e.material)}});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]??!1:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e}get attached(){return this._resources.attached}set attached(e){this._resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?(0,s.pC)(this._resources)&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,o.g)(e,this._color)||((0,o.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,(0,s.pC)(this._resources)&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,o.g)(e,this._outlineColor)||((0,o.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const e=this._resources.resources;(0,s.Wi)(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this._resources.resources,t=this._resources.object;if((0,s.Wi)(e)||(0,s.Wi)(t))return;const i=e.geometry;if((0,s.Wi)(i))return;const r=i.getMutableAttribute(m.T.SIZE).data,n=this._geometrySize;r[0]=n,r[1]=n,t.geometryVertexAttrsUpdated(t.geometries[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:w,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/b}_recreateGeometry(e,t){const i=this._createRenderGeometry(t);return(0,s.pC)(i)&&e.addGeometry(i),i}_createResources(e){const t=(0,g.cU)(this._primitive,this._preferredTextureSize),i=new v.A(this._materialParameters(t.id)),r=this._recreateGeometry(e,i);return{material:i,texture:t,geometry:r,forEach(e){e(t),e(i),(0,s.pC)(this.geometry)&&e(this.geometry)}}}_destroyResources(e){e.geometry=null,e.material.dispose(),e.texture.dispose()}get _preferredTextureSize(){return(0,r.uZ)((0,r.Sf)(2*this._geometrySize),16,128)}calculateMapBounds(e){if((0,s.Wi)(this._resources.resources)||(0,s.Wi)(this._resources.resources.geometry))return!1;const t=this._resources.resources.geometry.vertexAttributes.get(m.T.POSITION);return(0,l.SH)(t.data,this.view.renderCoordsHelper.spatialReference,P,this.view.spatialReference),(0,d.G1)(e,P),!0}_createRenderGeometry(e){const t=this.geometry;if((0,s.Wi)(t))return null;const{renderCoordsHelper:i,elevationProvider:r}=this.view,a=(0,p.w7)(t,r,_.o.fromElevationInfo(this.elevationInfo),i),o=(0,n.s)(h.WM.get(),t.x,t.y,a),c=h.WM.get();(0,l.SH)(o,t.spatialReference,c,i.spatialReference);const d=this._geometrySize;return(0,f.dV)(e,null,c,null,[d,d],[0,0,0,1])}}const b=g.Ns,w=[b/2,b/2,1-b/2,1-b/2],P=(0,a.c)()},86244:(e,t,i)=>{i.d(t,{l:()=>s});var r=i(94172);class s{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this._handle=(0,r.YP)((()=>this.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},63825:(e,t,i)=>{i.d(t,{O:()=>d});var r=i(92026),s=i(94172),n=i(79100),a=i(66327),o=i(76873),c=i(78485),l=i(97882);class d{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,r.pC)(this._resources)?this._resources.object:null}get resources(){return(0,r.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if((0,r.Wi)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==n.U.Mesh&&t.type!==n.U.Line&&t.type!==n.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==n.U.Mesh&&t.type!==n.U.Line&&t.type!==n.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const r=new l.F({pickable:!1,updatePolicy:c.j.SYNC});i.add(r);const n=new a.T({castShadow:!1}),d=e.createResources(n,r);d.forEach((e=>{i.add(e),e instanceof o.x&&i.loadImmediate(e)})),i.add(n),r.add(n);const h=e.cameraChanged,u=h?(0,s.YP)((()=>t.state.camera),(e=>h(e)),s.nn):null;this._resources={layer:r,object:n,external:d,cameraHandle:u},this._syncVisible()}_destroyResources(){if((0,r.Wi)(this._resources))return;const e=this._resourceFactory.view._stage;e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this._resources.external.forEach((t=>e.remove(t)))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){(0,r.Wi)(this._resources)||(this._resources.object.visible=this._visible)}}},81703:(e,t,i)=>{i.d(t,{u4:()=>c});var r=i(92026),s=i(17842),n=i(88396),a=i(11186),o=i(11185);function c(e,t,i){return function(e,t,i){const c=(0,s.Wv)((0,n.c)(o.WM.get(),t));if(c[2]=0,!e.unprojectFromRenderScreen(c,i.origin))return null;const l=(0,s.Wv)((0,n.c)(o.WM.get(),t));l[2]=1;const d=e.unprojectFromRenderScreen(l,o.WM.get());return(0,r.Wi)(d)?null:((0,a.b)(i.direction,d,i.origin),i)}(e,e.screenToRender(t,(0,s.Wv)(o.WM.get())),i)}},8084:(e,t,i)=>{i.d(t,{j:()=>h});var r=i(92026),s=i(21002),n=i(96415),a=i(82999),o=i(49450),c=i(58406),l=i(98634),d=i(19253);function h(e,t){e.extensions.add("GL_OES_standard_derivatives");const i=e.fragment;i.include(s.S),e.include(n.G),i.uniforms.add([new c.p("globalAlpha",(e=>e.globalAlpha)),new o.J("glowColor",(e=>e.glowColor)),new c.p("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new c.p("glowFalloff",(e=>e.glowFalloff)),new o.J("innerColor",(e=>e.innerColor)),new c.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new d.A("depthMap",((e,t)=>t.linearDepthTexture)),new a.A("nearFar",((e,t)=>t.camera.nearFar)),new d.A("frameColor",((e,t)=>t.mainColorTexture))]),i.code.add(l.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),i.code.add(l.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),i.code.add(l.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),i.code.add(l.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?(i.uniforms.add(new c.p("globalAlphaContrastBoost",(e=>(0,r.pC)(e.globalAlphaContrastBoost)?e.globalAlphaContrastBoost:1))),i.code.add(l.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):i.code.add(l.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},43505:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(82552),s=i(58406),n=i(98634);function a(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;(0,r.hY)(i,t),i.uniforms.add(new s.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),i.uniforms.add(new s.p("screenSizeScale",(e=>e.screenSizeScale))),i.code.add(n.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}},11606:(e,t,i)=>{i.d(t,{Q:()=>L});var r=i(11186),s=i(71353),n=i(67077),a=i(41414),o=i(25158),c=i(55158),l=i(37081),d=i(68401),h=i(23620),u=i(56529),p=i(93822),_=i(97731),g=i(4760),f=i(33236),m=i(22909),v=i(27366),y=i(82144),b=i(31132),w=i(33559),P=i(78041),S=i(27627),R=i(25920),D=i(8883),E=i(72511),O=i(8548),T=i(36207);class x extends b.A{initializeProgram(e){return new S.$(e.rctx,x.shader.get().build(this.configuration),C)}_setPipelineState(e){const t=this.configuration,i=e===R.A.NONE,r=e===R.A.FrontFace;return(0,T.sm)({blending:t.output!==l.H.Color&&t.output!==l.H.Alpha||!t.transparent?null:i?P.wu:(0,P.j7)(e),culling:(0,T.zp)(t.cullFace),depthTest:{func:r?O.wb.LESS:t.shadingEnabled?O.wb.LEQUAL:O.wb.LESS},depthWrite:i?t.writeDepth?T.LZ:null:(0,P.K5)(e),colorWrite:T.BK,polygonOffset:i||r?null:P.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}x.shader=new y.J(E.S,(()=>i.e(6556).then(i.bind(i,36556))));class A extends D.W{constructor(){super(...arguments),this.output=l.H.Color,this.cullFace=d.Vr.None,this.transparencyPassType=R.A.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,v._)([(0,w.o)({count:l.H.COUNT})],A.prototype,"output",void 0),(0,v._)([(0,w.o)({count:d.Vr.COUNT})],A.prototype,"cullFace",void 0),(0,v._)([(0,w.o)({count:R.A.COUNT})],A.prototype,"transparencyPassType",void 0),(0,v._)([(0,w.o)()],A.prototype,"hasSlicePlane",void 0),(0,v._)([(0,w.o)()],A.prototype,"transparent",void 0),(0,v._)([(0,w.o)()],A.prototype,"writeDepth",void 0),(0,v._)([(0,w.o)()],A.prototype,"screenSizeEnabled",void 0),(0,v._)([(0,w.o)()],A.prototype,"shadingEnabled",void 0),(0,v._)([(0,w.o)()],A.prototype,"hasMultipassTerrain",void 0),(0,v._)([(0,w.o)()],A.prototype,"cullAboveGround",void 0);const C=new Map([[g.T.POSITION,0],[g.T.NORMAL,1],[g.T.OFFSET,2]]);class L extends u.F5{constructor(e){super(e,new V),this.supportsEdges=!0,this._configuration=new A,this._vertexAttributeLocations=C}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,s,n,o){if(this.parameters.screenSizeEnabled){const t=e.vertexAttributes.get(g.T.OFFSET),c={applyToVertex:(e,s,n,a)=>{const o=(0,r.s)(z,t.data[3*a+0],t.data[3*a+1],t.data[3*a+2]),c=(0,r.s)(G,e,s,n);return(0,r.g)(o,o,this.parameters.screenSizeScale*i.camera.computeRenderPixelSizeAt(o)),(0,r.a)(c,c,o),[c[0],c[1],c[2]]},applyToAabb:e=>{const t=(0,a.be)(e,z);return(0,a.bA)(e,this.parameters.screenSizeScale*i.camera.computeRenderPixelSizeAt(t))}};(0,m.Bw)(e,i,s,n,c,o)}else(0,m.Bw)(e,i,s,n,void 0,o)}requiresSlot(e,t){if(t===l.H.Highlight)return e===p.r.OPAQUE_MATERIAL;if(t===l.H.Color||t===l.H.Alpha||t===l.H.ObjectAndLayerIdColor){let t=p.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(t=this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===t||e===p.r.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new M(e)}createBufferWriter(){return new j(this.parameters.screenSizeEnabled)}}class M extends h.Z{beginSlot(e){return this.ensureTechnique(x,e)}}class V extends u.Mt{constructor(){super(...arguments),this.color=(0,n.f)(1,1,1,1),this.shadingTint=(0,n.f)(0,0,0,.25),this.shadingDirection=(0,r.n)((0,s.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=d.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class j{constructor(e){this.screenSizeEnabled=e;const t=(0,c.U$)().vec3f(g.T.POSITION).vec3f(g.T.NORMAL);this.screenSizeEnabled&&t.vec3f(g.T.OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(g.T.POSITION).length}write(e,t,i,r,s){if((0,f.NK)(i,this.vertexBufferLayout,e,t,r,s),this.screenSizeEnabled){if(!i.vertexAttributes.has(g.T.OFFSET))throw new Error(`${g.T.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const e=i.vertexAttributes.get(g.T.OFFSET),n=i.indices.get(g.T.OFFSET);(0,_.hu)(3===e.size);const a=r.getField(g.T.OFFSET,o.ct);if(!a)throw new Error("unable to acquire view for "+g.T.OFFSET);(0,f.ho)(n,e.data,t,a,s)}}}}const z=(0,s.c)(),G=(0,s.c)()}}]);
//# sourceMappingURL=9212.8a40947b.chunk.js.map