"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[5002],{88396:(e,t,i)=>{i.d(t,{a:()=>o,b:()=>r,c:()=>s,d:()=>T,e:()=>E,f:()=>d,g:()=>a,h:()=>b,i:()=>y,j:()=>g,k:()=>I,l:()=>M,m:()=>w,n:()=>m,o:()=>f,p:()=>C,q:()=>k,r:()=>F,s:()=>_,t:()=>P,u:()=>v,v:()=>p,x:()=>c,y:()=>h});var n=i(26277);function s(e,t){return e[0]=t[0],e[1]=t[1],e}function o(e,t,i){return e[0]=t,e[1]=i,e}function r(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function a(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function l(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function u(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function c(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function h(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function d(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function p(e,t,i,n){return e[0]=t[0]+i[0]*n,e[1]=t[1]+i[1]*n,e}function g(e,t){const i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)}function _(e,t){const i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function f(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function v(e){const t=e[0],i=e[1];return t*t+i*i}function m(e,t){return e[0]=-t[0],e[1]=-t[1],e}function y(e,t){const i=t[0],n=t[1];let s=i*i+n*n;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]}function w(e,t,i){const n=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=n,e}function M(e,t,i,n){const s=t[0],o=t[1];return e[0]=s+n*(i[0]-s),e[1]=o+n*(i[1]-o),e}function C(e,t,i){const n=t[0],s=t[1];return e[0]=i[0]*n+i[2]*s,e[1]=i[1]*n+i[3]*s,e}function P(e,t,i){const n=t[0],s=t[1];return e[0]=i[0]*n+i[2]*s+i[4],e[1]=i[1]*n+i[3]*s+i[5],e}function F(e,t,i,n){const s=t[0]-i[0],o=t[1]-i[1],r=Math.sin(n),a=Math.cos(n);return e[0]=s*a-o*r+i[0],e[1]=s*r+o*a+i[1],e}function E(e,t){return e[0]===t[0]&&e[1]===t[1]}function k(e,t,i,n,s){let o=t[0]-i[0],r=t[1]-i[1];const a=(n[0]*o+n[1]*r)*(s-1);return o=n[0]*a,r=n[1]*a,e[0]=t[0]+o,e[1]=t[1]+r,e}const A=f,I=a,O=l,x=u,T=g,S=_,N=v;Object.freeze(Object.defineProperty({__proto__:null,copy:s,set:o,add:r,subtract:a,multiply:l,divide:u,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:c,max:h,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:d,scaleAndAdd:p,distance:g,squaredDistance:_,length:f,squaredLength:v,negate:m,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:y,dot:b,cross:w,lerp:M,random:function(e,t){t=t||1;const i=2*(0,n.R)()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},transformMat2:C,transformMat2d:P,transformMat3:function(e,t,i){const n=t[0],s=t[1];return e[0]=i[0]*n+i[3]*s+i[6],e[1]=i[1]*n+i[4]*s+i[7],e},transformMat4:function(e,t,i){const n=t[0],s=t[1];return e[0]=i[0]*n+i[4]*s+i[12],e[1]=i[1]*n+i[5]*s+i[13],e},rotate:F,angle:function(e,t){const i=e[0],n=e[1],s=t[0],o=t[1];let r=i*i+n*n;r>0&&(r=1/Math.sqrt(r));let a=s*s+o*o;a>0&&(a=1/Math.sqrt(a));const l=(i*s+n*o)*r*a;return l>1?0:l<-1?Math.PI:Math.acos(l)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:E,equals:function(e,t){const i=e[0],s=e[1],o=t[0],r=t[1];return Math.abs(i-o)<=n.E*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(s-r)<=n.E*Math.max(1,Math.abs(s),Math.abs(r))},projectAndScale:k,len:A,sub:I,mul:O,div:x,dist:T,sqrDist:S,sqrLen:N},Symbol.toStringTag,{value:"Module"}))},6394:(e,t,i)=>{function n(){return[0,0]}function s(e){return[e[0],e[1]]}function o(e,t){return[e,t]}function r(e){const t=[0,0],i=Math.min(2,e.length);for(let n=0;n<i;++n)t[n]=e[n];return t}function a(e,t){return new Float64Array(e,t,2)}function l(){return[0,0]}function u(){return o(1,1)}function c(){return o(1,0)}function h(){return o(0,1)}i.d(t,{O:()=>p,Z:()=>d,a:()=>n,b:()=>r,c:()=>a,d:()=>s,f:()=>o});const d=[0,0],p=u(),g=c(),_=h();Object.freeze(Object.defineProperty({__proto__:null,create:n,clone:s,fromValues:o,fromArray:r,createView:a,zeros:l,ones:u,unitX:c,unitY:h,ZEROS:d,ONES:p,UNIT_X:g,UNIT_Y:_},Symbol.toStringTag,{value:"Module"}))},15559:(e,t,i)=>{i.d(t,{Gb:()=>p,Jf:()=>_,TB:()=>v,cA:()=>m,j2:()=>f,p8:()=>g});i(59486);var n=i(10064),s=i(68860),o=i(38516),r=i(92975),a=i(29909),l=i(80885),u=(i(7882),i(78952));function c(e){if(!e)return null;if((0,r.sT)(e)&&e.wkid){const t=o.Dg[e.wkid];if(t)return t}if(e.wkt){const t=function(e){const t=o.yB.exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const n=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(n)||isNaN(s)?null:{a:n,f:0===s?0:1/s}}(e.wkt);if(t)return t}return null}function h(e){const t=c(e||u.Z.WGS84);if(function(e){return"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function d(e,t,i){const{a:n,eSq:s}=h(i),r=Math.sqrt(s),a=Math.sin(t[1]*o.Yr),l=n*t[0]*o.Yr;let u;return u=s>0?n*((1-s)*(a/(1-s*(a*a))-1/(2*r)*Math.log((1-r*a)/(1+r*a))))*.5:n*a,e[0]=l,e[1]=u,e}function p(e){return null!==c(e)}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"square-meters";if(e.some((e=>!p(e.spatialReference))))throw new n.Z("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let n=0;n<e.length;n++){const t=e[n],s=t.spatialReference,{radius:o,densificationRatio:r}=h(s),a=o*r;i.push(f(t,a))}const o=[],r=[0,0],a=[0,0];for(let n=0;n<i.length;n++){const{rings:e,spatialReference:l}=i[n];let u=0;for(let t=0;t<e.length;t++){const i=e[t];d(r,i[0],l),d(a,i[i.length-1],l);let n=a[0]*r[1]-r[0]*a[1];for(let e=0;e<i.length-1;e++)d(r,i[e+1],l),d(a,i[e],l),n+=a[0]*r[1]-r[0]*a[1];u+=n}u=(0,s.En)(u,"square-meters",t),o.push(u/-2)}return o}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"meters";if(!e)throw new n.Z("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((e=>!p(e.spatialReference))))throw new n.Z("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let n=0;n<e.length;n++){const o=e[n],{spatialReference:r}=o,a="polyline"===o.type?o.paths:o.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let i=0;for(let e=1;e<t.length;e++){const n=t[e-1][0],s=t[e][0],o=t[e-1][1],a=t[e][1];if(o!==a||n!==s){const e={distance:null};m(e,[n,o],[s,a],r),i+=e.distance}}l+=i}l=(0,s.En)(l,"meters",t),i.push(l)}return i}function f(e,t){if("polyline"!==e.type&&"polygon"!==e.type)throw new n.Z("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=e;if(!p(i))throw new n.Z("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const s="polyline"===e.type?e.paths:e.rings,o=[],r=[0,0],u={distance:null};for(const n of s){const e=[];o.push(e),e.push([n[0][0],n[0][1]]);let s,a,l=n[0][0],c=n[0][1];for(let o=0;o<n.length-1;o++){if(s=n[o+1][0],a=n[o+1][1],l===s&&c===a)continue;const h=[l,c];m(u,[l,c],[s,a],i);const{azimuth:d,distance:p}=u,g=p/t;if(g>1){for(let n=1;n<=g-1;n++)v(r,h,d,n*t,i),e.push(r.slice(0));v(r,h,d,(p+Math.floor(g-1)*t)/2,i),e.push(r.slice(0))}v(r,h,d,p,i),e.push(r.slice(0)),l=r[0],c=r[1]}}return"polyline"===e.type?new a.Z({paths:o,spatialReference:i}):new l.Z({rings:o,spatialReference:i})}function v(e,t,i,n,s){const r=t[0],a=t[1],l=r*o.Yr,u=a*o.Yr,c=i*o.Yr,{a:d,b:p,f:g}=h(s),_=Math.sin(c),f=Math.cos(c),v=(1-g)*Math.tan(u),m=1/Math.sqrt(1+v*v),y=v*m,b=Math.atan2(v,f),w=m*_,M=w*w,C=1-M,P=C*(d*d-p*p)/(p*p),F=1+P/16384*(4096+P*(P*(320-175*P)-768)),E=P/1024*(256+P*(P*(74-47*P)-128));let k,A,I,O,x=n/(p*F),T=2*Math.PI;for(;Math.abs(x-T)>1e-12;)I=Math.cos(2*b+x),k=Math.sin(x),A=Math.cos(x),O=E*k*(I+E/4*(A*(2*I*I-1)-E/6*I*(4*k*k-3)*(4*I*I-3))),T=x,x=n/(p*F)+O;const S=y*k-m*A*f,N=Math.atan2(y*A+m*k*f,(1-g)*Math.sqrt(M+S*S)),B=Math.atan2(k*_,m*A-y*k*f),L=g/16*C*(4+g*(4-3*C)),D=N/o.Yr,V=(l+(B-(1-L)*g*w*(x+L*k*(I+L*A*(2*I*I-1)))))/o.Yr;return e[0]=V,e[1]=D,e}function m(e,t,i,n){const s=t[0]*o.Yr,r=t[1]*o.Yr,a=i[0]*o.Yr,l=i[1]*o.Yr,{a:u,b:c,f:d,radius:p}=h(n),g=a-s,_=Math.atan((1-d)*Math.tan(r)),f=Math.atan((1-d)*Math.tan(l)),v=Math.sin(_),m=Math.cos(_),y=Math.sin(f),b=Math.cos(f);let w,M,C,P,F,E,k,A,I,O,x=1e3,T=g;do{if(k=Math.sin(T),A=Math.cos(T),C=Math.sqrt(b*k*(b*k)+(m*y-v*b*A)*(m*y-v*b*A)),0===C)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;F=v*y+m*b*A,E=Math.atan2(C,F),I=m*b*k/C,M=1-I*I,P=F-2*v*y/M,isNaN(P)&&(P=0),O=d/16*M*(4+d*(4-3*M)),w=T,T=g+(1-O)*d*I*(E+O*C*(P+O*F*(2*P*P-1)))}while(Math.abs(T-w)>1e-12&&--x>0);if(0===x){const t=p,i=Math.acos(Math.sin(r)*Math.sin(l)+Math.cos(r)*Math.cos(l)*Math.cos(a-s))*t,n=a-s,u=Math.sin(n)*Math.cos(l),c=Math.cos(r)*Math.sin(l)-Math.sin(r)*Math.cos(l)*Math.cos(n),h=Math.atan2(u,c);return e.azimuth=h/o.Yr,e.distance=i,e.reverseAzimuth=void 0,e}const S=M*(u*u-c*c)/(c*c),N=S/1024*(256+S*(S*(74-47*S)-128)),B=c*(1+S/16384*(4096+S*(S*(320-175*S)-768)))*(E-N*C*(P+N/4*(F*(2*P*P-1)-N/6*P*(4*C*C-3)*(4*P*P-3)))),L=Math.atan2(b*Math.sin(T),m*y-v*b*Math.cos(T)),D=Math.atan2(m*Math.sin(T),m*y*Math.cos(T)-v*b);return e.azimuth=L/o.Yr,e.distance=B,e.reverseAzimuth=D/o.Yr,e}},76419:(e,t,i)=>{i.d(t,{L:()=>o});var n=i(18107),s=i(3073);class o{constructor(e,t){this.owner=t,this.properties={},this.afterDispatchHandle=null;for(const i in e){const t=e[i],s=new n.e(t,null,null,2,2);this.properties[i]={pool:s,acquired:[]}}this.afterDispatchHandle=(0,s.Fs)((()=>this._release()))}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const e in this.properties){const t=this.properties[e];for(const e of t.acquired)(0,s.NC)(e)||t.pool.release(e);t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null}get(e){const t=this.owner._get(e),i=this.properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===t;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this.properties){const t=this.properties[e];let i=0;for(const e of t.acquired)(0,s.NC)(e)?t.acquired[i++]=e:t.pool.release(e);t.acquired.length=i}}}},15404:(e,t,i)=>{i.d(t,{f:()=>oi,t:()=>ri});var n=i(27366),s=i(50093),o=i(94172),r=i(99346),a=i(49861),l=(i(63780),i(93169),i(25243),i(69912)),u=i(85015),c=i(40281),h=i(61826),d=(i(42877),i(88367));let p=class extends u.Z{constructor(){super(...arguments),this.items=new c.Z,this._watchUpdatingTracking=new h.t,this._callbacks=new Map,this._projector=(0,d.E)(),this._hiddenProjector=(0,d.E)()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((()=>this.items),(e=>{for(const t of e.added){const e=()=>t.render();this._callbacks.set(t,e),this._projector.append(this.surface,e)}for(const t of e.removed){const e=this._projector.detach(this._callbacks.get(t));this.surface.removeChild(e.domNode),this._callbacks.delete(t)}}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let n=null;const s=()=>(n=e.render(),n);i.append(t,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const e=n.domNode.getBoundingClientRect();o.left=e.left,o.top=e.top,o.right=e.right,o.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return o}overlaps(e,t){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(t);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};(0,n._)([(0,a.Cb)({readOnly:!0})],p.prototype,"surface",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],p.prototype,"items",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],p.prototype,"needsRender",null),(0,n._)([(0,a.Cb)({readOnly:!0})],p.prototype,"_watchUpdatingTracking",void 0),(0,n._)([(0,a.Cb)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],p.prototype,"updating",void 0),p=(0,n._)([(0,l.j)("esri.views.overlay.ViewOverlay")],p);const g=p;i(59166);var _,f=i(98928),v=i(100),m=i(32718),y=i(92026),b=i(14916),w=i(8025),M=i(89125),C=i(83942),P=i(66978),F=i(69407),E=i(91505);const k=Symbol("anchorHandles");let A=class extends E.Z.EventedAccessor{constructor(e){super(e),this[_]=new v.Z,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[k].add([(0,o.gx)((()=>(0,y.yw)(this.screenLocationEnabled?this.view:null,(e=>[e.size,"3d"===e.type?e.camera:e.viewpoint]))),(()=>this.notifyChange("screenLocation"))),(0,o.YP)((()=>this.screenLocation),((e,t)=>{(0,y.pC)(e)&&(0,y.pC)(t)&&this.emit("view-change")}))])}destroy(){this.view=null,this[k]=(0,y.SC)(this[k])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&(0,y.pC)(e)&&(0,y.pC)(t)&&t.ready?t.toScreen(e):null}};_=k,(0,n._)([(0,a.Cb)()],A.prototype,"location",void 0),(0,n._)([(0,a.Cb)()],A.prototype,"screenLocation",null),(0,n._)([(0,a.Cb)()],A.prototype,"screenLocationEnabled",void 0),(0,n._)([(0,a.Cb)()],A.prototype,"view",void 0),A=(0,n._)([(0,l.j)("esri.widgets.support.AnchorElementViewModel")],A);const I=A;let O=class extends I{constructor(e){super(e),this.visible=!1}};(0,n._)([(0,a.Cb)()],O.prototype,"visible",void 0),O=(0,n._)([(0,l.j)("esri.widgets.CompassViewModel")],O);const x=O;var T=i(80975),S=i(67005);const N="esri-spinner",B="esri-spinner--start",L="esri-spinner--finish";let D=class extends F.Z{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new x,this.visible=!1}initialize(){this.own([(0,o.YP)((()=>this.visible),(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,n={[B]:e&&i,[L]:!e&&i},s=this._getPositionStyles();return(0,S.u)("div",{class:this.classes(N,n),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=(0,P.e4)(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if((0,y.Wi)(t)||(0,y.Wi)(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};(0,n._)([(0,w.B)("viewModel.location")],D.prototype,"location",void 0),(0,n._)([(0,w.B)("viewModel.view")],D.prototype,"view",void 0),(0,n._)([(0,a.Cb)({type:x})],D.prototype,"viewModel",void 0),(0,n._)([(0,w.B)("viewModel.visible")],D.prototype,"visible",void 0),D=(0,n._)([(0,l.j)("esri.widgets.Spinner")],D);const V=D;var R=i(72221),H=(i(59486),i(52639)),z=(i(51508),i(10064)),Z=i(81753),U=i(30651),Y=i(57976),q=i(6945),W=i(9676),j=i(86828),K=i(91806),G=i(69787),$=i(71045);const X="esri-icon-zoom-in-magnifying-glass",Q="esri-icon-trash",J="esri-icon-table",ee=new q.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:X}),te=new q.Z({id:"remove-selected-feature",title:"{messages.remove}",className:Q}),ie=new q.Z({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:X}),ne=new q.Z({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:J}),se=m.Z.getLogger("esri.widgets.Popup.PopupViewModel"),oe=e=>{const{event:t,view:i}=e,{action:n}=t,s=i&&i.popup;if(!n)return Promise.reject(new z.Z("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new z.Z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:o,id:r}=n;if(!r)return Promise.reject(new z.Z("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new z.Z("trigger-action:invalid-action","Action is disabled"));if(r===ee.id)return le(s.viewModel).catch(P.H9);if(r===ie.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==i?.type){const e=new z.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw se.error(e),e}if(!ae(t)){const e=new z.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw se.error(e),e}const n=t.sourceLayer,s=await i.whenLayerView(n),o=s.createQuery();o.aggregateIds=[t.getObjectId()],ie.active=!0,ie.disabled=!0;const{extent:r}=await s.queryExtent(o);await i.goTo({target:r}),ie.active=!1,ie.disabled=!1}(s.viewModel);if(r===ne.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,r===te.id){s.close();const{selectedFeature:e}=s;if(!e)return Promise.reject(new z.Z(`trigger-action:${te.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function re(e){const{selectedFeature:t,location:i,view:n}=e;return n?"3d"===n.type?t||i:e.get("selectedFeature.geometry")||i:null}function ae(e){return e?.isAggregate&&"cluster"===e?.sourceLayer?.featureReduction?.type}async function le(e){const{location:t,selectedFeature:i,view:n,zoomFactor:s}=e,o=re(e);if(!o){const e=new z.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:o,view:n});throw se.error(e),e}const r=n.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&"point"===a.type&&function(e,t){if("3d"!==t?.type||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new z.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});se.error(t)})),t}return!0}(i,n);ee.active=!0,ee.disabled=!0;try{await e.view.goTo({target:o,scale:l?r:void 0})}finally{ee.active=!1,ee.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}var ue=i(99505),ce=i(61459),he=i(7882);const de=c.Z.ofType({key:"type",defaultKeyValue:"button",base:Y.Z,typeMap:{button:q.Z,toggle:W.Z}}),pe="esri.widgets.Popup.PopupViewModel",ge=m.Z.getLogger(pe);let _e=class extends((0,ue._)(I)){constructor(e){super(e),this._handles=new v.Z,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new de,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new H.Z({symbol:new ce.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((e=>e.waitingForContent))}initialize(){this._handles.add([(0,o.YP)((()=>[this.autoOpenEnabled,this.view]),(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),(0,o.YP)((()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view]),(()=>this._highlightSelectedFeature())),(0,o.YP)((()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view]),(()=>this._highlightActiveFeature())),(0,o.YP)((()=>this.view?.animation?.state),(e=>this._animationStateChange(e))),(0,o.YP)((()=>this.location),(e=>this._locationChange(e))),(0,o.YP)((()=>this.selectedFeature),(e=>this._selectedFeatureChange(e))),(0,o.YP)((()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage]),(()=>this._selectedFeatureIndexChange())),(0,o.YP)((()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels]),(()=>this._setGraphicOnFeatureViewModels())),(0,o.YP)((()=>this.featureViewModels),(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>oe({event:e,view:this.view}))),(0,o.gx)((()=>!this.waitingForResult),(()=>this._waitingForResultChange()),o.Z_),(0,o.YP)((()=>[this.features,this.view?.map,this.view?.spatialReference]),(()=>this._updateFeatureVMs())),(0,o.YP)((()=>this.view?.scale),(()=>this._viewScaleChange())),(0,o.gx)((()=>!this.visible),(()=>this.browseClusterEnabled=!1)),(0,o.YP)((()=>this.browseClusterEnabled),(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new de;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:n,includeDefaultActions:s,selectedFeature:o}=this,r=s?i.concat(t):t,a=o&&("function"==typeof o.getEffectivePopupTemplate&&o.getEffectivePopupTemplate(n)||o.popupTemplate),l=a&&a.actions,u=a&&a.overwriteActions?l:l?l.concat(r):r;return u&&u.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){const e=this._get("defaultActions")||new de;return e.removeAll(),e.addMany(ae(this.selectedFeature)?[ie.clone(),ne.clone()]:[ee.clone()]),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:n,selectedFeatureIndex:s}=this,o=n&&t.length;o&&i&&-1===s?this.selectedFeatureIndex=0:o&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,Z.$)(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e);e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=re(this);if(!t){const i=new z.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return ge.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new z.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return ge.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const n=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of n)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(e){const t=e.features.filter((e=>ae(e)));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;"2d"===e?.type?ae(t)?(await async function(e){const{selectedFeature:t,view:i}=e,n=t.sourceLayer,s=await i.whenLayerView(n),o=s.createQuery();o.aggregateIds=[t.getObjectId()];const{extent:r}=await s.queryExtent(o);e.selectedClusterBoundaryFeature.geometry=r,i.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e,n=t.sourceLayer,s=await i.whenLayerView(n),o=s.createQuery();o.aggregateIds=[t.getObjectId()],ne.active=!0,ne.disabled=!0;const{features:r}=await s.queryFeatures(o);ne.active=!1,ne.disabled=!1,i.popup.open({features:[t].concat(r),featureMenuOpen:!0})}(this)):ge.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):ge.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(ee.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){const e=this.view?.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(ae(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:n,featureViewModels:s}=this;if(null===i)return;const o=((i-1)*n+t)%t,r=o+n;s.slice(o,r).forEach(((t,i)=>{t&&!t.graphic&&(t.graphic=e[o+i])}))}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:n}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(n.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),ae(e))return;return e.symbol=await(0,j.zd)(e),this._selectedClusterFeature=e,void n.graphics.add(this._selectedClusterFeature)}!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=n.center.clone()})):this.location=(0,y.Wg)(this._getPointFromGeometry(e.geometry))}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,n=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[n,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(ae(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const n=i.slice(0),s=[];t.forEach(((t,i)=>{if(!t)return;let o=null;if(n.some(((e,i)=>(e&&e.graphic===t&&(o=e,n.splice(i,1)),!!o))),o)s[i]=o;else{const n=new $.Z({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:this.view?.spatialReference,graphic:t===e?t:null,map:this.view?.map,view:this.view});s[i]=n}})),n.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),K.f.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:n}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:n,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:n}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:o}=e,r=[Promise.resolve(t),...s.map((e=>e.promise))];return n.popup.open({location:o||i,promises:r}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return(0,y.Wi)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return"map-notes"===i?.type||"subtype-group"===i?.type?i:t}_getHighlightTarget(e,t){const i="imagery"===t.type?void 0:"objectIdField"in t&&t.objectIdField,n=e.attributes;return n&&i&&n[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:n,visible:s}=this;if(!(n&&i&&t&&s))return;const o=this._getHighlightLayer(n);if(!(o&&o instanceof U.Z))return;const r=this._getLayerView(i,o);this._highlightActiveFeaturePromise=r;const a=await r;if(!(a&&(0,G.tl)(a)&&this._highlightActiveFeaturePromise===r&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(n,o));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:n,visible:s}=this;if(!(t&&n&&i&&s))return;const o=this._getHighlightLayer(t);if(!(o&&o instanceof U.Z))return;const r=this._getLayerView(n,o);this._highlightSelectedFeaturePromise=r;const a=await r;if(!(a&&(0,G.tl)(a)&&this._highlightSelectedFeaturePromise===r&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,o));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>!t.includes(e)));this.features=t.concat(i)}};(0,n._)([(0,a.Cb)()],_e.prototype,"featurePage",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"isLoadingFeature",null),(0,n._)([(0,a.Cb)({type:de})],_e.prototype,"actions",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"active",null),(0,n._)([(0,a.Cb)()],_e.prototype,"activeFeature",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"allActions",null),(0,n._)([(0,a.Cb)({type:Boolean})],_e.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"autoOpenEnabled",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"browseClusterEnabled",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"content",void 0),(0,n._)([(0,a.Cb)({type:de,readOnly:!0})],_e.prototype,"defaultActions",null),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"featureCount",null),(0,n._)([(0,a.Cb)()],_e.prototype,"features",null),(0,n._)([(0,a.Cb)()],_e.prototype,"featuresPerPage",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"featureViewModelAbilities",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"featureViewModels",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"highlightEnabled",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"includeDefaultActions",void 0),(0,n._)([(0,a.Cb)({type:he.Z})],_e.prototype,"location",null),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"pendingPromisesCount",null),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"selectedClusterBoundaryFeature",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"waitingForResult",null),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"promiseCount",null),(0,n._)([(0,a.Cb)()],_e.prototype,"promises",null),(0,n._)([(0,a.Cb)({value:null,readOnly:!0})],_e.prototype,"selectedFeature",null),(0,n._)([(0,a.Cb)({value:-1})],_e.prototype,"selectedFeatureIndex",null),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"selectedFeatureViewModel",null),(0,n._)([(0,a.Cb)({readOnly:!0})],_e.prototype,"state",null),(0,n._)([(0,a.Cb)()],_e.prototype,"title",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"view",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"visible",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"zoomFactor",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"zoomToLocation",void 0),(0,n._)([(0,a.Cb)()],_e.prototype,"centerAtLocation",null),_e=(0,n._)([(0,l.j)(pe)],_e);const fe=_e;var ve=i(96919),me=i(78088),ye=i(80532),be=i(93531),we=i(8704);const Me="selected-index",Ce="popup-spinner",Pe="esri-icon-left-triangle-arrow",Fe="esri-icon-right-triangle-arrow",Ee="esri-icon-maximize",ke="esri-icon-dock-bottom",Ae="esri-icon-dock-left",Ie="esri-icon-dock-right",Oe="esri-icon-close",xe="esri-icon-minimize",Te="esri-icon-check-mark",Se="esri-icon-loading-indicator",Ne="esri-icon-default-action",Be="esri-icon-handle-horizontal",Le="esri-rotating",De="esri-popup",Ve="esri-widget",Re="esri-popup__main-container",He="esri-popup__loading-container",ze="esri-popup--is-collapsible",Ze="esri-popup--is-collapsed",Ue="esri-popup--shadow",Ye="esri-popup--is-docked",qe="esri-popup--is-docked-top-left",We="esri-popup--is-docked-top-center",je="esri-popup--is-docked-top-right",Ke="esri-popup--is-docked-bottom-left",Ge="esri-popup--is-docked-bottom-center",$e="esri-popup--is-docked-bottom-right",Xe="esri-popup--aligned-top-center",Qe="esri-popup--aligned-bottom-center",Je="esri-popup--aligned-top-left",et="esri-popup--aligned-bottom-left",tt="esri-popup--aligned-top-right",it="esri-popup--aligned-bottom-right",nt="esri-popup--feature-menu-open",st="esri-popup--actions-menu-open",ot="esri-popup--feature-updated",rt="esri-popup__header",at="esri-popup__header-buttons",lt="esri-popup__header-container",ut="esri-popup__header-container--button",ct="esri-popup__header-title",ht="esri-popup__content",dt="esri-popup__footer",pt="esri-popup__footer--has-pagination",gt="esri-popup__footer--has-actions",_t="esri-popup__footer--has-actions-menu",ft="esri-popup__button",vt="esri-popup__button--disabled",mt="esri-popup__button--dock",yt="esri-popup__icon",bt="esri-popup__icon--dock-icon",wt="esri-popup__inline-actions-container",Mt="esri-popup__actions-menu-button",Ct="esri-popup__actions",Pt="esri-popup__action",Ft="esri-popup__action-image",Et="esri-popup__action-text",kt="esri-popup__action-toggle",At="esri-popup__action-toggle--on",It="esri-popup__pointer",Ot="esri-popup__pointer-direction",xt="esri-popup__navigation",Tt="esri-popup__pagination-previous",St="esri-popup__pagination-next",Nt="esri-popup__pagination-previous-icon",Bt="esri-popup__pagination-previous-icon--rtl",Lt="esri-popup__pagination-next-icon",Dt="esri-popup__pagination-next-icon--rtl",Vt="esri-popup__feature-menu",Rt="esri-popup__feature-menu-list",Ht="esri-popup__feature-menu-item",zt="esri-popup__feature-menu-viewport",Zt="esri-popup__feature-menu-header",Ut="esri-popup__feature-menu-item--selected",Yt="esri-popup__feature-menu-button",qt="esri-popup__feature-menu-title",Wt="esri-popup__feature-menu-observer",jt="esri-popup__feature-menu-loader",Kt={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Gt="esri-popup";function $t(e,t){return void 0===t?`${Gt}__${e}`:`${Gt}__${e}-${t}`}const Xt="esri.widgets.Popup",Qt=m.Z.getLogger(Xt),Jt={closeButton:!0,featureNavigation:!0};let ei=class extends((0,R.q)(F.Z)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new v.Z,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=e=>{let[t]=e;t?.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=(0,b.P)((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new fe,this.visible=null,this.visibleElements={...Jt},this._addSelectedFeatureIndexHandle(),this.own([(0,o.YP)((()=>this.viewModel?.screenLocation),(()=>this._positionContainer())),(0,o.YP)((()=>[this.viewModel?.active,this.dockEnabled]),(()=>this._toggleScreenLocationEnabled())),(0,o.YP)((()=>this.viewModel?.screenLocation),((e,t)=>{!!e!=!!t&&this.reposition()})),(0,o.YP)((()=>[this.viewModel?.view?.padding,this.viewModel?.view?.size,this.viewModel?.active,this.viewModel?.location,this.alignment]),(()=>this.reposition())),(0,o.YP)((()=>this.spinnerEnabled),(e=>this._spinnerEnabledChange(e))),(0,o.YP)((()=>this.viewModel?.view?.size),((e,t)=>this._updateDockEnabledForViewSize(e,t))),(0,o.YP)((()=>this.viewModel?.view),((e,t)=>this._viewChange(e,t))),(0,o.YP)((()=>this.viewModel?.view?.ready),((e,t)=>this._viewReadyChange(e,t))),(0,o.YP)((()=>[this.viewModel?.waitingForResult,this.viewModel?.location]),(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),(0,o.YP)((()=>[this.selectedFeatureWidget?.viewModel?.title,this.selectedFeatureWidget?.viewModel?.state]),(()=>this._setTitleFromFeatureWidget())),(0,o.YP)((()=>[this.selectedFeatureWidget?.viewModel?.content,this.selectedFeatureWidget?.viewModel?.state]),(()=>this._setContentFromFeatureWidget())),(0,o.gx)((()=>!this.collapsed),(()=>{"xsmall"===this.viewModel?.view?.widthBreakpoint&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),(0,o.on)((()=>this.viewModel?.allActions),"change",(()=>this._watchActions())),(0,o.YP)((()=>this.viewModel?.allActions),(()=>this._watchActions()),o.nn),(0,o.YP)((()=>this.viewModel?.featureViewModels),(()=>this._featureMenuViewportScrollTop()))])}destroy(){this._destroySelectedFeatureWidget(),this._destroySpinner(),this._handles?.destroy(),this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver?.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){return!!(this.selectedFeatureWidget?this.selectedFeatureWidget?.viewModel?.waitingForContent||"error"===this.selectedFeatureWidget?.viewModel?.state||this.selectedFeatureWidget?.viewModel?.content:this.viewModel?.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Kt}set dockOptions(e){const t={...Kt},i=this.get("viewModel.view.breakpoints"),n={};i&&(n.width=i.xsmall,n.height=i.xsmall);const s={...t,...e},o={...t.breakpoint,...n},{breakpoint:r}=s;!0===r?s.breakpoint=o:"object"==typeof r&&(s.breakpoint={...o,...r}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:n}=this.viewModel,s={...t,title:!1};return n?(e?(e.viewModel=n,e.visibleElements=s):this._feature=new C.Z({headingLevel:i+1,viewModel:n,visibleElements:s}),this._feature):null}castVisibleElements(e){return{...Jt,...e}}blur(){const{active:e}=this.viewModel;e||Qt.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Qt.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){this._handles.remove(Me);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};"xsmall"===this.viewModel?.view?.widthBreakpoint&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:n,currentAlignment:s,currentDockPosition:o}=this,{active:r}=this.viewModel,{menuActions:a}=n,l=r&&a.length>1&&e,u=r&&t,c=r&&!t,h=this.selectedFeature?.layer?.title,d=this.selectedFeature?.layer?.id,p={[Xe]:"top-center"===s,[Qe]:"bottom-center"===s,[Je]:"top-left"===s,[et]:"bottom-left"===s,[tt]:"top-right"===s,[it]:"bottom-right"===s,[Ye]:u,[Ue]:c,[qe]:"top-left"===o,[We]:"top-center"===o,[je]:"top-right"===o,[Ke]:"bottom-left"===o,[Ge]:"bottom-center"===o,[$e]:"bottom-right"===o,[nt]:i,[st]:l};return(0,S.u)("div",{class:this.classes(De,p),role:"presentation","data-layer-title":h,"data-layer-id":d,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},r?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,S.u)("span",{"aria-hidden":"true",class:this.classes(yt,Se,Le)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?(0,S.u)("div",{key:$t("loading-container"),role:"presentation",class:He,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=(0,T.dZ)(this.container),t={[Fe]:e,[Bt]:e,[Pe]:!e,[Nt]:!e};return(0,S.u)("span",{"aria-hidden":"true",class:this.classes(yt,t)})}renderPreviousButton(){const{messages:e}=this;return(0,S.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(ft,Tt),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=(0,T.dZ)(this.container),t={[Pe]:e,[Dt]:e,[Fe]:!e,[Lt]:!e};return(0,S.u)("span",{"aria-hidden":"true",class:this.classes(yt,t)})}renderNextButton(){const{messages:e}=this;return(0,S.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(ft,St),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:n,selectedFeatureIndex:s}=this.viewModel;return(0,S.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(ft,Yt),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(n,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[xe]:e,[bt]:!e,[Ie]:!e&&("top-right"===t||"bottom-right"===t),[Ae]:!e&&("top-left"===t||"bottom-left"===t),[Ee]:!e&&"top-center"===t,[ke]:!e&&"bottom-center"===t};return(0,S.u)("span",{"aria-hidden":"true",class:this.classes(i,yt)})}renderDockButton(){const{dockEnabled:e,messages:t}=this,i=this.viewModel?.view?.widthBreakpoint,n=e?t.undock:t.dock;return"xsmall"!==i&&this.dockOptions?.buttonEnabled?(0,S.u)("div",{role:"button","aria-label":n,title:n,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(ft,mt)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:n,messagesCommon:s}=this,o={[ut]:i},r=(0,S.u)(ve.X6,{level:this.headingLevel,class:ct,innerHTML:e}),a=i?(0,S.u)("button",{key:`${e}--collapsible`,id:t,title:n?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(lt,o),"aria-expanded":n?"false":"true",onclick:this._toggleCollapsed,type:"button"},r):(0,S.u)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(lt,o)},r);return e?a:null}renderCloseIcon(){return(0,S.u)("span",{"aria-hidden":"true",class:this.classes(yt,Oe)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?(0,S.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:ft,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,S.u)("header",{class:rt},this.renderTitle(),(0,S.u)("div",{class:at},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:n}=this.viewModel;return t&&!i?(0,S.u)("article",{key:n,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:ht},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n,messagesCommon:s}=this,o=i?s.close:s.open,{menuActions:r}=n;return r.length?(0,S.u)("div",{key:$t("actions-menu-button"),class:this.classes(ft,Mt),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},(0,S.u)("span",{"aria-hidden":"true",class:Be})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:n}=this,{menuActions:s}=n;return s.length&&i?(0,S.u)("ul",{id:e,role:"menu","aria-labelledby":t,key:$t("actions"),class:Ct,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map((e=>this.renderAction({action:e,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map((e=>this.renderAction({action:e,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,n=!!t.length;return i||n?(0,S.u)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":n.toString(),class:wt},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,S.u)("section",{key:$t("navigation"),class:this.classes(xt)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:n}=t,s=!!i.length,o=!!n.length,r={[pt]:e,[gt]:s,[_t]:o};return e||s?(0,S.u)("div",{key:$t("feature-buttons"),class:this.classes(dt,r)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,n=(0,we.n)(e.selectedFeatures,{total:t.length});return(0,S.u)("section",{key:$t("menu"),class:Vt},(0,S.u)("strong",{class:Zt},n),(0,S.u)("nav",{bind:this,class:zt,"data-node-ref":"_featureMenuViewportNode",afterCreate:T.Yo},this.renderFeatureMenu(),(0,S.u)("div",{class:Wt,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?(0,S.u)("div",{class:jt},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:(0,S.u)("div",{key:$t("pointer"),class:It,role:"presentation"},(0,S.u)("div",{class:this.classes(Ot,Ue)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:n,contentId:s,collapsible:o,hasContent:r,contentCollapsed:a,visibleElements:l}=this,{title:u}=this.viewModel,c="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,h="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,d={[Ue]:e,[ze]:o,[Ze]:a};return(0,S.u)("div",{class:this.classes(Re,Ve,d),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":u?n:"","aria-describedby":r&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null)}renderContent(){const e=this.viewModel?.content;return e?"string"==typeof e?(0,S.u)("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return(0,S.u)("span",{key:"text",class:Et},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),n={[Se]:e.active,[Le]:e.active,[yt]:!!t,[Ft]:!e.active&&!!i};return t&&(n[t]=!e.active),(0,S.u)("span",{key:"icon","aria-hidden":"true",class:this.classes(yt,n),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,n=this._getActionTitle(t),s={[Pt]:"toggle"!==t.type,[kt]:"toggle"===t.type,[At]:"toggle"===t.type&&t.value,[vt]:t.disabled},o=[this.renderActionIcon(t),this.renderActionText(n)],r="menu-item"===i?(0,S.u)("li",{key:t.uid,role:"menuitem",tabIndex:0,title:n,"aria-label":n,class:this.classes(ft,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):(0,S.u)("div",{key:t.uid,role:"button",tabIndex:0,title:n,"aria-label":n,class:this.classes(ft,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return t.visible?r:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:n}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:o}=this.viewModel,r=e===o,a={[Ut]:r},l=r?(0,S.u)("span",{key:$t(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:Te}):null,u=(0,S.u)("span",{innerHTML:e.title||n.untitled});return(0,S.u)("li",{role:"menuitem",tabIndex:-1,key:$t(`feature-menu-feature-${s}`),class:this.classes(a,Ht),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},(0,S.u)("span",{class:qt},u,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?(0,S.u)("ol",{class:Rt,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:n}=this,{id:s}=e,o=i?.attributes,r="zoom-to-feature"===s?(0,we.n)(e.title,{messages:t}):"remove-selected-feature"===s?(0,we.n)(e.title,{messages:n}):"zoom-to-clustered-features"===s||"browse-clustered-features"===s?(0,we.n)(e.title,{messages:t}):e.title;return r&&o?(0,we.n)(r,o):r}_getActionClass(e){const{selectedFeature:t}=this,i=t?.attributes,{className:n,image:s}=e,o=s||n?n:Ne;return o&&i?(0,we.n)(o,i):o}_getActionImage(e){const{selectedFeature:t}=this,i=t?.attributes,{image:n}=e;return n&&i?(0,we.n)(n,i):n}_createFeatureUpdatedAnimation(){return(0,T.vU)("enter",ot)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add((0,o.YP)((()=>[e.uid,e.active,e.className,e.disabled,e.id,e.title,e.image,e.visible]),(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter((e=>e.visible)),i=this._getInlineActionCount(),n=null===i,s=0===i;return{inlineActions:n?t.slice(0):s?new c.Z:t.slice(0,i),menuActions:n?new c.Z:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title="error"===e.viewModel?.state?t.errorMessage:e.viewModel?.title||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===(0,f.kK)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===(0,f.kK)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=(0,f.kK)(e),{_featureMenuNode:i}=this,n=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),o=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(n+1+o)%o].focus()):(e.stopPropagation(),s[(n-1+o)%o].focus())}_handleActionMenuItemKeyup(e){const t=(0,f.kK)(e),{_actionsMenuNode:i}=this,n=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,o=s.findIndex((e=>e.uid===n));if(!i)return;const r=i.querySelectorAll("li"),a=r.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),r[r.length-1].focus()):(e.stopPropagation(),r[0].focus()):(e.stopPropagation(),r[(o+1+a)%a].focus()):(e.stopPropagation(),r[(o-1+a)%a].focus())}_handleMainKeyup(e){const t=(0,f.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await(0,o.N1)((()=>!0===this.viewModel?.active)),this.focus())}_addSelectedFeatureIndexHandle(){const e=(0,o.YP)((()=>this.viewModel?.selectedFeatureIndex),((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,Me)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:n,side:s,view:o}=e;if(isNaN(i)||isNaN(t)||!o||!n)return!1;const r=o.padding;return"right"===s&&n.x+i/2>o.width-r.right||"left"===s&&n.x-i/2<r.left||"top"===s&&n.y-t<r.top||"bottom"===s&&n.y+t>o.height-r.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:n,viewModel:s}=this,{screenLocation:o,view:r}=s;if((0,y.Wi)(o)||!r||!i)return"top-center";if(!this._isScreenLocationWithinView(o,r))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=n?window.getComputedStyle(n,null):null,u=l?a(l.getPropertyValue("max-height")):0,c=l?a(l.getPropertyValue("height")):0,{height:h,width:d}=i.getBoundingClientRect(),p=d+t,g=Math.max(h,u,c)+t,_=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"right",view:r}),f=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"left",view:r}),v=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"top",view:r}),m=this._isOutsideView({popupHeight:g,popupWidth:p,screenLocation:o,side:"bottom",view:r});return f?v?"bottom-right":"top-right":_?v?"bottom-left":"top-left":v?m?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return(0,T.dZ)(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){if("auto"!==e)return e;const t=this.viewModel?.view,i=(0,T.dZ)(this.container)?"top-left":"top-right";if(!t)return i;const n=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-n.left-n.right,{breakpoints:o}=t;return o&&s<=o.xsmall?"bottom-center":i}_positionContainer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),n=this._calculatePositionStyle(t,i);n&&(e.style.top=n.top,e.style.left=n.left,e.style.bottom=n.bottom,e.style.right=n.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,n){const{currentAlignment:s,_pointerOffsetInPx:o}=this,r=n/2,a=i.height-t,l=i.width-e,{padding:u}=this.view;return"bottom-center"===s?{top:t+o-u.top,left:e-r-u.left}:"top-left"===s?{bottom:a+o-u.bottom,right:l+o-u.right}:"bottom-left"===s?{top:t+o-u.top,right:l+o-u.right}:"top-right"===s?{bottom:a+o-u.bottom,left:e+o-u.left}:"bottom-right"===s?{top:t+o-u.top,left:e+o-u.left}:"top-center"===s?{bottom:a+o-u.bottom,left:e-r-u.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:n}=this;if(!n)return;if(i)return{left:"",top:"",right:"",bottom:""};if((0,y.Wi)(e)||!t)return;const s=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,n,s);return o?{top:void 0!==o.top?`${o.top}px`:"auto",left:void 0!==o.left?`${o.left}px`:"auto",bottom:void 0!==o.bottom?`${o.bottom}px`:"auto",right:void 0!==o.right?`${o.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[n,s]=e,[o,r]=t,{width:a,height:l}=i;return n<=a&&o>a||n>a&&o<=a||s<=l&&r>l||s>l&&r<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},n=i.left+i.right,s=i.top+i.bottom,o=[],r=[];o[0]=e[0]-n,o[1]=e[1]-s,r[0]=t[0]-n,r[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(o,r,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){const t=e.breakpoint,i=this.viewModel?.view?.ui;if(!i)return!1;const{width:n,height:s}=i;if(isNaN(n)||isNaN(s))return!1;const o=t.hasOwnProperty("width")&&n<=t.width,r=t.hasOwnProperty("height")&&s<=t.height;return o||r}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?(0,we.n)(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Ce),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new V({view:e}),e.ui.add(this._spinner,{key:Ce,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,n=i.findIndex((e=>e.uid===t)),s=i.getItemAt(n);s&&"toggle"===s.type&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(n)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"actionsMenuId",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"actionsMenuButtonId",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"featureMenuId",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"titleId",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"contentId",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"hasContent",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"featureNavigationVisible",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"collapsible",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"featureMenuVisible",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"contentCollapsed",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"dividedActions",null),(0,n._)([(0,w.B)("viewModel.actions")],ei.prototype,"actions",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"actionsMenuOpen",null),(0,n._)([(0,a.Cb)()],ei.prototype,"alignment",void 0),(0,n._)([(0,w.B)("viewModel.autoCloseEnabled")],ei.prototype,"autoCloseEnabled",void 0),(0,n._)([(0,w.B)("viewModel.autoOpenEnabled")],ei.prototype,"autoOpenEnabled",void 0),(0,n._)([(0,w.B)("viewModel.defaultPopupTemplateEnabled")],ei.prototype,"defaultPopupTemplateEnabled",void 0),(0,n._)([(0,w.B)("viewModel.content")],ei.prototype,"content",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"collapsed",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"collapseEnabled",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"currentAlignment",null),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"currentDockPosition",null),(0,n._)([(0,a.Cb)()],ei.prototype,"dockOptions",null),(0,n._)([(0,a.Cb)()],ei.prototype,"dockEnabled",void 0),(0,n._)([(0,w.B)("viewModel.featureCount")],ei.prototype,"featureCount",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"featureMenuOpen",void 0),(0,n._)([(0,w.B)("viewModel.features")],ei.prototype,"features",void 0),(0,n._)([(0,w.B)("viewModel.goToOverride")],ei.prototype,"goToOverride",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"headingLevel",void 0),(0,n._)([(0,w.B)("viewModel.highlightEnabled")],ei.prototype,"highlightEnabled",void 0),(0,n._)([(0,w.B)("viewModel.location")],ei.prototype,"location",void 0),(0,n._)([(0,a.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ei.prototype,"label",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"maxInlineActions",void 0),(0,n._)([(0,a.Cb)(),(0,ye.H)("esri/widgets/Popup/t9n/Popup")],ei.prototype,"messages",void 0),(0,n._)([(0,a.Cb)(),(0,ye.H)("esri/t9n/common")],ei.prototype,"messagesCommon",void 0),(0,n._)([(0,w.B)("viewModel.promises")],ei.prototype,"promises",void 0),(0,n._)([(0,w.B)("viewModel.selectedFeature")],ei.prototype,"selectedFeature",void 0),(0,n._)([(0,w.B)("viewModel.selectedFeatureIndex")],ei.prototype,"selectedFeatureIndex",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],ei.prototype,"selectedFeatureWidget",null),(0,n._)([(0,a.Cb)()],ei.prototype,"spinnerEnabled",void 0),(0,n._)([(0,w.B)("viewModel.title")],ei.prototype,"title",void 0),(0,n._)([(0,w.B)("viewModel.updateLocationEnabled")],ei.prototype,"updateLocationEnabled",void 0),(0,n._)([(0,w.B)("viewModel.view")],ei.prototype,"view",void 0),(0,n._)([(0,a.Cb)({type:fe}),(0,be.s)(["triggerAction","trigger-action"])],ei.prototype,"viewModel",void 0),(0,n._)([(0,w.B)("viewModel.visible")],ei.prototype,"visible",void 0),(0,n._)([(0,a.Cb)()],ei.prototype,"visibleElements",void 0),(0,n._)([(0,M.p)("visibleElements")],ei.prototype,"castVisibleElements",null),(0,n._)([(0,me.h)()],ei.prototype,"_close",null),(0,n._)([(0,me.h)()],ei.prototype,"_toggleDockEnabled",null),(0,n._)([(0,me.h)()],ei.prototype,"_toggleFeatureMenu",null),(0,n._)([(0,me.h)()],ei.prototype,"_toggleActionsMenu",null),(0,n._)([(0,me.h)()],ei.prototype,"_triggerAction",null),(0,n._)([(0,me.h)()],ei.prototype,"_selectFeature",null),(0,n._)([(0,me.h)()],ei.prototype,"_next",null),(0,n._)([(0,me.h)()],ei.prototype,"_previous",null),ei=(0,n._)([(0,l.j)(Xt)],ei);const ti=ei,ii=[0,0];function ni(e){e&&((0,s.cS)(e),e.parentNode&&e.parentNode.removeChild(e))}const si=750,oi=e=>{let t=class extends e{constructor(){super(...arguments),this._freqInfo={freq:16,time:si},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([(0,o.YP)((()=>this.cursor),(e=>{const{surface:t}=this;t&&t.setAttribute("data-cursor",e)})),(0,o.YP)((()=>this.interacting),(e=>{const{surface:t}=this;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add((0,o.YP)((()=>this.ui),((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),ni(this.root),this._set("root",null),(0,s.YD)(this.userContent,t),ni(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",(0,s.YD)(e,t),e.appendChild(t),this._set("userContent",t);const n=document.createElement("div");n.className="esri-view-root",e.insertBefore(n,e.firstChild),this._set("root",n);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,n.appendChild(a),this._set("surface",a);const l=new g;n.appendChild(l.surface),this._set("overlay",l),(0,o.YP)((()=>l.needsRender),(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,r.A)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,o.YP)((()=>this.size),(e=>{const[t,i]=e,n="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?a.classList.add(n):a.classList.remove(n)}),o.nn),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new ti({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const n=this.position;return e-=n[0],t-=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const n=this.position;return e+=n[0],t+=n[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,o.YP)((()=>this.root),(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null}),o.nn),(0,o.YP)((()=>this.popup),((t,i)=>{const n="popup";i&&e.remove(i,n),t&&(t.view=e.view,e.add(t,{key:n,position:"manual"}))}),o.nn)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=si,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=si};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),(0,r.A)({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const n=this._position();i.freq=n||t?16:Math.min(si,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const n=this.width,s=this.height;return t===n&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=function(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return ii[0]=i.left+t.pageXOffset,ii[1]=i.top+t.pageYOffset,ii}(e);return(!t||i[0]!==t[0]||i[1]!==t[1])&&(this._set("position",[i[0],i[1]]),!0)}forceDOMReadyCycle(){}};return(0,n._)([(0,a.Cb)({value:null,cast:e=>(0,s.L7)(e)})],t.prototype,"container",null),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"focused",null),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"height",void 0),(0,n._)([(0,a.Cb)({type:ti})],t.prototype,"popup",null),(0,n._)([(0,a.Cb)({type:g})],t.prototype,"overlay",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"position",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"resizing",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"root",void 0),(0,n._)([(0,a.Cb)({value:null,readOnly:!0})],t.prototype,"size",null),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"surface",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"suspended",void 0),(0,n._)([(0,a.Cb)()],t.prototype,"ui",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"userContent",void 0),(0,n._)([(0,a.Cb)({readOnly:!0})],t.prototype,"width",void 0),(0,n._)([(0,a.Cb)()],t.prototype,"widthBreakpoint",void 0),t=(0,n._)([(0,l.j)("esri.views.DOMContainer")],t),t};function ri(e){return e&&"focus"in e}},45371:(e,t,i)=>{i.d(t,{a:()=>r});var n=i(32718);class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const i of this.keyModifiers)if(!t.has(i))return!1;return!0}}const o=n.Z.getLogger("esri.views.input.InputHandler");class r{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?o.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let n;"function"==typeof t?(i=t,n=[]):n=t||[];const o="string"==typeof e?new s(e,n):e,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},l=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),r(),this._manager&&this._manager.updateDependencies()}},u=new a(o,i,{onPause:l,onRemove:l,onResume:e=>{const t=this._incoming[e.match.eventType];t&&!t.includes(e)&&(t.push(e),r(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[o.eventType];return c||(c=[],this._incoming[o.eventType]=c),c.push(u),r(),this._manager&&this._manager.updateDependencies(),u}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new l(e,{onEmit:(e,t,i,n)=>{this._manager.emit(e.eventType,t,i,n)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):o.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class a{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class l{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}},91806:(e,t,i)=>{i.d(t,{$:()=>_,f:()=>m});var n=i(27366),s=i(85015),o=i(32718),r=i(92026),a=i(43e3),l=i(49861),u=(i(63780),i(93169),i(25243),i(69912)),c=i(76419),h=i(67750),d=i(45371);class p extends d.a{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse",e.data.x,e.data.y)}))}_setValue(e,t,i){e===this._value&&this._x===t&&this._y===i||(this._value=e,this._x=t,this._y=i,this._onChange(e,t,i))}}const g=o.Z.getLogger("esri.views.input.InputManager");let _=class extends s.Z{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=h.CK,this.latestPointerType="mouse",this._propertiesPool=new c.L({latestPointerLocation:y},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m.INTERNAL;if(this._nameToGroup[e])return void g.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void g.error("Can't register a group of zero handlers");const n={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const e=n.handlers[s];this._handlers.push(e),e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(t,i,n,s,o)=>{this._emitInputEvent(e.priorityIndex+1,t,i,n,o,s)},setPointerCapture:(t,i)=>{this._setPointerCapture(n,e,t,i)},setEventCallback:t=>{e.eventCallback=t},setUninstallCallback:t=>{e.uninstallCallback=t},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):g.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const e=this._handlers[i];e.priorityIndex=i,this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s)for(const t of n.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of n.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)(0,h.wj)(e)||t.add(e)}n.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const n=this._get("latestPointerLocation");if((0,r.Wi)(n)||n.x!==t||n.y!==i){const e=this._propertiesPool.get("latestPointerLocation");e.x=t,e.y=i,this._set("latestPointerLocation",e)}}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,n=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,n)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const n=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(n(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(n(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const o=t.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new p(((e,t,i)=>this._setLatestPointer(e,t,i))),this.installHandlers("input-manager-logic",[this._latestPointerHandler],m.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,m.INTERNAL)}_setPointerCapture(e,t,i,n){const s=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),0===o.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,n){this._emitInputEvent(0,e,t,i,n)}_emitInputEvent(e,t,i,n,s,o){const r=void 0!==n?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new f(t,i,r,o||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new a.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),n=t.data&&t.data.eventId;if(null==n||!this._stoppedPropagationEventIds.has(n))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=n&&this._stoppedPropagationEventIds.add(n);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new a.Z;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>e.keyModifiers.includes(t)));if(t.length===i.keyModifiers.length!==(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};(0,n._)([(0,l.Cb)({readOnly:!0})],_.prototype,"hasPendingInputs",null),(0,n._)([(0,l.Cb)()],_.prototype,"eventSource",void 0),(0,n._)([(0,l.Cb)()],_.prototype,"recognizers",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],_.prototype,"latestPointerType",void 0),(0,n._)([(0,l.Cb)({readOnly:!0})],_.prototype,"latestPointerLocation",void 0),_=(0,n._)([(0,u.j)("esri.views.input.InputManager")],_);class f{constructor(e,t,i,n,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=v.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=v.STOPPED}shouldStopPropagation(){return 0!=(this._propagationState&v.STOPPED)}async(e){this._propagationState|=v.PAUSED;const t=(e,t)=>{this._propagationState&=~v.PAUSED;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(this._propagationState&v.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}var v;!function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"}(v||(v={}));const m={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class y{}},67750:(e,t,i)=>{i.d(t,{CK:()=>s,kK:()=>r,wj:()=>a});var n=i(98928);const s=(0,i(93169).Z)("mac")?"Meta":"Ctrl",o={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let l=48;l<58;l++)o[l]=String.fromCharCode(l);for(let l=1;l<25;l++)o[111+l]=`F${l}`;for(let l=65;l<91;l++)o[l]=[String.fromCharCode(l+32),String.fromCharCode(l)];function r(e){if(void 0!==e.key)return(0,n.kK)(e);const t=o[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function a(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},69787:(e,t,i)=>{i.d(t,{rs:()=>o,tl:()=>s});var n=i(92026);function s(e){return e&&"function"==typeof e.highlight}function o(e,t,i){return(0,n.Wi)(e)||e>i&&(0===t||e<t)}},72612:(e,t,i)=>{i.d(t,{Eu:()=>o,Rw:()=>a,s6:()=>r,vT:()=>s});i(93169);var n=i(17842);function s(e){return(0,n.vW)(e.x,e.y)}function o(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,n.vW)(t.clientX-i.left,t.clientY-i.top)}function r(e,t){return t instanceof Event?o(e,t):s(t)}function a(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}},93531:(e,t,i)=>{function n(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,n=Array.isArray(e)?e:function(e){return e.split(",").map((e=>e.trim()))}(e);i.push(...n)}}i.d(t,{s:()=>n})}}]);
//# sourceMappingURL=5002.f6823ad7.chunk.js.map