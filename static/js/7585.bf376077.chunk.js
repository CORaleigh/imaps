"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[7585],{47585:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var i=a(72791),l=a(54901),r=a(64326),n=a(73937),o=a(81734),s=a(61524),d=a(91946),c=a(64128);let u;const m=async e=>{if(e.added.length){const t=await u.layer.queryFeatures({objectIds:[e.added[0].feature.getObjectId()],returnGeometry:!0});if(t.features.length){const e=t.features[0];e.setAttribute("type","address"),e.symbol=new d.Z({url:"assets/pin.svg",height:24,width:24}),(0,c.l)(u.view),u.view.graphics.add(e),u.view.goTo({target:e,zoom:18},{easing:"ease-in-out",duration:1e3})}}},p=e=>{e.findColumn("ADDRESS").width=150,e.findColumn("FEATURETYPE").width=150,setTimeout((()=>{const t=e.container.querySelector("vaadin-grid");null===t||void 0===t||t.addEventListener("click",(a=>{if("VAADIN-GRID-CELL-CONTENT"===a.target.nodeName){var i;e.highlightIds.removeAll();const l=(null===(i=t.getEventContext(a))||void 0===i?void 0:i.item).feature;e.highlightIds.add(l.getAttribute("OBJECTID"))}}))}),2e3)};let f;const y=async e=>{const t=new r.default({portalItem:{id:"318be24592ea4dcba042511b3125fd53"},layerId:2});f=t;const a=await t.load(),i=new r.default({source:[],fields:a.fields,geometryType:"point",spatialReference:e.spatialReference,popupTemplate:a.popupTemplate,objectIdField:a.objectIdField,displayField:a.displayField,id:"feature-table"});i.fields.forEach((e=>{e.nullable=!0,"DEED_DATE"===e.name&&(e.type="string")})),e.map.allTables.add(i);try{return await i.load(),i}catch(l){console.log(l)}},b=()=>new o.Z({columnTemplates:[new n.Z({label:"Address",fieldName:"ADDRESS",editable:!1,initialSortPriority:0,direction:"asc"}),new n.Z({label:"Type",fieldName:"FEATURETYPE",editable:!1,initialSortPriority:1,direction:"asc"})]}),h=async e=>{const t=await e.layer.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["ADDRESS","FEATURETYPE"]});let a="";e.tableTemplate.columnTemplates.forEach((e=>{a+=`${e.label},`})),a+="\r\n",t.features.forEach((t=>{e.tableTemplate.columnTemplates.forEach((e=>{t.attributes[e.fieldName]?a+=`"${t.attributes[e.fieldName]}",`:a+='"",'})),a+="\r\n"}));let i=(new Date).toISOString();i=i.replaceAll(":","").replaceAll("-","");const l=`imaps_addresses_export_${i}.csv`,r=new Blob([a],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(void 0!==n.download){const e=URL.createObjectURL(r);n.setAttribute("href",e),n.setAttribute("download",l),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}};var w=a(80184);function E(e){const t=(0,i.useRef)(),a=(0,i.useRef)(!1);return(0,i.useEffect)((()=>(a.current||(a.current=!0,(async(e,t)=>{var a;const i=await y(t);return u=new l.Z({container:e,view:t,editingEnabled:!1,multiSortEnabled:!0,visibleElements:{selectionColumn:!1,menuItems:{refreshData:!1,toggleColumns:!1}},menuConfig:{items:[new s.Z({label:"Export",iconClass:"esri-icon-download",clickFunction:()=>{h(u)}})]},tableTemplate:b(),layer:i}),await(null===(a=u)||void 0===a?void 0:a.when()),u.on("selection-change",m),p(u),u})(t.current,e.view).then((t=>{(async(e,t)=>{if(t)try{var a;(0,c.l)(t.view);const i=await(null===(a=f)||void 0===a?void 0:a.queryFeatures({geometry:e.geometry,outFields:["ADDRESS","FEATURETYPE"],returnGeometry:!0,where:"1=1"})),l=await t.layer.queryFeatures({where:"1=1",returnGeometry:!0});await t.layer.applyEdits({deleteFeatures:l.features}),await t.layer.applyEdits({addFeatures:i.features}),t.refresh()}catch(i){console.log(i)}})(e.property,t)}))),()=>{})),[]),(0,w.jsx)("div",{id:"address-table",ref:t})}const g=i.memo(E)}}]);
//# sourceMappingURL=7585.bf376077.chunk.js.map