(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[38],{1063:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return f})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return y}));var r=i(89),a=i(113);i(101);var s=class{constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}decreaseRefCount(e,t){var i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){var a=r.get(i);return a.refCount--,a.refCount<=0&&(r.delete(i),a.controller&&a.controller.abort()),a.refCount}return 0}getBlock(e,t){var i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){var a=r.get(i);return a.ts=Date.now(),a.refCount++,r.delete(i),r.set(i,a),a.block}return null}putBlock(e,t,i,r=null){var a=this._cachedBlocks,s=e+"/"+t;if(a.has(s)){var n=a.get(s);n.ts=Date.now(),n.refCount++}else a.set(s,{block:i,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}deleteBlock(e,t){var i=this._cachedBlocks,r=e+"/"+t;i.has(r)&&i.delete(r)}updateMaxSize(e){this._size=e,this.trim()}empty(){this._cachedBlocks.clear(),this.clearTimer()}getCurrentSize(){return this._cachedBlocks.size}updateTimer(){if(null==this._timer){var e=this._cachedBlocks;this._timer=setInterval((()=>{for(var t=Array.from(e),i=Date.now(),r=0;r<t.length&&t[r][1].ts<=i-this._duration;r++)e.delete(t[r][0]);0===e.size&&this.clearTimer()}),this._interval)}}trim(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),i=0;i<t.length-this._size;i++)e.delete(t[i][0])}clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}},n=i(723),l=new Map,o=new s;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function u(e,t){var i={extent:null,rasterInfo:t,cache:new Map};if(l.has(e)){var r=l.get(e);return r.push(i),r.length-1}return l.set(e,[i]),0}function c(e,t){if(l.has(e)){var i=l.get(e);i[t]=null,i.some((e=>null!=e))||l.delete(e)}}function p(e,t,i){if(!l.has(e))return null==t?o.decreaseRefCount(e,i):0;var r=l.get(e);if(null==r[t])return o.decreaseRefCount(e,i);var a=r[t].cache;if(a.has(i)){var s=a.get(i);if(s.refCount--,0===s.refCount){a.delete(i);for(var n=0;n<r.length;n++)r[n]&&r[n].cache.has(i)&&r[n].cache.delete(i);s.controller&&s.controller.abort()}return s.refCount}return 0}function d(e,t,i){if(!l.has(e))return null==t?o.getBlock(e,i):null;var r=l.get(e);if(null==r[t]){for(var a=0;a<r.length;a++)if(r[a]&&r[a].cache.has(i)){var s=r[a].cache.get(i);return s.refCount++,s.block}return o.getBlock(e,i)}var n=r[t].cache;if(n.has(i)){var h=n.get(i);return h.refCount++,h.block}for(var u=0;u<r.length;u++)if(u!==t&&r[u]&&r[u]&&r[u].cache.has(i)){var c=r[u].cache.get(i);return c.refCount++,n.set(i,c),c.block}return null}function f(e,t,i,r,a=null){if(l.has(e)){var s=l.get(e);if(null!=s[t]){var n={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:a};r.then((()=>n.isResolved=!0)).catch((()=>n.isRejected=!0)),s[t].cache.set(i,n)}else o.putBlock(e,i,r,a)}else null==t&&o.putBlock(e,i,r,a)}function m(e,t,i){if(l.has(e)){var r=l.get(e);null!=r[t]?r[t].cache.delete(i):o.deleteBlock(e,i)}else null==t&&o.deleteBlock(e,i)}function y(e,t,i,s,o,h,u=null){var c=function(e,t){if(!l.has(e))return null;var i=l.get(e);return null==i[t]?null:i[t]}(e,t),p=c.extent,{cache:d,rasterInfo:f}=c;if(!p||p.xmin!==i.xmin||p.xmax!==i.xmax||p.ymin!==i.ymin||p.ymax!==i.ymax){for(var m=i.clone().normalize(),{spatialReference:y,transform:b}=f,x=new Set,v=0;v<m.length;v++){var g=m[v];if(!(g.xmax-g.xmin<=s||g.ymax-g.ymin<=s)){var w=Object(n.e)(g,y,u);Object(r.k)(b)&&(w=b.inverseTransform(w));var _=new a.a({x:s,y:s,spatialReference:g.spatialReference});if(null==o&&!(o=Object(n.g)(_,y,g,u)))return;var{pyramidLevel:j,pyramidResolution:O,excessiveReading:T}=Object(n.h)(o,f,h||"closest");if(T)return;for(var{storageInfo:k}=f,{origin:R}=k,M={x:Math.max(0,Math.floor((w.xmin-R.x)/O.x)),y:Math.max(0,Math.floor((R.y-w.ymax)/O.y))},I=Math.ceil((w.xmax-w.xmin)/O.x-.1),P=Math.ceil((w.ymax-w.ymin)/O.y-.1),C=j>0?k.pyramidBlockWidth:k.blockWidth,S=j>0?k.pyramidBlockHeight:k.blockHeight,U=Math.max(0,Math.floor(M.x/C)-1),A=Math.max(0,Math.floor(M.y/S)-1),B=Math.floor((M.x+I-1)/C)+1,z=Math.floor((M.y+P-1)/S)+1,G=A;G<=z;G++)for(var V=U;V<=B;V++)x.add("".concat(j,"/").concat(G,"/").concat(V))}}d.forEach(((e,t)=>{if(!x.has(t)){var i=d.get(t);(null==i||i.isResolved||i.isRejected)&&d.delete(t)}})),c.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}}},1239:function(e,t,i){"use strict";i.r(t);var r=i(7),a=i(82),s=(i(80),i(89)),n=i(81),l=(i(88),i(85)),o=i(84),h=(i(83),i(86),i(87),i(94)),u=i(113),c=i(103),p=(i(101),i(105)),d=i(123),f=i(108),m=i(470),y=i(336),b=i(556),x=i(723),v=i(1063),g=i(444),w=i(640),_=i(508),j=i(577),O=i(607),T=i(382),k=i(482),R=i(93),M=i(650),I=e=>{var t=class extends e{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.fullExtent=null,this.tileInfo=null,this.datumTransformation=null}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}fetchPopupFeatures(e,t){var i=this;return Object(r.a)((function*(){var{layer:r}=i;if(!e)return Promise.reject(new R.a("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:r}));var{popupEnabled:a}=r,n=Object(M.a)(r,t);if(!a||!Object(s.k)(n))throw new R.a("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:n});var l=[],{value:o}=yield r.identify(e);if(o){var h,u,c=o.join(", "),p={ObjectId:0},f="Raster.ServicePixelValue";p[f]=i._formatAttributeValue(c,f);var m=null==(h=r.rasterInfo)||null==(u=h.attributeTable)?void 0:u.features;if(m&&m.length>0){var y=m.filter((e=>{var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===c}));if(y.length>0){var b=y[0];if(b)for(var x in b.attributes)if(b.attributes.hasOwnProperty(x)){var v=i._rasterFieldPrefix+x;p[v]=i._formatAttributeValue(b.attributes[x],v)}}}var g=new d.a(i.fullExtent.clone(),null,p);g.layer=r,g.sourceLayer=g.layer,l.push(g)}return l}))()}updateFullExtent(){var e,t=this.layer.tileInfo;t&&t.spatialReference||(e=new R.a("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));var i=Object(x.b)(this.layer.fullExtent,this.view.spatialReference,!1),r=Object(x.e)(this.layer.fullExtent,this.view.spatialReference,i);return null==r&&(e=new R.a("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",r),this.datumTransformation||(this.datumTransformation=Object(x.b)(this.layer.fullExtent,this.view.spatialReference,!0)),e?Promise.reject(e):Promise.resolve()}_formatAttributeValue(e,t){if("string"==typeof e){var i,r,a=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,s=this._getFieldInfo(a,t),n=s&&s.format;if(n)return e.trim().indexOf(",")>-1?(r=(i=",")+" ",this._formatDelimitedString(e,i,r,n)):e.trim().indexOf(" ")>-1?(i=r=" ",this._formatDelimitedString(e,i,r,n)):this._formatNumberFromString(e,n)}return e}_getFieldInfo(e,t){if(e&&e.length&&t){var i,r=t.toLowerCase();return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r&&e.fieldName.toLowerCase()!==r.replace(/ /g,"_"))&&(i=e,!0))),i}}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map((e=>this._formatNumberFromString(e,r))).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;var i=Number(e);return isNaN(i)?e:t.format(i)}};return Object(a.a)([Object(l.b)()],t.prototype,"layer",void 0),Object(a.a)([Object(l.b)()],t.prototype,"view",void 0),Object(a.a)([Object(l.b)()],t.prototype,"fullExtent",void 0),Object(a.a)([Object(l.b)()],t.prototype,"tileInfo",void 0),Object(a.a)([Object(l.b)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(a.a)([Object(o.a)("esri.views.layers.ImageryTileLayerView")],t)},P=i(125),C=i(661),S=i(127),U=i(636),A=i(432),B=i(404),z=i(305),G=i(395),V=i(238),q=i(415),F=i(897),L={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};class E extends q.a{constructor(e=null,t=null,i=null){super(),this._textureInvalidated=!0,this._memoryUsed=null,this._supportsBilinear=!0,this.stencilRef=0,this.coordScale=[1,1],this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.transforms={dvs:Object(G.b)()},this.source=e,this.transformGrid=t,this.interpolation=i}destroy(){var e=this.getTextures();null==e||e.textures.forEach((e=>e.dispose())),this._rasterTexture=null,this._transformGridTexture=null,this._colormapTexture=null}get symbolizerParameters(){return this._symbolizerParameters||L}set symbolizerParameters(e){this._symbolizerParameters=e}get source(){return this._source}set source(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._memoryUsed=null)}get suspended(){return this._suspended}set suspended(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}get bandIds(){return this._bandIds}set bandIds(e){this._bandIds=e,this.invalidateTexture()}get interpolation(){return this._interpolation}set interpolation(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==e&&"cubic"!==e?9728:9729)}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}setTransform(e){var t=Object(z.e)(this.transforms.dvs),[i,r]=e.toScreenNoRotation([0,0],this.x,this.y),a=this.resolution/this.pixelRatio/e.resolution,s=a*this.width,n=a*this.height,l=Math.PI*this.rotation/180;Object(z.a)(t,t,Object(V.b)(i,r)),Object(z.a)(t,t,Object(V.b)(s/2,n/2)),Object(z.i)(t,t,-l),Object(z.a)(t,t,Object(V.b)(-s/2,-n/2)),Object(z.f)(t,t,Object(V.b)(s,n)),Object(z.g)(this.transforms.dvs,e.displayViewMat3,t)}getTextures(){if(!this._rasterTexture)return null;var e=[],t=[];return this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap")),{names:e,textures:t}}getMemoryUsage(){if(Object(s.j)(this._memoryUsed)){var e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map((e=>e.descriptor.width*e.descriptor.height*4)).reduce(((e,t)=>e+t))}return this._memoryUsed}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:e}){var t,i,r;if(!this.stage)return null==(t=this._rasterTexture)||t.dispose(),null==(i=this._transformGridTexture)||i.dispose(),null==(r=this._colormapTexture)||r.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);if(this._textureInvalidated){this._textureInvalidated=!1;var a=this.source,s=a&&a.pixels&&a.pixels.length>0;this._createOrDestroyRasterTexture(e),this._rasterTexture&&(s?(this._updateColormapTexture(e),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=Object(F.c)(e,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())}}_createOrDestroyRasterTexture(e){var t,i,r=this.source?Object(b.h)(this.source,this.bandIds):null;if(r&&r.pixels&&r.pixels.length>0){var a=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}var s=this.interpolation||"nearest",n=this.isRendereredSource||!(null!=(t=e.capabilities.textureFloat)&&t.textureFloat);this._rasterTexture=Object(F.b)(e,r,s,n),this._supportsBilinear=null==(i=e.capabilities.textureFloat)?void 0:i.textureFloatLinear,this._rasterTextureBandIds=this.bandIds}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}_updateColormapTexture(e){var t=this._colormap,i=this.symbolizerParameters.colormap;return i?t?i.length!==t.length||i.some(((e,i)=>e!==t[i]))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Object(F.a)(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=Object(F.a)(e,i),void(this._colormap=i)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}class D extends B.a{constructor(e,t,i,r=null){super(e,t,i),this.bitmap=new E(r,null,null),this.bitmap.coordScale=i,this.bitmap.once("isReady",(()=>this.ready()))}destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}getMemoryUsage(){return this.bitmap.getMemoryUsage()}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}}class N extends A.a{constructor(){super(...arguments),this.isCustomTilingScheme=!1}createTile(e){var t=this._getTileBounds(e);return new D(e,t,this._tileInfoView.tileInfo.size)}destroyTile(){}prepareRenderPasses(e){var t=e.registerRenderPass({name:"bitmap (tile)",brushes:[U.a.raster],target:()=>this.children.map((e=>e.bitmap)),drawPhase:S.c.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===S.c.MAP&&super.doRender(e)}_getTileBounds(e){var t=this._tileInfoView.getTileBounds(Object(P.i)(),e);if(this.isCustomTilingScheme&&e.world){var{tileInfo:i}=this._tileInfoView,r=Object(C.o)(i.spatialReference);if(r){var{resolution:a}=i.lodAt(e.level),s=r/a%i.size[0],n=s?(i.size[0]-s)*a:0;t[0]-=n*e.world,t[2]-=n*e.world}}return t}}var W=i(384),Q=n.a.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),H=[0,0],J=class extends(I(Object(w.a)(Object(W.a)(T.a)))){constructor(){super(...arguments),this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._bitmapView=null,this._emptyTilePixelBlock=null,this._srcResolutions=null,this._previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._globalUpdateRequested=!1,this._isCustomTilingScheme=!1,this.useWebGLForProcessing=!0,this._redrawDebounced=Object(h.i)((e=>this._redrawImage(e)),2e3)}initialize(){var e=this.updateFullExtent();this.addResolvingPromise(e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this._bitmapView.removeAllChildren();var t=this._getCacheSize(e);this._tileStrategy=new O.a({cachePolicy:"purge",resampling:!1,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate()}}hitTest(e,t){if(this.suspended)return Promise.resolve(null);var i=this.view.toMap(Object(p.f)(e,t));return Promise.resolve(new d.a({attributes:{},geometry:i}))}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var{extent:t,resolution:i,scale:r}=e.state,a=this._tileInfoView.getClosestInfoForScale(r);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var n=this._srcResolutions[a.level],l=t.toJSON?t:c.a.fromJSON(t);Object(v.h)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,l,i,n,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this._previousLOD)?void 0:s.level)!==a.level&&(this._previousLOD=a,null!=this._symbolizerParams&&this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}this.notifyChange("updating")}attach(){this.layer.increaseRasterJobHandlerUsage(),Object(g.a)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0),this._initializeTileInfo(),this._tileInfoView=new _.a(this.tileInfo,this.fullExtent),this._fetchQueue=new j.a({tileInfoView:this._tileInfoView,concurrency:10,process:(e,t)=>this.fetchTile(e,t)});var e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new O.a({cachePolicy:"purge",resampling:!1,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:e,tileInfoView:this._tileInfoView}),this._bitmapView=new N(this._tileInfoView),this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme,this.container.addChild(this._bitmapView),this.handles.add([Object(f.d)(this,["layer.bandIds","layer.renderer"],(()=>this._redrawDebounced().catch((e=>{Object(h.m)(e)||Q.error(e)})))),Object(f.d)(this,["layer.interpolation"],((e,t)=>{"majority"!==e&&"majority"!==t||!this._canUseMajorityInterpolationOnDataSource()?this._redrawDebounced().catch((e=>{Object(h.m)(e)||Q.error(e)})):this.refreshDebounced()})),Object(f.d)(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach"),this._updateBlockCacheRegistry()}detach(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,Object(v.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=Object(h.d)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.requestUpdate()})));var e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return Object(k.a)(e,t,this.view)}doRefresh(){var e=this;return Object(r.a)((function*(){e.updateRequested||e.suspended||(e.layer.updateRenderer(),e._updateSymbolizerParams(),e._updateBlockCacheRegistry(!0),e._fetchQueue.reset(),e._tileStrategy.tiles.forEach((t=>e._enqueueTileFetch(t))),e.notifyChange("updating"))}))()}isUpdating(){return this._fetchQueue.length>0||this._globalUpdateRequested}acquireTile(e){var t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(H,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(()=>{e.destroy(),this.requestUpdate()})),this.requestUpdate()}fetchTile(e,t){var i=!Object(s.j)(t)&&t.signal,r=this._canUseWebGLForProcessing(),a={tileInfo:this.tileInfo,signal:Object(s.q)(i),registryId:this._blockCacheRegistryId,requestRawData:r,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:r?"nearest":this.layer.interpolation};return this.layer.fetchTile(e.level,e.row,e.col,a)}_canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}_getCacheSize(e){return e?40:0}_initializeTileInfo(){var e=this.view.spatialReference,t=new u.a({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:r,isCustomTilingScheme:a}=Object(x.a)(this.layer.rasterInfo,e),s=y.a.create({spatialReference:e,size:512,scales:i});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=a,this._set("tileInfo",s),this._srcResolutions=null!=r?r:[]}_enqueueTileFetch(e,t){var i=this;return Object(r.a)((function*(){if(!i._fetchQueue.has(e.key.id)){try{var t=yield i._fetchQueue.push(e.key),{bandIds:r}=i.layer,a=!i.useProgressiveUpdate||i.hasTilingEffects&&!i._globalSymbolizerParams;if(i._globalUpdateRequested&&!i.moving&&0===i._fetchQueue.length){a=!1;try{yield i._redrawImage(i._abortController&&i._abortController.signal)}catch(u){Object(h.m)(u)&&Q.error(u)}i._globalUpdateRequested=!1}var s=i._canUseWebGLForProcessing();if(s&&!i.hasTilingEffects&&null==i._symbolizerParams&&i._updateSymbolizerParams(),t&&t.pixelBlock){var n={extent:t.extent,pixelBlock:t.pixelBlock};if(e.bitmap.rawPixelData=n,s)e.bitmap.source=t.pixelBlock,e.bitmap.isRendereredSource=!1;else{var l=yield i.layer.applyRenderer(n,i.hasTilingEffects&&i._globalSymbolizerParams&&"stretch"===i._globalSymbolizerParams.type?i._globalSymbolizerParams:null);e.bitmap.source=l,e.bitmap.isRendereredSource=!0}e.bitmap.symbolizerParameters=s?i._globalSymbolizerParams||i._symbolizerParams:null,s?e.bitmap.transformGrid||(e.bitmap.transformGrid=t.transformGrid):e.bitmap.transformGrid=null}else{var o=i._createEmptyTilePixelBlock();e.bitmap.source=o,e.bitmap.symbolizerParameters=s?i._symbolizerParams:null,e.bitmap.transformGrid=null}e.bitmap.bandIds=r,e.bitmap.width=i._tileInfoView.tileInfo.size[0],e.bitmap.height=i._tileInfoView.tileInfo.size[1],e.bitmap.interpolation=i._getLayerInterpolation(),e.bitmap.suspended=a,e.bitmap.invalidateTexture(),e.once("attach",(()=>i.requestUpdate())),i._bitmapView.addChild(e)}catch(u){Object(h.m)(u)||Q.error(u)}i.requestUpdate()}}))()}_redrawImage(e){var t=this;return Object(r.a)((function*(){t.layer.updateRenderer(),t.hasTilingEffects?yield t._updateGlobalSymbolizerParams(e):(t._updateSymbolizerParams(),t._globalSymbolizerParams=null);var{bandIds:i}=t.layer,a=t._bitmapView.children.map(function(){var e=Object(r.a)((function*(e){var r=t._canUseWebGLForProcessing();!r&&e.bitmap.rawPixelData?(e.bitmap.source=yield t.layer.applyRenderer(e.bitmap.rawPixelData,t.hasTilingEffects&&t._globalSymbolizerParams&&"stretch"===t._globalSymbolizerParams.type?t._globalSymbolizerParams:null),e.bitmap.isRendereredSource=!0):(e.bitmap.isRendereredSource&&e.bitmap.rawPixelData&&(e.bitmap.source=e.bitmap.rawPixelData.pixelBlock),e.bitmap.isRendereredSource=!1),e.bitmap.symbolizerParameters=r?t._globalSymbolizerParams||t._symbolizerParams:null,e.bitmap.bandIds=i,e.bitmap.interpolation=t._getLayerInterpolation(),e.bitmap.suspended=!1}));return function(t){return e.apply(this,arguments)}}());yield Object(h.j)(a),t.container.requestRender()}))()}_createEmptyTilePixelBlock(){if(!this._emptyTilePixelBlock){var e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new m.a({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:"u8"})}return this._emptyTilePixelBlock}_updateGlobalSymbolizerParams(e){var t=this;return Object(r.a)((function*(){var i={srcResolution:t._srcResolutions[t._previousLOD.level],registryId:t._blockCacheRegistryId,signal:e},r=yield t.layer.fetchPixels(t.view.extent,t.view.width,t.view.height,i);if(r&&r.pixelBlock){var a=t.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(b.h)(r.pixelBlock,t.layer.bandIds),isGCS:t.view.spatialReference.isGeographic,resolution:{x:t._previousLOD.resolution,y:t._previousLOD.resolution},bandIds:t.layer.bandIds});!t._canUseWebGLForProcessing()&&a&&"stretch"===a.type&&t.layer.renderer&&"raster-stretch"===t.layer.renderer.type&&(a.factor=a.factor.map((e=>255*e)),a.outMin=Math.round(255*a.outMin),a.outMax=Math.round(255*a.outMax)),t._globalSymbolizerParams=a}}))()}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){var{url:t,rasterInfo:i,multidimensionalDefinition:r,raster:a}=this.layer,s=null!=i&&i.multidimensionalInfo?a.getSliceIndex(r):null,n=Object(v.d)(t,s);if(n!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(v.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(v.f)(n,this.layer.raster.rasterInfo),e){var l=this._tileInfoView.getClosestInfoForScale(this.view.scale),o=this._srcResolutions[l.level];Object(v.h)(n,this._blockCacheRegistryId,this.view.extent,this.view.resolution,o,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=n}}_canUseMajorityInterpolationOnDataSource(){var{bandCount:e,attributeTable:t,colormap:i,pixelType:r}=this.layer.rasterInfo;return 1===e&&(null!=t||null!=i||"u8"===r||"s8"===r)}_getLayerInterpolation(){var e=this.layer.renderer.type;return"raster-colormap"===e||"unique-value"===e||"class-breaks"===e?"nearest":this.layer.interpolation}};Object(a.a)([Object(l.b)()],J.prototype,"useProgressiveUpdate",null);var X=J=Object(a.a)([Object(o.a)("esri.views.2d.layers.ImageryTileLayerView2D")],J);t.default=X},382:function(e,t,i){"use strict";var r=i(82),a=(i(80),i(81)),s=(i(88),i(85)),n=i(84),l=(i(83),i(86),i(87),i(97)),o=i(131),h=i(266),u=i(227),c=i(167),p=class extends(Object(c.b)(Object(h.a)(Object(u.b)(o.a.EventedMixin(l.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw a.a.getLogger(this.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(t,"')"),e),e}}))}get fullOpacity(){var e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(r.a)([Object(s.b)()],p.prototype,"fullOpacity",null),Object(r.a)([Object(s.b)()],p.prototype,"layer",void 0),Object(r.a)([Object(s.b)()],p.prototype,"parent",void 0),Object(r.a)([Object(s.b)({readOnly:!0})],p.prototype,"suspended",null),Object(r.a)([Object(s.b)({readOnly:!0})],p.prototype,"suspendInfo",null),Object(r.a)([Object(s.b)({readOnly:!0})],p.prototype,"legendEnabled",null),Object(r.a)([Object(s.b)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),Object(r.a)([Object(s.b)()],p.prototype,"visible",null);var d=p=Object(r.a)([Object(n.a)("esri.views.layers.LayerView")],p);t.a=d},384:function(e,t,i){"use strict";i.d(t,"a",(function(){return R}));var r,a=i(82),s=(i(80),i(81),i(88),i(85)),n=i(84),l=(i(83),i(86),i(87),i(107)),o=i(293),h=i(108),u=i(90),c=class extends u.a{},p=c=Object(a.a)([Object(n.a)("esri.views.layers.support.ClipArea")],c),d=r=class extends p{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new r({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],d.prototype,"left",void 0),Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],d.prototype,"right",void 0),Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],d.prototype,"top",void 0),Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],d.prototype,"bottom",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],d.prototype,"version",null);var f,m=d=r=Object(a.a)([Object(n.a)("esri.views.layers.support.ClipRect")],d),y=i(492),b=i(166),x=i(103),v=i(130),g=i(100),w=(i(101),{base:b.a,key:"type",typeMap:{extent:x.a,polygon:v.a}}),_=f=class extends p{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new f({geometry:this.geometry.clone()})}};Object(a.a)([Object(s.b)({types:w,json:{read:g.a,write:!0}})],_.prototype,"geometry",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],_.prototype,"version",null);var j=_=f=Object(a.a)([Object(n.a)("esri.views.layers.support.Geometry")],_),O=class extends p{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(a.a)([Object(s.b)({type:[[[Number]]],json:{write:!0}})],O.prototype,"path",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],O.prototype,"version",null);var T=O=Object(a.a)([Object(n.a)("esri.views.layers.support.Path")],O),k=l.a.ofType({key:"type",base:p,typeMap:{rect:m,path:T,geometry:j}}),R=e=>{var t=class extends e{constructor(){super(...arguments),this.clips=new k,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new y.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.a)(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),Object(h.a)(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),Object(h.a)(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),Object(h.a)(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){var t=!0,i=this.layer,r=i.minScale,a=i.maxScale;if(null!=r&&null!=a){var s=!r,n=!a;!s&&e<=r&&(s=!0),!n&&e>=a&&(n=!0),t=s&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(a.a)([Object(s.b)({type:k,set(e){var t=Object(o.b)(e,this._get("clips"),k);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(a.a)([Object(s.b)()],t.prototype,"moving",void 0),Object(a.a)([Object(s.b)()],t.prototype,"attached",void 0),Object(a.a)([Object(s.b)()],t.prototype,"container",void 0),Object(a.a)([Object(s.b)()],t.prototype,"suspended",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(a.a)([Object(s.b)()],t.prototype,"updateRequested",void 0),Object(a.a)([Object(s.b)()],t.prototype,"updating",null),Object(a.a)([Object(s.b)()],t.prototype,"view",void 0),t=Object(a.a)([Object(n.a)("esri.views.2d.layers.LayerView2D")],t)}},404:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));i(80);var r=i(305),a=i(245),s=i(395),n=i(415);class l extends n.a{constructor(e,t,i,r=i){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:Object(s.b)(),tileMat3:Object(s.b)()},this.triangleCount=0,this.key=new a.a(e),this.bounds=t,this.size=i,this.coordRange=r}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,t){var i=t/(e.resolution*e.pixelRatio),a=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],this.coords),l=this.size[0]/this.coordRange[0]*i,o=this.size[1]/this.coordRange[1]*i;Object(r.j)(a,l,0,0,0,o,0,s,n,1),Object(r.g)(this.transforms.dvs,e.displayViewMat3,a)}}},421:function(e,t,i){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,i=0,r=0;r<e.length;r++){var a=e[r].size;"number"==typeof a&&(t+=a,i++)}return t/i}(e.stops):t}function s(e,t){if(!t)return e;var i=t.filter((e=>"size"===e.type)).map((t=>{var{maxSize:i,minSize:r}=t;return(a(i,e)+a(r,e))/2})),r=0,s=i.length;if(0===s)return e;for(var n=0;n<s;n++)r+=i[n];var l=Math.floor(r/s);return Math.max(l,e)}function n(e){var t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;var a="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return r(a,t.symbol);if("unique-value"===t.type){var n=a;return t.uniqueValueInfos.forEach((e=>{n=r(n,e.symbol)})),n}if("class-breaks"===t.type){var l=a;return t.classBreakInfos.forEach((e=>{l=r(l,e.symbol)})),l}return t.type,a}i.d(t,"a",(function(){return n}))},432:function(e,t,i){"use strict";var r=i(91),a=i(127),s=i(593),n=i(588),l=i(510),o=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends l.a{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(o),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){var{state:t}=e;return Object(r.a)(Object(r.a)({},super.createRenderParams(e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}prepareRenderPasses(e){var t=e.registerRenderPass({name:"stencil",brushes:[n.a],drawPhase:a.c.DEBUG|a.c.MAP|a.c.HIGHLIGHT,target:()=>this.getStencilTarget()}),i=e.registerRenderPass({name:"tileInfo",brushes:[s.a],drawPhase:a.c.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(e),t,i]}getStencilTarget(){return this.children}updateTransforms(e){for(var t of this.children){var i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(){var e=1;for(var t of this.children)t.stencilRef=e++}}t.a=h},470:function(e,t,i){"use strict";var r,a=i(82),s=(i(80),i(92)),n=i(89),l=i(81),o=i(85),h=i(116),u=i(84),c=i(93),p=(i(83),i(86),i(87),i(90)),d=l.a.getLogger("esri.layers.support.PixelBlock"),f=r=class extends p.a{constructor(e){super(e),this.width=null,this.height=null,this.pixelType="f32",this.validPixelCount=null,this.mask=null,this.maskIsAlpha=!1,this.pixels=null,this.statistics=null}static createEmptyBand(e,t){return new(r.getPixelArrayConstructor(e))(t)}static getPixelArrayConstructor(e){var t;switch(e){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"u32":t=Uint32Array;break;case"f32":t=Float32Array;break;case"f64":t=Float64Array;break;case"c64":case"c128":case"unknown":t=Float32Array}return t}castPixelType(e){if(!e)return"f32";var t=e.toLowerCase();return["u1","u2","u4"].indexOf(t)>-1?t="u8":-1===["unknown","u8","s8","u16","s16","u32","s32","f32","f64"].indexOf(t)&&(t="f32"),t}getPlaneCount(){return this.pixels&&this.pixels.length}addData(e){if(!e.pixels||e.pixels.length!==this.width*this.height)throw new c.a("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]),this.statistics||(this.statistics=[]),this.pixels.push(e.pixels),this.statistics.push(e.statistics||{minValue:null,maxValue:null})}getAsRGBA(){var e=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case"s8":case"s16":case"u16":case"s32":case"u32":case"f32":case"f64":this._fillFromNon8Bit(e);break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)}getAsRGBAFloat(){var e=new Float32Array(this.width*this.height*4);return this._fillFrom32Bit(e),e}updateStatistics(){this.statistics=this.pixels.map((e=>this._calculateBandStatistics(e,this.mask)));var e=this.mask,t=0;if(e)for(var i=0;i<e.length;i++)e[i]&&t++;else t=this.width*this.height;this.validPixelCount=t}clamp(e){if(e&&"f64"!==e&&"f32"!==e){var t;switch(e){case"u8":t=[0,255];break;case"u16":t=[0,65535];break;case"u32":t=[0,4294967295];break;case"s8":t=[-128,127];break;case"s16":t=[-32768,32767];break;case"s32":t=[-2147483648,2147483647];break;default:t=[-34e38,34e38]}for(var i,a,s,[n,l]=t,o=this.pixels,h=this.width*this.height,u=o.length,c=[],p=0;p<u;p++){s=r.createEmptyBand(e,h),i=o[p];for(var d=0;d<h;d++)a=i[d],s[d]=a>l?l:a<n?n:a;c.push(s)}this.pixels=c,this.pixelType=e}}extractBands(e){if(Object(n.j)(e)||0===e.length||null==this.pixels||0===this.pixels.length)return this;var t=this.pixels.length,i=e.some((e=>e>=this.pixels.length)),a=t===e.length&&!e.some(((e,t)=>e!==t));return i||a?this:new r({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:e.map((e=>this.pixels[e])),statistics:this.statistics&&e.map((e=>this.statistics[e]))})}clone(){var e,t=new r({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(this.mask instanceof Uint8Array?t.mask=new Uint8Array(this.mask):t.mask=this.mask.slice(0));var i=r.getPixelArrayConstructor(this.pixelType);if(this.pixels&&this.pixels.length>0){t.pixels=[];var a=this.pixels[0].slice;for(e=0;e<this.pixels.length;e++)t.pixels[e]=a?this.pixels[e].slice(0,this.pixels[e].length):new i(this.pixels[e])}if(this.statistics)for(t.statistics=[],e=0;e<this.statistics.length;e++)t.statistics[e]=Object(s.a)(this.statistics[e]);return t}_fillFrom8Bit(e){var{mask:t,maskIsAlpha:i,pixels:r}=this;if(e&&r&&r.length){var a,s,n,l;a=s=n=r[0],r.length>=3?(s=r[1],n=r[2]):2===r.length&&(s=r[1]);var o=new Uint32Array(e),h=this.width*this.height;if(a.length===h)if(t&&t.length===h)if(i)for(l=0;l<h;l++)t[l]&&(o[l]=t[l]<<24|n[l]<<16|s[l]<<8|a[l]);else for(l=0;l<h;l++)t[l]&&(o[l]=255<<24|n[l]<<16|s[l]<<8|a[l]);else for(l=0;l<h;l++)o[l]=255<<24|n[l]<<16|s[l]<<8|a[l];else d.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.")}else d.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFromNon8Bit(e){var{pixels:t,mask:i,statistics:r}=this;if(e&&t&&t.length){var a=this.pixelType,s=1,n=0;if(r&&r.length>0)n=r.map((e=>e.minValue)).reduce(((e,t)=>Math.min(e,t))),s=255/r.map((e=>e.maxValue-e.minValue)).reduce(((e,t)=>Math.max(e,t)));else{var l=255;"s8"===a?(n=-128,l=127):"u16"===a?l=65535:"s16"===a?(n=-32768,l=32767):"u32"===a?l=4294967295:"s32"===a?(n=-2147483648,l=2147483647):"f32"===a?(n=-34e38,l=34e38):"f64"===a&&(n=-Number.MAX_VALUE,l=Number.MAX_VALUE),s=255/(l-n)}var o,h,u,c,p,f=new Uint32Array(e),m=this.width*this.height;if((o=h=u=t[0]).length!==m)return d.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(t.length>=2)if(h=t[1],t.length>=3&&(u=t[2]),i&&i.length===m)for(c=0;c<m;c++)i[c]&&(f[c]=255<<24|(u[c]-n)*s<<16|(h[c]-n)*s<<8|(o[c]-n)*s);else for(c=0;c<m;c++)f[c]=255<<24|(u[c]-n)*s<<16|(h[c]-n)*s<<8|(o[c]-n)*s;else if(i&&i.length===m)for(c=0;c<m;c++)p=(o[c]-n)*s,i[c]&&(f[c]=255<<24|p<<16|p<<8|p);else for(c=0;c<m;c++)p=(o[c]-n)*s,f[c]=255<<24|p<<16|p<<8|p}else d.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")}_fillFrom32Bit(e){var t,i,r,a,{pixels:s,mask:n}=this;if(!e||!s||!s.length)return d.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");t=i=r=s[0],s.length>=3?(i=s[1],r=s[2]):2===s.length&&(i=s[1]);var l=this.width*this.height;if(t.length!==l)return d.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var o=0;if(n&&n.length===l)for(a=0;a<l;a++)e[o++]=t[a],e[o++]=i[a],e[o++]=r[a],e[o++]=1&n[a];else for(a=0;a<l;a++)e[o++]=t[a],e[o++]=i[a],e[o++]=r[a],e[o++]=1}_calculateBandStatistics(e,t){var i,r=1/0,a=-1/0,s=e.length,n=0;if(t)for(i=0;i<s;i++)t[i]&&(r=(n=e[i])<r?n:r,a=n>a?n:a);else for(i=0;i<s;i++)r=(n=e[i])<r?n:r,a=n>a?n:a;return{minValue:r,maxValue:a}}};Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"width",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"height",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"pixelType",void 0),Object(a.a)([Object(h.a)("pixelType")],f.prototype,"castPixelType",null),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"validPixelCount",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"mask",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"maskIsAlpha",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"pixels",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],f.prototype,"statistics",void 0);var m=f=r=Object(a.a)([Object(u.a)("esri.layers.support.PixelBlock")],f);t.a=m},482:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return o}));var r=i(89),a=i(103),s=(i(101),i(117)),n=i(421);function l(e,t,i,n=new a.a){var l;if("2d"===i.type)l=t*i.resolution;else if("3d"===i.type){var o=i.overlayPixelSizeInMapUnits(e),h=i.basemapSpatialReference;l=Object(r.k)(h)&&!h.equals(i.spatialReference)?Object(s.f)(h)/Object(s.f)(i.spatialReference):t*o}var u=e.x-l,c=e.y-l,p=e.x+l,d=e.y+l,{spatialReference:f}=i;return n.xmin=Math.min(u,p),n.ymin=Math.min(c,d),n.xmax=Math.max(u,p),n.ymax=Math.max(c,d),n.spatialReference=f,n}function o(e,t,i){var a=i.toMap(e);return!Object(r.j)(a)&&l(a,Object(n.a)(),i,h).intersects(t)}var h=new a.a},556:function(e,t,i){"use strict";i.d(t,"a",(function(){return k})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return o})),i.d(t,"h",(function(){return s})),i.d(t,"i",(function(){return d})),i.d(t,"j",(function(){return b})),i.d(t,"k",(function(){return y})),i.d(t,"l",(function(){return f})),i.d(t,"m",(function(){return x})),i.d(t,"n",(function(){return T})),i.d(t,"o",(function(){return p}));var r=i(470),a=function(e){return e&&"esri.layers.support.PixelBlock"===e.declaredClass&&e.pixels&&e.pixels.length>0};function s(e,t){if(null==t||!t.length||!a(e))return e;var i=e.pixels.length;return t&&t.some((e=>e>=i))||1===i&&1===t.length&&0===t[0]?e:i!==t.length||t.some(((e,t)=>e!==t))?new r.a({pixelType:e.pixelType,width:e.width,height:e.height,mask:e.mask,validPixelCount:e.validPixelCount,maskIsAlpha:e.maskIsAlpha,pixels:t.map((t=>e.pixels[t])),statistics:e.statistics&&t.map((t=>e.statistics[t]))}):e}function n(e){if(e){var t=e.colormap;if(t&&0!==t.length){var i=t.sort(((e,t)=>e[0]-t[0])),r=0;i[0][0]<0&&(r=i[0][0]);var a,s=Math.max(256,i[i.length-1][0]-r+1),n=new Uint8Array(4*s),l=[],o=0,h=0,u=5===i[0].length;if(s>65536)return i.forEach((e=>{l[e[0]-r]=u?e.slice(1):e.slice(1).concat([255])})),{indexed2DColormap:l,offset:r,alphaSpecified:u};if(e.fillUnspecified)for(o=(a=i[h])[0]-r;o<s;o++)n[4*o]=a[1],n[4*o+1]=a[2],n[4*o+2]=a[3],n[4*o+3]=u?a[4]:255,o===a[0]-r&&(a=h===i.length-1?a:i[++h]);else for(o=0;o<i.length;o++)n[h=4*((a=i[o])[0]-r)]=a[1],n[h+1]=a[2],n[h+2]=a[3],n[h+3]=u?a[4]:255;return{indexedColormap:n,offset:r,alphaSpecified:u}}}}function l(e,t){if(!a(e))return e;if(!t&&(t.indexedColormap||t.indexed2DColormap))return e;var i=e.clone(),r=i.pixels,s=i.mask,n=i.width*i.height;if(1!==r.length)return e;var l,{indexedColormap:o,indexed2DColormap:h,offset:u,alphaSpecified:c}=t,p=o.length-1,d=0,f=r[0],m=new Uint8Array(f.length),y=new Uint8Array(f.length),b=new Uint8Array(f.length),x=0;if(o)if(s)for(d=0;d<n;d++)s[d]&&((x=4*(f[d]-u))<u||x>p?s[d]=0:(m[d]=o[x],y[d]=o[x+1],b[d]=o[x+2],s[d]=o[x+3]));else{for(s=new Uint8Array(n),d=0;d<n;d++)(x=4*(f[d]-u))<u||x>p?s[d]=0:(m[d]=o[x],y[d]=o[x+1],b[d]=o[x+2],s[d]=o[x+3]);i.mask=s}else if(s)for(d=0;d<n;d++)s[d]&&(l=h[f[d]],m[d]=l[0],y[d]=l[1],b[d]=l[2],s[d]=l[3]);else{for(s=new Uint8Array(n),d=0;d<n;d++)l=h[f[d]],m[d]=l[0],y[d]=l[1],b[d]=l[2],s[d]=l[3];i.mask=s}return i.pixels=[m,y,b],i.statistics=null,i.pixelType="u8",i.maskIsAlpha=c,i}function o(e){if(!a(e))return null;e.statistics||e.updateStatistics();var t,i,r,s,n,l,o,h,u,c,p,d,f,m,{pixels:y,mask:b,pixelType:x,statistics:v}=e,g=e.width*e.height,w=y.length,_=[],j=[],O=256;for(s=0;s<w;s++){if(l=new Uint32Array(O),h=y[s],"u8"===x)if(t=-.5,i=255.5,b)for(n=0;n<g;n++)b[n]&&l[h[n]]++;else for(n=0;n<g;n++)l[h[n]]++;else{if(t=v[s].minValue,r=((i=v[s].maxValue)-t)/O,o=new Uint32Array(257),b)for(n=0;n<g;n++)b[n]&&o[Math.floor((h[n]-t)/r)]++;else for(n=0;n<g;n++)o[Math.floor((h[n]-t)/r)]++;for(n=0;n<255;n++)l[n]=o[n];l[255]=o[255]+o[256]}for(_.push({min:t,max:i,size:O,counts:l}),u=0,c=0,f=0,n=0;n<O;n++)u+=l[n],c+=n*l[n];for(m=c/u,n=0;n<O;n++)f+=l[n]*Math.pow(n-m,2);p=(m+.5)*(r=(i-t)/O)+t,d=Math.sqrt(f/(u-1))*r,j.push({min:t,max:i,avg:p,stddev:d})}return{statistics:j,histograms:_}}function h(e){for(var t=[],i=0;i<e.length;i++){for(var{min:r,max:a,size:s,counts:n}=e[i],l=0,o=0,h=0;h<s;h++)l+=n[h],o+=h*n[h];for(var u=o/l,c=0,p=0;p<s;p++)c+=n[p]*Math.pow(p-u,2);var d=(a-r)/s,f=(u+.5)*d+r,m=Math.sqrt(c/(l-1))*d;t.push({min:r,max:a,avg:f,stddev:m})}return t}function u(e){var{minCutOff:t,maxCutOff:i,gamma:r,pixelType:a}=e,s=e.outMin||0,n=e.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(a))return null;var l,o,h=t.length,u=0;"s8"===a?u=-127:"s16"===a&&(u=-32767);var c=256;["u16","s16"].indexOf(a)>-1&&(c=65536);var p=[],d=[],f=n-s;for(l=0;l<h;l++)d[l]=i[l]-t[l],p[l]=f/(i[l]-t[l]);var m,y=r&&r.length>=h,b=[];if(y)for(l=0;l<h;l++)r[l]>1?r[l]>2?b[l]=6.5+Math.pow(r[l]-2,2.5):b[l]=6.5+100*Math.pow(2-r[l],4):b[l]=1;var x,v,g,w=[];if(y)for(l=0;l<h;l++){for(g=[],o=0;o<c;o++)m=((x=o+u)-t[l])/d[l],v=1,r[l]>1&&(v-=Math.pow(1/f,m*b[l])),x<i[l]&&x>t[l]?g[o]=Math.floor(v*f*Math.pow(m,1/r[l]))+s:x>=i[l]?g[o]=n:g[o]=s;w[l]=g}else for(l=0;l<h;l++){for(g=[],o=0;o<c;o++)(x=o+u)<=t[l]?g[o]=s:x>=i[l]?g[o]=n:g[o]=Math.floor((x-t[l])/d[l]*f)+s;w[l]=g}if(null!=e.contrastOffset){var _=function(e,t){var i,r,a=Math.min(Math.max(e,-100),100),s=Math.min(Math.max(t,-100),100),n=255,l=128,o=new Uint8Array(256);for(i=0;i<256;i++)a>0&&a<100?r=(200*i-100*n+2*n*s)/(2*(100-a))+l:a<=0&&a>-100?r=(200*i-100*n+2*n*s)*(100+a)/2e4+l:100===a?r=(r=200*i-100*n+(n+1)*(100-a)+2*n*s)>0?n:0:-100===a&&(r=l),o[i]=r>n?n:r<0?0:r;return o}(e.contrastOffset,e.brightnessOffset);for(l=0;l<h;l++)for(g=w[l],o=0;o<c;o++)g[o]=_[g[o]]}return{lut:w,offset:u}}function c(e,t=256){t=Math.min(t,256);for(var{size:i,counts:r}=e,a=new Uint8Array(i),s=r.reduce(((e,i)=>e+i/t),0),n=0,l=0,o=0,h=s,u=0;u<i;u++)if(o+=r[u],!(u<i-1&&o+r[u+1]<h)){for(;n<t-1&&h<o;)n++,h+=s;for(var c=l;c<=u;c++)a[c]=n;l=u+1}for(var p=l;p<i;p++)a[p]=t-1;return a}function p(e,t){if(!a(e))return null;var i,r,s,n,l,o=e.clone(),{pixels:h,mask:u}=o,{minCutOff:c,maxCutOff:p,gamma:d}=t,f=t.outMin||0,m=t.outMax||255,y=o.width*o.height,b=h.length,x=m-f,v=[],g=[];for(i=0;i<b;i++)g[i]=p[i]-c[i],v[i]=x/(p[i]-c[i]);var w=d&&d.length>=b,_=[];if(w)for(i=0;i<b;i++)d[i]>1?d[i]>2?_[i]=6.5+Math.pow(d[i]-2,2.5):_[i]=6.5+100*Math.pow(2-d[i],4):_[i]=1;if(w)if(null!=u){for(r=0;r<y;r++)if(u[r])for(i=0;i<b;i++)l=((s=h[i][r])-c[i])/g[i],n=1,d[i]>1&&(n-=Math.pow(1/x,l*_[i])),s<p[i]&&s>c[i]?h[i][r]=Math.floor(n*x*Math.pow(l,1/d[i]))+f:s>=p[i]?h[i][r]=m:h[i][r]=f}else for(r=0;r<y;r++)for(i=0;i<b;i++)l=((s=h[i][r])-c[i])/g[i],n=1,d[i]>1&&(n-=Math.pow(1/x,l*_[i])),s<p[i]&&s>c[i]?h[i][r]=Math.floor(n*x*Math.pow(l,1/d[i]))+f:s>=p[i]?h[i][r]=m:h[i][r]=f;else if(null!=u){for(r=0;r<y;r++)if(u[r])for(i=0;i<b;i++)(s=h[i][r])<p[i]&&s>c[i]?h[i][r]=Math.floor((s-c[i])/g[i]*x)+f:s>=p[i]?h[i][r]=m:h[i][r]=f}else for(r=0;r<y;r++)for(i=0;i<b;i++)(s=h[i][r])<p[i]&&s>c[i]?h[i][r]=Math.floor((s-c[i])/g[i]*x)+f:s>=p[i]?h[i][r]=m:h[i][r]=f;return o.pixelType="u8",o.updateStatistics(),o}function d(e,t){if(!a(e))return null;var i,s,{pixels:n,mask:l}=e,o=e.width*e.height,h=n.length,u=t.lut,{offset:c}=t;u&&1===u[0].length&&(u=n.map((()=>u)));var p,d,f,m=[];if(c)if(null==l)for(i=0;i<h;i++){for(p=n[i],d=u[i],f=new Uint8Array(o),s=0;s<o;s++)f[s]=d[p[s]-c];m.push(f)}else for(i=0;i<h;i++){for(p=n[i],d=u[i],f=new Uint8Array(o),s=0;s<o;s++)l[s]&&(f[s]=d[p[s]-c]);m.push(f)}else if(null==l)for(i=0;i<h;i++){for(p=n[i],d=u[i],f=new Uint8Array(o),s=0;s<o;s++)f[s]=d[p[s]];m.push(f)}else for(i=0;i<h;i++){for(p=n[i],d=u[i],f=new Uint8Array(o),s=0;s<o;s++)l[s]&&(f[s]=d[p[s]]);m.push(f)}var y=new r.a({width:e.width,height:e.height,pixels:m,mask:l,pixelType:"u8"});return y.updateStatistics(),y}function f(e,t){if(!a(e))return null;var i,r,s,n,l,o,h=e.clone(),{pixels:u}=h,c=h.width*h.height,p=t.length,d=Math.floor(p/2),f=t[Math.floor(d)],m=u[0],y=!1,b=new Uint8Array(c),x=new Uint8Array(c),v=new Uint8Array(c),g=h.mask,w=4===t[0].mappedColor.length;for(g||((g=new Uint8Array(c)).fill(w?255:1),h.mask=g),l=0;l<c;l++)if(g[l]){for(i=m[l],y=!1,o=d,r=f,s=0,n=p-1;n-s>1;){if(i===r.value){y=!0;break}i>r.value?s=o:n=o,o=Math.floor((s+n)/2),r=t[Math.floor(o)]}y||(i===t[s].value?(r=t[s],y=!0):i===t[n].value?(r=t[n],y=!0):i<t[s].value?(y=!1,r=null):i>t[s].value&&(i<t[n].value?(r=t[s],y=!0):n===p-1?(y=!1,r=null):(r=t[n],y=!0))),y?(b[l]=r.mappedColor[0],x[l]=r.mappedColor[1],v[l]=r.mappedColor[2],g[l]=r.mappedColor[3]):b[l]=x[l]=v[l]=g[l]=0}return h.pixels=[b,x,v],h.mask=g,h.pixelType="u8",h.maskIsAlpha=w,h}function m(e,t,i,r,a,s,n,l){return{xmin:a<=i*e?0:a<i*e+e?a-i*e:e,ymin:s<=r*t?0:s<r*t+t?s-r*t:t,xmax:a+n<=i*e?0:a+n<i*e+e?a+n-i*e:e,ymax:s+l<=r*t?0:s+l<r*t+t?s+l-r*t:t}}function y(e,t){if(!e||0===e.length)return null;var i=e.filter((e=>e.pixelBlock))[0];if(!i)return null;var r=(i.extent.xmax-i.extent.xmin)/i.pixelBlock.width,a=(i.extent.ymax-i.extent.ymin)/i.pixelBlock.height,s=.01*Math.min(r,a),n=e.sort(((e,t)=>Math.abs(e.extent.ymax-t.extent.ymax)>s?t.extent.ymax-e.extent.ymax:Math.abs(e.extent.xmin-t.extent.xmin)>s?e.extent.xmin-t.extent.xmin:0)),l=Math.min.apply(null,n.map((e=>e.extent.xmin))),o=Math.min.apply(null,n.map((e=>e.extent.ymin))),h=Math.max.apply(null,n.map((e=>e.extent.xmax))),u=Math.max.apply(null,n.map((e=>e.extent.ymax))),c={x:Math.round((t.xmin-l)/r),y:Math.round((u-t.ymax)/a)},p={width:Math.round((h-l)/r),height:Math.round((u-o)/a)},d={width:Math.round((t.xmax-t.xmin)/r),height:Math.round((t.ymax-t.ymin)/a)};return Math.round(p.width/i.pixelBlock.width)*Math.round(p.height/i.pixelBlock.height)!==n.length||c.x<0||c.y<0||p.width<d.width||p.height<d.height?null:{extent:t,pixelBlock:b(n.map((e=>e.pixelBlock)),p,c,d)}}function b(e,t,i,s){var n=e.filter((e=>a(e)))[0];if(null==n)return null;var l,o,h,u,c,p,d,f,y,b,x,v,g,w=s?s.width:t.width,_=s?s.height:t.height,j=n.width,O=n.height,T=t.width/j,k=t.height/O,R=i?i.x:0,M=i?i.y:0,I=n.pixelType,P=r.a.getPixelArrayConstructor(I),C=n.pixels.length,S=[];for(p=0;p<C;p++){for(o=new P(w*_),d=0;d<k;d++)for(f=0;f<T;f++)if(h=e[d*T+f],a(h))for(l=h.pixels[p],y=(x=m(j,O,f,d,R,M,w,_)).ymin;y<x.ymax;y++)for(u=(d*O+y-M)*w+(f*j-R),c=y*j,b=x.xmin;b<x.xmax;b++)o[u+b]=l[c+b];S.push(o)}if(e.some((e=>null==e||e.mask&&e.mask.length>0)))for(v=new Uint8Array(w*_),d=0;d<k;d++)for(f=0;f<T;f++)if(g=(h=e[d*T+f])?h.mask:null,x=m(j,O,f,d,R,M,w,_),g)for(y=x.ymin;y<x.ymax;y++)for(u=(d*O+y-M)*w+(f*j-R),c=y*j,b=x.xmin;b<x.xmax;b++)v[u+b]=g[c+b];else if(h)for(y=x.ymin;y<x.ymax;y++)for(u=(d*O+y-M)*w+(f*j-R),c=y*j,b=x.xmin;b<x.xmax;b++)v[u+b]=1;else for(y=x.ymin;y<x.ymax;y++)for(u=(d*O+y-M)*w+(f*j-R),c=y*j,b=x.xmin;b<x.xmax;b++)v[u+b]=0;var U=new r.a({width:w,height:_,pixels:S,pixelType:I,mask:v});return U.updateStatistics(),U}function x(e,t,i){if(!a(e))return null;var{width:r,height:s}=e,n=t.x,l=t.y,o=i.width+n,h=i.height+l;if(n<0||l<0||o>r||h>s)return e;if(0===n&&0===l&&o===r&&h===s)return e;e.mask||(e.mask=new Uint8Array(r*s));for(var u=e.mask,c=0;c<s;c++)for(var p=c*r,d=0;d<r;d++)u[p+d]=c<l||c>=h||d<n||d>=o?0:1;return e.updateStatistics(),e}function v(e){if(!a(e))return null;for(var t=e.clone(),{width:i,height:r,pixels:s,mask:n}=e,l=s[0],o=t.pixels[0],h=2;h<r-1;h++){for(var u=new Map,c=h-2;c<h+2;c++)for(var p=0;p<4;p++){var d=c*i+p;_(u,l[d],n?n[d]:1)}o[h*i]=g(u),o[h*i+1]=o[h*i+2]=o[h*i];for(var f=3;f<i-1;f++){var m=(h-2)*i+f+1;_(u,l[m],n?n[m]:1),_(u,l[m=(h-1)*i+f+1],n?n[m]:1),_(u,l[m=h*i+f+1],n?n[m]:1),_(u,l[m=(h+1)*i+f+1],n?n[m]:1),w(u,l[m=(h-2)*i+f-3],n?n[m]:1),w(u,l[m=(h-1)*i+f-3],n?n[m]:1),w(u,l[m=h*i+f-3],n?n[m]:1),w(u,l[m=(h+1)*i+f-3],n?n[m]:1),o[h*i+f]=g(u)}o[h*i+f+1]=o[h*i+f]}for(var y=0;y<i;y++)o[y]=o[i+y]=o[2*i+y],o[(r-1)*i+y]=o[(r-2)*i+y];return t.updateStatistics(),t}function g(e){if(0===e.size)return 0;for(var t=0,i=-1,r=0,a=e.keys(),s=a.next();!s.done;)(r=e.get(s.value))>t&&(i=s.value,t=r),s=a.next();return i}function w(e,t,i){if(0!==i){var r=e.get(t);1===r?e.delete(t):e.set(t,r-1)}}function _(e,t,i){0!==i&&e.set(t,e.has(t)?e.get(t)+1:1)}function j(e,t,i){var{x:s,y:n}=t,{width:l,height:o}=i;if(0===s&&0===n&&o===e.height&&l===e.width)return e;var{width:h,height:u}=e,c=Math.max(0,n),p=Math.max(0,s),d=Math.min(s+l,h),f=Math.min(n+o,u);if(d<0||f<0||!a(e))return null;s=Math.max(0,-s),n=Math.max(0,-n);for(var{pixels:m,mask:y}=e,b=l*o,x=m.length,v=[],g=0;g<x;g++){for(var w=m[g],_=r.a.createEmptyBand(e.pixelType,b),j=c;j<f;j++)for(var O=j*h,T=(j+n-c)*l+s,k=p;k<d;k++)_[T++]=w[O+k];v.push(_)}for(var R=new Uint8Array(b),M=c;M<f;M++)for(var I=M*h,P=(M+n-c)*l+s,C=p;C<d;C++)R[P++]=y?y[I+C]:1;var S=new r.a({width:i.width,height:i.height,pixelType:e.pixelType,pixels:v,mask:R});return S.updateStatistics(),S}function O(e,t=!0){if(!a(e))return null;for(var{pixels:i,width:s,height:n,mask:l,pixelType:o}=e,h=[],u=Math.round(s/2),c=Math.round(n/2),p=n-1,d=s-1,f=0;f<i.length;f++){for(var m=i[f],y=r.a.createEmptyBand(o,u*c),b=0,x=0;x<n;x+=2)for(var v=0;v<s;v+=2){var g=m[x*s+v];if(t){var w=v===d?g:m[x*s+v+1],_=x===p?g:m[x*s+v+s],j=v===d?_:x===p?w:m[x*s+v+s+1];y[b++]=(g+w+_+j)/4}else y[b++]=g}h.push(y)}var O=null;if(l){O=new Uint8Array(u*c);for(var T=0,k=0;k<n;k+=2)for(var R=0;R<s;R+=2){var M=l[k*s+R];if(t){var I=R===d?M:l[k*s+R+1],P=k===p?M:l[k*s+R+s],C=R===d?P:k===p?I:l[k*s+R+s+1];O[T++]=M*I*P*C?1:0}else O[T++]=M}}return new r.a({width:u,height:c,pixelType:o,pixels:h,mask:O})}function T(e,t,i){if(!a(e))return null;for(var{width:r,height:s}=t,{width:n,height:l}=e,o=new Map,h={x:0,y:0},u=null==i?1:1+i,c=e,p=0;p<u;p++){for(var d=Math.ceil(n/r),f=Math.ceil(l/s),m=0;m<f;m++){h.y=m*s;for(var y=0;y<d;y++){h.x=y*r;var b=j(c,h,t);o.set("".concat(p,"/").concat(m,"/").concat(y),b)}}p<u-1&&(c=O(c)),n=Math.round(n/2),l=Math.round(l/2)}return o}function k(e,t,i,s,n="nearest"){if(!a(e))return null;"majority"===n&&(e=v(e));for(var l,o,h,u,c,p,d,{pixels:f,mask:m,pixelType:y}=e,b=e.width,x=e.height,g=r.a.getPixelArrayConstructor(y),w=f.length,{width:_,height:j}=t,O=s.cols,T=s.rows,k=Math.ceil(_/O),R=Math.ceil(j/T),M=!1,I=0;I<i.length;I+=3)-1===i[I]&&-1===i[I+1]&&-1===i[I+2]&&(M=!0);for(var P,C,S=new Float32Array(_*j),U=new Float32Array(_*j),A=0,B="majority"===n?0:.5,z=0;z<R;z++)for(var G=0;G<k;G++){o=i[l=12*(z*k+G)],h=i[l+1],u=i[l+2],c=i[l+3],p=i[l+4],d=i[l+5];for(var V=0;V<T;V++){A=(z*T+V)*_+G*O,C=(V+.5)/T;for(var q=0;q<V;q++)P=(q+.5)/O,S[A+q]=Math.round((o*P+h*C+u)*b-B),U[A+q]=Math.round((c*P+p*C+d)*x-B)}o=i[l+=6],h=i[l+1],u=i[l+2],c=i[l+3],p=i[l+4],d=i[l+5];for(var F=0;F<T;F++){A=(z*T+F)*_+G*O,C=(F+.5)/T;for(var L=F;L<O;L++)P=(L+.5)/O,S[A+L]=Math.round((o*P+h*C+u)*b-B),U[A+L]=Math.round((c*P+p*C+d)*x-B)}}for(var E,D=(e,t)=>{for(var i=0;i<j;i++){l=i*_;for(var r=0;r<_;r++)S[l]<0||U[l]<0?e[l]=0:e[l]=t[S[l]+U[l]*b],l++}},N=[],W=0;W<w;W++)D(E=new g(_*j),f[W]),N.push(E);var Q=new r.a({width:_,height:j,pixelType:y,pixels:N});if(m)Q.mask=new Uint8Array(_*j),D(Q.mask,m);else if(M){Q.mask=new Uint8Array(_*j);for(var H=0;H<_*j;H++)Q.mask[H]=S[H]<0||U[H]<0?0:1}return Q.updateStatistics(),Q}},650:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return n}));var r=i(7),a=i(89),s=i(118);function n(e){return l.apply(this,arguments)}function l(){return(l=Object(r.a)((function*(e,t=e.popupTemplate){if(!Object(a.k)(t))return[];var i=yield t.getRequiredFields(e.fields),{lastEditInfoEnabled:r}=t,{objectIdField:n,typeIdField:l,globalIdField:o,relationships:h}=e;if(i.includes("*"))return["*"];var u=r?yield Object(s.o)(e):[],c=Object(s.k)(e.fields,[...i,...u]);return l&&c.push(l),c&&n&&Object(s.t)(e.fields,n)&&-1===c.indexOf(n)&&c.push(n),c&&o&&Object(s.t)(e.fields,o)&&-1===c.indexOf(o)&&c.push(o),h&&h.forEach((t=>{var{keyField:i}=t;c&&i&&Object(s.t)(e.fields,i)&&-1===c.indexOf(i)&&c.push(i)})),c}))).apply(this,arguments)}function o(e,t){return e.popupTemplate?e.popupTemplate:Object(a.k)(t)&&t.defaultPopupTemplateEnabled&&Object(a.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}},723:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return y})),i.d(t,"h",(function(){return w}));var r=i(7),a=i(93),s=i(112),n=i(161),l=i(113),o=i(103),h=(i(101),i(117)),u=i(223),c=5e-4,p=function(e,t){var i=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||i)};function d(){return f.apply(this,arguments)}function f(){return(f=Object(r.a)((function*(){if(Object(u.g)()||!Object(u.h)())return null;yield Object(u.i)()}))).apply(this,arguments)}function m(e,t,i){if(!p(e.spatialReference,t))return null;if(!Object(u.g)())throw new a.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");return i?Object(u.e)(t,e.spatialReference,e):Object(u.e)(e.spatialReference,t,e)}function y(e,t,i,r=null){if(e.spatialReference.equals(t))return e;var s=p(e.spatialReference,t);if(s&&!Object(u.g)())throw new a.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var l=i.center,h=new o.a({xmin:l.x-e.x/2,xmax:l.x+e.x/2,ymin:l.y-e.y/2,ymax:l.y+e.y/2,spatialReference:e.spatialReference}),c=s?Object(u.j)(h,t,r):Object(n.d)(h,t);return null==c?null:{x:c.xmax-c.xmin,y:c.ymax-c.ymin}}function b(e,t=.01){return Object(h.f)(e)?t/Object(h.f)(e):0}function x(e,t,i=null,r=!0){var l=e.spatialReference;if(l.equals(t))return e;var o=p(l,t);if(o&&!Object(u.g)())throw new a.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var h=o?Object(u.j)(e,t,i):Object(n.d)(e,t);if(h&&r&&t.isGeographic){var d,f,[m,y]=l.isWebMercator?Object(s.d)(l).origin:null!=(d=null==(f=Object(s.d)(l))?void 0:f.valid)?d:[],x=b(l);x&&null!=m&&null!=y&&(Math.abs(e.x-m)<x&&Math.abs(180-h.x)<c?h.x-=360:Math.abs(e.x-y)<x&&Math.abs(180+h.x)<c&&(h.x+=360))}return h}function v(e,t,i=null,r=!0){var o,h,d,f,m=e.spatialReference;if(m.equals(t))return e;var y=p(m,t);if(y&&!Object(u.g)())throw new a.a("rasterprojectionhelper-projectExtent","projection engine is not loaded");var v=y?Object(u.j)(e,t,i):Object(n.d)(e,t),[g,w]=null!=(o=null==(h=Object(s.d)(m))?void 0:h.origin)?o:[];if(v&&r&&m.isWebMercator&&t.isGeographic&&null!=g&&null!=w){if(Math.abs(e.xmin-g)<.001&&Math.abs(w-e.xmax)>1e3&&Math.abs(180-v.xmax)<c){v.xmin=-180;var _=[];_.push(new l.a(e.xmax,e.ymin,m)),_.push(new l.a(e.xmax,(e.ymin+e.ymax)/2,m)),_.push(new l.a(e.xmax,e.ymax,m));var j=_.map((e=>x(e,t,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));v.xmax=Math.max.apply(null,j)}if(Math.abs(e.xmax-w)<.001&&Math.abs(g-e.xmin)>1e3&&Math.abs(180+v.xmin)<c){v.xmax=180;var O=[];O.push(new l.a(e.xmin,e.ymin,m)),O.push(new l.a(e.xmin,(e.ymin+e.ymax)/2,m)),O.push(new l.a(e.xmin,e.ymax,m));var T=O.map((e=>x(e,t,i))).filter((e=>!isNaN(null==e?void 0:e.x))).map((e=>e.x));v.xmin=Math.min.apply(null,T)}}[g,w]=t.isWebMercator?Object(s.d)(t).origin:null!=(d=null==(f=Object(s.d)(t))?void 0:f.valid)?d:[];var k=b(t);return k&&null!=g&&null!=w&&(Math.abs(v.xmin-g)<k&&(v.xmin=g),Math.abs(v.xmax-w)<k&&(v.xmax=w)),v}function g(e,t,i,r=null,n=null,o=!1,h=[32,32]){var c,d;if(p(e.spatialReference,t.spatialReference)&&!Object(u.g)())throw new a.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&i))return null;for(var f,{xmin:m,ymin:y,xmax:b,ymax:v}=e,g=e.spatialReference,w=t.spatialReference,[_,j]=null!=(c=null==(d=Object(s.d)(g))?void 0:d.valid)?c:[],O={x:h[0]*i.x,y:h[1]*i.y},T={cols:Math.ceil((b-m)/O.x-.1)+1,rows:Math.ceil((v-y)/O.y-.1)+1},k=O.x,R=O.y,M=[],I=!1,P=0;P<T.cols;P++){for(var C=[],S=0;S<T.rows;S++){var U=x(new l.a({x:m+k*P,y:v-R*S,spatialReference:g}),w,r);n&&(U=n.inverseTransform(U)),C.push(U),P>0&&o&&U&&f[S]&&null!=_&&U.x<f[S].x&&(U.x+=j-_),U?(M.push((U.x-t.xmin)/(t.xmax-t.xmin)),M.push((t.ymax-U.y)/(t.ymax-t.ymin))):(M.push(NaN),M.push(NaN),I=!0)}f=C}for(var A=function(e,t){var i=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,r=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(i-e[2*t.rows+2]),Math.abs(r-e[2*t.rows+3])]}(M,T),B=new Float32Array((T.cols-1)*(T.rows-1)*2*6),z=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),G=new Float32Array([-1,1,0,0,-1,1,1,0,0]),V=0;V<T.cols-1;V++){for(var q=0;q<T.rows-1;q++){for(var F=V*T.rows*2+2*q,L=M[F],E=M[F+1],D=M[F+2],N=M[F+3],W=M[F+=2*T.rows],Q=M[F+1],H=M[F+2],J=M[F+3],X=0,Z=12*(q*(T.cols-1)+V),K=0;K<3;K++)B[Z++]=z[X++]*L+z[X++]*D+z[X++]*H;X=0;for(var Y=0;Y<3;Y++)B[Z++]=z[X++]*E+z[X++]*N+z[X++]*J;X=0;for(var $=0;$<3;$++)B[Z++]=G[X++]*L+G[X++]*W+G[X++]*H;X=0;for(var ee=0;ee<3;ee++)B[Z++]=G[X++]*E+G[X++]*Q+G[X++]*J}if(I)for(var te=0;te<B.length;te++)isNaN(B[te])&&(B[te]=-1)}return{offsets:M,error:A,coefficients:B,spacing:h,size:[T.cols-1,T.rows-1]}}function w(e,t,i){var r=Math.log(e.x/t.pixelSize.x)/Math.LN2,a=Math.log(e.y/t.pixelSize.y)/Math.LN2,s=t.storageInfo.maximumPyramidLevel||0,n="down"===i?Math.floor(Math.min(r,a)):"up"===i?Math.ceil(Math.max(r,a)):Math.round((r+a)/2),o=!1;n<0?n=0:n>s&&(o=n>s+3,n=s);var h=Math.pow(2,n);return{pyramidLevel:n,pyramidResolution:new l.a({x:h*t.nativePixelSize.x,y:h*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:o}}function _(e,t,i=512,r=!0){var{extent:a,spatialReference:s,pixelSize:n}=e,o=y(new l.a({x:n.x,y:n.y,spatialReference:s}),t,a);if(null==o)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var u=(o.x+o.y)/2,c=Object(h.f)(t),p=u*c*96*39.37,d=t.isGeographic?512/i*295828763.7958547:512/i*591657527.591555,f=!1,m=v(a,t);r&&(t.isGeographic||t.isWebMercator)&&(f=m.xmin*m.xmax<0);var b,x=p,g=1.001;if(f){x=d;var w=.29858214164761665,_=w*(96*c*39.37);(b=y(new l.a({x:w,y:w,spatialReference:{wkid:3857}}),s,m)).x*=x/_,b.y*=x/_}else{b={x:n.x,y:n.y};for(var j=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),O=0;x<d*(g/2)&&O<j;)O++,x*=2,b.x*=2,b.y*=2;Math.max(x,d)/Math.min(x,d)<=g&&(x=d)}for(var T=[x],k=[{x:b.x,y:b.y}],R=Math.min(70.5310735,p)/g;x>=R;)x/=2,b.x/=2,b.y/=2,T.push(x),k.push({x:b.x,y:b.y});return{projectedPixelSize:o,scales:T,srcResolutions:k,isCustomTilingScheme:!f}}}}]);
//# sourceMappingURL=38.09bcd9cc.chunk.js.map