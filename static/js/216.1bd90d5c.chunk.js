(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[216],{1182:function(e,t,i){},1398:function(e,t,i){"use strict";i.r(t),i.d(t,"PropertyPanel",(function(){return p}));var r=i(1),n=i(91);const l=e=>{const t=e.map((e=>e.getAttribute("PIN_NUM"))),i=new URL(window.location.toString());if(t){i.searchParams.set("pin",t.toString());const e={pin:t.toString()};history.state?history.state.pin!=e.pin&&history.pushState({pin:t.toString()},"",i.href):history.pushState({pin:t.toString()},"",i.href)}else history.replaceState(history.state,"",i.href)};i(1182);var o=i(1384),s=i(3),a=i(0);const c=Object(r.lazy)((()=>Promise.all([i.e(3),i.e(4),i.e(17),i.e(22),i.e(92)]).then(i.bind(null,1403)))),d=Object(r.lazy)((()=>Promise.all([i.e(1),i.e(2),i.e(3),i.e(4),i.e(67)]).then(i.bind(null,1404)))),u=Object(r.lazy)((()=>Promise.all([i.e(3),i.e(4),i.e(17),i.e(22),i.e(106)]).then(i.bind(null,1385)))),p=e=>{const t=Object(r.useRef)({pin:""}),i=Object(r.useRef)(null),p=Object(r.useRef)(null),[b,v]=Object(r.useState)(!1),[f,h]=Object(r.useState)(!0),[y,j]=Object(r.useState)(),m=Object(r.useRef)(),[g,O]=Object(r.useState)("OBJECTID IS NULL"),[S,I]=Object(r.useState)("OBJECTID IS NULL"),[N,E]=Object(r.useState)(),[P,w]=Object(r.useState)("list"),[C,U]=Object(r.useState)(!1),[T,x]=Object(r.useState)(),M=Object(r.useRef)(),[R,A]=Object(r.useState)(),[L,k]=Object(r.useState)(!1),{theme:_}=Object(r.useContext)(s.a),D=e=>{const t=document.querySelector(`calcite-tab-title[tab=${e}]`),i=new KeyboardEvent("keydown",{altKey:!1,bubbles:!0,cancelable:!0,charCode:0,code:"Enter",composed:!0,ctrlKey:!1,detail:0,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1});t.dispatchEvent(i),U(!0)},J=()=>{h(!0),m.current=void 0,e.featureSelected(void 0),O("OBJECTID IS NULL"),D("list"),w("list"),e.propertiesSelected([]);const t=null===y||void 0===y?void 0:y.graphics.filter((e=>"buffer"===e.getAttribute("type")));(null===t||void 0===t?void 0:t.length)&&(null===y||void 0===y||y.graphics.removeMany(t))};return Object(r.useEffect)((()=>{if(!b){(e=>{E(e.map.allTables.find((e=>e.title.includes("Condo")&&"feature"===e.type))),x(e.map.allTables.find((e=>e.title.includes("Address")&&"feature"===e.type))),A(e.map.allLayers.find((e=>e.title.includes("Property")&&"feature"===e.type))),v(!0),j(e)})(e.view),document.querySelectorAll("calcite-tab").forEach((e=>{const t=new MutationObserver((e=>{if(e.length){var i;const r=null===(i=e[0].target)||void 0===i?void 0:i.shadowRoot;r&&(r.innerHTML+="<style>:host([active]) section { display: block !important; visibility: visible !important;} section {display: block !important; visiblity: hidden !important;}</style>"),t.disconnect()}else t.disconnect()}));e.innerHTML="<style>:host([active]) {display: block !important; visibility: visible !important;} :host { display: block; visibility: hidden !important;} calcite-tab {display: block !important; z-index: 1; visibility: hidden !important;} calcite-tab[active] { z-index: 100; visibility: visible !important;;} </style>",t.observe(e,{attributes:!0})})),window.addEventListener("popstate",(e=>{var i,r,n,l,o;(null===(i=e.state)||void 0===i?void 0:i.pin)===(null===(r=t.current)||void 0===r?void 0:r.pin)?history.back():(null===(n=e.state)||void 0===n?void 0:n.pin.length)>0&&(I(`PIN_NUM in ('${decodeURIComponent(null===(l=history.state)||void 0===l?void 0:l.pin.split(",").join("','"))}')`),O(`PIN_NUM in ('${decodeURIComponent(null===(o=history.state)||void 0===o?void 0:o.pin.split(",").join("','"))}')`));t.current=e.state}));const i=new URL(document.URL).searchParams.get("pin");i&&i.length>0&&(I(`PIN_NUM in ('${decodeURIComponent(i.split(",").join("','"))}')`),O(`PIN_NUM in ('${decodeURIComponent(i.split(",").join("','"))}')`))}}),[]),Object(r.useEffect)((()=>{((e,t,i)=>n.c(((r,n)=>{void 0!=i&&(null===t||void 0===t||t.queryFeatures({geometry:i,outFields:["OBJECTID","REID","PIN_NUM"],returnGeometry:!0,outSpatialReference:null===e||void 0===e?void 0:e.spatialReference}).then((e=>{const i=e.features.map((e=>e.getObjectId()));t.queryRelatedFeatures({relationshipId:0,objectIds:i,outFields:["*"]}).then((t=>{const l=[],o=[];i.forEach((e=>{var i;null===(i=t[e])||void 0===i||i.features.forEach((e=>{l.push(e.getAttribute("OBJECTID")),o.push(e)}))})),l.length?r({where:`OBJECTID in (${l.toString()})`,features:o,properties:e.features}):n()}))})))})))(y,R,e.geometry).then((t=>{if(void 0!=e.geometry){if(k(!0),O(t.where),M.current=t.properties,1===t.features.length){var i,r;const n=t.features[0];n.layer=N,n.popupTemplate=null===N||void 0===N?void 0:N.popupTemplate;const o=t.features[0];o.geometry=null===(i=t.properties)||void 0===i||null===(r=i.find((e=>e.getAttribute("PIN_NUM")===o.getAttribute("PIN_NUM"))))||void 0===r?void 0:r.geometry,m.current=o,e.featureSelected(o),h(!1),l([o]),D("info"),w("info")}else l([]),h(!0),m.current=void 0,D("list"),w("list");e.propertiesSelected(t.properties)}else J()})).catch((()=>{J()}))}),[e.geometry,e.propertiesSelected,e.featureSelected,e.selectedProperties]),Object(a.jsxs)("div",{className:"panel",id:"propertyPanel",children:[b&&Object(a.jsx)(r.Suspense,{fallback:"",children:Object(a.jsx)(c,{view:y,condosTable:N,addressTable:T,propertyLayer:R,where:S,clear:J,searchComplete:t=>{var i;t.feature||1===t.features.length?(m.current=t.features[0],e.featureSelected(t.features[0]),h(!1),l([t.features[0]]),D("info"),w("info")):(l([]),h(!0),m.current=void 0,D("list"),w("list"));const r=null===t||void 0===t?void 0:t.features.map((e=>e.getAttribute("OBJECTID")));O(`OBJECTID in (${r.toString()})`),M.current=t.properties,null===(i=e.selectedProperties)||void 0===i||i.forEach((e=>{e.setAttribute("selected",0)})),e.propertiesSelected(M.current);const n=e.view.graphics.filter((e=>"buffer"===e.getAttribute("type")));e.view.graphics.removeMany(n)}})}),Object(a.jsxs)(o.F,{class:`shell calcite-theme-${_}`,position:"below",layout:"center",children:[Object(a.jsxs)(o.D,{slot:"tab-nav",onCalciteTabChange:e=>{U(0===e.detail.tab||"list"===e.detail.tab)},children:[Object(a.jsx)(o.E,{tab:"list",active:!0,ref:p,children:"List"}),Object(a.jsx)(o.E,{tab:"info",ref:i,disabled:!!f||void 0,children:"Info"})]}),Object(a.jsx)(o.C,{tab:"list",children:b&&Object(a.jsx)(r.Suspense,{fallback:"",children:Object(a.jsx)(u,{view:y,layer:N,filter:g,loading:L,reloadTable:C,selectedTab:P,featureSelected:t=>{if(t){var i,r,n,o,s;null===(i=M.current)||void 0===i||i.forEach((e=>{(null===e||void 0===e?void 0:e.getAttribute("PIN_NUM"))!=(null===t||void 0===t?void 0:t.getAttribute("PIN_NUM"))&&(null===e||void 0===e||e.setAttribute("selected",0))}));const a=null===(r=M.current)||void 0===r?void 0:r.find((e=>(null===e||void 0===e?void 0:e.getAttribute("PIN_NUM"))===(null===t||void 0===t?void 0:t.getAttribute("PIN_NUM"))));null===a||void 0===a||a.setAttribute("selected",1),null===(n=M.current)||void 0===n||n.splice(null===(o=M.current)||void 0===o?void 0:o.indexOf(a),1),null===(s=M.current)||void 0===s||s.push(a),t.geometry=null===a||void 0===a?void 0:a.geometry,null===y||void 0===y||y.goTo(t.geometry,{duration:1e3,easing:"ease"}),m.current=t,e.featureSelected(t),h(!1),e.propertiesSelected(M.current),l([t]),D("info"),w("info")}}})})}),Object(a.jsx)(o.C,{tab:"info",children:b&&Object(a.jsx)(r.Suspense,{fallback:"",children:Object(a.jsx)(d,{view:y,feature:m.current})})})]})]})};t.default=p}}]);
//# sourceMappingURL=216.1bd90d5c.chunk.js.map