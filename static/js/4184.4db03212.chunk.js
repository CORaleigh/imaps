"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[4184],{45028:(e,t,r)=>{r.d(t,{C:()=>w,b:()=>T});var i=r(22357),s=r(37081),o=r(33280),n=r(94951),a=r(14801),l=r(48655),c=r(16574),d=r(137),h=r(15226),u=r(26461),p=r(116),f=r(82552),g=r(95276),m=r(98634),v=r(64201),_=r(25920),y=r(4760);function T(e){const t=new v.kG,{vertex:r,fragment:T}=t,w=e.output===s.H.Depth,C=e.hasMultipassTerrain&&(e.output===s.H.Color||e.output===s.H.Alpha);return(0,f.Sv)(r,e),t.include(n.w,e),t.include(l.c,e),t.include(a.R,e),t.attributes.add(y.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),C&&t.varyings.add("depth","float"),w&&(t.include(c.F,e),(0,i.Zu)(t),(0,i.Lm)(t)),r.code.add(m.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${C?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${w?m.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:m.H`transformPosition(proj, view, vpos);`}
    }
  `),t.include(o.f5,e),C&&t.include(h.l,e),T.include(p.Y),T.uniforms.add(new g.N("eColor",(e=>e.color))),e.output===s.H.Highlight&&t.include(d.bA,e),T.code.add(m.H`
  void main() {
    discardBySlice(vpos);
    ${C?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${e.output===s.H.ObjectAndLayerIdColor?m.H`fColor.a = 1.0;`:""}

    if (fColor.a < ${m.H.float(u.b)}) {
      discard;
    }

    ${e.output===s.H.Alpha?m.H`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===s.H.Color?m.H`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===_.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===s.H.Highlight?m.H`outputHighlight();`:""};
    ${e.output===s.H.Depth?m.H`outputDepth(linearDepth);`:""};
    ${e.output===s.H.ObjectAndLayerIdColor?m.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const w=Object.freeze(Object.defineProperty({__proto__:null,build:T},Symbol.toStringTag,{value:"Module"}))},18442:(e,t,r)=>{r.d(t,{H:()=>N,b:()=>D,c:()=>M});var i=r(92026),s=r(88396),o=r(6394),n=r(67077),a=r(67794),l=r(37081),c=r(33280),d=r(14801),h=r(28156),u=r(50600),p=r(50913),f=r(137),g=r(18607),m=r(26461),v=r(116),_=r(78980),y=r(62993),T=r(82999),w=r(95276),C=r(59150),S=r(58406),x=r(699),b=r(98634),O=r(64201),A=r(19253),R=r(25920),P=r(4760),E=r(65964);function D(e){const t=new O.kG,r=e.signedDistanceFieldEnabled;if(t.include(h.H),t.include(u.R,e),t.include(c.f5,e),e.occlusionPass)return t.include(p.R,e),t;const{vertex:D,fragment:H}=t;t.include(y.cK),H.include(_.n),H.include(v.Y),t.include(g.k,e),t.include(d.R,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),D.uniforms.add([new w.N("viewport",((e,t)=>t.camera.fullViewport)),new T.A("screenOffset",((e,t)=>(0,s.s)(L,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new T.A("anchorPosition",(e=>M(e))),new w.N("materialColor",(e=>e.color)),new S.p("pixelRatio",((e,t)=>t.camera.pixelRatio))]),r&&(D.uniforms.add(new w.N("outlineColor",(e=>e.outlineColor))),H.uniforms.add([new w.N("outlineColor",(e=>I(e)?e.outlineColor:n.Z)),new S.p("outlineSize",(e=>I(e)?e.outlineSize:0))])),e.hasScreenSizePerspective&&((0,y.ww)(D),(0,y.m8)(D)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(P.T.UV0,"vec2"),t.attributes.add(P.T.COLOR,"vec4"),t.attributes.add(P.T.SIZE,"vec2"),t.attributes.add(P.T.AUXPOS2,"vec4"),D.code.add(b.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?b.H`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:b.H`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const N=b.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,F=e.pixelSnappingEnabled?r?b.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:b.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:b.H`posProj += quadOffset;`;e.vvColor&&D.uniforms.add([new C.b("vvColorColors",(e=>e.vvColorColors),E.x),new x.O("vvColorValues",(e=>e.vvColorValues),E.x)]),D.uniforms.add(new T.A("textureCoordinateScaleFactor",(e=>(0,i.pC)(e.texture)&&(0,i.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:o.O))),D.code.add(b.H`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${N}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${e.output===l.H.ObjectAndLayerIdColor?b.H`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${b.H.float(m.b)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${b.H.float(m.b)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${F}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?b.H`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),H.uniforms.add(new A.A("tex",(e=>e.texture)));const z=e.debugDrawLabelBorder?b.H`(isBorder > 0.0 ? 0.0 : ${b.H.float(m.F)})`:b.H.float(m.F),U=b.H`
    ${e.debugDrawLabelBorder?b.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?b.H`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${b.H.float(a.Ph)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${z} ||
          fillPixelColor.a + outlinePixelColor.a < ${b.H.float(m.b)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${z}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:b.H`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${z}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?b.H`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===l.H.Alpha&&H.code.add(b.H`
      void main() {
        ${U}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===l.H.ObjectAndLayerIdColor&&H.code.add(b.H`
      void main() {
        ${U}
        outputObjectAndLayerIdColor();
      }
      `),e.output===l.H.Color&&H.code.add(b.H`
    void main() {
      ${U}
      ${e.transparencyPassType===R.A.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===l.H.Highlight&&(t.include(f.bA,e),H.code.add(b.H`
    void main() {
      ${U}
      ${e.binaryHighlightOcclusionEnabled?b.H`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function I(e){return e.outlineColor[3]>0&&e.outlineSize>0}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L;return e.textureIsSignedDistanceField?H(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,s.c)(t,e.anchorPosition),t}function H(e,t,r){(0,i.pC)(t)?(0,s.s)(r,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,s.s)(r,0,0)}const L=(0,o.a)(),N=Object.freeze(Object.defineProperty({__proto__:null,build:D,calculateAnchorPosForRendering:M},Symbol.toStringTag,{value:"Module"}))},99337:(e,t,r)=>{r.d(t,{N:()=>v,b:()=>m});var i=r(37081),s=r(33280),o=r(94951),n=r(48655),a=r(137),l=r(60300),c=r(26461),d=r(82552),h=r(95276),u=r(58406),p=r(98634),f=r(64201),g=r(4760);function m(e){const t=new f.kG,{vertex:r,fragment:m}=t;return t.include(o.w,e),t.include(n.c,e),t.include(l.q,e),(0,d.Sv)(r,e),e.stippleEnabled&&(t.attributes.add(g.T.UV0,"vec2"),t.attributes.add(g.T.AUXPOS1,"vec3"),r.uniforms.add(new h.N("viewport",((e,t)=>t.camera.fullViewport)))),t.attributes.add(g.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r.code.add(p.H`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(r.code.add(p.H`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?r.uniforms.add(new u.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):r.code.add(p.H`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(p.H`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?r.code.add(p.H`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(p.H`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new u.p("stipplePatternPixelSize",(e=>(0,l.C)(e)))),r.code.add(p.H`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(p.H`}`),e.output===i.H.Highlight&&t.include(a.bA,e),t.include(s.f5,e),m.uniforms.add(new u.p("alphaCoverage",((e,t)=>Math.min(1,e.width*t.camera.pixelRatio)))),e.hasVertexColors||m.uniforms.add(new h.N("constantColor",(e=>e.color))),m.code.add(p.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${e.output===i.H.ObjectAndLayerIdColor?p.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${p.H.float(c.b)}) {
      discard;
    }

    ${e.output===i.H.Color?p.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===i.H.Highlight?p.H`outputHighlight();`:""}
  }
  `),t}const v=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}))},98186:(e,t,r)=>{r.d(t,{R:()=>A,a:()=>P,b:()=>R});var i=r(92026),s=r(22357),o=r(37081),n=r(33280),a=r(14801),l=r(48353),c=r(16574),d=r(60300),h=r(40526),u=r(15226),p=r(85586),f=r(26461),g=r(116),m=r(82552),v=r(82999),_=r(95276),y=r(58406),T=r(98634),w=r(8654),C=r(64201),S=r(25920),x=r(4760),b=r(33720),O=r(737);const A=1;function R(e){const t=new C.kG,{vertex:r,fragment:R}=t,P=e.hasMultipassTerrain&&(e.output===o.H.Color||e.output===o.H.Alpha);t.include(p.e),t.include(l.U,e),t.include(d.q,e);const E=e.applyMarkerOffset&&!e.draped;E&&(r.uniforms.add(new y.p("markerScale",(e=>e.markerScale))),t.include(h.Q,{space:b.I9.World})),e.output===o.H.Depth&&t.include(c.F,e),t.include(a.R,e),(0,m.Sv)(r,e),r.uniforms.add([new w.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new v.A("nearFar",((e,t)=>t.camera.nearFar)),new y.p("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new _.N("viewport",((e,t)=>t.camera.fullViewport))]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(x.T.POSITION,"vec3"),t.attributes.add(x.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(x.T.UV0,"vec2"),t.attributes.add(x.T.AUXPOS1,"vec3"),t.attributes.add(x.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),(0,s.Lm)(t),P&&t.varyings.add("depth","float");const D=e.capType===O.R.ROUND,I=e.stippleEnabled&&e.stippleScaleWithLineWidth||D;I&&t.varyings.add("vLineWidth","float");const M=e.stippleEnabled&&e.stippleScaleWithLineWidth;M&&t.varyings.add("vLineSizeInv","float");const H=e.innerColorEnabled||D;H&&t.varyings.add("vLineDistance","float");const L=e.stippleEnabled&&D,N=e.falloffEnabled||L;N&&t.varyings.add("vLineDistanceNorm","float"),D&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(T.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(T.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),(0,s.bA)(t),r.code.add(T.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${P?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new y.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),r.code.add(T.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${I?T.H`vLineWidth = lineWidth;`:""}
      ${M?T.H`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),E&&r.code.add(T.H`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(T.H`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(e.stippleEnabled||D)&&r.code.add(T.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${D?T.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(T.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(T.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?T.H`min(1.0, subdivisionFactor * ${T.H.float((A+2)/(A+1))})`:T.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(T.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const F=e.capType!==O.R.BUTT;return r.code.add(T.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${F?T.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(T.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${N||H?T.H`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${H?T.H`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${N?T.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),D&&r.code.add(T.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new y.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):r.code.add(T.H`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(T.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(T.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(T.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new y.p("stipplePatternPixelSize",(e=>(0,d.C)(e)))),r.code.add(T.H`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(T.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),P&&t.include(u.l,e),t.include(n.f5,e),R.include(g.Y),R.code.add(T.H`
  void main() {
    discardBySlice(vpos);
    ${P?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?R.code.add(T.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(D&&R.code.add(T.H`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${T.H.float(f.b)}) {
        discard;
      }
    `),L?R.code.add(T.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.H.float(f.b)}, stippleCoverage);
      `):R.code.add(T.H`float stippleAlpha = getStippleAlpha();`),R.uniforms.add(new _.N("intrinsicColor",(e=>e.color))),e.output!==o.H.ObjectAndLayerIdColor&&R.code.add(T.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),R.code.add(T.H`vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(R.uniforms.add(new _.N("innerColor",(e=>(0,i.Pt)(e.innerColor,e.color)))),R.uniforms.add(new y.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),R.code.add(T.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),R.code.add(T.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(R.uniforms.add(new y.p("falloff",(e=>e.falloff))),R.code.add(T.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),R.code.add(T.H`
    ${e.output===o.H.ObjectAndLayerIdColor?T.H`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.H.float(f.b)}) {
      discard;
    }

    ${e.output===o.H.Alpha?T.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===o.H.Color?T.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===o.H.Color&&e.transparencyPassType===S.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===o.H.Highlight?T.H`gl_FragColor = vec4(1.0);`:""}
    ${e.output===o.H.Depth?T.H`outputDepth(linearDepth);`:""}
    ${e.output===o.H.ObjectAndLayerIdColor?T.H`outputObjectAndLayerIdColor();`:""}
  }
  `),t}const P=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:A,build:R},Symbol.toStringTag,{value:"Module"}))},49810:(e,t,r)=>{r.d(t,{W:()=>O,b:()=>b});var i=r(22357),s=r(37081),o=r(33280),n=r(94951),a=r(137),l=r(60750),c=r(92395),d=r(15226),h=r(8555),u=r(41481),p=r(58335),f=r(77652),g=r(79246),m=r(26461),v=r(116),_=r(82552),y=r(95276),T=r(58406),w=r(98634),C=r(64201),S=r(25920),x=r(4760);function b(e){const t=new C.kG,{vertex:r,fragment:b}=t;(0,_.Sv)(r,e),t.include(n.w,e),t.attributes.add(x.T.POSITION,"vec3"),t.attributes.add(x.T.UV0,"vec2");const O=new y.N("waterColor",(e=>e.color));if(e.output===s.H.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),r.uniforms.add(O),r.code.add(w.H`
        void main(void) {
          if (waterColor.a < ${w.H.float(m.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),b.uniforms.add(O),b.code.add(w.H`void main() {
gl_FragColor = waterColor;
}`),t;switch(e.output!==s.H.Color&&e.output!==s.H.Alpha||(t.include(h.n,e),t.include(i.qj,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.uniforms.add(O),r.code.add(w.H`
      void main(void) {
        if (waterColor.a < ${w.H.float(m.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===s.H.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(d.l,e),e.output){case s.H.Alpha:t.include(o.f5,e),b.uniforms.add(O),b.code.add(w.H`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case s.H.Color:t.include(c.kR,e),t.include(l._,{pbrMode:u.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(g.M),t.include(o.f5,e),t.include(p.XE,e),t.include(f.B,e),b.uniforms.add([O,new T.p("timeElapsed",(e=>e.timeElapsed)),r.uniforms.get("view"),r.uniforms.get("localOrigin")]),(0,_.hY)(b,e),b.include(v.Y),(0,c.Pe)(b),(0,c.F1)(b),b.code.add(w.H`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?w.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===S.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case s.H.Normal:t.include(h.n,e),t.include(g.M,e),t.include(o.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),r.uniforms.add(O),r.code.add(w.H`
        void main(void) {
          if (waterColor.a < ${w.H.float(m.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),b.uniforms.add(new T.p("timeElapsed",(e=>e.timeElapsed))),b.code.add(w.H`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case s.H.Highlight:t.include(a.bA,e),t.varyings.add("vpos","vec3"),r.uniforms.add(O),r.code.add(w.H`
      void main(void) {
        if (waterColor.a < ${w.H.float(m.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(o.f5,e),b.code.add(w.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return t}const O=Object.freeze(Object.defineProperty({__proto__:null,build:b},Symbol.toStringTag,{value:"Module"}))},82218:(e,t,r)=>{r.d(t,{a:()=>_,c:()=>y,g:()=>S,h:()=>E,u:()=>w});r(93169);var i=r(32718),s=r(16889),o=r(21530),n=r(14226),a=r(81949),l=r(11186),c=r(71353),d=r(14320),h=r(85981),u=r(55652),p=r(40885),f=r(40927),g=r(11185);const m=i.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const v=class{constructor(){this.plane=(0,u.Ue)(),this.origin=(0,c.c)(),this.basis1=(0,c.c)(),this.basis2=(0,c.c)()}};function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return{plane:(0,u.Ue)(e.plane),origin:(0,c.a)(e.origin),basis1:(0,c.a)(e.basis1),basis2:(0,c.a)(e.basis2)}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_();return T(e.origin,e.basis1,e.basis2,t)}function T(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_();return(0,l.c)(i.origin,e),(0,l.c)(i.basis1,t),(0,l.c)(i.basis2,r),w(i),N(i,"fromValues()"),i}function w(e){(0,u.my)(e.basis2,e.basis1,e.origin,e.plane)}function C(e,t,r){e!==r&&y(e,r);const i=(0,l.g)(g.WM.get(),I(e),t);return(0,l.a)(r.origin,r.origin,i),r.plane[3]-=t,r}function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_();const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return(0,l.s)(t.origin,e[0]+r,e[1]+i,0),(0,l.s)(t.basis1,r,0,0),(0,l.s)(t.basis2,0,i,0),(0,u.al)(0,0,1,0,t.plane),t}function x(e,t,r){return!!(0,u.BR)(e.plane,t,r)&&M(e,r)}function b(e,t,r){const i=U.get();F(e,t,i,U.get());let o=Number.POSITIVE_INFINITY;for(const n of G){const a=L(e,n,j.get()),c=g.WM.get();if((0,u.rx)(i,a,c)){const e=(0,l.r)(g.WM.get(),t.origin,c),i=Math.abs((0,s.ZF)((0,l.e)(t.direction,e)));i<o&&(o=i,(0,l.c)(r,c))}}return o===Number.POSITIVE_INFINITY?O(e,t,r):r}function O(e,t,r){if(x(e,t,r))return r;const i=U.get(),s=U.get();F(e,t,i,s);let o=Number.POSITIVE_INFINITY;for(const n of G){const a=L(e,n,j.get()),c=g.WM.get();if((0,u.dZ)(i,a,c)){const e=(0,p.Jk)(t,c);if(!(0,u.Ac)(s,c))continue;e<o&&(o=e,(0,l.c)(r,c))}}return P(e,t.origin)<o&&A(e,t.origin,r),r}function A(e,t,r){const i=(0,u.nF)(e.plane,t,g.WM.get()),s=(0,h.ct)(H(e,e.basis1),i,-1,1,g.WM.get()),o=(0,h.ct)(H(e,e.basis2),i,-1,1,g.WM.get());return(0,l.b)(r,(0,l.a)(g.WM.get(),s,o),e.origin),r}function R(e,t,r){const{origin:i,basis1:s,basis2:o}=e,n=(0,l.b)(g.WM.get(),t,i),a=(0,f.SR)(s,n),c=(0,f.SR)(o,n),d=(0,f.SR)(I(e),n);return(0,l.s)(r,a,c,d)}function P(e,t){const r=R(e,t,g.WM.get()),{basis1:i,basis2:s}=e,o=(0,l.l)(i),n=(0,l.l)(s),a=Math.max(Math.abs(r[0])-o,0),c=Math.max(Math.abs(r[1])-n,0),d=r[2];return a*a+c*c+d*d}function E(e,t){return Math.sqrt(P(e,t))}function D(e,t){const r=-e.plane[3];return(0,f.SR)(I(e),t)-r}function I(e){return(0,u.mJ)(e.plane)}function M(e,t){const r=(0,l.b)(g.WM.get(),t,e.origin),i=(0,l.p)(e.basis1),s=(0,l.p)(e.basis2),o=(0,l.e)(e.basis1,r),n=(0,l.e)(e.basis2,r);return-o-i<0&&o-i<0&&-n-s<0&&n-s<0}function H(e,t){const r=j.get();return(0,l.c)(r.origin,e.origin),(0,l.c)(r.vector,t),r}function L(e,t,r){const{basis1:i,basis2:s,origin:o}=e,n=(0,l.g)(g.WM.get(),i,t.origin[0]),a=(0,l.g)(g.WM.get(),s,t.origin[1]);(0,l.a)(r.origin,n,a),(0,l.a)(r.origin,r.origin,o);const c=(0,l.g)(g.WM.get(),i,t.direction[0]),d=(0,l.g)(g.WM.get(),s,t.direction[1]);return(0,l.g)(r.vector,(0,l.a)(c,c,d),2),r}function N(e,t){Math.abs((0,l.e)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&m.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.e)(e.basis1,I(e)))>1e-6&&m.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.e)(I(e),e.origin)-e.plane[3])>1e-6&&m.warn(t,"Plane offset is not consistent with plane origin")}function F(e,t,r,i){const s=I(e);(0,u.my)(s,t.direction,t.origin,r),(0,u.my)((0,u.mJ)(r),s,t.origin,i)}const z={plane:(0,u.Ue)(),origin:(0,c.f)(0,0,0),basis1:(0,c.f)(1,0,0),basis2:(0,c.f)(0,1,0)},U=new o.x(u.Ue),j=new o.x(h.Ue),V=(0,c.c)(),W=new o.x((()=>_())),G=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],B=(0,a.c)(),k=(0,a.c)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:v,UP:z,altitudeAt:D,axisAt:function(e,t,r,i){return function(e,t,r){switch(t){case d.R.X:(0,l.c)(r,e.basis1),(0,l.n)(r,r);break;case d.R.Y:(0,l.c)(r,e.basis2),(0,l.n)(r,r);break;case d.R.Z:(0,l.c)(r,I(e))}return r}(e,r,i)},closestPoint:O,closestPointOnSilhouette:b,copy:y,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,u.JG)(t.plane,e.plane)},create:_,distance:E,distance2:P,distanceToSilhouette:function(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of G){const s=L(e,i,j.get()),o=(0,h.Jk)(s,t);o>r&&(r=o)}return Math.sqrt(r)},elevate:C,equals:function(e,t){return(0,l.k)(e.basis1,t.basis1)&&(0,l.k)(e.basis2,t.basis2)&&(0,l.k)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,u.Ac)(e.plane,t)&&M(e,t)},fromAABoundingRect:S,fromValues:T,intersectRay:x,intersectRayClosestSilhouette:function(e,t,r){if(x(e,t,r))return r;const i=b(e,t,g.WM.get());return(0,l.a)(r,t.origin,(0,l.g)(g.WM.get(),t.direction,(0,l.i)(t.origin,i)/(0,l.l)(t.direction))),r},normal:I,projectPoint:A,projectPointLocal:R,rotate:function(e,t,r,i){return e!==i&&y(e,i),(0,n.d)(k,t,r),(0,l.m)(i.basis1,e.basis1,k),(0,l.m)(i.basis2,e.basis2,k),w(i),i},setAltitudeAt:function(e,t,r,i){const s=D(e,t),o=(0,l.g)(V,I(e),r-s);return(0,l.a)(i,t,o),i},setExtent:function(e,t,r){return S(t,r),C(r,D(e,e.origin),r),r},transform:function(e,t,r){return e!==r&&y(e,r),(0,n.a)(B,t),(0,n.t)(B,B),(0,l.m)(r.basis1,e.basis1,B),(0,l.m)(r.basis2,e.basis2,B),(0,l.m)((0,u.mJ)(r.plane),(0,u.mJ)(e.plane),B),(0,l.m)(r.origin,e.origin,t),(0,u.T5)(r.plane,r.plane,r.origin),r},updateUnboundedPlane:w,wrap:function(e,t,r){const i=W.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=(0,u.re)(0,0,0,0),w(i),i}},Symbol.toStringTag,{value:"Module"}))},46228:(e,t,r)=>{r.d(t,{I:()=>s,v:()=>o});var i=r(16889);function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const s=(0,i.uZ)(e,0,l);for(let i=0;i<4;i++)t[r+i]=Math.floor(256*c(s*n[i]))}function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(let i=0;i<4;i++)r+=e[t+i]*a[i];return r}const n=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=o(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},81020:(e,t,r)=>{function i(e){return"point"===e.type}r.d(t,{f:()=>i})},91226:(e,t,r)=>{r.d(t,{co:()=>s,ii:()=>c});var i,s,o,n=r(81949),a=r(71353),l=r(46208);class c{constructor(){this.readChannels=l.uz.RG,this.renderingStage=l.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,a.c)(),this.isCameraPositionFinal=!0,this.parallax=new d,this.parallaxNew=new d,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:s.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:i.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:o.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===s.FADE_OUT||this.fadeInOut.stage===s.FADE_IN||this.fadeIn.stage===i.FADE_IN||this.fadeInOutHeight.stage!==o.FINISHED||this.renderingStage===l.jL.FADING_TEXTURE_CHANNELS}}!function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(i||(i={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(s||(s={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(o||(o={}));class d{constructor(){this.anchorPointClouds=(0,a.c)(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=(0,n.c)()}}},46208:(e,t,r)=>{var i,s;r.d(t,{jL:()=>i,uz:()=>s}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FINISHED_RENDERING=1]="FINISHED_RENDERING",e[e.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",e[e.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",e[e.FINISHED=4]="FINISHED"}(i||(i={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(s||(s={}))},78935:(e,t,r)=>{r.d(t,{o:()=>n});var i=r(92026),s=r(88152),o=r(8821);class n{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,s.Z7)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,o.ht)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=(0,s.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,i.Pt)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,r){if((0,i.Wi)(e))return void(this._featureExpressionInfoContext=null);const s=e&&e.arcade;s&&(0,i.pC)(t)&&(0,i.pC)(r)?(this._featureExpressionInfoContext=(0,o.d9)(e),(0,o.aO)(this._featureExpressionInfoContext,(0,o.Tz)(s.modules,t,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new n;return(0,i.pC)(e)&&t.setFromElevationInfo(e),t}}},69691:(e,t,r)=>{r.d(t,{B5:()=>v,GC:()=>g,Lm:()=>y,Xf:()=>m,bD:()=>_,lO:()=>i,qZ:()=>p,rR:()=>u,w7:()=>f});var i,s=r(92026),o=r(14226),n=r(81949),a=r(71353),l=r(79803),c=r(81020),d=r(96387),h=r(77648);function u(e,t,r,i,s,o,n,a,c,d,h){const u=T[h.mode];let p,f,g=0;if((0,l.CM)(e,t,r,i,c.spatialReference,s,a))return u.requiresAlignment(h)?(g=u.applyElevationAlignmentBuffer(i,s,o,n,a,c,d,h),p=o,f=n):(p=i,f=s),(0,l.CM)(p,c.spatialReference,f,o,d.spatialReference,n,a)?g:void 0}function p(e,t,r,i,o){const n=((0,c.f)(e)?e.z:(0,h.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":{const r=(0,s.Pt)((0,h.KO)(t,e,"ground"),0);return o.verticalDistanceToGround=0,o.sampledElevation=r,void(o.z=r)}case"relative-to-ground":{const a=(0,s.Pt)((0,h.KO)(t,e,"ground"),0),l=r.geometryZWithOffset(n,i);return o.verticalDistanceToGround=l,o.sampledElevation=a,void(o.z=l+a)}case"relative-to-scene":{const a=(0,s.Pt)((0,h.KO)(t,e,"scene"),0),l=r.geometryZWithOffset(n,i);return o.verticalDistanceToGround=l,o.sampledElevation=a,void(o.z=l+a)}case"absolute-height":{const a=r.geometryZWithOffset(n,i),l=(0,s.Pt)((0,h.KO)(t,e,"ground"),0);return o.verticalDistanceToGround=a-l,o.sampledElevation=l,void(o.z=a)}default:return void(o.z=0)}}function f(e,t,r,i){return p(e,t,r,i,C),C.z}function g(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?i.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function _(e,t,r,i,s){p(t,r,s,i,C),(0,d.CV)(e,C.verticalDistanceToGround);const n=C.sampledElevation,a=(0,o.c)(w,e.transformation);return S[0]=t.x,S[1]=t.y,S[2]=C.z,(0,l.Bm)(t.spatialReference,S,a,i.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),n}class y{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(i||(i={}));const T={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,i,s,o,n,a){const l=a.calculateOffsetRenderUnits(n),c=a.featureExpressionInfoContext;t*=3,i*=3;for(let d=0;d<s;++d){const s=e[t+0],o=e[t+1],n=e[t+2];r[i+0]=s,r[i+1]=o,r[i+2]=null==c?n+l:l,t+=3,i+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,o,n){let a=0;const l=n.spatialReference;t*=3,i*=3;for(let c=0;c<o;++c){const o=e[t+0],c=e[t+1],d=e[t+2],h=(0,s.Pt)(n.getElevation(o,c,d,l,"ground"),0);a+=h,r[i+0]=o,r[i+1]=c,r[i+2]=h,t+=3,i+=3}return a/o},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,i,o,n,a,l){let c=0;const d=l.calculateOffsetRenderUnits(a),h=l.featureExpressionInfoContext,u=n.spatialReference;t*=3,i*=3;for(let p=0;p<o;++p){const o=e[t+0],a=e[t+1],l=e[t+2],p=(0,s.Pt)(n.getElevation(o,a,l,u,"ground"),0);c+=p,r[i+0]=o,r[i+1]=a,r[i+2]=null==h?l+p+d:p+d,t+=3,i+=3}return c/o},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,i,o,n,a,l){let c=0;const d=l.calculateOffsetRenderUnits(a),h=l.featureExpressionInfoContext,u=n.spatialReference;t*=3,i*=3;for(let p=0;p<o;++p){const o=e[t+0],a=e[t+1],l=e[t+2],p=(0,s.Pt)(n.getElevation(o,a,l,u,"scene"),0);c+=p,r[i+0]=o,r[i+1]=a,r[i+2]=null==h?l+p+d:p+d,t+=3,i+=3}return c/o},requiresAlignment:()=>!0}},w=(0,n.c)(),C=new y,S=(0,a.c)()},8821:(e,t,r)=>{r.d(t,{O$:()=>f,Tz:()=>d,WI:()=>p,aO:()=>h,d9:()=>l,ht:()=>u,kr:()=>c});var i=r(32718),s=r(66978),o=r(37818),n=r(819);const a=i.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function l(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,r,i){const o=e&&e.expression;if("string"!=typeof o)return null;const a=m(o);if(null!=a)return{cachedResult:a};const l=await(0,n.LC)();(0,s.k_)(r);const c=l.arcadeUtils,d=c.createSyntaxTree(o);return c.dependsOnView(d)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:c.createFunction(d),context:c.createExecContext(null,{sr:t}),modules:l}}}function d(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function h(e,t){if(null!=e&&!g(e)){if(!t||!e.arcade)return void a.errorOncePerTick("Arcade support required but not provided");const r=t;r._geometry&&(r._geometry=(0,o.kB)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function u(e){if(null!=e){if(g(e))return e.cachedResult;const t=e.arcade;let r=t?.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function p(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e&&e.featureExpressionInfo;const i=r&&r.expression;return t||"0"===i||(r=null),r??null}const f={cachedResult:0};function g(e){return null!=e.cachedResult}function m(e){return"0"===e?0:null}},96387:(e,t,r)=>{r.d(t,{CV:()=>C,Go:()=>w,Si:()=>R,Uu:()=>S,ZL:()=>O,_Z:()=>A,bD:()=>x,bh:()=>b,zE:()=>_});var i=r(92026),s=r(68860),o=r(14226),n=r(81949),a=r(71353),l=r(90045),c=r(67077),d=r(79803),h=r(41414),u=r(65156),p=r(4954),f=r(69662),g=r(65618),m=r(37818),v=r(4760);function _(e,t){if("point"===e.type)return T(e,t,!1);if((0,m.Ou)(e))switch(e.type){case"extent":return T(e.center,t,!1);case"polygon":return T(e.centroid,t,!1);case"polyline":return T(y(e),t,!0);case"mesh":return T(e.origin,t,!1)}else switch(e.type){case"extent":return T(function(e){return(0,g.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return T(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=(0,p.a)(e.rings,!!e.hasZ);return(0,g.Tx)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return T(y(e),t,!0)}}function y(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=(0,f.n8)(t,(0,f.ok)(t)/2);return(0,g.Tx)(r[0],r[1],r[2],e.spatialReference)}function T(e,t,r){const i=r?e:(0,m.WG)(e);return t&&e?(0,d.nF)(e,i,t)?i:null:i}function w(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,u.Ue)());const s=e;let o=.5*s.width*(r-1),n=.5*s.height*(r-1);return s.width<1e-7*s.height?o+=n/20:s.height<1e-7*s.width&&(n+=o/20),(0,l.s)(t,s.xmin-o-i,s.ymin-n-i,s.xmax+o+i,s.ymax+n+i),t}return null}function C(e,t){for(let r=0;r<e.geometries.length;++r){const i=e.geometries[r].getMutableAttribute(v.T.AUXPOS1);i&&i.data[3]!==t&&(i.data[3]=t,e.geometryVertexAttrsUpdated(e.geometries[r]))}}function S(e,t){const r=(0,c.d)(c.O);return(0,i.pC)(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),(0,i.pC)(t)?r[3]=t:(0,i.pC)(e)&&e.length>3&&(r[3]=e[3]),r}function x(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.O,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const o=new Array(3);if((0,i.Wi)(t)||(0,i.Wi)(r))o[0]=1,o[1]=1,o[2]=1;else{let i,s=0;for(let n=2;n>=0;n--){const a=e[n];let l;const c=null!=a,d=0===n&&!i&&!c,h=r[n];"symbol-value"===a||d?l=0!==h?t[n]/h:1:c&&"proportional"!==a&&isFinite(a)&&(l=0!==h?a/h:1),null!=l&&(o[n]=l,i=l,s=Math.max(s,Math.abs(l)))}for(let e=2;e>=0;e--)null==o[e]?o[e]=i:0===o[e]&&(o[e]=.001*s)}for(let i=2;i>=0;i--)o[i]/=s;return(0,a.d)(o)}function b(e){return O(function(e){return null!=e.isPrimitive}(e)?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"}function O(e){if(Array.isArray(e)){for(const t of e)if(!O(t))return!1;return!0}return null==e||e>=0}function A(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,n.c)();const s=e||0,a=t||0,l=r||0;return 0!==s&&(0,o.o)(i,i,-s/180*Math.PI),0!==a&&(0,o.r)(i,i,a/180*Math.PI),0!==l&&(0,o.n)(i,i,l/180*Math.PI),i}function R(e,t,r){if(null!=r.minDemResolution)return r.minDemResolution;const i=(0,s.c9)(t),o=(0,h.bf)(e)*i,n=(0,h.Ye)(e)*i,a=(0,h.Cb)(e)*(t.isGeographic?1:i);return 0===o&&0===n&&0===a?r.minDemResolutionForPoints:.01*Math.max(o,n,a)}},26279:(e,t,r)=>{var i,s,o;r.d(t,{Lw:()=>i,al:()=>o,eZ:()=>s}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(i||(i={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(s||(s={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(o||(o={}))},77648:(e,t,r)=>{r.d(t,{Fb:()=>n,KO:()=>a,sb:()=>o});var i=r(92026),s=r(81020);class o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=e,this.spatialReference=t,this.offset=r}}function n(e){return"array"in e}function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,s.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(n(t)){let s=t.offset;return e.getElevation(t.array[s++],t.array[s++],t.array[s]||0,(0,i.Pt)(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},2522:(e,t,r)=>{r.d(t,{Ch:()=>o,Hl:()=>l,_Z:()=>a,uM:()=>c,vT:()=>s});var i=r(67794);const s=64,o=s/2,n=o/5,a=s/n,l=.25;function c(e,t){return e.fromData(`${t}-marker`,(()=>(0,i.cU)(t,s,o,n)))}},67794:(e,t,r)=>{r.d(t,{Ns:()=>a,Ph:()=>n,cU:()=>l});r(93169);var i=r(46228),s=r(76873),o=r(8548);const n=128,a=.5;function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const l=c(e,t,r,i);return new s.x(l,{mipmap:!1,wrap:{s:o.e8.CLAMP_TO_EDGE,t:o.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return d(t,r);case"square":return h(t,r);case"cross":return p(t,r,i);case"x":return f(t,r,i);case"kite":return u(t,r);case"triangle":return g(t,r);case"arrow":return m(t,r)}}function d(e,t){const r=e/2-.5;return w(e,y(r,r,t/2))}function h(e,t){return v(e,t,!1)}function u(e,t){return v(e,t,!0)}function p(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _(e,t,!1,r)}function f(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _(e,t,!0,r)}function g(e,t){return w(e,T(e/2,t,t/2))}function m(e,t){const r=t,i=t/2,s=e/2,o=.8*r,n=y(s,(e-t)/2-o,Math.sqrt(o*o+i*i)),a=T(s,r,i);return w(e,((e,t)=>Math.max(a(e,t),-n(e,t))))}function v(e,t,r){return r&&(t/=Math.SQRT2),w(e,((i,s)=>{let o=i-.5*e+.25,n=.5*e-s-.75;if(r){const e=(o+n)/Math.SQRT2;n=(n-o)/Math.SQRT2,o=e}return Math.max(Math.abs(o),Math.abs(n))-.5*t}))}function _(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=i,r&&(t*=Math.SQRT2);const s=.5*t;return w(e,((t,o)=>{let n,a=t-.5*e,l=.5*e-o-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),n=a>l?a>s?Math.sqrt((a-s)*(a-s)+l*l):l:l>s?Math.sqrt(a*a+(l-s)*(l-s)):a,n-=i/2,n}))}function y(e,t,r){return(i,s)=>{const o=i-e,n=s-t;return Math.sqrt(o*o+n*n)-r}}function T(e,t,r){const i=Math.sqrt(t*t+r*r);return(s,o)=>{const n=Math.abs(s-e)-r,a=o-e+t/2+.75,l=(t*n+r*a)/i,c=-a;return Math.max(l,c)}}function w(e,t){const r=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let o=0;o<e;o++){const n=o+e*s;let a=t(o,s);a=a/e+.5,(0,i.I)(a,r,4*n)}return r}},19653:(e,t,r)=>{r.d(t,{Rn:()=>rr});var i,s=r(27366),o=r(85015),n=r(91505),a=r(100),l=r(77427),c=r(92026),d=r(27546),h=r(94172),u=r(92377),p=r(49861),f=(r(25243),r(63780)),g=r(69912),m=r(14226),v=r(11186),_=r(71353),y=r(50951),T=r(26279),w=r(94463),C=r(54134),S=r(65156),x=r(68401),b=r(61403);!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded",e[e.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"}(i||(i={}));class O{get extent(){return this._extent}constructor(e,t){this.index=e,this.renderTargets=t,this._extent=(0,S.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,b.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new A,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===i.ColorAndWater?this.renderTargets.getTarget(C.NH.Color):e===i.Highlight?this.renderTargets.getTarget(C.NH.Highlight):e===i.ObjectAndLayerIdColor?this.renderTargets.getTarget(C.NH.ObjectAndLayerIdColor):this.renderTargets.getTarget(C.NH.Occluded);return t?t.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(C.NH.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(C.NH.Color):null}getNormalTexture(e){const t=e===i.ColorAndWater?this.renderTargets.getTarget(C.NH.Water):null;return t?t.getTexture():null}draw(e,t){const r=this.computeRenderTargetValidityBitfield();for(const i of this.renderTargets.renderTargets)i.type!==C.NH.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[i.type]=e.drawTarget(this,i,t):this.validTargets[i.type]=!1;return r^this.computeRenderTargetValidityBitfield()?x.Yg.CHANGED:x.Yg.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[C.NH.Color]|+e[C.NH.ColorNoRasterImage]<<1|+e[C.NH.Highlight]<<2|+e[C.NH.Water]<<3|+e[C.NH.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,S.cv)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,S.cv)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,S.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===C.fu.INNER?0:this.resolution,0,this.resolution,this.resolution)}}class A{constructor(){this.extents=[(0,S.Ue)(),(0,S.Ue)(),(0,S.Ue)()],this.numViews=0}}var R=r(15245),P=r(8548),E=r(53634);class D{constructor(e,t){this._size=(0,R.c)(),this._fbo=null,this._fbo=new E.X(e,{colorTarget:P.Lm.TEXTURE,depthStencilTarget:P.OU.NONE},{target:P.No.TEXTURE_2D,pixelFormat:P.VI.RGBA,dataType:P.Br.UNSIGNED_BYTE,wrapMode:P.e8.CLAMP_TO_EDGE,samplingMode:P.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=(0,c.M2)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this._size[0]=e,this._size[1]=t,this._fbo.resize(this._size[0],this._size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){this._fbo?.resize(0,0)}get gpuMemoryUsage(){return this._fbo?.gpuMemoryUsage??0}}var I=r(93169),M=r(37081);class H{constructor(e,t,r){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.output=t,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new D(e,i)}}class L{constructor(e){this.renderTargets=[new H(e,M.H.Color,C.NH.Color),new H(e,M.H.Color,C.NH.ColorNoRasterImage),new H(e,M.H.Highlight,C.NH.Highlight,!1),new H(e,M.H.Normal,C.NH.Water),new H(e,M.H.Color,C.NH.Occluded)],(0,I.Z)("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new H(e,M.H.ObjectAndLayerIdColor,C.NH.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>N)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,t)=>e+t.fbo.gpuMemoryUsage),0)}}const N=1e3;var F=r(61863),z=r(59447),U=r(33559);class j{constructor(e){this._context=e,this._perConstructorInstances=new z.r,this._frameCounter=0,this._keepAliveFrameCount=W}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:G;const r=t.key;let i=this._perConstructorInstances.get(e,r);if((0,c.Wi)(i)){const s=new e(this._context,t,(()=>this.release(s)));i=new V(s),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}releaseAndAcquire(e,t,r){if((0,c.pC)(r)){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}release(e){if((0,c.Wi)(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);(0,c.Wi)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==W&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,r)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,r))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,r)=>{e.push((async(e,t)=>{const r=t.shader;r&&(await r.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,r))})),await Promise.all(e)}}class V{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const W=-1,G=new U.m;var B=r(86755),k=r(32718),$=r(97731);class Z{constructor(e,t,r,i){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new z.r}dispose(){this._textureRepository.destroy()}acquire(e,t,r){if(this._ownMaterial(e),!e.requiresSlot(t,r))return null;let i=this._id2glMaterialRef.get(r,e.id);if((0,c.Wi)(i)){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});i=new q(t),this._id2glMaterialRef.set(r,e.id,i)}return i.ref(),i.glMaterial}release(e,t){const r=this._id2glMaterialRef.get(t,e.id);(0,c.pC)(r)&&(r.unref(),r.referenced||((0,c.M2)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){(0,c.pC)(e.repository)&&e.repository!==this&&k.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class q{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,$.hu)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var J=r(32534),X=r(87145),Y=r(56529),Q=r(6394),K=r(91226),ee=r(43565),te=r(15226),re=r(40854),ie=r(93822),se=r(25920),oe=r(48919);class ne{constructor(e,t,r){this.shadowMap=e,this.ssaoHelper=t,this.slicePlane=r,this.slot=ie.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=se.A.NONE,this._camera=new B.V,this._inverseViewport=(0,Q.a)(),this.oldLighting=new oe.c,this.newLighting=new oe.c,this._fadedLighting=new oe.c,this._lighting=this.newLighting,this.ssr=new re.O,this.multipassTerrain=new te.a,this.multipassGeometry=new ee._,this.overlays=[],this.cloudsFade=new K.ii}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(t,r,e),this._lighting=this._fadedLighting)}}class ae{constructor(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new B.V,this.output=M.H.Color,this.renderOccludedMask=le,this.bindParameters=new ne(t,r,(0,c.pC)(i)?i.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=le}}const le=Y.yD.Occlude|Y.yD.OccludeAndTransparent|Y.yD.OccludeAndTransparentStencil;var ce=r(16889),de=r(11873),he=r(81949),ue=r(88396),pe=r(90045),fe=r(67077);let ge=class extends B.V{constructor(){super(...arguments),this._projectionMatrix=(0,he.c)()}get projectionMatrix(){return this._projectionMatrix}};(0,s._)([(0,p.Cb)()],ge.prototype,"_projectionMatrix",void 0),(0,s._)([(0,p.Cb)({readOnly:!0})],ge.prototype,"projectionMatrix",null),ge=(0,s._)([(0,g.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],ge);var me,ve=r(51378),_e=r(3384);!function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"}(me||(me={}));class ye{constructor(){this.camera=new ge,this.lightMat=(0,he.c)()}}class Te{get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,pe.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,t){this._rctx=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this._maxNumCascades=4,this._projectionView=(0,he.c)(),this._projectionViewInverse=(0,he.c)(),this._modelViewLight=(0,he.c)(),this._splitSchemeLambda=0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,fe.c)(),this._cascades=[new ye,new ye,new ye,new ye],this._lastOrigin=null,this._maxTextureSize=Math.min((0,I.Z)("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(e){this._maxNumCascades=(0,ce.uZ)(Math.floor(e),1,4)}get maxCascades(){return this._maxNumCascades}set enabled(e){this._enabled=e,e||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&(0,c.pC)(this._depthTexture)}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Ee[e]=this._cascades[e];return Ee.length=this._numCascades,Ee}start(e,t,r){(0,$.hu)(this.enabled),this._textureSize=this._computeTextureSize(e.fullWidth,e.fullHeight),this._ensureDepthTexture();const{near:i,far:s}=this._clampNearFar(r);this._computeCascadeDistances(s,i),this._setupMatrices(e,t);const{viewMatrix:o,projectionMatrix:n}=e;for(let a=0;a<this._numCascades;++a)this._constructCascade(a,n,o,t);this._lastOrigin=null,this.clear()}finish(e){(0,$.hu)(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,v.k)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,_.c)(),(0,v.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,m.w)(De,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)Ie[16*t+e]=De[e]}}return Ie}takeCascadeSnapshotTo(e,t){(0,$.hu)(this.enabled);const r=this._ensureSnapshot(t);this._bindFbo();const i=this._rctx,s=i.bindTexture(r,ve.x.TEXTURE_UNIT_FOR_UPDATES);i.gl.copyTexSubImage2D(P.No.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),i.bindTexture(s,ve.x.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(P.lk.COLOR_BUFFER_BIT|P.lk.DEPTH_BUFFER_BIT)}_computeTextureSize(e,t){const r=.5*Math.log(e*e+t*t)*Math.LOG2E,i=2**Math.round(r+.35);return Math.min(this._maxTextureSize,2*i)}_ensureDepthTexture(){if((0,c.pC)(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const e={target:P.No.TEXTURE_2D,pixelFormat:P.VI.RGBA,dataType:P.Br.UNSIGNED_BYTE,wrapMode:P.e8.CLAMP_TO_EDGE,samplingMode:P.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ve.x(this._rctx,e),this._fbo=new E.X(this._rctx,{colorTarget:P.Lm.TEXTURE,depthStencilTarget:P.OU.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(e){let t=this._snapshots[e];if((0,c.pC)(t)&&t.descriptor.width===this._textureSize)return t;this._discardSnapshot(e);const r={target:P.No.TEXTURE_2D,pixelFormat:P.VI.RGBA,dataType:P.Br.UNSIGNED_BYTE,wrapMode:P.e8.CLAMP_TO_EDGE,samplingMode:P.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return t=new ve.x(this._rctx,r),this._snapshots[e]=t,t}_discardDepthTexture(){this._fbo=(0,c.M2)(this._fbo),this._depthTexture=(0,c.M2)(this._depthTexture)}_discardSnapshot(e){this._snapshots[e]=(0,c.M2)(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this._depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,t,r,i){const s=this._cascades[e],o=-this._cascadeDistances[e],n=-this._cascadeDistances[e+1],a=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]),l=(t[10]*n+t[14])/Math.abs(t[11]*n+t[15]);(0,$.hu)(a<l);for(let u=0;u<8;++u){(0,pe.s)(Ce,u%4==0||u%4==3?-1:1,u%4==0||u%4==1?-1:1,u<4?a:l,1);const e=Se[u];(0,pe.t)(e,Ce,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,v.o)(Pe,Se[0]),s.camera.viewMatrix=(0,m.w)(we,this._modelViewLight,Pe);for(let u=0;u<8;++u)(0,v.m)(Se[u],Se[u],s.camera.viewMatrix);let c=Se[0][2],d=Se[0][2];for(let u=1;u<8;++u)c=Math.min(c,Se[u][2]),d=Math.max(d,Se[u][2]);c-=200,d+=200,s.camera.near=-d,s.camera.far=-c,function(e,t,r,i,s){const o=1/Se[0][3],n=1/Se[4][3];(0,$.hu)(o<n);let a=o+Math.sqrt(o*n);const l=Math.sin((0,ce.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,r,i,s,o,n,a){(0,ue.s)(Me,0,0);for(let w=0;w<4;++w)(0,ue.j)(Me,Me,e[w]);(0,ue.b)(Me,Me,.25),(0,ue.s)(He,0,0);for(let w=4;w<8;++w)(0,ue.j)(He,He,e[w]);(0,ue.b)(He,He,.25),(0,ue.l)(Le[0],e[4],e[5],.5),(0,ue.l)(Le[1],e[5],e[6],.5),(0,ue.l)(Le[2],e[6],e[7],.5),(0,ue.l)(Le[3],e[7],e[4],.5);let l=0,c=(0,ue.k)(Le[0],Me);for(let w=1;w<4;++w){const e=(0,ue.k)(Le[w],Me);e<c&&(c=e,l=w)}(0,ue.a)(Ne,Le[l],e[l+4]);const d=Ne[0];let h,u;Ne[0]=-Ne[1],Ne[1]=d,(0,ue.a)(Fe,He,Me),(0,ue.h)(Fe,Ne)<0&&(0,ue.n)(Ne,Ne),(0,ue.l)(Ne,Ne,Fe,r),(0,ue.f)(Ne,Ne),h=u=(0,ue.h)((0,ue.a)(ze,e[0],Me),Ne);for(let w=1;w<8;++w){const t=(0,ue.h)((0,ue.a)(ze,e[w],Me),Ne);t<h?h=t:t>u&&(u=t)}(0,ue.c)(i,Me),(0,ue.b)(ze,Ne,h-t),(0,ue.j)(i,i,ze);let p=-1,f=1,g=0,m=0;for(let w=0;w<8;++w){(0,ue.a)(Ue,e[w],i),(0,ue.f)(Ue,Ue);const t=Ne[0]*Ue[1]-Ne[1]*Ue[0];t>0?t>p&&(p=t,g=w):t<f&&(f=t,m=w)}(0,$.T)(p>0,"leftArea"),(0,$.T)(f<0,"rightArea"),(0,ue.b)(je,Ne,h),(0,ue.j)(je,je,Me),(0,ue.b)(Ve,Ne,u),(0,ue.j)(Ve,Ve,Me),We[0]=-Ne[1],We[1]=Ne[0];const v=(0,$.ep)(i,e[m],Ve,(0,ue.j)(ze,Ve,We),1,s),_=(0,$.ep)(i,e[g],Ve,ze,1,o),y=(0,$.ep)(i,e[g],je,(0,ue.j)(ze,je,We),1,n),T=(0,$.ep)(i,e[m],je,ze,1,a);(0,$.T)(v,"rayRay"),(0,$.T)(_,"rayRay"),(0,$.T)(y,"rayRay"),(0,$.T)(T,"rayRay")}(Se,a,l,xe,be,Oe,Ae,Re),function(e,t,r,i,s){(0,ue.a)($e,r,i),(0,ue.b)($e,$e,.5),Ze[0]=$e[0],Ze[1]=$e[1],Ze[2]=0,Ze[3]=$e[1],Ze[4]=-$e[0],Ze[5]=0,Ze[6]=$e[0]*$e[0]+$e[1]*$e[1],Ze[7]=$e[0]*$e[1]-$e[1]*$e[0],Ze[8]=1,Ze[Ge(0,2)]=-(0,ue.h)(ke(Ze,0),e),Ze[Ge(1,2)]=-(0,ue.h)(ke(Ze,1),e);let o=(0,ue.h)(ke(Ze,0),r)+Ze[Ge(0,2)],n=(0,ue.h)(ke(Ze,1),r)+Ze[Ge(1,2)],a=(0,ue.h)(ke(Ze,0),i)+Ze[Ge(0,2)],l=(0,ue.h)(ke(Ze,1),i)+Ze[Ge(1,2)];o=-(o+a)/(n+l),Ze[Ge(0,0)]+=Ze[Ge(1,0)]*o,Ze[Ge(0,1)]+=Ze[Ge(1,1)]*o,Ze[Ge(0,2)]+=Ze[Ge(1,2)]*o,o=1/((0,ue.h)(ke(Ze,0),r)+Ze[Ge(0,2)]),n=1/((0,ue.h)(ke(Ze,1),r)+Ze[Ge(1,2)]),Ze[Ge(0,0)]*=o,Ze[Ge(0,1)]*=o,Ze[Ge(0,2)]*=o,Ze[Ge(1,0)]*=n,Ze[Ge(1,1)]*=n,Ze[Ge(1,2)]*=n,Ze[Ge(2,0)]=Ze[Ge(1,0)],Ze[Ge(2,1)]=Ze[Ge(1,1)],Ze[Ge(2,2)]=Ze[Ge(1,2)],Ze[Ge(1,2)]+=1,o=(0,ue.h)(ke(Ze,1),t)+Ze[Ge(1,2)],n=(0,ue.h)(ke(Ze,2),t)+Ze[Ge(2,2)],a=(0,ue.h)(ke(Ze,1),r)+Ze[Ge(1,2)],l=(0,ue.h)(ke(Ze,2),r)+Ze[Ge(2,2)],o=-.5*(o/n+a/l),Ze[Ge(1,0)]+=Ze[Ge(2,0)]*o,Ze[Ge(1,1)]+=Ze[Ge(2,1)]*o,Ze[Ge(1,2)]+=Ze[Ge(2,2)]*o,o=(0,ue.h)(ke(Ze,1),t)+Ze[Ge(1,2)],n=(0,ue.h)(ke(Ze,2),t)+Ze[Ge(2,2)],a=-n/o,Ze[Ge(1,0)]*=a,Ze[Ge(1,1)]*=a,Ze[Ge(1,2)]*=a,s[0]=Ze[0],s[1]=Ze[1],s[2]=0,s[3]=Ze[2],s[4]=Ze[3],s[5]=Ze[4],s[6]=0,s[7]=Ze[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ze[6],s[13]=Ze[7],s[14]=0,s[15]=Ze[8]}(xe,be,Ae,Re,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}(r,i,c,d,s.camera),(0,m.m)(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const h=this._textureSize/2;s.camera.viewport=[e%2==0?0:h,0===Math.floor(e/2)?0:h,h,h]}_setupMatrices(e,t){(0,m.m)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,m.a)(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===y.JY.Global?e.eye:(0,v.s)(Pe,0,0,1);(0,m.u)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],r)}_clampNearFar(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}_computeCascadeDistances(e,t){this._numCascades=Math.min(1+Math.floor((0,$.E6)(e/t,4)),this._maxNumCascades);const r=(e-t)/this._numCascades,i=(e/t)**(1/this._numCascades);let s=t,o=t;for(let n=0;n<this._numCascades+1;++n)this._cascadeDistances[n]=(0,ce.t7)(s,o,this._splitSchemeLambda),s*=i,o+=r}get gpuMemoryUsage(){return this._snapshots.reduce(((e,t)=>e+(0,_e.un)(t)),this._fbo?.gpuMemoryUsage??0)}get test(){const e=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(t){e._splitSchemeLambda=t},get splitSchemeLambda(){return e._splitSchemeLambda}}}}const we=(0,he.c)(),Ce=(0,fe.c)(),Se=[];for(let sr=0;sr<8;++sr)Se.push((0,fe.c)());const xe=(0,Q.a)(),be=(0,Q.a)(),Oe=(0,Q.a)(),Ae=(0,Q.a)(),Re=(0,Q.a)(),Pe=(0,_.c)(),Ee=[],De=(0,he.c)(),Ie=new Float32Array(64),Me=(0,Q.a)(),He=(0,Q.a)(),Le=[(0,Q.a)(),(0,Q.a)(),(0,Q.a)(),(0,Q.a)()],Ne=(0,Q.a)(),Fe=(0,Q.a)(),ze=(0,Q.a)(),Ue=(0,Q.a)(),je=(0,Q.a)(),Ve=(0,Q.a)(),We=(0,Q.a)();function Ge(e,t){return 3*t+e}const Be=(0,Q.a)();function ke(e,t){return(0,ue.s)(Be,e[t],e[t+3]),Be}const $e=(0,Q.a)(),Ze=(0,de.c)();var qe=r(54463),Je=r(55848);r(22178);class Xe extends Je.Dx{constructor(e,t,r){super(e,t),this.triangleNr=r}}class Ye{constructor(){this.adds=new d.Z,this.removes=new d.Z,this.updates=new d.Z({allocator:e=>e||new Qe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class Qe{}class Ke{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var et=r(88153),tt=r(78289);function rt(e){return e.geometry.indexCount>=1}var it=r(50256),st=r(44070);class ot{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createProgram()}_createProgram(){return this._rctx.programCache.acquire("\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }","\n    void main(void) {\n      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }",new Map([]))}_createIndexbuffer(){return st.f.createIndex(this._rctx,P.l1.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,P.w0.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(P.MX.POINTS,1,P.g.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}}var nt=r(94425),at=r(85380);class lt extends at.Pf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,_.c)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}var ct=r(47475);class dt{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function ht(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let r=!0;for(;r;)r=!1,e.forEach((i=>{const s=t.get(i.to);s&&(i.to=s.to,t.delete(s.from),e.removeUnordered(s),r=!0)}))}class ut extends dt{constructor(e,t,r){super(t,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return(0,c.pC)(this.geometry.highlights)&&this.isVisible}get hasOccludees(){return(0,c.pC)(this.geometry.occludees)}}class pt{constructor(){this.first=0,this.count=0}}class ft{constructor(){this._numElements=0,this._instances=new Map,this.holes=new d.Z({allocator:e=>e||new dt,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=gt(),this.drawCommandsHighlight=gt(),this.drawCommandsOccludees=gt(),this.drawCommandsShadowHighlightRest=gt()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,r){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,i.from=t,i.to=r,this._numElements+=i.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),r=this.holes.front();return(0,c.pC)(this.vao)&&1===this.holes.length&&r.to===Math.floor(this.vao.size/e)?(t.first=0,void(t.count=r.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const r of t)r.isVisible&&(mt(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),mt(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function gt(){return new d.Z({allocator:e=>e||new pt,deallocator:e=>e})}function mt(e,t){const r=e.back();if(null==r){const r=e.pushNew();return r.first=t.from,void(r.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.numElements;r.count=e}else{const r=e.pushNew();r.first=t.from,r.count=t.numElements}}class vt{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var _t=r(18759),yt=r(95439),Tt=r(80658);const wt=_t.an+1;class Ct{constructor(e,t,r){this._rctx=e,this._locations=t,this._layout=r,this._cache=e.newCache(`VaoCache ${(0,yt.D)()}`,St)}dispose(){this._cache.destroy()}newVao(e){const t=e.toString(),r=this._cache.pop(t);if((0,c.pC)(r)){const i=r.pop();return r.length>0&&this._cache.put(t,r,e*r.length,wt),i}const i=new Tt.U(this._rctx,this._locations,{geometry:this._layout},{geometry:st.f.createVertex(this._rctx,P.l1.STATIC_DRAW)});return i.vertexBuffers.geometry.setSize(e),i}deleteVao(e){if((0,c.Wi)(e))return null;const t=e.size,r=t.toString(),i=this._cache.pop(r);return(0,c.pC)(i)?(i.push(e),this._cache.put(r,i,t*i.length,-1)):this._cache.put(r,[e],t,-1),null}}function St(e,t){if(t===_t.lN.ALL)return void e.forEach((e=>e.dispose()));const r=e.pop(),i=e.length*r.size;return r.dispose(),i}class xt{constructor(e,t,r){this._rctx=e,this._materialRepository=t,this.material=r,this._dataByOrigin=new Map,this._appleAmdDriverHelper=null,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new nt.p(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new Ct(e,r.vertexAttributeLocations,(0,it.K)(this._bufferWriter.vertexBufferLayout)),this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new ot(this._rctx))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache.dispose(),this._appleAmdDriverHelper?.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof ct.H}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Y.yD.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter,r=t.vertexBufferLayout.stride/4;for(const i of e){const e=i.renderGeometry,s=this._dataByOrigin.get(e.localOrigin.id)?.findBuffer(e.id);if((0,c.Wi)(s))return;const o=s.instances.get(e.id);if(i.updateType&(tt.$.GEOMETRY|tt.$.TRANSFORMATION)){const i=Nt(t.elementCount(o.geometry.geometry)*r),n=t.vertexBufferLayout.createView(i.buffer);this._writeGeometry(e,n,0),s.vao.vertexBuffers.geometry.setSubData(i,o.from*r,0,o.numElements*r)}i.updateType&(tt.$.HIGHLIGHT|tt.$.OCCLUDEE|tt.$.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const r=new z.r;for(const i of e){const e=i.localOrigin;if((0,c.Wi)(e))continue;let t=r.get(e.id,null);(0,c.Wi)(t)&&(t=new bt(e.vec3),r.set(e.id,null,t)),t.changes.push(i)}for(const i of t){const e=i.localOrigin;if((0,c.Wi)(e))continue;const t=this._dataByOrigin.get(e.id)?.findBuffer(i.id);if((0,c.Wi)(t))continue;let s=r.get(e.id,t);(0,c.Wi)(s)&&(s=new bt(e.vec3),r.set(e.id,t,s)),s.changes.push(i)}return r}_addAndRemoveGeometries(e,t){const{_bufferWriter:r,_dataByOrigin:i}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,t);o.forEach(((e,t)=>{const n=e.get(null),a=(0,c.pC)(n)?n.changes:[];o.delete(t,null);let l=i.get(t);if(e.forEach(((e,n)=>{if(o.delete(t,n),(0,c.Wi)(n))return void(0,$.hu)(!1,"No VAO for removed geometries");if(n.instances.size===e.changes.length)return this._vaoCache.deleteVao(n.vao),(0,f.e$)(l.buffers,n),void(0===l.buffers.length&&0===a.length&&i.delete(t));const d=n.numElements,h=n.vao.size/4,u=a.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),p=e.changes.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),g=Math.min((d+u-p)*s,Ht),m=g>h;g>Dt&&g<h/2?(e.changes.forEach((e=>{let{id:t}=e;return n.deleteInstance(t)})),n.instances.forEach((e=>{let{geometry:t}=e;return a.push(t)})),this._vaoCache.deleteVao(n.vao),(0,f.e$)(l.buffers,n)):m?this._applyAndRebuild(n,a,e):this._applyRemoves(n,e)})),a.length>0)for((0,c.Wi)(l)&&(l=new vt(n.origin),i.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new ft,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,l.oE)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,r){if((0,c.pC)(r))for(const c of r.changes)e.deleteInstance(c.id);const i=this._bufferWriter,s=i.vertexBufferLayout.stride,o=s/4,n=Math.floor(Ht/o);let a=e.numElements;for(;t.length>0;){const r=t.pop(),s=i.elementCount(r.geometry);if(a+s>n&&a>0){t.push(r);break}a+=s;const o=new ut(r,0,0);(0,$.hu)(null==e.instances.get(r.id)),e.addInstance(r.id,o)}const l=a*o,d=Nt(l),h=i.vertexBufferLayout.createView(d.buffer);let u=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,r)=>{this._writeGeometry(t.geometry,h,u);const s=u;u+=i.elementCount(t.geometry.geometry),e.updateInstance(r,s,u),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Ft(l)),e.vao.vertexBuffers.geometry.setSubData(d,0,0,u*o),e.holes.clear();const p=e.holes.pushNew();return p.from=u,p.to=Math.floor(e.vao.size/s),e.updateDrawCommands(s),e}_applyRemoves(e,t){if(0===t.changes.length)return;for(const n of t.changes){const t=n.id,r=e.instances.get(t);if(!r)continue;e.deleteInstance(t);const i=Et.back();if(i){if(i.to===r.from){i.to=r.to;continue}if(i.from===r.to){i.from=r.from;continue}}const s=Et.pushNew();s.from=r.from,s.to=r.to}ht(Et);const r=this._bufferWriter.vertexBufferLayout.stride/4,i=Et.reduce(((e,t)=>Math.max(e,t.numElements)),0)*r,s=Nt(i);s.fill(0,0,i);const o=e.vao.vertexBuffers.geometry;Et.forAll((e=>o.setSubData(s,e.from*r,0,e.numElements*r))),e.holes.pushArray(Et.data,Et.length),Et.forAll(((e,t)=>Et.data[t]=null)),Et.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length)return;if(!function(e){return(0,c.pC)(e.vao)}(e))return void this._applyAndRebuild(e,t,null);const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,s=e.numElements,o=t.reduce(((e,t)=>e+r.elementCount(t.geometry)),0),n=Math.min((s+o)*i,Ht),a=4*n;if(e.vao.size<Ft(Ht-Dt)&&a>e.vao.size)return void this._applyAndRebuild(e,t,null);ht(e.holes);const l=new Array;for(const c of t){const t=r.elementCount(c.geometry),i=Ot(e.holes,t);l.push(i)}const d=e.vao.vertexBuffers.geometry;let h=0,u=0,p=0;const g=Nt(n),m=r.vertexBufferLayout.createView(g.buffer);t.forEach(((t,s)=>{const o=l[s];if((0,c.Wi)(o))return;if(p!==o){const e=p-u;e>0&&d.setSubData(g,u*i,0,e*i),u=o,h=0}const n=r.elementCount(t.geometry);this._writeGeometry(t,m,h),h+=n,p=o+n;const a=new ut(t,o,o+n);(0,$.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const v=p-u;v>0&&d.setSubData(g,u*i,0,v*i),(0,f.hv)(t,((e,t)=>(0,c.Wi)(l[t])))}_writeGeometry(e,t,r){const i=e.localOrigin.vec3;(0,$.u_)(At,-i[0],-i[1],-i[2]);const s=(0,m.m)(Rt,At,e.transformation);(0,m.a)(Pt,s),(0,m.t)(Pt,Pt),this._bufferWriter.write(s,Pt,e.geometry,t,r)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,t){return this.material.requiresSlot(e,t)}render(e,t){if(!this.requiresSlot(t.slot,e))return!1;const r=e===M.H.Highlight||e===M.H.ShadowHighlight;if(r&&!this._hasHighlights)return!1;const i=e===M.H.ShadowExcludeHighlight,s=!(r||i),o=this._rctx;let n;const a=()=>{if((0,c.pC)(n))return n;const r=this._glMaterials.load(o,t.slot,e);return(0,c.Wi)(r)?null:(n=r.beginSlot(t),(0,c.Wi)(n)?null:(o.bindTechnique(n,this.material.parameters,t),n))};this._appleAmdDriverHelper?.resetIndicesType();for(const l of this._dataByOrigin.values())for(const e of l.buffers){if(r&&!e.hasHighlights)continue;const n=(r?e.drawCommandsHighlight:i&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,d=s&&e.drawCommandsOccludees||null;if(n?.length||d?.length){const r=a();if((0,c.Wi)(r))return!1;r.program.bindDraw(new lt(l.origin),t,this.material.parameters),r.ensureAttributeLocations(e.vao),o.bindVAO(e.vao),n?.length&&(r.bindPipelineState(o,t.slot,!1),n.forAll((e=>o.drawArrays(r.primitiveType,e.first,e.count)))),d?.length&&(r.bindPipelineState(o,t.slot,!0),d.forAll((e=>o.drawArrays(r.primitiveType,e.first,e.count))))}}return(0,c.pC)(n)}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class bt{constructor(e){this.origin=e,this.changes=new Array}}function Ot(e,t){let r;if(!e.some((e=>!(e.numElements<t)&&(r=e,!0))))return null;const i=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),i}const At=(0,he.c)(),Rt=(0,he.c)(),Pt=(0,he.c)(),Et=new d.Z({allocator:e=>e||new dt,deallocator:null}),Dt=65536,It=4*Dt,Mt=16777216,Ht=Mt/4;let Lt=new Float32Array(Dt);function Nt(e){return Lt.length<e&&(Lt=new Float32Array(e)),Lt}function Ft(e){const t=4*e;return t<It?It:Math.max(Math.min(Math.ceil(1.5*t/It)*It,Mt),t)}let zt=class extends o.Z{constructor(e){super(e),this._pending=new Ut,this._changes=new Ye,this._materialRenderers=new Map,this._sortedMaterialRenderers=new d.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return(0,l.oE)(this._materialRenderers,(e=>e.rendersOccluded))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=function(e){const t=new Map,r=e=>{let r=t.get(e);return r||(r=new Ke,t.set(e,r)),r};return e.removes.forAll((e=>{rt(e)&&r(e.material).removes.push(e)})),e.adds.forAll((e=>{rt(e)&&r(e.material).adds.push(e)})),e.updates.forAll((e=>{rt(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}(this._changes);let t=!1,r=!1,i=!1;return e.forEach(((e,s)=>{let o=this._materialRenderers.get(s);if(!o&&e.adds.length>0&&(o=new xt(this.rctx,this._materialRepository,s),this._materialRenderers.set(s,o),t=!0,r=!0,i=!0),!o)return;const n=r||o.hasHighlights,a=i||o.hasWater;o.modify(e),r=r||n!==o.hasHighlights,i=i||a!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(s),o.dispose(),t=!0)})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=(0,l.oE)(this._materialRenderers,(e=>e.hasHighlights))),i&&(this._hasWater=(0,l.oE)(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const i=this._pending.empty;for(const s of r)this._pending.adds.add(s);i&&this.notifyChange("updating"),t===tt.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const s of e)i.has(s)?(this._pending.removed.add(s),i.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete((0,c.Wg)(s.id));r&&!this._pending.empty&&this.notifyChange("updating"),t===tt.T.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=0===this._changes.updates.length;for(const i of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(i),e.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case tt.$.TRANSFORMATION:case tt.$.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case tt.$.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((r=>t=r.updateAnimation(e)||t)),t}render(e){this._sortedMaterialRenderers.forAll((t=>{t.material.shouldRender(e)&&t.render(e.output,e.bindParameters)}))}intersect(e,t,r,i,s){return this._geometries.forEach((o=>{if(i&&!i(o))return;this._intersectRenderGeometry(o,r,t,0,e,s);const n=this.rendererContext.longitudeCyclical;n&&(o.boundingSphere[0]-o.boundingSphere[3]<n.min&&this._intersectRenderGeometry(o,r,t,n.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>n.max&&this._intersectRenderGeometry(o,r,t,-n.range,e,s)),s++})),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((t,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(t)})),this._sortedMaterialRenderers.sort(((e,t)=>{const r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,r,i,s,o){if(!e.visible)return;let n=0;i+=e.transformation[12],n=e.transformation[13],jt[0]=r[0]-i,jt[1]=r[1]-n,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,jt,((r,i,n)=>{!function(e,t,r,i,s,o,n){const a=new Xe(o,n,t),l=t=>{t.set(qe.q7.OVERLAY,a,e.dist,e.normal,e.transformation,r,i)};if((null==s.results.min.drapedLayerOrder||r>=s.results.min.drapedLayerOrder)&&(null==s.results.min.dist||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==qe.eC.MIN&&(null==s.results.max.drapedLayerOrder||r<s.results.max.drapedLayerOrder)&&(null==s.results.max.dist||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===qe.eC.ALL){const e=(0,et.LP)(s.ray);l(e),s.results.all.push(e)}}(t,n,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if((0,c.Wi)(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const r of e){const e=r.graphicUid;(0,c.pC)(e)&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if((0,c.Wi)(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const r of e){const e=r.graphicUid;(0,c.pC)(e)&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return(0,c.Wi)(e.localOrigin)&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,s._)([(0,p.Cb)()],zt.prototype,"drapeSource",void 0),(0,s._)([(0,p.Cb)()],zt.prototype,"updating",null),(0,s._)([(0,p.Cb)()],zt.prototype,"rctx",null),(0,s._)([(0,p.Cb)()],zt.prototype,"rendererContext",void 0),(0,s._)([(0,p.Cb)()],zt.prototype,"_materialRepository",null),(0,s._)([(0,p.Cb)()],zt.prototype,"_localOriginFactory",null),(0,s._)([(0,p.Cb)({readOnly:!0})],zt.prototype,"isEmpty",null),(0,s._)([(0,p.Cb)()],zt.prototype,"_materialRenderers",void 0),(0,s._)([(0,p.Cb)()],zt.prototype,"_geometries",void 0),zt=(0,s._)([(0,g.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],zt);class Ut{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const jt=(0,Q.a)();var Vt=r(71568),Wt=r(82144),Gt=r(31132),Bt=r(7566),kt=r(27627),$t=r(36207);class Zt extends Gt.A{initializeProgram(e){return new kt.$(e.rctx,Zt.shader.get().build(),Bt.i)}initializePipeline(){return this.configuration.hasAlpha?(0,$t.sm)({blending:(0,$t.wK)(P.zi.SRC_ALPHA,P.zi.ONE,P.zi.ONE_MINUS_SRC_ALPHA,P.zi.ONE_MINUS_SRC_ALPHA),colorWrite:$t.BK}):(0,$t.sm)({colorWrite:$t.BK})}}Zt.shader=new Wt.J(F.a,(()=>r.e(7026).then(r.bind(r,77026))));class qt extends U.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,s._)([(0,U.o)()],qt.prototype,"hasAlpha",void 0);var Jt=r(78485),Xt=r(11954),Yt=r(82031),Qt=r(78307);let Kt=class extends o.Z{get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new a.Z,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new d.Z,this._passParameters=new F.T,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new B.V,this.worldToPCSRatio=1,this.events=new n.Z,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new Yt.h0(e.renderingContext),this._shaderTechniqueRepository=new j({rctx:this._rctx,viewingMode:y.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new ae(this._rctx,new Te(this._rctx,this.view.state.viewingMode),new Vt.L(this.view,this._shaderTechniqueRepository,this._rctx,(()=>{}))),this._handles.add([(0,h.YP)((()=>t.updating),(()=>this.events.emit("content-changed")),h.tX),(0,h.YP)((()=>this.spatialReference),(e=>this._localOriginFactory=new X.C(e)),h.tX),(0,h.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new Z(e.textureRepository,this._shaderTechniqueRepository,(e=>{(e.renderOccluded&ir)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=ie.r.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=(0,J.hf)(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=se.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Xt.Mi((0,_.f)(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Qt.T8.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,c.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,c.M2)(this._passParameters.texture),this._bindParameters.highlightDepthTexture=(0,c.M2)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,c.SC)(this._shaderTechniqueRepository),this._temporaryFBO=(0,c.M2)(this._temporaryFBO),this._quadVAO=(0,c.M2)(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,l.oE)(this._renderers,(e=>e.updating))}get hasOverlays(){return(0,c.pC)(this._overlays)&&(0,c.pC)(this._overlayRenderTarget)}get gpuMemoryUsage(){return(0,c.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,zt)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);(0,c.pC)(i)&&i.destroy();const s=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add((0,h.YP)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),s}removeDrapeSourceRenderer(e){if((0,c.Wi)(e))return;const t=this._renderers.get(e);(0,c.Wi)(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if((0,c.pC)(this._overlayRenderTarget))for(const r of this._overlayRenderTarget.renderTargets){const[i,s]=this.overlays,o=i.validTargets[r.type]||!s.validTargets[r.type];t=this._overlayRenderTarget.validateUsageForTarget(o,r,e)||t}return t}get overlays(){return(0,c.Pt)(this._overlays,[])}ensureDrapeTargets(e){(0,c.pC)(this._overlays)&&this._overlays.forEach((t=>t.hasTargetWithoutRasterImage=(0,u.f)(e,(e=>e.drapeTargetType===T.al.WithoutRasterImage))))}ensureDrapeSources(e){(0,c.pC)(this._overlays)&&this._overlays.forEach((t=>{t.hasDrapedFeatureSource=(0,u.f)(e,(e=>e.drapeSourceType===T.Lw.Features)),t.hasDrapedRasterSource=(0,u.f)(e,(e=>e.drapeSourceType===T.Lw.RasterImage))}))}ensureOverlays(e,t){(0,c.Wi)(this._overlays)&&(this._overlayRenderTarget=new L(this._rctx),this._overlays=[new O(C.fu.INNER,this._overlayRenderTarget),new O(C.fu.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=(0,c.M2)(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&((0,c.pC)(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Qt.G5,(e=>e.updatePolicy===Jt.j.SYNC))}get isEmpty(){return!w.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,l.oE)(this._renderers,(e=>!e.isEmpty))}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._renderers.forEach((r=>t=r.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,r){const i=e.canvasGeometries;if(0===i.numViews)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;const s=t.output;if(this.isEmpty||s===M.H.Highlight&&!this.hasHighlights||s===M.H.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=t.fbo;if(!o.isValid())return!1;const n=2*e.resolution,a=e.resolution;o.resize(n,a);const l=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*r,this._renderContext.output=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===M.H.Normal?ie.r.DRAPED_WATER:ie.r.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(l),e.index===C.fu.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(P.lk.COLOR_BUFFER_BIT)),t.type===C.NH.Occluded&&(this._renderContext.renderOccludedMask=ir),w.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&t.type!==C.NH.Occluded)for(let c=0;c<i.numViews;c++)this._setViewParameters(i.extents[c],e),this._drawDebugTexture(e.resolution,tr[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll((r=>{let{drapeSource:d,renderer:h}=r;if(t.type===C.NH.ColorNoRasterImage&&d.drapeSourceType===T.Lw.RasterImage)return;const{fullOpacity:u}=d,p=(0,c.pC)(u)&&u<1&&s===M.H.Color;p&&(this.bindTemporaryFramebuffer(this._rctx,n,a),l.clearSafe(P.lk.COLOR_BUFFER_BIT));for(let t=0;t<i.numViews;t++)this._setViewParameters(i.extents[t],e),h.render(this._renderContext);p&&(0,c.pC)(this._temporaryFBO)&&(o.bind(l),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),u,e.index))})),l.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,r){(0,c.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new D(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){let s=0;for(const o of this._renderers.values())s=o.intersect?.(e,t,r,i,s)??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers;this._renderers.forEach(((t,r)=>{const i=e.indexOf(r.layer),s=i>=0,o=this._renderers.size*(r.renderGroup??(s?T.eZ.MapLayer:T.eZ.ViewLayer))+(s?i:0);this._sortedRenderers.push(new er(r,t,o))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],(0,m.x)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,m.f)(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,l.oE)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=(0,l.oE)(this._renderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=(0,l.oE)(this._renderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e,t);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(P.MX.TRIANGLE_STRIP,0,(0,_e._V)(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t,r){if((0,v.s)(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*t*4);let s=0;for(let n=0;n<t;n++)for(let r=0;r<e;r++){const o=Math.floor(r/10),a=Math.floor(n/10);o<2||a<2||10*o>e-20||10*a>t-20?(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=255):(i[s++]=255,i[s++]=255,i[s++]=255,i[s++]=1&o&&1&a?1&r^1&n?0:255:1&o^1&a?0:128)}this._passParameters.texture=new ve.x(this._rctx,{target:P.No.TEXTURE_2D,pixelFormat:P.VI.RGBA,dataType:P.Br.UNSIGNED_BYTE,samplingMode:P.cw.NEAREST,width:e,height:t},i);const o=new qt;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Zt,o),this._quadVAO=(0,J.ow)(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};(0,s._)([(0,p.Cb)()],Kt.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,s._)([(0,p.Cb)({autoDestroy:!0})],Kt.prototype,"_shaderTechniqueRepository",void 0),(0,s._)([(0,p.Cb)({autoDestroy:!0})],Kt.prototype,"_stippleTextureRepository",void 0),(0,s._)([(0,p.Cb)({constructOnly:!0})],Kt.prototype,"view",void 0),(0,s._)([(0,p.Cb)()],Kt.prototype,"worldToPCSRatio",void 0),(0,s._)([(0,p.Cb)()],Kt.prototype,"spatialReference",void 0),(0,s._)([(0,p.Cb)({type:Boolean,readOnly:!0})],Kt.prototype,"updating",null),(0,s._)([(0,p.Cb)()],Kt.prototype,"isEmpty",null),Kt=(0,s._)([(0,g.j)("esri.views.3d.terrain.OverlayRenderer")],Kt);class er{constructor(e,t,r){this.drapeSource=e,this.renderer=t,this.index=r}}const tr=[[1,.5,.5],[.5,.5,1]],rr=-2,ir=Y.yD.OccludeAndTransparent},54134:(e,t,r)=>{var i,s,o,n,a,l,c;r.d(t,{NH:()=>a,Xo:()=>o,fu:()=>i}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(i||(i={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(s||(s={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(o||(o={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(n||(n={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(a||(a={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(l||(l={})),function(e){e[e.INSIDE=0]="INSIDE",e[e.INTERSECTS=1]="INTERSECTS",e[e.OUTSIDE=2]="OUTSIDE"}(c||(c={}))},48353:(e,t,r)=>{r.d(t,{U:()=>d});var i=r(49450),s=r(59150),o=r(58406),n=r(699),a=r(98634),l=r(4760),c=r(65964);function d(e,t){const r=e.vertex;r.uniforms.add(new o.p("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(l.T.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new i.J("vvSizeMinSize",(e=>e.vvSizeMinSize))),r.uniforms.add(new i.J("vvSizeMaxSize",(e=>e.vvSizeMaxSize))),r.uniforms.add(new i.J("vvSizeOffset",(e=>e.vvSizeOffset))),r.uniforms.add(new i.J("vvSizeFactor",(e=>e.vvSizeFactor))),r.code.add(a.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(l.T.SIZE,"float"),r.code.add(a.H`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(l.T.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add([new n.O("vvOpacityValues",(e=>e.vvOpacityValues),8),new n.O("vvOpacityOpacities",(e=>e.vvOpacityOpacities),8)]),r.code.add(a.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(a.H`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(l.T.COLORFEATUREATTRIBUTE,"float"),r.constants.add("vvColorNumber","int",c.x),r.uniforms.add(new n.O("vvColorValues",(e=>e.vvColorValues),c.x)),r.uniforms.add(new s.b("vvColorColors",(e=>e.vvColorColors),c.x)),r.code.add(a.H`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(l.T.COLOR,"vec4"),r.code.add(a.H`vec4 getColor(){
return applyOpacity(color);
}`))}},28156:(e,t,r)=>{r.d(t,{H:()=>s});var i=r(98634);function s(e){const t=i.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,r=i.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}},50600:(e,t,r)=>{r.d(t,{R:()=>p,d:()=>o});var i,s=r(49223);!function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(i||(i={}));var o,n=r(62993),a=r(82552),l=r(95276),c=r(58406),d=r(98634),h=r(19253),u=r(4760);function p(e,t){e.include(n.cK),e.attributes.add(u.T.POSITION,"vec3"),e.attributes.add(u.T.NORMAL,"vec3"),e.attributes.add(u.T.AUXPOS1,"vec4");const r=e.vertex;(0,a.Sv)(r,t),(0,a.hY)(r,t),r.uniforms.add([new l.N("viewport",((e,t)=>t.camera.fullViewport)),new c.p("polygonOffset",(e=>e.shaderPolygonOffset)),new c.p("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1)),new c.p("renderTransparentlyOccludedHUD",((e,t)=>t.renderTransparentlyOccludedHUD===i.Occluded?1:t.renderTransparentlyOccludedHUD===i.NotOccluded?0:.75)),new h.A("hudVisibilityTexture",((e,t)=>t.hudVisibilityTexture))]),t.hasVerticalOffset&&(0,s.V)(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(d.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(d.H`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||(0,a._8)(r),t.isDraped||(r.uniforms.add(new c.p("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),r.code.add(d.H`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===o.Screen&&r.uniforms.add(new c.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),t.hasScreenSizePerspective&&(0,n.m8)(r),r.code.add(d.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===o.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?d.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==o.Screen?d.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===o.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===o.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.code.add(d.H`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"}(o||(o={}))},50913:(e,t,r)=>{r.d(t,{R:()=>h});var i=r(21002),s=r(43565),o=r(78980),n=r(75993),a=r(82999),l=r(98634),c=r(19253),d=r(97528);function h(e,t){const{vertex:r,fragment:h}=e;t.hasMultipassGeometry&&r.include(s.S),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(l.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?l.H`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&h.include(i.S),t.hasMultipassTerrain&&h.uniforms.add([...(0,c.J)("terrainDepthTexture",((e,t)=>t.multipassTerrain.linearDepthTexture),t.hasWebGL2Context?d.D.None:d.D.InvSize),new a.A("nearFar",((e,t)=>t.camera.nearFar))]),h.include(o.n),h.code.add(l.H`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?l.H`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${(0,n.b6)(t,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},7683:(e,t,r)=>{r.d(t,{E:()=>o,K:()=>s});var i=r(98634);function s(e){e.fragment.code.add(i.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function o(e){e.fragment.code.add(i.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},60300:(e,t,r)=>{r.d(t,{q:()=>v,C:()=>y});var i=r(92026),s=r(78980),o=r(82552),n=r(75993),a=r(95276),l=r(58406),c=r(98634),d=r(19253),h=r(97528),u=r(82031),p=r(90045),f=r(67077);function g(e){return(0,i.Wi)(e)?f.Z:4===e.length?e:(0,p.s)(m,e[0],e[1],e[2],1)}const m=(0,f.c)();function v(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?_(e,t):function(e){e.fragment.code.add(c.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function _(e,t){const r=!(t.draped&&t.stipplePreferContinuous),{vertex:p,fragment:f}=e;f.include(s.n),t.draped||((0,o.hY)(p,t),p.uniforms.add(new l.p("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),p.code.add(c.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),p.code.add(c.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${T};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),p.code.add(c.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),p.code.add(c.H`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),p.uniforms.add(new l.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),p.code.add(c.H`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?c.H`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),f.constants.add("stippleTexturePadding","float",u.it);const m=t.hasWebGL2Context?h.D.None:h.D.Size;f.uniforms.add((0,d.J)("stipplePatternTexture",(e=>e.stippleTexture),m)),f.uniforms.add([new l.p("stipplePatternSDFNormalizer",(e=>function(e){return(0,i.pC)(e)?(Math.floor(.5*((0,u.kj)(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new l.p("stipplePatternPixelSizeInv",(e=>1/y(e)))]),f.code.add(c.H`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${(0,n.w_)(t,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `),f.code.add(c.H`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?c.H`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:c.H`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?c.H`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?c.H`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:c.H`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?c.H`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:c.H`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(f.uniforms.add(new a.N("stippleOffColor",(e=>g(e.stippleOffColor)))),f.code.add(c.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):f.code.add(c.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function y(e){const t=e.stipplePattern;return(0,i.pC)(t)?(0,u.$A)(e.stipplePattern)/t.pixelRatio:1}const T=c.H.float(.4)},40526:(e,t,r)=>{r.d(t,{Q:()=>l});var i=r(92026),s=r(2522),o=r(58406),n=r(98634),a=r(33720);function l(e,t){const r=e.vertex;e.constants.add("markerSizePerLineWidth","float",s._Z),r.uniforms.add(new o.p("pixelRatio",((e,t)=>t.camera.pixelRatio))),(0,i.Wi)(r.uniforms.get("markerScale"))&&r.constants.add("markerScale","float",1),r.code.add(n.H`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),t.space===a.I9.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new o.p("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),r.code.add(n.H`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))}},43565:(e,t,r)=>{r.d(t,{S:()=>a,_:()=>l});var i=r(21002),s=r(82999),o=r(98634),n=r(19253);function a(e){e.include(i.S),e.uniforms.add([new n.A("geometryDepthTexture",((e,t)=>t.multipassGeometry.linearDepthTexture)),new s.A("nearFar",((e,t)=>t.camera.nearFar))]),e.code.add(o.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class l{constructor(){this.enabled=!1}}},8555:(e,t,r)=>{r.d(t,{n:()=>s});var i=r(98634);function s(e,t){t.spherical?e.vertex.code.add(i.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(i.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(i.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(i.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},40854:(e,t,r)=>{r.d(t,{O:()=>h,P:()=>d});var i=r(81949),s=r(21002),o=r(82999),n=r(58406),a=r(98634),l=r(8654),c=r(19253);function d(e,t){const r=e.fragment;r.include(s.S),r.uniforms.add(new o.A("nearFar",((e,t)=>t.camera.nearFar))),r.uniforms.add(new c.A("depthMap",((e,t)=>t.linearDepthTexture))),r.uniforms.add(new l.g("proj",((e,t)=>t.ssr.camera.projectionMatrix))),r.uniforms.add(new n.p("invResolutionHeight",((e,t)=>1/t.ssr.camera.height))),r.uniforms.add(new l.g("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),r.code.add(a.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class h{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=(0,i.c)()}}},77652:(e,t,r)=>{r.d(t,{B:()=>S});var i=r(7683),s=r(98634);function o(e){e.fragment.code.add(s.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var n=r(2116),a=r(40854),l=r(16889),c=r(92026),d=r(22186),h=r(91226),u=r(46208),p=r(92395),f=r(13773),g=r(49450),m=r(58406),v=r(8654),_=r(61809),y=r(99340);class T extends _.x{constructor(e,t){super(e,"samplerCube",y.P.Pass,((r,i,s)=>r.bindTexture(e,t(i,s))))}}function w(e){const t=e.fragment;t.uniforms.add([new v.g("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new v.g("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new g.J("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new g.J("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new m.p("cloudsHeight",((e,t)=>t.cloudsFade.parallax.cloudsHeight)),new m.p("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new m.p("totalFadeInOut",((e,t)=>t.cloudsFade.fadeInOut.stage===h.co.FINISHED?t.cloudsFade.fadeInOutHeight.factor+1-t.cloudsFade.fadeIn.factor:t.cloudsFade.fadeInOutHeight.factor+1-t.cloudsFade.fadeInOut.factor)),new m.p("crossFadeAnchorFactor",((e,t)=>(0,l.uZ)(t.cloudsFade.crossFade.factor,0,1))),new T("cubeMap",((e,t)=>(0,c.pC)(t.cloudsFade.data)&&(0,c.pC)(t.cloudsFade.data.cubeMap)?t.cloudsFade.data.cubeMap.colorTexture:null)),new f.U("crossFade",((e,t)=>t.cloudsFade.crossFade.enabled)),new f.U("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===u.uz.RG)),new f.U("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===u.jL.FADING_TEXTURE_CHANNELS))]),t.constants.add("planetRadius","float",d.sv.radius),t.code.add(s.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(s.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(s.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),(0,p.Pe)(t),(0,p.F1)(t),t.code.add(s.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(s.H`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),t.code.add(s.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(s.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(s.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}var C=r(19253);function S(e,t){e.include(n.g,t),e.include(o),e.include(i.E),t.hasCloudsReflections&&e.include(w,t),t.hasScreenSpaceReflections&&e.include(a.P,t);const r=e.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(s.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add([new m.p("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new m.p("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))]),r.code.add(s.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&r.code.add(s.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?(r.uniforms.add([new v.g("view",((e,t)=>t.ssr.camera.viewMatrix)),new C.A("lastFrameColorTexture",((e,t)=>t.ssr.lastFrameColorTexture)),new m.p("fadeFactor",((e,t)=>t.ssr.fadeFactor))]),r.code.add(s.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(s.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?r.code.add(s.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(s.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(s.H`return waterRenderedColor;
}`)}},79246:(e,t,r)=>{r.d(t,{M:()=>u});var i=r(88396),s=r(6394),o=r(90045),n=r(67077),a=r(7683),l=r(82999),c=r(95276),d=r(98634),h=r(19253);function u(e){e.fragment.uniforms.add(new h.A("texWaveNormal",(e=>e.waveNormal))),e.fragment.uniforms.add(new h.A("texWavePerturbation",(e=>e.wavePertubation))),e.fragment.uniforms.add([new c.N("waveParams",(e=>(0,o.s)(p,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new l.A("waveDirection",(e=>(0,i.s)(f,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)))]),e.include(a.K),e.fragment.code.add(d.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const p=(0,n.c)(),f=(0,s.a)()},86755:(e,t,r)=>{r.d(t,{V:()=>S});var i,s=r(27366),o=r(85015),n=r(32718),a=r(16889),l=r(17842),c=r(49861),d=(r(25243),r(63780),r(69912)),h=r(14226),u=r(81949),p=r(88396),f=r(6394),g=r(11186),m=r(71353),v=r(90045),_=r(67077),y=r(95773),T=r(40885),w=r(40927),C=r(50951);let S=i=class extends o.Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._center=(0,m.c)(),this._up=(0,m.c)(),this._viewUp=(0,m.c)(),this._viewForward=(0,m.c)(),this._viewRight=(0,m.c)(),this._ray=(0,T.Ue)(),this._viewport=(0,_.f)(0,0,1,1),this._padding=(0,_.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,u.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,u.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,u.c)(),this._frustumDirty=!0,this._frustum=(0,y.Ue)(),this._fullViewport=(0,_.c)(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,g.b)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,v.b)((0,_.c)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,v.h)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[P.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[P.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[P.RIGHT]+this._padding[P.LEFT]}set fullWidth(e){this.width=e-(this._padding[P.RIGHT]+this._padding[P.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[P.TOP]+this._padding[P.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[P.TOP]+this._padding[P.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[P.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[P.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,v.g)(this._padding,e)||(this._viewport[0]+=e[P.LEFT]-this._padding[P.LEFT],this._viewport[1]+=e[P.BOTTOM]-this._padding[P.BOTTOM],this._viewport[2]-=e[P.RIGHT]+e[P.LEFT]-(this._padding[P.RIGHT]+this._padding[P.LEFT]),this._viewport[3]-=e[P.TOP]+e[P.BOTTOM]-(this._padding[P.TOP]+this._padding[P.BOTTOM]),(0,v.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,s=(0,h.q)((0,u.c)(),-i*(1+2*this._padding[P.LEFT]/e),i*(1+2*this._padding[P.RIGHT]/e),-r*(1+2*this._padding[P.BOTTOM]/t),r*(1+2*this._padding[P.TOP]/t),this.near,this.far),o=this._get("projectionMatrix");return o&&(0,h.h)(o,s)?o:s}get inverseProjectionMatrix(){return(0,h.a)((0,u.c)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,u.c)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,g.i)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){(0,g.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,v.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,v.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.c)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.c)(this._viewMatrix,e.viewMatrix),(0,g.c)(this._viewRight,e.viewRight),(0,g.c)(this._viewUp,e.viewUp),(0,g.c)(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new i).copyFrom(this)}equals(e){return(0,g.k)(this.eye,e.eye)&&(0,g.k)(this.center,e.center)&&(0,g.k)(this.up,e.up)&&(0,v.g)(this._viewport,e.viewport)&&(0,v.g)(this._padding,e.padding)&&(0,p.m)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(Math.abs(e.fov-this._fov)>=.001||(0,v.i)(e.padding,this._padding)>=.5||(0,v.i)(this.screenViewport,e.screenViewport)>=.5)return!1;(0,g.w)(O,e.eye,e.center),(0,g.w)(A,this.eye,this.center);const t=(0,g.e)(O,A),r=(0,g.D)(O),i=(0,g.D)(A),s=5e-4;return t*t>=(1-1e-10)*r*i&&(0,g.E)(e.eye,this.eye)<Math.max(r,i)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,w.SR)(this.viewForward,(0,g.b)(O,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.s1)();return e[0]=(this.padding[P.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[P.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[P.LEFT]+this.width*t,e[1]=this.padding[P.BOTTOM]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==x&&(0,g.c)(x,e),x[3]=1,(0,v.t)(x,x,this.projectionMatrix);const r=Math.abs(x[3]);(0,g.g)(x,x,1/r);const i=this.fullViewport;t[0]=(0,a.t7)(0,i[0]+i[2],.5+.5*x[0]),t[1]=(0,a.t7)(0,i[1]+i[3],.5+.5*x[1]),t[2]=.5*(x[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;x[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],x[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],x[2]=(2*e[2]-1)*e[3],x[3]=e[3],null!=this.inverseProjectionMatrix&&((0,v.t)(x,x,this.inverseProjectionMatrix),t[0]=x[0],t[1]=x[1],t[2]=x[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,R),this.renderToScreen(R,t),t}projectToRenderScreen(e,t){if(x[0]=e[0],x[1]=e[1],x[2]=e[2],x[3]=1,(0,v.t)(x,x,this.viewProjectionMatrix),0===x[3])return null;(0,g.g)(x,x,1/Math.abs(x[3]));const r=this.fullViewport;return"x"in t?(t.x=(0,a.t7)(0,r[0]+r[2],.5+.5*x[0]),t.y=(0,a.t7)(0,r[1]+r[3],.5+.5*x[1])):(t[0]=(0,a.t7)(0,r[0]+r[2],.5+.5*x[0]),t[1]=(0,a.t7)(0,r[1]+r[3],.5+.5*x[1]),t.length>2&&(t[2]=.5*(x[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,R),t)}unprojectFromRenderScreen(e,t){if((0,h.m)(b,this.projectionMatrix,this.viewMatrix),!(0,h.a)(b,b))return null;const r=this.fullViewport;return x[0]=2*(e[0]-r[0])/r[2]-1,x[1]=2*(e[1]-r[1])/r[3]-1,x[2]=2*e[2]-1,x[3]=1,(0,v.t)(x,x,b),0===x[3]?null:(t[0]=x[0]/x[3],t[1]=x[1]/x[3],t[2]=x[2]/x[3],t)}constrainWindowSize(e,t,r,i){const s=e*this.pixelRatio,o=t*this.pixelRatio,n=Math.max(s-r/2,0),a=Math.max(this.fullHeight-o-i/2,0),l=-Math.min(s-r/2,0),c=-Math.min(this.fullHeight-o-i/2,0);return[n,a,r-l- -Math.min(this.fullWidth-s-r/2,0),i-c- -Math.min(o-i/2,0)]}computeUp(e){e===C.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){(0,g.b)(O,this.center,this.eye);const e=(0,g.l)(this.center);e<1?((0,g.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,g.e)(O,this.center))>.9999*(0,g.l)(O)*e||((0,g.f)(this._up,O,this.center),(0,g.f)(this._up,this._up,O),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,g.r)(O,this.eye,this.center),Math.abs(O[2])<=.9999&&((0,g.g)(O,O,O[2]),(0,g.s)(this._up,-O[0],-O[1],1-O[2]),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,g.k)(e,t)||((0,g.c)(t,e),this._markViewDirty(),r.length&&this.notifyChange(r)):n.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.u)(this._viewMatrix,this.eye,this.center,this.up),(0,g.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,g.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,g.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,s._)([(0,c.Cb)()],S.prototype,"_center",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"_up",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"_viewport",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"_padding",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"_fov",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"_nearFar",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"_pixelRatio",void 0),(0,s._)([(0,c.Cb)()],S.prototype,"pixelRatio",null),(0,s._)([(0,c.Cb)()],S.prototype,"eye",null),(0,s._)([(0,c.Cb)()],S.prototype,"center",null),(0,s._)([(0,c.Cb)()],S.prototype,"up",null),(0,s._)([(0,c.Cb)({readOnly:!0})],S.prototype,"nearFar",null),(0,s._)([(0,c.Cb)()],S.prototype,"near",null),(0,s._)([(0,c.Cb)()],S.prototype,"far",null),(0,s._)([(0,c.Cb)()],S.prototype,"viewport",null),(0,s._)([(0,c.Cb)({readOnly:!0})],S.prototype,"screenViewport",null),(0,s._)([(0,c.Cb)()],S.prototype,"x",null),(0,s._)([(0,c.Cb)()],S.prototype,"y",null),(0,s._)([(0,c.Cb)()],S.prototype,"width",null),(0,s._)([(0,c.Cb)()],S.prototype,"height",null),(0,s._)([(0,c.Cb)()],S.prototype,"fullWidth",null),(0,s._)([(0,c.Cb)()],S.prototype,"fullHeight",null),(0,s._)([(0,c.Cb)({readOnly:!0})],S.prototype,"_aspect",null),(0,s._)([(0,c.Cb)()],S.prototype,"padding",null),(0,s._)([(0,c.Cb)({readOnly:!0})],S.prototype,"projectionMatrix",null),(0,s._)([(0,c.Cb)({readOnly:!0})],S.prototype,"inverseProjectionMatrix",null),(0,s._)([(0,c.Cb)()],S.prototype,"fov",null),(0,s._)([(0,c.Cb)()],S.prototype,"fovX",null),(0,s._)([(0,c.Cb)()],S.prototype,"fovY",null),S=i=(0,s._)([(0,d.j)("esri.views.3d.webgl-engine.lib.Camera")],S);const x=(0,_.c)(),b=(0,u.c)(),O=(0,m.c)(),A=(0,m.c)(),R=(0,l.J$)();var P;!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(P||(P={}))},88699:(e,t,r)=>{r.d(t,{QZ:()=>o,Rq:()=>n,bg:()=>s});var i=r(18722);function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=i.DB?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function o(e){return length<=i.DB?Array.from(e):new Float64Array(e)}function n(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}},73840:(e,t,r)=>{r.d(t,{AA:()=>n,XO:()=>o,xx:()=>s});var i=r(18722);function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=i.DB?t?new Array(e).fill(0):new Array(e):new Float32Array(e)}function o(e){return length<=i.DB?Array.from(e):new Float32Array(e)}function n(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)}},94425:(e,t,r)=>{r.d(t,{p:()=>o});var i=r(92026),s=r(68401);class o{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach(((e,t)=>{(0,i.pC)(e)&&this._repository.release(this._material,t)}))}load(e,t,r){if(!this._material.requiresSlot(t,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,t,r));const o=this._map.get(r);if((0,i.pC)(o)){if(o.ensureResources(e)===s.Rw.LOADED)return o;this._repository.requestRender()}return null}}},70619:(e,t,r)=>{r.d(t,{Cr:()=>te,IG:()=>b,QL:()=>q,nb:()=>J,B2:()=>E,DA:()=>K,x2:()=>Y,dV:()=>Z,mj:()=>$,rh:()=>Q,PI:()=>k,AW:()=>B,PD:()=>X,Ay:()=>ie,mx:()=>ee});var i,s=r(92026),o=r(11186),n=r(8229),a=r(71353),l=r(55652),c=r(40885),d=r(91526);!function(e){e.length=function(e,t){const r=e[t],i=e[t+1],s=e[t+2];return Math.sqrt(r*r+i*i+s*s)},e.normalize=function(e,t){const r=e[t],i=e[t+1],s=e[t+2],o=1/Math.sqrt(r*r+i*i+s*s);e[t]*=o,e[t+1]*=o,e[t+2]*=o},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(s=s||e)[o]=e[t]+r[i],s[o+1]=e[t+1]+r[i+1],s[o+2]=e[t+2]+r[i+2]},e.subtract=function(e,t,r,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(s=s||e)[o]=e[t]-r[i],s[o+1]=e[t+1]-r[i+1],s[o+2]=e[t+2]-r[i+2]}}(i||(i={}));var h=r(79100),u=r(88699),p=r(73840),f=r(95774),g=r(72838),m=r(97731),v=r(4760);const _=i,y=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],T=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],w=[0,0,1,0,1,1,0,1],C=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],S=new Array(36);for(let ne=0;ne<6;ne++)for(let e=0;e<6;e++)S[6*ne+e]=ne;const x=new Array(36);for(let ne=0;ne<6;ne++)x[6*ne+0]=0,x[6*ne+1]=1,x[6*ne+2]=2,x[6*ne+3]=2,x[6*ne+4]=3,x[6*ne+5]=0;function b(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=y[i][0]*t[0],r[3*i+1]=y[i][1]*t[1],r[3*i+2]=y[i][2]*t[2];return new f.Z(e,[[v.T.POSITION,new d.a(r,3,!0)],[v.T.NORMAL,new d.a(T,3)],[v.T.UV0,new d.a(w,2)]],[[v.T.POSITION,C],[v.T.NORMAL,S],[v.T.UV0,x]])}const O=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],A=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],R=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],P=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function E(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=O[i][0]*t[0],r[3*i+1]=O[i][1]*t[1],r[3*i+2]=O[i][2]*t[2];return new f.Z(e,[[v.T.POSITION,new d.a(r,3,!0)],[v.T.NORMAL,new d.a(A,3)]],[[v.T.POSITION,R],[v.T.NORMAL,P]])}const D=(0,n.f)(-.5,0,-.5),I=(0,n.f)(.5,0,-.5),M=(0,n.f)(0,0,.5),H=(0,n.f)(0,.5,0),L=(0,n.c)(),N=(0,n.c)(),F=(0,n.c)(),z=(0,n.c)(),U=(0,n.c)();(0,o.b)(L,D,H),(0,o.b)(N,D,I),(0,o.f)(F,L,N),(0,o.n)(F,F),(0,o.b)(L,I,H),(0,o.b)(N,I,M),(0,o.f)(z,L,N),(0,o.n)(z,z),(0,o.b)(L,M,H),(0,o.b)(N,M,D),(0,o.f)(U,L,N),(0,o.n)(U,U);const j=[D,I,M,H],V=[0,-1,0,F[0],F[1],F[2],z[0],z[1],z[2],U[0],U[1],U[2]],W=[0,1,2,3,1,0,3,2,1,3,0,2],G=[0,0,0,1,1,1,2,2,2,3,3,3];function B(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=j[i][0]*t[0],r[3*i+1]=j[i][1]*t[1],r[3*i+2]=j[i][2]*t[2];return new f.Z(e,[[v.T.POSITION,new d.a(r,3,!0)],[v.T.NORMAL,new d.a(V,3)]],[[v.T.POSITION,W],[v.T.NORMAL,G]])}function k(e,t,r,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const o=-Math.PI,n=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),h=Math.max(2,Math.floor(i)),u=(c+1)*(h+1),g=(0,p.xx)(3*u),m=(0,p.xx)(3*u),_=(0,p.xx)(2*u),y=[];let T=0;for(let d=0;d<=h;d++){const e=[],r=d/h,i=a+r*l,s=Math.cos(i);for(let a=0;a<=c;a++){const l=a/c,d=o+l*n,h=Math.cos(d)*s,u=Math.sin(i),p=-Math.sin(d)*s;g[3*T]=h*t,g[3*T+1]=u*t,g[3*T+2]=p*t,m[3*T]=h,m[3*T+1]=u,m[3*T+2]=p,_[2*T]=l,_[2*T+1]=r,e.push(T),++T}y.push(e)}const w=new Array;for(let d=0;d<h;d++)for(let e=0;e<c;e++){const t=y[d][e],r=y[d][e+1],i=y[d+1][e+1],s=y[d+1][e];0===d?(w.push(t),w.push(i),w.push(s)):d===h-1?(w.push(t),w.push(r),w.push(i)):(w.push(t),w.push(r),w.push(i),w.push(i),w.push(s),w.push(t))}const C=[[v.T.POSITION,w],[v.T.NORMAL,w]],S=[[v.T.POSITION,new d.a(g,3,!0)],[v.T.NORMAL,new d.a(m,3,!0)]];return s.uv&&(S.push([v.T.UV0,new d.a(_,2,!0)]),C.push([v.T.UV0,w])),s.offset&&(C[0][0]=v.T.OFFSET,S[0][0]=v.T.OFFSET,C.push([v.T.POSITION,new Array(w.length).fill(0)]),S.push([v.T.POSITION,new d.a(Float64Array.from(s.offset),3,!0)])),new f.Z(e,S,C)}function $(e,t,r,i){const{vertexAttributes:s,indices:o}=function(e,t,r){const i=e;let s,o;if(r)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;s=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let d=0;d<s.length;d+=3)_.scale(s,d,e/_.length(s,d));let n={};function a(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(n[i])return n[i];let o=s.length;return s.length+=3,_.add(s,3*t,s,3*r,s,o),_.scale(s,o,e/_.length(s,o)),o/=3,n[i]=o,o}for(let d=0;d<t;d++){const e=o.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=o[r],i=o[r+1],s=o[r+2],n=a(e,i),l=a(i,s),c=a(s,e),d=4*r;t[d]=e,t[d+1]=n,t[d+2]=c,t[d+3]=i,t[d+4]=l,t[d+5]=n,t[d+6]=s,t[d+7]=c,t[d+8]=l,t[d+9]=n,t[d+10]=l,t[d+11]=c}o=t,n={}}const l=(0,p.XO)(s);for(let d=0;d<l.length;d+=3)_.normalize(l,d);const c=[[v.T.POSITION,o],[v.T.NORMAL,o]];return{vertexAttributes:[[v.T.POSITION,new d.a((0,p.XO)(s),3,!0)],[v.T.NORMAL,new d.a(l,3,!0)]],indices:c}}(t,r,i);return new f.Z(e,s,o)}function Z(e,t,r,i,o,n,a,l){let c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const u=r?[r[0],r[1],r[2]]:[0,0,0],p=t?[t[0],t[1],t[2]]:[0,0,1];a=a||[0,0];const g=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],m=(0,s.pC)(o)&&2===o.length?o:[1,1],_=[[v.T.POSITION,new d.a(u,3,!0)],[v.T.NORMAL,new d.a(p,3,!0)],[v.T.UV0,new d.a(a,a.length)],[v.T.COLOR,new d.a(g,4,!0)],[v.T.SIZE,new d.a(m,2)]];if(null!=n){const e=[n[0],n[1],n[2],n[3]];_.push([v.T.AUXPOS1,new d.a(e,4)])}if(null!=l){const e=[l[0],l[1],l[2],l[3]];_.push([v.T.AUXPOS2,new d.a(e,4)])}return new f.Z(e,_,null,null,h.U.Point,c)}function q(e,t,r,i,s){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=0;const c=r,h=t;let u=(0,n.f)(0,l,0),g=(0,n.f)(0,l+h,0),m=(0,n.f)(0,-1,0),_=(0,n.f)(0,1,0);s&&(l=h,g=(0,n.f)(0,0,0),u=(0,n.f)(0,l,0),m=(0,n.f)(0,1,0),_=(0,n.f)(0,-1,0));const y=[g,u],T=[m,_],w=i+2,C=Math.sqrt(h*h+c*c);if(s)for(let d=i-1;d>=0;d--){const e=d*(2*Math.PI/i),t=(0,n.f)(Math.cos(e)*c,l,Math.sin(e)*c);y.push(t);const r=(0,n.f)(h*Math.cos(e)/C,-c/C,h*Math.sin(e)/C);T.push(r)}else for(let d=0;d<i;d++){const e=d*(2*Math.PI/i),t=(0,n.f)(Math.cos(e)*c,l,Math.sin(e)*c);y.push(t);const r=(0,n.f)(h*Math.cos(e)/C,c/C,h*Math.sin(e)/C);T.push(r)}const S=new Array,x=new Array;if(o){for(let e=3;e<y.length;e++)S.push(1),S.push(e-1),S.push(e),x.push(0),x.push(0),x.push(0);S.push(y.length-1),S.push(2),S.push(1),x.push(0),x.push(0),x.push(0)}if(a){for(let e=3;e<y.length;e++)S.push(e),S.push(e-1),S.push(0),x.push(e),x.push(e-1),x.push(1);S.push(0),S.push(2),S.push(y.length-1),x.push(1),x.push(2),x.push(T.length-1)}const b=(0,p.xx)(3*w);for(let n=0;n<w;n++)b[3*n]=y[n][0],b[3*n+1]=y[n][1],b[3*n+2]=y[n][2];const O=(0,p.xx)(3*w);for(let n=0;n<w;n++)O[3*n]=T[n][0],O[3*n+1]=T[n][1],O[3*n+2]=T[n][2];const A=[[v.T.POSITION,S],[v.T.NORMAL,x]],R=[[v.T.POSITION,new d.a(b,3,!0)],[v.T.NORMAL,new d.a(O,3,!0)]];return new f.Z(e,R,A)}function J(e,t,r,i,s,a,l){const c=s?(0,n.b)(s):(0,n.f)(1,0,0),h=a?(0,n.b)(a):(0,n.f)(0,0,0);l=l??!0;const u=(0,n.c)();(0,o.n)(u,c);const g=(0,n.c)();(0,o.g)(g,u,Math.abs(t));const m=(0,n.c)();(0,o.g)(m,g,-.5),(0,o.a)(m,m,h);const _=(0,n.f)(0,1,0);Math.abs(1-(0,o.e)(u,_))<.2&&(0,o.s)(_,0,0,1);const y=(0,n.c)();(0,o.f)(y,u,_),(0,o.n)(y,y),(0,o.f)(_,y,u);const T=2*i+(l?2:0),w=i+(l?2:0),C=(0,p.xx)(3*T),S=(0,p.xx)(3*w),x=(0,p.xx)(2*T),b=new Array(3*i*(l?4:2)),O=new Array(3*i*(l?4:2));l&&(C[3*(T-2)+0]=m[0],C[3*(T-2)+1]=m[1],C[3*(T-2)+2]=m[2],x[2*(T-2)]=0,x[2*(T-2)+1]=0,C[3*(T-1)+0]=C[3*(T-2)+0]+g[0],C[3*(T-1)+1]=C[3*(T-2)+1]+g[1],C[3*(T-1)+2]=C[3*(T-2)+2]+g[2],x[2*(T-1)]=1,x[2*(T-1)+1]=1,S[3*(w-2)+0]=-u[0],S[3*(w-2)+1]=-u[1],S[3*(w-2)+2]=-u[2],S[3*(w-1)+0]=u[0],S[3*(w-1)+1]=u[1],S[3*(w-1)+2]=u[2]);const A=(e,t,r)=>{b[e]=t,O[e]=r};let R=0;const P=(0,n.c)(),E=(0,n.c)();for(let n=0;n<i;n++){const e=n*(2*Math.PI/i);(0,o.g)(P,_,Math.sin(e)),(0,o.g)(E,y,Math.cos(e)),(0,o.a)(P,P,E),S[3*n+0]=P[0],S[3*n+1]=P[1],S[3*n+2]=P[2],(0,o.g)(P,P,r),(0,o.a)(P,P,m),C[3*n+0]=P[0],C[3*n+1]=P[1],C[3*n+2]=P[2],x[2*n+0]=n/i,x[2*n+1]=0,C[3*(n+i)+0]=C[3*n+0]+g[0],C[3*(n+i)+1]=C[3*n+1]+g[1],C[3*(n+i)+2]=C[3*n+2]+g[2],x[2*(n+i)+0]=n/i,x[2*n+1]=1;const t=(n+1)%i;A(R++,n,n),A(R++,n+i,n),A(R++,t,t),A(R++,t,t),A(R++,n+i,n),A(R++,t+i,t)}if(l){for(let e=0;e<i;e++){const t=(e+1)%i;A(R++,T-2,w-2),A(R++,e,w-2),A(R++,t,w-2)}for(let e=0;e<i;e++){const t=(e+1)%i;A(R++,e+i,w-1),A(R++,T-1,w-1),A(R++,t+i,w-1)}}const D=[[v.T.POSITION,b],[v.T.NORMAL,O],[v.T.UV0,b]],I=[[v.T.POSITION,new d.a(C,3,!0)],[v.T.NORMAL,new d.a(S,3,!0)],[v.T.UV0,new d.a(x,2,!0)]];return new f.Z(e,I,D)}function X(e,t,r,i,s,o){i=i||10,s=null==s||s,(0,m.hu)(t.length>1);const n=[],a=[];for(let l=0;l<i;l++){n.push([0,-l-1,-(l+1)%i-1]);const e=l/i*2*Math.PI;a.push([Math.cos(e)*r,Math.sin(e)*r])}return Y(e,a,t,[[0,0,0]],n,s,o)}function Y(e,t,r,i,s,h){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,n.f)(0,0,0);const g=t.length,m=(0,p.xx)(r.length*g*3+(6*i.length||0)),_=(0,p.xx)(r.length*g*3+(i?6:0)),y=new Array,T=new Array;let w=0,C=0;const S=(0,n.c)(),x=(0,n.c)(),b=(0,n.c)(),O=(0,n.c)(),A=(0,n.c)(),R=(0,n.c)(),P=(0,n.c)(),E=(0,a.c)(),D=(0,n.c)(),I=(0,n.c)(),M=(0,n.c)(),H=(0,n.c)(),L=(0,n.c)(),N=(0,l.Ue)();(0,o.s)(D,0,1,0),(0,o.b)(x,r[1],r[0]),(0,o.n)(x,x),h?((0,o.a)(E,r[0],u),(0,o.n)(b,E)):(0,o.s)(b,0,0,1),ie(x,b,D,D,A,b,se),(0,o.c)(O,b),(0,o.c)(H,A);for(let n=0;n<i.length;n++)(0,o.g)(R,A,i[n][0]),(0,o.g)(E,b,i[n][2]),(0,o.a)(R,R,E),(0,o.a)(R,R,r[0]),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2];_[C++]=-x[0],_[C++]=-x[1],_[C++]=-x[2];for(let o=0;o<s.length;o++)y.push(s[o][0]>0?s[o][0]:-s[o][0]-1+i.length),y.push(s[o][1]>0?s[o][1]:-s[o][1]-1+i.length),y.push(s[o][2]>0?s[o][2]:-s[o][2]-1+i.length),T.push(0),T.push(0),T.push(0);let F=i.length;const z=i.length-1;for(let n=0;n<r.length;n++){let e=!1;n>0&&((0,o.c)(S,x),n<r.length-1?((0,o.b)(x,r[n+1],r[n]),(0,o.n)(x,x)):e=!0,(0,o.a)(I,S,x),(0,o.n)(I,I),(0,o.a)(M,r[n-1],O),(0,l.Yq)(r[n],I,N),(0,l.BR)(N,(0,c.re)(M,S),E)?((0,o.b)(E,E,r[n]),(0,o.n)(b,E),(0,o.f)(A,I,b),(0,o.n)(A,A)):ie(I,O,H,D,A,b,se),(0,o.c)(O,b),(0,o.c)(H,A)),h&&((0,o.a)(E,r[n],u),(0,o.n)(L,E));for(let i=0;i<g;i++)if((0,o.g)(R,A,t[i][0]),(0,o.g)(E,b,t[i][1]),(0,o.a)(R,R,E),(0,o.n)(P,R),_[C++]=P[0],_[C++]=P[1],_[C++]=P[2],(0,o.a)(R,R,r[n]),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2],!e){const e=(i+1)%g;y.push(F+i),y.push(F+g+i),y.push(F+e),y.push(F+e),y.push(F+g+i),y.push(F+g+e);for(let t=0;t<6;t++){const e=y.length-6;T.push(y[e+t]-z)}}F+=g}const U=r[r.length-1];for(let n=0;n<i.length;n++)(0,o.g)(R,A,i[n][0]),(0,o.g)(E,b,i[n][1]),(0,o.a)(R,R,E),(0,o.a)(R,R,U),m[w++]=R[0],m[w++]=R[1],m[w++]=R[2];const j=C/3;_[C++]=x[0],_[C++]=x[1],_[C++]=x[2];const V=F-g;for(let o=0;o<s.length;o++)y.push(s[o][0]>=0?F+s[o][0]:-s[o][0]-1+V),y.push(s[o][2]>=0?F+s[o][2]:-s[o][2]-1+V),y.push(s[o][1]>=0?F+s[o][1]:-s[o][1]-1+V),T.push(j),T.push(j),T.push(j);const W=[[v.T.POSITION,y],[v.T.NORMAL,T]],G=[[v.T.POSITION,new d.a(m,3,!0)],[v.T.NORMAL,new d.a(_,3,!0)]];return new f.Z(e,G,W)}function Q(e,t,r,i){(0,m.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,m.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,m.hu)(null==r||r.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,m.hu)(null==r||3===r[0].length,"createPolylineGeometry(): malformed normal");const s=(0,u.bg)(3*t.length),o=new Array(2*(t.length-1));let n=0,a=0;for(let d=0;d<t.length;d++){for(let e=0;e<3;e++)s[n++]=t[d][e];d>0&&(o[a++]=d-1,o[a++]=d)}const l=[],c=[];if(l.push([v.T.POSITION,o]),c.push([v.T.POSITION,new d.a(s,3,!0)]),r){const e=(0,p.xx)(3*r.length);let i=0;for(let s=0;s<t.length;s++)for(let t=0;t<3;t++)e[i++]=r[s][t];l.push([v.T.NORMAL,o]),c.push([v.T.NORMAL,new d.a(e,3,!0)])}return i&&(c.push([v.T.COLOR,new d.a(i,4)]),l.push([v.T.COLOR,(0,g.p)(i.length/4)])),new f.Z(e,c,l,null,h.U.Line)}function K(e,t,r,i,s){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const n=new Array(18),a=[[-r,o,s/2],[i,o,s/2],[0,t+o,s/2],[-r,o,-s/2],[i,o,-s/2],[0,t+o,-s/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)n[3*c]=a[c][0],n[3*c+1]=a[c][1],n[3*c+2]=a[c][2];return new f.Z(e,[[v.T.POSITION,new d.a(n,3,!0)]],[[v.T.POSITION,l]])}function ee(e,t){const r=e.getMutableAttribute(v.T.POSITION).data;for(let i=0;i<r.length;i+=3){const e=r[i],s=r[i+1],n=r[i+2];(0,o.s)(oe,e,s,n),(0,o.m)(oe,oe,t),r[i]=oe[0],r[i+1]=oe[1],r[i+2]=oe[2]}}function te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;const r=e.vertexAttributes,i=r.get(v.T.POSITION).data,s=r.get(v.T.NORMAL).data;if(s){const e=t.getMutableAttribute(v.T.NORMAL).data;for(let t=0;t<s.length;t+=3){const r=s[t+1];e[t+1]=-s[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute(v.T.POSITION).data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}}function re(e,t,r,i,s){return!(Math.abs((0,o.e)(t,e))>s)&&((0,o.f)(r,e,t),(0,o.n)(r,r),(0,o.f)(i,r,e),(0,o.n)(i,i),!0)}function ie(e,t,r,i,s,o,n){return re(e,t,s,o,n)||re(e,r,s,o,n)||re(e,i,s,o,n)}const se=.99619469809,oe=(0,n.c)()},87145:(e,t,r)=>{r.d(t,{C:()=>_});var i=r(92026),s=r(95439),o=r(11186),n=r(71353),a=r(67077),l=r(79803),c=r(91526),d=r(79100),h=r(95774),u=r(61403),p=r(66327);const f=null;var g=r(4760),m=r(97882),v=r(58901);class _{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+(0,s.D)()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=f;if((0,i.pC)(t))return this._origins.set(this._rootOriginId,(0,u.a)(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const r=(0,u.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,s=Math.round(e[0]/r),n=Math.round(e[1]/r),a=Math.round(e[2]/r),l=`${s}/${n}/${a}`;let c=this._origins.get(l);const d=.5*r;if((0,o.b)(y,e,t.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),y[0]<d&&y[1]<d&&y[2]<d){if(c){const t=Math.max(...y);if((0,o.b)(y,e,c.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),Math.max(...y)<t)return c}return t}return c||(c=(0,u.a)(s*r,n*r,a*r,l),this._origins.set(l,c)),c}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,a.f)(1,1,0,1);const r=window.view,i=r._stage,s=t.toString();if(!this._objects.has(s)){this._material=new v.U({width:2,color:t}),i.add(this._material);const e=new m.F({pickable:!1}),r=new p.T({castShadow:!1});i.add(r),e.add(r),i.add(e),this._objects.set(s,r)}const o=this._objects.get(s),n=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],u=n.length,f=new Array(3*u),_=new Array,y=.5*this._gridSize;for(let a=0;a<u;a++)f[3*a+0]=e[0]+(1&n[a]?y:-y),f[3*a+1]=e[1]+(2&n[a]?y:-y),f[3*a+2]=e[2]+(4&n[a]?y:-y),a>0&&_.push(a-1,a);(0,l.CM)(f,this._originSR,0,f,r.renderSpatialReference,0,u);const T=new h.Z(this._material,[[g.T.POSITION,new c.a(f,3,!0)]],[[g.T.POSITION,_]],null,d.U.Line);i.add(T),o.addGeometry(T)}get test(){const e=this;return{set gridSize(t){e._gridSize=t}}}}const y=(0,n.c)()},88153:(e,t,r)=>{r.d(t,{LP:()=>C,Z8:()=>_});var i=r(92026),s=r(14226),o=r(81949),n=r(11186),a=r(71353),l=r(90045),c=r(67077),d=r(40885),h=r(50951),u=r(54463),p=r(55848),f=r(22178),g=r(76783);const m=1e-5;class v{constructor(e){this.options=new u.om,this._results=new y,this.transform=new g.yn,this.tolerance=m,this.verticalOffset=null,this._ray=(0,d.Ue)(),this._rayEnd=(0,a.c)(),this._rayBeginTransformed=(0,a.c)(),this._rayEndTransformed=(0,a.c)(),this.viewingMode=e??h.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay((0,d.zk)(e,t,this._ray),r)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,d.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===h.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,n.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;this.point=t,this.filterPredicate=s,this.tolerance=r??m;const n=(0,g.W9)(this.verticalOffset);if((0,i.pC)(e)&&e.length>0){const t=o?e=>{o(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator&&r.getSpatialQueryAccelerator();(0,i.pC)(e)?((0,i.pC)(n)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,n):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const r=e.transformation,s=(0,g.W9)(this.verticalOffset);for(const a of t){if(!a.visible)continue;const{material:t,id:l}=a;this.transform.setAndInvalidateLazyTransforms(r,a.shaderTransformation),(0,n.m)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,n.m)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const c=this.transform.transform;(0,i.pC)(s)&&(s.objectTransform=this.transform),t.intersect(a,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,r,s,n,a,d)=>{if(t>=0){if((0,i.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const h=n?this._results.hud:this._results,f=n?i=>{const n=new p.RA(e,l,s,d);i.set(u.q7.HUD,n,t,r,o.I,a)}:i=>i.set(u.q7.OBJECT,{object:e,geometryId:l,triangleNr:s},t,r,c,a);if((null==h.min.drapedLayerOrder||a>=h.min.drapedLayerOrder)&&(null==h.min.dist||t<h.min.dist)&&f(h.min),this.options.store!==u.eC.MIN&&(null==h.max.drapedLayerOrder||a<h.max.drapedLayerOrder)&&(null==h.max.dist||t>h.max.dist)&&f(h.max),this.options.store===u.eC.ALL)if(n){const e=new w(this._ray);f(e),this._results.hud.all.push(e)}else{const e=new T(this._ray);f(e),this._results.all.push(e)}}}))}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort(((e,t)=>e.dist!==t.dist?(0,i.Pt)(e.dist,0)-(0,i.Pt)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?(0,i.Pt)(e.drapedLayerOrder,Number.MAX_VALUE)-(0,i.Pt)(t.drapedLayerOrder,Number.MAX_VALUE):(0,i.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,i.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)))}}function _(e){return new v(e)}class y{constructor(){this.min=new T((0,d.Ue)()),this.max=new T((0,d.Ue)()),this.hud={min:new w((0,d.Ue)()),max:new w((0,d.Ue)()),all:new Array},this.ground=new T((0,d.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class T{get ray(){return this._ray}get distanceInRenderSpace(){return(0,i.pC)(this.dist)?((0,n.g)(S,this.ray.direction,this.dist),(0,n.l)(S)):null}getIntersectionPoint(e){return!!(0,f.nn)(this)&&((0,n.g)(S,this.ray.direction,this.dist),(0,n.a)(e,this.ray.origin,S),!0)}getTransformedNormal(e){return(0,n.c)(x,this.normal),x[3]=0,(0,l.t)(x,x,this.transformation),(0,n.c)(e,x),(0,n.n)(e,e)}constructor(e){this.intersector=u.q7.OBJECT,this.normal=(0,a.c)(),this.transformation=(0,o.c)(),this._ray=(0,d.Ue)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=u.q7.OBJECT,(0,d.JG)(e,this._ray)}set(e,t,r,l,c,d,h){this.intersector=e,this.dist=r,(0,n.c)(this.normal,(0,i.Pt)(l,a.U)),(0,s.c)(this.transformation,(0,i.Pt)(c,o.I)),this.target=t,this.drapedLayerOrder=d,this.drapedLayerGraphicOrder=h}copy(e){(0,d.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,n.c)(this.normal,e.normal),(0,s.c)(this.transformation,e.transformation)}}class w extends T{constructor(){super(...arguments),this.intersector=u.q7.HUD}}function C(e){return new T(e)}const S=(0,a.c)(),x=(0,c.c)()},54463:(e,t,r)=>{var i,s;r.d(t,{eC:()=>s,om:()=>o,q7:()=>i}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(i||(i={}));class o{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=s.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(s||(s={}))},55848:(e,t,r)=>{r.d(t,{Dx:()=>n,RA:()=>o});var i=r(92026),s=r(71353);class o extends class{constructor(e,t,r){this.object=e,this.geometryId=t,this.triangleNr=r}}{constructor(e,t,r,o){super(e,t,r),this.center=(0,i.pC)(o)?(0,s.a)(o):null}}class n extends class{constructor(e){this.layerUid=e}}{constructor(e,t){super(e),this.graphicUid=t}}},61403:(e,t,r)=>{r.d(t,{a:()=>o});var i=r(71353);class s{constructor(e,t){this.vec3=e,this.id=t}}function o(e,t,r,o){return new s((0,i.f)(e,t,r),o)}},78289:(e,t,r)=>{var i,s;r.d(t,{$:()=>s,T:()=>i}),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(s||(s={}))},66327:(e,t,r)=>{r.d(t,{T:()=>m});var i=r(92026),s=r(14226),o=r(81949),n=r(11186),a=r(71353),l=r(23470),c=r(80064),d=r(68401),h=r(1395),u=r(79100),p=r(47669),f=r(97731),g=r(32683);class m extends h.c{get geometries(){return this._geometries}get transformation(){return this._transformation}set transformation(e){(0,s.c)(this._transformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=u.U.Object,this._geometries=new Array,this._transformation=(0,o.c)(),this._bvObjectSpace=new _,this._bvWorldSpace=new _,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new v);const t=e.geometries;(0,i.pC)(t)&&(this._geometries=Array.from(t))}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,f.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("objectGeometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new p.O(d.V_.MaskOccludee);for(const t of this._geometries)t.occludees=(0,g.lr)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,g.U_)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new p.O(d.V_.Highlight);for(const t of this._geometries)t.highlights=(0,g.lr)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,g.U_)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,s.m)(t,this.transformation,e.transformation)}_getCombinedShaderTransformation(e){return(0,s.m)((0,o.c)(),this.transformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(const s of this._geometries){const e=s.boundingInfo;(0,i.pC)(e)&&(y(e,this._bvObjectSpace,s.shaderTransformation),y(e,this._bvWorldSpace,this._getCombinedShaderTransformation(s)))}(0,n.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,n.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=(0,a.c)(),t=(0,a.c)(),r=(0,c.u1)(this.transformation);for(const s of this._geometries){const o=s.boundingInfo;if((0,i.Wi)(o))continue;const a=s.shaderTransformation,l=(0,c.u1)(a);(0,n.m)(e,o.center,a);const d=(0,n.i)(e,this._bvObjectSpace.bounds),h=o.radius*l;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],d+h),(0,n.m)(t,e,this.transformation);const u=(0,n.i)(t,this._bvWorldSpace.bounds),p=h*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],u+p)}this._bvDirty=!1}_invalidateBoundingVolume(){this._bvDirty=!0,(0,i.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){(0,i.pC)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class v{constructor(){this.min=(0,a.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,a.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class _ extends v{constructor(){super(...arguments),this.bounds=(0,l.c)()}init(){(0,n.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,n.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,l.l)(this.bounds)}}function y(e,t,r){const i=e.bbMin,o=e.bbMax;if((0,s.y)(r)){const e=(0,n.s)(T,r[12],r[13],r[14]);(0,n.a)(w,i,e),(0,n.a)(C,o,e);for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],w[r]),t.max[r]=Math.max(t.max[r],C[r])}else if((0,n.m)(w,i,r),(0,n.k)(i,o))for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],w[s]),t.max[s]=Math.max(t.max[s],w[s]);else{(0,n.m)(C,o,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],C[e]),t.max[e]=Math.max(t.max[e],w[e],C[e]);for(let e=0;e<3;++e){(0,n.c)(w,i),(0,n.c)(C,o),w[e]=o[e],C[e]=i[e],(0,n.m)(w,w,r),(0,n.m)(C,C,r);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],C[e]),t.max[e]=Math.max(t.max[e],w[e],C[e])}}}const T=(0,a.c)(),w=(0,a.c)(),C=(0,a.c)()},39077:(e,t,r)=>{r.d(t,{z:()=>d});var i=r(92026),s=r(95439),o=r(14226),n=r(81949),a=r(11186),l=r(67077),c=r(80064);class d{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.boundingSphere=(0,l.c)(),this.screenToWorldRatio=1,this._transformation=(0,n.c)(),this._shaderTransformationDirty=!0,this.id=(0,s.D)(),this.layerUid=t.layerUid,this.graphicUid=t.graphicUid,this.boundingInfo=t.boundingInfo,this.shaderTransformer=t.shaderTransformer,this.castShadow=!!t.castShadow&&t.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,c.u1)(e);(0,i.Wi)(this.boundingInfo)||((0,a.m)(t,this.boundingInfo.center,e),t[3]=this.boundingInfo.radius*r)}get hasShaderTransformation(){return(0,i.pC)(this.shaderTransformer)}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return(0,i.Wi)(this.shaderTransformer)?this.transformation:(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,n.c)()),(0,o.c)(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}},78485:(e,t,r)=>{var i;r.d(t,{j:()=>i}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(i||(i={}))},97882:(e,t,r)=>{r.d(t,{F:()=>u});var i=r(91505),s=r(100),o=r(92026),n=r(27546),a=r(1395),l=r(79100);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];var d=r(78329),h=r(78485);class u extends a.c{get objects(){return this._objects}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(),this.apiLayerUid=t,this.type=l.U.Layer,this.events=new i.Z,this.sliceable=!1,this._objects=new n.Z,this._objectsAdded=new n.Z,this._stageHandles=new s.Z,this.apiLayerUid=t,this.visible=e?.visible??!0,this.pickable=e?.pickable??!0,this.updatePolicy=e?.updatePolicy??h.j.ASYNC,this._disableOctree=e?.disableOctree??!1}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of c)this._stageHandles.add(this.events.on(t,(r=>e.handleEvent(t,r))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,o.pC)(this._octree)&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,o.pC)(this._octree)&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,o.pC)(this._octree)&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,o.pC)(this._octree)){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){(0,o.pC)(this._stage)&&this.updatePolicy!==h.j.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){(0,o.pC)(this._octree)&&!this._objectsAdded.includes(e)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return(0,o.Wi)(this._octree)&&this._objects.length>50&&!this._disableOctree?(this._octree=new d.Z((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):(0,o.pC)(this._octree)&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=(0,o.SC)(this._octree),this._objectsAdded.clear()}}},22178:(e,t,r)=>{r.d(t,{nn:()=>o});var i=r(92026),s=(r(11186),r(71353));r(82218),r(54463);function o(e){return(0,i.pC)(e)&&(0,i.pC)(e.dist)}(0,s.c)()},66832:(e,t,r)=>{r.d(t,{E:()=>P});var i=r(93169),s=r(67077),o=r(37081),n=r(68401),a=r(23620),l=r(56529),c=r(78041),d=r(93822),h=r(12594),u=r(64642),p=r(11983),f=r(82144),g=r(31132),m=r(7566),v=r(27627),_=r(50411),y=r(25920),T=r(45028),w=r(49800),C=r(36207);class S extends g.A{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===w.zO.WEBGL2}initializeProgram(e){return new v.$(e.rctx,S.shader.get().build(this.configuration),m.i)}_createPipeline(e,t){const r=this.configuration,i=e===y.A.NONE,s=e===y.A.FrontFace;return(0,C.sm)({blending:r.output!==o.H.Color&&r.output!==o.H.Alpha||!r.transparent?null:i?c.wu:(0,c.j7)(e),culling:(0,C.zp)(r.cullFace),depthTest:{func:(0,c.Bh)(e)},depthWrite:(i||s)&&r.writeDepth?C.LZ:null,colorWrite:C.BK,stencilWrite:r.hasOccludees?_.s3:null,stencilTest:r.hasOccludees?t?_.eD:_.RY:null,polygonOffset:i||s?r.polygonOffset?x:null:(0,c.je)(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}S.shader=new f.J(T.C,(()=>r.e(3173).then(r.bind(r,23173))));const x={factor:1,units:1};var b=r(27366),O=r(33559),A=r(8883);class R extends A.W{constructor(){super(...arguments),this.output=o.H.Color,this.cullFace=n.Vr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=y.A.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1}}(0,b._)([(0,O.o)({count:o.H.COUNT})],R.prototype,"output",void 0),(0,b._)([(0,O.o)({count:n.Vr.COUNT})],R.prototype,"cullFace",void 0),(0,b._)([(0,O.o)()],R.prototype,"hasSlicePlane",void 0),(0,b._)([(0,O.o)()],R.prototype,"hasVertexColors",void 0),(0,b._)([(0,O.o)()],R.prototype,"transparent",void 0),(0,b._)([(0,O.o)()],R.prototype,"polygonOffset",void 0),(0,b._)([(0,O.o)()],R.prototype,"enableOffset",void 0),(0,b._)([(0,O.o)()],R.prototype,"writeDepth",void 0),(0,b._)([(0,O.o)()],R.prototype,"hasOccludees",void 0),(0,b._)([(0,O.o)({count:y.A.COUNT})],R.prototype,"transparencyPassType",void 0),(0,b._)([(0,O.o)()],R.prototype,"hasMultipassTerrain",void 0),(0,b._)([(0,O.o)()],R.prototype,"cullAboveGround",void 0),(0,b._)([(0,O.o)()],R.prototype,"objectAndLayerIdColorInstanced",void 0);class P extends p.c{constructor(e){super(e,new D),this.supportsEdges=!0,this._configuration=new R}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(e,t){return!!(t===o.H.Color||t===o.H.Alpha||t===o.H.Highlight||t===o.H.Depth&&this.parameters.writeLinearDepth||t===o.H.ObjectAndLayerIdColor)&&(e===d.r.DRAPED_MATERIAL||(t===o.H.Highlight?e===d.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?d.r.TRANSPARENT_MATERIAL:d.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:d.r.OPAQUE_MATERIAL)))}createGLMaterial(e){return new E(e)}createBufferWriter(){return new h.G((0,i.Z)("enable-feature:objectAndLayerId-rendering")?u.ck:u.IM)}}class E extends a.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==o.H.Color&&this._output!==o.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(S,e)}}class D extends l.Mt{constructor(){super(...arguments),this.color=s.Z,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n.Vr.None,this.hasOccludees=!1}}},64642:(e,t,r)=>{r.d(t,{IM:()=>a,W1:()=>n,ck:()=>l,wp:()=>o});var i=r(55158),s=r(4760);const o=(0,i.U$)().vec3f(s.T.POSITION),n=(0,i.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0),a=(0,i.U$)().vec3f(s.T.POSITION).vec4u8(s.T.COLOR),l=((0,i.U$)().vec3f(s.T.POSITION).vec4u8(s.T.OBJECTANDLAYERIDCOLOR),(0,i.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0).vec4u8(s.T.OBJECTANDLAYERIDCOLOR),(0,i.U$)().vec3f(s.T.POSITION).vec4u8(s.T.COLOR).vec4u8(s.T.OBJECTANDLAYERIDCOLOR))},48800:(e,t,r)=>{r.d(t,{A:()=>J});var i=r(93169),s=r(16889),o=r(92026),n=r(22753),a=r(11873),l=r(14226),c=r(81949),d=r(88396),h=r(6394),u=r(11186),p=r(71353),f=r(67077);function g(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var m=r(65156),v=r(25158),_=r(94463),y=r(55158),T=r(37081),w=r(50600),C=r(17363),S=r(56529),x=r(93822),b=r(65216),O=r(97731),A=r(4760);class R{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}}var P=r(33236),E=r(22909),D=r(18442),I=r(50951),M=r(82144),H=r(31132),L=r(7566),N=r(78041),F=r(27627),z=r(25920),U=r(49800),j=r(8548),V=r(36207);class W extends H.A{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===U.zO.WEBGL2,t.spherical=e.viewingMode===I.JY.Global}initializeProgram(e){return new F.$(e.rctx,W.shader.get().build(this.configuration),L.i)}_setPipelineState(e){const t=this.configuration,r=e===z.A.NONE,i=e===z.A.FrontFace,s=this.configuration.hasPolygonOffset?G:null,o=(r||i)&&t.output!==T.H.Highlight&&(t.depthEnabled||t.occlusionPass)?V.LZ:null;return(0,V.sm)({blending:t.output===T.H.Color||t.output===T.H.Alpha||t.output===T.H.Highlight?r?B:(0,N.j7)(e):null,depthTest:{func:j.wb.LEQUAL},depthWrite:o,colorWrite:V.BK,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?j.MX.POINTS:j.MX.TRIANGLES}}W.shader=new M.J(D.H,(()=>r.e(6823).then(r.bind(r,16823))));const G={factor:0,units:-4},B=(0,V.if)(j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA);var k=r(27366),$=r(33559),Z=r(8883);class q extends Z.W{constructor(){super(...arguments),this.output=T.H.Color,this.screenCenterOffsetUnitsEnabled=w.d.World,this.transparencyPassType=z.A.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,k._)([(0,$.o)({count:T.H.COUNT})],q.prototype,"output",void 0),(0,k._)([(0,$.o)({count:w.d.COUNT})],q.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,k._)([(0,$.o)({count:z.A.COUNT})],q.prototype,"transparencyPassType",void 0),(0,k._)([(0,$.o)()],q.prototype,"spherical",void 0),(0,k._)([(0,$.o)()],q.prototype,"occlusionTestEnabled",void 0),(0,k._)([(0,$.o)()],q.prototype,"signedDistanceFieldEnabled",void 0),(0,k._)([(0,$.o)()],q.prototype,"vvSize",void 0),(0,k._)([(0,$.o)()],q.prototype,"vvColor",void 0),(0,k._)([(0,$.o)()],q.prototype,"hasVerticalOffset",void 0),(0,k._)([(0,$.o)()],q.prototype,"hasScreenSizePerspective",void 0),(0,k._)([(0,$.o)()],q.prototype,"debugDrawLabelBorder",void 0),(0,k._)([(0,$.o)()],q.prototype,"binaryHighlightOcclusionEnabled",void 0),(0,k._)([(0,$.o)()],q.prototype,"hasSlicePlane",void 0),(0,k._)([(0,$.o)()],q.prototype,"hasPolygonOffset",void 0),(0,k._)([(0,$.o)()],q.prototype,"depthEnabled",void 0),(0,k._)([(0,$.o)()],q.prototype,"pixelSnappingEnabled",void 0),(0,k._)([(0,$.o)()],q.prototype,"isDraped",void 0),(0,k._)([(0,$.o)()],q.prototype,"hasMultipassGeometry",void 0),(0,k._)([(0,$.o)()],q.prototype,"hasMultipassTerrain",void 0),(0,k._)([(0,$.o)()],q.prototype,"cullAboveGround",void 0),(0,k._)([(0,$.o)()],q.prototype,"occlusionPass",void 0),(0,k._)([(0,$.o)()],q.prototype,"objectAndLayerIdColorInstanced",void 0),(0,k._)([(0,$.o)({constValue:!0})],q.prototype,"hasSliceInVertexProgram",void 0),(0,k._)([(0,$.o)({constValue:!1})],q.prototype,"hasVvInstancing",void 0);class J extends S.F5{constructor(e){super(e,new ge),this._configuration=new q}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?w.d.Screen:w.d.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.isDraped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSizeEnabled,this._configuration.vvColor=!!this.parameters.vvColorEnabled,this._configuration.occlusionPass=t.slot===x.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===T.H.Color||e===T.H.Alpha),e===T.H.Color&&(this._configuration.debugDrawLabelBorder=!!_.Z.LABELS_SHOW_BORDER),e===T.H.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassGeometry=t.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,r,i,s,a){if(!r.options.selectionMode||!r.options.hud||!e.visible)return;const c=this.parameters;let d=1,h=1;if((0,n.f)(oe,t),(0,o.pC)(e.shaderTransformer)){const t=e.shaderTransformer(de);d=t[0],h=t[5],function(e){const t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],n=e[5],a=e[6],l=e[7],c=e[8],d=1/Math.sqrt(t*t+r*r+i*i),h=1/Math.sqrt(s*s+o*o+n*n),u=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*d,e[1]=r*d,e[2]=i*d,e[3]=s*h,e[4]=o*h,e[5]=n*h,e[6]=a*u,e[7]=l*u,e[8]=c*u}(oe)}const f=e.vertexAttributes.get(A.T.POSITION),g=e.vertexAttributes.get(A.T.SIZE),m=e.vertexAttributes.get(A.T.NORMAL),v=e.vertexAttributes.get(A.T.AUXPOS1);(0,O.hu)(f.size>=3);const _=r.point,y=r.camera,T=(0,D.c)(c);d*=y.pixelRatio,h*=y.pixelRatio;const w="screen"===this.parameters.centerOffsetUnits;for(let o=0;o<f.data.length/f.size;o++){const e=o*f.size;(0,u.s)(ee,f.data[e],f.data[e+1],f.data[e+2]),(0,u.m)(ee,ee,t);const i=o*g.size;pe[0]=g.data[i]*d,pe[1]=g.data[i+1]*h,(0,u.m)(ee,ee,y.viewMatrix);const s=o*v.size;if((0,u.s)(le,v.data[s+0],v.data[s+1],v.data[s+2]),!w&&(ee[0]+=le[0],ee[1]+=le[1],0!==le[2])){const e=le[2];(0,u.n)(le,ee),(0,u.b)(ee,ee,(0,u.g)(le,le,e))}const n=o*m.size;if((0,u.s)(te,m.data[n],m.data[n+1],m.data[n+2]),this._normalAndViewAngle(te,oe,y,ce),this._applyVerticalOffsetTransformationView(ee,ce,y,Q),y.applyProjection(ee,re),re[0]>-1){re[0]=Math.floor(re[0]),re[1]=Math.floor(re[1]),w&&(le[0]||le[1])&&(re[0]+=le[0],0!==le[1]&&(re[1]+=(0,b.sX)(le[1],Q.factorAlignment)),y.unapplyProjection(re,ee)),re[0]+=this.parameters.screenOffset[0],re[1]+=this.parameters.screenOffset[1],(0,b.TU)(pe,Q.factor,pe);const e=he*y.pixelRatio;let t=0;if(c.textureIsSignedDistanceField&&(t=c.outlineSize*y.pixelRatio/2),_&&Y(_,re[0],re[1],pe,e,t,c,T)){const e=r.ray;if((0,u.m)(se,ee,(0,l.a)(ae,y.viewMatrix)),re[0]=_[0],re[1]=_[1],y.unprojectFromRenderScreen(re,ee)){const t=(0,p.c)();(0,u.c)(t,e.direction);const r=1/(0,u.l)(t);(0,u.g)(t,t,r),a((0,u.i)(e.origin,ee)*r,t,-1,!0,1,se)}}}}}intersectDraped(e,t,r,i,s,n){const a=e.vertexAttributes.get(A.T.POSITION),l=e.vertexAttributes.get(A.T.SIZE),c=this.parameters,d=(0,D.c)(c);let h=1,u=1;if((0,o.pC)(e.shaderTransformer)){const t=e.shaderTransformer(de);h=t[0],u=t[5]}h*=e.screenToWorldRatio,u*=e.screenToWorldRatio;const p=ue*e.screenToWorldRatio;for(let o=0;o<a.data.length/a.size;o++){const t=o*a.size,r=a.data[t],f=a.data[t+1],g=o*l.size;pe[0]=l.data[g]*h,pe[1]=l.data[g+1]*u;let m=0;c.textureIsSignedDistanceField&&(m=c.outlineSize*e.screenToWorldRatio/2),Y(i,r,f,pe,p,m,c,d)&&s(n.dist,n.normal,-1,!1)}}createBufferWriter(){return new _e(this)}_normalAndViewAngle(e,t,r,i){return g(t)&&(t=(0,n.f)(ne,t)),(0,u.t)(i.normal,e,t),(0,u.m)(i.normal,i.normal,r.viewInverseTransposeMatrix),i.cosAngle=(0,u.e)(ie,fe),i}_updateScaleInfo(e,t,r){const i=this.parameters;(0,o.pC)(i.screenSizePerspective)?(0,b.PV)(r,t,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),(0,o.pC)(i.screenSizePerspectiveAlignment)?(0,b.PV)(r,t,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,r,i,s,o,n){const a=this._normalAndViewAngle(t,r,s,ce);return this._applyVerticalGroundOffsetView(e,a,s,n),this._applyVerticalOffsetTransformationView(n,a,s,o),this._applyPolygonOffsetView(n,a,i[3],s,n),this._applyCenterOffsetView(n,i,n),n}applyShaderOffsetsNDC(e,t,r,i,s){return this._applyCenterOffsetNDC(e,t,r,i),(0,o.pC)(s)&&(0,u.c)(s,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,t,r,i,o){const n=i.aboveGround?1:-1;let a=Math.sign(r);0===a&&(a=n);const l=n*a;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(o,e);const c=(0,s.uZ)(Math.abs(t.cosAngle),.01,1),d=1-Math.sqrt(1-c*c)/c/i.viewport[2];return(0,u.g)(o,e,l>0?d:1/d),o}_applyVerticalGroundOffsetView(e,t,r,i){const s=(0,u.l)(e),o=r.aboveGround?1:-1,n=.5*r.computeRenderPixelSizeAtDist(s),a=(0,u.g)(ee,t.normal,o*n);return(0,u.a)(i,e,a),i}_applyVerticalOffsetTransformationView(e,t,r,i){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const r=(0,u.l)(e);this._updateScaleInfo(i,r,t.cosAngle)}else i.factor.scale=1,i.factorAlignment.scale=1;return e}const n=(0,u.l)(e),a=(0,o.Pt)(s.screenSizePerspectiveAlignment,s.screenSizePerspective),l=(0,E.Hx)(r,n,s.verticalOffset,t.cosAngle,a);return this._updateScaleInfo(i,n,t.cosAngle),(0,u.g)(t.normal,t.normal,l),(0,u.a)(e,e,t.normal)}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,u.n)(te,r),(0,u.a)(r,r,(0,u.g)(te,te,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const s="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),s||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const s=this.parameters.shaderPolygonOffset;if(e!==i&&(0,u.c)(i,e),s){const e=r.aboveGround?1:-1,o=e*Math.sign(t[3]);i[2]-=(o||e)*s}return i}requiresSlot(e,t){if(t===T.H.Color||t===T.H.Alpha||t===T.H.Highlight||t===T.H.ObjectAndLayerIdColor){if(e===x.r.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:r}=this.parameters;return e===(t?x.r.LABEL_MATERIAL:x.r.HUD_MATERIAL)||r&&e===x.r.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new X(e)}calculateRelativeScreenBounds(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,m.Ue)();return function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K;(0,d.c)(i,e.anchorPosition),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*r,i[1]+=e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class X extends C.F{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(W,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function Y(e,t,r,i,s,n,a,l){let c=t-s-(l[0]>0?i[0]*l[0]:0),d=c+i[0]+2*s,h=r-s-(l[1]>0?i[1]*l[1]:0),u=h+i[1]+2*s;const p=a.distanceFieldBoundingBox;return a.textureIsSignedDistanceField&&(0,o.pC)(p)&&(c+=i[0]*p[0],h+=i[1]*p[1],d-=i[0]*(1-p[2]),u-=i[1]*(1-p[3]),c-=n,d+=n,h-=n,u+=n),e[0]>c&&e[0]<d&&e[1]>h&&e[1]<u}const Q=new class{constructor(){this.factor=new R,this.factorAlignment=new R}},K=(0,h.a)(),ee=(0,p.c)(),te=(0,p.c)(),re=(0,f.c)(),ie=(0,p.c)(),se=(0,p.c)(),oe=(0,a.c)(),ne=(0,a.c)(),ae=(0,c.c)(),le=(0,p.c)(),ce={normal:ie,cosAngle:0},de=(0,c.c)(),he=1,ue=2,pe=[0,0],fe=(0,p.f)(0,0,1);class ge extends C.E{constructor(){super(...arguments),this.renderOccluded=S.yD.Occlude,this.color=(0,f.f)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,h.f)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=(0,f.f)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const me=(0,y.U$)().vec3f(A.T.POSITION).vec3f(A.T.NORMAL).vec2f(A.T.UV0).vec4u8(A.T.COLOR).vec2f(A.T.SIZE).vec4f(A.T.AUXPOS1).vec4f(A.T.AUXPOS2),ve=me.clone().vec4u8(A.T.OBJECTANDLAYERIDCOLOR);class _e{constructor(e){this._material=e,this.vertexBufferLayout=(0,i.Z)("enable-feature:objectAndLayerId-rendering")?ve:me}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(A.T.POSITION).length}write(e,t,r,i,s){(0,P.ho)(r.indices.get(A.T.POSITION),r.vertexAttributes.get(A.T.POSITION).data,e,i.position,s,6),(0,P.s5)(r.indices.get(A.T.NORMAL),r.vertexAttributes.get(A.T.NORMAL).data,t,i.normal,s,6);const n=r.vertexAttributes.get(A.T.UV0).data;let a,l,c,d;if(null==n||n.length<4){const e=this._material.parameters;a=0,l=0,c=e.texCoordScale[0],d=e.texCoordScale[1]}else a=n[0],l=n[1],c=n[2],d=n[3];c=Math.min(1.99999,c+1),d=Math.min(1.99999,d+1);let h=r.indices.get(A.T.POSITION).length,u=s;const p=i.uv0;for(let o=0;o<h;++o)p.set(u,0,a),p.set(u,1,l),u+=1,p.set(u,0,c),p.set(u,1,l),u+=1,p.set(u,0,c),p.set(u,1,d),u+=1,p.set(u,0,c),p.set(u,1,d),u+=1,p.set(u,0,a),p.set(u,1,d),u+=1,p.set(u,0,a),p.set(u,1,l),u+=1;(0,P.Vs)(r.indices.get(A.T.COLOR),r.vertexAttributes.get(A.T.COLOR).data,4,i.color,s,6);const f=r.indices.get(A.T.SIZE),g=r.vertexAttributes.get(A.T.SIZE).data;h=f.length;const m=i.size;u=s;for(let o=0;o<h;++o){const e=g[2*f[o]],t=g[2*f[o]+1];for(let r=0;r<6;++r)m.set(u,0,e),m.set(u,1,t),u+=1}if(r.indices.get(A.T.AUXPOS1)&&r.vertexAttributes.get(A.T.AUXPOS1)?(0,P.SW)(r.indices.get(A.T.AUXPOS1),r.vertexAttributes.get(A.T.AUXPOS1).data,i.auxpos1,s,6):(0,P.h)(i.auxpos1,s,6*h),r.indices.get(A.T.AUXPOS2)&&r.vertexAttributes.get(A.T.AUXPOS2)?(0,P.SW)(r.indices.get(A.T.AUXPOS2),r.vertexAttributes.get(A.T.AUXPOS2).data,i.auxpos2,s,6):(0,P.h)(i.auxpos2,s,6*h),(0,o.pC)(r.objectAndLayerIdColor)&&r.indices.get(A.T.POSITION)){const e=r.indices.get(A.T.POSITION).length,t=i.getField(A.T.OBJECTANDLAYERIDCOLOR,v.mc);(0,P.xP)(r.objectAndLayerIdColor,t,e,s,6)}}}},24231:(e,t,r)=>{r.d(t,{Y:()=>U});var i=r(32718),s=r(16889),o=r(92026),n=r(17842),a=r(88396),l=r(11186),c=r(71353),d=r(67077),h=r(95773),u=r(85981),p=r(55652),f=r(25158),g=r(37081),m=r(23620),v=r(56529),_=r(93822),y=r(97731),T=r(4760),w=r(12594),C=r(64642),S=r(33236),x=r(82144),b=r(31132),O=r(7566),A=r(27627),R=r(50411),P=r(99337),E=r(49800),D=r(8548),I=r(36207);class M extends b.A{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==g.H.Highlight}initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===E.zO.WEBGL2}initializeProgram(e){return new A.$(e.rctx,M.shader.get().build(this.configuration),O.i)}initializePipeline(){const e=this.configuration,t=(0,I.wK)(D.zi.SRC_ALPHA,D.zi.ONE,D.zi.ONE_MINUS_SRC_ALPHA,D.zi.ONE_MINUS_SRC_ALPHA),r=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,I.sm)({blending:r,depthTest:R.JN,depthWrite:i,colorWrite:I.BK,stencilWrite:e.hasOccludees?R.s3:null,stencilTest:e.hasOccludees?t?R.eD:R.RY:null})};return e.output===g.H.Color?(this._occludeePipelineState=r(!0,e.transparent||this._stippleEnabled?t:null,I.LZ),r(!1,e.transparent||this._stippleEnabled?t:null,I.LZ)):r(!1)}get primitiveType(){return D.MX.LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}M.shader=new x.J(P.N,(()=>r.e(8569).then(r.bind(r,78569))));var H,L=r(27366),N=r(33559),F=r(8883);class z extends F.W{constructor(){super(...arguments),this.output=g.H.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}(0,L._)([(0,N.o)({count:g.H.COUNT})],z.prototype,"output",void 0),(0,L._)([(0,N.o)()],z.prototype,"hasSlicePlane",void 0),(0,L._)([(0,N.o)()],z.prototype,"hasVertexColors",void 0),(0,L._)([(0,N.o)()],z.prototype,"transparent",void 0),(0,L._)([(0,N.o)()],z.prototype,"draped",void 0),(0,L._)([(0,N.o)()],z.prototype,"stippleEnabled",void 0),(0,L._)([(0,N.o)()],z.prototype,"stippleOffColorEnabled",void 0),(0,L._)([(0,N.o)()],z.prototype,"stipplePreferContinuous",void 0),(0,L._)([(0,N.o)()],z.prototype,"hasOccludees",void 0),(0,L._)([(0,N.o)({constValue:!1})],z.prototype,"stippleRequiresClamp",void 0),(0,L._)([(0,N.o)({constValue:!1})],z.prototype,"stippleScaleWithLineWidth",void 0),(0,L._)([(0,N.o)({constValue:!1})],z.prototype,"stippleRequiresStretchMeasure",void 0),function(e){e[e.START=0]="START",e[e.END=1]="END"}(H||(H={}));class U extends v.F5{constructor(e){super(e,new W),this._configuration=new z}getConfiguration(e,t){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=t.slot===_.r.DRAPED_MATERIAL;const r=(0,o.pC)(this.parameters.stipplePattern);return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&(0,o.pC)(this.parameters.stippleOffColor),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,t,r,s,o,n){if(!r.options.selectionMode||!e.visible)return;if(!(0,y.kG)(t))return void i.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const c=e.vertexAttributes.get(T.T.POSITION).data,d=r.camera,f=K;(0,a.c)(f,r.point);(0,l.s)(ee[0],f[0]-2,f[1]+2,0),(0,l.s)(ee[1],f[0]+2,f[1]+2,0),(0,l.s)(ee[2],f[0]+2,f[1]-2,0),(0,l.s)(ee[3],f[0]-2,f[1]-2,0);for(let i=0;i<4;i++)if(!d.unprojectFromRenderScreen(ee[i],te[i]))return;(0,p.zk)(d.eye,te[0],te[1],re),(0,p.zk)(d.eye,te[1],te[2],ie),(0,p.zk)(d.eye,te[2],te[3],se),(0,p.zk)(d.eye,te[3],te[0],oe);let g=Number.MAX_VALUE,m=0;for(let i=0;i<c.length-5;i+=3){if(G[0]=c[i]+t[12],G[1]=c[i+1]+t[13],G[2]=c[i+2]+t[14],B[0]=c[i+3]+t[12],B[1]=c[i+4]+t[13],B[2]=c[i+5]+t[14],(0,p.jH)(re,G)<0&&(0,p.jH)(re,B)<0||(0,p.jH)(ie,G)<0&&(0,p.jH)(ie,B)<0||(0,p.jH)(se,G)<0&&(0,p.jH)(se,B)<0||(0,p.jH)(oe,G)<0&&(0,p.jH)(oe,B)<0)continue;if(d.projectToRenderScreen(G,Z),d.projectToRenderScreen(B,q),Z[2]<0&&q[2]>0){(0,l.b)(k,G,B);const e=d.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],G)/(0,l.e)(k,(0,p.mJ)(e[h.Nu.NEAR]));(0,l.g)(k,k,t),(0,l.a)(G,G,k),d.projectToRenderScreen(G,Z)}else if(Z[2]>0&&q[2]<0){(0,l.b)(k,B,G);const e=d.frustum,t=-(0,p.jH)(e[h.Nu.NEAR],B)/(0,l.e)(k,(0,p.mJ)(e[h.Nu.NEAR]));(0,l.g)(k,k,t),(0,l.a)(B,B,k),d.projectToRenderScreen(B,q)}else if(Z[2]<0&&q[2]<0)continue;Z[2]=0,q[2]=0;const e=(0,u.Jk)((0,u.zk)(Z,q,Y),f);e<g&&(g=e,(0,l.c)(J,G),(0,l.c)(X,B),m=i/3)}const v=r.rayBegin,_=r.rayEnd;if(g<4){let e=Number.MAX_VALUE;if((0,u.AR)((0,u.zk)(J,X,Y),(0,u.zk)(v,_,Q),$)){(0,l.b)($,$,v);const t=(0,l.l)($);(0,l.g)($,$,1/t),e=t/(0,l.i)(v,_)}n(e,$,m,!1)}}intersectDraped(e,t,r,i,o,n){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(T.T.POSITION).data,l=e.vertexAttributes.get(T.T.SIZE),c=l?l.data[0]:0,d=i[0],h=i[1],u=((c+1)/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let g=0;g<a.length-5;g+=3){const e=a[g],t=a[g+1],r=d-e,i=h-t,o=a[g+3]-e,n=a[g+4]-t,l=(0,s.uZ)((o*r+n*i)/(o*o+n*n),0,1),c=o*l-r,u=n*l-i,m=c*c+u*u;m<p&&(p=m,f=g/3)}p<u*u&&o(n.dist,n.normal,f,!1)}requiresSlot(e,t){return!(t!==g.H.Color&&t!==g.H.Highlight&&t!==g.H.ObjectAndLayerIdColor||e!==_.r.OPAQUE_MATERIAL&&e!==_.r.DRAPED_MATERIAL)}createGLMaterial(e){return new j(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?C.IM:C.wp;return(0,o.Wi)(this.parameters.stipplePattern)?new w.G(e):new V(e.clone().vec3f(T.T.AUXPOS1).vec2f(T.T.UV0))}}class j extends m.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===g.H.Color&&this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(M,e)}}class V{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(T.T.POSITION).length}write(e,t,r,i,s){(0,S.NK)(r,this.vertexBufferLayout,e,t,i,s),this._writeAuxpos1(e,r,i,s),this._writeUV0(e,r,i,s)}_writeAuxpos1(e,t,r,i){const s=r.getField(T.T.AUXPOS1,f.ct),o=t.indices.get(T.T.POSITION),n=t.vertexAttributes.get(T.T.POSITION).data,a=e,l=s.typedBufferStride,c=s.typedBuffer;i*=l;for(let d=0;d<o.length-1;d+=2)for(const e of[1,0]){const t=3*o[d+e],r=n[t],s=n[t+1],h=n[t+2],u=a[0]*r+a[4]*s+a[8]*h+a[12],p=a[1]*r+a[5]*s+a[9]*h+a[13],f=a[2]*r+a[6]*s+a[10]*h+a[14];c[i]=u,c[i+1]=p,c[i+2]=f,i+=l}}_writeUV0(e,t,r,i){const s=r.getField(T.T.UV0,f.Eu),o=t.indices.get(T.T.POSITION),n=t.vertexAttributes.get(T.T.POSITION).data,a=t.vertexAttributes.get(T.T.DISTANCETOSTART)?.data,c=s.typedBufferStride,d=s.typedBuffer;let h=0;d[i*=c]=H.START,d[i+1]=h,i+=c;const u=3*o[0],p=(0,l.s)(G,n[u],n[u+1],n[u+2]);e&&(0,l.m)(p,p,e);const g=B,m=o.length-1;let v=1;const _=a?(e,t,r)=>h=a[r]:(e,t,r)=>h+=(0,l.i)(e,t);for(let f=1;f<m;f+=2){const t=3*o[f];(0,l.s)(g,n[t],n[t+1],n[t+2]),e&&(0,l.m)(g,g,e),_(p,g,v++);for(let e=0;e<2;++e)d[i]=1-e,d[i+1]=h,i+=c;(0,l.c)(p,g)}const y=3*o[m];(0,l.s)(g,n[y],n[y+1],n[y+2]),e&&(0,l.m)(g,g,e),_(p,g,v),d[i]=H.END,d[i+1]=h}}class W extends v.Mt{constructor(){super(...arguments),this.color=d.O,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}}const G=(0,c.c)(),B=(0,c.c)(),k=(0,c.c)(),$=(0,c.c)(),Z=(0,n.J$)(),q=(0,n.J$)(),J=(0,c.c)(),X=(0,c.c)(),Y=(0,u.Ue)(),Q=(0,u.Ue)(),K=(0,c.c)(),ee=[(0,n.J$)(),(0,n.J$)(),(0,n.J$)(),(0,n.J$)()],te=[(0,c.c)(),(0,c.c)(),(0,c.c)(),(0,c.c)()],re=(0,p.Ue)(),ie=(0,p.Ue)(),se=(0,p.Ue)(),oe=(0,p.Ue)()},58901:(e,t,r)=>{r.d(t,{U:()=>z});var i=r(93169),s=r(32718),o=r(16889),n=r(92026),a=r(17842),l=r(88396),c=r(11186),d=r(71353),h=r(67077),u=r(95773),p=r(85981),f=r(55652),g=r(55158),m=r(37081),v=r(23620),_=r(56529),y=r(93822),T=r(97731),w=r(4760),C=r(65964),S=r(33720),x=r(98186),b=r(82144),O=r(31132),A=r(78041),R=r(27627),P=r(50411),E=r(25920),D=r(8548),I=r(36207);const M=new Map([[w.T.POSITION,0],[w.T.SUBDIVISIONFACTOR,1],[w.T.UV0,2],[w.T.AUXPOS1,3],[w.T.AUXPOS2,4],[w.T.COLOR,5],[w.T.COLORFEATUREATTRIBUTE,5],[w.T.SIZE,6],[w.T.SIZEFEATUREATTRIBUTE,6],[w.T.OPACITYFEATUREATTRIBUTE,7],[w.T.OBJECTANDLAYERIDCOLOR,8]]);class H extends O.A{initializeProgram(e){return new R.$(e.rctx,H.shader.get().build(this.configuration),M)}_makePipelineState(e,t){const r=this.configuration,i=e===E.A.NONE,s=e===E.A.FrontFace;return(0,I.sm)({blending:r.output===m.H.Color||r.output===m.H.Alpha?i?A.wu:(0,A.j7)(e):null,depthTest:{func:(0,A.Bh)(e)},depthWrite:i?r.writeDepth?I.LZ:null:(0,A.K5)(e),colorWrite:I.BK,stencilWrite:r.hasOccludees?P.s3:null,stencilTest:r.hasOccludees?t?P.eD:P.RY:null,polygonOffset:i||s?r.hasPolygonOffset?L:null:A.E0})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?L:null;this._occluderPipelineTransparent=(0,I.sm)({blending:A.wu,polygonOffset:t,depthTest:P.zV,depthWrite:null,colorWrite:I.BK,stencilWrite:null,stencilTest:P.YD}),this._occluderPipelineOpaque=(0,I.sm)({blending:A.wu,polygonOffset:t,depthTest:P.zV,depthWrite:null,colorWrite:I.BK,stencilWrite:P.P7,stencilTest:P.ii}),this._occluderPipelineMaskWrite=(0,I.sm)({blending:null,polygonOffset:t,depthTest:P.JN,depthWrite:null,colorWrite:null,stencilWrite:P.s3,stencilTest:P.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?D.MX.LINES:D.MX.TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===y.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===y.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}H.shader=new b.J(x.a,(()=>r.e(6279).then(r.bind(r,56279))));const L={factor:0,units:-4};var N,F=r(737);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(N||(N={}));class z extends _.F5{constructor(e){super(e,new j),this._configuration=new F.G,this._vertexAttributeLocations=M,this._layout=this.createLayout()}isClosed(e,t){return B(this.parameters,e,t)}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===y.r.DRAPED_MATERIAL;const r=(0,n.pC)(this.parameters.stipplePattern)&&e!==m.H.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&(0,n.pC)(this.parameters.stippleOffColor),this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=!!(0,n.pC)(this.parameters.markerParameters)&&function(e){return e.anchor===S.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&(0,n.pC)(this.parameters.innerColor),this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===_.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,r,i,s,n){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(w.T.POSITION).data,l=e.vertexAttributes.get(w.T.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get(w.T.SIZEFEATUREATTRIBUTE).data[0];c*=(0,o.uZ)(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else l&&(c*=l.data[0]);const d=i[0],h=i[1],u=(c/2+4)*e.screenToWorldRatio;let p=Number.MAX_VALUE,f=0;for(let g=0;g<a.length-5;g+=3){const e=a[g],t=a[g+1],r=d-e,i=h-t,s=a[g+3]-e,n=a[g+4]-t,l=(0,o.uZ)((s*r+n*i)/(s*s+n*n),0,1),c=s*l-r,u=n*l-i,m=c*c+u*u;m<p&&(p=m,f=g/3)}p<u*u&&s(n.dist,n.normal,f,!1)}intersect(e,t,r,i,n,a){if(!r.options.selectionMode||!e.visible)return;if(!(0,T.kG)(t))return void s.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const d=e.vertexAttributes,h=d.get(w.T.POSITION).data;let g=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=d.get(w.T.SIZEFEATUREATTRIBUTE).data[0];g*=(0,o.uZ)(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else d.has(w.T.SIZE)&&(g*=d.get(w.T.SIZE).data[0]);const m=r.camera,v=J;(0,l.c)(v,r.point);const _=g*m.pixelRatio/2+4*m.pixelRatio;(0,c.s)(oe[0],v[0]-_,v[1]+_,0),(0,c.s)(oe[1],v[0]+_,v[1]+_,0),(0,c.s)(oe[2],v[0]+_,v[1]-_,0),(0,c.s)(oe[3],v[0]-_,v[1]-_,0);for(let s=0;s<4;s++)if(!m.unprojectFromRenderScreen(oe[s],ne[s]))return;(0,f.zk)(m.eye,ne[0],ne[1],ae),(0,f.zk)(m.eye,ne[1],ne[2],le),(0,f.zk)(m.eye,ne[2],ne[3],ce),(0,f.zk)(m.eye,ne[3],ne[0],de);let y=Number.MAX_VALUE,C=0;const S=G(this.parameters,d,e.indices)?h.length-2:h.length-5;for(let s=0;s<S;s+=3){k[0]=h[s]+t[12],k[1]=h[s+1]+t[13],k[2]=h[s+2]+t[14];const e=(s+3)%h.length;if($[0]=h[e]+t[12],$[1]=h[e+1]+t[13],$[2]=h[e+2]+t[14],(0,f.jH)(ae,k)<0&&(0,f.jH)(ae,$)<0||(0,f.jH)(le,k)<0&&(0,f.jH)(le,$)<0||(0,f.jH)(ce,k)<0&&(0,f.jH)(ce,$)<0||(0,f.jH)(de,k)<0&&(0,f.jH)(de,$)<0)continue;if(m.projectToRenderScreen(k,X),m.projectToRenderScreen($,Y),X[2]<0&&Y[2]>0){(0,c.b)(Z,k,$);const e=m.frustum,t=-(0,f.jH)(e[u.Nu.NEAR],k)/(0,c.e)(Z,(0,f.mJ)(e[u.Nu.NEAR]));(0,c.g)(Z,Z,t),(0,c.a)(k,k,Z),m.projectToRenderScreen(k,X)}else if(X[2]>0&&Y[2]<0){(0,c.b)(Z,$,k);const e=m.frustum,t=-(0,f.jH)(e[u.Nu.NEAR],$)/(0,c.e)(Z,(0,f.mJ)(e[u.Nu.NEAR]));(0,c.g)(Z,Z,t),(0,c.a)($,$,Z),m.projectToRenderScreen($,Y)}else if(X[2]<0&&Y[2]<0)continue;X[2]=0,Y[2]=0;const r=(0,p.Jk)((0,p.zk)(X,Y,ee),v);r<y&&(y=r,(0,c.c)(Q,k),(0,c.c)(K,$),C=s/3)}const x=r.rayBegin,b=r.rayEnd;if(y<_*_){let e=Number.MAX_VALUE;if((0,p.AR)((0,p.zk)(Q,K,ee),(0,p.zk)(x,b,te),q)){(0,c.b)(q,q,x);const t=(0,c.l)(q);(0,c.g)(q,q,1/t),e=t/(0,c.i)(x,b)}a(e,q,C,!1)}}createLayout(){const e=(0,g.U$)().vec3f(w.T.POSITION).f32(w.T.SUBDIVISIONFACTOR).vec2f(w.T.UV0).vec3f(w.T.AUXPOS1).vec3f(w.T.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(w.T.SIZEFEATUREATTRIBUTE):e.f32(w.T.SIZE),this.parameters.vvColorEnabled?e.f32(w.T.COLORFEATUREATTRIBUTE):e.vec4f(w.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(w.T.OPACITYFEATUREATTRIBUTE),(0,i.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(w.T.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new V(this._layout,this.parameters)}requiresSlot(e,t){return(t===m.H.Color||t===m.H.Alpha||t===m.H.Highlight||t===m.H.Depth||t===m.H.ObjectAndLayerIdColor)&&(e===y.r.DRAPED_MATERIAL||(this.parameters.renderOccluded===_.yD.OccludeAndTransparentStencil?e===y.r.OPAQUE_MATERIAL||e===y.r.OCCLUDER_MATERIAL||e===y.r.TRANSPARENT_OCCLUDER_MATERIAL:t===m.H.Color||t===m.H.Alpha?e===(this.parameters.writeDepth?y.r.TRANSPARENT_MATERIAL:y.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===y.r.OPAQUE_MATERIAL))}createGLMaterial(e){return new U(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),(0,n.pC)(e.markerParameters)&&(e.markerScale=e.markerParameters.width/e.width)}}class U extends v.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==m.H.Color&&this._output!==m.H.Alpha||this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,t)),this._stipplePattern=t),this.ensureTechnique(H,e)}}class j extends C.n{constructor(){super(...arguments),this.width=0,this.color=h.O,this.join="miter",this.cap=F.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class V{constructor(e,t){this._parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=x.R+r}}_isClosed(e){return G(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.indices.get(w.T.POSITION).length/2+1,r=this._isClosed(e);let i=r?2:4;return i+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),i+=2,this._parameters.wireframe&&(i=2+4*(i-2)),i}write(e,t,r,s,o){const a=re,l=ie,d=se,h=r.vertexAttributes.get(w.T.POSITION).data,u=r.indices&&r.indices.get(w.T.POSITION),p=r.vertexAttributes.get(w.T.DISTANCETOSTART)?.data;u&&u.length!==2*(h.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,g=0;this._parameters.vvSizeEnabled?g=r.vertexAttributes.get(w.T.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(w.T.SIZE)&&(f=r.vertexAttributes.get(w.T.SIZE).data[0]);let m=[1,1,1,1],v=0;this._parameters.vvColorEnabled?v=r.vertexAttributes.get(w.T.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(w.T.COLOR)&&(m=r.vertexAttributes.get(w.T.COLOR).data);const _=(0,i.Z)("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let y=0;this._parameters.vvOpacityEnabled&&(y=r.vertexAttributes.get(w.T.OPACITYFEATUREATTRIBUTE).data[0]);const T=h.length/3,C=new Float32Array(s.buffer),S=(0,i.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(s.buffer):null,x=this.vertexBufferLayout.stride/4;let b=o*x;const O=b;let A=0;const R=p?(e,t,r)=>A=p[r]:(e,t,r)=>A+=(0,c.i)(e,t),P=(0,i.Z)("enable-feature:objectAndLayerId-rendering"),E=(e,t,r,i,s,o,a)=>{if(C[b++]=t[0],C[b++]=t[1],C[b++]=t[2],C[b++]=i,C[b++]=a,C[b++]=s,C[b++]=e[0],C[b++]=e[1],C[b++]=e[2],C[b++]=r[0],C[b++]=r[1],C[b++]=r[2],this._parameters.vvSizeEnabled?C[b++]=g:C[b++]=f,this._parameters.vvColorEnabled)C[b++]=v;else{const e=Math.min(4*o,m.length-4);C[b++]=m[e],C[b++]=m[e+1],C[b++]=m[e+2],C[b++]=m[e+3]}this._parameters.vvOpacityEnabled&&(C[b++]=y),P&&((0,n.pC)(_)&&(S[4*b]=_[0],S[4*b+1]=_[1],S[4*b+2]=_[2],S[4*b+3]=_[3]),b++)};b+=x,(0,c.s)(l,h[0],h[1],h[2]),e&&(0,c.m)(l,l,e);const D=this._isClosed(r);if(D){const t=h.length-3;(0,c.s)(a,h[t],h[t+1],h[t+2]),e&&(0,c.m)(a,a,e)}else(0,c.s)(d,h[3],h[4],h[5]),e&&(0,c.m)(d,d,e),E(l,l,d,1,N.LEFT_CAP_START,0,0),E(l,l,d,1,N.RIGHT_CAP_START,0,0),(0,c.c)(a,l),(0,c.c)(l,d);const I=D?0:1,M=D?T:T-1;for(let i=I;i<M;i++){const t=(i+1)%T*3;(0,c.s)(d,h[t],h[t+1],h[t+2]),e&&(0,c.m)(d,d,e),R(a,l,i),E(a,l,d,0,N.LEFT_JOIN_END,i,A),E(a,l,d,0,N.RIGHT_JOIN_END,i,A);const r=this.numJoinSubdivisions;for(let e=0;e<r;++e){const t=(e+1)/(r+1);E(a,l,d,t,N.LEFT_JOIN_END,i,A),E(a,l,d,t,N.RIGHT_JOIN_END,i,A)}E(a,l,d,1,N.LEFT_JOIN_START,i,A),E(a,l,d,1,N.RIGHT_JOIN_START,i,A),(0,c.c)(a,l),(0,c.c)(l,d)}D?((0,c.s)(d,h[3],h[4],h[5]),e&&(0,c.m)(d,d,e),A=R(a,l,M),E(a,l,d,0,N.LEFT_JOIN_END,I,A),E(a,l,d,0,N.RIGHT_JOIN_END,I,A)):(A=R(a,l,M),E(a,l,l,0,N.LEFT_CAP_END,M,A),E(a,l,l,0,N.RIGHT_CAP_END,M,A)),W(C,O+x,C,O,x),b=W(C,b-x,C,b,x),this._parameters.wireframe&&this._addWireframeVertices(s,O,b,x)}_addWireframeVertices(e,t,r,i){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t);let n=0;const a=e=>n=W(o,e,s,n,i);for(let l=0;l<o.length-1;l+=2*i)a(l),a(l+2*i),a(l+1*i),a(l+2*i),a(l+1*i),a(l+3*i)}}function W(e,t,r,i,s){for(let o=0;o<s;o++)r[i++]=e[t++];return i}function G(e,t,r){return B(e,t.get(w.T.POSITION).data,r?r.get(w.T.POSITION):null)}function B(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}const k=(0,d.c)(),$=(0,d.c)(),Z=(0,d.c)(),q=(0,d.c)(),J=(0,d.c)(),X=(0,a.J$)(),Y=(0,a.J$)(),Q=(0,d.c)(),K=(0,d.c)(),ee=(0,p.Ue)(),te=(0,p.Ue)(),re=(0,d.c)(),ie=(0,d.c)(),se=(0,d.c)(),oe=[(0,a.J$)(),(0,a.J$)(),(0,a.J$)(),(0,a.J$)()],ne=[(0,d.c)(),(0,d.c)(),(0,d.c)(),(0,d.c)()],ae=(0,f.Ue)(),le=(0,f.Ue)(),ce=(0,f.Ue)(),de=(0,f.Ue)()},82031:(e,t,r)=>{r.d(t,{$A:()=>u,h0:()=>l,it:()=>f,kj:()=>p});var i=r(46228),s=r(92026),o=r(98634),n=r(8548),a=r(51378);class l{constructor(e){this._rctx=e,this._cache=new Map}destroy(){this._cache.forEach((e=>(0,s.M2)(e.stippleTexture))),this._cache.clear()}_acquire(e){if((0,s.Wi)(e))return null;const t=this._patternId(e),r=this._cache.get(t);if(r)return r.refCount++,r;const{encodedData:i,paddedPixels:o}=d(e),l=new c(new a.x(this._rctx,{width:o,height:1,internalFormat:n.VI.RGBA,pixelFormat:n.VI.RGBA,dataType:n.Br.UNSIGNED_BYTE,wrapMode:n.e8.CLAMP_TO_EDGE},i));return this._cache.set(t,l),l}release(e){if((0,s.Wi)(e))return;const t=this._patternId(e),r=this._cache.get(t);r&&(r.refCount--,0===r.refCount&&((0,s.pC)(r.stippleTexture)&&r.stippleTexture.dispose(),this._cache.delete(t)))}swap(e,t){const r=this._acquire(t);return this.release(e),r}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}class c extends o.K{constructor(e){super(),this.stippleTexture=e,this.refCount=1}}function d(e){const t=h(e),r=1/e.pixelRatio,s=u(e),o=p(e),n=(Math.floor(.5*(o-1))+.5)*r,a=[];let l=1;for(const i of t){for(let e=0;e<i;e++){const t=l*(Math.min(e,i-1-e)+.5)*r/n*.5+.5;a.push(t)}l=-l}const c=Math.round(t[0]/2),d=[...a.slice(c),...a.slice(0,c)],g=s+f,m=new Uint8Array(4*g);let v=4;for(const h of d)(0,i.I)(h,m,v),v+=4;return m.copyWithin(0,v-4,v),m.copyWithin(v,4,8),{encodedData:m,paddedPixels:g}}function h(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function u(e){if((0,s.Wi)(e))return 1;const t=h(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function p(e){return h(e).reduce(((e,t)=>Math.max(e,t)))}const f=2},11983:(e,t,r)=>{r.d(t,{c:()=>o});var i=r(56529),s=r(22909);class o extends i.F5{intersect(e,t,r,i,o,n){return(0,s.Bw)(e,r,i,o,void 0,n)}}},47475:(e,t,r)=>{r.d(t,{H:()=>I,m:()=>M});var i=r(38499),s=r(6394),o=r(67077),n=r(37081),a=r(92026);class l{constructor(){this.enabled=!0,this._time=(0,i.HA)(0)}get time(){return this._time}advance(e){let{deltaTime:t,fixedTime:r}=e;return(0,a.pC)(r)?this._time!==r&&(this._time=r,!0):(this._time=(0,i.HA)(this._time+t),0!==t)}}var c=r(56529),d=r(78041),h=r(93822),u=r(12594),p=r(64642),f=r(11983),g=r(23620),m=r(27366),v=r(50951),_=r(41481),y=(r(79246),r(82144)),T=r(31132),w=r(33559),C=r(7566),S=r(27627),x=r(25920),b=r(8883),O=r(49810),A=r(49800),R=r(36207);class P extends T.A{initializeConfiguration(e,t){t.hasWebGL2Context=e.rctx.type===A.zO.WEBGL2,t.spherical=e.viewingMode===v.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new S.$(e.rctx,P.shader.get().build(this.configuration),C.i)}_setPipelineState(e){const t=this.configuration,r=e===x.A.NONE,i=e===x.A.FrontFace;return(0,R.sm)({blending:t.output!==n.H.Normal&&t.output!==n.H.Highlight&&t.transparent?r?d.wu:(0,d.j7)(e):null,depthTest:{func:(0,d.Bh)(e)},depthWrite:r?t.writeDepth?R.LZ:null:(0,d.K5)(e),colorWrite:R.BK,polygonOffset:r||i?null:(0,d.je)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}P.shader=new y.J(O.W,(()=>r.e(9106).then(r.bind(r,19106))));class E extends b.W{constructor(){super(...arguments),this.output=n.H.Color,this.transparencyPassType=x.A.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,m._)([(0,w.o)({count:n.H.COUNT})],E.prototype,"output",void 0),(0,m._)([(0,w.o)({count:x.A.COUNT})],E.prototype,"transparencyPassType",void 0),(0,m._)([(0,w.o)()],E.prototype,"spherical",void 0),(0,m._)([(0,w.o)()],E.prototype,"receiveShadows",void 0),(0,m._)([(0,w.o)()],E.prototype,"hasSlicePlane",void 0),(0,m._)([(0,w.o)()],E.prototype,"transparent",void 0),(0,m._)([(0,w.o)()],E.prototype,"enableOffset",void 0),(0,m._)([(0,w.o)()],E.prototype,"writeDepth",void 0),(0,m._)([(0,w.o)()],E.prototype,"hasScreenSpaceReflections",void 0),(0,m._)([(0,w.o)()],E.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,m._)([(0,w.o)()],E.prototype,"hasCloudsReflections",void 0),(0,m._)([(0,w.o)()],E.prototype,"isDraped",void 0),(0,m._)([(0,w.o)()],E.prototype,"hasMultipassTerrain",void 0),(0,m._)([(0,w.o)()],E.prototype,"cullAboveGround",void 0),(0,m._)([(0,w.o)({constValue:_.f7.Water})],E.prototype,"pbrMode",void 0),(0,m._)([(0,w.o)({constValue:!0})],E.prototype,"useCustomDTRExponentForWater",void 0),(0,m._)([(0,w.o)({constValue:!0})],E.prototype,"highStepCount",void 0),(0,m._)([(0,w.o)({constValue:!1})],E.prototype,"useFillLights",void 0);class D extends g.Z{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const t=(0,a.pC)(e.cloudsFade.data);t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===n.H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(P,e)}}class I extends f.c{constructor(e){super(e,new M),this._configuration=new E,this.animation=new l}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<d.ve,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<H;const r=this.animation.advance(e);return this.setParameters({timeElapsed:(0,i.D9)(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(e,t){switch(t){case n.H.Normal:return e===h.r.DRAPED_WATER;case n.H.Color:if(this.parameters.isDraped)return e===h.r.DRAPED_MATERIAL;break;case n.H.Alpha:break;case n.H.Highlight:return e===h.r.OPAQUE_MATERIAL||e===h.r.DRAPED_MATERIAL;default:return!1}let r=h.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?h.r.TRANSPARENT_MATERIAL:h.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new D(e)}createBufferWriter(){return new u.G(p.W1)}}class M extends c.Mt{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,s.f)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,o.f)(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const H=35e3},33720:(e,t,r)=>{r.d(t,{I9:()=>i,PI:()=>d,i5:()=>s});var i,s,o=r(27366),n=r(37081),a=r(33559),l=r(25920),c=r(8883);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(i||(i={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(s||(s={}));class d extends c.W{constructor(){super(...arguments),this.output=n.H.Color,this.transparencyPassType=l.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=i.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=s.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,o._)([(0,a.o)({count:n.H.COUNT})],d.prototype,"output",void 0),(0,o._)([(0,a.o)({count:l.A.COUNT})],d.prototype,"transparencyPassType",void 0),(0,o._)([(0,a.o)()],d.prototype,"occluder",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasSlicePlane",void 0),(0,o._)([(0,a.o)()],d.prototype,"writeDepth",void 0),(0,o._)([(0,a.o)({count:i.COUNT})],d.prototype,"space",void 0),(0,o._)([(0,a.o)()],d.prototype,"hideOnShortSegments",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasCap",void 0),(0,o._)([(0,a.o)({count:s.COUNT})],d.prototype,"anchor",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasTip",void 0),(0,o._)([(0,a.o)()],d.prototype,"vvSize",void 0),(0,o._)([(0,a.o)()],d.prototype,"vvColor",void 0),(0,o._)([(0,a.o)()],d.prototype,"vvOpacity",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasOccludees",void 0),(0,o._)([(0,a.o)()],d.prototype,"hasMultipassTerrain",void 0),(0,o._)([(0,a.o)()],d.prototype,"cullAboveGround",void 0),(0,o._)([(0,a.o)({constValue:!0})],d.prototype,"hasVvInstancing",void 0),(0,o._)([(0,a.o)({constValue:!0})],d.prototype,"hasSliceTranslatedView",void 0)},737:(e,t,r)=>{r.d(t,{G:()=>c,R:()=>i});var i,s=r(27366),o=r(37081),n=r(33559),a=r(25920),l=r(8883);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(i||(i={}));class c extends l.W{constructor(){super(...arguments),this.output=o.H.Color,this.capType=i.BUTT,this.transparencyPassType=a.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,s._)([(0,n.o)({count:o.H.COUNT})],c.prototype,"output",void 0),(0,s._)([(0,n.o)({count:i.COUNT})],c.prototype,"capType",void 0),(0,s._)([(0,n.o)({count:a.A.COUNT})],c.prototype,"transparencyPassType",void 0),(0,s._)([(0,n.o)()],c.prototype,"occluder",void 0),(0,s._)([(0,n.o)()],c.prototype,"hasSlicePlane",void 0),(0,s._)([(0,n.o)()],c.prototype,"hasPolygonOffset",void 0),(0,s._)([(0,n.o)()],c.prototype,"writeDepth",void 0),(0,s._)([(0,n.o)()],c.prototype,"draped",void 0),(0,s._)([(0,n.o)()],c.prototype,"stippleEnabled",void 0),(0,s._)([(0,n.o)()],c.prototype,"stippleOffColorEnabled",void 0),(0,s._)([(0,n.o)()],c.prototype,"stippleScaleWithLineWidth",void 0),(0,s._)([(0,n.o)()],c.prototype,"stipplePreferContinuous",void 0),(0,s._)([(0,n.o)()],c.prototype,"roundJoins",void 0),(0,s._)([(0,n.o)()],c.prototype,"applyMarkerOffset",void 0),(0,s._)([(0,n.o)()],c.prototype,"vvSize",void 0),(0,s._)([(0,n.o)()],c.prototype,"vvColor",void 0),(0,s._)([(0,n.o)()],c.prototype,"vvOpacity",void 0),(0,s._)([(0,n.o)()],c.prototype,"falloffEnabled",void 0),(0,s._)([(0,n.o)()],c.prototype,"innerColorEnabled",void 0),(0,s._)([(0,n.o)()],c.prototype,"hasOccludees",void 0),(0,s._)([(0,n.o)()],c.prototype,"hasMultipassTerrain",void 0),(0,s._)([(0,n.o)()],c.prototype,"cullAboveGround",void 0),(0,s._)([(0,n.o)()],c.prototype,"wireframe",void 0),(0,s._)([(0,n.o)({constValue:!0})],c.prototype,"stippleRequiresClamp",void 0),(0,s._)([(0,n.o)({constValue:!0})],c.prototype,"stippleRequiresStretchMeasure",void 0),(0,s._)([(0,n.o)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,s._)([(0,n.o)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0),(0,s._)([(0,n.o)()],c.prototype,"objectAndLayerIdColorInstanced",void 0)}}]);
//# sourceMappingURL=4184.4db03212.chunk.js.map