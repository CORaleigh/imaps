{"version":3,"file":"static/js/7585.27ed741e.chunk.js","mappings":"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","sources":["components/Panels/Property/utils/addresses.ts","components/Panels/Property/AddressTable/AddressTable.tsx"],"sourcesContent":["import MapView from \"@arcgis/core/views/MapView\";\nimport FeatureTable from \"@arcgis/core/widgets/FeatureTable\";\nimport FeatureLayer from \"@arcgis/core/layers/FeatureLayer\";\nimport FieldColumnTemplate from \"@arcgis/core/widgets/FeatureTable/support/FieldColumnTemplate\";\nimport TableTemplate from \"@arcgis/core/widgets/FeatureTable/support/TableTemplate\";\nimport FeatureSet from \"@arcgis/core/rest/support/FeatureSet\";\nimport Graphic from \"@arcgis/core/Graphic\";\nimport ButtonMenuItem from \"@arcgis/core/widgets/FeatureTable/Grid/support/ButtonMenuItem\";\n\nimport PictureMarkerSymbol from \"@arcgis/core/symbols/PictureMarkerSymbol\";\nimport { clearAddressPoints } from \"./property\";\nlet featureTable: FeatureTable;\nexport function initializeFeatureTable(\n  ref: HTMLDivElement,\n  view: MapView\n): Promise<FeatureTable> {\n  return new Promise((resolve, reject) => {\n    getTableLayer(view).then((table: any) => {\n      featureTable = new FeatureTable({\n        container: ref,\n        view: view,\n        editingEnabled: false,\n        multiSortEnabled: true,\n        visibleElements: {\n          selectionColumn: false,\n          menuItems: {\n            refreshData: false,\n            toggleColumns: false,\n          },\n        },\n        menuConfig: {\n          items: [\n            new ButtonMenuItem({\n              label: \"Export\",\n              iconClass: \"esri-icon-download\",\n              clickFunction: () => {\n                exportTable(featureTable);\n              },\n            }),\n          ],\n        },\n        tableTemplate: getTableTemplate(table),\n        layer: table,\n      });\n      featureTable?.when(() => {\n        resolve(featureTable);\n        initializeGrid(featureTable);\n\n        featureTable.on(\"selection-change\", (e) => {\n          if (e.added.length) {\n            (featureTable.layer as __esri.FeatureLayer)\n              .queryFeatures({\n                objectIds: [e.added[0].feature.getObjectId()],\n                returnGeometry: true,\n              })\n              .then((featureSet) => {\n                if (featureSet.features.length) {\n                  const feature = featureSet.features[0];\n                  feature.setAttribute(\"type\", \"address\");\n                  feature.symbol = new PictureMarkerSymbol({\n                    url: \"assets/pin.svg\",\n                    height: 24,\n                    width: 24,\n                  });\n                  clearAddressPoints(view);\n\n                  view.graphics.add(feature);\n\n                  view.goTo(\n                    { target: feature, zoom: 18 },\n                    { easing: \"ease-in-out\", duration: 1000 }\n                  );\n                }\n              });\n          }\n        });\n      });\n    });\n  });\n}\nfunction initializeGrid(featureTable: FeatureTable) {\n  (featureTable.findColumn(\"ADDRESS\") as any).width = 150;\n  (featureTable.findColumn(\"FEATURETYPE\") as any).width = 150;\n\n  setTimeout(() => {\n    const grid = (featureTable.container as HTMLElement).querySelector(\n      \"vaadin-grid\"\n    ) as any;\n    grid?.addEventListener(\"click\", (e: any) => {\n      if ((e.target as HTMLElement).nodeName === \"VAADIN-GRID-CELL-CONTENT\") {\n        featureTable.highlightIds.removeAll();\n        const item = (grid.getEventContext(e) as any)?.item;\n        const feature = item.feature;\n        //            featureTable.view.goTo(feature);\n        featureTable.highlightIds.add(feature.getAttribute(\"OBJECTID\"));\n      }\n    });\n  }, 2000);\n}\nlet addressLayer: FeatureLayer;\n\nfunction getTableLayer(view: MapView) {\n  return new Promise((resolve, reject) => {\n    const layer = new FeatureLayer({\n      portalItem: {\n        id: \"318be24592ea4dcba042511b3125fd53\",\n      },\n      layerId: 2,\n    });\n    addressLayer = layer;\n    layer.load().then((table) => {\n      const copyTable = new FeatureLayer({\n        source: [],\n        fields: table.fields,\n        geometryType: \"point\",\n        spatialReference: view.spatialReference,\n        popupTemplate: table.popupTemplate,\n        objectIdField: table.objectIdField,\n        displayField: table.displayField,\n        id: \"feature-table\",\n      });\n      copyTable.fields.forEach((field) => {\n        field.nullable = true;\n        if (field.name === \"DEED_DATE\") {\n          field.type = \"string\";\n        }\n      });\n      view.map.allTables.add(copyTable);\n\n      copyTable\n        .load()\n        .then((copyTable: FeatureLayer) => {\n          resolve(copyTable);\n        })\n        .catch((reason) => {\n          console.log(reason);\n        });\n    });\n  });\n}\nfunction getTableTemplate(layer: __esri.FeatureLayer): TableTemplate {\n  const tableTemplate: TableTemplate = new TableTemplate({\n    columnTemplates: [\n      new FieldColumnTemplate({\n        label: \"Address\",\n        fieldName: \"ADDRESS\",\n        editable: false,\n        initialSortPriority: 0,\n        direction: \"asc\",\n      }),\n      new FieldColumnTemplate({\n        label: \"Type\",\n        fieldName: \"FEATURETYPE\",\n        editable: false,\n        initialSortPriority: 1,\n        direction: \"asc\",\n      }),\n    ],\n  });\n  return tableTemplate;\n}\n\nexport function updateTable(property: Graphic, featureTable: FeatureTable) {\n  if (featureTable) {\n    clearAddressPoints(featureTable.view as __esri.MapView);\n    addressLayer\n      ?.queryFeatures({\n        geometry: property.geometry,\n        outFields: [\"ADDRESS\", \"FEATURETYPE\"],\n        returnGeometry: true,\n        where: \"1=1\",\n      })\n      .then((featureSet) => {\n        (featureTable.layer as __esri.FeatureLayer)\n          .queryFeatures({\n            where: \"1=1\",\n            returnGeometry: true,\n          })\n          .then((result: FeatureSet) => {\n            (featureTable.layer as __esri.FeatureLayer)\n              .applyEdits({ deleteFeatures: result.features })\n              .then((result) => {\n                (featureTable.layer as __esri.FeatureLayer)\n                  .applyEdits({ addFeatures: featureSet.features })\n                  .then((result) => {\n                    featureTable.refresh();\n                  })\n                  .catch((reason) => {\n                    console.log(reason);\n                  });\n              })\n              .catch((reason) => {\n                console.log(reason);\n              });\n          });\n      });\n  }\n}\n\nconst exportTable = (table: FeatureTable): void => {\n  (table.layer as FeatureLayer)\n    .queryFeatures({\n      where: \"1=1\",\n      outFields: [\"*\"],\n      orderByFields: [\"ADDRESS\", \"FEATURETYPE\"],\n    })\n    .then((result) => {\n      let csv = \"\";\n      (\n        table.tableTemplate.columnTemplates as __esri.FieldColumnTemplate[]\n      ).forEach((field: __esri.FieldColumnTemplate) => {\n        csv += `${field.label},`;\n      });\n      csv += \"\\r\\n\";\n      result.features.forEach((feature) => {\n        (\n          table.tableTemplate.columnTemplates as __esri.FieldColumnTemplate[]\n        ).forEach((field: __esri.FieldColumnTemplate) => {\n          if (feature.attributes[field.fieldName]) {\n            csv += `\"${feature.attributes[field.fieldName]}\",`;\n          } else {\n            csv += `\"\",`;\n          }\n        });\n        csv += \"\\r\\n\";\n      });\n      let datestr = new Date().toISOString();\n      datestr = datestr.replaceAll(\":\", \"\").replaceAll(\"-\", \"\");\n      const exportedFilename = `imaps_addresses_export_${datestr}.csv`;\n\n      const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n      const link = document.createElement(\"a\");\n      if (link.download !== undefined) {\n        const url = URL.createObjectURL(blob);\n        link.setAttribute(\"href\", url);\n        link.setAttribute(\"download\", exportedFilename);\n        link.style.visibility = \"hidden\";\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    });\n};\n","import React, { useEffect, useRef } from \"react\";\nimport { initializeFeatureTable, updateTable } from \"../utils/addresses\";\nimport \"./AddressTable.css\";\ninterface Props {\n  view: __esri.MapView;\n  property: __esri.Graphic;\n}\nfunction AddressTable(props: Props) {\n  const ref = useRef() as any;\n  const loaded = useRef(false);\n\n  useEffect(() => {\n    if (!loaded.current) {\n      loaded.current = true;\n\n      initializeFeatureTable(ref.current, props.view).then(\n        (table: __esri.FeatureTable) => {\n          updateTable(props.property, table);\n        }\n      );\n    }\n    return () => {\n      //featureTable && featureTable?.destroy();\n    };\n  }, []);\n\n  return <div id=\"address-table\" ref={ref}></div>;\n}\n\nexport default React.memo(AddressTable);\n"],"names":["featureTable","addressLayer","initializeFeatureTable","ref","view","Promise","resolve","reject","layer","FeatureLayer","portalItem","id","layerId","load","then","table","copyTable","source","fields","geometryType","spatialReference","popupTemplate","objectIdField","displayField","forEach","field","nullable","name","type","map","allTables","add","catch","reason","console","log","getTableLayer","FeatureTable","container","editingEnabled","multiSortEnabled","visibleElements","selectionColumn","menuItems","refreshData","toggleColumns","menuConfig","items","ButtonMenuItem","label","iconClass","clickFunction","exportTable","tableTemplate","getTableTemplate","when","findColumn","width","setTimeout","grid","querySelector","addEventListener","e","target","nodeName","highlightIds","removeAll","feature","getEventContext","item","getAttribute","initializeGrid","on","added","length","queryFeatures","objectIds","getObjectId","returnGeometry","featureSet","features","setAttribute","symbol","PictureMarkerSymbol","url","height","clearAddressPoints","graphics","goTo","zoom","easing","duration","TableTemplate","columnTemplates","FieldColumnTemplate","fieldName","editable","initialSortPriority","direction","where","outFields","orderByFields","result","csv","attributes","datestr","Date","toISOString","replaceAll","exportedFilename","blob","Blob","link","document","createElement","undefined","download","URL","createObjectURL","style","visibility","body","appendChild","click","removeChild","AddressTable","props","useRef","loaded","useEffect","current","property","geometry","applyEdits","deleteFeatures","addFeatures","refresh","updateTable","React"],"sourceRoot":""}