"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[4567],{45028:(t,e,i)=>{i.d(e,{C:()=>T,b:()=>v});var r=i(71011),s=i(33280),n=i(94951),a=i(48655),o=i(16574),h=i(137),c=i(15226),l=i(26461),u=i(116),d=i(82552),p=i(82999),g=i(95276),f=i(98634),_=i(64201),m=i(68401),y=i(4760);function v(t){const e=new _.kG,i=t.output===r.H.Depth,v=t.hasMultipassTerrain&&(t.output===r.H.Color||t.output===r.H.Alpha);(0,d.S)(e,t),e.include(n.w,{hasModelTransformation:!1,linearDepth:i}),e.include(a.c,t),e.attributes.add(y.T.POSITION,"vec3"),e.varyings.add("vpos","vec3"),v&&e.varyings.add("depth","float");const{vertex:T,fragment:w}=e;return i&&(e.include(o.F,t),T.uniforms.add(new p.A("nearFar",((t,e)=>e.camera.nearFar))),e.varyings.add("linearDepth","float")),T.code.add(f.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${v?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?f.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:f.H`transformPosition(proj, view, vpos);`}
    }
  `),e.include(s.f5,t),v&&e.include(c.l,t),w.include(u.Y),w.uniforms.add(new g.N("eColor",(t=>t.color))),t.output===r.H.Highlight&&e.include(h.bA),w.code.add(f.H`
  void main() {
    discardBySlice(vpos);
    ${v?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${t.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${f.H.float(l.b)}) {
      discard;
    }

    ${t.output===r.H.Alpha?f.H`gl_FragColor = vec4(fColor.a);`:""}

    ${t.output===r.H.Color?f.H`gl_FragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===m.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${t.output===r.H.Highlight?f.H`outputHighlight();`:""};
    ${t.output===r.H.Depth?f.H`outputDepth(linearDepth);`:""};
  }
  `),e}const T=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},82218:(t,e,i)=>{i.d(e,{a:()=>y,c:()=>m,g:()=>b,h:()=>I,u:()=>T});i(93169);var r=i(32718),s=i(16889),n=i(21530),a=i(14226),o=i(81949),h=i(11186),c=i(71353),l=i(14320),u=i(85981),d=i(55652),p=i(40885),g=i(40927),f=i(11185);const _=r.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function m(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;return{plane:(0,d.Ue)(t.plane),origin:(0,c.a)(t.origin),basis1:(0,c.a)(t.basis1),basis2:(0,c.a)(t.basis2)}}function y(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();return v(t.origin,t.basis1,t.basis2,e)}function v(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m();return(0,h.c)(r.origin,t),(0,h.c)(r.basis1,e),(0,h.c)(r.basis2,i),T(r),N(r,"fromValues()"),r}function T(t){(0,d.my)(t.basis2,t.basis1,t.origin,t.plane)}function w(t,e,i){t!==i&&y(t,i);const r=(0,h.g)(f.WM.get(),D(t),e);return(0,h.a)(i.origin,i.origin,r),i.plane[3]-=e,i}function b(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return(0,h.s)(e.origin,t[0]+i,t[1]+r,0),(0,h.s)(e.basis1,i,0,0),(0,h.s)(e.basis2,0,r,0),(0,d.al)(0,0,1,0,e.plane),e}function O(t,e,i){return!!(0,d.BR)(t.plane,e,i)&&L(t,i)}function M(t,e,i){const r=V.get();U(t,e,r,V.get());let n=Number.POSITIVE_INFINITY;for(const a of G){const o=C(t,a,F.get()),c=f.WM.get();if((0,d.rx)(r,o,c)){const t=(0,h.r)(f.WM.get(),e.origin,c),r=Math.abs((0,s.ZF)((0,h.e)(e.direction,t)));r<n&&(n=r,(0,h.c)(i,c))}}return n===Number.POSITIVE_INFINITY?A(t,e,i):i}function A(t,e,i){if(O(t,e,i))return i;const r=V.get(),s=V.get();U(t,e,r,s);let n=Number.POSITIVE_INFINITY;for(const a of G){const o=C(t,a,F.get()),c=f.WM.get();if((0,d.dZ)(r,o,c)){const t=(0,p.Jk)(e,c);if(!(0,d.Ac)(s,c))continue;t<n&&(n=t,(0,h.c)(i,c))}}return R(t,e.origin)<n&&x(t,e.origin,i),i}function x(t,e,i){const r=(0,d.nF)(t.plane,e,f.WM.get()),s=(0,u.ct)(j(t,t.basis1),r,-1,1,f.WM.get()),n=(0,u.ct)(j(t,t.basis2),r,-1,1,f.WM.get());return(0,h.b)(i,(0,h.a)(f.WM.get(),s,n),t.origin),i}function P(t,e,i){const{origin:r,basis1:s,basis2:n}=t,a=(0,h.b)(f.WM.get(),e,r),o=(0,g.SR)(s,a),c=(0,g.SR)(n,a),l=(0,g.SR)(D(t),a);return(0,h.s)(i,o,c,l)}function R(t,e){const i=P(t,e,f.WM.get()),{basis1:r,basis2:s}=t,n=(0,h.l)(r),a=(0,h.l)(s),o=Math.max(Math.abs(i[0])-n,0),c=Math.max(Math.abs(i[1])-a,0),l=i[2];return o*o+c*c+l*l}function I(t,e){return Math.sqrt(R(t,e))}function S(t,e){const i=-t.plane[3];return(0,g.SR)(D(t),e)-i}function D(t){return(0,d.mJ)(t.plane)}function L(t,e){const i=(0,h.b)(f.WM.get(),e,t.origin),r=(0,h.p)(t.basis1),s=(0,h.p)(t.basis2),n=(0,h.e)(t.basis1,i),a=(0,h.e)(t.basis2,i);return-n-r<0&&n-r<0&&-a-s<0&&a-s<0}function j(t,e){const i=F.get();return(0,h.c)(i.origin,t.origin),(0,h.c)(i.vector,e),i}function C(t,e,i){const{basis1:r,basis2:s,origin:n}=t,a=(0,h.g)(f.WM.get(),r,e.origin[0]),o=(0,h.g)(f.WM.get(),s,e.origin[1]);(0,h.a)(i.origin,a,o),(0,h.a)(i.origin,i.origin,n);const c=(0,h.g)(f.WM.get(),r,e.direction[0]),l=(0,h.g)(f.WM.get(),s,e.direction[1]);return(0,h.g)(i.vector,(0,h.a)(c,c,l),2),i}function N(t,e){Math.abs((0,h.e)(t.basis1,t.basis2)/((0,h.l)(t.basis1)*(0,h.l)(t.basis2)))>1e-6&&_.warn(e,"Provided basis vectors are not perpendicular"),Math.abs((0,h.e)(t.basis1,D(t)))>1e-6&&_.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,h.e)(D(t),t.origin)-t.plane[3])>1e-6&&_.warn(e,"Plane offset is not consistent with plane origin")}function U(t,e,i,r){const s=D(t);(0,d.my)(s,e.direction,e.origin,i),(0,d.my)((0,d.mJ)(i),s,e.origin,r)}const E={plane:(0,d.Ue)(),origin:(0,c.f)(0,0,0),basis1:(0,c.f)(1,0,0),basis2:(0,c.f)(0,1,0)},V=new n.x(d.Ue),F=new n.x(u.Ue),H=(0,c.c)(),z=new n.x((()=>({origin:null,basis1:null,basis2:null,plane:null}))),G=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],B=(0,o.c)(),W=(0,o.c)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=(0,d.Ue)(),this.origin=(0,c.c)(),this.basis1=(0,c.c)(),this.basis2=(0,c.c)()}},create:m,wrap:function(t,e,i){const r=z.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=(0,d.re)(0,0,0,0),T(r),r},copy:y,copyWithoutVerify:function(t,e){(0,h.c)(e.origin,t.origin),(0,h.c)(e.basis1,t.basis1),(0,h.c)(e.basis2,t.basis2),(0,d.JG)(e.plane,t.plane)},fromValues:v,updateUnboundedPlane:T,elevate:w,setExtent:function(t,e,i){return b(e,i),w(i,S(t,t.origin),i),i},fromAABoundingRect:b,intersectRay:O,intersectRayClosestSilhouette:function(t,e,i){if(O(t,e,i))return i;const r=M(t,e,f.WM.get());return(0,h.a)(i,e.origin,(0,h.g)(f.WM.get(),e.direction,(0,h.i)(e.origin,r)/(0,h.l)(e.direction))),i},closestPointOnSilhouette:M,closestPoint:A,projectPoint:x,projectPointLocal:P,distance2:R,distance:I,distanceToSilhouette:function(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of G){const s=C(t,r,F.get()),n=(0,u.Jk)(s,e);n>i&&(i=n)}return Math.sqrt(i)},extrusionContainsPoint:function(t,e){return(0,d.Ac)(t.plane,e)&&L(t,e)},axisAt:function(t,e,i,r){return function(t,e,i){switch(e){case l.R.X:(0,h.c)(i,t.basis1),(0,h.n)(i,i);break;case l.R.Y:(0,h.c)(i,t.basis2),(0,h.n)(i,i);break;case l.R.Z:(0,h.c)(i,D(t))}return i}(t,i,r)},altitudeAt:S,setAltitudeAt:function(t,e,i,r){const s=S(t,e),n=(0,h.g)(H,D(t),i-s);return(0,h.a)(r,e,n),r},equals:function(t,e){return(0,h.k)(t.basis1,e.basis1)&&(0,h.k)(t.basis2,e.basis2)&&(0,h.k)(t.origin,e.origin)},transform:function(t,e,i){return t!==i&&y(t,i),(0,a.a)(B,e),(0,a.t)(B,B),(0,h.m)(i.basis1,t.basis1,B),(0,h.m)(i.basis2,t.basis2,B),(0,h.m)((0,d.mJ)(i.plane),(0,d.mJ)(t.plane),B),(0,h.m)(i.origin,t.origin,e),(0,d.T5)(i.plane,i.plane,i.origin),i},rotate:function(t,e,i,r){return t!==r&&y(t,r),(0,a.d)(W,e,i),(0,h.m)(r.basis1,t.basis1,W),(0,h.m)(r.basis2,t.basis2,W),T(r),r},normal:D,UP:E},Symbol.toStringTag,{value:"Module"}))},81020:(t,e,i)=>{function r(t){return"point"===t.type}i.d(e,{f:()=>r})},37818:(t,e,i)=>{i.d(e,{Ou:()=>c,WG:()=>_,kB:()=>d,mW:()=>u});var r=i(52639),s=(i(93169),i(84652)),n=i(92026),a=i(18722),o=i(77981),h=i(65618);function c(t){return"declaredClass"in t}function l(t){return"declaredClass"in t}function u(t,e){if(!t)return null;if("declaredClass"in t)return t;const i=new r.Z({layer:e,sourceLayer:e});return i.visible=t.visible,i.symbol=(0,s.d9)(t.symbol),i.attributes=(0,s.d9)(t.attributes),i.geometry=d(t.geometry),i}function d(t){return(0,n.Wi)(t)?null:c(t)?t:(0,o.im)(function(t){const e=t.spatialReference.toJSON();switch(t.type){case"point":{const{x:i,y:r,z:s,m:n}=t;return{x:i,y:r,z:s,m:n,spatialReference:e}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=t;return{rings:p(i),hasZ:r,hasM:s,spatialReference:e}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=t;return{paths:p(i),hasZ:r,hasM:s,spatialReference:e}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:a,zmax:o,mmin:h,mmax:c,hasZ:l,hasM:u}=t;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:a,zmax:o,mmin:h,mmax:c,hasZ:l,hasM:u,spatialReference:e}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=t;return{points:f(i)?g(i):i,hasZ:r,hasM:s,spatialReference:e}}default:return}}(t))}function p(t){return function(t){for(const e of t)if(0!==e.length)return f(e);return!1}(t)?t.map((t=>g(t))):t}function g(t){return t.map((t=>(0,a.qo)(t)))}function f(t){return t.length&&((0,a.xZ)(t[0])||(0,a.fS)(t[0]))}function _(t,e){if(!t)return null;let i;if(l(t)){if(null==e)return t.clone();if(l(e))return e.copy(t)}return null!=e?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=null,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=(0,h.Tx)(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}},96387:(t,e,i)=>{i.d(e,{CV:()=>w,Go:()=>T,Si:()=>P,Uu:()=>b,ZL:()=>A,_Z:()=>x,bD:()=>O,bh:()=>M,zE:()=>m});var r=i(92026),s=i(14226),n=i(81949),a=i(71353),o=i(90045),h=i(67077),c=i(79803),l=i(41414),u=i(65156),d=i(4954),p=i(69662),g=i(65618),f=i(37818),_=i(4760);function m(t,e){if("point"===t.type)return v(t,e,!1);if((0,f.Ou)(t))switch(t.type){case"extent":return v(t.center,e,!1);case"polygon":return v(t.centroid,e,!1);case"polyline":return v(y(t),e,!0);case"mesh":return v(t.origin,e,!1)}else switch(t.type){case"extent":return v(function(t){const e=isFinite(t.zmin);return(0,g.Tx)(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),e?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}(t),e,!0);case"polygon":return v(function(t){const e=t.rings[0];if(!e||0===e.length)return null;const i=(0,d.a)(t.rings,t.hasZ);return(0,g.Tx)(i[0],i[1],i[2],t.spatialReference)}(t),e,!0);case"polyline":return v(y(t),e,!0)}}function y(t){const e=t.paths[0];if(!e||0===e.length)return null;const i=(0,p.n8)(e,(0,p.ok)(e)/2);return(0,g.Tx)(i[0],i[1],i[2],t.spatialReference)}function v(t,e,i){const r=i?t:(0,f.WG)(t);return e&&t?(0,c.nF)(t,r,e)?r:null:r}function T(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t){e||(e=(0,u.Ue)());const s=t;let n=.5*s.width*(i-1),a=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=a/20:s.height<1e-7*s.width&&(a+=n/20),(0,o.s)(e,s.xmin-n-r,s.ymin-a-r,s.xmax+n+r,s.ymax+a+r),e}return null}function w(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(_.T.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttrsUpdated(t.geometryRecords[i]))}}function b(t,e){const i=(0,h.d)(h.O);return(0,r.pC)(t)&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),(0,r.pC)(e)?i[3]=e:(0,r.pC)(t)&&t.length>3&&(i[3]=t[3]),i}function O(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.O,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const n=new Array(3);if((0,r.Wi)(e)||(0,r.Wi)(i))n[0]=1,n[1]=1,n[2]=1;else{let r,s=0;for(let a=2;a>=0;a--){const o=t[a];let h;const c=null!=o,l=0===a&&!r&&!c,u=i[a];"symbol-value"===o||l?h=0!==u?e[a]/u:1:c&&"proportional"!==o&&isFinite(o)&&(h=0!==u?o/u:1),null!=h&&(n[a]=h,r=h,s=Math.max(s,Math.abs(h)))}for(let t=2;t>=0;t--)null==n[t]?n[t]=r:0===n[t]&&(n[t]=.001*s)}for(let r=2;r>=0;r--)n[r]/=s;return(0,a.d)(n)}function M(t){return function(t){return null!=t.isPrimitive}(t)&&(t=[t.width,t.depth,t.height]),A(t)?null:"Symbol sizes may not be negative values"}function A(t){if(Array.isArray(t)){for(const e of t)if(!A(e))return!1;return!0}return null==t||t>=0}function x(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,n.c)();const a=t||0,o=e||0,h=i||0;return 0!==a&&(0,s.g)(r,r,-a/180*Math.PI),0!==o&&(0,s.r)(r,r,o/180*Math.PI),0!==h&&(0,s.o)(r,r,h/180*Math.PI),r}function P(t,e){return null!=e.minDemResolution?e.minDemResolution:(0,l.wp)(t)?e.minDemResolutionForPoints:.01*(0,l.aO)(t)}},77648:(t,e,i)=>{i.d(e,{Fb:()=>a,KO:()=>o,sb:()=>n});var r=i(92026),s=i(81020);class n{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.array=t,this.spatialReference=e,this.offset=i}}function a(t){return"array"in t}function o(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,s.f)(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(a(e)){let s=e.offset;return t.getElevation(e.array[s++],e.array[s++],e.array[s]||0,(0,r.Pt)(e.spatialReference,t.spatialReference),i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}},74321:(t,e,i)=>{i.d(e,{k:()=>n});var r=i(98634),s=i(4760);function n(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.attributes.add(s.T.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(r.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?r.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},96415:(t,e,i)=>{i.d(e,{G:()=>l,R:()=>d});var r=i(88396),s=i(6394),n=i(90045),a=i(67077),o=i(82999),h=i(95276),c=i(98634);function l(t){t.fragment.uniforms.add(new h.N("projInfo",((t,e)=>function(t){const e=t.camera.projectionMatrix;return 0===e[11]?(0,n.s)(u,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):(0,n.s)(u,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}(e)))),t.fragment.uniforms.add(new o.A("zScale",((t,e)=>d(e)))),t.fragment.code.add(c.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const u=(0,a.c)();function d(t){return 0===t.camera.projectionMatrix[11]?(0,r.a)(p,0,1):(0,r.a)(p,1,0)}const p=(0,s.a)()},68827:(t,e,i)=>{i.d(e,{y:()=>s});var r=i(61809);class s extends r.x{constructor(t){super(t,"vec4")}}},60465:(t,e,i)=>{i.d(e,{d:()=>s});var r=i(61809);class s extends r.x{constructor(t){super(t,"float")}}},2104:(t,e,i)=>{i.d(e,{Q:()=>s});var r=i(61809);class s extends r.x{constructor(t){super(t,"sampler2D")}}},60045:(t,e,i)=>{i.d(e,{V:()=>w});var r=i(32718),s=i(16889),n=i(92026),a=i(17842),o=i(14226),h=i(81949),c=i(88396),l=i(6394),u=i(11186),d=i(71353),p=i(90045),g=i(67077),f=i(95773),_=i(40885),m=i(40927),y=i(50951),v=i(97731);const T=r.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera");class w{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._viewUp=(0,d.c)(),this._viewForward=(0,d.c)(),this._viewRight=(0,d.c)(),this._ray=(0,_.Ue)(),this._viewport=(0,g.f)(0,0,1,1),this._padding=(0,g.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,l.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,h.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,h.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,h.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,h.c)(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=(0,f.Ue)(),this._fullViewport=(0,g.c)(),this._pixelRatio=1,this.relativeElevation=0,(0,n.pC)(t)&&(0,u.c)(this._ray.origin,t),this._center=(0,n.pC)(e)?(0,d.a)(e):(0,d.c)(),this._up=(0,n.pC)(i)?(0,d.a)(i):(0,d.f)(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return(0,u.b)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){(0,o.c)(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[P.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[P.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[P.RIGHT]+this._padding[P.LEFT]}set fullWidth(t){this.width=t-(this._padding[P.RIGHT]+this._padding[P.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[P.TOP]+this._padding[P.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[P.TOP]+this._padding[P.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[P.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[P.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[P.TOP]===t[P.TOP]&&this._padding[P.RIGHT]===t[P.RIGHT]&&this._padding[P.BOTTOM]===t[P.BOTTOM]&&this._padding[P.LEFT]===t[P.LEFT]||(this._viewport[0]+=t[P.LEFT]-this._padding[P.LEFT],this._viewport[1]+=t[P.BOTTOM]-this._padding[P.BOTTOM],this._viewport[2]-=t[P.RIGHT]+t[P.LEFT]-(this._padding[P.RIGHT]+this._padding[P.LEFT]),this._viewport[3]-=t[P.TOP]+t[P.BOTTOM]-(this._padding[P.TOP]+this._padding[P.BOTTOM]),(0,p.c)(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,o.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;(0,o.l)(this._projectionMatrix,-r*(1+2*this._padding[P.LEFT]/t),r*(1+2*this._padding[P.RIGHT]/t),-i*(1+2*this._padding[P.BOTTOM]/e),i*(1+2*this._padding[P.TOP]/e),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return(0,n.Wi)(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=(0,h.c)()),this._inverseProjectionDirty&&(0,o.a)(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){(0,o.c)(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return(0,v.tM)(this._fov,this.width,this.height)}set fovX(t){this._fov=(0,v.Kj)(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return(0,v.RQ)(this._fov,this.width,this.height)}set fovY(t){this._fov=(0,v.zF)(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,u.i)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,o.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,o.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){(0,u.c)(this._ray.origin,t.eye),(0,u.c)(this._center,t.center),(0,u.c)(this._up,t.up),(0,p.c)(this._viewport,t.viewport),(0,p.c)(this._padding,t.padding),(0,c.c)(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||((0,o.c)(this._viewMatrix,t.viewMatrix),(0,u.c)(this._viewRight,t.viewRight),(0,u.c)(this._viewUp,t.viewUp),(0,u.c)(this._viewForward,t.viewForward)),e._projectionDirty?this._projectionDirty=!0:((0,o.c)(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||((0,f.JG)(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,o.c)(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,p.c)(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return(new w).copyFrom(this)}equals(t){return(0,u.k)(this.eye,t.eye)&&(0,u.k)(this._center,t.center)&&(0,u.k)(this._up,t.up)&&(0,p.g)(this._viewport,t.viewport)&&(0,p.g)(this._padding,t.padding)&&(0,c.e)(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const e=5e-4;(0,u.v)(M,t.eye,t.center),(0,u.v)(A,this.eye,this._center);const i=(0,u.e)(M,A),r=(0,u.w)(M),s=(0,u.w)(A);return i*i>=(1-1e-10)*r*s&&(0,u.x)(t.eye,this.eye)<Math.max(r,s)*e*e&&(0,p.i)(t.padding,this._padding)<.5&&(0,p.i)(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs((0,m.SR)(this.viewForward,(0,u.b)(M,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,a.s1)();return t[0]=(this.padding[P.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[P.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return t[0]=this.padding[P.LEFT]+this.width*e,t[1]=this.padding[P.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==b&&(0,u.c)(b,t),b[3]=1,(0,p.t)(b,b,this.projectionMatrix);const i=Math.abs(b[3]);(0,u.g)(b,b,1/i);const r=this.fullViewport;e[0]=(0,s.t7)(0,r[0]+r[2],.5+.5*b[0]),e[1]=(0,s.t7)(0,r[1]+r[3],.5+.5*b[1]),e[2]=.5*(b[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;b[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],b[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],b[2]=(2*t[2]-1)*t[3],b[3]=t[3],(0,p.t)(b,b,this.inverseProjectionMatrix),e[0]=b[0],e[1]=b[1],e[2]=b[2]}projectToScreen(t,e){this.projectToRenderScreen(t,x),this.renderToScreen(x,e)}projectToRenderScreen(t,e){if(b[0]=t[0],b[1]=t[1],b[2]=t[2],b[3]=1,(0,p.t)(b,b,this.viewProjectionMatrix),0===b[3])return null;(0,u.g)(b,b,1/Math.abs(b[3]));const i=this.fullViewport;return"x"in e?(e.x=(0,s.t7)(0,i[0]+i[2],.5+.5*b[0]),e.y=(0,s.t7)(0,i[1]+i[3],.5+.5*b[1])):(e[0]=(0,s.t7)(0,i[0]+i[2],.5+.5*b[0]),e[1]=(0,s.t7)(0,i[1]+i[3],.5+.5*b[1]),e.length>2&&(e[2]=.5*(b[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,x),e)}unprojectFromRenderScreen(t,e){if((0,o.m)(O,this.projectionMatrix,this.viewMatrix),!(0,o.a)(O,O))return null;const i=this.fullViewport;return b[0]=2*(t[0]-i[0])/i[2]-1,b[1]=2*(t[1]-i[1])/i[3]-1,b[2]=2*t[2]-1,b[3]=1,(0,p.t)(b,b,O),0===b[3]?null:(e[0]=b[0]/b[3],e[1]=b[1]/b[3],e[2]=b[2]/b[3],e)}constrainWindowSize(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i;const s=t*this._pixelRatio,n=e*this._pixelRatio,a=Math.max(s-i/2,0),o=Math.max(this.fullHeight-n-r/2,0),h=-Math.min(s-i/2,0),c=-Math.min(this.fullHeight-n-r/2,0);return[a,o,i-h- -Math.min(this.fullWidth-s-i/2,0),r-c- -Math.min(n-r/2,0)]}computeUp(t){t===y.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this._pixelRatio,r=this.fullHeight-t[1]*this._pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this._pixelRatio,r=(this.fullHeight-t[1])/this._pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){(0,u.b)(M,this.center,this.eye);const t=(0,u.l)(this.center);t<1?((0,u.s)(this._up,0,0,1),this._markViewDirty()):Math.abs((0,u.e)(M,this.center))>.9999*(0,u.l)(M)*t||((0,u.f)(this._up,M,this.center),(0,u.f)(this._up,this._up,M),(0,u.n)(this._up,this._up),this._markViewDirty())}_computeUpLocal(){(0,u.r)(M,this.eye,this.center),Math.abs(M[2])<=.9999&&((0,u.g)(M,M,M[2]),(0,u.s)(this._up,-M[0],-M[1],1-M[2]),(0,u.n)(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,e){"number"==typeof t[0]&&isFinite(t[0])&&"number"==typeof t[1]&&isFinite(t[1])&&"number"==typeof t[2]&&isFinite(t[2])?(0,u.k)(t,e)||((0,u.c)(e,t),this._markViewDirty()):T.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,f.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,o.n)(this._viewMatrix,this.eye,this._center,this._up),(0,u.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,u.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,u.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const b=(0,g.c)(),O=(0,h.c)(),M=(0,d.c)(),A=(0,d.c)(),x=(0,a.J$)();var P;!function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"}(P||(P={}))},94425:(t,e,i)=>{i.d(e,{S:()=>h,p:()=>o});var r=i(92026),s=i(71011),n=i(68401),a=i(68198);class o{constructor(t,e){this._material=t,this._repository=e,this._map=new Map}destroy(){this._map.forEach(((t,e)=>{(0,r.pC)(t)&&this._repository.release(this._material,h(e))}))}load(t,e){this._map.has(e)||this._map.set(e,this._repository.acquire(this._material,h(e)));const i=this._map.get(e);if((0,r.pC)(i)){if(i.ensureResources(t)===n.Rw.LOADED)return i;this._repository.requestRender()}return null}}function h(t){switch(t){case a.C.MATERIAL:return s.H.Color;case a.C.MATERIAL_ALPHA:return s.H.Alpha;case a.C.MATERIAL_DEPTH:return s.H.Depth;case a.C.MATERIAL_NORMAL:return s.H.Normal;case a.C.MATERIAL_DEPTH_SHADOWMAP_ALL:return s.H.Shadow;case a.C.MATERIAL_HIGHLIGHT:return s.H.Highlight;case a.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case a.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return s.H.Shadow}}},70619:(t,e,i)=>{i.d(e,{Z:()=>w});var r,s=i(11186),n=i(8229),a=i(71353),o=i(55652),h=i(40885),c=i(68401);!function(t){t.length=function(t,e){const i=t[e],r=t[e+1],s=t[e+2];return Math.sqrt(i*i+r*r+s*s)},t.normalize=function(t,e){const i=t[e],r=t[e+1],s=t[e+2],n=1/Math.sqrt(i*i+r*r+s*s);t[e]*=n,t[e+1]*=n,t[e+2]*=n},t.scale=function(t,e,i){t[e]*=i,t[e+1]*=i,t[e+2]*=i},t.add=function(t,e,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e;(s=s||t)[n]=t[e]+i[r],s[n+1]=t[e+1]+i[r+1],s[n+2]=t[e+2]+i[r+2]},t.subtract=function(t,e,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e;(s=s||t)[n]=t[e]-i[r],s[n+1]=t[e+1]-i[r+1],s[n+2]=t[e+2]-i[r+2]}}(r||(r={}));var l=i(74894),u=i(81955),d=i(97731),p=i(4760);const g=r;var f,_,m,y;!function(t){const e=.5,i=[[-e,-e,e],[e,-e,e],[e,e,e],[-e,e,e],[-e,-e,-e],[e,-e,-e],[e,e,-e],[-e,e,-e]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),a=new Uint16Array(36);for(let h=0;h<6;h++)for(let t=0;t<6;t++)a[6*h+t]=h;const o=new Uint16Array(36);for(let h=0;h<6;h++)o[6*h+0]=0,o[6*h+1]=1,o[6*h+2]=2,o[6*h+3]=2,o[6*h+4]=3,o[6*h+5]=0;t.createGeometry=function(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(24);for(let r=0;r<8;r++)e[3*r]=i[r][0]*t[0],e[3*r+1]=i[r][1]*t[1],e[3*r+2]=i[r][2]*t[2];return new l.Z([[p.T.POSITION,{size:3,data:e,exclusive:!0}],[p.T.NORMAL,{size:3,data:r}],[p.T.UV0,{size:2,data:s}]],[[p.T.POSITION,n],[p.T.NORMAL,a],[p.T.UV0,o]])}}(f||(f={})),function(t){const e=.5,i=[[-e,0,-e],[e,0,-e],[e,0,e],[-e,0,e],[0,-e,0],[0,e,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);t.createGeometry=function(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(18);for(let r=0;r<6;r++)e[3*r]=i[r][0]*t[0],e[3*r+1]=i[r][1]*t[1],e[3*r+2]=i[r][2]*t[2];return new l.Z([[p.T.POSITION,{size:3,data:e,exclusive:!0}],[p.T.NORMAL,{size:3,data:r}]],[[p.T.POSITION,s],[p.T.NORMAL,n]])}}(_||(_={})),function(t){const e=.5,i=(0,n.f)(-e,0,-e),r=(0,n.f)(e,0,-e),a=(0,n.f)(0,0,e),o=(0,n.f)(0,.5,0),h=(0,n.c)(),c=(0,n.c)(),u=(0,n.c)(),d=(0,n.c)(),g=(0,n.c)();(0,s.b)(h,i,o),(0,s.b)(c,i,r),(0,s.f)(u,h,c),(0,s.n)(u,u),(0,s.b)(h,r,o),(0,s.b)(c,r,a),(0,s.f)(d,h,c),(0,s.n)(d,d),(0,s.b)(h,a,o),(0,s.b)(c,a,i),(0,s.f)(g,h,c),(0,s.n)(g,g);const f=[i,r,a,o],_=[0,-1,0,u[0],u[1],u[2],d[0],d[1],d[2],g[0],g[1],g[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],y=[0,0,0,1,1,1,2,2,2,3,3,3];t.createGeometry=function(t){Array.isArray(t)||(t=[t,t,t]);const e=new Array(12);for(let i=0;i<4;i++)e[3*i]=f[i][0]*t[0],e[3*i+1]=f[i][1]*t[1],e[3*i+2]=f[i][2]*t[2];return new l.Z([[p.T.POSITION,{size:3,data:e,exclusive:!0}],[p.T.NORMAL,{size:3,data:_}]],[[p.T.POSITION,new Uint16Array(m)],[p.T.NORMAL,new Uint16Array(y)]])}}(m||(m={})),function(t){t.createBoxGeometry=f.createGeometry,t.createDiamondGeometry=_.createGeometry,t.createTetrahedronGeometry=m.createGeometry,t.createSphereGeometry=function(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{uv:!0};const s=-Math.PI,n=2*Math.PI,a=-Math.PI/2,o=Math.PI,h=Math.max(3,Math.floor(e)),c=Math.max(2,Math.floor(i)),u=(h+1)*(c+1),d=new Float32Array(3*u),g=new Float32Array(3*u),f=new Float32Array(2*u),_=[];let m=0;for(let l=0;l<=c;l++){const e=[],i=l/c,r=a+i*o,u=Math.cos(r);for(let a=0;a<=h;a++){const o=a/h,c=s+o*n,l=Math.cos(c)*u,p=Math.sin(r),_=-Math.sin(c)*u;d[3*m]=l*t,d[3*m+1]=p*t,d[3*m+2]=_*t,g[3*m]=l,g[3*m+1]=p,g[3*m+2]=_,f[2*m]=o,f[2*m+1]=i,e.push(m),++m}_.push(e)}const y=new Uint32Array(2*h*(c-1)*3);m=0;for(let l=0;l<c;l++)for(let t=0;t<h;t++){const e=_[l][t],i=_[l][t+1],r=_[l+1][t+1],s=_[l+1][t];0===l?(y[m++]=e,y[m++]=r,y[m++]=s):l===c-1?(y[m++]=e,y[m++]=i,y[m++]=r):(y[m++]=e,y[m++]=i,y[m++]=r,y[m++]=r,y[m++]=s,y[m++]=e)}const v=[[p.T.POSITION,y],[p.T.NORMAL,y]],T=[[p.T.POSITION,{size:3,data:d,exclusive:!0}],[p.T.NORMAL,{size:3,data:g,exclusive:!0}]];return r.uv&&(T.push([p.T.UV0,{size:2,data:f,exclusive:!0}]),v.push([p.T.UV0,y])),r.offset&&(v[0][0]=p.T.OFFSET,T[0][0]=p.T.OFFSET,v.push([p.T.POSITION,new Uint32Array(y.length)]),T.push([p.T.POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new l.Z(T,v)},t.createPolySphereGeometry=function(t,e,i){const r=t;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const t=r*(1+Math.sqrt(5))/2;s=[-r,t,0,r,t,0,-r,-t,0,r,-t,0,0,-r,t,0,r,t,0,-r,-t,0,r,-t,t,0,-r,t,0,r,-t,0,-r,-t,0,r],n=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let l=0;l<s.length;l+=3)g.scale(s,l,t/g.length(s,l));let a={};function o(e,i){e>i&&([e,i]=[i,e]);const r=e.toString()+"."+i.toString();if(a[r])return a[r];let n=s.length;return s.length+=3,g.add(s,3*e,s,3*i,s,n),g.scale(s,n,t/g.length(s,n)),n/=3,a[r]=n,n}for(let l=0;l<e;l++){const t=n.length,e=new Uint32Array(4*t);for(let i=0;i<t;i+=3){const t=n[i],r=n[i+1],s=n[i+2],a=o(t,r),h=o(r,s),c=o(s,t),l=4*i;e[l]=t,e[l+1]=a,e[l+2]=c,e[l+3]=r,e[l+4]=h,e[l+5]=a,e[l+6]=s,e[l+7]=c,e[l+8]=h,e[l+9]=a,e[l+10]=h,e[l+11]=c}n=e,a={}}const h=new Float32Array(s);for(let l=0;l<h.length;l+=3)g.normalize(h,l);const c=[[p.T.POSITION,n],[p.T.NORMAL,n]],u=[[p.T.POSITION,{size:3,data:new Float32Array(s),exclusive:!0}],[p.T.NORMAL,{size:3,data:h,exclusive:!0}]];return new l.Z(u,c)},t.createPointGeometry=function(t,e,i,r,s,n,a){const o=e?[e[0],e[1],e[2]]:[0,0,0],h=t?[t[0],t[1],t[2]]:[0,0,1];n=n||[0,0];const u=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],d=null!=r&&2===r.length?r:[1,1],g=[[p.T.POSITION,{size:3,data:o,exclusive:!0}],[p.T.NORMAL,{size:3,data:h,exclusive:!0}],[p.T.UV0,{size:n.length,data:n}],[p.T.COLOR,{size:4,data:u,exclusive:!0}],[p.T.SIZE,{size:2,data:d}]];if(null!=s){const t=new Float32Array([s[0],s[1],s[2],s[3]]);g.push([p.T.AUXPOS1,{size:4,data:t}])}if(null!=a){const t=new Float32Array([a[0],a[1],a[2],a[3]]);g.push([p.T.AUXPOS2,{size:4,data:t}])}return new l.Z(g,null,c.MX.Point)},t.updatePointGeometry=function(t,e,i,r,s,n,a,o){if(null!=t){const{data:e}=o.getMutableAttribute(p.T.NORMAL);e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=e){const{data:t}=o.getMutableAttribute(p.T.POSITION);t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=i){const{data:t}=o.getMutableAttribute(p.T.COLOR);t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3]}if(null!=r){const{data:t}=o.getMutableAttribute(p.T.SIZE);t[0]=r[0],t[1]=r[1]}if(null!=s){const{data:t}=o.getMutableAttribute(p.T.AUXPOS1);t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3]}if(null!=n){const{data:t}=o.getMutableAttribute(p.T.UV0);t[0]=n[0],t[1]=n[1]}if(null!=a){const{data:t}=o.getMutableAttribute(p.T.AUXPOS2);t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3]}},t.createPointArrayGeometry=function(t,e){const i=new Float32Array(3*t.length),r=new Float32Array(e?3*t.length:3),s=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let h=0;h<t.length;h++)i[3*h]=t[h][0],i[3*h+1]=t[h][1],i[3*h+2]=t[h][2],e&&(r[3*h]=e[h][0],r[3*h+1]=e[h][1],r[3*h+2]=e[h][2]),s[h]=h,n[h]=0;e||(r[0]=0,r[1]=1,r[2]=0);const a=[[p.T.POSITION,s],[p.T.NORMAL,e?s:n],[p.T.UV0,n]],o=[[p.T.POSITION,{size:3,data:i,exclusive:!0}],[p.T.NORMAL,{size:3,data:r,exclusive:!0}],[p.T.UV0,{size:2,data:[0,0],exclusive:!0}]];return new l.Z(o,a,c.MX.Point)},t.createTriangleGeometry=function(){const t=new Uint16Array([0,1,2]),e=new Uint16Array([0,0,0]),i=new Uint16Array([0,0,0]),r=[[p.T.POSITION,t],[p.T.NORMAL,e],[p.T.UV0,i]],s=[[p.T.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[p.T.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[p.T.UV0,{size:2,data:[0,0],exclusive:!0}]];return new l.Z(s,r)};const e=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function i(t,e,i,r,n){return!(Math.abs((0,s.e)(e,t))>n)&&((0,s.f)(i,t,e),(0,s.n)(i,i),(0,s.f)(r,i,t),(0,s.n)(r,r),!0)}function r(t,e,r,s,n,a,o){return i(t,e,n,a,o)||i(t,r,n,a,o)||i(t,s,n,a,o)}t.createSquareGeometry=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e;const i=new Array(12);for(let e=0;e<4;e++)for(let r=0;r<3;r++)i[3*e+r]=t[e][r];const r=new Uint32Array([0,1,2,2,3,0]),s=[0,0,1],n=new Uint32Array([0,0,0,0,0,0]),a=[0,0,1,0,1,1,0,1],o=[255,255,255,255],h=[[p.T.POSITION,r],[p.T.NORMAL,n],[p.T.UV0,r],[p.T.COLOR,n]],c=[[p.T.POSITION,{size:3,data:i,exclusive:!0}],[p.T.NORMAL,{size:3,data:s,exclusive:!0}],[p.T.UV0,{size:2,data:a,exclusive:!0}],[p.T.COLOR,{size:4,data:o,exclusive:!0}]];return new l.Z(c,h)},t.createConeGeometry=function(t,e,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=0;const h=e,c=t;let u=(0,n.f)(0,o,0),d=(0,n.f)(0,o+c,0),g=(0,n.f)(0,-1,0),f=(0,n.f)(0,1,0);r&&(o=c,d=(0,n.f)(0,0,0),u=(0,n.f)(0,o,0),g=(0,n.f)(0,1,0),f=(0,n.f)(0,-1,0));const _=[d,u],m=[g,f],y=i+2,v=Math.sqrt(c*c+h*h);if(r)for(let l=i-1;l>=0;l--){const t=l*(2*Math.PI/i),e=(0,n.f)(Math.cos(t)*h,o,Math.sin(t)*h);_.push(e);const r=(0,n.f)(c*Math.cos(t)/v,-h/v,c*Math.sin(t)/v);m.push(r)}else for(let l=0;l<i;l++){const t=l*(2*Math.PI/i),e=(0,n.f)(Math.cos(t)*h,o,Math.sin(t)*h);_.push(e);const r=(0,n.f)(c*Math.cos(t)/v,h/v,c*Math.sin(t)/v);m.push(r)}const T=new Uint32Array(2*(i+2)*3),w=new Uint32Array(2*(i+2)*3);let b=0,O=0;if(s){for(let t=3;t<_.length;t++)T[b++]=1,T[b++]=t-1,T[b++]=t,w[O++]=0,w[O++]=0,w[O++]=0;T[b++]=_.length-1,T[b++]=2,T[b++]=1,w[O++]=0,w[O++]=0,w[O++]=0}if(a){for(let t=3;t<_.length;t++)T[b++]=t,T[b++]=t-1,T[b++]=0,w[O++]=t,w[O++]=t-1,w[O++]=1;T[b++]=0,T[b++]=2,T[b++]=_.length-1,w[O++]=1,w[O++]=2,w[O++]=m.length-1}const M=new Float32Array(3*y);for(let n=0;n<y;n++)M[3*n]=_[n][0],M[3*n+1]=_[n][1],M[3*n+2]=_[n][2];const A=new Float32Array(3*y);for(let n=0;n<y;n++)A[3*n]=m[n][0],A[3*n+1]=m[n][1],A[3*n+2]=m[n][2];const x=[[p.T.POSITION,T],[p.T.NORMAL,w]],P=[[p.T.POSITION,{size:3,data:M,exclusive:!0}],[p.T.NORMAL,{size:3,data:A,exclusive:!0}]];return new l.Z(P,x)},t.createCylinderGeometry=function(t,e,i,r,a,o){const h=r?(0,n.a)(r):(0,n.f)(1,0,0),c=a?(0,n.a)(a):(0,n.f)(0,0,0);o=null==o||o;const u=(0,n.c)();(0,s.n)(u,h);const d=(0,n.c)();(0,s.g)(d,u,Math.abs(t));const g=(0,n.c)();(0,s.g)(g,d,-.5),(0,s.a)(g,g,c);const f=(0,n.f)(0,1,0);Math.abs(1-(0,s.e)(u,f))<.2&&(0,s.s)(f,0,0,1);const _=(0,n.c)();(0,s.f)(_,u,f),(0,s.n)(_,_),(0,s.f)(f,_,u);const m=2*i+(o?2:0),y=i+(o?2:0),v=new Float32Array(3*m),T=new Float32Array(3*y),w=new Float32Array(2*m),b=new Uint32Array(3*i*(o?4:2)),O=new Uint32Array(3*i*(o?4:2));o&&(v[3*(m-2)+0]=g[0],v[3*(m-2)+1]=g[1],v[3*(m-2)+2]=g[2],w[2*(m-2)]=0,w[2*(m-2)+1]=0,v[3*(m-1)+0]=v[3*(m-2)+0]+d[0],v[3*(m-1)+1]=v[3*(m-2)+1]+d[1],v[3*(m-1)+2]=v[3*(m-2)+2]+d[2],w[2*(m-1)]=1,w[2*(m-1)+1]=1,T[3*(y-2)+0]=-u[0],T[3*(y-2)+1]=-u[1],T[3*(y-2)+2]=-u[2],T[3*(y-1)+0]=u[0],T[3*(y-1)+1]=u[1],T[3*(y-1)+2]=u[2]);const M=(t,e,i)=>{b[t]=e,O[t]=i};let A=0;const x=(0,n.c)(),P=(0,n.c)();for(let n=0;n<i;n++){const t=n*(2*Math.PI/i);(0,s.g)(x,f,Math.sin(t)),(0,s.g)(P,_,Math.cos(t)),(0,s.a)(x,x,P),T[3*n+0]=x[0],T[3*n+1]=x[1],T[3*n+2]=x[2],(0,s.g)(x,x,e),(0,s.a)(x,x,g),v[3*n+0]=x[0],v[3*n+1]=x[1],v[3*n+2]=x[2],w[2*n+0]=n/i,w[2*n+1]=0,v[3*(n+i)+0]=v[3*n+0]+d[0],v[3*(n+i)+1]=v[3*n+1]+d[1],v[3*(n+i)+2]=v[3*n+2]+d[2],w[2*(n+i)+0]=n/i,w[2*n+1]=1;const r=(n+1)%i;M(A++,n,n),M(A++,n+i,n),M(A++,r,r),M(A++,r,r),M(A++,n+i,n),M(A++,r+i,r)}if(o){for(let t=0;t<i;t++){const e=(t+1)%i;M(A++,m-2,y-2),M(A++,t,y-2),M(A++,e,y-2)}for(let t=0;t<i;t++){const e=(t+1)%i;M(A++,t+i,y-1),M(A++,m-1,y-1),M(A++,e+i,y-1)}}const R=[[p.T.POSITION,b],[p.T.NORMAL,O],[p.T.UV0,b]],I=[[p.T.POSITION,{size:3,data:v,exclusive:!0}],[p.T.NORMAL,{size:3,data:T,exclusive:!0}],[p.T.UV0,{size:2,data:w,exclusive:!0}]];return new l.Z(I,R)},t.createTubeGeometry=function(e,i,r,s,n){r=r||10,s=null==s||s,(0,d.hu)(e.length>1);const a=[],o=[];for(let t=0;t<r;t++){a.push([0,-t-1,-(t+1)%r-1]);const e=t/r*2*Math.PI;o.push([Math.cos(e)*i,Math.sin(e)*i])}return t.createPathExtrusionGeometry(o,e,[[0,0,0]],a,s,n)},t.createPathExtrusionGeometry=function(t,e,i,c,u){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,n.f)(0,0,0);const g=t.length,f=new Float32Array(e.length*g*3+(6*i.length||0)),_=new Float32Array(e.length*g*3+(i?6:0)),m=(e.length-1)*g*6+3*c.length*2,y=new Uint32Array(m),T=new Uint32Array(m);let w=0,b=0,O=0,M=0;const A=(0,n.c)(),x=(0,n.c)(),P=(0,n.c)(),R=(0,n.c)(),I=(0,n.c)(),S=(0,n.c)(),D=(0,n.c)(),L=(0,a.c)(),j=(0,n.c)(),C=(0,n.c)(),N=(0,n.c)(),U=(0,n.c)(),E=(0,n.c)(),V=(0,o.Ue)();(0,s.s)(j,0,1,0),(0,s.b)(x,e[1],e[0]),(0,s.n)(x,x),u?((0,s.a)(L,e[0],d),(0,s.n)(P,L)):(0,s.s)(P,0,0,1),r(x,P,j,j,I,P,v),(0,s.c)(R,P),(0,s.c)(U,I);for(let r=0;r<i.length;r++)(0,s.g)(S,I,i[r][0]),(0,s.g)(L,P,i[r][2]),(0,s.a)(S,S,L),(0,s.a)(S,S,e[0]),f[w++]=S[0],f[w++]=S[1],f[w++]=S[2];_[b++]=-x[0],_[b++]=-x[1],_[b++]=-x[2];for(let r=0;r<c.length;r++)y[O++]=c[r][0]>0?c[r][0]:-c[r][0]-1+i.length,y[O++]=c[r][1]>0?c[r][1]:-c[r][1]-1+i.length,y[O++]=c[r][2]>0?c[r][2]:-c[r][2]-1+i.length,T[M++]=0,T[M++]=0,T[M++]=0;let F=i.length;const H=i.length-1;for(let n=0;n<e.length;n++){let i=!1;n>0&&((0,s.c)(A,x),n<e.length-1?((0,s.b)(x,e[n+1],e[n]),(0,s.n)(x,x)):i=!0,(0,s.a)(C,A,x),(0,s.n)(C,C),(0,s.a)(N,e[n-1],R),(0,o.Yq)(e[n],C,V),(0,o.BR)(V,(0,h.re)(N,A),L)?((0,s.b)(L,L,e[n]),(0,s.n)(P,L),(0,s.f)(I,C,P),(0,s.n)(I,I)):r(C,R,U,j,I,P,v),(0,s.c)(R,P),(0,s.c)(U,I)),u&&((0,s.a)(L,e[n],d),(0,s.n)(E,L));for(let r=0;r<g;r++)if((0,s.g)(S,I,t[r][0]),(0,s.g)(L,P,t[r][1]),(0,s.a)(S,S,L),(0,s.n)(D,S),_[b++]=D[0],_[b++]=D[1],_[b++]=D[2],(0,s.a)(S,S,e[n]),f[w++]=S[0],f[w++]=S[1],f[w++]=S[2],!i){const t=(r+1)%g;y[O++]=F+r,y[O++]=F+g+r,y[O++]=F+t,y[O++]=F+t,y[O++]=F+g+r,y[O++]=F+g+t;for(let e=0;e<6;e++)T[M++]=y[O-6+e]-H}F+=g}const z=e[e.length-1];for(let r=0;r<i.length;r++)(0,s.g)(S,I,i[r][0]),(0,s.g)(L,P,i[r][1]),(0,s.a)(S,S,L),(0,s.a)(S,S,z),f[w++]=S[0],f[w++]=S[1],f[w++]=S[2];const G=b/3;_[b++]=x[0],_[b++]=x[1],_[b++]=x[2];const B=F-g;for(let r=0;r<c.length;r++)y[O++]=c[r][0]>=0?F+c[r][0]:-c[r][0]-1+B,y[O++]=c[r][2]>=0?F+c[r][2]:-c[r][2]-1+B,y[O++]=c[r][1]>=0?F+c[r][1]:-c[r][1]-1+B,T[M++]=G,T[M++]=G,T[M++]=G;const W=[[p.T.POSITION,y],[p.T.NORMAL,T]],Z=[[p.T.POSITION,{size:3,data:f,exclusive:!0}],[p.T.NORMAL,{size:3,data:_,exclusive:!0}]];return new l.Z(Z,W)},t.createPolylineGeometry=function(t,e,i){(0,d.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,d.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,d.hu)(null==e||e.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,d.hu)(null==e||3===e[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*t.length),s=new Uint32Array(2*(t.length-1));let n=0,a=0;for(let c=0;c<t.length;c++){for(let e=0;e<3;e++)r[n++]=t[c][e];c>0&&(s[a++]=c-1,s[a++]=c)}const o=[],h=[];if(o.push([p.T.POSITION,s]),h.push([p.T.POSITION,{size:3,data:r,exclusive:!0}]),e){const i=new Float32Array(3*e.length);let r=0;for(let s=0;s<t.length;s++)for(let t=0;t<3;t++)i[r++]=e[s][t];o.push([p.T.NORMAL,s]),h.push([p.T.NORMAL,{size:3,data:i,exclusive:!0}])}return i&&(h.push([p.T.COLOR,{size:4,data:i}]),o.push([p.T.COLOR,(0,u.p)(i.length/4)])),new l.Z(h,o,c.MX.Line)},t.createExtrudedTriangle=function(t,e,i,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const n=new Array(18),a=[[-e,s,r/2],[i,s,r/2],[0,t+s,r/2],[-e,s,-r/2],[i,s,-r/2],[0,t+s,-r/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let h=0;h<6;h++)n[3*h]=a[h][0],n[3*h+1]=a[h][1],n[3*h+2]=a[h][2];return new l.Z([[p.T.POSITION,{size:3,data:n,exclusive:!0}]],[[p.T.POSITION,o]])},t.transformInPlace=function(t,e){const i=t.getMutableAttribute(p.T.POSITION).data;for(let r=0;r<i.length;r+=3){const t=i[r],n=i[r+1],a=i[r+2];(0,s.s)(T,t,n,a),(0,s.m)(T,T,e),i[r]=T[0],i[r+1]=T[1],i[r+2]=T[2]}},t.cgToGIS=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;const i=t.vertexAttributes,r=i.get(p.T.POSITION).data,s=i.get(p.T.NORMAL).data;if(s){const t=e.getMutableAttribute(p.T.NORMAL).data;for(let e=0;e<s.length;e+=3){const i=s[e+1];t[e+1]=-s[e+2],t[e+2]=i}}if(r){const t=e.getMutableAttribute(p.T.POSITION).data;for(let e=0;e<r.length;e+=3){const i=r[e+1];t[e+1]=-r[e+2],t[e+2]=i}}return e},t.makeOrthoBasisDirUp=i,t.makeOrthoBasisDirUpFallback=r}(y||(y={}));const v=.99619469809,T=(0,n.c)(),w=y},81268:(t,e,i)=>{i.d(e,{Z8:()=>y,LP:()=>b});var r=i(92026),s=i(14226),n=i(81949),a=i(11186),o=i(71353),h=i(90045),c=i(67077),l=i(40885),u=i(50951),d=i(54463);i(82218);function p(t){return(0,r.pC)(t)&&(0,r.pC)(t.dist)}(0,o.c)();var g=i(76783),f=i(32683);const _=1e-5;class m{constructor(t){this.options=new d.om,this._results=new v,this.transform=new g.yn,this.tolerance=_,this.verticalOffset=null,this._ray=(0,l.Ue)(),this._rayEnd=(0,o.c)(),this._rayBeginTransformed=(0,o.c)(),this._rayEndTransformed=(0,o.c)(),this.viewingMode=null==t?u.JY.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,e,i){this.resetWithRay((0,l.zk)(t,e,this._ray),i)}resetWithRay(t,e){this.camera=e,t!==this._ray&&(0,l.JG)(t,this._ray),0!==this.options.verticalOffset?this.viewingMode===u.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,a.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.point=e,this.filterPredicate=s,this.tolerance=null==i?_:i;const a=(0,g.W9)(this.verticalOffset);if((0,r.pC)(t)&&t.length>0){const e=n?t=>{n(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};for(const i of t){const t=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();(0,r.pC)(t)?((0,r.pC)(a)?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,e,a):t.forEachAlongRay(this._ray.origin,this._ray.direction,e),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(e)):i.objects.forAll((t=>e(t)))}}this.sortResults()}intersectObject(t){const e=t.geometryRecords;if(!e)return;const i=t.transformation,s=(0,g.W9)(this.verticalOffset);for(const o of e){const{geometry:e,material:h,instanceParameters:c}=o;if((0,f.PD)(c))continue;const l=e.id;this.transform.setAndInvalidateLazyTransforms(i,o.getShaderTransformation()),(0,a.m)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,a.m)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const u=this.transform.transform;(0,r.pC)(s)&&(s.objectTransform=this.transform),h.intersect(e,c,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((e,i,s,a,o,h)=>{if(e>=0){if((0,r.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,e))return;const c=a?this._results.hud:this._results,p=a?a=>{const c={object:t,geometryId:l,triangleNr:s,center:(0,r.pC)(h)?[h[0],h[1],h[2]]:null};a.set(d.q7.HUD,c,e,i,n.I,o)}:r=>r.set(d.q7.OBJECT,{object:t,geometryId:l,triangleNr:s},e,i,u,o);if((null==c.min.drapedLayerOrder||o>=c.min.drapedLayerOrder)&&(null==c.min.dist||e<c.min.dist)&&p(c.min),this.options.store!==d.eC.MIN&&(null==c.max.drapedLayerOrder||o<c.max.drapedLayerOrder)&&(null==c.max.dist||e>c.max.dist)&&p(c.max),this.options.store===d.eC.ALL)if(a){const t=new w(this._ray);p(t),this._results.hud.all.push(t)}else{const t=new T(this._ray);p(t),this._results.all.push(t)}}}),o.shaderTransformation)}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort(((t,e)=>t.dist!==e.dist?(0,r.Pt)(t.dist,0)-(0,r.Pt)(e.dist,0):t.drapedLayerOrder!==e.drapedLayerOrder?(0,r.Pt)(t.drapedLayerOrder,Number.MAX_VALUE)-(0,r.Pt)(e.drapedLayerOrder,Number.MAX_VALUE):(0,r.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,r.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)))}}function y(t){return new m(t)}class v{constructor(){this.min=new T((0,l.Ue)()),this.max=new T((0,l.Ue)()),this.hud={min:new w((0,l.Ue)()),max:new w((0,l.Ue)()),all:new Array},this.ground=new T((0,l.Ue)()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class T{constructor(t){this.intersector=d.q7.OBJECT,this.normal=(0,o.c)(),this.transformation=(0,n.c)(),this._ray=(0,l.Ue)(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return(0,r.pC)(this.dist)?((0,a.g)(O,this.ray.direction,this.dist),(0,a.l)(O)):null}getIntersectionPoint(t){return!!p(this)&&((0,a.g)(O,this.ray.direction,this.dist),(0,a.a)(t,this.ray.origin,O),!0)}getTransformedNormal(t){return(0,a.c)(M,this.normal),M[3]=0,(0,h.t)(M,M,this.transformation),(0,a.c)(t,M),(0,a.n)(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=d.q7.OBJECT,(0,l.JG)(t,this._ray)}set(t,e,i,h,c,l,u){this.intersector=t,this.dist=i,(0,a.c)(this.normal,(0,r.Pt)(h,o.U)),(0,s.c)(this.transformation,(0,r.Pt)(c,n.I)),this.target=e,this.drapedLayerOrder=l,this.drapedLayerGraphicOrder=u}copy(t){(0,l.JG)(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,(0,a.c)(this.normal,t.normal),(0,s.c)(this.transformation,t.transformation)}}class w extends T{constructor(){super(...arguments),this.intersector=d.q7.HUD}}function b(t){return new T(t)}const O=(0,o.c)(),M=(0,c.c)()},54463:(t,e,i)=>{var r,s;i.d(e,{eC:()=>s,om:()=>n,q7:()=>r}),function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"}(r||(r={}));class n{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=s.ALL}}!function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"}(s||(s={}))},59887:(t,e,i)=>{i.d(e,{T:()=>v});var r=i(92026),s=i(14226),n=i(81949),a=i(11186),o=i(71353),h=i(23470),c=i(80064),l=i(68401),u=i(1395),d=i(79100),p=i(13005),g=i(95439);class f{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,e,i,r,s,n){this.id=(0,g.D)(),this.geometry=t,this.material=e,this.transformation=i,this.instanceParameters=r,this.origin=s,this._shaderTransformation=n,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return(0,r.pC)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&((0,a.m)(t,t,this.getStaticTransformation()),!0)}}f.pool=new p.Z(f);var _=i(47669),m=i(97731),y=i(32683);class v extends u.c{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=d.U.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=(0,n.c)(),this._bvObjectSpace=new w,this._bvWorldSpace=new w,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new T),this.transformation=(0,n.c)();const{geometries:e,materials:i,transformations:r,origins:s}=t;if(Array.isArray(e)){(0,m.hu)(i.length===e.length,"Object3D: materials don't match geometries"),(0,m.hu)(r.length===e.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=e.length,this._geometries.length=e.length;for(let t=0;t<e.length;t++)this._geometries[t]=e[t],this._geometryRecords[t]=f.pool.acquire(e[t],i[t],(0,n.b)(r[t]),{highlights:null,occludees:null,visible:this._visible},s&&s[t])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){(0,s.c)(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){(0,m.hu)(null==this._parentLayer||null==t,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,e,i,s,a){i=i||n.I,this._geometries.push(t);const o=f.pool.acquire(t,e,i,{highlights:null,occludees:null,visible:this._visible},s,a);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||(0,r.pC)(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const e=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=(0,r.pC)(e.shaderTransformation)?this._geometryRecords.some((t=>(0,r.pC)(t.shaderTransformation))):this._hasVolatileTransformation,e.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:e}),this._invalidateBoundingVolume(),e}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const t of this._geometryRecords)t.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new _.O(l.V_.MaskOccludee);for(const e of this._geometryRecords)e.instanceParameters.occludees=(0,y.lr)(e.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const e of this._geometryRecords)e.instanceParameters.occludees=(0,y.U_)(e.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new _.O(l.V_.Highlight);for(const e of this._geometryRecords)e.instanceParameters.highlights=(0,y.lr)(e.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const e of this._geometryRecords)e.instanceParameters.highlights=(0,y.U_)(e.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,e){return(0,s.m)((0,r.Pt)(e,(0,n.c)()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,e){return e=e||(0,n.c)(),(0,s.m)(e,this.transformation,t.getShaderTransformation()),e}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const t=this._geometries[s],e=this._geometryRecords[s],i=t.boundingInfo;(0,r.pC)(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,e.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this._getCombinedShaderTransformation(e)))}(0,a.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,a.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=(0,o.c)(),e=(0,o.c)(),i=(0,c.u1)(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if((0,r.Wi)(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),h=(0,c.u1)(o);(0,a.m)(t,n.getCenter(),o);const l=(0,a.i)(t,this._bvObjectSpace.bounds),u=n.getBSRadius()*h;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+u),(0,a.m)(e,t,this.transformation);const d=(0,a.i)(e,this._bvWorldSpace.bounds),p=u*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,e,i){const r=t.getBBMin(),s=t.getBBMax(),n=(0,o.a)(r),h=(0,o.a)(s);(0,a.m)(n,n,i),(0,a.m)(h,h,i);for(let a=0;a<3;++a)e.min[a]=Math.min(e.min[a],n[a],h[a]),e.max[a]=Math.max(e.max[a],n[a],h[a]);for(let o=0;o<3;++o){(0,a.c)(n,r),(0,a.c)(h,s),n[o]=s[o],h[o]=r[o],(0,a.m)(n,n,i),(0,a.m)(h,h,i);for(let t=0;t<3;++t)e.min[t]=Math.min(e.min[t],n[t],h[t]),e.max[t]=Math.max(e.max[t],n[t],h[t])}}_invalidateBoundingVolume(){this._bvDirty=!0,(0,r.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,e){(0,r.pC)(this._parentLayer)&&this._parentLayer.events.emit(t,e)}get test(){const t=this;return{hasGeometry:e=>t._geometries.includes(e),getGeometryIndex:e=>t._geometries.indexOf(e)}}}class T{constructor(){this.min=(0,o.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,o.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class w extends T{constructor(){super(...arguments),this.bounds=(0,h.c)()}init(){(0,a.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,a.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,h.a)(this.bounds)}}},47669:(t,e,i)=>{i.d(e,{O:()=>s});var r=i(95439);class s{constructor(t){this.channel=t,this.id=(0,r.D)()}}},97882:(t,e,i)=>{i.d(e,{F:()=>d});var r=i(91505),s=i(100),n=i(92026),a=i(27546),o=i(68401),h=i(1395),c=i(79100);const l=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var u=i(78329);class d extends h.c{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";super(),this.apiLayerUid=e,this.type=c.U.Layer,this.events=new r.Z,this.isSliceable=!1,this._objects=new a.Z,this._stageHandles=new s.Z,this.apiLayerUid=e,this.isVisible=t?.isVisible??!0,this.isPickable=t?.isPickable??!0,this.updatePolicy=t?.updatePolicy??o.jq.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const e of l)this._stageHandles.add(this.events.on(e,(i=>t.handleEvent(e,i))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),(0,n.pC)(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),(0,n.pC)(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const e of t)e.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),(0,n.pC)(this._octree)&&this._octree.add(t)}removeMany(t){const e=new Array;if(this._objects.removeUnorderedMany(t,t.length,e),0!==e.length){for(const t of e)t.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:e}),(0,n.pC)(this._octree)&&this._octree.remove(e)}}sync(){(0,n.pC)(this._stage)&&this.updatePolicy!==o.jq.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,e){(0,n.pC)(this._octree)&&this._octree.update(t,e)}getSpatialQueryAccelerator(){return(0,n.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=(0,n.SC)(this._octree)}_createOctree(){this._octree=new u.Z((t=>t.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}},66832:(t,e,i)=>{i.d(e,{E:()=>x});var r=i(67077),s=i(71011),n=i(68401),a=i(23620),o=i(94425),h=i(56529),c=i(78041),l=i(93822),u=i(64226),d=i(22909),p=i(82144),g=i(31132),f=i(7566),_=i(27627),m=i(50411),y=i(45028),v=i(36207);class T extends g.A{initializeProgram(t){const e=T.shader.get().build(this.configuration);return new _.$(t.rctx,e,f.i)}_createPipeline(t,e){const i=this.configuration,r=t===n.Am.NONE,a=t===n.Am.FrontFace;return(0,v.sm)({blending:i.output!==s.H.Color&&i.output!==s.H.Alpha||!i.transparent?null:r?c.wu:(0,c.j7)(t),culling:(0,v.zp)(i.cullFace),depthTest:{func:(0,c.Bh)(t)},depthWrite:r||a?i.writeDepth&&v.LZ:null,colorWrite:v.BK,stencilWrite:i.hasOccludees?m.s3:null,stencilTest:i.hasOccludees?e?m.eD:m.RY:null,polygonOffset:r||a?i.polygonOffset&&w:(0,c.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,e){return e?this._occludeePipelineState:super.getPipelineState(t,e)}}T.shader=new p.J(y.C,(()=>i.e(3173).then(i.bind(i,23173))));const w={factor:1,units:1};var b=i(27366),O=i(33559),M=i(8883);class A extends M.W{constructor(){super(...arguments),this.output=s.H.Color,this.cullFace=n.Vr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=n.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,b._)([(0,O.o)({count:s.H.COUNT})],A.prototype,"output",void 0),(0,b._)([(0,O.o)({count:n.Vr.COUNT})],A.prototype,"cullFace",void 0),(0,b._)([(0,O.o)()],A.prototype,"hasSlicePlane",void 0),(0,b._)([(0,O.o)()],A.prototype,"hasVertexColors",void 0),(0,b._)([(0,O.o)()],A.prototype,"transparent",void 0),(0,b._)([(0,O.o)()],A.prototype,"polygonOffset",void 0),(0,b._)([(0,O.o)()],A.prototype,"enableOffset",void 0),(0,b._)([(0,O.o)()],A.prototype,"writeDepth",void 0),(0,b._)([(0,O.o)()],A.prototype,"hasOccludees",void 0),(0,b._)([(0,O.o)({count:n.Am.COUNT})],A.prototype,"transparencyPassType",void 0),(0,b._)([(0,O.o)()],A.prototype,"hasMultipassTerrain",void 0),(0,b._)([(0,O.o)()],A.prototype,"cullAboveGround",void 0);class x extends h.F5{constructor(t){super(t,new R),this.supportsEdges=!0,this._configuration=new A}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<c.ve,this._configuration.hasMultipassTerrain=e.multipassTerrain.enabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration}intersect(t,e,i,r,s,n,a){(0,d.Bw)(t,e,r,s,n,void 0,a)}requiresSlot(t,e){return t===l.r.DRAPED_MATERIAL||((0,o.S)(e)===s.H.Highlight?t===l.r.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?l.r.TRANSPARENT_MATERIAL:l.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:l.r.OPAQUE_MATERIAL))}createGLMaterial(t){return t.output===s.H.Color||t.output===s.H.Alpha||t.output===s.H.Highlight||t.output===s.H.Depth&&this.parameters.writeLinearDepth?new P(t):null}createBufferWriter(){return new u.G_(u.IM)}}class P extends a.Z{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==s.H.Color&&this._output!==s.H.Alpha||this._updateOccludeeState(t),this.ensureTechnique(T,t)}}class R extends h.Mt{constructor(){super(...arguments),this.color=r.Z,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=n.Vr.None,this.hasOccludees=!1}}},64226:(t,e,i)=>{i.d(e,{G_:()=>c,IM:()=>h,W1:()=>o,wp:()=>a});var r=i(55158),s=i(4760),n=i(33236);const a=(0,r.U$)().vec3f(s.T.POSITION),o=(0,r.U$)().vec3f(s.T.POSITION).vec2f(s.T.UV0),h=(0,r.U$)().vec3f(s.T.POSITION).vec4u8(s.T.COLOR);class c{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(s.T.POSITION).length}write(t,e,i,r){(0,n.NK)(e,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,i,r)}}}}]);
//# sourceMappingURL=4567.aaf579fb.chunk.js.map