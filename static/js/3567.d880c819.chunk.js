"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[3567],{32500:(e,t,i)=>{i.d(t,{I:()=>b,b:()=>v});var a=i(92026),s=i(6394),r=i(71011),n=i(33280),o=i(94951),l=i(15226),h=i(26461),c=i(116),p=i(82552),d=i(82999),u=i(58406),g=i(98634),_=i(64201),m=i(19253),y=i(68401),f=i(4760);function v(e){const t=new _.kG;(0,p.S)(t,e),t.include(o.w),t.attributes.add(f.T.POSITION,"vec3"),t.attributes.add(f.T.UV0,"vec2"),t.varyings.add("vpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float");const{vertex:i,fragment:v}=t;return i.uniforms.add(new d.A("textureCoordinateScaleFactor",(e=>(0,a.pC)(e.texture)&&(0,a.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:s.O))),i.code.add(g.H`
    void main(void) {
      vpos = position;
      ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(n.f5,e),t.include(l.l,e),v.uniforms.add([new m.A("tex",(e=>e.texture)),new u.p("opacity",(e=>e.opacity))]),t.varyings.add("vTexCoord","vec2"),e.output===r.H.Alpha?v.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${g.H.float(h.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(v.include(c.Y),v.code.add(g.H`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${g.H.float(h.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.transparencyPassType===y.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const b=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},11316:(e,t,i)=>{i.d(t,{S:()=>c,b:()=>h});var a=i(82552),s=i(95276),r=i(58406),n=i(98634),o=i(64201),l=i(4760);function h(e){const t=new o.kG;return t.extensions.add("GL_OES_standard_derivatives"),(0,a.S)(t,e),t.attributes.add(l.T.POSITION,"vec3"),t.attributes.add(l.T.UV0,"vec2"),t.varyings.add("vUV","vec2"),t.vertex.code.add(n.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),t.fragment.uniforms.add([new s.N("backgroundColor",(e=>e.backgroundColor)),new s.N("gridColor",(e=>e.gridColor)),new r.p("gridWidth",(e=>e.gridWidth))]),t.fragment.code.add(n.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),t}const c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}))},151:(e,t,i)=>{function a(){return new Float32Array(4)}function s(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,a){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=a,s}function n(){return a()}function o(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function h(){return r(0,1,0,0)}function c(){return r(0,0,1,0)}function p(){return r(0,0,0,1)}i.d(t,{a:()=>s,f:()=>r});const d=n(),u=o(),g=l(),_=h(),m=c(),y=p();Object.freeze(Object.defineProperty({__proto__:null,create:a,clone:s,fromValues:r,createView:function(e,t){return new Float32Array(e,t,4)},zeros:n,ones:o,unitX:l,unitY:h,unitZ:c,unitW:p,ZEROS:d,ONES:u,UNIT_X:g,UNIT_Y:_,UNIT_Z:m,UNIT_W:y},Symbol.toStringTag,{value:"Module"}))},66576:(e,t,i)=>{i.d(t,{B:()=>m});var a=i(92026),s=i(80292),r=i(35995),n=i(71907),o=i(33397),l=i(25265),h=i(49861);function c(e){return p[function(e){return e instanceof Blob?e.type:function(e){const t=(0,r.Ml)(e);return g[t]||d}(e.url)}(e)]||u}const p={},d="text/plain",u=p[d],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const b in g)p[g[b]]=b;var _=i(53283);function m(e){const t=(0,a.pC)(e)&&e.origins?e.origins:[void 0];return(i,n)=>{const p=function(e,t,i){if((0,a.pC)(e)&&"resource"===e.type)return function(e,t,i){const n=(0,o.VZ)(t,i);return{type:String,read:(e,t,i)=>{const a=(0,_.r)(e,t,i);return n.type===String?a:"function"==typeof n.type?new n.type({url:a}):void 0},write:{writer(t,o,h,p){if(!p||!p.resources)return"string"==typeof t?void(o[h]=(0,_.t)(t,p)):void(o[h]=t.write({},p));const d=function(e){return(0,a.Wi)(e)?null:"string"==typeof e?e:e.url}(t),u=d?(0,_.t)(d,{...p,verifyItemRelativeUrls:p&&p.verifyItemRelativeUrls?{writtenUrls:p.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},_.M.NO):null,g=n.type!==String&&(!(0,s.l)(this)||p&&p.origin&&this.originIdOf(i)>(0,l.M9)(p.origin));p&&p.portalItem&&(0,a.pC)(u)&&!(0,r.YP)(u)?g?function(e,t,i,a,s,n,o,l){const h=o.portalItem.resourceFromPath(a),p=v(i,a,o);c(p)===(0,r.Ml)(h.path)?(f(e,t,h,p,o.resources.toUpdate),s[n]=a):y(e,t,i,a,s,n,o,l)}(this,i,t,u,o,h,p,e):function(e,t,i,a){a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(e)}),t[i]=e}(u,o,h,p):p&&p.portalItem&&((0,a.Wi)(u)||(0,a.pC)((0,_.i)(u))||(0,r.jc)(u)||g)?y(this,i,t,u,o,h,p,e):o[h]=u}}}}(e,t,i);switch((0,a.pC)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=_.p;return{read:e,write:t}}}}(e,i,n);for(const e of t){const t=(0,h.CJ)(i,e,n);for(const e in p)t[e]=p[e]}}}function y(e,t,s,o,l,h,p,d){const u=(0,n.D)(),g=v(s,o,p),_=(0,r.v_)((0,a.U2)(d,"prefix"),u),m=`${_}.${c(g)}`,y=p.portalItem.resourceFromPath(m);(0,r.jc)(o)&&p.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(i,76200))).default,{data:a}=await t(e,{responseType:"blob"});return a}(o).then((e=>{y.path=`${_}.${c(e)}`,l[h]=y.itemRelativeUrl})).catch((()=>{}))),f(e,t,y,g,p.resources.toAdd),l[h]=y.itemRelativeUrl}function f(e,t,i,a,s){s.push({resource:i,content:a,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function v(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},80292:(e,t,i)=>{function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:()=>a})},45238:(e,t,i)=>{i.d(t,{EU:()=>p,Ue:()=>o,WH:()=>d,ZZ:()=>c,qC:()=>h,uT:()=>l});var a=i(16889),s=i(48976),r=i(98131),n=i(11186);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g;return[e[0],e[1],e[2],e[3]]}function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();return(0,n.c)(i,e),i[3]=t,i}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();return(0,s.s)(_,e,d(e)),(0,s.s)(m,t,d(t)),(0,s.m)(_,m,_),u(i,(0,a.BV)((0,s.g)(i,_)))}function c(e){return e}function p(e){return e[3]}function d(e){return(0,a.Vl)(e[3])}function u(e,t){return e[3]=t,e}const g=[0,0,1,0],_=(0,r.a)(),m=(0,r.a)();o()},96669:(e,t,i)=>{function a(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function s(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let a=0;a<e.length;a++){const s=e[a].size;"number"==typeof s&&(t+=s,i++)}return t/i}(e.stops):t}function r(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:a}=t;return(s(i,e)+s(a,e))/2}));let a=0;const r=i.length;if(0===r)return e;for(let s=0;s<r;s++)a+=i[s];const n=Math.floor(a/r);return Math.max(n,e)}function n(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const s="visualVariables"in t?r(i,t.visualVariables):i;if("simple"===t.type)return a(s,t.symbol);if("unique-value"===t.type){let e=s;return t.uniqueValueInfos.forEach((t=>{e=a(e,t.symbol)})),e}if("class-breaks"===t.type){let e=s;return t.classBreakInfos.forEach((t=>{e=a(e,t.symbol)})),e}return"dot-density"===t.type||t.type,s}i.d(t,{k:()=>n})},73567:(e,t,i)=>{i.r(t),i.d(t,{DrawGraphicTool3D:()=>Wt,ExtentTransformTool:()=>tr,GraphicMoveTool:()=>Hi,GraphicReshapeTool:()=>pa,GraphicTransformTool:()=>Da});var a=i(27366),s=i(42537),r=i(92026),n=i(94172),o=i(49861),l=(i(63780),i(93169)),h=i(25243),c=i(69912),p=i(74509),d=i(64575),u=i(17842),g=i(32718),_=(i(75366),i(71353)),m=i(85015),y=i(66978),f=i(58935),v=i(68860),b=i(88396),M=i(6394),S=i(11186),x=i(69662),C=i(41201);i(42877);let w=e=>({vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}),O=(e,t,i)=>{for(let a=0,s=t.length;a<s;a++){let s=t[a];Array.isArray(s)?O(e,s,i):null!=s&&!1!==s&&("string"==typeof s&&(s=w(s)),i.push(s))}};i(88367);const E={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let A=class extends m.Z{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this._backgroundColor="rgba(0, 0, 0, 0.6)",this._textColor="white",this._textShadowColor=[0,0,0],this._textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadow(){const[e,t,i]=this._textColor;return`0 0 ${this._textShadowSize}px rgb(${e}, ${t}, ${i})`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}render(){return function(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,s;return i&&1===i.length&&"string"==typeof i[0]?a=i[0]:i&&(s=[],O(e,i,s),0===s.length&&(s=void 0)),{vnodeSelector:e,properties:t,children:s,text:""===a?void 0:a,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this._backgroundColor,color:this._textColor,padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const i=this._padding,a=this._borderRadius,s=e.measureText(this.text).width,r=this.fontSize,n=T[this.anchor];e.textAlign="center",e.textBaseline="middle";const o=s+2*i,l=r+2*i,h=this.x+n.x*o,c=this.y+n.y*l;this._roundedRect(e,h,c,o,l,a),e.fillStyle=this._backgroundColor,e.fill();const p=this.x+(n.x+.5)*o,d=this.y+(n.y+.5)*l;this._renderTextShadow(e,this.text,p,d),e.fillStyle=this._textColor,e.fillText(this.text,p,d)}_renderTextShadow(e,t,i,a){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor[0]}, ${this._textShadowColor[1]}, ${this._textShadowColor[2]}, ${1/R.length})`;const s=this._textShadowSize;for(const[r,n]of R)e.fillText(t,i+s*r,a+s*n)}_roundedRect(e,t,i,a,s,r){e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+a-r,i),e.arcTo(t+a,i,t+a,i+r,r),e.lineTo(t+a,i+s-r),e.arcTo(t+a,i+s,t+a-r,i+s,r),e.lineTo(t+r,i+s),e.arcTo(t,i+s,t,i+s-r,r),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in E)e[E[t]]=this.anchor===t;return e}};(0,a._)([(0,o.Cb)()],A.prototype,"x",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"y",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"position",null),(0,a._)([(0,o.Cb)()],A.prototype,"text",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"fontSize",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"anchor",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"visible",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"_backgroundColor",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"_textColor",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"_textShadowColor",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"_textShadowSize",void 0),(0,a._)([(0,o.Cb)()],A.prototype,"_textShadow",null),(0,a._)([(0,o.Cb)()],A.prototype,"_padding",null),(0,a._)([(0,o.Cb)()],A.prototype,"_borderRadius",null),A=(0,a._)([(0,c.j)("esri.views.overlay.TextOverlayItem")],A);const T={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},R=[];{const e=16;for(let t=0;t<360;t+=360/e)R.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const G=A;var P=i(59418);const D={default:15,far:25};let I=class extends m.Z{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=(0,y.vr)((async e=>{const t=await(0,C.ME)("esri/core/t9n/Units");(0,y.k_)(e),this._messagesUnits=t})),t=()=>(0,r.yw)(this.context,(e=>e.editGeometryOperations));this.own([(0,n.YP)((()=>[(0,r.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits]),(()=>this._update())),...["vertex-add","vertex-update","vertex-remove"].map((e=>(0,n.on)(t,e,(()=>this._update())))),(0,s.kB)((()=>e.abort()))])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,r.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((e=>e.label.text))}}get _edgeDistancePixels(){return D[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if((0,r.Wi)(e))return void this._destroyUnusedLabels();const{components:t,geometry:i,coordinateHelper:a}=e.editGeometryOperations.data;if(!i)return void this._destroyUnusedLabels();const s=t.length;for(let n=0;n<s;++n){const o=[];if(t[n].iterateVertices((e=>{o.push(a.toXYZ(e.pos))})),0===n&&(0,r.pC)(this.stagedVertex)&&o.push(a.toXYZ(this.stagedVertex)),o.length<2)continue;const l=o[0],h=o[o.length-1];"polygon"===i.type&&o.length>2&&!(0,S.z)(l,h)&&o.push(l);const c=1===s&&!(0,x.bu)(o,!1,!1);let p=L,d=W;this.toScreenPointArray(e,l,p);for(let t=1;t<o.length;++t){const i=o[t-1],a=o[t];this.toScreenPointArray(e,a,d),this._addLabel(e,i,p,a,d,c),[p,d]=[d,p]}}this._destroyUnusedLabels()}_addLabel(e,t,i,a,s,n){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||(0,b.s)(i,s)<3025)return void(o.visible=!1);const l=(0,r.pC)(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,p.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:h}=e.editGeometryOperations.data,c=(0,P.MU)(t,a,h,l),d=this._messagesUnits,u=(0,v.RG)(e.view);o.text=(0,r.pC)(d)&&(0,r.pC)(c)?(0,f.N9)(d,c,u):"",o.visible=!0;const g=s[0]-i[0],_=s[1]-i[1];n?(0,b.a)(z,-_,g):(0,b.a)(z,_,-g),(0,b.i)(z,z),(0,b.f)(z,z,this._edgeDistancePixels),(0,b.l)(V,i,s,.5),(0,b.b)(V,V,z),o.position=[V[0],V[1]],Math.abs(z[0])>Math.abs(z[1])?o.anchor=z[0]>0?"left":"right":o.anchor=-z[1]<0?"top":"bottom"}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new G({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);const i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel(e){let{label:t}=e;(0,r.yw)(this.context,(e=>e.view.overlay.items.remove(t))),t.destroy()}};(0,a._)([(0,o.Cb)()],I.prototype,"context",void 0),(0,a._)([(0,o.Cb)()],I.prototype,"stagedVertex",void 0),(0,a._)([(0,o.Cb)()],I.prototype,"visible",void 0),(0,a._)([(0,o.Cb)()],I.prototype,"edgeDistance",void 0),(0,a._)([(0,o.Cb)()],I.prototype,"updating",null),(0,a._)([(0,o.Cb)()],I.prototype,"_messagesUnits",void 0),(0,a._)([(0,o.Cb)()],I.prototype,"_edgeDistancePixels",null),I=(0,a._)([(0,c.j)("esri.views.interactive")],I);const z=(0,M.a)(),V=(0,M.a)(),L=(0,u.s1)(),W=(0,u.s1)();var N=i(11208);let Z=class extends I{getCameraOrExtent(e){let{view:t}=e;return t.state.camera}toScreenPointArray(e,t){let{view:i,elevationInfo:a,editGeometryOperations:s}=e,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,u.s1)();const{spatialReference:n}=s.data.coordinateHelper;return(0,N.RS)(t,n,a,i,U),i.state.camera.projectToScreen(U,r),r}};Z=(0,a._)([(0,c.j)("esri.views.3d.interactive.SegmentLabels3D")],Z);const U=(0,_.c)();var k=i(51995),H=i(100),F=i(90045),Y=i(151),B=i(70444),j=i(95773),X=i(85981),Q=i(40885),q=i(62389),J=i(14226),K=i(81949),$=i(86244),ee=i(68401),te=i(59887),ie=i(97882);class ae extends $.l{constructor(e){super(e.view),this._resources=null,this._transform=(0,K.c)()}get object(){return(0,r.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,J.c)(this._transform,e),(0,r.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,r.Wi)(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new ie.F({isPickable:!1,updatePolicy:ee.jq.SYNC});e.add(t);const i=new te.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!(0,r.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){(0,r.Wi)(this._resources)||this._resources.object.setVisible(e)}}var se=i(70619),re=i(56529),ne=i(4760),oe=i(58901);class le extends ae{constructor(e){super(e),this._ray=(0,Q.Ue)(),this._externalResources=null,this._handles=new H.Z,this._isWorldDown=!1,this._start=(0,_.c)(),this._end=(0,_.f)(1,0,0),this._width=1,this._color=(0,Y.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Y.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=ue.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=re.yD.OccludeAndTransparent,this._fadedExtensions=_e,this.applyProps(e)}createExternalResources(){const e=new oe.U(this.materialParameters);this._handles.add((0,n.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()})));const t=new q.W({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){(0,r.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){(0,r.pC)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[(0,_.c)(),(0,_.c)()],i=this.extensionType===ue.FADED;i&&t.push((0,_.c)(),(0,_.c)());const a=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,s=se.Z.createPolylineGeometry(t,null,a);e.addGeometry(s,(0,r.Wg)(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,S.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,S.b)(this._end,e,this._end),(0,Q.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,S.k)(this._start,e)||((0,S.c)(this._start,e),(0,Q.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,S.k)(this._end,e)||((0,S.c)(this._end,e),(0,Q.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,F.g)(e,this._color)||((0,F.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,F.g)(e,this._innerColor)||((0,F.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,r.pC)(e)!==(0,r.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){((0,r.Wi)(e)||(0,r.Wi)(this._stippleOffColor)||!(0,F.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,r.pC)(e)?(0,Y.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,r.pC)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,r.pC)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=(0,r.Pt)(e,_e),this.recreateGeometry()}_updateMaterial(){(0,r.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){(0,r.pC)(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===ue.FADED?this._updateLineSegmentFinite(de):this._updateLineSegmentInfinite(this._extensionType,de);this._updateVertexAttributes(e,t),(0,r.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return(0,X.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,B.iL)(this._ray,he),e){case ue.LINE:he.c0=-Number.MAX_VALUE;break;case ue.RAY:case ue.GROUND_RAY:{const e=this._ray.origin,t=(0,r.Pt)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,S.o)(he.ray.direction,he.ray.direction),this._extensionType===ue.GROUND_RAY&&null!=t&&(he.c1=Math.abs(i-t));break}}if(!(0,j.zq)(i.frustum,he))return(0,X.zk)(this._start,this._end,t);const a=(0,B.Ws)(he,ce),s=(0,B.S$)(he,pe);return(0,X.zk)(a,s,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(ne.T.POSITION).data;if(this.extensionType===ue.FADED){const e=(0,X.KU)(t,-this.fadedExtensions.start,ce);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=(0,X.KU)(t,0,ce);i[3]=a[0],i[4]=a[1],i[5]=a[2];const s=(0,X.KU)(t,1,ce);i[6]=s[0],i[7]=s[1],i[8]=s[2];const r=(0,X.KU)(t,1+this.fadedExtensions.end,ce);i[9]=r[0],i[10]=r[1],i[11]=r[2]}else{const e=(0,X.KU)(t,0,ce);i[0]=e[0],i[1]=e[1],i[2]=e[2];const a=(0,X.KU)(t,1,ce);i[3]=a[0],i[4]=a[1],i[5]=a[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const he=(0,B.Ue)(),ce=(0,_.c)(),pe=(0,_.c)(),de=(0,X.Ue)();var ue;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(ue||(ue={}));const ge=1/3,_e={start:ge,end:ge};class me extends ae{constructor(e){super(e),this._handles=new H.Z,this._location=(0,_.c)(),this._direction=(0,_.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Y.f)(1,0,1,1),this._renderOccluded=re.yD.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){(0,S.k)(this._location,e)||((0,S.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,S.k)(this._direction,e)||((0,S.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,S.n)(this._direction,(0,S.b)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,F.g)(e,this._color)||((0,F.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new oe.U(this.materialParameters);this._handles.add((0,n.YP)((()=>this.view.state.camera),(()=>{this._updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=se.Z.createPolylineGeometry([(0,_.c)(),(0,_.c)()]),i=se.Z.createPolylineGeometry([(0,_.c)(),(0,_.c)()]),a=(0,r.Wg)(this._externalResources).material;e.addGeometry(t,a),e.addGeometry(i,a),this._updateVertices(e)}forEachExternalMaterial(e){(0,r.pC)(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){(0,r.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;(0,r.Wi)(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,fe),(0,S.a)(ye,this.location,this.direction),t.projectToScreen(ye,ve),(0,b.i)(ve,(0,b.g)(ve,ve,fe)),this._updateVertexAttributes(t,e,0,fe,ve,1),this._updateVertexAttributes(t,e,1,fe,ve,-1)}_updateVertexAttributes(e,t,i,a,s,r){const n=t.geometryRecords[i],o=n.geometry.getMutableAttribute(ne.T.POSITION).data,l=(0,b.f)(be,(0,b.a)(be,s[1]*r,s[0]*-r),this.offset+this.width/2),h=(0,b.b)(Me,(0,b.b)(Me,(0,b.b)(Me,a,(0,b.f)(Me,s,this.length/2)),l),l),c=(0,b.b)(Se,h,(0,b.f)(Se,s,-this.length));e.unprojectFromScreen(h,ye),o[0]=ye[0],o[1]=ye[1],o[2]=ye[2],e.unprojectFromScreen(c,ye),o[3]=ye[0],o[4]=ye[1],o[5]=ye[2],t.geometryVertexAttrsUpdated(n)}}const ye=(0,_.c)(),fe=(0,u.s1)(),ve=(0,u.s1)(),be=(0,u.s1)(),Me=(0,u.s1)(),Se=(0,u.s1)();var xe=i(16889),Ce=i(67077),we=i(79803),Oe=i(41414),Ee=i(11185),Ae=i(79100),Te=i(76873);class Re{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,r.pC)(this._resources)?this._resources.object:null}get resources(){return(0,r.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if((0,r.Wi)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type===Ae.U.Geometry&&e.remove(t)})),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory,t=e.view,i=t._stage;if(!i)return;const a=new ie.F({isPickable:!1,updatePolicy:ee.jq.SYNC});i.add(a);const s=new te.T({castShadow:!1}),r=e.createResources(s,a);r.forEach((e=>{i.add(e),e instanceof Te.x&&i.loadImmediate(e)})),i.add(s),a.add(s);const o=e.cameraChanged?(0,n.YP)((()=>t.state.camera),(t=>e.cameraChanged(t)),n.nn):null;this._resources={layer:a,object:s,external:r,cameraHandle:o},this._syncVisible()}_destroyResources(){if((0,r.Wi)(this._resources))return;const e=this.resourceFactory.view._stage;e?.remove(this._resources.object),e?.remove(this._resources.layer),this._resources.external.forEach((t=>{e?.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){(0,r.Wi)(this._resources)||this._resources.object.setVisible(this._visible)}}var Ge=i(69691),Pe=i(78935),De=i(55360),Ie=i(21400);class ze{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=(0,Ce.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,Ce.f)(1,1,1,1),this._elevationInfo=null,this.resources=new Re({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometry=this._recreateGeometry(t,e.material),(0,r.pC)(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?(0,r.pC)(this.resources)&&this.resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,F.g)(e,this._color)||((0,F.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,(0,r.pC)(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,F.g)(e,this._outlineColor)||((0,F.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}_updateMaterial(){const e=this.resources.resources;(0,r.Wi)(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if((0,r.Wi)(e)||(0,r.Wi)(t))return;const i=e.geometry;if((0,r.Wi)(i))return;const a=i.getMutableAttribute(ne.T.SIZE).data,s=this.geometrySize;a[0]=s,a[1]=s,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Le,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/Ve}_recreateGeometry(e,t){const i=this._createRenderGeometry();return(0,r.pC)(i)&&e.addGeometry(i,t),i}_createResources(e){const t=(0,De.cU)(this._primitive,this.preferredTextureSize),i=new Ie.A(this._materialParameters(t.id)),a=this._recreateGeometry(e,i);return{material:i,texture:t,geometry:a,forEach(e){e(t),e(i),(0,r.pC)(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return(0,xe.uZ)((0,xe.Sf)(2*this.geometrySize),16,128)}calculateMapBounds(e){if((0,r.Wi)(this.resources.resources)||(0,r.Wi)(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get(ne.T.POSITION);return(0,we.SH)(t.data,this.view.renderCoordsHelper.spatialReference,We,this.view.spatialReference),(0,Oe.G1)(e,We),!0}_createRenderGeometry(){const e=this.geometry;if((0,r.Wi)(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,a=(0,Ge.w7)(e,i,Pe.o.fromElevationInfo(this.elevationInfo),t),s=(0,S.s)(Ee.WM.get(),e.x,e.y,a),n=Ee.WM.get();(0,we.SH)(s,e.spatialReference,n,t.spatialReference);const o=this.geometrySize;return se.Z.createPointGeometry(null,n,null,[o,o],[0,0,0,1])}}const Ve=De.Ns,Le=[Ve/2,Ve/2,1-Ve/2,1-Ve/2],We=(0,_.c)();var Ne=i(74894),Ze=i(66832);class Ue extends ae{constructor(e){super(e),this._handles=new H.Z,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=(0,_.c)(),this._up=(0,_.c)(),this._right=(0,_.c)(),this._renderOccluded=re.yD.OccludeAndTransparent,this._color=(0,Y.f)(1,0,0,1),this._outlineColor=(0,Y.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=re.yD.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,F.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,F.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:a}=e;this._maxSize=Math.min((0,S.i)(i,t),(0,S.i)(i,a))/3,(0,S.n)(this._up,(0,S.b)(this._up,t,i)),(0,S.n)(this._right,(0,S.b)(this._right,a,i)),(0,S.c)(this._position,i),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Ze.E(this.quadMaterialParameters),this._outlineMaterial=new oe.U(this.outlineMaterialParameters),this._handles.add((0,n.YP)((()=>this.view.state.camera),(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=(0,S.a)(Ee.WM.get(),this._up,this._right),i=se.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),a=Math.min(this._maxSize,i);(0,J.f)(ke,this._position),(0,J.h)(ke,ke,[a,a,a]),(0,r.pC)(e)&&(e.transformation=ke)}_quadGeometryData(e,t){const i=(0,S.a)(Ee.WM.get(),e,t);return new Ne.Z([[ne.T.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[ne.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const ke=(0,K.c)();var He=i(76014),Fe=i(64674),Ye=i(38561);class Be extends Ye.a{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,view:a}=t;return(0,s.ed)(new ze({view:a,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:(0,r.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:k.Z.toUnitRGBA(He.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,view:a}=t;return(0,s.ed)(new ze({view:a,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:(0,r.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:k.Z.toUnitRGBA(He.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,view:a}=t;return(0,s.ed)(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,(0,r.Pt)(e.elevationInfo,t.elevationInfo),a,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,view:a}=t,n=(0,r.Pt)(e.elevationInfo,t.elevationInfo),o=(0,N.$r)(e.lineStart,i,n,t.view),l=(0,N.$r)(e.lineEnd,i,n,t.view),h=(0,S.h)(l,o,l,.5),c=new me({view:a,attached:!1,offset:He.c.parallelLineHintOffset,length:He.c.parallelLineHintLength,width:He.c.parallelLineHintWidth,color:k.Z.toUnitRGBA(He.c.orange),location:h,renderOccluded:re.yD.Opaque});return c.setDirectionFromPoints(o,h),c.attached=!0,(0,s.ed)(c)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,view:a}=t,n=(0,r.Pt)(e.elevationInfo,t.elevationInfo);return(0,s.ed)(new Ue({view:a,attached:!0,color:k.Z.toUnitRGBA(He.c.orange),renderOccluded:re.yD.Transparent,outlineRenderOccluded:re.yD.Opaque,outlineColor:k.Z.toUnitRGBA(He.c.orange),outlineSize:He.c.rightAngleHintOutlineSize,size:He.c.rightAngleHintSize,geometry:{previous:(0,N.$r)(e.previousVertex,i,n,a),center:(0,N.$r)(e.centerVertex,i,n,a),next:(0,N.$r)(e.nextVertex,i,n,a)}}))}_createLineSegmentHintFromMap(e,t,i,a,s,r){let n=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=(0,_.c)(),h=(0,_.c)();return(0,N.By)(t,i,a,s,r,l,h),this._createLineSegmentHint(e,r,l,h,n,o)}_createLineSegmentHint(e,t,i,a){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const n=new le({view:t,extensionType:ue.FADED,start:i,end:a,color:k.Z.toUnitRGBA(He.c.orange),renderOccluded:re.yD.Opaque});switch(e){case Fe.ze.TARGET:n.width=He.c.lineHintWidthTarget,n.fadedExtensions={start:0,end:He.c.lineHintFadedExtensions};break;case Fe.ze.REFERENCE_EXTENSION:n.width=He.c.lineHintWidthReference,n.fadedExtensions={start:0,end:0};break;case Fe.ze.REFERENCE:n.width=He.c.lineHintWidthReference,n.fadedExtensions={start:s?He.c.lineHintFadedExtensions:0,end:r?He.c.lineHintFadedExtensions:0}}return n.attached=!0,n}}var je=i(86950),Xe=i(86700);const Qe={main:new k.Z([255,127,0]),selected:new k.Z([255,255,255]),staged:new k.Z([12,207,255]),outline:new k.Z([0,0,0,.5]),selectedOutline:new k.Z([255,255,255])},qe=.3;function Je(e,t){const i=e.clone();return i.a*=t,i}function Ke(e,t){const i=e.clone(),a=(0,je._Y)(i);a.s*=t;const s=(0,je.xr)(a);return i.r=s.r,i.g=s.g,i.b=s.b,i}function $e(e,t){if(t)for(const i in t)e[i]=t[i]}class et{constructor(e){this.color=Qe.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=re.yD.Opaque,$e(this,e)}}class tt{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Qe.main,this.outlineColor=Qe.outline,this.renderOccluded=re.yD.Opaque,this.hoverOutlineColor=Qe.selectedOutline,$e(this,e)}apply(e,t){const i=this[e];t.setParameters({color:pt(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class it{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Je(Qe.main,.5),this.hoverColor=Qe.main,this.renderOccluded=re.yD.Transparent,this.minSquaredEdgeLength=900,$e(this,e)}apply(e,t){const i=this[e];t.setParameters({color:pt(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class at{constructor(e){this.vertex=new tt({color:Qe.main,outlineColor:Qe.outline}),this.edge=new tt({color:Ke(Je(Qe.main,2/3),.5),outlineColor:Je(Qe.outline,.5),size:8,collisionPadding:8}),this.selected=new tt({color:Qe.selected,outlineColor:Qe.outline}),this.edgeOffset=new it,$e(this,e)}}class st{constructor(e){this.color=Qe.selected,this.width=1.5,this.stipplePattern=(0,Xe.z5)(5),this.stippleOffColor=Qe.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Qe.selected,this.renderOccluded=re.yD.OccludeAndTransparent,$e(this,e)}apply(e){e.color=pt(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=pt(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=pt(this.innerColor),e.renderOccluded=this.renderOccluded}}class rt{constructor(e){this.color=Qe.selected,this.size=4,this.outlineSize=1,this.outlineColor=Qe.outline,this.shape="square",$e(this,e)}apply(e){e.color=pt(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=pt(this.outlineColor),e.primitive=this.shape}}class nt{constructor(e){this.innerColor=Qe.selected,this.innerWidth=1,this.glowColor=Qe.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=qe,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Qe.main,$e(this,e)}apply(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i={glowColor:k.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:k.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class ot{constructor(e){this.outline=new st({color:Qe.outline,renderOccluded:re.yD.OccludeAndTransparentStencil,stippleOffColor:Qe.selected,stipplePattern:(0,Xe.z5)(5),width:1.5,innerWidth:0}),this.staged=new st({color:Qe.selected,renderOccluded:re.yD.OccludeAndTransparentStencil,innerColor:Qe.staged,stippleOffColor:Qe.outline,stipplePattern:(0,Xe.z5)(5),width:1.5}),this.shadowStyle=new nt({globalAlpha:qe,glowColor:Qe.main,glowFalloff:8,glowWidth:8,innerColor:Qe.selected,innerWidth:1}),$e(this,e)}}class lt{constructor(e){this.outline=new rt({color:Qe.selected,outlineColor:Qe.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new nt({globalAlpha:qe,glowColor:Qe.main,glowFalloff:1.5,glowWidth:6,innerColor:Qe.selected,innerWidth:1,radius:2}),$e(this,e)}}class ht extends st{constructor(e){super(),this.extensionType=ue.GROUND_RAY,$e(this,e)}}class ct{constructor(e){this.lineGraphics=new ot,this.pointGraphics=new lt,this.heightPlane=new nt({globalAlpha:qe,glowColor:Qe.main,glowFalloff:8,glowWidth:8,innerColor:Qe.selected,innerWidth:1}),this.heightBox=new nt({globalAlpha:qe,glowColor:Qe.main,glowFalloff:8,glowWidth:8,innerColor:Qe.selected,innerWidth:0,heightFillColor:Qe.main}),this.zVerticalLine=new ht({color:Je(Qe.main,.5),falloff:2,innerColor:Je(Qe.selected,0),renderOccluded:re.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:ue.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,$e(this,e)}}function pt(e){return(0,Ce.b)(k.Z.toUnitRGBA(e))}const dt=new class{constructor(e){this.visualElements=new ct,this.reshapeManipulators=new at,this.zManipulator=new et,$e(this,e)}colorToVec4(e){return pt(e)}};var ut=i(91505),gt=i(65618),_t=i(79056),mt=i(26279),yt=i(78289);class ft{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return(0,r.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?(0,r.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,r.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.createResources(),t=new vt({view:this.resourceFactory.view}),i=this.resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new vt({view:this.resourceFactory.view}),external:e,geometriesAdded:!1},i&&(this._resources.drapeSourceRenderer=i.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if((0,r.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const e=this.resourceFactory.view.basemapTerrain?.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,r.Wi)(this._resources)||(0,r.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,yt.$.Geometry.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,r.Wi)(this._resources)||(0,r.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,yt.$.Geometry.UPDATE),this._resources.geometriesAdded=!0)}}let vt=class extends((0,_t.IG)(m.Z)){constructor(e){super(e),this.drapeSourceType=mt.L.Features,this.updatePolicy=ee.jq.SYNC}};(0,a._)([(0,o.Cb)({constructOnly:!0})],vt.prototype,"view",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],vt.prototype,"drapeSourceType",void 0),vt=(0,a._)([(0,c.j)("DrapedVisualElementLayerView")],vt);var bt=i(75558),Mt=i(81955),St=i(69831);class xt{constructor(e){this.view=null,this._attachmentOrigin=(0,gt.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new ut.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,Y.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,Y.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=re.yD.OccludeAndTransparentStencil,this.resources=new Re({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new ft({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}});let t=!0;this._laserline=new q.W({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&(0,r.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this._updateAttached(e)}_updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,F.g)(e,this._color)||((0,F.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,F.g)(e,this._innerColor)||((0,F.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=(0,r.pC)(e)!==(0,r.pC)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&(0,F.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,Y.a)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,(0,r.pC)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(0,r.pC)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;(0,S.s)(Ot,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get(ne.T.POSITION),a=i.indices.get(ne.T.POSITION),s=(0,r.Wg)(this.resources.resources).material.isClosed(e.data,a);(0,Mt.qZ)(e,a,s,wt)&&((0,S.a)(Ot,Ot,wt),t++)}return 0===t?null:((0,S.g)(Ot,Ot,1/t),this.view.renderCoordsHelper.fromRenderCoords(Ot,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,r.pC)(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),(0,r.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return(0,r.pC)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===re.yD.OccludeAndTransparentStencil?re.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){const a=this._createRenderGeometries();for(const s of a)e.addGeometry(s,t),i.push(s);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(e){const t=new oe.U(this.materialParameters),i=[];return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new oe.U(this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if((0,r.Wi)(t))return[];const i=(0,bt.rm)(t,this.view.basemapTerrain.spatialReference),a=[];for(const{position:s}of i.lines){const t={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:s},removeDuplicateStartEnd:this.isClosed?bt.NW.REMOVE:bt.NW.KEEP},i=new St.z((0,bt.YU)(t),e),r=(0,Oe.cS)(Ct);(0,Oe.G1)(r,s),(0,F.s)(i.boundingSphere,.5*(r[0]+r[3]),.5*(r[1]+r[4]),0,.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1]))),a.push(i)}return a}calculateMapBounds(e){if((0,r.Wi)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const a=i.vertexAttributes.get(ne.T.POSITION),s=new Float64Array(a.data.length);(0,we.CM)(a.data,t.spatialReference,0,s,this.view.spatialReference,0,a.data.length/3),(0,Oe.G1)(e,s)}return!0}_createRenderGeometries(){const e=this.geometry;if((0,r.Wi)(e))return[];const t=(0,bt.VP)(e,this.view.elevationProvider,this.view.renderCoordsHelper,Pe.o.fromElevationInfo(this.elevationInfo??new d.ZP({mode:(0,p.VW)(e,null)}))),i=[],a=[];for(const{position:s,mapPosition:r}of t.lines){const e={overlayInfo:null,attributeData:{position:s,mapPosition:r},removeDuplicateStartEnd:this.isClosed?bt.NW.REMOVE:bt.NW.KEEP};i.push((0,bt.YU)(e)),a.push(s)}return this._laserline.pathVerticalPlane=a,i}}const Ct=(0,Oe.Ue)(),wt=(0,_.c)(),Ot=(0,_.c)();var Et=i(36759),At=i(11606);class Tt extends ae{constructor(e){super(e),this.view=null,this._renderOccluded=re.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=dt.colorToVec4(dt.reshapeManipulators.vertex.color),this._size=dt.reshapeManipulators.vertex.size,this._outlineColor=dt.colorToVec4(dt.reshapeManipulators.vertex.outlineColor),this._outlineSize=dt.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){(0,F.g)(e,this._color)||((0,F.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,F.g)(e,this._outlineColor)||((0,F.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if((0,r.Wi)(e)||0===e.length)return[];const t=(0,Et.VP)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Pe.o.fromElevationInfo(this.elevationInfo)),i=[],a=t.numVertices,s=t.position;for(let r=0;r<a;++r){const e=(0,S.s)(Rt,s[3*r+0],s[3*r+1],s[3*r+2]),t=Gt(.5,e),a=Gt(.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:a})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:a}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(a,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new At.Q({...this.vertexMaterialParameters,writeDepth:!0,cullFace:ee.Vr.Back,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new At.Q({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:ee.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const Rt=(0,_.c)();function Gt(e,t){return se.Z.createSphereGeometry(e,16,16,{offset:t})}let Pt=class extends ut.Z.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,a._)([(0,o.Cb)({constructOnly:!0})],Pt.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)()],Pt.prototype,"tracking",void 0),(0,a._)([(0,o.Cb)()],Pt.prototype,"displaying",void 0),(0,a._)([(0,o.Cb)()],Pt.prototype,"isDraped",void 0),Pt=(0,a._)([(0,c.j)("esri.views.3d.layers.graphics.GraphicState")],Pt);var Dt=i(89215),It=i(69674),zt=i(54016),Vt=i(52349),Lt=i(61920);let Wt=class extends Dt.T{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.labelOptions=new Vt.Z,this.tooltipOptions=new Lt.Z,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new d.ZP({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:{mode:t?"absolute-height":"on-the-ground",offset:0}}}return e}initializeGraphic(e){const t=this._createGraphicState=new Pt({graphic:e});return(0,s.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(t),(0,n.YP)((()=>({element:this._outlineVisualElement,isDraped:t.isDraped})),(e=>{let{element:t,isDraped:i}=e;(0,r.yw)(t,(e=>e.isDraped=i))}),n.nn)])}makeDrawOperation(){const{geometryType:e}=this,t="circle"!==e&&"rectangle"!==e;return new It.w({view:this.view,manipulators:this.manipulators,geometryType:(0,Dt.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new zt.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new zt.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Be,segmentLabels:t?new Z:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,r.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,p.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(e){return(0,r.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new Tt({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:dt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=dt.colorToVec4(dt.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,(0,s.kB)((()=>{this._activeVertexVisualElement=(0,r.SC)(this._activeVertexVisualElement)})))}onOutlineChanged(e){if((0,r.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new xt({view:this.view,geometry:e,elevationInfo:t,isDraped:(0,r.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,p.Zz)(this.hasZ,t),attached:!1}),dt.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),dt.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,s.kB)((()=>{this._outlineVisualElement=(0,r.SC)(this._outlineVisualElement)}))}onRegularVerticesChanged(e){return(0,r.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new Tt({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:dt.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,s.kB)((()=>{this._verticesVisualElement=(0,r.SC)(this._verticesVisualElement)})))}};(0,a._)([(0,o.Cb)({constructOnly:!0})],Wt.prototype,"elevationInfo",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Wt.prototype,"geometryType",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Vt.Z})],Wt.prototype,"labelOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Lt.Z})],Wt.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)()],Wt.prototype,"type",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Wt.prototype,"view",void 0),Wt=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Wt);var Nt,Zt=i(40281),Ut=i(41691),kt=i(83639),Ht=i(77498);function Ft(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,p.RL)(e);return"on-the-ground"!==t.mode&&!((0,r.Wi)(e.geometry)||!e.geometry.hasZ)}!function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(Nt||(Nt={}));var Yt,Bt=i(35284);!function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(Yt||(Yt={}));class jt{constructor(){this.grabbingState=Yt.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Yt.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===Nt.TRANSLATE_Z&&(this.zManipulator=e),e instanceof Bt.Z&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),(0,r.Wi)(this.firstGrabbedXY)&&e.grabbing&&t===Nt.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Yt.ANY,t){case Nt.TRANSLATE_Z:this.grabbingState|=Yt.Z;break;case Nt.TRANSLATE_XY:this.grabbingState|=Yt.XY}}))}}function Xt(e){const{view:t,graphic:i}=e,a=new Pt({graphic:i}),r=function(e,t){const{view:i,graphic:a}=e,r=new xt({view:i,geometry:qt(a)?a.geometry:null,elevationInfo:(0,p.RL)(a),attached:!1});dt.visualElements.lineGraphics.shadowStyle.apply(r);const o=()=>{r.attached=t.displaying};dt.visualElements.lineGraphics.outline.apply(r);const l=[(0,n.YP)((()=>t.displaying),o),(0,n.YP)((()=>t.isDraped),(e=>{r.isDraped=e})),t.on("changed",(()=>r.geometry=qt(a)?a.geometry:null)),(0,s.ed)(r)];return o(),{visualElement:r,remove:()=>(0,s.AL)(l).remove()}}(e,a),o=[r,Qt(e,r.visualElement,a),t.maskOccludee(i),t.trackGraphicState(a)];return{visualElement:r.visualElement,remove:()=>(0,s.AL)(o).remove()}}function Qt(e,t,i){const{graphic:a,view:o}=e,l=[],h=(0,p.RL)(a),c="on-the-ground"===h.mode||!h.offset&&"absolute-height"!==h.mode,d=new jt,u=new le({view:o,extensionType:dt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:re.yD.OccludeAndTransparent});dt.visualElements.pointGraphics.shadowStyle.apply(u);const g=(0,xe.Vl)(dt.visualElements.heightPlaneAngleCutoff),_=new q.W({view:o,attached:!1,angleCutoff:g});dt.visualElements.heightPlane.apply(_);let m=1,y=1;const f=()=>{if(d.update(e),!i.displaying||c&&(i.isDraped||!qt(a)||!a.geometry.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(_.attached=!1);t.laserlineEnabled=!0;{const e=d.grabbingState&Yt.XY?dt.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,dt.visualElements.lineGraphics.shadowStyle.apply(t,e),dt.visualElements.pointGraphics.shadowStyle.apply(u,e))}{const e=d.grabbingState&Yt.Z?dt.visualElements.laserlineAlphaMultiplier:1;e!==y&&(y=e,dt.visualElements.heightPlane.apply(_,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,r.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,r.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(u,d),function(e,t,i,a){if(a.numSelected>0){(0,S.s)(Jt,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===Nt.TRANSLATE_XY&&e.selected&&e instanceof Bt.Z&&((0,S.a)(Jt,Jt,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=(0,S.g)(Jt,Jt,1/t),i.attached=!0):i.attached=!1}else{const a=t.attachmentOrigin;(0,r.pC)(a)&&e.view.renderCoordsHelper.toRenderCoords(a,Jt)?(i.heightManifoldTarget=Jt,i.attached=!0):i.attached=!1}}(e,t,_,d)};dt.visualElements.zVerticalLine.apply(u),l.push(i.on("changed",f),(0,n.YP)((()=>i.displaying),f),t.events.on("attachment-origin-changed",f),(0,s.ed)(u),(0,s.ed)(_));const v=[],b=()=>{(0,s.AL)(v).remove(),v.length=0,e.forEachManipulator((e=>v.push(e.events.on("grab-changed",f)))),e.forEachManipulator((e=>v.push(e.events.on("select-changed",f)))),f()};return b(),l.push(e.onManipulatorsChanged(b),(0,s.iU)((()=>(0,s.AL)(v)))),(0,s.AL)(l)}function qt(e){return(0,r.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const Jt=(0,_.c)();var Kt=i(65156);function $t(e){const{view:t,graphic:i}=e,a=new Pt({graphic:i}),o=[],l=function(e,t,i){const{view:a,graphic:o}=e,l=new ze({view:a,geometry:ei(o),elevationInfo:(0,p.RL)(o),attached:!1});return function(e,t,i,a){const o=()=>t.attached=i.displaying;(function(e,t,i,a){const{view:n,graphic:o}=e;let l=null;const h=e=>{(0,r.pC)(l)&&(l.remove(),l=null),i.isDraped&&(0,r.pC)(e)&&(l=function(e,t,i){const a=e.elevationProvider.spatialReference;(0,we.KC)(t,ti,a);const s=ti[0],r=ti[1];return e.elevationProvider.on("elevation-change",(e=>{(0,Kt.jE)(e.extent,s,r)&&i()}))}(n,e,(()=>{t.geometry=e})))},c=()=>{const e=ei(o);h(e),t.geometry=e};a.push(i.on("changed",c),(0,s.iU)((()=>l))),c()})(e,t,i,a),dt.visualElements.pointGraphics.outline.apply(t),a.push((0,n.YP)((()=>i.displaying),o,n.nn))}(e,l,t,i),i.push((0,s.ed)(l)),l}(e,a,o);return function(e,t,i,a){const{view:o,graphic:l}=e,h=new le({view:o,extensionType:dt.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:re.yD.OccludeAndTransparent});dt.visualElements.zVerticalLine.apply(h);const c=new q.W({view:o,intersectsLineInfinite:!0,attached:!1});dt.visualElements.pointGraphics.shadowStyle.apply(c);const d=(0,xe.Vl)(dt.visualElements.heightPlaneAngleCutoff),u=new q.W({view:o,attached:!1,angleCutoff:d});dt.visualElements.heightPlane.apply(u);const g=(0,p.RL)(e.graphic),_=Pe.o.fromElevationInfo(g),m="on-the-ground"===g.mode||!g.offset&&"absolute-height"!==g.mode,y=new jt;let f=1,v=1;const b=()=>{y.update(e);const i=ei(l),s=m&&(t.isDraped||(0,r.Wi)(i)||!i.hasZ);let n=!0;if(!s&&(0,r.pC)(i)){const e=(0,Ge.w7)(i,o.elevationProvider,_,o.renderCoordsHelper);(0,S.s)(ti,i.x,i.y,e),(0,we.SH)(ti,i.spatialReference,ti,o.renderCoordsHelper.spatialReference),h.setStartEndFromWorldDownAtLocation(ti),c.intersectsWorldUpAtLocation=ti}else n=!1;const p=y.grabbingState&Yt.Z?dt.visualElements.laserlineAlphaMultiplier:1;p!==f&&(f=p,dt.visualElements.heightPlane.apply(u,p));const d=(0,Oe.cS)(ii);!s&&t.displaying&&a.calculateMapBounds(d)&&(0,we.SH)((0,Oe.KE)(d,ti),o.spatialReference,ti,o.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=ti,u.attached=!0):u.attached=!1;const g=y.grabbingState&Yt.XY?dt.visualElements.laserlineAlphaMultiplier:1;g!==v&&(v=g,dt.visualElements.pointGraphics.shadowStyle.apply(c,g));const b=n&&t.displaying&&!s;c.attached=b,h.attached=b};i.push((0,n.YP)((()=>[t.displaying,t.isDraped]),b),t.on("changed",b)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",b))})),i.push((0,s.ed)(c)),i.push((0,s.ed)(h)),i.push((0,s.ed)(u)),b()}(e,a,o,l),o.push(t.trackGraphicState(a)),{visualElement:l,remove(){(0,s.AL)(o).remove()}}}function ei(e){const t=e.geometry;return(0,r.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const ti=(0,_.c)(),ii=(0,Oe.Ue)();function ai(e){switch((0,r.Wg)(e.graphic.geometry).type){case"point":case"mesh":return $t(e);case"polygon":case"polyline":return Xt(e);default:return null}}const si=[1,.5,0],ri=70,ni=Math.ceil(ri/3*2),oi=160,li=5*Math.PI/12,hi=1*Math.PI/3;class ci{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get hovering(){return this.someManipulator((e=>e.hovering))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof Bt.Z&&e(t,i)}))}}var pi=i(51328),di=i(74229);function ui(e,t,i,a){const s=e.graphic,r=(e,i)=>t({action:e,graphic:s,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{const n=t.next((e=>("start"===e.action&&r("start",e),e))).next((0,di.a9)(s,a)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e}));return i.next((0,di.bD)(s)).next((()=>{r("end",{screenDeltaX:0,screenDeltaY:0})})),n}))}function gi(e){if((0,r.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],a=t[1];return Math.atan2(a[1]-i[1],a[0]-i[0])}var _i=i(99034);class mi extends ci{constructor(e){super(),this._handles=new H.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=ri,this._updateAfterDrag=!1,this.events=new ut.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles=(0,r.SC)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,Nt.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const a=t.graphic,s=(0,p.RL)(a),n=(0,r.Wg)(a.geometry).spatialReference;return ui(t,i,(t=>this.createDragPipeline(((i,a,s,r,n)=>t(i,e(i,a,s,r,n),s)),s,n,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){return(0,s.AL)(this._arrowManipulatorInfos.map(((s,r)=>{let{manipulator:n}=s;return(0,di.Xd)(n,((s,n,o,l,h)=>{const c=n.next((e=>({...e,manipulatorType:Nt.TRANSLATE_XY}))).next((0,di.kY)(this._view,s.elevationAlignedLocation)).next((0,pi.G)(this._view,s.elevationAlignedLocation,t,i,a)).next((0,di.M2)(s.location,this.angle+(r+1)*Math.PI*.5)).next((0,di.zh)());e(s,c,o,l,h)}))})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator(e,t){let{manipulator:i,transform:a}=e;const s=this._radius/ri,r=54*s,n=r*Math.sqrt(3)/2,o=se.Z.createExtrudedTriangle(n,r/2,r/2,.02);se.Z.transformInPlace(o,(0,J.f)(Ee.MP.get(),(0,S.s)(Ee.WM.get(),0,-n/3,0))),i.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:_i.Q9.Focused},{geometry:o,material:this._transparentMaterial,stateMask:_i.Q9.Unfocused}],i.radius=n/3*2*1.2;const l=(0,J.b)(Ee.MP.get(),t*Math.PI/2),h=(0,J.f)(Ee.MP.get(),(0,S.s)(Ee.WM.get(),0,100*s,0));(0,J.m)(a,l,h)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=(0,J.d)(Ee.MP.get(),e,(0,_.f)(0,0,1));if((0,r.Wi)(t))return;const i=(0,J.u)(Ee.MP.get(),(0,S.s)(Ee.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,J.m)(Ee.MP.get(),i,t);for(const s of this._arrowManipulatorInfos){const e=(0,J.m)(Ee.MP.get(),a,s.transform);s.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new Bt.Z({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,_.f)(0,0,1)}}),i={manipulator:t,transform:(0,K.c)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=k.Z.toUnitRGBA(Qe.main);return t[3]*=e,new Ze.E({color:t,transparent:1!==e,cullFace:ee.Vr.Back,renderOccluded:re.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((e=>{let{manipulator:t}=e;return t}))}}}class yi{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new di.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,r.pC)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this._snap(this.lastDragEvent.screenEnd);if((0,r.pC)(i)){const a={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(a)}}this._enabled=e}_snap(e){const t=(0,r.pC)(this.view)?this.view.toMap(e,{exclude:[]}):null;return(0,r.pC)(t)&&(0,r.pC)(this.view)&&(t.z=(0,p.Ou)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return(0,r.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class fi extends ci{constructor(e){super(),this._snapToScene=new yi,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=ri,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,Nt.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const a=t.graphic,s=(0,p.RL)(a),n=(0,r.Wg)(a.geometry).spatialReference;return ui(t,i,(t=>this.createDragPipeline(((i,a,s,r,n)=>t(i,e(i,a,s,r,n),s)),s,n,a)),this._view.state.viewingMode)}createDragPipeline(e,t,i,a){const s=this._view;return(0,di.Xd)(this._manipulator,((r,n,o,l,h)=>{const c=n.next((0,di.kY)(s,r.elevationAlignedLocation)).next((0,pi.G)(s,r.elevationAlignedLocation,t,i,a)).next(this._snapToScene.createDragEventPipelineStep(s,t),this._snapToScene.next).next((e=>({...e,manipulatorType:Nt.TRANSLATE_XY}))).next((0,di.zh)());e(r,c,o,l,h)}))}_updateManipulatorTransform(){const e=(0,J.u)(Ee.MP.get(),(0,S.s)(Ee.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new Bt.Z({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,_.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=se.Z.createCylinderGeometry(.02,1,128,(0,_.f)(0,0,1),(0,_.f)(0,0,0)),t=(0,J.u)((0,K.c)(),(0,_.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:_i.Q9.Focused},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:_i.Q9.Unfocused}],this._manipulator.radius=this._radius/ri*80}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=k.Z.toUnitRGBA(Qe.main);return t[3]*=e,new Ze.E({color:t,transparent:1!==e,cullFace:ee.Vr.Back,renderOccluded:re.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}class vi extends ci{constructor(e){super(),this._radius=ri,this.events=new ut.Z,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,Nt.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const a=(0,r.Wg)(t.graphic.geometry).spatialReference;return ui(t,i,(t=>this.createDragPipeline(((i,a,s,r,n)=>t(i,e(i,a,s,r,n),s)),a)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return(0,di.Xd)(this._manipulator,((a,s,r,n,o)=>{const l=s.next((e=>({...e,manipulatorType:Nt.TRANSLATE_Z}))).next((0,pi.Sp)(i,a.renderLocation,t)).next((0,di.zh)());e(a,l,r,n,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/ri,t=dt.zManipulator.height*e,i=dt.zManipulator.coneHeight*e,a=dt.zManipulator.coneWidth*e,s=dt.zManipulator.width*e,r=[(0,_.f)(0,0,0),(0,_.f)(0,0,t)],n=se.Z.createTubeGeometry(r,s/2,16,!1),o=se.Z.createConeGeometry(i,a/2,16,!1),l=[(0,_.f)(0,0,0),(0,_.f)(0,0,t+i)],h=(e=>{const i=(0,K.c)();if((0,J.j)(i,i,[0,0,t]),(0,J.r)(i,i,Math.PI/2),e){const t=1+2*e/a;(0,J.h)(i,i,[t,t,t])}return i})(0),c=(e,t)=>{const i=(0,je._j)(dt.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,dt.zManipulator.color.a*e]},p=(0,kt.EA)(c(1,.25),re.yD.Occlude),d=(0,kt.EA)(c(1,0),re.yD.Occlude),u=(0,kt.EA)(c(.7,0),dt.zManipulator.renderOccluded),g=(0,kt.EA)(c(.85,0),dt.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:h,material:p,stateMask:_i.Q9.Unfocused},{geometry:n,material:p,stateMask:_i.Q9.Unfocused},{geometry:o,transform:h,material:d,stateMask:_i.Q9.Focused},{geometry:n,material:d,stateMask:_i.Q9.Focused},{geometry:o,transform:h,material:u,stateMask:_i.Q9.Unfocused},{geometry:n,material:u,stateMask:_i.Q9.Unfocused},{geometry:o,transform:h,material:g,stateMask:_i.Q9.Focused},{geometry:n,material:g,stateMask:_i.Q9.Focused}],this._manipulator.radius=s/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}_createManipulator(){const e=new Bt.Z({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=bi;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const a=(0,S.j)(t.eye,i),s=t.computeRenderPixelSizeAtDist(a),r=(0,S.b)(Mi,i,t.eye);(0,S.n)(r,r);const n=Si;this._view.renderCoordsHelper.worldUpAtPosition(bi,n);const o=Math.abs((0,S.e)(r,n)),l=(0,S.f)(Mi,r,n),h=(0,S.f)(Mi,l,n),c=(0,xe.uZ)(o,.01,1),p=1-Math.sqrt(1-c*c)/c/t.fullWidth,d=this._radius/ri,u=dt.zManipulator.width*d;(0,S.g)(h,(0,S.n)(h,h),(1/p-1)*a+s*u),e[12]-=Mi[0],e[13]-=Mi[1],e[14]-=Mi[2]},this._manipulator=e,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const bi=(0,_.c)(),Mi=(0,_.c)(),Si=(0,_.c)();class xi extends ci{constructor(e){super(),this._handles=new H.Z,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:a,radius:s}=e;this._view=i,this.xyManipulation=new fi({tool:t,view:i,snapToScene:a,radius:s}),this.xyAxisManipulation=new mi({tool:t,view:i,radius:s}),this.zManipulation=new vi({tool:t,view:i,radius:s}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return(0,s.AL)([this.xyManipulation.createGraphicDragPipeline(((t,i,a,s,r)=>e(wi.XY,t,i,a,s,r)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,a,s,r)=>e(wi.XY_AXIS,t,i,a,s,r)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,a,s,r)=>e(wi.Z,t,i,a,s,r)),t,i)])}createDragPipeline(e,t,i,a){return(0,s.AL)([this.xyManipulation.createDragPipeline(((t,i,a,s,r)=>e(wi.XY,t,i,a,s,r)),t,i,a),this.xyAxisManipulation.createDragPipeline(((t,i,a,s,r)=>e(wi.XY_AXIS,t,i,a,s,r)),t,i,a),this.zManipulation.createDragPipeline(((t,i,a,s,r)=>e(wi.Z,t,i,a,s,r)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,Nt.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,Nt.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,Nt.TRANSLATE_Z)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if((0,l.Z)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const a=()=>{const t=[];this.xyAxisVisible?(0,r.pC)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(Ci),this._handles.add(t,Ci)};for(const s of i)this._handles.add(s.events.on("focus-changed",a));this._view.inputManager&&this._handles.add((0,n.gx)((()=>this._view.inputManager?.latestPointerType),a)),a()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=(0,r.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?ni:ri}}const Ci="disable-xy-axis-display";var wi;!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(wi||(wi={}));var Oi=i(2346);class Ei extends ci{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,Nt.TRANSLATE_XY)}createGraphicDragPipeline(e){return ui(this._graphicState,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,a=(0,r.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,di.Xd)(this._manipulator,((s,r,n,o,l)=>{const h=r.next((0,pi._y)(l,t,i,a)).next((0,di.AN)()).next((0,di.zh)());e(s,h,n,o,l)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new Oi.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}var Ai=i(57889),Ti=i(45900),Ri=i(87268),Gi=i(34019),Pi=i(80151),Di=i(72189),Ii=i(47898),zi=i(4943);let Vi=class extends zi.h{constructor(e){super(e),this.type="translate-graphic",this.distance=Ii.yP}};(0,a._)([(0,o.Cb)()],Vi.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Vi.prototype,"distance",void 0),Vi=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],Vi);let Li=class extends zi.h{constructor(e){super(e),this.type="translate-z",this.distance=Ii.yP}};(0,a._)([(0,o.Cb)()],Li.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Li.prototype,"distance",void 0),Li=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TranslateZTooltipInfo")],Li);let Wi=class extends zi.h{constructor(e){super(e),this.type="translate-vertex",this.distance=Ii.yP,this.elevation=null,this.area=null,this.totalLength=null}};(0,a._)([(0,o.Cb)()],Wi.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Wi.prototype,"distance",void 0),(0,a._)([(0,o.Cb)()],Wi.prototype,"elevation",void 0),(0,a._)([(0,o.Cb)()],Wi.prototype,"area",void 0),(0,a._)([(0,o.Cb)()],Wi.prototype,"totalLength",void 0),Wi=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],Wi);var Ni=i(4914);class Zi{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class Ui{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class ki{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let Hi=class extends((0,Ut.p)(ut.Z.EventedMixin(Ti.m))){constructor(e){super(e),this.graphics=new Zt.Z,this.enableZ=!0,this.tooltipOptions=new Lt.Z,this.type="move-3d",this._snappingPipeline=new Pi.n,this._tooltip=null}initialize(){const{graphics:e,view:t}=this;this.own([e.on("change",(()=>this._refreshManipulators())),(0,n.YP)((()=>this.tooltipOptions.enabled),(e=>{this._tooltip=e?new Di.u({view:t}):(0,r.SC)(this._tooltip)}),n.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,r.SC)(this._tooltip),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>(0,Ai.P)(e)===Ht.e.SUPPORTED)).map((e=>new Fi(e)));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Ei({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.handles.add([e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()})),e.events.on("grab-changed",(e=>{let{action:t}=e;const{tooltipOptions:i,_tooltip:a}=this;(0,r.Wi)(a)||("focus"===t?a.info=new Vi({tooltipOptions:i}):a.clear())}))]))),this.handles.add(t.manipulationXY.createDragPipeline(((t,i,a,s)=>this._buildDragEventPipeline(e,wi.XY,t,i,a,s))))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new xi({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?xi.radiusForSymbol(e[0].graphic.symbol):ri});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(((e,i)=>{this.handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()}))),i===Nt.TRANSLATE_XY&&this.handles.add(e.events.on("focus-changed",(e=>{let{action:t}=e;const{tooltipOptions:i,_tooltip:a}=this;(0,r.Wi)(a)||("focus"===t?a.info=new Vi({tooltipOptions:i}):a.clear())}))),i===Nt.TRANSLATE_Z&&this.handles.add(e.events.on("focus-changed",(e=>{let{action:t}=e;const{tooltipOptions:i,_tooltip:a}=this;(0,r.Wi)(a)||("focus"===t?a.info=new Li({tooltipOptions:i}):a.clear())})))}));const i=()=>this._updateMoveManipulation(e);for(const s of e)this.handles.add([s.state.on("changed",i),(0,n.YP)((()=>s.state.displaying),i)]);const a=e[e.length-1];this.handles.add(a.state.on("changed",(()=>this._updateMoveManipulationAngle(a)))),this.handles.add(t.createDragPipeline(((t,i,a,s,r)=>this._buildDragEventPipeline(e,t,i,a,s,r)),(0,p.RL)(a.graphic),(0,r.Wg)(a.graphic.geometry).spatialReference,a.graphic)),this._updateMoveManipulationAngle(a)}_createVisualElements(e){for(const t of e){const i=t.graphic,a=ai({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>(0,s.kB)()});(0,r.Wi)(a)||(t.geometryRepresentation=a.visualElement,t.geometryRepresentation instanceof xt&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this._updateMoveManipulation(e)})),(0,n.YP)((()=>t.state.isDraped),(()=>this._updateMoveManipulation(e)))]),this.handles.add(a))}}_updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>gi(e.graphic.geometry)}_updateMoveManipulation(e){const t=(0,gt.Tx)(0,0,0,this.view.spatialReference);let i=0,a=!1;const s=this._moveManipulation;for(const n of e){if(!n.state.displaying)continue;const e=n.state.graphic;this.enableZ&&Ft(e)&&(a=!0);const s=n.geometryRepresentation instanceof xt&&!n.state.isDraped?n.geometryRepresentation.attachmentOrigin:(0,kt.du)(this.view,e);(0,r.pC)(s)&&(t.x+=s.x,t.y+=s.y,t.z+=s.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,s.location=t,s.xyManipulation.available=!0,s.xyAxisManipulation.available=!0,s.zManipulation.available=a):s.available=!1}_buildDragEventPipeline(e,t,i,a,s,r){const n=[],o=[];let l=null,h=null;const c=()=>{for(const e of n)e.dragging=!1;n.length=0,o.length=0,l=null,h=null,this._moveManipulation.interactive=!0};if(1===e.length&&t===wi.XY){const t=e[0].graphic;a=this._buildSnappingPipelineSteps(t,(0,p.RL)(t),a,s,r)}const d=a.next((t=>{if("start"===t.action){n.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(n.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,l=(0,di.oq)(o,this.view.state.viewingMode),h=(0,di.QY)(o),this.emit("graphic-move-start",new Zi(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>l(e))).next((i=>this._updateMoveTooltip(i,t,e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),a=i.x-t.x,s=i.y-t.y;if(this.emit("graphic-move",new Ui(a,s,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new ki(o)),this.destroyed)return null;c()}}));return s.next((e=>h(e))).next((()=>{if(this.emit("graphic-move-stop",new ki(o)),this.destroyed)return null;c()})),d}_updateMoveTooltip(e,t,i){const{tooltipOptions:a,_tooltip:s}=this;if((0,r.Wi)(s))return e;if(s.clear(),t===wi.XY||t===wi.XY_AXIS)if("end"===e.action)s.info=new Vi({tooltipOptions:a});else{const t=0===i.length?"absolute-height":i[0].state.isDraped?"on-the-ground":"absolute-height",n=(0,P.GQ)(e.mapStart,e.mapEnd,t);(0,r.pC)(n)&&(s.info=new Vi({tooltipOptions:a,distance:n}))}return t===wi.Z&&("end"===e.action?s.info=new Li({tooltipOptions:a}):(0,r.yw)((0,Ni._e)(e.mapStart,e.mapEnd),(e=>{s.info=new Li({tooltipOptions:a,distance:e})}))),e}_buildSnappingPipelineSteps(e,t,i,a,s){const n=e.geometry;if((0,r.Wi)(n)||"point"!==n.type&&"mesh"!==n.type)return i;const o=("point"===n.type?n:n.anchor).clone(),l=new Gi.N({elevationInfo:t,pointer:s,editGeometryOperations:Ri.c.fromGeometry(o,this.view.state.viewingMode),visualizer:new Be,excludeFeature:e}),h=this.snappingManager;return i.next((t=>(o.z=(0,p.vQ)(this.view,o,(0,p.RL)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:l.coordinateHelper.pointToVector(o)}))).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:h,cancel:a,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Hi.prototype,"view",void 0),(0,a._)([(0,o.Cb)()],Hi.prototype,"graphics",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Hi.prototype,"enableZ",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Lt.Z})],Hi.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Hi.prototype,"snappingManager",void 0),(0,a._)([(0,o.Cb)()],Hi.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],Hi.prototype,"updating",null),Hi=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Hi);class Fi{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Pt({graphic:e})}get graphic(){return this.state.graphic}}var Yi=i(46684),Bi=i(29909),ji=i(55652),Xi=i(74579),Qi=i(3711);function qi(e,t,i){const a="on-the-ground"===i.mode?Qi.v.XY:Qi.v.XYZ;return new Qi.A(e,a,t,0)}function Ji(e,t,i){const a=(0,_.c)();if(!e.renderCoordsHelper.toRenderCoords(t,a))return null;const s=Ki(e,t,(0,ji.mJ)(i.plane)),n=Ki(e,t,i.edgeDirection);if((0,r.Wi)(s)||(0,r.Wi)(n))return null;const o=(0,S.f)((0,_.c)(),s,n);return(0,ji.Yq)(a,o,(0,ji.Ue)())}function Ki(e,t,i){const a=(0,gt.Tx)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),s=(0,_.c)(),r=(0,_.c)();return e.renderCoordsHelper.toRenderCoords(t,s)&&e.renderCoordsHelper.toRenderCoords(a,r)?(0,S.r)(r,s,r):null}var $i=i(63920),ea=i(153);let ta=class extends zi.h{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=Ii.yP}};(0,a._)([(0,o.Cb)()],ta.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],ta.prototype,"distance",void 0),ta=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],ta);var ia=i(21971),aa=i(13615);let sa=class extends(ut.Z.EventedMixin(Ut.r)){constructor(e){super(e),this._vertexManipulatorMaterial=(0,kt.EA)(dt.colorToVec4(dt.reshapeManipulators.vertex.color),dt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=(0,kt.qJ)(dt.colorToVec4(dt.reshapeManipulators.vertex.outlineColor),dt.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=(0,kt.qJ)(dt.colorToVec4(dt.reshapeManipulators.vertex.hoverOutlineColor),dt.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=(0,kt.EA)(dt.colorToVec4(dt.reshapeManipulators.edge.color),dt.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=(0,kt.qJ)(dt.colorToVec4(dt.reshapeManipulators.edge.outlineColor),dt.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=(0,kt.EA)(dt.colorToVec4(dt.reshapeManipulators.edgeOffset.color),dt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=(0,kt.EA)(dt.colorToVec4(dt.reshapeManipulators.edgeOffset.hoverColor),dt.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=(0,kt.EA)(dt.colorToVec4(dt.reshapeManipulators.selected.color),dt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=(0,kt.qJ)(dt.colorToVec4(dt.reshapeManipulators.selected.outlineColor),dt.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=(0,kt.qJ)(dt.colorToVec4(dt.reshapeManipulators.selected.hoverOutlineColor),dt.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new H.Z,this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=ha.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new Pi.n,this._snappingPipelineHandle=new Pi.n,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:e,view:t}=this,i=this._graphicState=new Pt({graphic:e});this._tooltip=new Di.u({view:t}),this.own([(0,n.YP)((()=>i.displaying),(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),(0,n.YP)((()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset})),(e=>{let{labels:t,enabled:i,edgeOffsetEnabled:a}=e;(0,r.pC)(t)&&(t.visible=i,t.edgeDistance=a?"far":"default")}),n.nn),(0,n.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),n.nn),this.view.trackGraphicState(i)])}destroy(){this._segmentLabels=(0,r.SC)(this._segmentLabels),this._tooltip=(0,r.SC)(this._tooltip),this._editGeometryOperations=(0,r.SC)(this._editGeometryOperations),this._moveManipulation=(0,r.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,r.SC)(this._graphicMoveManipulation),this._manipulatorHandles=(0,r.SC)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return(0,r.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=(0,r.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,r.SC)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if((0,r.Wi)(this._editGeometryOperations))return;const e=(0,p.RL)(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return(0,r.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,r.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,r.Wi)(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return(0,r.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if((0,r.Wi)(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return(0,r.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),(0,r.Wi)(e)||((0,r.SC)(this._editGeometryOperations),this._editGeometryOperations=Ri.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(),(0,r.SC)(this._segmentLabels),this._segmentLabels=new Z({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,p.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return t;let i=0;const a=[],s=this._manipulatorInfos.some((e=>"vertex"===e.type&&e.manipulator.selected)),r=e===ca.SELECTED_OR_ALL&&s;for(const n of this._manipulatorInfos)"vertex"===n.type&&(n.manipulator.grabbing||r&&!n.manipulator.selected||a.push(n),i++);if(0===a.length)return t;if(this._moveVertices(a,t),a.length===i){if(this._updateEventState(ha.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(ha.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)"vertex"===t.type&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(ha.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:a}=e;if(!t&&!i&&!a)return;const s=[];for(const r of this._manipulatorInfos)"vertex"===r.type&&(r.manipulator.selected&&!r.manipulator.grabbing||r===e.info)&&s.push(r);this._moveVertices(s,e,ea.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case ha.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case ha.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case ha.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case ha.MOVING:switch(this._reshapeEventState){case ha.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case ha.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case ha.RESHAPING:switch(this._reshapeEventState){case ha.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case ha.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){const{graphic:t,handles:i,tool:a,view:s}=this,o=this._graphicState;if(this._graphicMoveManipulation=new Ei({tool:a,view:s,graphicState:o}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,a)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=(0,r.Wg)(this._editGeometryOperations).createUndoGroup()),t))).next((e=>this._perGraphicManipulatorDragAction(ca.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(wi.XY,e),e))).next((t=>{"end"===t.action&&(this._tooltip.clear(),e=(0,r.hw)(e))})),a.next(this._cancelDragOperation((()=>e=(0,r.hw)(e))))})))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))]))),this._moveManipulation=new xi({tool:a,view:s,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Ft(t),snapToScene:!1,radius:xi.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator(((e,a)=>{i.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(i=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...i,graphic:t}),i.stopPropagation()}))]),i.add(e.events.on("focus-changed",(e=>{let{action:t}=e;"focus"===t&&this._tooltipOptions.enabled?this._updateTranslateTooltip(a===Nt.TRANSLATE_Z?wi.Z:wi.XY):this._tooltip.clear()})))})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const l=(0,r.Wg)(t.geometry).spatialReference;i.add([this._moveManipulation.createDragPipeline(((i,s,n,o,l)=>{const h=n.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));return e.manipulatorType===Nt.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:o,snappingManager:a.snappingManager,snappingContext:new Gi.N({editGeometryOperations:(0,r.Wg)(this._editGeometryOperations),elevationInfo:e,pointer:l,excludeFeature:t,visualizer:new Be}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next((0,di.AN)()).next((e=>this._perGraphicManipulatorDragAction(ca.SELECTED_OR_ALL,e))).next((e=>(this._updateTranslateTooltip(i,e),e)));return o.next(this._cancelDragOperation()),h}),e,l,t),(0,n.YP)((()=>o?.displaying),(()=>{this._updateMoveManipulationPosition()}),n.nn),o.on("changed",(()=>this._updateMoveManipulationPosition())),(0,n.YP)((()=>o?.isDraped),(e=>{const t="align-move-manipulation";e?i.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),t):i.remove(t)}),n.nn)]),this._updateMoveManipulationPosition();const h=ai({view:s,graphic:t,forEachManipulator:e=>{if(!this.destroyed){(0,r.pC)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,Nt.TRANSLATE_XY);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});(0,r.pC)(h)&&(this._outlineVisualElement=h.visualElement instanceof xt?h.visualElement:null),(0,r.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{o.isDraped||this._updateMoveManipulationPosition()})),(0,n.YP)((()=>o.isDraped),(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(h)}_createEdgeOffsetManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,p.RL)(this.graphic);const i=dt.reshapeManipulators.edgeOffset,a=i.size/2,n=a+i.collisionPadding;if((0,r.Wi)(this._edgeOffsetManipulatorGeometryInside)||(0,r.Wi)(this._edgeOffsetManipulatorGeometryOutside)){const e=a/n,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=se.Z.createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=se.Z.createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset)}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:_i.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:_i.Q9.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:_i.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:_i.Q9.Focused}],l=new Bt.Z({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||(0,Xi.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:n,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:(0,_.f)(0,0,1)},collisionPriority:1}),h=new Bt.Z({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),c={manipulator:l,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:h,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(c,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(c);const d=this._getManipulatorInfoFromHandle(c.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(c))),u=this._getManipulatorInfoFromHandle(c.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(c)));c.locationUpdateHandle=(0,s.AL)([d,u]),this._manipulatorHandles.add(c.locationUpdateHandle,l),this._manipulatorHandles.add([this._watchAndUpdateGrabState(l,!0),this._watchAndUpdateGrabState(h,!0)],l),this._manipulatorHandles.add((0,di.Xd)(l,this._createEdgeOffsetPipeline(c,t)),l),this._manipulatorHandles.add((0,di.Xd)(h,((e,i,a,s)=>{if("touch"===s)this._createEdgeOffsetPipeline(c,t)(e,i,a);else if(this.enableMoveGraphic){const s=this.graphic,n=(0,r.pC)(s.geometry)?s.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next((0,di.kY)(this.view,e.elevationAlignedLocation)).next((0,pi.G)(this.view,e.elevationAlignedLocation,t,n,s)).next((0,di.zh)()).next((0,di.AN)()).next((e=>this._perGraphicManipulatorDragAction(ca.ALL,e))).next((e=>(this._updateTranslateGraphicTooltip(wi.XY,e),e))).next((e=>{"end"===e.action&&this._tooltip.clear()})),a.next(this._cancelDragOperation())}})),l);const g=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([l.events.on("immediate-click",g),h.events.on("immediate-click",g),l.events.on("focus-changed",(e=>{let{action:t}=e;const i=this._tooltipOptions;"focus"===t&&i.enabled?this._tooltip.info=new ta({tooltipOptions:i}):this._tooltip.clear()}))],l),this._manipulatorInfos.push(c),this.manipulators.add(l),this.manipulators.add(h),this.emit("manipulators-changed"),c}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,a=e.edgeManipulator,n=()=>{(0,r.hw)(e.visibilityHandle);const n=function(e,t,i){const a=i.projectToRenderScreen(e,(0,u.J$)()),s=i.projectToRenderScreen(t,(0,u.J$)());return(0,r.pC)(a)&&(0,r.pC)(s)?(0,S.p)((0,S.b)(a,a,s)):0}(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!a.focused||n)&&(i.grabbable=!n,a.grabbable=!n,e.visibilityHandle=(0,s.AL)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",n),a.events.on("focus-changed",n),{remove:()=>{(0,r.hw)(e.visibilityHandle),this.manipulators.remove(a)}}],i),n()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=(0,r.Wg)(this._editGeometryOperations).data.coordinateHelper,i=Ji(this.view,e.manipulator.elevationAlignedLocation,qi(t,e.handle,(0,r.Wg)(e.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,s=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,n=(0,r.pC)(i)?function(e,t,i){const a=(0,ji.mJ)(e),s=(0,S.r)((0,_.c)(),t,i),r=(0,S.f)((0,_.c)(),s,a),n=(0,S.f)((0,_.c)(),s,r);return(0,K.f)(s[0],s[1],s[2],0,r[0],r[1],r[2],0,n[0],n[1],n[2],0,0,0,0,1)}(i,a,s):K.I;e.manipulator.modelTransform=n,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=n;const o=(0,S.l)((0,S.b)(oa,a,s))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,a,s)=>{this._clearSelection();const{step:n,cleanup:o}=this._initializeEdgeOffset(e,t);a.next((e=>this._trackNumDragging(e))).next((0,di.kY)(this.view,i.elevationAlignedLocation)).next(n).next((0,pi.bB)(this.view)).next((0,pi.zP)(this.view,(0,r.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,di.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(e)).next(this._showEdgeOffsetTooltip()).next((e=>{"end"===e.action&&o()})),s.next((e=>(o(),e))).next((e=>(this._tooltip.clear(),e))).next(this._cancelDragOperation())}}_initializeEdgeOffset(e,t){const i=(0,r.Wg)(this._editGeometryOperations),a=qi(i.data.coordinateHelper,e.handle,t),o=i.createUndoGroup(),l=Ji(this.view,e.manipulator.elevationAlignedLocation,a);a.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),a.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const h=()=>new Bi.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:(0,r.Wg)(this._editGeometryOperations).data.spatialReference}),c=new xt({view:this.view,isDraped:this._graphicState.isDraped,geometry:h(),elevationInfo:e.elevationInfo,width:dt.visualElements.lineGraphics.outline.width,color:dt.colorToVec4(Qe.main),attached:!0});let p;const d=()=>{this._cleanEdgeOffsetCollapsedEdges(e),p=(0,r.hw)(p)},u=this.on("undo",d);return p=(0,s.AL)([(0,s.ed)(c),(0,n.YP)((()=>this._graphicState.isDraped),(e=>c.isDraped=e)),this._graphicState.on("changed",(()=>c.geometry=h())),o,u]),{step:e=>(0,r.Wi)(a)||(0,r.Wi)(l)?(d(),null):{...e,operation:a,plane:l},cleanup:d}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||(0,r.Wi)(t.operation))return t;this._updateEventState(ha.RESHAPING);const{mapDeltaX:i,mapDeltaY:a,mapDeltaZ:s}=t;return(i||a||s)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_applyComputeEdgeOffsetDistanceStep(){return e=>{const{operation:t,mapEnd:i}=e;if((0,r.Wi)(t)||(0,r.Wi)(i))return e;const a=t.signedDistanceToPoint(i);return{...e,signedDistance:a}}}_showEdgeOffsetTooltip(){return e=>{const{mapEnd:t,signedDistance:i,operation:a}=e,s=this._tooltip,n=this._tooltipOptions;if(!n.enabled||(0,r.Wi)(i))return s.clear(),e;const o=function(e,t,i,a,s){if(e){const e=s.toXYZ(s.pointToVector(i)),n=(0,ji.nF)(a,e,Ee.WM.get()),o=(0,aa.FB)(n,e,s.spatialReference);if((0,r.pC)(o))return(0,Ii.yG)(o.value*Math.sign(t),o.unit)}return(0,Ii.yG)(t*(0,v.c9)(i.spatialReference),"meters")}(this._graphicState.isDraped,-i,t,a.plane,(0,r.Wg)(this._editGeometryOperations).data.coordinateHelper);return(0,r.Wi)(s.info)||"reshape-edge-offset"!==s.info.type?s.info=new ta({tooltipOptions:n,distance:o}):s.info.distance=o,e}}_cleanEdgeOffsetCollapsedEdges(e){const t=e.handle.leftVertex.leftEdge?.leftVertex,i=e.handle.leftVertex,a=e.handle.rightVertex.rightEdge?.rightVertex,s=e.handle.rightVertex,n=(0,r.Wg)(this._editGeometryOperations).data.coordinateHelper,o=1e-6,l=[];t&&n.distance(t.pos,i.pos)<o&&l.push(this._getManipulatorInfoFromHandle(i)),(n.distance(i.pos,s.pos)<o||a&&n.distance(a.pos,s.pos)<o)&&l.push(this._getManipulatorInfoFromHandle(s)),l.length&&this._removeVertices(l)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,p.RL)(this.graphic);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if((0,r.Wi)(this._vertexManipulatorGeometry)||(0,r.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(dt.reshapeManipulators.vertex);this._vertexManipulatorGeometry=se.Z.createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=se.Z.createSphereGeometry(t,16,16)}if((0,r.Wi)(this._edgeManipulatorGeometry)||(0,r.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(dt.reshapeManipulators.edge);this._edgeManipulatorGeometry=se.Z.createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=se.Z.createSphereGeometry(t,16,16)}const i=(0,r.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:la.Vertex|_i.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:la.Vertex|_i.Q9.Unfocused|_i.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:la.Vertex|_i.Q9.Focused|_i.Q9.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:_i.Q9.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:_i.Q9.Selected|_i.Q9.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:_i.Q9.Selected|_i.Q9.Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:la.Edge|_i.Q9.Focused|_i.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:la.Edge|_i.Q9.Focused|_i.Q9.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:la.Edge|_i.Q9.Unfocused|_i.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:la.Edge|_i.Q9.Unfocused|_i.Q9.Unselected});const a=new Bt.Z({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(a,e,t);const n="edge"===e.type?{manipulator:a,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(n),this.manipulators.add(a),this._updateManipulatorPosition(n),"edge"===n.type){const e=this._getManipulatorInfoFromHandle(n.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(n))),t=this._getManipulatorInfoFromHandle(n.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(n)));n.locationUpdateHandle=(0,s.AL)([e,t]),this._manipulatorHandles.add(n.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const o=(0,di.Xd)(a,((e,i,a,s)=>{let o=null;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(o=(0,r.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===n.type){const t=this._splitEdgeManipulator(n);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:n,snapOrigin:n.handle.pos}})).next((0,di.kY)(this.view,e.elevationAlignedLocation)).next((0,pi.VG)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:a,snappingManager:this.tool.snappingManager,snappingContext:new Gi.N({editGeometryOperations:(0,r.Wg)(this._editGeometryOperations),elevationInfo:t,pointer:s,excludeFeature:this.graphic,visualizer:new Be}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((0,di.AN)()).next((t=>{this._perVertexManipulatorDragAction(t),"end"===t.action&&(o=(0,r.hw)(o)),this._updateTranslateVertexTooltip(e,wi.XY,t)})),a.next(this._cancelDragOperation((()=>o=(0,r.hw)(o))))}));return this._manipulatorHandles.add([o,a.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,n))),a.events.on("select-changed",(()=>{n.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()})),a.events.on("focus-changed",(e=>{let{action:t}=e;"focus"===t&&"edge"!==n.type?this._updateTranslateVertexTooltip(a,wi.XY):this._tooltip.clear()}))],a),this.emit("manipulators-changed"),n}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=(0,r.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,(0,r.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case ha.NONE:break;case ha.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case ha.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(ha.NONE)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=la.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=dt.reshapeManipulators.vertex.size/2+dt.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=(0,r.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=la.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=dt.reshapeManipulators.edge.size/2+dt.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||(0,Xi.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>this._onGrabStateChanged(e,t,i.action,i.pointerType)))}_onGrabStateChanged(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(ha.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{e.manipulator.interactive=!this._numGrabbing&&(0,r.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!this._numGrabbing)})),(0,r.Wg)(this._graphicMoveManipulation).forEachManipulator((e=>e.interactive=!this._numGrabbing)))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(e.manipulator.grabbing&&this._onGrabStateChanged(e.manipulator,!1,"end"),this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=(0,r.Wg)(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,na),e.manipulator.grabbing&&(0,r.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,a=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if((0,r.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const s=i.location,r=a.location,n=.5,o=s.x+n*(r.x-s.x),l=s.y+n*(r.y-s.y),h=s.hasZ&&r.hasZ?0:void 0;e.manipulator.location=(0,gt.Tx)(o,l,h,t.data.spatialReference)}else(0,S.h)(oa,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=oa}}_splitEdgeManipulator(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;const i=(0,r.Wg)(this._editGeometryOperations),a=(0,r.Wg)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const s=(0,p.RL)(this.graphic);let n;this.enableEdgeOffset?(this._removeManipulator(e),n=this._createVertexOrEdgeManipulator(a)):(n=e,n.handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,s)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(n),this.enableEdgeOffset||this._updateTranslateVertexTooltip(n.manipulator,wi.XY),this._updateSelection(e.manipulator);const o=this._updateEventState(ha.RESHAPING),l=i.data.coordinateHelper.vectorToArray(n.handle.pos),h=i.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:l,componentIndex:h,vertexIndex:(0,r.Wg)(a.index)}],added:l}),o&&this._updateEventState(ha.NONE),n}_updateMoveManipulationPosition(){const e=(0,S.s)(oa,0,0,0);let t=0,i=!1,a=null,s=null;for(const n of this._manipulatorInfos)"vertex"===n.type&&(n.manipulator.selected?(t++,(0,S.a)(e,e,n.manipulator.renderLocation),(0,r.Wi)(a)||n.selectedIndex>a.selectedIndex?(s=a,a=n):((0,r.Wi)(s)||n.selectedIndex>s.selectedIndex)&&(s=n)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Ft(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Ft(this.graphic)}if(0!==t){let e=0;if((0,r.pC)(a)){const t=a.handle.pos,i=(0,r.pC)(s)?s.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,n=(0,r.Wi)(s)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;i&&n?this._moveManipulation.xyAxisManipulation.available=!1:i?e=ra(i,t):n&&(e=ra(t,n))}this._moveManipulation.angle=e,this._moveManipulation.radius=ni}else this._moveManipulation.angleDeferred=()=>gi((0,r.Wg)(this.graphic.geometry)),this._moveManipulation.radius=xi.radiusForSymbol(this.graphic.symbol);0!==t&&i?((0,S.g)(e,e,1/t),na.spatialReference=(0,r.Wg)(this._editGeometryOperations).data.spatialReference,na.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,na),this._moveManipulation.elevationAlignedLocation=na):(0,r.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,r.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:(0,kt.u2)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=(0,r.Wg)(this._editGeometryOperations);for(const a of e)if("vertex"===a.type&&i.canRemoveVertex()){t.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const e=(0,r.Wg)(i.removeVertices([a.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:(0,r.Wg)(e.index)}}));this.outputGeometry=i.data.geometry;const a=this._updateEventState(ha.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(a&&(this._updateEventState(ha.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?ea.O.NEW_STEP:ea.O.ACCUMULATE_STEPS;const a=(0,r.Wg)(this._editGeometryOperations);a.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=a.data.geometry;for(const s of e)this._updateManipulatorPosition(s)}_offsetEdge(e,t){if((0,r.Wi)(t.operation)||(0,r.Wi)(t.signedDistance))return;const i=(0,r.Wg)(this._editGeometryOperations),a=t.operation.clone();a.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],a),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===$i.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===$i.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){const i=this._manipulatorInfos.filter((e=>"vertex"===e.type&&e.manipulator.selected));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}_updateTranslateGraphicTooltip(e,t){const i=this._tooltipOptions;if(!i.enabled)return;const a=e===wi.Z,s=a?new Li({tooltipOptions:i}):new Vi({tooltipOptions:i});if((0,r.pC)(t)&&"end"!==t.action){const{mapStart:e,mapEnd:i}=t,n=a?(0,Ni._e)(e,i):(0,P.GQ)(e,i,this._graphicState.isDraped?"on-the-ground":"absolute-height");s.distance=(0,r.pC)(n)?n:Ii.yP}this._tooltip.info=s}_updateTranslateVertexTooltip(e,t,i){const a=this._tooltipOptions;if(!a.enabled)return;const s=t===wi.Z,n=new Wi({tooltipOptions:a});if((0,r.pC)(i)&&"end"!==i.action){const{mapStart:e,mapEnd:t}=i,a=s?(0,Ni._e)(e,t):(0,P.GQ)(e,t,this._graphicState.isDraped?"on-the-ground":"absolute-height");n.distance=(0,r.pC)(a)?a:Ii.yP}const o=(0,Ni.g1)(e.elevationAlignedLocation);(0,r.pC)(o)&&(n.elevation={mode:"absolute-height",...o});const{geometry:l}=this.graphic;(0,r.pC)(l)&&!s&&(n.area="polygon"===l.type?(0,ia.M)(l,this._graphicState.isDraped):null,n.totalLength="polyline"===l.type?(0,P.Ul)(l,this._graphicState.isDraped?"on-the-ground":"absolute-height"):null),this._tooltip.info=n}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function ra(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,a._)([(0,o.Cb)()],sa.prototype,"_segmentLabels",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],sa.prototype,"tool",void 0),(0,a._)([(0,o.Cb)()],sa.prototype,"_tooltip",void 0),(0,a._)([(0,o.Cb)()],sa.prototype,"inputGeometry",null),(0,a._)([(0,o.Cb)()],sa.prototype,"outputGeometry",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],sa.prototype,"updating",null),(0,a._)([(0,o.Cb)()],sa.prototype,"manipulators",null),(0,a._)([(0,o.Cb)()],sa.prototype,"view",null),(0,a._)([(0,o.Cb)()],sa.prototype,"graphic",null),(0,a._)([(0,o.Cb)()],sa.prototype,"enableZShape",null),(0,a._)([(0,o.Cb)()],sa.prototype,"enableZVertex",null),(0,a._)([(0,o.Cb)()],sa.prototype,"enableMoveGraphic",null),(0,a._)([(0,o.Cb)()],sa.prototype,"enableMidpoints",null),(0,a._)([(0,o.Cb)()],sa.prototype,"enableEdgeOffset",null),(0,a._)([(0,o.Cb)()],sa.prototype,"_labelOptions",null),(0,a._)([(0,o.Cb)()],sa.prototype,"_tooltipOptions",null),sa=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],sa);const na=(0,gt.Tx)(0,0,null,null),oa=(0,_.c)();var la,ha,ca;!function(e){e.Vertex=_i.jg.Custom1,e.Edge=_i.jg.Custom2}(la||(la={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(ha||(ha={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(ca||(ca={}));let pa=class extends(ut.Z.EventedMixin(Ti.m)){constructor(e){super(e),this._handles=new H.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Vt.Z,this.tooltipOptions=new Lt.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const e=this._reshapeOperation=new sa({tool:this});this.own([e.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),e.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),e.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),e.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),e.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),(0,n.YP)((()=>this.graphic),(()=>this._updateGraphic()),n.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,r.SC)(this._handles),this._reshapeOperation=(0,r.SC)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const e=(0,Yi.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,r.pC)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,Yi.P)(this.graphic)!==Ht.e.SUPPORTED)return;const e=(0,n.YP)((()=>this.graphic?.geometry),(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),n.Z_);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){(0,r.Wi)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){(0,r.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,r.pC)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){(0,r.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,r.pC)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,a._)([(0,o.Cb)()],pa.prototype,"_reshapeOperation",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],pa.prototype,"view",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],pa.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],pa.prototype,"enableZShape",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],pa.prototype,"enableZVertex",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],pa.prototype,"enableMoveGraphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],pa.prototype,"enableMidpoints",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],pa.prototype,"enableEdgeOffset",void 0),(0,a._)([(0,o.Cb)()],pa.prototype,"type",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Vt.Z})],pa.prototype,"labelOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Lt.Z})],pa.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],pa.prototype,"snappingManager",void 0),(0,a._)([(0,o.Cb)()],pa.prototype,"updating",null),(0,a._)([(0,o.Cb)()],pa.prototype,"automaticManipulatorSelection",void 0),pa=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],pa);var da=i(7882),ua=i(50951),ga=i(17768),_a=i(99346);let ma=class extends zi.h{constructor(e){super(e),this.type="transform-rotate",this.rotationType="geographic"}};(0,a._)([(0,o.Cb)()],ma.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],ma.prototype,"rotation",void 0),(0,a._)([(0,o.Cb)()],ma.prototype,"rotationPrecision",void 0),(0,a._)([(0,o.Cb)()],ma.prototype,"orientation",void 0),(0,a._)([(0,o.Cb)()],ma.prototype,"orientationPrecision",void 0),(0,a._)([(0,o.Cb)()],ma.prototype,"rotationType",void 0),ma=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],ma);let ya=class extends zi.h{constructor(e){super(e),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,a._)([(0,o.Cb)()],ya.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],ya.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],ya.prototype,"size",void 0),(0,a._)([(0,o.Cb)()],ya.prototype,"sizeUnit",void 0),(0,a._)([(0,o.Cb)()],ya.prototype,"sizePrecision",void 0),ya=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],ya);let fa=class extends zi.h{constructor(e){super(e),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var va,ba;(0,a._)([(0,o.Cb)()],fa.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"orientation",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"orientationEnabled",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"orientationPrecision",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"rotationType",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"size",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"sizeUnit",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"sizeEnabled",void 0),(0,a._)([(0,o.Cb)()],fa.prototype,"sizePrecision",void 0),fa=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],fa),function(e){e.ScaleIn=_i.jg.Custom2,e.ScaleOut=_i.jg.Custom3,e.RotateLeft=_i.jg.Custom4,e.RotateRight=_i.jg.Custom5,e.Unlocked=_i.jg.Custom7,e.DelayedFocused=_i.jg.Custom8,e.TouchInput=_i.jg.Custom12}(va||(va={}));class Ma{constructor(e){let{adapter:t,tooltipOptions:i,mode:a,tool:s}=e;this.mode=null,this._handles=new H.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new ut.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,r.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=s,this.mode=a,this.adapter=t,this._tooltipOptions=i,this._tooltip=new Di.u({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,n.gx)((()=>!this._tooltipOptions.enabled),(()=>this._tooltip.clear()),n.nn))}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}destroy(){(0,r.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,r.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,r.SC)(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=(0,_a.A)({update:t=>{let{deltaTime:i}=t;e.update(i)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){(0,r.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,r.SC)(this._activeAnimation))}forEachManipulator(e){e(this._ringManipulator,Nt.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,i=(0,di.Xd)(e,((e,i,a)=>{this._scaleRotateDragData=null;const s=this.adapter.startInteraction(),n={mode:"none",origin:(0,_.a)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this._updateDragState();const o=Ee.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),i.next((0,pi._N)(this.tool.view,(0,ji.Yq)(e.renderLocation,o,(0,ji.Ue)()))).next((e=>{const i=(0,ji.mJ)(e.plane),a=(0,kt.Gd)(e.renderStart,e.renderEnd,n.origin,i),o=ga.Q4.shortestSignedDiff(n.angle,a);n.angleDir=(0,xe.uZ)(n.angleDir+o,-.3,.3),n.angle=a;const l=function(e,t){const i=(0,S.b)(Ee.WM.get(),t.renderStart,e.origin),a=(0,S.b)(Ee.WM.get(),t.renderEnd,e.origin),s=(0,S.l)(i),r=(0,S.l)(a);return 0===s?0:r/s}(n,e),h=l-this.adapter.scale;if(n.scaleDir=(0,xe.uZ)(n.scaleDir+h,-.2,.2),this._onScaleChanged(),"none"===n.mode){const i=this.mode||function(e,t,i,a){const{renderStart:s,renderEnd:r}=e,n=Sa(s,a,Ee.WM.get()),o=Sa(r,a,Ee.WM.get());if((0,S.d)(n,o)<100)return null;const l=(0,S.b)(Ee.WM.get(),s,i),h=(0,S.f)(Ee.WM.get(),l,(0,ji.mJ)(t)),c=s,p=(0,S.a)(Ee.WM.get(),c,h),d=Sa(i,a,Ee.WM.get()),u=n,g=Sa(p,a,Ee.WM.get()),_=(0,S.b)(Ee.WM.get(),g,u),m=(0,S.b)(Ee.WM.get(),n,d),y=(0,Q.re)(u,_),f=(0,Q.re)(d,m);return(0,Q.Jk)(y,o)<(0,Q.Jk)(f,o)?"rotate":"scale"}(e,e.plane,n.origin,this.tool.view.state.camera);if((0,r.pC)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}n.mode=i}}switch(n.mode){case"rotate":s.state.angle=n.initialAngle+a;break;case"scale":s.state.scale=l,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:(0,xe.BV)(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:l,yScale:l})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:(0,xe.BV)(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:l,yScale:l})}}return"end"===e.action&&(this.startAnimation(xa(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState(),s.done()),e})).next(this._updateTooltipPipelineStep(n)),a.next((()=>{if(s.cancel(),(0,r.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(xa(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()}))}));this._handles.add([i,e.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,a=null;const s=()=>!1;return{start:()=>{a=e.getFocused,e.getFocused=s,i=0,t()},update:e=>(i+=e,!a()||i>200?ba.STOP:ba.CONTINUE),destroy:()=>{e.getFocused=a,t()}}}(this,(()=>this._updateDelayedFocusedState()))):this._updateDelayedFocusedState()})),e.events.on("immediate-click",(e=>{e.stopPropagation()})),(0,n.YP)((()=>this.tool.graphicState?.displaying),(e=>this._ringManipulator.available=e),n.nn)])}_updateTooltipPipelineStep(e){return t=>{const i=this._tooltipOptions;if(!i.enabled)return t;if("end"===t.action)return this._updateFocusTooltip(),t;const a=this._tooltip,s=this._tooltipOptions.visualVariables,n=(0,r.pC)(s)?s.size:null,o=(0,r.pC)(s)?s.rotation:null;switch(e.mode){case"scale":a.info=new ya({tooltipOptions:i,scale:{value:this.adapter.scale},size:(0,Ii.yG)((0,r.Pt)(this.adapter.size,-1),"meters"),sizeUnit:(0,r.pC)(n)?n.unit:null,sizePrecision:(0,r.pC)(n)?Ca(n.valueType):null});break;case"rotate":{const e=(0,r.pC)(o)?Ca(o.valueType):null,t=(0,r.pC)(o)?o.rotationType:"geographic";a.info=new ma({tooltipOptions:i,rotation:(0,Ii.GJ)((0,r.Pt)(-this.adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:e,orientation:(0,Ii.GJ)(-this.adapter.angle,"radians","geographic"),orientationPrecision:e,rotationType:t})}}return t}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const e=this._tooltipOptions.visualVariables,t=(0,r.pC)(e)?e.rotation:null,i=(0,r.pC)(e)?e.size:null;this._tooltip.info=new fa({tooltipOptions:this._tooltipOptions,orientation:(0,Ii.GJ)(-this.adapter.angle,"radians","geographic"),orientationEnabled:null==this.mode||"rotate"===this.mode,orientationPrecision:(0,r.pC)(t)?Ca(t.valueType):null,rotationType:(0,r.pC)(t)?t.rotationType:"geographic",size:(0,Ii.yG)((0,r.Pt)(this.adapter.size,-1),"meters"),sizeUnit:(0,r.pC)(i)?i.unit:null,sizeEnabled:null==this.mode||"scale"===this.mode,sizePrecision:(0,r.pC)(i)?Ca(i.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(va.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(va.Unlocked,!((0,r.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,r.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(va.ScaleIn|va.ScaleOut,!1),this._ringManipulator.updateStateEnabled(va.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(va.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(va.RotateLeft|va.RotateRight,!1),this._ringManipulator.updateStateEnabled(va.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(va.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(va.ScaleIn|va.ScaleOut|va.RotateLeft|va.RotateRight,!1)}_updateManipulatorTransform(){const e=(0,J.d)(Ee.MP.get(),this.adapter.angle,(0,_.f)(0,0,1));if((0,r.Wi)(e))return;const t=this.getScale(),i=(0,J.u)(Ee.MP.get(),(0,S.s)(Ee.WM.get(),t,t,t));this._ringManipulator.modelTransform=(0,J.m)(Ee.MP.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const a=[],s=Math.ceil(128*(t-e)/(2*Math.PI));for(let r=0;r<s+1;r++){const n=e+r*(t-e)/s;a.push((0,_.f)(i*Math.cos(n),i*Math.sin(n),0))}return a},t=t=>e(0,2*Math.PI,t),i=(e,t)=>se.Z.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),a=t(oi),s=i(a,24),r={left:[],right:[]},n=[];for(let p=0;p<2;p++){const t=p*Math.PI-Math.PI/4,a=Math.PI/2-li,s=t+a,o=t+Math.PI/2-a,l=e(s,o,190),h=i(l,9);n.push(l),n.push(e(s,o,201)),r.left.push(h),r.right.push(h);for(let e=0;e<2;e++){const t=0===e,i=(0,K.c)();if(t){(0,J.h)(i,i,[1,-1,1]),(0,J.e)(i,i,-s,[0,0,1]);const e=Math.round(.2*(l.length-1));i[12]=l[e][0],i[13]=l[e][1],i[14]=l[e][2]}else{(0,J.e)(i,i,o,[0,0,1]);const e=Math.round(.8*(l.length-1));i[12]=l[e][0],i[13]=l[e][1],i[14]=l[e][2]}const a=se.Z.createExtrudedTriangle(60,0,23,.5);se.Z.transformInPlace(a,i),(t?r.left:r.right).push(a)}}const o=[];for(let p=0;p<2;p++){const t=p*Math.PI-Math.PI/4,a=Math.PI/2-hi,s=t+a,r=t+Math.PI/2-a,n=e(s,r,213);o.push(i(n,9))}const l=t(190),h=t(213),c=i(l,9),d=i(h,9),u=t(130),g=t(107),m=i(u,9),y=i(g,9),f=this._createMaterial(),v=this._createMaterial(.66),b=this._createMaterial(.5),M=this._createMaterial(.33);let S=[{geometry:s,material:f,stateMask:va.DelayedFocused},{geometry:s,material:b,stateMask:_i.Q9.None}];this.mode&&"scale"!==this.mode||(S=S.concat([{geometry:o,material:f,stateMask:va.DelayedFocused|va.Unlocked},{geometry:c,material:v,stateMask:va.DelayedFocused|va.ScaleIn},{geometry:d,material:M,stateMask:va.DelayedFocused|va.ScaleIn},{geometry:m,material:v,stateMask:va.DelayedFocused|va.ScaleOut},{geometry:y,material:M,stateMask:va.DelayedFocused|va.ScaleOut}])),this.mode&&"rotate"!==this.mode||(S=S.concat([{geometry:r.right,material:f,stateMask:va.DelayedFocused|va.Unlocked},{geometry:r.left,material:f,stateMask:va.DelayedFocused|va.RotateLeft},{geometry:r.right,material:f,stateMask:va.DelayedFocused|va.RotateRight}]));const x=[a,...n];return new Bt.Z({view:this.tool.view,renderObjects:S,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,p.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:(0,_.f)(0,0,1)}})}_createMaterial(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=(0,Ce.b)([...si,e]);return new Ze.E({color:t,transparent:1!==e,cullFace:ee.Vr.Back,renderOccluded:re.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function Sa(e,t,i){return t.projectToScreen(e,wa),(0,S.s)(i,wa[0],wa[1],0)}function xa(e,t){let i=null,a=1;const s=()=>a;return{start:()=>{a=e.getScale(),i=e.getScale,e.getScale=s,t()},update:e=>(a+=((a+1)/2-a)*Math.min(3*e,1),t(),Math.abs(a-1)<.01?ba.STOP:ba.CONTINUE),destroy:()=>{e.getScale=i,t()}}}function Ca(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(ba||(ba={}));const wa=(0,u.s1)();var Oa=i(45238);function Ea(e){return(0,r.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e){return(0,r.pC)(e.transform)?function(e,t){let i=t.clone(),a=null;return{undo:t=>{a=(0,r.pC)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=(0,r.pC)(e.transform)?e.transform.clone():null,e.transform=a,t.notifyGeometryChanged()}}}(e,e.transform):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:a=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,a.notifyGeometryChanged()},redo:a=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,a.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=r.YP;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Aa=class extends Ut.r{constructor(e){super(e),this.interactionState=null}initialize(){this.own([(0,n.gx)((()=>(0,r.pC)(this.interactionState)&&this.interactionState.angle!==this.interactionState.previousAngle?{interactionState:this.interactionState,angle:this.interactionState.state.angle}:null),(e=>{let{interactionState:t}=e;this._updateMeshRotation(t)}),n.Z_),(0,n.gx)((()=>(0,r.pC)(this.interactionState)&&this.interactionState.scale!==this.interactionState.previousScale?{interactionState:this.interactionState,scale:this.interactionState.state.scale}:null),(e=>{let{interactionState:t}=e;this._updateMeshSize(t)}),n.Z_)])}get angle(){const e=this.geometry.transform;if((0,r.Wi)(e))return 0;const t=(0,Oa.ZZ)(e.rotation)[2];return Math.abs(t)>.999999?(0,xe.Vl)((0,Oa.EU)(e.rotation))*Math.sign(t):0}get scale(){return(0,r.pC)(this.interactionState)?this.interactionState.scale:1}startInteraction(){const e=new Ta({angle:this.angle});this.interactionState=e;const t=()=>this.interactionState=null;return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return Ea(this.graphic)}_updateMeshRotation(e){const t=this.geometry.anchor,i=this.viewingMode===ua.JY.Global,{angle:a,previousAngle:s}=e;this.geometry.rotate(0,0,(0,xe.BV)(a-s),{origin:t,geographic:i}),e.previousAngle=a,(0,r.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const t=this.geometry.anchor,i=this.viewingMode===ua.JY.Global,{scale:a,previousScale:s}=e;this.geometry.scale(a/s,{origin:t,geographic:i}),e.previousScale=a,(0,r.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,a._)([(0,o.Cb)({constructOnly:!0})],Aa.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Aa.prototype,"geometry",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Aa.prototype,"viewingMode",void 0),(0,a._)([(0,o.Cb)()],Aa.prototype,"angle",null),(0,a._)([(0,o.Cb)()],Aa.prototype,"scale",null),(0,a._)([(0,o.Cb)()],Aa.prototype,"interactionState",void 0),Aa=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Aa);let Ta=class extends m.Z{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,a._)([(0,o.Cb)()],Ta.prototype,"angle",void 0),(0,a._)([(0,o.Cb)()],Ta.prototype,"initialAngle",void 0),(0,a._)([(0,o.Cb)()],Ta.prototype,"previousAngle",void 0),(0,a._)([(0,o.Cb)()],Ta.prototype,"previousScale",void 0),(0,a._)([(0,o.Cb)()],Ta.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],Ta.prototype,"state",null),Ta=(0,a._)([(0,c.j)("InteractionState")],Ta);let Ra=class extends Ut.r{constructor(e){super(e),this.sizeAxis=null,this.interactionState=null}initialize(){this.own((0,n.gx)((()=>(0,r.pC)(this.interactionState)?this.interactionState.state:null),(e=>{this._updateSymbol(e)}),n.Z_))}get angle(){return(0,r.pC)(this.interactionState)?this.interactionState.angle:(0,r.pC)(this._orientationReferenceSymbolLayer)?function(e){return-(0,xe.Vl)(e)}(this._orientationReferenceSymbolLayer.heading):0}get scale(){return(0,r.pC)(this.interactionState)?this.interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,r.pC)(this.interactionState)?this.interactionState.initialAngle:0}get size(){const e=this._sizeReferenceSymbolLayer;if((0,r.Wi)(e))return null;const t=this.findLayerView(),i=this._graphicSymbol;if((0,r.Wi)(t)||(0,r.Wi)(i)||"point-3d"!==i.type)return null;const a=t.getSymbolLayerSize(i,e);if("size"in a&&(0,r.pC)(a.size))return a.size;const s=this.sizeAxis;return"width"in a&&(0,r.pC)(a.width)&&((0,r.Wi)(s)||"width"===s||"all"===s||"width-and-depth"===s)?a.width:"depth"in a&&(0,r.pC)(e.depth)&&((0,r.Wi)(s)||"depth"===s||"all"===s||"width-and-depth"===s)?a.depth:"height"in a&&(0,r.pC)(e.height)&&((0,r.Wi)(s)||"height"===s||"all"===s)?a.height:null}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,r.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type))}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return(0,r.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((e=>"object"===e.type&&(0,r.pC)(e.heading)))}get _graphicSymbol(){return(0,r.pC)(this.graphic)&&(0,r.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if((0,r.pC)(this.interactionState)||(0,r.Wi)(e)||(0,r.Wi)(t))return Ga;const i=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray(),a=e.clone(),s=this.angle,n=new Pa({originalSymbol:a,angle:s,initialSizes:i});this.interactionState=n;const o=()=>this.interactionState=null;return{state:n,done:o,cancel:()=>{this._graphicSymbol=a,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e},redo:i=>{e=i.symbol,i.symbol=t}}}_updateSymbol(e){let{scale:t,angle:i,originalSymbol:a,initialSizes:s}=e;const n=this._graphicSymbol;if((0,r.Wi)(n)||"point-3d"!==n.type)return;const o=n.clone(),l=-(0,xe.BV)(i-this.initialAngle);let h=!1;this._forEachObjectSymbolLayerPair(a,o,((e,i,a)=>{const n=(0,r.Pt)(e.heading,0)+l;i.heading!==n&&(i.heading=n,h=!0);const o=s[a];if((0,r.pC)(o)&&"width"in o){o.width=this.sizeFilter(o.width),o.height=this.sizeFilter(o.height),o.depth=this.sizeFilter(o.depth);const e=o.width*t;i.width!==e&&(i.width=e,h=!0);const a=o.depth*t;i.depth!==a&&(i.depth=a,h=!0);const s=o.height*t;i.height!==s&&(i.height=s,h=!0)}})),h&&(this._graphicSymbol=o)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,a)=>{const s=t.symbolLayers.getItemAt(a);"object"===e.type&&"object"===s.type&&i(e,s,a)}))}};(0,a._)([(0,o.Cb)()],Ra.prototype,"angle",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"scale",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"relativeAngle",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"initialAngle",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"size",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"sizeAxis",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Ra.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)()],Ra.prototype,"interactionState",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Ra.prototype,"findLayerView",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0})],Ra.prototype,"sizeFilter",void 0),(0,a._)([(0,o.Cb)()],Ra.prototype,"_sizeReferenceSymbolLayer",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"_orientationReferenceSymbolLayer",null),(0,a._)([(0,o.Cb)()],Ra.prototype,"_graphicSymbol",null),Ra=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Ra);const Ga={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Pa=class extends m.Z{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}get state(){const{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:s}=this;return{originalSymbol:e,angle:t,initialAngle:i,scale:a,initialSizes:s}}};(0,a._)([(0,o.Cb)()],Pa.prototype,"originalSymbol",void 0),(0,a._)([(0,o.Cb)()],Pa.prototype,"angle",void 0),(0,a._)([(0,o.Cb)()],Pa.prototype,"initialAngle",void 0),(0,a._)([(0,o.Cb)()],Pa.prototype,"initialSizes",void 0),(0,a._)([(0,o.Cb)()],Pa.prototype,"scale",void 0),(0,a._)([(0,o.Cb)()],Pa.prototype,"state",null),Pa=(0,a._)([(0,c.j)("InteractionState")],Pa);let Da=class extends((0,Ut.p)(ut.Z.EventedMixin(Ti.m))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Lt.Z,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new Pi.n,this._tooltip=null}initialize(){const{graphic:e,view:t}=this;this.graphicState=new Pt({graphic:e}),this.own((0,n.YP)((()=>this.tooltipOptions.enabled),(e=>{this._tooltip=e?new Di.u({view:t}):(0,r.SC)(this._tooltip)}),n.tX)),this._moveManipulation=new xi({tool:this,view:t,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ft(e),radius:xi.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator(((t,i)=>this.handles.add([t.events.on("immediate-click",(t=>{this.emit("immediate-click",{...t,graphic:e}),t.stopPropagation()})),t.events.on("focus-changed",(e=>{let{action:t}=e;const{tooltipOptions:a,_tooltip:s}=this;if(!(0,r.Wi)(s)&&(s.clear(),"focus"===t)){const e=i===Nt.TRANSLATE_Z?Li:Vi;s.info=new e({tooltipOptions:a})}}))]))),this._moveManipulation.elevationInfo=(0,p.RL)(e);const i=e.geometry;if(this._moveManipulation.createGraphicDragPipeline(((a,s,n,o,l)=>((0,r.pC)(i)&&a===wi.XY&&(n=n.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Gi.N({elevationInfo:(0,p.RL)(e),pointer:l,editGeometryOperations:Ri.c.fromGeometry(new da.Z({spatialReference:i.spatialReference}),t.state.viewingMode),visualizer:new Be,excludeFeature:e}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:o}),this._snappingPipeline.next)),n.next((e=>{const{tooltipOptions:t,_tooltip:i}=this;if((0,r.Wi)(i))return e;const{mapStart:s,mapEnd:n}=e;i.clear();const o=a===wi.Z?Li:Vi;if("end"===e.action)i.info=new o({tooltipOptions:t});else{const e=a===wi.Z?(0,Ni._e)(s,n):(0,P.GQ)(s,n,this.graphicState.isDraped?"on-the-ground":"absolute-height");(0,r.pC)(e)&&(i.info=new o({tooltipOptions:t,distance:e}))}return e})))),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:a,dyScreen:s}=e,r={graphic:i,dxScreen:a,dyScreen:s};switch(t){case"start":this.emit("graphic-translate-start",r),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",r);break;case"end":this.emit("graphic-translate-stop",r)}})),this._moveManipulation.angle=(0,r.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,n.YP)((()=>this._scaleRotateAdapter.angle),(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Ma({tool:this,mode:e,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([ai({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.kB)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),(0,n.YP)((()=>t.scale),(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof Bt.Z&&this.handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}destroy(){this._tooltip=(0,r.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,r.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,r.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,r.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,r.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Aa({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Ra({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer)),sizeAxis:(0,r.pC)(this.tooltipOptions.visualVariables)&&(0,r.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(e){this._moveManipulation.forEachManipulator(e),(0,r.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return(0,n.YP)((()=>this.graphicState.displaying),(e=>{this._forEachManipulator((t=>t.available=e)),this._moveManipulation.zManipulation.available=e&&this.enableZ&&Ft(this.graphic)}))}_createGeometryUndoRecord(){return Ea(this.graphic)}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this._moveManipulation.location=e,(0,r.pC)(this._scaleRotate)&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,(0,r.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){(0,r.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,r.Wi)(this._scaleRotate))return;const e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}_updateMoveAngle(){this.view.state.viewingMode===ua.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){(0,kt.u2)(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,r.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Da.prototype,"view",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Da.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],Da.prototype,"enableZ",void 0),(0,a._)([(0,o.Cb)()],Da.prototype,"enableRotation",void 0),(0,a._)([(0,o.Cb)()],Da.prototype,"enableScaling",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Lt.Z})],Da.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)()],Da.prototype,"graphicState",void 0),(0,a._)([(0,o.Cb)({value:!1})],Da.prototype,"snapToScene",null),(0,a._)([(0,o.Cb)({constructOnly:!0})],Da.prototype,"snappingManager",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],Da.prototype,"type",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],Da.prototype,"updating",null),Da=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Da);var Ia=i(82218),za=(i(59486),i(11582)),Va=i(46784),La=i(89125),Wa=i(66576);let Na=class extends((0,za.J)(Va.wq)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,r._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};(0,a._)([(0,o.Cb)({readOnly:!0,json:{read:!1,write:!0}})],Na.prototype,"type",void 0),(0,a._)([(0,o.Cb)({type:da.Z}),(0,Wa.B)()],Na.prototype,"position",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Wa.B)(),(0,La.p)((e=>ga.BV.normalize((0,h.q9)(e),0,!0)))],Na.prototype,"heading",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Wa.B)(),(0,La.p)((e=>ga.BV.normalize((0,h.q9)(e),0,!0)))],Na.prototype,"tilt",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0}),(0,Wa.B)()],Na.prototype,"width",void 0),(0,a._)([(0,o.Cb)({type:Number,nonNullable:!0}),(0,Wa.B)()],Na.prototype,"height",void 0),Na=(0,a._)([(0,c.j)("esri.analysis.SlicePlane")],Na);var Za=i(48976),Ua=(i(14320),i(40927));(0,l.Z)("mac"),Math.cos((0,xe.Vl)(45)),Math.cos((0,xe.Vl)(5));const ka=(0,_.f)(1,.5,0),Ha=((0,Ce.b)([...ka,.7]),(0,Ce.b)([...ka,.5]),(0,Ce.b)([...ka,1])),Fa=(0,Ce.f)(1,1,1,1),Ya=(0,Ce.f)(1,.8,.6,1),Ba=(0,Ce.f)(1,.93,.86,1),ja=(0,Ce.b)([...ka,1]),Xa=(0,Ce.b)([...ka,1]),Qa=40,qa=(0,Ce.b)([...ka,1]);(0,K.c)();var Ja=i(71011),Ka=(i(23620),i(93822)),$a=i(64226),es=i(22909),ts=(i(98634),i(82144)),is=i(31132),as=i(7566),ss=i(27627),rs=i(11316),ns=i(8548),os=i(36207);class ls extends is.A{initializeProgram(e){const t=ls.shader.get().build(this.configuration);return new ss.$(e.rctx,t,as.i)}initializePipeline(){return(0,os.sm)({blending:(0,os.wK)(ns.zi.ONE,ns.zi.ONE,ns.zi.ONE_MINUS_SRC_ALPHA,ns.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:ns.wb.LESS},colorWrite:os.BK})}}ls.shader=new ts.J(rs.S,(()=>i.e(8492).then(i.bind(i,18492))));i(78952),i(92183),i(23470);(0,_.c)();(0,_.c)();i(92028);var hs=i(81703),cs=i(94425),ps=i(17363),ds=i(78041),us=i(33559),gs=i(50411),_s=i(8883),ms=i(32500);class ys extends is.A{initializeProgram(e){const t=ys.shader.get().build(this.configuration);return new ss.$(e.rctx,t,as.i)}_setPipelineState(e,t){const i=this.configuration,a=e===ee.Am.NONE,s=e===ee.Am.FrontFace;return(0,os.sm)({blending:i.output!==Ja.H.Color&&i.output!==Ja.H.Alpha||!i.transparent?null:a?fs:(0,ds.j7)(e),culling:(0,os.zp)(i.cullFace),depthTest:{func:(0,ds.Bh)(e)},depthWrite:a?i.writeDepth&&os.LZ:(0,ds.K5)(e),colorWrite:os.BK,stencilWrite:i.hasOccludees?gs.s3:null,stencilTest:i.hasOccludees?t?gs.eD:gs.RY:null,polygonOffset:a||s?null:(0,ds.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}ys.shader=new ts.J(ms.I,(()=>i.e(8957).then(i.bind(i,18957))));const fs=(0,os.if)(ns.zi.ONE,ns.zi.ONE_MINUS_SRC_ALPHA);class vs extends _s.W{constructor(){super(...arguments),this.output=Ja.H.Color,this.cullFace=ee.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=ee.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,a._)([(0,us.o)({count:Ja.H.COUNT})],vs.prototype,"output",void 0),(0,a._)([(0,us.o)({count:ee.Vr.COUNT})],vs.prototype,"cullFace",void 0),(0,a._)([(0,us.o)()],vs.prototype,"hasSlicePlane",void 0),(0,a._)([(0,us.o)()],vs.prototype,"transparent",void 0),(0,a._)([(0,us.o)()],vs.prototype,"enableOffset",void 0),(0,a._)([(0,us.o)()],vs.prototype,"writeDepth",void 0),(0,a._)([(0,us.o)()],vs.prototype,"hasOccludees",void 0),(0,a._)([(0,us.o)({count:ee.Am.COUNT})],vs.prototype,"transparencyPassType",void 0),(0,a._)([(0,us.o)()],vs.prototype,"hasMultipassTerrain",void 0),(0,a._)([(0,us.o)()],vs.prototype,"cullAboveGround",void 0);class bs extends re.F5{constructor(e){super(e,new Ss),this.supportsEdges=!0,this.techniqueConfig=new vs}getConfiguration(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<ds.ve,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(e,t,i,a,s,r,n){(0,es.Bw)(e,t,a,s,r,void 0,n)}requiresSlot(e,t){return e===Ka.r.DRAPED_MATERIAL||((0,cs.S)(t)===Ja.H.Highlight?e===Ka.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Ka.r.TRANSPARENT_MATERIAL:Ka.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ka.r.OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===Ja.H.Color||e.output===Ja.H.Alpha||e.output===Ja.H.Highlight?new Ms(e):void 0}createBufferWriter(){return new $a.G_($a.W1)}}class Ms extends ps.F{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ys,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==Ja.H.Color&&this._output!==Ja.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}class Ss extends re.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ee.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}var xs=i(24231);i(53866);g.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");var Cs;function ws(e,t){switch(t){case Cs.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,S.a)(Ee.WM.get(),e.origin,e.basis1),edge:t};case Cs.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,S.a)(Ee.WM.get(),e.origin,e.basis2),edge:t};case Cs.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,S.b)(Ee.WM.get(),e.origin,e.basis1),edge:t};case Cs.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,S.b)(Ee.WM.get(),e.origin,e.basis2),edge:t}}}function Os(e){const t=(0,S.l)(e.basis1),i=(0,S.l)(e.basis2);return.3*Math.min(t,i)}function Es(e){return Os(e)}function As(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Ts(e,t){const i=As(t),a=i?[(0,_.f)(1,0,0),(0,_.f)(0,0,0),(0,_.f)(0,1,0)]:[(0,_.f)(1,0,0),(0,_.f)(-1,0,0)],s=se.Z.createPolylineGeometry(a),r=qa,n=i?4:1,o=2*n,l=e=>e>1?(e=>new oe.U({color:r,width:e,renderOccluded:re.yD.OccludeAndTransparent}))(e):new xs.Y({color:r,renderOccluded:re.yD.OccludeAndTransparent}),h=[{geometry:s,material:l(n),stateMask:_i.Q9.Unfocused|Ns},{geometry:s,material:l(o),stateMask:_i.Q9.Focused|Ns},{geometry:s,material:l(1),stateMask:Zs}],c=new Bt.Z({view:e,renderObjects:h,collisionType:{type:"line",paths:[a]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4});return c.state=Ns,c}function Rs(e,t,i){const a=a=>{const s=(a?t:e).slice(0),n=(0,S.b)(Ee.WM.get(),s[0],s[1]);(0,S.n)(n,n);const o=(0,S.b)(Ee.WM.get(),s[s.length-1],s[s.length-2]);if((0,S.n)(o,o),i.padding>0){const e=(0,S.g)((0,_.c)(),o,-i.padding);if(s[s.length-1]=(0,S.a)(e,e,s[s.length-1]),i.bothEnds){const e=(0,S.g)((0,_.c)(),n,-i.padding);s[0]=(0,S.a)(e,e,s[0])}}const l=a?i.tipFocusMultiplier:1,h=i.tipLength*(i.focusTipLength?l:1),c=i.tipRadius*l,p=(0,J.i)(Ee.MP.get());if(i.padding>0){const e=h/4,t=(0,S.s)(Ee.WM.get(),0,e,0),a=1+i.padding/e;(0,J.j)(p,p,t),(0,J.h)(p,p,(0,S.s)(Ee.WM.get(),a,a,a)),(0,J.j)(p,p,(0,S.g)(t,t,-1/a))}const d=(0,J.i)((0,K.c)()),u=(0,_.f)(0,1,0),g=(0,J.k)((0,K.c)(),(0,Za.r)(Ee.vD.get(),u,o));g[12]=s[s.length-1][0],g[13]=s[s.length-1][1],g[14]=s[s.length-1][2],(0,J.m)(g,g,p);const m=[{part:"tube",geometry:Gs(i.tubeRadius*(a?i.tubeFocusMultiplier:1)+i.padding,i.flat,s),transform:d}];let y,f;if((0,r.pC)(i.flat)?y=se.Z.createExtrudedTriangle(h,c,c,i.flat.thickness):(y=se.Z.createConeGeometry(h,c,24,!1,!1,!0),f=se.Z.createConeGeometry(h,c,24,!1,!0,!1)),m.push({part:"tip",geometry:y,transform:g}),f&&m.push({part:"cap",geometry:f,transform:g}),i.bothEnds){const e=(0,J.k)((0,K.c)(),(0,Za.r)(Ee.vD.get(),u,n));e[12]=s[0][0],e[13]=s[0][1],e[14]=s[0][2],(0,J.m)(e,e,p),m.push({part:"tip",geometry:y,transform:e}),f&&m.push({part:"cap",geometry:f,transform:e})}return m};return{normal:a(!1),focused:a(!0)}}function Gs(e,t,i){const a=[];if((0,r.pC)(t))a.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const s=i/t*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}}return se.Z.createPathExtrusionGeometry(a,i,[],[],!1)}function Ps(e,t){const i=(0,S.b)((0,_.c)(),e[e.length-1],e[e.length-2]);if((0,S.n)(i,i),(0,S.g)(i,i,12),(0,S.a)(i,i,e[e.length-1]),t){const t=(0,S.b)((0,_.c)(),e[0],e[1]);return(0,S.n)(t,t),(0,S.g)(t,t,12),(0,S.a)(t,t,e[0]),[t,...e,i]}return[...e,i]}function Ds(e,t){return(0,Ua.cp)(t,e.basis2,e.basis1)+Ws}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(Cs||(Cs={}));const Is=_i.jg.Custom1;var zs,Vs;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(zs||(zs={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(Vs||(Vs={}));const Ls=_i.jg.Custom2,Ws=((0,Q.Ue)(),Math.PI/2),Ns=_i.jg.Custom1,Zs=_i.jg.Custom2;var Us;!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Us||(Us={}));const ks="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",Hs={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};class Fs{constructor(){this.lastDragEvent=null,this.next=new di.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,r.pC)(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=As(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}var Ys=i(34778),Bs=i(254),js=i(12225),Xs=i(29014);function Qs(e,t){return Js(e,t,!1)}function qs(e,t){return Js(e,t,!0)}function Js(e,t,i){if(e instanceof Ys.y){if(e.operation instanceof Bs.z)return function(e,t){const i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,a=(0,_.f)(i*e.dx,i*e.dy,i*e.dz);(0,S.a)(t.origin,t.origin,a)}(e.operation,t,i),!0;if(e.operation instanceof js.S)return function(e,t){const i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;(0,S.H)(t.basis1,t.basis1,_.Z,i),(0,S.H)(t.basis2,t.basis2,_.Z,i)}(e.operation,t,i),!0;if(e.operation instanceof Xs.q)return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=i?1/e.factor1:e.factor1,s=i?1/e.factor2:e.factor2;(0,S.g)(t.basis1,t.basis1,a),(0,S.g)(t.basis2,t.basis2,s),(0,b.q)(t.origin,t.origin,e.origin,e.axis1,a),(0,b.q)(t.origin,t.origin,e.origin,e.axis2,s)}(e.operation,t,i),!0}return!1}function Ks(e,t,i,a){const s=Ee.WM.get();(0,S.b)(s,(0,S.b)(s,e.origin,e.basis1),e.basis2);const n=Ee.WM.get();(0,S.C)(n,s,e.basis1,2);const o=Ee.WM.get();(0,S.C)(o,n,e.basis2,2);const l=Ee.WM.get();(0,S.C)(l,s,e.basis2,2),s[2]=n[2]=o[2]=l[2]=t;const h=a?"on-the-ground":"absolute-height",c=(0,Ii.Fp)((0,P.bZ)(s,n,i,h),(0,P.bZ)(l,o,i,h)),p=(0,Ii.Fp)((0,P.bZ)(n,o,i,h),(0,P.bZ)(s,l,i,h));return(0,r.Wi)(p)||(0,r.Wi)(c)?null:[c,p]}let $s=class extends zi.h{constructor(e){super(e),this.type="extent-rotate",this.angle=0}};(0,a._)([(0,o.Cb)()],$s.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],$s.prototype,"angle",void 0),$s=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],$s);let er=class extends zi.h{constructor(e){super(e),this.type="extent-scale",this.xScale=0,this.yScale=0,this.xSize=Ii.yP,this.ySize=Ii.yP}};(0,a._)([(0,o.Cb)()],er.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],er.prototype,"xScale",void 0),(0,a._)([(0,o.Cb)()],er.prototype,"yScale",void 0),(0,a._)([(0,o.Cb)()],er.prototype,"xSize",void 0),(0,a._)([(0,o.Cb)()],er.prototype,"ySize",void 0),er=(0,a._)([(0,c.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],er);let tr=class extends(ut.Z.EventedMixin(Ti.m)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Lt.Z,this._preserveAspectRatio=new Fs,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new H.Z,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=(0,Ia.c)(),this.mapBoundsStart=(0,Ia.c)(),this.zmax=0,this.sizeStart=null,this.displayBounds=(0,Ia.c)(),this.displayBoundsStart=(0,Ia.c)(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,M.a)(),this._endScale=(0,M.a)()}initialize(){const{view:e,graphic:t,manipulators:i,handles:a}=this,o=this.graphicState=new Pt({graphic:t}),l=t.geometry;this.editGeometryOperations=Ri.c.fromGeometry(l,e.state.viewingMode),this.graphicMoveManipulation=new Ei({tool:this,view:e,graphicState:o}),this.moveZManipulator=function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Us.CENTER_ON_ARROW)===Us.CENTER_ON_CALLOUT?Qa:0,i=[(0,_.f)(t,0,-24),(0,_.f)(t,0,24)],a=Ps(i,!0),s=(e,t)=>Rs(i,i,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),r=s(0,!1),n=s(2.25,!0),o=new Ze.E({color:Fa,cullFace:ee.Vr.Back,renderOccluded:re.yD.Opaque}),l=new Ze.E({color:Ya,cullFace:ee.Vr.Back,renderOccluded:re.yD.Opaque}),h=new Ze.E({color:Ba,cullFace:ee.Vr.Back,renderOccluded:re.yD.Opaque}),c=new Ze.E({color:Xa,transparent:!0,writeDepth:!1,cullFace:ee.Vr.Front,renderOccluded:re.yD.Transparent}),p=se.Z.createPolylineGeometry([[t,0,0],[t-Qa,0,0]]),d=se.Z.createPolylineGeometry([[t,0,0],[t-Qa,0,0]]),u=new xs.Y({color:ja,renderOccluded:re.yD.OccludeAndTransparent});return new Bt.Z({view:e,renderObjects:[...r.normal.map((e=>{let{part:t,geometry:i,transform:a}=e;return{geometry:i,material:"tip"===t?o:"cap"===t?l:h,transform:a,stateMask:_i.Q9.Unfocused|Is}})),...n.normal.map((e=>{let{geometry:t,transform:i}=e;return{geometry:t,material:c,transform:i,stateMask:_i.Q9.Unfocused|Is}})),{geometry:p,material:u,stateMask:_i.Q9.Unfocused|Is|Ls},...r.focused.map((e=>{let{part:t,geometry:i,transform:a}=e;return{geometry:i,material:"tip"===t?o:"cap"===t?l:h,transform:a,stateMask:_i.Q9.Focused|Is}})),...n.focused.map((e=>{let{geometry:t,transform:i}=e;return{geometry:t,material:c,transform:i,stateMask:_i.Q9.Focused|Is}})),{geometry:d,material:u,stateMask:_i.Q9.Focused|Is|Ls}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[a]},collisionPriority:1,radius:11,state:Is})}(e,Us.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Ls,a.add([this._createMoveXYGraphicDragPipeline(),(0,n.YP)((()=>this.enableZ),(()=>this._updateManipulatorAvailability(this.moveZManipulator,Nt.TRANSLATE_Z))),this._createMoveZDragPipeline()]),i.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((t=>{const i=Ts(e,t);return a.add([(0,n.YP)((()=>this.enableScaling),(()=>this._updateManipulatorAvailability(i,Nt.SCALE))),i.events.on("grab-changed",(e=>this._onResizeGrab(e))),this._createResizeDragPipeline(i,t)]),i})),i.addMany(this.resizeManipulators),this.rotateManipulatorTexture=function(e){return e.fromData(ks,(()=>new Te.x(ks,Hs)))}(e.toolViewManager.textures),this.rotateManipulator=function(e,t){const i=new bs({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:re.yD.Opaque}),a=40,s=27*1.1,r=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new Ne.Z([[ne.T.POSITION,{size:3,data:[a-e,-e,0,a+e,-e,0,a+e,e,0,a-e,e,0],exclusive:!0}],[ne.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[ne.T.POSITION,t],[ne.T.UV0,t]])},n=se.Z.createPolylineGeometry([[0,0,0],[13,0,0]]),o=se.Z.createPolylineGeometry([[0,0,0],[a-s,0,0]]),l=new xs.Y({color:Ha,renderOccluded:re.yD.OccludeAndTransparent}),h=[{geometry:r(27),material:i,stateMask:_i.Q9.Unfocused|Is},{geometry:n,material:l,stateMask:_i.Q9.Unfocused|Is},{geometry:r(s),material:i,stateMask:_i.Q9.Focused|Is},{geometry:o,material:l,stateMask:_i.Q9.Focused|Is}];return new Bt.Z({view:e,renderObjects:h,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},collisionPriority:1,radius:13.5,state:Is})}(e,this.rotateManipulatorTexture.texture),a.add([(0,n.YP)((()=>this.enableRotation),(()=>this._updateManipulatorAvailability(this.rotateManipulator,Nt.ROTATE))),this.rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this._createRotateDragPipeline(this.rotateManipulator)]),i.add(this.rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const h=ai({view:e,graphic:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>(0,s.kB)()});(0,r.pC)(h)&&(this.outlineVisualElement=h.visualElement instanceof xt?h.visualElement:null),(0,r.pC)(this.outlineVisualElement)&&a.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),a.add(h),a.add([o.on("changed",(()=>this._onGeometryChanged())),(0,n.YP)((()=>o.displaying),(()=>this._updateAllManipulatorAvailability())),(0,n.YP)((()=>o.isDraped),(()=>this._graphicDrapedChanged()),n.nn),e.trackGraphicState(o)]);const c=e.pointsOfInterest;c&&a.add((0,n.YP)((()=>c.centerOnSurfaceFrequent.location),(()=>this._updateDisplayBounds())));this._forEachManipulator((e=>{a.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((e,i)=>{a.add(e.events.on("immediate-click",(e=>{i===Nt.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:t}),e.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this.mapBounds=null,this.displayBounds=null,this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{handles:e,view:t}=this,i=this._tooltip=new Di.u({view:t}),a=()=>{i.info=this._getUpdatedTooltipInfo()};e.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()})),this.on("graphic-rotate-start",(e=>{this._startAngle=e.angle,a()})),this.on("graphic-rotate",(e=>{this._endAngle=e.angle,a()})),this.on("graphic-rotate-stop",(()=>{this._startAngle=0,this._endAngle=0,a()})),this.on("graphic-scale-start",(e=>{(0,b.a)(this._startScale,e.xScale,e.yScale),(0,b.a)(this._endScale,e.xScale,e.yScale),a()})),this.on("graphic-scale",(e=>{(0,b.a)(this._endScale,e.xScale,e.yScale),a()})),this.on("graphic-scale-stop",(()=>{(0,b.a)(this._startScale,0,0),(0,b.a)(this._endScale,0,0),a()}))]),this._forEachManipulator((t=>{e.add([t.events.on("focus-changed",a),t.events.on("grab-changed",a),t.events.on("drag",(e=>{"cancel"===e.action?this._tooltip.clear():a()}))])}))}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this.graphicMoveManipulation.grabbing||this.graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():this.rotateManipulator.focused?this._computeRotateTooltipInfo():this.resizeManipulators.some((e=>e.focused))?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,r.Pt)(this._moveXYTooltipInfo,(()=>new Vi({tooltipOptions:this.tooltipOptions})))}_computeMoveZTooltipInfo(){const e=this._moveZTooltipInfo=(0,r.Pt)(this._moveZTooltipInfo,(()=>new Li({tooltipOptions:this.tooltipOptions}))),t=this._moveUnit;if(this.moveZManipulator.dragging){const t=this.mapBoundsStart.origin,i=this.mapBounds.origin,a=(0,Ni.Cr)(t,i,this.view.spatialReference);if((0,r.Wi)(a))return null;e.distance=a}else e.distance=(0,Ii.yG)(0,t);return e}_computeRotateTooltipInfo(){const e=this._rotateTooltipInfo=(0,r.Pt)(this._rotateTooltipInfo,(()=>new $s({tooltipOptions:this.tooltipOptions})));return e.angle=this._startAngle-this._endAngle,e}_computeScaleTooltipInfo(){const e=this.graphic.geometry;if((0,r.Wi)(e))return null;const t=this._scaleTooltipInfo=(0,r.Pt)(this._scaleTooltipInfo,(()=>new er({tooltipOptions:this.tooltipOptions}))),i=Ks(this.mapBounds,this.zmax,e.spatialReference,this.graphicState.isDraped);return(0,r.Wi)(i)?null:(t.xSize=i[0],t.ySize=i[1],(0,r.pC)(this.sizeStart)&&this.resizeManipulators.some((e=>e.dragging))?(t.xScale=i[0].value/this.sizeStart[0].value,t.yScale=i[1].value/this.sizeStart[1].value):(t.xScale=1,t.yScale=1),t)}_graphicDrapedChanged(){this.handles.remove(ir),this._updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(e=>{(0,r.pC)(this.attachmentOrigin)&&(0,Kt.jE)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this._updateDisplayBounds()})),ir)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof Bt.Z){const a=this.graphicState.displaying,s=this.enableZ&&Ft(this.graphic);switch(t){case Nt.ROTATE:e.available=a&&this.enableRotation;break;case Nt.SCALE:e.available=a&&(this.enableScaling||this.enableRotation||s),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Ns:Zs;break;case Nt.TRANSLATE_Z:e.available=a&&s;break;default:e.available=a}}}_forEachManipulator(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((t=>e(t,Nt.SCALE))),e(this.rotateManipulator,Nt.ROTATE),e(this.moveZManipulator,Nt.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}get _moveUnit(){return(0,r.Pt)((0,v.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],a=(0,b.g)(Ee.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,b.i)(a,a);const s=(0,r.Pt)((0,kt.du)(this.view,this.graphic),(()=>e.extent.center));let n=sr*this.view.pixelSizeAt(s);const o=this.view.spatialReference,l=e.spatialReference;o.equals(l)||(n*=(0,v.c9)(o)/(0,v.c9)(l)),function(e,t,i,a){a||(a=(0,Ia.c)());const s=(0,b.a)(Ee.qW.get(),e[1],-e[0]),r=(0,b.a)(Ee.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=(0,b.a)(Ee.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=Ee.qW.get();t.components.forEach((t=>t.vertices.forEach((t=>{const i=t.pos;(0,b.a)(o,(0,b.h)(e,i),(0,b.h)(s,i)),(0,b.x)(r,r,o),(0,b.y)(n,n,o)}))));const l=1e-6,h=(0,b.a)(Ee.qW.get(),n[0]-r[0]<l?i/2:0,n[1]-r[1]<l?i/2:0);(0,b.g)(r,r,h),(0,b.b)(n,n,h),(0,b.f)(a.basis1,e,(n[0]-r[0])/2),(0,b.f)(a.basis2,s,(n[1]-r[1])/2),(0,b.a)(a.origin,r[0]*e[0]+r[1]*s[0],r[0]*e[1]+r[1]*s[1]),(0,b.b)(a.origin,a.origin,a.basis1),(0,b.b)(a.origin,a.origin,a.basis2)}(a,t,n,this.mapBounds),this._calculateZMax()}_calculateZMax(){const e=this.editGeometryOperations.data;if(!e.geometry.hasZ)return void(this.zmax=0);const t=e.coordinateHelper;let i=Number.NEGATIVE_INFINITY;for(const a of e.components)for(const e of a.vertices){const a=t.getZ(e.pos);i=Math.max(a,i)}this.zmax=i}_updateDisplayBounds(){const e=this.graphic.geometry;if((0,r.Wi)(e))return;const t=(0,r.pC)(this.outlineVisualElement)&&!this.graphicState.isDraped&&(0,r.pC)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:(0,kt.du)(this.view,this.graphic);this.attachmentOrigin=(0,r.Pt)(t,e.extent.center);const i=(0,r.pC)(t)?t.z:(0,Ge.w7)(this.mapBounds.origin,this.view.elevationProvider,Pe.o.fromElevationInfo((0,p.RL)(this.graphic)),this.view.renderCoordsHelper),a=(0,Ia.a)(this.mapBounds);a.origin[2]=i,function(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0;s||(s=(0,Ia.c)()),t.toRenderCoords(e.origin,i,s.origin);const r=Ee.WM.get();(0,S.a)(r,e.origin,e.basis1),(0,S.a)(r,r,e.basis2),t.toRenderCoords(r,i,r);const n=Ee.WM.get();(0,S.a)(n,e.origin,e.basis1),(0,S.b)(n,n,e.basis2),t.toRenderCoords(n,i,n);const o=Ee.WM.get();(0,S.b)(o,e.origin,e.basis1),(0,S.b)(o,o,e.basis2),t.toRenderCoords(o,i,o);const l=Ee.WM.get();(0,S.b)(l,e.origin,e.basis1),(0,S.a)(l,l,e.basis2),t.toRenderCoords(l,i,l);const h=(0,S.h)(Ee.WM.get(),r,n,.5);(0,S.b)(h,h,s.origin);const c=(0,S.h)(Ee.WM.get(),o,l,.5);(0,S.b)(c,s.origin,c),(0,S.h)(s.basis1,h,c,.5);const p=(0,S.h)(Ee.WM.get(),l,r,.5);(0,S.b)(p,p,s.origin);const d=(0,S.h)(Ee.WM.get(),n,o,.5);(0,S.b)(d,s.origin,d),(0,S.h)(s.basis2,p,d,.5);const u=(0,S.f)(Ee.WM.get(),s.basis1,s.basis2),g=(0,S.f)(u,u,s.basis1);(0,S.n)(g,g),(0,S.g)(s.basis2,g,(0,S.e)(s.basis2,g)),(0,S.g)(s.basis1,s.basis1,1+a/(0,S.l)(s.basis1)),(0,S.g)(s.basis2,s.basis2,1+a/(0,S.l)(s.basis2)),(0,Ia.u)(s)}(a,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this._updateManipulators()}get displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return ar*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((e,t,i)=>this._applyGraphicMoveSteps(t,i,wi.XY)))}_createMoveZDragPipeline(){const e=this.view,t=this.editGeometryOperations.data.spatialReference;return(0,di.Xd)(this.moveZManipulator,((i,a,s)=>{const r=(0,_.a)(i.renderLocation),n=a.next((0,pi.Sp)(e,r,t)).next((0,di.zh)());this._applyGraphicMoveSteps(n,s,wi.Z)}))}_applyGraphicMoveSteps(e,t,i){const a=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},(0,Ia.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next((0,di.AN)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e})).next((e=>this._updateMoveTooltip(e,i)));return t.next((()=>{(0,r.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),a}_calculateSizeStart(){(0,r.Wi)(this.graphic.geometry)?this.sizeStart=null:this.sizeStart=Ks(this.mapBoundsStart,this.zmax,this.graphic.geometry.spatialReference,this.graphicState.isDraped)}_moveDragUpdateGeometry(){return e=>{if((0,r.Wi)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const a of this.editGeometryOperations.data.components)t.push(...a.vertices);const i="start"===e.action?ea.O.NEW_STEP:ea.O.ACCUMULATE_STEPS;return Qs(this.editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_updateMoveTooltip(e,t){if(t===wi.XY||t===wi.XY_AXIS){const t=(0,P.GQ)(e.mapStart,e.mapEnd,this.graphicState.isDraped?"on-the-ground":"absolute-height");(0,r.pC)(t)&&(0,r.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=t)}return e}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);(0,ji.BR)(this.displayBounds.plane,t,Ee.WM.get())&&((0,Ia.a)(this.displayBounds,this.displayBoundsStart),(0,Ia.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return(0,di.Xd)(e,((e,i,a)=>{(0,r.Wi)(this.inputState)||(i.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next((0,pi._N)(this.view,this.displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),a.next((()=>{(0,r.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,a=this.displayBoundsMargin,s=this.displayBoundsMarginStart,r=(0,S.c)(Ee.WM.get(),t.origin);(0,S.C)(r,r,t.basis1,-i[0]),(0,S.C)(r,r,t.basis2,-i[1]);const n=(0,S.b)(Ee.WM.get(),e.renderEnd,r),o=(0,S.b)(Ee.WM.get(),e.renderStart,r),l=As(e.handle),h=Es(t),c=Es(this.displayBounds)/h,p=(e,t)=>{if(0===e)return 1;let i=(0,S.l)(t),r=.5*e*(0,S.e)(t,n)/i;const h=r<0?-1:1;l&&(r+=(i-.5*e*(0,S.e)(t,o)/i)*h*c);const p=i<1.5*s?1:rr;return i=Math.max(i-s,rr),h>0&&(r-=a),h*Math.max(h*(r/i),p)};return{...e,factor1:p(i[0],t.basis1),factor2:p(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=(0,S.c)((0,_.c)(),this.mapBoundsStart.origin);(0,S.C)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),(0,S.C)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=(0,b.a)((0,M.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);(0,b.i)(i,i);const a=[];for(const n of this.editGeometryOperations.data.components)a.push(...n.vertices);const s="start"===e.action?ea.O.NEW_STEP:ea.O.ACCUMULATE_STEPS,r=this.editGeometryOperations.scaleVertices(a,t,i,e.factor1,e.factor2,s,Ys.w.REPLACE);return(0,Ia.a)(this.mapBoundsStart,this.mapBounds),Qs(r,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=function(e,t,i,a){const s=t.worldUpAtPosition(e.origin,Ee.WM.get()),r=Ee.WM.get();switch(i){case zs.HEADING:(0,S.c)(r,s);break;case zs.TILT:(0,S.c)(r,e.basis1)}return(0,ji.Yq)(e.origin,r,a)}(this.displayBounds,this.view.renderCoordsHelper,zs.HEADING,(0,ji.Ue)()),i=this._calculatePickRay(e.screenPoint);(0,ji.BR)(t,i,Ee.WM.get())&&((0,Ia.a)(this.displayBounds,this.displayBoundsStart),(0,Ia.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return(0,di.Xd)(e,((e,t,i)=>{const a=this.inputState;(0,r.Wi)(a)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next((0,pi._N)(this.view,a.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(a)).next(this._rotateDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,angle:(0,xe.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),i.next((()=>{(0,r.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=(0,ji.mJ)(e.rotatePlane),a=(0,kt.Gd)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:a}}}_rotateDragUpdateGeometry(){return e=>{const t=(0,S.c)((0,_.c)(),this.mapBoundsStart.origin),i=[];for(const r of this.editGeometryOperations.data.components)i.push(...r.vertices);const a="start"===e.action?ea.O.NEW_STEP:ea.O.ACCUMULATE_STEPS,s=this.editGeometryOperations.rotateVertices(i,t,e.rotateAngle,a,Ys.w.REPLACE);return(0,Ia.a)(this.mapBoundsStart,this.mapBounds),Qs(s,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=(0,Q.Ue)(),i=(0,u.md)(e);return(0,hs.u4)(this.view.state.camera,i,t),(0,S.n)(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=function(e,t){return(0,kt.Aq)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,Ee.MP.get());(function(e,t,i,a){const s=a.worldUpAtPosition(i.origin,Ee.WM.get()),r=ws(i,Cs.POSITIVE_X),n=(0,J.b)(Ee.MP.get(),r.edge*Math.PI/2);(0,J.r)(n,n,-Ds(i,s)),(0,J.m)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=r.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach(((t,i)=>{!function(e,t,i,a){const s=(0,S.l)(a.basis1),r=(0,S.l)(a.basis2),n=Os(a),o=Es(a),l=(0,S.s)(Ee.WM.get(),0,0,0);(0,S.a)(l,(0,S.g)(Ee.WM.get(),a.basis1,t.direction[0]),(0,S.g)(Ee.WM.get(),a.basis2,t.direction[1])),(0,S.a)(l,a.origin,l);let h=0,c=1;if(As(t))1===t.direction[0]&&-1===t.direction[1]?h=Ws:1===t.direction[0]&&1===t.direction[1]?h=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(h=3*Math.PI/2),c=o;else{const e=0!==t.direction[0]?1:2;h=1===e?Ws:0,c=(1===e?r:s)-n}const p=(0,J.b)(Ee.MP.get(),h);(0,J.h)(p,p,(0,S.s)(Ee.WM.get(),c,c,c)),(0,J.m)(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(t,this.resizeHandles[i],e,this.displayBounds)}))}_updateZMoveHandle(e,t){const i=this.displayBounds,a={basis:i.basis1,direction:-1,position:(0,S.b)(Ee.WM.get(),i.origin,i.basis1),edge:2},s=Ee.MP.get();(0,J.g)(s,t,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position}_cancel(){const e=this.editGeometryOperations.lastOperation;(0,r.Wi)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,qs(e,this.mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if((0,r.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,qs((0,r.Wg)(e),this.mapBounds),this._updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,Qs((0,r.Wg)(e),this.mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator,tooltip:this._tooltip}}};(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],tr.prototype,"view",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],tr.prototype,"graphic",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,nonNullable:!0})],tr.prototype,"enableZ",void 0),(0,a._)([(0,o.Cb)()],tr.prototype,"enableRotation",void 0),(0,a._)([(0,o.Cb)()],tr.prototype,"enableScaling",void 0),(0,a._)([(0,o.Cb)({constructOnly:!0,type:Lt.Z})],tr.prototype,"tooltipOptions",void 0),(0,a._)([(0,o.Cb)()],tr.prototype,"preserveAspectRatio",null),(0,a._)([(0,o.Cb)()],tr.prototype,"grabbing",void 0),(0,a._)([(0,o.Cb)()],tr.prototype,"inputState",void 0),(0,a._)([(0,o.Cb)({readOnly:!0})],tr.prototype,"type",void 0),(0,a._)([(0,o.Cb)()],tr.prototype,"_moveUnit",null),tr=(0,a._)([(0,c.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],tr);const ir="draped-elevation-changes",ar=10,sr=80,rr=1e-6},89215:(e,t,i)=>{i.d(t,{T:()=>R,I:()=>D});var a=i(27366),s=i(52639),r=(i(93169),i(91505)),n=i(41691),o=i(42537),l=i(92026),h=i(49861),c=i(63780),p=(i(25243),i(69912)),d=i(93655),u=(i(59486),i(84652)),g=i(68860),_=i(42137),m=i(2170),y=i(69662),f=i(92975),v=i(3826),b=i(77577),M=i(7882),S=i(29909),x=i(80885);function C(e,t){const i=new M.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function w(e,t,i){const a=new S.Z({paths:e,spatialReference:t});return i&&(0,y.nc)(a),a}function O(e,t,i){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=(0,u.d9)(e);s.forEach((e=>{const t=e[0],i=e[e.length-1];(0,c.fS)(t,i)&&1!==e.length||e.push(e[0])}));let r=new x.Z({rings:s,spatialReference:t});return r.rings.forEach((e=>{(0,y.bu)(e,!1,!1)||e.reverse()})),i&&(0,y.nc)(r),a&&r.isSelfIntersecting&&(0,f.JY)(t)&&(r=(0,m.simplify)(r)),r}function E(e,t,i){const a=t.mapToLocalMultiple(e),s=[],r={x:a[0].x,y:a[0].y},n=a[1].x,o=a[1].y,h=Math.round(n-r.x),c=Math.round(o-r.y),p=Math.max(Math.abs(h),Math.abs(c));if(i){const e={x:r.x+p,y:r.y+p},t={x:r.x-p,y:r.y-p};s.push((0,v.Q8)(e.x,t.y),(0,v.Q8)(t.x,t.y),(0,v.Q8)(t.x,e.y),(0,v.Q8)(e.x,e.y))}else{const e={x:h>0?r.x+p:r.x-p,y:c>0?r.y+p:r.y-p};s.push((0,v.Q8)(r.x,r.y),(0,v.Q8)(e.x,r.y),(0,v.Q8)(e.x,e.y),(0,v.Q8)(r.x,e.y))}return O([(0,l.lV)(s.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function A(e,t,i,a){const s=t.mapToLocalMultiple(e);let r=null,n=null;if(i)r=s[0],n=s[1];else{const e=s[0],t=s[1],i=Math.round(t.x-e.x),a=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(a));r=(0,v.Q8)(i>0?e.x+o/2:e.x-o/2,a>0?e.y+o/2:e.y-o/2),n=(0,v.Q8)(Math.abs(i)>Math.abs(a)?r.x-o/2:r.x,Math.abs(i)>Math.abs(a)?r.y:r.y-o/2)}const o=t.localToMap(r),h=t.localToMap(n);if((0,l.Wi)(o)||(0,l.Wi)(h))return null;t.doUnnormalization&&(0,y.Sq)([[o,h]],t.spatialReference);const c=C(o,t.spatialReference),p=C(h,t.spatialReference),d=(0,g.c9)(t.spatialReference);let u=0;if((0,f.JY)(t.spatialReference))u=d*(0,m.distance)(c,p,null);else{const e=r.x-n.x,t=r.y-n.y;u=d*Math.sqrt(e*e+t*t)*(a||1)}const b=new _.Z({center:c,radius:u,radiusUnit:"meters",spatialReference:t.spatialReference});return O(b.rings,b.spatialReference,!1)}var T=i(45900);let R=class extends((0,n.p)(r.Z.EventedMixin(T.m))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new d.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,l.SC)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,l.SC)(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),(0,l.pC)(this._graphic)&&(this._graphic.symbol=e)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new s.Z({...this.graphicProperties,geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,o.kB)((()=>{(0,l.pC)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=(0,l.SC)(this._graphic))})),G)}_destroyAllVisualisations(){this.handles.remove(P.outline),this.handles.remove(P.regularVertices),this.handles.remove(P.activeVertex),this.handles.remove(G)}_getCreateOperationGeometry(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,a=i.slice();(0,l.pC)(t)&&a.push(this.drawOperation.coordinateHelper.pointToArray(t));const s=(0,l.pC)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],r={regularVertices:null,activeVertex:null,full:null,outline:null},n=a.length,o=this.view.spatialReference,h="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":r.regularVertices=i,r.activeVertex=s,r.full=this.drawOperation.coordinateHelper.arrayToPoint(a[0]);break;case"multipoint":r.regularVertices=i,r.activeVertex=s,n>0&&(r.full=function(e,t){return new b.Z({points:e,spatialReference:t})}(a,o));break;case"polyline":r.regularVertices=i,r.activeVertex=s,n>0&&(r.full=w([a],o,h));break;case"polygon":r.regularVertices=i,r.activeVertex=s,n>0&&(r.full=O([a],o,h,!0));break;case"circle":if(n>0){const t=(0,v.Gn)(this.view,a[0]);if(1===n&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+I*this.view.resolution,e[1]);r.full=A([e,i],t,!0)}else 2===n&&(r.full=this.forceUniformSize?A(a,t,this.centered):function(e,t,i){const a=t.mapToLocalMultiple(e),s=a[0],r=a[1],n=Math.round(r.x-s.x),o=Math.round(r.y-s.y),h=(0,v.Q8)(i?s.x:s.x+n/2,i?s.y:s.y+o/2),c=i?n:n/2,p=i?o:o/2,d=[],u=2*Math.PI/60;for(let l=0;l<60;l++){const e=Math.cos(l*u),t=Math.sin(l*u),i=(0,v.Q8)(c*e+h.x,p*t+h.y);d.push(i)}return d.push(d[0]),O([(0,l.lV)(d.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}(a,t,this.centered))}break;case"rectangle":if(n>0){const t=(0,v.Gn)(this.view,a[0]);if(1===n&&e.operationComplete){const e=a[0],i=t.makeMapPoint(e[0]+I*this.view.resolution,e[1]);r.full=E([e,i],t,!0)}else 2===n&&(r.full=this.forceUniformSize?E(a,t,this.centered):function(e,t,i){let a=t.mapToLocalMultiple(e);if(1===a.length){const e=48,t=a[0];a=[(0,v.Q8)(t.x-e,t.y+e),(0,v.Q8)(t.x+e,t.y-e),(0,v.Q8)(t.x+e,t.y-e),(0,v.Q8)(t.x-e,t.y+e)]}const s=[],r={x:a[0].x,y:a[0].y},n={x:a[1].x,y:a[1].y};if(i){const e=Math.round(n.x-r.x),t=Math.round(n.y-r.y);s.push((0,v.Q8)(r.x-e,r.y-t),(0,v.Q8)(n.x,r.y-t),(0,v.Q8)(n.x,n.y),(0,v.Q8)(r.x-e,n.y))}else s.push((0,v.Q8)(r.x,r.y),(0,v.Q8)(n.x,r.y),(0,v.Q8)(n.x,n.y),(0,v.Q8)(r.x,n.y));return O([(0,l.lV)(s.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}(a,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":n>1&&(r.outline=w([a],o,h));break;case"circle":case"rectangle":(0,l.pC)(r.full)&&"polygon"===r.full.type&&(r.outline=O(r.full.rings,o,h))}return r}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});(0,l.pC)(e)&&((0,l.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full,t=(0,l.Wg)(this._graphic).clone())}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();(0,l.Wi)(e)?this._destroyAllVisualisations():((0,l.pC)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),P.outline):this.handles.remove(P.outline),(0,l.pC)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),P.regularVertices):this.handles.remove(P.regularVertices),(0,l.pC)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),P.activeVertex):this.handles.remove(P.activeVertex),(0,l.pC)(e.full)?(0,l.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(G))}};(0,a._)([(0,h.Cb)({value:!0})],R.prototype,"centered",null),(0,a._)([(0,h.Cb)({nonNullable:!0})],R.prototype,"defaultZ",void 0),(0,a._)([(0,h.Cb)()],R.prototype,"drawOperation",void 0),(0,a._)([(0,h.Cb)({value:!0})],R.prototype,"enabled",null),(0,a._)([(0,h.Cb)({value:!0})],R.prototype,"forceUniformSize",null),(0,a._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"geometryType",void 0),(0,a._)([(0,h.Cb)()],R.prototype,"graphic",null),(0,a._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"graphicProperties",void 0),(0,a._)([(0,h.Cb)()],R.prototype,"graphicSymbol",null),(0,a._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"hasZ",void 0),(0,a._)([(0,h.Cb)({constructOnly:!0})],R.prototype,"mode",void 0),(0,a._)([(0,h.Cb)()],R.prototype,"snappingManager",void 0),(0,a._)([(0,h.Cb)()],R.prototype,"snapToScene",void 0),(0,a._)([(0,h.Cb)({readOnly:!0})],R.prototype,"type",void 0),(0,a._)([(0,h.Cb)({readOnly:!0})],R.prototype,"updating",null),(0,a._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],R.prototype,"view",void 0),R=(0,a._)([(0,p.j)("esri.views.draw.DrawGraphicTool")],R);const G="create-operation-graphic",P={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function D(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const I=48},63920:(e,t,i)=>{var a;i.d(t,{t:()=>a}),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(a||(a={}))},2346:(e,t,i)=>{i.d(t,{L:()=>v});var a=i(27366),s=i(85015),r=i(91505),n=i(92026),o=i(94172),l=i(17842),h=i(49861),c=(i(63780),i(93169),i(25243),i(69912)),p=i(88396),d=i(11186),u=i(71353),g=i(79803),_=i(74509),m=i(61574),y=i(64575),f=i(45008);let v=class extends s.Z{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new r.Z.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,_.vu)(this.graphic),i=e?e.offset:0;return new y.ZP({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if((0,n.Wi)(i))return null;const a=this._get("focusedSymbol"),s=(0,n.pC)(a)?a:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,s):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),(0,n.pC)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,n.pC)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,o.YP)((()=>this.graphic?.symbol),(e=>{(0,n.pC)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&(0,n.pC)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),o.Z_)}detachSymbolChanged(){(0,n.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&(0,n.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,a){if(a=a||(0,m.js)(i),(0,n.Wi)(a))return null;let s=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==a.type)return(0,f.D)(t,i,e)?1:null;if((0,n.Wi)(s)||!s.originalPoint.equals(i)){const t=i,r=e.spatialReference;if((0,g.Up)(t.spatialReference,r)){const e=(0,g.iV)(t,r);s={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,l.F2)(a.size)},this._circleCollisionCache=s}}if((0,n.pC)(s)){const i=(0,l.md)(t,M),r=e.toScreen(s.mapPoint),n=s.radiusPx,o=r.x+(0,l.F2)(a.xoffset),h=r.y-(0,l.F2)(a.yoffset);return(0,p.s)(i,[o,h])<n*n?1:null}return null}_intersectDistance3D(e,t,i){const a=e.toMap(t,{include:[i]});return a&&(0,g.KC)(a,b,e.renderSpatialReference)?(0,d.i)(b,e.state.camera.eye):null}};(0,a._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],v.prototype,"graphic",null),(0,a._)([(0,h.Cb)()],v.prototype,"elevationInfo",null),(0,a._)([(0,h.Cb)({constructOnly:!0,nonNullable:!0})],v.prototype,"view",void 0),(0,a._)([(0,h.Cb)({value:null})],v.prototype,"focusedSymbol",null),(0,a._)([(0,h.Cb)({constructOnly:!0})],v.prototype,"layer",void 0),(0,a._)([(0,h.Cb)()],v.prototype,"interactive",void 0),(0,a._)([(0,h.Cb)()],v.prototype,"selectable",void 0),(0,a._)([(0,h.Cb)()],v.prototype,"grabbable",void 0),(0,a._)([(0,h.Cb)({value:!1})],v.prototype,"grabbing",null),(0,a._)([(0,h.Cb)()],v.prototype,"dragging",void 0),(0,a._)([(0,h.Cb)()],v.prototype,"hovering",null),(0,a._)([(0,h.Cb)({value:!1})],v.prototype,"selected",null),(0,a._)([(0,h.Cb)()],v.prototype,"cursor",void 0),v=(0,a._)([(0,c.j)("esri.views.interactive.GraphicManipulator")],v);const b=(0,u.c)(),M=(0,l.s1)()},45008:(e,t,i)=>{i.d(t,{D:()=>l,K:()=>o});i(59486);var a=i(92026),s=i(68860),r=i(96669),n=i(53866);function o(e,t,i){let r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.Z;if("2d"===i.type)r=t*i.resolution;else if("3d"===i.type){const n=i.overlayPixelSizeInMapUnits(e),o=i.basemapSpatialReference;r=(0,a.pC)(o)&&!o.equals(i.spatialReference)?(0,s.c9)(o)/(0,s.c9)(i.spatialReference):t*n}const l=e.x-r,h=e.y-r,c=e.x+r,p=e.y+r,{spatialReference:d}=i;return o.xmin=Math.min(l,c),o.ymin=Math.min(h,p),o.xmax=Math.max(l,c),o.ymax=Math.max(h,p),o.spatialReference=d,o}function l(e,t,i){const s=i.toMap(e);return!(0,a.Wi)(s)&&o(s,(0,r.k)(),i,h).intersects(t)}const h=new n.Z},92028:(e,t,i)=>{i.d(t,{D:()=>r});var a=i(72619),s=i(50951);function r(e,t){return null!=e&&(null==t||(t===s.JY.Local?!e.isGeographic||e.isWGS84||e.wkid===a.W.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===a.W.CGCS2000||e.wkid===a.W.GCSMARS2000||e.wkid===a.W.GCSMARS2000_SPHERE||e.wkid===a.W.GCSMOON2000))}}}]);
//# sourceMappingURL=3567.d880c819.chunk.js.map