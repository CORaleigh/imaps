(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[15,245,307],{1001:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(367),n=i(446);const a={vvSizeEnabled:!1,vvSizeMinSize:Object(n.c)(1,1,1),vvSizeMaxSize:Object(n.c)(100,100,100),vvSizeOffset:Object(n.c)(0,0,0),vvSizeFactor:Object(n.c)(1,1,1),vvSizeValue:Object(n.c)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(r.b)()}},1002:function(e,t,i){"use strict";var r,n,a;i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n})),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(n||(n={})),function(e){e[e.LAYER_VIEW=0]="LAYER_VIEW",e[e.EXTERNAL=1]="EXTERNAL"}(a||(a={}))},1003:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return A}));i(82);var r,n,a=i(85),s=i(549),o=i(151),c=i(117),l=i(109),u=i(187),h=i(208),d=i(943),p=i(272),f=i(1004),b=i(607),g=i(1027),m=i(163),O=i(595),_=i(139),v=i(770);function y(e){const t=[],i=[];!function(e,t,i){const{attributeData:{position:n},removeDuplicateStartEnd:a}=e,o=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(n)&&a===r.REMOVE,c=n.length/3-(o?1:0),l=new Uint32Array(2*(c-1)),u=o?Object(s.m)(n,0,n.length-3):n;let h=0;for(let r=0;r<c-1;r++)l[h++]=r,l[h++]=r+1;t.push([_.a.POSITION,{size:3,data:u,exclusive:o}]),i.push([_.a.POSITION,l])}(e,i,t);const n=i[0][1].data,l=t[0][1].length,d=new Uint16Array(l);return function(e,t,i){const r=e.attributeData.mapPosition;Object(a.j)(r)||(i.push([_.a.MAPPOS,i[0][1]]),t.push([_.a.MAPPOS,{size:3,data:r}]))}(e,i,t),function(e,t,i,r){if(Object(a.k)(e.attributeData.colorFeature))return;const n=e.attributeData.color;t.push([_.a.COLOR,{size:4,data:Object(a.t)(n,f.c)}]),i.push([_.a.COLOR,r])}(e,i,t,d),function(e,t,i,r){if(Object(a.k)(e.attributeData.sizeFeature))return;const n=e.attributeData.size;t.push([_.a.SIZE,{size:1,data:[Object(a.t)(n,1)]}]),i.push([_.a.SIZE,r])}(e,i,t,d),function(e,t,i,r){const n=e.attributeData.colorFeature;Object(a.j)(n)||(t.push([_.a.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([_.a.COLOR,r]))}(e,i,t,d),function(e,t,i,r){const n=e.attributeData.sizeFeature;Object(a.j)(n)||(t.push([_.a.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([_.a.SIZEFEATUREATTRIBUTE,r]))}(e,i,t,d),function(e,t,i,r){const n=e.attributeData.opacityFeature;Object(a.j)(n)||(t.push([_.a.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([n])}]),i.push([_.a.OPACITYFEATUREATTRIBUTE,r]))}(e,i,t,d),function(e,t,i,r){if(Object(a.j)(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==p.a.Global||!e.overlayInfo.spatialReference.isGeographic)return;const n=new Float64Array(r.length),s=Object(h.e)(e.overlayInfo.spatialReference);for(let a=0;a<n.length;a+=3)Object(u.i)(r,a,n,a,s);const l=r.length/3,d=new Float32Array(l+1);let f=S,b=E,g=0,m=0;Object(c.w)(f,n[m++],n[m++],n[m++]),d[0]=0;for(let a=1;a<l+1;++a)a===l&&(m=0),Object(c.w)(b,n[m++],n[m++],n[m++]),g+=Object(o.d)(f,b),d[a]=g,[f,b]=[b,f];t.push([_.a.DISTANCETOSTART,{size:1,data:d}]),i.push([_.a.DISTANCETOSTART,i[0][1]])}(e,i,t,n),new O.a(i,t,m.f.Line)}function j(e,t,i,r){const n="polygon"===e.type?d.a.CCW_IS_HOLE:d.a.NONE,a="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(d.b)(a,e.hasZ,n),c=new Float64Array(s.length),l=Object(b.d)(s,e.spatialReference,0,c,0,s,0,s.length/3,t,i,r),u=null!=l;return{lines:u?x(o,s,c):[],projectionSuccess:u,sampledElevation:l}}function x(e,t,i){const r=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;r.push({position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function T(e,t){const i="polygon"===e.type?d.a.CCW_IS_HOLE:d.a.NONE,r="polygon"===e.type?e.rings:e.paths,{position:n,outlines:a}=Object(d.b)(r,!1,i),s=Object(u.l)(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=g.a;return{lines:s?x(a,n):[],projectionSuccess:s}}(n=r||(r={}))[n.KEEP=0]="KEEP",n[n.REMOVE=1]="REMOVE";const S=Object(l.f)(),E=Object(l.f)();function A(e){switch(e){case"butt":return v.a.BUTT;case"square":return v.a.SQUARE;case"round":return v.a.ROUND;default:return null}}},1004:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s}));var r=i(257);const n=1.2,a=r.b,s=r.a},1005:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(109);class n{constructor(e,t){this.vec3=e,this.id=t}}function a(e,t,i,a){return new n(Object(r.h)(e,t,i),a)}},1006:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var r=i(799),n=i(800),a=i(947),s=i(502),o=i(730),c=i(948),l=i(464),u=i(500),h=i(126),d=i(297),p=i(139);function f(){const e=new d.a;return e.attributes.add(p.a.POSITION,"vec2"),e.varyings.add("worldRay","vec3"),e.vertex.uniforms.add("inverseProjectionMatrix","mat4"),e.vertex.uniforms.add("inverseViewMatrix","mat4"),e.vertex.code.add(h.a`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),e.fragment.uniforms.add("lightingMainDirection","vec3"),e.fragment.include(l.a),e.fragment.include(u.a),e.include(n.a),e.include(r.a,{pbrMode:s.a.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(o.a),e.include(a.a),e.include(c.a),e.fragment.code.add(h.a`void main() {
vec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay), cameraPosition) : renderCloudCrossFade(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const b=Object.freeze({__proto__:null,build:f})},1007:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i(126);function n(e){e.fragment.code.add(r.a`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function a(e){e.fragment.code.add(r.a`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},1008:function(e,t,i){"use strict";i.d(t,"a",(function(){return x})),i.d(t,"b",(function(){return j}));var r=i(732),n=i(210),a=i(301),s=i(478),o=i(420),c=i(410),l=i(799),u=i(800),h=i(356),d=i(950),p=i(502),f=i(625),b=i(1086),g=i(949),m=i(397),O=i(464),_=i(126),v=i(297),y=i(139);function j(e){const t=new v.a;return t.include(s.a,{linearDepth:!1}),t.attributes.add(y.a.POSITION,"vec3"),t.attributes.add(y.a.UV0,"vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),e.output!==n.a.Color&&e.output!==n.a.Alpha||(t.include(d.a,e),t.include(r.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.fragment.uniforms.add("localOrigin","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(_.a`
      void main(void) {
        if (waterColor.a < ${_.a.float(m.c)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===n.a.Color?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(c.a),t.include(h.b,e)),e.output===n.a.Alpha&&(t.include(a.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(_.a`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===n.a.Color&&(t.include(u.a),t.include(l.a,{pbrMode:p.a.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(g.a,e),t.include(a.a,e),e.receiveShadows&&t.include(f.a,e),t.include(b.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("lightingSpecularStrength","float").add("lightingEnvironmentStrength","float").add("cameraPosition","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(O.a),t.fragment.code.add(_.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?_.a`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===n.a.Normal&&(t.include(d.a,e),t.include(g.a,e),t.include(a.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(_.a`
        void main(void) {
          if (waterColor.a < ${_.a.float(m.c)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(_.a`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===n.a.Draped&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(_.a`
        void main(void) {
          if (waterColor.a < ${_.a.float(m.c)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(_.a`void main() {
gl_FragColor = waterColor;
}`)),e.output===n.a.Highlight&&(t.include(o.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(_.a`
      void main(void) {
        if (waterColor.a < ${_.a.float(m.c)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(a.a,e),t.fragment.code.add(_.a`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const x=Object.freeze({__proto__:null,build:j})},1009:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return l}));var r=i(687),n=i(397),a=i(126),s=i(297),o=i(163),c=i(626);function l(e){const t=new s.a,{mode:i}=e;return t.include(r.a),t.include(n.a,{alphaDiscardMode:o.a.Blend}),t.fragment.uniforms.add("densityMap","sampler2D"),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("densityNormalizer","float"),t.fragment.uniforms.add("minDensity","float"),i===c.a.KernelDensity&&t.fragment.uniforms.add("densityMultiplier","float"),t.fragment.code.add(a.a`
    void main() {
      float density = texture2D(densityMap, uv).r${i===c.a.KernelDensity?a.a` * densityMultiplier`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `),t}const u=Object.freeze({__proto__:null,build:l,get HeatmapMode(){return c.a}})},1010:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i(687),n=i(126),a=i(297);function s(){const e=new a.a;return e.include(r.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("uColor","vec4"),e.fragment.code.add(n.a`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const o=Object.freeze({__proto__:null,build:s})},1011:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return p}));var r=i(210),n=i(301),a=i(478),s=i(624),o=i(420),c=i(894),l=i(397),u=i(126),h=i(297),d=i(139);function p(e){const t=new h.a;return t.include(a.a,{linearDepth:!1}),t.include(s.a,e),t.include(c.a,{...e,stippleRequiresStretchMeasure:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add(d.a.UV0,"vec2"),t.attributes.add(d.a.AUXPOS1,"vec3")),t.attributes.add(d.a.POSITION,"vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(u.a`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.vertex.code.add(u.a`vec4 vpos2 = transformPosition(proj, view, auxpos1);
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped||t.vertex.code.add(u.a`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(u.a`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?t.vertex.code.add(u.a`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):t.vertex.code.add(u.a`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(u.a`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),t.vertex.code.add(u.a`}`),e.output===r.a.Highlight&&t.include(o.a),t.include(n.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(u.a`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${u.a.float(l.c)}) {
      discard;
    }

    ${e.output===r.a.Color?u.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===r.a.Highlight?u.a`outputHighlight();`:""}
  }
  `),t}const f=Object.freeze({__proto__:null,build:p})},1027:function(e,t,i){"use strict";i.d(t,"a",(function(){return ci}));var r,n,a,s,o,c,l=i(79),u=i(100),h=i(138),d=i(124),p=i(87),f=i(424),b=i(85),g=i(212),m=i(551),O=i(136),_=i(81),v=(i(84),i(82),i(83),i(80)),y=i(147),j=i(219),x=i(109),T=i(200),S=i(272),E=i(1002),A=i(798);(c=r||(r={}))[c.INNER=0]="INNER",c[c.OUTER=1]="OUTER",function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(a||(a={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}));var w,M,R=i(116),C=i(118),P=i(163),I=i(1005);(M=w||(w={}))[M.None=0]="None",M[M.ColorAndWater=1]="ColorAndWater",M[M.Highlight=2]="Highlight",M[M.Occluded=3]="Occluded";class D{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=Object(C.l)(),this.resolution=0,this.renderLocalOrigin=Object(I.a)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new L,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=e===w.ColorAndWater?this.renderTargets.getTarget(s.Color):e===w.Highlight?this.renderTargets.getTarget(s.Highlight):this.renderTargets.getTarget(s.Occluded);return t?t.getTexture():null}getNormalTexture(e){const t=e===w.ColorAndWater?this.renderTargets.getTarget(s.Water):null;return t?t.getTexture():null}draw(e,t){const i=this.computeRenderTargetValidityBitfield(),r=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)n.type===s.ColorNoRasterImage&&!1===r?this.validTargets[n.type]=!1:this.validTargets[n.type]=e.drawTarget(this,n,t);return i^this.computeRenderTargetValidityBitfield()?P.k.CHANGED:P.k.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[s.Color]|+e[s.ColorNoRasterImage]<<1|+e[s.Highlight]<<2|+e[s.Water]<<3|+e[s.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(C.u)(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(C.u)(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(C.k)(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===r.INNER?0:this.resolution,0,this.resolution,this.resolution)}}class L{constructor(){this.extents=[Object(C.l)(),Object(C.l)(),Object(C.l)()],this.numViews=0}}var N=i(188),F=i(94),z=i(314);class U{constructor(e,t){this.size=Object(N.a)(),this._fbo=null,this._fbo=new z.a(e,{colorTarget:F.y.TEXTURE,depthStencilTarget:F.m.NONE},{target:F.A.TEXTURE_2D,pixelFormat:F.p.RGBA,dataType:F.q.UNSIGNED_BYTE,wrapMode:F.B.CLAMP_TO_EDGE,samplingMode:F.z.LINEAR_MIPMAP_LINEAR,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(b.e)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}var G=i(567);class V{constructor(e){const t=(t,i,r=!0)=>({type:i,fbo:new U(e,r),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(G.a.MATERIAL,s.Color),t(G.a.MATERIAL,s.ColorNoRasterImage),t(G.a.MATERIAL_HIGHLIGHT,s.Highlight,!1),t(G.a.MATERIAL_NORMAL,s.Water),t(G.a.MATERIAL,s.Occluded)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>k)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,t)=>e+t.fbo.gpuMemoryUsage),0)}}const k=1e3;var H=i(818);class B{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class W{constructor(e){this._context=e,this._perConstructorInstances=new H.a,this._frameCounter=0,this._keepAliveFrameCount=q}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let r=this._perConstructorInstances.get(e,i);if(Object(b.j)(r)){const n=new e(this._context,t,(()=>this.release(n)));r=new B(n),this._perConstructorInstances.set(e,i,r)}return++r.refCount,r.technique}releaseAndAcquire(e,t,i){if(Object(b.k)(i)){if(t.key===i.key)return i;this.release(i)}return this.acquire(e,t)}release(e){if(Object(b.j)(e)||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);Object(b.j)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==q&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,i))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,i)=>{e.push((async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach((e=>{e.technique.reload(this._context)})))})(t,i))})),await Promise.all(e)}}const q=-1,Z=e=>class extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const i=this[t];this[t]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};Z(class{});var X=i(748),Y=(i(171),i(692));class ${constructor(){this.adds=new g.a,this.removes=new g.a,this.updates=new g.a({allocator:e=>e||new Q,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Q{}class K{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}function J(e){return e.data.indexCount>=1}var ee=i(726),te=i(621),ie=i(335),re=i(896),ne=i(278),ae=i(1100);class se{constructor(e){this.first=e.from,this.count=e.to-e.from}}class oe{constructor(e=0,t=0){this.from=e,this.to=t}}class ce extends oe{constructor(e,t,i,r,n,a){super(t,i),this.id=e,this.isVisible=r,this.hasHighlights=n,this.hasOccludees=a}}function le(e){return Array.from(e.values()).sort(ue)}function ue(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function he(e,t){if(0===e.length)return void e.push(new se(t));const i=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(i,t)){const e=t.from-i.first+t.to-t.from;i.count=e}else e.push(new se(t))}class de{constructor(e,t){this._pool=e,this._size=0,this._buffer=e.newBuffer(pe(t))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(e){this._resize(this._size+e,!0).dispose()}alloc(e){return this._resize(e,!1)}_resize(e,t){let i;const r=function(e,t,i){return t<=i?e>=i?e:pe(Math.max(2*e,i)):e<=2*i?e:pe(i)}(this._buffer.length,this._size,e);if(this._buffer.length!==r){const e=this._pool.newBuffer(r);t&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,r))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength)),i=this._buffer,this._buffer=e}const n=this._size;return this._size=e,i?{dispose:()=>{i.array.fill(0,0,n),this._pool.deleteBuffer(i)},copy:(e,t,r)=>this._buffer.array.set(i.array.subarray(t,r),e),hasNewBuffer:!0}:{dispose:()=>{},copy:(e,t,i)=>{e!==t&&this._buffer.array.copyWithin(e,t,i)},hasNewBuffer:!1}}erase(e,t){this._buffer.array.fill(0,e,t)}}function pe(e){return 65536*Math.ceil(e/65536)}var fe=i(243),be=i(244),ge=i(162),me=i(164);class Oe{constructor(e,t,i,r){this.vao=new me.a(e,t,{geometry:i},{geometry:ge.a.createVertex(e,F.D.STATIC_DRAW)}),this.array=new Float32Array(r),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const _e=fe.a+1;class ve{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=e.newCache(`MergedRenderer pool ${Object(be.a)()}`,ye)}dispose(){this._cache.destroy()}newBuffer(e){const t=e.toString(),i=this._cache.pop(t);if(Object(b.k)(i)){const e=i.pop();return i.length>0&&this._cache.put(t,i,e.array.byteLength*i.length,_e),e}return new Oe(this._rctx,this._locations,this._layout,e)}deleteBuffer(e){const t=e.array.byteLength,i=e.array.length.toString(),r=this._cache.pop(i);return Object(b.k)(r)?(r.push(e),this._cache.put(i,r,t*r.length,-1)):this._cache.put(i,[e],t,-1),null}}function ye(e,t){if(t===fe.d.ALL)return void e.forEach((e=>e.dispose()));const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}var je=i(513);class xe{constructor(e,t,i){this._rctx=e,this._materialRepository=t,this._material=i,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new g.a,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new te.a(this._material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._bufferPool=new ve(e,i.vertexAttributeLocations,Object(ee.a)(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach((e=>e.buffer.dispose())),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof ae.a}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==ie.c.Occlude}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands()}_addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,n=this._dataByOrigin,a=function(e,t){const i=new Map;for(const r of e)Se(i,r,!0);for(const r of t)Se(i,r,!1);return i}(e,t);a.forEach(((e,t)=>{a.delete(t);const s=e.toAdd.reduce(((e,t)=>e+i.elementCount(t.data)),0);let o=n.get(t);if(null==o)Object(ne.a)(0===e.toRemove.length),o=new Me(e.origin,new de(this._bufferPool,s*r)),n.set(t,o);else if(0===e.toAdd.length&&o.instances.size===e.toRemove.length)return o.buffer.dispose(),void n.delete(t);let c=0;o.instances.forEach((e=>c+=e.to-e.from));const l=e.toRemove.reduce(((e,t)=>e+i.elementCount(t.data)),0),u=o.buffer.size,h=(c+s-l)*r,d=Ce;if(h<u/2?this._removeAndRebuild(o,e.toRemove,r,h,d):e.toRemove.length>0&&this._remove(o,e.toRemove,r,d),e.toAdd.length>0){const t=Pe;Object(ne.i)(t,-e.origin[0],-e.origin[1],-e.origin[2]),this._add(o,e.toAdd,r,t,d)}const p=o.buffer.vao.vertexBuffers.geometry;we(d),d.forAll((({from:e,to:t})=>{if(e<t){const i=o.buffer.array,r=4,n=e*r,a=t*r;p.setSubData(i,n,n,a)}})),d.clear(),o.drawCommandsDirty=!0}))}_updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.origin.id),a=n&&n.instances.get(e.id);if(!a)return;const s=r.updateType;if(s&re.a.State.VISIBILITIES&&(a.isVisible=e.instanceParameters.visible),s&(re.a.State.HIGHLIGHTS|re.a.State.VISIBILITIES)){const t=e.instanceParameters.visible;a.hasHighlights=!!e.instanceParameters.highlights&&t}if(s&re.a.State.OCCLUDEES&&(a.hasOccludees=!!e.instanceParameters.occludees),s&(re.a.State.VERTEXATTRS|re.a.State.TRANSFORMATION)){const{array:r,vao:s}=n.buffer;Object(je.b)(e,Ie,De),t.write({transformation:Ie,invTranspTransformation:De},e.data,t.vertexBufferLayout.createView(r.buffer),a.from),Object(ne.a)(a.from+t.elementCount(e.data)===a.to,"material VBO layout has changed"),s.vertexBuffers.geometry.setSubData(r,a.from*i*4,a.from*i*4,a.to*i*4)}n.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(f.c)(e.instances,(t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees)))}));const e=e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,0===e.instances.size)return;if(!Ee(e)){const t=this._bufferWriter.vertexBufferLayout.stride,i=4*e.buffer.size/t;return void(e.drawCommandsDefault=[{first:0,count:i}])}const t=le(e.instances);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const i of t)i.isVisible&&(i.hasOccludees?he(e.drawCommandsOccludees,i):he(e.drawCommandsDefault,i),i.hasHighlights?he(e.drawCommandsHighlight,i):he(e.drawCommandsShadowHighlightRest,i))};this._dataByOrigin.forEach((t=>{t.drawCommandsDirty&&(e(t),t.drawCommandsDirty=!1)}))}updateAnimation(e){return this._material.update(e)}requiresSlot(e,t){return null==e||this._material.requiresSlot(e,t)}render(e,t,i){if(!this.requiresSlot(e,t))return!1;const r=t===G.a.MATERIAL_HIGHLIGHT||t===G.a.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const n=t===G.a.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,a=!(r||n);if(this._dataByOrigin.forEach((e=>{if(r&&!e.hasHighlights)return;const t=(r?e.drawCommandsHighlight:n&&Ee(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,i=a&&e.drawCommandsOccludees||null;(Object(b.k)(t)||Object(b.k)(i))&&this._renderCommandData.push(new Re(e.origin,e.buffer,t,i))})),0===this._renderCommandData.length)return!1;const s=this._rctx,o=this._glMaterials.load(s,t);if(Object(b.j)(o))return this._renderCommandData.clear(),!1;const c=o.beginSlot(i);return s.useTechnique(c,e,!1),o.bind(i,c),this._renderCommandData.forAll((({origin:t,buffer:r,renderCommands:n,occludeeCommands:a})=>{i.origin=t,c.bindDraw(i),c.ensureAttributeLocations(r.vao),s.bindVAO(r.vao);const o=c.primitiveType;Object(b.k)(n)&&this._renderCommands(s,o,n),Object(b.k)(a)&&(c.bindPipelineState(s,e,!0),this._renderCommands(s,o,a),c.bindPipelineState(s,e,!1))})),this._renderCommandData.clear(),!0}_renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}_removeAndRebuild(e,t,i,r,n){for(const l of t)e.instances.delete(l.id);const a=le(e.instances);e.instances.clear();const s=e.buffer.size,o=e.buffer.alloc(r);let c=0;for(const l of a){const t=l.from*i,r=l.to*i;o.copy(c,t,r),l.from=c/i,c+=r-t,l.to=c/i,e.instances.set(l.id,l)}n.push(new oe(0,o.hasNewBuffer?e.buffer.array.length:s)),o.dispose(),e.buffer.erase(c,n.back().to),e.holes.clear()}_remove(e,t,i,r){for(const n of t){const t=n.id,a=e.instances.get(t),s=a.from*i,o=a.to*i;e.buffer.erase(s,o),e.holes.push(new oe(a.from,a.to)),e.instances.delete(t),r.push(new oe(s,o))}we(e.holes)}_add(e,t,i,r,n){if(0===t.length)return;const a=this._bufferWriter;let s=a.vertexBufferLayout.createView(e.buffer.array.buffer);const o=e.holes.length>0;let c=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER;for(const u of t){const t=Object(b.k)(u.transformation)?Object(y.m)(Ie,r,u.transformation):r;Object(y.a)(De,t);const h=Object(y.t)(De,De),d=a.elementCount(u.data),p=d*i;let f=Ae(e.holes,d);Object(b.j)(f)&&(f=e.buffer.size/i,e.buffer.grow(p),s=a.vertexBufferLayout.createView(e.buffer.array.buffer)),a.write({transformation:t,invTranspTransformation:h},u.data,s,f);const g=u.instanceParameters.visible,m=!!u.instanceParameters.highlights&&g,O=!!u.instanceParameters.occludees,_=new ce(u.id,f,f+d,g,m,O);Object(ne.a)(null==e.instances.get(u.id)),e.instances.set(u.id,_),o?n.push(new oe(_.from*i,_.to*i)):(c=Math.min(_.from,c),l=Math.max(_.to,l))}o||n.push(new oe(c*i,l*i))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Te{constructor(e){this.origin=e,this.toAdd=new Array,this.toRemove=new Array}}function Se(e,t,i){const r=t.origin;if(Object(b.j)(r))return;let n=e.get(r.id);null==n&&(n=new Te(r.vec3),e.set(r.id,n)),i?n.toAdd.push(t):n.toRemove.push(t)}function Ee(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Ae(e,t){let i;if(!e.some((e=>!(e.to-e.from<t)&&(i=e,!0))))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function we(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let i=!0;for(;i;)i=!1,e.forEach((r=>{const n=t.get(r.to);n&&(r.to=n.to,t.delete(n.from),e.removeUnordered(n),i=!0)}))}class Me{constructor(e,t){this.origin=e,this.buffer=t,this.instances=new Map,this.holes=new g.a({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Re{constructor(e,t,i,r){this.origin=e,this.buffer=t,this.renderCommands=i,this.occludeeCommands=r}}const Ce=new g.a({deallocator:null}),Pe=Object(T.d)(),Ie=Object(T.d)(),De=Object(T.d)();let Le=class extends u.a{constructor(){super(...arguments),this._pending=new Ne,this._changes=new $,this._materialRenderers=new Map,this._sortedMaterialRenderers=new g.a,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(f.c)(this._materialRenderers,(e=>e.rendersOccluded))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=function(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new K,t.set(e,i)),i};return e.removes.forAll((e=>{J(e)&&i(e.material).removes.push(e)})),e.adds.forAll((e=>{J(e)&&i(e.material).adds.push(e)})),e.updates.forAll((e=>{J(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}(this._changes);let t=!1,i=!1,r=!1;return e.forEach(((e,n)=>{let a=this._materialRenderers.get(n);if(!a&&e.adds.length>0&&(a=new xe(this.rctx,this.materialRepository,n),this._materialRenderers.set(n,a),t=!0,i=!0,r=!0),!a)return;const s=i||a.hasHighlights,o=r||a.hasWater;a.modify(e),i=i||s!==a.hasHighlights,r=r||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(n),a.dispose(),t=!0)})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(f.c)(this._materialRenderers,(e=>e.hasHighlights))),r&&(this._hasWater=Object(f.c)(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=this._pending.empty;for(const i of e)this._pending.adds.add(i);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const i of e)this._pending.adds.has(i)?(this._pending.removed.add(i),this._pending.adds.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=r,e.updateType=t}i&&this._changes.updates.length>0&&this.notifyChange("updating")}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((({materialRenderer:i})=>t=i.updateAnimation(e)||t)),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(t.slot,e.pass,t)}}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})})),this._sortedMaterialRenderers.sort(((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(l.a)([Object(_.b)()],Le.prototype,"rctx",void 0),Object(l.a)([Object(_.b)()],Le.prototype,"materialRepository",void 0),Object(l.a)([Object(_.b)()],Le.prototype,"updating",null),Le=Object(l.a)([Object(v.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Le);class Ne{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}var Fe,ze=i(495),Ue=i(545),Ge=i(411),Ve=i(139),ke=i(604),He=i(858),Be=i(501),We=i(388),qe=i(404),Ze=i(419),Xe=i(382),Ye=i(389),$e=i(626),Qe=i(355),Ke=i(203);!function(e){e[e.Screen=0]="Screen",e[e.World=1]="World"}(Fe||(Fe={}));class Je extends qe.a{constructor(e,t,i){super(e,t,i),this._kernelBlurRadius=1;const{R32F:r,textureFloatLinear:n}=e.rctx.capabilities.textureFloat,a=null!=r;this._kernelTextureChannels=a?1:4,this._floatInterpolationDisabled=!n;const s={target:F.A.TEXTURE_2D,pixelFormat:a?F.p.RED:F.p.RGBA,internalFormat:a?F.v.R32F:F.p.RGBA,dataType:F.q.FLOAT,samplingMode:F.z.NEAREST,wrapMode:F.B.CLAMP_TO_EDGE,width:1,height:1};this._kernel=new Ke.a(e.rctx,s)}initializeProgram(e){const t=Je.shader.get().build({isAttributeDriven:this.configuration.isAttributeDriven,mode:this.configuration.mode});return new Ye.a(e.rctx,t,Xe.a)}initializePipeline(){return Object(Qe.f)({blending:Object(Qe.h)(F.b.ONE,F.b.ONE,F.c.ADD),colorWrite:Qe.c,depthTest:null,depthWrite:null})}bindPass(e,t){const{camera:i}=t,{mode:r}=this.configuration;switch(Object(Be.b)(this.program,i.projectionMatrix),r){case $e.a.KernelDensity:this._bindKernelDensityPass(e,t);break;case $e.a.GaussianBlur:this._bindGaussianBlurPass(e,t)}}bindDraw(e){Object(Be.c)(this.program,e)}_bindKernelDensityPass({searchRadius:e,resolutionForScale:t},{camera:i,screenToWorldRatio:r}){0!==t&&(e/=r/t),this.program.setUniform1f("radius",e*i.pixelRatio/i.fullViewport[2])}_bindGaussianBlurPass({searchRadius:e,resolutionForScale:t},{camera:i,screenToWorldRatio:r}){const n=Math.round(e),a=3*(0===t?n:n*t/r);0===t||this._floatInterpolationDisabled?this._kernel.setSamplingMode(F.z.NEAREST):this._kernel.setSamplingMode(F.z.LINEAR),this._kernelBlurRadius!==n&&this._recomputeKernel(n),this.program.setUniform1f("radius",2*a*i.pixelRatio/i.fullViewport[2]),this.program.bindTexture(this._kernel,"kernel")}_recomputeKernel(e){const t=Object(He.b)(e),i=Math.ceil(t.length/2),r=this._kernelTextureChannels,n=new Float32Array(i*r);for(let a=0;a<i;++a){const e=t[i-1-a];for(let t=0;t<r;++t)n[a*r+t]=e}this._kernel.resize(i,1),this._kernel.setData(n),this._kernelBlurRadius=e}destroy(){this._kernel=Object(b.e)(this._kernel),super.destroy()}}Je.shader=new We.a($e.b,(()=>i.e(326).then(i.bind(null,1349))));class et extends Ze.a{constructor(){super(...arguments),this.isAttributeDriven=!1,this.mode=$e.a.GaussianBlur}}Object(l.a)([Object(Ze.b)()],et.prototype,"isAttributeDriven",void 0),Object(l.a)([Object(Ze.b)()],et.prototype,"mode",void 0);const tt={searchRadius:128,resolutionForScale:0,colorRampData:null,isAttributeDriven:!1,minDensity:0,maxDensity:100,fieldTotal:0,pixelRatio:1,...ie.a};class it extends ie.b{constructor(e){super(e,tt),this._techniqueConfig=new et}requiresSlot(e,t){return e===Ge.a.DRAPED_MATERIAL&&t===G.a.MATERIAL}getTechniqueConfig(){return this._techniqueConfig.isAttributeDriven=this.parameters.isAttributeDriven,this._techniqueConfig}createGLMaterial(e){return new rt(e)}intersect(){}createBufferWriter(){return new nt(this.parameters.isAttributeDriven?st:at)}}class rt extends Ue.a{constructor(e){super(e)}beginSlot(e){return this.updateParameters(e)}updateParameters(e){return this.ensureTechnique(Je,e)}bind(e,t){t.bindPass(this._material.parameters,e)}}class nt{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(Ve.a.POSITION).length*ot}write(e,t,i,r){Object(ke.f)(t.indices.get(Ve.a.POSITION),t.vertexAttributes.get(Ve.a.POSITION).data,e.transformation,i.position,r,ot);const n=t.indices.get(Ve.a.POSITION).length,a=i.uv0;let s=r;for(let c=0;c<n;++c)a.setValues(s++,-1,-1),a.setValues(s++,1,-1),a.setValues(s++,1,1),a.setValues(s++,1,1),a.setValues(s++,-1,1),a.setValues(s++,-1,-1);const o="featureAttribute"in i?i.featureAttribute:null;o&&Object(ke.a)(t.indices.get(Ve.a.FEATUREATTRIBUTE),t.vertexAttributes.get(Ve.a.FEATUREATTRIBUTE).data,o,r,ot)}}const at=Object(ze.a)().vec3f(Ve.a.POSITION).vec2f(Ve.a.UV0),st=at.clone().f32(Ve.a.FEATUREATTRIBUTE),ot=6;var ct=i(445),lt=i(1009);class ut extends qe.a{constructor(e,t){super(e,t,(()=>this.destroy()))}initializeProgram(e){const t=ut.shader.get().build({mode:this.configuration.mode});return new Ye.a(e.rctx,t,Xe.a)}initializePipeline(e){return Object(Qe.f)({blending:ct.d,colorWrite:Qe.c,depthTest:null,depthWrite:null})}bindPass(e,t){const{densityMap:i,colorRamp:r,maxDensity:n,minDensity:a,searchRadius:s}=e;this.program.bindTexture(i,"densityMap"),this.program.bindTexture(r,"tex"),this.configuration.mode===$e.a.KernelDensity&&this.program.setUniform1f("densityMultiplier",3/(s*s*Math.PI)),this.program.setUniform1f("densityNormalizer",1/(n-a)),this.program.setUniform1f("minDensity",a)}get primitiveType(){return F.r.TRIANGLE_STRIP}}ut.shader=new We.a(lt.a,(()=>i.e(325).then(i.bind(null,1350))));class ht extends Ze.a{constructor(){super(...arguments),this.mode=$e.a.GaussianBlur}}Object(l.a)([Object(Ze.b)()],ht.prototype,"mode",void 0);var dt=i(647);let pt=class extends Le{constructor(){super(...arguments),this.type="draped-heatmap"}initialize(){super.initialize();const e={colorTarget:F.y.TEXTURE,depthStencilTarget:F.m.NONE,width:0,height:0},{capabilities:t}=this.rctx,{R32F:i}=t.colorBufferFloat,{textureFloatLinear:r}=t.textureFloat,n=null!=i,a={target:F.A.TEXTURE_2D,pixelFormat:n?F.p.RED:F.p.RGBA,internalFormat:n?F.v.R32F:F.p.RGBA,dataType:F.q.FLOAT,samplingMode:r?F.z.LINEAR:F.z.NEAREST,wrapMode:F.B.CLAMP_TO_EDGE,width:0,height:0};this._densityMap=new z.a(this.rctx,e,a),this._quad=Object(Y.b)(this.rctx);const s={target:F.A.TEXTURE_2D,pixelFormat:F.p.RGBA,dataType:F.q.UNSIGNED_BYTE,samplingMode:F.z.LINEAR,wrapMode:F.B.CLAMP_TO_EDGE,width:1,height:1},o=new Ke.a(this.rctx,s,new Uint8ClampedArray(4));this._colorRamp=o,this._technique=new ut({rctx:this.rctx,viewingMode:S.a.Local},new ht),this._heatmapParameters={colorRamp:o,densityMap:this._densityMap.colorTexture,searchRadius:1,minDensity:0,maxDensity:100,fieldTotal:0}}destroy(){this._technique=Object(b.q)(this._technique),this._densityMap=Object(b.e)(this._densityMap),this._quad=Object(b.e)(this._quad),this._colorRamp=Object(b.e)(this._colorRamp)}get hasHighlights(){return!1}get hasWater(){return!1}get rendersOccluded(){return!1}get _heatmapDensityMaterialRenderers(){return this._sortedMaterialRenderers.filter(ft)}add(e){super.add(e)}remove(e){super.remove(e)}render(e,t){const i=this._heatmapDensityMaterialRenderers,r=i.length;if(r<1)return;const n=this.rctx.getBoundFramebufferObject(),a=this.rctx.getViewport(),s=i[0].material.parameters,{pixelRatio:o}=s,c=Math.ceil(a.width*o),l=Math.ceil(a.height*o);this._densityMap.resize(c,l),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,c,l),this.rctx.clear(F.e.COLOR_BUFFER_BIT);let u=!1;for(let b=0;b<r;b++){const r=i[b];r.material.shouldRender(e)&&(u=u||r.materialRenderer.render(t.slot,e.pass,t))}if(this.rctx.bindFramebuffer(n),this.rctx.setViewport(a.x,a.y,a.width,a.height),!u)return;const{searchRadius:h,minDensity:d,maxDensity:p,fieldTotal:f,colorRampData:g}=s,m=this._heatmapParameters;if(m.searchRadius=h,m.fieldTotal=f,m.searchRadius=h,m.minDensity=d,m.maxDensity=p,Object(b.k)(g)&&g!==this._colorRampData){const{colorRamp:e}=m,t=e.descriptor.width,i=g.length/4;i!==t&&e.resize(i,1),e.setData(g),this._colorRampData=g}this.rctx.bindVAO(this._quad),this.rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this.rctx),this._technique.bindPass(m,t),this.rctx.drawArrays(this._technique.primitiveType,0,Object(dt.f)(this._quad,"geometry"))}};function ft(e){return function(e){return e instanceof it}(e.material)}pt=Object(l.a)([Object(v.a)("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],pt);const bt=p.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class gt{constructor(e){this._glMaterial=e,this.refCnt=0,this._glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(ne.a)(this.refCnt>=0)}getRefCnt(){return this.refCnt}get glMaterial(){return this._glMaterial}}class mt{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new H.a}dispose(){this._textureRepository.dispose()}acquire(e,t){this._ownMaterial(e);let i=this._id2glMaterialRef.get(t,e.id);if(Object(b.j)(i)){const r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});i=new gt(r),this._id2glMaterialRef.set(t,e.id,i)}return i.incRefCnt(),i.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);Object(b.k)(i)&&(i.decRefCnt(),0===i.getRefCnt()&&(Object(b.e)(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){Object(b.k)(e.repository)&&e.repository!==this&&bt.error("Material is already owned by a different material repository"),e.repository=this}}var Ot=i(1088),_t=i(752),vt=i(608);class yt{constructor(e){this.rctx=e,this.camera=null,this.lastFrameCamera=new X.a,this.pass=G.a.MATERIAL,this.slot=Ge.a.OPAQUE_MATERIAL,this.highlightDepthTexture=null,this.renderOccludedMask=jt,this.hasOccludees=!1,this.hasFillLights=!0}resetRenderOccludedMask(){this.renderOccludedMask=jt}get isHighlightPass(){return this.pass===G.a.MATERIAL_HIGHLIGHT}}const jt=ie.c.Occlude|ie.c.OccludeAndTransparent|ie.c.OccludeAndTransparentStencil;var xt=i(1010);class Tt extends qe.a{initializeProgram(e){const t=Tt.shader.get().build();return new Ye.a(e.rctx,t,Xe.a)}initializePipeline(){return this.configuration.hasAlpha?Object(Qe.f)({blending:Object(Qe.g)(F.b.SRC_ALPHA,F.b.ONE,F.b.ONE_MINUS_SRC_ALPHA,F.b.ONE_MINUS_SRC_ALPHA),colorWrite:Qe.c}):Object(Qe.f)({colorWrite:Qe.c})}}Tt.shader=new We.a(xt.a,(()=>i.e(320).then(i.bind(null,1351))));class St extends Ze.a{constructor(){super(...arguments),this.hasAlpha=!1}}Object(l.a)([Object(Ze.b)()],St.prototype,"hasAlpha",void 0);class Et{constructor(e=Object(x.f)()){this.intensity=e}}class At{constructor(e=Object(x.f)(),t=Object(x.h)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class wt{constructor(e=Object(x.f)(),t=Object(x.h)(.57735,.57735,.57735),i=!0,r=1,n=1){this.intensity=e,this.direction=t,this.castShadows=i,this.specularStrength=r,this.environmentStrength=n}}class Mt{constructor(){this.r=[0],this.g=[0],this.b=[0]}}var Rt=i(117);function Ct(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function Pt(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function It(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function Dt(e){return(e+1)*(e+1)}function Lt(e,t,i){const r=e[0],n=e[1],a=e[2],s=i||[];return s.length=Dt(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*r*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*r*a,s[8]=.54627421529*(r*r-n*n)),s}function Nt(e,t){const i=(r=t.r.length,Object(R.e)(Math.floor(Math.sqrt(r)-1),0,2));var r;for(const n of e)Object(Rt.s)(Ht,n.direction),Lt(Ht,i,Vt),Ct(Vt,Bt),Pt(Vt,n.intensity[0],kt),It(t.r,kt),Pt(Vt,n.intensity[1],kt),It(t.g,kt),Pt(Vt,n.intensity[2],kt),It(t.b,kt);return t}function Ft(e,t,i,r){(function(e,t){const i=Dt(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0})(t,r),Object(Rt.w)(i.intensity,0,0,0);let n=!1;const a=zt,s=Ut,o=Gt;a.length=0,s.length=0,o.length=0;for(const c of e)c instanceof wt&&!n?(Object(Rt.k)(i.direction,c.direction),Object(Rt.k)(i.intensity,c.intensity),i.specularStrength=c.specularStrength,i.environmentStrength=c.environmentStrength,i.castShadows=c.castShadows,n=!0):c instanceof wt||c instanceof At?a.push(c):c instanceof Et?s.push(c):c instanceof Mt&&o.push(c);Nt(a,r),function(e,t){Lt(Ht,0,Vt);for(const i of e)t.r[0]+=Vt[0]*Bt[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Vt[0]*Bt[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Vt[0]*Bt[0]*i.intensity[2]*4*Math.PI}(s,r);for(const c of o)It(r.r,c.r),It(r.g,c.g),It(r.b,c.b)}const zt=[],Ut=[],Gt=[],Vt=[0],kt=[0],Ht=Object(x.f)(),Bt=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class Wt{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(x.f)(),ambient:{color:Object(x.f)(),intensity:1},diffuse:{color:Object(x.f)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new Mt,this._mainLight={intensity:Object(x.f)(),direction:Object(x.h)(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(e,t,i){const r=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",r),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("lightingSpecularStrength",this._mainLight.specularStrength),e.setUniform1f("lightingEnvironmentStrength",this._mainLight.environmentStrength),e.setUniform1f("ambientBoostFactor",this._ambientBoost),e.setUniform1b("hasFillLights",i);const n=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8]))}set(e){Ft(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(Rt.k)(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(Rt.e)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(Rt.k)(qt,this._oldSunlight.diffuse.color),Object(Rt.e)(qt,qt,this._ambientBoost*this.globalFactor),Object(Rt.f)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,qt)}get old(){return this._oldSunlight}}const qt=Object(x.f)();var Zt=i(436);class Xt{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach((e=>e.texture=Object(b.e)(e.texture))),this.cache.clear()}_acquire(e){if(Object(b.j)(e))return null;const t=this._patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const r=e.pixelRatio,{encodedData:n,sdfNormalizer:a,pixels:s,paddedPixels:o}=function(e,t){const i=e.map((e=>Math.round(e*t))),r=1/t,n=Math.floor(i.reduce(((e,t)=>e+t))),a=i.reduce(((e,t)=>Math.max(e,t))),s=(Math.floor(.5*(a-1))+.5)*r,o=[];let c=1;for(const f of i){for(let e=0;e<f;e++){const t=c*(Math.min(e,f-1-e)+.5)*r/s*.5+.5;o.push(t)}c=-c}const l=Math.round(i[0]/2),u=[...o.slice(l),...o.slice(0,l)],h=n+2,d=new Uint8Array(4*h);let p=4;for(const f of u)Object(Zt.a)(f,d,p),p+=4;return d.copyWithin(0,p-4,p),d.copyWithin(p,4,8),{encodedData:d,sdfNormalizer:s,paddedPixels:h,pixels:n}}(e.pattern,r),c=s/r,l={refCount:1,texture:null,bind:e=>(Object(b.j)(l.texture)&&(l.texture=new Ke.a(this._rctx,{width:o,height:1,internalFormat:F.p.RGBA,pixelFormat:F.p.RGBA,dataType:F.q.UNSIGNED_BYTE,wrapMode:F.B.CLAMP_TO_EDGE},n)),e.bindTexture(l.texture,"stipplePatternTexture"),{pixelSize:c,sdfNormalizer:a,pixels:s})};return this.cache.set(t,l),l.bind}release(e){if(Object(b.j)(e))return;const t=this._patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(b.k)(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this._acquire(t);return this.release(e),i}_patternId(e){return`${e.pattern.join(",")}-r${e.pixelRatio}`}}var Yt,$t=i(859);!function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(Yt||(Yt={}));class Qt extends qe.a{initializeProgram(e){const t=Qt.shader.get().build(this.configuration);return new Ye.a(e.rctx,t,Xe.a)}initializePipeline(){if(this.configuration.function===$t.a.TransparentToHUDVisibility)return Object(Qe.f)({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case Yt.None:return Object(Qe.f)({colorWrite:Qe.c});case Yt.Alpha:return Object(Qe.f)({blending:Object(Qe.g)(F.b.SRC_ALPHA,F.b.ONE,F.b.ONE_MINUS_SRC_ALPHA,F.b.ONE_MINUS_SRC_ALPHA),colorWrite:Qe.c});default:return Object(Qe.f)({blending:Object(Qe.h)(F.b.ONE,F.b.ONE_MINUS_SRC_ALPHA),colorWrite:Qe.c})}}}Qt.shader=new We.a($t.b,(()=>i.e(322).then(i.bind(null,1352))));class Kt extends Ze.a{constructor(){super(...arguments),this.function=$t.a.Standard,this.alphaMode=Yt.None,this.hasOpacityFactor=!1}}Object(l.a)([Object(Ze.b)({count:$t.a.COUNT})],Kt.prototype,"function",void 0),Object(l.a)([Object(Ze.b)({count:Yt.COUNT})],Kt.prototype,"alphaMode",void 0),Object(l.a)([Object(Ze.b)()],Kt.prototype,"hasOpacityFactor",void 0);var Jt=i(514);const ei=p.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let ti=class extends(Z(u.a)){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new Wt,this._handles=new d.a,this._frameTask=Jt.a,this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new g.a,this._geometries=new Map,this.worldToPCSRatio=1,this.events=new h.a,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new yt(this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new Xt(e.renderingContext),this._shaderTechniqueRepository=new W({rctx:this._rctx,viewingMode:S.a.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Object(O.a)(t,"loadingState",(()=>this.events.emit("content-changed"))),Object(O.a)(this,"spatialReference",(e=>this._localOrigins=new Ot.a(e)))]),this._materialRepository=new mt(e.textureRepository,this._shaderTechniqueRepository,(e=>{(e.renderOccluded&li)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")}),(()=>this.events.emit("content-changed"))),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new Et(Object(x.h)(1,1,1))]),this._bindParameters={slot:Ge.a.DRAPED_MATERIAL,highlightDepthTexture:Object(Y.a)(this._rctx),camera:ai,inverseViewport:Object(j.a)(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:T.a,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:P.i.NONE,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0},this._frameTask=this.view.resourceController.scheduler.registerTask(Jt.b.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._layerRenderers.forEach((e=>e.destroy())),this._layerRenderers.clear(),this._debugTextureTechnique=Object(b.q)(this._debugTextureTechnique),this._debugPatternTexture=Object(b.e)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(b.e)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(b.e)(this._shaderTechniqueRepository),this._temporaryFBO=Object(b.e)(this._temporaryFBO),this._quadVAO=Object(b.e)(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedLayerRenderersDirty||this._frameTask.updating||Object(f.c)(this._layerRenderers,(e=>e.updating))}get hasOverlays(){return Object(b.k)(this._overlays)&&Object(b.k)(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(b.k)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(b.k)(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Object(b.t)(this._overlays,[])}ensureDrapeTargets(e){Object(b.k)(this._overlays)&&this._overlays.forEach((t=>{t.hasTargetWithoutRasterImage=Object(m.a)(e,(e=>e.drapeTargetType===E.b.WithoutRasterImage))}))}ensureDrapeSources(e){Object(b.k)(this._overlays)&&this._overlays.forEach((t=>{t.hasDrapedFeatureSource=Object(f.c)(e,((e,t)=>t.drapeSourceType===E.a.Features)),t.hasDrapedRasterSource=Object(f.c)(e,((e,t)=>t.drapeSourceType===E.a.RasterImage))}))}ensureOverlays(e,t){Object(b.j)(this._overlays)&&(this._overlayRenderTarget=new V(this._rctx),this._overlays=[new D(r.INNER,this._overlayRenderTarget),new D(r.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(b.e)(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}_processLayers(e,t){let i=!1;for(const[r,n]of this._layerRenderers){if(e.done)break;(r.destroyed||t(r))&&(n.commitChanges()&&(i=!0,e.madeProgress()),n.isEmpty&&(i=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(r),this._handles.remove(r),n.destroy()))}this._updateSortedLayerRenderers(),i&&(Object(b.k)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncLayers(){this._processLayers(Jt.c,(e=>e.updatePolicy===P.j.SYNC))}addGeometries(e,t,i,r=!1){for(const n of e)Object(b.j)(n.origin)&&(n.origin=this._localOrigins.getOrigin(n.boundingSphere)),this._geometries.set(n.id,n);this._ensureLayerRenderer(t,r).add(e),i===re.a.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,i){for(const n of e)this._geometries.delete(Object(b.s)(n.id));const r=this._layerRenderers.get(t);r&&(r.remove(e),i===re.a.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,i){const r=this._layerRenderers.get(t);if(r)switch(r.modify(e,i),i){case re.a.State.TRANSFORMATION:case re.a.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e,t);case re.a.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e,t)}else ei.warn("Attempted to update geometry for nonexistent layer")}_notifyGraphicGeometryChanged(e,t){if(Object(b.j)(t.notifyGraphicGeometryChanged))return;let i;for(const r of e){const e=r.graphicUid;Object(b.k)(e)&&e!==i&&(t.notifyGraphicGeometryChanged(e),i=e)}}_notifyGraphicVisibilityChanged(e,t){if(Object(b.j)(t.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const e=r.graphicUid;Object(b.k)(e)&&e!==i&&(t.notifyGraphicVisibilityChanged(e),i=e)}}updateHighlights(e,t){const i=this._layerRenderers.get(t);i?i.modify(e,re.a.State.HIGHLIGHTS):ei.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!A.a.OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._layerRenderers.forEach((i=>t=i.updateAnimation(e)||t)),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,i){const n=e.canvasGeometries;if(0===n.numViews)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const a=t.renderPass;if(this.isEmpty()||a===G.a.MATERIAL_HIGHLIGHT&&!this.hasHighlights||a===G.a.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const o=t.fbo;if(!o.isValid())return!1;const c=2*e.resolution,l=e.resolution;o.resize(c,l);const u=this._rctx;ai.pixelRatio=e.pixelRatio*i,this._renderContext.pass=a,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===G.a.MATERIAL_NORMAL?Ge.a.DRAPED_WATER:Ge.a.DRAPED_MATERIAL,e.applyViewport(this._rctx),o.bind(u),e.index===r.INNER&&(u.setClearColor(0,0,0,0),u.clearSafe(F.e.COLOR_BUFFER_BIT));const h=t.type===s.ColorNoRasterImage?ii.ExcludeRasterImage:t.type===s.Occluded?ii.OccludedOnly:ii.Normal;if(h===ii.OccludedOnly&&(this._renderContext.renderOccludedMask=li),A.a.OVERLAY_DRAW_DEBUG_TEXTURE&&h!==ii.OccludedOnly)for(let r=0;r<n.numViews;r++)this._setViewParameters(n.extents[r],e,ai),this._drawDebugTexture(e.resolution,ni[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((({overlayLayer:t,renderer:i})=>{if(h===ii.ExcludeRasterImage&&t.drapeSourceType===E.a.RasterImage)return;const{fullOpacity:r}=t,s=Object(b.k)(r)&&r<1&&a===G.a.MATERIAL;s&&(this.bindTemporaryFramebuffer(this._rctx,c,l),u.clearSafe(F.e.COLOR_BUFFER_BIT));for(let a=0;a<n.numViews;a++)this._setViewParameters(n.extents[a],e,ai),i.render(this._renderContext,this._bindParameters);s&&Object(b.k)(this._temporaryFBO)&&(o.bind(u),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),Yt.PremultipliedAlpha,r,$t.a.OverlayWithTransparency,e.index))})),u.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){Object(b.j)(this._temporaryFBO)&&(this._temporaryFBO=new U(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}intersect(e,t,i,r){let n=0;this._geometries.forEach((a=>{if(r&&!r(a))return;this._intersectRenderGeometry(a,i,t,0,e,n);const s=this.longitudeCyclical;s&&(a.boundingSphere[0]-a.boundingSphere[3]<s.min&&this._intersectRenderGeometry(a,i,t,s.range,e,n),a.boundingSphere[0]+a.boundingSphere[3]>s.max&&this._intersectRenderGeometry(a,i,t,-s.range,e,n)),n++}))}_intersectRenderGeometry(e,t,i,r,n,a){if(!e.instanceParameters.visible)return;let s=0;Object(b.k)(e.transformation)&&(r+=e.transformation[12],s=e.transformation[13]),si[0]=i[0]-r,si[1]=i[1]-s,si[2]=1,oi[0]=i[0]-r,oi[1]=i[1]-s,oi[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),n,si,oi,((i,r,s)=>{!function(e,t,i,r,n,a,s){const o={layerUid:a,graphicUid:s,triangleNr:t},c=t=>{t.set(vt.b.OVERLAY,o,e.dist,e.normal,e.transformation,i,r)};if((null==n.results.min.drapedLayerOrder||i>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&c(n.results.min),n.options.store!==vt.c.MIN&&(null==n.results.max.drapedLayerOrder||i<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&c(n.results.max),n.options.store===vt.c.ALL){const e=Object(_t.b)(n.ray);c(e),n.results.all.push(e)}}(t,s,e.material.renderPriority,a,n,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,t)}_ensureLayerRenderer(e,t){let i=this._layerRenderers.get(e);return i&&t===i instanceof pt||(i=t?new pt({rctx:this._rctx,materialRepository:this._materialRepository}):new Le({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,i),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(()=>this.events.emit("content-changed"))),e),this._handles.add(Object(O.a)(i,"updating",(()=>this.notifyChange("updating"))),e)),i}_updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const e=this.view.map.allLayers;this._layerRenderers.forEach(((t,i)=>{const r=e.indexOf(i.layer);this._sortedLayerRenderers.push(new ri(i,t,r<0?1/0:r))})),this._sortedLayerRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,Object(y.q)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Object(y.f)(i.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=i,this._bindParameters.camera=i,this._bindParameters.inverseViewport[0]=1/i.fullViewport[2],this._bindParameters.inverseViewport[1]=1/i.fullViewport[3]}_updateHasWater(){const e=Object(f.c)(this._layerRenderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Object(f.c)(this._layerRenderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Object(f.c)(this._layerRenderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.useTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture(this._debugPatternTexture,"tex"),i.bindVAO(this._quadVAO),i.drawArrays(F.r.TRIANGLE_STRIP,0,Object(dt.f)(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let a=0;a<t;a++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(a/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&n^1&a?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new Ke.a(this._rctx,{target:F.A.TEXTURE_2D,pixelFormat:F.p.RGBA,dataType:F.q.UNSIGNED_BYTE,samplingMode:F.z.NEAREST,width:e,height:t},i);const n=new St;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Tt,n),this._quadVAO=Object(Y.b)(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};var ii;Object(l.a)([Object(_.b)()],ti.prototype,"_frameTask",void 0),Object(l.a)([Object(_.b)()],ti.prototype,"_sortedLayerRenderersDirty",void 0),Object(l.a)([(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}],ti.prototype,"_shaderTechniqueRepository",void 0),Object(l.a)([(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}],ti.prototype,"_stippleTextureRepository",void 0),Object(l.a)([Object(_.b)({constructOnly:!0})],ti.prototype,"view",void 0),Object(l.a)([Object(_.b)()],ti.prototype,"worldToPCSRatio",void 0),Object(l.a)([Object(_.b)()],ti.prototype,"spatialReference",void 0),Object(l.a)([Object(_.b)({type:Boolean,readOnly:!0})],ti.prototype,"updating",null),ti=Object(l.a)([Object(v.a)("esri.views.3d.terrain.OverlayRenderer")],ti),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(ii||(ii={}));class ri{constructor(e,t,i){this.overlayLayer=e,this.renderer=t,this.index=i}}const ni=[[1,.5,.5],[.5,.5,1]];const ai=new X.a;ai.near=1,ai.far=1e4,ai.relativeElevation=null;const si=Object(x.f)(),oi=Object(x.f)(),ci=-2,li=ie.c.OccludeAndTransparent},1061:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i(410),n=i(126);function a(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMatrix","mat4"),e.fragment.uniforms.add("proj","mat4"),e.fragment.code.add(n.a`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function s(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("view","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(r.a),e.include(a),e.fragment.code.add(n.a`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function o(e,t){var i,r;t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("view",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),r=t,(i=e).bindTexture(r.lastFrameColorTexture,"lastFrameColorMap"),i.setUniformMatrix4fv("reprojectionMatrix",r.reprojectionMatrix),i.setUniformMatrix4fv("proj",r.camera.projectionMatrix))}},1071:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(r||(r={}))},1084:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(410),n=i(857),a=i(500),s=i(126);function o(e,t){t.multipassGeometryEnabled&&e.vertex.include(n.b),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(s.a`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?s.a`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(r.a),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(a.a),e.fragment.code.add(s.a`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?s.a`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},1085:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i(85);const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},a={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null};function s(e,t=2){return{pattern:[e,e],pixelRatio:t}}function o(e){return Object(r.k)(e)&&"style"===e.type?function(e){return Object(r.k)(e)?function(e,t=2){return Object(r.j)(e)?e:{pattern:e.slice(),pixelRatio:t}}(a[e],8):null}(e.style):null}},1086:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(1007),n=i(947),a=i(754),s=i(1061),o=i(948),c=i(126);function l(e,t){e.include(a.a,t),e.include(n.a),e.include(r.a),t.cloudsReflectionsEnabled&&e.include(o.a),t.ssrEnabled&&e.include(s.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),e.fragment.code.add(c.a`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(c.a`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.cloudsReflectionsEnabled&&e.fragment.code.add(c.a`vec4 cloudsColor = crossFade == 0 ? renderCloud(reflectedWorld, position) : renderCloudCrossFade(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * (1.0 - totalFadeInOut);`),t.ssrEnabled?e.fragment.code.add(c.a`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):e.fragment.code.add(c.a`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.cloudsReflectionsEnabled?t.ssrEnabled?e.fragment.code.add(c.a`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):e.fragment.code.add(c.a`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):e.fragment.code.add(c.a`return waterRenderedColor;
}`)}},1087:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(219),n=i(335);const a={waveStrength:.06,waveTextureRepeat:32,waveDirection:Object(r.e)(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...n.a},s={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}},1088:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i(85),n=i(244),a=i(200),s=i(117),o=i(109),c=i(187),l=i(163),u=i(595),h=i(1005),d=i(659),p=i(139),f=i(776),b=i(777);class g{constructor(e,t=125e4){this._originSR=e,this._gridSize=t,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Object(n.a)()}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){if(Object(r.k)(m))return this._origins.set(this._rootOriginId,Object(h.a)(m[0],m[1],m[2],this._rootOriginId)),this.getOrigin(e);const t=Object(h.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,t),t}const i=this._gridSize,n=Math.round(e[0]/i),a=Math.round(e[1]/i),o=Math.round(e[2]/i),c=`${n}/${a}/${o}`;let l=this._origins.get(c);const u=.5*i;if(Object(s.j)(O,e,t.vec3),O[0]=Math.abs(O[0]),O[1]=Math.abs(O[1]),O[2]=Math.abs(O[2]),O[0]<u&&O[1]<u&&O[2]<u){if(l){const t=Math.max(...O);if(Object(s.j)(O,e,l.vec3),O[0]=Math.abs(O[0]),O[1]=Math.abs(O[1]),O[2]=Math.abs(O[2]),Math.max(...O)<t)return l}return t}return l||(l=Object(h.a)(n*i,a*i,o*i,c),this._origins.set(c,l)),l}_drawOriginBox(e,t=[1,1,0,1]){const i=window.view,r=i._stage,n=t.toString();if(!this._objects.has(n)){this._material=new b.a({width:2,color:t}),r.add(this._material);const e=new f.a({isPickable:!1}),i=new d.a({castShadow:!1});r.add(i),e.add(i),r.add(e),this._objects.set(n,i)}const s=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],h=o.length,g=new Array(3*h),m=new Uint16Array(2*(h-1)),O=.5*this._gridSize;for(let a=0;a<h;a++)g[3*a+0]=e[0]+(1&o[a]?O:-O),g[3*a+1]=e[1]+(2&o[a]?O:-O),g[3*a+2]=e[2]+(4&o[a]?O:-O),a>0&&(m[2*a+0]=a-1,m[2*a+1]=a);Object(c.l)(g,this._originSR,0,g,i.renderSpatialReference,0,h);const _=new u.a([[p.a.POSITION,{size:3,data:g,exclusive:!0}]],[[p.a.POSITION,m]],l.f.Line);r.add(_),s.addGeometry(_,this._material,a.a)}}let m=null;const O=Object(o.f)()},1100:function(e,t,i){"use strict";i.d(t,"a",(function(){return we}));var r=i(210),n=i(85),a=i(448);class s{constructor(){this.enabled=!0,this._time=0}get time(){return Object(a.a)(this._time)}advance(e){return Object(n.k)(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}var o=i(621),c=i(335),l=i(445),u=i(411),h=i(163),d=i(545),p=i(79),f=i(82),b=i(100),g=i(116),m=i(81),O=(i(84),i(83),i(80)),_=i(147),v=i(200),y=i(117),j=i(109),x=(i(543),i(462)),T=i(526);i(288);function S(e=A){return[e[0],e[1],e[2],e[3]]}function E(e,t,i=S()){return Object(y.g)(i,e,t),Object(y.r)(i,i),i[3]=Object(T.a)(e,t),i}const A=[0,0,1,0];Object(x.b)(),Object(x.b)();var w=i(1006),M=i(388),R=i(404),C=i(382),P=i(389),I=i(94),D=i(355);class L extends R.a{constructor(e){super(e,null,(()=>this.destroy()))}initializeProgram(e){const t=L.shader.get().build();return new P.a(e.rctx,t,C.a)}initializePipeline(){return Object(D.f)({blending:Object(D.h)(I.b.ONE,I.b.SRC_ALPHA),depthTest:{func:I.h.LEQUAL},colorWrite:D.c})}}L.shader=new M.a(w.a,(()=>i.e(318).then(i.bind(null,1348))));var N,F=i(86),z=i(95);let U=N=class extends F.a{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new N({cloudCover:this.cloudCover})}};Object(p.a)([Object(z.a)({cloudy:"cloudy"})],U.prototype,"type",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],U.prototype,"cloudCover",void 0),U=N=Object(p.a)([Object(O.a)("esri.views.3d.environment.CloudyWeather")],U);const G=U;var V;let k=V=class extends F.a{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new V({fogStrength:this.fogStrength})}};Object(p.a)([Object(z.a)({foggy:"foggy"})],k.prototype,"type",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],k.prototype,"fogStrength",void 0),k=V=Object(p.a)([Object(O.a)("esri.views.3d.environment.FoggyWeather")],k);const H=k;var B;let W=B=class extends F.a{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new B({cloudCover:this.cloudCover,precipitation:this.precipitation})}};Object(p.a)([Object(z.a)({rainy:"rainy"})],W.prototype,"type",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],W.prototype,"cloudCover",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],W.prototype,"precipitation",void 0),W=B=Object(p.a)([Object(O.a)("esri.views.3d.environment.RainyWeather")],W);const q=W;var Z;let X=Z=class extends b.a{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Z({cloudCover:this.cloudCover,precipitation:this.precipitation})}};Object(p.a)([Object(z.a)({snowy:"snowy"})],X.prototype,"type",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],X.prototype,"cloudCover",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],X.prototype,"precipitation",void 0),X=Z=Object(p.a)([Object(O.a)("esri.views.3d.environment.SnowyWeather")],X);const Y=X;var $;let Q=$=class extends F.a{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new $({cloudCover:this.cloudCover})}};Object(p.a)([Object(z.a)({sunny:"sunny"})],Q.prototype,"type",void 0),Object(p.a)([Object(m.b)({type:Number,nonNullable:!0,range:{min:0,max:1}})],Q.prototype,"cloudCover",void 0),Q=$=Object(p.a)([Object(O.a)("esri.views.3d.environment.SunnyWeather")],Q);const K={key:"type",base:null,typeMap:{sunny:Q,cloudy:G,rainy:q,snowy:Y,foggy:H}};Object.keys(K.typeMap);const J=1e4;var ee=i(692);let te=class extends b.a{constructor(e){super(e),this._inverseProjectionMatrix=Object(v.d)(),this._inverseViewMatrix=Object(v.d)(),this._technique=new L(e),this._vao=Object(ee.b)(e.rctx),this._setDefaultParallax(e.radius)}destroy(){this._technique=Object(n.q)(this._technique),this._vao=Object(n.e)(this._vao)}render(e,t,i){this._parameters.clouds=t;const r=e.camera;if(Object(n.j)(this._vao)||Object(n.j)(r))return;const a=e.rctx,s=a.useTechnique(this._technique);e.scenelightingData.setLightDirectionUniform(s),e.scenelightingData.setUniforms(s,!1,!1),Object(_.a)(this._inverseProjectionMatrix,r.projectionMatrix),Object(_.a)(this._inverseViewMatrix,r.viewMatrix),s.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix),s.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix),s.setUniform2f("cloudVariables",this._parameters.clouds.coverage,this._parameters.clouds.absorption),this._setParallaxParams(r.eye,i),e.cloudsCompositionParams=this._parameters,oe(s,r,this._parameters),a.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),a.drawArrays(I.r.TRIANGLE_STRIP,0,4)}get isFading(){return this._parameters.crossFade.stage!==ne.FINISHED||this._parameters.fadeInOut.stage!==re.FINISHED||this._parameters.fadeIn.stage!==ie.FINISHED||this._parameters.fadeInOutHeight.stage!==ae.FINISHED}_setDefaultParallax(e){this._parameters={parallax:{anchorPointClouds:Object(j.f)(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(v.d)()},parallaxNew:{anchorPointClouds:Object(j.f)(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Object(v.d)()},crossFade:{stage:ne.FINISHED,factor:0,distanceThresholdFactor:.3},fadeInOut:{stage:re.FINISHED,factor:0,distanceThresholdFactor:.6},fadeIn:{stage:ie.FINISHED,factor:0,distanceThresholdFactor:2},fadeInOutHeight:{stage:ae.FINISHED,factor:-1},cameraPositionLastFrame:Object(j.f)(),startTime:0,startTimeHeightFade:0,clouds:null}}_isCameraPositionFinal(e){return Object(y.C)(this._parameters.cameraPositionLastFrame,e)}_setFadeInStage(e){const t=this._isCameraPositionFinal(e);this._parameters.fadeIn.stage===ie.FINISHED&&(this._parameters.fadeIn.factor=1,Object(y.k)(this._parameters.parallax.anchorPointClouds,ue),this._parameters.fadeIn.stage=ie.CHANGE_ANCHOR,this._parameters.crossFade.stage=ne.FINISHED,this._parameters.fadeInOut.stage=re.FINISHED),this._parameters.fadeIn.stage===ie.CHANGE_ANCHOR&&t&&(Object(y.k)(this._parameters.parallax.anchorPointClouds,ue),this._parameters.fadeIn.stage=ie.FADE_IN,this._parameters.startTime=performance.now()),this._parameters.fadeIn.factor>0&&this._parameters.fadeIn.stage===ie.FADE_IN&&(this._parameters.fadeIn.factor=1-(performance.now()-this._parameters.startTime)/500),this._parameters.fadeIn.factor<=0&&this._parameters.fadeIn.stage===ie.FADE_IN&&(this._parameters.fadeIn.stage=ie.FINISHED,this._parameters.fadeIn.factor=0)}_setCrossFadingStage(){this._parameters.crossFade.stage===ne.FINISHED&&(Object(y.k)(this._parameters.parallaxNew.anchorPointClouds,ue),this._parameters.startTime=performance.now(),this._parameters.crossFade.factor=0,this._parameters.crossFade.stage=ne.CROSS_FADE),this._parameters.crossFade.factor<1&&this._parameters.crossFade.stage===ne.CROSS_FADE&&(this._parameters.crossFade.factor=(performance.now()-this._parameters.startTime)/500),this._parameters.crossFade.factor>=1&&this._parameters.crossFade.stage===ne.CROSS_FADE&&(this._parameters.crossFade.stage=ne.FINISHED,this._parameters.crossFade.factor=1,Object(y.k)(this._parameters.parallax.anchorPointClouds,this._parameters.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e){this._parameters.fadeInOut.stage===re.FINISHED&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=0,this._parameters.fadeInOut.stage=re.FADE_OUT),this._parameters.fadeInOut.factor<1&&this._parameters.fadeInOut.stage===re.FADE_OUT&&(this._parameters.fadeInOut.factor=(performance.now()-this._parameters.startTime)/250),this._parameters.fadeInOut.factor>=1&&this._parameters.fadeInOut.stage===re.FADE_OUT&&(this._parameters.fadeInOut.factor=1,Object(y.k)(this._parameters.parallax.anchorPointClouds,ue)),this._parameters.fadeInOut.factor>=1&&this._parameters.fadeInOut.stage===re.FADE_OUT&&this._isCameraPositionFinal(e)&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=1,this._parameters.fadeInOut.stage=re.FADE_IN,this._parameters.crossFade.stage=ne.FINISHED,this._parameters.crossFade.factor=0),this._parameters.fadeInOut.factor>0&&this._parameters.fadeInOut.stage===re.FADE_IN&&(this._parameters.fadeInOut.factor=1-(performance.now()-this._parameters.startTime)/500),this._parameters.fadeInOut.factor<=0&&this._parameters.fadeInOut.stage===re.FADE_IN&&(this._parameters.fadeInOut.stage=re.FINISHED,this._parameters.fadeInOut.factor=0)}_setFadeInOutHeight(e){const t=performance.now();this._parameters.startTimeHeightFade=this._parameters.fadeInOutHeight.stage===ae.FINISHED?t:this._parameters.startTimeHeightFade,e?this._parameters.fadeInOutHeight.factor+=(t-this._parameters.startTimeHeightFade)/500:this._parameters.fadeInOutHeight.factor-=(t-this._parameters.startTimeHeightFade)/500,this._parameters.startTimeHeightFade=t,this._parameters.fadeInOutHeight.factor=Object(g.e)(this._parameters.fadeInOutHeight.factor,0,1),this._parameters.fadeInOutHeight.stage=ae.HEIGHT_FADE}_setParallaxParams(e,t){this._parameters.fadeInOutHeight.factor<0&&(this._parameters.fadeInOutHeight.factor=Object(y.p)(e)-this._parameters.parallax.radius>J?1:0),Object(y.r)(ue,e),Object(y.e)(ue,ue,this._parameters.parallax.radius),0===this._parameters.parallax.anchorPointClouds[0]&&0===this._parameters.parallax.anchorPointClouds[1]&&0===this._parameters.parallax.anchorPointClouds[2]&&Object(y.k)(this._parameters.parallax.anchorPointClouds,ue);const i=Object(y.p)(Object(y.j)(he,this._parameters.parallax.anchorPointClouds,ue));let r=!0;i>this._parameters.fadeIn.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeIn.stage!==ie.FINISHED?this._setFadeInStage(e):i>this._parameters.fadeInOut.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeInOut.stage!==re.FINISHED?this._setFadeInOutStage(e):i>this._parameters.crossFade.distanceThresholdFactor*this._parameters.parallax.cloudsHeight&&!t||this._parameters.crossFade.stage!==ne.FINISHED?this._setCrossFadingStage():r=!1;const n=Object(y.p)(e),a=n-this._parameters.parallax.radius;(a>17e3||a<-1e4)&&this._parameters.fadeInOutHeight.factor<1?this._parameters.fadeInOutHeight.factor=1:(a>J||a<-3500)&&this._parameters.fadeInOutHeight.factor<1?this._setFadeInOutHeight(!0):a<J&&a>-3500&&this._parameters.fadeInOutHeight.factor>0?this._setFadeInOutHeight(!1):this._parameters.fadeInOutHeight.stage=ae.FINISHED,this._parameters.parallax.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(n*n-this._parameters.parallax.radius*this._parameters.parallax.radius,0))/n,E(ce,this._parameters.parallax.anchorPointClouds,le),this._parameters.parallax.transform=Object(v.d)(),Object(_.e)(this._parameters.parallax.transform,this._parameters.parallax.transform,le[3],le),r&&(E(ce,this._parameters.parallaxNew.anchorPointClouds,le),this._parameters.parallaxNew.transform=Object(v.d)(),Object(_.e)(this._parameters.parallaxNew.transform,this._parameters.parallaxNew.transform,le[3],le)),Object(y.k)(this._parameters.cameraPositionLastFrame,e)}};var ie,re,ne,ae,se;function oe(e,t,i){e.bindTexture(i.clouds.cubeMap.colorTexture,"cubeMap"),e.setUniform1f("cloudsHeight",i.parallax.cloudsHeight),e.setUniformMatrix4fv("rotationMatrixClouds",i.parallax.transform),e.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",i.parallaxNew.transform),e.setUniform3fv("anchorPosition",i.parallax.anchorPointClouds),e.setUniform3fv("anchorPositionCrossFade",i.parallaxNew.anchorPointClouds),i.fadeInOut.stage!==re.FINISHED?e.setUniform1f("totalFadeInOut",i.fadeInOutHeight.factor+Math.max(Object(g.e)(i.fadeInOut.factor,0,1))):e.setUniform1f("totalFadeInOut",i.fadeInOutHeight.factor+Math.max(Object(g.e)(i.fadeIn.factor,0,1))),e.setUniform1f("radiusCurvatureCorrectionFactor",i.parallax.radiusCurvatureCorrectionFactor),e.setUniform1i("crossFade",i.crossFade.stage),e.setUniform1f("crossFadeAnchorFactor",Object(g.e)(i.crossFade.factor,0,1)),e.setUniform1f("radius",i.parallax.radius),e.setUniform3fv("cameraPosition",t.eye)}Object(p.a)([Object(m.b)({constructOnly:!0})],te.prototype,"rctx",void 0),Object(p.a)([Object(m.b)({constructOnly:!0})],te.prototype,"viewingMode",void 0),Object(p.a)([Object(m.b)({constructOnly:!0})],te.prototype,"radius",void 0),te=Object(p.a)([Object(O.a)("esri.views.3d.environment.CloudsComposition")],te),(se=ie||(ie={}))[se.FINISHED=0]="FINISHED",se[se.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",se[se.FADE_IN=2]="FADE_IN",function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.FADE_IN=2]="FADE_IN"}(re||(re={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.CROSS_FADE=1]="CROSS_FADE"}(ne||(ne={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(ae||(ae={}));const ce=Object(j.h)(0,0,1),le=S(),ue=Object(j.f)(),he=Object(j.f)();var de=i(301),pe=i(420),fe=i(356),be=i(502),ge=i(625),me=i(1061),Oe=i(949),_e=i(501),ve=i(419),ye=i(1008);class je extends R.a{constructor(e,t,i){super(e,t,i),this._textureRepository=e.waterTextureRepository}initializeProgram(e){const t=je.shader.get(),i=this.configuration,r=t.build({oitEnabled:i.transparencyPassType===h.i.Color,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,pbrMode:be.a.Water,useCustomDTRExponentForWater:!0,ssrEnabled:i.useSSR,cloudsReflectionsEnabled:Object(f.a)("enable-feature:clouds-reflections"),highStepCount:!0,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new P.a(e.rctx,r,C.a)}bindPass(e,t){Object(_e.b)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(fe.a)(this.program,t)),this.configuration.output===r.a.Color&&(t.lighting.setUniforms(this.program,!1,!1),Object(me.b)(this.program,t),Object(f.a)("enable-feature:clouds-reflections")&&Object(n.k)(t.cloudsCompositionParams)&&oe(this.program,t.camera,t.cloudsCompositionParams)),this.configuration.output!==r.a.Color&&this.configuration.output!==r.a.Normal||(Object(Oe.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),this.configuration.output===r.a.Highlight&&Object(pe.b)(this.program,t)}bindDraw(e){Object(_e.c)(this.program,e),this.program.rebindTextures(),this.configuration.output!==r.a.Color&&this.configuration.output!==r.a.Alpha||Object(_e.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),this.configuration.output===r.a.Color&&Object(ge.b)(this.program,e),this.configuration.output!==r.a.Color&&this.configuration.output!==r.a.Alpha&&this.configuration.output!==r.a.Highlight||Object(de.c)(this.program,this.configuration,e)}_setPipelineState(e){const t=this.configuration,i=e===h.i.NONE,n=e===h.i.FrontFace;return Object(D.f)({blending:t.output!==r.a.Normal&&t.output!==r.a.Highlight&&t.transparent?i?l.d:Object(l.f)(e):null,depthTest:{func:Object(l.g)(e)},depthWrite:i?t.writeDepth&&D.d:Object(l.h)(e),colorWrite:D.c,polygonOffset:i||n?null:Object(l.e)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}je.shader=new M.a(ye.a,(()=>i.e(338).then(i.bind(null,1347))));class xe extends ve.a{constructor(){super(...arguments),this.output=r.a.Color,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=h.i.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(p.a)([Object(ve.b)({count:r.a.COUNT})],xe.prototype,"output",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"receiveShadows",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"slicePlaneEnabled",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"transparent",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"enableOffset",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"writeDepth",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"useSSR",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"isDraped",void 0),Object(p.a)([Object(ve.b)({count:h.i.COUNT})],xe.prototype,"transparencyPassType",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"multipassTerrainEnabled",void 0),Object(p.a)([Object(ve.b)()],xe.prototype,"cullAboveGround",void 0);class Te extends d.a{updateParameters(e){return this.ensureTechnique(je,e)}setElapsedTimeUniform(e){const t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.parameters.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:e.ssrEnabled})}ensureResources(e){const t=this._techniqueRep.constructionContext.waterTextureRepository;return t.ready||t.updating||t.loadTextures(e),t.ready?h.g.LOADED:h.g.LOADING}beginSlot(e){return this._output===r.a.Color&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),this._output!==r.a.Normal&&this._output!==r.a.Color||this.setElapsedTimeUniform(t.program)}}var Se=i(713),Ee=i(434),Ae=i(1087);class we extends c.b{constructor(e){super(e,Ae.a),this._techniqueConfig=new xe,this.animation=new s}getTechniqueConfig(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<l.b,this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<Me;const i=this.animation.advance(e);return this.animation.enabled&&i}intersect(e,t,i,r,n,a,s){Object(Ee.f)(e,t,r,n,a,void 0,s)}requiresSlot(e,t){switch(Object(o.b)(t)){case r.a.Normal:return e===u.a.DRAPED_WATER;case r.a.Color:if(this.parameters.isDraped)return e===u.a.DRAPED_MATERIAL;break;case r.a.Highlight:return e===u.a.OPAQUE_MATERIAL||e===u.a.DRAPED_MATERIAL}let i=u.a.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?u.a.TRANSPARENT_MATERIAL:u.a.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){if(e.output===r.a.Color&&this.parameters.isDraped)return e.output=r.a.Draped,new Te(e);switch(e.output){case r.a.Color:case r.a.Normal:case r.a.Highlight:case r.a.Alpha:return new Te(e)}return null}createBufferWriter(){return new Se.a(Se.d)}}const Me=35e3},1104:function(e,t,i){"use strict";i.d(t,"a",(function(){return K}));var r=i(116),n=i(85),a=i(102),s=i(233),o=i(367),c=i(147),l=i(200),u=i(151),h=i(219),d=i(117),p=i(109);function f(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}var b=i(118),g=i(495),m=i(210),O=i(753),_=i(562),v=i(856),y=i(335),j=i(411),x=i(768),T=i(278),S=i(139),E=i(604),A=i(434),w=i(513),M=i(827),R=i(79),C=i(301),P=i(731),I=i(420),D=i(857),L=i(356),N=i(623),F=i(747),z=i(501),U=i(388),G=i(404),V=i(419),k=i(163),H=i(382),B=i(445),W=i(389),q=i(94),Z=i(355);class X extends G.a{initializeProgram(e){const t=X.shader.get(),i=this.configuration,r=t.build({output:i.output,frontFacePass:i.transparencyPassType===k.i.FrontFace,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawLabelBorder:i.debugDrawLabelBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new W.a(e.rctx,r,H.a)}bindPass(e,t){Object(z.b)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(P.b)(this.program,e,t),Object(F.b)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(z.e)(this.program,t),this.configuration.output===m.a.Occlusion?(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(D.a)(this.program,t),Object(L.a)(this.program,t)):(Object(O.c)(this.program,t),Object(M.c)(this.program,e,t.camera.pixelRatio||1),Object(N.b)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),this.configuration.output===m.a.Highlight&&Object(I.b)(this.program,t)}bindDraw(e){Object(z.c)(this.program,e),Object(z.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(C.c)(this.program,this.configuration,e),this.program.rebindTextures()}_setPipelineState(e){const t=this.configuration,i=e===k.i.NONE,r=e===k.i.FrontFace,n=q.h.LEQUAL,a=this.configuration.polygonOffsetEnabled&&Y,s=(i||r)&&t.output!==m.a.Highlight?(t.depthEnabled||t.output===m.a.Occlusion)&&Z.d:null;return Object(Z.f)({blending:t.output===m.a.Color||t.output===m.a.Alpha||t.output===m.a.Highlight?i?$:Object(B.f)(e):null,depthTest:{func:n},depthWrite:s,colorWrite:Z.c,polygonOffset:a})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===m.a.Occlusion?q.r.POINTS:q.r.TRIANGLES}}X.shader=new U.a(M.a,(()=>i.e(324).then(i.bind(null,1345))));const Y={factor:0,units:-4},$=Object(Z.h)(q.b.ONE,q.b.ONE_MINUS_SRC_ALPHA);class Q extends V.a{constructor(){super(...arguments),this.output=m.a.Color,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=O.b.World,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=k.i.NONE,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(R.a)([Object(V.b)({count:m.a.COUNT})],Q.prototype,"output",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"occlusionTestEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"sdf",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"vvSize",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"vvColor",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"verticalOffset",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"screenSizePerspective",void 0),Object(R.a)([Object(V.b)({count:O.b.COUNT})],Q.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"debugDrawLabelBorder",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"binaryHighlightOcclusion",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"slicePlaneEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"polygonOffsetEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"depthEnabled",void 0),Object(R.a)([Object(V.b)({count:k.i.COUNT})],Q.prototype,"transparencyPassType",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"pixelSnappingEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"isDraped",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"multipassGeometryEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"multipassTerrainEnabled",void 0),Object(R.a)([Object(V.b)()],Q.prototype,"cullAboveGround",void 0);class K extends y.b{constructor(e){super(e,_e),this.techniqueConfig=new Q}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?O.b.Screen:O.b.World,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,e===m.a.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===m.a.Highlight&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,a,s,o,c,l){Object(n.k)(l)?this._intersectDrapedHudGeometry(e,s,o,c,l):this._intersectHudGeometry(e,t,i,r,o,c)}_intersectDrapedHudGeometry(e,t,i,r,a){const s=e.vertexAttributes.get(S.a.POSITION),o=e.vertexAttributes.get(S.a.SIZE),c=this.parameters,l=Object(M.d)(c);let u=1,h=1;if(Object(n.k)(r)){const e=r(fe);u=e[0],h=e[5]}u*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const d=ge*e.screenToWorldRatio;for(let n=0;n<s.data.length/s.size;n++){const r=n*s.size,p=s.data[r],f=s.data[r+1],b=n*o.size;let g;me[0]=o.data[b]*u,me[1]=o.data[b+1]*h,c.textureIsSignedDistanceField&&(g=c.outlineSize*e.screenToWorldRatio/2),te(t,p,f,me,d,g,c,l)&&i(a.dist,a.normal,-1,!0)}}_intersectHudGeometry(e,t,i,r,a,o){if(!r.options.selectionMode||!r.options.hud||Object(w.d)(t))return;const l=this.parameters;let u=1,h=1;if(Object(s.f)(le,i),Object(n.k)(o)){const e=o(fe);u=e[0],h=e[5],function(e){const t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8],u=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(n*n+a*a+s*s),d=1/Math.sqrt(o*o+c*c+l*l);e[0]=t*u,e[1]=i*u,e[2]=r*u,e[3]=n*h,e[4]=a*h,e[5]=s*h,e[6]=o*d,e[7]=c*d,e[8]=l*d}(le)}const f=e.vertexAttributes.get(S.a.POSITION),b=e.vertexAttributes.get(S.a.SIZE),g=e.vertexAttributes.get(S.a.NORMAL),m=e.vertexAttributes.get(S.a.AUXPOS1);Object(T.a)(f.size>=3);const O=r.point,_=r.camera,v=Object(M.d)(l);u*=_.pixelRatio,h*=_.pixelRatio;const y="screen"===this.parameters.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(d.w)(ne,f.data[e],f.data[e+1],f.data[e+2]),Object(d.q)(ne,ne,i);const t=n*b.size;me[0]=b.data[t]*u,me[1]=b.data[t+1]*h,Object(d.q)(ne,ne,_.viewMatrix);const s=n*m.size;if(Object(d.w)(de,m.data[s+0],m.data[s+1],m.data[s+2]),!y&&(ne[0]+=de[0],ne[1]+=de[1],0!==de[2])){const e=de[2];Object(d.r)(de,ne),Object(d.j)(ne,ne,Object(d.e)(de,de,e))}const o=n*g.size;if(Object(d.w)(ae,g.data[o],g.data[o+1],g.data[o+2]),this._normalAndViewAngle(ae,le,_,pe),this._applyVerticalOffsetTransformationView(ne,pe,_,ie),_.applyProjection(ne,se),se[0]>-1){let e=Math.floor(se[0])+this.parameters.screenOffset[0],t=Math.floor(se[1])+this.parameters.screenOffset[1];y&&(e+=de[0],0!==de[1]&&(t+=Object(x.b)(de[1],ie.factorAlignment))),Object(x.a)(me,ie.factor,me);const i=be*_.pixelRatio;let n;if(l.textureIsSignedDistanceField&&(n=l.outlineSize*_.pixelRatio/2),te(O,e,t,me,i,n,l,v)){const e=r.ray;if(Object(d.q)(ce,ne,Object(c.a)(he,_.viewMatrix)),se[0]=O[0],se[1]=O[1],_.unprojectFromRenderScreen(se,ne)){const t=Object(p.f)();Object(d.k)(t,e.direction);const i=1/Object(d.p)(t);Object(d.e)(t,t,i),a(Object(d.m)(e.origin,ne)*i,t,-1,!0,1,ce)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(S.a.POSITION),n=e.indices.get(S.a.POSITION);return Object(_.b)(r,n,t)}createBufferWriter(){return new ye(this)}_normalAndViewAngle(e,t,i,r){return f(t)&&(t=Object(s.f)(ue,t)),Object(d.x)(r.normal,e,t),Object(d.q)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Object(d.h)(oe,Oe),r}_updateScaleInfo(e,t,i){const r=this.parameters;r.screenSizePerspective?Object(x.c)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?Object(x.c)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,n,a,s){const o=this._normalAndViewAngle(t,i,n,pe);return this._applyVerticalGroundOffsetView(e,o,n,s),this._applyVerticalOffsetTransformationView(s,o,n,a),this._applyPolygonOffsetView(s,o,r[3],n,s),this._applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,i,r,a){return this._applyCenterOffsetNDC(e,t,i,r),Object(n.k)(a)&&Object(d.k)(a,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,n,a){const s=n.aboveGround?1:-1;let o=Math.sign(i);0===o&&(o=s);const c=s*o;if(this.parameters.shaderPolygonOffset<=0)return Object(d.k)(a,e);const l=Object(r.e)(Math.abs(t.cosAngle),.01,1),u=1-Math.sqrt(1-l*l)/l/n.viewport[2];return Object(d.e)(a,e,c>0?u:1/u),a}_applyVerticalGroundOffsetView(e,t,i,r){const n=Object(d.p)(e),a=i.aboveGround?1:-1,s=.5*i.computeRenderPixelSizeAtDist(n),o=Object(d.e)(ne,t.normal,a*s);return Object(d.f)(r,e,o),r}_applyVerticalOffsetTransformationView(e,t,i,r){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const i=Object(d.p)(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=Object(d.p)(e),s=n.screenSizePerspectiveAlignment||n.screenSizePerspective,o=Object(A.i)(i,a,n.verticalOffset,t.cosAngle,s);return this._updateScaleInfo(r,a,t.cosAngle),Object(d.e)(t.normal,t.normal,o),Object(d.f)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&Object(d.k)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(d.r)(ae,i),Object(d.f)(i,i,Object(d.e)(ae,ae,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&Object(d.k)(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const n=this.parameters.shaderPolygonOffset;if(e!==r&&Object(d.k)(r,e),n){const e=i.aboveGround?1:-1,a=e*Math.sign(t[3]);r[2]-=(a||e)*n}return r}requiresSlot(e){if(e===j.a.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:i}=this.parameters;return e===(t?j.a.LABEL_MATERIAL:j.a.HUD_MATERIAL)||i&&e===j.a.OCCLUSION_PIXELS}createGLMaterial(e){return e.output===m.a.Color||e.output===m.a.Alpha?new ee(e):e.output===m.a.Highlight?new J(e):null}calculateRelativeScreenBounds(e,t,i=Object(b.l)()){return function(e,t,i,r=re){Object(u.c)(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class J extends v.a{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(e)}selectProgram(e){return this.ensureTechnique(X,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}class ee extends J{_isOcclusionSlot(e){return e.slot===j.a.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===m.a.Color||this._output===m.a.Alpha)}selectProgram(e){return this.ensureTechnique(X,e,this._isOcclusionSlot(e)?m.a.Occlusion:this._output)}bind(e,t){this._isOcclusionSlot(e)||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.parameters,e)}}function te(e,t,i,r,n,a,s,o){let c=t-n-(o[0]>0?r[0]*o[0]:0),l=c+r[0]+2*n,u=i-n-(o[1]>0?r[1]*o[1]:0),h=u+r[1]+2*n;if(s.textureIsSignedDistanceField){const e=s.distanceFieldBoundingBox;c+=r[0]*e[0],u+=r[1]*e[1],l-=r[0]*(1-e[2]),h-=r[1]*(1-e[3]),c-=a,l+=a,u-=a,h+=a}return e[0]>c&&e[0]<l&&e[1]>u&&e[1]<h}const ie={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},re=Object(h.a)(),ne=Object(p.f)(),ae=Object(p.f)(),se=Object(a.d)(),oe=Object(p.f)(),ce=Object(p.f)(),le=Object(o.b)(),ue=Object(o.b)(),he=Object(l.d)(),de=Object(p.f)(),pe={normal:oe,cosAngle:0},fe=Object(l.d)(),be=1,ge=2,me=[0,0],Oe=Object(p.h)(0,0,1),_e={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(h.e)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawLabelBorder:!1,isDraped:!1,...y.a},ve=Object(g.a)().vec3f(S.a.POSITION).vec3f(S.a.NORMAL).vec2f(S.a.UV0).vec4u8(S.a.COLOR).vec2f(S.a.SIZE).vec4f(S.a.AUXPOS1).vec4f(S.a.AUXPOS2);class ye{constructor(e){this.material=e,this.vertexBufferLayout=ve}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get(S.a.POSITION).length}write(e,t,i,r){Object(E.f)(t.indices.get(S.a.POSITION),t.vertexAttributes.get(S.a.POSITION).data,e.transformation,i.position,r,6),Object(E.e)(t.indices.get(S.a.NORMAL),t.vertexAttributes.get(S.a.NORMAL).data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get(S.a.UV0).data;let n,a,s,o;if(null==e||e.length<4){const e=this.material.parameters;n=0,a=0,s=e.texCoordScale[0],o=e.texCoordScale[1]}else n=e[0],a=e[1],s=e[2],o=e[3];s=Math.min(1.99999,s+1),o=Math.min(1.99999,o+1);const c=t.indices.get(S.a.POSITION).length,l=i.uv0;let u=r;for(let t=0;t<c;++t)l.set(u,0,n),l.set(u,1,a),u+=1,l.set(u,0,s),l.set(u,1,a),u+=1,l.set(u,0,s),l.set(u,1,o),u+=1,l.set(u,0,s),l.set(u,1,o),u+=1,l.set(u,0,n),l.set(u,1,o),u+=1,l.set(u,0,n),l.set(u,1,a),u+=1}Object(E.c)(t.indices.get(S.a.COLOR),t.vertexAttributes.get(S.a.COLOR).data,4,i.color,r,6);{const e=t.indices.get(S.a.SIZE),n=t.vertexAttributes.get(S.a.SIZE).data,a=e.length,s=i.size;let o=r;for(let t=0;t<a;++t){const i=n[2*e[t]],r=n[2*e[t]+1];for(let e=0;e<6;++e)s.set(o,0,i),s.set(o,1,r),o+=1}}t.indices.get(S.a.AUXPOS1)&&t.vertexAttributes.get(S.a.AUXPOS1)&&Object(E.b)(t.indices.get(S.a.AUXPOS1),t.vertexAttributes.get(S.a.AUXPOS1).data,i.auxpos1,r,6),t.indices.get(S.a.AUXPOS2)&&t.vertexAttributes.get(S.a.AUXPOS2)&&Object(E.b)(t.indices.get(S.a.AUXPOS2),t.vertexAttributes.get(S.a.AUXPOS2).data,i.auxpos2,r,6)}}},1108:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i(85),n=i(737),a=i(98),s=i(610),o=i(273),c=i(197),l=i(81);function u(e){return h[function(e){return e instanceof Blob?e.type:function(e){const t=Object(a.p)(e);return f[t]||d}(e.url)}(e)]||p}const h={},d="text/plain",p=h[d],f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const v in f)h[f[v]]=v;var b=i(150);function g(e){const t=Object(r.k)(e)&&e.origins?e.origins:[void 0];return(i,s)=>{const h=function(e,t,i){if(Object(r.k)(e)&&"resource"===e.type)return function(e,t,i){const s=Object(o.b)(t,i);return{type:String,read:(e,t,i)=>{const r=Object(b.e)(e,t,i);return s.type===String?r:"function"==typeof s.type?new s.type({url:r}):void 0},write:{writer(t,o,l,h){if(!h||!h.resources)return"string"==typeof t?void(o[l]=Object(b.f)(t,h)):void(o[l]=t.write({},h));const d=function(e){return Object(r.j)(e)?null:"string"==typeof e?e:e.url}(t),p=d?Object(b.f)(d,{...h,verifyItemRelativeUrls:h&&h.verifyItemRelativeUrls?{writtenUrls:h.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},b.a.NO):null,f=s.type!==String&&(!Object(n.a)(this)||h&&h.origin&&this.originIdOf(i)>Object(c.e)(h.origin));h&&h.portalItem&&Object(r.k)(p)&&!Object(a.u)(p)?f?function(e,t,i,r,n,s,o,c){const l=o.portalItem.resourceFromPath(r),h=_(i,r,o);u(h)===Object(a.p)(l.path)?(O(e,t,l,h,o.resources.toUpdate),n[s]=r):m(e,t,i,r,n,s,o,c)}(this,i,t,p,o,l,h,e):function(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}(p,o,l,h):h&&h.portalItem&&(Object(r.j)(p)||Object(r.k)(Object(b.c)(p))||Object(a.v)(p)||f)?m(this,i,t,p,o,l,h,e):o[l]=p}}}}(e,t,i);switch(Object(r.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=b.d;return{read:e,write:t}}}}(e,i,s);for(const e of t){const t=Object(l.c)(i,e,s);for(const e in h)t[e]=h[e]}}}function m(e,t,n,o,c,l,h,d){const p=Object(s.a)(),f=_(n,o,h),b=Object(a.B)(Object(r.i)(d,"prefix"),p),g=`${b}.${u(f)}`,m=h.portalItem.resourceFromPath(g);Object(a.v)(o)&&h.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(null,103))).default,{data:r}=await t(e,{responseType:"blob"});return r}(o).then((e=>{m.path=`${b}.${u(e)}`,c[l]=m.itemRelativeUrl})).catch((()=>{}))),O(e,t,m,f,h.resources.toAdd),c[l]=m.itemRelativeUrl}function O(e,t,i,r,n){n.push({resource:i,content:r,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function _(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},1127:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(515),n=i(272);function a(e,t){return null!=e&&(null==t||(t===n.a.Local?!e.isGeographic||e.isWGS84||e.wkid===r.a.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===r.a.CGCS2000||e.wkid===r.a.GCSMARS2000||e.wkid===r.a.GCSMARS2000_SPHERE||e.wkid===r.a.GCSMOON2000))}},1146:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i(126),n=i(297),a=i(139);function s(){const e=new n.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add(a.a.POSITION,"vec3"),e.attributes.add(a.a.UV0,"vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(r.a`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(r.a`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const o=Object.freeze({__proto__:null,build:s})},1147:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return p}));var r=i(210),n=i(301),a=i(478),s=i(410),o=i(356),c=i(397),l=i(464),u=i(126),h=i(297),d=i(139);function p(e){const t=new h.a;return t.include(a.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add(d.a.POSITION,"vec3"),t.attributes.add(d.a.UV0,"vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(u.a`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(n.a,e),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(o.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),e.output===r.a.Alpha?t.fragment.code.add(u.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${u.a.float(c.b)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(l.a),t.fragment.code.add(u.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${u.a.float(c.b)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}const f=Object.freeze({__proto__:null,build:p})},1186:function(e,t,i){"use strict";i.d(t,"a",(function(){return R})),i.d(t,"b",(function(){return I}));var r=i(79),n=i(125),a=(i(82),i(138)),s=i(134),o=i(183),c=i(85),l=i(81),u=i(84),h=(i(83),i(80)),d=i(536),p=(i(99),i(89)),f=i(114),b=i(985),g=i(615),m=i(294),O=i(110),_=i(825),v=i(216),y=i(113),j=i(140),x=i(135);function T(e,t){const i=new y.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function S(e,t,i){const r=new j.a({paths:e,spatialReference:t});return i&&Object(m.i)(r),r}function E(e,t,i,r=!0){const n=Object(p.a)(e);n.forEach((e=>{const t=e[0],i=e[e.length-1];Object(u.c)(t,i)&&1!==e.length||e.push(e[0])}));let a=new x.a({rings:n,spatialReference:t});return a.rings.forEach((e=>{Object(m.g)(e,!1,!1)||e.reverse()})),i&&Object(m.i)(a),r&&a.isSelfIntersecting&&Object(O.l)(t)&&(a=Object(g.simplify)(a)),a}function A(e,t,i){const r=t.mapToLocalMultiple(e),n=[],a={x:r[0].x,y:r[0].y},s=r[1].x,o=r[1].y,l=Math.round(s-a.x),u=Math.round(o-a.y),h=Math.max(Math.abs(l),Math.abs(u));if(i){const e={x:a.x+h,y:a.y+h},t={x:a.x-h,y:a.y-h};n.push(Object(_.b)(e.x,t.y),Object(_.b)(t.x,t.y),Object(_.b)(t.x,e.y),Object(_.b)(e.x,e.y))}else{const e={x:l>0?a.x+h:a.x-h,y:u>0?a.y+h:a.y-h};n.push(Object(_.b)(a.x,a.y),Object(_.b)(e.x,a.y),Object(_.b)(e.x,e.y),Object(_.b)(a.x,e.y))}return E([Object(c.g)(n.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function w(e,t,i,r){const n=t.mapToLocalMultiple(e);let a=null,s=null;if(i)a=n[0],s=n[1];else{const e=n[0],t=n[1],i=Math.round(t.x-e.x),r=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(r));a=Object(_.b)(i>0?e.x+o/2:e.x-o/2,r>0?e.y+o/2:e.y-o/2),s=Object(_.b)(Math.abs(i)>Math.abs(r)?a.x-o/2:a.x,Math.abs(i)>Math.abs(r)?a.y:a.y-o/2)}const o=t.localToMap(a),l=t.localToMap(s);if(Object(c.j)(o)||Object(c.j)(l))return null;t.doUnnormalization&&Object(m.j)([[o,l]],t.spatialReference);const u=T(o,t.spatialReference),h=T(l,t.spatialReference),d=Object(f.e)(t.spatialReference);let p=0;if(Object(O.l)(t.spatialReference))p=d*Object(g.distance)(u,h,null);else{const e=a.x-s.x,t=a.y-s.y;p=d*Math.sqrt(e*e+t*t)*(r||1)}const v=new b.a({center:u,radius:p,radiusUnit:"meters",spatialReference:t.spatialReference});return E(v.rings,v.spatialReference,!1)}var M=i(675);let R=class extends(Object(s.b)(a.a.EventedMixin(M.a))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new d.a({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=Object(c.d)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Object(c.d)(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),Object(c.k)(this._graphic)&&(this._graphic.symbol=e)}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new n.a({...this.graphicProperties,geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(Object(o.c)((()=>{Object(c.k)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=Object(c.d)(this._graphic))})),C)}_destroyAllVisualisations(){this.handles.remove(P.outline),this.handles.remove(P.regularVertices),this.handles.remove(P.activeVertex),this.handles.remove(C)}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,r=i.slice();Object(c.k)(t)&&r.push(this.drawOperation.coordinateHelper.pointToArray(t));const n=Object(c.k)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null},s=r.length,o=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=i,a.activeVertex=n,a.full=this.drawOperation.coordinateHelper.arrayToPoint(r[0]);break;case"multipoint":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=function(e,t){return new v.a({points:e,spatialReference:t})}(r,o));break;case"polyline":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=S([r],o,l));break;case"polygon":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=E([r],o,l,!0));break;case"circle":if(s>0){const t=Object(_.a)(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+D*this.view.resolution,e[1]);a.full=w([e,i],t,!0)}else 2===s&&(a.full=this.forceUniformSize?w(r,t,this.centered):function(e,t,i){const r=t.mapToLocalMultiple(e),n=r[0],a=r[1],s=Math.round(a.x-n.x),o=Math.round(a.y-n.y),l=Object(_.b)(i?n.x:n.x+s/2,i?n.y:n.y+o/2),u=i?s:s/2,h=i?o:o/2,d=[],p=2*Math.PI/60;for(let c=0;c<60;c++){const e=Math.cos(c*p),t=Math.sin(c*p),i=Object(_.b)(u*e+l.x,h*t+l.y);d.push(i)}return d.push(d[0]),E([Object(c.g)(d.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}(r,t,this.centered))}break;case"rectangle":if(s>0){const t=Object(_.a)(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+D*this.view.resolution,e[1]);a.full=A([e,i],t,!0)}else 2===s&&(a.full=this.forceUniformSize?A(r,t,this.centered):function(e,t,i){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[Object(_.b)(t.x-e,t.y+e),Object(_.b)(t.x+e,t.y-e),Object(_.b)(t.x+e,t.y-e),Object(_.b)(t.x-e,t.y+e)]}const n=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y};if(i){const e=Math.round(s.x-a.x),t=Math.round(s.y-a.y);n.push(Object(_.b)(a.x-e,a.y-t),Object(_.b)(s.x,a.y-t),Object(_.b)(s.x,s.y),Object(_.b)(a.x-e,s.y))}else n.push(Object(_.b)(a.x,a.y),Object(_.b)(s.x,a.y),Object(_.b)(s.x,s.y),Object(_.b)(a.x,s.y));return E([Object(c.g)(n.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}(r,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":s>1&&(a.outline=S([r],o,l));break;case"circle":case"rectangle":Object(c.k)(a.full)&&"polygon"===a.full.type&&(a.outline=E(a.full.rings,o,l))}return a}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});Object(c.k)(e)&&(Object(c.j)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full,t=Object(c.s)(this._graphic).clone())}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();Object(c.j)(e)?this._destroyAllVisualisations():(Object(c.k)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),P.outline):this.handles.remove(P.outline),Object(c.k)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),P.regularVertices):this.handles.remove(P.regularVertices),Object(c.k)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),P.activeVertex):this.handles.remove(P.activeVertex),Object(c.k)(e.full)?Object(c.j)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(C))}};Object(r.a)([Object(l.b)({value:!0})],R.prototype,"centered",null),Object(r.a)([Object(l.b)({nonNullable:!0})],R.prototype,"defaultZ",void 0),Object(r.a)([Object(l.b)()],R.prototype,"drawOperation",void 0),Object(r.a)([Object(l.b)({value:!0})],R.prototype,"enabled",null),Object(r.a)([Object(l.b)({value:!0})],R.prototype,"forceUniformSize",null),Object(r.a)([Object(l.b)({constructOnly:!0})],R.prototype,"geometryType",void 0),Object(r.a)([Object(l.b)()],R.prototype,"graphic",null),Object(r.a)([Object(l.b)({constructOnly:!0})],R.prototype,"graphicProperties",void 0),Object(r.a)([Object(l.b)()],R.prototype,"graphicSymbol",null),Object(r.a)([Object(l.b)({constructOnly:!0})],R.prototype,"hasZ",void 0),Object(r.a)([Object(l.b)({constructOnly:!0})],R.prototype,"mode",void 0),Object(r.a)([Object(l.b)()],R.prototype,"snappingManager",void 0),Object(r.a)([Object(l.b)()],R.prototype,"snapToScene",void 0),Object(r.a)([Object(l.b)({readOnly:!0})],R.prototype,"type",void 0),Object(r.a)([Object(l.b)({readOnly:!0})],R.prototype,"updating",null),Object(r.a)([Object(l.b)({constructOnly:!0,nonNullable:!0})],R.prototype,"view",void 0),R=Object(r.a)([Object(h.a)("esri.views.draw.DrawGraphicTool")],R);const C="create-operation-graphic",P={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function I(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const D=48},1187:function(e,t,i){"use strict";i.d(t,"a",(function(){return k}));var r=i(87),n=i(85),a=i(102),s=i(151),o=i(117),c=i(109),l=i(620),u=i(499),h=i(423),d=i(421),p=i(210),f=i(562),b=i(545),g=i(335),m=i(411),O=i(278),_=i(139),v=i(604),y=i(713),j=i(434),x=i(513),T=i(79),S=i(301),E=i(420),A=i(501),w=i(388),M=i(404),R=i(419),C=i(382),P=i(389),I=i(654),D=i(1011),L=i(94),N=i(355);class F extends M.a{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==p.a.Highlight}initializeProgram(e){const t=F.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:i.stipplePreferContinuous});return new P.a(e.rctx,r,C.a)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(A.b)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:e,sdfNormalizer:i,pixels:r}=Object(n.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1f("stipplePatternTextureSize",r),this.program.setUniform1f("stipplePatternPixelSize",e),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(n.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}this.configuration.output===p.a.Highlight&&Object(E.b)(this.program,t)}bindDraw(e){Object(A.c)(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(A.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(S.c)(this.program,this.configuration,e),this.program.rebindTextures()}initializePipeline(){const e=this.configuration,t=Object(N.g)(L.b.SRC_ALPHA,L.b.ONE,L.b.ONE_MINUS_SRC_ALPHA,L.b.ONE_MINUS_SRC_ALPHA),i=(t,i=null,r=null)=>Object(N.f)({blending:i,depthTest:I.b,depthWrite:r,colorWrite:N.c,stencilWrite:e.sceneHasOcludees?I.h:null,stencilTest:e.sceneHasOcludees?t?I.d:I.c:null});return e.output===p.a.Color?(this._occludeePipelineState=i(!0,e.transparent||this.stippleEnabled?t:null,N.d),i(!1,e.transparent||this.stippleEnabled?t:null,N.d)):i(!1)}get primitiveType(){return L.r.LINES}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}F.shader=new w.a(D.a,(()=>i.e(332).then(i.bind(null,1356))));class z extends R.a{constructor(){super(...arguments),this.output=p.a.Color,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.sceneHasOcludees=!1}}Object(T.a)([Object(R.b)({count:p.a.COUNT})],z.prototype,"output",void 0),Object(T.a)([Object(R.b)()],z.prototype,"slicePlaneEnabled",void 0),Object(T.a)([Object(R.b)()],z.prototype,"vertexColors",void 0),Object(T.a)([Object(R.b)()],z.prototype,"transparent",void 0),Object(T.a)([Object(R.b)()],z.prototype,"draped",void 0),Object(T.a)([Object(R.b)()],z.prototype,"stippleEnabled",void 0),Object(T.a)([Object(R.b)()],z.prototype,"stippleOffColorEnabled",void 0),Object(T.a)([Object(R.b)()],z.prototype,"stipplePreferContinuous",void 0),Object(T.a)([Object(R.b)()],z.prototype,"sceneHasOcludees",void 0);const U=r.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var G,V;(V=G||(G={}))[V.START=0]="START",V[V.END=1]="END";class k extends g.b{constructor(e){super(e,W),this._techniqueConfig=new z}getTechniqueConfig(e,t){this._techniqueConfig.output=e,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=t.slot===m.a.DRAPED_MATERIAL;const i=Object(n.k)(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=i,this._techniqueConfig.stippleOffColorEnabled=i&&Object(n.k)(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,r,a,s,o,c,l){Object(n.k)(l)?Object(j.e)(e,r,l,s,1,o):this._intersectLineGeometry(e,t,i,r,o)}_intersectLineGeometry(e,t,i,r,n){if(!r.options.selectionMode||Object(x.d)(t))return;if(!Object(O.g)(i))return void U.error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(_.a.POSITION).data,c=r.camera,d=ie;Object(s.c)(d,r.point);Object(o.w)(re[0],d[0]-2,d[1]+2,0),Object(o.w)(re[1],d[0]+2,d[1]+2,0),Object(o.w)(re[2],d[0]+2,d[1]-2,0),Object(o.w)(re[3],d[0]-2,d[1]-2,0);for(let s=0;s<4;s++)if(!c.unprojectFromRenderScreen(re[s],ne[s]))return;Object(h.f)(c.eye,ne[0],ne[1],ae),Object(h.f)(c.eye,ne[1],ne[2],se),Object(h.f)(c.eye,ne[2],ne[3],oe),Object(h.f)(c.eye,ne[3],ne[0],ce);let p=Number.MAX_VALUE,f=0;for(let s=0;s<a.length-5;s+=3){if(q[0]=a[s]+i[12],q[1]=a[s+1]+i[13],q[2]=a[s+2]+i[14],Z[0]=a[s+3]+i[12],Z[1]=a[s+4]+i[13],Z[2]=a[s+5]+i[14],Object(h.t)(ae,q)<0&&Object(h.t)(ae,Z)<0||Object(h.t)(se,q)<0&&Object(h.t)(se,Z)<0||Object(h.t)(oe,q)<0&&Object(h.t)(oe,Z)<0||Object(h.t)(ce,q)<0&&Object(h.t)(ce,Z)<0)continue;if(c.projectToRenderScreen(q,$),c.projectToRenderScreen(Z,Q),$[2]<0&&Q[2]>0){Object(o.j)(X,q,Z);const e=c.frustum,t=-Object(h.t)(e[l.a.NEAR],q)/Object(o.h)(X,Object(h.q)(e[l.a.NEAR]));Object(o.e)(X,X,t),Object(o.f)(q,q,X),c.projectToRenderScreen(q,$)}else if($[2]>0&&Q[2]<0){Object(o.j)(X,Z,q);const e=c.frustum,t=-Object(h.t)(e[l.a.NEAR],Z)/Object(o.h)(X,Object(h.q)(e[l.a.NEAR]));Object(o.e)(X,X,t),Object(o.f)(Z,Z,X),c.projectToRenderScreen(Z,Q)}else if($[2]<0&&Q[2]<0)continue;$[2]=0,Q[2]=0;const e=Object(u.e)(Object(u.f)($,Q,ee),d);e<p&&(p=e,Object(o.k)(K,q),Object(o.k)(J,Z),f=s/3)}const b=r.rayBegin,g=r.rayEnd;if(p<4){let e=Number.MAX_VALUE;if(Object(u.a)(Object(u.f)(K,J,ee),Object(u.f)(b,g,te),Y)){Object(o.j)(Y,Y,b);const t=Object(o.p)(Y);Object(o.e)(Y,Y,1/t),e=t/Object(o.m)(b,g)}n(e,Y,f,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get(_.a.POSITION);return Object(f.a)(r,null,!1,t)}requiresSlot(e){return e===m.a.OPAQUE_MATERIAL||e===m.a.DRAPED_MATERIAL}createGLMaterial(e){return e.output===p.a.Color||e.output===p.a.Highlight?new H(e):null}createBufferWriter(){const e=this.parameters.vertexColors?y.b:y.c;return Object(n.j)(this.parameters.stipplePattern)?new y.a(e):new B(e.clone().vec3f(_.a.AUXPOS1).vec2f(_.a.UV0))}}class H extends b.a{updateParameters(e){return this.ensureTechnique(F,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return this._output===p.a.Color&&this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}class B{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(_.a.POSITION).length}write(e,t,i,r){Object(v.d)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this._writeAuxpos1(e,t,i,r),this._writeUV0(e,t,i,r)}_writeAuxpos1(e,t,i,r){const n=i.getField(_.a.AUXPOS1,d.u),a=t.indices.get(_.a.POSITION),s=t.vertexAttributes.get(_.a.POSITION).data,o=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;r*=c;for(let u=0;u<a.length-1;u+=2)for(const e of[1,0]){const t=3*a[u+e],i=s[t],n=s[t+1],h=s[t+2],d=o[0]*i+o[4]*n+o[8]*h+o[12],p=o[1]*i+o[5]*n+o[9]*h+o[13],f=o[2]*i+o[6]*n+o[10]*h+o[14];l[r]=d,l[r+1]=p,l[r+2]=f,r+=c}}_writeUV0(e,t,i,r){var n;const a=i.getField(_.a.UV0,d.m),s=t.indices.get(_.a.POSITION),c=t.vertexAttributes.get(_.a.POSITION).data,l=null==(n=t.vertexAttributes.get(_.a.DISTANCETOSTART))?void 0:n.data,u=e.transformation,h=a.typedBufferStride,p=a.typedBuffer;let f=0;p[r*=h]=G.START,p[r+1]=f,r+=h;const b=3*s[0],g=Object(o.w)(q,c[b],c[b+1],c[b+2]);u&&Object(o.q)(g,g,u);const m=Z,O=s.length-1;let v=1;const y=l?(e,t,i)=>f=l[i]:(e,t,i)=>f+=Object(o.m)(e,t);for(let d=1;d<O;d+=2){const e=3*s[d];Object(o.w)(m,c[e],c[e+1],c[e+2]),u&&Object(o.q)(m,m,u),y(g,m,v++);for(let t=0;t<2;++t)p[r]=1-t,p[r+1]=f,r+=h;Object(o.k)(g,m)}const j=3*s[O];Object(o.w)(m,c[j],c[j+1],c[j+2]),u&&Object(o.q)(m,m,u),y(g,m,v),p[r]=G.END,p[r+1]=f}}const W={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1,...g.a},q=Object(c.f)(),Z=Object(c.f)(),X=Object(c.f)(),Y=Object(c.f)(),$=Object(a.d)(),Q=Object(a.d)(),K=Object(c.f)(),J=Object(c.f)(),ee=Object(u.d)(),te=Object(u.d)(),ie=Object(c.f)(),re=[Object(a.d)(),Object(a.d)(),Object(a.d)(),Object(a.d)()],ne=[Object(c.f)(),Object(c.f)(),Object(c.f)(),Object(c.f)()],ae=Object(h.d)(),se=Object(h.d)(),oe=Object(h.d)(),ce=Object(h.d)()},126:function(e,t,i){"use strict";function r(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}i.d(t,"a",(function(){return r})),function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(r||(r={}))},1366:function(e,t,i){"use strict";i.r(t),i.d(t,"DrawGraphicTool3D",(function(){return dt})),i.d(t,"GraphicMoveTool",(function(){return pi})),i.d(t,"GraphicReshapeTool",(function(){return Di})),i.d(t,"GraphicTransformTool",(function(){return Ji})),i.d(t,"ExtentTransformTool",(function(){return Tn}));var r=i(79),n=i(183),a=i(85),s=i(136),o=i(81),c=(i(84),i(82)),l=i(83),u=i(80),h=i(416),d=i(336),p=i(105),f=i(117),b=i(109),g=i(124),m=i(271),O=i(240),_=i(767),v=i(620),y=i(499),j=i(360),x=i(861),T=i(147),S=i(200),E=i(944),A=i(163),w=i(659),M=i(776);class R extends E.a{constructor(e){super(e.view),this._resources=null,this._transform=Object(S.d)()}get object(){return Object(a.k)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(T.c)(this._transform,e),Object(a.k)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(a.j)(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new M.a({isPickable:!1,updatePolicy:A.j.SYNC});e.add(t);const i=new w.a({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(a.j)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(a.j)(this._resources)||this._resources.object.setVisible(e)}}var C=i(594),P=i(335),I=i(139),D=i(777);class L extends R{constructor(e){super(e),this._ray=Object(j.c)(),this._externalResources=null,this._handles=new g.a,this._isWorldDown=!1,this._start=Object(b.f)(),this._end=Object(b.h)(1,0,0),this._width=1,this._color=Object(O.c)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Object(O.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=G.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=P.c.OccludeAndTransparent,this._fadedExtensions=H,this.applyProps(e)}createExternalResources(){const e=new D.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this._updateGeometry()})));const t=new x.a({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){Object(a.k)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){Object(a.k)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[Object(b.f)(),Object(b.f)()],i=this.extensionType===G.FADED;i&&t.push(Object(b.f)(),Object(b.f)());const r=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=C.a.createPolylineGeometry(t,null,r);e.addGeometry(n,Object(a.s)(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),Object(a.k)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,Object(f.k)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(f.j)(this._end,e,this._end),Object(j.e)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,Object(f.o)(this._start,e)||(Object(f.k)(this._start,e),Object(j.e)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,Object(f.o)(this._end,e)||(Object(f.k)(this._end,e),Object(j.e)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(m.g)(e,this._color)||(Object(m.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(m.g)(e,this._innerColor)||(Object(m.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a.k)(e)!==Object(a.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(a.j)(e)||Object(a.j)(this._stippleOffColor)||!Object(m.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(a.k)(e)?Object(O.a)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&Object(a.k)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,Object(a.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(a.k)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(a.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Object(a.t)(e,H),this.recreateGeometry()}_updateMaterial(){Object(a.j)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){Object(a.k)(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===G.FADED?this._updateLineSegmentFinite(U):this._updateLineSegmentInfinite(this._extensionType,U);this._updateVertexAttributes(e,t),Object(a.k)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return Object(y.f)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Object(_.c)(this._ray,N),e){case G.LINE:N.c0=-Number.MAX_VALUE;break;case G.RAY:case G.GROUND_RAY:{const e=this._ray.origin,t=Object(a.t)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&Object(f.s)(N.ray.direction,N.ray.direction),this._extensionType===G.GROUND_RAY&&null!=t&&(N.c1=Math.abs(i-t));break}}if(!Object(v.e)(i.frustum,N))return Object(y.f)(this._start,this._end,t);const r=Object(_.e)(N,F),n=Object(_.d)(N,z);return Object(y.f)(r,n,t)}_updateVertexAttributes(e,t){const i=e.geometries[0].getMutableAttribute(I.a.POSITION).data;if(this.extensionType===G.FADED){const e=Object(y.h)(t,-this.fadedExtensions.start,F);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=Object(y.h)(t,0,F);i[3]=r[0],i[4]=r[1],i[5]=r[2];const n=Object(y.h)(t,1,F);i[6]=n[0],i[7]=n[1],i[8]=n[2];const a=Object(y.h)(t,1+this.fadedExtensions.end,F);i[9]=a[0],i[10]=a[1],i[11]=a[2]}else{const e=Object(y.h)(t,0,F);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=Object(y.h)(t,1,F);i[3]=r[0],i[4]=r[1],i[5]=r[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}const N=Object(_.a)(),F=Object(b.f)(),z=Object(b.f)(),U=Object(y.d)();var G,V;(V=G||(G={}))[V.LINE=0]="LINE",V[V.RAY=1]="RAY",V[V.GROUND_RAY=2]="GROUND_RAY",V[V.FADED=3]="FADED";const k=1/3,H={start:k,end:k};var B=i(102),W=i(151);class q extends R{constructor(e){super(e),this._handles=new g.a,this._location=Object(b.f)(),this._direction=Object(b.h)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Object(O.c)(1,0,1,1),this._renderOccluded=P.c.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){Object(f.o)(this._location,e)||(Object(f.k)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){Object(f.o)(this._direction,e)||(Object(f.k)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){Object(f.r)(this._direction,Object(f.j)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){Object(m.g)(e,this._color)||(Object(m.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new D.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this._updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=C.a.createPolylineGeometry([Object(b.f)(),Object(b.f)()]),i=C.a.createPolylineGeometry([Object(b.f)(),Object(b.f)()]),r=Object(a.s)(this._externalResources).material;e.addGeometry(t,r),e.addGeometry(i,r),this._updateVertices(e)}forEachExternalMaterial(e){Object(a.k)(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){Object(a.j)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;Object(a.j)(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,X),Object(f.f)(Z,this.location,this.direction),t.projectToScreen(Z,Y),Object(W.i)(Y,Object(W.f)(Y,Y,X)),this._updateVertexAttributes(t,e,0,X,Y,1),this._updateVertexAttributes(t,e,1,X,Y,-1)}_updateVertexAttributes(e,t,i,r,n,a){const s=t.geometryRecords[i],o=s.geometry.getMutableAttribute(I.a.POSITION).data,c=Object(W.g)($,Object(W.s)($,n[1]*a,n[0]*-a),this.offset+this.width/2),l=Object(W.m)(Q,Object(W.m)(Q,Object(W.m)(Q,r,Object(W.g)(Q,n,this.length/2)),c),c),u=Object(W.m)(K,l,Object(W.g)(K,n,-this.length));e.unprojectFromScreen(l,Z),o[0]=Z[0],o[1]=Z[1],o[2]=Z[2],e.unprojectFromScreen(u,Z),o[3]=Z[0],o[4]=Z[1],o[5]=Z[2],t.geometryVertexAttrsUpdated(s)}}const Z=Object(b.f)(),X=Object(B.f)(),Y=Object(B.f)(),$=Object(B.f)(),Q=Object(B.f)(),K=Object(B.f)();var J=i(116),ee=i(257),te=i(187),ie=i(223),re=i(288),ne=i(544);class ae{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return Object(a.k)(this._resources)?this._resources.object:null}get resources(){return Object(a.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(Object(a.j)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type===ne.a.Geometry&&e.remove(t)})),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new M.a({isPickable:!1,updatePolicy:A.j.SYNC});e.add(t);const i=new w.a({castShadow:!1}),r=this.resourceFactory.createResources(i,t);r.forEach((t=>e.add(t))),e.add(i),t.add(i);const n=this.resourceFactory.cameraChanged?Object(s.a)(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:t,object:i,external:r,cameraHandle:n},this._syncVisible()}_destroyResources(){if(Object(a.j)(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((t=>{null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){Object(a.j)(this._resources)||this._resources.object.setVisible(this._visible)}}var se=i(607),oe=i(676),ce=i(895),le=i(1104);class ue{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=Object(ee.g)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(ee.g)(1,1,1,1),this._elevationInfo=null,this.resources=new ae({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometry=this._recreateGeometry(t,e.material),Object(a.k)(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(a.k)(this.resources)&&this.resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){Object(m.g)(e,this._color)||(Object(m.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,Object(a.k)(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(m.g)(e,this._outlineColor)||(Object(m.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}_updateMaterial(){const e=this.resources.resources;Object(a.j)(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(Object(a.j)(e)||Object(a.j)(t))return;const i=e.geometry;if(Object(a.j)(i))return;const r=i.getMutableAttribute(I.a.SIZE).data,n=this.geometrySize;r[0]=n,r[1]=n,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:de,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/he}_recreateGeometry(e,t){const i=this._createRenderGeometry();return Object(a.k)(i)&&e.addGeometry(i,t),i}_createResources(e){const t=Object(ce.c)(this._primitive,this.preferredTextureSize),i=new le.a(this._materialParameters(t.id)),r=this._recreateGeometry(e,i);return{material:i,texture:t,geometry:r,forEach(e){e(t),e(i),Object(a.k)(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return Object(J.e)(Object(J.l)(2*this.geometrySize),16,128)}calculateMapBounds(e){if(Object(a.j)(this.resources.resources)||Object(a.j)(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get(I.a.POSITION);return Object(te.t)(t.data,this.view.renderCoordsHelper.spatialReference,pe,this.view.spatialReference),Object(ie.k)(e,pe),!0}_createRenderGeometry(){const e=this.geometry;if(Object(a.j)(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,r=Object(se.f)(e,i,oe.a.fromElevationInfo(this.elevationInfo),t),n=Object(f.w)(re.d.get(),e.x,e.y,r),s=re.d.get();Object(te.t)(n,e.spatialReference,s,t.spatialReference);const o=this.geometrySize;return C.a.createPointGeometry(null,s,null,[o,o],[0,0,0,1])}}const he=ce.a,de=[he/2,he/2,1-he/2,1-he/2],pe=Object(b.f)();var fe=i(595),be=i(751);class ge extends R{constructor(e){super(e),this._handles=new g.a,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=Object(b.f)(),this._up=Object(b.f)(),this._right=Object(b.f)(),this._renderOccluded=P.c.OccludeAndTransparent,this._color=Object(O.c)(1,0,0,1),this._outlineColor=Object(O.c)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=P.c.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Object(m.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(m.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Object(f.m)(t,e),Object(f.m)(t,i))/3,Object(f.r)(this._up,Object(f.j)(this._up,e,t)),Object(f.r)(this._right,Object(f.j)(this._right,i,t)),Object(f.k)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new be.a(this.quadMaterialParameters),this._outlineMaterial=new D.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=Object(f.f)(re.d.get(),this._up,this._right),i=C.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);Object(T.f)(me,this._position),Object(T.h)(me,me,[r,r,r]),Object(a.k)(e)&&(e.transformation=me)}_quadGeometryData(e,t){const i=Object(f.f)(re.d.get(),e,t);return new fe.a([[I.a.POSITION,{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[[I.a.POSITION,new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}const me=Object(S.d)();var Oe=i(684),_e=i(347),ve=i(999);class ye extends ve.a{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(new ue({view:a,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:p.a.toUnitRGBA(Oe.a.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(new ue({view:a,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:p.a.toUnitRGBA(Oe.a.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,r,a,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t,s=Object(_e.b)(e.lineStart,i,r,t.view),o=Object(_e.b)(e.lineEnd,i,r,t.view),c=Object(f.i)(o,s,o,.5),l=new q({view:a,attached:!1,offset:Oe.a.parallelLineHintOffset,length:Oe.a.parallelLineHintLength,width:Oe.a.parallelLineHintWidth,color:p.a.toUnitRGBA(Oe.a.orange),location:c,renderOccluded:P.c.Opaque});return l.setDirectionFromPoints(s,c),l.attached=!0,Object(n.a)(l)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(new ge({view:a,attached:!0,color:p.a.toUnitRGBA(Oe.a.orange),renderOccluded:P.c.Transparent,outlineRenderOccluded:P.c.Opaque,outlineColor:p.a.toUnitRGBA(Oe.a.orange),outlineSize:Oe.a.rightAngleHintOutlineSize,size:Oe.a.rightAngleHintSize,geometry:{previous:Object(_e.b)(e.previousVertex,i,r,a),center:Object(_e.b)(e.centerVertex,i,r,a),next:Object(_e.b)(e.nextVertex,i,r,a)}}))}_createLineSegmentHintFromMap(e,t,i,r,n,a,s=!0,o=!0){const c=Object(b.f)(),l=Object(b.f)();return Object(_e.d)(t,i,r,n,a,c,l),this._createLineSegmentHint(e,a,c,l,s,o)}_createLineSegmentHint(e,t,i,r,n=!0,a=!0){const s=new L({view:t,extensionType:G.FADED,start:i,end:r,color:p.a.toUnitRGBA(Oe.a.orange),renderOccluded:P.c.Opaque});switch(e){case _e.a.TARGET:s.width=Oe.a.lineHintWidthTarget,s.fadedExtensions={start:0,end:Oe.a.lineHintFadedExtensions};break;case _e.a.REFERENCE_EXTENSION:s.width=Oe.a.lineHintWidthReference,s.fadedExtensions={start:0,end:0};break;case _e.a.REFERENCE:s.width=Oe.a.lineHintWidthReference,s.fadedExtensions={start:n?Oe.a.lineHintFadedExtensions:0,end:a?Oe.a.lineHintFadedExtensions:0}}return s.attached=!0,s}}var je=i(505),xe=i(1085);const Te={main:new p.a([255,127,0]),selected:new p.a([255,255,255]),staged:new p.a([12,207,255]),outline:new p.a([0,0,0,.5]),selectedOutline:new p.a([255,255,255])},Se=.3;function Ee(e,t){const i=e.clone();return i.a*=t,i}function Ae(e,t){const i=e.clone(),r=Object(je.b)(i);r.s*=t;const n=Object(je.e)(r);return i.r=n.r,i.g=n.g,i.b=n.b,i}function we(e,t){if(t)for(const i in t)e[i]=t[i]}class Me{constructor(e){this.color=Te.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=P.c.Opaque,we(this,e)}}class Re{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Te.main,this.outlineColor=Te.outline,this.renderOccluded=P.c.Opaque,this.hoverOutlineColor=Te.selectedOutline,we(this,e)}apply(e,t){const i=this[e];t.setParameters({color:Ge(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class Ce{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Ee(Te.main,.5),this.hoverColor=Te.main,this.renderOccluded=P.c.Transparent,this.minSquaredEdgeLength=900,we(this,e)}apply(e,t){const i=this[e];t.setParameters({color:Ge(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class Pe{constructor(e){this.vertex=new Re({color:Te.main,outlineColor:Te.outline}),this.edge=new Re({color:Ae(Ee(Te.main,2/3),.5),outlineColor:Ee(Te.outline,.5),size:8,collisionPadding:8}),this.selected=new Re({color:Te.selected,outlineColor:Te.outline}),this.edgeOffset=new Ce,we(this,e)}}class Ie{constructor(e){this.color=Te.selected,this.width=1.5,this.stipplePattern=Object(xe.a)(5),this.stippleOffColor=Te.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Te.selected,this.renderOccluded=P.c.OccludeAndTransparent,we(this,e)}apply(e){e.color=Ge(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Ge(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Ge(this.innerColor),e.renderOccluded=this.renderOccluded}}class De{constructor(e){this.color=Te.selected,this.size=4,this.outlineSize=1,this.outlineColor=Te.outline,this.shape="square",we(this,e)}apply(e){e.color=Ge(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Ge(this.outlineColor),e.primitive=this.shape}}class Le{constructor(e){this.innerColor=Te.selected,this.innerWidth=1,this.glowColor=Te.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Se,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Te.main,we(this,e)}apply(e,t=1){const i={glowColor:p.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:p.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class Ne{constructor(e){this.outline=new Ie({color:Te.outline,renderOccluded:P.c.OccludeAndTransparentStencil,stippleOffColor:Te.selected,stipplePattern:Object(xe.a)(5),width:1.5,innerWidth:0}),this.staged=new Ie({color:Te.selected,renderOccluded:P.c.OccludeAndTransparentStencil,innerColor:Te.staged,stippleOffColor:Te.outline,stipplePattern:Object(xe.a)(5),width:1.5}),this.shadowStyle=new Le({globalAlpha:Se,glowColor:Te.main,glowFalloff:8,glowWidth:8,innerColor:Te.selected,innerWidth:1}),we(this,e)}}class Fe{constructor(e){this.outline=new De({color:Te.selected,outlineColor:Te.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Le({globalAlpha:Se,glowColor:Te.main,glowFalloff:1.5,glowWidth:6,innerColor:Te.selected,innerWidth:1,radius:2}),we(this,e)}}class ze extends Ie{constructor(e){super(),this.extensionType=G.GROUND_RAY,we(this,e)}}class Ue{constructor(e){this.lineGraphics=new Ne,this.pointGraphics=new Fe,this.heightPlane=new Le({globalAlpha:Se,glowColor:Te.main,glowFalloff:8,glowWidth:8,innerColor:Te.selected,innerWidth:1}),this.heightBox=new Le({globalAlpha:Se,glowColor:Te.main,glowFalloff:8,glowWidth:8,innerColor:Te.selected,innerWidth:0,heightFillColor:Te.main}),this.zVerticalLine=new ze({color:Ee(Te.main,.5),falloff:2,innerColor:Ee(Te.selected,0),renderOccluded:P.c.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:G.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,we(this,e)}}function Ge(e){return Object(ee.f)(p.a.toUnitRGBA(e))}const Ve=new class{constructor(e){this.visualElements=new Ue,this.reshapeManipulators=new Pe,this.zManipulator=new Me,we(this,e)}colorToVec4(e){return Ge(e)}};var ke=i(138),He=i(463),Be=i(100),We=i(159),qe=i(1002),Ze=i(896);class Xe{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(a.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(a.j)(this._resources)||(this._ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(a.j)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new Ye({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(Object(a.j)(this._resources))return;this._ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;!Object(a.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,Ze.a.Geometry.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){Object(a.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,Ze.a.Geometry.UPDATE),this._resources.geometriesAdded=!0)}}let Ye=class extends(Object(We.a)(Be.a)){constructor(e){super(e),this.drapeSourceType=qe.a.Features,this.updatePolicy=A.j.SYNC}};Object(r.a)([Object(o.b)({constructOnly:!0})],Ye.prototype,"view",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Ye.prototype,"drapeSourceType",void 0),Ye=Object(r.a)([Object(u.a)("DrapedVisualElementLayerView")],Ye);var $e=i(1003),Qe=i(562),Ke=i(963);class Je{constructor(e){this.view=null,this._attachmentOrigin=Object(He.g)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new ke.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(O.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(O.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=P.c.OccludeAndTransparentStencil,this.resources=new ae({view:e.view,createResources:e=>this._createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new Xe({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()}});let t=!0;this._laserline=new x.a({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(a.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this._updateAttached(e)}_updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(m.g)(e,this._color)||(Object(m.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(m.g)(e,this._innerColor)||(Object(m.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a.k)(e)!==Object(a.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(m.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(O.a)(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(a.k)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(a.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(f.w)(it,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get(I.a.POSITION),r=i.indices.get(I.a.POSITION),n=Object(a.s)(this.resources.resources).material.isClosed(e.data,r);Object(Qe.a)(e,r,n,tt)&&(Object(f.f)(it,it,tt),t++)}return 0===t?null:(Object(f.e)(it,it,1/t),this.view.renderCoordsHelper.fromRenderCoords(it,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){Object(a.k)(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),Object(a.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}get isClosed(){return Object(a.k)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===P.c.OccludeAndTransparentStencil?P.c.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,i){const r=this._createRenderGeometries();for(const n of r)e.addGeometry(n,t),i.push(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(e){const t=new D.a(this.materialParameters),i=[];return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_createDrapedResources(){const e=new D.a(this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(Object(a.j)(t))return[];const i=Object($e.d)(t,this.view.basemapTerrain.spatialReference),r=[];for(const{position:n}of i.lines){const t={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this.isClosed?$e.a.REMOVE:$e.a.KEEP},i=new Ke.a(Object($e.b)(t),e),a=Object(ie.h)(et);Object(ie.k)(a,n),Object(m.l)(i.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),r.push(i)}return r}calculateMapBounds(e){if(Object(a.j)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const r=i.vertexAttributes.get(I.a.POSITION),n=new Float64Array(r.data.length);Object(te.l)(r.data,t.spatialReference,0,n,this.view.spatialReference,0,r.data.length/3),Object(ie.k)(e,n)}return!0}_createRenderGeometries(){var e;const t=this.geometry;if(Object(a.j)(t))return[];const i=Object($e.c)(t,this.view.elevationProvider,this.view.renderCoordsHelper,oe.a.fromElevationInfo(null!=(e=this.elevationInfo)?e:new d.a({mode:Object(h.d)(t,null)}))),r=[],n=[];for(const{position:a,mapPosition:s}of i.lines){const e={overlayInfo:null,attributeData:{position:a,mapPosition:s},removeDuplicateStartEnd:this.isClosed?$e.a.REMOVE:$e.a.KEEP};r.push(Object($e.b)(e)),n.push(a)}return this._laserline.pathVerticalPlane=n,r}}const et=Object(ie.f)(),tt=Object(b.f)(),it=Object(b.f)();var rt=i(951),nt=i(964);class at extends R{constructor(e){super(e),this.view=null,this._renderOccluded=P.c.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=Ve.colorToVec4(Ve.reshapeManipulators.vertex.color),this._size=Ve.reshapeManipulators.vertex.size,this._outlineColor=Ve.colorToVec4(Ve.reshapeManipulators.vertex.outlineColor),this._outlineSize=Ve.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(m.g)(e,this._color)||(Object(m.c)(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(m.g)(e,this._outlineColor)||(Object(m.c)(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(Object(a.j)(e)||0===e.length)return[];const t=Object(rt.c)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,oe.a.fromElevationInfo(this.elevationInfo)),i=[],r=t.numVertices,n=t.position;for(let a=0;a<r;++a){const e=Object(f.w)(st,n[3*a+0],n[3*a+1],n[3*a+2]),t=ot(.5,e),r=ot(.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:r})}return i}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:r}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(r,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new nt.a({...this.vertexMaterialParameters,writeDepth:!0,cullFace:A.b.Back,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new nt.a({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:A.b.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const st=Object(b.f)();function ot(e,t){return C.a.createSphereGeometry(e,16,16,{offset:t})}let ct=class extends ke.a.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(r.a)([Object(o.b)({constructOnly:!0})],ct.prototype,"graphic",void 0),Object(r.a)([Object(o.b)()],ct.prototype,"tracking",void 0),Object(r.a)([Object(o.b)()],ct.prototype,"displaying",void 0),Object(r.a)([Object(o.b)()],ct.prototype,"isDraped",void 0),ct=Object(r.a)([Object(u.a)("esri.views.3d.layers.graphics.GraphicState")],ct);var lt=i(1186),ut=i(909),ht=i(892);let dt=class extends lt.a{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new d.a({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){var t;const i=null==(t=e.hasZ)||t;return{...e,elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}}}return e}initializeGraphic(e){return this._createGraphicState=new ct({graphic:e}),Object(n.b)([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),Object(s.a)(this._createGraphicState,"isDraped",(e=>{Object(a.k)(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)}))])}makeDrawOperation(){return new ut.a({view:this.view,manipulators:this.manipulators,geometryType:Object(lt.b)(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new ht.c(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new ht.a(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new ye})}onActiveVertexChanged(e){return Object(a.k)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new at({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:Ve.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=Ve.colorToVec4(Ve.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,Object(n.c)((()=>{this._activeVertexVisualElement=Object(a.d)(this._activeVertexVisualElement)})))}onOutlineChanged(e){if(Object(a.k)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Je({view:this.view,geometry:e,elevationInfo:t,isDraped:Object(a.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(h.c)(this.hasZ,t),attached:!1}),Ve.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),Ve.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Object(n.c)((()=>{this._outlineVisualElement=Object(a.d)(this._outlineVisualElement)}))}onRegularVerticesChanged(e){return Object(a.k)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new at({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:Ve.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Object(n.c)((()=>{this._verticesVisualElement=Object(a.d)(this._verticesVisualElement)})))}};Object(r.a)([Object(o.b)({constructOnly:!0})],dt.prototype,"elevationInfo",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],dt.prototype,"geometryType",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],dt.prototype,"type",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],dt.prototype,"view",void 0),dt=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],dt);var pt=i(111),ft=i(134),bt=i(771),gt=i(761);function mt(e,t=Object(h.e)(e)){return"on-the-ground"!==t.mode&&!(Object(a.j)(e.geometry)||!e.geometry.hasZ)}var Ot,_t,vt,yt,jt=i(688);(_t=Ot||(Ot={}))[_t.NONE=0]="NONE",_t[_t.ANY=1]="ANY",_t[_t.Z=2]="Z",_t[_t.XY=4]="XY",(yt=vt||(vt={}))[yt.TRANSLATE_Z=0]="TRANSLATE_Z",yt[yt.TRANSLATE_XY=1]="TRANSLATE_XY",yt[yt.SCALE=2]="SCALE",yt[yt.ROTATE=3]="ROTATE",yt[yt.SCALE_ROTATE=4]="SCALE_ROTATE";class xt{constructor(){this.grabbingState=Ot.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Ot.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(t===vt.TRANSLATE_Z&&(this.zManipulator=e),e instanceof jt.a&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(a.j)(this.firstGrabbedXY)&&e.grabbing&&t===vt.TRANSLATE_XY&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=Ot.ANY,t){case vt.TRANSLATE_Z:this.grabbingState|=Ot.Z;break;case vt.TRANSLATE_XY:this.grabbingState|=Ot.XY}}))}}function Tt(e){const{view:t,graphic:i}=e,r=new ct({graphic:i}),a=function(e,t){const{view:i,graphic:r}=e,a=new Je({view:i,geometry:Et(r)?r.geometry:null,elevationInfo:Object(h.e)(r),attached:!1});Ve.visualElements.lineGraphics.shadowStyle.apply(a);const s=()=>{a.attached=t.displaying};Ve.visualElements.lineGraphics.outline.apply(a);const o=[t.watch("displaying",s),t.watch("isDraped",(e=>a.isDraped=e)),t.on("changed",(()=>a.geometry=Et(r)?r.geometry:null)),Object(n.a)(a)];return s(),{visualElement:a,remove:()=>Object(n.b)(o).remove()}}(e,r),s=[a,St(e,a.visualElement,r),t.maskOccludee(i),t.trackGraphicState(r)];return{visualElement:a.visualElement,remove:()=>Object(n.b)(s).remove()}}function St(e,t,i){const{graphic:r,view:s}=e,o=[],c=Object(h.e)(r),l="on-the-ground"===c.mode||!c.offset&&"absolute-height"!==c.mode,u=new xt,d=new L({view:s,extensionType:Ve.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:P.c.OccludeAndTransparent});Ve.visualElements.pointGraphics.shadowStyle.apply(d);const p=Object(J.g)(Ve.visualElements.heightPlaneAngleCutoff),b=new x.a({view:s,attached:!1,angleCutoff:p});Ve.visualElements.heightPlane.apply(b);let g=1,m=1;const O=()=>{if(u.update(e),!i.displaying||l&&(i.isDraped||!Et(r)||!r.geometry.hasZ))return t.laserlineEnabled=!1,d.attached=!1,void(b.attached=!1);t.laserlineEnabled=!0;{const e=u.grabbingState&Ot.XY?Ve.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,Ve.visualElements.lineGraphics.shadowStyle.apply(t,e),Ve.visualElements.pointGraphics.shadowStyle.apply(d,e))}{const e=u.grabbingState&Ot.Z?Ve.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,Ve.visualElements.heightPlane.apply(b,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(a.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(a.k)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(d,u),function(e,t,i,r){if(r.numSelected>0){Object(f.w)(At,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{i===vt.TRANSLATE_XY&&e.selected&&e instanceof jt.a&&(Object(f.f)(At,At,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=Object(f.e)(At,At,1/t),i.attached=!0):i.attached=!1}else{const r=t.attachmentOrigin;Object(a.k)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,At)?(i.heightManifoldTarget=At,i.attached=!0):i.attached=!1}}(e,t,b,u)};Ve.visualElements.zVerticalLine.apply(d),o.push(i.on("changed",O),i.watch("displaying",O),t.events.on("attachment-origin-changed",O),Object(n.a)(d),Object(n.a)(b));const _=[],v=()=>{Object(n.b)(_).remove(),_.length=0,e.forEachManipulator((e=>_.push(e.events.on("grab-changed",O)))),e.forEachManipulator((e=>_.push(e.events.on("select-changed",O)))),O()};return v(),o.push(e.onManipulatorsChanged(v),Object(n.d)((()=>Object(n.b)(_)))),Object(n.b)(o)}function Et(e){return Object(a.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const At=Object(b.f)();var wt=i(118);function Mt(e){const{view:t,graphic:i}=e,r=new ct({graphic:i}),o=[],c=function(e,t,i){const{view:r,graphic:o}=e,c=new ue({view:r,geometry:Rt(o),elevationInfo:Object(h.e)(o),attached:!1});return function(e,t,i,r){const o=()=>t.attached=i.displaying;(function(e,t,i,r){const{view:s,graphic:o}=e;let c=null;const l=e=>{Object(a.k)(c)&&(c.remove(),c=null),i.isDraped&&Object(a.k)(e)&&(c=function(e,t,i){const r=e.elevationProvider.spatialReference;Object(te.o)(t,Ct,r);const n=Ct[0],a=Ct[1];return e.elevationProvider.on("elevation-change",(e=>{Object(wt.j)(e.extent,n,a)&&i()}))}(s,e,(()=>{t.geometry=e})))},u=()=>{const e=Rt(o);l(e),t.geometry=e};r.push(i.on("changed",u),Object(n.d)((()=>c))),u()})(e,t,i,r),Ve.visualElements.pointGraphics.outline.apply(t),r.push(Object(s.a)(i,"displaying",o))}(e,c,t,i),i.push(Object(n.a)(c)),c}(e,r,o);return function(e,t,i,r){const{view:s,graphic:o}=e,c=new L({view:s,extensionType:Ve.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:P.c.OccludeAndTransparent});Ve.visualElements.zVerticalLine.apply(c);const l=new x.a({view:s,intersectsLineInfinite:!0,attached:!1});Ve.visualElements.pointGraphics.shadowStyle.apply(l);const u=Object(J.g)(Ve.visualElements.heightPlaneAngleCutoff),d=new x.a({view:s,attached:!1,angleCutoff:u});Ve.visualElements.heightPlane.apply(d);const p=Object(h.e)(e.graphic),b=oe.a.fromElevationInfo(p),g="on-the-ground"===p.mode||!p.offset&&"absolute-height"!==p.mode,m=new xt;let O=1,_=1;const v=()=>{m.update(e);const i=Rt(o),n=g&&(t.isDraped||Object(a.j)(i)||!i.hasZ);let u=!0;if(!n&&Object(a.k)(i)){const e=Object(se.f)(i,s.elevationProvider,b,s.renderCoordsHelper);Object(f.w)(Ct,i.x,i.y,e),Object(te.t)(Ct,i.spatialReference,Ct,s.renderCoordsHelper.spatialReference),c.setStartEndFromWorldDownAtLocation(Ct),l.intersectsWorldUpAtLocation=Ct}else u=!1;const h=m.grabbingState&Ot.Z?Ve.visualElements.laserlineAlphaMultiplier:1;h!==O&&(O=h,Ve.visualElements.heightPlane.apply(d,h));const p=Object(ie.h)(Pt);!n&&t.displaying&&r.calculateMapBounds(p)&&Object(te.t)(Object(ie.q)(p,Ct),s.spatialReference,Ct,s.renderCoordsHelper.spatialReference)?(d.heightManifoldTarget=Ct,d.attached=!0):d.attached=!1;const v=m.grabbingState&Ot.XY?Ve.visualElements.laserlineAlphaMultiplier:1;v!==_&&(_=v,Ve.visualElements.pointGraphics.shadowStyle.apply(l,v));const y=u&&t.displaying&&!n;l.attached=y,c.attached=y};i.push(t.watch(["displaying","isDraped"],v),t.on("changed",v)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",v))})),i.push(Object(n.a)(l)),i.push(Object(n.a)(c)),i.push(Object(n.a)(d)),v()}(e,r,o,c),o.push(t.trackGraphicState(r)),{visualElement:c,remove(){Object(n.b)(o).remove()}}}function Rt(e){const t=e.geometry;return Object(a.j)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const Ct=Object(b.f)(),Pt=Object(ie.f)();function It(e){switch(Object(a.s)(e.graphic.geometry).type){case"point":case"mesh":return Mt(e);case"polygon":case"polyline":return Tt(e);default:return null}}const Dt=[1,.5,0],Lt=70,Nt=Math.ceil(Lt/3*2),Ft=160,zt=5*Math.PI/12,Ut=1*Math.PI/3;class Gt{constructor(){this._available=!0}set location(e){this._forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this._forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this._forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this._forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}_forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof jt.a&&e(t,i)}))}}var Vt=i(749),kt=i(490);function Ht(e,t,i,r){const n=e.graphic,a=(e,i)=>t({action:e,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{const s=t.next((e=>("start"===e.action&&a("start",e),e))).next(Object(kt.g)(n,r)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e}));return i.next(Object(kt.i)(n)).next((()=>{a("end",{screenDeltaX:0,screenDeltaY:0})})),s}))}function Bt(e){if(Object(a.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],r=t[1];return Math.atan2(r[1]-i[1],r[0]-i[0])}var Wt=i(574);class qt extends Gt{constructor(e){super(),this._handles=new g.a,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Lt,this._updateAfterDrag=!1,this.events=new ke.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles=Object(a.d)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,vt.TRANSLATE_XY)}createGraphicDragPipeline(e,t,i){const r=t.graphic,n=Object(h.e)(r),s=Object(a.s)(r.geometry).spatialReference;return Ht(t,i,(t=>this.createDragPipeline(((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n)),n,s,r)),this._view.state.viewingMode)}createDragPipeline(e,t,i,r){return Object(n.b)(this._arrowManipulatorInfos.map((({manipulator:n},a)=>Object(kt.e)(n,((n,s,o,c,l)=>{const u=s.next((e=>({...e,manipulatorType:vt.TRANSLATE_XY}))).next(Object(kt.f)(this._view,n.elevationAlignedLocation)).next(Object(Vt.e)(this._view,n.elevationAlignedLocation,t,i,r)).next(Object(kt.d)(n.location,this.angle+(a+1)*Math.PI*.5)).next(Object(kt.c)());e(n,u,o,c,l)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const r=this._radius/Lt,n=54*r,a=n*Math.sqrt(3)/2,s=C.a.createExtrudedTriangle(a,n/2,n/2,.02);C.a.transformInPlace(s,Object(T.f)(re.a.get(),Object(f.w)(re.d.get(),0,-a/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:Wt.c.Focused},{geometry:s,material:this._transparentMaterial,stateMask:Wt.c.Unfocused}],e.radius=a/3*2*1.2;const o=Object(T.b)(re.a.get(),i*Math.PI/2),c=Object(T.f)(re.a.get(),Object(f.w)(re.d.get(),0,100*r,0));Object(T.m)(t,o,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(T.d)(re.a.get(),e,Object(b.h)(0,0,1)),i=Object(T.u)(re.a.get(),Object(f.w)(re.d.get(),this.displayScale,this.displayScale,this.displayScale)),r=Object(T.m)(re.a.get(),i,t);for(const n of this._arrowManipulatorInfos){const e=Object(T.m)(re.a.get(),r,n.transform);n.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new jt.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(b.h)(0,0,1)}}),i={manipulator:t,transform:Object(S.d)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}_createMaterial(e=1){const t=p.a.toUnitRGBA(Te.main);return t[3]*=e,new be.a({color:t,transparent:1!==e,cullFace:A.b.Back,renderOccluded:P.c.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class Zt{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new kt.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(a.k)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this._snap(this.lastDragEvent.screenEnd);if(Object(a.k)(i)){const r={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(r)}}this._enabled=e}_snap(e){const t=Object(a.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(a.k)(t)&&Object(a.k)(this.view)&&(t.z=Object(h.g)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this._snap(e.screenEnd);return Object(a.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class Xt extends Gt{constructor(e){super(),this._handles=new g.a,this._snapToScene=new Zt,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Lt,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,vt.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const r=t.graphic,n=Object(h.e)(r),s=Object(a.s)(r.geometry).spatialReference;return Ht(t,i,(t=>this.createDragPipeline(((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n)),n,s,r)),this._view.state.viewingMode)}createDragPipeline(e,t,i,r){const n=this._view;return Object(kt.e)(this._manipulator,((a,s,o,c,l)=>{const u=s.next(Object(kt.f)(n,a.elevationAlignedLocation)).next(Object(Vt.e)(n,a.elevationAlignedLocation,t,i,r)).next(this._snapToScene.createDragEventPipelineStep(n,t),this._snapToScene.next).next((e=>({...e,manipulatorType:vt.TRANSLATE_XY}))).next(Object(kt.c)());e(a,u,o,c,l)}))}_updateManipulatorTransform(){const e=Object(T.u)(re.a.get(),Object(f.w)(re.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new jt.a({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(b.h)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=C.a.createCylinderGeometry(.02,1,128,Object(b.h)(0,0,1),Object(b.h)(0,0,0)),t=Object(T.u)(Object(S.d)(),Object(b.h)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:Wt.c.Focused},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:Wt.c.Unfocused}],this._manipulator.radius=this._radius/Lt*80}_createMaterial(e=1){const t=p.a.toUnitRGBA(Te.main);return t[3]*=e,new be.a({color:t,transparent:1!==e,cullFace:A.b.Back,renderOccluded:P.c.Transparent})}get test(){return{discManipulator:this._manipulator}}}class Yt extends Gt{constructor(e){super(),this._handles=new g.a,this._radius=Lt,this.events=new ke.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,vt.TRANSLATE_Z)}createGraphicDragPipeline(e,t,i){const r=Object(a.s)(t.graphic.geometry).spatialReference;return Ht(t,i,(t=>this.createDragPipeline(((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n)),r)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return Object(kt.e)(this._manipulator,((r,n,a,s,o)=>{const c=n.next((e=>({...e,manipulatorType:vt.TRANSLATE_Z}))).next(Object(Vt.j)(i,r.renderLocation,t)).next(Object(kt.c)());e(r,c,a,s,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/Lt,t=Ve.zManipulator.height*e,i=Ve.zManipulator.coneHeight*e,r=Ve.zManipulator.coneWidth*e,n=Ve.zManipulator.width*e,a=[Object(b.h)(0,0,0),Object(b.h)(0,0,t)],s=C.a.createTubeGeometry(a,n/2,16,!1),o=C.a.createConeGeometry(i,r/2,16,!1),c=[Object(b.h)(0,0,0),Object(b.h)(0,0,t+i)],l=(e=>{const i=Object(S.d)();if(Object(T.j)(i,i,[0,0,t]),Object(T.r)(i,i,Math.PI/2),e){const t=1+2*e/r;Object(T.h)(i,i,[t,t,t])}return i})(0),u=(e,t)=>{const i=Object(je.a)(Ve.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,Ve.zManipulator.color.a*e]},h=Object(bt.c)(u(1,.25),P.c.Occlude),d=Object(bt.c)(u(1,0),P.c.Occlude),p=Object(bt.c)(u(.7,0),Ve.zManipulator.renderOccluded),f=Object(bt.c)(u(.85,0),Ve.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:l,material:h,stateMask:Wt.c.Unfocused},{geometry:s,material:h,stateMask:Wt.c.Unfocused},{geometry:o,transform:l,material:d,stateMask:Wt.c.Focused},{geometry:s,material:d,stateMask:Wt.c.Focused},{geometry:o,transform:l,material:p,stateMask:Wt.c.Unfocused},{geometry:s,material:p,stateMask:Wt.c.Unfocused},{geometry:o,transform:l,material:f,stateMask:Wt.c.Focused},{geometry:s,material:f,stateMask:Wt.c.Focused}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}_createManipulator(){const e=new jt.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=$t;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const r=Object(f.n)(t.eye,i),n=t.computeRenderPixelSizeAtDist(r),a=Object(f.j)(Qt,i,t.eye);Object(f.r)(a,a);const s=Kt;this._view.renderCoordsHelper.worldUpAtPosition($t,s);const o=Math.abs(Object(f.h)(a,s)),c=Object(f.g)(Qt,a,s),l=Object(f.g)(Qt,c,s),u=Object(J.e)(o,.01,1),h=1-Math.sqrt(1-u*u)/u/t.fullWidth,d=this._radius/Lt,p=Ve.zManipulator.width*d;Object(f.e)(l,Object(f.r)(l,l),(1/h-1)*r+n*p),e[12]-=Qt[0],e[13]-=Qt[1],e[14]-=Qt[2]},this._manipulator=e,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const $t=Object(b.f)(),Qt=Object(b.f)(),Kt=Object(b.f)();class Jt extends Gt{constructor(e){super(),this._handles=new g.a,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:r,radius:n}=e;this._view=i,this.xyManipulation=new Xt({tool:t,view:i,snapToScene:r,radius:n}),this.xyAxisManipulation=new qt({tool:t,view:i,radius:n}),this.zManipulation=new Yt({tool:t,view:i,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(n.b)([this.xyManipulation.createGraphicDragPipeline(((t,i,r,n,a)=>e(ti.XY,t,i,r,n,a)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,r,n,a)=>e(ti.XY_AXIS,t,i,r,n,a)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,r,n,a)=>e(ti.Z,t,i,r,n,a)),t,i)])}createDragPipeline(e,t,i,r){return Object(n.b)([this.xyManipulation.createDragPipeline(((t,i,r,n,a)=>e(ti.XY,t,i,r,n,a)),t,i,r),this.xyAxisManipulation.createDragPipeline(((t,i,r,n,a)=>e(ti.XY_AXIS,t,i,r,n,a)),t,i,r),this.zManipulation.createDragPipeline(((t,i,r,n,a)=>e(ti.Z,t,i,r,n,a)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,vt.TRANSLATE_XY))),this.xyAxisManipulation.forEachManipulator((t=>e(t,vt.TRANSLATE_XY))),this.zManipulation.forEachManipulator((t=>e(t,vt.TRANSLATE_Z)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(c.a)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const r=()=>{const t=[];this.xyAxisVisible?Object(a.k)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(ei),this._handles.add(t,ei)};for(const n of i)this._handles.add(n.events.on("focus-changed",r));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",r)),r()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=Object(a.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?Nt:Lt}}const ei="disable-xy-axis-display";var ti,ii;(ii=ti||(ti={}))[ii.XY=0]="XY",ii[ii.XY_AXIS=1]="XY_AXIS",ii[ii.Z=2]="Z";var ri=i(772);class ni extends Gt{constructor(e){super(),this._handles=new g.a,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,vt.TRANSLATE_XY)}createGraphicDragPipeline(e){return Ht(this._graphicState,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,r=Object(a.k)(i.geometry)?i.geometry.spatialReference:null;return Object(kt.e)(this._manipulator,((n,a,s,o,c)=>{const l=a.next(Object(Vt.f)(c,t,i,r)).next(Object(kt.b)()).next(Object(kt.c)());e(n,l,s,o,c)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new ri.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}var ai=i(1073),si=i(675),oi=i(735),ci=i(712),li=i(795);class ui{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class hi{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class di{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let pi=class extends(Object(ft.b)(ke.a.EventedMixin(si.a))){constructor(e){super(e),this.graphics=new pt.a,this.enableZ=!0,this.type="move-3d",this._toolHandles=new g.a,this.snappingPipeline=new li.a}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>Object(ai.a)(e)===gt.a.SUPPORTED)).map((e=>new fi(e)));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new ni({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))))),this.handles.add(t.manipulationXY.createDragPipeline(((t,i,r,n)=>this._buildDragEventPipeline(e,ti.XY,t,i,r,n))))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new Jt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Jt.radiusForSymbol(e[0].graphic.symbol):Lt});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=()=>this._updateMoveManipulation(e);for(const n of e)this.handles.add([n.state.on("changed",i),n.state.watch("displaying",i)]);const r=e[e.length-1];this.handles.add(r.state.on("changed",(()=>this._updateMoveManipulationAngle(r)))),this.handles.add(t.createDragPipeline(((t,i,r,n,a)=>this._buildDragEventPipeline(e,t,i,r,n,a)),Object(h.e)(r.graphic),Object(a.s)(r.graphic.geometry).spatialReference,r.graphic)),this._updateMoveManipulationAngle(r)}_createVisualElements(e){for(const t of e){const i=t.graphic,r=It({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(n.c)()});Object(a.j)(r)||(t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof Je&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this._updateMoveManipulation(e)})),t.state.watch("isDraped",(()=>this._updateMoveManipulation(e)))]),this.handles.add(r))}}_updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>Bt(e.graphic.geometry)}_updateMoveManipulation(e){const t=Object(He.g)(0,0,0,this.view.spatialReference);let i=0,r=!1;const n=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const e=s.state.graphic;this.enableZ&&mt(e)&&(r=!0);const n=s.geometryRepresentation instanceof Je&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Object(bt.f)(this.view,e);Object(a.k)(n)&&(t.x+=n.x,t.y+=n.y,t.z+=n.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,n.location=t,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=r):n.available=!1}_buildDragEventPipeline(e,t,i,r,n,a){const s=[],o=[];let c=null,l=null;const u=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&t===ti.XY){const t=e[0].graphic;r=this._buildSnappingPipelineSteps(t,Object(h.e)(t),r,n,a)}const d=r.next((t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(kt.h)(o,this.view.state.viewingMode),l=Object(kt.j)(o),this.emit("graphic-move-start",new ui(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>c(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),r=i.x-t.x,n=i.y-t.y;if(this.emit("graphic-move",new hi(r,n,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new di(o)),this.destroyed)return null;u()}}));return n.next((e=>l(e))).next((()=>{if(this.emit("graphic-move-stop",new di(o)),this.destroyed)return null;u()})),d}_buildSnappingPipelineSteps(e,t,i,r,n){const s=e.geometry;if(Object(a.j)(s)||"point"!==s.type&&"mesh"!==s.type)return i;const o=("point"===s.type?s:s.anchor).clone(),c=new ci.a({elevationInfo:t,pointer:n,editGeometryOperations:oi.a.fromGeometry(o,this.view.state.viewingMode),visualizer:new ye,excludeFeature:e}),l=this.snappingManager;return i.next((t=>(o.z=Object(h.a)(this.view,o,Object(h.e)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:c.coordinateHelper.pointToVector(o)}))).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:r,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],pi.prototype,"view",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],pi.prototype,"graphics",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],pi.prototype,"enableZ",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],pi.prototype,"snappingManager",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],pi.prototype,"type",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],pi.prototype,"updating",null),pi=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],pi);class fi{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ct({graphic:e})}get graphic(){return this.state.graphic}}var bi=i(1074),gi=i(140),mi=i(431),Oi=i(423),_i=i(1219);function vi(e,t,i){const r="on-the-ground"===i.mode?_i.b.XY:_i.b.XYZ;return new _i.a(e,r,t,0)}function yi(e,t,i){const r=Object(b.f)();if(!e.renderCoordsHelper.toRenderCoords(t,r))return null;const n=ji(e,t,Object(Oi.q)(i.plane)),s=ji(e,t,i.edgeDirection);if(Object(a.j)(n)||Object(a.j)(s))return null;const o=Object(f.g)(Object(b.f)(),n,s);return Object(Oi.g)(r,o,Object(Oi.d)())}function ji(e,t,i){const r=Object(He.g)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=Object(b.f)(),a=Object(b.f)();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(r,a)?Object(f.v)(a,n,a):null}var xi=i(1071),Ti=i(1145);let Si=class extends(ke.a.EventedMixin(ft.a)){constructor(e){super(e),this._vertexManipulatorMaterial=Object(bt.c)(Ve.colorToVec4(Ve.reshapeManipulators.vertex.color),Ve.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Object(bt.d)(Ve.colorToVec4(Ve.reshapeManipulators.vertex.outlineColor),Ve.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Object(bt.d)(Ve.colorToVec4(Ve.reshapeManipulators.vertex.hoverOutlineColor),Ve.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Object(bt.c)(Ve.colorToVec4(Ve.reshapeManipulators.edge.color),Ve.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Object(bt.d)(Ve.colorToVec4(Ve.reshapeManipulators.edge.outlineColor),Ve.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=Object(bt.c)(Ve.colorToVec4(Ve.reshapeManipulators.edgeOffset.color),Ve.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Object(bt.c)(Ve.colorToVec4(Ve.reshapeManipulators.edgeOffset.hoverColor),Ve.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=Object(bt.c)(Ve.colorToVec4(Ve.reshapeManipulators.selected.color),Ve.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Object(bt.d)(Ve.colorToVec4(Ve.reshapeManipulators.selected.outlineColor),Ve.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Object(bt.d)(Ve.colorToVec4(Ve.reshapeManipulators.selected.hoverOutlineColor),Ve.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new g.a,this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=Pi.NONE,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new li.a,this._snappingPipelineHandle=new li.a,this._vertexLaserLineVisualElement=null}initialize(){const e=new ct({graphic:this.graphic});this._graphicState=e,this.handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._editGeometryOperations=Object(a.d)(this._editGeometryOperations),this._moveManipulation=Object(a.d)(this._moveManipulation),this._graphicMoveManipulation=Object(a.d)(this._graphicMoveManipulation),this._manipulatorHandles=Object(a.d)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return Object(a.k)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=Object(a.d)(this._moveManipulation),this._graphicMoveManipulation=Object(a.d)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(Object(a.j)(this._editGeometryOperations))return;const e=Object(h.e)(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return Object(a.k)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return Object(a.k)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(Object(a.j)(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return Object(a.k)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(Object(a.j)(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return Object(a.k)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),Object(a.j)(e)||(Object(a.d)(this._editGeometryOperations),this._editGeometryOperations=oi.a.fromGeometry(e,this.view.state.viewingMode),this._createManipulators())}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;let i=0;const r=[],n=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),a=e===Ii.SELECTED_OR_ALL&&n;for(const s of this._manipulatorInfos)Ai(s)&&(s.manipulator.grabbing||a&&!s.manipulator.selected||r.push(s),i++);if(0!==r.length)if(this._moveVertices(r,t),r.length===i){if(this._updateEventState(Pi.MOVING),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(Pi.RESHAPING),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)Ai(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(Pi.RESHAPING),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:r}=e;if(!t&&!i&&!r)return;const n=[];for(const a of this._manipulatorInfos)Ai(a)&&(a.manipulator.selected&&!a.manipulator.grabbing||a===e.info)&&n.push(a);this._moveVertices(n,e,Ti.a.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case Pi.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case Pi.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case Pi.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case Pi.MOVING:switch(this._reshapeEventState){case Pi.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case Pi.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case Pi.RESHAPING:switch(this._reshapeEventState){case Pi.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case Pi.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){if(this._graphicMoveManipulation=new ni({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,r)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=Object(a.s)(this._editGeometryOperations).createUndoGroup()),t))).next((t=>{this._perGraphicManipulatorDragAction(Ii.ALL,t),"end"===t.action&&(e=Object(a.r)(e))})),r.next(this._cancelDragOperation((()=>e=Object(a.r)(e))))})))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))]))),this._moveManipulation=new Jt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&mt(this.graphic),snapToScene:!1,radius:Jt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this.handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=Object(a.s)(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline(((t,i,r,n,s)=>{const o=r.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>Ai(e)&&e.manipulator.selected));return e.manipulatorType===vt.TRANSLATE_XY&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:n,snappingManager:this.tool.snappingManager,snappingContext:new ci.a({editGeometryOperations:Object(a.s)(this._editGeometryOperations),elevationInfo:e,pointer:s,excludeFeature:this.graphic,visualizer:new ye}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(Object(kt.b)()).next((e=>(this._perGraphicManipulatorDragAction(Ii.SELECTED_OR_ALL,e),e)));return n.next(this._cancelDragOperation()),o}),e,t,this.graphic),Object(s.a)(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),Object(s.a)(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this.handles.remove(e)}))]),this._updateMoveManipulationPosition();const i=It({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){Object(a.k)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,vt.TRANSLATE_XY);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});Object(a.k)(i)&&(this._outlineVisualElement=i.visualElement instanceof Je?i.visualElement:null),Object(a.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=Object(h.e)(this.graphic)){const i=Ve.reshapeManipulators.edgeOffset,r=i.size/2,s=r+i.collisionPadding;if(Object(a.j)(this._edgeOffsetManipulatorGeometryInside)||Object(a.j)(this._edgeOffsetManipulatorGeometryOutside)){const e=r/s,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=C.a.createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=C.a.createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset)}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:Wt.c.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Wt.c.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:Wt.c.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:Wt.c.Focused}],c=new jt.a({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||Object(mi.i)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(b.h)(0,0,1)},collisionPriority:1}),l=new jt.a({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),u={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:l,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(u,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(u);const d=this._getManipulatorInfoFromHandle(u.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(u))),p=this._getManipulatorInfoFromHandle(u.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(u)));u.locationUpdateHandle=Object(n.b)([d,p]),this._manipulatorHandles.add(u.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(l,!0)],c),this._manipulatorHandles.add(Object(kt.e)(c,this._createEdgeOffsetPipeline(u,t)),c),this._manipulatorHandles.add(Object(kt.e)(l,((e,i,r,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(u,t)(e,i,r);else if(this.enableMoveGraphic){const n=this.graphic,s=Object(a.k)(n.geometry)?n.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next(Object(kt.f)(this.view,e.elevationAlignedLocation)).next(Object(Vt.e)(this.view,e.elevationAlignedLocation,t,s,n)).next(Object(kt.c)()).next(Object(kt.b)()).next((e=>this._perGraphicManipulatorDragAction(Ii.ALL,e))),r.next(this._cancelDragOperation())}})),c);const f=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",f),l.events.on("immediate-click",f)],c),this._manipulatorInfos.push(u),this.manipulators.add(c),this.manipulators.add(l),this.emit("manipulators-changed"),u}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,r=e.edgeManipulator,s=()=>{Object(a.r)(e.visibilityHandle);const s=function(e,t,i){const r=i.projectToRenderScreen(e,Object(B.d)()),n=i.projectToRenderScreen(t,Object(B.d)());return Object(a.k)(r)&&Object(a.k)(n)?Object(f.t)(Object(f.j)(r,r,n)):0}(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!r.focused||s)&&(i.grabbable=!s,r.grabbable=!s,e.visibilityHandle=Object(n.b)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,r.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),r.events.on("focus-changed",s),{remove:()=>{Object(a.r)(e.visibilityHandle),this.manipulators.remove(r)}}],i),s()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=Object(a.s)(this._editGeometryOperations).data.coordinateHelper,i=yi(this.view,e.manipulator.elevationAlignedLocation,vi(t,e.handle,Object(a.s)(e.manipulator.elevationInfo))),r=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,s=Object(a.k)(i)?function(e,t,i){const r=Object(Oi.q)(e),n=Object(f.v)(Object(b.f)(),t,i),a=Object(f.g)(Object(b.f)(),n,r),s=Object(f.g)(Object(b.f)(),n,a);return Object(S.e)(n[0],n[1],n[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,0,0,0,1)}(i,r,n):S.a;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const o=Object(f.p)(Object(f.j)(Ri,r,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,r,n)=>{this._clearSelection();const{step:s,cleanup:o}=this._initializeEdgeOffset(e,t);r.next((e=>this._trackNumDragging(e))).next(Object(kt.f)(this.view,i.elevationAlignedLocation)).next(s).next(Object(Vt.i)(this.view)).next(Object(Vt.b)(this.view,Object(a.s)(this._editGeometryOperations).data.spatialReference)).next(Object(kt.b)()).next(this._applyEdgeOffsetStep(e)).next((e=>{"end"===e.action&&o()})),n.next((e=>(o(),e))).next(this._cancelDragOperation())}}_initializeEdgeOffset(e,t){const i=Object(a.s)(this._editGeometryOperations),r=vi(i.data.coordinateHelper,e.handle,t),s=i.createUndoGroup(),o=yi(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const c=()=>new gi.a({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:Object(a.s)(this._editGeometryOperations).data.spatialReference}),l=new Je({view:this.view,isDraped:this._graphicState.isDraped,geometry:c(),elevationInfo:e.elevationInfo,width:Ve.visualElements.lineGraphics.outline.width,color:Ve.colorToVec4(Te.main),attached:!0});let u;const h=()=>{this._cleanEdgeOffsetCollapsedEdges(e),u=Object(a.r)(u)},d=this.on("undo",h);return u=Object(n.b)([Object(n.a)(l),this._graphicState.watch("isDraped",(e=>l.isDraped=e)),this._graphicState.on("changed",(()=>l.geometry=c())),s,d]),{step:e=>Object(a.j)(r)||Object(a.j)(o)?(h(),null):{...e,operation:r,plane:o},cleanup:h}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||Object(a.j)(t.operation))return t;this._updateEventState(Pi.RESHAPING);const{mapDeltaX:i,mapDeltaY:r,mapDeltaZ:n}=t;return(i||r||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const r=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,n=e.handle.leftVertex,s=null==(i=e.handle.rightVertex.rightEdge)?void 0:i.rightVertex,o=e.handle.rightVertex,c=Object(a.s)(this._editGeometryOperations).data.coordinateHelper,l=1e-6,u=[];r&&c.distance(r.pos,n.pos)<l&&u.push(this._getManipulatorInfoFromHandle(n)),(c.distance(n.pos,o.pos)<l||s&&c.distance(s.pos,o.pos)<l)&&u.push(this._getManipulatorInfoFromHandle(o)),u.length&&this._removeVertices(u)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=Object(h.e)(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(Object(a.j)(this._vertexManipulatorGeometry)||Object(a.j)(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(Ve.reshapeManipulators.vertex);this._vertexManipulatorGeometry=C.a.createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=C.a.createSphereGeometry(t,16,16)}if(Object(a.j)(this._edgeManipulatorGeometry)||Object(a.j)(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(Ve.reshapeManipulators.edge);this._edgeManipulatorGeometry=C.a.createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=C.a.createSphereGeometry(t,16,16)}const i=Object(a.k)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Ci.Vertex|Wt.c.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:Ci.Vertex|Wt.c.Unfocused|Wt.c.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Ci.Vertex|Wt.c.Focused|Wt.c.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:Wt.c.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:Wt.c.Selected|Wt.c.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:Wt.c.Selected|Wt.c.Focused}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:Ci.Edge|Wt.c.Focused|Wt.c.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:Ci.Edge|Wt.c.Focused|Wt.c.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:Ci.Edge|Wt.c.Unfocused|Wt.c.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:Ci.Edge|Wt.c.Unfocused|Wt.c.Unselected});const r=new jt.a({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(r,e,t);const s="edge"===e.type?{manipulator:r,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:r,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(r),this._updateManipulatorPosition(s),"edge"===s.type){const e=this._getManipulatorInfoFromHandle(s.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(s))),t=this._getManipulatorInfoFromHandle(s.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(s)));s.locationUpdateHandle=Object(n.b)([e,t]),this._manipulatorHandles.add(s.locationUpdateHandle,r)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(r,!0),r);const o=Object(kt.e)(r,((e,i,r,n)=>{let o=null;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(o=Object(a.s)(this._editGeometryOperations).createUndoGroup()),wi(s)){const t=this._splitEdgeManipulator(s);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:s,snapOrigin:s.handle.pos}})).next(Object(kt.f)(this.view,e.elevationAlignedLocation)).next(Object(Vt.g)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new ci.a({editGeometryOperations:Object(a.s)(this._editGeometryOperations),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new ye}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(Object(kt.b)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(o=Object(a.r)(o))})),r.next(this._cancelDragOperation((()=>o=Object(a.r)(o))))}));return this._manipulatorHandles.add(o,r),this._manipulatorHandles.add([r.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,s))),r.events.on("select-changed",(()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))],r),this.emit("manipulators-changed"),s}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=Object(a.k)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,Object(a.k)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case Pi.NONE:break;case Pi.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case Pi.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(Pi.NONE)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=Ci.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=Ve.reshapeManipulators.vertex.size/2+Ve.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=Object(a.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=Ci.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=Ve.reshapeManipulators.edge.size/2+Ve.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||Object(mi.i)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(Pi.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==i.pointerType||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{e.manipulator.interactive=!this._numGrabbing&&Object(a.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!this._numGrabbing)})),Object(a.s)(this._graphicMoveManipulation).forEachManipulator((e=>e.interactive=!this._numGrabbing)))}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(a.s)(this._editGeometryOperations);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Mi),e.manipulator.grabbing&&Object(a.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,r=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if(Object(a.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=i.location,a=r.location,s=.5,o=n.x+s*(a.x-n.x),c=n.y+s*(a.y-n.y),l=n.hasZ&&a.hasZ?0:void 0;e.manipulator.location=Object(He.g)(o,c,l,t.data.spatialReference)}else Object(f.i)(Ri,i.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=Ri}}_splitEdgeManipulator(e,t=.5){const i=Object(a.s)(this._editGeometryOperations),r=Object(a.s)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const n=Object(h.e)(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(r)):(s=e,s.handle=r,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),r.leftEdge&&this._createVertexOrEdgeManipulator(r.leftEdge),r.rightEdge&&this._createVertexOrEdgeManipulator(r.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this._updateSelection(e.manipulator);const o=this._updateEventState(Pi.RESHAPING),c=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(r.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:c,componentIndex:l,vertexIndex:Object(a.s)(r.index)}],added:c}),o&&this._updateEventState(Pi.NONE),s}_updateMoveManipulationPosition(){const e=Object(f.w)(Ri,0,0,0);let t=0,i=!1,r=null,n=null;for(const s of this._manipulatorInfos)Ai(s)&&(s.manipulator.selected?(t++,Object(f.f)(e,e,s.manipulator.renderLocation),Object(a.j)(r)||s.selectedIndex>r.selectedIndex?(n=r,r=s):(Object(a.j)(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&mt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&mt(this.graphic)}if(0!==t){let e=0;if(Object(a.k)(r)){const t=r.handle.pos,i=Object(a.k)(n)?n.handle.pos:r.handle.leftEdge&&r.handle.leftEdge.leftVertex?r.handle.leftEdge.leftVertex.pos:null,s=!Object(a.k)(n)&&r.handle.rightEdge&&r.handle.rightEdge.rightVertex?r.handle.rightEdge.rightVertex.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=Ei(i,t):s&&(e=Ei(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=Nt}else this._moveManipulation.angleDeferred=()=>Bt(Object(a.s)(this.graphic.geometry)),this._moveManipulation.radius=Jt.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(f.e)(e,e,1/t),Mi.spatialReference=Object(a.s)(this._editGeometryOperations).data.spatialReference,Mi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Mi),this._moveManipulation.elevationAlignedLocation=Mi):Object(a.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(a.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(bt.g)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(a.s)(this._editGeometryOperations);for(const r of e)if("vertex"===r.handle.type&&i.canRemoveVertex()){t.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));const e=Object(a.s)(i.removeVertices([r.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:Object(a.s)(e.index)}}));this.outputGeometry=i.data.geometry;const r=this._updateEventState(Pi.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(r&&(this._updateEventState(Pi.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?Ti.a.NEW_STEP:Ti.a.ACCUMULATE_STEPS)){const r=Object(a.s)(this._editGeometryOperations);r.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=r.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if(Object(a.j)(t.operation))return;const i=Object(a.s)(this._editGeometryOperations),r=t.operation.clone();r.distance=t.operation.signedDistanceToPoint(t.mapEnd),i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],r),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&e.button===xi.a.Right&&this._removeVertices([t]),wi(t)&&e.button===xi.a.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}};function Ei(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Ai(e){return"vertex"===e.handle.type}function wi(e){return"edge"===e.handle.type}Object(r.a)([Object(o.b)({constructOnly:!0})],Si.prototype,"tool",void 0),Object(r.a)([Object(o.b)()],Si.prototype,"inputGeometry",null),Object(r.a)([Object(o.b)()],Si.prototype,"outputGeometry",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Si.prototype,"updating",null),Si=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Si);const Mi=Object(He.g)(0,0,null,null),Ri=Object(b.f)();var Ci,Pi,Ii;!function(e){e.Vertex=Wt.b.Custom1,e.Edge=Wt.b.Custom2}(Ci||(Ci={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(Pi||(Pi={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(Ii||(Ii={}));let Di=class extends(ke.a.EventedMixin(si.a)){constructor(e){super(e),this._handles=new g.a,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null,this.automaticManipulatorSelection=!1}destroy(){this._handles=Object(a.d)(this._handles),this._reshapeOperation=Object(a.d)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}_updateGeometry(){const e=Object(bi.a)(this.graphic);this._reshapeOperation.inputGeometry=Object(a.k)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),Object(bi.b)(this.graphic)!==gt.a.SUPPORTED)return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){Object(a.j)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new Si({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),Object(s.a)(this,"graphic",(()=>{this._updateGraphic()}),!0)]),this.finishToolCreation()}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){Object(a.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(a.k)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){Object(a.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(a.k)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(r.a)([Object(o.b)()],Di.prototype,"_reshapeOperation",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Di.prototype,"view",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Di.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Di.prototype,"enableZShape",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Di.prototype,"enableZVertex",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Di.prototype,"enableMoveGraphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Di.prototype,"enableMidpoints",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Di.prototype,"enableEdgeOffset",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Di.prototype,"type",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Di.prototype,"snappingManager",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Di.prototype,"updating",null),Object(r.a)([Object(o.b)()],Di.prototype,"automaticManipulatorSelection",void 0),Di=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Di);var Li,Ni,Fi,zi=i(113),Ui=i(272),Gi=i(234),Vi=i(629);(Fi=Li||(Li={})).ScaleIn=Wt.b.Custom2,Fi.ScaleOut=Wt.b.Custom3,Fi.RotateLeft=Wt.b.Custom4,Fi.RotateRight=Wt.b.Custom5,Fi.Unlocked=Wt.b.Custom7,Fi.DelayedFocused=Wt.b.Custom8,Fi.TouchInput=Wt.b.Custom12;class ki{constructor(e){this.mode=null,this._handles=new g.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new ke.a,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(a.k)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform()}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this.ringManipulator.location=e}set elevationAlignedLocation(e){this.ringManipulator.elevationAlignedLocation=e}get grabbing(){return this.ringManipulator.grabbing}set interactive(e){this.ringManipulator.interactive=e}destroy(){Object(a.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=Object(a.d)(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object(Gi.a)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(a.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=Object(a.d)(this._activeAnimation))}forEachManipulator(e){e(this.ringManipulator,vt.SCALE_ROTATE)}_createManipulator(){this.ringManipulator=this._createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(kt.e)(e,((e,i,r)=>{this._scaleRotateDragData=null,this.adapter.restart();const n={mode:"none",origin:Object(b.d)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this._updateDragState();const s=re.d.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,s),i.next(Object(Vt.h)(this.tool.view,Object(Oi.g)(e.renderLocation,s,Object(Oi.d)()))).next((e=>{const i=Object(Oi.q)(e.plane),r=Object(bt.a)(e.renderStart,e.renderEnd,n.origin,i),s=Vi.b.shortestSignedDiff(n.angle,r);n.angleDir=Object(J.e)(n.angleDir+s,-.3,.3),n.angle=r;const o=function(e,t){const i=Object(f.j)(re.d.get(),t.renderStart,e.origin),r=Object(f.j)(re.d.get(),t.renderEnd,e.origin),n=Object(f.p)(i),a=Object(f.p)(r);return 0===n?0:a/n}(n,e),c=o-this.adapter.scale;if(n.scaleDir=Object(J.e)(n.scaleDir+c,-.2,.2),this._onScaleChanged(),"none"===n.mode){const i=this.mode||function(e,t,i,r){const{renderStart:n,renderEnd:a}=e,s=Hi(n,r,re.d.get()),o=Hi(a,r,re.d.get());if(Object(f.l)(s,o)<100)return null;const c=Object(f.j)(re.d.get(),n,i),l=Object(f.g)(re.d.get(),c,Object(Oi.q)(t)),u=n,h=Object(f.f)(re.d.get(),u,l),d=Hi(i,r,re.d.get()),p=s,b=Hi(h,r,re.d.get()),g=Object(f.j)(re.d.get(),b,p),m=Object(f.j)(re.d.get(),s,d),O=Object(j.g)(p,g),_=Object(j.g)(d,m);return Object(j.d)(O,o)<Object(j.d)(_,o)?"rotate":"scale"}(e,e.plane,n.origin,this.tool.view.state.camera);if(Object(a.k)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}n.mode=i}}switch(n.mode){case"rotate":this.adapter.angle=n.initialAngle+r;break;case"scale":this.adapter.scale=o,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(J.n)(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:o,yScale:o})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(J.n)(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:o,yScale:o})}}"end"===e.action&&(this.startAnimation(Bi(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState())})),r.next((()=>{if(this.adapter.cancel(),Object(a.k)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(Bi(this,(()=>this._onScaleChanged()))),this._scaleRotateDragData=null,this._updateDragState()}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,r=null;const n=()=>!1;return{start:()=>{r=e.getFocused,e.getFocused=n,i=0,t()},update:e=>(i+=e,!r()||i>200?Ni.STOP:Ni.CONTINUE),destroy:()=>{e.getFocused=r,t()}}}(this,(()=>this._updateDelayedFocusedState()))):this._updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),Object(s.a)(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e))])}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(Li.DelayedFocused,this.getFocused())}_updateDragState(){if(this.ringManipulator.updateStateEnabled(Li.Unlocked,!(Object(a.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(a.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Li.ScaleIn|Li.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Li.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Li.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Li.RotateLeft|Li.RotateRight,!1),this.ringManipulator.updateStateEnabled(Li.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Li.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Li.ScaleIn|Li.ScaleOut|Li.RotateLeft|Li.RotateRight,!1)}_updateManipulatorTransform(){const e=Object(T.d)(re.a.get(),this.adapter.angle,Object(b.h)(0,0,1)),t=this.getScale(),i=Object(T.u)(re.a.get(),Object(f.w)(re.d.get(),t,t,t));this.ringManipulator.modelTransform=Object(T.m)(re.a.get(),i,e)}_createRingManipulator(){const e=(e,t,i)=>{const r=[],n=Math.ceil(128*(t-e)/(2*Math.PI));for(let a=0;a<n+1;a++){const s=e+a*(t-e)/n;r.push(Object(b.h)(i*Math.cos(s),i*Math.sin(s),0))}return r},t=t=>e(0,2*Math.PI,t),i=(e,t)=>C.a.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),r=t(Ft),n=i(r,24),a={left:[],right:[]},s=[];for(let h=0;h<2;h++){const t=h*Math.PI-Math.PI/4,r=Math.PI/2-zt,n=t+r,o=t+Math.PI/2-r,c=e(n,o,190),l=i(c,9);s.push(c),s.push(e(n,o,201)),a.left.push(l),a.right.push(l);for(let e=0;e<2;e++){const t=0===e,i=Object(S.d)();if(t){Object(T.h)(i,i,[1,-1,1]),Object(T.e)(i,i,-n,[0,0,1]);const e=Math.round(.2*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{Object(T.e)(i,i,o,[0,0,1]);const e=Math.round(.8*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const r=C.a.createExtrudedTriangle(60,0,23,.5);C.a.transformInPlace(r,i),(t?a.left:a.right).push(r)}}const o=[];for(let h=0;h<2;h++){const t=h*Math.PI-Math.PI/4,r=Math.PI/2-Ut,n=t+r,a=t+Math.PI/2-r,s=e(n,a,213);o.push(i(s,9))}const c=t(190),l=t(213),u=i(c,9),d=i(l,9),p=t(130),f=t(107),g=i(p,9),m=i(f,9),O=this._createMaterial(),_=this._createMaterial(.66),v=this._createMaterial(.5),y=this._createMaterial(.33);let j=[{geometry:n,material:O,stateMask:Li.DelayedFocused},{geometry:n,material:v,stateMask:Wt.c.None}];this.mode&&"scale"!==this.mode||(j=j.concat([{geometry:o,material:O,stateMask:Li.DelayedFocused|Li.Unlocked},{geometry:u,material:_,stateMask:Li.DelayedFocused|Li.ScaleIn},{geometry:d,material:y,stateMask:Li.DelayedFocused|Li.ScaleIn},{geometry:g,material:_,stateMask:Li.DelayedFocused|Li.ScaleOut},{geometry:m,material:y,stateMask:Li.DelayedFocused|Li.ScaleOut}])),this.mode&&"rotate"!==this.mode||(j=j.concat([{geometry:a.right,material:O,stateMask:Li.DelayedFocused|Li.Unlocked},{geometry:a.left,material:O,stateMask:Li.DelayedFocused|Li.RotateLeft},{geometry:a.right,material:O,stateMask:Li.DelayedFocused|Li.RotateRight}]));const x=[r,...s];return new jt.a({view:this.tool.view,renderObjects:j,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(h.e)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:Object(b.h)(0,0,1)}})}_createMaterial(e=1){const t=[...Dt,e];return new be.a({color:t,transparent:1!==e,cullFace:A.b.Back,renderOccluded:P.c.Transparent})}get test(){return{ringManipulator:this.ringManipulator}}}function Hi(e,t,i){return t.projectToScreen(e,Wi),Object(f.w)(i,Wi[0],Wi[1],0)}function Bi(e,t){let i=null,r=1;const n=()=>r;return{start:()=>{r=e.getScale(),i=e.getScale,e.getScale=n,t()},update:e=>(r+=((r+1)/2-r)*Math.min(3*e,1),t(),Math.abs(r-1)<.01?Ni.STOP:Ni.CONTINUE),destroy:()=>{e.getScale=i,t()}}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(Ni||(Ni={}));const Wi=Object(B.f)();var qi=i(144),Zi=i(849);function Xi(e){return Object(a.k)(e.geometry)&&"mesh"===e.geometry.type?function(e){return Object(a.k)(e.transform)?function(e,t){let i=t.clone(),r=null;return{undo:t=>{r=Object(a.k)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=Object(a.k)(e.transform)?e.transform.clone():null,e.transform=r,t.notifyGeometryChanged()}}}(e,e.transform):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:r=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,r.notifyGeometryChanged()},redo:r=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,r.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=a.o;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Yi=class extends ft.a{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove($i);const e=this.geometry.transform;if(this.scale=1,Object(a.k)(e)){const t=Object(Zi.c)(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=Object(J.g)(Object(Zi.a)(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Object(qi.e)((()=>({angle:this.angle,scale:this.scale})),(e=>this._update(e)),qi.c),$i)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return Xi(this.graphic)}_update({scale:e,angle:t}){const i=this.geometry.anchor,r=this.viewingMode===Ui.a.Global;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:i,geographic:r}),this.previousScale=e,Object(a.k)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,Object(J.n)(t-this.previousAngle),{origin:i,geographic:r}),this.previousAngle=t,Object(a.k)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged())}};Object(r.a)([Object(o.b)({constructOnly:!0})],Yi.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Yi.prototype,"geometry",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Yi.prototype,"viewingMode",void 0),Object(r.a)([Object(o.b)()],Yi.prototype,"angle",void 0),Object(r.a)([Object(o.b)()],Yi.prototype,"scale",void 0),Yi=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Yi);const $i="scale-heading-update-key";let Qi=class extends ft.a{constructor(e){super(e),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(Ki);const e=Object(a.k)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:a.o;if(this.symbol=Object(a.k)(e)?e.clone():null,this.initialSizes=[],Object(a.k)(e)){const t=this.findLayerView();Object(a.k)(t)&&(this.initialSizes=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray())}this.angle=0,Object(a.k)(e)&&e.symbolLayers.some((e=>!("object"!==e.type||!Object(a.k)(e.heading))&&(this.angle=-Object(J.g)(e.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(Object(qi.e)((()=>({angle:this.angle,scale:this.scale})),(e=>this._updateSymbol(e)),qi.c),Ki)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e,this.restart()},redo:i=>{e=i.symbol,i.symbol=t,this.restart()}}}_updateSymbol({scale:e,angle:t}){const i=this.graphic.symbol;if(Object(a.j)(this.symbol)||Object(a.j)(i)||"point-3d"!==i.type)return;const r=i.clone(),n=-Object(J.n)(t-this.initialAngle);let s=!1;this._forEachObjectSymbolLayerPair(this.symbol,r,((t,i,r)=>{const o=Object(a.t)(t.heading,0)+n;i.heading!==o&&(i.heading=o,s=!0);const c=this.initialSizes[r];if(Object(a.k)(c)&&"width"in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);const t=c.width*e;i.width!==t&&(i.width=t,s=!0);const r=c.depth*e;i.depth!==r&&(i.depth=r,s=!0);const n=c.height*e;i.height!==n&&(i.height=n,s=!0)}})),s&&(this.graphic.symbol=r)}_forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,r)=>{const n=t.symbolLayers.getItemAt(r);"object"===e.type&&"object"===n.type&&i(e,n,r)}))}};Object(r.a)([Object(o.b)()],Qi.prototype,"angle",void 0),Object(r.a)([Object(o.b)()],Qi.prototype,"scale",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Qi.prototype,"graphic",void 0),Object(r.a)([Object(o.b)()],Qi.prototype,"symbol",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Qi.prototype,"findLayerView",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Qi.prototype,"sizeFilter",void 0),Qi=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Qi);const Ki="scale-heading-update-key";let Ji=class extends(Object(ft.b)(ke.a.EventedMixin(si.a))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new li.a}initialize(){this.graphicState=new ct({graphic:this.graphic}),this.moveManipulation=new Jt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&mt(this.graphic),radius:Jt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:this.graphicState.graphic}),e.stopPropagation()}))))),this.moveManipulation.elevationInfo=Object(h.e)(this.graphic);const e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline(((t,i,r,n,s)=>(Object(a.k)(e)&&t===ti.XY&&(r=r.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new ci.a({elevationInfo:Object(h.e)(this.graphic),pointer:s,editGeometryOperations:oi.a.fromGeometry(new zi.a({spatialReference:e.spatialReference}),this.view.state.viewingMode),visualizer:new ye,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:n}),this.snappingPipeline.next)),r)),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:r,dyScreen:n}=e,a={graphic:i,dxScreen:r,dyScreen:n};switch(t){case"start":this.emit("graphic-translate-start",a),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",a);break;case"end":this.emit("graphic-translate-stop",a)}})),this.moveManipulation.angle=Object(a.k)(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(()=>this._updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new ki({tool:this,mode:e,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this._onScaleChanged())))}this.handles.add([It({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>Object(n.c)()}),this.graphicState.on("changed",(()=>this._onGeometryChanged())),this._hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this._updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((e=>{e instanceof jt.a&&this.handles.add(e.events.on("grab-changed",(()=>this._updateManipulatorsInteractive())))})),this.finishToolCreation()}_updateManipulatorsInteractive(){Object(a.j)(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}_createScaleRotateAdapter(){return Object(a.k)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Yi({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Qi({graphic:this.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer))})}_forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(a.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}_hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this._forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&mt(this.graphic)}))}_createGeometryUndoRecord(){return Xi(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=Object(a.d)(this.scaleRotate),this.scaleRotateAdapter=Object(a.d)(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this.moveManipulation.location=e,Object(a.k)(this.scaleRotate)&&(this.scaleRotate.location=e)}set elevationAlignedLocation(e){this.moveManipulation.elevationAlignedLocation=e,Object(a.k)(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){Object(a.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(Object(a.j)(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}_updateMoveAngle(){this.view.state.viewingMode===Ui.a.Local||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}_onGeometryChanged(){Object(bt.g)(this.view,this,this.graphic)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(a.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Ji.prototype,"view",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Ji.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Ji.prototype,"enableZ",void 0),Object(r.a)([Object(o.b)()],Ji.prototype,"enableRotation",void 0),Object(r.a)([Object(o.b)()],Ji.prototype,"enableScaling",void 0),Object(r.a)([Object(o.b)({value:!1})],Ji.prototype,"snapToScene",null),Object(r.a)([Object(o.b)({constructOnly:!0})],Ji.prototype,"snappingManager",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Ji.prototype,"type",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Ji.prototype,"updating",null),Ji=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Ji);var er=i(114),tr=i(219),ir=i(733),rr=(i(99),i(173)),nr=i(86),ar=i(104),sr=i(1108);let or=class extends(Object(rr.a)(nr.a)){constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(a.f)(this.position,e.position)&&this.width===e.width&&this.height===e.height}};Object(r.a)([Object(o.b)({readOnly:!0,json:{read:!1,write:!0}})],or.prototype,"type",void 0),Object(r.a)([Object(o.b)({type:zi.a}),Object(sr.a)()],or.prototype,"position",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(sr.a)(),Object(ar.a)((e=>Vi.a.normalize(Object(l.i)(e),0,!0)))],or.prototype,"heading",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(sr.a)(),Object(ar.a)((e=>Vi.a.normalize(Object(l.i)(e),0,!0)))],or.prototype,"tilt",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0}),Object(sr.a)()],or.prototype,"width",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0}),Object(sr.a)()],or.prototype,"height",void 0),or=Object(r.a)([Object(u.a)("esri.analysis.SlicePlane")],or);i(222);var cr=i(87),lr=i(543),ur=(i(584),i(526));i(746);Object(c.a)("mac"),Math.cos(Object(J.g)(45)),Math.cos(Object(J.g)(5));const hr=[1,.5,0],dr=[...hr,1],pr=[1,1,1,1],fr=[1,.8,.6,1],br=[1,.93,.86,1],gr=[...hr,1],mr=[...hr,1],Or=[...hr,1];Object(S.d)();var _r=i(210),vr=i(419),yr=i(545),jr=i(411),xr=i(713),Tr=i(434),Sr=i(501),Er=i(388),Ar=i(404),wr=i(382),Mr=i(389),Rr=i(1146),Cr=i(94),Pr=i(355);class Ir extends Ar.a{initializeProgram(e){const t=Ir.shader.get().build();return new Mr.a(e.rctx,t,wr.a)}bindPass(e,t){Object(Sr.b)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){Object(Sr.c)(this.program,e),this.program.rebindTextures()}initializePipeline(){return Object(Pr.f)({blending:Object(Pr.g)(Cr.b.ONE,Cr.b.ONE,Cr.b.ONE_MINUS_SRC_ALPHA,Cr.b.ONE_MINUS_SRC_ALPHA),depthTest:{func:Cr.h.LESS},colorWrite:Pr.c})}}Ir.shader=new Er.a(Rr.a,(()=>i.e(337).then(i.bind(null,1354))));P.b;yr.a;P.a;i(96),i(208),i(498);Object(b.f)();Object(b.f)();i(797),i(1127);var Dr=i(801),Lr=i(621),Nr=i(856),Fr=i(445),zr=i(301),Ur=i(356),Gr=i(654),Vr=i(1147);class kr extends Ar.a{initializeProgram(e){const t=kr.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,oitEnabled:i.transparencyPassType===A.i.Color,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Mr.a(e.rctx,r,wr.a)}bindPass(e,t){Object(Sr.b)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(Ur.a)(this.program,t))}bindDraw(e){Object(Sr.c)(this.program,e),Object(zr.c)(this.program,this.configuration,e),this.program.rebindTextures()}_setPipelineState(e,t){const i=this.configuration,r=e===A.i.NONE,n=e===A.i.FrontFace;return Object(Pr.f)({blending:i.output!==_r.a.Color&&i.output!==_r.a.Alpha||!i.transparent?null:r?Hr:Object(Fr.f)(e),culling:Object(Pr.b)(i.cullFace),depthTest:{func:Object(Fr.g)(e)},depthWrite:r?i.writeDepth&&Pr.d:Object(Fr.h)(e),colorWrite:Pr.c,stencilWrite:i.sceneHasOcludees?Gr.h:null,stencilTest:i.sceneHasOcludees?t?Gr.d:Gr.c:null,polygonOffset:r||n?null:Object(Fr.e)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}kr.shader=new Er.a(Vr.a,(()=>i.e(327).then(i.bind(null,1355))));const Hr=Object(Pr.h)(Cr.b.ONE,Cr.b.ONE_MINUS_SRC_ALPHA);class Br extends vr.a{constructor(){super(...arguments),this.output=_r.a.Color,this.cullFace=A.b.None,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=A.i.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(r.a)([Object(vr.b)({count:_r.a.COUNT})],Br.prototype,"output",void 0),Object(r.a)([Object(vr.b)({count:A.b.COUNT})],Br.prototype,"cullFace",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"slicePlaneEnabled",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"transparent",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"enableOffset",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"writeDepth",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"sceneHasOcludees",void 0),Object(r.a)([Object(vr.b)({count:A.i.COUNT})],Br.prototype,"transparencyPassType",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"multipassTerrainEnabled",void 0),Object(r.a)([Object(vr.b)()],Br.prototype,"cullAboveGround",void 0);class Wr extends P.b{constructor(e){super(e,Zr),this.supportsEdges=!0,this.techniqueConfig=new Br}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Fr.b,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,a,s){Object(Tr.f)(e,t,r,n,a,void 0,s)}requiresSlot(e,t){return e===jr.a.DRAPED_MATERIAL||(Object(Lr.b)(t)===_r.a.Highlight?e===jr.a.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?jr.a.TRANSPARENT_MATERIAL:jr.a.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:jr.a.OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===_r.a.Color||e.output===_r.a.Alpha||e.output===_r.a.Highlight?new qr(e):void 0}createBufferWriter(){return new xr.a(xr.d)}}class qr extends Nr.a{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(kr,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&(this._material.setParameters({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}beginSlot(e){return this._output!==_r.a.Color&&this._output!==_r.a.Alpha||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}const Zr={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:A.b.None,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...P.a};var Xr=i(1187);i(101);cr.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");var Yr;function $r(e,t){switch(t){case Yr.POSITIVE_X:return{basis:e.basis1,direction:1,position:Object(f.f)(re.d.get(),e.origin,e.basis1),edge:t};case Yr.POSITIVE_Y:return{basis:e.basis2,direction:1,position:Object(f.f)(re.d.get(),e.origin,e.basis2),edge:t};case Yr.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:Object(f.j)(re.d.get(),e.origin,e.basis1),edge:t};case Yr.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:Object(f.j)(re.d.get(),e.origin,e.basis2),edge:t}}}function Qr(e){const t=Object(f.p)(e.basis1),i=Object(f.p)(e.basis2);return.3*Math.min(t,i)}function Kr(e){return Qr(e)}function Jr(e){return 0!==e.direction[0]&&0!==e.direction[1]}function en(e,t=dn.CENTER_ON_ARROW){const i=t===dn.CENTER_ON_CALLOUT?40:0,r=[Object(b.h)(i,0,-24),Object(b.h)(i,0,24)],n=function(e,t){const i=Object(f.j)(Object(b.f)(),e[e.length-1],e[e.length-2]);if(Object(f.r)(i,i),Object(f.e)(i,i,12),Object(f.f)(i,i,e[e.length-1]),t){const t=Object(f.j)(Object(b.f)(),e[0],e[1]);return Object(f.r)(t,t),Object(f.e)(t,t,12),Object(f.f)(t,t,e[0]),[t,...e,i]}return[...e,i]}(r,!0),s=(e,t)=>function(e,t,i){const r=r=>{const n=(r?t:e).slice(0),s=Object(f.j)(re.d.get(),n[0],n[1]);Object(f.r)(s,s);const o=Object(f.j)(re.d.get(),n[n.length-1],n[n.length-2]);if(Object(f.r)(o,o),i.padding>0){const e=Object(f.e)(Object(b.f)(),o,-i.padding);if(n[n.length-1]=Object(f.f)(e,e,n[n.length-1]),i.bothEnds){const e=Object(f.e)(Object(b.f)(),s,-i.padding);n[0]=Object(f.f)(e,e,n[0])}}const c=r?i.tipFocusMultiplier:1,l=i.tipLength*(i.focusTipLength?c:1),u=i.tipRadius*c,h=Object(T.i)(re.a.get());if(i.padding>0){const e=l/4,t=Object(f.w)(re.d.get(),0,e,0),r=1+i.padding/e;Object(T.j)(h,h,t),Object(T.h)(h,h,Object(f.w)(re.d.get(),r,r,r)),Object(T.j)(h,h,Object(f.e)(t,t,-1/r))}const d=Object(T.i)(Object(S.d)()),p=Object(b.h)(0,1,0),g=Object(T.k)(Object(S.d)(),Object(lr.g)(re.b.get(),p,o));g[12]=n[n.length-1][0],g[13]=n[n.length-1][1],g[14]=n[n.length-1][2],Object(T.m)(g,g,h);const m=[{part:"tube",geometry:rn(i.tubeRadius*(r?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:d}];let O,_;if(Object(a.k)(i.flat)?O=C.a.createExtrudedTriangle(l,u,u,i.flat.thickness):(O=C.a.createConeGeometry(l,u,24,!1,!1,!0),_=C.a.createConeGeometry(l,u,24,!1,!0,!1)),m.push({part:"tip",geometry:O,transform:g}),_&&m.push({part:"cap",geometry:_,transform:g}),i.bothEnds){const e=Object(T.k)(Object(S.d)(),Object(lr.g)(re.b.get(),p,s));e[12]=n[0][0],e[13]=n[0][1],e[14]=n[0][2],Object(T.m)(e,e,h),m.push({part:"tip",geometry:O,transform:e}),_&&m.push({part:"cap",geometry:_,transform:e})}return m};return{normal:r(!1),focused:r(!0)}}(r,r,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),o=s(0,!1),c=s(2.25,!0),l=new be.a({color:pr,cullFace:A.b.Back,renderOccluded:P.c.Opaque}),u=new be.a({color:fr,cullFace:A.b.Back,renderOccluded:P.c.Opaque}),h=new be.a({color:br,cullFace:A.b.Back,renderOccluded:P.c.Opaque}),d=new be.a({color:mr,transparent:!0,writeDepth:!1,cullFace:A.b.Front,renderOccluded:P.c.Transparent}),p=C.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),g=C.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),m=new Xr.a({color:gr,renderOccluded:P.c.OccludeAndTransparent});return new jt.a({view:e,renderObjects:[...o.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?u:h,transform:i,stateMask:Wt.c.Unfocused|an}))),...c.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:Wt.c.Unfocused|an}))),{geometry:p,material:m,stateMask:Wt.c.Unfocused|an|cn},...o.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?u:h,transform:i,stateMask:Wt.c.Focused|an}))),...c.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:Wt.c.Focused|an}))),{geometry:g,material:m,stateMask:Wt.c.Focused|an|cn}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:11,state:an})}function tn(e,t){const i=Jr(t),r=i?[Object(b.h)(1,0,0),Object(b.h)(0,0,0),Object(b.h)(0,1,0)]:[Object(b.h)(1,0,0),Object(b.h)(-1,0,0)],n=C.a.createPolylineGeometry(r),a=Or,s=i?4:1,o=2*s,c=e=>e>1?(e=>new D.a({color:a,width:e,renderOccluded:P.c.OccludeAndTransparent}))(e):new Xr.a({color:a,renderOccluded:P.c.OccludeAndTransparent}),l=[{geometry:n,material:c(s),stateMask:Wt.c.Unfocused|un},{geometry:n,material:c(o),stateMask:Wt.c.Focused|un},{geometry:n,material:c(1),stateMask:hn}],u=new jt.a({view:e,renderObjects:l,collisionType:{type:"line",paths:[r]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4});return u.state=un,u}function rn(e,t,i){const r=[];if(Object(a.k)(t))r.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const n=i/t*2*Math.PI;r.push([Math.cos(n)*e,Math.sin(n)*e])}}return C.a.createPathExtrusionGeometry(r,i,[],[],!1)}function nn(e,t){return Object(ur.b)(t,e.basis2,e.basis1)+ln}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(Yr||(Yr={}));const an=Wt.b.Custom1;var sn,on;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(sn||(sn={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(on||(on={}));const cn=Wt.b.Custom2,ln=(Object(j.c)(),Math.PI/2),un=Wt.b.Custom1,hn=Wt.b.Custom2;var dn;!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(dn||(dn={}));const pn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/gAD/fAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/gAL/fgD/gAb/gAT/gwr/gQj/hA7/hAz/hxH/iBP/ixn/iRf/jBz/jR7/jyP/kCX/kyr/lS7/lCz/li//mTT/mTf/nDr/mjn/nTz/n0H/nT//oET/oEL/okf/oEX/o0r/pU3/o0v/pU//qFL/plH/qFX/qFP/qVb/q1n/rV3/rFz/rmD/rl7/sGL/rmH/tW3/s2v/tW//tW7/t3L/tnD/uHT/unb/unn/unf/vHv/vX3/v4D/vX7/w4n/xY3/xIv/x4//xY3/x5H/yZP/x5H/yJP/y5f/yZX/zZv/y5n/zZ3/zJv/z5//z6D/z6H/0aT/0KP/0qb/06j/1av/06r/1q3/1q//17H/2rb/2rb/2rj/3bz/4MH/38D/38H/4sX/4MT/48f/4sb/4sf/5Mr/5s3/5cz/5s3/59D/59D/6dT/6dP/6dT/6tb/6tX/6tf/69n/69j/7dr/7Nn/7dz/7dv/7t3/7t7/7t3/7+H/8eL/8uX/8eP/8+j/8+f/9On/8+j/9Or/9ez/9e3/9ez/9e3/9+//9+7/+PD/9+//+PH/+PD/+fL/+PH/+fT/+vX/+fT/+vb/+vX/+/b/+vb/+/j/+/j//Pr//Pn//fv//v3//vz//fz//fv//v3//fz//////v7//v3///9vf1WOAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADmklEQVR42qXXd3sUVRQG8BNDKkU3KLYUIFkLLBo0yRJNBszuuwQlGISIDUTFhljAhhUbtlXEYEcjoEJUNCqKPXZUUCDU0FvI+RpkZpa5c9iZzMzD7+/d88yde+95z5CbvIIhIyqrtbo6rboyUlKQR4GcGI7GIMSi4QHkU1bRKDgaVZRF3nKGanClDc4hD4Nq0CvtzAzqRd8L4GlkX3IVGg0fxpxMzjLOgk9hx2VkRuBbJNPh/+cjpQnezkuvcC6Q8vVseItkkKTWP6Pr17HwVkbCQFg+YJ4P3U0vtrS1t//c9u6zM+DgFLH/av+m7Gfe1IhpLf+ysmbxVBxrdD4ptvPzDvdY2trNUvfytBLlZDkdloZt3GPvPk5z8K0EpFMpJacWlmTqmdnBd1dBqMkm01BY4n+waTsb1nd0drHl/2kQSsiQpcHyKKd0MP/YfOt4AJfPWtTOKRumw04z+0MRlNV81PezoNz5JZv+boRdIemisMxkS+ck2M3rZMPHskcZ/Q/KR6y8D2HqWjbMh11/IgrDfoiU7lsgXGNW6GgQB1quYPrClk9+WnuITash3WGWfw02VUR5MUCKX3n7w8m3P1z121xIzazbMg5KLJcK4Ntl5vV4EDYhGgz/XmDdcnmWRsC/iQeM1wibYVSBAL5g3WQoF9JFCOBN1t0PpZo0BDCPdU9BqaU6BPAA65JQLglWYDbrFooCGgJ4jHXPiSUEeokvse4hKNXBtnEF624W2xiBf/GN3GP3pVCG0xAIE57+9h64uZd1bbApFpcpMXfFLuaVcLOKdS/DJiSu87UHucfhOb0+wIEmeZ0pCqWVdX+Nh5MJ61i3BDaVsqVhphkCnyaQrt68SYdvhE0pEQ2AzRI2LBuX3k1a2fAe7PoRyTU0/seGb66ANPkHNqxpEG1dBIvhvkNs2PLMWCiJ5FY27LlbBouMNsOTXWz6p/lqmK57fR2buh+HjDYVrsqCLhWmK5cuXvbZBhUVzzuGK+XUwO6J3exs5yMQLs6mlNMg3PY7O/nlBkiDyDISQv2CHXysrckEpHI5ZEmTXpUzyp+vTOx1yHLIp/icN74y927z54vuiiNNiISwc5hNub6pHoo8xNI5CCSS4T5sw/ewLZ1wNnwbnklOyuBPrJRcnKTBhzEDyVV+OTyV5x/fZ98Z5CG7RIOr2pJs8tanMApH0cI+5FP/sqoYhFhVaT8KJDdUHKkwP/8rhhWHct1+dwRTps/cplDIpwAAAABJRU5ErkJggg==";var fn=i(750);const bn={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};class gn{constructor(){this.lastDragEvent=null,this.next=new kt.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(a.k)(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=Jr(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}var mn=i(1e3),On=i(1218),_n=i(1220),vn=i(1221);function yn(e,t){return xn(e,t,!1)}function jn(e,t){return xn(e,t,!0)}function xn(e,t,i){if(e instanceof mn.b){if(e.operation instanceof On.a)return function(e,t,i=!1){const r=i?-1:1,n=Object(b.h)(r*e.dx,r*e.dy,r*e.dz);Object(f.f)(t.origin,t.origin,n)}(e.operation,t,i),!0;if(e.operation instanceof _n.a)return function(e,t,i=!1){const r=i?-e.angle:e.angle;Object(f.d)(t.basis1,t.basis1,b.c,r),Object(f.d)(t.basis2,t.basis2,b.c,r)}(e.operation,t,i),!0;if(e.operation instanceof vn.a)return function(e,t,i=!1){const r=i?1/e.factor1:e.factor1,n=i?1/e.factor2:e.factor2;Object(f.e)(t.basis1,t.basis1,r),Object(f.e)(t.basis2,t.basis2,n),Object(W.q)(t.origin,t.origin,e.origin,e.axis1,r),Object(W.q)(t.origin,t.origin,e.origin,e.axis2,n)}(e.operation,t,i),!0}return!1}let Tn=class extends(ke.a.EventedMixin(si.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new gn,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new g.a,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Object(ir.c)(),this.mapBoundsStart=Object(ir.c)(),this.displayBounds=Object(ir.c)(),this.displayBoundsStart=Object(ir.c)(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new ct({graphic:this.graphic});const e=this.graphic.geometry;this.editGeometryOperations=oi.a.fromGeometry(e,this.view.state.viewingMode),this.graphicMoveManipulation=new ni({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=en(this.view,dn.CENTER_ON_CALLOUT),this.moveZManipulator.state|=cn,this.handles.add(this.watch("enableZ",(()=>this._updateManipulatorAvailability(this.moveZManipulator,vt.TRANSLATE_Z)))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((e=>{const t=tn(this.view,e);return this.handles.add(this.watch("enableScaling",(()=>this._updateManipulatorAvailability(t,vt.SCALE)))),t.events.on("grab-changed",(e=>this._onResizeGrab(e))),this.handles.add(this._createResizeDragPipeline(t,e)),t})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=this.view.toolViewManager.textures.fromData(pn,(()=>new fn.a(pn,bn))),this.rotateManipulator=function(e,t){const i=new Wr({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:P.c.Opaque}),r=40,n=27*1.1,a=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new fe.a([[I.a.POSITION,{size:3,data:[r-e,-e,0,r+e,-e,0,r+e,e,0,r-e,e,0],exclusive:!0}],[I.a.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[I.a.POSITION,t],[I.a.UV0,t]])},s=C.a.createPolylineGeometry([[0,0,0],[13,0,0]]),o=C.a.createPolylineGeometry([[0,0,0],[r-n,0,0]]),c=new Xr.a({color:dr,renderOccluded:P.c.OccludeAndTransparent}),l=[{geometry:a(27),material:i,stateMask:Wt.c.Unfocused|an},{geometry:s,material:c,stateMask:Wt.c.Unfocused|an},{geometry:a(n),material:i,stateMask:Wt.c.Focused|an},{geometry:o,material:c,stateMask:Wt.c.Focused|an}];return new jt.a({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},collisionPriority:1,radius:13.5,state:an})}(this.view,this.rotateManipulatorTexture.texture),this.handles.add(this.watch("enableRotation",(()=>this._updateManipulatorAvailability(this.rotateManipulator,vt.ROTATE)))),this.rotateManipulator.events.on("grab-changed",(e=>{this._onRotateGrab(e)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const t=It({view:this.view,graphic:this.graphic,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>Object(n.c)()});Object(a.k)(t)&&(this.outlineVisualElement=t.visualElement instanceof Je?t.visualElement:null),Object(a.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this._updateDisplayBounds()))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",(()=>this._onGeometryChanged())),this.graphicState.watch("displaying",(()=>this._updateAllManipulatorAvailability())),Object(s.a)(this.graphicState,"isDraped",(()=>this._graphicDrapedChanged())),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.centerOnSurfaceFrequent.watch("location",(()=>this._updateDisplayBounds())));this._forEachManipulator((e=>{this.handles.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()})))}));this._forEachManipulator(((e,t)=>{this.handles.add(e.events.on("immediate-click",(e=>{t===vt.TRANSLATE_XY&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this.finishToolCreation()}_graphicDrapedChanged(){this.handles.remove(Sn),this._updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(e=>{Object(a.k)(this.attachmentOrigin)&&Object(wt.j)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this._updateDisplayBounds()})),Sn)}_updateAllManipulatorAvailability(){this._forEachManipulator(((e,t)=>this._updateManipulatorAvailability(e,t)))}_updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof jt.a){const r=this.graphicState.displaying,n=this.enableZ&&mt(this.graphic);switch(t){case vt.ROTATE:e.available=r&&this.enableRotation;break;case vt.SCALE:e.available=r&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?un:hn;break;case vt.TRANSLATE_Z:e.available=r&&n;break;default:e.available=r}}}_forEachManipulator(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((t=>e(t,vt.SCALE))),e(this.rotateManipulator,vt.ROTATE),e(this.moveZManipulator,vt.TRANSLATE_Z)}destroy(){this.mapBounds=null,this.displayBounds=null,this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],r=Object(W.f)(re.c.get(),i.leftVertex.pos,i.rightVertex.pos);Object(W.i)(r,r);const n=Object(a.t)(Object(bt.f)(this.view,this.graphic),e.extent.center);let s=An*this.view.pixelSizeAt(n);const o=this.view.spatialReference;o!==e.spatialReference&&(s*=Object(er.e)(o)/Object(er.e)(e.spatialReference)),function(e,t,i,r){r||(r=Object(ir.c)());const n=Object(W.s)(re.c.get(),e[1],-e[0]),a=Object(W.s)(re.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(W.s)(re.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=re.c.get();t.components.forEach((t=>t.vertices.forEach((t=>{const i=t.pos;Object(W.s)(o,Object(W.k)(e,i),Object(W.k)(n,i)),Object(W.w)(a,a,o),Object(W.x)(s,s,o)}))));const c=1e-6,l=Object(W.s)(re.c.get(),s[0]-a[0]<c?i/2:0,s[1]-a[1]<c?i/2:0);Object(W.f)(a,a,l),Object(W.m)(s,s,l),Object(W.g)(r.basis1,e,(s[0]-a[0])/2),Object(W.g)(r.basis2,n,(s[1]-a[1])/2),Object(W.s)(r.origin,a[0]*e[0]+a[1]*n[0],a[0]*e[1]+a[1]*n[1]),Object(W.m)(r.origin,r.origin,r.basis1),Object(W.m)(r.origin,r.origin,r.basis2)}(r,t,s,this.mapBounds)}_updateDisplayBounds(){const e=this.graphic.geometry;if(Object(a.j)(e))return;const t=Object(a.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(a.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(bt.f)(this.view,this.graphic);this.attachmentOrigin=Object(a.t)(t,e.extent.center);const i=Object(a.k)(t)?t.z:Object(se.f)(this.mapBounds.origin,this.view.elevationProvider,oe.a.fromElevationInfo(Object(h.e)(this.graphic)),this.view.renderCoordsHelper),r=Object(ir.a)(this.mapBounds);r.origin[2]=i,function(e,t,i,r=0,n){n||(n=Object(ir.c)()),t.toRenderCoords(e.origin,i,n.origin);const a=re.d.get();Object(f.f)(a,e.origin,e.basis1),Object(f.f)(a,a,e.basis2),t.toRenderCoords(a,i,a);const s=re.d.get();Object(f.f)(s,e.origin,e.basis1),Object(f.j)(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=re.d.get();Object(f.j)(o,e.origin,e.basis1),Object(f.j)(o,o,e.basis2),t.toRenderCoords(o,i,o);const c=re.d.get();Object(f.j)(c,e.origin,e.basis1),Object(f.f)(c,c,e.basis2),t.toRenderCoords(c,i,c);const l=Object(f.i)(re.d.get(),a,s,.5);Object(f.j)(l,l,n.origin);const u=Object(f.i)(re.d.get(),o,c,.5);Object(f.j)(u,n.origin,u),Object(f.i)(n.basis1,l,u,.5);const h=Object(f.i)(re.d.get(),c,a,.5);Object(f.j)(h,h,n.origin);const d=Object(f.i)(re.d.get(),s,o,.5);Object(f.j)(d,n.origin,d),Object(f.i)(n.basis2,h,d,.5);const p=Object(f.g)(re.d.get(),n.basis1,n.basis2),b=Object(f.g)(p,p,n.basis1);Object(f.r)(b,b),Object(f.e)(n.basis2,b,Object(f.h)(n.basis2,b)),Object(f.e)(n.basis1,n.basis1,1+r/Object(f.p)(n.basis1)),Object(f.e)(n.basis2,n.basis2,1+r/Object(f.p)(n.basis2)),Object(ir.k)(n)}(r,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this._updateManipulators()}get displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return En*this.view.pixelSizeAt(t)}_createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((e,t,i)=>this._applyGraphicMoveSteps(t,i)))}_createMoveZDragPipeline(){const e=this.view,t=this.editGeometryOperations.data.spatialReference;return Object(kt.e)(this.moveZManipulator,((i,r,n)=>{const a=Object(b.d)(i.renderLocation),s=r.next(Object(Vt.j)(e,a,t)).next(Object(kt.c)());this._applyGraphicMoveSteps(s,n)}))}_applyGraphicMoveSteps(e,t){const i=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},Object(ir.a)(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next(Object(kt.b)()).next(this._moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e}));return t.next((()=>{Object(a.k)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()})),i}_moveDragUpdateGeometry(){return e=>{if(Object(a.j)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const r of this.editGeometryOperations.data.components)t.push(...r.vertices);const i="start"===e.action?Ti.a.NEW_STEP:Ti.a.ACCUMULATE_STEPS;return yn(this.editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_onResizeGrab(e){if("start"!==e.action)return;const t=this._calculatePickRay(e.screenPoint);Object(Oi.m)(this.displayBounds.plane,t,re.d.get())&&(Object(ir.a)(this.displayBounds,this.displayBoundsStart),Object(ir.a)(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(e,t){return Object(kt.e)(e,((e,i,r)=>{Object(a.j)(this.inputState)||(i.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next(Object(Vt.h)(this.view,this.displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),r.next((()=>{Object(a.k)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()})))}))}_resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,r=this.displayBoundsMargin,n=this.displayBoundsMarginStart,a=Object(f.k)(re.d.get(),t.origin);Object(f.c)(a,a,t.basis1,-i[0]),Object(f.c)(a,a,t.basis2,-i[1]);const s=Object(f.j)(re.d.get(),e.renderEnd,a),o=Object(f.j)(re.d.get(),e.renderStart,a),c=Jr(e.handle),l=Kr(t),u=Kr(this.displayBounds)/l,h=(e,t)=>{if(0===e)return 1;let i=Object(f.p)(t),a=.5*e*Object(f.h)(t,s)/i;const l=a<0?-1:1;c&&(a+=(i-.5*e*Object(f.h)(t,o)/i)*l*u);const h=i<1.5*n?1:wn;return i=Math.max(i-n,wn),l>0&&(a-=r),l*Math.max(l*(a/i),h)};return{...e,factor1:h(i[0],t.basis1),factor2:h(i[1],t.basis2)}}}_resizeDragUpdateGeometry(){return e=>{const t=Object(f.k)(Object(b.f)(),this.mapBoundsStart.origin);Object(f.c)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(f.c)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(W.s)(Object(tr.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(W.i)(i,i);const r=[];for(const s of this.editGeometryOperations.data.components)r.push(...s.vertices);const n="start"===e.action?Ti.a.NEW_STEP:Ti.a.ACCUMULATE_STEPS,a=this.editGeometryOperations.scaleVertices(r,t,i,e.factor1,e.factor2,n,mn.a.REPLACE);return Object(ir.a)(this.mapBoundsStart,this.mapBounds),yn(a,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_onRotateGrab(e){if("start"!==e.action)return;const t=function(e,t,i,r){const n=t.worldUpAtPosition(e.origin,re.d.get()),a=re.d.get();switch(i){case sn.HEADING:Object(f.k)(a,n);break;case sn.TILT:Object(f.k)(a,e.basis1)}return Object(Oi.g)(e.origin,a,r)}(this.displayBounds,this.view.renderCoordsHelper,sn.HEADING,Object(Oi.d)()),i=this._calculatePickRay(e.screenPoint);Object(Oi.m)(t,i,re.d.get())&&(Object(ir.a)(this.displayBounds,this.displayBoundsStart),Object(ir.a)(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}_createRotateDragPipeline(e){return Object(kt.e)(e,((e,t,i)=>{const r=this.inputState;Object(a.j)(r)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next(Object(Vt.h)(this.view,r.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(r)).next(this._rotateDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,angle:Object(J.n)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),i.next((()=>{Object(a.k)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()})))}))}_rotateDragRenderPlaneToRotate(e){return t=>{const i=Object(Oi.q)(e.rotatePlane),r=Object(bt.a)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:r}}}_rotateDragUpdateGeometry(){return e=>{const t=Object(f.k)(Object(b.f)(),this.mapBoundsStart.origin),i=[];for(const a of this.editGeometryOperations.data.components)i.push(...a.vertices);const r="start"===e.action?Ti.a.NEW_STEP:Ti.a.ACCUMULATE_STEPS,n=this.editGeometryOperations.rotateVertices(i,t,e.rotateAngle,r,mn.a.REPLACE);return Object(ir.a)(this.mapBoundsStart,this.mapBounds),yn(n,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}_calculatePickRay(e){const t=Object(j.c)(),i=Object(B.i)(e);return Object(Dr.b)(this.view.state.camera,i,t),Object(f.r)(t.direction,t.direction),t}_updateManipulators(){if(!this.visible)return;const e=function(e,t){return Object(bt.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,re.a.get());(function(e,t,i,r){const n=r.worldUpAtPosition(i.origin,re.d.get()),a=$r(i,Yr.POSITIVE_X),s=Object(T.b)(re.a.get(),a.edge*Math.PI/2);Object(T.r)(s,s,-nn(i,n)),Object(T.m)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach(((t,i)=>{!function(e,t,i,r){const n=Object(f.p)(r.basis1),a=Object(f.p)(r.basis2),s=Qr(r),o=Kr(r),c=Object(f.w)(re.d.get(),0,0,0);Object(f.f)(c,Object(f.e)(re.d.get(),r.basis1,t.direction[0]),Object(f.e)(re.d.get(),r.basis2,t.direction[1])),Object(f.f)(c,r.origin,c);let l=0,u=1;if(Jr(t))1===t.direction[0]&&-1===t.direction[1]?l=ln:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),u=o;else{const e=0!==t.direction[0]?1:2;l=1===e?ln:0,u=(1===e?a:n)-s}const h=Object(T.b)(re.a.get(),l);Object(T.h)(h,h,Object(f.w)(re.d.get(),u,u,u)),Object(T.m)(h,i,h),h[12]=0,h[13]=0,h[14]=0,e.modelTransform=h,e.renderLocation=c}(t,this.resizeHandles[i],e,this.displayBounds)}))}_updateZMoveHandle(e,t){const i=this.displayBounds,r={basis:i.basis1,direction:-1,position:Object(f.j)(re.d.get(),i.origin,i.basis1),edge:2},n=re.a.get();Object(T.g)(n,t,r.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=r.position}_cancel(){const e=this.editGeometryOperations.lastOperation;Object(a.j)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,jn(e,this.mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if(Object(a.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,jn(Object(a.s)(e),this.mapBounds),this._updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,yn(Object(a.s)(e),this.mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Tn.prototype,"view",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Tn.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Tn.prototype,"enableZ",void 0),Object(r.a)([Object(o.b)()],Tn.prototype,"enableRotation",void 0),Object(r.a)([Object(o.b)()],Tn.prototype,"enableScaling",void 0),Object(r.a)([Object(o.b)()],Tn.prototype,"preserveAspectRatio",null),Object(r.a)([Object(o.b)()],Tn.prototype,"grabbing",void 0),Object(r.a)([Object(o.b)()],Tn.prototype,"inputState",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Tn.prototype,"type",void 0),Tn=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Tn);const Sn="draped-elevation-changes",En=10,An=80,wn=1e-6},139:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"}(r||(r={}))},163:function(e,t,i){"use strict";var r,n,a,s,o,c,l,u,h,d,p,f,b,g;i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return l})),i.d(t,"i",(function(){return s})),i.d(t,"j",(function(){return u})),i.d(t,"k",(function(){return f})),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(a||(a={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(s||(s={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(o||(o={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(c||(c={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(l||(l={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(u||(u={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(h||(h={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(d||(d={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(p||(p={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(f||(f={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(b||(b={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(g||(g={}))},188:function(e,t,i){"use strict";function r(){return new Float32Array(2)}function n(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function a(){return r()}function s(){return n(1,1)}function o(){return n(1,0)}function c(){return n(0,1)}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const l=a(),u=s(),h=o(),d=c();Object.freeze({__proto__:null,create:r,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:n,createView:function(e,t){return new Float32Array(e,t,2)},zeros:a,ones:s,unitX:o,unitY:c,ZEROS:l,ONES:u,UNIT_X:h,UNIT_Y:d})},210:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"}(r||(r={}))},233:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return n})),i.d(t,"g",(function(){return O})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return f})),i.d(t,"j",(function(){return l})),i.d(t,"k",(function(){return b})),i.d(t,"l",(function(){return h})),i.d(t,"m",(function(){return a})),i.d(t,"n",(function(){return o}));var r=i(189);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e,t,i,r,n,a,s,o,c,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=c,e[8]=l,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function o(e,t){if(e===t){const i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function c(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],u=t[8],h=u*s-o*l,d=-u*a+o*c,p=l*a-s*c;let f=i*h+r*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-u*r+n*l)*f,e[2]=(o*r-n*s)*f,e[3]=d*f,e[4]=(u*i-n*c)*f,e[5]=(-o*i+n*a)*f,e[6]=p*f,e[7]=(-l*i+r*c)*f,e[8]=(s*i-r*a)*f,e):null}function l(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=i[0],p=i[1],f=i[2],b=i[3],g=i[4],m=i[5],O=i[6],_=i[7],v=i[8];return e[0]=d*r+p*s+f*l,e[1]=d*n+p*o+f*u,e[2]=d*a+p*c+f*h,e[3]=b*r+g*s+m*l,e[4]=b*n+g*o+m*u,e[5]=b*a+g*c+m*h,e[6]=O*r+_*s+v*l,e[7]=O*n+_*o+v*u,e[8]=O*a+_*c+v*h,e}function u(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=c,e[6]=d*r+p*s+l,e[7]=d*n+p*o+u,e[8]=d*a+p*c+h,e}function h(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*s,e[1]=p*n+d*o,e[2]=p*a+d*c,e[3]=p*s-d*r,e[4]=p*o-d*n,e[5]=p*c-d*a,e[6]=l,e[7]=u,e[8]=h,e}function d(e,t,i){const r=i[0],n=i[1],a=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=a*t[6],e[7]=a*t[7],e[8]=a*t[8],e}function p(e,t,i){const r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e}function f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function b(e,t){const i=t[0],r=t[1],n=t[2],a=t[4],s=t[5],o=t[6],c=t[8],l=t[9],u=t[10],h=u*s-o*l,d=-u*a+o*c,p=l*a-s*c,f=i*h+r*d+n*p;if(!f)return null;const b=1/f;return e[0]=h*b,e[1]=(-u*r+n*l)*b,e[2]=(o*r-n*s)*b,e[3]=d*b,e[4]=(u*i-n*c)*b,e[5]=(-o*i+n*a)*b,e[6]=p*b,e[7]=(-l*i+r*c)*b,e[8]=(s*i-r*a)*b,e}function g(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],b=t[13],g=t[14],m=t[15],O=i*o-r*s,_=i*c-n*s,v=i*l-a*s,y=r*c-n*o,j=r*l-a*o,x=n*l-a*c,T=u*b-h*f,S=u*g-d*f,E=u*m-p*f,A=h*g-d*b,w=h*m-p*b,M=d*m-p*g;let R=O*M-_*w+v*A+y*E-j*S+x*T;return R?(R=1/R,e[0]=(o*M-c*w+l*A)*R,e[1]=(c*E-s*M-l*S)*R,e[2]=(s*w-o*E+l*T)*R,e[3]=(n*w-r*M-a*A)*R,e[4]=(i*M-n*E+a*S)*R,e[5]=(r*E-i*w-a*T)*R,e[6]=(b*x-g*j+m*y)*R,e[7]=(g*v-f*x-m*_)*R,e[8]=(f*j-b*v+m*O)*R,e):null}function m(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function O(e){const t=r.a,i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=e[6],u=e[7],h=e[8];return Math.abs(1-(i*i+s*s+l*l))<=t&&Math.abs(1-(n*n+o*o+u*u))<=t&&Math.abs(1-(a*a+c*c+h*h))<=t}const _=l,v=m;Object.freeze({__proto__:null,fromMat4:n,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:a,identity:s,transpose:o,invert:c,adjoint:function(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],u=t[8];return e[0]=s*u-o*l,e[1]=n*l-r*u,e[2]=r*o-n*s,e[3]=o*c-a*u,e[4]=i*u-n*c,e[5]=n*a-i*o,e[6]=a*l-s*c,e[7]=r*c-i*l,e[8]=i*s-r*a,e},determinant:function(e){const t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8];return t*(l*a-s*c)+i*(-l*n+s*o)+r*(c*n-a*o)},multiply:l,translate:u,rotate:h,scale:d,scaleByVec2:p,fromTranslation:f,fromRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,c=n+n,l=i*s,u=r*s,h=r*o,d=n*s,p=n*o,f=n*c,b=a*s,g=a*o,m=a*c;return e[0]=1-h-f,e[3]=u-m,e[6]=d+g,e[1]=u+m,e[4]=1-l-f,e[7]=p-b,e[2]=d-g,e[5]=p+b,e[8]=1-l-h,e},normalFromMat4Legacy:b,normalFromMat4:g,projection:function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},subtract:m,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){const i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=t[0],p=t[1],f=t[2],b=t[3],g=t[4],m=t[5],O=t[6],_=t[7],v=t[8];return Math.abs(i-d)<=r.a*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-p)<=r.a*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-f)<=r.a*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-b)<=r.a*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(o-g)<=r.a*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(c-m)<=r.a*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(l-O)<=r.a*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(u-_)<=r.a*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(h-v)<=r.a*Math.max(1,Math.abs(h),Math.abs(v))},isOrthoNormal:O,mul:_,sub:v})},240:function(e,t,i){"use strict";function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function s(){return r()}function o(){return a(1,1,1,1)}function c(){return a(1,0,0,0)}function l(){return a(0,1,0,0)}function u(){return a(0,0,1,0)}function h(){return a(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const d=s(),p=o(),f=c(),b=l(),g=u(),m=h();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:function(e,t){return new Float32Array(e,t,4)},zeros:s,ones:o,unitX:c,unitY:l,unitZ:u,unitW:h,ZEROS:d,ONES:p,UNIT_X:f,UNIT_Y:b,UNIT_Z:g,UNIT_W:m})},278:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return o})),i.d(t,"i",(function(){return c}));var r=i(151),n=(i(219),i(271),i(257));Object(n.e)();class a{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function s(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new a(t)}function o(e,t,i,r){let n,a=(i[0]-e[0])/t[0],s=(r[0]-e[0])/t[0];a>s&&(n=a,a=s,s=n);let o=(i[1]-e[1])/t[1],c=(r[1]-e[1])/t[1];if(o>c&&(n=o,o=c,c=n),a>c||o>s)return!1;o>a&&(a=o),c<s&&(s=c);let l=(i[2]-e[2])/t[2],u=(r[2]-e[2])/t[2];return l>u&&(n=l,l=u,u=n),!(a>u||l>s)&&(u<s&&(s=u),!(s<0))}function c(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function l(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function u(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function h(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function d(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function p(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function f(e,t,i,n,a){const s=e;0===e[11]?(n[0]=2/(t*s[0]),n[1]=2/(i*s[5]),n[2]=(1+s[12])/s[0],n[3]=(1+s[13])/s[5],Object(r.s)(a,0,1)):(n[0]=-2/(t*s[0]),n[1]=-2/(i*s[5]),n[2]=(1-s[8])/s[0],n[3]=(1-s[9])/s[5],Object(r.s)(a,1,0))}},279:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t,i,r,n,a=!1,s=0){this.name=e,this.count=t,this.type=i,this.offset=r,this.stride=n,this.normalized=a,this.divisor=s}}},297:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const r=i(87).a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class n{constructor(){this.includedModules=new Map}include(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&r.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))}}class a extends n{constructor(){super(...arguments),this.vertex=new c,this.fragment=new c,this.attributes=new l,this.varyings=new u,this.extensions=new h,this.constants=new d}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),n="vertex"===e?this.vertex:this.fragment,a=n.uniforms.generateSource(),s=n.code.generateSource(),o="vertex"===e?f:p,c=this.constants.generateSource().concat(n.constants.generateSource());return`\n${t.join("\n")}\n\n${o}\n\n${c.join("\n")}\n\n${a.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`}}class s{constructor(){this._entries=new Map}add(e,t,i){const r=`${e}_${t}_${i}`;return this._entries.set(r,{name:e,type:t,arraySize:i}),this}generateSource(){return Array.from(this._entries.values()).map((e=>`uniform ${e.type} ${e.name}${(e=>e?`[${e}]`:"")(e.arraySize)};`))}get entries(){return Array.from(this._entries.values())}}class o{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class c extends n{constructor(){super(...arguments),this.uniforms=new s,this.code=new o,this.constants=new d}get builder(){return this}}class l{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class h{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?h.ALLOWLIST_VERTEX:h.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}h.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],h.ALLOWLIST_VERTEX=[];class d{constructor(){this._entries=[]}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=d._numberToFloatStr(i);break;case"int":r=d._numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${d._numberToFloatStr(i[0])},                            ${d._numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${d._numberToFloatStr(i[0])},                            ${d._numberToFloatStr(i[1])},                            ${d._numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${d._numberToFloatStr(i[0])},                            ${d._numberToFloatStr(i[1])},                            ${d._numberToFloatStr(i[2])},                            ${d._numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${d._numberToIntStr(i[0])},                             ${d._numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${d._numberToIntStr(i[0])},                             ${d._numberToIntStr(i[1])},                             ${d._numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${d._numberToIntStr(i[0])},                             ${d._numberToIntStr(i[1])},                             ${d._numberToIntStr(i[2])},                             ${d._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,(e=>d._numberToFloatStr(e))).join(", ")})`}return this._entries.push(`const ${t} ${e} = ${r};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const p="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",f="precision highp float;\nprecision highp sampler2D;"},301:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return u}));var r=i(85),n=i(147),a=i(200),s=i(117),o=i(109),c=i(126);function l(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const i=c.a`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=c.a`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.sliceHighlightDisabled?c.a`#define highlightSlice(_color_, _pos_) (_color_)`:c.a`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}else{const i=c.a`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i)}}function u(e,t,i){h(e,t,i.slicePlane,{origin:i.origin})}function h(e,t,i,a){if(t.slicePlaneEnabled)if(Object(r.k)(i)){if(Object(s.k)(d,i.origin),Object(s.k)(p,i.basis1),Object(s.k)(f,i.basis2),Object(r.k)(a)&&Object(r.k)(a.origin)&&Object(s.j)(d,i.origin,a.origin),Object(r.k)(a)&&Object(r.k)(a.view)){const e=Object(r.k)(a.origin)?Object(n.j)(b,a.view,a.origin):a.view;Object(s.f)(p,p,d),Object(s.f)(f,f,d),Object(s.q)(d,d,e),Object(s.q)(p,p,e),Object(s.q)(f,f,e),Object(s.j)(p,p,d),Object(s.j)(f,f,d)}e.setUniform3fv("slicePlaneOrigin",d),e.setUniform3fv("slicePlaneBasis1",p),e.setUniform3fv("slicePlaneBasis2",f)}else e.setUniform3fv("slicePlaneBasis1",o.c),e.setUniform3fv("slicePlaneBasis2",o.c),e.setUniform3fv("slicePlaneOrigin",o.c)}const d=Object(o.f)(),p=Object(o.f)(),f=Object(o.f)(),b=Object(a.d)()},335:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return r}));var r,n,a=i(85),s=i(560),o=i(544),c=i(382),l=i(434);class u extends s.a{constructor(e,t){super(),this.type=o.a.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=c.a,this._parameters=Object(l.c)(e,t),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e){Object(l.h)(this._parameters,e)&&(this.validateParameters(this._parameters),this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!=(this.renderOccluded&e.renderOccludedMask)}isVisibleInPass(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(a.k)(this.repository)&&this.repository.materialChanged(this)}}(n=r||(r={}))[n.Occlude=1]="Occlude",n[n.Transparent=2]="Transparent",n[n.OccludeAndTransparent=4]="OccludeAndTransparent",n[n.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",n[n.Opaque=16]="Opaque";const h={renderOccluded:r.Occlude}},339:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c}));var r,n,a=i(82),s=i(85);function o(e,t,i={}){const r=c(e);for(;r.length>1;){const e=l(t,r.shift(),i);if(Object(s.k)(e))return e}return function(e,t,i={}){if(!window.WebGLRenderingContext)return u(e,h),null;const r=l(e,t,i);return Object(s.j)(r)&&u(e,d),r}(t,r.shift(),i)}function c(e){const t=Object(a.a)("esri-force-webgl");if(t===r.WEBGL1||t===r.WEBGL2)return[t];switch(e){case"2d":return[r.WEBGL1];case"3d":return[r.WEBGL2,r.WEBGL1]}}function l(e,t,i={}){const n=t===r.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let a=null;for(const r of n){try{a=e.getContext(r,i)}catch(s){}if(a)break}return a}function u(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(n=r||(r={}))[n.WEBGL1=1]="WEBGL1",n[n.WEBGL2=2]="WEBGL2";const h='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',d='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},355:function(e,t,i){"use strict";i.d(t,"a",(function(){return G})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return v})),i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return a}));var r=i(163),n=i(94);function a(e,t,i=n.c.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function s(e,t,i,r,a=n.c.ADD,s=n.c.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:a,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const o={face:n.n.BACK,mode:n.j.CCW},c={face:n.n.FRONT,mode:n.j.CCW},l=e=>e===r.b.Back?o:e===r.b.Front?c:null,u={zNear:0,zFar:1},h={r:!0,g:!0,b:!0,a:!0};function d(e){return x.intern(e)}function p(e){return S.intern(e)}function f(e){return A.intern(e)}function b(e){return M.intern(e)}function g(e){return C.intern(e)}function m(e){return I.intern(e)}function O(e){return L.intern(e)}function _(e){return F.intern(e)}function v(e){return U.intern(e)}class y{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function j(e){return"["+e.join(",")+"]"}const x=new y(T,(e=>({__tag:"Blending",...e})));function T(e){return e?j([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const S=new y(E,(e=>({__tag:"Culling",...e})));function E(e){return e?j([e.face,e.mode]):null}const A=new y(w,(e=>({__tag:"PolygonOffset",...e})));function w(e){return e?j([e.factor,e.units]):null}const M=new y(R,(e=>({__tag:"DepthTest",...e})));function R(e){return e?j([e.func]):null}const C=new y(P,(e=>({__tag:"StencilTest",...e})));function P(e){return e?j([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const I=new y(D,(e=>({__tag:"DepthWrite",...e})));function D(e){return e?j([e.zNear,e.zFar]):null}const L=new y(N,(e=>({__tag:"ColorWrite",...e})));function N(e){return e?j([e.r,e.g,e.b,e.a]):null}const F=new y(z,(e=>({__tag:"StencilWrite",...e})));function z(e){return e?j([e.mask]):null}const U=new y((function(e){return e?j([T(e.blending),E(e.culling),w(e.polygonOffset),R(e.depthTest),P(e.stencilTest),D(e.depthWrite),N(e.colorWrite),z(e.stencilWrite)]):null}),(e=>({blending:d(e.blending),culling:p(e.culling),polygonOffset:f(e.polygonOffset),depthTest:b(e.depthTest),stencilTest:g(e.stencilTest),depthWrite:m(e.depthWrite),colorWrite:O(e.colorWrite),stencilWrite:_(e.stencilWrite)})));class G{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}},356:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i(126);function n(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(r.a`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function a(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}},358:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return s})),i.d(t,"g",(function(){return o})),i.d(t,"h",(function(){return c})),i.d(t,"i",(function(){return l}));var r=i(189);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function a(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5];let c=i*a-r*n;return c?(c=1/c,e[0]=a*c,e[1]=-r*c,e[2]=-n*c,e[3]=i*c,e[4]=(n*o-a*s)*c,e[5]=(r*s-i*o)*c,e):null}function s(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=i[0],u=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*l+a*u,e[1]=n*l+s*u,e[2]=r*h+a*d,e[3]=n*h+s*d,e[4]=r*p+a*f+o,e[5]=n*p+s*f+c,e}function o(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=Math.sin(i),u=Math.cos(i);return e[0]=r*u+a*l,e[1]=n*u+s*l,e[2]=r*-l+a*u,e[3]=n*-l+s*u,e[4]=o,e[5]=c,e}function c(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=i[0],u=i[1];return e[0]=r*l,e[1]=n*l,e[2]=a*u,e[3]=s*u,e[4]=o,e[5]=c,e}function l(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=i[0],u=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=r*l+a*u+o,e[5]=n*l+s*u+c,e}function u(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function h(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function p(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}const f=s,b=p;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:n,set:function(e,t,i,r,n,a,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=s,e},invert:a,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:s,rotate:o,scale:c,translate:l,fromRotation:u,fromScaling:h,fromTranslation:d,str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},subtract:p,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=t[0],u=t[1],h=t[2],d=t[3],p=t[4],f=t[5];return Math.abs(i-l)<=r.a*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-u)<=r.a*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-h)<=r.a*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-d)<=r.a*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=r.a*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-f)<=r.a*Math.max(1,Math.abs(c),Math.abs(f))},mul:f,sub:b})},359:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r,n,a,s={exports:{}};r=s,n=function(){function e(e,i,n){n=n||2;var a,s,o,l,u,h,d,p=i&&i.length,f=p?i[0]*n:e.length,b=t(e,0,f,n,!0),g=[];if(!b||b.next===b.prev)return g;if(p&&(b=c(e,i,b,n)),e.length>80*n){a=o=e[0],s=l=e[1];for(var m=n;m<f;m+=n)(u=e[m])<a&&(a=u),(h=e[m+1])<s&&(s=h),u>o&&(o=u),h>l&&(l=h);d=0!==(d=Math.max(o-a,l-s))?1/d:0}return r(b,g,n,a,s,d),g}function t(e,t,i,r,n){var a,s;if(n===w(e,t,i,r)>0)for(a=t;a<i;a+=r)s=S(a,e[a],e[a+1],s);else for(a=i-r;a>=t;a-=r)s=S(a,e[a],e[a+1],s);if(s&&_(s,s.next)){var o=s.next;E(s),s=o}return s}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==O(r.prev,r,r.next))r=r.next;else{var n=r.prev;if(E(r),(r=t=n)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,c,l,u,h,d){if(e){!d&&h&&p(e,l,u,h);for(var f,b,g=e;e.prev!==e.next;)if(f=e.prev,b=e.next,h?a(e,l,u,h):n(e))t.push(f.i/c),t.push(e.i/c),t.push(b.i/c),E(e),e=b.next,g=b.next;else if((e=b)===g){d?1===d?r(e=s(i(e),t,c),t,c,l,u,h,2):2===d&&o(e,t,c,l,u,h):r(i(e),t,c,l,u,h,1);break}}}function n(e){var t=e.prev,i=e,r=e.next;if(O(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(g(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&O(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,i,r){var n=e.prev,a=e,s=e.next;if(O(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,c=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,u=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,h=f(o,c,t,i,r),d=f(l,u,t,i,r),p=e.prevZ,b=e.nextZ;p&&p.z>=h&&b&&b.z<=d;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&O(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,b!==e.prev&&b!==e.next&&g(n.x,n.y,a.x,a.y,s.x,s.y,b.x,b.y)&&O(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&g(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&O(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;b&&b.z<=d;){if(b!==e.prev&&b!==e.next&&g(n.x,n.y,a.x,a.y,s.x,s.y,b.x,b.y)&&O(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function s(e,t,r){var n=e;do{var a=n.prev,s=n.next.next;!_(a,s)&&v(a,n,n.next,s)&&x(a,s)&&x(s,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(s.i/r),E(n),E(n.next),n=e=s),n=n.next}while(n!==e);return i(n)}function o(e,t,n,a,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&m(c,l)){var u=T(c,l);return c=i(c,c.next),u=i(u,u.next),r(c,t,n,a,s,o),void r(u,t,n,a,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,r,n,a){var s,o,c,u=[];for(s=0,o=r.length;s<o;s++)(c=t(e,r[s]*a,s<o-1?r[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),u.push(b(c));for(u.sort(l),s=0;s<u.length;s++)n=i(n=h(u[s],n),n.next);return n}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function h(e,t){var r=function(e,t){var i,r=t,n=e.x,a=e.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>s){if(s=o,o===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,u=i.x,h=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&g(a<h?n:s,a,u,h,a<h?s:n,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(n-r.x),x(r,e)&&(c<p||c===p&&(r.x>i.x||r.x===i.x&&d(i,r)))&&(i=r,p=c)),r=r.next}while(r!==l);return i}(e,t);if(!r)return t;var n=T(r,e),a=i(r,r.next);let s=u(n);return i(s,s.next),a=u(a),u(t===r?a:t)}function d(e,t){return O(e.prev,e,t.prev)<0&&O(t.next,e,e.next)<0}function p(e,t,i,r){var n=e;do{null===n.z&&(n.z=f(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,a,s,o,c,l=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ);t++);for(c=l;o>0||c>0&&r;)0!==o&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,l*=2}while(s>1)}(n)}function f(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function b(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function g(e,t,i,r,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(r-o)-(i-s)*(t-o)>=0&&(i-s)*(a-o)-(n-s)*(r-o)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&v(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(O(e.prev,e,t.prev)||O(e,t.prev,t))||_(e,t)&&O(e.prev,e,e.next)>0&&O(t.prev,t,t.next)>0)}function O(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,i,r){var n=j(O(e,t,i)),a=j(O(e,t,r)),s=j(O(i,r,e)),o=j(O(i,r,t));return n!==a&&s!==o||!(0!==n||!y(e,i,t))||!(0!==a||!y(e,r,t))||!(0!==s||!y(i,e,r))||!(0!==o||!y(i,t,r))}function y(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function j(e){return e>0?1:e<0?-1:0}function x(e,t){return O(e.prev,e,e.next)<0?O(e,t,e.next)>=0&&O(e,e.prev,t)>=0:O(e,t,e.prev)<0||O(e,e.next,t)<0}function T(e,t){var i=new A(e.i,e.x,e.y),r=new A(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function S(e,t,i,r){var n=new A(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function w(e,t,i,r){for(var n=0,a=t,s=i-r;a<i;a+=r)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}return e.deviation=function(e,t,i,r){var n=t&&t.length,a=n?t[0]*i:e.length,s=Math.abs(w(e,0,a,i));if(n)for(var o=0,c=t.length;o<c;o++){var l=t[o]*i,u=o<c-1?t[o+1]*i:e.length;s-=Math.abs(w(e,l,u,i))}var h=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,p=r[o+1]*i,f=r[o+2]*i;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)i.vertices.push(e[n][a][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},e},void 0!==(a=n())&&(r.exports=a);const o=s.exports},382:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(139);const n=new Map([[r.a.POSITION,0],[r.a.NORMAL,1],[r.a.UV0,2],[r.a.COLOR,3],[r.a.SIZE,4],[r.a.TANGENT,4],[r.a.AUXPOS1,5],[r.a.SYMBOLCOLOR,5],[r.a.AUXPOS2,6],[r.a.FEATUREATTRIBUTE,6],[r.a.INSTANCEFEATUREATTRIBUTE,6],[r.a.INSTANCECOLOR,7],[r.a.MODEL,8],[r.a.MODELNORMAL,12],[r.a.MODELORIGINHI,11],[r.a.MODELORIGINLO,15]])},388:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},389:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(85),n=i(212),a=i(493);class s{constructor(e,t,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new n.a({deallocator:null}),this._glProgram=e.programCache.acquire(t.generateSource("vertex"),t.generateSource("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this._fragmentUniforms=Object(a.b)()?t.fragmentUniforms.entries:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t){this._glProgram.setUniform1f(e,t)}setUniform1fv(e,t){this._glProgram.setUniform1fv(e,t)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2f(e,t,i){this._glProgram.setUniform2f(e,t,i)}setUniform2fv(e,t){this._glProgram.setUniform2fv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3f(e,t,i,r){this._glProgram.setUniform3f(e,t,i,r)}setUniform3fv(e,t){this._glProgram.setUniform3fv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4f(e,t,i,r,n){this._glProgram.setUniform4f(e,t,i,r,n)}setUniform4fv(e,t){this._glProgram.setUniform4fv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}setUniformMatrix3fv(e,t){this._glProgram.setUniformMatrix3fv(e,t)}setUniformMatrix4fv(e,t){this._glProgram.setUniformMatrix4fv(e,t)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(r.j)(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let i=this._textures.get(t);return null==i?(i=this._allocTextureUnit(e),this._textures.set(t,i)):i.texture=e,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(e,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),Object(r.k)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},397:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s}));var r=i(126),n=i(163);const a=.1,s=.001;function o(e,t){const i=e.fragment;switch(t.alphaDiscardMode){case n.a.Blend:i.code.add(r.a`
        #define discardOrAdjustAlpha(color) { if (color.a < ${r.a.float(s)}) { discard; } }
      `);break;case n.a.Opaque:i.code.add(r.a`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case n.a.Mask:i.uniforms.add("textureAlphaCutoff","float"),i.code.add(r.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case n.a.MaskBlend:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(r.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},404:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(85),n=i(94);class a{constructor(e,t,i){this.release=i,t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}destroy(){this._program=Object(r.e)(this._program),this._pipeline=this._config=null}reload(e){Object(r.e)(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}get program(){return this._program}get key(){return this._config.key}get configuration(){return this._config}bindPass(e,t){}bindMaterial(e,t){}bindDraw(e){}bindPipelineState(e,t=null,i){e.setPipelineState(this.getPipelineState(t,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return n.r.TRIANGLES}getPipelineState(e,t){return this._pipeline}}},410:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(500),n=i(126);function a(e){e.include(r.a),e.code.add(n.a`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},411:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.OPAQUE_PLUGIN=3]="OPAQUE_PLUGIN",e[e.TRANSPARENT_MATERIAL=4]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_PLUGIN=5]="TRANSPARENT_PLUGIN",e[e.TRANSPARENT_TERRAIN=6]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=7]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=8]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=9]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=10]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=11]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=12]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=13]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=14]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=15]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=16]="HUD_MATERIAL",e[e.LABEL_MATERIAL=17]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=18]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=19]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=20]="DRAPED_MATERIAL",e[e.DRAPED_WATER=21]="DRAPED_WATER",e[e.VOXEL=22]="VOXEL",e[e.MAX_SLOTS=23]="MAX_SLOTS"}(r||(r={}))},419:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));class r{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function n(e={}){return(t,i)=>{var r,n;t._parameterNames=null!=(r=t._parameterNames)?r:[],t._parameterNames.push(i);const a=t._parameterNames.length-1,s=e.count||2,o=Math.ceil(Math.log2(s)),c=null!=(n=t._parameterBits)?n:[0];let l=0;for(;c[l]+o>16;)l++,l>=c.length&&c.push(0);t._parameterBits=c;const u=c[l],h=(1<<o)-1<<u;c[l]+=o,Object.defineProperty(t,i,{get(){return this[a]},set(e){if(this[a]!==e&&(this[a]=e,this._keyDirty=!0,this._parameterBits[l]=this._parameterBits[l]&~h|+e<<u&h,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}},420:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i(257),n=i(126);const a=Object(r.g)(1,1,0,1),s=Object(r.g)(1,0,1,1);function o(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",a).add("unoccludedHighlightFlag","vec4",s),e.fragment.code.add(n.a`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function c(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}},421:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return G})),i.d(t,"d",(function(){return B})),i.d(t,"e",(function(){return N})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return m})),i.d(t,"h",(function(){return O})),i.d(t,"i",(function(){return _})),i.d(t,"j",(function(){return w})),i.d(t,"k",(function(){return P})),i.d(t,"l",(function(){return T})),i.d(t,"m",(function(){return p})),i.d(t,"n",(function(){return y})),i.d(t,"o",(function(){return V})),i.d(t,"p",(function(){return W})),i.d(t,"q",(function(){return F})),i.d(t,"r",(function(){return M})),i.d(t,"s",(function(){return I})),i.d(t,"t",(function(){return S})),i.d(t,"u",(function(){return f})),i.d(t,"v",(function(){return j})),i.d(t,"w",(function(){return k})),i.d(t,"x",(function(){return q})),i.d(t,"y",(function(){return z})),i.d(t,"z",(function(){return R})),i.d(t,"A",(function(){return D})),i.d(t,"B",(function(){return E})),i.d(t,"C",(function(){return b})),i.d(t,"D",(function(){return x})),i.d(t,"E",(function(){return H})),i.d(t,"F",(function(){return Z})),i.d(t,"G",(function(){return U})),i.d(t,"H",(function(){return C})),i.d(t,"I",(function(){return L})),i.d(t,"J",(function(){return A}));class r{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=9;const a=this.TypedArrayConstructor;void 0===r&&(r=9*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;for(let o=0;o<9;++o)r[a++]=n[s++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=9;class n{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=16;const a=this.TypedArrayConstructor;void 0===r&&(r=16*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;for(let o=0;o<16;++o)r[a++]=n[s++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class a{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=1;const a=this.TypedArrayConstructor;void 0===r&&(r=a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=1;var s=i(151);class o{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=2;const a=this.TypedArrayConstructor;void 0===r&&(r=2*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(s.s)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=2;var c=i(117);class l{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=3;const a=this.TypedArrayConstructor;void 0===r&&(r=3*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(c.w)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}l.ElementCount=3;var u=i(271);class h{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=4;const a=this.TypedArrayConstructor;void 0===r&&(r=4*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(u.l)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a++]=n[s++],r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}h.ElementCount=4;class d extends a{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends o{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends l{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class b extends h{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f32";class g extends r{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class m extends r{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f64";class O extends n{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="f32";class _ extends n{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class v extends a{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f64";class y extends o{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class j extends l{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="f64";class x extends h{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class T extends a{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u8";class S extends o{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class E extends l{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class A extends h{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u8";class w extends a{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="u16";class M extends o{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u16";class R extends l{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u16";class C extends h{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u16";class P extends a{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u32";class I extends o{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class D extends l{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class L extends h{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="u32";class N extends a{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="i8";class F extends o{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class z extends l{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="i8";class U extends h{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i8";class G extends a{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class V extends o{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i16";class k extends l{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i16";class H extends h{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i16";class B extends a{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i32";class W extends o{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class q extends l{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class Z extends h{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32"},434:function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return S})),i.d(t,"d",(function(){return j})),i.d(t,"e",(function(){return A})),i.d(t,"f",(function(){return f})),i.d(t,"g",(function(){return O})),i.d(t,"h",(function(){return E})),i.d(t,"i",(function(){return x}));var r=i(116),n=i(85),a=i(117),s=i(109),o=i(223),c=i(163),l=i(768),u=i(278),h=i(139),d=i(513);const p=Object(o.f)();function f(e,t,i,r,n,a,s){if(!Object(d.d)(t))if(e.boundingInfo){Object(u.a)(e.primitiveType===c.f.Triangle);const t=i.tolerance;g(e.boundingInfo,r,n,t,a,s)}else{const t=e.indices.get(h.a.POSITION),i=e.vertexAttributes.get(h.a.POSITION);O(r,n,0,t.length/3,t,i,void 0,a,s)}}const b=Object(s.f)();function g(e,t,i,r,s,c){if(Object(n.j)(e))return;const l=function(e,t,i){return Object(a.w)(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}(t,i,b);if(Object(o.y)(p,e.getBBMin()),Object(o.x)(p,e.getBBMax()),Object(n.k)(s)&&s.applyToAabb(p),j(p,t,l,r)){const{primitiveIndices:n,indices:a,position:o}=e,l=n?n.length:a.length/3;if(l>R){const n=e.getChildren();if(void 0!==n){for(let e=0;e<8;++e)void 0!==n[e]&&g(n[e],t,i,r,s,c);return}}O(t,i,0,l,a,o,n,s,c)}}const m=Object(s.f)();function O(e,t,i,r,a,s,o,c,l){if(o)return function(e,t,i,r,a,s,o,c,l){const u=s.data,h=s.stride||s.size,d=e[0],p=e[1],f=e[2],b=t[0]-d,g=t[1]-p,O=t[2]-f;for(let _=i;_<r;++_){const e=o[_];let t=3*e,i=h*a[t++],r=u[i++],s=u[i++],v=u[i];i=h*a[t++];let j=u[i++],x=u[i++],T=u[i];i=h*a[t];let S=u[i++],E=u[i++],A=u[i];Object(n.k)(c)&&([r,s,v]=c.applyToVertex(r,s,v,_),[j,x,T]=c.applyToVertex(j,x,T,_),[S,E,A]=c.applyToVertex(S,E,A,_));const w=j-r,M=x-s,R=T-v,C=S-r,P=E-s,I=A-v,D=g*I-P*O,L=O*C-I*b,N=b*P-C*g,F=w*D+M*L+R*N;if(Math.abs(F)<=Number.EPSILON)continue;const z=d-r,U=p-s,G=f-v,V=z*D+U*L+G*N;if(F>0){if(V<0||V>F)continue}else if(V>0||V<F)continue;const k=U*R-M*G,H=G*w-R*z,B=z*M-w*U,W=b*k+g*H+O*B;if(F>0){if(W<0||V+W>F)continue}else if(W>0||V+W<F)continue;const q=(C*k+P*H+I*B)/F;q>=0&&l(q,y(w,M,R,C,P,I,m),e,!1)}}(e,t,i,r,a,s,o,c,l);const u=s.data,h=s.stride||s.size,d=e[0],p=e[1],f=e[2],b=t[0]-d,g=t[1]-p,O=t[2]-f;for(let _=i,v=3*i;_<r;++_){let e=h*a[v++],t=u[e++],i=u[e++],r=u[e];e=h*a[v++];let s=u[e++],o=u[e++],j=u[e];e=h*a[v++];let x=u[e++],T=u[e++],S=u[e];Object(n.k)(c)&&([t,i,r]=c.applyToVertex(t,i,r,_),[s,o,j]=c.applyToVertex(s,o,j,_),[x,T,S]=c.applyToVertex(x,T,S,_));const E=s-t,A=o-i,w=j-r,M=x-t,R=T-i,C=S-r,P=g*C-R*O,I=O*M-C*b,D=b*R-M*g,L=E*P+A*I+w*D;if(Math.abs(L)<=Number.EPSILON)continue;const N=d-t,F=p-i,z=f-r,U=N*P+F*I+z*D;if(L>0){if(U<0||U>L)continue}else if(U>0||U<L)continue;const G=F*w-A*z,V=z*E-w*N,k=N*A-E*F,H=b*G+g*V+O*k;if(L>0){if(H<0||U+H>L)continue}else if(H>0||U+H<L)continue;const B=(M*G+R*V+C*k)/L;B>=0&&l(B,y(E,A,w,M,R,C,m),_,!1)}}const _=Object(s.f)(),v=Object(s.f)();function y(e,t,i,r,n,s,o){return Object(a.w)(_,e,t,i),Object(a.w)(v,r,n,s),Object(a.g)(o,_,v),Object(a.r)(o,o),o}function j(e,t,i,r){return function(e,t,i,r,n){const a=(e[0]-r-t[0])*i[0],s=(e[3]+r-t[0])*i[0];let o=Math.min(a,s),c=Math.max(a,s);const l=(e[1]-r-t[1])*i[1],u=(e[4]+r-t[1])*i[1];if(c=Math.min(c,Math.max(l,u)),c<0)return!1;if(o=Math.max(o,Math.min(l,u)),o>c)return!1;const h=(e[2]-r-t[2])*i[2],d=(e[5]+r-t[2])*i[2];return c=Math.min(c,Math.max(h,d)),!(c<0)&&(o=Math.max(o,Math.min(h,d)),!(o>c)&&o<n)}(e,t,i,r,1/0)}function x(e,t,i,n,a){let s=(i.screenLength||0)*e.pixelRatio;a&&(s=Object(l.d)(s,n,t,a));const o=s*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(r.e)(o*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function T(e,t,i){if(!e)return;const r=e.parameters,n=e.paddingPixelsOverride;t.setUniform4f(i,r.divisor,r.offset,r.minPixelSize,n)}function S(e,t){const i=t?S(t):{};for(const r in e){let t=e[r];t&&t.forEach&&(t=w(t)),null==t&&r in i||(i[r]=t)}return i}function E(e,t){let i=!1;for(const r in t){const n=t[r];void 0!==n&&(i=!0,Array.isArray(n)?e[r]=n.slice():e[r]=n)}return i}function A(e,t,i,n,a,s){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(h.a.POSITION).data,c=e.vertexAttributes.get(h.a.SIZE),l=c&&c.data[0],u=n[0],d=n[1],p=((l+a)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,b=0;for(let h=0;h<o.length-5;h+=3){const e=o[h],t=o[h+1],i=u-e,n=d-t,a=o[h+3]-e,s=o[h+4]-t,c=Object(r.e)((a*i+s*n)/(a*a+s*s),0,1),l=a*c-i,p=s*c-n,g=l*l+p*p;g<f&&(f=g,b=h/3)}f<p*p&&s(i.dist,i.normal,b,!1)}function w(e){const t=[];return e.forEach((e=>t.push(e))),t}const M={multiply:1,ignore:2,replace:3,tint:4},R=1e3},436:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i(116);function n(e,t,i=0){const n=Object(r.e)(e,0,c);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*l(n*s[r]))}function a(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*o[r];return i}const s=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],c=a(new Uint8ClampedArray([255,255,255,255]));function l(e){return e-Math.floor(e)}},445:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return l})),i.d(t,"g",(function(){return f})),i.d(t,"h",(function(){return u}));var r=i(163),n=i(94),a=i(355);const s=Object(a.g)(n.b.SRC_ALPHA,n.b.ONE,n.b.ONE_MINUS_SRC_ALPHA,n.b.ONE_MINUS_SRC_ALPHA),o=Object(a.h)(n.b.ONE,n.b.ONE),c=Object(a.h)(n.b.ZERO,n.b.ONE_MINUS_SRC_ALPHA);function l(e){return e===r.i.FrontFace?null:e===r.i.Alpha?c:o}function u(e){return e===r.i.FrontFace?a.d:null}const h=5e5,d={factor:-1,units:-2};function p(e){return e?d:null}function f(e,t=n.h.LESS){return e===r.i.NONE||e===r.i.FrontFace?t:n.h.LEQUAL}},446:function(e,t,i){"use strict";function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(){return r()}function o(){return a(1,1,1)}function c(){return a(1,0,0)}function l(){return a(0,1,0)}function u(){return a(0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const h=s(),d=o(),p=c(),f=l(),b=u();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:function(e,t){return new Float32Array(e,t,3)},zeros:s,ones:o,unitX:c,unitY:l,unitZ:u,ZEROS:h,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:b})},463:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return u}));i(409),i(82);var r=i(85),n=(i(549),i(244),i(96),i(223)),a=i(118);i(328),i(205),i(154),i(488);class s{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function o(e){return Object(r.k)(e.geometry)}class c{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function u(e){if(Object(r.j)(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function h(e,t){switch(Object(n.h)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(n.l)(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(n.l)(t,e.rings[i],e.hasZ);break;case"multipoint":Object(n.l)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function d(e,t){switch(Object(a.m)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(a.p)(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(a.p)(t,e.rings[i]);break;case"multipoint":Object(a.p)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(n.f)(),Object(a.l)()},464:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){e.code.add(r.a`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},478:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e,t){const i={hasModelTransformation:!1,...t};if(i.hasModelTransformation)return i.linearDepth?void e.vertex.code.add(r.a`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(r.a`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);i.linearDepth?e.vertex.code.add(r.a`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(r.a`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},488:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i(82),i(85);function r(e,t){return!!n(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function n(e,t){return e===t||e&&t&&e.equals(t)}},490:function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return f})),i.d(t,"h",(function(){return m})),i.d(t,"i",(function(){return _})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return O})),i.d(t,"l",(function(){return g}));i(99),i(183);var r=i(89),n=i(116),a=i(85),s=i(102),o=i(109),c=i(187),l=i(272),u=i(700),h=i(113);function d(e,t){return e.events.on("drag",function(e,t){let i=null,r=null;return n=>{if("cancel"===n.action)return void(Object(a.k)(r)&&(r.execute({action:"cancel"}),i=null,r=null));const s={action:n.action,screenStart:n.start,screenEnd:n.screenPoint};"start"===n.action&&Object(a.j)(i)&&(i=new T,r=new T,t(e,i,r,n.pointerType,s)),Object(a.k)(i)&&i.execute(s),"end"===n.action&&Object(a.k)(i)&&(i=null,r=null)}}(e,t))}function p(e,t){const i=[e.x,e.y,e.z],r=t,n=[Math.cos(r),Math.sin(r)],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(0===a)return null;n[0]/=a,n[1]/=a;const s=e=>{const t=(e.x-i[0])*n[0]+(e.y-i[1])*n[1];e.x=i[0]+t*n[0],e.y=i[1]+t*n[1]};return e=>(s(e.mapStart),s(e.mapEnd),e)}function f(e,t){let i=null;return r=>{if("start"===r.action&&(i=function(e,t,i){const r=e.geometry;if(Object(a.j)(r))return null;if("mesh"===r.type)return function(e,t,i,r){if(Object(a.k)(t.transform))return function(e,t,i,r){const n=b(i.getOriginPoint(t.spatialReference),r),s=t.spatialReference;return Object(a.j)(n)?null:{move:(t,r,l)=>{const h=Object(u.d)(n.clone(),t,r,l);if(h.spatialReference.equals(s))i.origin=Object(o.h)(h.x,h.y,h.z);else{const e=Object(c.j)(h,s);Object(a.k)(e)&&(i.origin=Object(o.h)(e.x,e.y,e.z))}e.notifyMeshTransformChanged(),e.notifyGeometryChanged()}}}(e,t,t.transform,i);if(!t.spatialReference.equals(i))return null;let n=0,s=0,d=0;return{move:(i,a,o)=>{const c=i-n,u=a-s,p=o-d;if(c||u||p){const f=new h.a(t.origin.x+c,t.origin.y+u,t.origin.z+p,t.origin.spatialReference);t.centerAt(f,{geographic:r===l.a.Global}),e.notifyGeometryChanged(),n=i,s=a,d=o}}}}(e,r,t,i);const n=b(r,t),s=r.spatialReference;return Object(a.j)(n)?null:{move:(t,i,r)=>{const a=Object(u.d)(n.clone(),t,i,r);a.spatialReference.equals(s)?e.geometry=a:e.geometry=Object(c.j)(a,s)}}}(e,r.mapStart.spatialReference,t)),Object(a.j)(i))return null;const n=r.mapEnd.x-r.mapStart.x,s=r.mapEnd.y-r.mapStart.y,d=r.mapEnd.z-r.mapStart.z;return i.move(n,s,d),{...r,translationX:n,translationY:s,translationZ:d}}}function b(e,t){return Object(a.j)(e)?null:e.spatialReference.equals(t)?e.clone():Object(c.j)(e,t)}function g(e,t=null,i){let r=null;const n=Object(a.k)(t)&&!e.spatialReference.equals(t)?e=>Object(a.k)(e)?Object(c.j)(e,t):e:e=>e,s={exclude:[],...i};return t=>{if("start"===t.action&&(r=n(e.toMap(t.screenStart,s))),Object(a.j)(r))return null;const i=n(e.toMap(t.screenEnd,s));return Object(a.k)(i)?{...t,mapStart:r,mapEnd:i}:null}}function m(e,t){const i=e.map((e=>Object(a.s)(f(e,t)))).filter((e=>Object(a.k)(e)));return e=>{const t=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,n=e.mapEnd.z-e.mapStart.z;return i.forEach((t=>t(e))),{...e,translationX:t,translationY:r,translationZ:n}}}function O(e,t){const i=new Map;for(const n of t)i.set(n,Object(r.a)(e[n]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)}function _(e){return Object(a.k)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){const i=Object(a.k)(t.transform)?t.transform.clone():null,r=t.vertexAttributes.clonePositional();return n=>(t.transform=i,t.vertexAttributes=r,e.notifyGeometryChanged(),n)}(e,e.geometry):O(e,["geometry"])}function v(e){const t=e.map((e=>Object(a.s)(_(e)))).filter((e=>Object(a.k)(e)));return e=>(t.forEach((t=>t(e))),e)}function y(){let e=0,t=0,i=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,i=r.mapStart.z);const n=r.mapEnd.x-e,a=r.mapEnd.y-t,s=r.mapEnd.z-i;return e=r.mapEnd.x,t=r.mapEnd.y,i=r.mapEnd.z,{...r,mapDeltaX:n,mapDeltaY:a,mapDeltaZ:s,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function j(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const r=i.screenEnd.x-e,n=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:r,screenDeltaY:n}}}function x(e,t){let i=null,r=0,a=0;return o=>{if("start"===o.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(r=o.screenStart.x-i.x,a=o.screenStart.y-i.y)),null==i)return null;const c=Object(n.e)(o.screenEnd.x-r,0,e.width),l=Object(n.e)(o.screenEnd.y-a,0,e.height),u=Object(s.e)(c,l);return o.screenStart=i,o.screenEnd=u,o}}class T{constructor(){this.execute=()=>{}}next(e,t=new T){return Object(a.k)(e)&&(this.execute=i=>{const r=e(i);Object(a.k)(r)&&t.execute(r)}),t}}},492:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var r=i(101),n=i(216),a=i(113),s=i(135),o=i(140);const c={convertToGEGeometry:function(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){const r=e.hasZ(t),n=e.hasM(t),s=new a.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(s.z=e.getPointZ(t)),n&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s},exportPolygon:function(e,t,i){const r=new s.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportPolyline:function(e,t,i){const r=new o.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,i){const r=new n.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r},exportExtent:function(e,t,i){const n=e.hasZ(t),a=e.hasM(t),s=new r.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(n){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(a){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s.cache._geVersion=t,s}}},495:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(421),n=i(743);class a{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fieldNames){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new a(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,i,r){const n=this.stride;if(n%4==0){const a=new Uint32Array(e.buffer,t*n,r*n/4);new Uint32Array(this.buffer,i*n,r*n/4).set(a)}else{const a=new Uint8Array(e.buffer,t*n,r*n);new Uint8Array(this.buffer,i*n,r*n).set(a)}}}class s{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this._appendField(e,r.m,t),this}vec2f64(e,t){return this._appendField(e,r.n,t),this}vec3f(e,t){return this._appendField(e,r.u,t),this}vec3f64(e,t){return this._appendField(e,r.v,t),this}vec4f(e,t){return this._appendField(e,r.C,t),this}vec4f64(e,t){return this._appendField(e,r.D,t),this}mat3f(e,t){return this._appendField(e,r.f,t),this}mat3f64(e,t){return this._appendField(e,r.g,t),this}mat4f(e,t){return this._appendField(e,r.h,t),this}mat4f64(e,t){return this._appendField(e,r.i,t),this}vec4u8(e,t){return this._appendField(e,r.J,t),this}f32(e,t){return this._appendField(e,r.a,t),this}f64(e,t){return this._appendField(e,r.b,t),this}u8(e,t){return this._appendField(e,r.l,t),this}u16(e,t){return this._appendField(e,r.j,t),this}i8(e,t){return this._appendField(e,r.e,t),this}vec2i8(e,t){return this._appendField(e,r.q,t),this}vec2i16(e,t){return this._appendField(e,r.o,t),this}vec2u8(e,t){return this._appendField(e,r.t,t),this}vec4u16(e,t){return this._appendField(e,r.H,t),this}u32(e,t){return this._appendField(e,r.k,t),this}_appendField(e,t,i){const r=t.ElementCount*Object(n.a)(t.ElementType),a=this.stride;this.fields.set(e,{size:r,constructor:t,offset:a,optional:i}),this.stride+=r,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new a(this,e)}createView(e){return new a(this,e)}clone(){const e=new s;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,i)=>e.fields.set(i,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function o(){return new s}},499:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return u})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return f}));var r=i(116),n=i(485),a=i(117),s=i(109),o=i(288);function c(e){return e?{origin:Object(s.d)(e.origin),vector:Object(s.d)(e.vector)}:{origin:Object(s.f)(),vector:Object(s.f)()}}function l(e,t=c()){return u(e.origin,e.vector,t)}function u(e,t,i=c()){return Object(a.k)(i.origin,e),Object(a.k)(i.vector,t),i}function h(e,t,i=c()){return Object(a.k)(i.origin,e),Object(a.j)(i.vector,t,e),i}function d(e,t){const i=Object(a.j)(o.d.get(),t,e.origin),n=Object(a.h)(e.vector,i),s=Object(a.h)(e.vector,e.vector),c=Object(r.e)(n/s,0,1),l=Object(a.j)(o.d.get(),Object(a.e)(o.d.get(),e.vector,c),i);return Object(a.h)(l,l)}function p(e,t,i){return Object(a.f)(i,e.origin,Object(a.e)(i,e.vector,t))}function f(e,t,i,n,s){const{vector:c,origin:l}=e,u=Object(a.j)(o.d.get(),t,l),h=Object(a.h)(c,u)/Object(a.t)(c);return Object(a.e)(s,c,Object(r.e)(h,i,n)),Object(a.f)(s,s,e.origin)}function b(e,t){if(m(e,function(e,t){const i=_.get();return i.origin=e,i.vector=t,i}(t.origin,t.direction),!1,O)){const{tA:t,pB:i,distance2:r}=O;if(t>=0&&t<=1)return r;if(t<0)return Object(a.l)(e.origin,i);if(t>1)return Object(a.l)(Object(a.f)(o.d.get(),e.origin,e.vector),i)}return null}function g(e,t,i){return!!m(e,t,!0,O)&&(Object(a.k)(i,O.pA),!0)}function m(e,t,i,n){const s=1e-6,c=e.origin,l=Object(a.f)(o.d.get(),c,e.vector),u=t.origin,h=Object(a.f)(o.d.get(),u,t.vector),d=o.d.get(),p=o.d.get();if(d[0]=c[0]-u[0],d[1]=c[1]-u[1],d[2]=c[2]-u[2],p[0]=h[0]-u[0],p[1]=h[1]-u[1],p[2]=h[2]-u[2],Math.abs(p[0])<s&&Math.abs(p[1])<s&&Math.abs(p[2])<s)return!1;const f=o.d.get();if(f[0]=l[0]-c[0],f[1]=l[1]-c[1],f[2]=l[2]-c[2],Math.abs(f[0])<s&&Math.abs(f[1])<s&&Math.abs(f[2])<s)return!1;const b=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],m=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],O=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],_=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*O-g*g;if(Math.abs(_)<s)return!1;let v=(b*g-m*O)/_,y=(b+g*v)/O;i&&(v=Object(r.e)(v,0,1),y=Object(r.e)(y,0,1));const j=o.d.get(),x=o.d.get();return j[0]=c[0]+v*f[0],j[1]=c[1]+v*f[1],j[2]=c[2]+v*f[2],x[0]=u[0]+y*p[0],x[1]=u[1]+y*p[1],x[2]=u[2]+y*p[2],n.tA=v,n.tB=y,n.pA=j,n.pB=x,n.distance2=Object(a.l)(j,x),!0}const O={tA:0,tB:0,pA:Object(s.f)(),pB:Object(s.f)(),distance2:0},_=new n.a((()=>({origin:null,vector:null})))},500:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){e.code.add(r.a`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},501:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return l}));var r=i(147),n=i(920);function a(e,t,i){e.setUniform3f("cameraPosition",i[3]-t[0],i[7]-t[1],i[11]-t[2])}function s(e,t){e.setUniformMatrix4fv("proj",t)}function o(e,t,i){Object(r.j)(u,i,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",u)}function c(e,t){o(e,t.origin,t.camera.viewMatrix)}function l(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}const u=Object(n.a)()},502:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var r=i(446),n=i(913),a=i(126);Object(r.c)(0,.6,.2);var s,o;function c(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;t.pbrMode===s.Normal&&r&&e.include(n.a,t),t.pbrMode!==s.Schematic?(t.pbrMode===s.Disabled&&i.code.add(a.a`float getBakedOcclusion() { return 1.0; }`),t.pbrMode===s.Normal&&(i.uniforms.add("emissionFactor","vec3"),i.uniforms.add("mrrFactors","vec3"),i.code.add(a.a`vec3 mrr;
vec3 emission;
float occlusion;`),t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add("texMetallicRoughness","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texMetallicRoughnessSize","vec2"),i.code.add(a.a`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add("texEmission","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texEmissionSize","vec2"),i.code.add(a.a`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add("texOcclusion","sampler2D"),t.supportsTextureAtlas&&i.uniforms.add("texOcclusionSize","vec2"),i.code.add(a.a`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(a.a`float getBakedOcclusion() { return 1.0; }`),i.code.add(a.a`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `))):i.code.add(a.a`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function l(e,t,i=!1){i||(e.setUniform3fv("mrrFactors",t.mrrFactors),e.setUniform3fv("emissionFactor",t.emissiveFactor))}(o=s||(s={}))[o.Disabled=0]="Disabled",o[o.Normal=1]="Normal",o[o.Schematic=2]="Schematic",o[o.Water=3]="Water",o[o.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",o[o.COUNT=5]="COUNT"},505:function(e,t,i){"use strict";function r(e){return"h"in e&&"s"in e&&"v"in e}function n(e){return"l"in e&&"a"in e&&"b"in e}function a(e){return"l"in e&&"c"in e&&"h"in e}function s(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return O}));const o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],c=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){const i=[];let r,n;if(e[0].length!==t.length)throw"dimensions do not match";const a=e.length,s=e[0].length;let o=0;for(r=0;r<a;r++){for(o=0,n=0;n<s;n++)o+=e[r][n]*t[n];i.push(o)}return i}function u(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=l(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function h(e){const t=l(c,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function d(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function f(e){return d(u(e))}function b(e){return h(p(e))}function g(e){return function(e){const t=e.l,i=e.a,r=e.b,n=Math.sqrt(i*i+r*r);let a=Math.atan2(r,i);return a=a>0?a:a+2*Math.PI,{l:t,c:n,h:a}}(d(u(e)))}function m(e){return h(p(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}function O(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:a(e)?m(e):n(e)?b(e):s(e)?h(e):r(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,n=r*i,a=n*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:n,g:a,b:0};break;case 1:s={r:a,g:n,b:0};break;case 2:s={r:0,g:n,b:a};break;case 3:s={r:0,g:a,b:n};break;case 4:s={r:a,g:0,b:n};break;case 5:case 6:s={r:n,g:0,b:a};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+r-n),s.g=Math.round(s.g+r-n),s.b=Math.round(s.b+r-n),s}(e):e}function _(e){return r(e)?e:function(e){const t=e.r,i=e.g,r=e.b,n=Math.max(t,i,r),a=n-Math.min(t,i,r);let s=n,o=0===a?0:n===t?(i-r)/a%6:n===i?(r-t)/a+2:(t-i)/a+4,c=0===a?0:a/s;return o<0&&(o+=6),o*=60,c*=100,s*=100/255,{h:o,s:c,v:s}}(O(e))}function v(e){return n(e)?e:f(O(e))}function y(e){return a(e)?e:g(O(e))}function j(e,t){const i=f(e);return i.l*=1-t,b(i)}},513:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return d})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return l}));var r=i(85),n=i(147),a=i(200),s=i(278),o=i(725);function c(e,t){return Object(r.j)(e)&&(e=[]),e.push(t),e}function l(e,t){if(Object(r.j)(e))return null;const i=e.filter((e=>e!==t));return 0===i.length?null:i}function u(e){return!!Object(r.k)(e)&&!e.visible}function h(e,t,i){const a=e.origin.vec3;Object(s.i)(b,-a[0],-a[1],-a[2]),Object(r.k)(e.transformation)?Object(n.m)(t,b,e.transformation):Object(n.c)(t,b),i&&(Object(n.a)(i,t),Object(n.t)(i,i))}function d(e,t,i,r,n){p[0]=e.get(t,0),p[1]=e.get(t,1),p[2]=e.get(t,2),Object(o.a)(p,f,3),i.set(n,0,f[0]),r.set(n,0,f[1]),i.set(n,1,f[2]),r.set(n,1,f[3]),i.set(n,2,f[4]),r.set(n,2,f[5])}const p=new Float64Array(3),f=new Float32Array(6),b=Object(a.d)()},514:function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return C}));var r=i(79),n=i(100),a=i(124),s=i(87),o=i(85),c=i(481),l=i(212),u=i(91),h=i(144),d=i(448),p=i(81),f=(i(84),i(82),i(83),i(80));let b=class extends n.a{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise(((r,n)=>this._tasks.push(new g(r,n,e,t,i))))}unshift(e,t,i){return this.running=!0,new Promise(((r,n)=>this._tasks.unshift(new g(r,n,e,t,i))))}_process(e){if(0===this._tasks.length)return!1;const t=this._tasks.shift();try{const i=Object(u.m)(t.signal);if(i&&!t.abortCallback)t.reject(Object(u.d)());else{const r=i?t.abortCallback(Object(u.d)()):t.callback(e);Object(u.n)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=Object(u.d)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};Object(r.a)([Object(p.b)()],b.prototype,"running",void 0),b=Object(r.a)([Object(f.a)("esri.layers.support.PromiseQueue")],b);class g{constructor(e,t,i,r,n){this.resolve=e,this.reject=t,this.callback=i,this.signal=r,this.abortCallback=n}}var m=i(633);const O=s.a.getLogger("esri.views.support.Scheduler");var _,v;(v=_||(_={})).RESOURCE_CONTROLLER="schedule",v.SLIDE="slide",v.STREAM_DATA_LOADER="stream loader",v.ELEVATION_QUERY="elevation query",v.TERRAIN_SURFACE="terrain",v.SURFACE_GEOMETRY_UPDATES="surface geometry updates",v.GRAPHICS_CORE="Graphics3D",v.I3S_CONTROLLER="I3S",v.POINT_CLOUD_LAYER="point cloud",v.FEATURE_TILE_FETCHER="feature fetcher",v.OVERLAY="overlay",v.STAGE="stage",v.GRAPHICS_DECONFLICTOR="graphics deconflictor",v.FILTER_VISIBILITY="Graphics3D filter visibility",v.SCALE_VISIBILITY="Graphics3D scale visibility",v.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",v.POINT_OF_INTEREST_FREQUENT="POI frequent",v.POINT_OF_INTEREST_INFREQUENT="POI infrequent",v.LABELER="labeler",v.FEATURE_QUERY_ENGINE="feature query",v.FEATURE_TILE_TREE="feature tile tree",v.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",v.ELEVATION_ALIGNMENT="elevation alignment",v.TEXT_TEXTURE_ATLAS="text texture atlas",v.TEXTURE_UNLOAD="texture unload",v.LINE_OF_SIGHT_TOOL="line of sight tool",v.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",v.ELEVATION_PROFILE="elevation profile",v.SNAPPING="snapping",v.SHADOW_ACCUMULATOR="shadow accumulator",v.CLOUDS_GENERATOR="cloud generator",v[v.TEST_PRIO=1]="TEST_PRIO";const y=new Map([[_.RESOURCE_CONTROLLER,0],[_.SLIDE,0],[_.STREAM_DATA_LOADER,0],[_.ELEVATION_QUERY,0],[_.TERRAIN_SURFACE,1],[_.SURFACE_GEOMETRY_UPDATES,1],[_.GRAPHICS_CORE,2],[_.I3S_CONTROLLER,2],[_.POINT_CLOUD_LAYER,2],[_.FEATURE_TILE_FETCHER,2],[_.OVERLAY,4],[_.STAGE,4],[_.GRAPHICS_DECONFLICTOR,4],[_.FILTER_VISIBILITY,4],[_.SCALE_VISIBILITY,4],[_.FRUSTUM_VISIBILITY,4],[_.POINT_OF_INTEREST_FREQUENT,6],[_.POINT_OF_INTEREST_INFREQUENT,30],[_.LABELER,8],[_.FEATURE_QUERY_ENGINE,8],[_.FEATURE_TILE_TREE,16],[_.FEATURE_TILE_TREE_ACTIVE,0],[_.ELEVATION_ALIGNMENT,12],[_.TEXT_TEXTURE_ATLAS,12],[_.CLOUDS_GENERATOR,12],[_.TEXTURE_UNLOAD,12],[_.LINE_OF_SIGHT_TOOL,16],[_.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[_.SNAPPING,0],[_.SHADOW_ACCUMULATOR,30]]);function j(e){return y.has(e)?y.get(e):"number"==typeof e?e:1}var x;!function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(x||(x={}));const T=Object(d.a)(6.5),S=Object(d.a)(1),E=Object(d.a)(30),A=Object(d.a)(1e3/30),w=Object(d.a)(100);var M,R;!function(e){let t=class extends n.a{constructor(e){super(e),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new c.a("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=x.INTERACTING,this._tasks=new l.a,this._runQueue=new l.a,this._load=0,this._idleStateCallbacks=new l.a,this._idleUpdatesStartFired=!1,this._maxReschedule=I,this._forceTask=!1,this._debug=!1,this._debugHandle=Object(h.e)((()=>m.a.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),h.a),this._budget=new s(e.nowFunc);for(const r of Object.keys(_))this.performanceInfo.tasks.set(_[r],new c.a(_[r]));let t;const i=this;this._test={get state(){return Object(o.t)(t,i._state)},set state(e){t=e},FRAME_SAFETY_BUDGET:T,INTERACTING_BUDGET:A,IDLE_BUDGET:w,get budget(){return i._budget.budget},usedBudget:0,setBudget:e=>i._budget=e,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),Object(o.r)(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=I,this._schedule(),this.frame()))})))}registerTask(e,t){const r=j(e),n=new i(this,e,t,r);return this._tasks.push(n),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new c.a(e)),n}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===x.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),r._state===x.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==x.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return Object(o.j)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=T,i=e.frameDuration,r=S;switch(this.state){case x.IDLE:t=Object(d.a)(0),i=Object(d.a)(Math.max(w,e.frameDuration)),r=E;break;case x.INTERACTING:i=Object(d.a)(Math.max(A,e.frameDuration));case x.ANIMATING:}return i=Object(d.a)(i-e.elapsedFrameTime-t),this.state!==x.IDLE&&i<S&&!this._forceTask?(this._forceTask=!0,!1):(i=Object(d.a)(Math.max(i,r)),this._budget.reset(i,this.state),this._maxReschedule=I,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case x.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case x.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(Object(d.a)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return R.SCHEDULED;let t=R.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=R.READY:t!==R.READY&&(t=R.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?` ${e}x ${i}`:` ${i}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&(e=!0,t=Math.max(t,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,this._runQueue.push(i)):--i.schedulePriority)})),!e)return this.updating=!1,!1;this._maxReschedule===I&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const i=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)}catch(t){O.error(`Exception in task "${r.name}"`,t)}r.schedulePriority=r.basePriority;const n=this._budget.now()-i;if(r.runtime+=n,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+n),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",r.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some((e=>e.needsUpdate)),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this.updating=this._tasks.some((e=>e.needsUpdate)),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(_))this._frameTaskTimes.set(_[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};Object(r.a)([Object(p.b)()],t.prototype,"updating",void 0),Object(r.a)([Object(p.b)()],t.prototype,"nowFunc",void 0),t=Object(r.a)([Object(f.a)("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends n.a{constructor(e,t,i,r){super({}),this._scheduler=e,this.name=t,this._basePriority=r,this.runtime=0,this._queue=new b,this._handles=new a.a,this.schedulePriority=this._basePriority,this.task=Object(o.k)(i)?i:this._queue,this._handles.add(Object(h.f)((()=>this.task.running),(()=>e.activate())))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(C),this._scheduler.removeTask(this),this.schedule=P.schedule,this.reschedule=P.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=j(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this._queue.push(e,t,i)}reschedule(e,t,i){return this._queue.unshift(e,t,i)}processQueue(e){this._queue.runTask(e)}};Object(r.a)([Object(p.b)({constructOnly:!0})],i.prototype,"task",void 0),Object(r.a)([Object(p.b)({readOnly:!0})],i.prototype,"updating",null),i=Object(r.a)([Object(f.a)("esri.views.support.SchedulerTask")],i);class s{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=x.IDLE,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=s}(M||(M={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(R||(R={}));const C=(()=>{const e=new M.Budget((()=>performance.now()));return e.enabled=!1,e})();const P=new class{remove(){}processQueue(){}schedule(e,t,i){try{if(Object(u.m)(t)){const e=Object(u.d)();return i?Promise.resolve(i(e)):Promise.reject(e)}return Object(u.w)(e(C))}catch(r){return Promise.reject(r)}}reschedule(e,t,i){return this.schedule(e,t,i)}},I=Number.MAX_SAFE_INTEGER},543:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return M})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return C})),i.d(t,"h",(function(){return l}));var r=i(367),n=i(462),a=i(109),s=i(189),o=i(117),c=i(271);function l(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function u(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>s.a?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function h(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],c=i[1],l=i[2],u=i[3];return e[0]=r*u+s*o+n*l-a*c,e[1]=n*u+s*c+a*o-r*l,e[2]=a*u+s*l+r*c-n*o,e[3]=s*u-r*o-n*c-a*l,e}function d(e,t,i,r){const n=t[0],a=t[1],o=t[2],c=t[3];let l,u,h,d,p,f=i[0],b=i[1],g=i[2],m=i[3];return u=n*f+a*b+o*g+c*m,u<0&&(u=-u,f=-f,b=-b,g=-g,m=-m),1-u>s.a?(l=Math.acos(u),h=Math.sin(l),d=Math.sin((1-r)*l)/h,p=Math.sin(r*l)/h):(d=1-r,p=r),e[0]=d*n+p*f,e[1]=d*a+p*b,e[2]=d*o+p*g,e[3]=d*c+p*m,e}function p(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=a*o,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function b(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}function g(e,t,i,r){const n=.5*Math.PI/180;t*=n,i*=n,r*=n;const a=Math.sin(t),s=Math.cos(t),o=Math.sin(i),c=Math.cos(i),l=Math.sin(r),u=Math.cos(r);return e[0]=a*c*u-s*o*l,e[1]=s*o*u+a*c*l,e[2]=s*c*l-a*o*u,e[3]=s*c*u+a*o*l,e}const m=c.c,O=c.l,_=c.a,v=h,y=c.b,j=c.d,x=c.j,T=c.e,S=T,E=c.f,A=E,w=c.k,M=c.g,R=c.h;function C(e,t,i){const r=Object(o.h)(t,i);return r<-.999999?(Object(o.g)(P,I,t),Object(o.y)(P)<1e-6&&Object(o.g)(P,D,t),Object(o.r)(P,P),l(e,P,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o.g)(P,t,i),e[0]=P[0],e[1]=P[1],e[2]=P[2],e[3]=1+r,w(e,e))}const P=Object(a.f)(),I=Object(a.h)(1,0,0),D=Object(a.h)(0,1,0);const L=Object(n.b)(),N=Object(n.b)();const F=Object(r.b)();Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:l,getAxisAngle:u,multiply:h,rotateX:function(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+s*o,e[1]=n*c+a*o,e[2]=a*c-n*o,e[3]=s*c-r*o,e},rotateY:function(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c-a*o,e[1]=n*c+s*o,e[2]=a*c+r*o,e[3]=s*c-n*o,e},rotateZ:function(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*o,e[1]=n*c-r*o,e[2]=a*c+s*o,e[3]=s*c-a*o,e},calculateW:function(e,t){const i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},slerp:d,random:function(e){const t=Object(s.b)(),i=Object(s.b)(),r=Object(s.b)(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},invert:p,conjugate:f,fromMat3:b,fromEuler:g,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:m,set:O,add:_,mul:v,scale:y,dot:j,lerp:x,length:T,len:S,squaredLength:E,sqrLen:A,normalize:w,exactEquals:M,equals:R,rotationTo:C,sqlerp:function(e,t,i,r,n,a){return d(L,t,n,a),d(N,i,r,a),d(e,L,N,2*a*(1-a)),e},setAxes:function(e,t,i,r){const n=F;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],w(e,b(e,n))}})},544:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"}(r||(r={}))},545:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(163);class n{constructor(e){this._material=e.material,this._techniqueRep=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRep.release(this._technique)}get technique(){return this._technique}ensureTechnique(e,t,i=this._output){return this._technique=this._techniqueRep.releaseAndAcquire(e,this._material.getTechniqueConfig(i,t),this._technique),this._technique}ensureResources(e){return r.g.LOADED}}},560:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(244);class n{constructor(){this.id=Object(r.a)()}unload(){}}},562:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return p}));var r=i(117),n=i(109),a=i(485),s=(i(151),i(499));i(288);new a.a(s.d),new a.a((()=>({p0:null,p1:null,p2:null})));const o=Object(n.f)(),c=Object(n.f)();let l=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const u=new Uint16Array([0]),h=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function d(e){if(1===e)return u;if(e<h.length)return new Uint16Array(h.buffer,0,e);if(e>l.length){const t=Math.max(2*l.length,e);l=new Uint32Array(t);for(let e=0;e<l.length;e++)l[e]=e}return new Uint32Array(l.buffer,0,e)}function p(e){if(1===e)return new Uint16Array(u);if(e<h.length)return new Uint16Array(h.slice(0,e));if(e>l.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(l.slice(0,e))}function f(e,t,i){if(!e)return!1;const{size:n,data:a}=e;Object(r.w)(i,0,0,0),Object(r.w)(v,0,0,0);let s=0,l=0;for(let p=0;p<t.length-2;p+=3){const e=t[p+0]*n,f=t[p+1]*n,b=t[p+2]*n;Object(r.w)(m,a[e+0],a[e+1],a[e+2]),Object(r.w)(O,a[f+0],a[f+1],a[f+2]),Object(r.w)(_,a[b+0],a[b+1],a[b+2]);const g=(u=m,h=O,d=_,Object(r.j)(o,h,u),Object(r.j)(c,d,u),Object(r.p)(Object(r.g)(o,o,c))/2);g?(Object(r.f)(m,m,O),Object(r.f)(m,m,_),Object(r.e)(m,m,1/3*g),Object(r.f)(i,i,m),s+=g):(Object(r.f)(v,v,m),Object(r.f)(v,v,O),Object(r.f)(v,v,_),l+=3)}var u,h,d;return(0!==l||0!==s)&&(0!==s?(Object(r.e)(i,i,1/s),!0):0!==l&&(Object(r.e)(i,v,1/l),!0))}function b(e,t,i){if(!e||!t)return!1;const{size:n,data:a}=e;Object(r.w)(i,0,0,0);let s=-1,o=0;for(let r=0;r<t.length;r++){const e=t[r]*n;s!==e&&(i[0]+=a[e+0],i[1]+=a[e+1],i[2]+=a[e+2],o++),s=e}return o>1&&Object(r.e)(i,i,1/o),o>0}function g(e,t,i,n){if(!e)return!1;const{size:a,data:s}=e;Object(r.w)(n,0,0,0),Object(r.w)(v,0,0,0);let o=0,c=0;const l=t?t.length-1:s.length/a-1,u=l+(i?2:0);for(let h=0;h<u;h+=2){const e=h<l?h:l,i=h<l?h+1:0,u=(t?t[e]:e)*a,d=(t?t[i]:i)*a;m[0]=s[u+0],m[1]=s[u+1],m[2]=s[u+2],O[0]=s[d+0],O[1]=s[d+1],O[2]=s[d+2],Object(r.e)(m,Object(r.f)(m,m,O),.5);const p=Object(r.n)(m,O);p>0?(Object(r.f)(n,n,Object(r.e)(m,m,p)),o+=p):(Object(r.f)(v,v,m),c++)}return 0!==o?(Object(r.e)(n,n,1/o),!0):0!==c&&(Object(r.e)(n,v,1/c),!0)}const m=Object(n.f)(),O=Object(n.f)(),_=Object(n.f)(),v=Object(n.f)()},567:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT",e[e.MAX_PASS=8]="MAX_PASS"}(r||(r={}))},568:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return x})),i.d(t,"d",(function(){return A})),i.d(t,"e",(function(){return v})),i.d(t,"f",(function(){return S})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return y})),i.d(t,"i",(function(){return T}));var r=i(85),n=i(147),a=i(200),s=i(109),o=i(271),c=i(257),l=i(187),u=i(223),h=i(118),d=i(438),p=i(294),f=i(463),b=i(638),g=i(139);function m(e,t){if("point"===e.type)return _(e,t,!1);if(Object(b.d)(e))switch(e.type){case"extent":return _(e.center,t,!1);case"polygon":return _(e.centroid,t,!1);case"polyline":return _(O(e),t,!0);case"mesh":return _(e.origin,t,!1)}else switch(e.type){case"extent":return _(function(e){const t=isFinite(e.zmin);return Object(f.g)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return _(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Object(d.c)(e.rings,e.hasZ);return Object(f.g)(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return _(O(e),t,!0)}}function O(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(p.f)(t,Object(p.e)(t)/2);return Object(f.g)(i[0],i[1],i[2],e.spatialReference)}function _(e,t,i){const r=i?e:Object(b.a)(e);return t&&e?Object(l.n)(e,r,t)?r:null:r}function v(e,t,i,r=0){if(e){t||(t=Object(h.l)());const n=e;let a=.5*n.width*(i-1),s=.5*n.height*(i-1);return n.width<1e-7*n.height?a+=s/20:n.height<1e-7*n.width&&(s+=a/20),Object(o.l)(t,n.xmin-a-r,n.ymin-s-r,n.xmax+a+r,n.ymax+s+r),t}return null}function y(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(g.a.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function j(e,t){const i=Object(c.d)(c.a);return Object(r.k)(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),Object(r.k)(t)?i[3]=t:Object(r.k)(e)&&e.length>3&&(i[3]=e[3]),i}function x(e=s.a,t,i,n=1){const a=new Array(3);if(Object(r.j)(t)||Object(r.j)(i))a[0]=1,a[1]=1,a[2]=1;else{let r,n=0;for(let s=2;s>=0;s--){const o=e[s];let c;const l=null!=o,u=0===s&&!r&&!l,h=i[s];"symbol-value"===o||u?c=0!==h?t[s]/h:1:l&&"proportional"!==o&&isFinite(o)&&(c=0!==h?o/h:1),null!=c&&(a[s]=c,r=c,n=Math.max(n,Math.abs(c)))}for(let e=2;e>=0;e--)null==a[e]?a[e]=r:0===a[e]&&(a[e]=.001*n)}for(let r=2;r>=0;r--)a[r]/=n;return Object(s.g)(a)}function T(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),S(e)?null:"Symbol sizes may not be negative values"}function S(e){if(Array.isArray(e)){for(const t of e)if(!S(t))return!1;return!0}return null==e||e>=0}function E(e,t,i,r=Object(a.d)()){const s=e||0,o=t||0,c=i||0;return 0!==s&&Object(n.g)(r,r,-s/180*Math.PI),0!==o&&Object(n.r)(r,r,o/180*Math.PI),0!==c&&Object(n.o)(r,r,c/180*Math.PI),r}function A(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(u.s)(e)?t.minDemResolutionForPoints:.01*Object(u.t)(e)}},574:function(e,t,i){"use strict";var r,n,a;i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n})),function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(n||(n={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(a||(a={}))},594:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var r,n,a=i(117),s=i(446),o=i(109),c=i(423),l=i(360),u=i(163);(n=r||(r={})).length=function(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)},n.normalize=function(e,t){const i=e[t],r=e[t+1],n=e[t+2],a=1/Math.sqrt(i*i+r*r+n*n);e[t]*=a,e[t+1]*=a,e[t+2]*=a},n.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},n.add=function(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]+i[r],n[a+1]=e[t+1]+i[r+1],n[a+2]=e[t+2]+i[r+2]},n.subtract=function(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]-i[r],n[a+1]=e[t+1]-i[r+1],n[a+2]=e[t+2]-i[r+2]};var h=i(595),d=i(562),p=i(278),f=i(139);const b=r;var g,m,O,_;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let c=0;c<6;c++)for(let e=0;e<6;e++)s[6*c+e]=c;const o=new Uint16Array(36);for(let c=0;c<6;c++)o[6*c+0]=0,o[6*c+1]=1,o[6*c+2]=2,o[6*c+3]=2,o[6*c+4]=3,o[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new h.a([[f.a.POSITION,{size:3,data:t,exclusive:!0}],[f.a.NORMAL,{size:3,data:r}],[f.a.UV0,{size:2,data:n}]],[[f.a.POSITION,a],[f.a.NORMAL,s],[f.a.UV0,o]])}}(g||(g={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new h.a([[f.a.POSITION,{size:3,data:t,exclusive:!0}],[f.a.NORMAL,{size:3,data:r}]],[[f.a.POSITION,n],[f.a.NORMAL,a]])}}(m||(m={})),function(e){const t=.5,i=Object(s.c)(-t,0,-t),r=Object(s.c)(t,0,-t),n=Object(s.c)(0,0,t),o=Object(s.c)(0,.5,0),c=Object(s.b)(),l=Object(s.b)(),u=Object(s.b)(),d=Object(s.b)(),p=Object(s.b)();Object(a.j)(c,i,o),Object(a.j)(l,i,r),Object(a.g)(u,c,l),Object(a.r)(u,u),Object(a.j)(c,r,o),Object(a.j)(l,r,n),Object(a.g)(d,c,l),Object(a.r)(d,d),Object(a.j)(c,n,o),Object(a.j)(l,n,i),Object(a.g)(p,c,l),Object(a.r)(p,p);const b=[i,r,n,o],g=[0,-1,0,u[0],u[1],u[2],d[0],d[1],d[2],p[0],p[1],p[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],O=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=b[i][0]*e[0],t[3*i+1]=b[i][1]*e[1],t[3*i+2]=b[i][2]*e[2];return new h.a([[f.a.POSITION,{size:3,data:t,exclusive:!0}],[f.a.NORMAL,{size:3,data:g}]],[[f.a.POSITION,new Uint16Array(m)],[f.a.NORMAL,new Uint16Array(O)]])}}(O||(O={})),function(e){e.createBoxGeometry=g.createGeometry,e.createDiamondGeometry=m.createGeometry,e.createTetrahedronGeometry=O.createGeometry,e.createSphereGeometry=function(e,t,i,r={uv:!0}){const n=-Math.PI,a=2*Math.PI,s=-Math.PI/2,o=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(i)),u=(c+1)*(l+1),d=new Float32Array(3*u),p=new Float32Array(3*u),b=new Float32Array(2*u),g=[];let m=0;for(let h=0;h<=l;h++){const t=[],i=h/l,r=s+i*o,u=Math.cos(r);for(let s=0;s<=c;s++){const o=s/c,l=n+o*a,h=Math.cos(l)*u,f=Math.sin(r),g=-Math.sin(l)*u;d[3*m]=h*e,d[3*m+1]=f*e,d[3*m+2]=g*e,p[3*m]=h,p[3*m+1]=f,p[3*m+2]=g,b[2*m]=o,b[2*m+1]=i,t.push(m),++m}g.push(t)}const O=new Uint32Array(2*c*(l-1)*3);m=0;for(let h=0;h<l;h++)for(let e=0;e<c;e++){const t=g[h][e],i=g[h][e+1],r=g[h+1][e+1],n=g[h+1][e];0===h?(O[m++]=t,O[m++]=r,O[m++]=n):h===l-1?(O[m++]=t,O[m++]=i,O[m++]=r):(O[m++]=t,O[m++]=i,O[m++]=r,O[m++]=r,O[m++]=n,O[m++]=t)}const _=[[f.a.POSITION,O],[f.a.NORMAL,O]],v=[[f.a.POSITION,{size:3,data:d,exclusive:!0}],[f.a.NORMAL,{size:3,data:p,exclusive:!0}]];return r.uv&&(v.push([f.a.UV0,{size:2,data:b,exclusive:!0}]),_.push([f.a.UV0,O])),r.offset&&(_[0][0]=f.a.OFFSET,v[0][0]=f.a.OFFSET,_.push([f.a.POSITION,new Uint32Array(O.length)]),v.push([f.a.POSITION,{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new h.a(v,_)},e.createPolySphereGeometry=function(e,t,i){const r=e;let n,a;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;n=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],a=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let h=0;h<n.length;h+=3)b.scale(n,h,e/b.length(n,h));let s={};function o(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(s[r])return s[r];let a=n.length;return n.length+=3,b.add(n,3*t,n,3*i,n,a),b.scale(n,a,e/b.length(n,a)),a/=3,s[r]=a,a}for(let h=0;h<t;h++){const e=a.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=a[i],r=a[i+1],n=a[i+2],s=o(e,r),c=o(r,n),l=o(n,e),u=4*i;t[u]=e,t[u+1]=s,t[u+2]=l,t[u+3]=r,t[u+4]=c,t[u+5]=s,t[u+6]=n,t[u+7]=l,t[u+8]=c,t[u+9]=s,t[u+10]=c,t[u+11]=l}a=t,s={}}const c=new Float32Array(n);for(let h=0;h<c.length;h+=3)b.normalize(c,h);const l=[[f.a.POSITION,a],[f.a.NORMAL,a]],u=[[f.a.POSITION,{size:3,data:new Float32Array(n),exclusive:!0}],[f.a.NORMAL,{size:3,data:c,exclusive:!0}]];return new h.a(u,l)},e.createPointGeometry=function(e,t,i,r,n,a,s){const o=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const l=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],d=null!=r&&2===r.length?r:[1,1],p=[[f.a.POSITION,{size:3,data:o,exclusive:!0}],[f.a.NORMAL,{size:3,data:c,exclusive:!0}],[f.a.UV0,{size:a.length,data:a}],[f.a.COLOR,{size:4,data:l,exclusive:!0}],[f.a.SIZE,{size:2,data:d}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);p.push([f.a.AUXPOS1,{size:4,data:e}])}if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);p.push([f.a.AUXPOS2,{size:4,data:e}])}return new h.a(p,null,u.f.Point)},e.updatePointGeometry=function(e,t,i,r,n,a,s,o){if(null!=e){const{data:t}=o.getMutableAttribute(f.a.NORMAL);t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute(f.a.POSITION);e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=o.getMutableAttribute(f.a.COLOR);e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=o.getMutableAttribute(f.a.SIZE);e[0]=r[0],e[1]=r[1]}if(null!=n){const{data:e}=o.getMutableAttribute(f.a.AUXPOS1);e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=a){const{data:e}=o.getMutableAttribute(f.a.UV0);e[0]=a[0],e[1]=a[1]}if(null!=s){const{data:e}=o.getMutableAttribute(f.a.AUXPOS2);e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}},e.createPointArrayGeometry=function(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),a=new Uint32Array(e.length);for(let c=0;c<e.length;c++)i[3*c]=e[c][0],i[3*c+1]=e[c][1],i[3*c+2]=e[c][2],t&&(r[3*c]=t[c][0],r[3*c+1]=t[c][1],r[3*c+2]=t[c][2]),n[c]=c,a[c]=0;t||(r[0]=0,r[1]=1,r[2]=0);const s=[[f.a.POSITION,n],[f.a.NORMAL,t?n:a],[f.a.UV0,a]],o=[[f.a.POSITION,{size:3,data:i,exclusive:!0}],[f.a.NORMAL,{size:3,data:r,exclusive:!0}],[f.a.UV0,{size:2,data:[0,0],exclusive:!0}]];return new h.a(o,s,u.f.Point)},e.createTriangleGeometry=function(){const e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),i=new Uint16Array([0,0,0]),r=[[f.a.POSITION,e],[f.a.NORMAL,t],[f.a.UV0,i]],n=[[f.a.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[f.a.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[f.a.UV0,{size:2,data:[0,0],exclusive:!0}]];return new h.a(n,r)};const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function i(e,t,i,r,n){return!(Math.abs(Object(a.h)(t,e))>n)&&(Object(a.g)(i,e,t),Object(a.r)(i,i),Object(a.g)(r,i,e),Object(a.r)(r,r),!0)}function r(e,t,r,n,a,s,o){return i(e,t,a,s,o)||i(e,r,a,s,o)||i(e,n,a,s,o)}e.createSquareGeometry=function(e=t){const i=new Array(12);for(let t=0;t<4;t++)for(let r=0;r<3;r++)i[3*t+r]=e[t][r];const r=new Uint32Array([0,1,2,2,3,0]),n=new Uint32Array([0,0,0,0,0,0]),a=[[f.a.POSITION,r],[f.a.NORMAL,n],[f.a.UV0,r],[f.a.COLOR,n]],s=[[f.a.POSITION,{size:3,data:i,exclusive:!0}],[f.a.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[f.a.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[f.a.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]];return new h.a(s,a)},e.createConeGeometry=function(e,t,i,r,n=!0,a=!0){let o=0;const c=t,l=e;let u=Object(s.c)(0,o,0),d=Object(s.c)(0,o+l,0),p=Object(s.c)(0,-1,0),b=Object(s.c)(0,1,0);r&&(o=l,d=Object(s.c)(0,0,0),u=Object(s.c)(0,o,0),p=Object(s.c)(0,1,0),b=Object(s.c)(0,-1,0));const g=[d,u],m=[p,b],O=i+2,_=Math.sqrt(l*l+c*c);if(r)for(let h=i-1;h>=0;h--){const e=h*(2*Math.PI/i),t=Object(s.c)(Math.cos(e)*c,o,Math.sin(e)*c);g.push(t);const r=Object(s.c)(l*Math.cos(e)/_,-c/_,l*Math.sin(e)/_);m.push(r)}else for(let h=0;h<i;h++){const e=h*(2*Math.PI/i),t=Object(s.c)(Math.cos(e)*c,o,Math.sin(e)*c);g.push(t);const r=Object(s.c)(l*Math.cos(e)/_,c/_,l*Math.sin(e)/_);m.push(r)}const v=new Uint32Array(2*(i+2)*3),y=new Uint32Array(2*(i+2)*3);let j=0,x=0;if(n){for(let e=3;e<g.length;e++)v[j++]=1,v[j++]=e-1,v[j++]=e,y[x++]=0,y[x++]=0,y[x++]=0;v[j++]=g.length-1,v[j++]=2,v[j++]=1,y[x++]=0,y[x++]=0,y[x++]=0}if(a){for(let e=3;e<g.length;e++)v[j++]=e,v[j++]=e-1,v[j++]=0,y[x++]=e,y[x++]=e-1,y[x++]=1;v[j++]=0,v[j++]=2,v[j++]=g.length-1,y[x++]=1,y[x++]=2,y[x++]=m.length-1}const T=new Float32Array(3*O);for(let s=0;s<O;s++)T[3*s]=g[s][0],T[3*s+1]=g[s][1],T[3*s+2]=g[s][2];const S=new Float32Array(3*O);for(let s=0;s<O;s++)S[3*s]=m[s][0],S[3*s+1]=m[s][1],S[3*s+2]=m[s][2];const E=[[f.a.POSITION,v],[f.a.NORMAL,y]],A=[[f.a.POSITION,{size:3,data:T,exclusive:!0}],[f.a.NORMAL,{size:3,data:S,exclusive:!0}]];return new h.a(A,E)},e.createCylinderGeometry=function(e,t,i,r,n,o){const c=r?Object(s.a)(r):Object(s.c)(1,0,0),l=n?Object(s.a)(n):Object(s.c)(0,0,0);o=null==o||o;const u=Object(s.b)();Object(a.r)(u,c);const d=Object(s.b)();Object(a.e)(d,u,Math.abs(e));const p=Object(s.b)();Object(a.e)(p,d,-.5),Object(a.f)(p,p,l);const b=Object(s.c)(0,1,0);Math.abs(1-Object(a.h)(u,b))<.2&&Object(a.w)(b,0,0,1);const g=Object(s.b)();Object(a.g)(g,u,b),Object(a.r)(g,g),Object(a.g)(b,g,u);const m=2*i+(o?2:0),O=i+(o?2:0),_=new Float32Array(3*m),v=new Float32Array(3*O),y=new Float32Array(2*m),j=new Uint32Array(3*i*(o?4:2)),x=new Uint32Array(3*i*(o?4:2));o&&(_[3*(m-2)+0]=p[0],_[3*(m-2)+1]=p[1],_[3*(m-2)+2]=p[2],y[2*(m-2)]=0,y[2*(m-2)+1]=0,_[3*(m-1)+0]=_[3*(m-2)+0]+d[0],_[3*(m-1)+1]=_[3*(m-2)+1]+d[1],_[3*(m-1)+2]=_[3*(m-2)+2]+d[2],y[2*(m-1)]=1,y[2*(m-1)+1]=1,v[3*(O-2)+0]=-u[0],v[3*(O-2)+1]=-u[1],v[3*(O-2)+2]=-u[2],v[3*(O-1)+0]=u[0],v[3*(O-1)+1]=u[1],v[3*(O-1)+2]=u[2]);const T=function(e,t,i){j[e]=t,x[e]=i};let S=0;const E=Object(s.b)(),A=Object(s.b)();for(let s=0;s<i;s++){const e=s*(2*Math.PI/i);Object(a.e)(E,b,Math.sin(e)),Object(a.e)(A,g,Math.cos(e)),Object(a.f)(E,E,A),v[3*s+0]=E[0],v[3*s+1]=E[1],v[3*s+2]=E[2],Object(a.e)(E,E,t),Object(a.f)(E,E,p),_[3*s+0]=E[0],_[3*s+1]=E[1],_[3*s+2]=E[2],y[2*s+0]=s/i,y[2*s+1]=0,_[3*(s+i)+0]=_[3*s+0]+d[0],_[3*(s+i)+1]=_[3*s+1]+d[1],_[3*(s+i)+2]=_[3*s+2]+d[2],y[2*(s+i)+0]=s/i,y[2*s+1]=1;const r=(s+1)%i;T(S++,s,s),T(S++,s+i,s),T(S++,r,r),T(S++,r,r),T(S++,s+i,s),T(S++,r+i,r)}if(o){for(let e=0;e<i;e++){const t=(e+1)%i;T(S++,m-2,O-2),T(S++,e,O-2),T(S++,t,O-2)}for(let e=0;e<i;e++){const t=(e+1)%i;T(S++,e+i,O-1),T(S++,m-1,O-1),T(S++,t+i,O-1)}}const w=[[f.a.POSITION,j],[f.a.NORMAL,x],[f.a.UV0,j]],M=[[f.a.POSITION,{size:3,data:_,exclusive:!0}],[f.a.NORMAL,{size:3,data:v,exclusive:!0}],[f.a.UV0,{size:2,data:y,exclusive:!0}]];return new h.a(M,w)},e.createTubeGeometry=function(t,i,r,n,a){r=r||10,n=null==n||n,Object(p.a)(t.length>1);const s=[],o=[];for(let e=0;e<r;e++){s.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;o.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(o,t,[[0,0,0]],s,n,a)},e.createPathExtrusionGeometry=function(e,t,i,n,u,d=Object(s.c)(0,0,0)){const p=e.length,b=new Float32Array(t.length*p*3+(6*i.length||0)),g=new Float32Array(t.length*p*3+(i?6:0)),m=(t.length-1)*p*6+3*n.length*2,O=new Uint32Array(m),_=new Uint32Array(m);let y=0,j=0,x=0,T=0;const S=Object(s.b)(),E=Object(s.b)(),A=Object(s.b)(),w=Object(s.b)(),M=Object(s.b)(),R=Object(s.b)(),C=Object(s.b)(),P=Object(o.f)(),I=Object(s.b)(),D=Object(s.b)(),L=Object(s.b)(),N=Object(s.b)(),F=Object(s.b)(),z=Object(c.d)();Object(a.w)(I,0,1,0),Object(a.j)(E,t[1],t[0]),Object(a.r)(E,E),u?(Object(a.f)(P,t[0],d),Object(a.r)(A,P)):Object(a.w)(A,0,0,1),r(E,A,I,I,M,A,v),Object(a.k)(w,A),Object(a.k)(N,M);for(let r=0;r<i.length;r++)Object(a.e)(R,M,i[r][0]),Object(a.e)(P,A,i[r][2]),Object(a.f)(R,R,P),Object(a.f)(R,R,t[0]),b[y++]=R[0],b[y++]=R[1],b[y++]=R[2];g[j++]=-E[0],g[j++]=-E[1],g[j++]=-E[2];for(let r=0;r<n.length;r++)O[x++]=n[r][0]>0?n[r][0]:-n[r][0]-1+i.length,O[x++]=n[r][1]>0?n[r][1]:-n[r][1]-1+i.length,O[x++]=n[r][2]>0?n[r][2]:-n[r][2]-1+i.length,_[T++]=0,_[T++]=0,_[T++]=0;let U=i.length;const G=i.length-1;for(let s=0;s<t.length;s++){let i=!1;s>0&&(Object(a.k)(S,E),s<t.length-1?(Object(a.j)(E,t[s+1],t[s]),Object(a.r)(E,E)):i=!0,Object(a.f)(D,S,E),Object(a.r)(D,D),Object(a.f)(L,t[s-1],w),Object(c.g)(t[s],D,z),Object(c.m)(z,Object(l.g)(L,S),P)?(Object(a.j)(P,P,t[s]),Object(a.r)(A,P),Object(a.g)(M,D,A),Object(a.r)(M,M)):r(D,w,N,I,M,A,v),Object(a.k)(w,A),Object(a.k)(N,M)),u&&(Object(a.f)(P,t[s],d),Object(a.r)(F,P));for(let r=0;r<p;r++)if(Object(a.e)(R,M,e[r][0]),Object(a.e)(P,A,e[r][1]),Object(a.f)(R,R,P),Object(a.r)(C,R),g[j++]=C[0],g[j++]=C[1],g[j++]=C[2],Object(a.f)(R,R,t[s]),b[y++]=R[0],b[y++]=R[1],b[y++]=R[2],!i){const e=(r+1)%p;O[x++]=U+r,O[x++]=U+p+r,O[x++]=U+e,O[x++]=U+e,O[x++]=U+p+r,O[x++]=U+p+e;for(let t=0;t<6;t++)_[T++]=O[x-6+t]-G}U+=p}const V=t[t.length-1];for(let r=0;r<i.length;r++)Object(a.e)(R,M,i[r][0]),Object(a.e)(P,A,i[r][1]),Object(a.f)(R,R,P),Object(a.f)(R,R,V),b[y++]=R[0],b[y++]=R[1],b[y++]=R[2];const k=j/3;g[j++]=E[0],g[j++]=E[1],g[j++]=E[2];const H=U-p;for(let r=0;r<n.length;r++)O[x++]=n[r][0]>=0?U+n[r][0]:-n[r][0]-1+H,O[x++]=n[r][2]>=0?U+n[r][2]:-n[r][2]-1+H,O[x++]=n[r][1]>=0?U+n[r][1]:-n[r][1]-1+H,_[T++]=k,_[T++]=k,_[T++]=k;const B=[[f.a.POSITION,O],[f.a.NORMAL,_]],W=[[f.a.POSITION,{size:3,data:b,exclusive:!0}],[f.a.NORMAL,{size:3,data:g,exclusive:!0}]];return new h.a(W,B)},e.createPolylineGeometry=function(e,t,i){Object(p.a)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(p.a)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(p.a)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(p.a)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let a=0,s=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)r[a++]=e[l][t];l>0&&(n[s++]=l-1,n[s++]=l)}const o=[],c=[];if(o.push([f.a.POSITION,n]),c.push([f.a.POSITION,{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)i[r++]=t[n][e];o.push([f.a.NORMAL,n]),c.push([f.a.NORMAL,{size:3,data:i,exclusive:!0}])}return i&&(c.push([f.a.COLOR,{size:4,data:i}]),o.push([f.a.COLOR,Object(d.d)(i.length/4)])),new h.a(c,o,u.f.Line)},e.createExtrudedTriangle=function(e,t,i,r,n=0){const a=new Array(18),s=[[-t,n,r/2],[i,n,r/2],[0,e+n,r/2],[-t,n,-r/2],[i,n,-r/2],[0,e+n,-r/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)a[3*c]=s[c][0],a[3*c+1]=s[c][1],a[3*c+2]=s[c][2];return new h.a([[f.a.POSITION,{size:3,data:a,exclusive:!0}]],[[f.a.POSITION,o]])},e.transformInPlace=function(e,t){const i=e.getMutableAttribute(f.a.POSITION).data;for(let r=0;r<i.length;r+=3){const e=i[r],n=i[r+1],s=i[r+2];Object(a.w)(y,e,n,s),Object(a.q)(y,y,t),i[r]=y[0],i[r+1]=y[1],i[r+2]=y[2]}},e.cgToGIS=function(e,t=e){const i=e.vertexAttributes,r=i.get(f.a.POSITION).data,n=i.get(f.a.NORMAL).data;if(n){const e=t.getMutableAttribute(f.a.NORMAL).data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute(f.a.POSITION).data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t},e.makeOrthoBasisDirUp=i,e.makeOrthoBasisDirUpFallback=r}(_||(_={}));const v=.99619469809,y=Object(s.b)(),j=_},595:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var r=i(85),n=i(163),a=i(212),s=i(117),o=i(109),c=i(278);class l{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=Object(o.f)(),Object(c.a)(e.length>=1),Object(c.a)(i.length%this._numIndexPerPrimitive==0),Object(c.a)(i.length>=e.length*this._numIndexPerPrimitive),Object(c.a)(3===r.size||4===r.size);const{data:n,size:a}=r,l=e.length;let h=a*i[this._numIndexPerPrimitive*e[0]];u.clear(),u.push(h),this.bbMin=Object(o.h)(n[h],n[h+1],n[h+2]),this.bbMax=Object(o.d)(this.bbMin);for(let s=0;s<l;++s){const t=this._numIndexPerPrimitive*e[s];for(let e=0;e<this._numIndexPerPrimitive;++e){h=a*i[t+e],u.push(h);let r=n[h];this.bbMin[0]=Math.min(r,this.bbMin[0]),this.bbMax[0]=Math.max(r,this.bbMax[0]),r=n[h+1],this.bbMin[1]=Math.min(r,this.bbMin[1]),this.bbMax[1]=Math.max(r,this.bbMax[1]),r=n[h+2],this.bbMin[2]=Math.min(r,this.bbMin[2]),this.bbMax[2]=Math.max(r,this.bbMax[2])}}Object(s.i)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let d=this.radius*this.radius;for(let s=0;s<u.length;++s){h=u.getItemAt(s);const e=n[h]-this.center[0],t=n[h+1]-this.center[1],i=n[h+2]-this.center[2],r=e*e+t*t+i*i;if(r<=d)continue;const a=Math.sqrt(r),o=.5*(a-this.radius);this.radius=this.radius+o,d=this.radius*this.radius;const c=o/a;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=i*c}u.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(s.l)(this.bbMin,this.bbMax)>1){const e=Object(s.i)(Object(o.f)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let s=0;s<8;++s)r[s]=0;const{data:n,size:a}=this.position;for(let s=0;s<t;++s){let t=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[s];let c=a*this.indices[o],l=n[c],u=n[c+1],h=n[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=a*this.indices[o+e];const t=n[c],i=n[c+1],r=n[c+2];t<l&&(l=t),i<u&&(u=i),r<h&&(h=r)}l<e[0]&&(t|=1),u<e[1]&&(t|=2),h<e[2]&&(t|=4),i[s]=t,++r[t]}let c=0;for(let s=0;s<8;++s)r[s]>0&&++c;if(c<2)return;const u=new Array(8);for(let s=0;s<8;++s)u[s]=r[s]>0?new Uint32Array(r[s]):void 0;for(let s=0;s<8;++s)r[s]=0;for(let s=0;s<t;++s){const e=i[s];u[e][r[e]++]=this.primitiveIndices[s]}this._children=new Array(8);for(let s=0;s<8;++s)void 0!==u[s]&&(this._children[s]=new l(u[s],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){u.prune()}}const u=new a.a({deallocator:null});var h=i(560),d=i(544),p=i(562),f=i(139);class b extends h.a{constructor(e,t=[],i=n.f.Triangle,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=d.a.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,a]of e)a&&this._vertexAttributes.set(n,{...a});if(null==t||0===t.length){const e=function(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}(this._vertexAttributes),t=Object(p.d)(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const i of this._vertexAttributes.keys())this._indices.set(i,t)}else for(const[n,a]of t)a&&(this._indices.set(n,g(a)),n===f.a.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const e=new b([],void 0,this._primitiveType,void 0),{_vertexAttributes:t,_indices:i}=e;return this._vertexAttributes.forEach(((e,i)=>{t.set(i,e)})),this._indices.forEach(((e,t)=>{i.set(t,e)})),e.screenToWorldRatio=this.screenToWorldRatio,e._boundingInfo=this._boundingInfo,e}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(r.j)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return this.primitiveType===n.f.Triangle?this._computeAttachmentOriginTriangles(e):this._computeAttachmentOriginPoints(e)}_computeAttachmentOriginTriangles(e){const t=this.indices.get(f.a.POSITION),i=this.vertexAttributes.get(f.a.POSITION);return Object(p.c)(i,t,e)}_computeAttachmentOriginPoints(e){const t=this.indices.get(f.a.POSITION),i=this.vertexAttributes.get(f.a.POSITION);return Object(p.b)(i,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(f.a.POSITION);if(0===e.length)return null;const t=this.primitiveType===n.f.Triangle?3:1;Object(c.a)(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=Object(p.d)(e.length/t),r=this.vertexAttributes.get(f.a.POSITION);return new l(i,t,e,r)}}function g(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},604:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return h}));var r=i(147),n=i(421),a=i(278),s=i(139);function o(e,t,i,r,n=1){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,1===n)for(let c=0;c<o;++c)a[r]=t[e[c]],r+=s;else for(let c=0;c<o;++c){const i=t[e[c]];for(let e=0;e<n;e++)a[r]=i,r+=s}}function c(e,t,i,r){const n=i.typedBuffer,a=i.typedBufferStride,s=e.length;r*=a;for(let o=0;o<s;++o){const i=2*e[o];n[r]=t[i],n[r+1]=t[i+1],r+=a}}function l(e,t,i,r,n){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,null==n||1===n)for(let c=0;c<o;++c){const i=3*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}else for(let c=0;c<o;++c){const i=3*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}}function u(e,t,i,r,n=1){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,1===n)for(let c=0;c<o;++c){const i=4*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}else for(let c=0;c<o;++c){const i=4*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}}function h(e,t,i,r,n,a=1){if(!i)return void l(e,t,r,n,a);const s=r.typedBuffer,o=r.typedBufferStride,c=e.length,u=i[0],h=i[1],d=i[2],p=i[4],f=i[5],b=i[6],g=i[8],m=i[9],O=i[10],_=i[12],v=i[13],y=i[14];if(n*=o,1===a)for(let l=0;l<c;++l){const i=3*e[l],r=t[i],a=t[i+1],c=t[i+2];s[n]=u*r+p*a+g*c+_,s[n+1]=h*r+f*a+m*c+v,s[n+2]=d*r+b*a+O*c+y,n+=o}else for(let l=0;l<c;++l){const i=3*e[l],r=t[i],c=t[i+1],j=t[i+2],x=u*r+p*c+g*j+_,T=h*r+f*c+m*j+v,S=d*r+b*c+O*j+y;for(let e=0;e<a;++e)s[n]=x,s[n+1]=T,s[n+2]=S,n+=o}}function d(e,t,i,n,a,s=1){if(!i)return void l(e,t,n,a,s);const o=i,c=n.typedBuffer,u=n.typedBufferStride,h=e.length,d=o[0],p=o[1],f=o[2],b=o[4],g=o[5],m=o[6],O=o[8],_=o[9],v=o[10],y=!Object(r.p)(o),j=1e-6,x=1-j;if(a*=u,1===s)for(let r=0;r<h;++r){const i=3*e[r],n=t[i],s=t[i+1],o=t[i+2];let l=d*n+b*s+O*o,h=p*n+g*s+_*o,T=f*n+m*s+v*o;if(y){const e=l*l+h*h+T*T;if(e<x&&e>j){const t=1/Math.sqrt(e);l*=t,h*=t,T*=t}}c[a+0]=l,c[a+1]=h,c[a+2]=T,a+=u}else for(let r=0;r<h;++r){const i=3*e[r],n=t[i],o=t[i+1],l=t[i+2];let h=d*n+b*o+O*l,T=p*n+g*o+_*l,S=f*n+m*o+v*l;if(y){const e=h*h+T*T+S*S;if(e<x&&e>j){const t=1/Math.sqrt(e);h*=t,T*=t,S*=t}}for(let e=0;e<s;++e)c[a+0]=h,c[a+1]=T,c[a+2]=S,a+=u}}function p(e,t,i,n,a,s=1){if(!i)return void u(e,t,n,a,s);const o=i,c=n.typedBuffer,l=n.typedBufferStride,h=e.length,d=o[0],p=o[1],f=o[2],b=o[4],g=o[5],m=o[6],O=o[8],_=o[9],v=o[10],y=!Object(r.p)(o),j=1e-6,x=1-j;if(a*=l,1===s)for(let r=0;r<h;++r){const i=4*e[r],n=t[i],s=t[i+1],o=t[i+2],u=t[i+3];let h=d*n+b*s+O*o,T=p*n+g*s+_*o,S=f*n+m*s+v*o;if(y){const e=h*h+T*T+S*S;if(e<x&&e>j){const t=1/Math.sqrt(e);h*=t,T*=t,S*=t}}c[a+0]=h,c[a+1]=T,c[a+2]=S,c[a+3]=u,a+=l}else for(let r=0;r<h;++r){const i=4*e[r],n=t[i],o=t[i+1],u=t[i+2],h=t[i+3];let T=d*n+b*o+O*u,S=p*n+g*o+_*u,E=f*n+m*o+v*u;if(y){const e=T*T+S*S+E*E;if(e<x&&e>j){const t=1/Math.sqrt(e);T*=t,S*=t,E*=t}}for(let e=0;e<s;++e)c[a+0]=T,c[a+1]=S,c[a+2]=E,c[a+3]=h,a+=l}}function f(e,t,i,r,n,a=1){const s=r.typedBuffer,o=r.typedBufferStride,c=e.length;if(n*=o,1===a){if(4===i)for(let l=0;l<c;++l){const i=4*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}else if(4===i)for(let l=0;l<c;++l){const i=4*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}function b(e,t,i,r,o,l){for(const u of t.fieldNames){const t=e.vertexAttributes.get(u),b=e.indices.get(u);if(t&&b)switch(u){case s.a.POSITION:{Object(a.a)(3===t.size);const e=o.getField(u,n.u);e&&h(b,t.data,i,e,l);break}case s.a.NORMAL:{Object(a.a)(3===t.size);const e=o.getField(u,n.u);e&&d(b,t.data,r,e,l);break}case s.a.UV0:{Object(a.a)(2===t.size);const e=o.getField(u,n.m);e&&c(b,t.data,e,l);break}case s.a.COLOR:{Object(a.a)(3===t.size||4===t.size);const e=o.getField(u,n.J);e&&f(b,t.data,t.size,e,l);break}case s.a.SYMBOLCOLOR:{Object(a.a)(3===t.size||4===t.size);const e=o.getField(u,n.J);e&&f(b,t.data,t.size,e,l);break}case s.a.TANGENT:{Object(a.a)(4===t.size);const e=o.getField(u,n.C);e&&p(b,t.data,r,e,l);break}}}}},607:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return f})),i.d(t,"e",(function(){return m})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return b})),i.d(t,"h",(function(){return O})),i.d(t,"i",(function(){return _}));var r,n,a=i(222),s=i(85),o=i(147),c=i(200),l=i(109),u=i(187),h=i(797),d=i(568),p=i(746);function f(e,t,i,r,n,a,s,o,c,l,h){const d=j[h.mode];let p,f,b=0;if(Object(u.l)(e,t,i,r,c.spatialReference,n,o))return d.requiresAlignment(h)?(b=d.applyElevationAlignmentBuffer(r,n,a,s,o,c,l,h),p=a,f=s):(p=r,f=n),Object(u.l)(p,c.spatialReference,f,a,l.spatialReference,s,o)?b:void 0}function b(e,t,i,r,n){const o=(Object(h.a)(e)?e.z:Object(p.c)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=Object(s.t)(Object(p.b)(t,e,"ground"),0);return n.verticalDistanceToGround=0,n.sampledElevation=i,void(n.z=i)}case"relative-to-ground":{const a=Object(s.t)(Object(p.b)(t,e,"ground"),0),c=i.geometryZWithOffset(o,r);return n.verticalDistanceToGround=c,n.sampledElevation=a,void(n.z=c+a)}case"relative-to-scene":{const a=Object(s.t)(Object(p.b)(t,e,"scene"),0),c=i.geometryZWithOffset(o,r);return n.verticalDistanceToGround=c,n.sampledElevation=a,void(n.z=c+a)}case"absolute-height":{const a=i.geometryZWithOffset(o,r),c=Object(s.t)(Object(p.b)(t,e,"ground"),0);return n.verticalDistanceToGround=a-c,n.sampledElevation=c,void(n.z=a)}default:return Object(a.a)(i.mode),void(n.z=0)}}function g(e,t,i,r){return b(e,t,i,r,T),T.z}function m(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function O(e){return"relative-to-ground"===e||"relative-to-scene"===e}function _(e){return"absolute-height"!==e}function v(e,t,i,r,n){b(t,i,n,r,T),Object(d.h)(e,T.verticalDistanceToGround);const a=T.sampledElevation,s=Object(o.c)(x,e.transformation);return S[0]=t.x,S[1]=t.y,S[2]=T.z,Object(u.d)(t.spatialReference,S,s,r.spatialReference)?e.transformation=s:console.warn("Could not locate symbol object properly, it might be misplaced"),a}class y{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(n=r||(r={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";const j={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a,s,o){const c=o.calculateOffsetRenderUnits(s),l=o.featureExpressionInfoContext;t*=3,r*=3;for(let u=0;u<n;++u){const n=e[t+0],a=e[t+1],s=e[t+2];i[r+0]=n,i[r+1]=a,i[r+2]=null==l?s+c:c,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a){let o=0;const c=a.spatialReference;t*=3,r*=3;for(let l=0;l<n;++l){const n=e[t+0],l=e[t+1],u=e[t+2],h=Object(s.t)(a.getElevation(n,l,u,c,"ground"),0);o+=h,i[r+0]=n,i[r+1]=l,i[r+2]=h,t+=3,r+=3}return o/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a,o,c){let l=0;const u=c.calculateOffsetRenderUnits(o),h=c.featureExpressionInfoContext,d=a.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(s.t)(a.getElevation(n,o,c,d,"ground"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==h?c+p+u:p+u,t+=3,r+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a,o,c){let l=0;const u=c.calculateOffsetRenderUnits(o),h=c.featureExpressionInfoContext,d=a.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(s.t)(a.getElevation(n,o,c,d,"scene"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==h?c+p+u:p+u,t+=3,r+=3}return l/n},requiresAlignment:()=>!0}},x=Object(c.d)(),T=new y,S=Object(l.f)()},608:function(e,t,i){"use strict";var r,n;i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));class a{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=n.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},615:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return A})),i.d(t,"clip",(function(){return o})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return y})),i.d(t,"crosses",(function(){return u})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return F})),i.d(t,"difference",(function(){return j})),i.d(t,"disjoint",(function(){return g})),i.d(t,"distance",(function(){return h})),i.d(t,"equals",(function(){return d})),i.d(t,"extendedSpatialReferenceInfo",(function(){return s})),i.d(t,"flipHorizontal",(function(){return D})),i.d(t,"flipVertical",(function(){return L})),i.d(t,"generalize",(function(){return N})),i.d(t,"geodesicArea",(function(){return V})),i.d(t,"geodesicBuffer",(function(){return w})),i.d(t,"geodesicDensify",(function(){return z})),i.d(t,"geodesicLength",(function(){return k})),i.d(t,"intersect",(function(){return T})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return _})),i.d(t,"nearestCoordinate",(function(){return M})),i.d(t,"nearestVertex",(function(){return R})),i.d(t,"nearestVertices",(function(){return C})),i.d(t,"offset",(function(){return E})),i.d(t,"overlaps",(function(){return m})),i.d(t,"planarArea",(function(){return U})),i.d(t,"planarLength",(function(){return G})),i.d(t,"relate",(function(){return O})),i.d(t,"rotate",(function(){return I})),i.d(t,"simplify",(function(){return v})),i.d(t,"symmetricDifference",(function(){return x})),i.d(t,"touches",(function(){return f})),i.d(t,"union",(function(){return S})),i.d(t,"within",(function(){return b}));var r=i(518),n=i(492);function a(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return r.G.extendedSpatialReferenceInfo(e)}function o(e,t){return r.G.clip(n.hydratedAdapter,a(e),e,t)}function c(e,t){return r.G.cut(n.hydratedAdapter,a(e),e,t)}function l(e,t){return r.G.contains(n.hydratedAdapter,a(e),e,t)}function u(e,t){return r.G.crosses(n.hydratedAdapter,a(e),e,t)}function h(e,t,i){return r.G.distance(n.hydratedAdapter,a(e),e,t,i)}function d(e,t){return r.G.equals(n.hydratedAdapter,a(e),e,t)}function p(e,t){return r.G.intersects(n.hydratedAdapter,a(e),e,t)}function f(e,t){return r.G.touches(n.hydratedAdapter,a(e),e,t)}function b(e,t){return r.G.within(n.hydratedAdapter,a(e),e,t)}function g(e,t){return r.G.disjoint(n.hydratedAdapter,a(e),e,t)}function m(e,t){return r.G.overlaps(n.hydratedAdapter,a(e),e,t)}function O(e,t,i){return r.G.relate(n.hydratedAdapter,a(e),e,t,i)}function _(e){return r.G.isSimple(n.hydratedAdapter,a(e),e)}function v(e){return r.G.simplify(n.hydratedAdapter,a(e),e)}function y(e,t=!1){return r.G.convexHull(n.hydratedAdapter,a(e),e,t)}function j(e,t){return r.G.difference(n.hydratedAdapter,a(e),e,t)}function x(e,t){return r.G.symmetricDifference(n.hydratedAdapter,a(e),e,t)}function T(e,t){return r.G.intersect(n.hydratedAdapter,a(e),e,t)}function S(e,t=null){return r.G.union(n.hydratedAdapter,a(e),e,t)}function E(e,t,i,s,o,c){return r.G.offset(n.hydratedAdapter,a(e),e,t,i,s,o,c)}function A(e,t,i,s=!1){return r.G.buffer(n.hydratedAdapter,a(e),e,t,i,s)}function w(e,t,i,s,o,c){return r.G.geodesicBuffer(n.hydratedAdapter,a(e),e,t,i,s,o,c)}function M(e,t,i=!0){return r.G.nearestCoordinate(n.hydratedAdapter,a(e),e,t,i)}function R(e,t){return r.G.nearestVertex(n.hydratedAdapter,a(e),e,t)}function C(e,t,i,s){return r.G.nearestVertices(n.hydratedAdapter,a(e),e,t,i,s)}function P(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function I(e,t,i){var n;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;if(null==(i=null!=(n=i)?n:P(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(r.G.rotate(e,t,i));return s.spatialReference=a,s}function D(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(t=null!=(i=t)?i:P(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r.G.flipHorizontal(e,t));return a.spatialReference=n,a}function L(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(t=null!=(i=t)?i:P(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r.G.flipVertical(e,t));return a.spatialReference=n,a}function N(e,t,i,s){return r.G.generalize(n.hydratedAdapter,a(e),e,t,i,s)}function F(e,t,i){return r.G.densify(n.hydratedAdapter,a(e),e,t,i)}function z(e,t,i,s=0){return r.G.geodesicDensify(n.hydratedAdapter,a(e),e,t,i,s)}function U(e,t){return r.G.planarArea(n.hydratedAdapter,a(e),e,t)}function G(e,t){return r.G.planarLength(n.hydratedAdapter,a(e),e,t)}function V(e,t,i){return r.G.geodesicArea(n.hydratedAdapter,a(e),e,t,i)}function k(e,t,i){return r.G.geodesicLength(n.hydratedAdapter,a(e),e,t,i)}},620:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return b})),i.d(t,"d",(function(){return m})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return O}));var r,n,a,s=i(485),o=i(147),c=i(117),l=i(109),u=i(271),h=i(257),d=i(767),p=i(423),f=i(288);function b(e){return e?[Object(p.d)(e[0]),Object(p.d)(e[1]),Object(p.d)(e[2]),Object(p.d)(e[3]),Object(p.d)(e[4]),Object(p.d)(e[5])]:[Object(p.d)(),Object(p.d)(),Object(p.d)(),Object(p.d)(),Object(p.d)(),Object(p.d)()]}function g(e,t){for(let i=0;i<v.NUM;i++)Object(p.c)(e[i],t[i])}function m(e,t,i,a=x){const s=Object(o.m)(f.a.get(),t,e);Object(o.a)(s,s);for(let r=0;r<y.NUM;++r){const e=Object(u.m)(f.e.get(),j[r],s);Object(c.w)(a[r],e[0]/e[3],e[1]/e[3],e[2]/e[3])}!function(e,t){Object(p.f)(t[n.FAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_TOP_LEFT],e[r.LEFT]),Object(p.f)(t[n.NEAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_RIGHT],t[n.FAR_TOP_RIGHT],e[r.RIGHT]),Object(p.f)(t[n.FAR_BOTTOM_LEFT],t[n.FAR_BOTTOM_RIGHT],t[n.NEAR_BOTTOM_RIGHT],e[r.BOTTOM]),Object(p.f)(t[n.NEAR_TOP_LEFT],t[n.NEAR_TOP_RIGHT],t[n.FAR_TOP_RIGHT],e[r.TOP]),Object(p.f)(t[n.NEAR_BOTTOM_LEFT],t[n.NEAR_BOTTOM_RIGHT],t[n.NEAR_TOP_RIGHT],e[r.NEAR]),Object(p.f)(t[n.FAR_BOTTOM_RIGHT],t[n.FAR_BOTTOM_LEFT],t[n.FAR_TOP_LEFT],e[r.FAR])}(i,a)}function O(e,t){for(let i=0;i<v.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function _(e,t){for(let i=0;i<v.NUM;i++){const r=e[i];if(!Object(p.b)(r,t))return!1}return!0}(a=r||(r={}))[a.LEFT=0]="LEFT",a[a.RIGHT=1]="RIGHT",a[a.BOTTOM=2]="BOTTOM",a[a.TOP=3]="TOP",a[a.NEAR=4]="NEAR",a[a.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(n||(n={}));n.FAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_RIGHT,n.NEAR_BOTTOM_LEFT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_BOTTOM_RIGHT,n.NEAR_TOP_RIGHT,n.NEAR_TOP_LEFT,n.FAR_BOTTOM_RIGHT,n.FAR_BOTTOM_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_RIGHT,n.NEAR_BOTTOM_RIGHT,n.FAR_BOTTOM_RIGHT,n.FAR_TOP_RIGHT,n.NEAR_TOP_RIGHT,n.FAR_BOTTOM_LEFT,n.NEAR_BOTTOM_LEFT,n.NEAR_TOP_LEFT,n.FAR_TOP_LEFT,n.FAR_TOP_LEFT,n.NEAR_TOP_LEFT,n.NEAR_TOP_RIGHT,n.FAR_TOP_RIGHT;var v,y;!function(e){e[e.NUM=6]="NUM"}(v||(v={})),function(e){e[e.NUM=8]="NUM"}(y||(y={}));const j=[Object(h.g)(-1,-1,-1,1),Object(h.g)(1,-1,-1,1),Object(h.g)(1,1,-1,1),Object(h.g)(-1,1,-1,1),Object(h.g)(-1,-1,1,1),Object(h.g)(1,-1,1,1),Object(h.g)(1,1,1,1),Object(h.g)(-1,1,1,1)],x=(new s.a(d.a),[Object(l.f)(),Object(l.f)(),Object(l.f)(),Object(l.f)(),Object(l.f)(),Object(l.f)(),Object(l.f)(),Object(l.f)()])},621:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i(85),n=i(210),a=i(163),s=i(567);class o{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}destroy(){this._map.forEach(((e,t)=>{Object(r.k)(e)&&this._repository.release(this._material,c(t))}))}load(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,c(t)));const i=this._map.get(t);if(Object(r.k)(i)){if(i.ensureResources(e)===a.g.LOADED)return i;this._repository.requestRender()}return null}}function c(e){switch(e){default:case s.a.MATERIAL:return n.a.Color;case s.a.MATERIAL_ALPHA:return n.a.Alpha;case s.a.MATERIAL_DEPTH_SHADOWMAP_ALL:return n.a.Shadow;case s.a.MATERIAL_NORMAL:return n.a.Normal;case s.a.MATERIAL_DEPTH:return n.a.Depth;case s.a.MATERIAL_HIGHLIGHT:return n.a.Highlight;case s.a.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case s.a.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return n.a.Shadow}}},622:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(210),n=i(500),a=i(126);function s(e,t){e.fragment.include(n.a),t.output===r.a.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(a.a`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===r.a.Depth&&e.fragment.code.add(a.a`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},623:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return o}));var r=i(126),n=i(139);function a(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add(n.a.INSTANCEFEATUREATTRIBUTE,"vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(r.a`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(r.a`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?r.a`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(r.a`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(r.a`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?r.a`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(r.a`vec4 vvColor() { return vec4(1.0); }`)}function s(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function o(e,t){s(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function c(e,t){s(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}},624:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(126),n=i(139);function a(e,t){t.attributeColor?(e.attributes.add(n.a.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.a`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r.a`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r.a`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},625:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return o}));var r=i(500),n=i(126);function a(e){e.fragment.include(r.a),e.fragment.uniforms.add("shadowMapTex","sampler2D"),e.fragment.uniforms.add("numCascades","int"),e.fragment.uniforms.add("cascadeDistances","vec4"),e.fragment.uniforms.add("shadowMapMatrix","mat4",4),e.fragment.uniforms.add("depthHalfPixelSz","float"),e.fragment.code.add(n.a`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = cascadeDistances;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function s(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function o(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)}function c(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},626:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r,n,a=i(126),s=i(297),o=i(139);function c(e){const t=new s.a,{mode:i,isAttributeDriven:n}=e;return t.attributes.add(o.a.POSITION,"vec3"),t.attributes.add(o.a.UV0,"vec2"),e.isAttributeDriven&&(t.attributes.add(o.a.FEATUREATTRIBUTE,"float"),t.varyings.add("attributeValue","float")),t.varyings.add("unitCirclePos","vec2"),t.vertex.uniforms.add("radius","float"),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),t.vertex.code.add(a.a`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${o.a.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${n?a.a`attributeValue = ${o.a.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `),i===r.KernelDensity?t.fragment.code.add(a.a`
      void main() {
        float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
        if (radiusRatioSquared > 1.0) {
          discard;
        }

        float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
        float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${n?a.a` * attributeValue`:""};
        gl_FragColor = vec4(density);
      }
    `):i===r.GaussianBlur&&(t.fragment.uniforms.add("kernel","sampler2D"),t.fragment.code.add(a.a`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      vec2 uv = abs(unitCirclePos);
      vec2 uvX = vec2(uv.x, 0.5);
      vec2 uvY = vec2(uv.y, 0.5);
      float intensity = texture2D(kernel, uvX).r * texture2D(kernel, uvY).r${n?a.a` * attributeValue`:""};
      gl_FragColor = vec4(intensity);
    }
  `)),t}(n=r||(r={}))[n.GaussianBlur=0]="GaussianBlur",n[n.KernelDensity=1]="KernelDensity";const l=Object.freeze({__proto__:null,get HeatmapMode(){return r},build:c})},629:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return o}));var r=i(116),n=i(117),a=i(109);function s(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function o(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),a=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return Object(n.w)(e,i,r,a),e}class c{constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,i,r=0,n=!1){return(i-=r)<e?i+=this.ndiff(e-i):i>t&&(i-=this.ndiff(i-t)),n&&i===t&&(i=e),i+r}normalize(e,t=0,i=!1){return this._normalize(this.min,this.max,e,t,i)}clamp(e,t=0){return Object(r.e)(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+this.ndiff(e-t,i)}minimalMonotonic(e,t,i){return this._normalize(e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(r)?i:r}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}function l(e,t,i,r){Object(n.j)(u,t,e),Object(n.j)(h,i,e),Object(n.g)(r,u,h),Object(n.r)(r,r),r[3]=-Object(n.h)(e,r)}const u=Object(a.f)(),h=Object(a.f)();function d(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}d(new c(0,2*Math.PI));const p=d(new c(-Math.PI,Math.PI)),f=d(new c(0,360));Object(a.f)(),Object(a.f)(),Object(a.f)()},633:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(79),n=i(100),a=i(81),s=(i(84),i(82),i(83),i(80));let o=class extends n.a{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};Object(r.a)([Object(a.b)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=Object(r.a)([Object(s.a)("esri.views.support.DebugFlags")],o);const c=new o},638:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l}));var r=i(125),n=(i(82),i(89)),a=i(85),s=i(549),o=i(97),c=i(463);function l(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if("declaredClass"in e)return e;const i=new r.a({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Object(n.a)(e.symbol),i.attributes=Object(n.a)(e.attributes),i.geometry=d(e.geometry),i}function d(e){return Object(a.j)(e)?null:l(e)?e:Object(o.a)(function(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:n,m:a}=e;return{x:i,y:r,z:n,m:a,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:n}=e;return{rings:p(i),hasZ:r,hasM:n,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:n}=e;return{paths:p(i),hasZ:r,hasM:n,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:u,hasM:h}=e;return{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:u,hasM:h,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:n}=e;return{points:b(i)?f(i):i,hasZ:r,hasM:n,spatialReference:t}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return b(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Object(s.n)(e)))}function b(e){return e.length&&(Object(s.d)(e[0])||Object(s.e)(e[0]))}function g(e,t){if(!e)return null;let i;if(u(e)){if(null==t)return e.clone();if(u(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Object(c.g)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},639:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var r,n,a=i(126),s=i(139);function o(e,t){t.attributeTextureCoordinates===r.Default&&(e.attributes.add(s.a.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.vertex.code.add(a.a`void forwardTextureCoordinates() {
vuv0 = uv0;
}`)),t.attributeTextureCoordinates===r.Atlas&&(e.attributes.add(s.a.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(s.a.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),e.vertex.code.add(a.a`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`)),t.attributeTextureCoordinates===r.None&&e.vertex.code.add(a.a`void forwardTextureCoordinates() {}`)}(n=r||(r={}))[n.None=0]="None",n[n.Default=1]="Default",n[n.Atlas=2]="Atlas",n[n.COUNT=3]="COUNT"},654:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return o}));var r=i(163),n=i(94);const a={func:n.h.LESS},s={func:n.h.ALWAYS},o={mask:255},c={mask:0},l={function:{func:n.h.ALWAYS,ref:r.h.OutlineVisualElementMask,mask:r.h.OutlineVisualElementMask},operation:{fail:n.w.KEEP,zFail:n.w.KEEP,zPass:n.w.ZERO}},u={function:{func:n.h.ALWAYS,ref:r.h.OutlineVisualElementMask,mask:r.h.OutlineVisualElementMask},operation:{fail:n.w.KEEP,zFail:n.w.KEEP,zPass:n.w.REPLACE}},h={function:{func:n.h.EQUAL,ref:r.h.OutlineVisualElementMask,mask:r.h.OutlineVisualElementMask},operation:{fail:n.w.KEEP,zFail:n.w.KEEP,zPass:n.w.KEEP}},d={function:{func:n.h.NOTEQUAL,ref:r.h.OutlineVisualElementMask,mask:r.h.OutlineVisualElementMask},operation:{fail:n.w.KEEP,zFail:n.w.KEEP,zPass:n.w.KEEP}}},659:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var r=i(85),n=i(147),a=i(200),s=i(117),o=i(109),c=i(498),l=i(629),u=i(163),h=i(560),d=i(544),p=i(211),f=i(244);class b{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,n,a){this.id=Object(f.a)(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=n,this._shaderTransformation=a,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(r.k)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(s.q)(e,e,this.getStaticTransformation()),!0)}}b.pool=new p.a(b);var g=i(796),m=i(278),O=i(513);class _ extends h.a{constructor(e={}){super(),this.type=d.a.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(a.d)(),this._bvObjectSpace=new y,this._bvWorldSpace=new y,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new v),this.transformation=Object(a.d)();const{geometries:t,materials:i,transformations:r,origins:n}=e;if(Array.isArray(t)){Object(m.a)(i.length===t.length,"Object3D: materials don't match geometries"),Object(m.a)(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=b.pool.acquire(t[e],i[e],Object(a.c)(r[e]),{highlights:null,occludees:null,visible:this._visible},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n.c)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(m.a)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e,t,i,n,s){i=i||a.a,this._geometries.push(e);const o=b.pool.acquire(e,t,i,{highlights:null,occludees:null,visible:this._visible},n,s);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(r.k)(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(r.k)(t.shaderTransformation)?this._geometryRecords.some((e=>Object(r.k)(e.shaderTransformation))):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometryRecords)e.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new g.a(u.d.MaskOccludee);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(O.a)(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(O.e)(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new g.a(u.d.Highlight);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(O.a)(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(O.e)(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n.m)(Object(r.t)(t,Object(a.d)()),this.transformation,e.getStaticTransformation())}_getCombinedShaderTransformation(e,t){return t=t||Object(a.d)(),Object(n.m)(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],i=e.boundingInfo;Object(r.k)(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this._getCombinedShaderTransformation(t)))}Object(s.i)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(s.i)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o.f)(),t=Object(o.f)(),i=Object(l.c)(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const a=this._geometries[n].boundingInfo;if(Object(r.j)(a))continue;const o=this._geometryRecords[n].getShaderTransformation(),c=Object(l.c)(o);Object(s.q)(e,a.getCenter(),o);const u=Object(s.m)(e,this._bvObjectSpace.bounds),h=a.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],u+h),Object(s.q)(t,e,this.transformation);const d=Object(s.m)(t,this._bvWorldSpace.bounds),p=h*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),n=e.getBBMax(),a=Object(o.d)(r),c=Object(o.d)(n);Object(s.q)(a,a,i),Object(s.q)(c,c,i);for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],c[s]),t.max[s]=Math.max(t.max[s],a[s],c[s]);for(let o=0;o<3;++o){Object(s.k)(a,r),Object(s.k)(c,n),a[o]=n[o],c[o]=r[o],Object(s.q)(a,a,i),Object(s.q)(c,c,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],a[e],c[e]),t.max[e]=Math.max(t.max[e],a[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(r.k)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(r.k)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class v{constructor(){this.min=Object(o.h)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o.h)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class y extends v{constructor(){super(...arguments),this.bounds=Object(c.c)()}init(){Object(s.w)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(s.w)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c.a)(this.bounds)}}},674:function(e,t,i){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let r=0;r<e.length;r++){const n=e[r].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}function a(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:r}=t;return(n(i,e)+n(r,e))/2}));let r=0;const a=i.length;if(0===a)return e;for(let n=0;n<a;n++)r+=i[n];const s=Math.floor(r/a);return Math.max(s,e)}function s(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?a(i,t.visualVariables):i;if("simple"===t.type)return r(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos.forEach((t=>{e=r(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=r(e,t.symbol)})),e}return t.type,n}i.d(t,"a",(function(){return s}))},675:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i(79),n=i(100),a=i(87),s=i(85),o=i(91),c=i(81),l=(i(84),i(82),i(83),i(80)),u=i(701),h=i(574),d=i(745);const p=a.a.getLogger("esri.views.interactive.InteractiveToolBase");let f=class extends n.a{constructor(e){super(e),this.manipulators=new d.a,this.updating=!1,this.automaticManipulatorSelection=!0,this._editableFlags=new Map([[h.a.MANAGER,!0],[h.a.USER,!0]]),this._creationStartedResolver=Object(o.f)(),this._creationFinishedResolver=Object(o.f)()}set toolState(e){this._set("toolState",e),this._syncVisible()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(h.a.USER)}set editable(e){this.setEditableFlag(h.a.USER,e)}get created(){return"created"===this.toolState}get cursor(){return null}initialize(){this._syncVisible()}destroy(){this.manipulators.destroy(),this._set("view",null)}activate(){Object(s.j)(this.view)?p.error("Can't activate tool if view is not defined."):(Object(u.b)(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===h.a.USER&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(e){return this._editableFlags.get(e)}whenCreationStarted(){return this._creationStartedResolver.promise}whenCreated(){return this._creationFinishedResolver.promise}rejectCreation(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(h.a.USER)&&this.getEditableFlag(h.a.MANAGER)}startToolCreation(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}}_syncVisible(){if("pending"!==this.toolState)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};Object(r.a)([Object(c.b)({value:"pending"})],f.prototype,"toolState",null),Object(r.a)([Object(c.b)({constructOnly:!0})],f.prototype,"view",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],f.prototype,"active",null),Object(r.a)([Object(c.b)({value:!0})],f.prototype,"visible",null),Object(r.a)([Object(c.b)({value:!0})],f.prototype,"editable",null),Object(r.a)([Object(c.b)({readOnly:!0})],f.prototype,"created",null),Object(r.a)([Object(c.b)({readOnly:!0})],f.prototype,"manipulators",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],f.prototype,"updating",void 0),Object(r.a)([Object(c.b)()],f.prototype,"cursor",null),Object(r.a)([Object(c.b)()],f.prototype,"automaticManipulatorSelection",void 0),f=Object(r.a)([Object(l.a)("esri.views.interactive.InteractiveToolBase")],f)},676:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(85),n=i(645),a=i(855);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n.a)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=Object(a.d)(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n.c)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(r.t)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(Object(r.j)(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(r.k)(t)&&Object(r.k)(i)?(this._featureExpressionInfoContext=Object(a.a)(e),Object(a.f)(this._featureExpressionInfoContext,Object(a.c)(n.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return Object(r.k)(e)&&t.setFromElevationInfo(e),t}}},687:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(126),n=i(139);function a(e,t=!0){e.attributes.add(n.a.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(r.a`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?r.a`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},688:function(e,t,i){"use strict";i.d(t,"a",(function(){return P}));i(99);var r=i(222),n=i(138),a=i(116),s=i(85),o=i(102),c=i(152),l=i(233),u=i(367),h=i(147),d=i(200),p=i(151),f=i(117),b=i(109),g=i(187),m=i(208),O=i(118),_=i(499),v=i(423),y=i(360),j=i(288),x=i(638),T=i(746),S=i(801),E=i(748),A=i(659),w=i(163),M=i(776),R=i(574),C=i(113);class P{constructor(e){this.camera=new E.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(d.d)(),this._worldFrame=null,this._renderLocation=Object(b.f)(),this._renderLocationDirty=!0,this._location=new C.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new C.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=R.b.None,this._focused=!1,this.events=new n.a.EventEmitter,this._screenLocation={screenPointArray:Object(o.f)(),renderScreenPointArray:Object(o.d)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(c.d)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){I(e)&&(this._screenLocationDirty=!0),Object(h.c)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(d.d)()),function(e,t,i){switch(e.viewingMode){case"local":return Object(h.i)(i),!0;case"global":{const r=Object(m.e)(e.renderCoordsHelper.spatialReference);Object(g.w)(t,0,V,0,r.radius),Object(g.c)(Object(a.g)(V[0]),Object(a.g)(V[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(x.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(x.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=Object(s.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,I(this._modelTransform)){const t=this._calculateModelTransformOffset(q);e=Object(f.f)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=Object(o.i)(e,D),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(p.a)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,U),c=n*this.screenLocation.pixelSize,l=Object(S.b)(this.camera,i,N);if(Object(s.j)(l))return null;for(const i of e){if(0===i.length)continue;const e=Object(f.q)(V,i[0],r);for(let t=1;t<i.length;t++){const n=Object(f.q)(k,i[t],r),s=Object(_.b)(Object(_.f)(e,n,L),l);if(null!=s&&s<c*c){const t=Object(f.f)(j.d.get(),e,n);Object(f.e)(t,t,.5);const i=Object(o.a)(j.d.get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(f.k)(e,n)}}break}case"disc":{var c;const e=this.collisionType.direction,t=null!=(c=this.collisionType.offset)?c:b.c,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,U),u=n*this.screenLocation.pixelSize,h=Object(S.b)(this.camera,i,N);if(Object(s.j)(h))return null;const d=Object(l.f)(F,o),p=Object(f.x)(B,e,d),g=Object(f.q)(W,t,o);Object(v.g)(g,p,G);const m=H;if(Object(v.m)(G,h,m)&&Object(f.l)(m,g)<u*u)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(r,U),u=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),h=Object(S.b)(this.camera,i,N);if(Object(s.j)(h))return null;const d=Object(l.f)(F,c),p=Object(f.x)(B,t,d),b=this._calculateModelTransformPosition(W);Object(v.g)(b,p,G);const g=H;if(!Object(v.m)(G,h,g))break;for(const i of e){if(0===i.length)continue;const e=Object(f.q)(V,i[0],c);for(let t=1;t<i.length;t++){const r=Object(f.q)(k,i[t],c),n=Object(_.e)(Object(_.f)(e,r,L),g);if(null!=n&&n<u*u){const t=Object(f.f)(j.d.get(),e,r);Object(f.e)(t,t,.5);const i=Object(o.a)(j.d.get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(f.k)(e,r)}}break}default:Object(r.a)(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(Object(s.j)(i.engineLayerId)){const e=new M.a({isPickable:!1,updatePolicy:w.j.SYNC});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(s.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(g.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new C.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(g.n)(this.location,Z,e.spatialReference),Object(O.h)(e.extent,Z)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(s.j)(this.elevationInfo))return!1;let t=null,i=0;const r=Object(s.t)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(s.t)(Object(T.b)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(s.t)(Object(T.b)(this.view.elevationProvider,e,"ground"),0)+r;break;case"relative-to-scene":i=Object(s.t)(Object(T.b)(this.view.elevationProvider,e,"scene"),0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=U;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?R.c.Focused:R.c.Unfocused)|(this.selected?R.c.Selected:R.c.Unselected),n=this._noDisplayCount>0;for(const{stateMask:a,objects:s}of i){if(n){for(const e of s)e.setVisible(!1);continue}const e=(a&R.c.All)!==R.c.None,i=(a&R.b.All)!==R.b.None,o=!e||(r&a)==(a&R.c.All),c=!i||(this.state&a)==(a&R.b.All);if(o&&c)for(const r of s)r.setVisible(!0),r.transformation=t;else for(const t of s)t.setVisible(!1)}}_ensureEngineResources(){if(Object(s.j)(this._engineResources)){const e=Object(s.s)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));const r=(e,t)=>{const{geometry:i,material:r,transform:n}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,r,n))):e.addGeometry(i,r,n)},n=new Map;this._renderObjects.forEach((e=>{const t=new A.a({castShadow:!1});r(t,e);const i=e.stateMask||0,a=n.get(i)||[];a.push(t),n.set(i,a)}));const a=[];n.forEach(((e,t)=>a.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=Object(s.s)(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||Object(s.j)(this._engineResources)||!this.view._stage)return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),r.forEach((e=>{const t=Object(s.s)(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,z);return Object(f.w)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Object(f.j)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(h.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(h.m)(t,t,this._worldFrame),Object(h.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(s.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(Object(s.k)(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function I(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const D=Object(o.f)(),L=Object(_.d)(),N=Object(y.c)(),F=Object(u.b)(),z=Object(d.d)(),U=Object(d.d)(),G=Object(v.d)(),V=Object(b.f)(),k=Object(b.f)(),H=Object(b.f)(),B=Object(b.f)(),W=Object(b.f)(),q=Object(b.f)(),Z=new C.a({x:0,y:0,z:0,spatialReference:null})},692:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return d}));var r=i(382),n=i(139),a=i(94),s=i(279);new s.a(n.a.POSITION,3,a.k.FLOAT,0,12),new s.a(n.a.POSITION,3,a.k.FLOAT,0,20),new s.a(n.a.UV0,2,a.k.FLOAT,12,20),new s.a(n.a.POSITION,3,a.k.FLOAT,0,32),new s.a(n.a.NORMAL,3,a.k.FLOAT,12,32),new s.a(n.a.UV0,2,a.k.FLOAT,24,32),new s.a(n.a.POSITION,3,a.k.FLOAT,0,16),new s.a(n.a.COLOR,4,a.k.UNSIGNED_BYTE,12,16);const o=[new s.a(n.a.POSITION,2,a.k.FLOAT,0,8)],c=[new s.a(n.a.POSITION,2,a.k.FLOAT,0,16),new s.a(n.a.UV0,2,a.k.FLOAT,8,16)];var l=i(162),u=i(203),h=i(164);function d(e,t=o,i=r.a,n=-1,s=1){let u=null;return u=t===c?new Float32Array([n,n,0,0,s,n,1,0,n,s,0,1,s,s,1,1]):new Float32Array([n,n,s,n,n,s,s,s]),new h.a(e,i,{geometry:t},{geometry:l.a.createVertex(e,a.D.STATIC_DRAW,u)})}function p(e){return new u.a(e,{target:a.A.TEXTURE_2D,pixelFormat:a.p.RGBA,dataType:a.q.UNSIGNED_BYTE,samplingMode:a.z.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},699:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));i(99);var r=i(85),n=i(114),a=i(674),s=i(101);function o(e,t,i,a=new s.a){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const a=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;o=Object(r.k)(s)&&!s.equals(i.spatialReference)?Object(n.e)(s)/Object(n.e)(i.spatialReference):t*a}const c=e.x-o,l=e.y-o,u=e.x+o,h=e.y+o,{spatialReference:d}=i;return a.xmin=Math.min(c,u),a.ymin=Math.min(l,h),a.xmax=Math.max(c,u),a.ymax=Math.max(l,h),a.spatialReference=d,a}function c(e,t,i){const n=i.toMap(e);return!Object(r.j)(n)&&o(n,Object(a.a)(),i,l).intersects(t)}const l=new s.a},713:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return o}));var r=i(495),n=i(139),a=i(604);const s=Object(r.a)().vec3f(n.a.POSITION),o=Object(r.a)().vec3f(n.a.POSITION).vec2f(n.a.UV0),c=Object(r.a)().vec3f(n.a.POSITION).vec4u8(n.a.COLOR);class l{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(n.a.POSITION).length}write(e,t,i,r){Object(a.d)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}},725:function(e,t,i){"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function n(e,t,i,n){for(let o=0;o<n;++o)a[0]=e[o],r(a,s,1),t[o]=s[0],i[o]=s[1]}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const a=new Float64Array(1),s=new Float32Array(2)},726:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(94),n=i(279);function a(e,t=0){const i=e.stride;return e.fieldNames.filter((t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)})).map((r=>{const a=e.fields.get(r),o=a.constructor.ElementCount,c=s(a.constructor.ElementType),l=a.offset,u=!(!a.optional||!a.optional.glNormalized);return new n.a(r,o,c,l,i,u,t)}))}function s(e){const t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const o={u8:r.k.UNSIGNED_BYTE,u16:r.k.UNSIGNED_SHORT,u32:r.k.UNSIGNED_INT,i8:r.k.BYTE,i16:r.k.SHORT,i32:r.k.INT,f32:r.k.FLOAT}},730:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){e.vertex.code.add(r.a`const float PI = 3.141592653589793;`),e.fragment.code.add(r.a`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},731:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i(272),n=i(747),a=i(126);function s(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(n.a),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(a.a`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${t.viewingMode===r.a.Global?a.a`vec3 worldNormal = normalize(worldPos + localOrigin);`:a.a`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?a.a`
          float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:a.a`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(a.a`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function o(e,t,i){if(!t.verticalOffset)return;const r=function(e,t,i,r=c){return r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*i),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),n=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",r.screenLength*n,r.perDistance,r.minWorldLength,r.maxWorldLength)}const c={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},732:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(210),n=i(126);function a(e,t){t.output===r.a.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(n.a`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===r.a.Depth||t.output===r.a.Shadow?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("nearFar","vec2"),e.vertex.code.add(n.a`void forwardLinearDepth() {
linearDepth = (-position_view().z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(n.a`void forwardLinearDepth() {}`)}},733:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return q})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return R})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return M})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return x})),i.d(t,"i",(function(){return I})),i.d(t,"j",(function(){return P})),i.d(t,"k",(function(){return v}));i(82);var r=i(87),n=i(116),a=i(485),s=i(147),o=i(200),c=i(117),l=i(109),u=i(584),h=i(499),d=i(423),p=i(360),f=i(526),b=i(288);const g=r.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function m(e=z){return{plane:Object(d.d)(e.plane),origin:Object(l.d)(e.origin),basis1:Object(l.d)(e.basis1),basis2:Object(l.d)(e.basis2)}}function O(e,t=m()){return _(e.origin,e.basis1,e.basis2,t)}function _(e,t,i,r=m()){return Object(c.k)(r.origin,e),Object(c.k)(r.basis1,t),Object(c.k)(r.basis2,i),v(r),function(e,t){Math.abs(Object(c.h)(e.basis1,e.basis2)/(Object(c.p)(e.basis1)*Object(c.p)(e.basis2)))>1e-6&&g.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c.h)(e.basis1,I(e)))>1e-6&&g.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c.h)(I(e),e.origin)-e.plane[3])>1e-6&&g.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function v(e){Object(d.i)(e.basis2,e.basis1,e.origin,e.plane)}function y(e,t,i){e!==i&&O(e,i);const r=Object(c.e)(b.d.get(),I(e),t);return Object(c.f)(i.origin,i.origin,r),i.plane[3]-=t,i}function j(e,t=m()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return Object(c.w)(t.origin,e[0]+i,e[1]+r,0),Object(c.w)(t.basis1,i,0,0),Object(c.w)(t.basis2,0,r,0),Object(d.h)(0,0,1,0,t.plane),t}function x(e,t,i){return!!Object(d.m)(e.plane,t,i)&&D(e,i)}function T(e,t,i){const r=U.get();F(e,t,r,U.get());let a=Number.POSITIVE_INFINITY;for(const s of H){const o=N(e,s,G.get()),l=b.d.get();if(Object(d.k)(r,o,l)){const e=Object(c.v)(b.d.get(),t.origin,l),r=Math.abs(Object(n.b)(Object(c.h)(t.direction,e)));r<a&&(a=r,Object(c.k)(i,l))}}return a===Number.POSITIVE_INFINITY?S(e,t,i):i}function S(e,t,i){if(x(e,t,i))return i;const r=U.get(),n=U.get();F(e,t,r,n);let a=Number.POSITIVE_INFINITY;for(const s of H){const o=N(e,s,G.get()),l=b.d.get();if(Object(d.l)(r,o,l)){const e=Object(p.d)(t,l);if(!Object(d.o)(n,l))continue;e<a&&(a=e,Object(c.k)(i,l))}}return w(e,t.origin)<a&&E(e,t.origin,i),i}function E(e,t,i){const r=Object(d.r)(e.plane,t,b.d.get()),n=Object(h.i)(L(e,e.basis1),r,-1,1,b.d.get()),a=Object(h.i)(L(e,e.basis2),r,-1,1,b.d.get());return Object(c.j)(i,Object(c.f)(b.d.get(),n,a),e.origin),i}function A(e,t,i){const{origin:r,basis1:n,basis2:a}=e,s=Object(c.j)(b.d.get(),t,r),o=Object(f.d)(n,s),l=Object(f.d)(a,s),u=Object(f.d)(I(e),s);return Object(c.w)(i,o,l,u)}function w(e,t){const i=A(e,t,b.d.get()),{basis1:r,basis2:n}=e,a=Object(c.p)(r),s=Object(c.p)(n),o=Math.max(Math.abs(i[0])-a,0),l=Math.max(Math.abs(i[1])-s,0),u=i[2];return o*o+l*l+u*u}function M(e,t){return Math.sqrt(w(e,t))}function R(e,t){return Object(d.o)(e.plane,t)&&D(e,t)}function C(e,t){const i=-e.plane[3];return Object(f.d)(I(e),t)-i}function P(e,t,i,r){return e!==r&&O(e,r),Object(s.d)(W,t,i),Object(c.q)(r.basis1,e.basis1,W),Object(c.q)(r.basis2,e.basis2,W),v(r),r}function I(e){return Object(d.q)(e.plane)}function D(e,t){const i=Object(c.j)(b.d.get(),t,e.origin),r=Object(c.t)(e.basis1),n=Object(c.t)(e.basis2),a=Object(c.h)(e.basis1,i),s=Object(c.h)(e.basis2,i);return-a-r<0&&a-r<0&&-s-n<0&&s-n<0}function L(e,t){const i=G.get();return Object(c.k)(i.origin,e.origin),Object(c.k)(i.vector,t),i}function N(e,t,i){const{basis1:r,basis2:n,origin:a}=e,s=Object(c.e)(b.d.get(),r,t.origin[0]),o=Object(c.e)(b.d.get(),n,t.origin[1]);Object(c.f)(i.origin,s,o),Object(c.f)(i.origin,i.origin,a);const l=Object(c.e)(b.d.get(),r,t.direction[0]),u=Object(c.e)(b.d.get(),n,t.direction[1]);return Object(c.e)(i.vector,Object(c.f)(l,l,u),2),i}function F(e,t,i,r){const n=I(e);Object(d.i)(n,t.direction,t.origin,i),Object(d.i)(Object(d.q)(i),n,t.origin,r)}const z={plane:Object(d.d)(),origin:Object(l.h)(0,0,0),basis1:Object(l.h)(1,0,0),basis2:Object(l.h)(0,1,0)},U=new a.a(d.d),G=new a.a(h.d),V=Object(l.f)(),k=new a.a((()=>({origin:null,basis1:null,basis2:null,plane:null}))),H=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],B=Object(o.d)(),W=Object(o.d)(),q=Object.freeze({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=Object(d.d)(),this.origin=Object(l.f)(),this.basis1=Object(l.f)(),this.basis2=Object(l.f)()}},create:m,wrap:function(e,t,i){const r=k.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=Object(d.u)(0,0,0,0),v(r),r},copy:O,copyWithoutVerify:function(e,t){Object(c.k)(t.origin,e.origin),Object(c.k)(t.basis1,e.basis1),Object(c.k)(t.basis2,e.basis2),Object(d.c)(t.plane,e.plane)},fromValues:_,updateUnboundedPlane:v,elevate:y,setExtent:function(e,t,i){return j(t,i),y(i,C(e,e.origin),i),i},fromAABoundingRect:j,intersectRay:x,intersectRayClosestSilhouette:function(e,t,i){if(x(e,t,i))return i;const r=T(e,t,b.d.get());return Object(c.f)(i,t.origin,Object(c.e)(b.d.get(),t.direction,Object(c.m)(t.origin,r)/Object(c.p)(t.direction))),i},closestPointOnSilhouette:T,closestPoint:S,projectPoint:E,projectPointLocal:A,distance2:w,distance:M,distanceToSilhouette:function(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of H){const n=N(e,r,G.get()),a=Object(h.e)(n,t);a>i&&(i=a)}return Math.sqrt(i)},extrusionContainsPoint:R,axisAt:function(e,t,i,r){return function(e,t,i){switch(t){case u.a.X:Object(c.k)(i,e.basis1),Object(c.r)(i,i);break;case u.a.Y:Object(c.k)(i,e.basis2),Object(c.r)(i,i);break;case u.a.Z:Object(c.k)(i,I(e))}return i}(e,i,r)},altitudeAt:C,setAltitudeAt:function(e,t,i,r){const n=C(e,t),a=Object(c.e)(V,I(e),i-n);return Object(c.f)(r,t,a),r},equals:function(e,t){return Object(c.o)(e.basis1,t.basis1)&&Object(c.o)(e.basis2,t.basis2)&&Object(c.o)(e.origin,t.origin)},transform:function(e,t,i){return e!==i&&O(e,i),Object(s.a)(B,t),Object(s.t)(B,B),Object(c.q)(i.basis1,e.basis1,B),Object(c.q)(i.basis2,e.basis2,B),Object(c.q)(Object(d.q)(i.plane),Object(d.q)(e.plane),B),Object(c.q)(i.origin,e.origin,t),Object(d.s)(i.plane,i.plane,i.origin),i},rotate:P,normal:I,UP:z})},734:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return _})),i.d(t,"c",(function(){return O}));var r=i(85),n=i(233),a=i(367),s=i(147),o=i(200),c=i(543),l=i(462),u=i(117),h=i(446),d=i(109),p=i(257),f=i(498);class b{constructor(){this._transform=Object(o.d)(),this._transformInverse=new g({value:this._transform},s.a,o.d),this._transformInverseTranspose=new g(this._transformInverse,s.t,o.d),this._transformTranspose=new g({value:this._transform},s.t,o.d),this._transformInverseRotation=new g({value:this._transform},n.k,a.b)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s.c)(this._transform,e)}multiplyTransform(e){Object(s.m)(this._transform,this._transform,e)}set(e){Object(s.c)(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}}class g{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const m=new class{constructor(e=0){this.offset=e,this.sphere=Object(f.c)(),this.tmpVertex=Object(d.f)()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let n=r[0]*e+r[4]*t+r[8]*i+r[12],a=r[1]*e+r[5]*t+r[9]*i+r[13],s=r[2]*e+r[6]*t+r[10]*i+r[14];const o=this.offset/Math.sqrt(n*n+a*a+s*s);n+=n*o,a+=a*o,s+=s*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*a+c[8]*s+c[12],this.tmpVertex[1]=c[1]*n+c[5]*a+c[9]*s+c[13],this.tmpVertex[2]=c[2]*n+c[6]*a+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function O(e){return Object(r.k)(e)?(m.offset=e,m):null}new class{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(d.f)(),this.mbs=Object(p.e)(),this.obb={center:Object(d.f)(),halfSize:Object(h.b)(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,n=t,a=i+this.componentLocalOriginLength,s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,n=e[3],a=e[4],s=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(n*n+a*a+s*s);return e[3]+=n*c,e[4]+=a*c,e[5]+=s*c,e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){const t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(u.u)(this.obb.halfSize,e.halfSize,e.quaternion),Object(u.f)(this.obb.halfSize,this.obb.halfSize,e.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(u.j)(this.obb.halfSize,this.obb.halfSize,e.center),Object(c.a)(v,e.quaternion),Object(u.u)(this.obb.halfSize,this.obb.halfSize,v),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}};new class{constructor(e=0){this.offset=e,this.tmpVertex=Object(d.f)()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],n=t+this.localOrigin[1],a=i+this.localOrigin[2],s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){const t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],n=e[3]+this.localOrigin[0],a=e[4]+this.localOrigin[1],s=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(n*n+a*a+s*s);return e[3]+=n*c,e[4]+=a*c,e[5]+=s*c,e}};const _="terrain",v=Object(l.b)()},737:function(e,t,i){"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return r}))},743:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return s}));i(82);function r(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function n(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function a(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function s(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}},745:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r,n,a=i(111),s=i(85);(n=r||(r={}))[n.WhenToolEditable=0]="WhenToolEditable",n[n.WhenToolNotEditable=1]="WhenToolNotEditable",n[n.Always=2]="Always";class o{constructor(){this._isToolEditable=!0,this._manipulators=new a.a,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=r.WhenToolEditable){return this.addMany([e],t)[0]}addMany(e,t=r.WhenToolEditable){return e.map((e=>{const i=this._nextManipulatorId++,r={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r),i}))}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this._manipulators.forEach((({manipulator:e})=>{e.destroy&&e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,r=Number.MAX_VALUE;return this._manipulators.forEach((({id:n,manipulator:a,attached:o})=>{if(!o||!a.interactive)return;const c=a.intersectionDistance(e,t);Object(s.k)(c)&&c<r&&(r=c,i={id:n,manipulator:a})})),i}findById(e){if(Object(s.j)(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===r.Always||(this._isToolEditable?e.visibilityPredicate===r.WhenToolEditable:e.visibilityPredicate===r.WhenToolNotEditable)}}},746:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s}));var r=i(85),n=i(797);class a{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function s(e){return"array"in e}function o(e,t,i="ground"){if(Object(n.a)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(r.t)(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},747:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(126),n=i(434);function a(e){e.vertex.code.add(r.a`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(r.a`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(r.a`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(r.a`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(r.a`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(r.a`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(r.a`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function s(e,t){if(t.screenSizePerspective){Object(n.a)(t.screenSizePerspective,e,"screenSizePerspective");const i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(n.a)(i,e,"screenSizePerspectiveAlignment")}}},748:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r=i(87),n=i(116),a=i(85),s=i(102),o=i(147),c=i(200),l=i(151),u=i(219),h=i(117),d=i(109),p=i(271),f=i(257),b=i(620),g=i(360),m=i(526),O=i(272),_=i(278);const v=r.a.getLogger("esri.views.3d.webgl-engine.lib.Camera");class y{constructor(e=null,t=null,i=null){this._viewUp=Object(d.f)(),this._viewForward=Object(d.f)(),this._viewRight=Object(d.f)(),this._ray=Object(g.c)(),this._viewport=Object(f.g)(0,0,1,1),this._padding=Object(f.g)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(u.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c.d)(),this._projectionDirty=!0,this._projectionMatrix=Object(c.d)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c.d)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c.d)(),this._frustumDirty=!0,this._frustum=Object(b.c)(),this._fullViewport=Object(f.e)(),this.pixelRatio=1,this.relativeElevation=0,Object(a.k)(e)&&Object(h.k)(this._ray.origin,e),this._center=Object(a.k)(t)?Object(d.d)(t):Object(d.f)(),this._up=Object(a.k)(i)?Object(d.d)(i):Object(d.h)(0,0,1)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(h.j)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[A.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[A.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[A.RIGHT]+this._padding[A.LEFT]}set fullWidth(e){this.width=e-(this._padding[A.RIGHT]+this._padding[A.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[A.TOP]+this._padding[A.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[A.TOP]+this._padding[A.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[A.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[A.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[A.TOP]===e[A.TOP]&&this._padding[A.RIGHT]===e[A.RIGHT]&&this._padding[A.BOTTOM]===e[A.BOTTOM]&&this._padding[A.LEFT]===e[A.LEFT]||(this._viewport[0]+=e[A.LEFT]-this._padding[A.LEFT],this._viewport[1]+=e[A.BOTTOM]-this._padding[A.BOTTOM],this._viewport[2]-=e[A.RIGHT]+e[A.LEFT]-(this._padding[A.RIGHT]+this._padding[A.LEFT]),this._viewport[3]-=e[A.TOP]+e[A.BOTTOM]-(this._padding[A.TOP]+this._padding[A.BOTTOM]),Object(p.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(o.l)(this._projectionMatrix,-r*(1+2*this._padding[A.LEFT]/e),r*(1+2*this._padding[A.RIGHT]/e),-i*(1+2*this._padding[A.BOTTOM]/t),i*(1+2*this._padding[A.TOP]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(o.c)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(_.b)(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(_.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(_.c)(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(_.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(h.m)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o.a)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(h.k)(this._ray.origin,e.eye),Object(h.k)(this._center,e.center),Object(h.k)(this._up,e.up),Object(p.c)(this._viewport,e.viewport),Object(p.c)(this._padding,e.padding),Object(l.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o.c)(this._viewMatrix,e.viewMatrix),Object(h.k)(this._viewRight,e.viewRight),Object(h.k)(this._viewUp,e.viewUp),Object(h.k)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o.c)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(b.b)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new y).copyFrom(this)}equals(e){return Object(h.o)(this.eye,e.eye)&&Object(h.o)(this._center,e.center)&&Object(h.o)(this._up,e.up)&&Object(p.g)(this._viewport,e.viewport)&&Object(p.g)(this._padding,e.padding)&&Object(l.e)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4;Object(h.z)(T,e.eye,e.center),Object(h.z)(S,this.eye,this._center);const i=Object(h.h)(T,S),r=Object(h.A)(T),n=Object(h.A)(S);return i*i>=(1-1e-10)*r*n&&Object(h.B)(e.eye,this.eye)<Math.max(r,n)*t*t&&Object(p.i)(e.padding,this._padding)<.5&&Object(p.i)(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(Object(m.d)(this.viewForward,Object(h.j)(T,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(s.f)()){return e[0]=(this.padding[A.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[A.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[A.LEFT]+this.width*t,e[1]=this.padding[A.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t,i=!1){e!==j&&Object(h.k)(j,e),j[3]=1,i&&(t[2]=-j[2]),Object(p.m)(j,j,this.projectionMatrix),Object(h.e)(j,j,1/Math.abs(j[3]));const r=this.fullViewport;return t[0]=Object(n.k)(0,r[0]+r[2],.5+.5*j[0]),t[1]=Object(n.k)(0,r[1]+r[3],.5+.5*j[1]),i||(t[2]=.5*(j[2]+1)),t}projectToScreen(e,t){this.projectToRenderScreen(e,E),this.renderToScreen(E,t)}projectToRenderScreen(e,t){if(j[0]=e[0],j[1]=e[1],j[2]=e[2],j[3]=1,Object(p.m)(j,j,this.viewProjectionMatrix),0===j[3])return null;Object(h.e)(j,j,1/Math.abs(j[3]));const i=this.fullViewport;return"x"in t?(t.x=Object(n.k)(0,i[0]+i[2],.5+.5*j[0]),t.y=Object(n.k)(0,i[1]+i[3],.5+.5*j[1])):(t[0]=Object(n.k)(0,i[0]+i[2],.5+.5*j[0]),t[1]=Object(n.k)(0,i[1]+i[3],.5+.5*j[1]),t.length>2&&(t[2]=.5*(j[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,E),t)}unprojectFromRenderScreen(e,t){if(Object(o.m)(x,this.projectionMatrix,this.viewMatrix),!Object(o.a)(x,x))return null;const i=this.fullViewport;return j[0]=2*(e[0]-i[0])/i[2]-1,j[1]=2*(e[1]-i[1])/i[3]-1,j[2]=2*e[2]-1,j[3]=1,Object(p.m)(j,j,x),0===j[3]?null:(t[0]=j[0]/j[3],t[1]=j[1]/j[3],t[2]=j[2]/j[3],t)}constrainWindowSize(e,t,i,r=i){const n=e*this.pixelRatio,a=t*this.pixelRatio,s=Math.max(n-i/2,0),o=Math.max(this.fullHeight-a-r/2,0),c=-Math.min(n-i/2,0),l=-Math.min(this.fullHeight-a-r/2,0);return[s,o,i-c- -Math.min(this.fullWidth-n-i/2,0),r-l- -Math.min(a-r/2,0)]}computeUp(e){e===O.a.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){Object(h.j)(T,this.center,this.eye);const e=Object(h.p)(this.center);e<1?(Object(h.w)(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(h.h)(T,this.center))>.9999*Object(h.p)(T)*e||(Object(h.g)(this._up,T,this.center),Object(h.g)(this._up,this._up,T),Object(h.r)(this._up,this._up),this._markViewDirty())}_computeUpLocal(){Object(h.v)(T,this.eye,this.center),Math.abs(T[2])<=.9999&&(Object(h.e)(T,T,T[2]),Object(h.w)(this._up,-T[0],-T[1],1-T[2]),Object(h.r)(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(h.o)(e,t)||(Object(h.k)(t,e),this._markViewDirty()):v.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(b.d)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o.n)(this._viewMatrix,this.eye,this._center,this._up),Object(h.w)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(h.w)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(h.w)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const j=Object(f.e)(),x=Object(c.d)(),T=Object(d.f)(),S=Object(d.f)(),E=Object(s.d)();var A,w;(w=A||(A={}))[w.TOP=0]="TOP",w[w.RIGHT=1]="RIGHT",w[w.BOTTOM=2]="BOTTOM",w[w.LEFT=3]="LEFT"},749:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return A})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return M})),i.d(t,"e",(function(){return x})),i.d(t,"f",(function(){return S})),i.d(t,"g",(function(){return T})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return y})),i.d(t,"j",(function(){return E}));var r,n,a=i(85),s=i(102),o=i(117),c=i(109),l=i(187),u=i(423),h=i(360),d=i(526),p=i(288),f=i(416),b=i(801),g=i(752),m=i(608),O=i(734),_=i(490);function v(e,t){return j(e,(()=>t))}function y(e){return j(e,(e=>e.plane))}function j(e,t){const i=Object(c.f)(),r=Object(c.f)();let n=!1;return o=>{const c=t(o);if("start"===o.action){const t=Object(s.i)(o.screenStart,Object(s.c)(p.c.get())),r=Object(b.b)(e.state.camera,t,P);Object(a.k)(r)&&(n=Object(u.m)(c,r,i))}if(!n)return null;const l=Object(s.i)(o.screenEnd,Object(s.c)(p.c.get())),h=Object(b.b)(e.state.camera,l,P);return Object(a.j)(h)?null:Object(u.m)(c,h,r)?{...o,renderStart:i,renderEnd:r,plane:c,ray:h}:null}}function x(e,t,i,r=null,n=null){return function(e,t,i,r=null,n=null){let o=null;return c=>{if("start"===c.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(s.f)(c.screenStart.x,c.screenStart.y),t,i,n),Object(a.k)(o)&&Object(a.k)(r)&&!Object(l.n)(o,o,r)))return null;if(Object(a.j)(o))return null;const u=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(s.f)(c.screenEnd.x,c.screenEnd.y),t,i,n);return Object(a.k)(u)?Object(a.k)(r)&&!Object(l.n)(u,u,r)?null:{...c,mapStart:o,mapEnd:u}:null}}(e,i,Object(f.g)(t,e,i),r,n)}function T(e,t,i,r=null,n=null){return x(e,i,Object(f.e)(t),r,n)}function S(e,t,i,r){const n=t.toMap(e.screenStart,{include:[i]});return Object(a.k)(n)?T(t,i,n,r):null}function E(e,t,i){let r=null;const n=new _.a;return n.next(v(e,function(e,t){const i=R,r=C,n=Object(u.d)();e.renderCoordsHelper.worldUpAtPosition(t,i);const a=Object(o.g)(n,i,Object(o.j)(r,t,e.state.camera.eye));return Object(o.g)(a,a,i),Object(u.g)(t,a,n)}(e,t))).next(function(e,t){const i=Object(c.f)(),r=Object(o.p)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const n=Object(c.f)(),a=Object(c.f)(),s=n=>(Object(o.j)(n,n,t),Object(d.c)(i,n,n),"global"===e.viewingMode&&Object(o.p)(n)*Math.sign(Object(o.h)(i,n))<.001-r&&Object(o.j)(n,Object(o.e)(n,i,.001),t),Object(o.f)(n,n,t),n);return e=>(e.renderStart=s(Object(o.k)(n,e.renderStart)),e.renderEnd=s(Object(o.k)(a,e.renderEnd)),e)}(e,t)).next(A(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e})),e=>(r=null,n.execute(e),r)}function A(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,t),n=i.fromRenderCoords(e.renderEnd,t);return Object(a.k)(r)&&Object(a.k)(n)?{...e,mapStart:r,mapEnd:n}:null}}function w(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":Object(a.k)(t)&&(t.remove(),t=null)}return i}}function M(e,t=null){const i=Object(g.a)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=m.c.MIN,i.options.hud=!1;const n=Object(s.f)(),o={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=Object(c.f)(),u=Object(a.t)(t,e.spatialReference),h=t=>{e.map.ground&&e.map.ground.opacity<1?o.exclude.add(O.b):o.exclude.delete(O.b),e.sceneIntersectionHelper.intersectIntersectorScreen(Object(s.i)(t,n),i,o);const a=i.results.min;let c;if(a.getIntersectionPoint(l))c=a.intersector===m.b.TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(l))return null;c=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,u),surfaceType:c}};let d;return e=>{if("start"===e.action){const t=h(e.screenStart);d=Object(a.k)(t)?t.location:null}if(Object(a.j)(d))return null;const t=h(e.screenEnd);return Object(a.k)(t)&&Object(a.k)(t.location)?{...e,mapStart:d,mapEnd:t.location,surfaceType:t.surfaceType}:null}}(n=r||(r={}))[n.GROUND=0]="GROUND",n[n.OTHER=1]="OTHER";const R=Object(c.f)(),C=Object(c.f)(),P=Object(h.c)()},750:function(e,t,i){"use strict";i.d(t,"a",(function(){return B}));var r=i(222),n=i(88),a=i(138),s=i(116),o=i(85),c=i(91),l=i(549),u=i(98),h=i(819),d=i(528),p=i(163),f=i(157);let b;var g,m;(m=g||(g={}))[m.ETC1_RGB=0]="ETC1_RGB",m[m.ETC2_RGBA=1]="ETC2_RGBA",m[m.BC1_RGB=2]="BC1_RGB",m[m.BC3_RGBA=3]="BC3_RGBA",m[m.BC4_R=4]="BC4_R",m[m.BC5_RG=5]="BC5_RG",m[m.BC7_M6_RGB=6]="BC7_M6_RGB",m[m.BC7_M5_RGBA=7]="BC7_M5_RGBA",m[m.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",m[m.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",m[m.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",m[m.ATC_RGB=11]="ATC_RGB",m[m.ATC_RGBA=12]="ATC_RGBA",m[m.FXT1_RGB=17]="FXT1_RGB",m[m.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",m[m.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",m[m.ETC2_EAC_R11=20]="ETC2_EAC_R11",m[m.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",m[m.RGBA32=13]="RGBA32",m[m.RGB565=14]="RGB565",m[m.BGR565=15]="BGR565",m[m.RGBA4444=16]="RGBA4444";var O=i(94),_=i(203),v=i(647);let y=null,j=null;async function x(){return Object(o.j)(j)&&(j=function(){if(Object(o.j)(b)){const e=e=>Object(f.a)(`esri/libs/basisu/${e}`);b=Promise.all([i.e(241),i.e(260)]).then(i.bind(null,1344)).then((e=>e.b)).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return b}(),y=await j),j}function T(e,t,i,r,n){const a=Object(v.b)(t?O.i.COMPRESSED_RGBA8_ETC2_EAC:O.i.COMPRESSED_RGB8_ETC2),s=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*a*s)}function S(e){return e.getNumImages()>=1&&!e.isUASTC()}function E(e){return e.getFaces()>=1&&e.isETC1S()}function A(e,t,i,r,n,a,s,o){const{compressedTextureETC:c,compressedTextureS3TC:l}=e.capabilities,[u,h]=c?r?[g.ETC2_RGBA,O.i.COMPRESSED_RGBA8_ETC2_EAC]:[g.ETC1_RGB,O.i.COMPRESSED_RGB8_ETC2]:l?r?[g.BC3_RGBA,O.i.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[g.BC1_RGB,O.i.COMPRESSED_RGB_S3TC_DXT1_EXT]:[g.RGBA32,O.p.RGBA],d=t.hasMipmap?i:Math.min(1,i),p=[];for(let g=0;g<d;g++)p.push(new Uint8Array(s(g,u))),o(g,u,p[g]);const f=p.length>1,b=f?O.z.LINEAR_MIPMAP_LINEAR:O.z.LINEAR,m={...t,samplingMode:b,hasMipmap:f,internalFormat:h,width:n,height:a};return new _.a(e,m,{type:"compressed",levels:p})}var w=i(560),M=i(544);const R=i(87).a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),C=542327876,P=131072;function I(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const D=I("DXT1"),L=I("DXT3"),N=I("DXT5");function F(e,t,i){const{textureData:r,internalFormat:n,width:a,height:o}=function(e,t){const i=new Int32Array(e,0,31);if(i[0]!==C)return R.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return R.error("Unsupported format, must contain a FourCC code"),null;const r=i[21];let n,a;switch(r){case D:n=8,a=O.i.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case L:n=16,a=O.i.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case N:n=16,a=O.i.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return R.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(r)),null}let o=1,c=i[4],l=i[3];0==(3&c)&&0==(3&l)||(R.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,l=l+3&-4);const u=c,h=l;let d,p;i[2]&P&&!1!==t&&(o=Math.max(1,i[7])),1===o||Object(s.j)(c)&&Object(s.j)(l)||(R.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let f=i[1]+4;const b=[];for(let s=0;s<o;++s)p=(c+3>>2)*(l+3>>2)*n,d=new Uint8Array(e,f,p),b.push(d),f+=p,c=Math.max(1,c>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:b},internalFormat:a,width:u,height:h}}(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?O.z.LINEAR_MIPMAP_LINEAR:O.z.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=n,t.width=a,t.height=o,new _.a(e,t,r)}var z,U,G=i(692),V=i(278),k=i(314),H=i(788);class B extends w.a{constructor(e,t){super(),this.data=e,this.type=M.a.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new a.a,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:O.B.REPEAT,t:O.B.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||p.e.STRETCH,this.estimatedTexMemRequired=B._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const e=this.data;Object(o.j)(e)||(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){Object(u.v)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}_startPreloadImageElement(e){Object(u.w)(e.src)||Object(u.v)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static _getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static _estimateTexMemRequired(e,t){if(Object(o.j)(e))return 0;if(Object(l.c)(e)||Object(l.k)(e))return t.encoding===B.KTX2_ENCODING?function(e,t){if(Object(o.j)(y))return e.byteLength;const i=new y.KTX2File(new Uint8Array(e)),r=E(i)?T(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}(e,t.mipmap):t.encoding===B.BASIS_ENCODING?function(e,t){if(Object(o.j)(y))return e.byteLength;const i=new y.BasisFile(new Uint8Array(e)),r=S(i)?T(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?B._getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(e){var t;return{target:O.A.TEXTURE_2D,pixelFormat:O.p.RGBA,dataType:O.q.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?O.z.LINEAR_MIPMAP_LINEAR:O.z.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(e,t){if(Object(o.k)(this._glTexture))return this._glTexture;if(Object(o.k)(this._loadingPromise))return this._loadingPromise;const i=this.data;return Object(o.j)(i)?(this._glTexture=new _.a(e,this._createDescriptor(e),null),this._glTexture):"string"==typeof i?this._loadFromURL(e,t,i):i instanceof Image?this._loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i,t):(Object(l.c)(i)||Object(l.k)(i))&&this.params.encoding===B.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(e,i)):(Object(l.c)(i)||Object(l.k)(i))&&this.params.encoding===B.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(e,i)):(Object(l.c)(i)||Object(l.k)(i))&&this.params.encoding===B.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(e,i)):Object(l.k)(i)?this._loadFromPixelData(e,i):Object(l.c)(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||Object(o.j)(this._glTexture))return i;if(this.data.readyState<z.HAVE_CURRENT_DATA||i===this.data.currentTime)return i;if(Object(o.k)(this._powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:n}=this._powerOfTwoStretchInfo;n.setData(this.data),this._drawStretchedTexture(e,t,i,r,n,this._glTexture)}else{const{width:e,height:t}=this.data,{width:i,height:r}=this._glTexture.descriptor;e!==i||t!==r?this._glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.data.currentTime}_loadFromDDSData(e,t){return this._glTexture=F(e,this._createDescriptor(e),t),this._glTexture}_loadFromKTX2(e,t){return this._loadAsync((()=>async function(e,t,i){Object(o.j)(y)&&(y=await x());const r=new y.KTX2File(new Uint8Array(i));if(!E(r))return null;r.startTranscoding();const n=A(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),((e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,i)=>r.transcodeImage(i,e,0,0,t,0,-1,-1)));return r.close(),r.delete(),n}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromBasis(e,t){return this._loadAsync((()=>async function(e,t,i){Object(o.j)(y)&&(y=await x());const r=new y.BasisFile(new Uint8Array(i));if(!S(r))return null;r.startTranscoding();const n=A(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),((e,t)=>r.getImageTranscodedSizeInBytes(0,e,t)),((e,t,i)=>r.transcodeImage(i,0,e,t,0,0)));return r.close(),r.delete(),n}(e,this._createDescriptor(e),t).then((e=>(this._glTexture=e,e)))))}_loadFromPixelData(e,t){Object(V.a)(this.params.width>0&&this.params.height>0);const i=this._createDescriptor(e);return i.pixelFormat=1===this.params.components?O.p.LUMINANCE:3===this.params.components?O.p.RGB:O.p.RGBA,i.width=this.params.width,i.height=this.params.height,this._glTexture=new _.a(e,i,t),this._glTexture}_loadFromURL(e,t,i){return this._loadAsync((async r=>{const n=await Object(h.a)(i,{signal:r});return Object(c.t)(r),this._loadFromImage(e,n,t)}))}_loadFromImageElement(e,t,i){return i.complete?this._loadFromImage(e,i,t):this._loadAsync((async r=>{const n=await Object(d.a)(i,i.src,!1,r);return Object(c.t)(r),this._loadFromImage(e,n,t)}))}_loadFromVideoElement(e,t,i){return i.readyState>=z.HAVE_CURRENT_DATA?this._loadFromImage(e,i,t):this._loadFromVideoElementAsync(e,t,i)}_loadFromVideoElementAsync(e,t,i){return this._loadAsync((r=>new Promise(((a,s)=>{const l=()=>{i.removeEventListener("loadeddata",u),i.removeEventListener("error",h),Object(o.r)(d)},u=()=>{i.readyState>=z.HAVE_CURRENT_DATA&&(l(),a(this._loadFromImage(e,i,t)))},h=e=>{l(),s(e||new n.a("Failed to load video"))};i.addEventListener("loadeddata",u),i.addEventListener("error",h);const d=Object(c.o)(r,(()=>h(Object(c.d)())))}))))}_loadFromImage(e,t,i){const r=B._getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const n=this._createDescriptor(e);return n.pixelFormat=3===this.params.components?O.p.RGB:O.p.RGBA,!this._requiresPowerOfTwo(e,n)||Object(s.j)(r.width)&&Object(s.j)(r.height)?(n.width=r.width,n.height=r.height,this._glTexture=new _.a(e,n,t),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(e,t,r,n,i),this._glTexture)}_loadAsync(e){const t=new AbortController;this._loadingController=t;const i=e(t.signal);this._loadingPromise=i;const r=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(r,r),i}_requiresPowerOfTwo(e,t){const i=O.B.CLAMP_TO_EDGE,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Object(H.a)(e.gl)&&(t.hasMipmap||!r)}_makePowerOfTwoTexture(e,t,i,n,a){const{width:o,height:c}=i,l=Object(s.l)(o),u=Object(s.l)(c);let h;switch(n.width=l,n.height=u,this.params.powerOfTwoResizeMode){case p.e.PAD:n.textureCoordinateScaleFactor=[o/l,c/u],h=new _.a(e,n),h.updateData(0,0,0,o,c,t);break;case p.e.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(e,t,n,a());break;default:Object(r.a)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(e,t,i,r){const n=new _.a(e,i),a=new k.a(e,{colorTarget:O.y.TEXTURE,depthStencilTarget:O.m.NONE},n),s=new _.a(e,{target:O.A.TEXTURE_2D,pixelFormat:i.pixelFormat,dataType:O.q.UNSIGNED_BYTE,wrapMode:O.B.CLAMP_TO_EDGE,samplingMode:O.z.LINEAR,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=Object(G.b)(e),c=e.getBoundFramebufferObject();return this._drawStretchedTexture(e,r,a,o,s,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:o,sourceTexture:s,framebuffer:a}:(o.dispose(!0),s.dispose(),a.detachColorTexture(),a.dispose()),e.bindFramebuffer(c),n}_drawStretchedTexture(e,t,i,r,n,a){e.bindFramebuffer(i);const s=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);const o=e.useTechnique(t);o.setUniform4f("uColor",1,1,1,1),o.bindTexture(n,"tex"),e.bindVAO(r),e.drawArrays(O.r.TRIANGLE_STRIP,0,Object(v.f)(r,"geometry")),e.bindFramebuffer(null),e.setViewport(s.x,s.y,s.width,s.height)}unload(){if(Object(o.k)(this._powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this._powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(Object(o.k)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),Object(o.k)(this._loadingController)){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}}B.DDS_ENCODING="image/vnd-ms.dds",B.KTX2_ENCODING="image/ktx2",B.BASIS_ENCODING="image/x.basis",(U=z||(z={}))[U.HAVE_NOTHING=0]="HAVE_NOTHING",U[U.HAVE_METADATA=1]="HAVE_METADATA",U[U.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",U[U.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",U[U.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"},751:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i(210),n=i(163),a=i(545),s=i(621),o=i(335),c=i(445),l=i(411),u=i(713),h=i(434),d=i(79),p=i(301),f=i(420),b=i(356),g=i(501),m=i(388),O=i(404),_=i(419),v=i(382),y=i(389),j=i(654),x=i(828),T=i(355);class S extends O.a{initializeProgram(e){const t=S.shader.get(),i=this.configuration,r=t.build({output:i.output,oitEnabled:i.transparencyPassType===n.i.Color,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new y.a(e.rctx,r,v.a)}bindPass(e,t){Object(g.b)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),this.configuration.output===r.a.Highlight&&Object(f.b)(this.program,t),(this.configuration.output===r.a.Depth||t.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(b.a)(this.program,t))}bindDraw(e){Object(g.c)(this.program,e),this.program.rebindTextures(),Object(p.c)(this.program,this.configuration,e)}_createPipeline(e,t){const i=this.configuration,a=e===n.i.NONE,s=e===n.i.FrontFace;return Object(T.f)({blending:i.output!==r.a.Color&&i.output!==r.a.Alpha||!i.transparent?null:a?c.d:Object(c.f)(e),culling:Object(T.b)(i.cullFace),depthTest:{func:Object(c.g)(e)},depthWrite:a||s?i.writeDepth&&T.d:null,colorWrite:T.c,stencilWrite:i.sceneHasOcludees?j.h:null,stencilTest:i.sceneHasOcludees?t?j.d:j.c:null,polygonOffset:a||s?i.polygonOffset&&E:Object(c.e)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}}S.shader=new m.a(x.a,(()=>i.e(321).then(i.bind(null,1346))));const E={factor:1,units:1};class A extends _.a{constructor(){super(...arguments),this.output=r.a.Color,this.cullFace=n.b.None,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=n.i.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(d.a)([Object(_.b)({count:r.a.COUNT})],A.prototype,"output",void 0),Object(d.a)([Object(_.b)({count:n.b.COUNT})],A.prototype,"cullFace",void 0),Object(d.a)([Object(_.b)()],A.prototype,"slicePlaneEnabled",void 0),Object(d.a)([Object(_.b)()],A.prototype,"vertexColors",void 0),Object(d.a)([Object(_.b)()],A.prototype,"transparent",void 0),Object(d.a)([Object(_.b)()],A.prototype,"polygonOffset",void 0),Object(d.a)([Object(_.b)()],A.prototype,"enableOffset",void 0),Object(d.a)([Object(_.b)()],A.prototype,"writeDepth",void 0),Object(d.a)([Object(_.b)()],A.prototype,"sceneHasOcludees",void 0),Object(d.a)([Object(_.b)({count:n.i.COUNT})],A.prototype,"transparencyPassType",void 0),Object(d.a)([Object(_.b)()],A.prototype,"multipassTerrainEnabled",void 0),Object(d.a)([Object(_.b)()],A.prototype,"cullAboveGround",void 0);class w extends o.b{constructor(e){super(e,R),this.supportsEdges=!0,this.techniqueConfig=new A}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<c.b,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,r,n,a,s){Object(h.f)(e,t,r,n,a,void 0,s)}requiresSlot(e,t){return e===l.a.DRAPED_MATERIAL||(Object(s.b)(t)===r.a.Highlight?e===l.a.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?l.a.TRANSPARENT_MATERIAL:l.a.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:l.a.OPAQUE_MATERIAL))}createGLMaterial(e){return e.output===r.a.Color||e.output===r.a.Alpha||e.output===r.a.Highlight||e.output===r.a.Depth&&this.parameters.writeLinearDepth?new M(e):null}createBufferWriter(){return new u.a(u.b)}}class M extends a.a{updateParameters(e){return this.ensureTechnique(S,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return this._output!==r.a.Color&&this._output!==r.a.Alpha||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const R={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:n.b.None,sceneHasOcludees:!1,...o.a}},752:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return y}));var r=i(85),n=i(147),a=i(200),s=i(117),o=i(109),c=i(271),l=i(257),u=i(360),h=i(272),d=i(608);i(733);function p(e){return Object(r.k)(e)&&Object(r.k)(e.dist)}Object(o.f)();var f=i(734),b=i(513);const g=1e-5;class m{constructor(e){this.options=new d.a,this._results=new _,this.transform=new f.a,this.tolerance=g,this.verticalOffset=null,this._ray=Object(u.c)(),this._rayEnd=Object(o.f)(),this._rayBeginTransformed=Object(o.f)(),this._rayEndTransformed=Object(o.f)(),this.viewingMode=null==e?h.a.Global:e}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay(Object(u.e)(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&Object(u.b)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===h.a.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(s.f)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,i,n,a){this.point=t,this.filterPredicate=n,this.tolerance=null==i?g:i;const s=Object(f.c)(this.verticalOffset);if(Object(r.k)(e)&&e.length>0){const t=a?e=>{a(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();Object(r.k)(e)?(Object(r.k)(s)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometryRecords;if(!t)return;const i=e.transformation,n=Object(f.c)(this.verticalOffset);for(const o of t){const{geometry:t,material:c,instanceParameters:l}=o;if(Object(b.d)(l))continue;const u=t.id;this.transform.setAndInvalidateLazyTransforms(i,o.getShaderTransformation()),Object(s.q)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Object(s.q)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;Object(r.k)(n)&&(n.objectTransform=this.transform),c.intersect(t,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,i,n,s,o,c)=>{if(t>=0){if(Object(r.k)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;if(s){if(null==this._results.hud.dist||t<this._results.hud.dist){const r={object:e,geometryId:u,triangleNr:n,center:c};this._results.hud.set(d.b.HUD,r,t,i,a.a,o)}return}const l=r=>r.set(d.b.OBJECT,{object:e,geometryId:u,triangleNr:n},t,i,h,o);if((null==this._results.min.drapedLayerOrder||o>=this._results.min.drapedLayerOrder)&&(null==this._results.min.dist||t<this._results.min.dist)&&l(this._results.min),this.options.store!==d.c.MIN&&(null==this._results.max.drapedLayerOrder||o<this._results.max.drapedLayerOrder)&&(null==this._results.max.dist||t>this._results.max.dist)&&l(this._results.max),this.options.store===d.c.ALL){const r=y(this._ray);r.set(d.b.OBJECT,{object:e,geometryId:u,triangleNr:n},t,i,h),this._results.all.push(r)}}}),o.shaderTransformation)}}sortResults(){this._results.all.sort(((e,t)=>e.dist!==t.dist?Object(r.t)(e.dist,0)-Object(r.t)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?Object(r.t)(e.drapedLayerOrder,Number.MAX_VALUE)-Object(r.t)(t.drapedLayerOrder,Number.MAX_VALUE):Object(r.t)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-Object(r.t)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)))}}function O(e){return new m(e)}class _{constructor(){this._min=new v(Object(u.c)()),this._max=new v(Object(u.c)()),this._hud=new v(Object(u.c)()),this._ground=new v(Object(u.c)())}get min(){return this._min}get max(){return this._max}get hud(){return this._hud}get ground(){return this._ground}init(e){this._min.init(e),this._max.init(e),this._hud.init(e),this._ground.init(e),this.all=[]}}class v{constructor(e){this.intersector=d.b.OBJECT,this.normal=Object(o.f)(),this.transformation=Object(a.d)(),this._ray=Object(u.c)(),this.init(e)}get ray(){return this._ray}get distanceInRenderSpace(){return Object(r.k)(this.dist)?(Object(s.e)(j,this.ray.direction,this.dist),Object(s.p)(j)):null}getIntersectionPoint(e){return!!p(this)&&(Object(s.e)(j,this.ray.direction,this.dist),Object(s.f)(e,this.ray.origin,j),!0)}getTransformedNormal(e){return Object(s.k)(x,this.normal),x[3]=0,Object(c.m)(x,x,this.transformation),Object(s.k)(e,x),Object(s.r)(e,e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=d.b.OBJECT,Object(u.b)(e,this._ray)}set(e,t,i,c,l,u,h){this.intersector=e,this.dist=i,Object(s.k)(this.normal,Object(r.t)(c,o.b)),Object(n.c)(this.transformation,Object(r.t)(l,a.a)),this.target=t,this.drapedLayerOrder=u,this.drapedLayerGraphicOrder=h}copy(e){Object(u.b)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(s.k)(this.normal,e.normal),Object(n.c)(this.transformation,e.transformation)}}function y(e){return new v(e)}const j=Object(o.f)(),x=Object(l.e)()},753:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return u})),function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(r||(r={}));var n,a,s=i(747),o=i(126),c=i(139);function l(e,t){const i=e;i.include(s.a),i.attributes.add(c.a.POSITION,"vec3"),i.attributes.add(c.a.NORMAL,"vec3"),i.attributes.add(c.a.AUXPOS1,"vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("cameraPosition","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("renderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(o.a`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.vertex.code.add(o.a`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||i.vertex.code.add(o.a`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),i.vertex.code.add(o.a`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||t.screenCenterOffsetUnitsEnabled===n.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?o.a`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==n.Screen?o.a`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===n.Screen?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===n.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(o.a`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function u(e,t){e.setUniform1f("renderTransparentlyOccludedHUD",t.renderTransparentlyOccludedHUD===r.OCCLUDED?1:t.renderTransparentlyOccludedHUD===r.NOTOCCLUDED?0:.75)}(a=n||(n={}))[a.World=0]="World",a[a.Screen=1]="Screen",a[a.COUNT=2]="COUNT"},754:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(126);function n(e){const t=e.fragment.code;t.add(r.a`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r.a`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r.a`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var a=i(502),s=i(730);function o(e,t){const i=e.fragment.code;e.include(s.a),t.pbrMode===a.a.Water||t.pbrMode===a.a.WaterOnIntegratedMesh?(i.add(r.a`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r.a`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r.a`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r.a`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r.a`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==a.a.Normal&&t.pbrMode!==a.a.Schematic||(e.include(n),i.add(r.a`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r.a`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r.a`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(r.a`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r.a`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r.a`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},758:function(e,t,i){"use strict";function r(){return[1,0,0,1,0,0]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,create:r,clone:n,fromValues:function(e,t,i,r,n,a){return[e,t,i,r,n,a]},createView:function(e,t){return new Float64Array(e,t,6)}})},766:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));const r=["freehand","hybrid","click"],n="click"},767:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return l}));var r=i(485),n=i(117),a=i(360);i(288);function s(e){return e?{ray:Object(a.c)(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a.c)(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=s()){return Object(a.b)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,i=s()){const r=Object(n.p)(e.vector);return Object(a.f)(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function l(e,t){return h(e,e.c0,t)}function u(e,t){return h(e,e.c1,t)}function h(e,t,i){return Object(n.f)(i,e.ray.origin,Object(n.e)(i,e.ray.direction,t))}new r.a((()=>({c0:0,c1:0,ray:null})))},768:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return l}));var r=i(116);i(272);function n(e,t,i){const r=i.parameters,n=i.paddingPixelsOverride;return u.scale=Math.min(r.divisor/(t-r.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u.minPixelSize=r.minPixelSize,u.paddingPixels=n,u}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(Object(r.k)(e*t.scale,e,t.factor),a(e,t))}function o(e,t,i,r){r.scale=function(e,t,i){const r=n(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,s(1,r)}(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function c(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,a(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function l(e,t,i,r){return s(e,n(t,i,r))}Object(r.g)(10),Object(r.g)(12),Object(r.g)(70),Object(r.g)(40);const u={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},769:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i(116),n=i(805),a=i(687),s=i(126),o=i(297);const c=Object(r.g)(6);function l(e){const t=new o.a;return t.extensions.add("GL_OES_standard_derivatives"),t.include(a.a),t.include(n.a,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(s.a`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.pointDistanceEnabled&&t.fragment.code.add(s.a`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.intersectsLineEnabled&&t.fragment.code.add(s.a`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(s.a`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.fragment.code.add(s.a`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled&&t.fragment.code.add(s.a`{
float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
color = max(color, heightManifoldColor * heightManifoldAlpha);
}`),e.pointDistanceEnabled&&t.fragment.code.add(s.a`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`),e.lineVerticalPlaneEnabled&&t.fragment.code.add(s.a`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`),e.intersectsLineEnabled&&t.fragment.code.add(s.a`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`),t.fragment.code.add(s.a`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}const u=Object.freeze({__proto__:null,defaultAngleCutoff:c,build:l})},770:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return v})),i.d(t,"d",(function(){return _}));var r=i(210),n=i(301),a=i(945),s=i(622),o=i(410),c=i(894),l=i(356),u=i(730),h=i(397),d=i(464),p=i(126),f=i(297),b=i(139);const g=1;var m,O;function _(e){const t=new f.a,i=e.capType!==m.BUTT,O=e.capType===m.ROUND,_=e.stippleEnabled&&O,v=e.falloffEnabled||_,y=e.innerColorEnabled||O,j=e.stippleEnabled&&e.stippleScaleWithLineWidth||O,x=e.stippleEnabled&&e.stippleScaleWithLineWidth,T=e.stippleEnabled||O;return t.include(u.a),t.include(a.a,e),t.include(c.a,{...e,stippleRequiresStretchMeasure:!0}),e.output===r.a.Depth&&t.include(s.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4"),t.vertex.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(b.a.POSITION,"vec3"),t.attributes.add(b.a.SUBDIVISIONFACTOR,"float"),t.attributes.add(b.a.UV0,"vec2"),t.attributes.add(b.a.AUXPOS1,"vec3"),t.attributes.add(b.a.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),j&&t.varyings.add("vLineWidth","float"),x&&t.varyings.add("vLineSizeInv","float"),y&&t.varyings.add("vLineDistance","float"),v&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),O&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),t.vertex.code.add(p.a`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(p.a`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(p.a`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),t.vertex.code.add(p.a`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${j?p.a`vLineWidth = lineWidth;`:""}
      ${x?p.a`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),T&&t.vertex.code.add(p.a`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${O?p.a`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),t.vertex.code.add(p.a`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(p.a`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?p.a`min(1.0, subdivisionFactor * ${p.a.float((g+2)/(g+1))})`:p.a`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):t.vertex.code.add(p.a`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(p.a`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${i?p.a`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),t.vertex.code.add(p.a`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${v||y?p.a`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${y?p.a`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${v?p.a`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),O&&t.vertex.code.add(p.a`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped||t.vertex.code.add(p.a`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),t.vertex.code.add(p.a`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?t.vertex.code.add(p.a`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):t.vertex.code.add(p.a`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),t.vertex.code.add(p.a`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),t.vertex.code.add(p.a`
      // Convert back into NDC
      pos.xy = (pos.xy / screenSize) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(o.a),t.include(l.b,e)),t.include(n.a,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(d.a),t.fragment.code.add(p.a`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?t.fragment.code.add(p.a`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(O&&t.fragment.code.add(p.a`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${p.a.float(h.c)}) {
        discard;
      }
    `),_?t.fragment.code.add(p.a`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${p.a.float(h.c)}, stippleCoverage);
      `):t.fragment.code.add(p.a`float stippleAlpha = getStippleAlpha();`),t.fragment.code.add(p.a`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&t.fragment.code.add(p.a`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`),t.fragment.code.add(p.a`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(p.a`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)),t.fragment.code.add(p.a`
    if (finalColor.a < ${p.a.float(h.c)}) {
      discard;
    }

    ${e.output===r.a.Alpha?p.a`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===r.a.Color?p.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===r.a.Color&&e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===r.a.Highlight?p.a`gl_FragColor = vec4(1.0);`:""}
    ${e.output===r.a.Depth?p.a`outputDepth(linearDepth);`:""}
  }
  `),t}(O=m||(m={}))[O.BUTT=0]="BUTT",O[O.SQUARE=1]="SQUARE",O[O.ROUND=2]="ROUND",O[O.COUNT=3]="COUNT";const v=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:g,get CapType(){return m},build:_})},771:function(e,t,i){"use strict";i.d(t,"a",(function(){return _})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return g})),i.d(t,"d",(function(){return m})),i.d(t,"e",(function(){return O})),i.d(t,"f",(function(){return y})),i.d(t,"g",(function(){return j}));var r=i(85),n=i(147),a=i(117),s=i(257),o=i(288),c=i(638),l=i(688),u=i(568),h=i(163),d=i(594),p=i(335),f=i(751),b=i(964);function g(e,t=p.c.OccludeAndTransparent,i=!0){const r=Object(s.g)(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return i?new b.a({color:r,transparent:n,writeDepth:!0,cullFace:h.b.Back,renderOccluded:t}):new f.a({color:r,transparent:n,writeDepth:!0,cullFace:h.b.Back,renderOccluded:t})}function m(e,t=p.c.OccludeAndTransparent){const i=Object(s.g)(e[0],e[1],e[2],4===e.length?e[3]:1);return new f.a({color:i,transparent:!0,writeDepth:!0,cullFace:h.b.Front,renderOccluded:t})}function O(e,t,i){return new l.a({view:e,renderObjects:[{geometry:d.a.createSphereGeometry(1,32,32),material:g(Object(s.g)(t[0],t[1],t[2],null!=i?i:1))}]})}function _(e,t,i,r){const s=Object(a.j)(o.d.get(),e,i),c=v(s,Object(a.g)(o.d.get(),r,s),i,o.a.get());Object(n.a)(c,c);const l=Object(a.q)(o.d.get(),t,c);return Math.atan2(l[1],l[0])}function v(e,t,i,r){const n=Object(a.r)(o.d.get(),e),s=Object(a.r)(o.d.get(),t),c=Object(a.g)(o.d.get(),n,s);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=s[0],r[5]=s[1],r[6]=s[2],r[7]=0,r[8]=c[0],r[9]=c[1],r[10]=c[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function y(e,t){const i=e.getViewForGraphic(t);return Object(r.k)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function j(e,t,i){const n=y(e,i);Object(r.k)(n)?t.elevationAlignedLocation=n:function(e,t){if(Object(r.j)(t))return;const i="mesh"===t.type?t.anchor:Object(u.a)(t);Object(r.j)(i)||(e.location=Object(c.b)(i))}(t,i.geometry)}},772:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var r=i(79),n=i(100),a=i(138),s=i(85),o=i(102),c=i(81),l=(i(84),i(82),i(83),i(80)),u=i(151),h=i(117),d=i(109),p=i(187),f=i(416),b=i(320),g=i(336),m=i(699);let O=class extends n.a{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new a.a.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(f.f)(this.graphic),i=e?e.offset:0;return new g.a({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(Object(s.j)(i))return null;const r=this._get("focusedSymbol"),n=Object(s.k)(r)?r:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(s.k)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(s.k)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(e=>{Object(s.k)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(s.k)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){Object(s.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(s.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,r){if(r=r||Object(b.h)(i),Object(s.j)(r))return null;let n=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==r.type)return Object(m.b)(t,i,e)?1:null;if(Object(s.j)(n)||!n.originalPoint.equals(i)){const t=i,a=e.spatialReference;if(Object(p.b)(t.spatialReference,a)){const e=Object(p.j)(t,a);n={originalPoint:t.clone(),mapPoint:e,radiusPx:Object(o.g)(r.size)},this._circleCollisionCache=n}}if(Object(s.k)(n)){const i=Object(o.i)(t,v),a=e.toScreen(n.mapPoint),s=n.radiusPx,c=a.x+Object(o.g)(r.xoffset),l=a.y-Object(o.g)(r.yoffset);return Object(u.a)(i,[c,l])<s*s?1:null}return null}_intersectDistance3D(e,t,i){const r=e.toMap(t,{include:[i]});return r&&Object(p.o)(r,_,e.renderSpatialReference)?Object(h.m)(_,e.state.camera.eye):null}};Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],O.prototype,"graphic",null),Object(r.a)([Object(c.b)({readOnly:!0})],O.prototype,"elevationInfo",null),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],O.prototype,"view",void 0),Object(r.a)([Object(c.b)({value:null})],O.prototype,"focusedSymbol",null),Object(r.a)([Object(c.b)({constructOnly:!0})],O.prototype,"layer",void 0),Object(r.a)([Object(c.b)()],O.prototype,"interactive",void 0),Object(r.a)([Object(c.b)()],O.prototype,"selectable",void 0),Object(r.a)([Object(c.b)()],O.prototype,"grabbable",void 0),Object(r.a)([Object(c.b)({value:!1})],O.prototype,"grabbing",null),Object(r.a)([Object(c.b)()],O.prototype,"dragging",void 0),Object(r.a)([Object(c.b)()],O.prototype,"hovering",null),Object(r.a)([Object(c.b)({value:!1})],O.prototype,"selected",null),Object(r.a)([Object(c.b)()],O.prototype,"cursor",void 0),O=Object(r.a)([Object(l.a)("esri.views.interactive.GraphicManipulator")],O);const _=Object(d.f)(),v=Object(o.f)()},776:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i(138),n=i(124),a=i(85),s=i(212),o=i(163),c=i(560),l=i(544);const u=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var h=i(826);class d extends c.a{constructor(e,t=""){var i,a,c;super(),this.apiLayerUid=t,this.type=l.a.Layer,this.events=new r.a,this.isSliceable=!1,this._objects=new s.a,this._stageHandles=new n.a,this.apiLayerUid=t,this.isVisible=null==(i=null==e?void 0:e.isVisible)||i,this.isPickable=null==(a=null==e?void 0:e.isPickable)||a,this.updatePolicy=null!=(c=null==e?void 0:e.updatePolicy)?c:o.j.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of u)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(a.k)(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(a.k)(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(a.k)(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(a.k)(this._octree)&&this._octree.remove(t)}}sync(){Object(a.k)(this._stage)&&this.updatePolicy!==o.j.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(a.k)(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(a.j)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(a.d)(this._octree)}_createOctree(){this._octree=new h.b((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}},777:function(e,t,i){"use strict";i.d(t,"a",(function(){return Y}));var r=i(87),n=i(116),a=i(85),s=i(102),o=i(151),c=i(117),l=i(109),u=i(620),h=i(499),d=i(423),p=i(495),f=i(210),b=i(562),g=i(545),m=i(621),O=i(335),_=i(411),v=i(278),y=i(139),j=i(1001),x=i(513),T=i(770),S=i(79),E=i(147),A=i(288),w=i(301),M=i(420),R=i(356),C=i(623),P=i(501),I=i(388),D=i(404),L=i(419),N=i(163),F=i(445),z=i(389),U=i(654),G=i(94),V=i(355);const k=new Map([[y.a.POSITION,0],[y.a.SUBDIVISIONFACTOR,1],[y.a.UV0,2],[y.a.AUXPOS1,3],[y.a.AUXPOS2,4],[y.a.SIZE,6],[y.a.SIZEFEATUREATTRIBUTE,6],[y.a.COLOR,5],[y.a.COLORFEATUREATTRIBUTE,5],[y.a.OPACITYFEATUREATTRIBUTE,7]]);class H extends D.a{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==f.a.Highlight}initializeProgram(e){const t=H.shader.get(),i=this.configuration,r=t.build({oitEnabled:i.transparencyPassType===N.i.Color,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:i.stippleScaleWithLineWidth,stipplePreferContinuous:i.stipplePreferContinuous,capType:i.capType,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround,wireframe:i.wireframe});return new z.a(e.rctx,r,k)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(P.b)(this.program,t.camera.projectionMatrix),this.configuration.output===f.a.Highlight&&Object(M.b)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(R.a)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(C.d)(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.stippleEnabled){const{pixelSize:i,sdfNormalizer:r,pixels:n}=Object(a.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};if(this.program.setUniform1f("stipplePatternSDFNormalizer",r),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){const t=Object(a.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(a.t)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){Object(P.c)(this.program,e),this.stippleEnabled&&!this.configuration.draped&&Object(P.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(w.b)(this.program,this.configuration,e.slicePlane,{origin:e.origin,view:e.camera.viewMatrix}),this.program.setUniformMatrix4fv("inverseProjectionMatrix",Object(E.a)(A.a.get(),e.camera.projectionMatrix)),this.program.rebindTextures()}_makePipelineState(e,t){const i=this.configuration,r=e===N.i.NONE,n=e===N.i.FrontFace;return Object(V.f)({blending:i.output===f.a.Color||i.output===f.a.Alpha?r?F.d:Object(F.f)(e):null,depthTest:{func:Object(F.g)(e)},depthWrite:r?i.writeDepth&&V.d:Object(F.h)(e),colorWrite:V.c,stencilWrite:i.sceneHasOcludees?U.h:null,stencilTest:i.sceneHasOcludees?t?U.d:U.c:null,polygonOffset:r||n?i.polygonOffset&&B:F.a})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&B;return e.occluder&&(this._occluderPipelineTransparent=Object(V.f)({blending:F.d,polygonOffset:t,depthTest:U.a,depthWrite:null,colorWrite:V.c,stencilWrite:null,stencilTest:U.f}),this._occluderPipelineOpaque=Object(V.f)({blending:F.d,polygonOffset:t,depthTest:U.a,depthWrite:null,colorWrite:V.c,stencilWrite:U.g,stencilTest:U.e}),this._occluderPipelineMaskWrite=Object(V.f)({blending:null,polygonOffset:t,depthTest:U.b,depthWrite:null,colorWrite:null,stencilWrite:U.h,stencilTest:U.d})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?G.r.LINES:G.r.TRIANGLE_STRIP}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===_.a.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===_.a.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,t)}}H.shader=new I.a(T.c,(()=>i.e(335).then(i.bind(null,1343))));const B={factor:0,units:-4};class W extends L.a{constructor(){super(...arguments),this.output=f.a.Color,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.capType=T.a.BUTT,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=N.i.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1}}Object(S.a)([Object(L.b)({count:f.a.COUNT})],W.prototype,"output",void 0),Object(S.a)([Object(L.b)()],W.prototype,"occluder",void 0),Object(S.a)([Object(L.b)()],W.prototype,"slicePlaneEnabled",void 0),Object(S.a)([Object(L.b)()],W.prototype,"transparent",void 0),Object(S.a)([Object(L.b)()],W.prototype,"polygonOffset",void 0),Object(S.a)([Object(L.b)()],W.prototype,"writeDepth",void 0),Object(S.a)([Object(L.b)()],W.prototype,"draped",void 0),Object(S.a)([Object(L.b)()],W.prototype,"stippleEnabled",void 0),Object(S.a)([Object(L.b)()],W.prototype,"stippleOffColorEnabled",void 0),Object(S.a)([Object(L.b)()],W.prototype,"stippleScaleWithLineWidth",void 0),Object(S.a)([Object(L.b)()],W.prototype,"stipplePreferContinuous",void 0),Object(S.a)([Object(L.b)({count:T.a.COUNT})],W.prototype,"capType",void 0),Object(S.a)([Object(L.b)()],W.prototype,"roundJoins",void 0),Object(S.a)([Object(L.b)()],W.prototype,"vvSize",void 0),Object(S.a)([Object(L.b)()],W.prototype,"vvColor",void 0),Object(S.a)([Object(L.b)()],W.prototype,"vvOpacity",void 0),Object(S.a)([Object(L.b)()],W.prototype,"falloffEnabled",void 0),Object(S.a)([Object(L.b)()],W.prototype,"innerColorEnabled",void 0),Object(S.a)([Object(L.b)()],W.prototype,"sceneHasOcludees",void 0),Object(S.a)([Object(L.b)({count:N.i.COUNT})],W.prototype,"transparencyPassType",void 0),Object(S.a)([Object(L.b)()],W.prototype,"multipassTerrainEnabled",void 0),Object(S.a)([Object(L.b)()],W.prototype,"cullAboveGround",void 0),Object(S.a)([Object(L.b)()],W.prototype,"wireframe",void 0);const q=r.a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var Z,X;(X=Z||(Z={}))[X.LEFT_JOIN_START=-2]="LEFT_JOIN_START",X[X.LEFT_JOIN_END=-1]="LEFT_JOIN_END",X[X.LEFT_CAP_START=-4]="LEFT_CAP_START",X[X.LEFT_CAP_END=-5]="LEFT_CAP_END",X[X.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",X[X.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",X[X.RIGHT_CAP_START=4]="RIGHT_CAP_START",X[X.RIGHT_CAP_END=5]="RIGHT_CAP_END";class Y extends O.b{constructor(e){super(e,Q),this._vertexAttributeLocations=k,this.techniqueConfig=new W,this.layout=this.createLayout()}isClosed(e,t){return te(this.parameters,e,t)}dispose(){}getPassParameters(){return this.parameters}getTechniqueConfig(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===_.a.DRAPED_MATERIAL;const i=Object(a.k)(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleOffColorEnabled=i&&Object(a.k)(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&Object(a.k)(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===O.c.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(e,t,i,r,n,s,o,c,l){Object(a.k)(l)?this._intersectDrapedLineGeometry(e,r,l,s,o):this._intersectLineGeometry(e,t,i,r,o)}_intersectDrapedLineGeometry(e,t,i,r,a){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get(y.a.POSITION).data,o=e.vertexAttributes.get(y.a.SIZE);let c=this.parameters.width;if(this.parameters.vvSizeEnabled){const t=e.vertexAttributes.get(y.a.SIZEFEATUREATTRIBUTE).data[0];c*=Object(n.e)(this.parameters.vvSizeOffset[0]+t*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(c*=o.data[0]);const l=r[0],u=r[1],h=(c/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE,p=0;for(let f=0;f<s.length-5;f+=3){const e=s[f],t=s[f+1],i=l-e,r=u-t,a=s[f+3]-e,o=s[f+4]-t,c=Object(n.e)((a*i+o*r)/(a*a+o*o),0,1),h=a*c-i,b=o*c-r,g=h*h+b*b;g<d&&(d=g,p=f/3)}d<h*h&&a(i.dist,i.normal,p,!1)}_intersectLineGeometry(e,t,i,r,a){if(!r.options.selectionMode||Object(x.d)(t))return;if(!Object(v.g)(i))return void q.error("intersection assumes a translation-only matrix");const s=e.vertexAttributes,l=s.get(y.a.POSITION).data;let p=this.parameters.width;if(this.parameters.vvSizeEnabled){const e=s.get(y.a.SIZEFEATUREATTRIBUTE).data[0];p*=Object(n.e)(this.parameters.vvSizeOffset[0]+e*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else s.has(y.a.SIZE)&&(p*=s.get(y.a.SIZE).data[0]);const f=r.camera,b=se;Object(o.c)(b,r.point);const g=p*f.pixelRatio/2+4*f.pixelRatio;Object(c.w)(ge[0],b[0]-g,b[1]+g,0),Object(c.w)(ge[1],b[0]+g,b[1]+g,0),Object(c.w)(ge[2],b[0]+g,b[1]-g,0),Object(c.w)(ge[3],b[0]-g,b[1]-g,0);for(let n=0;n<4;n++)if(!f.unprojectFromRenderScreen(ge[n],me[n]))return;Object(d.f)(f.eye,me[0],me[1],Oe),Object(d.f)(f.eye,me[1],me[2],_e),Object(d.f)(f.eye,me[2],me[3],ve),Object(d.f)(f.eye,me[3],me[0],ye);let m=Number.MAX_VALUE,O=0;const _=ee(this.parameters,s,e.indices)?l.length-2:l.length-5;for(let n=0;n<_;n+=3){ie[0]=l[n]+i[12],ie[1]=l[n+1]+i[13],ie[2]=l[n+2]+i[14];const e=(n+3)%l.length;if(re[0]=l[e]+i[12],re[1]=l[e+1]+i[13],re[2]=l[e+2]+i[14],Object(d.t)(Oe,ie)<0&&Object(d.t)(Oe,re)<0||Object(d.t)(_e,ie)<0&&Object(d.t)(_e,re)<0||Object(d.t)(ve,ie)<0&&Object(d.t)(ve,re)<0||Object(d.t)(ye,ie)<0&&Object(d.t)(ye,re)<0)continue;if(f.projectToRenderScreen(ie,oe),f.projectToRenderScreen(re,ce),oe[2]<0&&ce[2]>0){Object(c.j)(ne,ie,re);const e=f.frustum,t=-Object(d.t)(e[u.a.NEAR],ie)/Object(c.h)(ne,Object(d.q)(e[u.a.NEAR]));Object(c.e)(ne,ne,t),Object(c.f)(ie,ie,ne),f.projectToRenderScreen(ie,oe)}else if(oe[2]>0&&ce[2]<0){Object(c.j)(ne,re,ie);const e=f.frustum,t=-Object(d.t)(e[u.a.NEAR],re)/Object(c.h)(ne,Object(d.q)(e[u.a.NEAR]));Object(c.e)(ne,ne,t),Object(c.f)(re,re,ne),f.projectToRenderScreen(re,ce)}else if(oe[2]<0&&ce[2]<0)continue;oe[2]=0,ce[2]=0;const t=Object(h.e)(Object(h.f)(oe,ce,he),b);t<m&&(m=t,Object(c.k)(le,ie),Object(c.k)(ue,re),O=n/3)}const j=r.rayBegin,T=r.rayEnd;if(m<g*g){let e=Number.MAX_VALUE;if(Object(h.a)(Object(h.f)(le,ue,he),Object(h.f)(j,T,de),ae)){Object(c.j)(ae,ae,j);const t=Object(c.p)(ae);Object(c.e)(ae,ae,1/t),e=t/Object(c.m)(j,T)}a(e,ae,O,!1)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices,n=i.get(y.a.POSITION);return Object(b.a)(n,r?r.get(y.a.POSITION):null,r&&ee(this.parameters,i,r),t)}createLayout(){const e=Object(p.a)().vec3f(y.a.POSITION).f32(y.a.SUBDIVISIONFACTOR).vec2f(y.a.UV0).vec3f(y.a.AUXPOS1).vec3f(y.a.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(y.a.SIZEFEATUREATTRIBUTE):e.f32(y.a.SIZE),this.parameters.vvColorEnabled?e.f32(y.a.COLORFEATUREATTRIBUTE):e.vec4f(y.a.COLOR),this.parameters.vvOpacityEnabled&&e.f32(y.a.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new K(this.layout,this.parameters)}requiresSlot(e,t){if(e===_.a.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===O.c.OccludeAndTransparentStencil)return e===_.a.OPAQUE_MATERIAL||e===_.a.OCCLUDER_MATERIAL||e===_.a.TRANSPARENT_OCCLUDER_MATERIAL;const i=Object(m.b)(t);return i===f.a.Color||i===f.a.Alpha?e===(this.parameters.writeDepth?_.a.TRANSPARENT_MATERIAL:_.a.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===_.a.OPAQUE_MATERIAL}createGLMaterial(e){return e.output===f.a.Color||e.output===f.a.Alpha||e.output===f.a.Highlight||e.output===f.a.Depth?new $(e):null}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),this._requiresTransparent(e)&&(e.transparent=!0)}_requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this._colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this._colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}_colorRequiresTransparent(e){return Object(a.k)(e)&&e[3]<1&&e[3]>0}}class $ extends g.a{updateParameters(e){return this.ensureTechnique(H,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return this._output!==f.a.Color&&this._output!==f.a.Alpha||this._updateOccludeeState(e),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const Q={width:0,color:[1,1,1,1],join:"miter",cap:T.a.BUTT,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,wireframe:!1,...O.a,...j.a};class K{constructor(e,t){this.parameters=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=t.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=T.b+i}}_isClosed(e){return ee(this.parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.indices.get(y.a.POSITION).length/2+1,i=this._isClosed(e);let r=i?2:4;return r+=((i?t:t-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this.parameters.wireframe&&(r=2+4*(r-2)),r}write(e,t,i,r){var n;const a=pe,s=fe,o=be,l=t.vertexAttributes.get(y.a.POSITION).data,u=t.indices&&t.indices.get(y.a.POSITION),h=null==(n=t.vertexAttributes.get(y.a.DISTANCETOSTART))?void 0:n.data;u&&u.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let d=1,p=0;this.parameters.vvSizeEnabled?p=t.vertexAttributes.get(y.a.SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(y.a.SIZE)&&(d=t.vertexAttributes.get(y.a.SIZE).data[0]);let f=[1,1,1,1],b=0;this.parameters.vvColorEnabled?b=t.vertexAttributes.get(y.a.COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(y.a.COLOR)&&(f=t.vertexAttributes.get(y.a.COLOR).data);let g=0;this.parameters.vvOpacityEnabled&&(g=t.vertexAttributes.get(y.a.OPACITYFEATUREATTRIBUTE).data[0]);const m=l.length/3,O=e.transformation,_=new Float32Array(i.buffer),v=this.vertexBufferLayout.stride/4;let j=r*v;const x=j;let T=0;const S=h?(e,t,i)=>T=h[i]:(e,t,i)=>T+=Object(c.m)(e,t),E=(e,t,i,r,n,a,s)=>{if(_[j++]=t[0],_[j++]=t[1],_[j++]=t[2],_[j++]=r,_[j++]=s,_[j++]=n,_[j++]=e[0],_[j++]=e[1],_[j++]=e[2],_[j++]=i[0],_[j++]=i[1],_[j++]=i[2],this.parameters.vvSizeEnabled?_[j++]=p:_[j++]=d,this.parameters.vvColorEnabled)_[j++]=b;else{const e=Math.min(4*a,f.length-4);_[j++]=f[e+0],_[j++]=f[e+1],_[j++]=f[e+2],_[j++]=f[e+3]}this.parameters.vvOpacityEnabled&&(_[j++]=g)};j+=v,Object(c.w)(s,l[0],l[1],l[2]),O&&Object(c.q)(s,s,O);const A=this._isClosed(t);if(A){const e=l.length-3;Object(c.w)(a,l[e],l[e+1],l[e+2]),O&&Object(c.q)(a,a,O)}else Object(c.w)(o,l[3],l[4],l[5]),O&&Object(c.q)(o,o,O),E(s,s,o,1,Z.LEFT_CAP_START,0,0),E(s,s,o,1,Z.RIGHT_CAP_START,0,0),Object(c.k)(a,s),Object(c.k)(s,o);const w=A?0:1,M=A?m:m-1;for(let y=w;y<M;y++){const e=(y+1)%m*3;Object(c.w)(o,l[e+0],l[e+1],l[e+2]),O&&Object(c.q)(o,o,O),S(a,s,y),E(a,s,o,0,Z.LEFT_JOIN_END,y,T),E(a,s,o,0,Z.RIGHT_JOIN_END,y,T);const t=this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);E(a,s,o,e,Z.LEFT_JOIN_END,y,T),E(a,s,o,e,Z.RIGHT_JOIN_END,y,T)}E(a,s,o,1,Z.LEFT_JOIN_START,y,T),E(a,s,o,1,Z.RIGHT_JOIN_START,y,T),Object(c.k)(a,s),Object(c.k)(s,o)}A?(Object(c.w)(o,l[3],l[4],l[5]),O&&Object(c.q)(o,o,O),T=S(a,s,M),E(a,s,o,0,Z.LEFT_JOIN_END,w,T),E(a,s,o,0,Z.RIGHT_JOIN_END,w,T)):(T=S(a,s,M),E(a,s,s,0,Z.LEFT_CAP_END,M,T),E(a,s,s,0,Z.RIGHT_CAP_END,M,T)),J(_,x+v,_,x,v),j=J(_,j-v,_,j,v),this.parameters.wireframe&&this._addWireframeVertices(i,x,j,v)}_addWireframeVertices(e,t,i,r){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let s=0;const o=e=>s=J(a,e,n,s,r);for(let c=0;c<a.length-1;c+=2*r)o(c),o(c+2*r),o(c+1*r),o(c+2*r),o(c+1*r),o(c+3*r)}}function J(e,t,i,r,n){for(let a=0;a<n;a++)i[r++]=e[t++];return r}function ee(e,t,i){return te(e,t.get(y.a.POSITION).data,i?i.get(y.a.POSITION):null)}function te(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const ie=Object(l.f)(),re=Object(l.f)(),ne=Object(l.f)(),ae=Object(l.f)(),se=Object(l.f)(),oe=Object(s.d)(),ce=Object(s.d)(),le=Object(l.f)(),ue=Object(l.f)(),he=Object(h.d)(),de=Object(h.d)(),pe=Object(l.f)(),fe=Object(l.f)(),be=Object(l.f)(),ge=[Object(s.d)(),Object(s.d)(),Object(s.d)(),Object(s.d)()],me=[Object(l.f)(),Object(l.f)(),Object(l.f)(),Object(l.f)()],Oe=Object(d.d)(),_e=Object(d.d)(),ve=Object(d.d)(),ye=Object(d.d)()},795:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(85),n=i(91),a=i(488),s=i(490),o=i(712),c=i(514);class l{constructor(){this.next=new s.a}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:l,updatingHandles:u}){if(Object(r.j)(i))return e=>e;let h=null,d=null;const p=()=>{h=Object(r.a)(h),i.doneSnapping(),Object(r.k)(d)&&d.frameTask.remove(),d=null};return t.next((e=>(p(),e))),this.next=new s.a,t=>{if(!e(t))return t;if(h=Object(r.a)(h),"start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(c.b.SNAPPING):c.a;d={context:new o.a({editGeometryOperations:l.editGeometryOperations,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:Object(r.k)(t.info)?t.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:Object(r.k)(t.snapOrigin)?l.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(Object(r.k)(d)){const e=d.context.coordinateHelper.vectorToDehydratedPoint(d.context.coordinateHelper.arrayToVector([d.originalPos.x,d.originalPos.y,d.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const r=t.mapStart.x-d.originalPos.x,s=t.mapStart.y-d.originalPos.y,o={...t,action:"udpate"},c=d.context,l=i.update(e,d.context);if(t.mapEnd.x=l.x+r,t.mapEnd.y=l.y+s,"end"!==t.action){const t=d.frameTask;h=Object(n.g)((async n=>{const u=await t.schedule((()=>i.snap(e,c,n)),n);if(u.valid){const e=await t.schedule((()=>u.apply()),n);Object(a.a)(e,l)||(o.mapEnd.x=e.x+r,o.mapEnd.y=e.y+s,this.next.execute(o))}})),u.addPromise(h.promise)}}return"end"===t.action&&p(),t}}}},796:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(244);class n{constructor(e){this.channel=e,this.id=Object(r.a)()}}},797:function(e,t,i){"use strict";function r(e){return"point"===e.type}i.d(t,"a",(function(){return r}))},798:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(79),n=i(100),a=i(81),s=(i(84),i(82),i(83),i(80));let o=class extends n.a{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};Object(r.a)([Object(a.b)()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(r.a)([Object(a.b)()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(r.a)([Object(a.b)()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(r.a)([Object(a.b)()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TEXT_SHOW_BASELINE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TEXT_SHOW_BORDER",void 0),Object(r.a)([Object(a.b)()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(r.a)([Object(a.b)()],o.prototype,"SHOW_POI",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(r.a)([Object(a.b)()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LINE_WIREFRAMES",void 0),o=Object(r.a)([Object(s.a)("esri.views.3d.support.DebugFlags")],o);const c=new o},799:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(502),n=i(126);function a(e,t){const i=e.fragment,a=void 0!==t.lightingSphericalHarmonicsOrder?t.lightingSphericalHarmonicsOrder:2;0===a?(i.uniforms.add("lightingAmbientSH0","vec3"),i.code.add(n.a`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===a?(i.uniforms.add("lightingAmbientSH_R","vec4"),i.uniforms.add("lightingAmbientSH_G","vec4"),i.uniforms.add("lightingAmbientSH_B","vec4"),i.code.add(n.a`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===a&&(i.uniforms.add("lightingAmbientSH0","vec3"),i.uniforms.add("lightingAmbientSH_R1","vec4"),i.uniforms.add("lightingAmbientSH_G1","vec4"),i.uniforms.add("lightingAmbientSH_B1","vec4"),i.uniforms.add("lightingAmbientSH_R2","vec4"),i.uniforms.add("lightingAmbientSH_G2","vec4"),i.uniforms.add("lightingAmbientSH_B2","vec4"),i.code.add(n.a`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==r.a.Normal&&t.pbrMode!==r.a.Schematic||i.code.add(n.a`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}},800:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){const t=e.fragment;t.uniforms.add("lightingMainDirection","vec3"),t.uniforms.add("lightingMainIntensity","vec3"),t.uniforms.add("lightingFixedFactor","float"),t.uniforms.add("lightingSpecularStrength","float"),t.uniforms.add("lightingEnvironmentStrength","float"),t.code.add(r.a`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},801:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var r=i(85),n=i(102),a=i(151),s=i(117),o=i(288);function c(e,t,i){return l(e,e.screenToRender(t,Object(n.b)(o.d.get())),i)}function l(e,t,i){const c=Object(n.b)(Object(a.c)(o.d.get(),t));if(c[2]=0,!e.unprojectFromRenderScreen(c,i.origin))return null;const l=Object(n.b)(Object(a.c)(o.d.get(),t));l[2]=1;const u=e.unprojectFromRenderScreen(l,o.d.get());return Object(r.j)(u)?null:(Object(s.j)(i.direction,u,i.origin),i)}},805:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(410),n=i(126);function a(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(n.a`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function s(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(r.a),e.include(a),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(n.a`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),e.fragment.code.add(n.a`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),e.fragment.code.add(n.a`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),e.fragment.code.add(n.a`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?e.fragment.code.add(n.a`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):e.fragment.code.add(n.a`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},818:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(e,t){var i;return null==(i=this._outer.get(e))?void 0:i.get(t)}set(e,t,i){const r=this._outer.get(e);r?r.set(t,i):this._outer.set(e,new Map([[t,i]]))}delete(e,t){const i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}forEach(e){this._outer.forEach(((t,i)=>e(t,i)))}}},819:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(103);async function n(e,t){const{data:i}=await Object(r.default)(e,{responseType:"image",...t});return i}},825:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return p}));i(99);var r=i(85),n=i(358),a=i(758),s=i(543),o=i(462),c=i(117),l=i(109),u=i(584),h=i(113);function d(e,t,i=null){return Object(r.k)(i)?[e,t,i]:[e,t]}function p(e,t,i=null){return Object(r.k)(i)?{x:e,y:t,z:i}:{x:e,y:t}}class f{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return Object(r.g)(e.map((e=>this.mapToLocal(e))))}get doUnnormalization(){return!1}}class b extends f{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=Object(a.b)(),this.transformInv=Object(a.b)(),this.transform=Object(a.a)(e),Object(n.e)(this.transformInv,this.transform)}makeMapPoint(e,t){return d(e,t,this.defaultZ)}mapToLocal(e){return p(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return d(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class g extends f{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=Object(l.f)(),this.tangentFrameUpWS=Object(l.f)(),this.tangentFrameRightWS=Object(l.f)(),this.tangentFrameForwardWS=Object(l.f)(),this.localFrameRightWS=Object(l.f)(),this.localFrameUpWS=Object(l.f)(),this.worldToLocalTransform=Object(o.b)(),this.localToWorldTransform=Object(o.b)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,u.a.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,u.a.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,u.a.Z,this.tangentFrameForwardWS);const r=Object(l.f)();Object(c.e)(r,this.tangentFrameForwardWS,Object(c.h)(i,this.tangentFrameForwardWS)),Object(c.j)(this.localFrameRightWS,i,r),Object(c.r)(this.localFrameRightWS,this.localFrameRightWS),Object(c.g)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Object(s.g)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Object(s.c)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return d(e,t,this.defaultZ)}mapToLocal(e){const t=Object(l.f)();this.view.renderCoordsHelper.toRenderCoords(new h.a({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(c.u)(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r.k)(i)?p(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=Object(l.f)();this.view.renderCoordsHelper.toRenderCoords(new h.a({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(c.u)(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r.k)(i)?d(i.x,i.y,this.defaultZ):null}}function m(e,t){if("2d"===e.type)return new b(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new h.a({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new h.a({x:t[0],y:t[1],spatialReference:e.spatialReference});return new g(e,i)}return null}},826:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return f}));var r,n,a=i(85),s=i(211),o=i(212),c=i(117),l=i(109),u=i(620),h=i(360),d=i(498),p=i(278);class f{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new b,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),b.clearPool(),E[0]=null,C.prune(),F.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=b.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}b.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=b.acquire();for(const r of e){const e=Object(a.k)(t)?t:Object(d.b)(this._objectToBoundingSphere(r),P);j(e[3])?(i.init(this._root),this._remove(r,e,i)):this._degenerateObjects.delete(r)}b.release(i),this._shrink()}update(e,t){if(!j(t[3])&&this._isDegenerate(e))return;const i=function(e){return E[0]=e,E}(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=Object(h.g)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,r){const n=Object(h.g)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNodeWithOffset(n,e,r))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),!0}))}forEach(e){this._forEachNode(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),n=1/0){let a=1/0,s=1/0,o=null;const l=v(e,t),h=c=>{if(--n,!r(c))return;const l=this._objectToBoundingSphere(c);if(!Object(u.f)(i,l))return;const h=y(e,t,Object(d.e)(l)),p=h-l[3],f=h+l[3];p<a&&(a=p,s=f,o=c)};return this._forEachNodeDepthOrdered(this._root,(r=>{if(n<=0||!Object(u.f)(i,r.bounds))return!1;if(Object(c.e)(w,l,r.halfSize),Object(c.f)(w,w,r.bounds),y(e,t,w)>s)return!1;const a=r.node;return a.terminals.forAll((e=>h(e))),null!==a.residents&&a.residents.forAll((e=>h(e))),!0}),e,t),o}forEachInDepthRange(e,t,i,n,a,s,o){let l=-1/0,h=1/0;const p={setRange:e=>{i===r.FRONT_TO_BACK?(l=Math.max(l,e.near),h=Math.min(h,e.far)):(l=Math.max(l,-e.far),h=Math.min(h,-e.near))}};p.setRange(n);const f=y(t,i,e),b=v(t,i),g=v(t,-i),m=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),n=Object(d.e)(r),c=y(t,i,n)-f,b=c-r[3],g=c+r[3];b>h||g<l||!Object(u.f)(s,r)||a(e,p)};this._forEachNodeDepthOrdered(this._root,(e=>{if(!Object(u.f)(s,e.bounds))return!1;if(Object(c.e)(w,b,e.halfSize),Object(c.f)(w,w,e.bounds),y(t,i,w)-f>h)return!1;if(Object(c.e)(w,g,e.halfSize),Object(c.f)(w,w,e.bounds),y(t,i,w)-f<l)return!1;const r=e.node;return r.terminals.forAll((e=>m(e))),null!==r.residents&&r.residents.forAll((e=>m(e))),!0}),t,i)}forEachNode(e){this._forEachNode(this._root,(t=>e(t.node,t.bounds,t.halfSize)))}_intersectsNode(e,t){return O(t.bounds,2*-t.halfSize,M),O(t.bounds,2*t.halfSize,R),Object(p.h)(e.origin,e.direction,M,R)}_intersectsNodeWithOffset(e,t,i){return O(t.bounds,2*-t.halfSize,M),O(t.bounds,2*t.halfSize,R),i.applyToMinMax(M,R),Object(p.h)(e.origin,e.direction,M,R)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(d.f)(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(d.f)(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=b.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(b.acquire().init(i).advance(e));b.release(i)}}_forEachNodeDepthOrdered(e,t,i,n=r.FRONT_TO_BACK){let a=b.acquire().init(e);const s=[a];for(function(e,t,i){if(!F.length)for(let r=0;r<8;++r)F.push({index:0,distance:0});for(let r=0;r<8;++r){const i=x[r];F.data[r].index=r,F.data[r].distance=y(e,t,i)}F.sort(((e,t)=>e.distance-t.distance));for(let r=0;r<8;++r)i[r]=F.data[r].index}(i,n,z);0!==s.length;){if(a=s.pop(),t(a)&&!a.isLeaf())for(let e=7;e>=0;--e){const t=z[e];a.node.children[t]&&s.push(b.acquire().init(a).advance(t))}b.release(a)}}_remove(e,t,i){C.clear();const r=i.advanceTo(t,((e,t)=>{C.push(e.node),C.push(t)}))?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let n=C.length-2;n>=0;n-=2){const e=C.data[n],t=C.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new o.a({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=b.acquire().init(e);this._add(t.getItemAt(i),r),b.release(r)}}_grow(e,t){if(0!==t&&(_(e,t,(e=>this._objectToBoundingSphere(e)),I),j(I[3])&&!this._fitsInsideTree(I)))if(this._nodeIsEmpty(this._root.node))Object(d.b)(I,this._root.bounds),this._root.halfSize=1.25*I[3];else{const e=this._rootBoundsForRootAsSubNode(I);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(I,e):this._growRootAsSubNode(e),b.release(e)}}_rebuildTree(e,t){Object(c.k)(D,t.bounds),D[3]=t.halfSize,_([e,D],2,(e=>e),L);const i=b.acquire().init(this._root);this._root.initFrom(null,L,1.25*L[3]),this._forEachNode(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),b.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let s=0;s<3;s++){const e=n[s]-a-(i[s]-t),o=i[s]+t-(n[s]+a),c=Math.max(0,Math.ceil(e/(2*a))),l=Math.max(0,Math.ceil(o/(2*a)))+1,u=2**Math.ceil(Math.log(c+l)*Math.LOG2E);r=Math.max(r,u),N[s].min=c,N[s].max=l}for(let s=0;s<3;s++){let e=N[s].min,t=N[s].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const o=n[s]-a-e*a*2;A[s]=o+(t+e)*a}return A[3]=r*a*S,b.acquire().initFrom(null,A,r*a,0)}_growRootAsSubNode(e){const t=this._root.node;Object(c.k)(I,this._root.bounds),I[3]=this._root.halfSize,this._root.init(e),e.advanceTo(I,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!j(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class b{constructor(){this.bounds=Object(d.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=Object(a.k)(e)?e:b.createEmptyNode(),Object(a.k)(t)&&Object(d.b)(t,this.bounds),this.halfSize=i,this.depth=r,this}advance(e){let t=this.node.children[e];t||(t=b.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=x[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*S,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new o.a({shrink:!0}),residents:new o.a({shrink:!0})}}static acquire(){return b._pool.acquire()}static release(e){b._pool.release(e)}static clearPool(){b._pool.prune()}}function g(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function m(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function O(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function _(e,t,i,r){if(1===t){const t=i(e[0]);Object(d.b)(t,r)}else{M[0]=1/0,M[1]=1/0,M[2]=1/0,R[0]=-1/0,R[1]=-1/0,R[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);j(t[3])&&(g(M,t),m(R,t))}Object(c.i)(r,M,R,.5),r[3]=Math.max(R[0]-M[0],R[1]-M[1],R[2]-M[2])/2}}function v(e,t){let i=1/0,r=null;for(let n=0;n<8;++n){const a=y(e,t,T[n]);a<i&&(i=a,r=T[n])}return r}function y(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function j(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}b._pool=new s.a(b),(n=r||(r={}))[n.FRONT_TO_BACK=1]="FRONT_TO_BACK",n[n.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const x=[Object(l.h)(-1,-1,-1),Object(l.h)(1,-1,-1),Object(l.h)(-1,1,-1),Object(l.h)(1,1,-1),Object(l.h)(-1,-1,1),Object(l.h)(1,-1,1),Object(l.h)(-1,1,1),Object(l.h)(1,1,1)],T=[Object(l.h)(-1,-1,-1),Object(l.h)(-1,-1,1),Object(l.h)(-1,1,-1),Object(l.h)(-1,1,1),Object(l.h)(1,-1,-1),Object(l.h)(1,-1,1),Object(l.h)(1,1,-1),Object(l.h)(1,1,1)],S=Math.sqrt(3),E=[null];const A=Object(d.c)(),w=Object(l.f)(),M=Object(l.f)(),R=Object(l.f)(),C=new o.a,P=Object(d.c)(),I=Object(d.c)(),D=Object(d.c)(),L=Object(d.c)(),N=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=new o.a,z=[0,0,0,0,0,0,0,0]},827:function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return j})),i.d(t,"d",(function(){return x}));var r=i(151),n=i(219),a=i(257),s=i(895),o=i(210),c=i(301),l=i(946),u=i(753),h=i(1084),d=i(420),p=i(623),f=i(397),b=i(464),g=i(500),m=i(747),O=i(126),_=i(297),v=i(139);function y(e){const t=new _.a,i=e.signedDistanceFieldEnabled;if(t.include(l.a),t.include(u.a,e),t.include(c.a,e),e.output===o.a.Occlusion)return t.include(h.a,e),t;t.include(m.a),t.fragment.include(g.a),t.fragment.include(b.a),t.include(p.a,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(v.a.UV0,"vec2"),t.attributes.add(v.a.COLOR,"vec4"),t.attributes.add(v.a.SIZE,"vec2"),t.attributes.add(v.a.AUXPOS2,"vec4"),t.vertex.code.add(O.a`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?O.a`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:O.a`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const r=O.a`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,n=e.pixelSnappingEnabled?i?O.a`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:O.a`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:O.a`posProj += quadOffset;`;t.vertex.code.add(O.a`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${r}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${O.a.float(f.c)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${O.a.float(f.c)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${n}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?O.a`} else { vtc = vec2(0.0);
        ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const a=e.debugDrawLabelBorder?O.a`(isBorder > 0.0 ? 0.0 : ${O.a.float(f.b)})`:O.a.float(f.b),y=O.a`
    ${e.debugDrawLabelBorder?O.a`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?O.a`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${O.a.float(s.b)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${O.a.float(f.c)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:O.a`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?O.a`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===o.a.Alpha&&t.fragment.code.add(O.a`
      void main() {
        ${y}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===o.a.Color&&t.fragment.code.add(O.a`
    void main() {
      ${y}
      ${e.frontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===o.a.Highlight&&(t.include(d.a),t.fragment.code.add(O.a`
    void main() {
      ${y}
      ${e.binaryHighlightOcclusionEnabled?O.a`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function j(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a.b),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",x(t))}function x(e,t=T){return e.textureIsSignedDistanceField?function(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):Object(r.c)(t,e.anchorPos),t}const T=Object(n.a)(),S=Object.freeze({__proto__:null,build:y,bindHUDMaterialUniforms:j,calculateAnchorPosForRendering:x})},828:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return g}));var r=i(210),n=i(301),a=i(478),s=i(624),o=i(622),c=i(420),l=i(410),u=i(356),h=i(397),d=i(464),p=i(126),f=i(297),b=i(139);function g(e){const t=new f.a,i=e.output===r.a.Depth;return t.include(a.a,{linearDepth:i}),t.include(s.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add(b.a.POSITION,"vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(o.a,e),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(p.a`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?p.a`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:p.a`transformPosition(proj, view, vpos);`}
    }
  `),t.include(n.a,e),t.fragment.include(d.a),e.multipassTerrainEnabled&&(t.fragment.include(l.a),t.include(u.b,e)),t.fragment.uniforms.add("eColor","vec4"),e.output===r.a.Highlight&&t.include(c.a),t.fragment.code.add(p.a`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${p.a.float(h.c)}) {
      discard;
    }

    ${e.output===r.a.Alpha?p.a`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===r.a.Color?p.a`gl_FragColor = highlightSlice(fColor, vpos); ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===r.a.Highlight?p.a`outputHighlight();`:""};
    ${e.output===r.a.Depth?p.a`outputDepth(linearDepth);`:""};
  }
  `),t}const m=Object.freeze({__proto__:null,build:g})},829:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i(126);function n(e){e.vertex.uniforms.add("cameraPosition","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(r.a`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function a(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},849:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return c}));var r=i(116),n=i(543),a=i(462),s=i(117);function o(e=p){return[e[0],e[1],e[2],e[3]]}function c(e,t,i=o()){return Object(s.k)(i,e),i[3]=t,i}function l(e,t,i=o()){return Object(n.h)(f,e,d(e)),Object(n.h)(b,t,d(t)),Object(n.f)(f,b,f),function(e,t){return e[3]=t,e}(i,Object(r.n)(Object(n.b)(i,f)))}function u(e){return e}function h(e){return e[3]}function d(e){return Object(r.g)(e[3])}const p=[0,0,1,0],f=Object(a.b)(),b=Object(a.b)();o()},855:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return p}));var r=i(87),n=i(638),a=i(130);const s=r.a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const n=b(r);if(null!=n)return{cachedResult:n};const s=await Object(a.e)(),o=s.arcadeUtils,c=o.createSyntaxTree(r);return o.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(c),context:o.createExecContext(null,{sr:t}),modules:s}}}function l(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function u(e,t){if(null!=e&&!f(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Object(n.b)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function h(e){if(null!=e){if(f(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function d(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const p={cachedResult:0};function f(e){return null!=e.cachedResult}function b(e){return"0"===e?0:null}},856:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(85),n=i(91),a=i(163),s=i(545);class o extends s.a{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,(e=>this._texture=e)),this._acquire(e.normalTextureId,(e=>this._textureNormal=e)),this._acquire(e.emissiveTextureId,(e=>this._textureEmissive=e)),this._acquire(e.occlusionTextureId,(e=>this._textureOcclusion=e)),this._acquire(e.metallicRoughnessTextureId,(e=>this._textureMetallicRoughness=e))}dispose(){this._texture=Object(r.q)(this._texture),this._textureNormal=Object(r.q)(this._textureNormal),this._textureEmissive=Object(r.q)(this._textureEmissive),this._textureOcclusion=Object(r.q)(this._textureOcclusion),this._textureMetallicRoughness=Object(r.q)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?a.g.LOADED:a.g.LOADING}updateTexture(e){(Object(r.j)(this._texture)||e!==this._texture.id)&&(this._texture=Object(r.q)(this._texture),this._textureId=e,this._acquire(this._textureId,(e=>this._texture=e)))}bindTextures(e){Object(r.k)(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(r.k)(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(r.k)(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(r.k)(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(r.k)(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(e){const t=Object(r.k)(this._texture)?this._texture.glTexture:null;Object(r.k)(t)&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(e,t){if(Object(r.j)(e))return void t(null);const i=this._textureRepository.acquire(e);if(Object(n.n)(i))return++this._numLoading,void i.then((e=>{if(this._disposed)return Object(r.q)(e),void t(null);t(e)})).finally((()=>--this._numLoading));t(i)}}},857:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i(410),n=i(126);function a(e){e.include(r.a),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("nearFar","vec2"),e.code.add(n.a`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function s(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},858:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return n}));var r=i(116);const n=(()=>{if(!("document"in globalThis))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,i=>{t.clearRect(0,0,1,e.height);const r=t.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:t}of i)r.addColorStop(Math.max(e,.001),`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`);return t.fillStyle=r,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function a(e,t,i,r){const{blurRadius:n,fieldOffset:a,field:s}=t,c=new Float64Array(i*r),l=o(n),u=Math.round(3*n);let h,d=Number.NEGATIVE_INFINITY;const p=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):i=>+i.readAttribute(e)+t:e=>1}(s,a),f=new Set;for(const o of e){const e=o.getCursor();for(;e.next();){const t=e.getObjectId();if(f.has(t))continue;f.add(t);const n=e.readLegacyPointGeometry(),a=128;if(n.x<-a||n.x>=i+a||n.y<-a||n.y>r+a)continue;const s=+p(e),o=Math.round(n.x)-u,b=Math.round(n.y)-u,g=Math.max(0,o),m=Math.max(0,b),O=Math.min(r,Math.round(n.y)+u),_=Math.min(i,Math.round(n.x)+u);for(let e=m;e<O;e++){const t=l[e-b];for(let r=g;r<_;r++){const n=l[r-o];h=c[e*i+r]+=t*n*s,h>d&&(d=h)}}}}return{matrix:c.buffer,max:d}}function s(e,t,i,n,a,s){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const o=e.getImageData(0,0,t,t);i&&n&&o.data.set(new Uint8ClampedArray(function(e,t,i,n,a){const s=new Uint32Array(e*e),o="buffer"in t?t:new Float64Array(t),c="buffer"in i?new Uint32Array(i.buffer):new Uint32Array(new Uint8Array(i).buffer),l=c.length/(a-n);for(let u=0;u<o.length;u++){const e=o[u],t=Math.floor((e-n)*l);s[u]=c[Object(r.e)(t,0,c.length-1)]}return s.buffer}(t,i,n,a,s))),e.putImageData(o,0,0)}function o(e){const t=Math.round(3*e),i=2*e*e,r=new Float64Array(2*t+1);for(let n=0;n<=r.length;n++)r[n]=Math.exp(-((n-t)**2)/i)/Math.sqrt(2*Math.PI)*(e/2);return r}},859:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r,n,a=i(687),s=i(126),o=i(297);function c(e){const t=new o.a;return t.include(a.a),t.fragment.uniforms.add("tex","sampler2D"),e.function===r.Standard&&(e.hasOpacityFactor?(t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(s.a`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):t.fragment.code.add(s.a`void main() {
gl_FragColor = texture2D(tex, uv);
}`)),e.function===r.OverlayWithTransparency&&(t.fragment.uniforms.add("overlayIdx","int"),e.hasOpacityFactor&&t.fragment.uniforms.add("opacity","float"),t.fragment.code.add(s.a`
      void main() {
        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
        gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
      }`)),e.function===r.TransparentToHUDVisibility&&t.fragment.code.add(s.a`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`),e.function===r.Transparency&&(t.fragment.uniforms.add("colorTexture","sampler2D"),t.fragment.uniforms.add("alphaTexture","sampler2D"),t.fragment.uniforms.add("frontFaceTexture","sampler2D"),t.fragment.code.add(s.a`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`)),t}(n=r||(r={}))[n.Standard=0]="Standard",n[n.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",n[n.Transparency=2]="Transparency",n[n.OverlayWithTransparency=3]="OverlayWithTransparency",n[n.COUNT=4]="COUNT";const l=Object.freeze({__proto__:null,get CompositingFunction(){return r},build:c})},861:function(e,t,i){"use strict";i.d(t,"a",(function(){return te}));var r=i(85),n=i(117),a=i(109),s=i(499),o=i(944),c=i(116),l=i(219),u=i(271),h=i(257),d=i(767),p=i(620),f=i(423),b=i(360),g=i(498),m=i(726),O=i(495),_=i(139),v=i(79),y=i(147),j=i(200),x=i(388),T=i(404),S=i(419),E=i(389),A=i(893),w=i(94),M=i(355);class R extends T.a{initializeProgram(e){const t=R.shader.get(),i=this.configuration,r=t.build(i);return new E.a(e.rctx,r,R.attributeLocations)}bind(e,t,i){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("proj",i.projectionMatrix),Object(y.j)(P,i.viewMatrix,t),this.program.setUniformMatrix4fv("modelView",P),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}initializePipeline(){return Object(M.f)({blending:Object(M.h)(w.b.ONE,w.b.ONE_MINUS_SRC_ALPHA),colorWrite:M.c})}}R.shader=new x.a(A.a,(()=>i.e(328).then(i.bind(null,1341)))),R.attributeLocations=new Map([[_.a.START,0],[_.a.END,1],[_.a.UP,2],[_.a.EXTRUDE,3]]);class C extends S.a{constructor(){super(...arguments),this.contrastControlEnabled=!1}}Object(v.a)([Object(S.b)()],C.prototype,"contrastControlEnabled",void 0);const P=Object(j.d)();var I=i(162),D=i(164);class L{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=Object(a.f)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1],t[i++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);Object(n.w)(this._origin,e[t+0],e[t+1],e[t+2])}else Object(n.w)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);Object(r.k)(t)&&(e.bindVAO(t),e.drawArrays(w.r.TRIANGLES,0,this._count))}dispose(){Object(r.k)(this._vao)&&this._vao.dispose()}_ensureVAO(e){return Object(r.j)(this._buffers)?null:(Object(r.j)(this._vao)&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new D.a(e,R.attributeLocations,{data:Object(m.a)(z)},{data:I.a.createVertex(e,w.D.STATIC_DRAW,i)})}_ensureVertexData(e,t){if(!this._dirty)return;const i=this._createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const i=z.createBuffer(t),r=this._origin;let a=0,s=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=Object(n.w)(F,o[e+0],o[e+1],o[e+2]);0===e?s=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,s);const c=this._renderCoordsHelper.worldUpAtPosition(t,N),l=a+2*e,u=Object(n.j)(F,t,r);if(e<o.length-3){i.up.setVec(l,c),i.up.setVec(l+3,c),i.up.setVec(l+5,c);for(let e=0;e<6;e++)i.start.setVec(l+e,u);i.extrude.setValues(l+0,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,c),i.up.setVec(l-4,c),i.up.setVec(l-5,c);for(let e=-6;e<0;e++)i.end.setVec(l+e,u)}}a+=this._numberOfRenderVertices(o)}return i.buffer}}const N=Object(a.f)(),F=Object(a.f)(),z=Object(O.a)().vec3f(_.a.START).vec3f(_.a.END).vec3f(_.a.UP).vec2f(_.a.EXTRUDE);var U=i(692),G=i(411),V=i(278),k=i(434),H=i(382),B=i(769);class W extends T.a{initializeProgram(e){const t=W.shader.get(),i=this.configuration,r=t.build(i);return new E.a(e.rctx,r,H.a)}bind(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);const i=null!=e.angleCutoff?e.angleCutoff:B.c;this.program.setUniform2f("angleCutoff",Math.cos(i),Math.cos(Math.max(0,i-Object(c.g)(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}initializePipeline(){return Object(M.f)({blending:Object(M.h)(w.b.ONE,w.b.ONE_MINUS_SRC_ALPHA),colorWrite:M.c})}}W.shader=new x.a(B.a,(()=>i.e(329).then(i.bind(null,1342))));class q extends S.a{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1}}Object(v.a)([Object(S.b)()],q.prototype,"heightManifoldEnabled",void 0),Object(v.a)([Object(S.b)()],q.prototype,"pointDistanceEnabled",void 0),Object(v.a)([Object(S.b)()],q.prototype,"lineVerticalPlaneEnabled",void 0),Object(v.a)([Object(S.b)()],q.prototype,"intersectsLineEnabled",void 0),Object(v.a)([Object(S.b)()],q.prototype,"contrastControlEnabled",void 0);const Z=Object(a.f)(),X=Object(h.e)(),Y={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Object(c.g)(6),globalAlphaContrastBoost:2};function $(e,t,i,r){const a=Z,s=X;Object(n.q)(a,t,r),Object(n.k)(s,i),s[3]=0,Object(u.m)(s,s,r),Object(f.g)(a,s,e)}class Q{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=Object(h.e)(),this._zScale=Object(l.a)(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=Object(a.f)(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=Object(a.f)(),this._pointDistanceTarget=Object(a.f)(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=Object(s.d)(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=Object(s.d)(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=Object(a.f)(),this._tempDir=Object(a.f)(),this._tempUp=Object(a.f)(),this._tempVec3A=Object(a.f)(),this._tempVec3B=Object(a.f)(),this._tempVec4=Object(h.e)(),this._tempPlane=Object(f.d)(),this._tempSphere=Object(g.c)(),this._params=Object(k.c)(t,Y)}get renderSlots(){return[this._config.contrastControlEnabled?G.a.LASERLINES_CONTRAST_CONTROL:G.a.LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){Object(n.k)(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){Object(n.k)(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){Object(n.k)(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){Object(s.c)(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){Object(s.c)(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,Object(r.k)(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){Object(r.j)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new L(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){Object(r.j)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new L(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){Object(k.h)(this._params,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=Object(U.b)(t),this._techniqueRepository=e.shaderTechniqueRepository,this._techniqueConfig=new q;const i=new C;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(R,i)}uninitializeRenderContext(){this._quadVAO=Object(r.e)(this._quadVAO),this._technique=Object(r.q)(this._technique),this._pathVerticalPlaneData=Object(r.e)(this._pathVerticalPlaneData),this._pathTechnique=Object(r.q)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(W,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(e,t){const i=e.camera;Object(V.f)(i.projectionMatrix,i.fullWidth,i.fullHeight,this._projInfo,this._zScale),(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx,r=i.useTechnique(t);this._bindGlobalUniforms(e,r),this._bindHeightManifoldUniforms(e,r),this._bindPointDistanceUniforms(e,r),this._bindLineVerticalPlaneUniforms(e,r),this._bindIntersectsLineUniforms(e,r),t.bind(this._params,e.camera),i.bindVAO(this._quadVAO),i.drawArrays(w.r.TRIANGLE_STRIP,0,4)}_renderPath(e){if(Object(r.j)(this._pathVerticalPlaneData)||Object(r.j)(this._pathTechnique))return;const t=e.rctx,i=this._pathTechnique,n=t.useTechnique(i);this._bindGlobalUniforms(e,n),i.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}_bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,r=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),$(r,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",r)}_bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,r=this._tempSphere;Object(n.k)(r,this._pointDistanceOrigin),Object(n.q)(r,r,i.viewMatrix),r[3]=Object(n.m)(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r[0],r[1],r[2],r[3])}_bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,r=e.camera,a=this._tempPlane,o=this._tempVec3A,c=this._tempUp,l=this._tempDir,u=this._tempNormal;Object(s.h)(this._lineVerticalPlaneSegment,.5,o),i.worldUpAtPosition(o,c),Object(n.r)(l,this._lineVerticalPlaneSegment.vector),Object(n.g)(u,c,l),Object(n.r)(u,u),$(a,this._lineVerticalPlaneSegment.origin,u,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",a);const h=this._tempVec3A;Object(n.k)(h,this._lineVerticalPlaneSegment.origin),i.setAltitude(h,0),Object(n.q)(h,h,r.viewMatrix),t.setUniform3fv("lineVerticalStart",h);const d=this._tempVec3B;Object(n.f)(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(d,0),Object(n.q)(d,d,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",d)}_bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=J,r=ee;if(this._intersectsLineInfinite){const t=e.camera;if(Object(d.c)(Object(b.g)(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),K),K.c0=-Number.MAX_VALUE,!Object(p.e)(t.frustum,K))return;Object(d.e)(K,i),Object(d.d)(K,r)}else Object(n.k)(i,this._intersectsLineSegment.origin),Object(n.f)(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const a=this._tempVec3A;Object(n.q)(a,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",a);const s=this._tempVec4;Object(n.k)(s,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Object(u.m)(this._tempVec4,this._tempVec4,e.camera.viewMatrix),Object(n.q)(r,r,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),Object(n.r)(s,s),t.setUniform3f("intersectsLineDirection",s[0],s[1],s[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}_bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2fv("nearFar",i.nearFar),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor")}_requestRender(){this._context&&this._context.requestRender()}}const K=Object(d.a)(),J=Object(a.f)(),ee=Object(a.f)();class te extends o.a{constructor(e){super(e.view),this._angleCutoff=B.c,this._style={},this._heightManifoldTarget=Object(a.f)(),this._heightManifoldEnabled=!1,this._intersectsLine=Object(s.d)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){Object(r.k)(e)?(Object(n.k)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(Object(r.j)(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,ie);this.intersectsLine=Object(s.g)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){Object(r.k)(e)?(Object(s.c)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=Object(r.k)(e)?Object(s.c)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=Object(r.k)(e)?{origin:Object(a.d)(e.origin),target:Object(a.d)(e.target)}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||Object(r.k)(this._pointDistanceLine)||Object(r.k)(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){Object(r.k)(this.renderer)||(this.renderer=new Q(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}_syncStyle(){Object(r.j)(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){Object(r.j)(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){Object(r.j)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){Object(r.j)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){Object(r.j)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){Object(r.j)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=Object(r.k)(this._pathVerticalPlaneBuffers)&&this.visible,Object(r.k)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){Object(r.j)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=Object(r.k)(this._lineVerticalPlaneSegment)&&this.visible,Object(r.k)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){Object(r.j)(this.renderer)||(this.renderer.pointDistanceEnabled=Object(r.k)(this._pointDistanceLine)&&this.visible,Object(r.k)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}_disposeRenderer(){Object(r.k)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const ie=Object(a.f)()},882:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(116);function n(e,t,i){var n;const l=e.byteLength/(4*t),u=new Uint32Array(e,0,l*t);let h=new Uint32Array(l);const d=null!=(n=null==i?void 0:i.minReduction)?n:0,p=(null==i?void 0:i.originalIndices)||null,f=p?p.length:0,b=(null==i?void 0:i.componentOffsets)||null;let g=0;if(b)for(let r=0;r<b.length-1;r++){const e=b[r+1]-b[r];e>g&&(g=e)}else g=l;const m=Math.floor(1.1*g)+1;(null==c||c.length<2*m)&&(c=new Uint32Array(Object(r.l)(2*m)));for(let r=0;r<2*m;r++)c[r]=0;let O=0;const _=!!b&&!!p,v=_?f:l,y=_?new Uint32Array(f):null,j=1.96;let x=0!==d?Math.ceil(4*j*j/(d*d)*d*(1-d)):v,T=1,S=b?b[1]:v;for(let r=0;r<v;r++){if(r===x){const e=1-O/r;if(e+j*Math.sqrt(e*(1-e)/r)<d)return null;x*=2}if(r===S){for(let e=0;e<2*m;e++)c[e]=0;if(p)for(let e=b[T-1];e<b[T];e++)y[e]=h[p[e]];S=b[++T]}const e=_?p[r]:r,i=e*t,n=o(u,i,t);let s=n%m,l=O;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(a(u,i,e*t,t)){l=h[e];break}}s++,s>=m&&(s-=m)}l===O&&(c[2*s]=n,c[2*s+1]=e+1,O++),h[e]=l}if(0!==d&&1-O/l<d)return null;if(_){for(let e=b[T-1];e<y.length;e++)y[e]=h[p[e]];h=y}const E=new Uint32Array(t*O);O=0;for(let r=0;r<v;r++)h[r]===O&&(s(u,(_?p[r]:r)*t,E,O*t,t),O++);if(p&&!_){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=h[p[t]];h=e}return{buffer:E.buffer,indices:h,uniqueCount:O}}function a(e,t,i,r){for(let n=0;n<r;n++)if(e[t+n]!==e[i+n])return!1;return!0}function s(e,t,i,r,n){for(let a=0;a<n;a++)i[r+a]=e[t+a]}function o(e,t,i){let r=0;for(let n=0;n<i;n++)r=e[t+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},892:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i(85),n=i(102),a=i(463),s=i(416);class o{constructor(e,t,i,r=null){this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=r}screenToMap(e){if(Object(r.k)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.f)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.f)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(r.k)(t)&&(t.z=void 0),t}mapToScreen(e){const t=Object(a.g)(e.x,e.y,Object(s.a)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class c{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return Object(r.k)(t)&&(t.z=Object(s.g)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return Object(r.k)(this.elevationInfo)&&(t=Object(a.g)(e.x,e.y,Object(s.a)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class l{constructor(e){this.view=e,this.screenToMap=t=>e.toMap(t),this.mapToScreen=t=>e.toScreen(t)}}},893:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o}));var r=i(805),n=i(126),a=i(297),s=i(139);function o(e){const t=new a.a;return t.include(r.a,e),t.vertex.uniforms.add("modelView","mat4"),t.vertex.uniforms.add("proj","mat4"),t.attributes.add(s.a.START,"vec3"),t.attributes.add(s.a.END,"vec3"),t.attributes.add(s.a.UP,"vec3"),t.attributes.add(s.a.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(n.a`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(n.a`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}const c=Object.freeze({__proto__:null,build:o})},894:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(500),n=i(126);function a(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const i=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(r.a),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("cameraPosition","vec3"),e.vertex.code.add(n.a`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),e.vertex.code.add(n.a`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${s};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),e.vertex.code.add(n.a`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),e.vertex.code.add(n.a`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),e.vertex.code.add(n.a`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?n.a`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(n.a`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),e.fragment.code.add(n.a`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?n.a`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n.a`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?n.a`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?n.a`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:n.a`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?n.a`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n.a`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?e.fragment.code.add(n.a`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(n.a`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(n.a`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}const s=n.a.float(.4)},895:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c}));i(82);var r=i(436),n=i(750),a=i(94);const s=128,o=.5;function c(e,t=s,i=t*o,r=0){const c=l(e,t,i,r);return new n.a(c,{mipmap:!1,wrap:{s:a.B.CLAMP_TO_EDGE,t:a.B.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function l(e,t=s,i=t*o,r=0){switch(e){default:return function(e,t){const i=e/2-.5;return f(e,d(i,i,t/2))}(t,i);case"square":return function(e,t){return u(e,t,!1)}(t,i);case"cross":return function(e,t,i=0){return h(e,t,!1,i)}(t,i,r);case"x":return function(e,t,i=0){return h(e,t,!0,i)}(t,i,r);case"kite":return function(e,t){return u(e,t,!0)}(t,i);case"triangle":return function(e,t){return f(e,p(e/2,t,t/2))}(t,i);case"arrow":return function(e,t){const i=t,r=t/2,n=e/2,a=.8*i,s=d(n,(e-t)/2-a,Math.sqrt(a*a+r*r)),o=p(n,i,r);return f(e,((e,t)=>Math.max(o(e,t),-s(e,t))))}(t,i)}}function u(e,t,i){return i&&(t/=Math.SQRT2),f(e,((r,n)=>{let a=r-.5*e+.25,s=.5*e-n-.75;if(i){const e=(a+s)/Math.SQRT2;s=(s-a)/Math.SQRT2,a=e}return Math.max(Math.abs(a),Math.abs(s))-.5*t}))}function h(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const n=.5*t;return f(e,((t,a)=>{let s,o=t-.5*e,c=.5*e-a-1;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}return o=Math.abs(o),c=Math.abs(c),s=o>c?o>n?Math.sqrt((o-n)*(o-n)+c*c):c:c>n?Math.sqrt(o*o+(c-n)*(c-n)):o,s-=r/2,s}))}function d(e,t,i){return(r,n)=>{const a=r-e,s=n-t;return Math.sqrt(a*a+s*s)-i}}function p(e,t,i){const r=Math.sqrt(t*t+i*i);return(n,a)=>{const s=Math.abs(n-e)-i,o=a-e+t/2+.75,c=(t*s+i*o)/r,l=-o;return Math.max(c,l)}}function f(e,t){const i=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let a=0;a<e;a++){const s=a+e*n;let o=t(a,n);o=o/e+.5,Object(r.a)(o,i,4*s)}return i}},896:function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"}(r||(r={}))},897:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var r=i(829),n=i(210),a=i(301),s=i(478),o=i(410),c=i(356),l=i(397),u=i(464),h=i(126),d=i(297),p=i(139);function f(e){const t=new d.a;return t.include(s.a,{linearDepth:!1}),t.include(r.a,{}),t.include(a.a,e),t.fragment.include(u.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("uColor","vec4"),t.attributes.add(p.a.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(p.a.OFFSET,"vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add(p.a.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(h.a`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(h.a`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),t.vertex.code.add(h.a`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(o.a),t.include(c.b,e)),t.fragment.code.add(h.a`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(h.a`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`):t.fragment.code.add(h.a`vec4 finalColor = uColor;`),t.fragment.code.add(h.a`
      if (finalColor.a < ${h.a.float(l.c)}) {
        discard;
      }
      ${e.output===n.a.Alpha?h.a`gl_FragColor = vec4(finalColor.a);`:""}

      ${e.output===n.a.Color?h.a`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}const b=Object.freeze({__proto__:null,build:f})},909:function(e,t,i){"use strict";i.d(t,"a",(function(){return x}));var r=i(79),n=i(138),a=i(134),s=i(89),o=i(85),c=i(91),l=i(102),u=i(81),h=(i(83),i(80)),d=i(488),p=i(272);class f{constructor({grabbableForEvent:e}){this.events=new n.a,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}var b=i(766),g=i(891),m=i(490),O=i(736),_=i(735),v=i(712),y=i(795),j=i(514);let x=class extends(n.a.EventedMixin(a.a)){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingPipeline=new y.a,this._snappingTask=null,this._stagedVertex=null,this.snapToSceneEnabled=null,Object(o.j)(e.elevationInfo)&&(this.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0})}initialize(){var e,t;this.coordinateHelper=Object(g.a)(this.hasZ,this.hasM,this.view.spatialReference);const i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=i?i.registerTask(j.b.SNAPPING):j.a;const r="viewingMode"in this.view.state?this.view.state.viewingMode:p.a.Local,n="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new _.a(new O.c(n,this.coordinateHelper,r)),this._activeComponent=new O.a(this.spatialReference,r),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),i=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}}))),this._manipulator=new f({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(e=>this._onImmediateClick(e))),this._manipulator.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e)))])}destroy(){this._editGeometryOperations=Object(o.d)(this._editGeometryOperations),this._frameTask=Object(o.r)(this._frameTask)}get _snappingEnabled(){return Object(o.k)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}set drawingMode(e){this._set("drawingMode",null!=e?e:b.a)}get hasStagedVertex(){return Object(o.k)(this._stagedVertex)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return Object(o.k)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get spatialReference(){return this.view.spatialReference}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if(Object(o.j)(e))this.discardStagedVertex();else if(!Object(o.k)(this._stagedVertex)||!Object(d.a)(this._stagedVertex,e)){if(Object(o.j)(this._stagedVertex))this._stagedVertex=Object(s.a)(e);else{if(Object(d.a)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return Object(o.k)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingTask=Object(o.a)(this._snappingTask),Object(o.k)(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;Object(o.a)(this._snappingTask),Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();const i="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"})}discardStagedVertex(){this._stagedVertex=null}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Object(m.e)(e,((e,t,i,r)=>{const n="touch"===r&&this._snappingEnabled;!this.isCompleted&&n&&(t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||n&&0===this.numVertices)&&this.commitStagedVertex()),e))).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>n,cancel:i,snappingManager:this.snappingManager,snappingContext:new v.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((e=>(n&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e))),i.next((()=>{n&&Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping()})))}))}_createManipulatorDragPipelineFreehand(e){return Object(m.e)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(Object(o.j)(this.stagedVertex)&&(this.stagedVertex=e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return Object(m.e)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(Object(o.j)(this.stagedVertex)&&(this.stagedVertex=e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}_getDrawSurface(){if(Object(o.j)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;Object(o.k)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(o.k)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(o.k)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_onHold(e){Object(o.a)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if(Object(o.k)(i))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();const r=this._screenToMap(e.screenPoint);if(Object(o.k)(r))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),this.complete());break;case"click":case"hybrid":this._snappingTask=Object(o.a)(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){if(Object(o.a)(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=Object(l.e)(e.x,e.y),i=this._closeOnClickVertexIndex(t);if(Object(o.k)(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);if(this._manipulator.cursor=Object(o.k)(i)?"crosshair":null,Object(o.k)(i))if(Object(o.k)(this.snappingManager)){const t=this.snappingManager,r=new v.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=t.update(i,r),this._snappingTask=Object(c.g)((async e=>{const n=await this._frameTask.schedule((()=>t.snap(i,r,e)),e);n.valid&&await this._frameTask.schedule((()=>{this.stagedVertex=n.apply()}),e)})),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=i}e.stopPropagation()}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),Object(o.j)(e))return null;const i=this._screenToMap(t.screenEnd);return Object(o.k)(i)?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!Object(o.k)(i)&&function(e,t,i){const r=e.x-t.x,n=e.y-t.y;return r*r+n*n<=i}(i,t,25)}};Object(r.a)([Object(u.b)()],x.prototype,"defaultZ",void 0),Object(r.a)([Object(u.b)({value:b.a})],x.prototype,"drawingMode",null),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"elevationDrawSurface",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"elevationInfo",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"geometryType",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"hasM",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"hasZ",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"manipulators",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"drawSurface",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"snappingManager",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"snappingVisualizer",void 0),Object(r.a)([Object(u.b)()],x.prototype,"snapToSceneEnabled",void 0),Object(r.a)([Object(u.b)({readOnly:!0})],x.prototype,"updating",null),Object(r.a)([Object(u.b)({constructOnly:!0})],x.prototype,"view",void 0),x=Object(r.a)([Object(h.a)("esri.views.draw.DrawOperation")],x)},913:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(639),n=i(126);function a(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n.a`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function s(e,t){e.include(r.a,t),e.fragment.code.add(n.a`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.attributeTextureCoordinates===r.b.Default&&e.fragment.code.add(n.a`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return texture2D(tex, params.uv);
}`),t.attributeTextureCoordinates===r.b.Atlas&&(e.include(a),e.fragment.code.add(n.a`vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
}`))}},943:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r,n,a=i(359),s=i(294),o=i(882);function c(e){const t=l(e.rings,e.hasZ,r.CCW_IS_HOLE),i=[];let n=0,s=0;for(const r of t.polygons){const e=r.count,o=r.index,c=new Float64Array(t.position.buffer,3*o*t.position.BYTES_PER_ELEMENT,3*e),l=r.holeIndices.map((e=>e-o)),u=new Uint32Array(Object(a.a)(c,l,3));i.push({position:c,faces:u}),n+=c.length,s+=u.length}const c=function(e,t,i){if(1===e.length)return e[0];const r=new Float64Array(t),n=new Uint32Array(i);let a=0,s=0,o=0;for(const c of e){for(let e=0;e<c.position.length;e++)r[a++]=c.position[e];for(let e=0;e<c.faces.length;e++)n[s++]=c.faces[e]+o;o=a/3}return{position:r,faces:n}}(i,n,s),u=Object(o.a)(c.position.buffer,6,{originalIndices:c.faces});return c.position=new Float64Array(u.buffer),c.faces=u.indices,c}function l(e,t,i){const n=e.length,a=new Array(n),s=new Array(n),o=new Array(n);let c=0,l=0,d=0,p=0;for(let r=0;r<n;++r)p+=e[r].length;const f=new Float64Array(3*p);let b=0;for(let g=n-1;g>=0;g--){const p=e[g],m=i===r.CCW_IS_HOLE&&h(p);if(m&&1!==n)a[c++]=p;else{let e=p.length;for(let t=0;t<c;++t)e+=a[t].length;const i={index:b,pathLengths:new Array(c+1),count:e,holeIndices:new Array(c)};i.pathLengths[0]=p.length,p.length>0&&(o[d++]={index:b,count:p.length}),b=m?u(p,p.length-1,-1,f,b,p.length,t):u(p,0,1,f,b,p.length,t);for(let r=0;r<c;++r){const e=a[r];i.holeIndices[r]=b,i.pathLengths[r+1]=e.length,e.length>0&&(o[d++]={index:b,count:e.length}),b=u(e,0,1,f,b,e.length,t)}c=0,i.count>0&&(s[l++]=i)}}for(let r=0;r<c;++r){const e=a[r];e.length>0&&(o[d++]={index:b,count:e.length}),b=u(e,0,1,f,b,e.length,t)}return l<n&&(s.length=l),d<n&&(o.length=d),{position:f,polygons:s,outlines:o}}function u(e,t,i,r,n,a,s){n*=3;for(let o=0;o<a;++o){const a=e[t];r[n++]=a[0],r[n++]=a[1],r[n++]=s?a[2]:0,t+=i}return n/3}function h(e){return!Object(s.g)(e,!1,!1)}(n=r||(r={}))[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"},944:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},945:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(126),n=i(139);function a(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add(n.a.SIZEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(r.a`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(n.a.SIZE,"float"),e.vertex.code.add(r.a`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(n.a.OPACITYFEATUREATTRIBUTE,"float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(r.a`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(r.a`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(n.a.COLORFEATUREATTRIBUTE,"float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(r.a`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(n.a.COLOR,"vec4"),e.vertex.code.add(r.a`vec4 getColor(){
return applyOpacity(color);
}`))}},946:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){const t=r.a`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=r.a`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},947:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){e.fragment.code.add(r.a`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},948:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(126);function n(e){e.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade","mat4").add("radiusCurvatureCorrectionFactor","float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float").add("cloudVariables","vec2").add("cubeMap","samplerCube"),e.fragment.code.add(r.a`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(cameraPosition - sphereOriginOffset, dir);
float C = dot(cameraPosition - sphereOriginOffset, cameraPosition - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.fragment.code.add(r.a`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.fragment.code.add(r.a`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),e.fragment.code.add(r.a`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.fragment.code.add(r.a`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),e.fragment.code.add(r.a`vec4 renderCloud(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`),e.fragment.code.add(r.a`vec4 renderCloudCrossFade(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)}},949:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(1007),n=i(126);function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(r.b),e.fragment.code.add(n.a`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function s(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},950:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(272),n=i(126);function a(e,t){t.viewingMode===r.a.Global?e.vertex.code.add(n.a`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(n.a`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.viewingMode===r.a.Global?e.vertex.code.add(n.a`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(n.a`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},951:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return g}));var r=i(85),n=i(200),a=i(109),s=i(187),o=i(223),c=i(294),l=i(463),u=i(607),h=i(568),d=i(659);const p=Object(a.f)();function f(e,t,i,a,c,l,h,f){const b=i?i.length:0,g=e.clippingExtent;if(Object(s.o)(t,p,e.elevationProvider.spatialReference),Object(r.k)(g)&&!Object(o.e)(g,p))return null;Object(s.o)(t,p,e.renderCoordsHelper.spatialReference);const m=e.localOriginFactory.getOrigin(p),O=new d.a({castShadow:!1,metadata:{layerUid:l,graphicUid:h,usesVerticalDistanceToGround:!0}});for(let r=0;r<b;r++){const e=n.a;O.addGeometry(i[r],a[r],e,m,f)}return{object:O,sampledElevation:Object(u.c)(O,t,e.elevationProvider,e.renderCoordsHelper,c)}}function b(e,t,i){const r=e.elevationContext,n=i.spatialReference;Object(s.o)(t,p,n),r.centerPointInElevationSR=Object(l.g)(p[0],p[1],t.hasZ?p[2]:0,n)}function g(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(h.a)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(c.f)(t,Object(c.e)(t)/2);return Object(l.g)(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function m(e,t,i,r,n){const a=new Float64Array(3*e.length),s=new Float64Array(a.length);e.forEach(((e,t)=>{a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));const o=Object(u.d)(a,t,0,s,0,a,0,a.length/3,i,r,n),c=null!=o;return{numVertices:e.length,position:a,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},963:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i(85),n=i(244),a=i(147),s=i(200),o=i(117),c=i(257),l=i(629),u=i(163),h=i(562);class d{constructor(){this.visible=!0}}var p=i(796),f=i(139),b=i(513);class g{constructor(e,t,i={}){this.data=e,this.material=t,this.boundingSphere=Object(c.e)(),this.instanceParameters=new d,this._transformation=Object(s.d)(),this._shaderTransformationDirty=!0,this.layerUid=Object(r.t)(i.layerUid,null),this.graphicUid=Object(r.t)(i.graphicUid,null),this.id=i.id?i.id:Object(n.a)(),this.boundingInfo=Object(r.t)(i.boundingInfo,null),this.calculateShaderTransformation=Object(r.t)(this.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,i=Object(l.c)(e)){Object(r.j)(this.boundingInfo)||(Object(o.q)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return Object(r.k)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(r.j)(this.calculateShaderTransformation)?Object(r.t)(this.transformation,s.a):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(s.d)()),Object(a.c)(this._shaderTransformation,this.calculateShaderTransformation(Object(r.t)(this.transformation,s.a))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(r.k)(this._transformation)&&Object(o.q)(e,e,this._transformation),!0);const t=this.indices.get(f.a.POSITION),i=this.vertexAttributes.get(f.a.POSITION);return!!Object(h.c)(i,t,e)&&(Object(r.k)(this._transformation)&&Object(o.q)(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new p.a(u.d.Highlight),t=this.instanceParameters;return t.highlights=Object(b.a)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(b.e)(t.highlights,e)}}},964:function(e,t,i){"use strict";i.d(t,"a",(function(){return N}));var r=i(117),n=i(109),a=i(223),s=i(421),o=i(495),c=i(210),l=i(163),u=i(545),h=i(621),d=i(335),p=i(411),f=i(278),b=i(139),g=i(604),m=i(434),O=i(79),_=i(257),v=i(829),y=i(301),j=i(356),x=i(501),T=i(388),S=i(404),E=i(419),A=i(445),w=i(389),M=i(897),R=i(94),C=i(355);class P extends S.a{initializeProgram(e){const t=P.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,oitEnabled:i.transparencyPassType===l.i.Color,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new w.a(e.rctx,r,D)}bindPass(e,t){const{screenSizeEnabled:i,shadingEnabled:r}=this.configuration,{color:n,shadingTint:a,shadingDirection:s}=e;Object(x.b)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("uColor",n),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(j.a)(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this._blendColor(L,a,n)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(v.b)(this.program,e,t)}bindDraw(e){Object(x.c)(this.program,e),Object(x.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(y.c)(this.program,this.configuration,e),this.program.rebindTextures()}_blendColor(e,t,i){const r=1-t[3],n=t[3]+i[3]*r;return 0===n?(e[3]=n,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*r)/n,e[1]=(t[1]*t[3]+i[1]*i[3]*r)/n,e[2]=(t[2]*t[3]+i[2]*i[3]*r)/n,e[3]=i[3],e)}_setPipelineState(e){const t=this.configuration,i=e===l.i.NONE,r=e===l.i.FrontFace;return Object(C.f)({blending:t.output!==c.a.Color&&t.output!==c.a.Alpha||!t.transparent?null:i?A.d:Object(A.f)(e),culling:Object(C.b)(t.cullFace),depthTest:{func:r?R.h.LESS:t.shadingEnabled?R.h.LEQUAL:R.h.LESS},depthWrite:i?t.writeDepth&&C.d:Object(A.h)(e),colorWrite:C.c,polygonOffset:i||r?null:A.a})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}P.shader=new T.a(M.a,(()=>i.e(336).then(i.bind(null,1353))));class I extends E.a{constructor(){super(...arguments),this.output=c.a.Color,this.cullFace=l.b.None,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=l.i.NONE,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(O.a)([Object(E.b)({count:c.a.COUNT})],I.prototype,"output",void 0),Object(O.a)([Object(E.b)({count:l.b.COUNT})],I.prototype,"cullFace",void 0),Object(O.a)([Object(E.b)()],I.prototype,"slicePlaneEnabled",void 0),Object(O.a)([Object(E.b)()],I.prototype,"transparent",void 0),Object(O.a)([Object(E.b)()],I.prototype,"writeDepth",void 0),Object(O.a)([Object(E.b)()],I.prototype,"screenSizeEnabled",void 0),Object(O.a)([Object(E.b)()],I.prototype,"shadingEnabled",void 0),Object(O.a)([Object(E.b)({count:l.i.COUNT})],I.prototype,"transparencyPassType",void 0),Object(O.a)([Object(E.b)()],I.prototype,"multipassTerrainEnabled",void 0),Object(O.a)([Object(E.b)()],I.prototype,"cullAboveGround",void 0);const D=new Map([[b.a.POSITION,0],[b.a.NORMAL,1],[b.a.OFFSET,2]]),L=Object(_.e)();class N extends d.b{constructor(e){super(e,z),this.supportsEdges=!0,this.techniqueConfig=new I,this._vertexAttributeLocations=D}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.parameters}intersect(e,t,i,n,s,o,c){if(this.parameters.screenSizeEnabled){const i=e.vertexAttributes.get(b.a.OFFSET),l={applyToVertex:(e,t,a,s)=>{const o=Object(r.w)(G,i.data[3*s+0],i.data[3*s+1],i.data[3*s+2]),c=Object(r.w)(V,e,t,a);return Object(r.e)(o,o,this.parameters.screenSize*n.camera.computeRenderPixelSizeAt(o)),Object(r.f)(c,c,o),[c[0],c[1],c[2]]},applyToAabb:e=>{const t=Object(a.d)(e,G);return Object(a.v)(e,this.parameters.screenSize*n.camera.computeRenderPixelSizeAt(t))}};Object(m.f)(e,t,n,s,o,l,c)}else Object(m.f)(e,t,n,s,o,void 0,c)}requiresSlot(e,t){if(Object(h.b)(t)===c.a.Highlight)return e===p.a.OPAQUE_MATERIAL;let i=p.a.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?p.a.TRANSPARENT_MATERIAL:p.a.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i||e===p.a.DRAPED_MATERIAL}createGLMaterial(e){return e.output===c.a.Color||e.output===c.a.Alpha||e.output===c.a.Highlight?new F(e):null}createBufferWriter(){return new U(this.parameters.screenSizeEnabled)}}class F extends u.a{updateParameters(e){return this.ensureTechnique(P,e)}beginSlot(e){return this.updateParameters(e)}bind(e,t){t.bindPass(this._material.getPassParameters(),e)}}const z={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(r.r)(Object(n.f)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:l.b.None,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...d.a};class U{constructor(e){this.screenSizeEnabled=e;const t=Object(o.a)().vec3f(b.a.POSITION).vec3f(b.a.NORMAL);this.screenSizeEnabled&&t.vec3f(b.a.OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(b.a.POSITION).length}write(e,t,i,r){if(Object(g.d)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.screenSizeEnabled){if(!t.vertexAttributes.has(b.a.OFFSET))throw new Error(`${b.a.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const n=t.vertexAttributes.get(b.a.OFFSET),a=t.indices.get(b.a.OFFSET);Object(f.a)(3===n.size);const o=i.getField(b.a.OFFSET,s.u);if(!o)throw new Error("unable to acquire view for "+b.a.OFFSET);Object(g.f)(a,n.data,e.invTranspTransformation,o,r)}}}}const G=Object(n.f)(),V=Object(n.f)()}}]);
//# sourceMappingURL=15.5698f944.chunk.js.map