(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[291],{718:function(e,t,a){"use strict";a.r(t),a.d(t,"previewSymbol2D",(function(){return d}));var l=a(104),n=a(88),s=a(102),i=a(432),o=a(835),c=a(836);const u="picture-fill",r=120,m=document.createElement("canvas");function h(e,t){const a=m.getContext("2d"),l=[];return t&&(t.weight&&l.push(t.weight),t.size&&l.push(t.size+"px"),t.family&&l.push(t.family)),a.font=l.join(" "),a.measureText(e).width}function p(e){if(0===e.length)return 0;if(e.length>2){const t=Object(s.i)(1),a=parseFloat(e);switch(e.slice(-2)){case"px":return a;case"pt":return a*t;case"in":return 72*a*t;case"pc":return 12*a*t;case"mm":return 2.8346456692913384*a*t;case"cm":return 28.346456692913385*a*t}}return parseFloat(e)}function d(e,t){var a,m;const d=null!=(null==t?void 0:t.size)?Object(s.h)(t.size):null,f=null!=(null==t?void 0:t.maxSize)?Object(s.h)(t.maxSize):null,v=null!=(null==t?void 0:t.opacity)?t.opacity:null,y=null!=(null==t?void 0:t.rotation)?t.rotation:"angle"in e?e.angle:null,b=Object(i.c)(e);let w=Object(i.e)(e);if(b&&!w){const e="type"in b?null:new l.a(b);"#ffffff"===(e?e.toHex():null)&&(w={color:"#bdc3c7",width:.75})}const g={shape:null,fill:null,stroke:w,offset:[0,0]};null!=(a=w)&&a.width&&(w.width=Math.min(w.width,80));const M=(null==(m=w)?void 0:m.width)||0;let k=null!=d&&(null==(null==t?void 0:t.scale)||(null==t?void 0:t.scale)),j=0,x=0,L=!1;switch(e.type){case"simple-marker":{const t=e.style,a=Math.min(null!=d?d:Object(s.h)(e.size),f||r);switch(j=a,x=a,t){case"circle":g.shape={type:"circle",cx:0,cy:0,r:.5*a},k||(j+=M,x+=M);break;case"cross":g.shape={type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[j,.5*x]},{command:"M",values:[.5*j,0]},{command:"L",values:[.5*j,x]}]};break;case"diamond":g.shape={type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[.5*j,0]},{command:"L",values:[j,.5*x]},{command:"L",values:[.5*j,x]},{command:"Z",values:[]}]},k||(j+=M,x+=M);break;case"square":g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[j,0]},{command:"L",values:[j,x]},{command:"L",values:[0,x]},{command:"Z",values:[]}]},k||(j+=M,x+=M),y&&(L=!0);break;case"triangle":g.shape={type:"path",path:[{command:"M",values:[.5*j,0]},{command:"L",values:[j,x]},{command:"L",values:[0,x]},{command:"Z",values:[]}]},k||(j+=M,x+=M),y&&(L=!0);break;case"x":g.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[j,x]},{command:"M",values:[j,0]},{command:"L",values:[0,x]}]},y&&(L=!0);break;case"path":g.shape={type:"path",path:e.path||""},k||(j+=M,x+=M),y&&(L=!0),k=!0}break}case"simple-line":{const e=Math.min(null!=d?d:M,f||80),t=e>22?2*e:40;w.width=e,j=t,x=e,g.shape={type:"path",path:[{command:"M",values:[0,x]},{command:"L",values:[j,x]}]};break}case u:case"simple-fill":j=Math.min(null!=d?d:22,f||r)+M,x=j,k=!0,g.shape="object"==typeof(null==t?void 0:t.symbolConfig)&&null!=t&&t.symbolConfig.isSquareFill?o.l.squareFill[0]:o.l.fill[0];break;case"picture-marker":{let t=Object(s.h)(e.width),a=Object(s.h)(e.height);const l=null!=d?d:Math.max(t,a),n=t/a;t=n<=1?Math.ceil(l*n):l,a=n<=1?l:Math.ceil(l/n),j=Math.min(t,f||r),x=Math.min(a,f||r),g.shape={type:"image",x:-Math.round(j/2),y:-Math.round(x/2),width:j,height:x,src:e.url||""},y&&(L=!0);break}case"text":{const t=e,a=t.text||"Aa",l=t.font,n=Math.min(null!=d?d:Object(s.h)(l.size),f||r),i=h(a,{weight:l.weight,size:n,family:l.family}),o=/[\uE600-\uE6FF]/.test(a);j=o?n:i,x=n;let c=.25*p((l?n:0).toString());o&&(c+=5),g.shape={type:"text",text:a,x:0,y:c,align:"middle",decoration:l&&l.decoration,rotated:t.rotated,kerning:t.kerning},g.font=l&&{size:n,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!g.shape)return Promise.reject(new n.a("symbolPreview: renderPreviewHTML2D","symbol not supported."));const O=b,z=e.color;let C=null;return O&&"pattern"===O.type&&z&&e.type!==u?C=Object(i.d)(O.src,z.toCss(!0)).then((e=>(O.src=e,g.fill=O,g))):(g.fill=b,C=Promise.resolve(g)),C.then((e=>{const a=[[e]];if("object"==typeof(null==t?void 0:t.symbolConfig)&&null!=t&&t.symbolConfig.applyColorModulation){const t=.6*j;a.unshift([{...e,offset:[-t,0],fill:Object(o.a)(b,-.3)}]),a.push([{...e,offset:[t,0],fill:Object(o.a)(b,.3)}]),j+=2*t}return Object(c.a)(a,[j,x],{node:t&&t.node,scale:k,opacity:v,rotation:y,useRotationSize:L})}))}}}]);
//# sourceMappingURL=291.4d17279c.chunk.js.map