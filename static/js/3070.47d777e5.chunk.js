"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[3070,8860],{52639:(e,t,i)=>{i.d(t,{Z:()=>m});var n=i(27366),r=i(59486),s=i(44055),l=i(51508),a=i(11582),o=i(46784),c=i(92026),u=i(95439),d=i(49861),h=(i(63780),i(93169),i(25243),i(69912)),y=i(77981);function f(e){if(!(0,c.pC)(e))return null;const t={};for(const i in e){const n=e[i];n&&(t[i]=n.toJSON())}return 0!==Object.keys(t).length?t:null}let p=class extends((0,a.J)(o.wq)){constructor(){super(...arguments),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:(0,u.D)(),configurable:!0})}normalizeCtorArgs(e,t,i,n){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:n}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&(0,c.pC)(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:f(this.aggregateGeometries),geometry:(0,c.pC)(this.geometry)?this.geometry.toJSON():null,symbol:(0,c.pC)(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){(0,c.pC)(this.geometry)&&"mesh"===this.geometry.type&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,n){if(!this.layer||!("graphicChanged"in this.layer))return;const r={graphic:this,property:e,oldValue:t,newValue:i};"attributes"===e&&(r.attributeName=n),this.layer.graphicChanged(r)}};(0,n._)([(0,d.Cb)({value:null,json:{read:function(e){if(!e)return null;const t={};for(const i in e){const n=(0,y.im)(e[i]);n&&(t[i]=n)}return 0!==Object.keys(t).length?t:null}}})],p.prototype,"aggregateGeometries",null),(0,n._)([(0,d.Cb)({value:null})],p.prototype,"attributes",null),(0,n._)([(0,d.Cb)({value:null,types:r.qM,json:{read:y.im}})],p.prototype,"geometry",null),(0,n._)([(0,d.Cb)({type:Boolean})],p.prototype,"isAggregate",void 0),(0,n._)([(0,d.Cb)({clonable:"reference"})],p.prototype,"layer",void 0),(0,n._)([(0,d.Cb)({type:s.Z})],p.prototype,"popupTemplate",void 0),(0,n._)([(0,d.Cb)({clonable:"reference"})],p.prototype,"sourceLayer",void 0),(0,n._)([(0,d.Cb)({value:null,types:l.LB})],p.prototype,"symbol",null),(0,n._)([(0,d.Cb)({type:Boolean,value:!0})],p.prototype,"visible",null),p=(0,n._)([(0,h.j)("esri.Graphic")],p),function(e){e.generateUID=u.D}(p||(p={}));const m=p},53283:(e,t,i)=>{i.d(t,{M:()=>f,e:()=>h,f:()=>s,i:()=>d,p:()=>p,r:()=>a,t:()=>l,w:()=>o});var n=i(92026),r=i(35995);function s(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=(0,r.hF)(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=(0,r.PF)(e,t.portalItem.itemUrl);u.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return y(e,t&&t.portal)}function l(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.YES;if(!e)return e;!(0,r.YP)(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let n=(0,r.hF)(e);if(t){const i=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(i){const s=y(i,t.portal);n=(0,r.PF)(y(n,t.portal),s,s),n!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(n)}}return n=h(n,t&&t.portal),(0,r.YP)(n)&&(n=(0,r.Fv)(n)),t?.resources&&t?.portalItem&&!(0,r.YP)(n)&&!(0,r.HK)(n)&&i===f.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(n)}),n}function a(e,t,i){return s(e,i)}function o(e,t,i,n){const r=l(e,n);void 0!==r&&(t[i]=r)}const c=/\/items\/([^\/]+)\/resources\//,u=/^\.\/resources\//;function d(e){const t=(0,n.pC)(e)?e.match(c):null;return(0,n.pC)(t)?t[1]:null}function h(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?(0,r.Ie)(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function y(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,n=(0,r.TI)();return(0,r.D6)(n,`${n.scheme}://${i}`)?(0,r.Ie)(e,t.portalHostname,i):(0,r.Ie)(e,i,t.portalHostname)}var f;!function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"}(f||(f={}));const p=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:s,toJSON:l,read:a,write:o,itemIdFromResourceUrl:d,ensureMainOnlineDomain:h,get MarkKeep(){return f}},Symbol.toStringTag,{value:"Module"}))},27135:(e,t,i)=>{i.d(t,{J:()=>s});var n=i(43404),r=i(49861);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e instanceof n.X?e:new n.X(e,t),s={type:t?.ignoreUnknown??1?i.apiValues:String,json:{type:i.jsonValues,read:!t?.readOnly&&{reader:i.read},write:{writer:i.write}}};return void 0!==t?.readOnly&&(s.readOnly=!!t.readOnly),void 0!==t?.default&&(s.json.default=t.default),void 0!==t?.name&&(s.json.name=t.name),(0,r.Cb)(s)}},76672:(e,t,i)=>{i.d(t,{E:()=>r,_:()=>s});var n=i(92026);async function r(e,t){const{WhereClause:n}=await i.e(8562).then(i.bind(i,48562));return n.create(e,t)}function s(e,t){return(0,n.pC)(e)?(0,n.pC)(t)?`(${e}) AND (${t})`:e:t}},68860:(e,t,i)=>{i.d(t,{$C:()=>N,En:()=>A,FN:()=>F,Jo:()=>X,KU:()=>x,OG:()=>V,RG:()=>G,UF:()=>C,Yl:()=>M,ZO:()=>I,_R:()=>O,c9:()=>P,cM:()=>z,fN:()=>w,gV:()=>Q,hd:()=>u,j5:()=>q,oD:()=>L,oq:()=>Z,qE:()=>$,qv:()=>R,tQ:()=>T,ty:()=>k,y:()=>H});i(93169);var n=i(43404),r=i(92026),s=i(92183),l=i(78952),a=i(22186),o=i(92975),c=i(89093);const u=39.37,d=a.sv.radius*Math.PI/200,h=/UNIT\[([^\]]+)\]\]$/i,y=c.Z,f=/UNIT\[([^\]]+)\]/i,p=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),m=(0,n.w)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),g=e=>e*e,b=e=>e*e*e,v={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:g(.001)},"square-centimeters":{inBaseUnits:g(.01)},"square-decimeters":{inBaseUnits:g(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:g(1e3)},"square-inches":{inBaseUnits:g(.0254)},"square-feet":{inBaseUnits:g(.3048)},"square-yards":{inBaseUnits:g(.9144)},"square-miles":{inBaseUnits:g(1609.344)},"square-us-feet":{inBaseUnits:g(1200/3937)},acres:{inBaseUnits:.0015625*g(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*b(.001)},"cubic-centimeters":{inBaseUnits:1e3*b(.01)},"cubic-decimeters":{inBaseUnits:1e3*b(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*b(1e3)},"cubic-inches":{inBaseUnits:1e3*b(.0254)},"cubic-feet":{inBaseUnits:1e3*b(.3048)},"cubic-yards":{inBaseUnits:1e3*b(.9144)},"cubic-miles":{inBaseUnits:1e3*b(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},_=(()=>{const e={};for(const t in v)for(const i in v[t].units)e[i]=t;return e})();const w=["metric","imperial","square-inches","square-feet","square-yards","square-miles","square-us-feet","square-meters","square-kilometers","acres","ares","hectares"],L=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],S=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function I(e){return"imperial"===e||"metric"===e}function C(e){const t=_[e];if(!t)throw new Error("unknown type");return t}function E(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||C(e),v[t].baseUnit===e}function A(e,t,i){if(t===i)return e;const n=C(t);if(n!==C(i))throw new Error("incompatible units");const r=E(t,n)?e:function(e,t,i){return e*v[i].units[t].inBaseUnits}(e,t,n);return E(i,n)?r:function(e,t,i){return e/v[i].units[t].inBaseUnits}(r,i,n)}function x(e,t){const i=A(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function V(e,t){const i=A(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function F(e,t){const i=A(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function R(e,t){const i=A(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function T(e,t){const i=A(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function M(e,t){const i=A(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function k(e,t,i){return A(e,t,"meters")/(i*Math.PI/180)}function N(e){return m.fromJSON(e.toLowerCase())||null}function O(e){if(e&&"object"==typeof e&&!(0,o.N$)(e))return 1;const t=P(e);return t>1e5?1:t}function z(e){return P(e)>=(e instanceof l.Z?(0,s.Iu)(e).metersPerDegree:1e5)?"meters":$(e)}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.sv.metersPerDegree;return(0,r.Pt)(D(e,!0),t)}function D(e){let t,i,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null;if(null!=e&&("object"==typeof e?(t=e.wkid,i=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(i=e)),t){if((0,o.o$)(t))return a.yr.metersPerDegree;if((0,o.ME)(t))return a.Z1.metersPerDegree;r=y.values[y[t]],!r&&n&&p.has(t)&&(r=d)}else i&&(W(i)?r=B(h.exec(i),r):j(i)&&(r=B(f.exec(i),r)));return r}function B(e,t){return e&&e[1]?U(e[1]):t}function U(e){return parseFloat(e.split(",")[1])}function $(e){let t,i,n=null;if(null!=e&&("object"==typeof e?(t=e.wkid,i=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(i=e)),t)n=y.units[y[t]];else if(i){const e=W(i)?h:j(i)?f:null;if(e){const t=e.exec(i);t&&t[1]&&(n=function(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!y.units.includes(i)){const t=U(e);i=null;const n=y.values;for(let e=0;e<n.length;++e)if(Math.abs(t-n[e])<1e-7){i=y.units[e];break}}return i}(t[1]))}}return(0,r.pC)(n)?N(n):null}function q(e){const t=$(e);return(0,r.Wi)(t)||!L.includes(t)?null:t}function H(e){const t=z(e);return(0,r.Wi)(t)||!L.includes(t)?null:t}function Z(e){const t=$(e);return(0,r.Wi)(t)?null:S.get(t)}function j(e){return/^GEOCCS/i.test(e)}function W(e){return/^PROJCS/i.test(e)}function G(e){const t="metric";if((0,r.Wi)(e))return t;const i=e.map,n=i&&"portalItem"in i?i.portalItem?.portal:null;if(n)switch(n?.user?.units??n.units){case t:return t;case"english":return"imperial"}return(0,r.Pt)(function(e){const t=$(e);if((0,r.Wi)(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}(e.spatialReference),t)}const Y={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},J={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},Q=(0,n.w)()(Y),X=(0,n.w)()(J);(0,n.w)()({...Y,...J})},92183:(e,t,i)=>{i.d(t,{GG:()=>a,HQ:()=>o,Iu:()=>h,VY:()=>c,e8:()=>y,rS:()=>d,wY:()=>u});var n=i(78952),r=i(22186),s=i(92975);function l(e){return new n.Z({wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${e.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`})}const a=l(r.sv),o=l(r.yr),c=l(r.Z1),u=new n.Z({wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${r.sv.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`});function d(e){return e&&((0,s.BZ)(e)||e===o)?o:e&&((0,s.V2)(e)||e===c)?c:a}function h(e){return e&&((0,s.BZ)(e)||e===o)?r.yr:e&&((0,s.V2)(e)||e===c)?r.Z1:r.sv}function y(e){return(0,s.o$)(e)?r.yr:(0,s.ME)(e)?r.Z1:r.sv}},41414:(e,t,i)=>{i.d(t,{BD:()=>L,G1:()=>h,Gv:()=>O,HH:()=>o,JR:()=>T,KE:()=>E,TC:()=>c,Tn:()=>x,Ue:()=>l,VK:()=>u,Wi:()=>y,Zp:()=>S,aO:()=>w,al:()=>a,bA:()=>C,be:()=>v,cS:()=>F,cv:()=>I,dp:()=>_,fS:()=>N,op:()=>A,pp:()=>d,sU:()=>f,t8:()=>V,wp:()=>k,wz:()=>b,xE:()=>z,y8:()=>R});var n=i(92026),r=i(53866),s=i(65156);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,i,n,r,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l();return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a[4]=r,a[5]=s,a}function o(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new r.Z(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function u(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function d(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length/3,r=e[0],s=e[1],l=e[2],a=e[3],o=e[4],c=e[5];for(let u=0;u<n;u++)r=Math.min(r,t[i+3*u]),s=Math.min(s,t[i+3*u+1]),l=Math.min(l,t[i+3*u+2]),a=Math.max(a,t[i+3*u]),o=Math.max(o,t[i+3*u+1]),c=Math.max(c,t[i+3*u+2]);e[0]=r,e[1]=s,e[2]=l,e[3]=a,e[4]=o,e[5]=c}function y(e,t,i){const n=t.length;let r=e[0],s=e[1],l=e[2],a=e[3],o=e[4],c=e[5];if(i)for(let u=0;u<n;u++){const e=t[u];r=Math.min(r,e[0]),s=Math.min(s,e[1]),l=Math.min(l,e[2]),a=Math.max(a,e[0]),o=Math.max(o,e[1]),c=Math.max(c,e[2])}else for(let u=0;u<n;u++){const e=t[u];r=Math.min(r,e[0]),s=Math.min(s,e[1]),a=Math.max(a,e[0]),o=Math.max(o,e[1])}e[0]=r,e[1]=s,e[2]=l,e[3]=a,e[4]=o,e[5]=c}function f(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function p(e){return e[0]>=e[3]?0:e[3]-e[0]}function m(e){return e[1]>=e[4]?0:e[4]-e[1]}function g(e){return e[2]>=e[5]?0:e[5]-e[2]}function b(e){const t=p(e),i=g(e),n=m(e);return Math.sqrt(t*t+i*i+n*n)}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=e[0]+p(e)/2,t[1]=e[1]+m(e)/2,t[2]=e[2]+g(e)/2,t}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=p(e),t[1]=m(e),t[2]=g(e),t}function w(e){return Math.max(p(e),g(e),m(e))}function L(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function S(e,t){return!!(0,n.Wi)(t)||function(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}(e,t)}function I(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+n,r[3]=e[3]+t,r[4]=e[4]+i,r[5]=e[5]+n,r}function C(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const n=e[0]+p(e)/2,r=e[1]+m(e)/2,s=e[2]+g(e)/2;return i[0]=n+(e[0]-n)*t,i[1]=r+(e[1]-r)*t,i[2]=s+(e[2]-s)*t,i[3]=n+(e[3]-n)*t,i[4]=r+(e[4]-r)*t,i[5]=s+(e[5]-s)*t,i}function E(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function A(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function x(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function V(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function F(e){return e?V(e,O):l(O)}function R(e,t){return t||(t=(0,s.Ue)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function T(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function M(e){return 6===e.length}function k(e){return 0===p(e)&&0===m(e)&&0===g(e)}function N(e,t,i){if((0,n.Wi)(e)||(0,n.Wi)(t))return e===t;if(!M(e)||!M(t))return!1;if(i){for(let n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1}else for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}const O=[1/0,1/0,1/0,-1/0,-1/0,-1/0],z=[0,0,0,0,0,0];l()},41978:(e,t,i)=>{i.d(t,{AM:()=>y});var n=i(27366),r=i(85015),s=i(93169),l=i(84652),a=i(32718),o=i(49861),c=(i(25243),i(69912)),u=i(85411),d=i(32551);const h=-1;let y=class extends r.Z{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=(0,s.Z)("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(f(e))}catch(t){this._transitionTo([]),a.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return null!==this._to}canTransitionTo(e){try{return this.scale>0&&p(this._current,f(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}end(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&p(this._current,e,this.scale)?(this._final=e,this._to=(0,l.d9)(e),function(e,t,i){const n=e.length>t.length?e:t,r=e.length>t.length?t:e,s=r[r.length-1],l=s?.scale??i,a=s?.effects??[];for(let o=r.length;o<n.length;o++)r.push({scale:l,effects:[...a]});for(let o=0;o<n.length;o++)r[o].scale=r[o].scale===h?i:r[o].scale,n[o].scale=n[o].scale===h?i:n[o].scale,(0,d.uF)(r[o].effects,n[o].effects)}(this._current,this._to,this.scale),this._from=(0,l.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,l.d9)(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let i=0;i<this._current.length;i++){const e=this._current[i],n=this._from[i],r=this._to[i];e.scale=m(n.scale,r.scale,t);for(let i=0;i<e.effects.length;i++){const s=e.effects[i],l=n.effects[i],a=r.effects[i];s.interpolate(l,a,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,l.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),0===this._current.length)return;const t=this._current,i=this._current.length-1;let n,r,s=1;if(1===t.length||e>=t[0].scale)r=n=t[0].effects;else if(e<=t[i].scale)r=n=t[i].effects;else for(let l=0;l<i;l++){const i=t[l],a=t[l+1];if(i.scale>=e&&a.scale<=e){s=(e-i.scale)/(a.scale-i.scale),n=i.effects,r=a.effects;break}}for(let l=0;l<this.effects.length;l++)this.effects[l].interpolate(n[l],r[l],s)}};function f(e){const t=(0,u.Q)(e)||[];return function(e){const t=e[0];return!!t&&"type"in t}(t)?[{scale:h,effects:t}]:t}function p(e,t,i){return!e[0]?.effects||!t[0]?.effects||!((e[0]?.scale===h||t[0]?.scale===h)&&(e.length>1||t.length>1)&&i<=0)&&(0,d.AS)(e[0].effects,t[0].effects)}function m(e,t,i){return e+(t-e)*i}(0,n._)([(0,o.Cb)()],y.prototype,"_to",void 0),(0,n._)([(0,o.Cb)()],y.prototype,"duration",void 0),(0,n._)([(0,o.Cb)({value:""})],y.prototype,"effect",null),(0,n._)([(0,o.Cb)({readOnly:!0})],y.prototype,"effects",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],y.prototype,"hasEffects",null),(0,n._)([(0,o.Cb)({value:0})],y.prototype,"scale",null),(0,n._)([(0,o.Cb)({readOnly:!0})],y.prototype,"transitioning",null),y=(0,n._)([(0,c.j)("esri.layers.effects.EffectView")],y)},44041:(e,t,i)=>{i.d(t,{R:()=>f});var n=i(27366),r=i(85015),s=i(41691),l=i(92026),a=i(76672),o=i(49861),c=(i(63780),i(93169),i(25243),i(69912)),u=i(45948),d=i(87072),h=i(58132);const y={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let f=class extends((0,s.p)(r.Z)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const t=(0,d.f)(this.floors,e);return e.toExportImageJSON(t)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&(0,h.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(y[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter((t=>null!=t.definitionExpression||e&&null!=t.floorInfo));return t.length?JSON.stringify(t.reduce(((e,t)=>{const i=(0,d.f)(this.floors,t),n=(0,a._)(i,t.definitionExpression);return(0,l.pC)(n)&&(e[t.id]=n),e}),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=t=>{const n=this.scale,r=0===n,s=0===t.minScale||n<=t.minScale,l=0===t.maxScale||n>=t.maxScale;t.visible&&(r||s&&l)&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const n=this._get("visibleSublayers");return!n||n.length!==e.length||n.some(((t,i)=>e[i]!==t))?e:n}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}};(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"dynamicLayers",null),(0,n._)([(0,o.Cb)()],f.prototype,"floors",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"hasDynamicLayers",null),(0,n._)([(0,o.Cb)()],f.prototype,"layer",null),(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"layers",null),(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"layerDefs",null),(0,n._)([(0,o.Cb)({type:Number})],f.prototype,"scale",void 0),(0,n._)([(0,o.Cb)(u.qG)],f.prototype,"timeExtent",void 0),(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"version",null),(0,n._)([(0,o.Cb)({readOnly:!0})],f.prototype,"visibleSublayers",null),f=(0,n._)([(0,c.j)("esri.layers.mixins.ExportImageParameters")],f)},45948:(e,t,i)=>{i.d(t,{qG:()=>_,PV:()=>m,id:()=>L,iR:()=>y,rn:()=>p,rT:()=>C,u1:()=>I,rO:()=>S,Oh:()=>b,bT:()=>v,C_:()=>h,Lx:()=>g,vg:()=>w,YI:()=>d,HQ:()=>f});var n=i(62044),r=i(53866),s=i(78952),l=i(53283),a=i(92026),o=(i(66978),i(86710));var c=i(64575),u=i(81219);const d={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},h={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},y={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},f={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:l.w}}},p={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},m={value:null,type:c.ZP,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function g(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const b={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},v={...b,json:{...b.json,origins:{"web-document":{...b.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,u.b)(t.layerDefinition.drawingInfo.transparency):void 0:(0,u.b)(t.drawingInfo.transparency)}}},_={type:n.Z,readOnly:!0,get(){if(!this.layer?.timeInfo)return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=this.view?.timeExtent;let s=this.layer.timeExtent;e&&(s=function(e){if(!e)return e;const{start:t,end:i}=e;return new n.Z({start:(0,a.pC)(t)?(0,o.Nm)(t,t.getTimezoneOffset(),"minutes"):t,end:(0,a.pC)(i)?(0,o.Nm)(i,i.getTimezoneOffset(),"minutes"):i})}(s));let l=i?r&&s?r.intersection(s):r||s:s;if(!l||l.isEmpty||l.isAllTime)return l;t&&(l=l.offset(-t.value,t.unit)),e&&(l=function(e){if(!e)return e;const{start:t,end:i}=e;return new n.Z({start:(0,a.pC)(t)?(0,o.Nm)(t,-t.getTimezoneOffset(),"minutes"):t,end:(0,a.pC)(i)?(0,o.Nm)(i,-i.getTimezoneOffset(),"minutes"):i})}(l));const c=this._get("timeExtent");return l.equals(c)?c:l}},w={type:r.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=r.Z.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(i.spatialReference=s.Z.fromJSON(t.spatialReference)),i}}}},read:!1}},L={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},S={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},I={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},C={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},39638:(e,t,i)=>{var n;function r(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return n.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((e=>null==e||e.code!==t)))return n.INVALID_CODED_VALUE}return null}function s(e){if(e&&"range"===e.type)return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}}i.d(t,{D3:()=>s,F3:()=>r,V$:()=>n}),function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(n||(n={}))},37270:(e,t,i)=>{i.d(t,{AB:()=>m,CH:()=>E,Ec:()=>ee,Gz:()=>q,H7:()=>D,Lk:()=>g,Ll:()=>I,M$:()=>$,Mu:()=>x,O5:()=>_,Pz:()=>H,Q0:()=>f,Qc:()=>Z,Qj:()=>C,R9:()=>K,UF:()=>h,YN:()=>u,ZV:()=>S,gd:()=>p,io:()=>b,j:()=>A,os:()=>V,qN:()=>B,vP:()=>X,vl:()=>L,wF:()=>j,y2:()=>U});var n=i(10064),r=i(92026),s=i(18202),l=i(39638),a=i(819);const o=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],c=["field","normalizationField"];function u(e,t){if(null!=e&&null!=t)for(const i of Array.isArray(e)?e:[e])if(d(o,i,t),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)d(c,e,t)}function d(e,t,i){if(e)for(const n of e){const e=(0,s.hS)(n,t),r=e&&"function"!=typeof e&&i.get(e);r&&(0,s.RB)(n,r.name,t)}}function h(e,t){if(null!=e&&t?.fields.length)if("startField"in e){const i=t.get(e.startField),n=t.get(e.endField);e.startField=i&&i.name||null,e.endField=n&&n.name||null}else{const i=t.get(e.startTimeField),n=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=n&&n.name||null}}const y=new Set;function f(e,t){return e&&t?(y.clear(),p(y,e,t),Array.from(y).sort()):[]}function p(e,t,i){if(i)if(t?.fields?.length)if(i.includes("*"))for(const{name:n}of t.fields)e.add(n);else for(const n of i)m(e,t,n);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const t of i)e.add(t)}}function m(e,t,i){if("string"==typeof i)if(t){const n=t.get(i);n&&e.add(n.name)}else e.add(i)}function g(e,t){return(0,r.Wi)(t)||(0,r.Wi)(e)?[]:t.includes("*")?e.fields.map((e=>e.name)):t}async function b(e,t,i){if(!i)return;const{arcadeUtils:n}=await(0,a.LC)(),r=n.extractFieldNames(i,t?.fields?.map((e=>e.name)));for(const s of r)m(e,t,s)}async function v(e,t,r){if(r&&"1=1"!==r){const s=(await Promise.all([i.e(8562),i.e(4397)]).then(i.bind(i,48562))).WhereClause.create(r,t);if(!s.isStandardized)throw new n.Z("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});p(e,t,s.fieldNames)}}function _(e){let{displayField:t,fields:i}=e;return t||(i&&i.length?w(i,"name-or-title")||w(i,"unique-identifier")||w(i,"type-or-category")||function(e){for(const t of e){if(!t||!t.name)continue;const e=t.name.toLowerCase();if(e.includes("name")||e.includes("title"))return t.name}return null}(i):null)}function w(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function L(e,t){if(!t)return;const i=(0,s.hS)("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function S(e,t,i){if(!t||!i||!("fields"in i))return;const n=[];if(i.popupTemplate?.expressionInfos&&n.push(...i.popupTemplate.expressionInfos.map((i=>b(e,t.fieldsIndex,i.expression)))),Array.isArray(i.popupTemplate?.content)){const r=i.popupTemplate.content;for(const i of r)"expression"===i.type&&i.expressionInfo&&n.push(b(e,t.fieldsIndex,i.expressionInfo.expression))}i.fields&&n.push(...i.fields.map((i=>async function(e,t,i){i.outStatistic.onStatisticValueExpression?b(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}(e,t.fieldsIndex,i)))),await Promise.all(n)}async function I(e,t,i){t&&(t.timeInfo&&(0,r.pC)(i)&&i.timeExtent&&p(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&p(e,t.fieldsIndex,[t.floorInfo.floorField]),(0,r.pC)(i)&&(0,r.pC)(i.where)&&await v(e,t.fieldsIndex,i.where))}async function C(e,t,i){t&&i&&await Promise.all(i.map((i=>async function(e,t,i){t&&i&&(i.valueExpression?await b(e,t.fieldsIndex,i.valueExpression):i.field&&m(e,t.fieldsIndex,i.field))}(e,t,i))))}function E(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?f(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}function A(e){if(!e)return[];const t=e.geometryFieldsInfo;return t?f(e.fieldsIndex,[t.shapeAreaField,t.shapeLengthField]):[]}async function x(e,t){const{labelingInfo:i,fieldsIndex:n}=t;i&&i.length&&await Promise.all(i.map((t=>async function(e,t,i){if(!i)return;const n=i.getLabelExpression(),r=i.where;if("arcade"===n.type)await b(e,t,n.expression);else{const i=n.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{m(e,t,i.slice(1,-1))}))}await v(e,t,r)}(e,n,t))))}function V(e){const t=e.defaultValue;return void 0!==t&&z(e,t)?t:e.nullable?null:void 0}function F(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function R(e){return null===e||F(e)}const T="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function M(e){return null===e||T(e)}function k(e){return null!=e&&"string"==typeof e}function N(e){return null===e||k(e)}function O(){return!0}function z(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?M:T;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?R:F;break;case"string":case"esriFieldTypeString":i=e.nullable?N:k;break;default:i=O}return 1===arguments.length?i:i(t)}const P=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function D(e){return null!=e&&P.has(e.type)}function B(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function U(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}var $,q;function H(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function Z(e,t){return e.nullable&&null===t?null:D(e)&&!function(e,t){const i="string"==typeof e?W(e):e;return!!i&&(i.isInteger?T(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}(e.type,Number(t))?$.OUT_OF_RANGE:z(e,t)?e.domain?(0,l.F3)(e.domain,t):null:q.INVALID_TYPE}function j(e){return(0,l.D3)(e.domain)||(D(e)?W(e.type):void 0)}function W(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return G;case"esriFieldTypeInteger":case"integer":return Y;case"esriFieldTypeSingle":case"single":return J;case"esriFieldTypeDouble":case"double":return Q}}!function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"}($||($={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(q||(q={}));const G={min:-32768,max:32767,isInteger:!0},Y={min:-2147483648,max:2147483647,isInteger:!0},J={min:-34e37,max:12e37,isInteger:!1},Q={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function X(e,t,i){switch(e){case l.V$.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case l.V$.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case q.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case $.OUT_OF_RANGE:{const{min:e,max:n}=W(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${n}`}}}function K(e,t){return!function(e,t,i){if(!t||!t.attributes||!e){if((0,r.pC)(i))for(const t of e)i.add(t);return!0}const n=t.attributes;let s=!1;for(const l of e)if(!(l in n)){if(s=!0,!(0,r.pC)(i))break;i.add(l)}return s}(e,t,null)}function ee(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some((t=>e.toLowerCase().startsWith(t)))}},87072:(e,t,i)=>{function n(e){const t=e.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in e.view?s(e.view.floors,t.floorInfo.floorField):null}function r(e,t){return"floorInfo"in t&&t.floorInfo?.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(!e?.length)return null;const i=e.filter((e=>""!==e)).map((e=>`'${e}'`));return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}i.d(t,{c:()=>n,f:()=>r})},58132:(e,t,i)=>{i.d(t,{FN:()=>l,QV:()=>s,ac:()=>o});var n=i(92026),r=i(25265);function s(e,t,i){const n=t.flatten((e=>{let{sublayers:t}=e;return t})).length;return n!==e.length||(!!e.some((e=>e.originIdOf("minScale")>i||e.originIdOf("maxScale")>i||e.originIdOf("renderer")>i||e.originIdOf("labelingInfo")>i||e.originIdOf("opacity")>i||e.originIdOf("labelsVisible")>i||e.originIdOf("source")>i))||!a(e,t))}function l(e,t,i){return!!e.some((e=>{const t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,n.Wi)(t.gdbVersion)||t.gdbVersion===i))||e.originIdOf("renderer")>r.s3.SERVICE||e.originIdOf("labelingInfo")>r.s3.SERVICE||e.originIdOf("opacity")>r.s3.SERVICE||e.originIdOf("labelsVisible")>r.s3.SERVICE}))||!a(e,t)}function a(e,t){if(!e||!e.length||(0,n.Wi)(t))return!0;const i=t.slice().reverse().flatten((e=>{let{sublayers:t}=e;return t&&t.toArray().reverse()})).map((e=>e.id)).toArray();if(e.length>i.length)return!1;let r=0;const s=i.length;for(const{id:n}of e){for(;r<s&&i[r]!==n;)r++;if(r>=s)return!1}return!0}function o(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}},4075:(e,t,i)=>{i.d(t,{D2:()=>o,NM:()=>u,WU:()=>h,f1:()=>c});i(59166);var n=i(6291);const r=/^-?(\d+)(\.(\d+))?$/i;function s(e,t){return e-t}function l(e,t){let i,n;return i=Number(e.toFixed(t)),i<e?n=i+1/10**t:(n=i,i-=1/10**t),i=Number(i.toFixed(t)),n=Number(n.toFixed(t)),[i,n]}function a(e,t,i,n,r){const s=c(e,t,i,n),l=null==s.previous||s.previous<=r,a=null==s.next||s.next<=r;return l&&a||s.previous+s.next<=2*r}function o(e){const t=String(e),i=t.match(r);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().includes("e")){const e=t.split("e"),i=e[0],n=e[1];if(i&&n){const e=Number(i);let t=Number(n);const r=t>0;r||(t=Math.abs(t));const s=o(e);return r?(s.integer+=t,t>s.fractional?s.fractional=0:s.fractional-=t):(s.fractional+=t,t>s.integer?s.integer=1:s.integer-=t),s}}return{integer:0,fractional:0}}function c(e,t,i,n){const r={previous:null,next:null};if(null!=i){const n=e-i,s=t-i-n;r.previous=Math.floor(Math.abs(100*s/n))}if(null!=n){const i=n-e,s=n-t-i;r.next=Math.floor(Math.abs(100*s/i))}return r}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=e.slice(0),{tolerance:n=2,strictBounds:r=!1,indexes:c=i.map(((e,t)=>t))}=t;c.sort(s);for(let s=0;s<c.length;s++){const e=c[s],t=i[e],u=0===e?null:i[e-1],d=e===i.length-1?null:i[e+1],h=o(t).fractional;if(h){let o,c=0,y=!1;for(;c<=h&&!y;){const e=l(t,c);o=r&&0===s?e[1]:e[0],y=a(t,o,u,d,n),c++}y&&(i[e]=o)}}return i}const d={maximumFractionDigits:20};function h(e){return(0,n.uf)(e,d)}},61029:(e,t,i)=>{i.d(t,{e:()=>l,s:()=>a});i(93169);var n=i(10064),r=i(92026),s=i(23707);function l(e){return(0,r.Wi)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function a(e){if((0,r.Wi)(e))return null;if(!l(e))return new n.Z("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return function(e){return o(e,(0,s.q)(e.symbol).error)}(e);case"unique-value":return function(e){const t=e.uniqueValueInfos.map((e=>(0,s.q)(e.symbol).error)).filter((e=>!!e)),i=(0,s.q)(e.defaultSymbol);return i.error&&t.unshift(i.error),o(e,t)}(e);case"class-breaks":return function(e){const t=e.classBreakInfos.map((e=>(0,s.q)(e.symbol).error)).filter((e=>!!e)),i=(0,s.q)(e.defaultSymbol);return i.error&&t.unshift(i.error),o(e,t)}(e);case"dictionary":case"heatmap":return null}return null}function o(e,t){if(!t)return null;let i;if(i=Array.isArray(t)?t:[t],i.length>0){const t=i.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));t.sort();const r=[];return t.forEach(((e,i)=>{0!==i&&e===t[i-1]||r.push(e)})),new n.Z("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${r.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:i})}return null}},99388:(e,t,i)=>{i.d(t,{zB:()=>d});var n=i(63780),r=i(32718),s=i(77427),l=i(76969),a=(i(4075),i(57203),i(74579)),o=i(226),c=i(40778);r.Z.getLogger("esri.renderers.support.utils"),(0,l.Ze)("short-date");function u(e,t,i){(0,s.s1)(e,t,(()=>[])).push(...i)}async function d(e){const t=new Map;if("visualVariables"in e&&e.visualVariables){const i=e.visualVariables.filter((e=>"color"===e.type));for(const e of i){const i=e.field||e.valueExpression,n=(await(0,o.pO)(e)).map((e=>e.color));u(t,i,n)}}if("heatmap"===e.type){const i=(0,c.h)(e).map((e=>e.color));u(t,e.field,i)}else if("pie-chart"===e.type){for(const i of e.attributes)u(t,i.field,[i.color]);u(t,null,[e?.othersCategory?.color,(0,a._h)(e.backgroundFillSymbol,null)])}else if("dot-density"===e.type){for(const i of e.attributes)u(t,i.field,[i.color]);u(t,null,[e.backgroundColor])}else if("unique-value"===e.type)if("predominance"===e.authoringInfo?.type)for(const i of e.uniqueValueInfos)u(t,i.value.toString(),[(0,a._h)(i.symbol,null)]);else{const i=e.uniqueValueInfos.map((e=>(0,a._h)(e.symbol,null))),{field:n,field2:r,field3:s,valueExpression:l}=e;(n||l)&&u(t,n||l,i),r&&u(t,r,i),s&&u(t,s,i)}else if("class-breaks"===e.type){const i=e.classBreakInfos.map((e=>(0,a._h)(e.symbol,null)));u(t,e.field||e.valueExpression,i)}else"simple"===e.type&&u(t,null,[(0,a._h)(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&u(t,null,[(0,a._h)(e.defaultSymbol,null)]),t.forEach(((e,i)=>{const r=(0,n.Tw)(e.filter(Boolean),((e,t)=>JSON.stringify(e)===JSON.stringify(t)));t.set(i,r)})),t}},37384:(e,t,i)=>{i.d(t,{$o:()=>r,V$:()=>l});const n="calcite-theme-";function r(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"").startsWith("dark")}function s(){return`${n}${r()?"dark":"light"}`}function l(e){a(e),e.classList.add(s())}function a(e){Array.from(e.classList).forEach((t=>{t.startsWith(n)&&e.classList.remove(t)}))}},22061:(e,t,i)=>{i.d(t,{Z:()=>y});var n=i(27366),r=i(51995),s=i(43404),l=i(46784),a=i(49861),o=(i(63780),i(93169),i(25243),i(38511)),c=i(69912);const u=new s.X({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let d=0,h=class extends l.wq{constructor(e){super(e),this.id="sym"+d++,this.type=null,this.color=new r.Z([0,0,0,1])}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,n._)([(0,a.Cb)({type:u.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:u.write}}})],h.prototype,"type",void 0),(0,n._)([(0,a.Cb)({type:r.Z,json:{write:{allowNull:!0}}})],h.prototype,"color",void 0),(0,n._)([(0,o.r)("color")],h.prototype,"readColor",null),h=(0,n._)([(0,c.j)("esri.symbols.Symbol")],h);const y=h},65349:(e,t,i)=>{i.r(t),i.d(t,{default:()=>hn});var n=i(27366),r=i(100),s=i(92026),l=i(94172),a=i(8025),o=(i(63780),i(93169),i(89125)),c=i(49861),u=i(69912),d=i(69407),h=(i(59166),i(85015)),y=i(40281),f=(i(25243),i(51995)),p=i(19545),m=i(76200),g=i(51508),b=i(43404),v=i(32718),_=i(66978),w=i(17842),L=i(35995),S=i(25265),I=i(41978),C=i(60676),E=i(44041),A=i(37270),x=i(9014),V=i(61029),F=i(12726),R=i(49729),T=i(37817),M=i(69157),k=i(86828),N=i(74579),O=i(245);function z(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const i=e.visualVariables.find((e=>"size"===e.type)),n=((e,t)=>{const i=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return t?.levels?t.levels[i]:null})(t,i);return n?new O.Z({field:i.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}var P=i(226),D=i(40778),B=(i(84652),i(79563)),U=i(36009);const $={HH:315,HL:45,LL:135,LH:225},q={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function H(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return(0,U.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){const t=(0,B.mx)(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=(0,B.mx)(e);return t&&t.color}return(0,B._M)(e)}function Z(e,t){const i=t.HH.label,n=t.LL.label,r=t.HL.label,s=t.LH.label;switch(e){case"HH":default:return{top:i,bottom:n,left:r,right:s};case"HL":return{top:r,bottom:s,left:n,right:i};case"LL":return{top:n,bottom:i,left:s,right:r};case"LH":return{top:s,bottom:r,left:i,right:n}}}function j(e){let t=$[e];return e&&null==t&&(t=$.HH),t||0}var W=i(4075),G=i(75434),Y=i(80975),J=i(37384),Q=i(16072),X=i(16851);const K=[255,255,255],ee=[200,200,200],te=[128,128,128];async function ie(e,t,n,r,s,l){const a=t.legendOptions,o=a&&a.customValues,c=await se(e,n),u=!!c,d=!!o,h=null!=t.minSize&&null!=t.maxSize,y=t.stops&&t.stops.length>1,f=!!t.target;if(!u||!d&&!(h||y&&!f))return;const p=(0,N.YW)(c);let m=null,g=null,b=null;g=p&&!y?(0,W.NM)([t.minDataValue,t.maxDataValue]):o||await async function(e,t,n,r){const s=(await Promise.resolve().then(i.bind(i,56011))).getSizeRangeAtScale(e,n,r),l=s&&oe(s);if(!s&&!l)return;let a=l.map((t=>function(e,t,i){const n=i.minSize,r=i.maxSize,s=t.minDataValue,l=t.maxDataValue;let a=null;a=e<=n?s:e>=r?l:(e-n)/(r-n)*(l-s)+s;return a}(t,e,s)));a=(0,W.NM)(a);for(let i=1;i<a.length-1;i++){const s=await ce(e,t,a[i],a[i-1],n,r);s&&(a[i]=s[0],l[i]=s[1])}return a}(t,c,r,s);const v=e?.authoringInfo,_="univariate-color-size"===v?.type,w=_&&"above-and-below"===v?.univariateTheme;if(!g&&y&&(g=t.stops.map((e=>e.value)),m=t.stops.some((e=>!!e.label)),"flow"===e.type&&(g=(0,W.NM)(g)),m&&(b=t.stops.map((e=>e.label)))),p&&g?.length>2&&!w&&(g=[g[0],g[g.length-1]]),!g)return null;_&&5!==g?.length&&(g=oe({minSize:g[0],maxSize:g[g.length-1]}));const L=p?ne(e,g):null,S=(0,N.Y6)(c),I=m?null:function(e,t){const i=e.length-1;return e.map(((e,n)=>(0,G.MN)(e,n,i,t)))}(g,l);return(await Promise.all(g.map((async(i,n)=>{const l=p?L[n]:await ue(t,c,i,r,s);return{value:i,symbol:de(w&&"class-breaks"===e.type?re(e,n):c,l),label:m?b[n]:I[n],size:l,outlineSize:S}})))).reverse()}function ne(e,t){const i=e?.authoringInfo,n="univariate-color-size"===i?.type;let r=[12,30];if(n){const e=t[0],i=t[t.length-1],n=12,s=30;r=t.map((t=>n+(t-e)/(i-e)*(s-n)))}return n&&"below"===i?.univariateTheme&&r.reverse(),r}function re(e,t){const i=e.classBreakInfos,n=i.length,r=n<2||!(t>=2)?i[0].symbol.clone():i[n-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(r.type.includes("3d")?le(r):ae(r)),r}async function se(e,t){if("flow"===e.type)return(0,G.y$)(e,t);if("pie-chart"===e.type)return new Q.Z({color:null,outline:e.outline?.width?e.outline:new X.Z});let i=null,n=null;if("simple"===e.type)i=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;i=t&&t[0]&&t[0].symbol,n=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;i=t&&t[0]&&t[0].symbol,n=t.length>1}return!i||function(e){if(e)return(0,g.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type)):e.type.includes("fill");return!1}(i)?null:(i=i.clone(),(t||n)&&(i.type.includes("3d")?le(i):ae(i)),i)}function le(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:te}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:ee}:(e.material={color:K},e.outline={color:te,size:1.5})}))}function ae(e){const t=(0,J.$o)();if("cim"===e.type)(0,R.ZB)(e,new f.Z(ee));else if(e.type.includes("line"))e.color=te;else if(e.color=t?te:K,"simple-marker"===e.type)if(e.outline){const t=e.outline?.color?.toHex();"#ffffff"===t&&(e.outline.color=te)}else e.outline={color:te,width:1.5}}function oe(e){const t=e.minSize,i=(e.maxSize-t)/4,n=[];for(let r=0;r<5;r++)n.push(t+i*r);return n}async function ce(e,t,i,n,r,s){const l=await ue(e,t,i,r,s),a=await ue(e,t,n,r,s),o=(0,W.D2)(i),c=o.fractional;let u=o.integer,d=null,h=null;i>0&&i<1&&(d=10**c,u=(0,W.D2)(i*=d).integer);for(let y=u-1;y>=0;y--){const n=10**y;let o=Math.floor(i/n)*n,c=Math.ceil(i/n)*n;null!=d&&(o/=d,c/=d);let u=(o+c)/2;[,u]=(0,W.NM)([o,u,c],{indexes:[1]});const f=await ue(e,t,o,r,s),p=await ue(e,t,c,r,s),m=await ue(e,t,u,r,s),g=(0,W.f1)(l,f,a,null),b=(0,W.f1)(l,p,a,null),v=(0,W.f1)(l,m,a,null);let _=g.previous<=20,w=b.previous<=20;if(_&&w&&(g.previous<=b.previous?(_=!0,w=!1):(w=!0,_=!1)),_?h=[o,f]:w?h=[c,p]:v.previous<=20&&(h=[u,m]),h)break}return h}async function ue(e,t,n,r,s){const{getSize:l}=await Promise.resolve().then(i.bind(i,56011));return l(e,n,{scale:r,view:s,shape:"simple-marker"===t.type?t.style:null})}function de(e,t){const i=e.clone();if((0,g.dU)(i))(0,N.YW)(i)||i.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(i))i.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(i)){const e=i.width,n=i.height;i.height=t,i.width=t*(e/n)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(i)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(i)&&i.font&&(i.font.size=t):i.width=t;return i}i(76969);var he=i(6291);i(99388);var ye=i(61459);const fe=v.Z.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),pe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,me=new b.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ge={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},be=new Q.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),ve=new ye.Z({style:"solid"});function _e(e){return"flow"===e.type}function we(e){return"vector-field"===e.type}function Le(e){return"raster-colormap"===e.type}function Se(e){return"raster-stretch"===e.type}function Ie(e){return"raster-shaded-relief"===e.type}function Ce(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function Ee(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Ae(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function xe(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Ve(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Fe(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Re(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Te(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function Me(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function ke(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function Ne(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Oe(e){return"esri.layers.ImageryLayer"===e.declaredClass}function ze(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}const Pe=new Q.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let De={},Be=class extends h.Z{constructor(e){super(e),this._handles=new r.Z,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new y.Z,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([(0,l.on)((()=>this.children),"change",(t=>{const{added:i,removed:n}=t,r=this._handles;i.forEach((t=>{const i=`activeLayerInfo-ready-watcher-${t.layer.uid}`;r.add((0,l.YP)((()=>t.ready),e,l.nn),i)})),n.forEach((e=>r.remove(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(De={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(De=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new I.AM,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,i=this.layer.parent,n=i&&"uid"in i?this._getParentLayerOpacity(i):null;return null!=t?t*e:null!=n?n*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction&&"cluster"===e.featureReduction.type)return!0;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return!0;const t=e.get("renderer.valueExpression");if(pe.test(t))return!0;const i=e.get("renderer.visualVariables");if(i)return i.some((e=>this._isScaleDrivenSizeVariable(e)))}return this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,(e=>{if(function(e){return"esri.layers.FeatureLayer"===e.declaredClass}(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,i=t&&t.drawingInfo,n=i&&(0,x.i)(i.renderer),r=me.read(t.geometryType);return n?this._getRendererLegendElements(n,{title:e.name,geometryType:r}):(fe.warn("drawingInfo not available!"),null)}return null}));try{const e=[];await(0,_.as)(t).then((t=>{t.forEach((t=>{let{value:i}=t;return i&&e.push(...i)}))})),this.legendElements=e,this.notifyChange("ready")}catch($){fe.warn("error while building legend for layer!",$)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){fe.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){const e=this.layer;if(function(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))this._constructLegendElementsForVoxellayer();else if(function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(ke(e))await this._constructLegendElementsForBuildingSceneLayer();else if(Ne(e)||function(e){return"esri.layers.TileLayer"===e.declaredClass}(e)||ke(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let t="default";Oe(e)&&(t=(e?.renderingRule?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${t}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const i=t.map((async t=>{if(Oe(e)||ze(e)){const t=(0,l.YP)((()=>["renderingRule"in e&&e.renderingRule,e.bandIds]),(()=>(0,_.Ds)((async()=>{De.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this._handles.add(t,"imageryLayers-watcher")}const i=this._generateSymbolTableElementForLegendLayer(t);i&&i.infos.length&&(Oe(e)&&(i.title=e.title),this.legendElements.push(i)),this.notifyChange("ready")}));await(0,_.as)(i)})).catch((e=>{fe.warn("Request to server for legend has failed!",e)}))}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!i&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await(0,l.N1)((()=>!t.updating));const n=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return n.geometry=this.view.extent,0!==(i?"queryFeatureCount"in t&&await t.queryFeatureCount(n):"queryFeatureCount"in e&&await e.queryFeatureCount(n))}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,i=t.minSize,n=t.maxSize;return"object"==typeof i&&i?this._isScaleDrivenSizeVariable(i):"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):!!t.expression||pe.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&Ne(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const i of t.sourceJSON.layers)if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxellayer(){this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add((0,l.YP)((()=>e.currentVariableId),(()=>this._constructLegendElementsForVoxellayer())),"voxel-style-watcher");const t=(0,s.Wg)(e.getVariableStyle(null)),i=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach((t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new ye.Z({color:t.color,outline:null})})})),e.length&&i.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:n}=t.transferFunction,r=e.toArray().reverse(),s=n.map(((e,t)=>`${0===t?G.zZ:G.Eh} ${function(e){const t=Math.floor(Math.log10(Math.abs(e)))+1,i=t<4||t>6?4:t,n=Math.abs(e)>=1e6?"compact":"standard";return(0,he.uf)(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:i})}(e)}`)).reverse(),l=r.map((e=>({color:e.color,value:null,label:null})));l[0].label=s[0],l[l.length-1].label=s[1],i.push({type:"color-ramp",title:t.label,infos:l,preview:(0,k.jT)(r.map((e=>e.color)))})}const n=e.opacity,r=i.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,n)));await(0,_.as)(r),this.legendElements=i,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add((0,l.YP)((()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer}),(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((i=>e.styleId===i.id&&(t=i.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this._handles.add((0,l.YP)((()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers}),(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const n=e.toArray();for(const r of n){const e=(0,l.YP)((()=>[r.title,r.visible,r.legendEnabled]),(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||r.visible&&r.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(r,t);e&&e.infos.length&&i.unshift(e)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let i=e.legendUrl;if(!i)return;const n={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(i=(0,L.fl)(i,t));let r=null;const s=e.layer?.opacity;try{r=(await(0,m.default)(i,{responseType:"image"})).data,r&&(r.style.opacity=s)}catch{}return n.infos.push({src:i,preview:r,opacity:s}),n}_getLegendLayers(e,t){const i=De&&De[e];return i?Promise.resolve(i):this._legendRequest(t).then((t=>{const i=t.layers;return De[e]=i,i}))}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(Oe(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(i.renderingRule=JSON.stringify(e.rasterFunctionDefinition||e.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:n,customParameters:r}=t;i={raster:e,viewId:n,...i,...r}}}let n=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=n.indexOf("?");e>-1?n=n.substring(0,e)+"/legend"+n.substring(e):n+="/legend"}else{const e=n.toLowerCase().indexOf("/rest/"),t=n.substring(0,e)+n.substring(e+5,n.length);n="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return(0,m.default)(n,{query:i}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add((0,l.YP)((()=>e.sublayers),(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){fe.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const n=e.toArray();for(const r of n){const e=(0,l.YP)((()=>["renderer"in r&&r.renderer,r.opacity,r.title,r.visible]),(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||r.visible){const e=r&&null!=r.opacity?r.opacity:null,n=null!=e?e*t:t;if("building-group"===r.type){const e={type:"symbol-table",title:r.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(r.sublayers,n);e.infos.push(...t),i=[e,...i]}else r.renderer&&(i=[...await this._getRendererLegendElements(r.renderer,{title:r.title,opacity:n,sublayer:r}),...i])}}return i.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add((0,l.YP)((()=>e.sublayers),(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){fe.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,i){const n=this.layer;let r=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let s=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(s=this.sublayerIds.map((e=>n.findSublayerById(e))).filter(Boolean));for(const a of s){const e=(0,l.YP)((()=>[a.renderer,a.opacity,a.title,a.visible,a.legendEnabled]),(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||a.visible&&a.legendEnabled&&this._isSublayerInScale(a)){const e=a&&null!=a.opacity?a.opacity:null,n=null!=e?e*t:t;if(a.renderer&&!a.sublayers&&a.originIdOf("renderer")>S.s3.SERVICE)await a.load(),r=[...await this._getRendererLegendElements(a.renderer,{title:a.title,opacity:n,sublayer:a}),...r];else{const e=await this._generateSymbolTableElementForSublayer(a,n,i);e&&r.unshift(e)}}}return r.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const t=this.layer,n=e.source;let r=null;if(n&&("map-layer"!==n.type||n.mapLayerId!==e.id||n.gdbVersion&&n.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>S.s3.SERVICE||e.originIdOf("labelingInfo")>S.s3.SERVICE||e.originIdOf("labelsVisible")>S.s3.SERVICE){const e=new E.R({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const s=r||`${t.uid}-default`;(await this._getLegendLayers(s,r)).forEach((e=>i.set(e.layerId,e)))}const n=i.get(e.id);if((!n||n?.subLayerIds&&n.defaultVisibility)&&e.sublayers){const n=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:n}}return this._generateSymbolTableElementForLegendLayer(n,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const n=t?.renderer;let r=t?.title||e.layerName;if(n&&(!t||t?.originIdOf("renderer")>S.s3.SERVICE)){const e=t?.title||this._getRendererTitle(n,t);e&&(r&&"string"!=typeof e&&"title"in e&&(e.title=r),r=e)}const s={type:"symbol-table",title:r,legendType:e.legendType?e.legendType:null,infos:[]},l=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups?.length>0?e.legendGroups.forEach((t=>{const n={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(l.filter((e=>e.groupId===t.id)),e.layerId,i)};n.infos?.length>0&&s.infos.push(n)})):s.infos=this._generateSymbolTableElementInfosForLegendLayer(l,e.layerId,i),s.infos.length>0?s:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map((e=>{let n=e.url;if(e.imageData&&e.imageData.length>0)n=`data:image/png;base64,${e.imageData}`;else{if(0===n.indexOf("http"))return null;n=(0,p.Dp)(`${this.layer.url}/${t}/images/${n}`)}return{label:e.label,src:n,opacity:null==i?this.opacity:i,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let n=null,r=null,s=!0;return!i.minScale&&0!==i.minScale||!i.maxScale&&0!==i.maxScale?(0===e.minScale&&i.tileInfo&&(n=i.tileInfo.lods[0].scale),0===e.maxScale&&i.tileInfo&&(r=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(n=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,r=Math.max(i.maxScale,e.maxScale)),(n>0&&n<this.scale||r>this.scale)&&(s=!1),s}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const i=t.renderer,n=e.some((e=>e.values));let r=null,s=null;return n&&e.some(((e,t)=>(e.values||(r=t,s=e,s.label||(s.label="others")),null!=s))),i?"unique-value"===i.type?s&&(e.splice(r,1),e.push(s)):"class-breaks"===i.type&&(s&&e.splice(r,1),e.reverse(),s&&e.push(s)):s&&(e.splice(r,1),e.push(s)),e}async _getRendererLegendElements(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){return Ce(e)||Ee(e)||Ae(e)||xe(e)||Te(e)||Me(e)?"2d"===t.type||(0,V.e)(e):Se(e)||Le(e)||Ie(e)||Ve(e)||Fe(e)||Re(e)||we(e)||_e(e)}(e,this.view)?function(e){return Ve(e)||Fe(e)||Re(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e)?this._constructPointCloudRendererLegendElements(e,t):Te(e)?this._constructDotDensityRendererLegendElements(e):Me(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(fe.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).title,i=[];let n=null,r=null;if(Ve(e))n={type:"symbol-table",title:t||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{n.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(be,e.color)})}));else if(Fe(e)){const i=e.stops;let s=null;if(i.length&&(1===i.length&&(s=i[0].color),!s)){const e=i[0].value,t=i[i.length-1].value;null!=e&&null!=t&&(s=(0,P.QQ)(e+(t-e)/2,i))}n={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(be,s||be.color)}]};const l=(0,P.NA)(e.stops);r={type:"color-ramp",title:t||this._getPointCloudRendererTitle(e),infos:l,preview:(0,k.jT)(l.map((e=>e.color)))}}else Re(e)&&(n={type:"symbol-table",title:t||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{n.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(be,e.color)})})));n&&n.infos.length&&i.push(n),r&&r.infos.length&&i.push(r);const s=i.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})));return(0,_.as)(s).then((()=>i))}_getElementInfoForDotDensity(e,t){const{backgroundColor:i,outline:n,dotSize:r}=e,s=this.effectList?.effects.map((e=>e.toJSON())),l=(0,C.rM)(s),a=r+"-"+t+"-"+i+"-"+(n&&JSON.stringify(n.toJSON()))+"-"+l,o=this._dotDensityUrlCache,c=o.has(a)?o.get(a):(0,k.k)(e,t);o.set(a,c);const u={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},d=(0,M.w)([[u]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:d,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions&&e.legendOptions.unit,n={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};return e.attributes.forEach((t=>{const i=this._getElementInfoForDotDensity(e,t.color);i.label=t.label||t.valueExpressionTitle||t.field,n.infos.push(i)})),Promise.resolve([n])}async _constructPieChartRendererLegendElements(e){const t=this.layer.opacity,i=[],n="Others",r=e.outline;e.attributes.forEach((e=>{const t=new Q.Z({color:e.color,outline:r}),n=e.label||e.valueExpressionTitle||e.field;i.push({label:n,symbol:t})}));const s=i.length?[...i]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const t=new Q.Z({color:e.othersCategory.color,outline:r});i.push({label:e.othersCategory.label||n,symbol:t})}if(e.defaultColor?.a){const t=new Q.Z({color:e.defaultColor,outline:r});i.push({label:e.defaultLabel,symbol:t})}const l=await this._getVisualVariableLegendElements(e,this.layer)||[];if(i.length){l.unshift({type:"symbol-table",title:null,infos:i});const t=s.filter((e=>e.label!==n)).map((e=>e.symbol.color)).filter(Boolean),a=(0,k.LC)(t,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:r});l.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:a})}const a=l.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol&&!e?.preview)).map((e=>this._getSymbolPreview(e,t,{effectList:this.effectList})));return await(0,_.as)(a),l}async _constructRendererLegendElements(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{title:i,sublayer:n}=t,r=n||this.layer;let l=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const a=await this._getVisualVariableLegendElements(l,r)||[],o={type:"symbol-table",title:i||this._getRendererTitle(l,r),infos:[]};let c=null,u=!1;const d=new Set;if(_e(l)&&!this._hasSizeRamp){const e=await(0,G.y$)(l);o.infos.push({label:null,symbol:e})}else if(function(e){return"univariate-color-size"===("authoringInfo"in e&&e?.authoringInfo)?.type}(l)){let e=i;const t=function(e){const t="authoringInfo"in e&&e?.authoringInfo;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(l)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",n=a.findIndex((e=>"color-ramp"===e.type)),r=-1!==n?a.splice(n,1)[0]:null,s=a.findIndex((e=>"size-ramp"===e.type)),o=-1!==s?a.splice(s,1)[0]:null,c=[];r&&(e=r.title,c.push(r)),o&&(e=o.title,c.push(o)),c.length>0&&a.push({type:t,title:e,infos:c})}else if(xe(l)){const e=(0,D.h)(l);a.push({type:"heatmap-ramp",title:i||l.legendOptions?.title,infos:e,preview:(0,k.jT)(e.map((e=>e.color)),{effectList:this.effectList})})}else if(Ae(l)){const e=l&&l.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:i,field1:n,field2:s}=e;if(i&&n&&s){const e=[n,s];let c=j(t)||0;for(const t of e){const{field:e,normalizationField:i,label:n}=t,s=n||{field:this._getFieldAlias(e,r),normField:i&&this._getFieldAlias(i,r)},l=Pe.clone();l.angle=c,o.infos.push({label:s,symbol:l}),d.add(l),c+=90}const u=function(e){const{focus:t,infos:i,numClasses:n}=e,r=q[n],s={};i.forEach((e=>{s[e.value]={label:e.label,fill:H(e.symbol)}}));const l=[];for(let a=0;a<n;a++){const e=[];for(let t=0;t<n;t++){const i=s[r[a][t]];e.push(i.fill)}l.push(e)}return{type:"relationship-ramp",numClasses:n,focus:t,colors:l,labels:Z(t,s),rotation:j(t)}}({focus:t,numClasses:i,infos:l.uniqueValueInfos});a.unshift(u)}}else{const e=l.field;l.uniqueValueInfos.forEach((t=>{t.symbol&&o.infos.push({label:t.label||this._getDomainName(e,t.value,r)||t.value,value:t.value,symbol:t.symbol})}))}l.defaultSymbol&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),u=!0)}else if(Ee(l))c=this._isUnclassedRenderer(l),(!c||!this._hasSizeRamp)&&(l.classBreakInfos.forEach((e=>{e.symbol&&o.infos.unshift({label:e.label||(c?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),c&&(o.title=null),this._updateInfosforClassedSizeRenderer(l,o.infos)),l.defaultSymbol&&!c&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),u=!0);else if(Se(l))if(ze(this.layer)||function(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const e=this._constructTileImageryStretchRendererElements(l);!function(e){return"stretch-ramp"===e.type}(e)?o.infos=e:a.push(e)}else{const e=this.layer;let t,i;l.statistics&&l.statistics.length&&(t=null!=l.statistics[0].min?l.statistics[0].min:l.statistics[0][0],i=null!=l.statistics[0].max?l.statistics[0].max:l.statistics[0][1]);let n=[];const r=(0,s.Wg)(e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo),c=r.keyProperties.BandProperties,u=ge[e.rasterInfo.pixelType.toLowerCase()];1===r.bandCount||e.bandIds&&1===e.bandIds.length?(t=null!=t?t:r.statistics?r.statistics[e.bandIds[0]].min:u[0],i=null!=i?i:r.statistics?r.statistics[e.bandIds[0]].max:u[1],t||i?a.push(this._getStretchLegendElements(l,{min:t,max:i})):this._getServerSideLegend()):r.bandCount>=3?c&&c.length>=r.bandCount?e.bandIds&&3===e.bandIds.length?(n=e.bandIds.map((e=>c[e].BandName)),o.infos=this._createSymbolTableElementMultiBand(n)):"lerc"===e.format?(n=[0,1,2].map((e=>c[e].BandName)),o.infos=this._createSymbolTableElementMultiBand(n)):this._getServerSideLegend():"lerc"===e.format?(n=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(n)):this._getServerSideLegend():this._getServerSideLegend()}else if(Le(l))l.colormapInfos.forEach((e=>{o.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(ve,e.color)})}));else if(Ce(l)){let e=l.symbol;switch(t.geometryType){case"point":e="pointSymbol"in r&&r.pointSymbol;break;case"polyline":e="lineSymbol"in r&&r.lineSymbol;break;case"polygon":e="polygonSymbol"in r&&r.polygonSymbol}l.symbol&&!this._hasSizeRamp&&o.infos.push({label:l.label,symbol:e})}else if(we(l)){l.outputUnit&&(this.title="("+l.toJSON().outputUnit+")"),o.title=l.attributeField;const e=l.getClassBreakInfos();e?.length?e.forEach((e=>{o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:l.attributeField,symbol:l.getDefaultSymbol()})}else Ie(l)&&a.push(this._getStretchLegendElements(l,{min:0,max:255}));const h=l.defaultSymbol;!h||u||Ce(l)||c&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||a.push({type:"symbol-table",infos:[{label:l.defaultLabel||"others",symbol:h}]}),o.infos.length&&a.unshift(o);const y=null==t.opacity?this.opacity:t.opacity,f=this._isTallSymbol("visualVariables"in l&&l.visualVariables),p=Oe(this.layer)||ze(this.layer),m=a.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!!e?.symbol)).map((e=>this._getSymbolPreview(e,y,{isDefault:e.symbol===h,applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:f,isSquareFill:p},effectList:d.has(e.symbol)?null:this.effectList})));return l=null,await(0,_.as)(m),a}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){const t=this.layer,i=t.rasterInfo,n=i.bandCount||e.statistics.length;let r,s,l=[];const a=i.keyProperties&&i.keyProperties.BandProperties,o=e?.statistics?.length?e.statistics:i?.statistics;if(o)r=void 0!==o[0].min?o[0].min:o[0][0],s=o[0].max||o[0][1];else{const e=ge[t.rasterInfo.pixelType.toLowerCase()];r=e[0],s=e[1]}if(t.hasStandardTime()&&(r=t.getStandardTimeValue(r),s=t.getStandardTimeValue(s)),1===i.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:r,max:s});function c(e){const n=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),n}return l=a&&a.length>=n?c(a):c(),this._createSymbolTableElementMultiBand(l)}_getStretchLegendElements(e,t){const i=e.colorRamp,n=(0,P.fD)(i,t);return{type:"stretch-ramp",title:"",infos:n,preview:(0,k.jT)(n.map((e=>e.color)))}}async _getSizeLegendElement(e,t,i,n){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await ie(i,t,await(0,G.jb)(i),this.scale,this.view.type,n)}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach(((e,n)=>{t.push({label:{colorName:i[n],bandName:e},src:G.uY[n],opacity:this.opacity??1})})),t}_updateInfosforClassedSizeRenderer(e,t){const i=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,n=e.classBreakInfos.some((e=>(0,N.YW)(e.symbol)));if(i&&n){const i=30,n=12,r=e.classBreakInfos.length,s=(i-n)/(r>1?r-1:r);t.forEach(((e,t)=>{e.size=i-s*t}))}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let n=0;n<e.length&&(!t||!i);n++){const r=e[n];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(i=!0))}return t&&i}async _getSymbolPreview(e,t,n){let r=!n?.isDefault&&null==e.size&&this._hasSizeRamp?(0,w.Wz)(T.b_.size):e.size;if(this._scaleDrivenSizeVariable&&n?.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then(i.bind(i,56011));r=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}return(0,k.l3)(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:n?.symbolConfig,effectView:n?.effectList}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){const t=[],i=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const n="visualVariables"in e&&e.visualVariables?.some((e=>"size"===e.type&&"outline"!==e.target&&!pe.test(e.valueExpression)));if(e&&"visualVariables"in e&&!n&&"featureReduction"in i&&"cluster"===i.featureReduction?.type){const t=this.layerView._effectiveRenderer,n=(0,s.Wg)(z(t,this.view));if(n){const t=i.featureReduction;if("clusterMinSize"in t&&"clusterMaxSize"in t){const{clusterMinSize:e,clusterMaxSize:i}=t;n.legendOptions=new F.Z({showLegend:e!==i})}const r=e.visualVariables||[];e.visualVariables=r.concat([n]),this._hasClusterSizeVariable=!0}}const r=await(0,G.jb)(e);if(Ee(e)||Ae(e)){const i=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,r).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(t,i)}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:r).then((t=>{this._applySymbolToRenderer(e,t,Ce(e))})).catch((()=>{this._applySymbolToRenderer(e,null,Ce(e))}))),(0,_.as)(t).then((()=>e))}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const i=this._webStyleSymbolCache;try{const n=await("2d"===this.view.type?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i}));return this._getAppliedCloneSymbol(n,t)}catch{throw fe.warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),n=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,n):"cim"===i.type?(0,R.ZB)(i,t):i.color&&(i.color=new f.Z(n||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new f.Z(t))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const i=e.visualVariables,n=[],r=[],l=[];for(const s of i)"color"===s.type?n.push(s):"size"===s.type?r.push(s):"opacity"===s.type&&l.push(s);const a=[...n,...r,...l];let o,c;if(0===n.length&&Ee(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];o=t&&t.symbol}if(0===n.length&&Ce(e)&&(o=e.symbol),o)if(o.type.includes("3d")){const e=o.symbolLayers.getItemAt(0);"water"===e.type?(0,s.pC)(e.color)&&(c=e.color):(0,s.pC)(e.material)&&(0,s.pC)(e.material.color)&&(c=e.material.color)}else o.url||(c=o.color);const u=this.effectList;return(await Promise.all(a.map((async i=>{if(!i.legendOptions||!1!==i.legendOptions.showLegend){const n=_e(e)?i.field:this._getRampTitle(i,t);let r=null;const s="getField"in t&&t.getField&&t.getField(i.field),l=s&&(0,A.y2)(s);if("color"===i.type){const e=await(0,P.pO)(i,null,l);r={type:"color-ramp",title:n,infos:e,preview:(0,k.jT)(e.map((e=>e.color)),{effectList:u})},this._hasColorRamp||(this._hasColorRamp=!(null==r.infos||!r.infos.length))}else if("size"===i.type&&"outline"!==i.target)pe.test(i.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=i):(r=await this._getSizeLegendElement(n,i,e,l),this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===i.type){const e=await(0,P.pO)(i,c,l);r={type:"opacity-ramp",title:n,infos:e,preview:(0,k.jT)(e.map((e=>e.color)),{effectList:u})},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==r.infos||!r.infos.length))}return r&&r.infos?r:null}})))).filter((e=>!!e))}_getDomainName(e,t,i){if(e&&"function"!=typeof e){const n="getField"in i&&i.getField&&i.getField(e),r=n&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(n.name):null;return r&&"coded-value"===r.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,n="popupTemplate"in e&&e.popupTemplate,r=n&&n.fieldInfos;if(r)for(const t of r)if(t.fieldName===i)return"cluster_count"===i?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,n=e.normalizationField,r=!1,s=!1,l=!1,a=null;i="function"==typeof i?null:i,n="function"==typeof n?null:n;const o=e.legendOptions&&e.legendOptions.title;if(null!=o)a=o;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const i=e[t];if("color"===i.type){if("ratio"===i.style){r=!0;break}if("percent"===i.style){s=!0;break}if("percent-of-total"===i.style){l=!0;break}}}}a={field:i&&this._getFieldAlias(i,t),normField:n&&this._getFieldAlias(n,t),ratio:r,ratioPercent:s,ratioPercentTotal:l}}return a}_getRendererTitle(e,t){const i=e;if(i.legendOptions&&i.legendOptions.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let n=i.field,r=null,s=null;Ee(i)&&(r=i.normalizationField,s="percent-of-total"===i.normalizationType),n="function"==typeof n?null:n,r="function"==typeof r?null:r;let l=null;return(n||r)&&(l={field:n&&this._getFieldAlias(n,t),normField:r&&this._getFieldAlias(r,t),normByPct:s}),l}_getFieldAlias(e,t){const i="popupTemplate"in t&&t.popupTemplate,n=i&&i.fieldInfos;let r=null;n&&n.some((t=>e===t.fieldName&&(r=t,!0)));let s=null;"getField"in t&&t.getField?s=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(s=t.fieldsIndex.get(e));const l=r||s;let a=null;return l&&(a=r&&r.label||s&&s.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return Ee(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(i=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),i}};(0,n._)([(0,c.Cb)()],Be.prototype,"children",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],Be.prototype,"effectList",null),(0,n._)([(0,c.Cb)()],Be.prototype,"layerView",void 0),(0,n._)([(0,c.Cb)()],Be.prototype,"layer",void 0),(0,n._)([(0,c.Cb)()],Be.prototype,"legendElements",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],Be.prototype,"opacity",null),(0,n._)([(0,c.Cb)()],Be.prototype,"parent",void 0),(0,n._)([(0,c.Cb)({readOnly:!0,dependsOn:[]})],Be.prototype,"ready",null),(0,n._)([(0,c.Cb)()],Be.prototype,"hideLayersNotInCurrentView",void 0),(0,n._)([(0,c.Cb)()],Be.prototype,"keepCacheOnDestroy",void 0),(0,n._)([(0,c.Cb)()],Be.prototype,"respectLayerVisibility",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],Be.prototype,"scale",null),(0,n._)([(0,c.Cb)()],Be.prototype,"sublayerIds",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],Be.prototype,"isScaleDriven",null),(0,n._)([(0,c.Cb)()],Be.prototype,"title",void 0),(0,n._)([(0,c.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],Be.prototype,"version",null),(0,n._)([(0,c.Cb)()],Be.prototype,"view",void 0),Be=(0,n._)([(0,u.j)("esri.widgets.Legend.support.ActiveLayerInfo")],Be);const Ue=Be;var $e=i(36257);const qe="state",He="view",Ze="all-layer-views",je="legend-properties",We=y.Z.ofType(Ue),Ge=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Ye="view.basemapView.baseLayerViews",Je="view.groundView.layerViews",Qe="view.basemapView.referenceLayerViews",Xe=[Ye,Je,"view.layerViews",Qe];let Ke=class extends h.Z{constructor(e){super(e),this._handles=new r.Z,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new y.Z,this.activeLayerInfos=new We,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add((0,l.YP)((()=>this.view),(()=>this._viewHandles()),l.nn),He),this._handles.add((0,$e.qe)((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(qe),this.view&&this._handles.add((0,l.YP)((()=>this.state),(()=>this._stateHandles()),l.nn),qe)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([Ze,je]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",(e=>this._allLayerViewsChangeHandle(e))),Ze),this._handles.add((0,l.YP)((()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible]),(()=>this._propertiesChangeHandle())),je)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach((i=>{if(!i.parent){const n=i.layer.parent,r=n&&"uid"in n&&this._layerViewByLayerId[n.uid],s=r&&this._activeLayerInfosByLayerViewId[r.uid];s&&e.includes(s)&&(t.push(i),i.parent=s,s.children.add(i),this._sortActiveLayerInfos(s.children))}})),e.removeMany(t);const i={};this.view.allLayerViews.forEach(((e,t)=>i[e.layer.uid]=t)),e.sort(((e,t)=>{const n=i[e.layer.uid]||0;return(i[t.layer.uid]||0)-n}))}_generateLayerViews(){const e=[];return Xe.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===Ye||e===Qe),i=!this.groundLegendVisible&&e===Je;return!t&&!i}_collectLayerViews(e,t){const i=n=>(n&&n.forEach((n=>{t.push(n),i(n[e])})),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some((t=>this._hasLayerInfo(t,e)))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some((e=>this._isLayerUIDMatching(e,t)))}_isLayerViewSupported(e){return!!Ge.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,l.YP)((()=>[e.legendEnabled,e.layer.legendEnabled]),(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){const t=e.layer,i=e.uid,n=this._layerInfosByLayerViewId[i];let r=this._activeLayerInfosByLayerViewId[i];if(!r){const s=n&&void 0!==n.title&&n.layer.uid===t.uid;r=new Ue({layer:t,layerView:e,title:s?n.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:n&&n.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=r}const s=t.parent&&"uid"in t.parent&&this._layerViewByLayerId[t.parent?.uid];if(r.parent=this._activeLayerInfosByLayerViewId[s?.uid],!this._handles.has(i)){const n=[(0,l.YP)((()=>t.title),(e=>this._titleHandle(e,r))),(0,l.YP)((()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol]),(()=>this._constructLegendElements(r))),(0,l.gx)((()=>!0===this.view?.stationary),(()=>this._scaleHandle(r)),l.nn),(0,l.YP)((()=>e._effectiveRenderer),(()=>this._constructLegendElements(r))),(0,l.YP)((()=>"effect"in t&&t.effect),(()=>this._constructLegendElements(r)))];if(this.respectLayerVisibility){const i=(0,l.YP)((()=>e.legendEnabled),(e=>this._legendEnabledHandle(e,r))),s=(0,l.YP)((()=>t.legendEnabled),(e=>this._legendEnabledHandle(e,r)));n.push(i,s)}this._handles.add(n,i)}r.isScaleDriven||this._constructLegendElements(r),this._addActiveLayerInfo(r)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const t=e.parent;if(t)t.children.includes(e)||t.children.push(e),this._sortActiveLayerInfos(t.children);else{const t=this.layerInfos?.some((e=>e.layer.uid===i.uid));i.parent&&"uid"in i.parent&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((t=>{const i=t.layer.parent,n=i&&"uid"in i&&this._layerViewByLayerId[i?.uid],r=this._activeLayerInfosByLayerViewId[n?.uid];r&&(e.push(t),t.parent=r)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&"binning"===t.featureReduction?.type&&"renderer"in t.featureReduction?e.buildLegendElementsForRenderer(t.featureReduction.renderer):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};(0,n._)([(0,c.Cb)({type:We})],Ke.prototype,"activeLayerInfos",void 0),(0,n._)([(0,c.Cb)()],Ke.prototype,"basemapLegendVisible",void 0),(0,n._)([(0,c.Cb)()],Ke.prototype,"groundLegendVisible",void 0),(0,n._)([(0,c.Cb)()],Ke.prototype,"hideLayersNotInCurrentView",void 0),(0,n._)([(0,c.Cb)()],Ke.prototype,"keepCacheOnDestroy",void 0),(0,n._)([(0,c.Cb)()],Ke.prototype,"respectLayerVisibility",void 0),(0,n._)([(0,c.Cb)()],Ke.prototype,"layerInfos",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],Ke.prototype,"state",null),(0,n._)([(0,c.Cb)()],Ke.prototype,"view",void 0),Ke=(0,n._)([(0,u.j)("esri.widgets.Legend.LegendViewModel")],Ke);const et=Ke;var tt=i(99653),it=i(67005);const nt="http://www.w3.org/2000/svg",rt="esri-relationship-ramp--diamond__container",st="esri-relationship-ramp--diamond__left-column",lt="esri-relationship-ramp--diamond__right-column",at="esri-relationship-ramp--diamond__middle-column",ot="esri-relationship-ramp--diamond__middle-column--label",ct="esri-relationship-ramp--diamond__middle-column--ramp",ut="esri-relationship-ramp--square__table",dt="esri-relationship-ramp--square__table-row",ht="esri-relationship-ramp--square__table-cell",yt="esri-relationship-ramp--square__table-label",ft="esri-relationship-ramp--square__table-label--left-bottom",pt="esri-relationship-ramp--square__table-label--right-bottom",mt="esri-relationship-ramp--square__table-label--left-top",gt="esri-relationship-ramp--square__table-label--right-top";function bt(e,t,i,n){const{focus:r,labels:s}=e,l=!!r,a=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:60;const{focus:s,numClasses:l,colors:a,rotation:o}=e,c=!!s,u=Math.sqrt(r**2+r**2)+(c?0:5),d=[],h=[],y=[],f=(r||75)/l;for(let E=0;E<l;E++){const e=E*f;for(let t=0;t<l;t++){const i=t*f,n=(0,tt.jA)(a[E][t]),r=(0,tt.kQ)(null),s={type:"rect",x:i,y:e,width:f,height:f};d.push((0,tt.ch)(n)),h.push((0,tt.vq)(s,n.fill,r,null)),y.push((0,tt.A5)(s))}}const p=10,m=15,g=15,b=10;let v=null;c||(v="margin: -15px -15px -18px -15px");const _=vt("left",s,t),w=vt("right",s,t),L=(0,tt.al)(y),S=(0,tt.iL)(L,u,u,0,!1,o,!1),I=(0,tt.iL)(L,u,u,0,!1,c?-45:null,!1),C={filter:(0,N.wJ)(n),opacity:null==i?null:`${i}`};return(0,it.u)("div",{styles:C,class:c?ct:ht},(0,it.u)("svg",{xmlns:nt,width:u,height:u,style:v},(0,it.u)("defs",null,(0,it.u)("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,it.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,it.u)("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,it.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),(0,it.u)("g",{transform:S},h),(0,it.u)("g",{transform:I},(0,it.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":_.markerStart,"marker-end":_.markerEnd,x1:-p,y1:r-m,x2:-p,y2:m}),(0,it.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":w.markerStart,"marker-end":w.markerEnd,x1:g,y1:r+b,x2:r-g,y2:r+b}))))}(e,t,i,n),o=(0,Y.dZ)();return l?(0,it.u)("div",{class:rt,styles:{justifyContent:"center"}},(0,it.u)("div",{class:st},o?s.right:s.left),(0,it.u)("div",{class:at},(0,it.u)("div",{class:ot},s.top),a,(0,it.u)("div",{class:ot},s.bottom)),(0,it.u)("div",{class:lt},o?s.left:s.right)):(0,it.u)("div",{class:ut},(0,it.u)("div",{class:dt},(0,it.u)("div",{class:(0,Y.Sh)(ht,yt,pt)},o?s.top:s.left),(0,it.u)("div",{class:ht}),(0,it.u)("div",{class:(0,Y.Sh)(ht,yt,ft)},o?s.left:s.top)),(0,it.u)("div",{class:dt},(0,it.u)("div",{class:ht}),a,(0,it.u)("div",{class:ht})),(0,it.u)("div",{class:dt},(0,it.u)("div",{class:(0,Y.Sh)(ht,yt,gt)},o?s.right:s.bottom),(0,it.u)("div",{class:ht}),(0,it.u)("div",{class:(0,Y.Sh)(ht,yt,mt)},o?s.bottom:s.right)))}function vt(e,t,i){const n=`${i}_arrowStart`,r=`${i}_arrowEnd`,s="left"===e,l={markerStart:null,markerEnd:null};switch(t){case"HL":s?l.markerStart=`url(#${r})`:l.markerEnd=`url(#${n})`;break;case"LL":l.markerStart=`url(#${r})`;break;case"LH":s?l.markerEnd=`url(#${n})`:l.markerStart=`url(#${r})`;break;default:l.markerEnd=`url(#${n})`}return l}i(42877);const _t=(0,i(88367).E)(),wt=20,Lt=10,St=20,It="esri-univariate-above-and-below-ramp__symbol",Ct="esri-legend__color-ramp";function Et(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical";const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,it.u)("svg",{height:"4",width:"10"},(0,it.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,it.u)("svg",{height:"10",width:"10"},(0,it.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function At(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical";const i=document.createElement("div");return i.style.height="20px",i.className=It,null!=e&&(i.style.opacity=e.toString()),_t.append(i,Et.bind(null,t)),i}function xt(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",n=arguments.length>3?arguments[3]:void 0;e.infos.forEach(((e,r)=>{if(n&&2===r)e.preview=At(t,i);else{const t=(0,w.F2)(e.size)+("horizontal"===i?St:Lt),n="div"===e.preview.tagName.toLowerCase(),r=n?e.preview:document.createElement("div");r.className=It,"horizontal"===i?r.style.width=`${t}px`:r.style.height=`${t}px`,n||r.appendChild(e.preview),e.preview=r}}))}function Vt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic";const i=e.infos;return"classic"===t?((0,w.F2)(i[0].size)+Lt)/2:((0,w.F2)(i[0].size)-(0,w.F2)(i[i.length-1].size))/2}function Ft(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),n=(0,k.jT)("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return n.className=Ct,null!=t.opacity&&(n.style.opacity=t.opacity.toString()),n}function Rt(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",r=0;const s=e.infos,l=Math.floor(s.length/2),a="full"===t||"above"===t?0:l,o="full"===t||"below"===t?s.length-1:l;for(let c=a;c<=o;c++)r+=i&&c===l?"horizontal"===n?10:wt:(0,w.F2)(s[c].size)+("horizontal"===n?St:Lt);return Math.round(r)}function Tt(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical";const r=Rt(e,t,i,n),s=e.infos,l=Math.floor(s.length/2),a="full"===t||"above"===t?0:l,o="full"===t||"below"===t?s.length-1:l,c="full"===t?s[a].size+s[o].size:"above"===t?s[a].size:s[o].size,u=i?"vertical"===n?wt:10:0,d="vertical"===n?Lt*("full"===t?2:1):St*("full"===t?2:1);return Math.round(r-((0,w.F2)(c)/2+u/2+d/2))}function Mt(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical";const n=e.infos;let r=n.find((e=>{let{type:t}=e;return"size-ramp"===t})),s=n.find((e=>{let{type:t}=e;return"color-ramp"===t}));return r&&(r={...r},r.infos=[...r.infos],xt(r,t,i,!0)),s&&(s={...s},s.infos=[...s.infos]),"horizontal"===i&&(r?.infos.reverse(),s?.infos.reverse()),{sizeRampElement:r,colorRampElement:s}}function kt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical";const i=e.infos;let n=i.find((e=>{let{type:t}=e;return"size-ramp"===t})),r=i.find((e=>{let{type:t}=e;return"color-ramp"===t}));return n&&(n={...n},n.infos=[...n.infos],xt(n,null,t,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===t&&(n?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:n,colorRampElement:r}}var Nt=i(8704);function Ot(e){e.appendChild(this)}function zt(e,t,i){if(!t)return;if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,Nt.n)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let n=null;return function(e,t){return t}(0,i)?n=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Pt(t,i)&&(n=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),n?(0,Nt.n)("showField"===n?"{field}":e[n],{field:t.field,normField:t.normField}):null}function Pt(e,t){return!t}function Dt(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var Bt=i(96919),Ut=i(78088),$t=i(80532);const qt="esri-legend--card__carousel-indicator--activated",Ht="esri-legend--card",Zt="esri-legend--stacked",jt="esri-legend--card__carousel-title",Wt="esri-legend--card__carousel-indicator",Gt="esri-legend--card__interval-separator",Yt="esri-legend--card__imagery-layer-image--stretched",Jt="esri-legend--card__image-label",Qt="esri-legend--card__layer-caption",Xt="esri-legend--card__label-element",Kt="esri-legend--card__layer-row",ei="esri-legend--card__label-cell",ti="esri-legend--card__message",ii="esri-legend--card__ramp-label",ni="esri-legend--card__section",ri="esri-legend--card__service-caption-text",si="esri-legend--card__service-content",li="esri-legend--card__service",ai="esri-legend--card__group-layer",oi="esri-legend--card__group-layer-child",ci="esri-legend--card__symbol",ui="esri-legend--card__size-ramp-row",di="esri-legend--card__symbol-row",hi="esri-legend--card__symbol-cell",yi="esri-legend--card__carousel-indicator-container",fi="esri-legend--card__interval-separators-container",pi="esri-legend--card__relationship-label-container",mi="esri-legend--card__label-container",gi="esri-legend--card__service-caption-container",bi="esri-legend--card__symbol-container",vi="esri-legend--card__size-ramp-container",_i="esri-legend--card__size-ramp-preview",wi="esri-legend--card__pie-chart-ramp-preview",Li="esri-legend__size-ramp--horizontal",Si="esri-legend__ramp-labels",Ii="esri-legend__layer-cell esri-legend__layer-cell--info",Ci="esri-univariate-above-and-below-ramp__color--card";var Ei;!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(Ei||(Ei={}));const Ai=window.devicePixelRatio;let xi=class extends d.Z{constructor(e,t){super(e,t),this._handles=new r.Z,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=Ei.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own((0,l.YP)((()=>this.activeLayerInfos),(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)})))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===Ei.Auto&&this.view.container.clientWidth<=768||this.layout===Ei.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,n=this._sectionNames.map(((e,t)=>{const n=(0,Nt.n)(this.messagesCommon.pagination.pageText,{index:t+1,total:i});return(0,it.u)("div",{key:e,role:"tab",id:e,"aria-label":n,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:n,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(Wt,{[qt]:this._selectedSectionName===e}),"data-section-name":e})})),r=this._hasIndicators&&i>1?(0,it.u)("div",{class:yi,key:"carousel-navigation",role:"tablist"},n):null,s=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,l={[Zt]:this._hasIndicators};return(0,it.u)("div",{class:this.classes(Ht,l)},s||(0,it.u)("div",{class:ti},this.messages.noLegend),r)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,i="ArrowLeft"===t?-1:1,n=e.target.getAttribute("data-section-name"),r=this._sectionNames.indexOf(n),s=this._sectionNames;let l=null;-1!==r&&(s[r+i]?l=document.getElementById(s[r+i]):"ArrowLeft"===t?l=document.getElementById(s[s.length-1]):"ArrowRight"===t&&(l=document.getElementById(s[0])),l&&l.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add((0,l.YP)((()=>e.version),(()=>this._generateSectionNames())),t)}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,it.u)("div",{key:e.layer.uid,class:this.classes(li,ai)},(0,it.u)("div",{class:gi},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.some((e=>"relationship-ramp"===e.type)),n=t.map(((t,n)=>this._renderLegendForElement(t,e,n,i))).filter((e=>!!e));if(!n.length)return null;const r={[oi]:!!e.parent};return(0,it.u)("div",{key:e.layer.uid,class:this.classes(li,r)},(0,it.u)("div",{class:gi},(0,it.u)("div",{class:ri},e.title)),(0,it.u)("div",{class:si},n))}}_renderLegendForElement(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r="color-ramp"===e.type,s="opacity-ramp"===e.type,l="size-ramp"===e.type,a=t.layer;let o=null;if("string"==typeof e.title)o=e.title;else if(e.title){const t=e.title,i=zt(this.messages,t,r||s);o=t.title?`${t.title} (${i})`:i}const c=this._getSectionName(a,e,i),u=this._hasIndicators?(0,it.u)("div",null,(0,it.u)(Bt.X6,{level:this.headingLevel,class:jt},t.title),(0,it.u)(Bt.X6,{level:(0,Bt.MJ)(this.headingLevel),class:Qt},o)):o?(0,it.u)(Bt.X6,{level:this.headingLevel,class:Qt},o):null,d=t.effectList;let h=null;if("symbol-table"===e.type){const i=e.infos.map(((i,n)=>this._renderLegendForElementInfo(i,t,e.legendType,n))).filter((e=>!!e));if(i.length){const e=i[0].properties.classes&&i[0].properties.classes[di],t={[mi]:!e&&!n,[pi]:n};h=(0,it.u)("div",{class:this.classes(t)},i)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?h=this._renderLegendForRamp(e,a.opacity,d):l?h=this._renderSizeRamp(e,a.opacity):"pie-chart-ramp"===e.type?h=this._renderPieChartRamp(e):"relationship-ramp"===e.type?h=bt(e,this.id,a.opacity,d):"univariate-above-and-below-ramp"===e.type?h=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,d):"univariate-color-size-ramp"===e.type&&(h=this._renderUnivariateColorSizeRamp(e,a.opacity,d));if(!h)return null;const y=(0,it.u)("div",{key:c,class:ni,id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[u,h]);return this._sectionMap.set(c,y),y}_renderPieChartRamp(e){return(0,it.u)("div",{class:wi,bind:e.preview,afterCreate:Ot})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:n,colorRampElement:r}=Mt(e,t,"horizontal");if(!n)return null;const s=Rt(n,"full",!0,"horizontal"),l=Tt(n,"above",!0,"horizontal"),a=Tt(n,"below",!0,"horizontal"),o=Ft(r,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i}),c=Ft(r,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i}),u=Vt(n,"card"),d=n.infos.map((e=>e.label)),h=d.length-1,y=d.map(((e,t)=>0===t||t===h?(0,it.u)("div",{key:t},e):null)),f={marginTop:"3px",display:"flex"};(0,Y.dZ)(this.container)?f.marginRight=`${u}px`:f.marginLeft=`${u}px`;const p={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,it.u)("div",{class:Kt,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,it.u)("div",{class:this.classes(bi,Li),styles:{display:"flex",flexDirection:"row"}},n.infos.map(((e,t)=>(0,it.u)("div",{key:t,class:ci,bind:e.preview,afterCreate:Ot})))),o?(0,it.u)("div",{class:Ci,styles:f,key:"color-ramp-preview"},(0,it.u)("div",{bind:o,afterCreate:Ot}),(0,it.u)("div",{bind:c,afterCreate:Ot})):null,(0,it.u)("div",{class:Ii},(0,it.u)("div",{class:Si,styles:p},y)))}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:n,colorRampElement:r}=kt(e,"horizontal");if(!n)return null;const s=Rt(n,"full",!1,"horizontal"),l=Ft(r,{width:Tt(n,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i}),a=Vt(n,"card"),o=n.infos.length-1,c=n.infos.map(((e,t)=>0===t||t===o?(0,it.u)("div",{key:t},e.label):null)),u={marginTop:"3px",display:"flex"};(0,Y.dZ)(this.container)?u.marginRight=`${a}px`:u.marginLeft=`${a}px`;const d={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,it.u)("div",{class:Kt,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,it.u)("div",{class:this.classes(bi,Li),styles:{display:"flex",flexDirection:"row"}},n.infos.map(((e,t)=>(0,it.u)("div",{key:t,class:ci,bind:e.preview,afterCreate:Ot})))),(0,it.u)("div",{class:Ci,styles:u,key:"color-ramp-preview"},(0,it.u)("div",{bind:l,afterCreate:Ot})),(0,it.u)("div",{class:Ii},(0,it.u)("div",{class:Si,styles:d},c)))}_renderLegendForElementInfo(e,t,i,n){const r=t.layer;if(e.type)return this._renderLegendForElement(e,t,n);const s=Dt(r,i);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,it.u)("div",{key:n,bind:e.preview,afterCreate:Ot});const t={[hi]:this._hasIndicators};return(0,it.u)("div",{key:n,class:this.classes(Kt,{[di]:this._hasIndicators})},(0,it.u)("div",{class:this.classes(t),bind:e.preview,afterCreate:Ot}),(0,it.u)("div",{class:this.classes(Jt,{[ei]:this._hasIndicators})},zt(this.messages,e.label,!1)||""))}let i=255,s=255,l=255,a=0,o=255,c=255,u=255,d=0;const h=e.symbol.color&&e.symbol.color.a,y=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;h&&(i=e.symbol.color.r,s=e.symbol.color.g,l=e.symbol.color.b,a=e.symbol.color.a*r.opacity),y&&(o=e.symbol.outline.color.r,c=e.symbol.outline.color.g,u=e.symbol.outline.color.b,d=e.symbol.outline.color.a*r.opacity);const f=e.symbol.color?.isBright??!0,p=f?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",m={background:h?`rgba(${i}, ${s}, ${l}, ${a})`:"none",color:f?"black":"white",textShadow:`-1px -1px 0 ${p},\n                                              1px -1px 0 ${p},\n                                              -1px 1px 0 ${p},\n                                              1px 1px 0 ${p}`,border:y?`1px solid rgba(${o}, ${c}, ${u}, ${d})`:"none",filter:(0,N.wJ)(t.effectList)};return(0,it.u)("div",{key:n,class:Kt},(0,it.u)("div",{class:Xt,styles:m}," ",e.label," "))}if(e.src){const t=this._renderImage(e,r,s);return(0,it.u)("div",{key:n,class:Kt},t,(0,it.u)("div",{class:Jt},e.label||""))}}_renderImage(e,t,i){const{label:n,src:r,opacity:s}=e,l={[Yt]:i,[ci]:!i},a={opacity:`${null!=s?s:t.opacity}`};return(0,it.u)("img",{alt:zt(this.messages,n,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:a})}_renderSizeRampLines(e){const t=e.infos,i=t[0],n=t[t.length-1],r=i.symbol,s=this._hasIndicators,l=(0,w.F2)(i.size+i.outlineSize)*Ai,a=(0,w.F2)(n.size+n.outlineSize)*Ai,o=s?l:l+50*Ai,c=s?l/2+50*Ai:l,u=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===i||"cone"===i||"tetrahedron"===i}return"triangle"===e.style}}(r),d=function(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1),n=i.resource&&i.resource.primitive;return"circle"===n||"cross"===n||"kite"===n||"sphere"===n||"cube"===n||"diamond"===n}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(r),h=document.createElement("canvas");h.width=o,h.height=c,h.style.width=h.width/Ai+"px",h.style.height=h.height/Ai+"px";const y=h.getContext("2d");if(s){y.beginPath();const e=0,t=0,i=o/2-a/2,n=c;y.moveTo(e,t),y.lineTo(i,n);const r=o,s=0,l=o/2+a/2,u=c;y.moveTo(r,s),y.lineTo(l,u)}else{y.beginPath();const e=0,t=c/2-a/2,i=o,n=0;y.moveTo(e,t),y.lineTo(i,n);const r=0,s=c/2+a/2,l=o,u=c;y.moveTo(r,s),y.lineTo(l,u)}return y.strokeStyle="#ddd",y.stroke(),(0,it.u)("div",{bind:h,afterCreate:Ot,styles:s?{display:"flex",marginTop:`-${u?0:d?l/2:0}px`,marginBottom:`-${u?a:d?a/2:0}px`}:{display:"flex",marginRight:`-${u?0:d?l/2:0}px`,marginLeft:`-${u?0:d?a/2:0}px`}})}_renderSizeRamp(e,t){const i=e.infos,n=i[0].label,r=i[i.length-1].label;let s=i[0].preview,l=i[i.length-1].preview;const a=this._hasIndicators,o={"flex-direction":a?"column":"row-reverse"};s&&(s=s.cloneNode(!0),s.style.display="flex"),l&&(l=l.cloneNode(!0),l.style.display="flex");const c={opacity:null!=t?`${t}`:""};return(0,it.u)("div",{class:this.classes(Kt,{[ui]:a})},(0,it.u)("div",{class:ii},a?n:r),(0,it.u)("div",{class:vi,styles:o},(0,it.u)("div",{bind:s,afterCreate:Ot,class:_i,styles:c}),this._renderSizeRampLines(e),(0,it.u)("div",{bind:l,afterCreate:Ot,class:vi,styles:c})),(0,it.u)("div",{class:ii},a?r:n))}_renderLegendForRamp(e,t,i){const n=e.infos,r="heatmap-ramp"===e.type,s=n.length-1,l=25,a=s>2&&!r?25*s:100,o=a+20,c=10,u=n.slice(0).reverse();u.forEach(((e,t)=>{e.offset=r?e.ratio:t/s}));const d=u.length-1,h=u.length%2!=0&&u[u.length/2|0],y=h&&(0,it.u)("div",{class:fi},(0,it.u)("div",{class:Gt},"|"),(0,it.u)("div",{class:ii},h.label)),f=n[n.length-1].label,p=n[0].label,m=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:u[0].color,stroke:{width:0}},{shape:{type:"rect",x:c,y:0,width:a,height:l},fill:{type:"linear",x1:c,y1:0,x2:a+c,y2:0,colors:u},stroke:{width:0}},{shape:{type:"path",path:`M${a+c} 0 L${o} 12.5 L${a+c} 25 Z`},fill:u[d].color,stroke:{width:0}}]],g=(0,tt.KB)(m,o,l),{messages:b}=this,v={filter:(0,N.wJ)(i),opacity:null==t?null:`${t}`};return(0,it.u)("div",{class:Kt,styles:{justifyContent:"center"}},(0,it.u)("div",{class:ii},r?b[f]:f),(0,it.u)("div",{class:bi},(0,it.u)("div",{styles:v},g),y),(0,it.u)("div",{class:ii},r?b[p]:p))}};(0,n._)([(0,c.Cb)()],xi.prototype,"activeLayerInfos",void 0),(0,n._)([(0,c.Cb)()],xi.prototype,"headingLevel",void 0),(0,n._)([(0,c.Cb)()],xi.prototype,"layout",void 0),(0,n._)([(0,c.Cb)(),(0,$t.H)("esri/widgets/Legend/t9n/Legend")],xi.prototype,"messages",void 0),(0,n._)([(0,c.Cb)(),(0,$t.H)("esri/t9n/common")],xi.prototype,"messagesCommon",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],xi.prototype,"type",void 0),(0,n._)([(0,c.Cb)()],xi.prototype,"view",void 0),(0,n._)([(0,Ut.h)()],xi.prototype,"_selectSection",null),xi=(0,n._)([(0,u.j)("esri.widgets.Legend.styles.Card")],xi);const Vi=xi,Fi="esri-legend__service",Ri="esri-legend__service-label",Ti="esri-legend__layer",Mi="esri-legend__group-layer",ki="esri-legend__group-layer-child",Ni="esri-legend__layer-table",Oi="esri-legend__layer-table--size-ramp",zi="esri-legend__layer-child-table",Pi="esri-legend__layer-caption",Di="esri-legend__layer-body",Bi="esri-legend__layer-row",Ui="esri-legend__layer-cell esri-legend__layer-cell--info",$i="esri-legend__imagery-layer-image--stretched",qi="esri-legend__imagery-layer-info--stretched",Hi="esri-legend__layer-cell esri-legend__layer-cell--symbols",Zi="esri-legend__symbol",ji="esri-legend__ramps",Wi="esri-legend__size-ramp",Gi="esri-legend__color-ramp",Yi="esri-legend__opacity-ramp",Ji="esri-legend__ramp-labels",Qi="esri-legend__ramp-label",Xi="esri-univariate-above-and-below-ramp__label",Ki="esri-legend__message",en="esri-widget__heading",tn={display:"flex",alignItems:"flex-start"},nn={marginLeft:"3px"},rn={display:"table-cell",verticalAlign:"middle"};let sn=class extends d.Z{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return(0,it.u)("div",null,t&&t.length?t:(0,it.u)("div",{class:Ki},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,i=`esri-legend__${e.layer.uid}-version-${e.version}`,n=e.title?(0,Bt.X6)({level:this.headingLevel,class:this.classes(en,Ri)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return(0,it.u)("div",{key:i,class:this.classes(Fi,Mi)},n,t)}{const t=e.legendElements;if(t&&!t.length)return null;const r=t.map((t=>this._renderLegendForElement(t,e.layer,e.effectList))).filter((e=>!!e));if(!r.length)return null;const s={[ki]:!!e.parent};return(0,it.u)("div",{key:i,class:this.classes(Fi,s),tabIndex:0},n,(0,it.u)("div",{class:Ti},r))}}_renderLegendForElement(e,t,i,n){const r="color-ramp"===e.type,s="opacity-ramp"===e.type,l="size-ramp"===e.type;let a=null;if("symbol-table"===e.type||l){const n=e.infos.map((n=>this._renderLegendForElementInfo(n,t,i,l,e.legendType))).filter((e=>!!e));n.length&&(a=(0,it.u)("div",{class:Di},n))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?a=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?a=bt(e,this.id,t.opacity,i):"pie-chart-ramp"===e.type?a=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i):"univariate-color-size-ramp"===e.type&&(a=this._renderUnivariateColorSizeRamp(e,t.opacity,i));if(!a)return null;const o=e.title;let c=null;if("string"==typeof o)c=o;else if(o){const e=zt(this.messages,o,r||s);c=Pt(0,r||s)&&o.title?`${o.title} (${e})`:e}const u=n?zi:Ni,d=c?(0,it.u)("div",{class:Pi},c):null,h={[Oi]:l||!n};return(0,it.u)("div",{class:this.classes(u,h)},d,a)}_renderPieChartRamp(e){return(0,it.u)("div",{bind:e.preview,afterCreate:Ot})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:n,colorRampElement:r}=Mt(e,t);if(!n)return null;const s=Tt(n,"above",!0),l=Tt(n,"below",!0),a=Ft(r,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:i}),o=Ft(r,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"below",effectList:i}),c=Vt(n),u=n.infos.map((e=>e.label)),d=u.map(((e,t)=>{const i=2===t;return 0===t?(0,it.u)("div",{key:t,class:e?a?Xi:Qi:null},e):i?(0,it.u)("div",null):null})),h=u.length-1,y=Math.floor(u.length/2),f=u.map(((e,t)=>t===y||t===h?(0,it.u)("div",{key:t,class:e?a?Xi:Qi:null},e):null)),p={display:"table-cell",verticalAlign:"middle"},m={marginTop:`${c}px`},g={height:`${s}px`},b={height:`${l}px`};return(0,it.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:tn},(0,it.u)("div",{class:Di},n.infos.map(((e,t)=>(0,it.u)("div",{class:this.classes(Bi,Wi)},(0,it.u)("div",{class:Zi,styles:p,bind:e.preview,afterCreate:Ot}),a||t%2!=0?null:(0,it.u)("div",{class:Ui},u[t]))))),a?(0,it.u)("div",{styles:m,key:"color-ramp-preview"},(0,it.u)("div",{styles:nn},(0,it.u)("div",{styles:rn},(0,it.u)("div",{class:ji,bind:a,afterCreate:Ot})),(0,it.u)("div",{styles:rn},(0,it.u)("div",{class:Ji,styles:g},d))),(0,it.u)("div",{styles:nn},(0,it.u)("div",{styles:rn},(0,it.u)("div",{class:ji,bind:o,afterCreate:Ot})),(0,it.u)("div",{styles:rn},(0,it.u)("div",{class:Ji,styles:b},f)))):null)}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:n,colorRampElement:r}=kt(e);if(!n)return null;const s=Vt(n),l=Tt(n,"full",!1),a=Ft(r,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"full",effectList:i}),o=n.infos.length-1,c=n.infos.map(((e,t)=>0===t||t===o?(0,it.u)("div",{key:t,class:e.label?r?Xi:Qi:null},e.label):null)),u={display:"table-cell",verticalAlign:"middle"},d={marginTop:`${s}px`},h={height:`${l}px`};return(0,it.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:tn},(0,it.u)("div",{class:Di},n.infos.map((e=>(0,it.u)("div",{class:this.classes(Bi,Wi)},(0,it.u)("div",{class:Zi,styles:u,bind:e.preview,afterCreate:Ot}))))),(0,it.u)("div",{styles:d,key:"color-ramp-preview"},(0,it.u)("div",{styles:nn},(0,it.u)("div",{styles:rn},(0,it.u)("div",{class:ji,bind:a,afterCreate:Ot})),(0,it.u)("div",{styles:rn},(0,it.u)("div",{class:Ji,styles:h},c)))))}_renderLegendForRamp(e,t){const i=e.infos,n="opacity-ramp"===e.type,r="heatmap-ramp"===e.type,s="stretch-ramp"===e.type,l=e.preview,a=n?Yi:"";l.className=`${Gi} ${a}`,null!=t&&(l.style.opacity=t.toString());const o=i.map((e=>(0,it.u)("div",{class:e.label?Qi:null},r?this.messages[e.label]||e.label:s?this._getStretchStopLabel(e):e.label))),c={width:"24px"},u={height:l.style.height};return(0,it.u)("div",{class:Bi},(0,it.u)("div",{class:Hi,styles:c},(0,it.u)("div",{class:ji,bind:l,afterCreate:Ot})),(0,it.u)("div",{class:Ui},(0,it.u)("div",{class:Ji,styles:u},o)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,he.uf)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,i,n,r){if(e.type)return this._renderLegendForElement(e,t,i,!0);let s=null;const l=Dt(t,r);if(e.preview?s=(0,it.u)("div",{class:Zi,bind:e.preview,afterCreate:Ot}):e.src&&(s=this._renderImage(e,t,l)),!s)return null;const a={[qi]:l},o={[qi]:l,[Wi]:!l&&n};return(0,it.u)("div",{class:Bi},(0,it.u)("div",{class:this.classes(Hi,o)},s),(0,it.u)("div",{class:this.classes(Ui,a)},zt(this.messages,e.label,!1)||""))}_renderImage(e,t,i){const{label:n,src:r,opacity:s}=e,l={[$i]:i,[Zi]:!i},a={opacity:`${null!=s?s:t.opacity}`};return(0,it.u)("img",{alt:zt(this.messages,n,!1),src:r,border:0,width:e.width,height:e.height,class:this.classes(l),styles:a})}};(0,n._)([(0,c.Cb)()],sn.prototype,"activeLayerInfos",void 0),(0,n._)([(0,c.Cb)()],sn.prototype,"headingLevel",void 0),(0,n._)([(0,c.Cb)(),(0,$t.H)("esri/widgets/Legend/t9n/Legend")],sn.prototype,"messages",void 0),(0,n._)([(0,c.Cb)({readOnly:!0})],sn.prototype,"type",void 0),sn=(0,n._)([(0,u.j)("esri.widgets.Legend.styles.Classic")],sn);const ln=sn,an="esri-legend",on="esri-widget",cn="esri-widget--panel",un="esri-icon-layer-list";let dn=class extends d.Z{constructor(e,t){super(e,t),this._handles=new r.Z,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=un,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new ln,this.view=null,this.viewModel=new et}initialize(){this.own([(0,l.on)((()=>this.view),"resize",(()=>this.scheduleRender())),(0,l.on)((()=>this.activeLayerInfos),"change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),(0,l.YP)((()=>this.headingLevel),(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),(0,l.YP)((()=>this.style),((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)}),l.nn)])}destroy(){this._handles=(0,s.SC)(this._handles)}castStyle(e){if(e instanceof Vi||e instanceof ln)return e;if("string"==typeof e)return"card"===e?new Vi:new ln;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,new("card"===e.type?Vi:ln)(t)}return new ln}render(){return(0,it.u)("div",{class:this.classes(an,on,this.style instanceof ln?cn:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=(0,l.YP)((()=>e.version),(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const i=(0,l.on)((()=>e.children),"change",(()=>e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))),l.nn);this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};(0,n._)([(0,a.B)("viewModel.activeLayerInfos")],dn.prototype,"activeLayerInfos",void 0),(0,n._)([(0,a.B)("viewModel.basemapLegendVisible")],dn.prototype,"basemapLegendVisible",void 0),(0,n._)([(0,a.B)("viewModel.groundLegendVisible")],dn.prototype,"groundLegendVisible",void 0),(0,n._)([(0,c.Cb)()],dn.prototype,"headingLevel",void 0),(0,n._)([(0,a.B)("viewModel.hideLayersNotInCurrentView")],dn.prototype,"hideLayersNotInCurrentView",void 0),(0,n._)([(0,a.B)("viewModel.keepCacheOnDestroy")],dn.prototype,"keepCacheOnDestroy",void 0),(0,n._)([(0,a.B)("viewModel.respectLayerVisibility")],dn.prototype,"respectLayerVisibility",void 0),(0,n._)([(0,c.Cb)()],dn.prototype,"iconClass",void 0),(0,n._)([(0,c.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],dn.prototype,"label",void 0),(0,n._)([(0,a.B)("viewModel.layerInfos")],dn.prototype,"layerInfos",void 0),(0,n._)([(0,c.Cb)(),(0,$t.H)("esri/widgets/Legend/t9n/Legend")],dn.prototype,"messages",void 0),(0,n._)([(0,c.Cb)()],dn.prototype,"style",void 0),(0,n._)([(0,o.p)("style")],dn.prototype,"castStyle",null),(0,n._)([(0,a.B)("viewModel.view")],dn.prototype,"view",void 0),(0,n._)([(0,c.Cb)()],dn.prototype,"viewModel",void 0),dn=(0,n._)([(0,u.j)("esri.widgets.Legend")],dn);const hn=dn},226:(e,t,i)=>{i.d(t,{NA:()=>c,QQ:()=>u,fD:()=>d,pO:()=>a});var n=i(51995),r=i(75434);const s=new n.Z([64,64,64]);function l(e,t){const i=[],n=e.length-1;return 5===e.length?i.push(0,2,4):i.push(0,n),e.map(((e,s)=>i.includes(s)?(0,r.MN)(e,s,n,t):null))}async function a(e,t,n){let r=!1,s=[],a=[];if(e.stops){const t=e.stops;s=t.map((e=>e.value)),r=t.some((e=>!!e.label)),r&&(a=t.map((e=>e.label)))}const c=s[0],u=s[s.length-1];if(null==c&&null==u)return null;const d=r?null:l(s,n);return(await Promise.all(s.map((async(n,s)=>({value:n,color:"opacity"===e.type?await o(n,e,t):(await Promise.resolve().then(i.bind(i,56011))).getColor(e,n),label:r?a[s]:d[s]}))))).reverse()}async function o(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s;const l=new n.Z(r),a=(await Promise.resolve().then(i.bind(i,56011))).getOpacity(t,e);return null!=a&&(l.a=a),l}function c(e){let t=!1,i=[],n=[];i=e.map((e=>e.value)),t=e.some((e=>!!e.label)),t&&(n=e.map((e=>e.label)));const r=i[0],s=i[i.length-1];if(null==r&&null==s)return null;const a=t?null:l(i,!1);return i.map(((i,r)=>({value:i,color:u(i,e),label:t?n[r]:a[r]}))).reverse()}function u(e,t){const{startIndex:i,endIndex:r,weight:s}=function(e,t){let i=0,n=t.length-1;return t.some(((t,r)=>e<t.value?(n=r,!0):(i=r,!1))),{startIndex:i,endIndex:n,weight:(e-t[i].value)/(t[n].value-t[i].value)}}(e,t);if(i===r)return t[i].color;const l=n.Z.blendColors(t[i].color,t[r].color,s);return new n.Z(l)}function d(e,t){let i=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach(((r,s)=>{0===s?i.push({value:t.max,color:new n.Z(r.toColor),label:"high"}):i.push({value:null,color:new n.Z(r.toColor),label:""}),s===e.colorRamps.length-1?i.push({value:t.min,color:new n.Z(r.fromColor),label:"low"}):i.push({value:null,color:new n.Z(r.fromColor),label:""})}));else{let r,s;e&&"algorithmic"===e.type?(r=e.fromColor,s=e.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:t.max,color:new n.Z(s),label:"high"},{value:t.min,color:new n.Z(r),label:"low"}]}return i}},40778:(e,t,i)=>{i.d(t,{h:()=>r});var n=i(6711);function r(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter((e=>e.color?.a>0));let i=t.length-1;if(t&&t[0]){const e=t[i];e&&1!==e.ratio&&(t.push(new n.Z({ratio:1,color:e.color})),i++)}return t.map(((t,n)=>{let r="";return 0===n?r=e.legendOptions?.minLabel||"low":n===i&&(r=e.legendOptions?.maxLabel||"high"),{color:t.color,label:r,ratio:t.ratio}})).reverse()}},75434:(e,t,i)=>{i.d(t,{Eh:()=>a,MN:()=>c,jb:()=>d,uY:()=>u,y$:()=>h,zZ:()=>l});i(51508);var n=i(76969),r=i(4075),s=i(16851);const l="<",a=">",o=(0,n.Ze)("short-date");function c(e,t,i,s){let c="";0===t?c=`${l} `:t===i&&(c=`${a} `);let u=null;return u=s?(0,n.p6)(e,o):(0,r.WU)(e),c+u}const u=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function d(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find((e=>"color"===e.type));if(!t)return null;let n=null,r=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;n=t.stops[0].value,r=t.stops[t.stops.length-1].value}const s=n+(r-n)/2,{getColor:l}=await Promise.resolve().then(i.bind(i,56011));return l(t,s)}async function h(e,t){const i=e.trailCap,n=e.trailWidth||1,r=t||await d(e)||e.color;return new s.Z({cap:i,color:r,width:n})}},96919:(e,t,i)=>{i.d(t,{MJ:()=>c,X6:()=>a});var n=i(16889),r=i(80975),s=i(67005);const l="esri-widget__heading";function a(e,t){const i=o(e.level),n=`h${i}`;return delete e.level,(0,s.u)(n,{...e,class:(0,r.Sh)(l,e.class),role:"heading","aria-level":String(i)},t)}function o(e){return(0,n.uZ)(Math.ceil(e),1,6)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return o(e+t)}}}]);
//# sourceMappingURL=3070.47d777e5.chunk.js.map