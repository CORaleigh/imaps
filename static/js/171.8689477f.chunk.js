(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[171],{1047:function(e,t,r){"use strict";var a=r(82),n=(r(80),r(81),r(88),r(85)),i=r(84),o=(r(83),r(86),r(87),r(167)),s=class extends o.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};Object(a.a)([Object(n.b)({readOnly:!0})],s.prototype,"supportsTileUpdates",null),Object(a.a)([Object(n.b)({constructOnly:!0})],s.prototype,"remoteClient",void 0),Object(a.a)([Object(n.b)({constructOnly:!0})],s.prototype,"service",void 0),Object(a.a)([Object(n.b)()],s.prototype,"spatialReference",null),Object(a.a)([Object(n.b)({constructOnly:!0})],s.prototype,"tileInfo",void 0),Object(a.a)([Object(n.b)({constructOnly:!0})],s.prototype,"tileStore",void 0);var c=s=Object(a.a)([Object(i.a)("esri.views.2d.layers.features.processors.BaseProcessor")],s);t.a=c},1204:function(e,t,r){"use strict";r.r(t);var a=r(91),n=r(7),i=r(82),o=(r(80),r(89)),s=(r(81),r(88),r(85),r(84)),c=(r(83),r(86),r(87),r(317)),l=r(122),d=r(916),u=r(521),f=r(1047);class h{constructor(e,t){this.offset=e,this.extent=t}}var p=class extends f.a{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(e,t){var r=this;return Object(n.a)((function*(){var a=t.schema.processors[0];"heatmap"===a.type&&Object(c.a)(r._schema,a)&&(e.mesh=!0,r._schema=a)}))()}onTileUpdate(e){for(var t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}onTileMessage(e,t,r){var i=this;return Object(n.a)((function*(){i._tileKeyToFeatureSets.has(e.key.id)||i._tileKeyToFeatureSets.set(e.key.id,new Map);var n=i._tileKeyToFeatureSets.get(e.key.id);if(Object(o.k)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&n.set(t.addOrUpdate.instance,t),t.end){var s=[],c=function(e){var t=e.key,r=new Map,a=256,n=l.E,i=e.tileInfoView.tileInfo.isWrappable;return r.set(Object(u.a)(t,-1,-1,i).id,new h([-n,-n],[n-a,n-a,n,n])),r.set(Object(u.a)(t,0,-1,i).id,new h([0,-n],[0,n-a,n,n])),r.set(Object(u.a)(t,1,-1,i).id,new h([n,-n],[0,n-a,a,n])),r.set(Object(u.a)(t,-1,0,i).id,new h([-n,0],[n-a,0,n,n])),r.set(Object(u.a)(t,1,0,i).id,new h([n,0],[0,0,a,n])),r.set(Object(u.a)(t,-1,1,i).id,new h([-n,n],[n-a,0,n,a])),r.set(Object(u.a)(t,0,1,i).id,new h([0,n],[0,0,n,a])),r.set(Object(u.a)(t,1,1,i).id,new h([n,n],[0,0,a,a])),r}(e);i._tileKeyToFeatureSets.forEach(((t,r)=>{if(r===e.key.id)t.forEach((e=>Object(o.b)(e.addOrUpdate,(e=>s.push(e)))));else if(c.has(r)){var a=c.get(r),[n,i]=a.offset;t.forEach((e=>Object(o.b)(e.addOrUpdate,(e=>{var t=e.transform(n,i,1,1);s.push(t)}))))}}));var f=Object(d.a)(s,i._schema.mesh,512,512),p={tileKey:e.key.id,intensityInfo:f},b=[f.matrix];return i.remoteClient.invoke("tileRenderer.onTileData",p,Object(a.a)(Object(a.a)({},r),{},{transferList:b}))}}))()}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}},b=p=Object(i.a)([Object(s.a)("esri.views.2d.layers.features.processors.HeatmapProcessor")],p);t.default=b},521:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r(430);function a(e,t,r,a){var n=e.clone(),i=1<<n.level,o=n.col+t,s=n.row+r;return a&&o<0?(n.col=o+i,n.world-=1):o>=i?(n.col=o-i,n.world+=1):n.col=o,n.row=s,n}},916:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i}));var a=r(158),n=r(110),i=(()=>{if(!("document"in a.a))return()=>null;var e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,r=>{t.clearRect(0,0,1,e.height);var a=t.createLinearGradient(0,0,0,e.height);for(var{ratio:n,color:i}of r.colorStops)a.addColorStop(Math.max(n,.001),"rgba(".concat(i[0],", ").concat(i[1],", ").concat(i[2],", ").concat(i[3],")"));return t.fillStyle=a,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function o(e,t,r,a){var n,{blurRadius:i,fieldOffset:o,field:s}=t,l=new Float64Array(r*a),d=c(i),u=Math.round(3*i),f=Number.NEGATIVE_INFINITY,h=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(s,o),p=new Set;for(var b of e)for(var y=b.getCursor();y.next();){var v=y.getObjectId();if(!p.has(v)){p.add(v);var O=y.readLegacyPointGeometry(),j=128;if(!(O.x<-128||O.x>=r+j||O.y<-128||O.y>a+j))for(var m=+h(y),w=Math.round(O.x)-u,g=Math.round(O.y)-u,M=Math.max(0,w),T=Math.max(0,g),x=Math.min(a,Math.round(O.y)+u),S=Math.min(r,Math.round(O.x)+u),k=T;k<x;k++)for(var U=d[k-g],I=M;I<S;I++){var F=d[I-w];(n=l[k*r+I]+=U*F*m)>f&&(f=n)}}}return{matrix:l.buffer,max:f}}function s(e,t,r,a,i,o){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);var s=e.getImageData(0,0,t,t);r&&a&&s.data.set(new Uint8ClampedArray(function(e,t,r,a,i){for(var o=new Uint32Array(e*e),s=("buffer"in t?t:new Float64Array(t)),c=("buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer)),l=c.length/(i-a),d=0;d<s.length;d++){var u=s[d],f=Math.floor((u-a)*l);o[d]=c[Object(n.d)(f,0,c.length-1)]}return o.buffer}(t,r,a,i,o))),e.putImageData(s,0,0)}function c(e){for(var t=Math.round(3*e),r=2*e*e,a=new Float64Array(2*t+1),n=0;n<=a.length;n++)a[n]=Math.exp(-Math.pow(n-t,2)/r)/Math.sqrt(2*Math.PI)*(e/2);return a}}}]);
//# sourceMappingURL=171.8689477f.chunk.js.map