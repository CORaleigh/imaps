"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[2224],{15909:(e,a,t)=>{t.d(a,{D:()=>n});var r=t(80292);function n(e){e&&e.writtenProperties&&e.writtenProperties.forEach((e=>{let{target:a,propName:t,newOrigin:n}=e;(0,r.l)(a)&&n&&a.originOf(t)!==n&&a.updateOrigin(t,n)}))}},80292:(e,a,t)=>{function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}t.d(a,{l:()=>r})},2224:(e,a,t)=>{t.r(a),t.d(a,{save:()=>C,saveAll:()=>E,saveAs:()=>J});var r=t(63780),n=t(10064),l=t(32718),i=t(92026),s=t(66978),o=t(15909),u=t(16455),y=t(94650),c=t(25899),d=t(37933),f=t(70032),p=t(98995),m=t(32698),w=t(73117);const b=l.Z.getLogger("esri.layers.FeatureLayer"),h="Feature Service";function S(e,a){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${a}`}function v(e,a){if(a.type!==h)throw new n.Z("feature-layer:portal-item-wrong-type",S(e,`should have portal item of type "${h}"`))}async function I(e){if(await e.load(),(0,d.rQ)(e))throw new n.Z("feature-layer:save",S(e,"using an in-memory source cannot be saved to a portal item"))}async function L(e,a,t){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},a);return function(e,a){let t=e.messages.filter((e=>{let{type:a}=e;return"error"===a})).map((e=>{let{name:a,message:t,details:r}=e;return new n.Z(a,t,r)}));if(a?.ignoreUnsupported&&(t=t.filter((e=>{let{name:a}=e;return"layer:unsupported"!==a&&"symbol:unsupported"!==a&&"symbol-layer:unsupported"!==a&&"property:unsupported"!==a&&"url:unsupported"!==a}))),t.length>0)throw new n.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:t})}(a,t),r}function P(e){const{layer:a,layerJSON:t}=e;return a.isTable?{layers:[],tables:[t]}:{layers:[t],tables:[]}}function g(e){(0,w.qj)(e,w.Kz.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,a,t)=>t.indexOf(e)===a)))}async function O(e,a){return/\/\d+\/?$/.test(e.url)?P(a[0]):async function(e,a){const{layer:{url:t,customParameters:r,apiKey:n}}=a[0];let l=await e.fetchData("json");l&&null!=l.layers&&null!=l.tables||(l=await async function(e,a,t){var r,n;e||(e={}),(r=e).layers||(r.layers=[]),(n=e).tables||(n.tables=[]);const{url:l,customParameters:o,apiKey:c}=a,{serviceJSON:d,layersJSON:f}=await(0,y.fetchFeatureService)(l,{customParameters:o,apiKey:c}),p=T(e.layers,d.layers,t),m=T(e.tables,d.tables,t);e.layers=p.itemResources,e.tables=m.itemResources;const w=[...p.added,...m.added],b=f?[...f.layers,...f.tables]:[];return await async function(e,a,t,r){const n=a.map((e=>{let{id:a}=e;return new u.default({url:t,layerId:a,sourceJSON:r.find((e=>{let{id:t}=e;return t===a}))})}));await(0,s.as)(n.map((e=>e.load()))),n.forEach((a=>{const{layerId:t,loaded:r,defaultPopupTemplate:n}=a;r&&!(0,i.Wi)(n)&&N(a,{id:t,popupInfo:n.toJSON()},e)}))}(e,w,l,b),e}(l,{url:t,customParameters:r,apiKey:n},a.map((e=>e.layer.layerId))));for(const i of a)N(i.layer,i.layerJSON,l);return l}(e,a)}function T(e,a,t){const n=(0,r.e5)(e,a,((e,a)=>e.id===a.id));e=e.filter((e=>!n.removed.some((a=>a.id===e.id))));const l=n.added.map((e=>{let{id:a}=e;return{id:a}}));return l.forEach((a=>{let{id:t}=a;e.push({id:t})})),{itemResources:e,added:l.filter((e=>{let{id:a}=e;return!t.includes(a)}))}}function N(e,a,t){e.isTable?A(t.tables,a):A(t.layers,a)}function A(e,a){const t=e.findIndex((e=>{let{id:t}=e;return t===a.id}));-1===t?e.push(a):e[t]=a}function M(e){const{portalItem:a}=e;return(0,d.y2)(e)&&!e.dynamicDataSource&&!!a?.loaded&&a.type===h}const C=(0,s.Ds)((async function(e,a){await I(e),function(e){const a=e.portalItem;if(!a)throw b.error("save: requires the portalItem property to be set"),new n.Z("feature-layer:portal-item-not-set",S(e,"requires the portalItem property to be set"));if(!a.loaded)throw new n.Z("feature-layer:portal-item-not-loaded",S(e,"cannot be saved to a portal item that does not exist or is inaccessible"));v(e,a)}(e);const t=e.portalItem,r=(0,m.Y)(t),l=await L(e,r,a),i=await O(t,[{layer:e,layerJSON:l}]);return g(t),await t.update({data:i}),(0,o.D)(r),t}));const E=(0,s.Ds)((async(e,a)=>{await async function(e){if(!e?.length)throw new n.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const r of e)if(!M(r))throw new n.Z("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${S(r,"does not conform")}`,{layer:r});const a=e.map((e=>e.portalItem.id));if(new Set(a).size>1)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const t=e.map((e=>e.layerId));if(new Set(t).size!==t.length)throw new n.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const t=e[0].portalItem,r=(0,m.Y)(t),l=await Promise.all(e.map((e=>L(e,r,a)))),i=await O(t,e.map(((e,a)=>({layer:e,layerJSON:l[a]}))));return g(t),await t.update({data:i}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,o.D)(r),t.clone()})),J=(0,s.Ds)((async function(e,a,t){await I(e);const r=function(e,a){var t,r;let n=p.default.from(a);return n.id&&(n=n.clone(),n.id=null),(t=n).type??(t.type=h),(r=n).portal??(r.portal=f.Z.getDefault()),v(e,n),n}(e,a),n=(0,m.Y)(r),l=P({layer:e,layerJSON:await L(e,n,t)});return await async function(e,a){const{url:t,layerId:r,title:n,fullExtent:l,isTable:s}=e,o=(0,c.Qc)(t),u=(0,i.pC)(o)&&"FeatureServer"===o.serverType;a.url=u?t:`${t}/${r}`,a.title||(a.title=n),a.extent=null,!s&&(0,i.pC)(l)&&(a.extent=await(0,w.$o)(l)),(0,w.ck)(a,w.Kz.METADATA),(0,w.ck)(a,w.Kz.MULTI_LAYER),(0,w.qj)(a,w.Kz.SINGLE_LAYER),s&&(0,w.qj)(a,w.Kz.TABLE),g(a)}(e,r),await async function(e,a,t){const r=e.portal;await r._signIn(),await r.user.addItem({item:e,data:a,folder:t?.folder})}(r,l,t),e.portalItem=r,(0,o.D)(n),r}))},94650:(e,a,t)=>{t.r(a),t.d(a,{fetchFeatureService:()=>p,fromUrl:()=>u});var r=t(76200),n=t(10064),l=t(92026),i=t(35995),s=t(25899),o=t(19610);async function u(e){const a=e.properties?.customParameters,r=await async function(e,a){let t=(0,s.Qc)(e);if((0,l.Wi)(t)&&(t=await c(e,a)),(0,l.Wi)(t))throw new n.Z("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:r,sublayer:i}=t;let u;const y={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(r){case"MapServer":u=null!=i?"FeatureLayer":async function(e,a){return(await m(e,{customParameters:a})).tileInfo}(e,a).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":u=m(e,{customParameters:a}).then((e=>{const a=e.tileInfo&&e.tileInfo.format;return e.tileInfo?"LERC"!==a?.toUpperCase()||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":u=m(t.url.path,{customParameters:a}).then((e=>{if(e){if("Voxel"===e?.layerType)return"VoxelLayer";if(e?.layers&&Array.isArray(e.layers)&&e.layers.length>0){const a={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},t=e.layers[0]?.layerType;if(null!=a[t])return a[t]}}return"SceneLayer"}));break;default:u=y[r]}const d={FeatureLayer:!0,SceneLayer:!0},f="FeatureServer"===r,w={parsedUrl:t,Constructor:null,layerOrTableId:f?i:null,sublayerIds:null,tableIds:null},b=await u;if(d[b]&&null==i){const t=await async function(e,a,t){let r,n=!1;if("FeatureServer"===a){const a=await p(e,{customParameters:t});n=!!a.layersJSON,r=a.layersJSON||a.serviceJSON}else r=await m(e,{customParameters:t});const l=r?.layers,i=r?.tables;return{layerIds:l?.map((e=>e.id)).reverse()||[],tableIds:i?.map((e=>e.id)).reverse()||[],layerInfos:n?l:[],tableInfos:n?i:[]}}(e,r,a);f&&(w.sublayerInfos=t.layerInfos,w.tableInfos=t.tableInfos),1!==t.layerIds.length+t.tableIds.length?(w.sublayerIds=t.layerIds,w.tableIds=t.tableIds):f&&(w.layerOrTableId=t.layerIds[0]??t.tableIds[0],w.sourceJSON=t.layerInfos[0]??t.tableInfos[0])}return w.Constructor=await async function(e){return(0,o.T[e])()}(b),w}(e.url,a),i={...e.properties,url:e.url};if(!r.sublayerIds)return null!=r.layerOrTableId&&(i.layerId=r.layerOrTableId,i.sourceJSON=r.sourceJSON),new r.Constructor(i);const u=new(0,(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(6983),t.e(7994)]).then(t.bind(t,65069))).default)({title:r.parsedUrl.title});return function(e,a,t){function r(e,r){const n={...t,layerId:e,sublayerTitleMode:"service-name"};return(0,l.pC)(r)&&(n.sourceJSON=r),new a.Constructor(n)}a.sublayerIds.forEach((t=>{const n=r(t,y(a.sublayerInfos,t));e.add(n)})),a.tableIds.forEach((t=>{const n=r(t,y(a.tableInfos,t));e.tables.add(n)}))}(u,r,i),u}function y(e,a){return e?e.find((e=>e.id===a)):null}async function c(e,a){const t=await m(e,{customParameters:a});let r=null,n=null;const o=t.type;if("Feature Layer"===o||"Table"===o?(r="FeatureServer",n=t.id):"indexedVector"===o?r="VectorTileServer":t.hasOwnProperty("mapName")?r="MapServer":t.hasOwnProperty("bandCount")&&t.hasOwnProperty("pixelSizeX")?r="ImageServer":t.hasOwnProperty("maxRecordCount")&&t.hasOwnProperty("allowGeometryUpdates")?r="FeatureServer":t.hasOwnProperty("streamUrls")?r="StreamServer":d(t)?(r="SceneServer",n=t.id):t.hasOwnProperty("layers")&&d(t.layers?.[0])&&(r="SceneServer"),!r)return null;const u=null!=n?(0,s.DR)(e):null;return{title:(0,l.pC)(u)&&t.name||(0,i.vt)(e),serverType:r,sublayer:n,url:{path:(0,l.pC)(u)?u.serviceUrl:(0,i.mN)(e).path}}}function d(e){return e?.hasOwnProperty("store")&&e.hasOwnProperty("id")&&"number"==typeof e.id}function f(e){return!e.type||"Feature Layer"===e.type}async function p(e,a){let t=await m(e,a);t=t||{},t.layers=t.layers?.filter(f)||[];const r={serviceJSON:t};if(t.currentVersion<10.5)return r;const n=await m(e+"/layers",a);return r.layersJSON={layers:n?.layers?.filter(f)||[],tables:n?.tables||[]},r}async function m(e,a){return(await(0,r.default)(e,{responseType:"json",query:{f:"json",...a?.customParameters,token:a?.apiKey}})).data}},37933:(e,a,t)=>{function r(e){const a=e?.type;return"imagery-tile"===a||"tile"===a||"open-street-map"===a||"vector-tile"===a||"web-tile"===a||"wmts"===a}function n(e){const a=e?.type;return"base-tile"===a||"tile"===a||"elevation"===a||"imagery-tile"===a||"base-elevation"===a||"open-street-map"===a||"wcs"===a||"web-tile"===a||"wmts"===a||"vector-tile"===a}function l(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type}function i(e){return"feature"===e?.type&&"feature-layer"===e.source?.type}function s(e){if(e.activeLayer){const a=e.activeLayer.tileMatrixSet;if(a)return a;const t=e.activeLayer.tileMatrixSets;if(t)return t}return null}t.d(a,{iC:()=>n,mt:()=>s,qq:()=>r,rQ:()=>l,y2:()=>i})},19610:(e,a,t)=>{t.d(a,{T:()=>r});const r={BingMapsLayer:async()=>(await Promise.all([t.e(4226),t.e(5592),t.e(3109),t.e(8897)]).then(t.bind(t,60165))).default,BuildingSceneLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(8597),t.e(4653),t.e(6455),t.e(3470),t.e(2586),t.e(6505)]).then(t.bind(t,66505))).default,CSVLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(8597),t.e(4653),t.e(6455),t.e(5418)]).then(t.bind(t,98435))).default,ElevationLayer:async()=>(await Promise.all([t.e(8995),t.e(1009),t.e(2893),t.e(5964)]).then(t.bind(t,72882))).default,FeatureLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(8597),t.e(4653),t.e(6455),t.e(1321)]).then(t.bind(t,16455))).default,GroupLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(6983),t.e(7994),t.e(3091)]).then(t.bind(t,65069))).default,GeoRSSLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4711)]).then(t.bind(t,70054))).default,GeoJSONLayer:async()=>(await Promise.all([t.e(4226),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(8597),t.e(3743)]).then(t.bind(t,5064))).default,ImageryLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(1009),t.e(5277),t.e(7314),t.e(3406),t.e(4653),t.e(5192),t.e(2927),t.e(5345),t.e(1204),t.e(6261),t.e(374)]).then(t.bind(t,63752))).default,ImageryTileLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9803),t.e(1009),t.e(7314),t.e(2927),t.e(2893),t.e(5345),t.e(394),t.e(1204),t.e(6261),t.e(5602)]).then(t.bind(t,93060))).default,IntegratedMeshLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(9803),t.e(3470),t.e(8884)]).then(t.bind(t,56251))).default,KMLLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(3570)]).then(t.bind(t,13838))).default,LineOfSightLayer:async()=>(await Promise.all([t.e(4226),t.e(9803),t.e(8481)]).then(t.bind(t,33724))).default,MapImageLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(5277),t.e(8597),t.e(9186),t.e(9583),t.e(5139)]).then(t.bind(t,19583))).default,MapNotesLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9803),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(8597),t.e(4653),t.e(6455),t.e(9436)]).then(t.bind(t,33513))).default,OGCFeatureLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(5277),t.e(2841),t.e(8597),t.e(3406),t.e(8716),t.e(5423)]).then(t.bind(t,98701))).default,OpenStreetMapLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1040),t.e(1656)]).then(t.bind(t,31656))).default,PointCloudLayer:async()=>(await Promise.all([t.e(8995),t.e(4055),t.e(3470),t.e(5752)]).then(t.bind(t,9532))).default,RouteLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9803),t.e(9014),t.e(1909),t.e(729),t.e(8953)]).then(t.bind(t,54404))).default,SceneLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9803),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(8597),t.e(4653),t.e(6455),t.e(3470),t.e(2586),t.e(5838)]).then(t.bind(t,5838))).default,StreamLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(5277),t.e(2841),t.e(8152)]).then(t.bind(t,2668))).default,TileLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9014),t.e(5277),t.e(8597),t.e(2893),t.e(9186),t.e(1912)]).then(t.bind(t,42977))).default,UnknownLayer:async()=>(await Promise.all([t.e(8995),t.e(4917)]).then(t.bind(t,74917))).default,UnsupportedLayer:async()=>(await Promise.all([t.e(8995),t.e(8101)]).then(t.bind(t,88101))).default,VectorTileLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(2893),t.e(969),t.e(2642)]).then(t.bind(t,27106))).default,VoxelLayer:async()=>(await Promise.all([t.e(8995),t.e(3470),t.e(9902)]).then(t.bind(t,52560))).default,WebTileLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1040)]).then(t.bind(t,89200))).default,WFSLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(7111),t.e(3798),t.e(9803),t.e(9014),t.e(1009),t.e(5277),t.e(2841),t.e(2622),t.e(4514)]).then(t.bind(t,38566))).default,WMSLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1508),t.e(4055),t.e(3863)]).then(t.bind(t,84227))).default,WMTSLayer:async()=>(await Promise.all([t.e(4226),t.e(8995),t.e(5592),t.e(3109),t.e(1040),t.e(6951)]).then(t.bind(t,46951))).default}},32698:(e,a,t)=>{t.d(a,{Y:()=>i,h:()=>l});var r=t(35995),n=t(70032);function l(e){return{origin:"portal-item",url:(0,r.mN)(e.itemUrl),portal:e.portal||n.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function i(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,r.mN)(e.itemUrl):null,portal:e.portal||n.Z.getDefault(),portalItem:e}}},73117:(e,a,t)=>{t.d(a,{$o:()=>u,Kz:()=>y,_$:()=>s,ck:()=>o,qj:()=>i});var r=t(79803),n=t(78952),l=t(81753);function i(e,a){if(!s(e,a)){const t=e.typeKeywords;t?t.push(a):e.typeKeywords=[a]}}function s(e,a){return!!e.typeKeywords?.includes(a)}function o(e,a){const t=e.typeKeywords;if(t){const e=t.indexOf(a);e>-1&&t.splice(e,1)}}async function u(e){const a=e.clone().normalize();let t;if(a.length>1)for(const r of a)t?r.width>t.width&&(t=r):t=r;else t=a[0];return async function(e){const a=e.spatialReference;if(a.isWGS84)return e.clone();if(a.isWebMercator)return(0,l.Sx)(e);const t=n.Z.WGS84;return await(0,r.iQ)(a,t),(0,r.iV)(e,t)}(t)}const y={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}}}]);
//# sourceMappingURL=2224.f7e16b9c.chunk.js.map