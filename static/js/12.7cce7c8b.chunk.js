(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[12],{124:function(e,t,r){"use strict";function n(e,...t){let r="";for(let n=0;n<t.length;n++)r+=e[n]+t[n];return r+=e[e.length-1],r}r.d(t,"a",(function(){return n})),function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(n||(n={}))},203:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(108),i=r(85),s=r(217),o=r(223),a=r(501);class c{constructor(e,t,r=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(o.c.Texture,this),this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...t},34067===this._descriptor.target?this.setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.c.Texture,this))}release(){this.dispose()}resize(e,t){const r=this._descriptor;r.width===e&&r.height===t||(r.width=e,r.height=t,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null))}setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this.setData(e,t)}setData(e,t=3553){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const n=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES),o=this._descriptor;c._validateTexture(this._context,o),r.pixelStorei(r.UNPACK_ALIGNMENT,o.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.preMultiplyAlpha?1:0);const a=o.pixelFormat;let u=o.internalFormat?o.internalFormat:this._deriveInternalFormat(a,o.dataType);if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let n=e.width,i=e.height;e instanceof HTMLVideoElement&&(n=e.videoWidth,i=e.videoHeight),o.width&&o.height,r.texImage2D(t,0,u,a,o.dataType,e),Object(s.a)(r),o.hasMipmap&&this.generateMipmap(),void 0===o.width&&(o.width=n),void 0===o.height&&(o.height=i)}else{null!=o.width&&null!=o.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&u===r.DEPTH_STENCIL&&(u=r.DEPTH24_STENCIL8);let n=o.width,c=o.height;if(function(e){return Object(i.k)(e)&&"type"in e&&"compressed"===e.type}(e)){const i=Math.round(Math.log(Math.max(n,c))/Math.LN2)+1;o.hasMipmap=o.hasMipmap&&i===e.levels.length;for(let s=0;;++s){const i=e.levels[Math.min(s,e.levels.length-1)];if(r.compressedTexImage2D(t,s,u,n,c,0,i),1===n&&1===c||!o.hasMipmap)break;n=Math.max(1,n>>1),c=Math.max(1,c>>1)}}else if(Object(i.k)(e))r.texImage2D(t,0,u,n,c,0,a,o.dataType,e),Object(s.a)(r),o.hasMipmap&&this.generateMipmap();else for(let e=0;r.texImage2D(t,e,u,n,c,0,a,o.dataType,null),Object(s.a)(r),(1!==n||1!==c)&&o.hasMipmap;++e)n=Math.max(1,n>>1),c=Math.max(1,c>>1)}c._applySamplingMode(r,this._descriptor),c._applyWrapMode(r,this._descriptor),c._applyAnisotropicFilteringParameters(this._context,this._descriptor),Object(s.a)(r),this._context.bindTexture(n,c.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,r,n,i,s,o=3553){s||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,u=this._descriptor,l=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);(t<0||r<0||n>u.width||i>u.height||t+n>u.width||r+i>u.height)&&console.error("An attempt to update out of bounds of the texture!"),a.pixelStorei(a.UNPACK_ALIGNMENT,u.unpackAlignment),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,u.flipped?1:0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u.preMultiplyAlpha?1:0),s instanceof ImageData||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement?a.texSubImage2D(o,e,t,r,u.pixelFormat,u.dataType,s):a.texSubImage2D(o,e,t,r,n,i,u.pixelFormat,u.dataType,s),this._context.bindTexture(l,c.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,c._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,c.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,c._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(c._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(c._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if("webgl"===this._context.webglVersion)return e;if(5126===t)switch(e){case 6408:return 34836;case 6407:return 34837;default:throw new Error("Unable to derive format")}return e}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const r=Object(n.l)(t.width)&&Object(n.l)(t.height);Object(a.a)(e.gl)||r||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let r=t.samplingMode,n=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(n=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(n=9728)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,r),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,n)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var r;const n=e.capabilities.textureFilterAnisotropic;n&&e.gl.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY,null!=(r=t.maxAnisotropy)?r:1)}}c.TEXTURE_UNIT_FOR_UPDATES=0},216:function(e,t,r){"use strict";function n(){return[0,0,0,0]}function i(e){return[e[0],e[1],e[2],e[3]]}function s(e,t,r,n){return[e,t,r,n]}function o(e){const t=[0,0,0,0],r=Math.min(4,e.length);for(let n=0;n<r;++n)t[n]=e[n];return t}function a(e,t){return new Float64Array(e,t,4)}function c(){return[0,0,0,0]}function u(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function d(){return s(0,1,0,0)}function f(){return s(0,0,1,0)}function h(){return s(0,0,0,1)}r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return n})),r.d(t,"f",(function(){return i})),r.d(t,"g",(function(){return s}));const p=[0,0,0,0],m=u(),g=l(),b=d(),v=f(),x=h();Object.freeze({__proto__:null,create:n,clone:i,fromValues:s,fromArray:o,createView:a,zeros:c,ones:u,unitX:l,unitY:d,unitZ:f,unitW:h,ZEROS:p,ONES:m,UNIT_X:g,UNIT_Y:b,UNIT_Z:v,UNIT_W:x})},217:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return c}));var n=r(88),i=r(79);const s=r(80).a.getLogger("esri/views/webgl");const o=!!Object(i.a)("enable-feature:webgl-debug");function a(){return o}function c(){return o}function u(e){if(a()){const t=e.getError();if(t){const r=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),i=(new Error).stack;s.error(new n.a("webgl-error","WebGL error occured",{message:r,stack:i}))}}}},223:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i}));const n=33984;var i;!function(e){e[e.Texture=0]="Texture",e[e.Buffer=1]="Buffer",e[e.VAO=2]="VAO",e[e.Program=3]="Program",e[e.Framebuffer=4]="Framebuffer",e[e.Renderbuffer=5]="Renderbuffer",e[e.COUNT=6]="COUNT"}(i||(i={}));const s=33306},255:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return m}));var n=r(85),i=r(370),s=r(311),o=r(165),a=r(376),c=r(202),u=r(105),l=r(216);class d{constructor(e,t,r){this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(r/this.itemByteSize),this.tickHandle=i.a.before((()=>this.reset()))}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=Object(n.p)(this.tickHandle)),this.itemsPtr=0,this.items=Object(n.p)(this.items),this.buffers=Object(n.p)(this.buffers)}get(){0===this.itemsPtr&&Object(i.a)((()=>{}));const e=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=e;){const e=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let t=0;t<this.itemsPerBuffer;++t)this.items.push(this.itemCreate(e,t*this.itemByteSize));this.buffers.push(e)}return this.items[this.itemsPtr++]}reset(){const e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0}static createVec2f64(e=f){return new d(16,c.c,e)}static createVec3f64(e=f){return new d(24,u.d,e)}static createVec4f64(e=f){return new d(32,l.c,e)}static createMat3f64(e=f){return new d(72,s.a,e)}static createMat4f64(e=f){return new d(128,o.b,e)}static createQuatf64(e=f){return new d(32,a.d,e)}get test(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}const f=4096,h=d.createVec2f64(),p=d.createVec3f64(),m=d.createVec4f64(),g=(d.createMat3f64(),d.createMat4f64()),b=d.createQuatf64()},263:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return h})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return c})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return g}));var n=r(108),i=(r(138),r(136)),s=(r(202),r(105),r(245),r(216));Object(s.e)();class o{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function a(e,t){if(!e){t=t||"assert";const e=new Error(t);throw e.stack&&console.log(e.stack),new o(t)}}function c(e,t,r,n){let i,s=(r[0]-e[0])/t[0],o=(n[0]-e[0])/t[0];s>o&&(i=s,s=o,o=i);let a=(r[1]-e[1])/t[1],c=(n[1]-e[1])/t[1];if(a>c&&(i=a,a=c,c=i),s>c||a>o)return!1;a>s&&(s=a),c<o&&(o=c);let u=(r[2]-e[2])/t[2],l=(n[2]-e[2])/t[2];return u>l&&(i=u,u=l,l=i),!(s>l||u>o)&&(l<o&&(o=l),!(o<0))}function u(e,t,r,n){e[12]=t,e[13]=r,e[14]=n}function l(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function d(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)}function f(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)}function h(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function p(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))}function m(e,t,r=0){const i=Object(n.f)(e,0,x);for(let n=0;n<4;n++)t[r+n]=Math.floor(256*O(i*b[n]))}function g(e,t=0){let r=0;for(let n=0;n<4;n++)r+=e[t+n]*v[n];return r}const b=[1,256,65536,16777216],v=[1/256,1/65536,1/16777216,1/4294967296],x=g(new Uint8ClampedArray([255,255,255,255]));function O(e){return e-Math.floor(e)}function _(e,t,r,n,s){const o=e;0===e[11]?(n[0]=2/(t*o[0]),n[1]=2/(r*o[5]),n[2]=(1+o[12])/o[0],n[3]=(1+o[13])/o[5],Object(i.s)(s,0,1)):(n[0]=-2/(t*o[0]),n[1]=-2/(r*o[5]),n[2]=(1-o[8])/o[0],n[3]=(1-o[9])/o[5],Object(i.s)(s,1,0))}},272:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return c}));var n=r(85),i=r(111),s=r(105),o=r(124);function a(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const r=o.a`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=o.a`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,i=t.sliceHighlightDisabled?o.a`#define highlightSlice(_color_, _pos_) (_color_)`:o.a`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(i)}else{const r=o.a`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(r),e.fragment.code.add(r)}}function c(e,t,r){u(e,t,r.slicePlane,r.origin)}function u(e,t,r,o){t.slicePlaneEnabled&&(Object(n.k)(r)?(o?(Object(i.j)(l,r.origin,o),e.setUniform3fv("slicePlaneOrigin",l)):e.setUniform3fv("slicePlaneOrigin",r.origin),e.setUniform3fv("slicePlaneBasis1",r.basis1),e.setUniform3fv("slicePlaneBasis2",r.basis2)):(e.setUniform3fv("slicePlaneBasis1",s.b),e.setUniform3fv("slicePlaneBasis2",s.b),e.setUniform3fv("slicePlaneOrigin",s.b)))}const l=Object(s.e)()},298:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return c}));var n=r(391),i=r(111),s=r(105),o=r(255);function a(e){return e?{origin:Object(s.c)(e.origin),direction:Object(s.c)(e.direction)}:{origin:Object(s.e)(),direction:Object(s.e)()}}function c(e,t){const r=p.get();return r.origin=e,r.direction=t,r}function u(e,t=a()){return d(e.origin,e.direction,t)}function l(e,t,r=a()){return Object(i.k)(r.origin,e),Object(i.j)(r.direction,t,e),r}function d(e,t,r=a()){return Object(i.k)(r.origin,e),Object(i.k)(r.direction,t),r}function f(e,t){const r=Object(i.g)(o.d.get(),Object(i.r)(o.d.get(),e.direction),Object(i.j)(o.d.get(),t,e.origin));return Object(i.h)(r,r)}function h(e,t,r){const n=Object(i.h)(e.direction,Object(i.j)(r,t,e.origin));return Object(i.f)(r,e.origin,Object(i.e)(r,e.direction,n)),r}const p=new n.a((function(){return{origin:null,direction:null}}))},299:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));const n=r(80).a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class i{constructor(){this.includedModules=new Map}include(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&n.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))}}class s extends i{constructor(){super(...arguments),this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new l,this.extensions=new d,this.constants=new f}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(),i="vertex"===e?this.vertex:this.fragment,s=i.uniforms.generateSource(),o=i.code.generateSource(),a="vertex"===e?p:h,c=this.constants.generateSource().concat(i.constants.generateSource());return`\n${t.join("\n")}\n\n${a}\n\n${c.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${n.join("\n")}\n\n${o.join("\n")}`}}class o{constructor(){this._entries=new Map}add(e,t,r){const n=`${e}_${t}_${r}`;return this._entries.set(n,{name:e,type:t,arraySize:r}),this}generateSource(){return Array.from(this._entries.values()).map((e=>`uniform ${e.type} ${e.name}${(e=>e?`[${e}]`:"")(e.arraySize)};`))}get entries(){return Array.from(this._entries.values())}}class a{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class c extends i{constructor(){super(...arguments),this.uniforms=new o,this.code=new a,this.constants=new f}get builder(){return this}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class l{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class d{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?d.ALLOWLIST_VERTEX:d.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}d.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],d.ALLOWLIST_VERTEX=[];class f{constructor(){this._entries=[]}add(e,t,r){let n="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":n=f.numberToFloatStr(r);break;case"int":n=f.numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${f.numberToFloatStr(r[0])},                            ${f.numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${f.numberToFloatStr(r[0])},                            ${f.numberToFloatStr(r[1])},                            ${f.numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${f.numberToFloatStr(r[0])},                            ${f.numberToFloatStr(r[1])},                            ${f.numberToFloatStr(r[2])},                            ${f.numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${f.numberToIntStr(r[0])},                             ${f.numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${f.numberToIntStr(r[0])},                             ${f.numberToIntStr(r[1])},                             ${f.numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${f.numberToIntStr(r[0])},                             ${f.numberToIntStr(r[1])},                             ${f.numberToIntStr(r[2])},                             ${f.numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${t}(${Array.prototype.map.call(r,(e=>f.numberToFloatStr(e))).join(", ")})`}return this._entries.push(`const ${t} ${e} = ${n};`),this}static numberToIntStr(e){return e.toFixed(0)}static numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const h="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",p="precision highp float;\nprecision highp sampler2D;"},304:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));var n=r(124);function i(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(n.a`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function s(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}},345:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(555),i=r(124);function s(e){e.include(n.a),e.code.add(i.a`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},352:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return c}));var n=r(216),i=r(124);const s=Object(n.g)(1,1,0,1),o=Object(n.g)(1,0,1,1);function a(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",s).add("unoccludedHighlightFlag","vec4",o),e.fragment.code.add(i.a`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function c(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}},359:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));class n{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},360:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(85),i=r(197),s=r(217),o=r(623);class a extends o.a{constructor(e,t,r){super(e,t.generateSource("vertex"),t.generateSource("fragment"),r),this._textures=new Map,this._freeTextureUnits=new i.a({deallocator:null}),this._fragmentUniforms=Object(s.b)()?t.fragmentUniforms.entries:null}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(n.j)(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let r=this._textures.get(t);return null==r?(r=this._allocTextureUnit(e),this._textures.set(t,r)):r.texture=e,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(e,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),Object(n.k)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},364:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return s}));var n=r(124);const i=.1,s=.001;function o(e,t){const r=e.fragment;switch(t.alphaDiscardMode){case 0:r.code.add(n.a`
        #define discardOrAdjustAlpha(color) { if (color.a < ${n.a.float(s)}) { discard; } }
      `);break;case 1:r.code.add(n.a`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:r.uniforms.add("textureAlphaCutoff","float"),r.code.add(n.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(n.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},368:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(85);class i{constructor(e,t,r=(()=>this.dispose())){this.release=r,t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}dispose(){this._program=Object(n.f)(this._program),this._pipeline=this._config=null}reload(e){Object(n.f)(this._program),this._program=this.initializeProgram(e)}get program(){return this._program}get pipeline(){return this._pipeline}get key(){return this._config.key}get configuration(){return this._config}bindPass(e,t){}bindMaterial(e,t){}bindDraw(e,t,r){}bindPipelineState(e){e.setPipelineState(this.pipeline)}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return 4}}},372:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}));var n=r(108);class i{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits.map((()=>0))}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const r of e)t[r]=this[r];return t}}function s(e={}){return(t,r)=>{var i,s;t._parameterNames=null!=(i=t._parameterNames)?i:[],t._parameterNames.push(r);const o=t._parameterNames.length-1,a=e.count||2,c=Math.ceil(Object(n.n)(a)),u=null!=(s=t._parameterBits)?s:[0];let l=0;for(;u[l]+c>16;)l++,l>=u.length&&u.push(0);t._parameterBits=u;const d=u[l],f=(1<<c)-1<<d;u[l]+=c,Object.defineProperty(t,r,{get(){return this[o]},set(e){if(this[o]!==e&&(this[o]=e,this._keyDirty=!0,this._parameterBits[l]=this._parameterBits[l]&~f|+e<<d&f,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+r+" must be boolean or number, got "+typeof e}})}}},377:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]])},384:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return o})),r.d(t,"g",(function(){return i})),r.d(t,"h",(function(){return d}));var n=r(176);const i=Object(n.g)(770,1,771,771),s=Object(n.h)(1,1),o=Object(n.h)(0,771);function a(e){return 2===e?null:1===e?o:s}function c(e){return 2===e?n.d:null}const u=5e5,l={factor:-1,units:-2};function d(e){return e?l:null}function f(e){return 3===e||2===e?513:515}},391:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(85),i=r(370);class s{constructor(e){this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=i.a.before((()=>this.reset())),this.grow()}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=Object(n.p)(this.tickHandle)),this.items=Object(n.p)(this.items)}get(){return 0===this.itemsPtr&&Object(i.a)((()=>{})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]}reset(){const e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*o);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0}grow(){for(let e=0;e<Math.max(8,Math.min(this.items.length,o));e++)this.items.push(this.allocator())}}const o=1024},403:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(124);function i(e){e.code.add(n.a`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},409:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return w})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return S})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return g})),r.d(t,"h",(function(){return j})),r.d(t,"i",(function(){return _}));var n=r(108),i=r(85),s=r(111),o=r(105),a=r(215),c=r(850),u=r(263),l=r(442);const d=Object(a.f)();function f(e,t,r,n,i,s,o){if(!Object(l.e)(t))if(e.boundingInfo){Object(u.a)(0===e.primitiveType);const t=r.tolerance;p(e.boundingInfo,n,i,t,s,o)}else{const t=e.indices.get("position"),r=e.vertexAttributes.get("position");g(n,i,0,t.length/3,t,r,void 0,s,o)}}const h=Object(o.e)();function p(e,t,r,n,o,c){if(Object(i.j)(e))return;const u=function(e,t,r){return Object(s.w)(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}(t,r,h);if(Object(a.y)(d,e.getBBMin()),Object(a.x)(d,e.getBBMax()),Object(i.k)(o)&&o.applyToAabb(d),O(d,t,u,n)){const{primitiveIndices:i,indices:s,position:a}=e,u=i?i.length:s.length/3;if(u>P){const i=e.getChildren();if(void 0!==i){for(let e=0;e<8;++e)void 0!==i[e]&&p(i[e],t,r,n,o,c);return}}g(t,r,0,u,s,a,i,o,c)}}const m=Object(o.e)();function g(e,t,r,n,s,o,a,c,u){if(a)return function(e,t,r,n,s,o,a,c,u){const l=o.data,d=o.stride||o.size,f=e[0],h=e[1],p=e[2],g=t[0]-f,b=t[1]-h,v=t[2]-p;for(let O=r;O<n;++O){const e=a[O];let t=3*e,r=d*s[t++],n=l[r++],o=l[r++],_=l[r];r=d*s[t++];let T=l[r++],w=l[r++],j=l[r];r=d*s[t];let S=l[r++],M=l[r++],y=l[r];Object(i.k)(c)&&([n,o,_]=c.applyToVertex(n,o,_,O),[T,w,j]=c.applyToVertex(T,w,j,O),[S,M,y]=c.applyToVertex(S,M,y,O));const P=T-n,A=w-o,I=j-_,F=S-n,z=M-o,D=y-_,C=b*D-z*v,E=v*F-D*g,L=g*z-F*b,N=P*C+A*E+I*L;if(Math.abs(N)<=Number.EPSILON)continue;const U=f-n,R=h-o,H=p-_,V=U*C+R*E+H*L;if(N>0){if(V<0||V>N)continue}else if(V>0||V<N)continue;const k=R*I-A*H,B=H*P-I*U,q=U*A-P*R,G=g*k+b*B+v*q;if(N>0){if(G<0||V+G>N)continue}else if(G>0||V+G<N)continue;const W=(F*k+z*B+D*q)/N;W>=0&&u(W,x(P,A,I,F,z,D,m),e)}}(e,t,r,n,s,o,a,c,u);const l=o.data,d=o.stride||o.size,f=e[0],h=e[1],p=e[2],g=t[0]-f,b=t[1]-h,v=t[2]-p;for(let O=r,_=3*r;O<n;++O){let e=d*s[_++],t=l[e++],r=l[e++],n=l[e];e=d*s[_++];let o=l[e++],a=l[e++],T=l[e];e=d*s[_++];let w=l[e++],j=l[e++],S=l[e];Object(i.k)(c)&&([t,r,n]=c.applyToVertex(t,r,n,O),[o,a,T]=c.applyToVertex(o,a,T,O),[w,j,S]=c.applyToVertex(w,j,S,O));const M=o-t,y=a-r,P=T-n,A=w-t,I=j-r,F=S-n,z=b*F-I*v,D=v*A-F*g,C=g*I-A*b,E=M*z+y*D+P*C;if(Math.abs(E)<=Number.EPSILON)continue;const L=f-t,N=h-r,U=p-n,R=L*z+N*D+U*C;if(E>0){if(R<0||R>E)continue}else if(R>0||R<E)continue;const H=N*P-y*U,V=U*M-P*L,k=L*y-M*N,B=g*H+b*V+v*k;if(E>0){if(B<0||R+B>E)continue}else if(B>0||R+B<E)continue;const q=(A*H+I*V+F*k)/E;q>=0&&u(q,x(M,y,P,A,I,F,m),O)}}const b=Object(o.e)(),v=Object(o.e)();function x(e,t,r,n,i,o,a){return Object(s.w)(b,e,t,r),Object(s.w)(v,n,i,o),Object(s.g)(a,b,v),Object(s.r)(a,a),a}function O(e,t,r,n){return function(e,t,r,n,i){const s=(e[0]-n-t[0])*r[0],o=(e[3]+n-t[0])*r[0];let a=Math.min(s,o),c=Math.max(s,o);const u=(e[1]-n-t[1])*r[1],l=(e[4]+n-t[1])*r[1];if(c=Math.min(c,Math.max(u,l)),c<0)return!1;if(a=Math.max(a,Math.min(u,l)),a>c)return!1;const d=(e[2]-n-t[2])*r[2],f=(e[5]+n-t[2])*r[2];return c=Math.min(c,Math.max(d,f)),!(c<0)&&(a=Math.max(a,Math.min(d,f)),!(a>c)&&a<i)}(e,t,r,n,1/0)}function _(e,t,r,i,s){let o=(r.screenLength||0)*e.pixelRatio;s&&(o=Object(c.d)(o,i,t,s));const a=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(n.f)(a*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function T(e,t,r){if(!e)return;const n=e.parameters,i=e.paddingPixelsOverride;t.setUniform4f(r,n.divisor,n.offset,n.minPixelSize,i)}function w(e,t){const r=t?w(t):{};for(const n in e){let t=e[n];t&&t.forEach&&(t=M(t)),null==t&&n in r||(r[n]=t)}return r}function j(e,t){let r=!1;for(const n in t){const i=t[n];void 0!==i&&(r=!0,Array.isArray(i)?e[n]=i.slice():e[n]=i)}return r}function S(e,t,r,i,s){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get("position").data,a=e.vertexAttributes.get("size"),c=a&&a.data[0],u=r[0],l=r[1],d=((c+i)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE;for(let h=0;h<o.length-5;h+=3){const e=o[h],t=o[h+1],r=u-e,i=l-t,s=o[h+3]-e,a=o[h+4]-t,c=Object(n.f)((s*r+a*i)/(s*s+a*a),0,1),d=s*c-r,p=a*c-i,m=d*d+p*p;m<f&&(f=m)}f<d*d&&s()}function M(e){const t=[];return e.forEach((e=>t.push(e))),t}const y={multiply:1,ignore:2,replace:3,tint:4},P=1e3},410:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return c}));var n=r(85),i=r(583),s=r(377),o=r(409);class a extends i.a{constructor(e,t){super(),this.type=3,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=s.a,this._params=Object(o.c)(e,t),this.validateParameterValues(this._params)}dispose(){}get params(){return this._params}update(e){return!1}setParameterValues(e){Object(o.h)(this._params,e)&&(this.validateParameterValues(this._params),this.parametersChanged())}validateParameterValues(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}isVisibleInPass(e){return!0}get renderOccluded(){return this.params.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(n.k)(this.materialRepository)&&this.materialRepository.materialChanged(this)}}function c(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}const u={renderOccluded:1}},411:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(124);function i(e,t){t.linearDepth?e.vertex.code.add(n.a`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(n.a`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},425:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a}));var n=r(108),i=r(111),s=r(105);function o(e,t,r){const n=Object(i.h)(e,t)/Object(i.h)(e,e);return Object(i.e)(r,e,n)}function a(e,t){return Object(i.h)(e,t)/Object(i.p)(e)}function c(e,t){const r=Object(i.h)(e,t)/(Object(i.p)(e)*Object(i.p)(t));return-Object(n.b)(r)}function u(e,t,r){Object(i.r)(l,e),Object(i.r)(d,t);const s=Object(i.h)(l,d),o=Object(n.b)(s),a=Object(i.g)(l,l,d);return Object(i.h)(a,r)<0?2*Math.PI-o:o}const l=Object(s.e)(),d=Object(s.e)()},426:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return f})),r.d(t,"f",(function(){return d})),r.d(t,"g",(function(){return l})),r.d(t,"h",(function(){return h})),r.d(t,"i",(function(){return p}));var n=r(108),i=r(391),s=r(111),o=r(105),a=r(255);function c(e){return e?{origin:Object(o.c)(e.origin),vector:Object(o.c)(e.vector)}:{origin:Object(o.e)(),vector:Object(o.e)()}}function u(e,t=c()){return l(e.origin,e.vector,t)}function l(e,t,r=c()){return Object(s.k)(r.origin,e),Object(s.k)(r.vector,t),r}function d(e,t,r=c()){return Object(s.k)(r.origin,e),Object(s.j)(r.vector,t,e),r}function f(e,t){const r=Object(s.j)(a.d.get(),t,e.origin),i=Object(s.h)(e.vector,r),o=Object(s.h)(e.vector,e.vector),c=Object(n.f)(i/o,0,1),u=Object(s.j)(a.d.get(),Object(s.e)(a.d.get(),e.vector,c),r);return Object(s.h)(u,u)}function h(e,t,r){return Object(s.f)(r,e.origin,Object(s.e)(r,e.vector,t))}function p(e,t,r,i,o){const{vector:c,origin:u}=e,l=Object(s.j)(a.d.get(),t,u),d=Object(s.h)(c,l)/Object(s.t)(c);return Object(s.e)(o,c,Object(n.f)(d,r,i)),Object(s.f)(o,o,e.origin)}function m(e,t){if(b(e,function(e,t){const r=x.get();return r.origin=e,r.vector=t,r}(t.origin,t.direction),!1,v)){const{tA:t,pB:r,distance2:n}=v;if(t>=0&&t<=1)return n;if(t<0)return Object(s.l)(e.origin,r);if(t>1)return Object(s.l)(Object(s.f)(a.d.get(),e.origin,e.vector),r)}return null}function g(e,t,r){return!!b(e,t,!0,v)&&(Object(s.k)(r,v.pA),!0)}function b(e,t,r,i){const o=1e-6,c=e.origin,u=Object(s.f)(a.d.get(),c,e.vector),l=t.origin,d=Object(s.f)(a.d.get(),l,t.vector),f=a.d.get(),h=a.d.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],h[0]=d[0]-l[0],h[1]=d[1]-l[1],h[2]=d[2]-l[2],Math.abs(h[0])<o&&Math.abs(h[1])<o&&Math.abs(h[2])<o)return!1;const p=a.d.get();if(p[0]=u[0]-c[0],p[1]=u[1]-c[1],p[2]=u[2]-c[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const m=f[0]*h[0]+f[1]*h[1]+f[2]*h[2],g=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],b=f[0]*p[0]+f[1]*p[1]+f[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],x=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-g*g;if(Math.abs(x)<o)return!1;let O=(m*g-b*v)/x,_=(m+g*O)/v;r&&(O=Object(n.f)(O,0,1),_=Object(n.f)(_,0,1));const T=a.d.get(),w=a.d.get();return T[0]=c[0]+O*p[0],T[1]=c[1]+O*p[1],T[2]=c[2]+O*p[2],w[0]=l[0]+_*h[0],w[1]=l[1]+_*h[1],w[2]=l[2]+_*h[2],i.tA=O,i.tB=_,i.pA=T,i.pB=w,i.distance2=Object(s.l)(T,w),!0}const v={tA:0,tB:0,pA:Object(o.e)(),pB:Object(o.e)(),distance2:0},x=new i.a((()=>({origin:null,vector:null})))},432:function(e,t,r){"use strict";r.d(t,"a",(function(){return v})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return g})),r.d(t,"e",(function(){return T})),r.d(t,"f",(function(){return b}));r(79);var n=r(80),i=r(108),s=r(85),o=r(138),a=r(111),c=r(105),u=r(245),l=r(216),d=r(298),f=r(425),h=r(255);const p=n.a.getLogger("esri.geometry.support.sphere");function m(){return Object(l.e)()}function g(e,t=m()){return Object(u.c)(t,e)}function b(e){return e}function v(e){e[0]=e[1]=e[2]=e[3]=0}function x(e){return Array.isArray(e)?e[3]:e}function O(e){return Array.isArray(e)?e:A}function _(e,t,r){if(Object(s.j)(t))return!1;const n=Object(a.j)(h.d.get(),t.origin,O(e)),i=Object(a.h)(t.direction,t.direction),o=2*Object(a.h)(t.direction,n),c=o*o-4*i*(Object(a.h)(n,n)-e[3]*e[3]);if(c<0)return!1;const u=Math.sqrt(c);let l=(-o-u)/(2*i);const d=(-o+u)/(2*i);return(l<0||d<l&&d>0)&&(l=d),!(l<0)&&(r&&Object(a.f)(r,t.origin,Object(a.e)(h.d.get(),t.direction,l)),!0)}function T(e,t){return _(e,t,null)}function w(e,t,r){const n=h.d.get(),i=h.a.get();Object(a.g)(n,t.origin,t.direction);const s=x(e);Object(a.g)(r,n,t.origin),Object(a.e)(r,r,1/Object(a.p)(r)*s);const c=S(e,t.origin),u=Object(f.a)(t.origin,r);return Object(o.j)(i),Object(o.e)(i,i,u+c,n),Object(a.q)(r,r,i),r}function j(e,t,r){const n=Object(a.j)(h.d.get(),t,O(e)),i=Object(a.e)(h.d.get(),n,e[3]/Object(a.p)(n));return Object(a.f)(r,i,O(e))}function S(e,t){const r=Object(a.j)(h.d.get(),t,O(e)),n=Object(a.p)(r),s=x(e),o=s+Math.abs(s-n);return Object(i.b)(s/o)}const M=Object(c.e)();function y(e,t,r,n){const s=Object(a.j)(M,t,O(e));switch(r){case 0:{const e=Object(i.e)(s,M)[2];return Object(a.w)(n,-Math.sin(e),Math.cos(e),0)}case 1:{const e=Object(i.e)(s,M),t=e[1],r=e[2],o=Math.sin(t);return Object(a.w)(n,-o*Math.cos(r),-o*Math.sin(r),Math.cos(t))}case 2:return Object(a.r)(n,s);default:return}}function P(e,t){const r=Object(a.j)(I,t,O(e));return Object(a.p)(r)-e[3]}const A=Object(c.e)(),I=Object(c.e)();Object.freeze({__proto__:null,create:m,copy:g,fromCenterAndRadius:function(e,t){return Object(l.g)(e[0],e[1],e[2],t)},wrap:b,clear:v,fromRadius:function(e){return e},getRadius:x,getCenter:O,fromValues:function(e,t,r,n){return Object(l.g)(e,t,r,n)},elevate:function(e,t,r){return e!==r&&Object(a.k)(r,e),r[3]=e[3]+t,r},setExtent:function(e,t,r){return p.error("sphere.setExtent is not yet supported"),e===r?r:g(e,r)},intersectRay:_,intersectsRay:T,intersectRayClosestSilhouette:function(e,t,r){if(_(e,t,r))return r;const n=w(e,t,h.d.get());return Object(a.f)(r,t.origin,Object(a.e)(h.d.get(),t.direction,Object(a.m)(t.origin,n)/Object(a.p)(t.direction))),r},closestPointOnSilhouette:w,closestPoint:function(e,t,r){return _(e,t,r)?r:(Object(d.a)(t,O(e),r),j(e,r,r))},projectPoint:j,distanceToSilhouette:function(e,t){const r=Object(a.j)(h.d.get(),t,O(e)),n=Object(a.t)(r),i=e[3]*e[3];return Math.sqrt(Math.abs(n-i))},angleToSilhouette:S,axisAt:y,altitudeAt:P,setAltitudeAt:function(e,t,r,n){const i=P(e,t),s=y(e,t,2,I),o=Object(a.e)(I,s,r-i);return Object(a.f)(n,t,o)}})},433:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return c})),r.d(t,"f",(function(){return l}));var n=r(138),i=r(914);function s(e,t,r){e.setUniform3f("camPos",r[3]-t[0],r[7]-t[1],r[11]-t[2])}function o(e,t){e.setUniformMatrix4fv("proj",t)}function a(e,t){e.setUniform2fv("nearFar",t)}function c(e,t,r){Object(n.t)(d,r,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",d)}function u(e,t){c(e,t.origin,t.camera.viewMatrix)}function l(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}const d=Object(i.a)()},442:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return p})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return u}));var n=r(85),i=r(138),s=r(165),o=r(766),a=r(263);function c(e,t){return Object(n.j)(e)&&(e=[]),e.push(t),e}function u(e,t){if(Object(n.j)(e))return e;const r=e.filter((e=>e!==t));return 0===r.length?null:r}function l(e){return!!Object(n.k)(e)&&!e.visible}function d(e,t){const r=new Map;return r.set(0,t.acquire(e,0)),r.set(1,t.acquire(e,7)),r.set(4,t.acquire(e,3)),r.set(3,t.acquire(e,2)),r.set(2,t.acquire(e,1)),r.set(5,t.acquire(e,4)),r.set(7,t.acquire(e,3)),r.set(6,t.acquire(e,3)),r}function f(e,t){t.release(e,0),t.release(e,7),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)}function h(e,t,r){const s=e.origin.vec3;Object(a.j)(b,-s[0],-s[1],-s[2]),Object(n.k)(e.transformation)?Object(i.n)(t,b,e.transformation):Object(i.f)(t,b),r&&(Object(i.c)(r,t),Object(i.b)(r,r))}function p(e,t,r,n,i){m[0]=e.get(t,0),m[1]=e.get(t,1),m[2]=e.get(t,2),Object(o.a)(m,g,3),r.set(i,0,g[0]),n.set(i,0,g[1]),r.set(i,1,g[2]),n.set(i,1,g[3]),r.set(i,2,g[4]),n.set(i,2,g[5])}const m=new Float64Array(3),g=new Float32Array(6),b=Object(s.d)()},453:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(378),i=r(673);class s{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const r of e.fieldNames){const t=e.fields.get(r);this[r]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new s(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,r,n){const i=this.stride;if(i%4==0){const s=new Uint32Array(e.buffer,t*i,n*i/4);new Uint32Array(this.buffer,r*i,n*i/4).set(s)}else{const s=new Uint8Array(e.buffer,t*i,n*i);new Uint8Array(this.buffer,r*i,n*i).set(s)}}}class o{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this.appendField(e,n.m,t),this}vec2f64(e,t){return this.appendField(e,n.n,t),this}vec3f(e,t){return this.appendField(e,n.u,t),this}vec3f64(e,t){return this.appendField(e,n.v,t),this}vec4f(e,t){return this.appendField(e,n.C,t),this}vec4f64(e,t){return this.appendField(e,n.D,t),this}mat3f(e,t){return this.appendField(e,n.f,t),this}mat3f64(e,t){return this.appendField(e,n.g,t),this}mat4f(e,t){return this.appendField(e,n.h,t),this}mat4f64(e,t){return this.appendField(e,n.i,t),this}vec4u8(e,t){return this.appendField(e,n.J,t),this}f32(e,t){return this.appendField(e,n.a,t),this}f64(e,t){return this.appendField(e,n.b,t),this}u8(e,t){return this.appendField(e,n.l,t),this}u16(e,t){return this.appendField(e,n.j,t),this}i8(e,t){return this.appendField(e,n.e,t),this}vec2i8(e,t){return this.appendField(e,n.q,t),this}vec2i16(e,t){return this.appendField(e,n.o,t),this}vec2u8(e,t){return this.appendField(e,n.t,t),this}vec4u16(e,t){return this.appendField(e,n.H,t),this}u32(e,t){return this.appendField(e,n.k,t),this}appendField(e,t,r){const n=t.ElementCount*Object(i.a)(t.ElementType),s=this.stride;this.fields.set(e,{size:n,constructor:t,offset:s,optional:r}),this.stride+=n,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new s(this,e)}createView(e){return new s(this,e)}clone(){const e=new o;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,r)=>e.fields.set(r,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function a(){return new o}},466:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(85),i=r(197),s=r(111),o=r(105),a=r(263);class c{constructor(e,t,r,n){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=r,this.position=n,this.center=Object(o.e)(),Object(a.a)(e.length>=1),Object(a.a)(r.length%this._numIndexPerPrimitive==0),Object(a.a)(r.length>=e.length*this._numIndexPerPrimitive),Object(a.a)(3===n.size||4===n.size);const{data:i,size:c}=n,l=e.length;let d=c*r[this._numIndexPerPrimitive*e[0]];u.clear(),u.push(d),this.bbMin=Object(o.g)(i[d],i[d+1],i[d+2]),this.bbMax=Object(o.c)(this.bbMin);for(let s=0;s<l;++s){const t=this._numIndexPerPrimitive*e[s];for(let e=0;e<this._numIndexPerPrimitive;++e){d=c*r[t+e],u.push(d);let n=i[d];this.bbMin[0]=Math.min(n,this.bbMin[0]),this.bbMax[0]=Math.max(n,this.bbMax[0]),n=i[d+1],this.bbMin[1]=Math.min(n,this.bbMin[1]),this.bbMax[1]=Math.max(n,this.bbMax[1]),n=i[d+2],this.bbMin[2]=Math.min(n,this.bbMin[2]),this.bbMax[2]=Math.max(n,this.bbMax[2])}}Object(s.i)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let f=this.radius*this.radius;for(let s=0;s<u.length;++s){d=u.getItemAt(s);const e=i[d]-this.center[0],t=i[d+1]-this.center[1],r=i[d+2]-this.center[2],n=e*e+t*t+r*r;if(n<=f)continue;const o=Math.sqrt(n),a=.5*(o-this.radius);this.radius=this.radius+a,f=this.radius*this.radius;const c=a/o;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=r*c}u.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(s.l)(this.bbMin,this.bbMax)>1){const e=Object(s.i)(Object(o.e)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,r=new Uint8Array(t),n=new Array(8);for(let s=0;s<8;++s)n[s]=0;const{data:i,size:a}=this.position;for(let s=0;s<t;++s){let t=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[s];let c=a*this.indices[o],u=i[c],l=i[c+1],d=i[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=a*this.indices[o+e];const t=i[c],r=i[c+1],n=i[c+2];t<u&&(u=t),r<l&&(l=r),n<d&&(d=n)}u<e[0]&&(t|=1),l<e[1]&&(t|=2),d<e[2]&&(t|=4),r[s]=t,++n[t]}let u=0;for(let s=0;s<8;++s)n[s]>0&&++u;if(u<2)return;const l=new Array(8);for(let s=0;s<8;++s)l[s]=n[s]>0?new Uint32Array(n[s]):void 0;for(let s=0;s<8;++s)n[s]=0;for(let s=0;s<t;++s){const e=r[s];l[e][n[e]++]=this.primitiveIndices[s]}this._children=new Array(8);for(let s=0;s<8;++s)void 0!==l[s]&&(this._children[s]=new c(l[s],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){u.prune()}}const u=new i.a({deallocator:null});var l=r(583),d=r(490);class f extends l.a{constructor(e,t=[],r=0,n=-1){super(),this._primitiveType=r,this.edgeIndicesLength=n,this.type=2,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[i,s]of e)s&&this._vertexAttributes.set(i,{...s});if(null==t||0===t.length){const e=function(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}(this._vertexAttributes),t=Object(d.d)(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const r of this._vertexAttributes.keys())this._indices.set(r,t)}else for(const[i,s]of t)s&&(this._indices.set(i,h(s)),"position"===i&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(i).length:this.edgeIndicesLength))}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(n.j)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)}computeAttachmentOriginTriangles(e){const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return Object(d.c)(r,t,e)}computeAttachmentOriginPoints(e){const t=this.indices.get("position"),r=this.vertexAttributes.get("position");return Object(d.b)(r,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get("position");if(0===e.length)return null;const t=0===this.primitiveType?3:1;Object(a.a)(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const r=Object(d.d)(e.length/t),n=this.vertexAttributes.get("position");return new c(r,t,e,n)}}function h(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},487:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(732);class i extends n.a{constructor(e){super(),this._material=e.material,this._techniqueRep=e.techniqueRep,this._output=e.output}get technique(){return this._technique}getPipelineState(e,t){return this.technique.pipeline}ensureResources(e){return 2}ensureParameters(e){}}},490:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return p})),r.d(t,"d",(function(){return f})),r.d(t,"e",(function(){return h}));var n=r(111),i=r(105),s=r(391),o=(r(136),r(426));r(255);new s.a(o.d),new s.a((()=>({p0:null,p1:null,p2:null})));const a=Object(i.e)(),c=Object(i.e)();let u=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const l=new Uint16Array([0]),d=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function f(e){if(1===e)return l;if(e<d.length)return new Uint16Array(d.buffer,0,e);if(e>u.length){const t=Math.max(2*u.length,e);u=new Uint32Array(t);for(let e=0;e<u.length;e++)u[e]=e}return new Uint32Array(u.buffer,0,e)}function h(e){if(1===e)return new Uint16Array(l);if(e<d.length)return new Uint16Array(d.slice(0,e));if(e>u.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(u.slice(0,e))}function p(e,t,r){if(!e)return!1;const{size:i,data:s}=e;Object(n.w)(r,0,0,0),Object(n.w)(O,0,0,0);let o=0,u=0;for(let h=0;h<t.length-2;h+=3){const e=t[h+0]*i,p=t[h+1]*i,m=t[h+2]*i;Object(n.w)(b,s[e+0],s[e+1],s[e+2]),Object(n.w)(v,s[p+0],s[p+1],s[p+2]),Object(n.w)(x,s[m+0],s[m+1],s[m+2]);const g=(l=b,d=v,f=x,Object(n.j)(a,d,l),Object(n.j)(c,f,l),Object(n.p)(Object(n.g)(a,a,c))/2);g?(Object(n.f)(b,b,v),Object(n.f)(b,b,x),Object(n.e)(b,b,1/3*g),Object(n.f)(r,r,b),o+=g):(Object(n.f)(O,O,b),Object(n.f)(O,O,v),Object(n.f)(O,O,x),u+=3)}var l,d,f;return(0!==u||0!==o)&&(0!==o?(Object(n.e)(r,r,1/o),!0):0!==u&&(Object(n.e)(r,O,1/u),!0))}function m(e,t,r){if(!e||!t)return!1;const{size:i,data:s}=e;Object(n.w)(r,0,0,0);let o=-1,a=0;for(let n=0;n<t.length;n++){const e=t[n]*i;o!==e&&(r[0]+=s[e+0],r[1]+=s[e+1],r[2]+=s[e+2],a++),o=e}return a>1&&Object(n.e)(r,r,1/a),a>0}function g(e,t,r,i){if(!e)return!1;const{size:s,data:o}=e;Object(n.w)(i,0,0,0),Object(n.w)(O,0,0,0);let a=0,c=0;const u=t?t.length-1:o.length/s-1,l=u+(r?2:0);for(let d=0;d<l;d+=2){const e=d<u?d:u,r=d<u?d+1:0,l=(t?t[e]:e)*s,f=(t?t[r]:r)*s;b[0]=o[l+0],b[1]=o[l+1],b[2]=o[l+2],v[0]=o[f+0],v[1]=o[f+1],v[2]=o[f+2],Object(n.e)(b,Object(n.f)(b,b,v),.5);const h=Object(n.n)(b,v);h>0?(Object(n.f)(i,i,Object(n.e)(b,b,h)),a+=h):(Object(n.f)(O,O,b),c++)}return 0!==a?(Object(n.e)(i,i,1/a),!0):0!==c&&(Object(n.e)(i,O,1/c),!0)}const b=Object(i.e)(),v=Object(i.e)(),x=Object(i.e)(),O=Object(i.e)()},501:function(e,t,r){"use strict";function n(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}r.d(t,"a",(function(){return n}))},511:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return a}));var n=r(555),i=r(124);function s(e){e.fragment.include(n.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(i.a`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)}function o(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function a(e,t,r){t.shadowMappingEnabled&&t.shadowMap.bindView(e,r)}function c(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},549:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o}));var n=r(124);function i(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(n.a`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(n.a`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?n.a`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(n.a`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(n.a`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?n.a`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(n.a`vec4 vvColor() { return vec4(1.0); }`)}function s(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function o(e,t){s(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function a(e,t){s(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}},555:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(124);function i(e){e.code.add(n.a`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},580:function(e,t,r){"use strict";function n(){return new Float32Array(3)}function i(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function s(e,t,r){const n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}function o(){return n()}function a(){return s(1,1,1)}function c(){return s(1,0,0)}function u(){return s(0,1,0)}function l(){return s(0,0,1)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s}));const d=o(),f=a(),h=c(),p=u(),m=l();Object.freeze({__proto__:null,create:n,clone:i,fromValues:s,createView:function(e,t){return new Float32Array(e,t,3)},zeros:o,ones:a,unitX:c,unitY:u,unitZ:l,ZEROS:d,ONES:f,UNIT_X:h,UNIT_Y:p,UNIT_Z:m})},583:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(253);class i{constructor(){this.id=Object(n.a)()}unload(){}}},584:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(555),i=r(124);function s(e,t){e.fragment.include(n.a),3===t.output?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(i.a`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===t.output&&e.fragment.code.add(i.a`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},585:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return u}));var n=r(138),i=r(378),s=r(263);function o(e,t,r,n){const i=r.typedBuffer,s=r.typedBufferStride,o=e.length;n*=s;for(let a=0;a<o;++a){const r=2*e[a];i[n]=t[r],i[n+1]=t[r+1],n+=s}}function a(e,t,r,n,i){const s=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(n*=o,null==i||1===i)for(let c=0;c<a;++c){const r=3*e[c];s[n]=t[r],s[n+1]=t[r+1],s[n+2]=t[r+2],n+=o}else for(let c=0;c<a;++c){const r=3*e[c];for(let e=0;e<i;++e)s[n]=t[r],s[n+1]=t[r+1],s[n+2]=t[r+2],n+=o}}function c(e,t,r,n,i=1){const s=r.typedBuffer,o=r.typedBufferStride,a=e.length;if(n*=o,1===i)for(let c=0;c<a;++c){const r=4*e[c];s[n]=t[r],s[n+1]=t[r+1],s[n+2]=t[r+2],s[n+3]=t[r+3],n+=o}else for(let c=0;c<a;++c){const r=4*e[c];for(let e=0;e<i;++e)s[n]=t[r],s[n+1]=t[r+1],s[n+2]=t[r+2],s[n+3]=t[r+3],n+=o}}function u(e,t,r,n,i,s=1){if(!r)return void a(e,t,n,i,s);const o=n.typedBuffer,c=n.typedBufferStride,u=e.length,l=r[0],d=r[1],f=r[2],h=r[4],p=r[5],m=r[6],g=r[8],b=r[9],v=r[10],x=r[12],O=r[13],_=r[14];if(i*=c,1===s)for(let a=0;a<u;++a){const r=3*e[a],n=t[r],s=t[r+1],u=t[r+2];o[i]=l*n+h*s+g*u+x,o[i+1]=d*n+p*s+b*u+O,o[i+2]=f*n+m*s+v*u+_,i+=c}else for(let a=0;a<u;++a){const r=3*e[a],n=t[r],u=t[r+1],T=t[r+2],w=l*n+h*u+g*T+x,j=d*n+p*u+b*T+O,S=f*n+m*u+v*T+_;for(let e=0;e<s;++e)o[i]=w,o[i+1]=j,o[i+2]=S,i+=c}}function l(e,t,r,i,s,o=1){if(!r)return void a(e,t,i,s,o);const c=r,u=i.typedBuffer,l=i.typedBufferStride,d=e.length,f=c[0],h=c[1],p=c[2],m=c[4],g=c[5],b=c[6],v=c[8],x=c[9],O=c[10],_=!Object(n.q)(c),T=1e-6,w=1-T;if(s*=l,1===o)for(let n=0;n<d;++n){const r=3*e[n],i=t[r],o=t[r+1],a=t[r+2];let c=f*i+m*o+v*a,d=h*i+g*o+x*a,j=p*i+b*o+O*a;if(_){const e=c*c+d*d+j*j;if(e<w&&e>T){const t=1/Math.sqrt(e);c*=t,d*=t,j*=t}}u[s+0]=c,u[s+1]=d,u[s+2]=j,s+=l}else for(let n=0;n<d;++n){const r=3*e[n],i=t[r],a=t[r+1],c=t[r+2];let d=f*i+m*a+v*c,j=h*i+g*a+x*c,S=p*i+b*a+O*c;if(_){const e=d*d+j*j+S*S;if(e<w&&e>T){const t=1/Math.sqrt(e);d*=t,j*=t,S*=t}}for(let e=0;e<o;++e)u[s+0]=d,u[s+1]=j,u[s+2]=S,s+=l}}function d(e,t,r,i,s,o=1){if(!r)return void c(e,t,i,s,o);const a=r,u=i.typedBuffer,l=i.typedBufferStride,d=e.length,f=a[0],h=a[1],p=a[2],m=a[4],g=a[5],b=a[6],v=a[8],x=a[9],O=a[10],_=!Object(n.q)(a),T=1e-6,w=1-T;if(s*=l,1===o)for(let n=0;n<d;++n){const r=4*e[n],i=t[r],o=t[r+1],a=t[r+2],c=t[r+3];let d=f*i+m*o+v*a,j=h*i+g*o+x*a,S=p*i+b*o+O*a;if(_){const e=d*d+j*j+S*S;if(e<w&&e>T){const t=1/Math.sqrt(e);d*=t,j*=t,S*=t}}u[s+0]=d,u[s+1]=j,u[s+2]=S,u[s+3]=c,s+=l}else for(let n=0;n<d;++n){const r=4*e[n],i=t[r],a=t[r+1],c=t[r+2],d=t[r+3];let j=f*i+m*a+v*c,S=h*i+g*a+x*c,M=p*i+b*a+O*c;if(_){const e=j*j+S*S+M*M;if(e<w&&e>T){const t=1/Math.sqrt(e);j*=t,S*=t,M*=t}}for(let e=0;e<o;++e)u[s+0]=j,u[s+1]=S,u[s+2]=M,u[s+3]=d,s+=l}}function f(e,t,r,n,i,s=1){const o=n.typedBuffer,a=n.typedBufferStride,c=e.length;if(i*=a,1===s){if(4===r)for(let u=0;u<c;++u){const r=4*e[u];o[i]=t[r],o[i+1]=t[r+1],o[i+2]=t[r+2],o[i+3]=t[r+3],i+=a}else if(3===r)for(let u=0;u<c;++u){const r=3*e[u];o[i]=t[r],o[i+1]=t[r+1],o[i+2]=t[r+2],o[i+3]=255,i+=a}}else if(4===r)for(let u=0;u<c;++u){const r=4*e[u];for(let e=0;e<s;++e)o[i]=t[r],o[i+1]=t[r+1],o[i+2]=t[r+2],o[i+3]=t[r+3],i+=a}else if(3===r)for(let u=0;u<c;++u){const r=3*e[u];for(let e=0;e<s;++e)o[i]=t[r],o[i+1]=t[r+1],o[i+2]=t[r+2],o[i+3]=255,i+=a}}function h(e,t,r,n,a,c){for(const h of t.fieldNames){const t=e.vertexAttributes.get(h),p=e.indices.get(h);if(t&&p)switch(h){case"position":{Object(s.a)(3===t.size);const e=a.getField(h,i.u);e&&u(p,t.data,r,e,c);break}case"normal":{Object(s.a)(3===t.size);const e=a.getField(h,i.u);e&&l(p,t.data,n,e,c);break}case"uv0":{Object(s.a)(2===t.size);const e=a.getField(h,i.m);e&&o(p,t.data,e,c);break}case"color":{Object(s.a)(3===t.size||4===t.size);const e=a.getField(h,i.J);e&&f(p,t.data,t.size,e,c);break}case"symbolColor":{Object(s.a)(3===t.size||4===t.size);const e=a.getField(h,i.J);e&&f(p,t.data,t.size,e,c);break}case"tangent":{Object(s.a)(4===t.size);const e=a.getField(h,i.C);e&&d(p,t.data,n,e,c);break}}}}},586:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(124);function i(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(n.a`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(n.a`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(n.a`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},608:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return l})),r.d(t,"g",(function(){return o})),r.d(t,"h",(function(){return s}));const n={func:513},i={func:519},s={mask:255},o={mask:0},a={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},c={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},u={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},l={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}},639:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(124);function i(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(n.a`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(n.a`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):e.vertex.code.add(n.a`void forwardLinearDepth() {}`)}},652:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(124);function i(e){const t=e.fragment.code;t.add(n.a`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(n.a`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(n.a`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=r(677);function o(e,t){const r=e.fragment.code;e.include(s.a),3===t.pbrMode||4===t.pbrMode?(r.add(n.a`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),r.add(n.a`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(n.a`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(n.a`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(n.a`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):1!==t.pbrMode&&2!==t.pbrMode||(e.include(i),r.add(n.a`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(n.a`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(n.a`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),r.add(n.a`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(n.a`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(n.a`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},673:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return o}));r(79);function n(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function i(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function s(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function o(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}},677:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(124);function i(e){e.vertex.code.add(n.a`const float PI = 3.141592653589793;`),e.fragment.code.add(n.a`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},700:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var n=r(805),i=r(124);function s(e,t){const r=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(n.a),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),r.add(i.a`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?i.a`vec3 worldNormal = normalize(worldPos + localOrigin);`:i.a`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?i.a`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:i.a`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):r.add(i.a`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function o(e,t,r){if(!t.verticalOffset)return;const n=a(t.verticalOffset,r.camera.fovY,r.camera.fullViewport[3]),i=r.camera.pixelRatio||1;e.setUniform4f("verticalOffset",n.screenLength*i,n.perDistance,n.minWorldLength,n.maxWorldLength)}function a(e,t,r,n=c){return n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*r),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}const c={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},704:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return x})),r.d(t,"c",(function(){return v}));var n=r(85),i=r(290),s=r(311),o=r(138),a=r(165),c=r(523),u=r(376),l=r(111),d=r(580),f=r(105),h=r(216),p=r(432);class m{constructor(){this._transform=Object(a.d)(),this._transformInverse=new g({value:this._transform},o.c,a.d),this._transformInverseTranspose=new g(this._transformInverse,o.b,a.d),this._transformTranspose=new g({value:this._transform},o.b,a.d),this._transformInverseRotation=new g({value:this._transform},i.j,s.b)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(o.f)(this._transform,e)}multiplyTransform(e){Object(o.n)(this._transform,this._transform,e)}set(e){Object(o.f)(this._transform,e),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}class g{constructor(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const b=new class{constructor(e=0){this.offset=e,this.sphere=Object(p.b)(),this.tmpVertex=Object(f.e)()}applyToVertex(e,t,r){const n=this.objectTransform.transform;let i=n[0]*e+n[4]*t+n[8]*r+n[12],s=n[1]*e+n[5]*t+n[9]*r+n[13],o=n[2]*e+n[6]*t+n[10]*r+n[14];const a=this.offset/Math.sqrt(i*i+s*s+o*o);i+=i*a,s+=s*a,o+=o*a;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*i+c[4]*s+c[8]*o+c[12],this.tmpVertex[1]=c[1]*i+c[5]*s+c[9]*o+c[13],this.tmpVertex[2]=c[2]*i+c[6]*s+c[10]*o+c[14],this.tmpVertex}applyToMinMax(e,t){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const n=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*n,t[1]+=t[1]*n,t[2]+=t[2]*n}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function v(e){return Object(n.k)(e)?(b.offset=e,b):null}new class{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(f.e)(),this.mbs=Object(h.e)(),this.obb={center:Object(f.e)(),halfSize:Object(d.b)(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,r){const n=e,i=t,s=r+this.componentLocalOriginLength,o=this.offset/Math.sqrt(n*n+i*i+s*s);return this.tmpVertex[0]=e+n*o,this.tmpVertex[1]=t+i*o,this.tmpVertex[2]=r+s*o,this.tmpVertex}applyToAabb(e){const t=e[0],r=e[1],n=e[2]+this.componentLocalOriginLength,i=e[3],s=e[4],o=e[5]+this.componentLocalOriginLength,a=this.offset/Math.sqrt(t*t+r*r+n*n);e[0]+=t*a,e[1]+=r*a,e[2]+=n*a;const c=this.offset/Math.sqrt(i*i+s*s+o*o);return e[3]+=i*c,e[4]+=s*c,e[5]+=o*c,e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/t;return this.mbs[0]=e[0]+e[0]*r,this.mbs[1]=e[1]+e[1]*r,this.mbs[2]=e[2]+e[2]*r,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){const t=e.center,r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*r,this.obb.center[1]=t[1]+t[1]*r,this.obb.center[2]=t[2]+t[2]*r,Object(l.u)(this.obb.halfSize,e.halfSize,e.quaternion),Object(l.f)(this.obb.halfSize,this.obb.halfSize,e.center);const n=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*n,this.obb.halfSize[1]+=this.obb.halfSize[1]*n,this.obb.halfSize[2]+=this.obb.halfSize[2]*n,Object(l.j)(this.obb.halfSize,this.obb.halfSize,e.center),Object(c.a)(O,e.quaternion),Object(l.u)(this.obb.halfSize,this.obb.halfSize,O),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}};new class{constructor(e=0){this.offset=e,this.tmpVertex=Object(f.e)()}applyToVertex(e,t,r){const n=e+this.localOrigin[0],i=t+this.localOrigin[1],s=r+this.localOrigin[2],o=this.offset/Math.sqrt(n*n+i*i+s*s);return this.tmpVertex[0]=e+n*o,this.tmpVertex[1]=t+i*o,this.tmpVertex[2]=r+s*o,this.tmpVertex}applyToAabb(e){const t=e[0]+this.localOrigin[0],r=e[1]+this.localOrigin[1],n=e[2]+this.localOrigin[2],i=e[3]+this.localOrigin[0],s=e[4]+this.localOrigin[1],o=e[5]+this.localOrigin[2],a=this.offset/Math.sqrt(t*t+r*r+n*n);e[0]+=t*a,e[1]+=r*a,e[2]+=n*a;const c=this.offset/Math.sqrt(i*i+s*s+o*o);return e[3]+=i*c,e[4]+=s*c,e[5]+=o*c,e}};const x="terrain",O=Object(u.b)()},732:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return s}));const n=e=>class extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const r=this[t];this[t]=null,r&&"function"==typeof r.dispose&&r.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class i extends(n(class{})){}function s(){return(e,t)=>{var r,n;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(r=null==(n=e._managedDisposables)?void 0:n.slice())?r:[]),e._managedDisposables.unshift(t)}}},741:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u}));var n=r(377);const i=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],s=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];var o=r(222),a=r(203),c=r(227);function u(e,t=i,r=n.a,a=-1,u=1){let l=null;return l=t===s?new Float32Array([a,a,0,0,u,a,1,0,a,u,0,1,u,u,1,1]):new Float32Array([a,a,u,a,a,u,u,u]),new c.a(e,r,{geometry:t},{geometry:o.a.createVertex(e,35044,l)})}function l(e){return new a.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}},766:function(e,t,r){"use strict";function n(e,t,r){for(let n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}function i(e,t,r,i){for(let a=0;a<i;++a)s[0]=e[a],n(s,o,1),t[a]=o[0],r[a]=o[1]}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));const s=new Float64Array(1),o=new Float32Array(2)},805:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o}));var n=r(124),i=r(409);function s(e){e.vertex.code.add(n.a`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(n.a`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(n.a`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(n.a`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(n.a`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(n.a`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`),e.vertex.code.add(n.a`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function o(e,t){if(t.screenSizePerspective){Object(i.a)(t.screenSizePerspective,e,"screenSizePerspective");const r=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(i.a)(r,e,"screenSizePerspectiveAlignment")}}},815:function(e,t,r){"use strict";r.d(t,"a",(function(){return N}));var n=r(205),i=r(88),s=r(125),o=r(108),a=r(85),c=r(91),u=r(357),l=r(98),d=r(930),f=r(506),h=r(160);let p;var m=r(203),g=r(659);let b=null,v=null;async function x(){return Object(a.j)(v)&&(v=function(){if(Object(a.j)(p)){const e=e=>Object(h.a)(`esri/libs/basisu/${e}`);p=Promise.all([r.e(206),r.e(244)]).then(r.bind(null,1321)).then((function(e){return e.b})).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return p}(),b=await v),v}function O(e,t,r,n,i){const s=Object(g.b)(t?37496:37492),o=i&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*n*s*o)}function _(e){return e.getNumImages()>=1&&!e.isUASTC()}function T(e){return e.getFaces()>=1&&e.isETC1S()}function w(e,t,r,n,i,s,o,a){const{compressedTextureETC:c,compressedTextureS3TC:u}=e.capabilities,[l,d]=c?n?[1,37496]:[0,37492]:u?n?[3,33779]:[2,33776]:[13,6408],f=t.hasMipmap?r:Math.min(1,r),h=[];for(let m=0;m<f;m++)h.push(new Uint8Array(o(m,l))),a(m,l,h[m]);const p=h.length>1,g=p?9987:9729,b={...t,samplingMode:g,hasMipmap:p,internalFormat:d,width:i,height:s};return new m.a(e,b,{type:"compressed",levels:h})}var j=r(583);const S=r(80).a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),M=542327876,y=131072;function P(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const A=P("DXT1"),I=P("DXT3"),F=P("DXT5");function z(e,t,r){const{textureData:n,internalFormat:i,width:s,height:a}=function(e,t){const r=new Int32Array(e,0,31);if(r[0]!==M)return S.error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return S.error("Unsupported format, must contain a FourCC code"),null;const n=r[21];let i,s;switch(n){case A:i=8,s=33776;break;case I:i=16,s=33778;break;case F:i=16,s=33779;break;default:return S.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(n)),null}let a=1,c=r[4],u=r[3];0==(3&c)&&0==(3&u)||(S.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,u=u+3&-4);const l=c,d=u;let f,h;r[2]&y&&!1!==t&&(a=Math.max(1,r[7])),1===a||Object(o.l)(c)&&Object(o.l)(u)||(S.warn("Ignoring mipmaps of non power of two sized compressed texture."),a=1);let p=r[1]+4;const m=[];for(let o=0;o<a;++o)h=(c+3>>2)*(u+3>>2)*i,f=new Uint8Array(e,p,h),m.push(f),p+=h,c=Math.max(1,c>>1),u=Math.max(1,u>>1);return{textureData:{type:"compressed",levels:m},internalFormat:s,width:l,height:d}}(r,t.hasMipmap);return t.samplingMode=n.levels.length>1?9987:9729,t.hasMipmap=n.levels.length>1,t.internalFormat=i,t.width=s,t.height=a,new m.a(e,t,n)}var D=r(741),C=r(263),E=r(248),L=r(501);class N extends j.a{constructor(e,t){super(),this.data=e,this.type=4,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new s.a,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=N.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;Object(a.j)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){Object(l.t)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){Object(l.u)(e.src)||Object(l.t)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if(Object(a.j)(e))return 0;if(Object(u.c)(e)||Object(u.k)(e))return t.encoding===N.KTX2_ENCODING?function(e,t){if(Object(a.j)(b))return e.byteLength;const r=new b.KTX2File(new Uint8Array(e)),n=T(r)?O(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),n}(e,t.mipmap):t.encoding===N.BASIS_ENCODING?function(e,t){if(Object(a.j)(b))return e.byteLength;const r=new b.BasisFile(new Uint8Array(e)),n=_(r)?O(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),n}(e,t.mipmap):e.byteLength;const{width:r,height:n}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?N.getDataDimensions(e):t;return(t.mipmap?4/3:1)*r*n*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}load(e,t){if(Object(a.k)(this.glTexture))return this.glTexture;if(Object(a.k)(this.loadingPromise))return this.loadingPromise;const r=this.data;return Object(a.j)(r)?(this.glTexture=new m.a(e,this.createDescriptor(e),null),this.glTexture):"string"==typeof r?this.loadFromURL(e,t,r):r instanceof Image?this.loadFromImageElement(e,t,r):r instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this.loadFromImage(e,r,t):(Object(u.c)(r)||Object(u.k)(r))&&this.params.encoding===N.DDS_ENCODING?this.loadFromDDSData(e,r):(Object(u.c)(r)||Object(u.k)(r))&&this.params.encoding===N.KTX2_ENCODING?this.loadFromKTX2(e,r):(Object(u.c)(r)||Object(u.k)(r))&&this.params.encoding===N.BASIS_ENCODING?this.loadFromBasis(e,r):Object(u.k)(r)?this.loadFromPixelData(e,r):Object(u.c)(r)?this.loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,r){if(!(this.data instanceof HTMLVideoElement)||Object(a.j)(this.glTexture))return r;if(this.data.readyState<2||r===this.data.currentTime)return r;if(Object(a.k)(this.powerOfTwoStretchInfo)){const{framebuffer:r,vao:n,sourceTexture:i}=this.powerOfTwoStretchInfo;i.setData(this.data),this.drawStretchedTexture(e,t,r,n,i,this.glTexture)}else{const{width:e,height:t}=this.data,{width:r,height:n}=this.glTexture.descriptor;e!==r||t!==n?this.glTexture.updateData(0,0,0,Math.min(e,r),Math.min(t,n),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this.glTexture=z(e,this.createDescriptor(e),t),this.glTexture}loadFromKTX2(e,t){return this.loadAsync((()=>async function(e,t,r){Object(a.j)(b)&&(b=await x());const n=new b.KTX2File(new Uint8Array(r));if(!T(n))return null;n.startTranscoding();const i=w(e,t,n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),((e,t)=>n.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,r)=>n.transcodeImage(r,e,0,0,t,0,-1,-1)));return n.close(),n.delete(),i}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromBasis(e,t){return this.loadAsync((()=>async function(e,t,r){Object(a.j)(b)&&(b=await x());const n=new b.BasisFile(new Uint8Array(r));if(!_(n))return null;n.startTranscoding();const i=w(e,t,n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),((e,t)=>n.getImageTranscodedSizeInBytes(0,e,t)),((e,t,r)=>n.transcodeImage(r,0,e,t,0,0)));return n.close(),n.delete(),i}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromPixelData(e,t){Object(C.a)(this.params.width>0&&this.params.height>0);const r=this.createDescriptor(e);return r.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,r.width=this.params.width,r.height=this.params.height,this.glTexture=new m.a(e,r,t),this.glTexture}loadAsync(e){const t=Object(c.d)();this.loadingController=t;const r=e(t.signal);this.loadingPromise=r;const n=()=>{this.loadingController===t&&(this.loadingController=null),this.loadingPromise===r&&(this.loadingPromise=null)};return r.then(n,n),r}loadFromURL(e,t,r){return this.loadAsync((async n=>{const i=await Object(d.a)(r,{signal:n});return this.loadFromImage(e,i,t)}))}loadFromImageElement(e,t,r){return r.complete?this.loadFromImage(e,r,t):this.loadAsync((async n=>{const i=await Object(f.a)(r,r.src,!1,n);return this.loadFromImage(e,i,t)}))}loadFromVideoElement(e,t,r){return r.readyState>=2?this.loadFromImage(e,r,t):this.loadFromVideoElementAsync(e,t,r)}loadFromVideoElementAsync(e,t,r){return this.loadAsync((n=>new Promise(((s,o)=>{const u=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",d),Object(a.k)(f)&&f.remove()},l=()=>{r.readyState>=2&&(u(),s(this.loadFromImage(e,r,t)))},d=e=>{u(),o(e||new i.a("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",d);const f=Object(c.q)(n,(()=>d(Object(c.e)())))}))))}loadFromImage(e,t,r){const n=N.getDataDimensions(t);this.params.width=n.width,this.params.height=n.height;const i=this.createDescriptor(e);return i.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,i)||Object(o.l)(n.width)&&Object(o.l)(n.height)?(i.width=n.width,i.height=n.height,this.glTexture=new m.a(e,i,t),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,n,i,r),this.glTexture)}requiresPowerOfTwo(e,t){const r=33071,n="number"==typeof t.wrapMode?t.wrapMode===r:t.wrapMode.s===r&&t.wrapMode.t===r;return!Object(L.a)(e.gl)&&(t.hasMipmap||!n)}makePowerOfTwoTexture(e,t,r,i,s){const{width:a,height:c}=r,u=Object(o.p)(a),l=Object(o.p)(c);let d;switch(i.width=u,i.height=l,this.params.powerOfTwoResizeMode){case 2:i.textureCoordinateScaleFactor=[a/u,c/l],d=new m.a(e,i),d.updateData(0,0,0,a,c,t);break;case 1:case null:case void 0:d=this.stretchToPowerOfTwo(e,t,i,s);break;default:Object(n.a)(this.params.powerOfTwoResizeMode)}return i.hasMipmap&&d.generateMipmap(),d}stretchToPowerOfTwo(e,t,r,n){const i=new m.a(e,r),s=new E.a(e,{colorTarget:0,depthStencilTarget:0},i),o=new m.a(e,{target:3553,pixelFormat:r.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t),a=Object(D.b)(e);return this.drawStretchedTexture(e,n,s,a,o,i),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:a,sourceTexture:o,framebuffer:s}:(a.dispose(!0),o.dispose(),s.detachColorTexture(),e.bindFramebuffer(null),s.dispose()),i}drawStretchedTexture(e,t,r,n,i,s){e.bindFramebuffer(r);const o=e.getViewport();e.setViewport(0,0,s.descriptor.width,s.descriptor.height);const a=t.program;e.useProgram(a),a.setUniform4f("color",1,1,1,1),a.bindTexture(i,"tex"),e.bindVAO(n),e.setPipelineState(t.pipeline),e.drawArrays(5,0,Object(g.f)(n,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)}unload(){if(Object(a.k)(this.powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:r}=this.powerOfTwoStretchInfo;t.dispose(!0),r.dispose(),e.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(Object(a.k)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),Object(a.k)(this.loadingController)){const e=this.loadingController;this.loadingController=null,this.loadingPromise=null,e.abort()}this.events.emit("unloaded")}}N.DDS_ENCODING="image/vnd-ms.dds",N.KTX2_ENCODING="image/ktx2",N.BASIS_ENCODING="image/x.basis"},850:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return u}));var n=r(108);function i(e,t,r){const n=r.parameters,i=r.paddingPixelsOverride;return l.scale=Math.min(n.divisor/(t-n.offset),1),l.factor=function(e){return Math.abs(e*e*e)}(e),l.minPixelSize=n.minPixelSize,l.paddingPixels=i,l}function s(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function o(e,t){return Math.max(Object(n.m)(e*t.scale,e,t.factor),s(e,t))}function a(e,t,r,n){n.scale=function(e,t,r){const n=i(e,t,r);return n.minPixelSize=0,n.paddingPixels=0,o(1,n)}(e,t,r),n.factor=0,n.minPixelSize=r.parameters.minPixelSize,n.paddingPixels=r.paddingPixelsOverride}function c(e,t,r=[0,0]){const n=Math.min(Math.max(t.scale,s(e[1],t)/e[1]),1);return r[0]=e[0]*n,r[1]=e[1]*n,r}function u(e,t,r,n){return o(e,i(t,r,n))}Object(n.h)(10),Object(n.h)(12),Object(n.h)(70),Object(n.h)(40);const l={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},930:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(101);async function i(e,t){const{data:r}=await Object(n.default)(e,{responseType:"image",...t});return r}},940:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(85),i=r(487);class s extends i.a{constructor(e){super(e),this._textureIDs=new Set,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._initTransparent=!!e.initTextureTransparent,this._texture=this._acquire(this._textureId),this._textureNormal=this._acquire(e.normalTextureId),this._textureEmissive=this._acquire(e.emissiveTextureId),this._textureOcclusion=this._acquire(e.occlusionTextureId),this._textureMetallicRoughness=this._acquire(e.metallicRoughnessTextureId)}dispose(){this._textureIDs.forEach((e=>this._textureRepository.release(e))),this._textureIDs.clear()}updateTexture(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))}bindTextures(e){Object(n.k)(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(n.k)(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(n.k)(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(n.k)(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(n.k)(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(e){const t=Object(n.k)(this._texture)&&this._texture.glTexture;t&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(e){if(!Object(n.j)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}_release(e){Object(n.j)(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}}}]);
//# sourceMappingURL=12.7cce7c8b.chunk.js.map