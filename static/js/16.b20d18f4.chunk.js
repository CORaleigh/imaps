(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[16],{1082:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(80),s=r(966),a={minX:0,minY:0,maxX:0,maxY:0};class n{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new s.a(9,Object(i.a)("csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){var e=new Array(this._idByBounds.size),t=0;this._idByBounds.forEach(((r,i)=>{e[t++]=i})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))),this._boundsToLoad.length=0)}}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){a.minX=t[0],a.minY=t[1],a.maxX=t[2],a.maxY=t[3],e.search(a,r)}(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},400:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return g}));var i=r(7),s=r(112),a=r(161),n=r(223),u=r(428),o=[0,0];function l(e,t){if(!t)return null;if("x"in t){var r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,o),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){var i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,o),[i.xmax,i.ymax]=e(t.xmax,t.ymax,o),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function c(e,t){var r=[];for(var i of e)r.push(h(i,t));return r}function h(e,t){var r=[];for(var i of e){var s=t(i[0],i[1],[0,0]);r.push(s),i.length>2&&s.push(i[2]),i.length>3&&s.push(i[3])}return r}function d(e,t){return f.apply(this,arguments)}function f(){return(f=Object(i.a)((function*(e,t){if(t){var r=Array.isArray(e)?e.map((e=>{var t;return null==(t=e.geometry)?void 0:t.spatialReference})):[e];yield Object(n.f)(r.map((e=>({source:e,dest:t}))))}}))).apply(this,arguments)}var m=l.bind(null,a.c),p=l.bind(null,a.g);function y(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(s.i)(t)&&Object(s.i)(r)&&!Object(s.c)(t,r)?Object(a.a)(t,r)?Object(s.m)(r)?m(e):p(e):Object(n.m)(u.a,[e],t,r,null)[0]:e):e}var v=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(e,t,r){var a=this;return Object(i.a)((function*(){!e||!e.length||!t||!r||Object(s.c)(t,r);var i={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return a._jobs.push(i),new Promise((e=>{i.resolve=e,null===a._timer&&(a._timer=setTimeout(a._process,10))}))}))()}_process(){this._timer=null;var e=this._jobs.shift();if(e){var{geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:o}=e;Object(a.a)(r,i)?Object(s.m)(i)?o(t.map(m)):o(t.map(p)):o(Object(n.m)(u.a,t,r,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}};function g(e,t,r){return b.apply(this,arguments)}function b(){return(b=Object(i.a)((function*(e,t,r){return v.push(e,t,r)}))).apply(this,arguments)}},428:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var i=new s(e.getPointX(t),e.getPointY(t),r),a=e.hasZ(t),n=e.hasM(t);return a&&(i.z=e.getPointZ(t)),n&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new n(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new u(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var i=e.hasZ(t),s=e.hasM(t),a=new o(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){var n=e.getZExtent(t);a.zmin=n.vmin,a.zmax=n.vmax}if(s){var u=e.getMExtent(t);a.mmin=u.vmin,a.mmax=u.vmax}return a}};class s{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class a{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class n{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class u{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i,s){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},469:function(e,t,r){"use strict";function i(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,u){if(!t||!t.lengths.length)return null;var o="upperLeft"===(null==u?void 0:u.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var l=e.coords,c=[],h=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=t,m=i(r,s),p=0;for(var y of d){var v=a(h,f,p,y,r,s,o);v&&c.push(v),p+=y*m}if(c.sort(((e,t)=>{var i=o*e[2]-o*t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),c.length){var g=6*c[0][2];l[0]=c[0][0]/g,l[1]=c[0][1]/g,r&&(g=6*c[0][4],l[2]=0!==g?c[0][3]/g:0),(l[0]<h[0]||l[0]>h[1]||l[1]<h[2]||l[1]>h[3]||r&&(l[2]<h[4]||l[2]>h[5]))&&(l.length=0)}if(!l.length){var b=t.lengths[0]?n(f,0,d[0],r,s):null;if(!b)return null;l[0]=b[0],l[1]=b[1],r&&b.length>2&&(l[2]=b[2])}return e}function a(e,t,r,s,a,n,u=1){for(var o=i(a,n),l=r,c=r+o,h=0,d=0,f=0,m=0,p=0,y=0,v=s-1;y<v;y++,l+=o,c+=o){var g=t[l],b=t[l+1],_=t[l+2],x=t[c],I=t[c+1],j=t[c+2],O=g*I-x*b;m+=O,h+=(g+x)*O,d+=(b+I)*O,a&&(f+=(_+j)*(O=g*j-x*_),p+=O),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),b<e[2]&&(e[2]=b),b>e[3]&&(e[3]=b),a&&(_<e[4]&&(e[4]=_),_>e[5]&&(e[5]=_))}if(m*u>0&&(m*=-1),p*u>0&&(p*=-1),!m)return null;var S=[h,d,.5*m];return a&&(S[3]=f,S[4]=.5*p),S}function n(e,t,r,s,a){for(var n=i(s,a),h=t,d=t+n,f=0,m=0,p=0,y=0,v=0,g=r-1;v<g;v++,h+=n,d+=n){var b=e[h],_=e[h+1],x=e[h+2],I=e[d],j=e[d+1],O=e[d+2],S=s?o(b,_,x,I,j,O):u(b,_,I,j);if(S)if(f+=S,s){var M=c(b,_,x,I,j,O);m+=S*M[0],p+=S*M[1],y+=S*M[2]}else{var R=l(b,_,I,j);m+=S*R[0],p+=S*R[1]}}return f>0?s?[m/f,p/f,y/f]:[m/f,p/f]:r>0?s?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function u(e,t,r,i){var s=r-e,a=i-t;return Math.sqrt(s*s+a*a)}function o(e,t,r,i,s,a){var n=i-e,u=s-t,o=a-r;return Math.sqrt(n*n+u*u+o*o)}function l(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function c(e,t,r,i,s,a){return[e+.5*(i-e),t+.5*(s-t),r+.5*(a-r)]}r.d(t,"a",(function(){return s}))},497:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(133),s=Object(i.b)((function(e){var t;void 0!==(t=function(){function e(r,i,s,a,n){for(;a>s;){if(a-s>600){var u=a-s+1,o=i-s+1,l=Math.log(u),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(u-c)/u)*(o-u/2<0?-1:1);e(r,i,Math.max(s,Math.floor(i-o*c/u+h)),Math.min(a,Math.floor(i+(u-o)*c/u+h)),n)}var d=r[i],f=s,m=a;for(t(r,s,i),n(r[a],d)>0&&t(r,s,a);f<m;){for(t(r,f,m),f++,m--;n(r[f],d)<0;)f++;for(;n(r[m],d)>0;)m--}0===n(r[s],d)?t(r,s,m):t(r,++m,a),m<=i&&(s=m+1),i<=m&&(a=m-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,s,a,n){e(t,i,s||0,a||t.length-1,n||r)}}())&&(e.exports=t)}))},668:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return x})),r.d(t,"d",(function(){return I})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return _}));var i=r(7),s=r(89),a=r(95),n=r(112),u=r(371),o=r(100),l=r(117),c=r(236),h=r(178),d=r(168),f=(r(469),r(400)),m=new a.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({}),y=new h.a,v=new h.a,g=new h.a,b={esriGeometryPoint:d.m,esriGeometryPolyline:d.o,esriGeometryPolygon:d.n,esriGeometryMultipoint:d.l};function _(e,t,r,i=e.hasZ,s=e.hasM){var a=e.hasZ&&i,n=e.hasM&&s;if(r){var u=Object(d.u)(g,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,s);return Object(d.m)(u,a,n)}return Object(d.m)(t,a,n)}function x(e,t,r,i,s,a,n=t,u=r){var o=t&&n,l=r&&u,c=i?"coords"in i?i:i.geometry:null;if(!c)return null;if(s){var h=Object(d.q)(v,c,t,r,e,s,n,u);return a&&(h=Object(d.u)(g,h,o,l,e,a)),b[e](h,o,l)}if(a){var f=Object(d.u)(g,c,t,r,e,a,n,u);return b[e](f,o,l)}return Object(d.x)(y,c,t,r,n,u),b[e](y,o,l)}function I(e,t,r){return j.apply(this,arguments)}function j(){return(j=Object(i.a)((function*(e,t,r){var{outFields:i,orderByFields:s,groupByFieldsForStatistics:a,outStatistics:n}=e;if(i)for(var u=0;u<i.length;u++)i[u]=i[u].trim();if(s)for(var o=0;o<s.length;o++)s[o]=s[o].trim();if(a)for(var l=0;l<a.length;l++)a[l]=a[l].trim();if(n)for(var c=0;c<n.length;c++)n[c].onStatisticField&&(n[c].onStatisticField=n[c].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),O(e,t,r)}))).apply(this,arguments)}function O(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(i.a)((function*(e,t,r){if(!e)return null;var{where:i}=e;if(e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||t&&t===i)&&(e.where=null),!e.geometry)return e;var a=yield M(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){var{spatialReference:n}=e.geometry;(a=Object(u.a)(a)).spatialReference=n}e.geometry=a,yield Object(f.a)(a.spatialReference,r);var l=(yield Object(c.a)(Object(o.a)(a)))[0];if(Object(s.j)(l))throw p;var h=l.toJSON(),d=yield Object(f.b)(h,h.spatialReference,r);if(!d)throw p;return d.spatialReference=r,e.geometry=d,e}))).apply(this,arguments)}function M(e){return R.apply(this,arguments)}function R(){return(R=Object(i.a)((function*(e){var{geometry:t,distance:r,units:i}=e;if(null==r||"vertexAttributes"in t)return t;var s=t.spatialReference,a=i?m.fromJSON(i):Object(l.h)(s),u=s&&(Object(n.f)(s)||Object(n.m)(s))?t:yield Object(f.a)(s,n.a).then((()=>Object(f.b)(t,n.a)));return(yield w())(u.spatialReference,u,r,a)}))).apply(this,arguments)}function w(){return F.apply(this,arguments)}function F(){return(F=Object(i.a)((function*(){return(yield Promise.all([r.e(9),r.e(28)]).then(r.bind(null,788))).geodesicBuffer}))).apply(this,arguments)}function T(e){return e&&A in e?JSON.parse(JSON.stringify(e,B)):e}var A="_geVersion",B=(e,t)=>e!==A?t:void 0},755:function(e,t,r){"use strict";function i(e,t){if(!e)return null;var r=t.featureAdapter,{startTimeField:i,endTimeField:s}=e,a=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(i&&s)t.forEach((e=>{var t=r.getAttribute(e,i),u=r.getAttribute(e,s);null==t||isNaN(t)||(a=Math.min(a,t)),null==u||isNaN(u)||(n=Math.max(n,u))}));else{var u=i||s;t.forEach((e=>{var t=r.getAttribute(e,u);null==t||isNaN(t)||(a=Math.min(a,t),n=Math.max(n,t))}))}return{start:a,end:n}}function s(e,t,r){if(!t||!e)return null;var{startTimeField:i,endTimeField:s}=e;if(!i&&!s)return null;var{start:a,end:n}=t;return null===a&&null===n?null:void 0===a&&void 0===n?()=>!1:i&&s?function(e,t,r,i,s){return null!=i&&null!=s?a=>{var n=e.getAttribute(a,t),u=e.getAttribute(a,r);return(null==n||n<=s)&&(null==u||u>=i)}:null!=i?t=>{var s=e.getAttribute(t,r);return null==s||s>=i}:null!=s?r=>{var i=e.getAttribute(r,t);return null==i||i<=s}:void 0}(r,i,s,a,n):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e.getAttribute(i,t)===r:null!=r&&null!=i?s=>{var a=e.getAttribute(s,t);return a>=r&&a<=i}:null!=r?i=>e.getAttribute(i,t)>=r:null!=i?r=>e.getAttribute(r,t)<=i:void 0}(r,i||s,a,n)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}))},766:function(e,t,r){"use strict";var i=r(91),s=r(7),a=r(92),n=r(89),u=r(93),o=r(112),l=r(210),c=r(100),h=r(117),d=r(125),f=r(323),m=r(236),p=r(213),y=r(207),v=r(837),g=r(279),b=r(400),_=r(403),x=r(272);var I=new class{constructor(e,t){this._cache=new _.a(e),this._invalidCache=new _.a(t)}get(e,t){var r="".concat(t.uid,":").concat(e),i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{var s=x.WhereClause.create(e,t);return this._cache.put(r,s),s}catch(a){return this._invalidCache.put(r,null),null}}}(50,500),j="feature-store:unsupported-query",O=" as ",S=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function M(e,t){return e?I.get(e,t):null}function R(e,t,r,i=!0){var s=[];for(var a of t)if("*"!==a&&!e.has(a))if(i){var n=w(a);try{var o=M(n,e);if(!o)throw new u.a(j,"invalid SQL expression",{where:n});if(!o.isStandardized)throw new u.a(j,"expression is not standard",{clause:o});R(e,o.fieldNames,"expression contains missing fields")}catch(c){var l=c&&c.details;if(l&&(l.clause||l.where))throw c;l&&l.missingFields?s.push(...l.missingFields):s.push(a)}}else s.push(a);if(s.length)throw new u.a(j,r,{missingFields:s})}function w(e){return e.split(O)[0]}function F(e,t){var r=t.get(e);return!!r&&!S.has(r.type)}var T=r(668),A=r(877),B=r(755),N=r(168),E=r(311);var Q=class{constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;var s=0;for(var a of i){var n=w(a),u=this.fieldsIndex.get(n),o=u?null:M(n,r),l=u?u.name:a.split(O)[1]||"FIELD_EXP_"+s++;this._fieldDataCache.set(a,{alias:l,clause:o})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){var i=r?r.name:t,s=null;return this._fieldDataCache.has(i)?s=this._fieldDataCache.get(i).clause:r||(s=M(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:s})),r?this.featureAdapter.getAttribute(e,i):s.calculateValue(e,this.featureAdapter)}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:M(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:M(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}_processAttributesForOutFields(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);var r={};for(var i of t){var{alias:s,clause:a}=this._fieldDataCache.get(i);r[s]=a?a.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,s)}return r}_processAttributesForDistinctValues(e){if(Object(n.j)(e)||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t)for(var i of t){var{alias:s}=this._fieldDataCache.get(i);r.push(e[s])}else for(var a in e)r.push(e[a]);var u="".concat((t||["*"]).join(","),"=").concat(r.join(",")),o=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++o),o>1?null:e}};function P(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function C(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function G(e,t,r){return r?t-e:e-t}function Y(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var s=new Date(e).getTime(),a=new Date(t).getTime();if(!isNaN(s)&&!isNaN(a))return G(s,a,i)}if("number"==typeof e&&"number"==typeof t)return G(e,t,i);if("string"==typeof e&&"string"==typeof t){var n=e.toUpperCase(),u=t.toUpperCase();return!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?C(n,u,i):C(P(n),P(u),i)}return i?1:-1}class V{constructor(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter,this.aggregateAdapter=r.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(e){var t=new Q(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);var{groupByFieldsForStatistics:r,having:i}=e;if(!(null==r?void 0:r.length))return 1;var s=new Map,a=new Map,n=new Set,u=e.outStatistics;for(var o of u){var{statisticType:l}=o,c="exceedslimit"!==l?o.onStatisticField:void 0;if(!a.has(c)){var h=[];for(var d of r){var f=this._getAttributeValues(t,d,s);h.push(f)}a.set(c,this._calculateUniqueValues(h))}var m=a.get(c);for(var p in m){var{data:y,items:v}=m[p],g=y.join(",");i&&!t.validateItems(v,i)||n.add(g)}}return n.size}createQueryResponse(e){var t;return t=e.outStatistics?e.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(Object(o.i)(e.outSR)&&!Object(o.c)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=Object(T.b)(Object(i.a)({spatialReference:e.outSR},Object(b.b)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=Object(T.b)(Object(i.a)({spatialReference:e.outSR},this.queryGeometry))),t}createSnappingResponse(e,t){var r=this.featureAdapter,i=function(e,t){return e?t?4:3:t?3:2}(this.hasZ,this.hasM),{x:s,y:a}=e.point,n="number"==typeof e.distance?e.distance:e.distance.x,u="number"==typeof e.distance?e.distance:e.distance.y,o={candidates:[]},l="esriGeometryPolygon"===this.geometryType,c=this.getPointCreator(e.point,this.spatialReference,t);for(var h of this.items){var d=r.getGeometry(h);if(d){var{coords:f,lengths:m}=d;if(1&e.types)for(var p=0,y=0;y<m.length;y++)for(var v=m[y],g=0;g<v;g++,p+=i){var b=f[p],_=f[p+1];if(g!==v-1){var x=f[p+i],I=f[p+i+1],{x:j,y:O}=z(s,a,b,_,x,I),S=(s-j)/n,M=(a-O)/u,R=S*S+M*M;R<=1&&o.candidates.push({type:"edge",objectId:r.getObjectId(h),distance:Math.sqrt(R),target:c(j,O),start:c(b,_),end:c(x,I)})}}if(2&e.types)for(var w=l?f.length-i:f.length,F=0;F<w;F+=i){var T=f[F],A=f[F+1],B=(s-T)/n,N=(a-A)/u,E=B*B+N*N;E<=1&&o.candidates.push({type:"vertex",objectId:r.getObjectId(h),distance:Math.sqrt(E),target:c(T,A)})}}}return o.candidates.sort(((e,t)=>e.distance-t.distance)),o}getPointCreator(e,t,r){var i=Object(n.k)(r)&&!Object(o.c)(t,r)?e=>Object(b.b)(e,t,r):e=>e;return null!=e.z&&null!=e.m?(t,r)=>i({x:t,y:r,z:e.z,m:e.m}):null!=e.z?(t,r)=>i({x:t,y:r,z:e.z}):null!=e.m?(t,r)=>i({x:t,y:r,m:e.m}):(e,t)=>i({x:e,y:t})}executeAttributesQuery(e){var t=M(e.where,this.fieldsIndex);if(!t)return Promise.resolve(this);if(t.isStandardized){var r=0,i=[];for(var s of this.items)t.testFeature(s,this.featureAdapter)&&(i[r++]=s);var a=new V(i,this.queryGeometry,this);return a.definitionExpression=e.where,Promise.resolve(a)}return Promise.reject(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(e){if(!e.aggregateIds||!e.aggregateIds.length||Object(n.j)(this.aggregateAdapter))return Promise.resolve(this);var t=new Set;for(var r of e.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));var i=this.featureAdapter.getObjectId;return Promise.resolve(new V(this.items.filter((e=>t.has(i(e)))),this.queryGeometry,this))}executeObjectIdsQuery(e){if(!e.objectIds||!e.objectIds.length)return Promise.resolve(this);var t=new Set(e.objectIds),r=this.featureAdapter.getObjectId;return Promise.resolve(new V(this.items.filter((e=>t.has(r(e)))),this.queryGeometry,this))}executeTimeQuery(e){var t=Object(B.b)(this.timeInfo,e.timeExtent,this.featureAdapter);if(!Object(n.k)(t))return Promise.resolve(this);var r=this.items.filter(t);return Promise.resolve(new V(r,this.queryGeometry,this))}filterLatest(){var{trackIdField:e,startTimeField:t,endTimeField:r}=this.timeInfo,i=r||t,s=new Map,a=this.featureAdapter.getAttribute;for(var n of this.items){var u=a(n,e),o=a(n,i),l=s.get(u);(!l||o>a(l,i))&&s.set(u,n)}var c=Array.from(s.values());return Promise.resolve(new V(c,this.queryGeometry,this))}project(e){var t=this;return Object(s.a)((function*(){if(!e||Object(o.c)(t.spatialReference,e))return t;var r=t.featureAdapter,i=(yield Object(b.c)(t.items.map((e=>Object(T.c)(t.geometryType,t.hasZ,t.hasM,r.getGeometry(e)))),t.spatialReference,e)).map(((e,i)=>r.cloneWithGeometry(t.items[i],Object(N.d)(e,t.hasZ,t.hasM))));return new V(i,t.queryGeometry,{definitionExpression:t.definitionExpression,geometryType:t.geometryType,hasM:t.hasM,hasZ:t.hasZ,objectIdField:t.objectIdField,spatialReference:e,fieldsIndex:t.fieldsIndex,timeInfo:t.timeInfo,featureAdapter:t.featureAdapter})}))()}_sortFeatures(e,t,r){var i=this;if(e.length>1&&t&&t.length){var s=function(t){var s=t.split(" "),a=s[0],n=i.fieldsIndex.get(a),u=s[1]&&"desc"===s[1].toLowerCase();e.sort(((e,t)=>Y(r(e,a,n),r(t,a,n),n,u)))};for(var a of t.reverse())s(a)}}_createFeatureQueryResponse(e){var t=this.items,{geometryType:r,hasM:i,hasZ:s,objectIdField:a,spatialReference:n}=this,{outFields:u,outSR:o,quantizationParameters:l,resultRecordCount:c,resultOffset:h,returnZ:d,returnM:f}=e,m=null!=c&&t.length>(h||0)+c,p=u&&(u.indexOf("*")>-1?[...this.fieldsIndex.fields]:u.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:m,features:this._createFeatures(e,t),fields:p,geometryType:r,hasM:i&&f,hasZ:s&&d,objectIdFieldName:a,spatialReference:Object(T.b)(o||n),transform:l&&Object(E.c)(l)||null}}_createFeatures(e,t){var r=new Q(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:s}=this,{orderByFields:a,quantizationParameters:n,returnGeometry:u,returnCentroid:o,maxAllowableOffset:l,resultOffset:c,resultRecordCount:h,returnZ:d=!1,returnM:f=!1}=e,m=s&&d,p=i&&f,y=[],v=0,g=[...t];if(this._sortFeatures(g,a,((e,t,i)=>r.getFieldValue(e,t,i))),u||o){var b=Object(E.c)(n);if(u&&!o)for(var _ of g)y[v++]={attributes:r.getAttributes(_),geometry:Object(T.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(_),l,b,m,p)};else if(!u&&o)for(var x of g)y[v++]={attributes:r.getAttributes(x),centroid:Object(T.f)(this,this.featureAdapter.getCentroid(x,this),b)};else for(var I of g)y[v++]={attributes:r.getAttributes(I),centroid:Object(T.f)(this,this.featureAdapter.getCentroid(I,this),b),geometry:Object(T.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(I),l,b,m,p)}}else for(var j of g){var O=r.getAttributes(j);O&&(y[v++]={attributes:O})}var S=c||0;if(null!=h){var M=S+h;y=y.slice(S,Math.min(y.length,M))}return y}_createExceedsLimitQueryResponse(e){var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(var a of e.outStatistics)if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var n=this.hasZ?this.hasM?4:3:this.hasM?3:2,u=this.featureAdapter;t=this.items.reduce(((e,t)=>{var r=u.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/n>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){var t=this,r={attributes:{}},i=[],s=new Map,a=new Map,n=new Map,u=new Map,o=new Q(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:c,having:h,orderByFields:d}=e,f=c&&c.length,m=!!f,p=m&&c[0],y=m&&!this.fieldsIndex.get(p);for(var v of l){var{outStatisticFieldName:g,statisticType:b}=v,_=v,x="exceedslimit"!==b?v.onStatisticField:void 0,I="percentile_disc"===b||"percentile_cont"===b,j=m&&1===f&&(x===p||y)&&"count"===b;if(m){if(!n.has(x)){var O=[];for(var S of c){var M=this._getAttributeValues(o,S,s);O.push(M)}n.set(x,this._calculateUniqueValues(O,o.returnDistinctValues))}var R=n.get(x),w=function(e){var{count:r,data:i,items:a,itemPositions:n}=R[e],l=i.join(",");if(!h||o.validateItems(a,h)){var d=u.get(l)||{attributes:{}},f=null;if(j)f=r;else{var m=t._getAttributeValues(o,x,s),p=n.map((e=>m[e]));f=I&&"statisticParameters"in _?t._getPercentileValue(_,p):t._getStatisticValue(_,p)}d.attributes[g]=f,c.forEach(((e,r)=>d.attributes[t.fieldsIndex.get(e)?e:"EXPR_".concat(r+1)]=i[r])),u.set(l,d)}};for(var F in R)w(F)}else{var T=this._getAttributeValues(o,x,s);r.attributes[g]=I&&"statisticParameters"in _?this._getPercentileValue(_,T):this._getStatisticValue(_,T,a)}i.push({name:g,alias:g,type:"esriFieldTypeDouble"})}var A=m?Array.from(u.values()):[r];return this._sortFeatures(A,d,((e,t)=>e.attributes[t])),{fields:i,features:A}}_getStatisticValue(e,t,r){var{onStatisticField:i,statisticType:s}=e,a=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,a),a["var"===s?"variance":s]}_getPercentileValue(e,t){var{onStatisticField:r,statisticParameters:i,statisticType:s}=e,{value:a,orderBy:n}=i,u="desc"===n,o=this.fieldsIndex.get(r),l=[...t].filter((e=>null!=e)).sort(((e,t)=>Y(e,t,o,u)));return this._calculatePercentile(l,a,"percentile_disc"===s)}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),s=this.items.map((r=>e.getFieldValue(r,t,i)));return r.set(t,s),s}_calculateStatistics(e){var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,s=null,a=null,n=null,u=[],o=0;for(var l of e)"string"==typeof l?o++:null==l||isNaN(l)||(i+=l,t=Math.min(t,l),r=Math.max(r,l),u.push(l),o++);if(o){s=i/o;var c=0;for(var h of u)c+=Math.pow(h-s,2);n=o>1?c/(o-1):0,a=Math.sqrt(n)}else t=null,r=null;return{avg:s,count:o,max:r,min:t,stddev:a,sum:i,variance:n}}_calculateUniqueValues(e,t){for(var r={},i=this.items,s=i.length,a=0;a<s;a++){var n=i[a],u=[];for(var o of e)u.push(o[a]);var l=u.join(",");t?null==r[l]&&(r[l]={count:1,data:u,items:[n],itemPositions:[a]}):null==r[l]?r[l]={count:1,data:u,items:[n],itemPositions:[a]}:(r[l].count++,r[l].items.push(n),r[l].itemPositions.push(a))}return r}_calculatePercentile(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,s=Math.floor(i),a=s+1,n=i%1,u=e[s],o=e[a];return a>=e.length||r||"string"==typeof u||"string"==typeof o?u:u*(1-n)+o*n}}function z(e,t,r,i,s,a){var n=s-r,u=a-i,o=n*n+u*u,l=(e-r)*n+(t-i)*u,c=Math.min(1,Math.max(0,l/o));return{x:r+n*c,y:i+u*c}}var Z=V;var X="feature-store:unsupported-query";var q=new Set,D=new p.b(2e6),k=0;var L=Object(g.d)(),U=Object(g.d)();t.a=class{constructor(e){this.capabilities={query:v.a},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new p.a(k+++"$$",D)),this.fieldsIndex=new y.a(e.fields),e.scheduler&&e.task&&(this._frameQueue=new f.a,this._frameTask=e.scheduler.registerTask(e.task,(e=>this._update(e)),(()=>this._frameQueue.length>0)))}destroy(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(T.b)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(B.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}executeQuery(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e);try{s=yield r._schedule((()=>Object(T.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t),i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)}catch(n){if(n!==T.a)throw n;i=new Z([],null,r)}return i.createQueryResponse(s)}))()}executeQueryForCount(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=yield r._schedule((()=>Object(T.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t),i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)}catch(n){if(n!==T.a)throw n;return 0}return i.createQueryResponseForCount(s)}))()}executeQueryForExtent(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e),n=s.outSR;try{s=yield r._schedule((()=>Object(T.d)(s,r.definitionExpression,r.spatialReference)),t),(s=yield r._reschedule((()=>r._checkQuerySupport(s)),t)).returnGeometry=!0,s.returnCentroid=!1,s.outSR=null,i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t);var u=(i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)).size;if(!u)return{count:u,extent:null};Object(g.q)(U,g.a),r.featureStore.forEachBounds(i.items,(e=>Object(g.g)(U,e)),L);var o={xmin:U[0],ymin:U[1],xmax:U[3],ymax:U[4],spatialReference:Object(T.b)(r.spatialReference)};r.hasZ&&isFinite(U[2])&&isFinite(U[5])&&(o.zmin=U[2],o.zmax=U[5]);var l=Object(b.b)(o,i.spatialReference,n);if(l.spatialReference=Object(T.b)(n||r.spatialReference),l.xmax-l.xmin==0){var c=Object(h.f)(l.spatialReference);l.xmin-=c,l.xmax+=c}if(l.ymax-l.ymin==0){var d=Object(h.f)(l.spatialReference);l.ymin-=d,l.ymax+=d}if(r.hasZ&&null!=l.zmin&&null!=l.zmax&&l.zmax-l.zmin==0){var f=Object(h.f)(l.spatialReference);l.zmin-=f,l.zmax+=f}return{count:u,extent:l}}catch(m){if(m===T.a)return{count:0,extent:null};throw m}}))()}executeQueryForIds(e={},t){var r=this;return Object(s.a)((function*(){return r.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}))()}executeQueryForIdSet(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=yield r._schedule((()=>Object(T.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t);var n=(i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)).items,u=new Set;return yield r._reschedule((()=>{for(var e of n)u.add(i.featureAdapter.getObjectId(e))}),t),u}catch(o){if(o===T.a)return new Set;throw o}}))()}executeQueryForSnapping(e,t){var r=this;return Object(s.a)((function*(){var{point:s,distance:a,types:u}=e;if(0===u)return{candidates:[]};var l=yield r._reschedule((()=>r._checkQuerySupport(e.query)),t),h=!Object(o.c)(s.spatialReference,r.spatialReference);h&&(yield Object(b.a)(s.spatialReference,r.spatialReference));var d="number"==typeof a?a:a.x,f="number"==typeof a?a:a.y,p={xmin:s.x-d,xmax:s.x+d,ymin:s.y-f,ymax:s.y+f,spatialReference:s.spatialReference},y=h?Object(b.b)(p,r.spatialReference):p;if(!y)return{candidates:[]};var v=(yield Object(m.a)(Object(c.a)(s),null,{signal:t}))[0],g=(yield Object(m.a)(Object(c.a)(y),null,{signal:t}))[0];if(Object(n.j)(v)||Object(n.j)(g))return{candidates:[]};var _=new Z(r._searchFeatures(r._getQueryBBoxes(g.toJSON())),null,r);_=yield r._reschedule((()=>_.executeObjectIdsQuery(l)),t),_=yield r._reschedule((()=>_.executeTimeQuery(l)),t),_=yield r._reschedule((()=>_.executeAttributesQuery(l)),t);var x=v.toJSON(),I=h?Object(b.b)(x,r.spatialReference):x,j=h?Math.max(y.xmax-y.xmin,y.ymax-y.ymin)/2:a;return _.createSnappingResponse(Object(i.a)(Object(i.a)({},e),{},{point:I,distance:j}),s.spatialReference)}))()}executeQueryForLatestObservations(e={},t){var r=this;return Object(s.a)((function*(){if(!r.timeInfo||!r.timeInfo.trackIdField)throw new u.a(X,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:r.timeInfo});var i,s=Object(a.a)(e);try{s=yield r._schedule((()=>Object(T.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t),i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t),i=yield r._reschedule((()=>i.filterLatest()),t)}catch(n){if(n!==T.a)throw n;i=new Z([],null,r)}return i.createQueryResponse(s)}))()}_schedule(e,t){var r=this;return Object(s.a)((function*(){return r._frameQueue?r._frameQueue.push(e,t):e()}))()}_reschedule(e,t){var r=this;return Object(s.a)((function*(){return r._frameQueue?r._frameQueue.unshift(e,t):e()}))()}_update(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null}_getAll(){if(!this._allItems){var e=[];this.featureStore.forEach((t=>e.push(t))),this._allItems=new Z(e,null,this)}return this._allItems}_executeGeometryQuery(e,t){var r=this;return Object(s.a)((function*(){var{geometry:i,outSR:a,spatialRel:u,returnGeometry:l,returnCentroid:c}=e,h=l||c,d=Object(o.i)(a)&&!Object(o.c)(r.spatialReference,a),f=r._geometryQueryCache?d&&h?JSON.stringify({geometry:i,spatialRelationship:u,outSpatialReference:a}):JSON.stringify({geometry:i,spatialRelationship:u}):null;if(f){var m=r._geometryQueryCache.get(f);if(!Object(n.l)(m))return m}var p=function(){var e=Object(s.a)((function*(e){if(d&&h){var t=yield e.project(a);return f&&r._geometryQueryCache.put(f,t,t.size||1),t}return f&&r._geometryQueryCache.put(f,e,e.size||1),e}));return function(t){return e.apply(this,arguments)}}();if(!i)return p(r._getAll());var y=r.featureAdapter;if("esriSpatialRelDisjoint"===u){var v,g,b=r._searchFeatures(r._getQueryBBoxes(i));if(!b.length)return p(r._getAll());var _=new Set;for(var x of b)_.add(y.getObjectId(x));return yield r._reschedule((()=>{var e=0;v=new Array(_.size),r.featureStore.forEach((t=>v[e++]=t)),g=_}),t),p(yield r._reschedule(Object(s.a)((function*(){var e=yield Object(A.c)(u,i,r.geometryType,r.hasZ,r.hasM);return new Z(yield r._runSpatialFilter(v,(t=>!g.has(y.getObjectId(t))||e(y.getGeometry(t))),t),i,r)})),t))}var I=r._searchFeatures(r._getQueryBBoxes(i));if(!I.length){var j=new Z([],i,r);return f&&r._geometryQueryCache.put(f,j,j.size||1),j}if(r._canExecuteSoloPass(i,e))return p(new Z(I,i,r));var O=yield Object(A.c)(u,i,r.geometryType,r.hasZ,r.hasM),S=yield r._runSpatialFilter(I,(e=>O(y.getGeometry(e))),t);return p(new Z(S,i,r))}))()}_runSpatialFilter(e,t,r){var i=this;return Object(s.a)((function*(){if(!t)return e;if(!i._budget)return e.filter((e=>t(e)));var a=0,n=new Array,u=function(){var o=Object(s.a)((function*(){for(;a<e.length;){var s=e[a];t(s)&&n.push(s),i._budget.done&&(yield i._reschedule((()=>u()),r)),++a}}));return function(){return o.apply(this,arguments)}}();return i._reschedule((()=>u()),r).then((()=>n))}))()}_canExecuteSoloPass(e,t){var{geometryType:r}=this,{spatialRel:i}=t;return Object(A.a)(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))}_getQueryBBoxes(e){if(Object(A.a)(e)){if(Object(c.d)(e))return[Object(d.n)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(c.g)(e))return e.rings.map((e=>Object(d.n)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[Object(l.a)(Object(d.i)(),e)]}_searchFeatures(e){for(var t of e)this.featureStore.forEachInBounds(t,(e=>{q.add(e)}));var r=new Array(q.size),i=0;return q.forEach((e=>r[i++]=e)),q.clear(),r}_checkQuerySupport(e){var t=this;return Object(s.a)((function*(){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new u.a(X,"Unsupported query options",{query:e});return Promise.all([t._checkAttributesQuerySupport(e),t._checkStatisticsQuerySupport(e),Object(A.b)(e,t.geometryType,t.spatialReference),Object(b.a)(t.spatialReference,e.outSR)]).then((()=>e))}))()}_checkAttributesQuerySupport(e){var{outFields:t,orderByFields:r,returnDistinctValues:i,outStatistics:s}=e,a=s?s.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())):[];if(r&&r.length>0){var n=" asc",o=" desc",l=r.map((e=>{var t=e.toLowerCase();return t.indexOf(n)>-1?t.split(n)[0]:t.indexOf(o)>-1?t.split(o)[0]:e})).filter((e=>-1===a.indexOf(e)));R(this.fieldsIndex,l,"orderByFields contains missing fields")}if(t&&t.length>0)R(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new u.a(X,"outFields should be specified for returnDistinctValues",{query:e});!function(e,t){if(!t)return!0;var r=I.get(t,e);if(!r)throw new u.a(j,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new u.a(j,"where clause is not standard",{where:t});R(e,r.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,e.where)}_checkStatisticsQuerySupport(e){var t=this;return Object(s.a)((function*(){var{outStatistics:r,groupByFieldsForStatistics:i,having:s}=e,a=i&&i.length,n=r&&r.length;if(s){if(!a||!n)throw new u.a(X,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});!function(e,t,r){if(!t)return!0;var i=I.get(t,e);if(!i)throw new u.a(j,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new u.a(j,"having does not contain a valid aggregate function",{having:t});var s=i.fieldNames;if(R(e,s,"having contains missing fields"),!i.getExpressions().every((t=>{var{aggregateType:i,field:s}=t,a=e.has(s)&&e.get(s).name;return r.some((t=>{var{onStatisticField:r,statisticType:s}=t;return(e.has(r)&&e.get(r).name)===a&&s.toLowerCase().trim()===i}))})))throw new u.a(j,"expressions in having should also exist in outStatistics",{having:t})}(t.fieldsIndex,s,r)}if(n){if(!function(e){return e.every((e=>"exceedslimit"!==e.statisticType))}(r))return;var o=r.map((e=>e.onStatisticField));for(var l of(R(t.fieldsIndex,o,"onStatisticFields contains missing fields"),a&&R(t.fieldsIndex,i,"groupByFieldsForStatistics contains missing fields"),r)){var{onStatisticField:c,statisticType:h}=l;if("percentile_disc"!==h&&"percentile_cont"!==h||!("statisticParameters"in l)){if("count"!==h&&c&&F(c,t.fieldsIndex))throw new u.a(X,"outStatistics contains non-numeric fields",{definition:l,query:e})}else{var{statisticParameters:d}=l;if(!d)throw new u.a(X,"statisticParamters should be set for percentile type",{definition:l,query:e})}}}}))()}}},837:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},876:function(e,t,r){"use strict";var i=r(89),s=r(81),a=r(93),n=r(131),u=r(125),o=r(168),l=r(279),c=r(1082),h=r(292),d=r(178),f=r(469),m={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new h.a(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(e.centroid||(e.centroid=Object(f.a)(new d.a,e.geometry,t.hasZ,t.hasM)),e.centroid)};t.a=class{constructor(e){this.geometryInfo=e,this._boundsStore=new c.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new n.a,this.featureAdapter=m}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){if(!this.numFeatures)return null;var e=Object(u.i)(u.a);return this._featuresById.forEach((t=>{var r=this._boundsStore.get(t.objectId);r&&(e[0]=Math.min(r[0],e[0]),e[1]=Math.min(r[1],e[1]),e[2]=Math.max(r[2],e[2]),e[3]=Math.max(r[3],e[3]))})),e}get storeStatistics(){var e=0;return this._featuresById.forEach((t=>{t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(var t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){for(var t of(this._boundsStore.invalidateIndex(),e)){var r=this._featuresById.get(t);r&&this._remove(r)}this._emitChanged()}forEachBounds(e,t,r){for(var i of e){var s=this._boundsStore.get(i.objectId);s&&t(Object(l.k)(r,s))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){var e=!1;this._featuresById.forEach(((t,r)=>{this._markedIds.has(r)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.displayId=n.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):Object(i.k)(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=Object(o.r)(r||Object(u.i)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else s.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new a.a("featurestore:invalid-feature","feature id is missing",{feature:e}))}}_remove(e){return Object(i.k)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}},877:function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return O}));var i=r(7),s=r(93),a=r(112),n=r(309),u=r(354),o=r(100),l=r(178),c=r(168);function h(e,t){return e?t?4:3:t?3:2}function d(e,t,r,i,s){if(!e)return!1;var a=h(t,r),{coords:n,lengths:u}=e,o=!1,l=0;for(var c of u)o=f(o,n,a,l,c,i,s),l+=c*a;return o}function f(e,t,r,i,s,a,n){for(var u=e,o=i,l=i,c=i+s*r;l<c;l+=r){(o=l+r)===c&&(o=i);var h=t[l],d=t[l+1],f=t[o],m=t[o+1];(d<n&&m>=n||m<n&&d>=n)&&h+(n-d)/(m-d)*(f-h)<a&&(u=!u)}return u}var m=r(400),p=r(668),y="feature-store:unsupported-query",v={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function x(e){return!0===g[e]}function I(e){return!0===b[Object(o.c)(e)]}function j(e){return!0===_[e]}function O(e,t,i,s,a){if(Object(o.g)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var f=Object(c.g)(new l.a,t,!1,!1);return Promise.resolve((e=>function(e,t,r,i){return d(e,t,r,i.coords[0],i.coords[1])}(f,!1,!1,e)))}if(Object(o.g)(t)&&"esriGeometryMultipoint"===i){var m=Object(c.g)(new l.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>function(e,t,r,i,s,a){var n=h(s,a),{coords:u,lengths:o}=i;if(!o)return!1;for(var l=0,c=0;l<o.length;l++,c+=n)if(!d(e,t,r,u[c],u[c+1]))return!1;return!0}(m,!1,!1,e,s,a)))}if(Object(o.d)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>Object(n.e)(t,Object(p.c)(i,s,a,e))));if(Object(o.d)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((e=>Object(n.d)(t,Object(p.c)(i,s,a,e))));if(Object(o.d)(t)&&"esriSpatialRelIntersects"===e){var y=Object(u.b)(i);return Promise.resolve((e=>y(t,Object(p.c)(i,s,a,e))))}return Promise.all([r.e(9),r.e(28)]).then(r.bind(null,788)).then((r=>{var n=r[v[e]].bind(null,t.spatialReference,t);return e=>n(Object(p.c)(i,s,a,e))}))}function S(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(i.a)((function*(e,t,r){var{spatialRel:i,geometry:n}=e;if(n){if(!x(i))throw new s.a(y,"Unsupported query spatial relationship",{query:e});if(Object(a.i)(n.spatialReference)&&Object(a.i)(r)){if(!I(n))throw new s.a(y,"Unsupported query geometry type",{query:e});if(!j(t))throw new s.a(y,"Unsupported layer geometry type",{query:e});if(e.outSR)return Object(m.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}))).apply(this,arguments)}function R(e){if(Object(o.d)(e))return!0;if(Object(o.g)(e)){for(var t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},966:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(89),s=r(209),a=r(176),n=r(497);class u{constructor(e=9,t){this.compareMinX=h,this.compareMinY=d,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),_.prune(),x.prune(),I.prune(),j.prune()}all(e){this._all(this.data,e)}search(e,t){var r=this.data,i=this.toBBox;if(g(e,r))for(_.clear();r;){for(var s=0,a=r.children.length;s<a;s++){var n=r.children[s],u=r.leaf?i(n):n;g(e,u)&&(r.leaf?t(n):v(e,u)?this._all(n,t):_.push(n))}r=_.pop()}}collides(e){var t=this.data,r=this.toBBox;if(!g(e,t))return!1;for(_.clear();t;){for(var i=0,s=t.children.length;i<s;i++){var a=t.children[i],n=t.leaf?r(a):a;if(g(e,n)){if(t.leaf||v(e,n))return!0;_.push(a)}}t=_.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=new S([]),this}remove(e){if(!e)return this;var t,r=this.data,a=null,n=0,u=!1,o=this.toBBox(e);for(I.clear(),j.clear();r||I.length>0;){var l;if(r||(r=Object(i.d)(I.pop()),a=I.data[I.length-1],n=null!=(l=j.pop())?l:0,u=!0),r.leaf&&-1!==(t=Object(s.e)(r.children,e,r.children.length,r.indexHint)))return r.children.splice(t,1),I.push(r),this._condense(I),this;u||r.leaf||!v(r,o)?a?(n++,r=a.children[n],u=!1):r=null:(I.push(r),j.push(n),n=0,a=r,r=r.children[0])}return this}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){var r=e;for(x.clear();r;){var i;if(!0===r.leaf)for(var s of r.children)t(s);else x.pushArray(r.children);r=null!=(i=x.pop())?i:null}}_build(e,t,r,i){var s=r-t+1,a=this._maxEntries;if(s<=a){var n=new S(e.slice(t,r+1));return o(n,this.toBBox),n}i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1)));var u=new M([]);u.height=i;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));b(e,t,r,c,this.compareMinX);for(var h=t;h<=r;h+=c){var d=Math.min(h+c-1,r);b(e,h,d,l,this.compareMinY);for(var f=h;f<=d;f+=l){var m=Math.min(f+l-1,d);u.children.push(this._build(e,f,m,i-1))}}return o(u,this.toBBox),u}_chooseSubtree(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){for(var s=void 0,a=1/0,n=1/0,u=0,o=t.children.length;u<o;u++){var l=t.children[u],c=f(l),h=p(e,l)-c;h<n?(n=h,a=c<a?c:a,s=l):h===n&&c<a&&(a=c,s=l)}t=s||t.children[0]}return t}_insert(e,t,r){var i=this.toBBox,s=r?e:i(e);I.clear();var a=this._chooseSubtree(s,this.data,t,I);for(a.children.push(e),c(a,s);t>=0&&I.data[t].children.length>this._maxEntries;)this._split(I,t),t--;this._adjustParentBBoxes(s,I,t)}_split(e,t){var r=e.data[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);var a=this._chooseSplitIndex(r,s,i);if(a){var n=r.children.splice(a,r.children.length-a),u=r.leaf?new S(n):new M(n);u.height=r.height,o(r,this.toBBox),o(u,this.toBBox),t?e.data[t-1].children.push(u):this._splitRoot(r,u)}else console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}_splitRoot(e,t){this.data=new M([e,t]),this.data.height=e.height+1,o(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){var i,s,a;i=s=1/0;for(var n=t;n<=r-t;n++){var u=l(e,0,n,this.toBBox),o=l(e,n,r,this.toBBox),c=y(u,o),h=f(u)+f(o);c<i?(i=c,a=n,s=h<s?h:s):c===i&&h<s&&(s=h,a=n)}return a}_chooseSplitAxis(e,t,r){var i=e.leaf?this.compareMinX:h,s=e.leaf?this.compareMinY:d;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,s)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);for(var s=this.toBBox,a=l(e,0,t,s),n=l(e,r-t,r,s),u=m(a)+m(n),o=t;o<r-t;o++){var h=e.children[o];c(a,e.leaf?s(h):h),u+=m(a)}for(var d=r-t-1;d>=t;d--){var f=e.children[d];c(n,e.leaf?s(f):f),u+=m(n)}return u}_adjustParentBBoxes(e,t,r){for(var i=r;i>=0;i--)c(t.data[i],e)}_condense(e){for(var t=e.length-1;t>=0;t--){var r=e.data[t];if(0===r.children.length)if(t>0){var i=e.data[t-1],a=i.children;a.splice(Object(s.e)(a,r,a.length,i.indexHint),1)}else this.clear();else o(r,this.toBBox)}}_initFormat(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function o(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,i,s){s||(s=new S([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,n=t;n<r;n++)a=e.children[n],c(s,e.leaf?i(a):a);return s}function c(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function f(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function y(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,s-r)*Math.max(0,a-i)}function v(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,r,s,a){for(var u=[t,r];u.length;){var o=Object(i.d)(u.pop()),l=Object(i.d)(u.pop());if(!(o-l<=s)){var c=l+Math.ceil((o-l)/s/2)*s;Object(n.a)(e,c,l,o,a),u.push(l,c,c,o)}}}var _=new a.a,x=new a.a,I=new a.a,j=new a.a({deallocator:void 0});class O extends class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}{constructor(){super(...arguments),this.height=1,this.indexHint=new s.a}}class S extends O{constructor(e){super(),this.children=e,this.leaf=!0}}class M extends O{constructor(e){super(),this.children=e,this.leaf=!1}}}}]);
//# sourceMappingURL=16.b20d18f4.chunk.js.map