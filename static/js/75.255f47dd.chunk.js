(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[75,11,22,114,168,273,274,282],{104:function(e,t,r){"use strict";function i(){return[0,0,0]}function s(e){return[e[0],e[1],e[2]]}function a(e,t,r){return[e,t,r]}function n(e){for(var t=[0,0,0],r=Math.min(3,e.length),i=0;i<r;++i)t[i]=e[i];return t}function o(e,t){return new Float64Array(e,t,3)}function u(){return[0,0,0]}function l(){return a(1,1,1)}function c(){return a(1,0,0)}function h(){return a(0,1,0)}function d(){return a(0,0,1)}r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return i})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return a}));var f=[0,0,0],p=l(),g=c(),m=h(),v=d();Object.freeze({__proto__:null,create:i,clone:s,fromValues:a,fromArray:n,createView:o,zeros:u,ones:l,unitX:c,unitY:h,unitZ:d,ZEROS:f,ONES:p,UNIT_X:g,UNIT_Y:m,UNIT_Z:v})},111:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return I})),r.d(t,"d",(function(){return d})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return b})),r.d(t,"h",(function(){return O})),r.d(t,"i",(function(){return l})),r.d(t,"j",(function(){return n})),r.d(t,"k",(function(){return g})),r.d(t,"l",(function(){return j})),r.d(t,"m",(function(){return E})),r.d(t,"n",(function(){return p})),r.d(t,"o",(function(){return a})),r.d(t,"p",(function(){return F})),r.d(t,"q",(function(){return y})),r.d(t,"r",(function(){return m})),r.d(t,"s",(function(){return v})),r.d(t,"t",(function(){return w})),r.d(t,"u",(function(){return M})),r.d(t,"v",(function(){return o})),r.d(t,"w",(function(){return x})),r.d(t,"x",(function(){return N})),r.d(t,"y",(function(){return A})),r.d(t,"z",(function(){return R}));var i=r(104),s=r(184);function a(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function o(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function u(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function l(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function c(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function h(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function d(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function f(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function p(e,t){var r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}function g(e,t){var r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function m(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function y(e,t){var r=t[0],i=t[1],s=t[2],a=r*r+i*i+s*s;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _(e,t,r){var i=t[0],s=t[1],a=t[2],n=r[0],o=r[1],u=r[2];return e[0]=s*u-a*o,e[1]=a*n-i*u,e[2]=i*o-s*n,e}function O(e,t,r,i){var s=t[0],a=t[1],n=t[2];return e[0]=s+i*(r[0]-s),e[1]=a+i*(r[1]-a),e[2]=n+i*(r[2]-n),e}function j(e,t,r){var i=t[0],s=t[1],a=t[2];return e[0]=r[0]*i+r[4]*s+r[8]*a+r[12],e[1]=r[1]*i+r[5]*s+r[9]*a+r[13],e[2]=r[2]*i+r[6]*s+r[10]*a+r[14],e}function x(e,t,r){var i=t[0],s=t[1],a=t[2];return e[0]=i*r[0]+s*r[3]+a*r[6],e[1]=i*r[1]+s*r[4]+a*r[7],e[2]=i*r[2]+s*r[5]+a*r[8],e}function w(e,t,r){var i=r[0],s=r[1],a=r[2],n=r[3],o=t[0],u=t[1],l=t[2],c=s*l-a*u,h=a*o-i*l,d=i*u-s*o,f=s*d-a*h,p=a*c-i*d,g=i*h-s*c,m=2*n;return c*=m,h*=m,d*=m,f*=2,p*=2,g*=2,e[0]=o+c+f,e[1]=u+h+p,e[2]=l+d+g,e}function I(e,t,r,i){var s=[],a=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],a[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),a[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),a[2]=s[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}var S=Object(i.e)(),T=Object(i.e)();function F(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var M=l,k=c,C=h,R=p,A=g,E=a,N=m;Object.freeze({__proto__:null,length:a,copy:n,set:o,add:u,subtract:l,multiply:c,divide:h,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},max:function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:d,scaleAndAdd:f,distance:p,squaredDistance:g,squaredLength:m,negate:v,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:y,dot:b,cross:_,lerp:O,hermite:function(e,t,r,i,s,a){var n=a*a,o=n*(2*a-3)+1,u=n*(a-2)+a,l=n*(a-1),c=n*(3-2*a);return e[0]=t[0]*o+r[0]*u+i[0]*l+s[0]*c,e[1]=t[1]*o+r[1]*u+i[1]*l+s[1]*c,e[2]=t[2]*o+r[2]*u+i[2]*l+s[2]*c,e},bezier:function(e,t,r,i,s,a){var n=1-a,o=n*n,u=a*a,l=o*n,c=3*a*o,h=3*u*n,d=u*a;return e[0]=t[0]*l+r[0]*c+i[0]*h+s[0]*d,e[1]=t[1]*l+r[1]*c+i[1]*h+s[1]*d,e[2]=t[2]*l+r[2]*c+i[2]*h+s[2]*d,e},random:function(e,t){t=t||1;var r=2*Object(s.b)()*Math.PI,i=2*Object(s.b)()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e},transformMat4:j,transformMat3:x,transformQuat:w,rotateX:function(e,t,r,i){var s=[],a=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],a[0]=s[0],a[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),a[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateY:function(e,t,r,i){var s=[],a=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],a[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),a[1]=s[1],a[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},rotateZ:I,angle:function(e,t){n(S,e),n(T,t),y(S,S),y(T,T);var r=b(S,T);return r>1?0:r<-1?Math.PI:Math.acos(r)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:F,equals:function(e,t){var r=e[0],i=e[1],a=e[2],n=t[0],o=t[1],u=t[2];return Math.abs(r-n)<=s.a*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=s.a*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(a-u)<=s.a*Math.max(1,Math.abs(a),Math.abs(u))},sub:M,mul:k,div:C,dist:R,sqrDist:A,len:E,sqrLen:N})},115:function(e,t,r){"use strict";var i=r(82),s=r(89),a=r(85),n=r(84),o=r(97),u=r(107),l=class extends o.a{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){var e=0;return this._groups.forEach((t=>{e+=t.length})),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!u.a.isCollection(e))return this;var r=this._getOrCreateGroup(t);return Array.isArray(e)||u.a.isCollection(e)?e.forEach((e=>this._isHandle(e)&&r.push(e))):r.push(e),this.notifyChange("size"),this}forEach(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{var r=this._getGroup(e);r&&t&&r.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||u.a.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;for(var t=this._getGroup(e),r=0;r<t.length;r++)t[r].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach((e=>{for(var t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);var t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return Object(s.d)(this._groups.get(this._ensureGroupKey(e)))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};Object(i.a)([Object(a.b)({readOnly:!0})],l.prototype,"size",null);var c=l=Object(i.a)([Object(n.a)("esri.core.Handles")],l);t.a=c},117:function(e,t,r){"use strict";r.d(t,"a",(function(){return V})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return T})),r.d(t,"d",(function(){return L})),r.d(t,"e",(function(){return D})),r.d(t,"f",(function(){return z})),r.d(t,"g",(function(){return P})),r.d(t,"h",(function(){return G})),r.d(t,"i",(function(){return q})),r.d(t,"j",(function(){return c})),r.d(t,"k",(function(){return S})),r.d(t,"l",(function(){return x})),r.d(t,"m",(function(){return E})),r.d(t,"n",(function(){return Q})),r.d(t,"o",(function(){return w})),r.d(t,"p",(function(){return O})),r.d(t,"q",(function(){return j})),r.d(t,"r",(function(){return A})),r.d(t,"s",(function(){return k})),r.d(t,"t",(function(){return C})),r.d(t,"u",(function(){return R})),r.d(t,"v",(function(){return F})),r.d(t,"w",(function(){return M})),r.d(t,"x",(function(){return N}));var i=r(91),s=(r(80),r(95)),a=r(257),n=r(112),o=r(99),u=r(139),l=r(173),c=39.37,h=u.a.radius*Math.PI/200,d=/UNIT\[([^\]]+)\]\]$/i,f=a.a,p=/UNIT\[([^\]]+)\]/i,g=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),m=Object(s.b)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),v=e=>e*e,y=e=>e*e*e,b={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:v(.001)},"square-centimeters":{inBaseUnits:v(.01)},"square-decimeters":{inBaseUnits:v(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:v(1e3)},"square-inches":{inBaseUnits:v(.0254)},"square-feet":{inBaseUnits:v(.3048)},"square-yards":{inBaseUnits:v(.9144)},"square-miles":{inBaseUnits:v(1609.344)},"square-us-feet":{inBaseUnits:v(1200/3937)},acres:{inBaseUnits:.0015625*v(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*y(.001)},"cubic-centimeters":{inBaseUnits:1e3*y(.01)},"cubic-decimeters":{inBaseUnits:1e3*y(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*y(1e3)},"cubic-inches":{inBaseUnits:1e3*y(.0254)},"cubic-feet":{inBaseUnits:1e3*y(.3048)},"cubic-yards":{inBaseUnits:1e3*y(.9144)},"cubic-miles":{inBaseUnits:1e3*y(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},_=function(){var e={};for(var t in b)for(var r in b[t].units)e[r]=t;return e}();var O=["metric","imperial","square-inches","square-feet","square-yards","square-miles","square-us-feet","square-meters","square-kilometers","acres","ares","hectares"],j=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function x(e){return"imperial"===e||"metric"===e}function w(e){var t=_[e];if(t)return t;throw new Error("unknown measure")}function I(e){return function(e){return b[e].baseUnit}(w(e))}function S(e,t=null){return t=t||w(e),b[t].baseUnit===e}function T(e,t,r){if(t===r)return e;var i=w(t);if(i!==w(r))throw new Error("incompatible units");var s=S(t,i)?e:function(e,t,r){return e*b[r].units[t].inBaseUnits}(e,t,i);return S(r,i)?s:function(e,t,r){return e/b[r].units[t].inBaseUnits}(s,r,i)}function F(e,t){return T(e,t,"meters")<3e3?"meters":"kilometers"}function M(e,t){return T(e,t,"meters")<1e5?"meters":"kilometers"}function k(e,t){return T(e,t,"feet")<1e3?"feet":"miles"}function C(e,t){return T(e,t,"feet")<1e5?"feet":"miles"}function R(e,t){return T(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"}function A(e,t){return T(e,t,"square-feet")<1e6?"square-feet":"square-miles"}function E(e,t,r){return T(e,t,"meters")/(r*Math.PI/180)}function N(e){return m.fromJSON(e.toLowerCase())||null}function P(e){if(e&&"object"==typeof e&&!Object(n.e)(e))return 1;var t=z(e);return t>1e5?1:t}function q(e){return z(e)>=(e instanceof o.a?Object(l.e)(e).metersPerDegree:1e5)?"meters":G(e)}function z(e,t=u.a.metersPerDegree){return D(e,!0)||t}function D(e,t=!1){var r,i,s=null;if(null!=e&&("object"==typeof e?(r=e.wkid,i=e.wkt):"number"==typeof e?r=e:"string"==typeof e&&(i=e)),r){if(Object(n.k)(r))return u.b.metersPerDegree;if(Object(n.l)(r))return u.c.metersPerDegree;!(s=f.values[f[r]])&&t&&g.has(r)&&(s=h)}else if(i)if(-1!==i.search(/^PROJCS/i)){var a=d.exec(i);a&&a[1]&&(s=parseFloat(a[1].split(",")[1]))}else if(-1!==i.search(/^GEOCCS/i)){var o=p.exec(i);o&&o[1]&&(s=parseFloat(o[1].split(",")[1]))}return s}function G(e){var t,r,i=null;if(null!=e&&("object"==typeof e?(t=e.wkid,r=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(r=e)),t)i=f.units[f[t]];else if(r&&-1!==r.search(/^PROJCS/i)){var s=d.exec(r);s&&s[1]&&(i=(s=/[\\"\\']{1}([^\\"\\']+)/.exec(s[1]))&&s[1])}return i?N(i):null}function L(e){if(!e)return null;switch(G(e)){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null}return null}var U={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},B={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},V=Object(s.b)()(U),Q=Object(s.b)()(B);Object(s.b)()(Object(i.a)(Object(i.a)({},U),B))},1222:function(e,t,r){"use strict";r.r(t),r.d(t,"getInstances",(function(){return dt}));var i=r(7),s=r(82),a=r(80),n=r(81),o=(r(88),r(85)),u=r(84),l=(r(83),r(86),r(87),r(167)),c=r(336),h=r(508),d=r(555);class f{constructor(){this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}static create(e){var t=new f;for(var r in e){var i=e[r];if("object"==typeof i)for(var s in i){var a=i[s];t[r][s]=a}t[r]=i}return t}static empty(){return f.create({})}static all(){return f.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})}unset(e){e.source&&(this.source=!1),e.targets.feature&&(this.targets.feature=!1),e.targets.aggregate&&(this.targets.aggregate=!1),e.storage.filters&&(this.storage.filters=!1),e.storage.data&&(this.storage.data=!1),e.mesh&&(this.mesh=!1),e.queryFilter&&(this.queryFilter=!1)}any(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter}describe(){var e=0,t="";if(this.mesh)for(var r of(e+=20,t+="-> (20) Mesh needs update\n",this.why.mesh))t+="    + ".concat(r,"\n");if(this.source)for(var i of(e+=10,t+="-> (10) The source needs update\n",this.why.source))t+="    + ".concat(i,"\n");this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed");var s=e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow";console.debug("Applying ".concat(s," update of cost ").concat(e,"/45 ")),console.debug(t)}toJSON(){return{queryFilter:this.queryFilter,source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh}}}var p=r(91),g=r(89),m=r(94),v=r(108),y=r(168),b=r(207),_=r(496),O=r(711),j=r(366),x=r(563),w=r(969),I=r(766),S=r(242),T=r(93),F=r(106),M=r(132),k=r(275),C=r(190),R=r(112),A=r(99),E=r(161),N=(r(101),r(237),r(316)),P=(r(146),r(967)),q=(r(782),n.a.getLogger("esri.layers.graphics.sources.ogcfeature"),"json");function z(e,t,r){return D.apply(this,arguments)}function D(){return(D=Object(i.a)((function*(e,t,r){var{capabilities:{query:{maxRecordCount:i}},collectionId:s,layerDefinition:a,spatialReference:n,supportedCrs:o,url:u}=e,l="".concat(u,"/collections/").concat(s,"/items"),{geometry:c,num:h,start:d,timeExtent:f,where:m}=t;if(t.objectIds)throw new T.a("ogc-feature-layer:query-by-objectids-not-supported","Queries with objectids are not supported");var v=A.a.fromJSON(n),b=Object(g.r)(t.outSpatialReference,v),_=b.isWGS84?null:G(b,o),O=V(c,o),j=U(f),x=B(m),w=null!=h?h:null!=d&&void 0!==d?10:i,{data:I}=yield Object(F.default)(l,Object(p.a)(Object(p.a)({},r),{},{query:Object(p.a)(Object(p.a)({},O),{},{crs:_,datetime:j,query:x,limit:w,startindex:d,f:q})})),S=!1;I.links&&(S=!!I.links.find((e=>"next"===e.rel))),!S&&Number.isInteger(I.numberMatched)&&Number.isInteger(I.numberReturned)&&(S=I.numberReturned<I.numberMatched);var{fields:M,globalIdField:k,hasM:C,hasZ:z,objectIdField:D}=a,L=a.geometryType,Q=Object(P.a)(I,{geometryType:L,hasZ:z,objectIdFieldName:D});if(!_&&b.isWebMercator)for(var Y of Q)if(Y.geometry){var X=Object(y.k)(Y.geometry,L,z,!1);X.spatialReference=A.a.WGS84,Y.geometry=Object(y.d)(Object(E.d)(X,b))}for(var J of Q)J.objectId=J.attributes[D];var Z=_||!_&&b.isWebMercator?b.toJSON():R.a,H=new N.a;return H.exceededTransferLimit=S,H.features=Q,H.fields=M,H.geometryType=L,H.globalIdFieldName=k,H.hasM=C,H.hasZ=z,H.objectIdFieldName=D,H.spatialReference=Z,H}))).apply(this,arguments)}function G(e,t){return t.find((t=>{var r=function(e){var t=new RegExp("^http://www.opengis.net/def/crs/(?<authority>.*)/(?<version>.*)/(?<code>.*)$","i").exec(e),r=null==t?void 0:t.groups;if(!r)return null;var{authority:i,code:s}=r;switch(i.toLowerCase()){case"ogc":switch(s.toLowerCase()){case"crs27":return A.a.GCS_NAD_1927;case"crs83":return new A.a({wkid:4269});case"crs84":case"crs84h":return A.a.WGS84;default:return null}case"esri":case"epsg":var a=Number.parseInt(s,10);return Number.isNaN(a)?null:900913===a?A.a.WebMercator:new A.a({wkid:a});default:return null}}(t);return Object(R.c)(r,e)}))}function L(e){var{xmin:t,ymin:r,xmax:i,ymax:s}=e;return"".concat(t,",").concat(r,",").concat(i,",").concat(s)}function U(e){if(Object(g.j)(e))return null;var{start:t,end:r}=e;return"".concat(t?t.toISOString():"..","/").concat(r?r.toISOString():"..")}function B(e){return Object(g.j)(e)||!e||"1=1"===e?null:e}function V(e,t){if(!function(e){return Object(g.k)(e)&&"extent"===e.type}(e))return null;var{spatialReference:r}=e;if(!r||r.isWGS84)return{bbox:L(e)};var i=G(r,t);return i?{bbox:L(e),"bbox-crs":i}:r.isWebMercator?{bbox:L(Object(E.d)(e,A.a.WGS84))}:null}var Q=r(292),Y=r(178),X=r(407),J=r(362),Z=r(387),H=268435455;class W{constructor(){this.fieldMap=new Map,this.fields=[],this.hasFeatures=!1,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}hasField(e){return this.fieldMap.has(e)}isDateField(e){var t;return null==(t=this.fieldMap.get(e))?void 0:t.isDate}getFieldIndex(e){var t;return null==(t=this.fieldMap.get(e))?void 0:t.index}}function $(e){for(var t=e.getLength(),r=e.pos()+t,i={name:"",isDate:!1};e.pos()<r&&e.next();)switch(e.tag()){case 1:i.name=e.getString();break;case 2:"esriFieldTypeDate"===Object(Z.b)(e.getEnum())&&(i.isDate=!0);break;default:e.skip()}return i}var K=n.a.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF"),ee=268435455;function te(e){for(;e.next();)switch(e.tag()){case 1:return e.getMessage();default:e.skip()}return null}class re extends X.a{constructor(e,t,r,i){super(e),this._hasNext=!1,this._isPoints=!1,this._isPolygons=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},this._geometryType=i,this._reader=t,this._header=r,this._hasNext=r.hasFeatures,this._isPoints="esriGeometryPoint"===i,this._isPolygons="esriGeometryPolygon"===i}static fromBuffer(e,t,r=!1){var i=function(e){try{for(var r=new J.a(new Uint8Array(e),new DataView(e));r.next();)switch(r.tag()){case 2:return te(r.getMessage());default:r.skip()}}catch(t){var i=new T.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:t});K.error(i)}return null}(e),s=function(e,t,r=!1){for(var i=e.pos(),s=new W,a=0,n=0,o=null,u=null,l=null,c=!1;e.next();)switch(e.tag()){case 1:o=e.getString();break;case 3:u=e.getString();break;case 12:l=e.processMessage(Z.c);break;case 9:if(s.exceededTransferLimit=e.getBool(),s.exceededTransferLimit){s.offsets.geometry=r?new Float64Array(8e3):new Int32Array(8e3),s.centroid=r?new Float64Array(16e3):new Int32Array(16e3);for(var h=0;h<s.centroid.length;h++)s.centroid[h]=H}break;case 13:var d=$(e),f=d.name,p=d.name.toLowerCase().trim(),g={fieldName:f,index:a++,isDate:d.isDate};s.fields.push(g),s.fieldMap.set(d.name,g),s.fieldMap.set(p,g);break;case 15:var m=e.getLength(),v=e.pos()+m;if(!s.exceededTransferLimit){var y=s.offsets.geometry,b=s.centroid;y.push(0),b.push(H),b.push(H)}!c&&s.exceededTransferLimit&&(c=!0,s.offsets.attributes=r?new Float64Array(8e3*a):new Uint32Array(8e3*a));for(var _=n*a;e.pos()<v&&e.next();)switch(e.tag()){case 1:c?s.offsets.attributes[_++]=e.pos():s.offsets.attributes.push(e.pos());var O=e.getLength();e.skipLen(O);break;case 2:if(t)for(var j=e.getLength(),x=e.pos()+j;e.pos()<x&&e.next();)switch(e.tag()){case 3:e.getUInt32();var w=e.getSInt64(),I=e.getSInt64();s.centroid[2*n]=w,s.centroid[2*n+1]=I;break;default:e.skip()}else{s.offsets.geometry[n]=e.pos();var S=e.getLength();e.skipLen(S)}break;case 4:for(var F=e.getLength(),M=e.pos()+F;e.pos()<M&&e.next();)switch(e.tag()){case 3:e.getUInt32();var k=e.getSInt64(),C=e.getSInt64();s.centroid[2*n]=k,s.centroid[2*n+1]=C;break;default:e.skip()}break;default:e.skip()}n++,s.hasFeatures=!0;break;default:e.skip()}var R=o||u;if(!R)throw new T.a("FeatureSet has no objectId or globalId field name");return s.featureCount=n,s.fieldCount=a,s.objectIdFieldIndex=s.getFieldIndex(R),s.transform=l,s.displayIds=new Uint32Array(s.featureCount),s.groupIds=new Uint16Array(s.featureCount),e.move(i),s}(i,"esriGeometryPoint"===t,r),a=X.a.createInstance();return new re(a,i,s,t)}get geometryType(){return this._geometryType}get size(){return this._header.featureCount}get hasZ(){return!1}get hasM(){return!1}get stride(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getApproximateSize(){if(this._hasFilter){var e=Math.abs(this._xmax-this._xmin)*Math.abs(this._ymax-this._ymin),t=this.size*e/262144;return Math.max(Math.round(t),0)}return this.size}getQuantizationTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}getAttributeHash(){var e="";return this._header.fields.forEach((({index:t})=>{e+=this._readAttributeAtIndex(t)+"."})),e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}getGroupId(){return this._header.groupIds[this._featureIndex]}setGroupId(e){this._header.groupIds[this._featureIndex]=e}readLegacyFeature(){if(void 0===this._cache.legacyFeature){var e,t=this.readCentroid(),r={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:null!=(e=t&&{x:t.coords[0],y:t.coords[1]})?e:null};return this._cache.legacyFeature=r,r}return this._cache.legacyFeature}readOptimizedFeature(){if(void 0===this._cache.optFeature){var e=new Q.a(this.readGeometry(),this.readAttributes(),this.readCentroid());return e.objectId=this.getObjectId(),e.displayId=this.getDisplayId(),this._cache.optFeature=e,e}return this._cache.optFeature}getXHydrate(){var e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return Object(g.j)(t)?e:e*t.scale[0]+t.translate[0]}getYHydrate(){var e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return Object(g.j)(t)?e:t.translate[1]-e*t.scale[1]}getX(){return this._header.centroid[2*this._featureIndex]*this._sx+this._tx}getY(){return this._header.centroid[2*this._featureIndex+1]*this._sy+this._ty}readLegacyPointGeometry(){return{x:this.getX(),y:this.getY()}}readLegacyGeometry(){var e=this.readGeometry();return Object(y.k)(e,this.geometryType,!1,!1)}readLegacyCentroid(){var e=this.readCentroid();if(!e)return null;var[t,r]=e.coords;return{x:t,y:r}}readGeometryArea(){return this._cache.area||this.readGeometry(),this._cache.area}readUnquantizedGeometry(){if(void 0===this._cache.unquantGeometry){var e=this.readGeometry();if(!e)return this._cache.unquantGeometry=null,null;for(var t=e.clone(),r=t.lengths,i=t.coords,s=0,a=2;s<r.length;s++,a+=2)for(var n=r[s],o=1;o<n;o+=1,a+=2)i[a]+=i[a-2],i[a+1]+=i[a-1];return this._cache.unquantGeometry=t,t}return this._cache.unquantGeometry}readHydratedGeometry(){if(this._isPoints){var e=this.getXHydrate(),t=this.getYHydrate();return new Y.a([],[e,t])}var r=this.readGeometry();if(!r)return null;var i=r.clone(),s=this.getQuantizationTransform();return Object(g.k)(s)&&Object(y.z)(i,i,this.hasZ,this.hasM,s),i}readGeometry(){if(void 0===this._cache.geometry){var e=null;if(this._isPoints){var t=this.getX(),r=this.getY();e=new Y.a([],[t,r])}else{var i=this._header.offsets.geometry[this._featureIndex],s=this._reader;if(0===i)return null;s.move(i);try{e=this._parseGeometry(s)}catch(Ie){return console.error("Failed to parse geometry!",Ie),null}}return this._cache.geometry=e,e}return this._cache.geometry}readCentroid(){if(void 0===this._cache.centroid){var e=null,t=this._header.centroid[2*this._featureIndex]+this._tx,r=this._header.centroid[2*this._featureIndex+1]+this._ty;return t===ee?(e=this._computeCentroid())&&(this._header.centroid[2*this._featureIndex]=e.coords[0]-this._tx,this._header.centroid[2*this._featureIndex+1]=e.coords[1]-this._ty):e=new Y.a([],[t,r]),this._cache.centroid=e,e}return this._cache.centroid}copy(){var e=this._reader.clone(),t=new re(this.instance,e,this._header,this.geometryType);return this.copyInto(t),t}next(){for(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0;++this._featureIndex<this.size&&!this._passesFilter()&&!this._getExists(););return this._featureIndex<this.size}_readAttribute(e,t){var r=this._header.hasField(e)?e:function(e){return e.toLowerCase().trim()}(e),i=this._header.getFieldIndex(r);if(null!=i){var s=this._readAttributeAtIndex(i);return t?null==s?s:this._header.isDateField(r)?new Date(s):s:s}}_readAttributes(){var e={};return this._header.fields.forEach((({fieldName:t,index:r})=>{e[t]=this._readAttributeAtIndex(r)})),e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext}_passesFilter(){if(!this._hasFilter)return!0;var e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];if(e===ee){if(this._isPolygons&&!this.readCentroid())return!1;e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1]}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_readAttributeAtIndex(e){var t=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],r=this._reader;return r.move(t),function(e){for(var t=e.getLength(),r=e.pos()+t;e.pos()<r&&e.next();)switch(e.tag()){case 1:var i=e.getString();return""===i?null:i;case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(r)}_preprocessPolygon(e,t){for(var r=0,i=0,s=0,a=!1,n=!1,o=!1,u=-1,l=[],c=0,h=!1,d=0;d<t.length;d++){for(var f=t[d],p=e[2*r],g=e[2*r+1],m=0,v=1;v<f;v++){var y=p,b=g,_=p+e[2*(r+v)],O=g+e[2*(r+v)+1];p=_,g=O,m+=(_-y)*(O+b)*.5}var j=m>0;if(j&&h&&(i+=f),j||(u++,h=!1),u>=1e6)break;c+=m,a&&j&&n&&(o=!0),e[2*s]=e[2*i],e[2*s+++1]=e[2*i+++1];for(var x=1,w=e[2*i],I=e[2*i+++1],S=2;S<f;S++){var T=e[2*i],F=e[2*i+++1];0===w*F-T*I&&w*T+I*F>0?(w+=T,I+=F):(e[2*s]=w,e[2*s+++1]=I,x++,w=T,I=F)}e[2*s]=w,e[2*s+++1]=I,x++,l.push(x),a=!1,n=!0,r+=f}return l.length?(this._cache.area=Math.abs(c),new Y.a(l,e,o)):null}_parseGeometry(e){for(var t=e.getLength(),r=e.pos()+t,i=[],s=[];e.pos()<r&&e.next();)switch(e.tag()){case 2:for(var a=e.getUInt32(),n=e.pos()+a;e.pos()<n;)s.push(e.getUInt32());break;case 3:for(var o=e.getUInt32(),u=e.pos()+o;e.pos()<u;)i.push(e.getSInt32()),i.push(e.getSInt32()),this.hasZ&&e.getSInt32(),this.hasM&&e.getSInt32();break;case 1:default:e.skip()}var l=0;for(var c of s)i[2*l]+=this._tx,i[2*l+1]+=this._ty,l+=c;return this._isPolygons?this._preprocessPolygon(i,s):new Y.a(s,i)}}class ie{constructor(e){this.service=e}destroy(){}}function se(e){var t,{capabilities:r}=e;return(t=e.source)&&t.capabilities&&t.collectionId&&t.layerDefinition&&t.url?new ue(e):function(e){return Array.isArray(e.source)}(e)?new ae(e):r.query.supportsFormatPBF&&Object(a.a)("featurelayer-pbf")?new ne(e):new oe(e)}class ae extends ie{constructor(e){super(e),this._portsOpen=Object(k.c)(e.source).then((e=>this.client=e))}destroy(){this.client.close(),this.client=null}executeQuery(e,t){var r=this;return Object(i.a)((function*(){yield r._portsOpen;var i=yield r.client.invoke("queryFeatures",e.toJSON(),t);return _.a.fromFeatureSet(i,r.service.objectIdField)}))()}}class ne extends ie{executeQuery(e,t){var r=this;return Object(i.a)((function*(){var{data:i}=yield Object(C.executeQueryPBFBuffer)(r.service.source,e,Object(p.a)(Object(p.a)({},t),{},{query:Object(p.a)(Object(p.a)({},r.service.customParameters),null==t?void 0:t.query)})),s=!e.quantizationParameters;return re.fromBuffer(i,r.service.geometryType,s)}))()}}class oe extends ie{executeQuery(e,t){var r=this;return Object(i.a)((function*(){var{source:i,capabilities:s,spatialReference:a,objectIdField:n}=r.service;if(e.quantizationParameters&&!s.query.supportsQuantization){var o=e.clone();o.quantizationParameters=null;var{data:u}=yield Object(C.executeQuery)(i,o,a,Object(p.a)(Object(p.a)({},t),{},{query:Object(p.a)(Object(p.a)({},r.service.customParameters),null==t?void 0:t.query)})),l=Object(y.b)(u,n);return Object(y.t)(t.transform,l),_.a.fromOptimizedFeatureSet(l)}var{data:c}=yield Object(C.executeQuery)(i,e,r.service.spatialReference,Object(p.a)(Object(p.a)({},t),{},{query:Object(p.a)(Object(p.a)({},Object(g.q)(r.service.customParameters)),null==t?void 0:t.query)}));return _.a.fromFeatureSet(c,r.service.objectIdField)}))()}}class ue extends ie{executeQuery(e,t){var r=this;return Object(i.a)((function*(){var{capabilities:i}=r.service;if(e.quantizationParameters&&!i.query.supportsQuantization){e.clone().quantizationParameters=null;var s=yield z(r.service.source,e,t);return Object(y.t)(t.transform,s),_.a.fromOptimizedFeatureSet(s)}var a=yield z(r.service.source,e,t);return _.a.fromOptimizedFeatureSet(a)}))()}}var le=r(131),ce=r(150),he=r(317),de=r(97),fe=class extends de.a{constructor(e){super(e),this._queue=[],this._onGoingRequest=null,this._abortController=Object(m.d)()}destroy(){this.clear()}get updating(){return!this.destroyed&&(this._queue.length>0||null!=this._onGoingRequest)}clear(){if(this.destroyed)throw new Error("instance is already destroyed");for(var e=this._queue.pop();e;)e.resolver.reject(Object(m.e)()),e=this._queue.pop();this._queue.length=0,this._abortController.abort(),this._abortController=Object(m.d)()}push(e){var t=this;return Object(i.a)((function*(){if(t.destroyed)throw new Error("instance is already destroyed");var r=Object(m.g)();return t._queue.push({event:e,resolver:r}),t.notifyChange("updating"),Promise.resolve().then((()=>{t._processNext()})),r.promise}))()}_processNext(){var e=this;return Object(i.a)((function*(){if(!e._onGoingRequest){for(var t=[],r=new Set,i=new Set,s=new Set,a=e._queue.shift();a;){var{event:{addedFeatures:n,deletedFeatures:o,updatedFeatures:u},resolver:l}=a;for(var{objectId:c,error:h}of(t.push(l),n))h||(r.add(c),i.add(c),s.delete(c));for(var{objectId:d,error:f}of u)f||(i.add(d),s.delete(d));for(var{objectId:p,error:g}of o)g||(r.has(p)?r.delete(p):s.add(p),i.delete(p));a=e._queue.shift()}if(!i.size&&!s.size)return e.notifyChange("updating"),void t.forEach((e=>e()));var m=[],v=[];i.size&&i.forEach((e=>{m.push(e)})),s.size&&s.forEach((e=>{v.push(e)})),e._onGoingRequest=Promise.resolve().then((()=>e.processEdits(m,v,{signal:e._abortController.signal}))).catch((()=>{})),e.notifyChange("updating"),yield e._onGoingRequest,e._onGoingRequest=null,e.notifyChange("updating"),t.forEach((e=>e())),e._queue.length>0&&e._processNext()}}))()}};Object(s.a)([Object(o.b)({constructOnly:!0})],fe.prototype,"processEdits",void 0),Object(s.a)([Object(o.b)({readOnly:!0})],fe.prototype,"updating",null),fe=Object(s.a)([Object(u.a)("esri.views.2d.layers.features.controllers.EditsQueue")],fe);var pe=r(666);class ge{constructor(e){this.requests={done:new Array,stream:new pe.a(10)},this._abortController=new AbortController,this.didSend=!1,this.tile=e}get invalid(){return this._invalid}get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}sentEnd(){return this.requests.done.some((e=>e.message.end))}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach((t=>t.message.status.unset(e)))}invalidate(e){switch(e){case"fields":return void("none"===this._invalid&&(this._invalid="fields"));case"all":return void(this._invalid="all")}}done(){this._invalid="none"}add(e){var t;e.message.status=null!=(t=e.message.status)?t:f.empty(),this.requests.done.push(e),e.message.end&&(this.resolved=!0)}abort(){this._abortController.abort()}}class me{constructor(e){this.events=new le.a,this._pendingEdits=new Set,this._resolver=Object(m.g)(),this._editsQueue=new fe({processEdits:(e,t)=>this._processEdit(e,t)}),this._subscriptions=new Map,this._outSR=e.outSR,this._serviceInfo=e.serviceInfo,this._onTileUpdateMessage=e.onMessage}destroy(){this._editsQueue.clear()}_onMessage(e){var t=this;return Object(i.a)((function*(){var r,i=t._subscriptions.get(e.id);if(i){var s=Object(p.a)(Object(p.a)({},e),{},{remove:null!=(r=e.remove)?r:[],status:e.status});return t._onTileUpdateMessage(s,i.options)}}))()}update(e,t){var r,i=t.fields.length;t.outFields=function(e,t){var r=new Set;return e&&e.forEach((e=>r.add(e))),t&&t.forEach((e=>r.add(e))),r.has("*")?["*"]:Array.from(r)}(null==(r=this._schema)?void 0:r.outFields,t.outFields),t.outFields=t.outFields.length>=.75*i?["*"]:t.outFields,t.outFields.sort();var s=Object(he.a)(this._schema,t);if(s){Object(a.a)("esri-2d-update-debug")&&console.debug("Applying Update - Source:",s);var n={returnCentroid:Object(a.a)("esri-2d-query-centroid-enabled")&&"esriGeometryPolygon"===this._serviceInfo.geometryType,returnGeometry:!0,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:["".concat(this._serviceInfo.objectIdField," ASC")],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment?new Date(t.historicMoment):null,timeExtent:ce.a.fromJSON(t.timeExtent)},o=this._schema&&Object(he.b)(s,"outFields");this._schema&&Object(he.c)(s,["timeExtent","definitionExpression","gdbVersion","historicMoment"])&&(e.why.mesh.push("Layer filter changed"),e.why.source.push("Layer filter changed"),e.mesh=!0,e.source=!0,e.queryFilter=!0,this._invalidate("all")),o&&(e.why.source.push("Layer required fields changed"),e.source=!0,this._invalidate("fields")),Object(he.a)(n,this._queryInfo)&&(this._queryInfo=n),this._schema=t,this._resolver.resolve()}}whenInitialized(){return this._resolver.promise}applyUpdate(e){var t=this;return Object(i.a)((function*(){e.queryFilter?t.refresh():(t._subscriptions.forEach((t=>t.applyUpdate(e))),yield t.resend())}))()}refresh(){for(var e of this._tiles())this.unsubscribe(e),this.subscribe(e)}_tiles(){var e=[];return this._subscriptions.forEach((t=>e.push(t.tile))),e}pause(){this._subscriptions.forEach((e=>e.abort()))}subscribe(e){var t=new ge(e);this._subscriptions.set(e.id,t)}unsubscribe(e){var t=this.get(e.id);Object(g.k)(t)&&t.abort(),this._subscriptions.delete(e.id)}forEachPendingEdit(e){Array.from(this._subscriptions.values()).some((e=>"none"!==e.invalid))?this._pendingEdits.forEach(e):this._pendingEdits.clear()}edit(e){var t=this;return Object(i.a)((function*(){return t._editsQueue.push(e)}))()}createQuery(e={}){return new M.a(Object(p.a)(Object(p.a)({},this._queryInfo),e))}get(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null}queryLastEditDate(){return Object(i.a)((function*(){throw new Error("Service does not support query type")}))()}query(e,t){return Object(i.a)((function*(){throw new Error("Service does not support query")}))()}_invalidate(e){this._subscriptions.forEach((t=>t.invalidate(e)))}_processEdit(e,t){var r=this;return Object(i.a)((function*(){t.forEach((e=>{r._pendingEdits.has(e)&&r._pendingEdits.delete(e)})),e.forEach((e=>r._pendingEdits.add(e)));var s=Array.from(r._subscriptions.values()).map((({tile:e})=>e)).map((t=>{var i=r.createTileQuery(t);return i.objectIds=e,{tile:t,query:i}})).map(function(){var e=Object(i.a)((function*({tile:e,query:t}){return{tile:e,result:yield r.query(t)}}));return function(t){return e.apply(this,arguments)}}()),a=(yield Object(m.b)(s)).map(function(){var s=Object(i.a)((function*({tile:i,result:s}){if(s.hasFeatures||t.length||e.length)return r._subscriptions.get(i.key.id)?r._onMessage({type:"update",id:i.key.id,addOrUpdate:s,remove:[...e,...t],end:!0,status:f.empty()}):void 0}));return function(e){return s.apply(this,arguments)}}());yield Promise.all(a),r._invalidate("all")}))()}}var ve=n.a.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource");class ye extends me{constructor(e){var t;super(e),t=this,this.type="feature",this.mode="on-demand",this._adapter=se(e.serviceInfo),this._queue=new O.a({concurrency:8,process:function(){var e=Object(i.a)((function*(e){if(Object(m.u)(e),Object(g.k)(e.tile)){var r=e.tile.key.id,{tile:i,signal:s}=e,n={query:Object(a.a)("esri-tiles-debug")?{tile:r.replace(/\//g,"."),depth:e.depth}:void 0,signal:s,transform:i.transform};return t._adapter.executeQuery(e.query,n)}return t._adapter.executeQuery(e.query,e)}));return function(t){return e.apply(this,arguments)}}()}),this._patchQueue=new O.a({concurrency:8,process:function(){var e=Object(i.a)((function*(e){if(Object(m.u)(e),Object(g.k)(e.tile)){var r=e.tile.key.id,{tile:i,signal:s}=e,n={query:Object(a.a)("esri-tiles-debug")?{tile:r.replace(/\//g,"."),depth:e.depth}:void 0,signal:s,transform:i.transform};return t._adapter.executeQuery(e.query,n)}return t._adapter.executeQuery(e.query,e)}));return function(t){return e.apply(this,arguments)}}()})}destroy(){super.destroy(),this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()}get updating(){return!!this._queue.length}get maxRecordCountFactor(){var{query:e}=this._serviceInfo.capabilities;return e.supportsMaxRecordCountFactor?4:null}get maxPageSize(){var e,{query:t}=this._serviceInfo.capabilities;return(null!=(e=t.maxRecordCount)?e:8e3)*Object(g.r)(this.maxRecordCountFactor,1)}get pageSize(){return Math.min(8e3,this.maxPageSize)}enableEvent(e,t){}subscribe(e){super.subscribe(e),this._fetchDataTile(e).catch((t=>{Object(m.m)(t)||ve.error(new T.a("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t}))}))}unsubscribe(e){super.unsubscribe(e)}resume(){this._queue.resume()}forEachRequest(e,t){var r=this._subscriptions.get(e),{requests:i,signal:s}=r;for(var a of i.done)t(a.message,{signal:s})}query(e,t){var r=this;return Object(i.a)((function*(){return r._adapter.executeQuery(e,t)}))()}queryLastEditDate(){var e=this;return Object(i.a)((function*(){var t=e._serviceInfo.source,r=Object(p.a)(Object(p.a)({},t.query),{},{f:"json"});return(yield Object(F.default)(t.path,{query:r,responseType:"json"})).data.editingInfo.lastEditDate}))()}createTileQuery(e){var t=this.createQuery();return t.quantizationParameters=e.getQuantizationParameters(),t.resultType="tile",t.geometry=e.extent,"esriGeometryPolyline"===this._serviceInfo.geometryType&&(t.maxAllowableOffset=e.resolution),this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,t.maxAllowableOffset=e.resolution),t}_createQuery(e,t){var r=new M.a(Object(p.a)(Object(p.a)({},this._queryInfo),t));return this._serviceInfo.capabilities.query.supportsQuantization||(t.quantizationParameters=null,r.maxAllowableOffset=e.resolution),t.quantizationParameters&&"esriGeometryPolyline"===this._serviceInfo.geometryType&&(r.maxAllowableOffset=e.resolution),r.resultType="tile",r.geometry=e.extent,r}_executePatchQuery(e,t,r,s){var a=this;return Object(i.a)((function*(){var i=t.clone();i.outFields=[a._serviceInfo.objectIdField,...r],i.returnCentroid=!1,i.returnGeometry=!1;var n=Object(g.k)(i.start)?i.start/8e3:0,o=s.signal;return a._patchQueue.push({tile:e,query:i,signal:o,depth:n})}))()}_resend(e,t){var r=this;return Object(i.a)((function*(){var{query:i,message:s}=e,a=Object(g.k)(i.outFields)?i.outFields:[],n=r._queryInfo.outFields,o=n.filter((e=>-1===a.indexOf(e)));if(!Object(g.j)(s.addOrUpdate))if(o.length)try{var u=r._subscriptions.get(s.id).tile,l=yield r._executePatchQuery(u,i,o,t);Object(m.u)(t),i.outFields=n,s.addOrUpdate.joinAttributes(l),r._onMessage(Object(p.a)(Object(p.a)({},s),{},{end:s.end,type:"append"}))}catch(c){}else r._onMessage(Object(p.a)(Object(p.a)({},s),{},{end:s.end,type:"append"}))}))()}resend(){var e=this;return Object(i.a)((function*(){var t=0,r=!1,i=[];for(e._subscriptions.forEach((t=>{t.requests.done.length||e._onMessage({id:t.tile.id,addOrUpdate:null,end:!1,type:"append"})}));!r;)r=!0,e._subscriptions.forEach((({requests:s,signal:a})=>{s.done.length>t&&(r=!1,i.push(e._resend(s.done[t],{signal:a})))})),t++;yield Promise.all(i)}))()}}var be=Object(a.a)("esri-mobile"),_e={maxDrillLevel:be?1:4,maxRecordCountFactor:be?1:3};class Oe extends ye{constructor(e){super(e)}_fetchDataTile(e){var t=this;return Object(i.a)((function*(){var r=t._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,s=t._subscriptions.get(e.key.id),a=s.signal,n=e.getQuantizationParameters(),o=0,u=function(){var l=Object(i.a)((function*(i,l){var c=t._queryInfo,h=t._createQuery(i,{maxRecordCountFactor:r?_e.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:n});o++;try{var d=yield t._queue.push({tile:e,query:h,signal:a,depth:l});if(o--,Object(m.u)(a),!d)return;if(c!==t._queryInfo)return void u(i,l);if(d.exceededTransferLimit&&l<_e.maxDrillLevel){for(var f of i.createChildTiles())u(f,l+1);return}var p={id:e.id,addOrUpdate:d,end:0===o,type:"append"};s.add({query:h,message:p}),t._onMessage(p)}catch(g){Object(m.m)(g)||t._onMessage({id:e.id,addOrUpdate:null,end:!0,type:"append"})}}));return function(e,t){return l.apply(this,arguments)}}();u(e,0)}))()}}var je=r(420),xe=r(110);var we,Ie,Se=class{constructor(e,t,r,i,s=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=r,this._purgeOptions=i,this.store=e,this.objectIdField=t,this.purgeInterval=s,this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}add(e){if(this._useGeneratedIds){var t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}else e.objectId=e.attributes[this.objectIdField];if(this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return Object(g.j)(this._trackIdLessObservations)&&(this._trackIdLessObservations=new pe.a(1e5)),void this._trackIdLessObservations.enqueue(e.objectId);var r=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(r)){var i=Object(g.k)(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,s=Object(xe.d)(i,0,1e3);this._trackIdToObservations.set(r,new pe.a(s))}var a=this._trackIdToObservations.get(r).enqueue(e.objectId);Object(g.k)(a)&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(a))}checkForUpdates(){var e=this._getToAdd(),t=this._getToRemove(),r=performance.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);var i=[];if(Object(g.k)(t))for(var s of t){var a=this.store.removeById(s);Object(g.k)(a)&&i.push(a)}if(Object(g.k)(e))for(var n of e)n.attributes.__esri_timestamp__=r,this.store.add(n);(e||i)&&this.store.update(e,i)}_getToAdd(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((r=>e[t++]=r)),this._addOrUpdated.clear(),e}_getToRemove(){var e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){var t=this._purgeOptions;Object(g.k)(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(e.displayCount){var t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField)for(var r of this._trackIdToObservations.values())if(t>e.displayCount&&r.size){var i=Object(g.q)(r.dequeue());this._removed.push(i),t--}if(Object(g.k)(this._trackIdLessObservations))for(var s=t-e.displayCount;s-- >0;){var a=this._trackIdLessObservations.dequeue();Object(g.k)(a)&&this._removed.push(a)}}}}_purgeByAge(e){var t;if(e.age&&null!=(t=this._timeInfo)&&t.startTimeField){var r=60*e.age*1e3,i=this._maxAge-r;this.store.forEach((e=>{e.attributes[this._timeInfo.startTimeField]<i&&this._removed.push(e.objectId)}))}}_purgeByAgeReceived(e,t){if(t.ageReceived){var r=e+60*t.ageReceived*1e3;this.store.forEach((e=>{e.attributes.__esri_timestamp__<r&&this._removed.push(e.objectId)}))}}_purgeTracks(){this._trackIdToObservations.forEach(((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)}))}},Te=r(212),Fe=class extends(le.a.EventedMixin(l.a)){onFeature(e){this.emit("feature",e)}},Me=Fe=Object(s.a)([Object(u.a)("esri.layers.graphics.sources.connections.StreamConnection")],Fe),ke=n.a.getLogger("esri.layers.graphics.sources.connections.WebSocketConnection");(Ie=we||(we={}))[Ie.CONNECTING=0]="CONNECTING",Ie[Ie.OPEN=1]="OPEN",Ie[Ie.CLOSING=2]="CLOSING",Ie[Ie.CLOSED=3]="CLOSED";var Ce=class extends Me{constructor(e){super(),this.errorString=null;var{geometryType:t,spatialReference:r,sourceSpatialReference:i}=e;this._config=e,this._featureZScaler=Object(Te.a)(t,i,r),this._open()}_open(){var e=this;return Object(i.a)((function*(){yield e._tryCreateWebSocket(),e.destroyed||(yield e._handshake())}))()}destroy(){Object(g.k)(this._websocket)&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(Object(g.j)(this._websocket))return"disconnected";switch(this._websocket.readyState){case we.CONNECTING:case we.OPEN:return"connected";case we.CLOSING:case we.CLOSED:return"disconnected"}}_tryCreateWebSocket(e=this._config.source.path,t=1e3,r=0){var s=this;return Object(i.a)((function*(){try{if(s.destroyed)return;s._websocket=yield s._createWebSocket(e),s.notifyChange("connectionStatus")}catch(a){var i=t/1e3;return s._config.maxReconnectionAttempts&&r>=s._config.maxReconnectionAttempts?(ke.error(new T.a("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void s.destroy()):(ke.error(new T.a("websocket-connection","Failed to connect. Attempting to reconnect in ".concat(i,"s"),a)),yield Object(m.a)(t),s._tryCreateWebSocket(e,Math.min(1.5*t,1e3*s._config.maxReconnectionInterval),r+1))}}))()}_createWebSocket(e){var t=new WebSocket(e),r=new Promise(((e,r)=>{t.onopen=()=>e(t),t.onclose=e=>r(e)}));return r.then((()=>{if(this.destroyed)return t.onclose=()=>{},void t.close();t.onclose=e=>this._onClose(e),t.onerror=e=>this._onError(e),t.onmessage=e=>this._onMessage(e)})),r}_handshake(e=1e4){var t=this;return Object(i.a)((function*(){var r=t._websocket;if(!Object(g.j)(r)){var i=Object(m.g)(),s=r.onmessage,{filter:a,outFields:n,spatialReference:o}=t._config;return i.timeout(e),r.onmessage=e=>{var u,l=null;try{l=JSON.parse(e.data)}catch(c){}l&&"object"==typeof l||(ke.error(new T.a("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),i.reject(),t.destroy()),(null==(u=l.spatialReference)?void 0:u.wkid)!==(null==o?void 0:o.wkid)&&(ke.error(new T.a("websocket-connection","Protocol violation. Handshake failed - expected wkid of ".concat(o.wkid),e.data)),i.reject(),t.destroy()),"json"!==l.format&&(ke.error(new T.a("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),i.reject(),t.destroy()),a&&l.filter!==a&&ke.error(new T.a("websocket-connection","Tried to set filter, but server doesn't support it")),n&&l.outFields!==n&&ke.error(new T.a("websocket-connection","Tried to set outFields, but server doesn't support it")),r.onmessage=s,i.resolve()},r.send(JSON.stringify({filter:a,outFields:n,format:"json",spatialReference:{wkid:o.wkid}})),i.promise}}))()}_onMessage(e){try{var t=JSON.parse(e.data);if("featureResult"!==t.type)throw new T.a("websocket-connection","Protocol violation - Expected to find message of type 'featureResult'",t);for(var r of t.features)this._featureZScaler&&this._featureZScaler(r.geometry),this.onFeature(r)}catch(i){return ke.error(new T.a("websocket-connection","Failed to parse message",i)),void this.destroy()}}_onError(e){var t="Encountered an error over WebSocket connection";this._set("errorString",t),ke.error("websocket-connection",t)}_onClose(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&ke.error("websocket-connection","WebSocket closed unexpectedly with error code ".concat(e.code)),this.destroyed||this._open()}};Object(s.a)([Object(o.b)()],Ce.prototype,"connectionStatus",null),Object(s.a)([Object(o.b)()],Ce.prototype,"errorString",void 0),Ce=Object(s.a)([Object(u.a)("esri.layers.graphics.sources.connections.WebSocketConnection")],Ce);var Re=r(100),Ae=n.a.getLogger("esri.layers.graphics.sources.connections.GeoEventConnection"),Ee={maxQueryDepth:5,maxRecordCountFactor:3},Ne=class extends Ce{constructor(e){super(Object(p.a)(Object(p.a)({},Ee),e))}_open(){var e=this;return Object(i.a)((function*(){var t=yield e._fetchServiceDefinition(e._config.source);t.timeInfo.trackIdField||Ae.warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");var r=yield e._fetchWebSocketUrl(t.streamUrls,e._config.spatialReference);e._buddyServicesQuery||(e._buddyServicesQuery=e._queryBuddyServices()),yield e._buddyServicesQuery,yield e._tryCreateWebSocket(r);var{filter:i,outFields:s}=e._config;e.destroyed||e._setFilter(i,s)}))()}_onMessage(e){var t;try{t=this._enrich(JSON.parse(e.data)),this._featureZScaler&&this._featureZScaler(t.geometry)}catch(r){return void Ae.error(new T.a("geoevent-connection","Failed to parse message",r))}this.onFeature(t)}_fetchServiceDefinition(e){var t=this;return Object(i.a)((function*(){var r=Object(F.default)(e.path,{query:{f:"json"},responseType:"json"}),i=(yield r).data;return t._serviceDefinition=i,i}))()}_fetchWebSocketUrl(e,t){var r=this;return Object(i.a)((function*(){var i=e[0],{urls:s,token:a}=i;return"".concat(r._inferWebSocketBaseUrl(s),"/subscribe?outSR=").concat(t.wkid).concat(a?"&token="+a:"")}))()}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(var t of e)if(-1!==t.indexOf("wss"))return t;return Ae.error(new T.a("geoevent-connection","Unable to infer WebSocket url",e)),null}_setFilter(e,t){var r=this;return Object(i.a)((function*(){var i=r._websocket;if(!(Object(g.j)(i)||Object(g.j)(e)&&Object(g.j)(t))){var s=JSON.stringify({filter:r._serializeFilter(e,t)}),a=!1,n=Object(m.g)();return i.onmessage=e=>{var t=JSON.parse(e.data);t.filter&&(t.error&&(Ae.error(new T.a("geoevent-connection","Failed to set service filter",t.error)),r._set("errorString","Could not set service filter - ".concat(t.error)),n.reject(t.error)),i.onmessage=r._onMessage.bind(r),a=!0,n.resolve())},i.send(s),setTimeout((()=>{a||(r.destroyed||r._websocket!==i||Ae.error(new T.a("geoevent-connection","Server timed out when setting filter")),n.reject())}),1e4),n.promise}}))()}_serializeFilter(e,t){var r={};if(Object(g.j)(e)&&Object(g.j)(t))return r;if(Object(g.k)(e)&&e.geometry)try{var i=Object(Re.a)(e.geometry);if("extent"!==i.type)throw new T.a("Expected extent but found type ".concat(i.type));r.geometry=JSON.stringify(i.shiftCentralMeridian())}catch(s){Ae.error(new T.a("geoevent-connection","Encountered an error when setting connection geometryDefinition",s))}return Object(g.k)(e)&&e.where&&"1 = 1"!==e.where&&(r.where=e.where),Object(g.k)(t)&&(r.outFields=t.join(",")),r}_enrich(e){if(!this._relatedFeatures)return e;var t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t];if(!this._relatedFeatures.has(r))return Ae.warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;var{attributes:i,geometry:s}=this._relatedFeatures.get(r);for(var a in i)e.attributes[a]=i[a];return s&&(e.geometry=s),e.geometry||e.centroid||Ae.error(new T.a("geoevent-connection","Found malformed feature - no geometry found",e)),e}_queryBuddyServices(){var e=this;return Object(i.a)((function*(){try{var{relatedFeatures:t,keepLatestArchive:r}=e._serviceDefinition,i=e._queryRelatedFeatures(t),s=e._queryArchive(r);yield i;var a=yield s;if(!a)return;for(var n of a.features)e.onFeature(e._enrich(n))}catch(Ie){Ae.error(new T.a("geoevent-connection","Encountered an error when querying buddy services",{error:Ie}))}}))()}_queryRelatedFeatures(e){var t=this;return Object(i.a)((function*(){if(e){var r=yield t._queryBuddy(e.featuresUrl);t._addRelatedFeatures(r)}}))()}_queryArchive(e){var t=this;return Object(i.a)((function*(){if(e)return t._queryBuddy(e.featuresUrl)}))()}_queryBuddy(e){var t=this;return Object(i.a)((function*(){var i=new((yield Promise.all([r.e(4),r.e(3),r.e(33),r.e(34),r.e(164)]).then(r.bind(null,271))).default)({url:e}),{capabilities:s}=yield i.load(),a=s.query.supportsMaxRecordCountFactor,n=s.query.supportsPagination,o=s.query.supportsCentroid,u=t._config.maxRecordCountFactor,l=i.capabilities.query.maxRecordCount,c=a?l*u:l,h=new M.a;if(h.outFields=Object(g.r)(t._config.outFields,["*"]),h.where=Object(g.r)(Object(g.i)(t._config.filter,"where"),"1=1"),h.returnGeometry=!0,h.returnExceededLimitFeatures=!0,h.outSpatialReference=A.a.fromJSON(t._config.spatialReference),o&&(h.returnCentroid=!0),a&&(h.maxRecordCountFactor=u),n)return h.num=c,i.destroy(),t._queryPages(e,h);var d=yield Object(C.executeQuery)(e,h,t._config.sourceSpatialReference);return i.destroy(),d.data}))()}_queryPages(e,t,r=[],s=0){var a=this;return Object(i.a)((function*(){t.start=Object(g.k)(t.num)?s*t.num:null;var{data:i}=yield Object(C.executeQuery)(e,t,a._config.sourceSpatialReference);return i.exceededTransferLimit&&s<a._config.maxQueryDepth?(i.features.forEach((e=>r.push(e))),a._queryPages(e,t,r,s+1)):(r.forEach((e=>i.features.push(e))),i)}))()}_addRelatedFeatures(e){var t=new Map,r=e.features,i=this._serviceDefinition.relatedFeatures.joinField;for(var s of r){var a=s.attributes[i];t.set(a,s)}this._relatedFeatures=t}},Pe=Ne=Object(s.a)([Object(u.a)("esri.layers.graphics.sources.connections.GeoEventConnection")],Ne);function qe(e,t){var r=e.weakClone(),i=Object(y.v)(t,e.geometry.coords[0]),s=Object(y.w)(t,e.geometry.coords[1]);return r.geometry=new Y.a([],[i,s]),r}function ze(e,t){var r=Object(je.a)(9,function(e){switch(e){case"esriGeometryPoint":return e=>({minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]});default:return e=>{var t=1/0,r=1/0,i=-1/0,s=-1/0;return e.geometry.forEachVertex(((e,a)=>{t=Math.min(t,e),r=Math.min(r,a),i=Math.max(i,e),s=Math.max(s,a)})),{minX:t,minY:r,maxX:i,maxY:s}}}}(t));return r.load(e),r}class De{constructor(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map}get _features(){var e=[];return this._objectIdToFeature.forEach((t=>e.push(t))),e}add(e){this._objectIdToFeature.set(e.objectId,e),this._index=null}get(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null}forEach(e){this._objectIdToFeature.forEach(e)}search(e){return this._index||(this._index=ze(this._features,this._geometryType)),function(e,t){return e.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}(this._index,e)}removeById(e){var t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._objectIdToFeature.size}}class Ge extends me{constructor(e){super(e),this.type="geoevent",this._dataReceiveEventEnabled=!1,this._level=0,this._updateInfo={websocket:0,client:0};var{outSR:t}=e,{geometryType:r,objectIdField:i,timeInfo:s,purgeOptions:a,source:n,spatialReference:o,serviceFilter:u,maxReconnectionAttempts:l,maxReconnectionInterval:c,updateInterval:h}=e.serviceInfo,d=new De(this._onUpdate.bind(this),r),f=new Se(d,i,s,a),p=function(e,t,r,i,s,a,n){var o=0===e.path.indexOf("wss://")||0===e.path.indexOf("ws://"),u={source:e,sourceSpatialReference:t,spatialReference:r,geometryType:i,filter:s,maxReconnectionAttempts:a,maxReconnectionInterval:n};return o?new Ce(u):new Pe(u)}(n,o,t,r,u,l,c);this._store=d,this._manager=f,this._connection=p,this._quantize=function(e){switch(e){case"esriGeometryPoint":return qe;case"esriGeometryPolygon":case"esriGeometryPolyline":default:return(t,r)=>{var i=t.weakClone(),s=new Y.a,a=Object(y.u)(s,t.geometry,!1,!1,e,r,!1,!1);return i.geometry=a,i}}}(r),this._handles=[this._connection.on("feature",(e=>this._onFeature(e))),this._connection.watch("connectionStatus",(e=>this.events.emit("connectionStatus",e))),this._connection.watch("errorString",(e=>this.events.emit("errorString",e)))];var g=performance.now();this._updateIntervalId=setInterval((()=>{var t=performance.now(),r=t-g;if(r>2500){g=t;var i=Math.round(this._updateInfo.client/(r/1e3)),s=Math.round(this._updateInfo.websocket/(r/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.events.emit("updateRate",{client:i,websocket:s})}e.canAcceptRequest()&&this._manager.checkForUpdates()}),h)}destroy(){super.destroy(),clearInterval(this._updateIntervalId),this._handles.forEach((e=>e.remove())),this._connection.destroy()}_fetchDataTile(){}resume(){}enableEvent(e,t){"data-received"===e&&(this._dataReceiveEventEnabled=t)}get updating(){return!1}subscribe(e){super.subscribe(e);var t=this._subscriptions.get(e.id);this._level=e.level;var r=this._getTileFeatures(e);this._onMessage({type:"append",id:e.key.id,addOrUpdate:r,end:!0}),t.didSend=!0}unsubscribe(e){super.unsubscribe(e)}forEachRequest(e,t){var r=this._subscriptions.get(e),{tile:i,signal:s}=r,a={type:"append",tile:i,id:e,addOrUpdate:this._getTileFeatures(i),end:!0};t(a,{signal:s}),r.requests.stream.entries.forEach((e=>{Object(g.k)(e)&&t(e,{signal:s})}))}createTileQuery(e){throw new Error("Service does not support tile  queries")}resend(){var e=this;return Object(i.a)((function*(){e._subscriptions.forEach((t=>{var{tile:r}=t,i={type:"append",id:r.id,addOrUpdate:e._getTileFeatures(r),end:!0};e._onMessage(i)}))}))()}_getTileFeatures(e){var t=this._store.search(e).map((t=>this._quantize(t,e.transform)));return _.a.fromOptimizedFeatures(t,this._serviceInfo.geometryType,e.transform)}_onFeature(e){this._updateInfo.websocket++;try{this._dataReceiveEventEnabled&&this.events.emit("feature",e);var t=Object(y.a)(e,this._serviceInfo.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(t)}catch(r){}}_onUpdate(e,t){Object(g.k)(e)&&(this._updateInfo.client+=e.length),this._subscriptions.forEach(((e,t)=>{e.didSend&&e.tile.level===this._level&&this._onMessage({type:"append",id:t,addOrUpdate:null,clear:!0,end:!1})})),this._subscriptions.forEach(((e,t)=>{if(e.didSend&&e.tile.level===this._level){var r=e.tile,i={type:"append",id:t,addOrUpdate:this._getTileFeatures(r),remove:[],end:!0,status:f.empty()};e.requests.stream.enqueue(i),this._onMessage(i)}}))}}var Le=n.a.getLogger("esri.views.2d.layers.features.sources.FeatureSource");class Ue extends ye{constructor(e){super(e)}_fetchDataTile(e){var t=this;return Object(i.a)((function*(){for(var r=t._subscriptions.get(e.key.id),i=!1,s=0,a=0,n=(s,n)=>{a--,Object(m.u)(r);var o=e.id,u=s.reader,l=s.query;if(!u.exceededTransferLimit){if(i=!0,0!==n&&!u.hasFeatures){var c={id:o,addOrUpdate:u,end:0===a,type:"append"};return r.add({message:c,query:l}),void t._onMessage(c)}var h={id:o,addOrUpdate:u,end:0===a,type:"append"};return r.add({message:h,query:l}),void t._onMessage(h)}var d={id:o,addOrUpdate:u,end:i&&0===a,type:"append"};r.add({message:d,query:l}),t._onMessage(d)},o=0,u=0;!i&&u++<20;){for(var l=void 0,c=function(o){var u=s++;a++,l=t._fetchDataTilePage(e,u,r).then((e=>e&&n(e,u))).catch((r=>{i=!0,Object(m.m)(r)||(Le.error(new T.a("mapview-query-error","Encountered error when fetching tile",{tile:e,error:r})),t._onMessage({id:e.id,addOrUpdate:null,end:i,type:"append"}))}))},h=0;h<o+1;h++)c();yield l,Object(m.u)(r),o=Math.min(o+2,6)}}))()}_fetchDataTilePage(e,t,r){var s=this;return Object(i.a)((function*(){var i=s._queryInfo,a={start:s.pageSize*t,num:s.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};Object(g.k)(s.maxRecordCountFactor)&&(a.maxRecordCountFactor=s.maxRecordCountFactor);var n=s._createQuery(e,a);try{var o=r.signal,u=yield s._queue.push({tile:e,query:n,signal:o,depth:t});return Object(m.u)(r),u?i!==s._queryInfo?s._fetchDataTilePage(e,t,r):{reader:u,query:n}:null}catch(l){return Object(m.v)(l),null}}))()}}var Be=r(526),Ve=r(904),Qe=n.a.getLogger("esri.views.2d.layers.features.sources.SnapshotFeatureSource");function Ye(e,t,r){var i=e.getXHydrate(),s=e.getYHydrate(),a=t.getColumnForX(i),n=Math.floor(t.normalizeCol(a));return"".concat(r,"/").concat(Math.floor(t.getRowForY(s)),"/").concat(n)}function Xe(e,t){if(Object(g.j)(e))return null;var r=t.transform,i=e.getQuantizationTransform();if(Object(g.j)(i)){var[s,a]=r.scale,[n,o]=r.translate,u=-n/s,l=1/s,c=o/a,h=1/-a;return e.transform(u,c,l,h)}var[d,f]=i.scale,[p,m]=i.translate,[v,y]=r.scale,[b,_]=r.translate,O=d/v,j=(p-b)/v,x=f/y,w=(-m+_)/y;return e.transform(j,w,O,x)}class Je extends ye{constructor(e){super(e),this.mode="snapshot",this._loading=!0,this._controller=new AbortController,this._downloadPromise=null,this._didSendEnd=!1,this._queries=new Array,this._invalidated=!1,this._hasAggregates=!1,this._random=new Be.a(1e3),this._featureCount=e.featureCount,this._store=e.store,this._markedIdsBufId=this._store.storage.createBitset()}destroy(){super.destroy(),this._controller.abort()}get loading(){return this._loading}get _signal(){return this._controller.signal}update(e,t){super.update(e,t),this._hasAggregates=e.targets.aggregate}resend(e=!1){var t=this;return Object(i.a)((function*(){if(yield t._downloadPromise,t._invalidated||e)return t._invalidated=!1,t._subscriptions.forEach((e=>e.clear())),t._downloadPromise=t._download(t._featureCount),void(yield t._downloadPromise);var r=t._queries.map((({query:e,reader:r})=>t._sendPatchQuery(e,r)));yield Promise.all(r),t._subscriptions.forEach((e=>{e.requests.done.forEach((e=>t._onMessage(e.message)))}))}))()}refresh(){var e=this;return Object(i.a)((function*(){yield e.resend(!0)}))()}edit(e){var t=this;return Object(i.a)((function*(){var r=t._signal,i=[...e.addedFeatures.filter((e=>!e.error)).map((e=>e.objectId)),...e.updatedFeatures.filter((e=>!e.error)).map((e=>e.objectId))],s=[...e.deletedFeatures.filter((e=>!e.error)).map((e=>e.objectId)),...i];for(var a of s)t._store.remove(a);var n=t.createQuery();n.objectIds=i;var o=yield t._queue.push({query:n,depth:0,signal:r});Object(m.u)({signal:r}),t._store.insert(o),t._send(o),t._invalidateQueries()}))()}_invalidateQueries(){this._invalidated=!0}_sendPatchQuery(e,t){var r=this;return Object(i.a)((function*(){var i=Object(g.k)(e.outFields)?e.outFields:[],s=r._queryInfo.outFields,a=s.filter((e=>-1===i.indexOf(e)));if(a.length){var n=e.clone(),o=r._signal;n.returnGeometry=!1,n.returnCentroid=!1,n.outFields=a,e.outFields=s;var u=yield r._queue.push({query:n,depth:0,signal:o});Object(m.u)({signal:o}),t.joinAttributes(u)}}))()}_fetchDataTile(e){var t=this;return Object(i.a)((function*(){t._downloadPromise||(t._downloadPromise=t._download(t._featureCount));for(var r=t._store.search(e),i=t._subscriptions.get(e.key.id),s=r.length-1,a=0;a<s;a++){var n=Xe(r[a],e),o={type:"append",id:e.id,addOrUpdate:n,end:!1,status:f.empty()};i.add({query:null,message:o}),t._hasAggregates||(yield Object(m.a)(1)),t._onMessage(o)}var u=Xe(s>=0?r[s]:null,e),l=t._didSendEnd,c={type:"append",id:e.id,addOrUpdate:u,end:l,status:f.empty()};i.add({query:null,message:c}),t._onMessage(c)}))()}_download(e){var t=this;return Object(i.a)((function*(){try{yield t.whenInitialized();var r=t._store.storage.getBitset(t._markedIdsBufId),i=new Set;r.clear();var s=Math.ceil(e/t.pageSize),a=Array.from({length:s},((e,t)=>t)).sort(((e,r)=>t._random.getInt()-t._random.getInt())).map((e=>t._downloadPage(e,r,i)));yield Promise.all(a),t._store.sweepFeatures(r,t._store.storage),t._store.sweepFeatureSets(i)}catch(n){Qe.error("mapview-snapshot-source","Encountered and error when downloading feature snapshot",n)}t._sendEnd(),t._loading=!1}))()}_downloadPage(e,t,r){var s=this;return Object(i.a)((function*(){var i=s.pageSize,a={start:e*i,num:i,cacheHint:!0};Object(g.k)(s.maxRecordCountFactor)&&(a.maxRecordCountFactor=s.maxRecordCountFactor);var n=s.createQuery(a),o=s._signal,u=yield s._queue.push({query:n,depth:e,signal:o});Object(m.u)({signal:o}),s._queries.push({query:n,reader:u}),s._store.insert(u),r.add(u.instance);for(var l=u.getCursor();l.next();)t.set(l.getDisplayId());s._send(u)}))()}_send(e){if(this._subscriptions.size){var t=null,r=new Map,i=new Set,s=new Map;for(var a of(this._subscriptions.forEach((e=>{var a,n=e.tile;r.set(n.key.id,null),t=n.tileInfoView,i.add(n.level);var{row:o,col:u}=n.key,l="".concat(n.level,"/").concat(o,"/").concat(u),c=null!=(a=s.get(l))?a:[];c.push(e),s.set(l,c)})),i))for(var n=t.getLODInfoAt(a),o=e.getCursor();o.next();){var u=Ye(o,n,a),l=o.getIndex();if(s.has(u))for(var c of s.get(u)){var h=c.tile.id,d=r.get(h);Object(g.j)(d)&&(d=[],r.set(h,d)),d.push(l)}}r.forEach(((t,r)=>{if(Object(g.k)(t)){var i=this._subscriptions.get(r),s={type:"append",id:r,addOrUpdate:Xe(Ve.a.from(e,t),i.tile),end:!1,status:f.empty()};i.add({query:null,message:s}),this._onMessage(s)}}))}}_sendEnd(){this._subscriptions.forEach((e=>{var t={type:"append",id:e.tile.id,addOrUpdate:null,end:!0,status:f.empty()};e.add({query:null,message:t}),this._onMessage(t)})),this._didSendEnd=!0}}function Ze(e,t,r,i,s,a){var n=function(e,t,r,i,s,a){switch(e.type){case"snapshot":return{type:"feature",origin:"snapshot",featureCount:Object(g.r)(e.featureCount,0),serviceInfo:e,onMessage:i,outSR:t,tileInfoView:r,canAcceptRequest:s,store:a};case"stream":return{type:"geoevent",serviceInfo:e,onMessage:i,outSR:t,canAcceptRequest:s};case"memory":case"on-demand":return{type:"feature",serviceInfo:e,onMessage:i,outSR:t,origin:n(e.source),tileInfoView:r,canAcceptRequest:s}}function n(e){return Array.isArray(e)?"local":"path"in e&&Object(S.c)(e.path)?"hosted":"unknown"}}(e,t,r,i,s,a);switch(n.type){case"feature":switch(n.origin){case"hosted":case"local":return new Ue(n);case"snapshot":return new Je(n);case"unknown":return new Oe(n)}case"geoevent":return new Ge(n)}}var He=r(139);new Float64Array(2),new Float64Array(2);function We(e,t,r,i){i%2&&(i+=1);for(var s=0,a=0,n=-90,o=90,u=-180,l=180,c=0;c<i/2;c++){for(var h=0;h<5;h++){var d=(u+l)/2,f=r>d?1:0;s|=f<<29-(h+5*c),u=(1-f)*u+f*d,l=(1-f)*d+f*l}for(var p=0;p<5;p++){var g=(n+o)/2,m=t>g?1:0;a|=m<<29-(p+5*c),n=(1-m)*n+m*g,o=(1-m)*g+m*o}}e.geohashX=s,e.geohashY=a}function $e(e,t,r,i,s){s%2&&(s+=1);for(var a=0,n=0,o=-90,u=90,l=-180,c=180,h=0;h<s/2;h++){for(var d=0;d<5;d++){var f=(l+c)/2,p=i>f?1:0;a|=p<<29-(d+5*h),l=(1-p)*l+p*f,c=(1-p)*f+p*c}for(var g=0;g<5;g++){var m=(o+u)/2,v=r>m?1:0;n|=v<<29-(g+5*h),o=(1-v)*o+v*m,u=(1-v)*m+v*u}}e[2*t]=a,e[2*t+1]=n}class Ke{constructor(e=[],t=8096){this._nodes=0,this._root=new et(0,0,0),this._statisticFields=e,this._pool=t?new pe.a(8096):null}_acquire(e,t,r){this._nodes++;var i=null;return Object(g.k)(this._pool)&&(i=this._pool.dequeue()),Object(g.k)(i)?i.realloc(e,t,r):new et(e,t,r)}_release(e){this._nodes--,Object(g.k)(this._pool)&&this._pool.enqueue(e)}get count(){return this._root.count}get size(){return this._nodes}get poolSize(){return Object(g.n)(this._pool,0,(e=>e.size))}get depth(){var e=0;return this._forEachNode((t=>e=Math.max(e,t.depth))),e}dropLevels(e){this._forEachNode((t=>{if(t.depth>=e)for(var r=0;r<t.children.length;r++){var i=t.children[r];t.children[r]=null,i&&this._release(i)}}))}clear(){this.dropLevels(0)}insert(e,t,r=0){var i=_.a.fromOptimizedFeatures([e],"esriGeometryPoint").getCursor();i.next();var s=i.readGeometry();if(s){var[a,n]=s.coords,o=e.geohashX,u=e.geohashY;this.insertCursor(i,e.displayId,a,n,o,u,t,r)}}insertCursor(e,t,r,i,s,a,n,o=0){for(var u=this._root,l=0,c=0,h=0;null!==u;){if(u.depth>=o&&(u.count+=1,u.xTotal+=r,u.yTotal+=i,u.xGeohashTotal+=s,u.yGeohashTotal+=a,u.displayId=t,this._updateStatisticsCursor(e,u,1)),l>=n)return void u.add(t);var d=Math.ceil((l+1)/2),f=Math.floor((l+1)/2),p=1-l%2,g=30-(3*d+2*f),m=30-(2*d+3*f),v=(s&7*p+3*(1-p)<<g)>>g,y=(a&3*p+7*(1-p)<<m)>>m,b=v+y*(8*p+4*(1-p));c=c<<3*p+2*(1-p)|v,h=h<<2*p+3*(1-p)|y,null==u.children[b]&&(u.children[b]=this._acquire(c,h,l+1)),l+=1,u=u.children[b]}}remove(e,t){var r=_.a.fromOptimizedFeatures([e],"esriGeometryPoint").getCursor();r.next();var i=r.readGeometry();if(i){var[s,a]=i.coords,n=e.geohashX,o=e.geohashY;this.removeCursor(r,s,a,n,o,t)}}removeCursor(e,t,r,i,s,a){for(var n=this._root,o=0;null!==n;){if(n.count-=1,n.xTotal-=t,n.yTotal-=r,n.xGeohashTotal-=i,n.yGeohashTotal-=s,this._updateStatisticsCursor(e,n,-1),o>=a)return void n.remove(e.getDisplayId());var u=Math.ceil((o+1)/2),l=Math.floor((o+1)/2),c=1-o%2,h=30-(3*u+2*l),d=30-(2*u+3*l),f=((i&7*c+3*(1-c)<<h)>>h)+((s&3*c+7*(1-c)<<d)>>d)*(8*c+4*(1-c)),p=n.children[f];1===p.count&&(this._release(p),n.children[f]=null),o+=1,n=p}}find(e,t,r){return this._root.find(e,t,r,0,0,0)}findSingleOccupancyNode(e,t,r,i,s){for(var a=this._root;null!==a;){var n=a.depth,o=a.xNode,u=a.yNode,l=1-n%2,c=a.xGeohashTotal/a.count,h=a.yGeohashTotal/a.count;if(1===a.count&&e<c&&c<=r&&t<h&&h<=i)return a;if(n>=s)a=a.next;else{for(var d=Math.ceil((n+1)/2),f=Math.floor((n+1)/2),p=30-(3*d+2*f),g=30-(2*d+3*f),m=~((1<<p)-1),v=~((1<<g)-1),y=(e&m)>>p,b=(t&v)>>g,_=(r&m)>>p,O=(i&v)>>g,j=o<<3*l+2*(1-l),x=u<<2*l+3*(1-l),w=j+8*l+4*(1-l),I=x+4*l+8*(1-l),S=Math.max(j,y),T=Math.max(x,b),F=Math.min(w,_),M=Math.min(I,O),k=null,C=null,R=T;R<=M;R++)for(var A=S;A<=F;A++){var E=A-j+(R-x)*(8*l+4*(1-l)),N=a.children[E];N&&(k||((k=N).next=a.next),C&&(C.next=N),C=N,N.next=a.next)}a=k||a.next}}return null}getRegionDisplayIds(e,t,r,i,s){for(var a=this._root,n=[];null!==a;){var o=a.depth,u=a.xNode,l=a.yNode;if(o>=s){var c=a.xGeohashTotal/a.count,h=a.yGeohashTotal/a.count;e<=c&&c<=r&&t<=h&&h<=i&&a.displayIds.forEach((e=>n.push(e))),a=a.next}else{for(var d=Math.ceil((o+1)/2),f=Math.floor((o+1)/2),p=1-o%2,g=30-(3*d+2*f),m=30-(2*d+3*f),v=~((1<<g)-1),y=~((1<<m)-1),b=(e&v)>>g,_=(t&y)>>m,O=(r&v)>>g,j=(i&y)>>m,x=u<<3*p+2*(1-p),w=l<<2*p+3*(1-p),I=x+8*p+4*(1-p),S=w+4*p+8*(1-p),T=Math.max(x,b),F=Math.max(w,_),M=Math.min(I,O),k=Math.min(S,j),C=null,R=null,A=F;A<=k;A++)for(var E=T;E<=M;E++){var N=E-x+(A-w)*(8*p+4*(1-p)),P=a.children[N];P&&(C||((C=P).next=a.next),R&&(R.next=P),R=P,P.next=a.next)}a=C||a.next}}return n}getRegionStatistics(e,t,r,i,s){for(var a=this._root,n=0,o=0,u=0,l={},c=0;null!==a;){var h=a.depth,d=a.xNode,f=a.yNode;if(h>=s){var p=a.xGeohashTotal/a.count,g=a.yGeohashTotal/a.count;e<p&&p<=r&&t<g&&g<=i&&(n+=a.count,o+=a.xTotal,u+=a.yTotal,1===a.count&&(c=a.displayId),this._aggregateStatistics(l,a.statistics)),a=a.next}else{for(var m=Math.ceil((h+1)/2),v=Math.floor((h+1)/2),y=1-h%2,b=30-(3*m+2*v),_=30-(2*m+3*v),O=~((1<<b)-1),j=~((1<<_)-1),x=(e&O)>>b,w=(t&j)>>_,I=(r&O)>>b,S=(i&j)>>_,T=d<<3*y+2*(1-y),F=f<<2*y+3*(1-y),M=T+8*y+4*(1-y),k=F+4*y+8*(1-y),C=Math.max(T,x),R=Math.max(F,w),A=Math.min(M,I),E=Math.min(k,S),N=null,P=null,q=R;q<=E;q++)for(var z=C;z<=A;z++){var D=z-T+(q-F)*(8*y+4*(1-y)),G=a.children[D];if(G){if(q!==R&&q!==E&&z!==C&&z!==A){var L=G.xGeohashTotal/G.count,U=G.yGeohashTotal/G.count;e<L&&L<=r&&t<U&&U<=i&&(n+=G.count,o+=G.xTotal,u+=G.yTotal,1===G.count&&(c=G.displayId),this._aggregateStatistics(l,G.statistics));continue}N||((N=G).next=a.next),P&&(P.next=G),P=G,G.next=a.next}}a=N||a.next}}return{count:n,attributes:this._normalizeStatistics(l,n),xTotal:o,yTotal:u,referenceId:c}}_forEachNode(e){for(var t=this._root;null!==t;){var r=this._linkChildren(t)||t.next;e(t),t=r}}_linkChildren(e){for(var t=null,r=null,i=0;i<=e.children.length;i++){var s=e.children[i];s&&(t||((t=s).next=e.next),r&&(r.next=s),r=s,s.next=e.next)}return t}_updateStatisticsCursor(e,t,r){for(var i of this._statisticFields){var s=i.name,a=i.inField?e.readAttribute(i.inField):e.getComputedNumericAtIndex(i.inFieldIndex);switch(i.statisticType){case"norm":t.statistics[s]||(t.statistics[s]={});var n=i.inNormalizationField,o=e.readAttribute(n),u=t.statistics[s].onStatisticField||0,l=t.statistics[s].onStatisticNormalizationField||0;null==a||isNaN(a)||null==o||0===o||isNaN(o)||(t.statistics[s].onStatisticField=u+r*a,t.statistics[s].onStatisticNormalizationField=l+r*o);break;case"sum":case"avg":t.statistics[s]||(t.statistics[s]={value:0,nanCount:0});var c=t.statistics[s].value,h=t.statistics[s].nanCount;null==a||isNaN(a)?t.statistics[s].nanCount=h+r:t.statistics[s].value=c+r*a;break;case"avg_angle":t.statistics[s]||(t.statistics[s]={x:0,y:0,nanCount:0});var d=t.statistics[s].x,f=t.statistics[s].y,p=t.statistics[s].nanCount,g=Math.PI/180;null==a||isNaN(a)?t.statistics[s].nanCount=p+r:(t.statistics[s].x=d+r*Math.cos(a*g),t.statistics[s].y=f+r*Math.sin(a*g));break;case"mode":t.statistics[s]||(t.statistics[s]={});var m=t.statistics[s][a]||0;t.statistics[s][a]=m+r}}}_aggregateStatistics(e,t){for(var r of this._statisticFields){var i=r.name;switch(r.statisticType){case"sum":case"avg":case"avg_angle":case"mode":case"norm":for(var s in e[i]||(e[i]={}),t[i]){var a=e[i][s]||0;e[i][s]=a+t[i][s]}}}}_normalizeStatistics(e,t){var r={};for(var i of this._statisticFields){var s=i.name;switch(i.statisticType){case"norm":var a=e[s];if(t&&null==a.onStatisticNormalizationField)break;if(t&&a.onStatisticNormalizationField){r[s]=a.onStatisticField/a.onStatisticNormalizationField;break}r[s]=0;break;case"sum":if(!t)break;var{value:n,nanCount:o}=e[s];if(!(t-o))break;r[s]=n;break;case"avg":if(!t)break;var{value:u,nanCount:l}=e[s];if(!(t-l))break;r[s]=u/(t-l);break;case"avg_angle":if(!t)break;var{x:c,y:h,nanCount:d}=e[s];if(!(t-d))break;var f=c/(t-d),p=h/(t-d),g=180/Math.PI,m=Math.atan2(p,f)*g;r[s]=m;break;case"mode":var v=e[s],y=0,b=null;for(var _ in v){var O=v[_];O>y&&(y=O,b=_)}r[s]="null"===b?null:b}}return r}}class et{constructor(e,t,r){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.displayIds=new Set,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this.children=new Array(32);for(var i=0;i<this.children.length;i++)this.children[i]=null;this.xNode=e,this.yNode=t,this.depth=r}realloc(e,t,r){for(var i=0;i<this.children.length;i++)this.children[i]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this.displayIds.clear(),this}add(e){this.displayIds.add(e)}remove(e){this.displayIds.delete(e)}getLngLatBounds(){var e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),i=30-(3*t+2*r),s=30-(2*t+3*r);return function(e,t){for(var r=-90,i=90,s=-180,a=180,n=0;n<t;n++){for(var o=Math.ceil((n+1)/2),u=Math.floor((n+1)/2),l=1-n%2,c=30-(3*o+2*u),h=30-(2*o+3*u),d=3*l+2*(1-l),f=2*l+3*(1-l),p=3*l+7*(1-l)<<h,g=(7*l+3*(1-l)<<c&e.geohashX)>>c,m=(p&e.geohashY)>>h,v=d-1;v>=0;v--){var y=(s+a)/2,b=g&1<<v?1:0;s=(1-b)*s+b*y,a=(1-b)*y+b*a}for(var _=f-1;_>=0;_--){var O=(r+i)/2,j=m&1<<_?1:0;r=(1-j)*r+j*O,i=(1-j)*O+j*i}}return[s,r,a,i]}({geohashX:this.xNode<<i,geohashY:this.yNode<<s},this.depth)}find(e,t,r,i,s,a){if(i>=r)return this;var n=1-i%2,o=3*n+2*(1-n),u=2*n+3*(1-n),l=30-s-o,c=30-a-u,h=((e&7*n+3*(1-n)<<l)>>l)+((t&3*n+7*(1-n)<<c)>>c)*(8*n+4*(1-n)),d=this.children[h];return null==d?null:d.find(e,t,r,i+1,s+o,a+u)}}var tt=r(122),rt=r(400),it=r(930);class st extends Q.a{constructor(e,t,r,i,s){super(new Y.a([],[t,r]),i,null,e),this.geohashBoundsInfo=s}get count(){return this.attributes.cluster_count}static create(e,t,r,i,s,a,n,o){var u=new st(t,r,i,a,n);return u.displayId=e.createDisplayId(!0),u.referenceId=o,u.tileLevel=s,u}update(e,t,r,i,s,a){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=i,this.geohashBoundsInfo=s,this.referenceId=null,this.referenceId=a,this}toJSON(){return{objectId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null,attributes:Object(p.a)(Object(p.a)({},this.attributes),{},{clusterId:this.objectId}),geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}}}function at(e){return 57.29577951308232*e}class nt extends it.a{constructor(e,t,r){super(e,r),this.events=new le.a,this._geohashLevel=0,this._aggregateValueRanges={},this._aggregateValueRangesChanged=!1,this._geohashBuf=[],this._clusters=new Map,this._tiles=new Map,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=Object(rt.a)(t,A.a.WGS84),this._bitsets.geohash=r.getBitset(r.createBitset()),this._bitsets.inserted=r.getBitset(r.createBitset())}updateSchema(e,t){var r=()=>super.updateSchema,s=this;return Object(i.a)((function*(){var i=s._schema;try{yield r().call(s,e,t),yield s._projectionSupportCheck}catch(o){}var n=Object(he.a)(i,t);t&&(!Object(g.j)(n)||e.source||e.storage.filters)?((Object(he.b)(n,"params.fields")||!s._tree||e.source)&&(s._tree=new Ke(s._statisticFields),s._rebuildTree(),Object(a.a)("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),Object(a.a)("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",n),e.targets[t.name]=!0,e.mesh=!1,s._aggregateValueRanges={}):i&&(e.mesh=!0)}))()}sweepFeatures(e,t){this._bitsets.inserted.forEachSet((r=>{if(!e.has(r)){var i=t.lookupByDisplayIdUnsafe(r);this._remove(i)}}))}sweepClusters(e,t,r){this._clusters.forEach(((i,s)=>{i&&i.tileLevel!==r&&(e.releaseDisplayId(i.displayId),t.unsetAttributeData(i.displayId),this._clusters.delete(s))}))}onTileData(e,t,r,i,s=!0){if(!this._schema||Object(g.j)(t.addOrUpdate))return t;for(var a=this._tree,n=this._getTransforms(e,this._spatialReference),o=t.addOrUpdate.getCursor();o.next();)this._update(o,i,a);if(t.status.mesh||!s)return t;var u=new Array,l=this._schema.params.clusterRadius;this._getClustersForTile(u,e,l,r,a,n),t.addOrUpdate=_.a.fromOptimizedFeatures(u,"esriGeometryPoint"),t.addOrUpdate.attachStorage(r),t.end=!0;for(var c=t.addOrUpdate.getCursor();c.next();){var h=c.getDisplayId();this._bitsets.computed.unset(h),this.setComputedAttributes(r,c,h,e.scale)}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t}onTileUpdate({added:e,removed:t}){if(e.length){var r=e[0].level;this._setGeohashLevel(r)}if(this._schema){var i=this._schema.params.clusterRadius;t.forEach((e=>{this._tiles.delete(e.key.id),this._markTileClustersForDeletion(e,i)}))}}getAggregate(e){var t=null;return this._clusters.forEach((r=>{r&&r.displayId===e&&(t=r.toJSON())})),t}getDisplayId(e){var t=this._clusters.get(e);return t?t.displayId:null}getFeatureDisplayIdsForAggregate(e){var t=this._clusters.get(e);if(!t)return[];var r=t.geohashBoundsInfo;return this._tree.getRegionDisplayIds(r.xLL,r.yLL,r.xTR,r.yTR,r.level)}getDisplayIdForReferenceId(e){var t;return this._clusters.forEach((r=>{r&&r.referenceId===e&&(t=r.displayId)})),t}getAggregateValueRanges(){return this._aggregateValueRanges}forEach(e){this._clusters.forEach(((t,r)=>{t&&e(t,r)}))}size(){var e=0;return this.forEach((t=>e++)),e}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){var t=e.getDisplayId(),r=e.getXHydrate(),i=e.getYHydrate(),s=this._geohashBuf[2*t],a=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,r,i,s,a,this._geohashLevel))}_update(e,t,r){var i=e.getDisplayId(),s=this._bitsets.inserted,a=t.isVisible(i);if(a!==s.has(i))if(a){var n=e.getXHydrate(),o=e.getYHydrate();if(this._setGeohash(i,n,o)){var u=this._geohashBuf[2*i],l=this._geohashBuf[2*i+1];r.insertCursor(e,i,n,o,u,l,this._geohashLevel),s.set(i)}}else this._remove(e)}_setGeohash(e,t,r){if(this._bitsets.geohash.has(e))return!0;var i=this._geohashBuf;if(this._spatialReference.isWebMercator){var s=at(t/He.a.radius),a=s-360*Math.floor((s+180)/360);$e(i,e,at(Math.PI/2-2*Math.atan(Math.exp(-1*r/He.a.radius))),a,12)}else{var n=Object(rt.b)({x:t,y:r},this._spatialReference,A.a.WGS84);if(!n)return!1;$e(i,e,n.y,n.x,12)}return this._bitsets.geohash.set(e),!0}_getClustersForTile(e,t,r,i,s,a,n=!0){for(var o=this,u=this._schema.params.clusterPixelBuffer,l=2*r,c=this._getGeohashLevel(t.key.level),h=Math.ceil(Math.pow(2,t.key.level)*tt.E/l),d=Math.ceil(u/l)+0,f=Math.ceil(tt.E/l),{row:m,col:v}=t.key,b=v*tt.E,_=m*tt.E,O=Math.floor(b/l)-d,j=Math.floor(_/l)-d,x=O+f+2*d,w=j+f+2*d,I=t.tileInfoView.getLODInfoAt(t.key.level),S=O;S<=x;S++)for(var T=function(r){var u=S;I.wrap&&(u=S<0?S+h:S%h);var l=I.wrap&&S<0,d=I.wrap&&S%h!==S,f=o._lookupCluster(i,I,t.key.level,u,r,c,s);if(Object(g.k)(f)){var m=Object(g.b)(a,(e=>l?e.left:d?e.right:e.tile));if(n&&Object(g.j)(m))return"continue";if(!f.count)return"continue";if(Object(g.k)(m)&&n){var v=f.geometry.clone(),b=f.attributes;v.coords[0]=Object(y.v)(m,v.coords[0]),v.coords[1]=Object(y.w)(m,v.coords[1]),1===f.count&&Object(g.k)(f.referenceId)&&(b=Object(p.a)(Object(p.a)({},f.attributes),{},{referenceId:f.referenceId}));var _=new Q.a(v,b);_.displayId=f.displayId,e.push(_)}}},F=j;F<=w;F++)T(F)}_getGeohashLevel(e){return Math.min(Math.ceil(e/2+2),12)}_setGeohashLevel(e){var t=this._getGeohashLevel(e),r=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==r)return this._geohashLevel=r,this._rebuildTree(),void this._bitsets.geohash.clear()}_getTransforms(e,t){var r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},i=Object(R.d)(t);if(!i)return{tile:r,left:null,right:null};var[s,a]=i.valid;return{tile:r,left:Object(p.a)(Object(p.a)({},r),{},{translate:[a,e.bounds[3]]}),right:Object(p.a)(Object(p.a)({},r),{},{translate:[s-a+e.bounds[0],e.bounds[3]]})}}_getClusterId(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r}_markForDeletion(e,t,r){var i=this._getClusterId(e,t,r);this._clusters.delete(i)}_getClusterBounds(e,t,r){var i=this._schema.params.clusterRadius,s=2*i,a=r%2?t*s:t*s-i,n=r*s,o=a+s,u=n-s,l=Math.pow(2,e.level)*tt.E;e.wrap&&a<0&&(a=0),e.wrap&&o>l&&(o=l);var c=a/tt.E,h=n/tt.E,d=o/tt.E,f=u/tt.E;return[e.getXForColumn(c),e.getYForRow(h),e.getXForColumn(d),e.getYForRow(f)]}_lookupCluster(e,t,r,i,s,a,n){var o=this._getClusterId(r,i,s),u=this._clusters.get(o),[l,c,h,d]=this._getClusterBounds(t,i,s),f={x:l,y:c},m={x:h,y:d},v=0,y=0,b=0,_=0;if(this._spatialReference.isWebMercator){var O=at(f.x/He.a.radius);v=O-360*Math.floor((O+180)/360),y=at(Math.PI/2-2*Math.atan(Math.exp(-1*f.y/He.a.radius)));var j=at(m.x/He.a.radius);b=j-360*Math.floor((j+180)/360),_=at(Math.PI/2-2*Math.atan(Math.exp(-1*m.y/He.a.radius)))}else{var x=Object(rt.b)(f,this._spatialReference,A.a.WGS84),w=Object(rt.b)(m,this._spatialReference,A.a.WGS84);if(!x||!w)return null;v=x.x,y=x.y,b=w.x,_=w.y}var I={geohashX:0,geohashY:0},S={geohashX:0,geohashY:0};We(I,y,v,a),We(S,_,b,a);var T=I.geohashX,F=I.geohashY,M=S.geohashX,k=S.geohashY,C={xLL:T,yLL:F,xTR:M,yTR:k,level:a},R=n.getRegionStatistics(T,F,M,k,a),{count:E,xTotal:N,yTotal:P,referenceId:q}=R,z=E?N/E:0,D=E?P/E:0;if(0===E)return this._clusters.set(o,null),null;var G=Object(p.a)({cluster_count:E},R.attributes),L=Object(g.k)(u)?u.update(z,D,r,G,C,q):st.create(e,o,z,D,r,G,C,q);return 0===E&&(L.geometry.coords[0]=(l+h)/2,L.geometry.coords[1]=(c+d)/2),this._clusters.set(o,L),this._updateAggregateValueRangeForCluster(L,L.tileLevel),L}_updateAggregateValueRangeForCluster(e,t){var r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},i=r.minValue,s=r.maxValue;r.minValue=Math.min(i,e.count),r.maxValue=Math.max(s,e.count),this._aggregateValueRanges[t]=r,i===r.minValue&&s===r.maxValue||(this._aggregateValueRangesChanged=!0)}_markTileClustersForDeletion(e,t){for(var r=2*t,i=Math.ceil(tt.E/r),{row:s,col:a}=e.key,n=a*tt.E,o=s*tt.E,u=Math.floor(n/r),l=Math.floor(o/r),c=u;c<u+i;c++)for(var h=l;h<l+i;h++)this._markForDeletion(e.key.level,c,h)}}function ot(e){if(!Object(m.m)(e)&&!function(e){return"worker:port-closed"===e.name}(e))throw e}function ut(e){return"feature"===e.type&&"snapshot"===e.mode}var lt=class extends l.a{constructor(){super(...arguments),this._storage=new x.a,this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null}initialize(){this._initAttributeStore(),this._initStores(),this._initQueryEngine(),this._initSource(),this._updateQueue=new O.a({concurrency:"geoevent"===this._source.type?1:4,process:(e,t)=>this._onTileMessage(e,{signal:t})}),this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this)),this.watch("updating",(e=>!e&&this.onIdle()))]),this._checkUpdating=setInterval((()=>this.notifyChange("updating")),300)}startup(){var e=this;return Object(i.a)((function*(){e._initAttributeStore(),e.tileStore.tiles.forEach((t=>e._source.subscribe(t)))}))()}_initSource(){var e=this.tileStore.tileScheme;this._source=Ze(this.service,this.spatialReference,e,((e,t)=>(this._invalidated=!0,this._patchTile(e,t))),(()=>this._updateQueue.length<50),this.featureStore),this._proxyEvents()}_proxyEvents(){if("geoevent"===this._source.type){var e=this._source.events;this.handles.add([e.on("connectionStatus",(e=>this.remoteClient.invoke("setProperty",{propertyName:"connectionStatus",value:e}).catch(ot))),e.on("errorString",(e=>this.remoteClient.invoke("setProperty",{propertyName:"errorString",value:e}).catch(ot))),e.on("feature",(e=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}}).catch(ot))),e.on("updateRate",(e=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:Object(p.a)({},e)}).catch(ot)))])}}_initAttributeStore(){this.attributeStore?this.attributeStore.invalidateResources():this.attributeStore=new j.a({type:"remote",initialize:(e,t)=>Object(m.l)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t}).catch(ot)),update:(e,t)=>Object(m.l)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t}).catch(ot)),render:e=>Object(m.l)(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:e}).catch(ot))},this.config)}_initStores(){var e="snapshot"===this.service.type?"snapshot":"on-demand",t={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new w.a(t,this._storage,e),this.aggregateStore=new nt(t,this.spatialReference,this._storage),this.handles.add(this.aggregateStore.events.on("valueRangesChanged",(e=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:e.valueRanges}}).catch(ot)})))}_initQueryEngine(){var e,t=this;null==(e=this.queryEngine)||e.destroy(),this.queryEngine=new I.a({definitionExpression:this.config.definitionExpression,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds:e=>t.aggregateStore.getFeatureDisplayIdsForAggregate(e).map((e=>t.getObjectId(e)))},timeInfo:this.service.timeInfo})}destroy(){this._updateQueue.destroy(),this._source.destroy(),this.queryEngine.destroy(),this.attributeStore&&this.attributeStore.destroy(),clearInterval(this._checkUpdating)}get fieldsIndex(){return new b.a(this.service.fields)}get hasAggregates(){return!!this.config.schema.targets.aggregate}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){return this._source.updating||!!this._updateQueue.length}enableEvent(e){this._source.enableEvent(e.name,e.value)}pause(){this._updateQueue.pause(),this._updateQueue.clear()}update(e,t){var r=this;return Object(i.a)((function*(){r._set("config",t),r._schema=t.schema,r._initQueryEngine(),yield Promise.all([r._source.update(e,t.schema.source),r.featureStore.updateSchema(e,t.schema.targets.feature),r.attributeStore.update(e,t),r.attributeStore.updateFilters(e,r)]),yield r.aggregateStore.updateSchema(e,t.schema.targets.aggregate),Object(a.a)("esri-2d-update-debug")&&e.describe()}))()}applyUpdate(e){var t=this;return Object(i.a)((function*(){e.mesh&&t.clearTiles(),t._updateQueue.clear(),t._updateQueue.resume(),yield t._source.applyUpdate(e),t.notifyChange("updating"),yield Object(v.g)(t,"updating",!0),t.hasAggregates&&(yield Object(m.a)(10),yield Object(v.g)(t,"updating",!0))}))()}onEdits(e){var t=this;return Object(i.a)((function*(){try{var r=e.deletedFeatures.map((e=>Object(p.a)(Object(p.a)({},e),{},{objectId:e.objectId&&-1!==e.objectId?e.objectId:t._lookupObjectIdByGlobalId(e.globalId)})));t.featureStore.invalidate(),yield t._source.edit(Object(p.a)(Object(p.a)({},e),{},{deletedFeatures:r}))}catch(i){}}))()}refresh(){var e=this;return Object(i.a)((function*(){e.featureStore.invalidate(),e.clearTiles(),e._source.refresh(),e._cleanupNeeded=!0,e.notifyChange("updating"),yield Object(v.g)(e,"updating",!0)}))()}clearTiles(){for(var e of this.tileStore.tiles)this.processor.onTileClear(e)}onTileUpdate(e){for(var t of(this.aggregateStore.onTileUpdate(e),e.added))this._source.subscribe(t),this._level=t.level;for(var r of e.removed)this._source.unsubscribe(r),this._cleanupNeeded=!0,this._tileToResolver.has(r.id)&&(this._tileToResolver.get(r.id).resolve(),this._tileToResolver.delete(r.id));this.notifyChange("updating")}onIdle(){this._invalidated&&((this.hasAggregates||"heatmap"===this.processor.type)&&this._repushTiles(),this._invalidated=!1),this._markAndSweep()}queryExtent(e){return this.queryEngine.executeQueryForExtent(e)}queryFeatures(e){return this.queryEngine.executeQuery(e)}queryFeatureCount(e){return this.queryEngine.executeQueryForCount(e)}queryLatestObservations(e){return this.queryEngine.executeQueryForLatestObservations(e)}queryObjectIds(e){return this.queryEngine.executeQueryForIds(e)}queryStatistics(){var e=this;return Object(i.a)((function*(){return Object(p.a)(Object(p.a)({},e.featureStore.storeStatistics),{},{displayedFeatureCount:0,displayedVertexCount:0,displayPreProcessTime:0})}))()}getObjectId(e){return this.featureStore.lookupObjectId(e,this._storage)}getDisplayId(e){if(this._schema.targets.aggregate){var t=this.aggregateStore.getDisplayId(e);if(Object(g.j)(t)){var r=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(r)}return t}return this.featureStore.lookupDisplayId(e)}getFeature(e){var t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(Object(g.j)(t))return null;var r=t.readHydratedGeometry(),i=Object(y.k)(r,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:i}}getAggregate(e){return this.aggregateStore.getAggregate(e)}setHighlight(e){var t=this;return Object(i.a)((function*(){var r=e.map((e=>t.getDisplayId(e)));return t.attributeStore.setHighlight(e,r)}))()}_lookupObjectIdByGlobalId(e){var t=this.service.globalIdField;if(Object(g.j)(t))throw new Error("Expected globalIdField to be defined");var r=null;if(this.featureStore.forEach((i=>{e===i.readAttribute(t)&&(r=i.getObjectId())})),Object(g.j)(r))throw new Error("Expected to find a feature with globalId ".concat(e));return r}_repushTiles(){for(var e of this.tileStore.tiles)this._patchTile({type:"append",id:e.key.id,addOrUpdate:_.a.fromOptimizedFeatures([],this.service.geometryType),remove:[],end:!0,status:f.empty()})}_maybeForceCleanup(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()}_patchTile(e,t){var r=this._updateQueue.push(e,t).then((()=>{this.notifyChange("updating")})).catch((e=>{this.notifyChange("updating")}));return this.notifyChange("updating"),r}_onTileMessage(e,t){var r=this;return Object(i.a)((function*(){Object(m.u)(t);var i=r.tileStore.get(e.id);if(i){if(e.clear)return r.processor.onTileClear(i);var s=e.status;e.remove.length&&(r._cleanupNeeded=!0);var a=[];for(var n of e.remove)a.push(r.featureStore.lookupDisplayId(n));e.remove=a;try{if(Object(g.j)(e.addOrUpdate))return void r.processor.onTileMessage(i,Object(p.a)(Object(p.a)({},e),{},{addOrUpdate:null}),r.hasAggregates,t).catch(m.v);if(e.addOrUpdate.setArcadeSpatialReference(r.spatialReference),r.featureStore.hasInstance(e.addOrUpdate.instance)&&s.targets.feature||(s.targets.feature=!0,r.featureStore.onTileData(i,e)),s.storage.data&&s.storage.filters||(s.storage.data=!0,s.storage.filters=!0,r.attributeStore.onTileData(i,e),"geoevent"===r._source.type?(yield r.attributeStore.sendUpdates(),Object(m.u)(t)):r.attributeStore.sendUpdates()),r.hasAggregates&&!s.targets.aggregate){s.targets.aggregate=!0;var o=ut(r._source)&&r._source.loading,u=!ut(r._source)||o||e.end;if(r.aggregateStore.onTileData(i,e,r._storage,r.attributeStore,u),!u)return;s.mesh||(r.attributeStore.onTileData(i,e),r.attributeStore.sendUpdates(),r.processor.onTileClear(i))}s.mesh||(s.mesh=!0,yield r.processor.onTileMessage(i,e,r.hasAggregates,t),Object(m.u)(t)),r._maybeForceCleanup()}catch(l){Object(m.v)(l)}}}))()}_mark(e,t,r){var i=(4294901760&this._storage.getInstanceId(e))>>>16;e&&(t.add(i),r.set(e))}_markAndSweep(){if(this._lastCleanup=performance.now(),this._cleanupNeeded&&"geoevent"!==this._source.type&&"snapshot"!==this._source.mode){this._cleanupNeeded=!1;var e=this._storage.getBitset(this._markedIdsBufId),t=new Set;for(var r of(e.clear(),this.tileStore.tiles))this._source.forEachRequest(r.key.id,(r=>{if(!Object(g.j)(r.addOrUpdate))for(var i=r.addOrUpdate.getCursor();i.next();){var s=i.getDisplayId();if(!s){var a=i.getObjectId();s=this.featureStore.lookupDisplayId(a)}this._mark(s,t,e)}}));this._source.forEachPendingEdit((r=>{var i=this.featureStore.lookupDisplayId(r);this._mark(i,t,e)})),this._updateQueue.forEach((r=>{for(var i of r.remove){var s=this.featureStore.lookupDisplayId(i);this._mark(s,t,e)}})),this.config.schema.targets.aggregate&&(this.aggregateStore.sweepFeatures(e,this.featureStore),this.aggregateStore.sweepClusters(this._storage,this.attributeStore,this._level)),this.featureStore.sweepFeatures(e,this._storage,this.attributeStore),this.featureStore.sweepFeatureSets(t)}}};Object(s.a)([Object(o.b)({constructOnly:!0})],lt.prototype,"tileStore",void 0),Object(s.a)([Object(o.b)()],lt.prototype,"config",void 0),Object(s.a)([Object(o.b)({readOnly:!0})],lt.prototype,"fieldsIndex",null),Object(s.a)([Object(o.b)()],lt.prototype,"processor",void 0),Object(s.a)([Object(o.b)({constructOnly:!0})],lt.prototype,"remoteClient",void 0),Object(s.a)([Object(o.b)({constructOnly:!0})],lt.prototype,"service",void 0),Object(s.a)([Object(o.b)()],lt.prototype,"spatialReference",null),Object(s.a)([Object(o.b)()],lt.prototype,"updating",null);var ct=lt=Object(s.a)([Object(u.a)("esri.views.2d.layers.features.controllers.FeatureController2D")],lt),ht=new Set;function dt(){return ht}var ft=class extends l.a{constructor(){super(...arguments),this.controller=null,this.processor=null,this.remoteClient=null,this.tileStore=null,this.service=null,this.viewState=null}initialize(){this.handles.add(this.watch("updating",(e=>{this.remoteClient.invoke("setUpdating",e).catch((e=>{}))})))}destroy(){var e,t,r;null==(e=this.controller)||e.destroy(),null==(t=this.processor)||t.destroy(),null==(r=this.tileStore)||r.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null}get updating(){return!this.controller||this.controller.updating}startup({service:e,config:t,tileInfo:r,tiles:s}){var a=this;return Object(i.a)((function*(){if(a.service=e,!a.tileStore){var i=new h.a(c.a.fromJSON(r));a.tileStore=new d.a(i)}a.tileStore.clear(),yield a._createProcessorAndController(t),yield a.update({config:t},!0),a.tileStore.updateTiles(s)}))()}updateTiles(e){var t=this;return Object(i.a)((function*(){t.tileStore.updateTiles(e)}))()}update({config:e},t=!1){var r=this;return Object(i.a)((function*(){var i=f.empty();return t||r.controller.pause(),yield Promise.all([r.processor.update(i,e),r.controller.update(i,e)]),i.toJSON()}))()}applyUpdate(e){var t=this;return Object(i.a)((function*(){return t.controller.applyUpdate(f.create(e))}))()}_createProcessorAndController(e){var t=this;return Object(i.a)((function*(){yield Promise.all([t._handleControllerConfig(e),t._handleProcessorConfig(e)]),t.controller.processor=t.processor}))()}_handleControllerConfig(e){var t=this;return Object(i.a)((function*(){var r=yield t._createController(t.service,e);return yield r.startup(),r}))()}_handleProcessorConfig(e){var t=this;return Object(i.a)((function*(){return t._createProcessor(t.service,e)}))()}_createController(e,t){var r=this;return Object(i.a)((function*(){r.controller&&r.controller.destroy();var{tileStore:i,remoteClient:s}=r,a=new ct({service:e,config:t,tileStore:i,remoteClient:s});return r.controller=a,a}))()}_createProcessor(e,t){var s=this;return Object(i.a)((function*(){var i=t.schema.processors[0].type,a=(yield function(e){return"heatmap"===e?r.e(171).then(r.bind(null,1204)):Promise.all([r.e(4),r.e(17),r.e(21),r.e(43),r.e(95)]).then(r.bind(null,1205))}(i)).default,{remoteClient:n,tileStore:o}=s,u=new a({service:e,config:t,tileStore:o,remoteClient:n});return s.processor&&s.processor.destroy(),s.processor=u,u}))()}};Object(s.a)([Object(o.b)()],ft.prototype,"controller",void 0),Object(s.a)([Object(o.b)()],ft.prototype,"processor",void 0),Object(s.a)([Object(o.b)()],ft.prototype,"updating",null),Object(s.a)([Object(o.b)()],ft.prototype,"viewState",void 0);var pt=ft=Object(s.a)([Object(u.a)("esri.views.2d.layers.features.Pipeline")],ft);t.default=pt},123:function(e,t,r){"use strict";var i,s=r(91),a=r(82),n=(r(80),r(92)),o=r(89),u=(r(81),r(88),r(85)),l=r(84),c=(r(83),r(86),r(87),r(90)),h=r(100),d=r(101),f=r(169),p=r(138),g=r(189),m=i=class extends c.a{constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Object(g.a)(),configurable:!0})}normalizeCtorArgs(e,t,r,i){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:r,popupTemplate:i}}set attributes(e){var t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){var t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){var t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){var t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){return this.popupTemplate?this.popupTemplate:this.sourceLayer?"popupTemplate"in this.sourceLayer&&this.sourceLayer.popupTemplate?this.sourceLayer.popupTemplate:e&&"defaultPopupTemplate"in this.sourceLayer&&Object(o.k)(this.sourceLayer.defaultPopupTemplate)?this.sourceLayer.defaultPopupTemplate:null:null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){var r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{geometry:Object(o.k)(this.geometry)?this.geometry.toJSON():null,symbol:Object(o.k)(this.symbol)?this.symbol.toJSON():null,attributes:Object(s.a)({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}clone(){return new i(this.cloneProperties())}cloneProperties(){return{attributes:Object(n.a)(this.attributes),geometry:Object(n.a)(this.geometry),layer:this.layer,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),sourceLayer:this.sourceLayer,symbol:Object(n.a)(this.symbol),visible:this.visible}}_notifyLayer(e,t,r,i){if(this.layer&&"graphicChanged"in this.layer){var s={graphic:this,property:e,oldValue:t,newValue:r};"attributes"===e&&(s.attributeName=i),this.layer.graphicChanged(s)}}};Object(a.a)([Object(u.b)({value:null})],m.prototype,"attributes",null),Object(a.a)([Object(u.b)({value:null,types:d.a,json:{read:h.a}})],m.prototype,"geometry",null),Object(a.a)([Object(u.b)({type:Boolean})],m.prototype,"isAggregate",void 0),Object(a.a)([Object(u.b)()],m.prototype,"layer",void 0),Object(a.a)([Object(u.b)({type:f.a})],m.prototype,"popupTemplate",void 0),Object(a.a)([Object(u.b)()],m.prototype,"sourceLayer",void 0),Object(a.a)([Object(u.b)({value:null,types:p.e})],m.prototype,"symbol",null),Object(a.a)([Object(u.b)({type:Boolean,value:!0})],m.prototype,"visible",null),m=i=Object(a.a)([Object(l.a)("esri.Graphic")],m),(m||(m={})).generateUID=g.a;var v=m;t.a=v},125:function(e,t,r){"use strict";r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return b})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return g})),r.d(t,"g",(function(){return v})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return s})),r.d(t,"j",(function(){return O})),r.d(t,"k",(function(){return l})),r.d(t,"l",(function(){return c})),r.d(t,"m",(function(){return o})),r.d(t,"n",(function(){return n})),r.d(t,"o",(function(){return d})),r.d(t,"p",(function(){return y})),r.d(t,"q",(function(){return _})),r.d(t,"r",(function(){return u})),r.d(t,"s",(function(){return h}));r(80),r(89);var i=r(103);function s(e=w){return[e[0],e[1],e[2],e[3]]}function a(e){return[e[0],e[1],e[2],e[3]]}function n(e,t,r,i,a=s()){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a}function o(e,t=s()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function u(e,t){return new i.a({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function l(e,t,r=e){if("length"in t)j(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[0]),r[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":r[0]=Math.min(e[0],t.xmin),r[1]=Math.min(e[1],t.ymin),r[2]=Math.max(e[2],t.xmax),r[3]=Math.max(e[3],t.ymax);break;case"point":r[0]=Math.min(e[0],t.x),r[1]=Math.min(e[1],t.y),r[2]=Math.max(e[2],t.x),r[3]=Math.max(e[3],t.y)}return r}function c(e,t,r=e){for(var i=t.length,s=e[0],a=e[1],n=e[2],o=e[3],u=0;u<i;u++){var l=t[u];s=Math.min(s,l[0]),a=Math.min(a,l[1]),n=Math.max(n,l[0]),o=Math.max(o,l[1])}return r[0]=s,r[1]=a,r[2]=n,r[3]=o,r}function h(e){return e[0]>=e[2]?0:e[2]-e[0]}function d(e){return e[1]>=e[3]?0:e[3]-e[1]}function f(e){return h(e)*d(e)}function p(e,t){return m(e,t[0],t[1])}function g(e,t){return m(e,t.x,t.y)}function m(e,t,r){return t>=e[0]&&r>=e[1]&&t<=e[2]&&r<=e[3]}function v(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[0]<=e[2]+r&&t[1]<=e[3]+r}function y(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function b(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function _(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function O(e){return e?_(e,x):s(x)}function j(e){return 4===e.length}var x=[1/0,1/0,-1/0,-1/0],w=[0,0,0,0]},132:function(e,t,r){"use strict";var i,s=r(82),a=(r(80),r(92)),n=r(89),o=(r(81),r(88)),u=r(85),l=r(116),c=r(95),h=r(84),d=r(96),f=(r(83),r(86),r(87),r(90)),p=r(99),g=r(113),m=r(100),v=r(101),y=r(150),b=r(170),_=r(250),O=r(246),j=new c.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),x=new c.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),w=i=class extends f.a{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.datumTransformation=null,this.distance=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.units=null,this.where=null}static from(e){return Object(o.d)(i,e)}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){var r={};for(var i in e){var s=e[i];Array.isArray(s)?r[i]=s.map((e=>e instanceof Date?e.getTime():e)):s instanceof Date?r[i]=s.getTime():r[i]=s}t.parameterValues=r}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new i(Object(a.a)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:Object(n.k)(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))}};w.MAX_MAX_RECORD_COUNT_FACTOR=5,Object(s.a)([Object(u.b)({json:{write:!0}})],w.prototype,"aggregateIds",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{writer:(e,t)=>{null!=e&&(t.cacheHint=e)}}}})],w.prototype,"cacheHint",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],w.prototype,"datumTransformation",void 0),Object(s.a)([Object(l.a)("datumTransformation")],w.prototype,"castDatumTransformation",null),Object(s.a)([Object(u.b)({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],w.prototype,"distance",void 0),Object(s.a)([Object(u.b)({type:b.a,json:{write:!0}})],w.prototype,"dynamicDataSource",void 0),Object(s.a)([Object(u.b)({type:String,json:{write:!0}})],w.prototype,"gdbVersion",void 0),Object(s.a)([Object(u.b)({types:v.a,json:{read:m.a,write:!0}})],w.prototype,"geometry",void 0),Object(s.a)([Object(u.b)({type:Number,json:{write:!0}})],w.prototype,"geometryPrecision",void 0),Object(s.a)([Object(u.b)({type:[String],json:{write:!0}})],w.prototype,"groupByFieldsForStatistics",void 0),Object(s.a)([Object(u.b)({type:String,json:{write:!0}})],w.prototype,"having",void 0),Object(s.a)([Object(u.b)({type:Date})],w.prototype,"historicMoment",void 0),Object(s.a)([Object(d.a)("historicMoment")],w.prototype,"writeHistoricMoment",null),Object(s.a)([Object(u.b)({type:Number,json:{write:!0}})],w.prototype,"maxAllowableOffset",void 0),Object(s.a)([Object(u.b)({type:Number,cast:e=>e<1?1:e>i.MAX_MAX_RECORD_COUNT_FACTOR?i.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],w.prototype,"maxRecordCountFactor",void 0),Object(s.a)([Object(u.b)({type:String,json:{write:!0}})],w.prototype,"multipatchOption",void 0),Object(s.a)([Object(u.b)({type:Number,json:{read:{source:"resultRecordCount"}}})],w.prototype,"num",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],w.prototype,"objectIds",void 0),Object(s.a)([Object(u.b)({type:[String],json:{write:!0}})],w.prototype,"orderByFields",void 0),Object(s.a)([Object(u.b)({type:[String],json:{write:!0}})],w.prototype,"outFields",void 0),Object(s.a)([Object(u.b)({type:p.a,json:{read:{source:"outSR"},write:{target:"outSR"}}})],w.prototype,"outSpatialReference",void 0),Object(s.a)([Object(u.b)({type:[O.a],json:{write:{enabled:!0,overridePolicy(){return{enabled:Object(n.k)(this.outStatistics)&&this.outStatistics.length>0}}}}})],w.prototype,"outStatistics",void 0),Object(s.a)([Object(u.b)({json:{write:!0}})],w.prototype,"parameterValues",void 0),Object(s.a)([Object(d.a)("parameterValues")],w.prototype,"writeParameterValues",null),Object(s.a)([Object(u.b)({type:g.a,json:{write:!0}})],w.prototype,"pixelSize",void 0),Object(s.a)([Object(u.b)({type:_.a,json:{write:!0}})],w.prototype,"quantizationParameters",void 0),Object(s.a)([Object(u.b)({type:[Object],json:{write:!0}})],w.prototype,"rangeValues",void 0),Object(s.a)([Object(u.b)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],w.prototype,"relationParameter",void 0),Object(s.a)([Object(u.b)({type:String,json:{write:!0}})],w.prototype,"resultType",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnCentroid",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnDistinctValues",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:!e})}}})],w.prototype,"returnExceededLimitFeatures",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:!0}})],w.prototype,"returnGeometry",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnQueryGeometry",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnM",void 0),Object(s.a)([Object(u.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],w.prototype,"returnZ",void 0),Object(s.a)([Object(u.b)({type:p.a,json:{write:!0}})],w.prototype,"sourceSpatialReference",void 0),Object(s.a)([Object(u.b)({type:String,json:{read:{source:"spatialRel",reader:j.read},write:{target:"spatialRel",writer:j.write}}})],w.prototype,"spatialRelationship",void 0),Object(s.a)([Object(u.b)({type:Number,json:{read:{source:"resultOffset"}}})],w.prototype,"start",void 0),Object(s.a)([Object(d.a)("start"),Object(d.a)("num")],w.prototype,"writeStart",null),Object(s.a)([Object(u.b)({type:String,json:{write:!0}})],w.prototype,"sqlFormat",void 0),Object(s.a)([Object(u.b)({type:String,json:{write:!0}})],w.prototype,"text",void 0),Object(s.a)([Object(u.b)({type:y.a,json:{write:!0}})],w.prototype,"timeExtent",void 0),Object(s.a)([Object(u.b)({type:String,json:{read:x.read,write:{writer:x.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],w.prototype,"units",void 0),Object(s.a)([Object(u.b)({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||this.start>0}}}}})],w.prototype,"where",void 0),Object(s.a)([Object(d.a)("where")],w.prototype,"writeWhere",null);var I=w=i=Object(s.a)([Object(h.a)("esri.tasks.support.Query")],w);t.a=I},133:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i}));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof e||"undefined"!=typeof self&&self;function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function s(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return a(null==t&&r.path)}},r.exports),r.exports}function a(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}}).call(this,r(172))},140:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return l}));r(80);var i=r(95);function s(e){return e}var a={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}},n=Object(i.b)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:null});function o(e,t,r){var i=new Date(e.getTime());if(t&&r){var s=a[r],{getter:n,setter:o,multiplier:u}=s;i[o](i[n]()+t*u)}return i}var u={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8};function l(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return null}}},146:function(e,t,r){"use strict";r.r(t);var i=r(82),s=(r(80),r(89)),a=(r(81),r(88),r(85)),n=r(95),o=r(98),u=r(84),l=r(96),c=(r(83),r(86),r(87),r(90)),h=r(99),d=r(100),f=r(101),p=r(123),g=r(155),m=new n.a({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null}),v=class extends c.a{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){for(var r=h.a.fromJSON(t.spatialReference),i=[],a=0;a<e.length;a++){var n=e[a],o=p.a.fromJSON(n),u=n.geometry&&n.geometry.spatialReference;Object(s.k)(o.geometry)&&!u&&(o.geometry.spatialReference=r),i.push(o)}return i}writeGeometryType(e,t,r,i){if(e)m.write(e,t,r,i);else{var{features:a}=this;if(a)for(var n of a)if(n&&Object(s.k)(n.geometry))return void m.write(n.geometry.type,t,r,i)}}readQueryGeometry(e,t){if(!e)return null;var r=!!e.spatialReference,i=Object(d.a)(e);return!r&&t.spatialReference&&(i.spatialReference=h.a.fromJSON(t.spatialReference)),i}writeSpatialReference(e,t){if(e)t.spatialReference=e.toJSON();else{var{features:r}=this;if(r)for(var i of r)if(i&&Object(s.k)(i.geometry)&&i.geometry.spatialReference)return void(t.spatialReference=i.geometry.spatialReference.toJSON())}}toJSON(e){var t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var i=t.features[r];if(i.geometry){var s=e&&e[r];i.geometry=s&&s.toJSON()||i.geometry}}return t}quantize(e){for(var{scale:[t,r],translate:[i,a]}=e,n=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-i)/t)),(e=>Math.round((a-e)/r))),u=0,l=n.length;u<l;u++)o(Object(s.q)(n[u].geometry))||(n.splice(u,1),u--,l--);return this.transform=e,this}unquantize(){var{geometryType:e,features:t,transform:r}=this;if(!r)return this;var{translate:[i,a],scale:[n,o]}=r,u=this._getHydrationFunction(e,(e=>e*n+i),(e=>a-e*o));for(var{geometry:l}of t)Object(s.k)(l)&&u(l);return this.transform=null,this}_quantizePoints(e,t,r){for(var i,s,a=[],n=0,o=e.length;n<o;n++){var u=e[n];if(n>0){var l=t(u[0]),c=r(u[1]);l===i&&c===s||(a.push([l-i,c-s]),i=l,s=c)}else i=t(u[0]),s=r(u[1]),a.push([i,s])}return a.length>0?a:null}_getQuantizationFunction(e,t,r){return"point"===e?e=>(e.x=t(e.x),e.y=r(e.y),e):"polyline"===e||"polygon"===e?e=>{for(var i=Object(d.g)(e)?e.rings:e.paths,s=[],a=0,n=i.length;a<n;a++){var o=i[a],u=this._quantizePoints(o,t,r);u&&s.push(u)}return s.length>0?(Object(d.g)(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?e=>{var i=this._quantizePoints(e.points,t,r);return i.length>0?(e.points=i,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,r){return"point"===e?e=>{e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?e=>{for(var i,s,a=Object(d.g)(e)?e.rings:e.paths,n=0,o=a.length;n<o;n++)for(var u=a[n],l=0,c=u.length;l<c;l++){var h=u[l];l>0?(i+=h[0],s+=h[1]):(i=h[0],s=h[1]),h[0]=t(i),h[1]=r(s)}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?e=>{for(var i,s,a=e.points,n=0,o=a.length;n<o;n++){var u=a[n];n>0?(i+=u[0],s+=u[1]):(i=u[0],s=u[1]),u[0]=t(i),u[1]=r(s)}}:void 0}};Object(i.a)([Object(a.b)({type:String,json:{write:!0}})],v.prototype,"displayFieldName",void 0),Object(i.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],v.prototype,"exceededTransferLimit",void 0),Object(i.a)([Object(a.b)({type:[p.a],json:{write:!0}})],v.prototype,"features",void 0),Object(i.a)([Object(o.a)("features")],v.prototype,"readFeatures",null),Object(i.a)([Object(a.b)({type:[g.a],json:{write:!0}})],v.prototype,"fields",void 0),Object(i.a)([Object(a.b)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m.read}}})],v.prototype,"geometryType",void 0),Object(i.a)([Object(l.a)("geometryType")],v.prototype,"writeGeometryType",null),Object(i.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],v.prototype,"hasM",void 0),Object(i.a)([Object(a.b)({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],v.prototype,"hasZ",void 0),Object(i.a)([Object(a.b)({types:f.a,json:{write:!0}})],v.prototype,"queryGeometry",void 0),Object(i.a)([Object(o.a)("queryGeometry")],v.prototype,"readQueryGeometry",null),Object(i.a)([Object(a.b)({type:h.a,json:{write:!0}})],v.prototype,"spatialReference",void 0),Object(i.a)([Object(l.a)("spatialReference")],v.prototype,"writeSpatialReference",null),Object(i.a)([Object(a.b)({json:{write:!0}})],v.prototype,"transform",void 0),(v=Object(i.a)([Object(u.a)("esri.tasks.support.FeatureSet")],v)).prototype.toJSON.isDefaultToJSON=!0,v||(v={});var y=v;t.default=y},150:function(e,t,r){"use strict";var i,s=r(82),a=(r(80),r(81),r(88),r(85)),n=r(98),o=r(84),u=r(96),l=(r(83),r(86),r(87),r(90)),c=r(140),h=i=class extends l.a{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return d}static get empty(){return f}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(i.allTime)}get isEmpty(){return this.equals(i.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new i({end:this.end,start:this.start})}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();var t=this.start?Object(c.e)(this.start,e):null,r=this.end?Object(c.c)(Object(c.e)(this.end,e),1,e):null;return new i({start:t,end:r})}intersection(e){var t,r,s,a,n,o,u,l;if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return i.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();var c,h,d=null!=(t=null==(r=this.start)?void 0:r.getTime())?t:-1/0,f=null!=(s=null==(a=this.end)?void 0:a.getTime())?s:1/0,p=null!=(n=null==(o=e.start)?void 0:o.getTime())?n:-1/0,g=null!=(u=null==(l=e.end)?void 0:l.getTime())?u:1/0;if(p>=d&&p<=f?c=p:d>=p&&d<=g&&(c=d),f>=p&&f<=g?h=f:g>=d&&g<=f&&(h=g),!isNaN(c)&&!isNaN(h)){var m=new i;return m.start=c===-1/0?null:new Date(c),m.end=h===1/0?null:new Date(h),m}return i.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();var r=new i,{start:s,end:a}=this;return s&&(r.start=Object(c.c)(s,e,t)),a&&(r.end=Object(c.c)(a,e,t)),r}equals(e){if(!e)return!1;var t=this.start?this.start.getTime():this.start,r=this.end?this.end.getTime():this.end,i=e.start?e.start.getTime():e.start,s=e.end?e.end.getTime():e.end;return t===i&&r===s}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return d.clone();var t=this.start&&e.start?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,r=this.end&&e.end?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new i({start:t,end:r})}};Object(s.a)([Object(a.b)({type:Date,json:{write:{allowNull:!0}}})],h.prototype,"end",void 0),Object(s.a)([Object(n.a)("end")],h.prototype,"readEnd",null),Object(s.a)([Object(u.a)("end")],h.prototype,"writeEnd",null),Object(s.a)([Object(a.b)({readOnly:!0,json:{read:!1}})],h.prototype,"isAllTime",null),Object(s.a)([Object(a.b)({readOnly:!0,json:{read:!1}})],h.prototype,"isEmpty",null),Object(s.a)([Object(a.b)({type:Date,json:{write:{allowNull:!0}}})],h.prototype,"start",void 0),Object(s.a)([Object(n.a)("start")],h.prototype,"readStart",null),Object(s.a)([Object(u.a)("start")],h.prototype,"writeStart",null);var d=new(h=i=Object(s.a)([Object(o.a)("esri.TimeExtent")],h)),f=new h({start:void 0,end:void 0}),p=h;t.a=p},155:function(e,t,r){"use strict";var i,s=r(82),a=(r(80),r(81),r(88)),n=r(85),o=r(95),u=r(102),l=r(98),c=r(84),h=(r(83),r(86),r(87),r(90)),d=r(149),f=r(237),p=new o.a({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"}),g=i=class extends h.a{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){var r;try{r=JSON.parse(t)}catch(i){}return r?r.value:null}readValueType(e,{description:t}){var r;try{r=JSON.parse(t)}catch(i){}return r?p.fromJSON(r.fieldValueType):null}clone(){return new i({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],g.prototype,"alias",void 0),Object(s.a)([Object(n.b)({type:[String,Number],json:{write:{allowNull:!0}}})],g.prototype,"defaultValue",void 0),Object(s.a)([Object(n.b)()],g.prototype,"description",void 0),Object(s.a)([Object(l.a)("description")],g.prototype,"readDescription",null),Object(s.a)([Object(n.b)({types:d.d,json:{read:{reader:d.b},write:!0}})],g.prototype,"domain",void 0),Object(s.a)([Object(n.b)({type:Boolean,json:{write:!0}})],g.prototype,"editable",void 0),Object(s.a)([Object(n.b)({type:a.a,json:{write:!0}})],g.prototype,"length",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],g.prototype,"name",void 0),Object(s.a)([Object(n.b)({type:Boolean,json:{write:!0}})],g.prototype,"nullable",void 0),Object(s.a)([Object(u.a)(f.a)],g.prototype,"type",void 0),Object(s.a)([Object(n.b)()],g.prototype,"valueType",void 0),Object(s.a)([Object(l.a)("valueType",["description"])],g.prototype,"readValueType",null);var m=g=i=Object(s.a)([Object(c.a)("esri.layers.support.Field")],g);t.a=m},167:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l}));var i=r(82),s=r(85),a=r(84),n=r(97),o=r(115),u=r(297),l=e=>{var t=class extends e{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new o.a}get updatingHandles(){return this._get("updatingHandles")||new u.a}};return Object(i.a)([Object(s.b)({readOnly:!0})],t.prototype,"handles",null),Object(i.a)([Object(s.b)({readOnly:!0})],t.prototype,"updatingHandles",null),t=Object(i.a)([Object(a.a)("esri.core.HandleOwner")],t)},c=class extends(l(n.a)){};c=Object(i.a)([Object(a.a)("esri.core.HandleOwner")],c)},168:function(e,t,r){"use strict";r.d(t,"a",(function(){return V})),r.d(t,"b",(function(){return $})),r.d(t,"c",(function(){return Q})),r.d(t,"d",(function(){return J})),r.d(t,"e",(function(){return Y})),r.d(t,"f",(function(){return L})),r.d(t,"g",(function(){return G})),r.d(t,"h",(function(){return q})),r.d(t,"i",(function(){return X})),r.d(t,"j",(function(){return W})),r.d(t,"k",(function(){return Z})),r.d(t,"l",(function(){return R})),r.d(t,"m",(function(){return O})),r.d(t,"n",(function(){return z})),r.d(t,"o",(function(){return N})),r.d(t,"p",(function(){return ce})),r.d(t,"q",(function(){return re})),r.d(t,"r",(function(){return ae})),r.d(t,"s",(function(){return le})),r.d(t,"t",(function(){return ee})),r.d(t,"u",(function(){return te})),r.d(t,"v",(function(){return v})),r.d(t,"w",(function(){return y})),r.d(t,"x",(function(){return oe})),r.d(t,"y",(function(){return K})),r.d(t,"z",(function(){return ne}));var i=r(81),s=r(93),a=r(100),n=r(292),o=r(316),u=r(178);function l(e,t){return e?t?4:3:t?3:2}var c=i.a.getLogger("esri.tasks.support.optimizedFeatureSet"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},d=(e,t,r,i,s,a)=>{e[r]=s,e[r+1]=a},f=(e,t,r,i,s,a)=>{e[r]=s,e[r+1]=a,e[r+2]=t[i+2]},p=(e,t,r,i,s,a)=>{e[r]=s,e[r+1]=a,e[r+2]=t[i+3]},g=(e,t,r,i,s,a)=>{e[r]=s,e[r+1]=a,e[r+2]=t[i+2],e[r+3]=t[i+3]};function m(e,t,r,i){if(e){if(r)return t&&i?g:f;if(t&&i)return p}else if(t&&i)return f;return d}function v({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function y({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function b({scale:e,translate:t},r){return r*e[0]+t[0]}function _({scale:e,translate:t},r){return t[1]-r*e[1]}function O(e,t,r){return e?t?r?F(e):w(e):r?S(e):j(e):null}function j(e){var t=e.coords;return{x:t[0],y:t[1]}}function x(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function w(e){var t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function I(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function S(e){var t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function F(e){var t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function M(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function k(e,t){return e&&t?M:e?I:t?T:x}function C(e,t,r,i,s){var a=k(r,i);for(var o of t){var{geometry:l,attributes:c}=o,h=void 0;l&&(h=a(new u.a,l)),e.push(new n.a(h,c,null,c[s]))}return e}function R(e,t,r){if(!e)return null;for(var i=l(t,r),s=[],a=0;a<e.coords.length;a+=i){for(var n=[],o=0;o<i;o++)n.push(e.coords[a+o]);s.push(n)}return t?r?{points:s,hasZ:t,hasM:r}:{points:s,hasZ:t}:r?{points:s,hasM:r}:{points:s}}function A(e,t,r,i,s){var a=l(r,i);for(var o of t){var c=o.geometry,h=o.attributes,d=void 0;c&&(d=E(new u.a,c,a)),e.push(new n.a(d,h,null,h[s]))}return e}function E(e,t,r=l(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;var i=e.coords,s=0;for(var a of t.points)for(var n=0;n<r;n++)i[s++]=a[n];return e}function N(e,t,r){if(!e)return null;var i=l(t,r),{coords:s,lengths:a}=e,n=[],o=0;for(var u of a){for(var c=[],h=0;h<u;h++){for(var d=[],f=0;f<i;f++)d.push(s[o++]);c.push(d)}n.push(c)}return t?r?{paths:n,hasZ:t,hasM:r}:{paths:n,hasZ:t}:r?{paths:n,hasM:r}:{paths:n}}function P(e,t,r,i,s){var a=l(r,i);for(var o of t){var c=o.geometry,h=o.attributes,d=void 0;c&&(d=q(new u.a,c,a)),e.push(new n.a(d,h,null,h[s]))}return e}function q(e,t,r=l(t.hasZ,t.hasM)){var{lengths:i,coords:s}=e,a=0;for(var n of t.paths){for(var o of n)for(var u=0;u<r;u++)s[a++]=o[u];i.push(n.length)}return e}function z(e,t,r){if(!e)return null;var i=l(t,r),{coords:s,lengths:a}=e,n=[],o=0;for(var u of a){for(var c=[],h=0;h<u;h++){for(var d=[],f=0;f<i;f++)d.push(s[o++]);c.push(d)}n.push(c)}return t?r?{rings:n,hasZ:t,hasM:r}:{rings:n,hasZ:t}:r?{rings:n,hasM:r}:{rings:n}}function D(e,t,r,i,s){for(var a of t){var o=a.geometry,l=a.centroid,c=a.attributes,h=void 0;o&&(h=G(new u.a,o,r,i)),l?e.push(new n.a(h,c,x(new u.a,l),c[s])):e.push(new n.a(h,c,null,c[s]))}return e}function G(e,t,r=t.hasZ,i=t.hasM){return L(e,t.rings,r,i),e}function L(e,t,r,i){var s=l(r,i),{lengths:a,coords:n}=e,o=0;for(var u of(a.length=n.length=0,t)){for(var c of u)for(var h=0;h<s;h++)n[o++]=c[h];a.push(u.length)}return e}var U=[],B=[];function V(e,t,r,i,s){U[0]=e;var[a]=Q(B,U,t,r,i,s);return U.length=B.length=0,a}function Q(e,t,r,i,a,o){if(e.length=0,!r){for(var u of t){var l=u.attributes[o];e.push(new n.a(null,u.attributes,null,l))}return e}switch(r){case"esriGeometryPoint":return C(e,t,i,a,o);case"esriGeometryMultipoint":return A(e,t,i,a,o);case"esriGeometryPolyline":return P(e,t,i,a,o);case"esriGeometryPolygon":return D(e,t,i,a,o);default:c.error("convertToFeatureSet:unknown-geometry",new s.a("Unable to parse unknown geometry type '".concat(r,"'"))),e.length=0}return e}function Y(e,t,r,i,a,n){var o=e.length;switch(r){case"esriGeometryPoint":C(e,t,i,a,n);break;case"esriGeometryMultipoint":A(e,t,i,a,n);break;case"esriGeometryPolyline":P(e,t,i,a,n);break;case"esriGeometryPolygon":D(e,t,i,a,n);break;default:c.error("convertToFeatureSet:unknown-geometry",new s.a("Unable to parse unknown geometry type '".concat(r,"'")))}for(var u=0;u<t.length;u++)e[u+o].geometryType=r,e[u+o].insertAfter=t[u].insertAfter,e[u+o].groupId=t[u].groupId;return e}function X(e,t,r,i){B[0]=e,H(U,B,t,r,i);var s=U[0];return U.length=B.length=0,s}function J(e,t,r){if(!e)return null;var i=new u.a;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==r&&(r=e.hasM),Object(a.f)(e)?k(null!=t?t:null!=e.z,null!=r?r:null!=e.m)(i,e):Object(a.g)(e)?G(i,e,t,r):Object(a.h)(e)?q(i,e,l(t,r)):Object(a.e)(e)?E(i,e,l(t,r)):void c.error("convertFromGeometry:unknown-geometry",new s.a("Unable to parse unknown geometry type '".concat(e,"'")))}function Z(e,t,r,i){var a=e&&("coords"in e?e:e.geometry);if(!a)return null;switch(t){case"esriGeometryPoint":var n=j;return r&&i?n=F:r?n=w:i&&(n=S),n(a);case"esriGeometryMultipoint":return R(a,r,i);case"esriGeometryPolyline":return N(a,r,i);case"esriGeometryPolygon":return z(a,r,i);default:return void c.error("convertToGeometry:unknown-geometry",new s.a("Unable to parse unknown geometry type '".concat(t,"'")))}}function H(e,t,r,i,a){switch(e.length=0,r){case"esriGeometryPoint":return function(e,t,r,i){var s=j;for(var a of(r&&i?s=F:r?s=w:i&&(s=S),t)){var{geometry:n,attributes:o}=a,u=n?s(n):null;e.push({attributes:o,geometry:u})}return e}(e,t,i,a);case"esriGeometryMultipoint":return function(e,t,r,i){for(var s of t){var{geometry:a,attributes:n}=s,o=void 0;a&&(o=R(a,r,i)),e.push({attributes:n,geometry:o})}return e}(e,t,i,a);case"esriGeometryPolyline":return function(e,t,r,i){for(var s of t){var{geometry:a,attributes:n}=s,o=void 0;a&&(o=N(a,r,i)),e.push({attributes:n,geometry:o})}return e}(e,t,i,a);case"esriGeometryPolygon":return function(e,t,r,i){for(var s of t){var{geometry:a,attributes:n,centroid:o}=s,u=void 0;if(a&&(u=z(a,r,i)),o){var l=j(o);e.push({attributes:n,centroid:l,geometry:u})}else e.push({attributes:n,geometry:u})}return e}(e,t,i,a);default:c.error("convertToFeatureSet:unknown-geometry",new s.a("Unable to parse unknown geometry type '".concat(r,"'")))}return e}function W(e){var{objectIdFieldName:t,spatialReference:r,transform:i,fields:s,hasM:a,hasZ:n,features:o,geometryType:u,exceededTransferLimit:l,uniqueIdField:c,queryGeometry:h,queryGeometryType:d}=e,f={features:H([],o,u,n,a),fields:s,geometryType:u,objectIdFieldName:t,spatialReference:r,uniqueIdField:c,queryGeometry:Z(h,d,!1,!1)};return i&&(f.transform=i),l&&(f.exceededTransferLimit=l),a&&(f.hasM=a),n&&(f.hasZ=n),f}function $(e,t){var r=new o.a,{hasM:i,hasZ:a,features:n,objectIdFieldName:u,spatialReference:l,geometryType:h,exceededTransferLimit:d,transform:f,fields:p}=e;return p&&(r.fields=p),r.geometryType=h,r.objectIdFieldName=u||t,r.spatialReference=l,r.objectIdFieldName?(n&&Q(r.features,n,h,a,i,r.objectIdFieldName),d&&(r.exceededTransferLimit=d),i&&(r.hasM=i),a&&(r.hasZ=a),f&&(r.transform=f),r):(c.error(new s.a("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function K(e){var{transform:t,features:r,hasM:i,hasZ:s}=e;if(!t)return e;for(var a of r)a.geometry&&ne(a.geometry,a.geometry,i,s,t),a.centroid&&ne(a.centroid,a.centroid,i,s,t);return e.transform=null,e}function ee(e,t){var{geometryType:r,features:i,hasM:s,hasZ:a}=t;if(!e)return t;for(var n=0;n<i.length;n++){var o=i[n],l=o.weakClone();l.geometry=new u.a,te(l.geometry,o.geometry,s,a,r,e),o.centroid&&(l.centroid=new u.a,te(l.centroid,o.centroid,s,a,"esriGeometryPoint",e)),i[n]=l}return t.transform=e,t}function te(e,t,r,i,s,a,n=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var u=h[s],{coords:c,lengths:d}=t,f=l(r,i),p=l(r&&n,i&&o),g=m(r,i,n,o);if(!d.length)return g(e.coords,c,0,0,v(a,c[0]),y(a,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;var b,_,O,j,x=0,w=0,I=w;for(var S of d)if(!(S<u)){var T=0;w=I,O=b=v(a,c[x]),j=_=y(a,c[x+1]),g(e.coords,c,w,x,O,j),T++,x+=f,w+=p;for(var F=1;F<S;F++,x+=f)O=v(a,c[x]),j=y(a,c[x+1]),O===b&&j===_||(g(e.coords,c,w,x,O-b,j-_),w+=p,T++,b=O,_=j);T>=u&&(e.lengths.push(T),I=w)}return e.coords.length=I,e.coords.length?e:null}function re(e,t,r,i,s,a,n=r,o=i){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var u=h[s],{coords:c,lengths:d}=t,f=l(r,i),p=l(r&&n,i&&o),g=m(r,i,n,o);if(!d.length)return g(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=f,e;var v=0,y=a*a;for(var b of d)if(b<u)v+=b*f;else{var _=e.coords.length/p,O=v,j=v+(b-1)*f;g(e.coords,c,e.coords.length,O,c[O],c[O+1]),se(e.coords,c,f,y,g,O,j),g(e.coords,c,e.coords.length,j,c[j],c[j+1]);var x=e.coords.length/p-_;x>=u?e.lengths.push(x):e.coords.length=_*p,v+=b*f}return e.coords.length?e:null}function ie(e,t,r,i){var s=e[t],a=e[t+1],n=e[r],o=e[r+1],u=e[i],l=e[i+1],c=n,h=o,d=u-c,f=l-h;if(0!==d||0!==f){var p=((s-c)*d+(a-h)*f)/(d*d+f*f);p>1?(c=u,h=l):p>0&&(c+=d*p,h+=f*p)}return(d=s-c)*d+(f=a-h)*f}function se(e,t,r,i,s,a,n){for(var o,u=i,l=0,c=a+r;c<n;c+=r)(o=ie(t,c,a,n))>u&&(l=c,u=o);u>i&&(l-a>r&&se(e,t,r,i,s,a,l),s(e,t,e.length,l,t[l],t[l+1]),n-l>r&&se(e,t,r,i,s,l,n))}function ae(e,t,r,i){if(!t||!t.coords||!t.coords.length)return null;var s=l(r,i),a=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords)for(var c=t.coords,h=0;h<c.length;h+=s){var d=c[h],f=c[h+1];a=Math.min(a,d),o=Math.max(o,d),n=Math.min(n,f),u=Math.max(u,f)}return e[0]=a,e[1]=n,e[2]=o,e[3]=u,e}function ne(e,t,r,i,s){var{coords:a,lengths:n}=t,o=r?i?g:f:i?f:d,u=l(r,i);if(!a.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!n.length)return o(e.coords,a,0,0,b(s,a[0]),_(s,a[1])),e!==t&&(e.lengths.length=0,e.coords.length=u),e;for(var[c,h]=s.scale,p=0,m=0;m<n.length;m++){var v=n[m];e.lengths[m]=v;var y=b(s,a[p]),O=_(s,a[p+1]);o(e.coords,a,p,p,y,O),p+=u;for(var j=1;j<v;j++,p+=u)y+=a[p]*c,O-=a[p+1]*h,o(e.coords,a,p,p,y,O)}return e!==t&&(e.lengths.length=n.length,e.coords.length=a.length),e}function oe(e,t,r,i,s,a){var n=l(r,i),o=m(r,i,s,a),u=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(var c=0;c<u.length;c+=n)o(e.coords,u,e.coords.length,c,u[c],u[c+1]);return e}function ue(e,t,r,i){for(var s=0,a=e[i*t],n=e[i*(t+1)],o=1;o<r;o++){var u=a+e[i*(t+o)],l=n+e[i*(t+o)+1],c=(u-a)*(l+n);a=u,n=l,s+=c}return.5*s}function le(e,t){for(var{coords:r,lengths:i}=e,s=0,a=0,n=0;n<i.length;n++)a+=ue(r,s,i[n],t),s+=n;return Math.abs(a)}function ce(e,t){for(var r=e.clone(),i=e.coords,s=e.lengths,a=0,n=0;n<s.length;n++){for(var o=s[n],u=i[t*a],l=i[t*a+1],c=1;c<o;c++){var h=u+i[t*(a+c)],d=l+i[t*(a+c)+1];r.coords[t*(a+c)]=h,r.coords[t*(a+c)+1]=d,u=h,l=d}a+=o}return r}},170:function(e,t,r){"use strict";r.d(t,"a",(function(){return R}));var i,s,a=r(82),n=(r(80),r(81),r(88)),o=r(85),u=r(116),l=r(95),c=r(102),h=r(98),d=r(188),f=r(84),p=(r(83),r(86),r(87),r(90)),g=r(155),m=r(262),v=r(99),y=r(183),b=(r(101),i=class extends p.a{constructor(e){super(e),this.type="query-table"}clone(){var e,{workspaceId:t,query:r,oidFields:s,spatialReference:a,geometryType:n}=this,o={workspaceId:t,query:r,oidFields:s,spatialReference:null!=(e=null==a?void 0:a.clone())?e:void 0,geometryType:n};return new i(o)}});Object(a.a)([Object(c.a)({queryTable:"query-table"})],b.prototype,"type",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"workspaceId",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"query",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],b.prototype,"oidFields",void 0),Object(a.a)([Object(o.b)({type:v.a,json:{write:!0}})],b.prototype,"spatialReference",void 0),Object(a.a)([Object(c.a)(y.a)],b.prototype,"geometryType",void 0),b=i=Object(a.a)([Object(f.a)("esri.layers.support.source.QueryTableDataSource")],b);var _,O=s=class extends p.a{constructor(e){super(e),this.type="raster"}clone(){var{workspaceId:e,dataSourceName:t}=this;return new s({workspaceId:e,dataSourceName:t})}};Object(a.a)([Object(c.a)({raster:"raster"})],O.prototype,"type",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],O.prototype,"dataSourceName",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],O.prototype,"workspaceId",void 0),O=s=Object(a.a)([Object(f.a)("esri.layers.support.source.RasterDataSource")],O);var j,x,w=_=class extends p.a{constructor(e){super(e),this.type="table"}clone(){var{workspaceId:e,gdbVersion:t,dataSourceName:r}=this;return new _({workspaceId:e,gdbVersion:t,dataSourceName:r})}};Object(a.a)([Object(c.a)({table:"table"})],w.prototype,"type",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],w.prototype,"workspaceId",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],w.prototype,"gdbVersion",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],w.prototype,"dataSourceName",void 0),w=_=Object(a.a)([Object(f.a)("esri.layers.support.source.TableDataSource")],w);var I=Object(l.b)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"}),S=j=class extends p.a{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,r){return F()(e,t,r)}castLeftTableSource(e){return Object(n.k)(k(),e)}readRightTableSource(e,t,r){return F()(e,t,r)}castRightTableSource(e){return Object(n.k)(k(),e)}clone(){var e,t,{leftTableKey:r,rightTableKey:i,leftTableSource:s,rightTableSource:a,joinType:n}=this,o={leftTableKey:r,rightTableKey:i,leftTableSource:null!=(e=null==s?void 0:s.clone())?e:void 0,rightTableSource:null!=(t=null==a?void 0:a.clone())?t:void 0,joinType:n};return new j(o)}};Object(a.a)([Object(c.a)({joinTable:"join-table"})],S.prototype,"type",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],S.prototype,"leftTableKey",void 0),Object(a.a)([Object(o.b)({type:String,json:{write:!0}})],S.prototype,"rightTableKey",void 0),Object(a.a)([Object(o.b)({json:{write:!0}})],S.prototype,"leftTableSource",void 0),Object(a.a)([Object(h.a)("leftTableSource")],S.prototype,"readLeftTableSource",null),Object(a.a)([Object(u.a)("leftTableSource")],S.prototype,"castLeftTableSource",null),Object(a.a)([Object(o.b)({json:{write:!0}})],S.prototype,"rightTableSource",void 0),Object(a.a)([Object(h.a)("rightTableSource")],S.prototype,"readRightTableSource",null),Object(a.a)([Object(u.a)("rightTableSource")],S.prototype,"castRightTableSource",null),Object(a.a)([Object(c.a)(I)],S.prototype,"joinType",void 0),S=j=Object(a.a)([Object(f.a)("esri.layers.support.source.JoinTableDataSource")],S);var T=null;function F(){return T||(T=Object(d.b)({types:k()})),T}var M=null;function k(){return M||(M={key:"type",base:null,typeMap:{"data-layer":R,"map-layer":m.a}}),M}var C={key:"type",base:null,typeMap:{"join-table":S,"query-table":b,raster:O,table:w}},R=x=class extends p.a{constructor(e){super(e),this.type="data-layer"}clone(){var{fields:e,dataSource:t}=this;return new x({fields:e,dataSource:t})}};Object(a.a)([Object(c.a)({dataLayer:"data-layer"})],R.prototype,"type",void 0),Object(a.a)([Object(o.b)({type:[g.a],json:{write:!0}})],R.prototype,"fields",void 0),Object(a.a)([Object(o.b)({types:C,json:{write:!0}})],R.prototype,"dataSource",void 0),(R=x=Object(a.a)([Object(f.a)("esri.layers.support.source.DataLayerSource")],R)).from=Object(n.m)(R)},173:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return u})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return c})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return h}));var i=r(112),s=r(99),a=r(139);function n(e){return new s.a({wkt:'GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",'.concat(e.radius,',0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]')})}var o=n(a.a),u=n(a.b),l=n(a.c),c=new s.a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",'.concat(a.a.radius,',298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]')});function h(e){return e&&(Object(i.g)(e)||e===u)?u:e&&(Object(i.h)(e)||e===l)?l:o}function d(e){return e&&(Object(i.g)(e)||e===u)?a.b:e&&(Object(i.h)(e)||e===l)?a.c:a.a}function f(e){return Object(i.k)(e)?a.b:Object(i.l)(e)?a.c:a.a}},178:function(e,t,r){"use strict";class i{constructor(e=[],t=[],r=!1){this.lengths=null!=e?e:[],this.coords=null!=t?t:[],this.hasIndeterminateRingOrder=r}get isPoint(){return 0===this.lengths.length}forEachVertex(e){var t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(var r=0;r<this.lengths.length;r++){for(var i=this.lengths[r],s=0;s<i;s++)e(this.coords[2*(s+t)],this.coords[2*(s+t)+1]);t+=i}}clone(){return new i(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}t.a=i},184:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return o}));var i=1e-6,s=Math.random,a=Math.PI/180,n=180/Math.PI;function o(e){return e*a}function u(e){return e*n}Object.freeze({__proto__:null,EPSILON:i,RANDOM:s,toRadian:o,toDegree:u,equals:function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))}})},189:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=0;function s(){return++i}},190:function(e,t,r){"use strict";r.r(t),r.d(t,"executeQuery",(function(){return g})),r.d(t,"executeQueryForCount",(function(){return O})),r.d(t,"executeQueryForExtent",(function(){return j})),r.d(t,"executeQueryForIds",(function(){return _})),r.d(t,"executeQueryPBF",(function(){return v})),r.d(t,"executeQueryPBFBuffer",(function(){return b})),r.d(t,"queryToQueryStringParameters",(function(){return p})),r.d(t,"runQuery",(function(){return x}));var i=r(91),s=r(7),a=r(89),n=r(83),o=r(100),u=r(106),l=r(236),c=r(270),h=r(269),d=r(386),f="Layer does not support extent calculation.";function p(e,t){var r=e.geometry,i=e.toJSON(),s=i;if(Object(a.k)(r)&&(s.geometry=JSON.stringify(r),s.geometryType=Object(o.c)(r),s.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(s.objectIds=i.objectIds.join(",")),i.orderByFields&&(s.orderByFields=i.orderByFields.join(",")),!i.outFields||!i.returnDistinctValues&&(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?delete s.outFields:-1!==i.outFields.indexOf("*")?s.outFields="*":s.outFields=i.outFields.join(","),i.outSR?s.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(s.outSR=s.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(s.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(s.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(s.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(s.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(s.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(s.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){var n=i.timeExtent,{start:u,end:l}=n;null==u&&null==l||(s.time=u===l?u:"".concat(null==u?"null":u,",").concat(null==l?"null":l)),delete i.timeExtent}return s}function g(e,t,r,i){return m.apply(this,arguments)}function m(){return(m=Object(s.a)((function*(e,t,r,i){var s=Object(a.k)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:yield x(e,t,"json",i);return Object(c.a)(t,r,s.data),s}))).apply(this,arguments)}function v(e,t,r,i){return y.apply(this,arguments)}function y(){return(y=Object(s.a)((function*(e,t,r,i){if(Object(a.k)(t.timeExtent)&&t.timeExtent.isEmpty)return Promise.resolve({data:r.createFeatureResult()});var s=yield b(e,t,i),n=s;return n.data=Object(d.a)(s.data,r),n}))).apply(this,arguments)}function b(e,t,r){return x(e,t,"pbf",r)}function _(e,t,r){return Object(a.k)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):x(e,t,"json",r,{returnIdsOnly:!0})}function O(e,t,r){return Object(a.k)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):x(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function j(e,t,r){return Object(a.k)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):x(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(f);if(t.hasOwnProperty("count"))throw new Error(f);return e}))}function x(e,t,r,s={},o={}){var c="string"==typeof e?Object(n.J)(e):e,d=t.geometry?[t.geometry]:[];return s.responseType="pbf"===r?"array-buffer":"json",Object(l.a)(d,null,s).then((e=>{var l=e&&e[0];Object(a.k)(l)&&((t=t.clone()).geometry=l);var d=Object(h.a)(Object(i.a)(Object(i.a)(Object(i.a)({},c.query),{},{f:r},o),p(t,o)));return Object(u.default)(Object(n.y)(c.path,"query"),Object(i.a)(Object(i.a)({},s),{},{query:Object(i.a)(Object(i.a)({},d),s.query)}))}))}},207:function(e,t,r){"use strict";function i(e){return"date"===e.type||"esriFieldTypeDate"===e.type}function s(e){return e.toLowerCase().trim()}t.a=class{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],e){var t=[];for(var r of e){var a=r&&r.name;if(a){var n=s(a);this._fieldsMap.set(a,r),this._fieldsMap.set(n,r),t.push(n),i(r)&&(this.dateFields.push(r),this._dateFieldsSet.add(r))}}t.sort(),this.uid=t.join(",")}}destroy(){this._fieldsMap.clear()}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(s(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}normalizeFieldName(e){var t=this.get(e);if(t)return t.name}}},212:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return u}));var i=r(89),s=r(112),a=r(117);function n(e,t,r){if(Object(i.j)(t)||Object(i.j)(r)||r.vcsWkid||Object(s.c)(t,r))return null;var n=Object(a.g)(t)/Object(a.g)(r);if(1===n)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){e&&null!=e.z&&(e.z*=t)}(e,n);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(var r of e.paths)for(var i of r)i.length>2&&(i[2]*=t)}(e,n);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(var r of e.rings)for(var i of r)i.length>2&&(i[2]*=t)}(e,n);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(var r of e.points)r.length>2&&(r[2]*=t)}(e,n);default:return null}}function o(e,t,r){if(null==e.hasM||e.hasZ)for(var i of t)for(var s of i)s.length>2&&(s[2]*=r)}function u(e,t,r){if((e||t)&&r){var i=Object(a.g)(r);l(e,r,i),l(t,r,i)}}function l(e,t,r){if(e)for(var i of e)c(i.geometry,t,r)}function c(e,t,r){if(e&&e.spatialReference&&!Object(s.c)(e.spatialReference,t)){var i=Object(a.g)(e.spatialReference)/r;if(1!==i)if("x"in e)null!=e.z&&(e.z*=i);else if("rings"in e)o(e,e.rings,i);else if("paths"in e)o(e,e.paths,i);else if("points"in e&&(null==e.hasM||e.hasZ))for(var n of e.points)n.length>2&&(n[2]*=i)}}},213:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return a}));var i=r(176);class s{constructor(e,t,r){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,t,r,i=0){this._storage.put(this._namespace+e,t,r,i)}get(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,r){this._storage.updateSize(this._namespace+e,t,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class a{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.a,this._users=new i.a}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,r,i){var s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==t&&this._notifyRemoved(e,s.entry)),r>this._maxSize)this._notifyRemoved(e,t);else if(void 0!==t)if(!r||r<0)console.warn("Refusing to cache entry with invalid size "+r);else{var a=1+Math.max(i,-3)- -3;this._db.set(e,{entry:t,size:r,lifetime:a,lives:a}),this._size+=r,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}updateSize(e,t,r){var i=this._db.get(e);if(i&&i.entry===t){if(this._size-=i.size,r>this._maxSize)return this._db.delete(e),void this._notifyRemoved(e,t);i.size=r,this._size+=r,this._checkSizeLimit()}}pop(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){var e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{var s=e.lifetime;r[s]=(r[s]||0)+e.size,this._users.forAll((r=>{var s=r.namespace;if(i.startsWith(s)){var a=t[s]||0;t[s]=a+e.size}}))}));var i={};this._users.forAll((e=>{var r=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var s=t[r]||0;t[r]=s,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));var s=Object.keys(t);s.forEach((e=>t[e]=t[e]/this._size*100)),s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r])+"% / "+i[r]));for(var a=r.length-1;a>=0;--a){var n=r[a];n&&(e["Priority "+(a+-3-1)]=Math.round(n/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){this._db.forEach(((t,r)=>{r.startsWith(e)&&(this._size-=t.size,this._db.delete(r),this._notifyRemoved(r,t.entry))}))}clearAll(){this._db.forEach(((e,t)=>this._notifyRemoved(t,e.entry))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemoved(e,t){this._removeFuncs.forAll((r=>{e.startsWith(r[0])&&r[1](t)}))}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(var[e,t]of this._db)if(this._db.delete(e),t.lives<=1?(this._size-=t.size,this._notifyRemoved(e,t.entry)):(--t.lives,this._db.set(e,t)),this._size<=.9*this.maxSize)return}}},236:function(e,t,r){"use strict";r.d(t,"a",(function(){return F})),r.d(t,"b",(function(){return k})),r.d(t,"c",(function(){return w}));var i=r(7),s=r(159),a=r(89),n=r(81),o=r(93),u=r(112),l=r(161),c=r(130),h=r(141),d=r(243),f=r(91),p=r(83),g=r(100),m=(r(101),r(106));function v(e,t,r,i){return y.apply(this,arguments)}function y(){return(y=Object(i.a)((function*(e,t,r,i){var s="string"==typeof e?Object(p.J)(e):e,a=t[0].spatialReference,n=Object(f.a)(Object(f.a)({},i),{},{query:Object(f.a)(Object(f.a)({},s.query),{},{f:"json",sr:JSON.stringify(a),target:JSON.stringify({geometryType:Object(g.c)(t[0]),geometries:t}),cutter:JSON.stringify(r)})}),o=yield Object(m.default)(s.path+"/cut",n),{cutIndexes:u,geometries:l=[]}=o.data;return{cutIndexes:u,geometries:l.map((e=>{var t=Object(g.a)(e);return t.spatialReference=a,t}))}}))).apply(this,arguments)}function b(e,t,r){return _.apply(this,arguments)}function _(){return(_=Object(i.a)((function*(e,t,r){var i="string"==typeof e?Object(p.J)(e):e,s=t[0].spatialReference,a=Object(g.c)(t[0]),n=Object(f.a)(Object(f.a)({},r),{},{query:Object(f.a)(Object(f.a)({},i.query),{},{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(O(t))})});return j((yield Object(m.default)(i.path+"/simplify",n)).data,a,s)}))).apply(this,arguments)}function O(e){return{geometryType:Object(g.c)(e[0]),geometries:e.map((e=>e.toJSON()))}}function j(e,t,r){var i=Object(g.b)(t);return e.map((e=>{var t=i.fromJSON(e);return t.spatialReference=r,t}))}var x=n.a.getLogger("esri.geometry.support.normalizeUtils");function w(e,t){if(!(e instanceof h.a||e instanceof c.a)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw x.error(r),new o.a(r)}var i=Object(d.b)(e),s=[];for(var a of i){var n=[];s.push(n),n.push([a[0][0],a[0][1]]);for(var u=0;u<a.length-1;u++){var l=a[u][0],f=a[u][1],p=a[u+1][0],g=a[u+1][1],m=Math.sqrt((p-l)*(p-l)+(g-f)*(g-f)),v=(g-f)/m,y=(p-l)/m,b=m/t;if(b>1){for(var _=1;_<=b-1;_++){var O=_*t,j=y*O+l,w=v*O+f;n.push([j,w])}var I=(m+Math.floor(b-1)*t)/2,S=y*I+l,T=v*I+f;n.push([S,T])}n.push([p,g])}}return function(e){return"polygon"===e.type}(e)?new c.a({rings:s,spatialReference:e.spatialReference}):new h.a({paths:s,spatialReference:e.spatialReference})}function I(e,t,r){if(t){var i=w(e,1e6);e=Object(l.e)(i,!0)}return r&&(e=Object(d.e)(e,r)),e}function S(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var s=Object(d.d)(i,t);e[0]=i+s*(-2*t)}else if(i<r){var a=Object(d.d)(i,r);e[0]=i+a*(-2*r)}}else{var n=e.x;if(n>t){var o=Object(d.d)(n,t);e=e.clone().offset(o*(-2*t),0)}else if(n<r){var u=Object(d.d)(n,r);e=e.clone().offset(u*(-2*r),0)}}return e}function T(e,t){for(var r=-1,i=function(i){for(var s=t.cutIndexes[i],a=t.geometries[i],n=Object(d.b)(a),o=function(e){var t=n[e];t.some((r=>{if(r[0]<180)return!0;for(var i=0,s=0;s<t.length;s++){var n=t[s][0];i=n>i?n:i}i=Number(i.toFixed(9));for(var o=-360*Object(d.d)(i,180),u=0;u<t.length;u++){var l=a.getPoint(e,u);a.setPoint(e,u,l.clone().offset(o,0))}return!0}))},u=0;u<n.length;u++)o(u);if(s===r){if(function(e){return"polygon"===e[0].type}(e))for(var l of Object(d.b)(a))e[s]=e[s].addRing(l);else if(function(e){return"polyline"===e[0].type}(e))for(var c of Object(d.b)(a))e[s]=e[s].addPath(c)}else r=s,e[s]=a},s=0;s<t.cutIndexes.length;s++)i(s);return e}function F(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(i.a)((function*(e,t,r){if(!Array.isArray(e))return F([e],t);var i,n,o,f,p,g,m,y,_=t?t.url:s.a.geometryServiceUrl,O=0,j=[],x=[];for(var w of e)if(Object(a.j)(w))x.push(w);else if(i||(i=w.spatialReference,n=Object(u.d)(i),g=(o=i.isWebMercator)?102100:4326,f=d.a[g].maxX,p=d.a[g].minX,m=d.a[g].plus180Line,y=d.a[g].minus180Line),n)if("mesh"===w.type)x.push(w);else if("point"===w.type)x.push(S(w.clone(),f,p));else if("multipoint"===w.type){var M=w.clone();M.points=M.points.map((e=>S(e,f,p))),x.push(M)}else if("extent"===w.type){var k=w.clone()._normalize(!1,!1,n);x.push(k.rings?new c.a(k):k)}else if(w.extent){var C=w.extent,R=Object(d.d)(C.xmin,p)*(2*f),A=0===R?w.clone():Object(d.e)(w.clone(),R);C.offset(R,0),C.intersects(m)&&C.xmax!==f?(O=C.xmax>O?C.xmax:O,A=I(A,o),j.push(A),x.push("cut")):C.intersects(y)&&C.xmin!==p?(O=C.xmax*(2*f)>O?C.xmax*(2*f):O,A=I(A,o,360),j.push(A),x.push("cut")):x.push(A)}else x.push(w.clone());else x.push(w);for(var E=Object(d.d)(O,f),N=-90,P=E,q=new h.a;E>0;){var z=360*E-180;q.addPath([[z,N],[z,-1*N]]),N*=-1,E--}if(j.length>0&&P>0){for(var D=T(j,yield v(_,j,q,r)),G=[],L=[],U=0;U<x.length;U++){var B=x[U];if("cut"!==B)L.push(B);else{var V=D.shift(),Q=e[U];Object(a.k)(Q)&&"polygon"===Q.type&&Q.rings&&Q.rings.length>1&&V.rings.length>=Q.rings.length?(G.push(V),L.push("simplify")):L.push(o?Object(l.b)(V):V)}}if(!G.length)return L;for(var Y=yield b(_,G,r),X=[],J=0;J<L.length;J++){var Z=L[J];"simplify"!==Z?X.push(Z):X.push(o?Object(l.b)(Y.shift()):Y.shift())}return X}for(var H=[],W=0;W<x.length;W++){var $=x[W];if("cut"!==$)H.push($);else{var K=j.shift();H.push(!0===o?Object(l.b)(K):K)}}return Promise.resolve(H)}))).apply(this,arguments)}function k(e,t){var r=Object(u.d)(t);if(r){var[i,s]=r.valid,a=s-i;if(e<i)for(;e<i;)e+=a;if(e>s)for(;e>s;)e-=a}return e}},237:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i=new(r(95).a)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},242:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return g})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return h})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return m})),r.d(t,"i",(function(){return v})),r.d(t,"j",(function(){return p})),r.d(t,"k",(function(){return y}));var i=r(89),s=r(83),a=r(258),n=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"],o=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(".concat(n.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),u=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(".concat(n.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),l=/(.*)\/(\d+)\/?$/i;function c(e){return!!o.test(e)}function h(e){var t=Object(s.J)(e),r=t.path.match(o)||t.path.match(u);if(!r)return null;var[,i,a,n,l]=r,c=a.indexOf("/");return{title:f(-1!==c?a.slice(c+1):a),serverType:n,sublayer:null!=l&&""!==l?parseInt(l,10):null,url:{path:i}}}function d(e){var t=Object(s.J)(e).path.match(l);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function f(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function p(e,t){var r=[];if(e){var s=h(e);Object(i.k)(s)&&s.title&&r.push(s.title)}if(t){var a=f(t);r.push(a)}if(2===r.length){if(-1!==r[0].toLowerCase().indexOf(r[1].toLowerCase()))return r[0];if(-1!==r[1].toLowerCase().indexOf(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function g(e){if(!e)return!1;var t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),r=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&r}function m(e,t){return e?Object(s.H)(Object(s.G)(e,t)):e}function v(e){var{url:t}=e;if(!t)return{url:t};t=Object(s.G)(t,e.logger);var r,a=Object(s.J)(t),n=h(a.path);if(Object(i.k)(n))null!=n.sublayer&&null==e.layer.layerId&&(r=n.sublayer),t=n.url.path;else if(e.nonStandardUrlAllowed){var o=d(a.path);Object(i.k)(o)&&(t=o.serviceUrl,r=o.sublayerId)}return{url:Object(s.H)(t),layerId:r}}function y(e,t,r,i,n){Object(a.f)(t,i,"url",n),i.url&&null!=e.layerId&&(i.url=Object(s.y)(i.url,r,e.layerId.toString()))}function b(e){if(!e)return!1;var t=e.toLowerCase(),r=-1!==t.indexOf("/services/"),i=-1!==t.indexOf("/mapserver/wmsserver"),s=-1!==t.indexOf("/imageserver/wmsserver"),a=-1!==t.indexOf("/wmsserver");return r&&(i||s||a)}function _(e){if(!e)return!1;var t=new s.a(Object(s.z)(e)).authority.toLowerCase();return"server.arcgisonline.com"===t||"services.arcgisonline.com"===t}},243:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return u}));var i=r(99),s=r(141),a=r(100),n={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new s.a({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator}),minus180Line:new s.a({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:i.a.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new s.a({paths:[[[180,-180],[180,180]]],spatialReference:i.a.WGS84}),minus180Line:new s.a({paths:[[[-180,-180],[-180,180]]],spatialReference:i.a.WGS84})}};function o(e,t){return Math.ceil((e-t)/(2*t))}function u(e,t){var r=l(e);for(var i of r)for(var s of i)s[0]+=t;return e}function l(e){return Object(a.g)(e)?e.rings:e.paths}function c(e){var t=(null==e?void 0:e.isWebMercator)?102100:4326;return[n[t].minX,n[t].maxX]}},245:function(e,t,r){"use strict";var i=r(221);class s{constructor(e,t,r,i){this.set(e,t,r,i)}static getId(e,t,r,i){return"object"==typeof e?"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.world):"".concat(e,"/").concat(t,"/").concat(r,"/").concat(i)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}acquire(e,t,r,i){this.set(e,t,r,i)}contains(e){var t=e.level-this.level;return this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new s(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,r,i){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){var[s,a,n,o]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(a),this.col=parseFloat(n),this.world=parseFloat(o)}else this.level=+e,this.row=+t,this.col=+r,this.world=+i||0;return this}toString(){return"".concat(this.level,"/").concat(this.row,"/").concat(this.col,"/").concat(this.world)}getParentKey(){return this.level<=0?null:new s(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){var e=this.level+1,t=this.row<<1,r=this.col<<1,i=this.world;return[new s(e,t,r,i),new s(e,t,r+1,i),new s(e,t+1,r,i),new s(e,t+1,r+1,i)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}s.pool=new i.a(s,null,null,25,50),t.a=s},246:function(e,t,r){"use strict";var i,s=r(82),a=(r(80),r(92)),n=(r(81),r(88),r(85)),o=r(95),u=r(84),l=r(96),c=(r(83),r(86),r(87),r(90)),h=new o.a({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete"}),d=i=class extends c.a{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=Object(a.a)(e))}clone(){return new i({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:Object(a.a)(this.statisticParameters)})}};Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],d.prototype,"maxPointCount",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],d.prototype,"maxRecordCount",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],d.prototype,"maxVertexCount",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],d.prototype,"onStatisticField",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],d.prototype,"outStatisticFieldName",void 0),Object(s.a)([Object(n.b)({type:String,json:{read:{source:"statisticType",reader:h.read},write:{target:"statisticType",writer:h.write}}})],d.prototype,"statisticType",void 0),Object(s.a)([Object(n.b)({type:Object})],d.prototype,"statisticParameters",void 0),Object(s.a)([Object(l.a)("statisticParameters")],d.prototype,"writeStatisticParameters",null);var f=d=i=Object(s.a)([Object(u.a)("esri.tasks.support.StatisticDefinition")],d);t.a=f},250:function(e,t,r){"use strict";var i,s=r(82),a=(r(80),r(92)),n=(r(81),r(88),r(85)),o=r(95),u=r(84),l=(r(83),r(86),r(87),r(90)),c=r(103),h=(r(101),new o.a({upperLeft:"upper-left",lowerLeft:"lower-left"})),d=i=class extends l.a{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new i(Object(a.a)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};Object(s.a)([Object(n.b)({type:c.a,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"extent",void 0),Object(s.a)([Object(n.b)({type:["view","edit"],json:{write:!0}})],d.prototype,"mode",void 0),Object(s.a)([Object(n.b)({type:String,json:{read:h.read,write:h.write}})],d.prototype,"originPosition",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],d.prototype,"tolerance",void 0);var f=d=i=Object(s.a)([Object(u.a)("esri.tasks.support.QuantizationParameters")],d);t.a=f},262:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var i,s=r(82),a=(r(80),r(81),r(88)),n=r(85),o=r(102),u=r(84),l=(r(83),r(86),r(87),r(90)),c=i=class extends l.a{constructor(e){super(e),this.type="map-layer"}clone(){var{mapLayerId:e,gdbVersion:t}=this;return new i({mapLayerId:e,gdbVersion:t})}};Object(s.a)([Object(o.a)({mapLayer:"map-layer"})],c.prototype,"type",void 0),Object(s.a)([Object(n.b)({type:a.a,json:{write:!0}})],c.prototype,"mapLayerId",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],c.prototype,"gdbVersion",void 0),c=i=Object(s.a)([Object(u.a)("esri.layers.support.source.MapLayerSource")],c)},269:function(e,t,r){"use strict";function i(e){var t={};for(var r in e)if("declaredClass"!==r){var s=e[r];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){t[r]=[];for(var a=0;a<s.length;a++)t[r][a]=i(s[a])}else"object"==typeof s?s.toJSON&&(t[r]=JSON.stringify(s)):t[r]=s}return t}r.d(t,"a",(function(){return i}))},270:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(212);function s(e,t,r){if(r&&r.features&&r.hasZ){var s=Object(i.a)(r.geometryType,t,e.outSpatialReference);if(s)for(var a of r.features)s(a.geometry)}}},272:function(e,t,r){"use strict";r.r(t),r.d(t,"WhereClause",(function(){return O})),r.d(t,"defaultAttributeAdapter",(function(){return P}));var i=r(80);var s={min:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.min.apply(Math,e[0])},max:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.max.apply(Math,e[0])},avg:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:a(e[0])},sum:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}(e[0])},stddev:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sqrt(n(e[0]))},count:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].length},var:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:n(e[0])}};function a(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function n(e){var t=a(e),r=e.length,i=0;for(var s of e)i+=Math.pow(s-t,2);return r>1?i/(r-1):0}var o=r(143);class u{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static fixDefaults(e){if(null!==e.precision||null!==e.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(e){var t=new u;return t.second=e/1e3,t}static createFromValueAndQualifer(e,t,r){var i=new u;if(i.op="-"===r?"-":"+","interval-period"===t.type){u.fixDefaults(t);var s=new RegExp("^[0-9]{1,}$");if("year"===t.period||"month"===t.period)throw new Error("Year-Month Intervals not supported");if(!s.test(e))throw new Error("Illegal Interval");i[t.period]=parseFloat(e)}else{if(u.fixDefaults(t.start),u.fixDefaults(t.end),"year"===t.start.period||"month"===t.start.period)throw new Error("Year-Month Intervals not supported");if("year"===t.end.period||"month"===t.end.period)throw new Error("Year-Month Intervals not supported");switch(t.start.period){case"day":switch(t.end.period){case"hour":if(!new RegExp("^[0-9]{1,} [0-9]{1,}$").test(e))throw new Error("Illegal Interval");i[t.start.period]=parseFloat(e.split(" ")[0]),i[t.end.period]=parseFloat(e.split(" ")[1]);break;case"minute":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$").test(e))throw new Error("Illegal Interval");i[t.start.period]=parseFloat(e.split(" ")[0]);var a=e.split(" ")[1].split(":");i.hour=parseFloat(a[0]),i.minute=parseFloat(a[1]);break;case"second":if(!new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(e))throw new Error("Illegal Interval");i[t.start.period]=parseFloat(e.split(" ")[0]);var n=e.split(" ")[1].split(":");i.hour=parseFloat(n[0]),i.minute=parseFloat(n[1]),i.second=parseFloat(n[2]);break;default:throw"Invalid Interval."}break;case"hour":switch(t.end.period){case"minute":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}$").test(e))throw new Error("Illegal Interval");i.hour=parseFloat(e.split(":")[0]),i.minute=parseFloat(e.split(":")[1]);break;case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(e))throw new Error("Illegal Interval");var o=e.split(":");i.hour=parseFloat(o[0]),i.minute=parseFloat(o[1]),i.second=parseFloat(o[2]);break;default:throw"Invalid Interval."}break;case"minute":switch(t.end.period){case"second":if(!new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$").test(e))throw new Error("Illegal Interval");var l=e.split(":");i.minute=parseFloat(l[0]),i.second=parseFloat(l[1]);break;default:throw"Invalid Interval."}break;default:throw"Invalid Interval."}}return i}valueInMilliseconds(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function l(e,t){var r=c[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return r.evaluate(t)}var c={extract:{minParams:2,maxParams:2,evaluate:([e,t])=>{if(null==t)return null;if(t instanceof Date)switch(e.toUpperCase()){case"SECOND":return t.getSeconds();case"MINUTE":return t.getMinutes();case"HOUR":return t.getHours();case"DAY":return t.getDate();case"MONTH":return t.getMonth()+1;case"YEAR":return t.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:e=>{if(2===e.length){var[t,r]=e;return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){var[i,s,a]=e;return null==i||null==s||null==a?null:a<=0?"":i.toString().substring(s-1,s+a-1)}}},position:{minParams:2,maxParams:2,evaluate:([e,t])=>null==e||null==t?null:t.indexOf(e)+1},trim:{minParams:2,maxParams:3,evaluate:e=>{var t=3===e.length,r=t?e[1]:" ",i=t?e[2]:e[1];if(null==r||null==i)return null;var s="(".concat(Object(o.a)(r),")");switch(e[0]){case"BOTH":return i.replace(new RegExp("^".concat(s,"*|").concat(s,"*$"),"g"),"");case"LEADING":return i.replace(new RegExp("^".concat(s,"*"),"g"),"");case"TRAILING":return i.replace(new RegExp("".concat(s,"*$"),"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.abs(e[0])},ceiling:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.ceil(e[0])},floor:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.floor(e[0])},log:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])},log10:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.log(e[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.sin(e[0])},cos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.cos(e[0])},tan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.tan(e[0])},asin:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.asin(e[0])},acos:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.acos(e[0])},atan:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:Math.atan(e[0])},sign:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0]>0?1:e[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])},mod:{minParams:2,maxParams:2,evaluate:e=>null==e[0]||null==e[1]?null:e[0]%e[1]},round:{minParams:1,maxParams:2,evaluate:e=>{var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:e=>null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))},char_length:{minParams:1,maxParams:1,evaluate:e=>"string"==typeof e[0]||e[0]instanceof String?e[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:e=>{for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:e=>null==e[0]?null:e[0].toString().toUpperCase()}},h=r(133),d=Object(h.b)((function(e){var t;t=function(){function e(t,r,i,s){this.message=t,this.expected=r,this.found=i,this.location=s,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(e,Error),e.buildMessage=function(e,t){var r={literal:function(e){return'"'+s(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function s(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+i(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+i(e)}))}function n(e){return r[e.type](e)}return"Expected "+function(e){var t,r,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=n(e[t]);if(i.sort(),i.length>0){for(t=1,r=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."},{SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var i,s={},a={start:Ye},n=Ye,o=function(e,t){var r={type:"expr_list"},i=function(e,t,r){return function(e,t){for(var r=[e],i=0;i<t.length;i++)r.push(t[i][3]);return r}(e,t)}(e,t);return r.value=i,r},u=function(e,t){return gr(e,t)},l=Le("!",!1),c=Le("=",!1),h=Le(">=",!1),d=Le(">",!1),f=Le("<=",!1),p=Le("<>",!1),g=Le("<",!1),m=Le("!=",!1),v=function(e){return e[0]+" "+e[2]},y=Le("+",!1),b=Le("-",!1),_=Le("*",!1),O=Le("/",!1),j=function(e,t){return e+t.join("")},x=/^[A-Za-z_\x80-\uFFFF]/,w=Ue([["A","Z"],["a","z"],"_",["\x80","\uffff"]],!1,!1),I=/^[A-Za-z0-9_]/,S=Ue([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),T=/^[A-Za-z0-9_.\x80-\uFFFF]/,F=Ue([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uffff"]],!1,!1),M=Le("@",!1),k=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}},C=function(e,t){return{type:"interval-period",period:"second",precision:e,secondary:t}},R=function(e){return parseFloat(e)},A=Le("'",!1),E=Le("N'",!1),N="''",P=Le("''",!1),q=/^[^']/,z=Ue(["'"],!0,!1),D=function(e,t){return{type:"when_clause",operand:e,value:t}},G=Le(".",!1),L=/^[0-9]/,U=Ue([["0","9"]],!1,!1),B=/^[eE]/,V=Ue(["e","E"],!1,!1),Q=/^[+\-]/,Y=Ue(["+","-"],!1,!1),X=Le("NULL",!0),J=Le("TRUE",!0),Z=Le("FALSE",!0),H=Le("IN",!0),W=Le("IS",!0),$=Le("LIKE",!0),K=Le("ESCAPE",!0),ee=Le("NOT",!0),te=Le("AND",!0),re=Le("OR",!0),ie=Le("BETWEEN",!0),se=Le("FROM",!0),ae=Le("FOR",!0),ne=Le("SUBSTRING",!0),oe=Le("EXTRACT",!0),ue=Le("TRIM",!0),le=Le("POSITION",!0),ce=Le("TIMESTAMP",!0),he=Le("DATE",!0),de=Le("LEADING",!0),fe=Le("TRAILING",!0),pe=Le("BOTH",!0),ge=Le("TO",!0),me=Le("INTERVAL",!0),ve=Le("YEAR",!0),ye=Le("MONTH",!0),be=Le("DAY",!0),_e=Le("HOUR",!0),Oe=Le("MINUTE",!0),je=Le("SECOND",!0),xe=Le("CASE",!0),we=Le("END",!0),Ie=Le("WHEN",!0),Se=Le("THEN",!0),Te=Le("ELSE",!0),Fe=Le(",",!1),Me=Le("(",!1),ke=Le(")",!1),Ce=/^[ \t\n\r]/,Re=Ue([" ","\t","\n","\r"],!1,!1),Ae=Le("`",!1),Ee=/^[^`]/,Ne=Ue(["`"],!0,!1),Pe=0,qe=[{line:1,column:1}],ze=0,De=[],Ge=0;if("startRule"in r){if(!(r.startRule in a))throw new Error("Can't start parsing from rule \""+r.startRule+'".');n=a[r.startRule]}function Le(e,t){return{type:"literal",text:e,ignoreCase:t}}function Ue(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Be(e){var r,i=qe[e];if(i)return i;for(r=e-1;!qe[r];)r--;for(i={line:(i=qe[r]).line,column:i.column};r<e;)10===t.charCodeAt(r)?(i.line++,i.column=1):i.column++,r++;return qe[e]=i,i}function Ve(e,t){var r=Be(e),i=Be(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:i.line,column:i.column}}}function Qe(e){Pe<ze||(Pe>ze&&(ze=Pe,De=[]),De.push(e))}function Ye(){var e,t;return e=Pe,hr()!==s&&(t=Je())!==s&&hr()!==s?e=t:(Pe=e,e=s),e}function Xe(){var e,t,r,i,a,n,u,l;if(e=Pe,(t=Je())!==s){for(r=[],i=Pe,(a=hr())!==s&&(n=ur())!==s&&(u=hr())!==s&&(l=Je())!==s?i=a=[a,n,u,l]:(Pe=i,i=s);i!==s;)r.push(i),i=Pe,(a=hr())!==s&&(n=ur())!==s&&(u=hr())!==s&&(l=Je())!==s?i=a=[a,n,u,l]:(Pe=i,i=s);r!==s?e=t=o(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}function Je(){var e,t,r,i,a,n,o,l;if(e=Pe,(t=Ze())!==s){for(r=[],i=Pe,(a=hr())!==s&&(n=Pt())!==s&&(o=hr())!==s&&(l=Ze())!==s?i=a=[a,n,o,l]:(Pe=i,i=s);i!==s;)r.push(i),i=Pe,(a=hr())!==s&&(n=Pt())!==s&&(o=hr())!==s&&(l=Ze())!==s?i=a=[a,n,o,l]:(Pe=i,i=s);r!==s?e=t=u(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}function Ze(){var e,t,r,i,a,n,o,l;if(e=Pe,(t=He())!==s){for(r=[],i=Pe,(a=hr())!==s&&(n=Nt())!==s&&(o=hr())!==s&&(l=He())!==s?i=a=[a,n,o,l]:(Pe=i,i=s);i!==s;)r.push(i),i=Pe,(a=hr())!==s&&(n=Nt())!==s&&(o=hr())!==s&&(l=He())!==s?i=a=[a,n,o,l]:(Pe=i,i=s);r!==s?e=t=u(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}function He(){var e,r,i,a,n;return e=Pe,(r=Et())===s&&(r=Pe,33===t.charCodeAt(Pe)?(i="!",Pe++):(i=s,0===Ge&&Qe(l)),i!==s?(a=Pe,Ge++,61===t.charCodeAt(Pe)?(n="=",Pe++):(n=s,0===Ge&&Qe(c)),Ge--,n===s?a=void 0:(Pe=a,a=s),a!==s?r=i=[i,a]:(Pe=r,r=s)):(Pe=r,r=s)),r!==s&&(i=hr())!==s&&(a=He())!==s?e=r=function(e){return function(e,t){return{type:"unary_expr",operator:"NOT",expr:t}}(0,e)}(a):(Pe=e,e=s),e===s&&(e=function(){var e,t,r;return e=Pe,(t=et())!==s&&hr()!==s?((r=function(){var e;return(e=function(){var e,t,r,i,a,n;if(e=[],t=Pe,(r=hr())!==s&&(i=We())!==s&&(a=hr())!==s&&(n=et())!==s?t=r=[r,i,a,n]:(Pe=t,t=s),t!==s)for(;t!==s;)e.push(t),t=Pe,(r=hr())!==s&&(i=We())!==s&&(a=hr())!==s&&(n=et())!==s?t=r=[r,i,a,n]:(Pe=t,t=s);else e=s;return e!==s&&(e=function(e){return{type:"arithmetic",tail:e}}(e)),e}())===s&&(e=function(){var e,t,r,i;return e=Pe,(t=Ke())!==s&&hr()!==s&&(r=lr())!==s&&hr()!==s&&(i=Xe())!==s&&hr()!==s&&cr()!==s?e=t=function(e,t){return{op:e,right:t}}(t,i):(Pe=e,e=s),e===s&&(e=Pe,(t=Ke())!==s&&hr()!==s&&(r=lr())!==s&&hr()!==s&&(i=cr())!==s?e=t=function(e){return{op:e,right:{type:"expr_list",value:[]}}}(t):(Pe=e,e=s),e===s&&(e=Pe,(t=Ke())!==s&&hr()!==s&&(r=lt())!==s?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=s))),e}())===s&&(e=function(){var e,t,r,i,a,n;return e=Pe,(t=Et())!==s&&hr()!==s&&(r=qt())!==s&&hr()!==s&&(i=et())!==s&&hr()!==s&&(a=Nt())!==s&&hr()!==s&&(n=et())!==s?e=t=function(e,t,r){return{op:"NOT"+e,right:{type:"expr_list",value:[t,r]}}}(r,i,n):(Pe=e,e=s),e===s&&(e=Pe,(t=qt())!==s&&hr()!==s&&(r=et())!==s&&hr()!==s&&(i=Nt())!==s&&hr()!==s&&(a=et())!==s?e=t=function(e,t,r){return{op:e,right:{type:"expr_list",value:[t,r]}}}(t,r,a):(Pe=e,e=s)),e}())===s&&(e=function(){var e,t,r,i;return e=Pe,(t=Ct())!==s&&hr()!==s&&(r=Et())!==s&&hr()!==s&&(i=et())!==s?e=t=function(e,t){return{op:e+"NOT",right:t}}(t,i):(Pe=e,e=s),e===s&&(e=Pe,(t=Ct())!==s&&hr()!==s&&(r=et())!==s?e=t=function(e,t){return{op:e,right:t}}(t,r):(Pe=e,e=s)),e}())===s&&(e=function(){var e,t,r,i;return e=Pe,(t=$e())!==s&&hr()!==s&&(r=mt())!==s&&hr()!==s&&At()!==s&&hr()!==s&&(i=vt())!==s?e=t=function(e,t,r){return{op:e,right:t,escape:r.value}}(t,r,i):(Pe=e,e=s),e===s&&(e=Pe,(t=$e())!==s&&hr()!==s&&(r=mt())!==s?e=t=function(e,t){return{op:e,right:t,escape:""}}(t,r):(Pe=e,e=s)),e}()),e}())===s&&(r=null),r!==s?e=t=function(e,t){return""==t||null==t||null==t?e:"arithmetic"==t.type?gr(e,t.tail):pr(t.op,e,t.right,t.escape)}(t,r):(Pe=e,e=s)):(Pe=e,e=s),e}()),e}function We(){var e;return">="===t.substr(Pe,2)?(e=">=",Pe+=2):(e=s,0===Ge&&Qe(h)),e===s&&(62===t.charCodeAt(Pe)?(e=">",Pe++):(e=s,0===Ge&&Qe(d)),e===s&&("<="===t.substr(Pe,2)?(e="<=",Pe+=2):(e=s,0===Ge&&Qe(f)),e===s&&("<>"===t.substr(Pe,2)?(e="<>",Pe+=2):(e=s,0===Ge&&Qe(p)),e===s&&(60===t.charCodeAt(Pe)?(e="<",Pe++):(e=s,0===Ge&&Qe(g)),e===s&&(61===t.charCodeAt(Pe)?(e="=",Pe++):(e=s,0===Ge&&Qe(c)),e===s&&("!="===t.substr(Pe,2)?(e="!=",Pe+=2):(e=s,0===Ge&&Qe(m)))))))),e}function $e(){var e,t,r,i,a;return e=Pe,t=Pe,(r=Et())!==s&&(i=hr())!==s&&(a=Rt())!==s?t=r=[r,i,a]:(Pe=t,t=s),t!==s&&(t=v(t)),(e=t)===s&&(e=Rt()),e}function Ke(){var e,t,r,i,a;return e=Pe,t=Pe,(r=Et())!==s&&(i=hr())!==s&&(a=kt())!==s?t=r=[r,i,a]:(Pe=t,t=s),t!==s&&(t=v(t)),(e=t)===s&&(e=kt()),e}function et(){var e,t,r,i,a,n,o,l;if(e=Pe,(t=rt())!==s){for(r=[],i=Pe,(a=hr())!==s&&(n=tt())!==s&&(o=hr())!==s&&(l=rt())!==s?i=a=[a,n,o,l]:(Pe=i,i=s);i!==s;)r.push(i),i=Pe,(a=hr())!==s&&(n=tt())!==s&&(o=hr())!==s&&(l=rt())!==s?i=a=[a,n,o,l]:(Pe=i,i=s);r!==s?e=t=u(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}function tt(){var e;return 43===t.charCodeAt(Pe)?(e="+",Pe++):(e=s,0===Ge&&Qe(y)),e===s&&(45===t.charCodeAt(Pe)?(e="-",Pe++):(e=s,0===Ge&&Qe(b))),e}function rt(){var e,t,r,i,a,n,o,u;if(e=Pe,(t=st())!==s){for(r=[],i=Pe,(a=hr())!==s&&(n=it())!==s&&(o=hr())!==s&&(u=st())!==s?i=a=[a,n,o,u]:(Pe=i,i=s);i!==s;)r.push(i),i=Pe,(a=hr())!==s&&(n=it())!==s&&(o=hr())!==s&&(u=st())!==s?i=a=[a,n,o,u]:(Pe=i,i=s);r!==s?e=t=function(e,t){return gr(e,t)}(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}function it(){var e;return 42===t.charCodeAt(Pe)?(e="*",Pe++):(e=s,0===Ge&&Qe(_)),e===s&&(47===t.charCodeAt(Pe)?(e="/",Pe++):(e=s,0===Ge&&Qe(O))),e}function st(){var e,t;return(e=function(){var e;return(e=vt())===s&&(e=function(){var e,t,r,i;return e=Pe,(t=function(){var e,t,r,i;return e=Pe,(t=Ot())!==s&&(r=jt())!==s&&(i=xt())!==s?e=t=function(e,t,r){return parseFloat(e+t+r)}(t,r,i):(Pe=e,e=s),e===s&&(e=Pe,(t=Ot())!==s&&(r=jt())!==s?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=s),e===s&&(e=Pe,(t=Ot())!==s&&(r=xt())!==s?e=t=function(e,t){return parseFloat(e+t)}(t,r):(Pe=e,e=s),e===s&&(e=Pe,(t=Ot())!==s&&(t=function(e){return parseFloat(e)}(t)),e=t))),e}())!==s?(r=Pe,Ge++,i=nt(),Ge--,i===s?r=void 0:(Pe=r,r=s),r!==s?e=t=function(e){return{type:"number",value:e}}(t):(Pe=e,e=s)):(Pe=e,e=s),e}())===s&&(e=function(){var e,t;return e=Pe,(t=Ft())!==s&&(t={type:"bool",value:!0}),(e=t)===s&&(e=Pe,(t=Mt())!==s&&(t={type:"bool",value:!1}),e=t),e}())===s&&(e=function(){var e;return(e=Tt())!==s&&(e={type:"null",value:null}),e}())===s&&(e=function(){var e,t;return e=Pe,Qt()!==s&&hr()!==s&&(t=mt())!==s?e=function(e){return{type:"date",value:e.value}}(t):(Pe=e,e=s),e}())===s&&(e=function(){var e,t;return e=Pe,Vt()!==s&&hr()!==s&&(t=mt())!==s?e=function(e){return{type:"timestamp",value:e.value}}(t):(Pe=e,e=s),e}())===s&&(e=ht()),e}())===s&&(e=function(){var e,t,r;return e=Pe,Lt()!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(t=function(){var e;return(e=Wt())===s&&(e=$t())===s&&(e=Kt())===s&&(e=er())===s&&(e=tr())===s&&(e=rr()),e}())!==s&&hr()!==s&&zt()!==s&&hr()!==s&&(r=Je())!==s&&hr()!==s&&cr()!==s?e=function(e,t){return{type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:e},t]}}}(t,r):(Pe=e,e=s),e}())===s&&(e=function(){var e,t,r,i,a,n,o,u;return e=Pe,Gt()!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(t=Je())!==s&&hr()!==s&&zt()!==s&&hr()!==s&&(r=Je())!==s&&hr()!==s?(i=Pe,(a=Dt())!==s&&(n=hr())!==s&&(o=Je())!==s&&(u=hr())!==s?i=a=[a,n,o,u]:(Pe=i,i=s),i===s&&(i=null),i!==s&&(a=cr())!==s?e=function(e,t,r){return{type:"function",name:"substring",args:{type:"expr_list",value:r?[e,t,r[2]]:[e,t]}}}(t,r,i):(Pe=e,e=s)):(Pe=e,e=s),e}())===s&&(e=function(){var e,t,r,i;return e=Pe,Ut()!==s&&hr()!==s&&lr()!==s&&hr()!==s?((t=ct())===s&&(t=null),t!==s&&hr()!==s&&(r=Je())!==s&&hr()!==s&&zt()!==s&&hr()!==s&&(i=Je())!==s&&hr()!==s&&cr()!==s?e=function(e,t,r){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t,r]}}}(t,r,i):(Pe=e,e=s)):(Pe=e,e=s),e===s&&(e=Pe,Ut()!==s&&hr()!==s&&lr()!==s&&hr()!==s?((t=ct())===s&&(t=null),t!==s&&hr()!==s&&(r=Je())!==s&&hr()!==s&&cr()!==s?e=function(e,t){return{type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==e?"BOTH":e},t]}}}(t,r):(Pe=e,e=s)):(Pe=e,e=s)),e}())===s&&(e=function(){var e,t,r;return e=Pe,Bt()!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(t=Je())!==s&&hr()!==s&&kt()!==s&&hr()!==s&&(r=Je())!==s&&hr()!==s&&cr()!==s?e=function(e,t){return{type:"function",name:"position",args:{type:"expr_list",value:[e,t]}}}(t,r):(Pe=e,e=s),e}())===s&&(e=function(){var e,t,r;return e=Pe,(t=fr())!==s&&hr()!==s&&lr()!==s&&hr()!==s?((r=Xe())===s&&(r=null),r!==s&&hr()!==s&&cr()!==s?e=t=function(e,t){return{type:"function",name:e,args:t||{type:"expr_list",value:[]}}}(t,r):(Pe=e,e=s)):(Pe=e,e=s),e}())===s&&(e=function(){var e;return(e=function(){var e,t,r,i,a;if(e=Pe,ir()!==s)if(hr()!==s)if((t=Je())!==s)if(hr()!==s){for(r=[],i=bt();i!==s;)r.push(i),i=bt();r!==s&&(i=hr())!==s&&(a=sr())!==s?e=function(e,t){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:null}}(t,r):(Pe=e,e=s)}else Pe=e,e=s;else Pe=e,e=s;else Pe=e,e=s;else Pe=e,e=s;if(e===s)if(e=Pe,ir()!==s)if(hr()!==s)if((t=Je())!==s)if(hr()!==s){for(r=[],i=bt();i!==s;)r.push(i),i=bt();r!==s&&(i=hr())!==s&&(a=_t())!==s&&hr()!==s&&sr()!==s?e=function(e,t,r){return{type:"case_expression",format:"simple",operand:e,clauses:t,else:r.value}}(t,r,a):(Pe=e,e=s)}else Pe=e,e=s;else Pe=e,e=s;else Pe=e,e=s;else Pe=e,e=s;return e}())===s&&(e=function(){var e,t,r,i;if(e=Pe,ir()!==s)if(hr()!==s){for(t=[],r=yt();r!==s;)t.push(r),r=yt();t!==s&&(r=hr())!==s&&(i=sr())!==s?e=function(e){return{type:"case_expression",format:"searched",clauses:e,else:null}}(t):(Pe=e,e=s)}else Pe=e,e=s;else Pe=e,e=s;if(e===s)if(e=Pe,ir()!==s)if(hr()!==s){for(t=[],r=yt();r!==s;)t.push(r),r=yt();t!==s&&(r=hr())!==s&&(i=_t())!==s&&hr()!==s&&sr()!==s?e=function(e,t){return{type:"case_expression",format:"searched",clauses:e,else:t.value}}(t,i):(Pe=e,e=s)}else Pe=e,e=s;else Pe=e,e=s;return e}()),e}())===s&&(e=function(){var e;return(e=function(){var e;return(e=function(){var e,t,r,i;if(e=Pe,(t=nt())!==s){for(r=[],i=ut();i!==s;)r.push(i),i=ut();r!==s?e=t=j(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}())!==s&&(e=e),e}())!==s&&(e=function(e){return/^CURRENT_DATE$/i.test(e)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(e)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:e}}(e)),e}())===s&&(e=lt())===s&&(e=Pe,lr()!==s&&hr()!==s&&(t=Je())!==s&&hr()!==s&&cr()!==s?e=function(e){return e.paren=!0,e}(t):(Pe=e,e=s)),e}function at(){var e,t,r,i;if(e=Pe,(t=nt())!==s){for(r=[],i=ot();i!==s;)r.push(i),i=ot();r!==s?e=t=j(t,r):(Pe=e,e=s)}else Pe=e,e=s;return e}function nt(){var e;return x.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=s,0===Ge&&Qe(w)),e}function ot(){var e;return I.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=s,0===Ge&&Qe(S)),e}function ut(){var e;return T.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=s,0===Ge&&Qe(F)),e}function lt(){var e,r,i;return e=Pe,64===t.charCodeAt(Pe)?(r="@",Pe++):(r=s,0===Ge&&Qe(M)),r!==s&&(i=at())!==s?e=r=[r,i]:(Pe=e,e=s),e!==s&&(e=function(e){return{type:"param",value:e[1]}}(e)),e}function ct(){var e;return(e=Yt())===s&&(e=Xt())===s&&(e=Jt()),e}function ht(){var e,r,i,a;return e=Pe,Ht()!==s&&hr()!==s?(45===t.charCodeAt(Pe)?(r="-",Pe++):(r=s,0===Ge&&Qe(b)),r===s&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=s,0===Ge&&Qe(y))),r!==s&&hr()!==s&&(i=mt())!==s&&hr()!==s&&(a=dt())!==s?e=function(e,t,r){return{type:"interval",value:t,qualifier:r,op:e}}(r,i,a):(Pe=e,e=s)):(Pe=e,e=s),e===s&&(e=Pe,Ht()!==s&&hr()!==s&&(r=mt())!==s&&hr()!==s&&(i=dt())!==s?e=function(e,t){return{type:"interval",value:e,qualifier:t,op:""}}(r,i):(Pe=e,e=s)),e}function dt(){var e,t,r;return e=Pe,(t=function(){var e,t,r;return e=Pe,(t=ft())!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(r=gt())!==s&&hr()!==s&&cr()!==s?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Pe=e,e=s),e===s&&(e=Pe,(t=ft())!==s&&(t=k(t)),e=t),e}())!==s&&hr()!==s&&Zt()!==s&&hr()!==s&&(r=function(){var e,t,r,i;return e=Pe,(t=ft())!==s&&(t=function(e){return{type:"interval-period",period:e.value,precision:null,secondary:null}}(t)),(e=t)===s&&(e=Pe,(t=rr())!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(r=gt())!==s&&hr()!==s&&ur()!==s&&hr()!==s&&(i=pt())!==s&&hr()!==s&&cr()!==s?e=t=C(r,i):(Pe=e,e=s),e===s&&(e=Pe,(t=rr())!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(r=gt())!==s&&hr()!==s&&cr()!==s?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Pe=e,e=s),e===s&&(e=Pe,(t=rr())!==s&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t))),e}())!==s?e=t=function(e,t){return{type:"interval-qualifier",start:e,end:t}}(t,r):(Pe=e,e=s),e===s&&(e=function(){var e,t,r,i;return e=Pe,(t=ft())!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(r=pt())!==s&&hr()!==s&&cr()!==s?e=t=function(e,t){return{type:"interval-period",period:e.value,precision:t,secondary:null}}(t,r):(Pe=e,e=s),e===s&&(e=Pe,(t=ft())!==s&&(t=k(t)),(e=t)===s&&(e=Pe,(t=rr())!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(r=gt())!==s&&hr()!==s&&ur()!==s&&hr()!==s&&(i=pt())!==s&&hr()!==s&&cr()!==s?e=t=C(r,i):(Pe=e,e=s),e===s&&(e=Pe,(t=rr())!==s&&hr()!==s&&lr()!==s&&hr()!==s&&(r=pt())!==s&&hr()!==s&&cr()!==s?e=t=function(e){return{type:"interval-period",period:"second",precision:e,secondary:null}}(r):(Pe=e,e=s),e===s&&(e=Pe,(t=rr())!==s&&(t={type:"interval-period",period:"second",precision:null,secondary:null}),e=t)))),e}()),e}function ft(){var e,t;return e=Pe,(t=Kt())!==s&&(t={type:"string",value:"day"}),(e=t)===s&&(e=Pe,(t=er())!==s&&(t={type:"string",value:"hour"}),(e=t)===s&&(e=Pe,(t=tr())!==s&&(t={type:"string",value:"minute"}),(e=t)===s&&(e=Pe,(t=$t())!==s&&(t={type:"string",value:"month"}),(e=t)===s&&(e=Pe,(t=Wt())!==s&&(t={type:"string",value:"year"}),e=t)))),e}function pt(){var e;return(e=wt())!==s&&(e=R(e)),e}function gt(){var e;return(e=wt())!==s&&(e=R(e)),e}function mt(){var e;return(e=vt())===s&&(e=lt()),e}function vt(){var e,r,i,a,n;if(e=Pe,39===t.charCodeAt(Pe)?(r="'",Pe++):(r=s,0===Ge&&Qe(A)),r===s&&("N'"===t.substr(Pe,2)?(r="N'",Pe+=2):(r=s,0===Ge&&Qe(E))),r!==s){for(i=[],a=Pe,t.substr(Pe,2)===N?(n=N,Pe+=2):(n=s,0===Ge&&Qe(P)),n!==s&&(n="'"),(a=n)===s&&(q.test(t.charAt(Pe))?(a=t.charAt(Pe),Pe++):(a=s,0===Ge&&Qe(z)));a!==s;)i.push(a),a=Pe,t.substr(Pe,2)===N?(n=N,Pe+=2):(n=s,0===Ge&&Qe(P)),n!==s&&(n="'"),(a=n)===s&&(q.test(t.charAt(Pe))?(a=t.charAt(Pe),Pe++):(a=s,0===Ge&&Qe(z)));i!==s?(39===t.charCodeAt(Pe)?(a="'",Pe++):(a=s,0===Ge&&Qe(A)),a!==s?e=r=function(e){return{type:"string",value:e.join("")}}(i):(Pe=e,e=s)):(Pe=e,e=s)}else Pe=e,e=s;return e}function yt(){var e,t,r;return e=Pe,ar()!==s&&hr()!==s&&(t=Je())!==s&&hr()!==s&&nr()!==s&&hr()!==s&&(r=Je())!==s?e=D(t,r):(Pe=e,e=s),e}function bt(){var e,t,r;return e=Pe,ar()!==s&&hr()!==s&&(t=Je())!==s&&hr()!==s&&nr()!==s&&hr()!==s&&(r=Je())!==s?e=D(t,r):(Pe=e,e=s),e}function _t(){var e,t;return e=Pe,or()!==s&&hr()!==s&&(t=Je())!==s?e=function(e){return{type:"else_clause",value:e}}(t):(Pe=e,e=s),e}function Ot(){var e,r,i;return(e=wt())===s&&(e=Pe,45===t.charCodeAt(Pe)?(r="-",Pe++):(r=s,0===Ge&&Qe(b)),r===s&&(43===t.charCodeAt(Pe)?(r="+",Pe++):(r=s,0===Ge&&Qe(y))),r!==s&&(i=wt())!==s?e=r=function(e,t){return e[0]+t}(r,i):(Pe=e,e=s)),e}function jt(){var e,r,i;return e=Pe,46===t.charCodeAt(Pe)?(r=".",Pe++):(r=s,0===Ge&&Qe(G)),r!==s?((i=wt())===s&&(i=null),i!==s?e=r=function(e){return"."+(null!=e?e:"")}(i):(Pe=e,e=s)):(Pe=e,e=s),e}function xt(){var e,t,r;return e=Pe,(t=St())!==s&&(r=wt())!==s?e=t=function(e,t){return e+t}(t,r):(Pe=e,e=s),e}function wt(){var e,t;if(e=[],(t=It())!==s)for(;t!==s;)e.push(t),t=It();else e=s;return e!==s&&(e=function(e){return e.join("")}(e)),e}function It(){var e;return L.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=s,0===Ge&&Qe(U)),e}function St(){var e,r,i;return e=Pe,B.test(t.charAt(Pe))?(r=t.charAt(Pe),Pe++):(r=s,0===Ge&&Qe(V)),r!==s?(Q.test(t.charAt(Pe))?(i=t.charAt(Pe),Pe++):(i=s,0===Ge&&Qe(Y)),i===s&&(i=null),i!==s?e=r=function(e,t){return"e"+(null===t?"":t)}(0,i):(Pe=e,e=s)):(Pe=e,e=s),e}function Tt(){var e,r,i,a;return e=Pe,"null"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(X)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r=[r,i]:(Pe=e,e=s)):(Pe=e,e=s),e}function Ft(){var e,r,i,a;return e=Pe,"true"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(J)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r=[r,i]:(Pe=e,e=s)):(Pe=e,e=s),e}function Mt(){var e,r,i,a;return e=Pe,"false"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=s,0===Ge&&Qe(Z)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r=[r,i]:(Pe=e,e=s)):(Pe=e,e=s),e}function kt(){var e,r,i,a;return e=Pe,"in"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=s,0===Ge&&Qe(H)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="IN":(Pe=e,e=s)):(Pe=e,e=s),e}function Ct(){var e,r,i,a;return e=Pe,"is"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=s,0===Ge&&Qe(W)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="IS":(Pe=e,e=s)):(Pe=e,e=s),e}function Rt(){var e,r,i,a;return e=Pe,"like"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe($)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="LIKE":(Pe=e,e=s)):(Pe=e,e=s),e}function At(){var e,r,i,a;return e=Pe,"escape"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=s,0===Ge&&Qe(K)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="ESCAPE":(Pe=e,e=s)):(Pe=e,e=s),e}function Et(){var e,r,i,a;return e=Pe,"not"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=s,0===Ge&&Qe(ee)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="NOT":(Pe=e,e=s)):(Pe=e,e=s),e}function Nt(){var e,r,i,a;return e=Pe,"and"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=s,0===Ge&&Qe(te)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="AND":(Pe=e,e=s)):(Pe=e,e=s),e}function Pt(){var e,r,i,a;return e=Pe,"or"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=s,0===Ge&&Qe(re)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="OR":(Pe=e,e=s)):(Pe=e,e=s),e}function qt(){var e,r,i,a;return e=Pe,"between"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=s,0===Ge&&Qe(ie)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="BETWEEN":(Pe=e,e=s)):(Pe=e,e=s),e}function zt(){var e,r,i,a;return e=Pe,"from"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(se)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="FROM":(Pe=e,e=s)):(Pe=e,e=s),e}function Dt(){var e,r,i,a;return e=Pe,"for"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=s,0===Ge&&Qe(ae)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="FOR":(Pe=e,e=s)):(Pe=e,e=s),e}function Gt(){var e,r,i,a;return e=Pe,"substring"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=s,0===Ge&&Qe(ne)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="SUBSTRING":(Pe=e,e=s)):(Pe=e,e=s),e}function Lt(){var e,r,i,a;return e=Pe,"extract"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=s,0===Ge&&Qe(oe)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="EXTRACT":(Pe=e,e=s)):(Pe=e,e=s),e}function Ut(){var e,r,i,a;return e=Pe,"trim"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(ue)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="TRIM":(Pe=e,e=s)):(Pe=e,e=s),e}function Bt(){var e,r,i,a;return e=Pe,"position"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=s,0===Ge&&Qe(le)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="POSITION":(Pe=e,e=s)):(Pe=e,e=s),e}function Vt(){var e,r,i,a;return e=Pe,"timestamp"===t.substr(Pe,9).toLowerCase()?(r=t.substr(Pe,9),Pe+=9):(r=s,0===Ge&&Qe(ce)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="TIMESTAMP":(Pe=e,e=s)):(Pe=e,e=s),e}function Qt(){var e,r,i,a;return e=Pe,"date"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(he)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="DATE":(Pe=e,e=s)):(Pe=e,e=s),e}function Yt(){var e,r,i,a;return e=Pe,"leading"===t.substr(Pe,7).toLowerCase()?(r=t.substr(Pe,7),Pe+=7):(r=s,0===Ge&&Qe(de)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="LEADING":(Pe=e,e=s)):(Pe=e,e=s),e}function Xt(){var e,r,i,a;return e=Pe,"trailing"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=s,0===Ge&&Qe(fe)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="TRAILING":(Pe=e,e=s)):(Pe=e,e=s),e}function Jt(){var e,r,i,a;return e=Pe,"both"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(pe)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="BOTH":(Pe=e,e=s)):(Pe=e,e=s),e}function Zt(){var e,r,i,a;return e=Pe,"to"===t.substr(Pe,2).toLowerCase()?(r=t.substr(Pe,2),Pe+=2):(r=s,0===Ge&&Qe(ge)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="TO":(Pe=e,e=s)):(Pe=e,e=s),e}function Ht(){var e,r,i,a;return e=Pe,"interval"===t.substr(Pe,8).toLowerCase()?(r=t.substr(Pe,8),Pe+=8):(r=s,0===Ge&&Qe(me)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="INTERVAL":(Pe=e,e=s)):(Pe=e,e=s),e}function Wt(){var e,r,i,a;return e=Pe,"year"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(ve)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="YEAR":(Pe=e,e=s)):(Pe=e,e=s),e}function $t(){var e,r,i,a;return e=Pe,"month"===t.substr(Pe,5).toLowerCase()?(r=t.substr(Pe,5),Pe+=5):(r=s,0===Ge&&Qe(ye)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="MONTH":(Pe=e,e=s)):(Pe=e,e=s),e}function Kt(){var e,r,i,a;return e=Pe,"day"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=s,0===Ge&&Qe(be)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="DAY":(Pe=e,e=s)):(Pe=e,e=s),e}function er(){var e,r,i,a;return e=Pe,"hour"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(_e)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="HOUR":(Pe=e,e=s)):(Pe=e,e=s),e}function tr(){var e,r,i,a;return e=Pe,"minute"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=s,0===Ge&&Qe(Oe)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="MINUTE":(Pe=e,e=s)):(Pe=e,e=s),e}function rr(){var e,r,i,a;return e=Pe,"second"===t.substr(Pe,6).toLowerCase()?(r=t.substr(Pe,6),Pe+=6):(r=s,0===Ge&&Qe(je)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="SECOND":(Pe=e,e=s)):(Pe=e,e=s),e}function ir(){var e,r,i,a;return e=Pe,"case"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(xe)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="CASE":(Pe=e,e=s)):(Pe=e,e=s),e}function sr(){var e,r,i,a;return e=Pe,"end"===t.substr(Pe,3).toLowerCase()?(r=t.substr(Pe,3),Pe+=3):(r=s,0===Ge&&Qe(we)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="END":(Pe=e,e=s)):(Pe=e,e=s),e}function ar(){var e,r,i,a;return e=Pe,"when"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(Ie)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="WHEN":(Pe=e,e=s)):(Pe=e,e=s),e}function nr(){var e,r,i,a;return e=Pe,"then"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(Se)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="THEN":(Pe=e,e=s)):(Pe=e,e=s),e}function or(){var e,r,i,a;return e=Pe,"else"===t.substr(Pe,4).toLowerCase()?(r=t.substr(Pe,4),Pe+=4):(r=s,0===Ge&&Qe(Te)),r!==s?(i=Pe,Ge++,a=ot(),Ge--,a===s?i=void 0:(Pe=i,i=s),i!==s?e=r="ELSE":(Pe=e,e=s)):(Pe=e,e=s),e}function ur(){var e;return 44===t.charCodeAt(Pe)?(e=",",Pe++):(e=s,0===Ge&&Qe(Fe)),e}function lr(){var e;return 40===t.charCodeAt(Pe)?(e="(",Pe++):(e=s,0===Ge&&Qe(Me)),e}function cr(){var e;return 41===t.charCodeAt(Pe)?(e=")",Pe++):(e=s,0===Ge&&Qe(ke)),e}function hr(){var e,t;for(e=[],t=dr();t!==s;)e.push(t),t=dr();return e}function dr(){var e;return Ce.test(t.charAt(Pe))?(e=t.charAt(Pe),Pe++):(e=s,0===Ge&&Qe(Re)),e}function fr(){var e,r,i,a;if(e=Pe,(r=at())!==s&&(r=r),(e=r)===s)if(e=Pe,96===t.charCodeAt(Pe)?(r="`",Pe++):(r=s,0===Ge&&Qe(Ae)),r!==s){if(i=[],Ee.test(t.charAt(Pe))?(a=t.charAt(Pe),Pe++):(a=s,0===Ge&&Qe(Ne)),a!==s)for(;a!==s;)i.push(a),Ee.test(t.charAt(Pe))?(a=t.charAt(Pe),Pe++):(a=s,0===Ge&&Qe(Ne));else i=s;i!==s?(96===t.charCodeAt(Pe)?(a="`",Pe++):(a=s,0===Ge&&Qe(Ae)),a!==s?e=r=function(e){return e.join("")}(i):(Pe=e,e=s)):(Pe=e,e=s)}else Pe=e,e=s;return e}function pr(e,t,r,i){var s={type:"binary_expr",operator:e,left:t,right:r};return void 0!==i&&(s.escape=i),s}function gr(e,t){for(var r=e,i=0;i<t.length;i++)r=pr(t[i][1],r,t[i][3]);return r}if((i=n())!==s&&Pe===t.length)return i;throw i!==s&&Pe<t.length&&Qe({type:"end"}),function(t,r,i){return new e(e.buildMessage(t,r),t,r,i)}(De,ze<t.length?t.charAt(ze):null,ze<t.length?Ve(ze,ze+1):Ve(ze,ze))}}},e.exports&&(e.exports=t())}));var f=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,g=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,m=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,v=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;function y(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function b(e,t,r="0",i="0",s="0",a="0",n="",o="0",u="0"){if("+"===n||"-"===n){var l="".concat(y(parseInt(e,10),4),"-").concat(y(parseInt(t,10),2),"-").concat(y(parseInt(r,10),2)),c="";parseFloat(a)<10&&(c="0");var h="".concat(y(parseInt(i,10),2),":").concat(y(parseInt(s,10),2),":").concat(c+parseFloat(a).toString()),d="".concat(n).concat(y(parseInt(o,10),2),":").concat(y(parseInt(u,10),2));return new Date(l+"T"+h+d)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(r,10),parseInt(i,10),parseInt(s,10),parseFloat(a))}class _{static makeBool(e){return w(e)}static featureValue(e,t,r,i){return N(e,t,r,i)}static equalsNull(e){return null===e}static applyLike(e,t,r){return k(e,t,r)}static ensureArray(e){return I(e)}static applyIn(e,t){return M(e,t)}static currentDate(){var e=new Date;return e.setHours(0,0,0,0),e}static makeSqlInterval(e,t,r){return u.createFromValueAndQualifer(e,t,r)}static convertInterval(e){return e instanceof u?e.valueInMilliseconds():e}static currentTimestamp(){return new Date}static compare(e,t,r){return R(e,t,r)}static calculate(e,t,r){return E(e,t,r)}static makeComparable(e){return C(e)}static evaluateFunction(e,t){return l(e,t)}static lookup(e,t){var r=t[e];return void 0===r?null:r}static between(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}static notbetween(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}static ternaryNot(e){return S(e)}static ternaryAnd(e,t){return T(e,t)}static ternaryOr(e,t){return F(e,t)}}class O{constructor(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this.parseTree=class{static parse(e){return d.parse(e)}}.parse(e);var{isStandardized:r,isAggregate:i,referencedFieldNames:s}=this.extractExpressionInfo(t);this.referencedFieldNames=s,this.isStandardized=r,this.isAggregate=i}static create(e,t){return new O(e,t)}get fieldNames(){return this.referencedFieldNames}testSet(e,t=P){var r={},i=function(i){r[i]=e.map((e=>t.getAttribute(e,i)))};for(var s of this.fieldNames)i(s);return!!this.evaluateNode(this.parseTree,{attributes:r},P)}calculateValue(e,t=P){var r=this.evaluateNode(this.parseTree,e,t);return r instanceof u?r.valueInMilliseconds()/864e5:r}calculateValueCompiled(e,t=P){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(i.a)("csp-restrictions")?this.calculateValue(e,t):(this.compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}testFeature(e,t=P){return!!this.evaluateNode(this.parseTree,e,t)}testFeatureCompiled(e,t=P){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):Object(i.a)("csp-restrictions")?this.testFeature(e,t):(this.compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}getFunctions(){var e=[];return this.visitAll(this.parseTree,(t=>{"function"===t.type&&e.push(t.name.toLowerCase())})),A(e)}getExpressions(){var e=new Map;return this.visitAll(this.parseTree,(t=>{if("function"===t.type){var r=t.name.toLowerCase(),i=t.args.value[0];if("column_ref"===i.type){var s=i.column,a="".concat(r,"-").concat(s);e.has(a)||e.set(a,{aggregateType:r,field:s})}}})),[...e.values()]}getVariables(){var e=[];return this.visitAll(this.parseTree,(t=>{"param"===t.type&&e.push(t.value.toLowerCase())})),A(e)}compileMe(){var e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(_)}extractExpressionInfo(e){var t=[],r=!0,i=!0;return this.visitAll(this.parseTree,(a=>{switch(a.type){case"column_ref":var n=e.get(a.column),o=n&&n.name;!n||"date"!==n.type&&"esriFieldTypeDate"!==n.type||(this.datefields[n.name]=1),void 0!==o?(t.push(o),a.column=o):t.push(a.column);break;case"function":var{name:u,args:l}=a,h=l.value.length;r&&(r=function(e,t){var r=c[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(u,h)),i&&(i=function(e,t){var r=s[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams}(u,h))}})),{referencedFieldNames:A(t),isStandardized:r,isAggregate:i}}visitAll(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r of e.clauses)this.visitAll(r,t);"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var i of e.value)this.visitAll(i,t);break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var i=0;i<e.clauses.length;i++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[i].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[i].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(var s=0;s<e.clauses.length;s++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[s].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[s].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":var a="[";for(var n of e.value)"["!==a&&(a+=","),a+=this.evaluateNodeToJavaScript(n);return a+="]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+x(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+j(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}evaluateNode(e,t,r){switch(e.type){case"interval":var i=this.evaluateNode(e.value,t,r);return u.createFromValueAndQualifer(i,e.qualifier,e.op);case"case_expression":if("simple"===e.format){for(var a=C(this.evaluateNode(e.operand,t,r)),n=0;n<e.clauses.length;n++)if(a===C(this.evaluateNode(e.clauses[n].operand,t,r)))return this.evaluateNode(e.clauses[n].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}else{for(var o=0;o<e.clauses.length;o++)if(w(this.evaluateNode(e.clauses[o].operand,t,r)))return this.evaluateNode(e.clauses[o].value,t,r);if(null!==e.else)return this.evaluateNode(e.else,t,r)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":var c=[];for(var h of e.value)c.push(this.evaluateNode(h,t,r));return c;case"unary_expr":return S(this.evaluateNode(e.expr,t,r));case"binary_expr":switch(e.operator){case"AND":return T(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"OR":return F(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t,r);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t,r);case"IN":var d=I(this.evaluateNode(e.right,t,r));return M(this.evaluateNode(e.left,t,r),d);case"NOT IN":var f=I(this.evaluateNode(e.right,t,r));return S(M(this.evaluateNode(e.left,t,r),f));case"BETWEEN":var p=this.evaluateNode(e.left,t,r),g=this.evaluateNode(e.right,t,r);return null==p||null==g[0]||null==g[1]?null:p>=C(g[0])&&p<=C(g[1]);case"NOTBETWEEN":var m=this.evaluateNode(e.left,t,r),v=this.evaluateNode(e.right,t,r);return null==m||null==v[0]||null==v[1]?null:m<C(v[0])||m>C(v[1]);case"LIKE":return k(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape);case"NOT LIKE":return S(k(this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return R(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r));case"-":case"+":case"*":case"/":return E(e.operator,this.evaluateNode(e.left,t,r),this.evaluateNode(e.right,t,r))}case"null":case"bool":case"string":case"number":return e.value;case"date":return x(e.value);case"timestamp":return j(e.value);case"current_time":var y=new Date;return"date"===e.mode&&y.setHours(0,0,0,0),y;case"column_ref":return N(t,e.column,this.datefields,r);case"function":var b=this.evaluateNode(e.args,t,r);return this.isAggregate?function(e,t){var r=s[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to ".concat(e.toUpperCase()));return r.evaluate(t)}(e.name,b):l(e.name,b)}throw new Error("Unsupported sql syntax "+e.type)}}function j(e){var t=p.exec(e);if(null!==t){var[,r,i,s,a,n,o]=t;return b(r,i,s,a,n,o)}if(null!==(t=g.exec(e))){var[,u,l,c,h,d,y,_,O,j]=t;return b(u,l,c,h,d,y,_,O,j)}if(null!==(t=m.exec(e))){var[,x,w,I,S,T,F,M,k]=t;return b(x,w,I,S,T,"0",F,M,k)}if(null!==(t=v.exec(e))){var[,C,R,A,E,N]=t;return b(C,R,A,E,N)}if(null!==(t=f.exec(e))){var[,P,q,z]=t;return b(P,q,z)}throw new Error("SQL Invalid Timestamp")}function x(e){var t=f.exec(e);if(null===t)throw new Error("SQL Invalid Date");var[,r,i,s]=t;return new Date(parseInt(r,10),parseInt(i,10)-1,parseInt(s,10))}function w(e){return!0===e}function I(e){return Array.isArray(e)?e:[e]}function S(e){return null!==e?!0!==e:null}function T(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function F(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function M(e,t){if(null==e)return null;var r=!1;for(var i of t)if(null==i)r=null;else if(e===i){r=!0;break}return r}function k(e,t,r){if(null==e)return null;for(var i=t,s=r,a="",n="-[]/{}()*+?.\\^$|",o=0,u=0;u<i.length;u++){var l=i.charAt(u);switch(o){case 0:l===s?o=1:n.indexOf(l)>=0?a+="\\"+l:a+="%"===l?".*":"_"===l?".":l;break;case 1:n.indexOf(l)>=0?a+="\\"+l:a+=l,o=0}}return new RegExp("^"+a+"$").test(e)}function C(e){return e instanceof Date?e.valueOf():e}function R(e,t,r){if(null==t||null==r)return null;var i=C(t),s=C(r);switch(e){case"<>":return i!==s;case"=":return i===s;case">":return i>s;case"<":return i<s;case">=":return i>=s;case"<=":return i<=s}}function A(e){var t=[],r={};for(var i of e){var s=i.toLowerCase();void 0===r[s]&&(t.push(i),r[s]=1)}return t}function E(e,t,r){if(t instanceof u)if(r instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+r.getTime());case"-":return t.valueInMilliseconds()-r.getTime();case"*":return t.valueInMilliseconds()*r.getTime();case"/":return t.valueInMilliseconds()/r.getTime()}else if(r instanceof u)switch(e){case"+":return u.createFromMilliseconds(t.valueInMilliseconds()+r.valueInMilliseconds());case"-":return u.createFromMilliseconds(t.valueInMilliseconds()-r.valueInMilliseconds());case"*":return t.valueInMilliseconds()*r.valueInMilliseconds();case"/":return t.valueInMilliseconds()/r.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(r instanceof u)if(t instanceof Date)switch(e){case"+":return new Date(r.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-r.valueInMilliseconds());case"*":return t.getTime()*r.valueInMilliseconds();case"/":return t.getTime()/r.valueInMilliseconds()}else r=r.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof r)switch(r=24*r*60*60*1e3,t=t.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}else if(r instanceof Date&&"number"==typeof t)switch(t=24*t*60*60*1e3,r=r.getTime(),e){case"+":return new Date(t+r);case"-":return new Date(t-r);case"*":return new Date(t*r);case"/":return new Date(t/r)}switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r}}function N(e,t,r,i){var s=i.getAttribute(e,t);return null!=s&&1===r[t]?new Date(s):s}var P={getAttribute:(e,t)=>(function(e){return e&&"object"==typeof e.attributes}(e)?e.attributes:e)[t]}},279:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return j})),r.d(t,"f",(function(){return S})),r.d(t,"g",(function(){return n})),r.d(t,"h",(function(){return u})),r.d(t,"i",(function(){return l})),r.d(t,"j",(function(){return o})),r.d(t,"k",(function(){return x})),r.d(t,"l",(function(){return a})),r.d(t,"m",(function(){return y})),r.d(t,"n",(function(){return I})),r.d(t,"o",(function(){return g})),r.d(t,"p",(function(){return v})),r.d(t,"q",(function(){return O})),r.d(t,"r",(function(){return _})),r.d(t,"s",(function(){return b})),r.d(t,"t",(function(){return p}));var i=r(89);r(103),r(125);function s(e=F){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,r,i,a,n,o=s()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=a,o[5]=n,o}function n(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function o(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function u(e,t,r=0,i=t.length/3){for(var s=e[0],a=e[1],n=e[2],o=e[3],u=e[4],l=e[5],c=0;c<i;c++)s=Math.min(s,t[r+3*c]),a=Math.min(a,t[r+3*c+1]),n=Math.min(n,t[r+3*c+2]),o=Math.max(o,t[r+3*c]),u=Math.max(u,t[r+3*c+1]),l=Math.max(l,t[r+3*c+2]);e[0]=s,e[1]=a,e[2]=n,e[3]=o,e[4]=u,e[5]=l}function l(e,t,r){var i=t.length,s=e[0],a=e[1],n=e[2],o=e[3],u=e[4],l=e[5];if(r)for(var c=0;c<i;c++){var h=t[c];s=Math.min(s,h[0]),a=Math.min(a,h[1]),n=Math.min(n,h[2]),o=Math.max(o,h[0]),u=Math.max(u,h[1]),l=Math.max(l,h[2])}else for(var d=0;d<i;d++){var f=t[d];s=Math.min(s,f[0]),a=Math.min(a,f[1]),o=Math.max(o,f[0]),u=Math.max(u,f[1])}e[0]=s,e[1]=a,e[2]=n,e[3]=o,e[4]=u,e[5]=l}function c(e){return e[0]>=e[3]?0:e[3]-e[0]}function h(e){return e[1]>=e[4]?0:e[4]-e[1]}function d(e){return e[2]>=e[5]?0:e[5]-e[2]}function f(e,t=[0,0,0]){return t[0]=e[0]+c(e)/2,t[1]=e[1]+h(e)/2,t[2]=e[2]+d(e)/2,t}function p(e,t=[0,0,0]){return t[0]=c(e),t[1]=h(e),t[2]=d(e),t}function g(e){return Math.max(c(e),d(e),h(e))}function m(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function v(e,t,r=e){var i=e[0]+c(e)/2,s=e[1]+h(e)/2,a=e[2]+d(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=s+(e[1]-s)*t,r[2]=a+(e[2]-a)*t,r[3]=i+(e[3]-i)*t,r[4]=s+(e[4]-s)*t,r[5]=a+(e[5]-a)*t,r}function y(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function b(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function _(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function O(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function j(e){return e?O(e,T):s(T)}function x(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function w(e){return 6===e.length}function I(e){return 0===c(e)&&0===h(e)&&0===d(e)}function S(e,t,r){if(Object(i.j)(e)||Object(i.j)(t))return e===t;if(!w(e)||!w(t))return!1;if(r){for(var s=0;s<e.length;s++)if(!r(e[s],t[s]))return!1}else for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var T=[1/0,1/0,1/0,-1/0,-1/0,-1/0],F=[0,0,0,0,0,0];s()},282:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return u})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return l}));var i=[252,146,31,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},a={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},n={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},o={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},u={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},l={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},c={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},292:function(e,t,r){"use strict";class i{constructor(e=null,t={},r,i){this.displayId=0,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),r&&(this.centroid=r),null!=i&&(this.objectId=i)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){var e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}t.a=i},297:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var i=r(82),s=r(89),a=r(240),n=r(85),o=r(84),u=r(241),l=r(344),c=r(97),h=r(115),d=r(108),f=class extends c.a{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new h.a,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,r,i=0){var s=0!=(1&i),a=++this.handleId;s||this.installSyncUpdatingWatch(e,t,a);var n=0!=(2&i)?Object(d.a)(e,t,r,s):e.watch(t,r,s);return this.handles.add(n,a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionPropertyChange(e,t,r,i=0){var s=0!=(2&i),a=++this.handleId;return this.handles.add([Object(d.b)(e,t,"after-changes",this.createSyncUpdatingCallback()),Object(d.b)(e,t,"change",r,s?e=>{r({added:e.items,removed:[],moved:[],target:e})}:void 0)],a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionChange(e,t,r=0){var i=0!=(2&r),s=++this.handleId;return this.handles.add([e.on("after-changes",this.createSyncUpdatingCallback()),e.on("change",t)],s),i&&t({added:e.items,removed:[],moved:[],target:e}),{remove:()=>{this.handles.remove(s)}}}addPromise(e){if(Object(s.j)(e))return e;var t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(p)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);var r=()=>this.handles.remove(t);return e.then(r,r),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(e,t,r){var i=this.createSyncUpdatingCallback(),s=Object(l.a)((()=>Object(a.c)(e,t)),i);return this.handles.add(s,r),s}createSyncUpdatingCallback(){return()=>{this.handles.remove(p),++this.scheduleHandleId;var e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Object(u.b)((()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(p))})),p)}}};Object(i.a)([Object(n.b)({readOnly:!0})],f.prototype,"updating",void 0),f=Object(i.a)([Object(o.a)("esri.views.support.WatchUpdatingTracking")],f);var p=-42},311:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return j})),r.d(t,"g",(function(){return x}));var i=r(100);var s=(e,t,r)=>[t,r],a=(e,t,r)=>[t,r,e[2]],n=(e,t,r)=>[t,r,e[2],e[3]];function o(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function u({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function l({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function c(e,t,r){for(var i,s,a,n,o=[],c=0;c<r.length;c++){var h=r[c];c>0?(a=u(e,h[0]),n=l(e,h[1]),a===i&&n===s||(o.push(t(h,a-i,n-s)),i=a,s=n)):(i=u(e,h[0]),s=l(e,h[1]),o.push(t(h,i,s)))}return o.length>0?o:null}function h({scale:e,translate:t},r){return r*e[0]+t[0]}function d({scale:e,translate:t},r){return t[1]-r*e[1]}function f(e,t,r){var i=new Array(r.length);if(!r.length)return i;var[s,a]=e.scale,n=h(e,r[0][0]),o=d(e,r[0][1]);i[0]=t(r[0],n,o);for(var u=1;u<r.length;u++){var l=r[u];n+=l[0]*s,o-=l[1]*a,i[u]=t(l,n,o)}return i}function p(e,t,r){for(var i=new Array(r.length),s=0;s<r.length;s++)i[s]=f(e,t,r[s]);return i}function g(e,t,r,i,o){return t.points=function(e,t,r,i){return c(e,r?i?n:a:i?a:s,t)}(e,r.points,i,o),t}function m(e,t,r,i,s){return t.x=u(e,r.x),t.y=l(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function v(e,t,r,i,o){var u=function(e,t,r,i){for(var o=[],u=r?i?n:a:i?a:s,l=0;l<t.length;l++){var h=c(e,u,t[l]);h&&h.length>=3&&o.push(h)}return o.length?o:null}(e,r.rings,i,o);return u?(t.rings=u,t):null}function y(e,t,r,i,o){var u=function(e,t,r,i){for(var o=[],u=r?i?n:a:i?a:s,l=0;l<t.length;l++){var h=c(e,u,t[l]);h&&h.length>=2&&o.push(h)}return o.length?o:null}(e,r.paths,i,o);return u?(t.paths=u,t):null}function b(e,t){return e&&t?Object(i.f)(t)?m(e,{},t,!1,!1):Object(i.h)(t)?y(e,{},t,!1,!1):Object(i.g)(t)?v(e,{},t,!1,!1):Object(i.e)(t)?g(e,{},t,!1,!1):Object(i.d)(t)?(n=!1,o=!1,(s={}).xmin=u(r=e,(a=t).xmin),s.ymin=l(r,a.ymin),s.xmax=u(r,a.xmax),s.ymax=l(r,a.ymax),s!==a&&(n&&(s.zmin=a.zmin,s.zmax=a.zmax),o&&(s.mmin=a.mmin,s.mmax=a.mmax)),s):null:null;var r,s,a,n,o}function _(e,t,r,i,o){return t.points=function(e,t,r,i){return f(e,r?i?n:a:i?a:s,t)}(e,r.points,i,o),t}function O(e,t,r,i,s){return t.x=h(e,r.x),t.y=d(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function j(e,t,r,i,o){return t.rings=function(e,t,r,i){return p(e,r?i?n:a:i?a:s,t)}(e,r.rings,i,o),t}function x(e,t,r,i,o){return t.paths=function(e,t,r,i){return p(e,r?i?n:a:i?a:s,t)}(e,r.paths,i,o),t}},316:function(e,t,r){"use strict";class i{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){var e=new i;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}t.a=i},317:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return p}));var i=r(89),s=r(126),a=r(97),n=r(107),o=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function u(e){return e instanceof a.a}function l(e){return e instanceof n.a?Object.keys(e.items):u(e)?Object(s.a)(e).keys():e?Object.keys(e):[]}function c(e,t){return e instanceof n.a?e.items[t]:e[t]}function h(e){return e?e.declaredClass:null}function d(e,t){var r=e.diff;if(r&&"function"==typeof r)return r(e,t);var s=l(e),a=l(t);if(0!==s.length||0!==a.length){if(!s.length||!a.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};var n,f=a.filter((e=>-1===s.indexOf(e))),p=s.filter((e=>-1===a.indexOf(e))),g=s.filter((r=>a.indexOf(r)>-1&&c(e,r)!==c(t,r))).concat(f,p).sort(),m=h(e);if(m&&o.indexOf(m)>-1&&g.length)return{type:"complete",oldValue:e,newValue:t};var v=u(e)&&u(t);for(var y of g){var b=c(e,y),_=c(t,y),O=void 0;(v||"function"!=typeof b&&"function"!=typeof _)&&b!==_&&(null==b&&null==_||(O=r&&r[y]&&"function"==typeof r[y]?r[y](b,_):"object"==typeof b&&"object"==typeof _&&h(b)===h(_)?d(b,_):{type:"complete",oldValue:b,newValue:_},Object(i.k)(O)&&(Object(i.k)(n)?n.diff[y]=O:n={type:"partial",diff:{[y]:O}})))}return n}}function f(e,t){if(Object(i.j)(e))return!1;var r=t.split("."),s=e;for(var a of r){if("complete"===s.type)return!0;if("partial"!==s.type)return!1;var n=s.diff[a];if(!n)return!1;s=n}return!0}function p(e,t){for(var r of t)if(f(e,r))return!0;return!1}function g(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&h(e)!==h(t)?{type:"complete",oldValue:e,newValue:t}:d(e,t)}},336:function(e,t,r){"use strict";var i,s=r(91),a=r(82),n=(r(80),r(81),r(88)),o=r(85),u=r(95),l=r(98),c=r(84),h=r(96),d=(r(83),r(86),r(87),r(90)),f=r(112),p=r(99),g=r(161),m=r(113),v=(r(101),r(117)),y=r(125),b=r(460),_=new u.a({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"}),O=i=class extends d.a{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={size:256,spatialReference:p.a.WebMercator}){var t=e.resolutionFactor||1,r=e.scales,s=e.size||256,a=e.spatialReference||p.a.WebMercator;if(!Object(f.i)(a)){var n=[];if(r)for(var o=0;o<r.length;o++){var u=r[o];n.push({level:o,scale:u,resolution:u})}else for(var l=5e-4,c=23;c>=0;c--)n.unshift({level:c,scale:l,resolution:l}),l*=2;return new i({dpi:96,lods:n,origin:new m.a(0,0,a),size:[s,s],spatialReference:a})}var h=Object(f.d)(a),d=e.origin?new m.a({x:e.origin.x,y:e.origin.y,spatialReference:a}):new m.a(h?{x:h.origin[0],y:h.origin[1],spatialReference:a}:{x:0,y:0,spatialReference:a}),g=1/(39.37*Object(v.f)(a)*96),y=[];if(r)for(var b=0;b<r.length;b++){var _=r[b],O=_*g;y.push({level:b,scale:_,resolution:O})}else{var j=Object(f.f)(a)?512/s*591657527.5917094:256/s*591657527.591555,x=Math.ceil(24/t);y.push({level:0,scale:j,resolution:j*g});for(var w=1;w<x;w++){var I=j/Math.pow(2,t),S=I*g;y.push({level:w,scale:I,resolution:S}),j=I}}return new i({dpi:96,lods:y,origin:d,size:[s,s],spatialReference:a})}get isWrappable(){var{spatialReference:e,origin:t}=this;if(e&&t){var r=Object(f.d)(e);return e.isWrappable&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return m.a.fromJSON(Object(s.a)({spatialReference:t.spatialReference},e))}set lods(e){var t=0,r=0,i=[];this._levelToLOD={},e&&(t=-1/0,r=1/0,e.forEach((e=>{i.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,this._levelToLOD[e.level]=e}))),this._set("scales",i),this._set("minScale",t),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[0]}zoomToScale(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var r=Math.round(e-.5),i=Math.round(e);return t[i]+(i-e)*(t[r]-t[i])}scaleToZoom(e){for(var t=this.scales,r=t.length-1,i=0;i<r;i++){var s=t[i],a=t[i+1];if(s<=e)return i;if(a===e)return i+1;if(s>e&&a<e)return i+1-(e-a)/(s-a)}return i}snapScale(e,t=.95){var r=this.scaleToZoom(e);return r%Math.floor(r)>=t?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(e,t,r,i){var s,a,n=this.lodAt(e);if(!n)return null;if("number"==typeof t)s=t,a=r;else if(Object(f.c)(t.spatialReference,this.spatialReference))s=t.x,a=t.y,i=r;else{var o=Object(g.d)(t,this.spatialReference);if(!o)return null;s=o.x,a=o.y,i=r}var u=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i={id:null,level:0,row:0,col:0,extent:Object(y.i)()}),i.level=e,i.row=Math.floor((this.origin.y-a)/l+.001),i.col=Math.floor((s-this.origin.x)/u+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=0){var r=this.lodAt(e.level);if(!r&&1===t){var i=this.lods[this.lods.length-1];i.level<e.level&&(r=i)}if(r){var s=e.level-r.level,a=r.resolution*this.size[0]/Math.pow(2,s),n=r.resolution*this.size[1]/Math.pow(2,s);e.id="".concat(e.level,"/").concat(e.row,"/").concat(e.col),e.extent||(e.extent=Object(y.i)()),e.extent[0]=this.origin.x+e.col*a,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+a,e.extent[3]=e.extent[1]+n}}upsampleTile(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){var{resolution:r}=this.lodAt(t.level),i=r*this.size[0],s=r*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+i,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return i.fromJSON(this.write({}))}_initializeUpsampleLevels(){var e=this.lods;this._upsampleLevels=[];for(var t=null,r=0;r<e.length;r++){var i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}};Object(a.a)([Object(o.b)({type:Number,json:{write:!0}})],O.prototype,"compressionQuality",void 0),Object(a.a)([Object(o.b)({type:Number,json:{write:!0}})],O.prototype,"dpi",void 0),Object(a.a)([Object(o.b)({type:String,json:{read:_.read,write:_.write,origins:{"web-scene":{read:!1,write:!1}}}})],O.prototype,"format",void 0),Object(a.a)([Object(o.b)({readOnly:!0})],O.prototype,"isWrappable",null),Object(a.a)([Object(o.b)({type:m.a,json:{write:!0}})],O.prototype,"origin",void 0),Object(a.a)([Object(l.a)("origin")],O.prototype,"readOrigin",null),Object(a.a)([Object(o.b)({type:[b.a],value:null,json:{write:!0}})],O.prototype,"lods",null),Object(a.a)([Object(o.b)({readOnly:!0})],O.prototype,"minScale",void 0),Object(a.a)([Object(o.b)({readOnly:!0})],O.prototype,"maxScale",void 0),Object(a.a)([Object(o.b)({readOnly:!0})],O.prototype,"scales",void 0),Object(a.a)([Object(o.b)({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],O.prototype,"size",void 0),Object(a.a)([Object(l.a)("size",["rows","cols"])],O.prototype,"readSize",null),Object(a.a)([Object(h.a)("size",{cols:{type:n.a},rows:{type:n.a}})],O.prototype,"writeSize",null),Object(a.a)([Object(o.b)({type:p.a,json:{write:!0}})],O.prototype,"spatialReference",void 0);var j=O=i=Object(a.a)([Object(c.a)("esri.layers.support.TileInfo")],O);t.a=j},362:function(e,t,r){"use strict";var i=r(80),s=r(221),a=4294967296,n=Object(i.a)("esri-text-decoder")?new TextDecoder("utf-8"):null,o=Object(i.a)("safari")||Object(i.a)("ios")?6:Object(i.a)("ff")?12:32;class u{constructor(e,t,r=0,i=(e?e.byteLength:0)){this._tag=0,this._dataType=99,this.init(e,t,r,i)}init(e,t,r,i){this._data=e,this._dataView=t,this._pos=r,this._end=i}clone(){return new u(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;var e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){var e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){var e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getUint32(t+4,!0)*a;return this._skip(8),r}getSFixed64(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+e.getInt32(t+4,!0)*a;return this._skip(8),r}getDouble(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r}getBytes(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,r,i){var s=this.getMessage(),a=e(s,t,r,i);return s.release(),a}processMessage(e){var t=this.getMessage(),r=e(t);return t.release(),r}getMessage(){var e=this._getLength(),t=u.pool.acquire();return t.init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){u.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var s=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*s,s*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*s}return this._pos=r,i}_decodeSVarint(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2}_getLength(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,r){if((r=Math.min(this._end,r))-t>o&&n){var i=e.subarray(t,r);return n.decode(i)}for(var s="",a="",u=t;u<r;++u){var l=e[u];128&l?a+="%"+l.toString(16):(s+=decodeURIComponent(a)+String.fromCharCode(l),a="")}return a.length&&(s+=decodeURIComponent(a)),s}_toBytes(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)}}u.pool=new s.a(u,null,(e=>{e._data=null,e._dataView=null})),t.a=u},366:function(e,t,r){"use strict";r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return _}));var i=r(7),s=r(80),a=r(89),n=r(81),o=r(93),u=r(94),l=r(110),c=r(317),h=r(207),d=r(122),f=r(151),p=r(429),g=r(520),m=n.a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),v=Object(p.b)(p.a,m),y=e=>(2147483648&e)>>>31,b=e=>2147483647&e;function _(e){return 1===y(e)}var O={sharedArrayBuffer:Object(s.a)("esri-shared-array-buffer"),atomics:Object(s.a)("esri-atomics")};function j(e,t){return r=>t(e(r))}class x{constructor(e,t,r,i){this.size=0,this.texelSize=4;var{pixelType:s,layout:a,textureOnly:n}=i;this.textureOnly=n||!1,this.pixelType=s,this._ctype=t,this.layout=a,this._resetRange(),this._shared=e,this.size=r,n||(this.data=this._initData(s,r,e,t))}get buffer(){return Object(a.b)(this.data,(e=>e.buffer))}unsetComponentAllTexels(e,t){for(var r=Object(a.q)(this.data),i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){for(var r=Object(a.q)(this.data),i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,r){var i=Object(a.q)(this.data);for(var s of r)i[s*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)}setComponentTexel(e,t,r){Object(a.q)(this.data)[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}unsetComponentTexel(e,t,r){Object(a.q)(this.data)[r*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}getData(e,t){var r=b(e);return Object(a.q)(this.data)[r*this.texelSize+t]}setData(e,t,r){var i=b(e),s=1<<t;0!=(this.layout&s)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):m.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&O.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&O.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(e){if(this.size=e,!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=Object(a.q)(this.data);t.set(r),this.data=t}}toMessage(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),s=this.pixelType,n=this.layout,o=Object(a.q)(this.data);return o.slice?{start:e,end:t,data:i&&o.slice(e*r,(t+1)*r)||null,pixelType:s,layout:n}:i?{start:e,end:t,data:new(Object(f.j)(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:s,layout:n}:{start:e,end:t,data:null,pixelType:s,layout:n}}_initData(e,t,r,i){for(var s=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,a=Object(f.j)(e),n=new a(new s(t*t*4*a.BYTES_PER_ELEMENT)),o=0;o<n.length;o+=4)n[o+1]=255;return n}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}t.a=class{constructor(e,t){this._client=e,this.config=t,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(d.m),this._targetType=0,this._abortController=Object(u.d)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;var r=t.supportsTextureFloat?5126:5121;v("Creating AttributeStore ".concat(O.sharedArrayBuffer?"with":"without"," shared memory")),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:r,layout:15},{pixelType:r,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,t){this.config=t;var r=t.schema.processors[0].storage,i=Object(c.a)(this._schema,r);if((e.targets.feature||e.targets.aggregate)&&(e.storage.data=!0),i&&(Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",i),e.storage.data=!0,this._schema=r,this._attributeComputeMap.clear(),!Object(a.j)(r))){switch(r.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(var n of r.mapping)this._bindAttribute(n)}}onTileData(e,t){if(!Object(a.j)(t.addOrUpdate))for(var r=t.addOrUpdate.getCursor();r.next();){var i=r.getDisplayId();this.setAttributeData(i,r)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=Object(u.d)()}setHighlight(e,t){var r=this;return Object(i.a)((function*(){var i=r._getBlock(0),s=t.map((e=>b(e)));for(var a of(i.lock(),i.unsetComponentAllTexels(0,1),i.setComponent(0,1,s),i.unlock(),r._idsToHighlight.clear(),e))r._idsToHighlight.add(a);yield r.sendUpdates()}))()}updateFilters(e,t){var r=this;return Object(i.a)((function*(){var{config:i,service:a,spatialReference:n}=t,{filters:o}=i,u=o.map(((e,t)=>r._updateFilter(e,t,a,n)));(yield Promise.all(u)).some((e=>e))&&(e.storage.filters=!0,Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}))()}setData(e,t,r,i){var s=b(e);this._ensureSizeForTexel(s),this._getBlock(t).setData(e,r,i)}getData(e,t,r){return this._getBlock(t).getData(e,r)}getHighlightFlag(e){return this._idsToHighlight.has(e)?d.j:0}unsetAttributeData(e){var t=b(e);this._getBlock(0).setData(t,0,0)}setAttributeData(e,t){var r=b(e);if(this._ensureSizeForTexel(r),this._getBlock(0).setData(r,0,this.getFilterFlags(t)),this._targetType===y(e)){var i=this._attributeComputeMap,s=this.config.supportsTextureFloat?1:2;i.size&&i.forEach(((e,i)=>{var a=i*s%4,n=Math.floor(i*s/4),o=this._getBlock(n+d.b),u=e(t);if(this.config.supportsTextureFloat)o.setData(r,a,u);else if(u===d.n)o.setData(r,a,255),o.setData(r,a+1,255);else{var c=Object(l.d)(Math.round(u),-32767,32766)+32768,h=255&c,f=(65280&c)>>8;o.setData(r,a,h),o.setData(r,a+1,f)}}))}}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(u.g)(),this._nextUpdate.promise;var e={blocks:this._blocks.map((e=>Object(a.k)(e)?e.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{var t=()=>{if(this._currUpdate=null,this._nextUpdate){var e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>e.resolve()))}},r=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),r})).catch((e=>Object(u.m)(e)?(this._createResourcesPromise=null,this._createResources()):(m.error(new o.a("mapview-attribute-store","Encountered an error during client update",e)),Promise.resolve()))),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){var t;if(null!=e.fieldIndex)e.normalizationField&&m.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),t=t=>t.getComputedNumericAtIndex(e.fieldIndex);else{if(!e.field)return;t=e.normalizationField?t=>{var r=t.readAttribute(e.normalizationField);return r?t.readAttribute(e.field)/r:null}:t=>t.readAttribute(e.field)}e.valueRepresentation&&(t=j(t,(t=>Object(g.b)(t,e.valueRepresentation))));this._attributeComputeMap.set(e.binding,j(t,(e=>null===e||isNaN(e)||e===1/0?d.n:e)))}_createResources(){if(Object(a.k)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(d.a),v("Initializing AttributeStore");var e={shared:O.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(a.m)(this._blocks,(e=>({textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType})))},t=this._client.initialize(e,this._signal).catch((e=>{Object(u.m)(e)?this._createResourcesPromise=null:m.error(new o.a("mapview-attribute-store","Encountered an error during client initialization",e))}));return this._createResourcesPromise=t,t.then((()=>Object(a.j)(this._createResourcesPromise)?this._createResources():void 0)),t}_getBlock(e){var t=this._blocks[e];if(Object(a.k)(t))return t;v("Initializing AttributeBlock at index ".concat(e));var r=O.sharedArrayBuffer,i=this._client.type,s=new x(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=s,this._createResourcesPromise=null,s}_expand(){if(this._size<this.config.maxTextureSize){var e=this._size<<=1;return v("Expanding block size to",e,this._blocks),Object(a.h)(this._blocks,(t=>t.expand(e))),this._createResourcesPromise=null,this._size=e,0}return m.error(new o.a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateFilter(e,t,r,s){var n=this;return Object(i.a)((function*(){var i=n._filters[t],o=Object(a.k)(i)&&i.hash;if(!i&&!e)return!1;if(o===JSON.stringify(e))return!1;if(Object(a.j)(e)){var u=1<<t+1,l=n._getBlock(0);return n._filters[t]=null,l.setComponentAllTexels(0,u),n.sendUpdates(),!0}var c=yield n._getFilter(t,r);return yield c.update(e,s),!0}))()}_getFilter(e,t){var s=this;return Object(i.a)((function*(){var i=s._filters[e];if(Object(a.k)(i))return i;var{default:n}=yield r.e(122).then(r.bind(null,709)),o=new n({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new h.a(t.fields)});return s._filters[e]=o,o}))()}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){for(var t=0,r=(e=>1===y(e)?254:255)(e.getDisplayId()),i=0;i<this._filters.length;i++){var s=!!(r&1<<i),n=this._filters[i];t|=(!s||Object(a.j)(n)||n.check(e)?1:0)<<i}var o=0;if(this._idsToHighlight.size){var u=e.getObjectId();o=this.getHighlightFlag(u)}return t<<1|o}}},372:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l}));var i=r(112),s=r(117),a=r(292),n=r(316),o=r(178),u=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class l{constructor(e){this.options=e,this.geometryTypes=u,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new n.a}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(e&&e.features&&e.hasZ&&this.options.sourceSpatialReference&&e.spatialReference&&!Object(i.c)(e.spatialReference,this.options.sourceSpatialReference)&&!e.spatialReference.vcsWkid){var t=Object(s.g)(this.options.sourceSpatialReference)/Object(s.g)(e.spatialReference);if(1!==t)for(var r of e.features)if(r.geometry&&r.geometry.coords)for(var a=r.geometry.coords,n=2;n<a.length;n+=3)a[n]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new a.a}createSpatialReference(){return{wkid:0}}createGeometry(){return new o.a}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new o.a}}},386:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(387);function s(e,t){var r=Object(i.a)(e,t),s=r.queryResult.featureResult,a=r.queryResult.queryGeometry,n=r.queryResult.queryGeometryType;if(s&&s.features&&s.features.length&&s.objectIdFieldName){var o=s.objectIdFieldName;for(var u of s.features)u.attributes&&(u.objectId=u.attributes[o])}return s&&(s.queryGeometry=a,s.queryGeometryType=n),s}},387:function(e,t,r){"use strict";r.d(t,"a",(function(){return C})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return S}));var i=r(89),s=r(81),a=r(93),n=r(178),o=r(372),u=r(362),l=s.a.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),c=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],h=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],d=["upperLeft","lowerLeft"];function f(e){return e>=c.length?null:c[e]}function p(e){return e>=h.length?null:h[e]}function g(e){return e>=d.length?null:d[e]}function m(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function v(e,t,r){for(var i=t.createPointGeometry(r);e.next();)switch(e.tag()){case 3:for(var s=e.getUInt32(),a=e.pos()+s,n=0;e.pos()<a;)t.addCoordinatePoint(i,e.getSInt64(),n++);break;case 1:case 2:default:e.skip()}return i}function y(e,t,r){for(var i=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);e.next();)switch(e.tag()){case 2:for(var a=e.getUInt32(),n=e.pos()+a,o=0;e.pos()<n;)t.addLength(i,e.getUInt32(),o++);break;case 3:var u=e.getUInt32(),l=e.pos()+u,c=0;for(t.allocateCoordinates(i);e.pos()<l;)t.addCoordinate(i,e.getSInt64(),c),++c===s&&(c=0);break;case 1:default:e.skip()}return i}function b(e){for(var t=new n.a,r="esriGeometryPoint";e.next();)switch(e.tag()){case 2:for(var i=e.getUInt32(),s=e.pos()+i;e.pos()<s;)t.lengths.push(e.getUInt32());break;case 3:for(var a=e.getUInt32(),u=e.pos()+a;e.pos()<u;)t.coords.push(e.getSInt64());break;case 1:r=o.a[e.getEnum()];break;default:e.skip()}return{queryGeometry:t,queryGeometryType:r}}function _(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function O(e){for(var t={type:f(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=f(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=p(e.getEnum());break;case 5:try{t.domain=JSON.parse(e.getString())}catch(g){l.error(new a.a("query:parsing-pbf","Failed to parse domain",{error:g})),t.domain=null}break;case 6:t.defaultValue=e.getString();break;default:e.skip()}return t}function j(e){for(var t={};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function x(e,t,r,i){for(var s=t.createFeature(r),a=0;e.next();)switch(e.tag()){case 1:var n=i[a++].name;s.attributes[n]=e.processMessage(_);break;case 2:s.geometry=e.processMessageWithArgs(y,t,r);break;case 4:s.centroid=e.processMessageWithArgs(v,t,r);break;default:e.skip()}return s}function w(e){for(var t=[1,1,1,1];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function I(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function S(e){for(var t={originPosition:g(0)};e.next();)switch(e.tag()){case 1:t.originPosition=g(e.getEnum());break;case 2:t.scale=e.processMessage(w);break;case 3:t.translate=e.processMessage(I);break;default:e.skip()}return t}function T(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function F(e,t){for(var r=t.createSpatialReference();e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function M(e,t){var r=t.createFeatureResult();r.geometryType=m(t,0);for(var i=!1;e.next();)switch(e.tag()){case 1:r.objectIdFieldName=e.getString();break;case 3:r.globalIdFieldName=e.getString();break;case 4:r.geohashFieldName=e.getString();break;case 5:r.geometryProperties=e.processMessage(T);break;case 7:r.geometryType=m(t,e.getEnum());break;case 8:r.spatialReference=e.processMessageWithArgs(F,t);break;case 10:r.hasZ=e.getBool();break;case 11:r.hasM=e.getBool();break;case 12:r.transform=e.processMessage(S);break;case 9:var s=e.getBool();r.exceededTransferLimit=s;break;case 13:t.addField(r,e.processMessage(O));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,e.processMessageWithArgs(x,t,r,r.fields));break;case 2:r.uniqueIdField=e.processMessage(j);break;case 6:default:e.skip()}return t.finishFeatureResult(r),r}function k(e,t){for(var r={},s=null;e.next();)switch(e.tag()){case 4:s=e.processMessageWithArgs(b);break;case 1:r.featureResult=e.processMessageWithArgs(M,t);break;case 2:case 3:default:e.skip()}return Object(i.k)(s)&&r.featureResult&&t.addQueryGeometry(r,s),r}function C(e,t){try{for(var r=new u.a(new Uint8Array(e),new DataView(e)),i={};r.next();)switch(r.tag()){case 2:i.queryResult=r.processMessageWithArgs(k,t);break;default:r.skip()}return i}catch(s){throw new a.a("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:s})}}},400:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return y}));var i=r(7),s=r(112),a=r(161),n=r(223),o=r(428),u=[0,0];function l(e,t){if(!t)return null;if("x"in t){var r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,u),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){var i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,u),[i.xmax,i.ymax]=e(t.xmax,t.ymax,u),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function c(e,t){var r=[];for(var i of e)r.push(h(i,t));return r}function h(e,t){var r=[];for(var i of e){var s=t(i[0],i[1],[0,0]);r.push(s),i.length>2&&s.push(i[2]),i.length>3&&s.push(i[3])}return r}function d(e,t){return f.apply(this,arguments)}function f(){return(f=Object(i.a)((function*(e,t){if(t){var r=Array.isArray(e)?e.map((e=>{var t;return null==(t=e.geometry)?void 0:t.spatialReference})):[e];yield Object(n.f)(r.map((e=>({source:e,dest:t}))))}}))).apply(this,arguments)}var p=l.bind(null,a.c),g=l.bind(null,a.g);function m(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(s.i)(t)&&Object(s.i)(r)&&!Object(s.c)(t,r)?Object(a.a)(t,r)?Object(s.m)(r)?p(e):g(e):Object(n.m)(o.a,[e],t,r,null)[0]:e):e}var v=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(e,t,r){var a=this;return Object(i.a)((function*(){!e||!e.length||!t||!r||Object(s.c)(t,r);var i={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return a._jobs.push(i),new Promise((e=>{i.resolve=e,null===a._timer&&(a._timer=setTimeout(a._process,10))}))}))()}_process(){this._timer=null;var e=this._jobs.shift();if(e){var{geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:u}=e;Object(a.a)(r,i)?Object(s.m)(i)?u(t.map(p)):u(t.map(g)):u(Object(n.m)(o.a,t,r,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}};function y(e,t,r){return b.apply(this,arguments)}function b(){return(b=Object(i.a)((function*(e,t,r){return v.push(e,t,r)}))).apply(this,arguments)}},403:function(e,t,r){"use strict";var i=r(213);t.a=class{constructor(e,t){this._storage=new i.b,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},405:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t){this._mask=0,this._buf=e,this._mask=t}static fromBuffer(e,t){return new i(e,t)}static create(e,t=4294967295){var r=new Uint32Array(Math.ceil(e/32));return new i(r,t)}_getIndex(e){return Math.floor(e/32)}has(e){var t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){for(var r=e,i=t;r%32&&r!==i;){if(this.has(r))return!0;r++}for(;i%32&&r!==i;){if(this.has(r))return!0;i--}if(r===i)return!1;for(var s=r/32;s!==i/32;s++)if(this._buf[s])return!0;return!1}set(e){var t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]|=i}setRange(e,t){for(var r=e,i=t;r%32&&r!==i;)this.set(r++);for(;i%32&&r!==i;)this.set(i--);if(r!==i)for(var s=r/32;s!==i/32;s++)this._buf[s]=4294967295}unset(e){var t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]&=4294967295^i}resize(e){var t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(var t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(var t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(var t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(var t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(var t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(var t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(var e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(var t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new i(this._buf.slice(),this._mask)}clear(){for(var e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(var t=0;t<this._buf.length;t++){var r=this._buf[t],i=32*t;if(r)for(;r;)1&r&&e(i),r>>>=1,i++}}countSet(){var e=0;return this.forEachSet((t=>{e++})),e}}},406:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(81),s=r(93),a=r(127),n=r(151),o=i.a.getLogger("esri.views.2d.engine.webgl");function u(e){return Object(n.o)(e.minDataValue)&&Object(n.o)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.e.SIZE_UNIT_VALUE:(o.error(new s.a("mapview-bad-type","Found invalid size VisualVariable",e)),a.e.NONE)}},407:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));r(80);var i=r(89),s=r(100),a=(r(101),r(178)),n=r(168),o=r(469),u=r(405),l=0;class c{constructor(e){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._deleted=null,this._joined=[],this.instance=e}static createInstance(){return l=++l>65535?0:l}get isEmpty(){return Object(i.k)(this._deleted)&&this._deleted.countSet()===this.getApproximateSize()}get _hasFilter(){return-1!==this._xmin}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,i){var s=this.copy();return s._tx+=e,s._ty+=t,s._sx*=r,s._sy*=i,s}extent(e,t,r,i){var s=this.copy();return s._xmin=e,s._xmax=r,s._ymin=t,s._ymax=i,s}hasFilter(){return this._hasFilter}readAttribute(e,t=!1){var r=this._readAttribute(e,t);if(void 0!==r)return r;for(var i of this._joined){i.setIndex(this.getIndex());var s=i._readAttribute(e,t);if(void 0!==s)return s}}readAttributes(){return this._readAttributes()}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){var e=this.readHydratedGeometry(),t=Object(n.k)(e,this.geometryType,this.hasZ,this.hasM),r=Object(s.a)(t);return r.spatialReference=this._arcadeSpatialReference,r}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}removeAtIndex(e){Object(i.j)(this._deleted)&&(this._deleted=u.a.create(this.getApproximateSize())),this._deleted.set(e)}_getExists(){return Object(i.j)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;var e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;var t=Object(i.r)(this.getQuantizationTransform(),null);return Object(o.a)(new a.a,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._xmin=this._xmin,e._xmax=this._xmax,e._ymin=this._ymin,e._ymax=this._ymax}}},420:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(497);function s(e,t){if(!(this instanceof s))return new s(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function a(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function n(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,i,s){s||(s=v(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,n=t;n<r;n++)a=e.children[n],u(s,e.leaf?i(a):a);return s}function u(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,s-r)*Math.max(0,a-i)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function y(e,t,r,s,a){for(var n,o=[t,r];o.length;)(r=o.pop())-(t=o.pop())<=s||(n=t+Math.ceil((r-t)/s/2)*s,Object(i.a)(e,n,t,r,a),o.push(t,n,n,r))}s.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],i=this.toBBox;if(!m(e,t))return r;for(var s,a,n,o,u=[];t;){for(s=0,a=t.children.length;s<a;s++)n=t.children[s],m(e,o=t.leaf?i(n):n)&&(t.leaf?r.push(n):g(e,o)?this._all(n,r):u.push(n));t=u.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!m(e,t))return!1;for(var i,s,a,n,o=[];t;){for(i=0,s=t.children.length;i<s;i++)if(a=t.children[i],m(e,n=t.leaf?r(a):a)){if(t.leaf||g(e,n))return!0;o.push(a)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=v([]),this},remove:function(e,t){if(!e)return this;for(var r,i,s,n,o=this.data,u=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),i=l[l.length-1],r=c.pop(),n=!0),o.leaf&&-1!==(s=a(e,o.children,t)))return o.children.splice(s,1),l.push(o),this._condense(l),this;n||o.leaf||!g(o,u)?i?(r++,o=i.children[r],n=!1):o=null:(l.push(o),c.push(r),r=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,i){var s,a=r-t+1,o=this._maxEntries;if(a<=o)return n(s=v(e.slice(t,r+1)),this.toBBox),s;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(s=v([])).leaf=!1,s.height=i;var u,l,c,h,d=Math.ceil(a/o),f=d*Math.ceil(Math.sqrt(o));for(y(e,t,r,f,this.compareMinX),u=t;u<=r;u+=f)for(y(e,u,c=Math.min(u+f-1,r),d,this.compareMinY),l=u;l<=c;l+=d)h=Math.min(l+d-1,c),s.children.push(this._build(e,l,h,i-1));return n(s,this.toBBox),s},_chooseSubtree:function(e,t,r,i){for(var s,a,n,o,u,l,c,d;i.push(t),!t.leaf&&i.length-1!==r;){for(c=d=1/0,s=0,a=t.children.length;s<a;s++)u=h(n=t.children[s]),(l=f(e,n)-u)<d?(d=l,c=u<c?u:c,o=n):l===d&&u<c&&(c=u,o=n);t=o||t.children[0]}return t},_insert:function(e,t,r){var i=this.toBBox,s=r?e:i(e),a=[],n=this._chooseSubtree(s,this.data,t,a);for(n.children.push(e),u(n,s);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(s,a,t)},_split:function(e,t){var r=e[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);var a=this._chooseSplitIndex(r,s,i),o=v(r.children.splice(a,r.children.length-a));o.height=r.height,o.leaf=r.leaf,n(r,this.toBBox),n(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(e,t){this.data=v([e,t]),this.data.height=e.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var i,s,a,n,u,l,c,d;for(l=c=1/0,i=t;i<=r-t;i++)n=p(s=o(e,0,i,this.toBBox),a=o(e,i,r,this.toBBox)),u=h(s)+h(a),n<l?(l=n,d=i,c=u<c?u:c):n===l&&u<c&&(c=u,d=i);return d},_chooseSplitAxis:function(e,t,r){var i=e.leaf?this.compareMinX:l,s=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,s)&&e.children.sort(i)},_allDistMargin:function(e,t,r,i){e.children.sort(i);var s,a,n=this.toBBox,l=o(e,0,t,n),c=o(e,r-t,r,n),h=d(l)+d(c);for(s=t;s<r-t;s++)a=e.children[s],u(l,e.leaf?n(a):a),h+=d(l);for(s=r-t-1;s>=t;s--)a=e.children[s],u(c,e.leaf?n(a):a),h+=d(c);return h},_adjustParentBBoxes:function(e,t,r){for(var i=r;i>=0;i--)u(t[i],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():n(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},428:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var i=new s(e.getPointX(t),e.getPointY(t),r),a=e.hasZ(t),n=e.hasM(t);return a&&(i.z=e.getPointZ(t)),n&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new n(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var i=e.hasZ(t),s=e.hasM(t),a=new u(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){var n=e.getZExtent(t);a.zmin=n.vmin,a.zmax=n.vmax}if(s){var o=e.getMExtent(t);a.mmin=o.vmin,a.mmax=o.vmax}return a}};class s{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class a{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class n{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class u{constructor(e,t,r,i,s){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},429:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));var i=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),s=!1},430:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(315),s=r(103),a=r(125),n=r(250),o=r(245);class u{constructor(e,t){this.key=new o.a(0,0,0,0),this.bounds=Object(a.i)(),this.objectIds=new Set,this.key.set(t);var r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return s.a.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){var e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new u(this.tileInfoView,this.key)}createChildTiles(){for(var e=this.key.getChildKeys(),t=i.a.acquire(),r=0;r<e.length;r++)t[r]=new u(this.tileInfoView,e[r]);return t}getQuantizationParameters(){return n.a.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}},459:function(e,t,r){"use strict";var i=r(89);t.a=class{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0!==this.length){var e=this.peek();return this._items.delete(Object(i.d)(e)),e}}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}},460:function(e,t,r){"use strict";var i,s=r(82),a=(r(80),r(81),r(88)),n=r(85),o=r(84),u=(r(83),r(86),r(87),r(90)),l=i=class extends u.a{constructor(e){super(e),this.level=0,this.levelValue=null,this.resolution=0,this.scale=0}clone(){return new i({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})}};Object(s.a)([Object(n.b)({type:a.a,json:{write:!0}})],l.prototype,"level",void 0),Object(s.a)([Object(n.b)({type:String,json:{write:!0}})],l.prototype,"levelValue",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],l.prototype,"resolution",void 0),Object(s.a)([Object(n.b)({type:Number,json:{write:!0}})],l.prototype,"scale",void 0);var c=l=i=Object(s.a)([Object(o.a)("esri.layers.support.LOD")],l);t.a=c},469:function(e,t,r){"use strict";function i(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,o){if(!t||!t.lengths.length)return null;var u="upperLeft"===(null==o?void 0:o.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var l=e.coords,c=[],h=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=t,p=i(r,s),g=0;for(var m of d){var v=a(h,f,g,m,r,s,u);v&&c.push(v),g+=m*p}if(c.sort(((e,t)=>{var i=u*e[2]-u*t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),c.length){var y=6*c[0][2];l[0]=c[0][0]/y,l[1]=c[0][1]/y,r&&(y=6*c[0][4],l[2]=0!==y?c[0][3]/y:0),(l[0]<h[0]||l[0]>h[1]||l[1]<h[2]||l[1]>h[3]||r&&(l[2]<h[4]||l[2]>h[5]))&&(l.length=0)}if(!l.length){var b=t.lengths[0]?n(f,0,d[0],r,s):null;if(!b)return null;l[0]=b[0],l[1]=b[1],r&&b.length>2&&(l[2]=b[2])}return e}function a(e,t,r,s,a,n,o=1){for(var u=i(a,n),l=r,c=r+u,h=0,d=0,f=0,p=0,g=0,m=0,v=s-1;m<v;m++,l+=u,c+=u){var y=t[l],b=t[l+1],_=t[l+2],O=t[c],j=t[c+1],x=t[c+2],w=y*j-O*b;p+=w,h+=(y+O)*w,d+=(b+j)*w,a&&(f+=(_+x)*(w=y*x-O*_),g+=w),y<e[0]&&(e[0]=y),y>e[1]&&(e[1]=y),b<e[2]&&(e[2]=b),b>e[3]&&(e[3]=b),a&&(_<e[4]&&(e[4]=_),_>e[5]&&(e[5]=_))}if(p*o>0&&(p*=-1),g*o>0&&(g*=-1),!p)return null;var I=[h,d,.5*p];return a&&(I[3]=f,I[4]=.5*g),I}function n(e,t,r,s,a){for(var n=i(s,a),h=t,d=t+n,f=0,p=0,g=0,m=0,v=0,y=r-1;v<y;v++,h+=n,d+=n){var b=e[h],_=e[h+1],O=e[h+2],j=e[d],x=e[d+1],w=e[d+2],I=s?u(b,_,O,j,x,w):o(b,_,j,x);if(I)if(f+=I,s){var S=c(b,_,O,j,x,w);p+=I*S[0],g+=I*S[1],m+=I*S[2]}else{var T=l(b,_,j,x);p+=I*T[0],g+=I*T[1]}}return f>0?s?[p/f,g/f,m/f]:[p/f,g/f]:r>0?s?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,i){var s=r-e,a=i-t;return Math.sqrt(s*s+a*a)}function u(e,t,r,i,s,a){var n=i-e,o=s-t,u=a-r;return Math.sqrt(n*n+o*o+u*u)}function l(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function c(e,t,r,i,s,a){return[e+.5*(i-e),t+.5*(s-t),r+.5*(a-r)]}r.d(t,"a",(function(){return s}))},496:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(89),s=r(168),a=r(407);class n extends a.a{constructor(e,t,r){super(e),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=t}static fromFeatures(e,t,r){for(var i=Object(s.c)([],e,t,!1,!1,r),a=0;a<i.length;a++)i[a].displayId=e[a].displayId;return n.fromOptimizedFeatures(i,t)}static fromFeatureSet(e,t){var r=Object(s.b)(e,t);return n.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(e){var{features:t,geometryType:r}=e,i=n.fromOptimizedFeatures(t,r);for(var s of(i._exceededTransferLimit=e.exceededTransferLimit,i._transform=e.transform,e.fields))"esriFieldTypeDate"===s.type&&i._dateFields.add(s.name);return i}static fromOptimizedFeatures(e,t,r){var i=a.a.createInstance(),s=new n(i,e,t);return s._transform=r,s}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){var e="";for(var t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}getGroupId(){return this._current.groupId}setGroupId(e){this._current.groupId=e}copy(){var e=new n(this.instance,this._features,this.geometryType);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._passesFilter()&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(s.i)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){var e=this.readGeometry();return Object(s.k)(e,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){var e=this.readCentroid();return e?{x:e.coords[0]*this._sx+this._tx,y:e.coords[1]*this._sy+this._ty}:null}readGeometryArea(){return Object(s.s)(this._current.geometry,2)}readUnquantizedGeometry(){var e=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!e)return e;var t=e.clone();return function({coords:e,lengths:t}){var r=0;for(var i of t){for(var s=1;s<i;s++)e[2*(r+s)]+=e[2*(r+s)-2],e[2*(r+s)+1]+=e[2*(r+s)-1];r+=i}}(t),t}readHydratedGeometry(){var e=this._current.geometry;if(!e)return null;var t=e.clone();return Object(i.k)(this._transform)&&Object(s.z)(t,t,this.hasZ,this.hasM,this._transform),t}getXHydrate(){var e=this._current.geometry.coords[0],t=this.getQuantizationTransform();return Object(i.j)(t)?e:e*t.scale[0]+t.translate[0]}getYHydrate(){var e=this._current.geometry.coords[1],t=this.getQuantizationTransform();return Object(i.j)(t)?e:t.translate[1]-e*t.scale[1]}getX(){return this._current.geometry.coords[0]*this._sx+this._tx}getY(){return this._current.geometry.coords[1]*this._sy+this._ty}readGeometry(){if(!this._current.hasGeometry)return null;var e=this._current.geometry.clone();if(e.isPoint)return e.coords[0]=e.coords[0]*this._sx+this._tx,e.coords[1]=e.coords[1]*this._sy+this._ty,e;var t=0;for(var r of e.lengths)e.coords[2*t]=e.coords[2*t]*this._sx+this._tx,e.coords[2*t+1]=e.coords[2*t+1]*this._sy+this._ty,t+=r;return e}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){var e=this._computeCentroid();if(!e)return null;e.coords[0]=(e.coords[0]-this._tx)/this._sx,e.coords[1]=(e.coords[1]-this._ty)/this._sy,this._current.centroid=e}var t=this._current.centroid.clone();return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sx+this._ty,t}_readAttribute(e,t){var r=this._current.attributes[e];if(void 0!==r)return null!=r&&t&&this._dateFields.has(e)?new Date(r):r;var i=this.readAttributes(),s=e.toLocaleLowerCase().trim();for(var a in i)if(a.toLocaleLowerCase().trim()===s){var n=this._current.attributes[a];return null!=n&&t&&this._dateFields.has(a)?new Date(n):n}}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;var e=0,t=0;switch(this.geometryType){case"esriGeometryPoint":var r=this._current.geometry;if(!r)return!1;[e,t]=r.coords;break;case"esriGeometryPolygon":var i=this.readCentroid();if(!i)return!1;[e,t]=i.coords,e-=this._tx,t-=this._ty;break;default:return!1}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}}},497:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(133),s=Object(i.b)((function(e){var t;void 0!==(t=function(){function e(r,i,s,a,n){for(;a>s;){if(a-s>600){var o=a-s+1,u=i-s+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(u-o/2<0?-1:1);e(r,i,Math.max(s,Math.floor(i-u*c/o+h)),Math.min(a,Math.floor(i+(o-u)*c/o+h)),n)}var d=r[i],f=s,p=a;for(t(r,s,i),n(r[a],d)>0&&t(r,s,a);f<p;){for(t(r,f,p),f++,p--;n(r[f],d)<0;)f++;for(;n(r[p],d)>0;)p--}0===n(r[s],d)?t(r,s,p):t(r,++p,a),p<=i&&(s=p+1),i<=p&&(a=p-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,s,a,n){e(t,i,s||0,a||t.length-1,n||r)}}())&&(e.exports=t)}))},508:function(e,t,r){"use strict";var i=r(112),s=r(245);function a(e,t){return[e,t]}function n(e,t,r){return e[0]=t,e[1]=r,e}var o=new s.a("0/0/0/0");class u{constructor(e,t,r,i,s,a,n,o,u,l,c,h){this.level=e,this.resolution=t,this.scale=r,this.origin=i,this.first=s,this.last=a,this.size=n,this.norm=o,this.worldStart=u,this.worldEnd=l,this.worldSize=c,this.wrap=h}static create(e,t,r){var s,o,l,c,h=Object(i.d)(e.spatialReference),d=a(e.origin.x,e.origin.y),f=a(e.size[0]*t.resolution,e.size[1]*t.resolution),p=a(-1/0,-1/0),g=a(1/0,1/0),m=a(1/0,1/0);return r&&(n(p,Math.max(0,Math.floor((r.xmin-d[0])/f[0])),Math.max(0,Math.floor((d[1]-r.ymax)/f[1]))),n(g,Math.max(0,Math.floor((r.xmax-d[0])/f[0])),Math.max(0,Math.floor((d[1]-r.ymin)/f[1]))),n(m,g[0]-p[0]+1,g[1]-p[1]+1)),e.isWrappable?(s=a(Math.ceil(Math.round((h.valid[1]-h.valid[0])/t.resolution)/e.size[0]),m[1]),o=a(Math.floor((h.origin[0]-d[0])/f[0]),p[1]),l=a(s[0]+o[0]-1,g[1]),c=!0):(o=p,l=g,s=m,c=!1),new u(t.level,t.resolution,t.scale,d,p,g,m,f,o,l,s,c)}normalizeCol(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,r=!1){o.set(t);var i=r?o.col:this.denormalizeCol(o.col,o.world),s=o.row;return function(e,t,r,i,s){e[0]=t,e[1]=r,e[2]=i,e[3]=s}(e,this.getXForColumn(i),this.getYForRow(s+1),this.getXForColumn(i+1),this.getYForRow(s)),e}getTileCoords(e,t,r=!1){o.set(t);var i=r?o.col:this.denormalizeCol(o.col,o.world);return Array.isArray(e)?n(e,this.getXForColumn(i),this.getYForRow(o.row)):(e.x=this.getXForColumn(i),e.y=this.getYForRow(o.row)),e}}var l=u,c=r(513);var h=class{constructor(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}},d=new s.a("0/0/0/0");class f{constructor(e,t,r,i,s,a,n,o){this.x=e,this.ymin=t,this.ymax=r,this.invM=i,this.leftAdjust=s,this.rightAdjust=a,this.leftBound=n,this.rightBound=o}static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);var[r,i]=e,[s,a]=t,n=s-r,o=a-i,u=0!==o?n/o:0,l=(Math.ceil(i)-i)*u,c=(Math.floor(i)-i)*u;return new f(r,Math.floor(i),Math.ceil(a),u,n<0?l:c,n<0?c:l,n<0?s:r,n<0?r:s)}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}var p=[[0,0],[0,0],[0,0],[0,0]];t.a=class{constructor(e,t){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var r=e.lods.slice();r.sort((function(e,t){return t.scale-e.scale}));var i=this._lodInfos=r.map((r=>l.create(e,r,t)));r.forEach(((e,t)=>{this._infoByLevel[e.level]=i[t],this._infoByScale[e.scale]=i[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,r=!1){d.set(t);var i=this._infoByLevel[d.level];return i?i.getTileBounds(e,d,r):e}getTileCoords(e,t,r=!1){d.set(t);var i=this._infoByLevel[d.level];return i?i.getTileCoords(e,d,r):e}getTileCoverage(e,t=192,r="closest"){var i,s,a,n="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),o=c.a.pool.acquire(n),u=this._wrap,l=1/0,d=-1/0,g=o.spans;for(var m of(p[0][0]=p[0][1]=p[1][1]=p[3][0]=-t,p[1][0]=p[2][0]=e.size[0]+t,p[2][1]=p[3][1]=e.size[1]+t,p))e.toMap(m,m),m[0]=n.getColumnForX(m[0]),m[1]=n.getRowForY(m[1]);for(var v=[],y=3,b=0;b<4;b++)if(p[b][1]!==p[y][1]){var _=f.create(p[b],p[y]);l=Math.min(_.ymin,l),d=Math.max(_.ymax,d),void 0===v[_.ymin]&&(v[_.ymin]=[]),v[_.ymin].push(_),y=b}else y=b;if(null==l||null==d||d-l>100)return null;var O=[];for(i=l;i<d;){null!=v[i]&&(O=O.concat(v[i])),s=1/0,a=-1/0;for(var j=O.length-1;j>=0;j--){var x=O[j];s=Math.min(s,x.getLeftCol()),a=Math.max(a,x.getRightCol())}if(s=Math.floor(s),a=Math.floor(a),i>=n.first[1]&&i<=n.last[1])if(u)if(n.size[0]<n.worldSize[0])for(var w=Math.floor(a/n.worldSize[0]),I=Math.floor(s/n.worldSize[0]);I<=w;I++)g.push(new h(i,Math.max(n.getFirstColumnForWorld(I),s),Math.min(n.getLastColumnForWorld(I),a)));else g.push(new h(i,s,a));else s>n.last[0]||a<n.first[0]||(s=Math.max(s,n.first[0]),a=Math.min(a,n.last[0]),g.push(new h(i,s,a)));i+=1;for(var S=O.length-1;S>=0;S--){var T=O[S];T.ymax>=i?T.incrRow():O.splice(S,1)}}return o}getTileParentId(e){d.set(e);var t=this._infoByLevel[d.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(d,this._lodInfos[r],d),d.id)}getTileResolution(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){var t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){d.set(t);var r=this._infoByLevel[d.level],i=e.lodInfo;if(i.resolution>r.resolution){this._getTileIdAtLOD(d,i,d);var s=i.denormalizeCol(d.col,d.world);for(var a of e.spans)if(a.row===d.row&&a.colFrom<=s&&a.colTo>=s)return!0}if(i.resolution<r.resolution){var[n,o,u,l]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),c=r.denormalizeCol(d.col,d.world),h=i.getColumnForX(r.getXForColumn(c)),f=i.getRowForY(r.getYForRow(d.row)),p=i.getColumnForX(r.getXForColumn(c+1))-1,g=i.getRowForY(r.getYForRow(d.row+1))-1;return!(h>l||p<u||f>o||g<n)}var m=i.denormalizeCol(d.col,d.world);return e.spans.some((e=>e.row===d.row&&e.colFrom<=m&&e.colTo>=m))}normalizeBounds(e,t,r){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var s=Object(i.d)(this.tileInfo.spatialReference),a=-r*(s.valid[1]-s.valid[0]);e[0]+=a,e[2]+=a}return e}getSmallestInfoForScale(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(var r=1;r<t.length-1;r++)if(e>t[r]+1e-6)return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){var t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t),t[0])),this._infoByScale[e]}scaleToLevel(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var r=t.length-1;r>=0;r--)if(e<t[r])return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,t,r){var i=this._infoByLevel[r.level];return e.set(r),t.resolution<i.resolution?null:(t.resolution===i.resolution||(e.level=t.level,e.col=Math.floor(r.col*i.resolution/t.resolution+.01),e.row=Math.floor(r.row*i.resolution/t.resolution+.01)),e)}}},513:function(e,t,r){"use strict";var i=r(221);class s{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,t){var{spans:r,lodInfo:i}=this,{level:s}=i;if(0!==r.length)for(var{row:a,colFrom:n,colTo:o}of r)for(var u=n;u<=o;u++)e.call(t,s,a,i.normalizeCol(u),i.getWorldForColumn(u))}}s.pool=new i.a(s),t.a=s},520:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return c}));var i=r(91),s=r(89),a=r(105),n=r(122),o=r(127),u=r(187),l=r(406);function c(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function h(e){return e.map((e=>function(e){return{value:e.value,size:Object(a.k)(e.size)}}(e)))}function d(e){if("string"==typeof e||"number"==typeof e)return Object(a.k)(e);var t=e;return{type:"size",expression:t.expression,stops:h(t.stops)}}var f=e=>{for(var t=[],r=[],i=h(e),s=i.length,o=0;o<6;o++){var u=i[Math.min(o,s-1)];t.push(u.value),r.push(null==u.size?n.n:Object(a.h)(u.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function p(e){var t=e&&e.length>0?{}:null,r=t?{}:null;if(!t)return{vvFields:t,vvRanges:r};for(var s of e)if(s.field&&(t[s.type]=s.field),"size"===s.type){r.size||(r.size={});var a=s;switch(Object(l.a)(a)){case o.e.SIZE_MINMAX_VALUE:r.size.minMaxValue={minDataValue:a.minDataValue,maxDataValue:a.maxDataValue,minSize:d(a.minSize),maxSize:d(a.maxSize)};break;case o.e.SIZE_SCALE_STOPS:r.size.scaleStops={stops:h(a.stops)};break;case o.e.SIZE_FIELD_STOPS:if(a.levels){var n={};for(var u in a.levels)n[u]=f(a.levels[u]);r.size.fieldStops={type:"level-dependent",levels:n}}else r.size.fieldStops=Object(i.a)({type:"static"},f(a.stops));break;case o.e.SIZE_UNIT_VALUE:r.size.unitValue={unit:a.valueUnit,valueRepresentation:a.valueRepresentation}}}else if("color"===s.type)r.color=v(s);else if("opacity"===s.type)r.opacity=g(s);else if("rotation"===s.type){var c=s;r.rotation={type:c.rotationType}}return{vvFields:t,vvRanges:r}}function g(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,i=0;i<8;++i){var s=r[Math.min(i,r.length-1)];t.values[i]=s.value,t.opacities[i]=s.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var a=e.stops&&e.stops.length>=0&&e.stops[0].opacity,n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=a}return t}function m(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function v(e){if(Object(s.j)(e))return null;if(e.normalizationField)return null;var t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;t.field=e.field;for(var r=e.stops,i=0;i<8;++i){var a=r[Math.min(i,r.length-1)];t.values[i]=a.value,m(t.colors,i,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var n=e.stops&&e.stops.length>=0&&e.stops[0].color,o=0;o<8;o++)t.values[o]=1/0,m(t.colors,o,n)}for(var l=0;l<32;l+=4)Object(u.b)(t.colors,l,!0);return t}},555:function(e,t,r){"use strict";var i=r(80),s=r(131),a=r(245),n=r(513),o=r(430),u=r(420),l={added:[],removed:[]},c=new Set,h=new a.a(0,0,0,0);class d extends s.a{constructor(e){super(),this._tiles=new Map,this._index=Object(u.a)(9,Object(i.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}minLOD(){return Math.min(...this.tiles.map((e=>e.level)))}intersections(e,t){var r="string"==typeof e?this.get(e):e;if(!r)return[];var i=t*r.resolution,s=r.bounds[0]-i,a=r.bounds[1]-i,n=r.bounds[2]+i,o=r.bounds[3]+i,u=[];for(var l of this._index.search({minX:s,minY:a,maxX:n,maxY:o})){var c=l.bounds.slice();c[0]=Math.max(c[0],s),c[1]=Math.max(c[1],a),c[2]=Math.min(c[2],n),c[3]=Math.min(c[3],o),c[2]-c[0]>0&&c[3]-c[1]>0&&u.push({bounds:c,tile:l})}return u}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){var t={added:[],removed:[]};for(var r of e.added)if(!this.has(r)){var i=new o.a(this.tileScheme,r);this._tiles.set(r,i),this._index.insert(i),t.added.push(i)}for(var s of e.removed)if(this.has(s)){var a=this.get(s);this._tiles.delete(s),this._index.remove(a),t.removed.push(a)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){var t=this.tileScheme.getTileCoverage(e,0);if(t){var{spans:r,lodInfo:i}=t,{level:s}=i;if(r.length>0)for(var{row:a,colFrom:u,colTo:d}of r)for(var f=u;f<=d;f++){var p=h.set(s,a,i.normalizeCol(f),i.getWorldForColumn(f)).id;if(c.add(p),!this.has(p)){var g=new o.a(this.tileScheme,p);this._tiles.set(p,g),this._index.insert(g),this.tiles.push(g),l.added.push(g)}}for(var m=this.tiles.length-1;m>=0;m--){var v=this.tiles[m];c.has(v.id)||(this._tiles.delete(v.id),this.tiles.splice(m,1),this._index.remove(v),l.removed.push(v))}(l.added.length||l.removed.length)&&this.emit("update",l),n.a.pool.release(t),c.clear(),l.added.length=0,l.removed.length=0}}}t.a=d},563:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(405),s=2147483648;class a{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function(e,t){return((t?s:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}function n(e,t,r){if(!(e.length>t))for(;e.length<=t;)e.push(r)}var o=2147483647;class u{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new a,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){var e=this._bitsets.length;return this._bitsets.push(i.a.create(this._allocatedSize,o)),e+1}getBitset(e){return this._bitsets[e-1]}_expand(){for(var e of(this._allocatedSize<<=1,this._bitsets))e.resize(this._allocatedSize)}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),n(this._numerics[e],t,0)}_ensureInstanceId(e){n(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),n(this._strings[e],t,null)}createDisplayId(e=!1){var t=this._idGenerator.createId();return t>this._allocatedSize&&this._expand(),((e,t)=>((t?2147483648:0)|e)>>>0)(t,e)}releaseDisplayId(e){for(var t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(e&o)}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(e&o,0)}setComputedNumeric(e,t,r){return this.setComputedNumericAtIndex(e&o,r,0)}getComputedString(e,t){return this.getComputedStringAtIndex(e&o,0)}setComputedString(e,t,r){return this.setComputedStringAtIndex(e&o,0,r)}getComputedNumericAtIndex(e,t){var r=e&o;return this._ensureNumeric(t,r),this._numerics[t][r]}setComputedNumericAtIndex(e,t,r){var i=e&o;this._ensureNumeric(t,i),this._numerics[t][i]=r}getInstanceId(e){var t=e&o;return this._ensureInstanceId(t),this._instanceIds[t]}setInstanceId(e,t){var r=e&o;this._ensureInstanceId(r),this._instanceIds[r]=t}getComputedStringAtIndex(e,t){var r=e&o;return this._ensureString(t,r),this._strings[t][r]}setComputedStringAtIndex(e,t,r){var i=e&o;this._ensureString(t,i),this._strings[t][i]=r}getXMin(e){return this._bounds[4*(e&o)]}getYMin(e){return this._bounds[4*(e&o)+1]}getXMax(e){return this._bounds[4*(e&o)+2]}getYMax(e){return this._bounds[4*(e&o)+3]}setBounds(e,t){var r=t.readHydratedGeometry();if(!r||!r.coords.length)return!1;var i=1/0,s=1/0,a=-1/0,u=-1/0;r.forEachVertex(((e,t)=>{i=Math.min(i,e),s=Math.min(s,t),a=Math.max(a,e),u=Math.max(u,t)}));var l=e&o;return n(this._bounds,4*l+4,0),this._bounds[4*l]=i,this._bounds[4*l+1]=s,this._bounds[4*l+2]=a,this._bounds[4*l+3]=u,!0}}},666:function(e,t,r){"use strict";var i=r(89);t.a=class{constructor(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}dequeue(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}find(e){if(0===this.size)return null;for(var t of this._buffer)if(Object(i.k)(t)&&e(t))return t;return null}clear(e){for(var t=this.dequeue();Object(i.k)(t);)e&&e(t),t=this.dequeue()}}},668:function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return k})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return j})),r.d(t,"e",(function(){return w})),r.d(t,"f",(function(){return _}));var i=r(7),s=r(89),a=r(95),n=r(112),o=r(371),u=r(100),l=r(117),c=r(236),h=r(178),d=r(168),f=(r(469),r(400)),p=new a.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),g=Object.freeze({}),m=new h.a,v=new h.a,y=new h.a,b={esriGeometryPoint:d.m,esriGeometryPolyline:d.o,esriGeometryPolygon:d.n,esriGeometryMultipoint:d.l};function _(e,t,r,i=e.hasZ,s=e.hasM){var a=e.hasZ&&i,n=e.hasM&&s;if(r){var o=Object(d.u)(y,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,s);return Object(d.m)(o,a,n)}return Object(d.m)(t,a,n)}function O(e,t,r,i,s,a,n=t,o=r){var u=t&&n,l=r&&o,c=i?"coords"in i?i:i.geometry:null;if(!c)return null;if(s){var h=Object(d.q)(v,c,t,r,e,s,n,o);return a&&(h=Object(d.u)(y,h,u,l,e,a)),b[e](h,u,l)}if(a){var f=Object(d.u)(y,c,t,r,e,a,n,o);return b[e](f,u,l)}return Object(d.x)(m,c,t,r,n,o),b[e](m,u,l)}function j(e,t,r){return x.apply(this,arguments)}function x(){return(x=Object(i.a)((function*(e,t,r){var{outFields:i,orderByFields:s,groupByFieldsForStatistics:a,outStatistics:n}=e;if(i)for(var o=0;o<i.length;o++)i[o]=i[o].trim();if(s)for(var u=0;u<s.length;u++)s[u]=s[u].trim();if(a)for(var l=0;l<a.length;l++)a[l]=a[l].trim();if(n)for(var c=0;c<n.length;c++)n[c].onStatisticField&&(n[c].onStatisticField=n[c].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),w(e,t,r)}))).apply(this,arguments)}function w(e,t,r){return I.apply(this,arguments)}function I(){return(I=Object(i.a)((function*(e,t,r){if(!e)return null;var{where:i}=e;if(e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||t&&t===i)&&(e.where=null),!e.geometry)return e;var a=yield S(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){var{spatialReference:n}=e.geometry;(a=Object(o.a)(a)).spatialReference=n}e.geometry=a,yield Object(f.a)(a.spatialReference,r);var l=(yield Object(c.a)(Object(u.a)(a)))[0];if(Object(s.j)(l))throw g;var h=l.toJSON(),d=yield Object(f.b)(h,h.spatialReference,r);if(!d)throw g;return d.spatialReference=r,e.geometry=d,e}))).apply(this,arguments)}function S(e){return T.apply(this,arguments)}function T(){return(T=Object(i.a)((function*(e){var{geometry:t,distance:r,units:i}=e;if(null==r||"vertexAttributes"in t)return t;var s=t.spatialReference,a=i?p.fromJSON(i):Object(l.h)(s),o=s&&(Object(n.f)(s)||Object(n.m)(s))?t:yield Object(f.a)(s,n.a).then((()=>Object(f.b)(t,n.a)));return(yield F())(o.spatialReference,o,r,a)}))).apply(this,arguments)}function F(){return M.apply(this,arguments)}function M(){return(M=Object(i.a)((function*(){return(yield Promise.all([r.e(9),r.e(28)]).then(r.bind(null,788))).geodesicBuffer}))).apply(this,arguments)}function k(e){return e&&C in e?JSON.parse(JSON.stringify(e,R)):e}var C="_geVersion",R=(e,t)=>e!==C?t:void 0},711:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(89),s=r(94),a=r(241),n=r(459);class o{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class u{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new n.a(e.peeker),this.process=e.process;var t=e.scheduler;e.task&&Object(i.k)(t)&&(this._task=t.registerTask(e.task,(e=>this.update(e)),(()=>this.needsUpdate())))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){var t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();var e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,r)=>e(r)))}get(e){var t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,t){var r=this.get(e);if(r)return r;var a=Object(s.d)(),n=null;t&&(n=Object(s.p)(t,(()=>a.abort())));var o=()=>{u.remove(),Object(i.k)(n)&&n.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},u=Object(s.q)(a.signal,(()=>{var t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject(Object(s.e)())})),l=Object(s.f)();return this._deferreds.set(e,l),this._controllers.set(e,a),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}reset(){var e=[];for(var t of(this._processingItems.forEach((t=>e.push(t))),this._processingItems.clear(),e))this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){for(var e=[];this._queue.length;)e.push(this._queue.pop());return this.clear(),e}needsUpdate(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}update(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=Object(a.b)((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(!Object(i.j)(e)){var t,r=Object(s.d)(),a=new o(e,r);this._processingItems.set(e,a);try{t=this.process(e,r.signal)}catch(n){this._processError(a,n)}Object(s.o)(t)?(a.promise=t,t.then((e=>this._processResult(a,e)),(e=>this._processError(a,e)))):this._processResult(a,t)}}get test(){return{update:e=>this.update(e)}}}},755:function(e,t,r){"use strict";function i(e,t){if(!e)return null;var r=t.featureAdapter,{startTimeField:i,endTimeField:s}=e,a=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;if(i&&s)t.forEach((e=>{var t=r.getAttribute(e,i),o=r.getAttribute(e,s);null==t||isNaN(t)||(a=Math.min(a,t)),null==o||isNaN(o)||(n=Math.max(n,o))}));else{var o=i||s;t.forEach((e=>{var t=r.getAttribute(e,o);null==t||isNaN(t)||(a=Math.min(a,t),n=Math.max(n,t))}))}return{start:a,end:n}}function s(e,t,r){if(!t||!e)return null;var{startTimeField:i,endTimeField:s}=e;if(!i&&!s)return null;var{start:a,end:n}=t;return null===a&&null===n?null:void 0===a&&void 0===n?()=>!1:i&&s?function(e,t,r,i,s){return null!=i&&null!=s?a=>{var n=e.getAttribute(a,t),o=e.getAttribute(a,r);return(null==n||n<=s)&&(null==o||o>=i)}:null!=i?t=>{var s=e.getAttribute(t,r);return null==s||s>=i}:null!=s?r=>{var i=e.getAttribute(r,t);return null==i||i<=s}:void 0}(r,i,s,a,n):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e.getAttribute(i,t)===r:null!=r&&null!=i?s=>{var a=e.getAttribute(s,t);return a>=r&&a<=i}:null!=r?i=>e.getAttribute(i,t)>=r:null!=i?r=>e.getAttribute(r,t)<=i:void 0}(r,i||s,a,n)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s}))},766:function(e,t,r){"use strict";var i=r(91),s=r(7),a=r(92),n=r(89),o=r(93),u=r(112),l=r(210),c=r(100),h=r(117),d=r(125),f=r(323),p=r(236),g=r(213),m=r(207),v=r(837),y=r(279),b=r(400),_=r(403),O=r(272);var j=new class{constructor(e,t){this._cache=new _.a(e),this._invalidCache=new _.a(t)}get(e,t){var r="".concat(t.uid,":").concat(e),i=this._cache.get(r);if(i)return i;if(void 0!==this._invalidCache.get(r))return null;try{var s=O.WhereClause.create(e,t);return this._cache.put(r,s),s}catch(a){return this._invalidCache.put(r,null),null}}}(50,500),x="feature-store:unsupported-query",w=" as ",I=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function S(e,t){return e?j.get(e,t):null}function T(e,t,r,i=!0){var s=[];for(var a of t)if("*"!==a&&!e.has(a))if(i){var n=F(a);try{var u=S(n,e);if(!u)throw new o.a(x,"invalid SQL expression",{where:n});if(!u.isStandardized)throw new o.a(x,"expression is not standard",{clause:u});T(e,u.fieldNames,"expression contains missing fields")}catch(c){var l=c&&c.details;if(l&&(l.clause||l.where))throw c;l&&l.missingFields?s.push(...l.missingFields):s.push(a)}}else s.push(a);if(s.length)throw new o.a(x,r,{missingFields:s})}function F(e){return e.split(w)[0]}function M(e,t){var r=t.get(e);return!!r&&!I.has(r.type)}var k=r(668),C=r(877),R=r(755),A=r(168),E=r(311);var N=class{constructor(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;var s=0;for(var a of i){var n=F(a),o=this.fieldsIndex.get(n),u=o?null:S(n,r),l=o?o.name:a.split(w)[1]||"FIELD_EXP_"+s++;this._fieldDataCache.set(a,{alias:l,clause:u})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach((e=>this.getAttributes(e))),this._returnDistinctMap.size):e.length}getAttributes(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(e,t,r){var i=r?r.name:t,s=null;return this._fieldDataCache.has(i)?s=this._fieldDataCache.get(i).clause:r||(s=S(t,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:s})),r?this.featureAdapter.getAttribute(e,i):s.calculateValue(e,this.featureAdapter)}validateItem(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:S(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)}validateItems(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:S(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)}_processAttributesForOutFields(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);var r={};for(var i of t){var{alias:s,clause:a}=this._fieldDataCache.get(i);r[s]=a?a.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,s)}return r}_processAttributesForDistinctValues(e){if(Object(n.j)(e)||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t)for(var i of t){var{alias:s}=this._fieldDataCache.get(i);r.push(e[s])}else for(var a in e)r.push(e[a]);var o="".concat((t||["*"]).join(","),"=").concat(r.join(",")),u=this._returnDistinctMap.get(o)||0;return this._returnDistinctMap.set(o,++u),u>1?null:e}};function P(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function q(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function z(e,t,r){return r?t-e:e-t}function D(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var s=new Date(e).getTime(),a=new Date(t).getTime();if(!isNaN(s)&&!isNaN(a))return z(s,a,i)}if("number"==typeof e&&"number"==typeof t)return z(e,t,i);if("string"==typeof e&&"string"==typeof t){var n=e.toUpperCase(),o=t.toUpperCase();return!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?q(n,o,i):q(P(n),P(o),i)}return i?1:-1}class G{constructor(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter,this.aggregateAdapter=r.aggregateAdapter}get size(){return this.items.length}createQueryResponseForCount(e){var t=new N(e,this.featureAdapter,this.fieldsIndex);if(!e.outStatistics)return t.countDistinctValues(this.items);var{groupByFieldsForStatistics:r,having:i}=e;if(!(null==r?void 0:r.length))return 1;var s=new Map,a=new Map,n=new Set,o=e.outStatistics;for(var u of o){var{statisticType:l}=u,c="exceedslimit"!==l?u.onStatisticField:void 0;if(!a.has(c)){var h=[];for(var d of r){var f=this._getAttributeValues(t,d,s);h.push(f)}a.set(c,this._calculateUniqueValues(h))}var p=a.get(c);for(var g in p){var{data:m,items:v}=p[g],y=m.join(",");i&&!t.validateItems(v,i)||n.add(y)}}return n.size}createQueryResponse(e){var t;return t=e.outStatistics?e.outStatistics.some((e=>"exceedslimit"===e.statisticType))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(Object(u.i)(e.outSR)&&!Object(u.c)(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=Object(k.b)(Object(i.a)({spatialReference:e.outSR},Object(b.b)(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=Object(k.b)(Object(i.a)({spatialReference:e.outSR},this.queryGeometry))),t}createSnappingResponse(e,t){var r=this.featureAdapter,i=function(e,t){return e?t?4:3:t?3:2}(this.hasZ,this.hasM),{x:s,y:a}=e.point,n="number"==typeof e.distance?e.distance:e.distance.x,o="number"==typeof e.distance?e.distance:e.distance.y,u={candidates:[]},l="esriGeometryPolygon"===this.geometryType,c=this.getPointCreator(e.point,this.spatialReference,t);for(var h of this.items){var d=r.getGeometry(h);if(d){var{coords:f,lengths:p}=d;if(1&e.types)for(var g=0,m=0;m<p.length;m++)for(var v=p[m],y=0;y<v;y++,g+=i){var b=f[g],_=f[g+1];if(y!==v-1){var O=f[g+i],j=f[g+i+1],{x:x,y:w}=L(s,a,b,_,O,j),I=(s-x)/n,S=(a-w)/o,T=I*I+S*S;T<=1&&u.candidates.push({type:"edge",objectId:r.getObjectId(h),distance:Math.sqrt(T),target:c(x,w),start:c(b,_),end:c(O,j)})}}if(2&e.types)for(var F=l?f.length-i:f.length,M=0;M<F;M+=i){var k=f[M],C=f[M+1],R=(s-k)/n,A=(a-C)/o,E=R*R+A*A;E<=1&&u.candidates.push({type:"vertex",objectId:r.getObjectId(h),distance:Math.sqrt(E),target:c(k,C)})}}}return u.candidates.sort(((e,t)=>e.distance-t.distance)),u}getPointCreator(e,t,r){var i=Object(n.k)(r)&&!Object(u.c)(t,r)?e=>Object(b.b)(e,t,r):e=>e;return null!=e.z&&null!=e.m?(t,r)=>i({x:t,y:r,z:e.z,m:e.m}):null!=e.z?(t,r)=>i({x:t,y:r,z:e.z}):null!=e.m?(t,r)=>i({x:t,y:r,m:e.m}):(e,t)=>i({x:e,y:t})}executeAttributesQuery(e){var t=S(e.where,this.fieldsIndex);if(!t)return Promise.resolve(this);if(t.isStandardized){var r=0,i=[];for(var s of this.items)t.testFeature(s,this.featureAdapter)&&(i[r++]=s);var a=new G(i,this.queryGeometry,this);return a.definitionExpression=e.where,Promise.resolve(a)}return Promise.reject(new TypeError("Where clause is not standardized"))}executeAggregateIdsQuery(e){if(!e.aggregateIds||!e.aggregateIds.length||Object(n.j)(this.aggregateAdapter))return Promise.resolve(this);var t=new Set;for(var r of e.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach((e=>t.add(e)));var i=this.featureAdapter.getObjectId;return Promise.resolve(new G(this.items.filter((e=>t.has(i(e)))),this.queryGeometry,this))}executeObjectIdsQuery(e){if(!e.objectIds||!e.objectIds.length)return Promise.resolve(this);var t=new Set(e.objectIds),r=this.featureAdapter.getObjectId;return Promise.resolve(new G(this.items.filter((e=>t.has(r(e)))),this.queryGeometry,this))}executeTimeQuery(e){var t=Object(R.b)(this.timeInfo,e.timeExtent,this.featureAdapter);if(!Object(n.k)(t))return Promise.resolve(this);var r=this.items.filter(t);return Promise.resolve(new G(r,this.queryGeometry,this))}filterLatest(){var{trackIdField:e,startTimeField:t,endTimeField:r}=this.timeInfo,i=r||t,s=new Map,a=this.featureAdapter.getAttribute;for(var n of this.items){var o=a(n,e),u=a(n,i),l=s.get(o);(!l||u>a(l,i))&&s.set(o,n)}var c=Array.from(s.values());return Promise.resolve(new G(c,this.queryGeometry,this))}project(e){var t=this;return Object(s.a)((function*(){if(!e||Object(u.c)(t.spatialReference,e))return t;var r=t.featureAdapter,i=(yield Object(b.c)(t.items.map((e=>Object(k.c)(t.geometryType,t.hasZ,t.hasM,r.getGeometry(e)))),t.spatialReference,e)).map(((e,i)=>r.cloneWithGeometry(t.items[i],Object(A.d)(e,t.hasZ,t.hasM))));return new G(i,t.queryGeometry,{definitionExpression:t.definitionExpression,geometryType:t.geometryType,hasM:t.hasM,hasZ:t.hasZ,objectIdField:t.objectIdField,spatialReference:e,fieldsIndex:t.fieldsIndex,timeInfo:t.timeInfo,featureAdapter:t.featureAdapter})}))()}_sortFeatures(e,t,r){var i=this;if(e.length>1&&t&&t.length){var s=function(t){var s=t.split(" "),a=s[0],n=i.fieldsIndex.get(a),o=s[1]&&"desc"===s[1].toLowerCase();e.sort(((e,t)=>D(r(e,a,n),r(t,a,n),n,o)))};for(var a of t.reverse())s(a)}}_createFeatureQueryResponse(e){var t=this.items,{geometryType:r,hasM:i,hasZ:s,objectIdField:a,spatialReference:n}=this,{outFields:o,outSR:u,quantizationParameters:l,resultRecordCount:c,resultOffset:h,returnZ:d,returnM:f}=e,p=null!=c&&t.length>(h||0)+c,g=o&&(o.indexOf("*")>-1?[...this.fieldsIndex.fields]:o.map((e=>this.fieldsIndex.get(e))));return{exceededTransferLimit:p,features:this._createFeatures(e,t),fields:g,geometryType:r,hasM:i&&f,hasZ:s&&d,objectIdFieldName:a,spatialReference:Object(k.b)(u||n),transform:l&&Object(E.c)(l)||null}}_createFeatures(e,t){var r=new N(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:s}=this,{orderByFields:a,quantizationParameters:n,returnGeometry:o,returnCentroid:u,maxAllowableOffset:l,resultOffset:c,resultRecordCount:h,returnZ:d=!1,returnM:f=!1}=e,p=s&&d,g=i&&f,m=[],v=0,y=[...t];if(this._sortFeatures(y,a,((e,t,i)=>r.getFieldValue(e,t,i))),o||u){var b=Object(E.c)(n);if(o&&!u)for(var _ of y)m[v++]={attributes:r.getAttributes(_),geometry:Object(k.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(_),l,b,p,g)};else if(!o&&u)for(var O of y)m[v++]={attributes:r.getAttributes(O),centroid:Object(k.f)(this,this.featureAdapter.getCentroid(O,this),b)};else for(var j of y)m[v++]={attributes:r.getAttributes(j),centroid:Object(k.f)(this,this.featureAdapter.getCentroid(j,this),b),geometry:Object(k.c)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(j),l,b,p,g)}}else for(var x of y){var w=r.getAttributes(x);w&&(m[v++]={attributes:w})}var I=c||0;if(null!=h){var S=I+h;m=m.slice(I,Math.min(m.length,S))}return m}_createExceedsLimitQueryResponse(e){var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(var a of e.outStatistics)if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var n=this.hasZ?this.hasM?4:3:this.hasM?3:2,o=this.featureAdapter;t=this.items.reduce(((e,t)=>{var r=o.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/n>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}}_createStatisticsQueryResponse(e){var t=this,r={attributes:{}},i=[],s=new Map,a=new Map,n=new Map,o=new Map,u=new N(e,this.featureAdapter,this.fieldsIndex),l=e.outStatistics,{groupByFieldsForStatistics:c,having:h,orderByFields:d}=e,f=c&&c.length,p=!!f,g=p&&c[0],m=p&&!this.fieldsIndex.get(g);for(var v of l){var{outStatisticFieldName:y,statisticType:b}=v,_=v,O="exceedslimit"!==b?v.onStatisticField:void 0,j="percentile_disc"===b||"percentile_cont"===b,x=p&&1===f&&(O===g||m)&&"count"===b;if(p){if(!n.has(O)){var w=[];for(var I of c){var S=this._getAttributeValues(u,I,s);w.push(S)}n.set(O,this._calculateUniqueValues(w,u.returnDistinctValues))}var T=n.get(O),F=function(e){var{count:r,data:i,items:a,itemPositions:n}=T[e],l=i.join(",");if(!h||u.validateItems(a,h)){var d=o.get(l)||{attributes:{}},f=null;if(x)f=r;else{var p=t._getAttributeValues(u,O,s),g=n.map((e=>p[e]));f=j&&"statisticParameters"in _?t._getPercentileValue(_,g):t._getStatisticValue(_,g)}d.attributes[y]=f,c.forEach(((e,r)=>d.attributes[t.fieldsIndex.get(e)?e:"EXPR_".concat(r+1)]=i[r])),o.set(l,d)}};for(var M in T)F(M)}else{var k=this._getAttributeValues(u,O,s);r.attributes[y]=j&&"statisticParameters"in _?this._getPercentileValue(_,k):this._getStatisticValue(_,k,a)}i.push({name:y,alias:y,type:"esriFieldTypeDouble"})}var C=p?Array.from(o.values()):[r];return this._sortFeatures(C,d,((e,t)=>e.attributes[t])),{fields:i,features:C}}_getStatisticValue(e,t,r){var{onStatisticField:i,statisticType:s}=e,a=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,a),a["var"===s?"variance":s]}_getPercentileValue(e,t){var{onStatisticField:r,statisticParameters:i,statisticType:s}=e,{value:a,orderBy:n}=i,o="desc"===n,u=this.fieldsIndex.get(r),l=[...t].filter((e=>null!=e)).sort(((e,t)=>D(e,t,u,o)));return this._calculatePercentile(l,a,"percentile_disc"===s)}_getAttributeValues(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),s=this.items.map((r=>e.getFieldValue(r,t,i)));return r.set(t,s),s}_calculateStatistics(e){var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,s=null,a=null,n=null,o=[],u=0;for(var l of e)"string"==typeof l?u++:null==l||isNaN(l)||(i+=l,t=Math.min(t,l),r=Math.max(r,l),o.push(l),u++);if(u){s=i/u;var c=0;for(var h of o)c+=Math.pow(h-s,2);n=u>1?c/(u-1):0,a=Math.sqrt(n)}else t=null,r=null;return{avg:s,count:u,max:r,min:t,stddev:a,sum:i,variance:n}}_calculateUniqueValues(e,t){for(var r={},i=this.items,s=i.length,a=0;a<s;a++){var n=i[a],o=[];for(var u of e)o.push(u[a]);var l=o.join(",");t?null==r[l]&&(r[l]={count:1,data:o,items:[n],itemPositions:[a]}):null==r[l]?r[l]={count:1,data:o,items:[n],itemPositions:[a]}:(r[l].count++,r[l].items.push(n),r[l].itemPositions.push(a))}return r}_calculatePercentile(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,s=Math.floor(i),a=s+1,n=i%1,o=e[s],u=e[a];return a>=e.length||r||"string"==typeof o||"string"==typeof u?o:o*(1-n)+u*n}}function L(e,t,r,i,s,a){var n=s-r,o=a-i,u=n*n+o*o,l=(e-r)*n+(t-i)*o,c=Math.min(1,Math.max(0,l/u));return{x:r+n*c,y:i+o*c}}var U=G;var B="feature-store:unsupported-query";var V=new Set,Q=new g.b(2e6),Y=0;var X=Object(y.d)(),J=Object(y.d)();t.a=class{constructor(e){this.capabilities={query:v.a},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new g.a(Y+++"$$",Q)),this.fieldsIndex=new m.a(e.fields),e.scheduler&&e.task&&(this._frameQueue=new f.a,this._frameTask=e.scheduler.registerTask(e.task,(e=>this._update(e)),(()=>this._frameQueue.length>0)))}destroy(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(k.b)(this.spatialReference)}:null}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(R.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}executeQuery(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e);try{s=yield r._schedule((()=>Object(k.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t),i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)}catch(n){if(n!==k.a)throw n;i=new U([],null,r)}return i.createQueryResponse(s)}))()}executeQueryForCount(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=yield r._schedule((()=>Object(k.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t),i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)}catch(n){if(n!==k.a)throw n;return 0}return i.createQueryResponseForCount(s)}))()}executeQueryForExtent(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e),n=s.outSR;try{s=yield r._schedule((()=>Object(k.d)(s,r.definitionExpression,r.spatialReference)),t),(s=yield r._reschedule((()=>r._checkQuerySupport(s)),t)).returnGeometry=!0,s.returnCentroid=!1,s.outSR=null,i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t);var o=(i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)).size;if(!o)return{count:o,extent:null};Object(y.q)(J,y.a),r.featureStore.forEachBounds(i.items,(e=>Object(y.g)(J,e)),X);var u={xmin:J[0],ymin:J[1],xmax:J[3],ymax:J[4],spatialReference:Object(k.b)(r.spatialReference)};r.hasZ&&isFinite(J[2])&&isFinite(J[5])&&(u.zmin=J[2],u.zmax=J[5]);var l=Object(b.b)(u,i.spatialReference,n);if(l.spatialReference=Object(k.b)(n||r.spatialReference),l.xmax-l.xmin==0){var c=Object(h.f)(l.spatialReference);l.xmin-=c,l.xmax+=c}if(l.ymax-l.ymin==0){var d=Object(h.f)(l.spatialReference);l.ymin-=d,l.ymax+=d}if(r.hasZ&&null!=l.zmin&&null!=l.zmax&&l.zmax-l.zmin==0){var f=Object(h.f)(l.spatialReference);l.zmin-=f,l.zmax+=f}return{count:o,extent:l}}catch(p){if(p===k.a)return{count:0,extent:null};throw p}}))()}executeQueryForIds(e={},t){var r=this;return Object(s.a)((function*(){return r.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}))()}executeQueryForIdSet(e={},t){var r=this;return Object(s.a)((function*(){var i,s=Object(a.a)(e);s.returnGeometry=!1,s.returnCentroid=!1,s.outSR=null;try{s=yield r._schedule((()=>Object(k.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t);var n=(i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t)).items,o=new Set;return yield r._reschedule((()=>{for(var e of n)o.add(i.featureAdapter.getObjectId(e))}),t),o}catch(u){if(u===k.a)return new Set;throw u}}))()}executeQueryForSnapping(e,t){var r=this;return Object(s.a)((function*(){var{point:s,distance:a,types:o}=e;if(0===o)return{candidates:[]};var l=yield r._reschedule((()=>r._checkQuerySupport(e.query)),t),h=!Object(u.c)(s.spatialReference,r.spatialReference);h&&(yield Object(b.a)(s.spatialReference,r.spatialReference));var d="number"==typeof a?a:a.x,f="number"==typeof a?a:a.y,g={xmin:s.x-d,xmax:s.x+d,ymin:s.y-f,ymax:s.y+f,spatialReference:s.spatialReference},m=h?Object(b.b)(g,r.spatialReference):g;if(!m)return{candidates:[]};var v=(yield Object(p.a)(Object(c.a)(s),null,{signal:t}))[0],y=(yield Object(p.a)(Object(c.a)(m),null,{signal:t}))[0];if(Object(n.j)(v)||Object(n.j)(y))return{candidates:[]};var _=new U(r._searchFeatures(r._getQueryBBoxes(y.toJSON())),null,r);_=yield r._reschedule((()=>_.executeObjectIdsQuery(l)),t),_=yield r._reschedule((()=>_.executeTimeQuery(l)),t),_=yield r._reschedule((()=>_.executeAttributesQuery(l)),t);var O=v.toJSON(),j=h?Object(b.b)(O,r.spatialReference):O,x=h?Math.max(m.xmax-m.xmin,m.ymax-m.ymin)/2:a;return _.createSnappingResponse(Object(i.a)(Object(i.a)({},e),{},{point:j,distance:x}),s.spatialReference)}))()}executeQueryForLatestObservations(e={},t){var r=this;return Object(s.a)((function*(){if(!r.timeInfo||!r.timeInfo.trackIdField)throw new o.a(B,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:r.timeInfo});var i,s=Object(a.a)(e);try{s=yield r._schedule((()=>Object(k.d)(s,r.definitionExpression,r.spatialReference)),t),s=yield r._reschedule((()=>r._checkQuerySupport(s)),t),i=yield r._reschedule((()=>r._executeGeometryQuery(s,t)),t),i=yield r._reschedule((()=>i.executeAggregateIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeObjectIdsQuery(s)),t),i=yield r._reschedule((()=>i.executeTimeQuery(s)),t),i=yield r._reschedule((()=>i.executeAttributesQuery(s)),t),i=yield r._reschedule((()=>i.filterLatest()),t)}catch(n){if(n!==k.a)throw n;i=new U([],null,r)}return i.createQueryResponse(s)}))()}_schedule(e,t){var r=this;return Object(s.a)((function*(){return r._frameQueue?r._frameQueue.push(e,t):e()}))()}_reschedule(e,t){var r=this;return Object(s.a)((function*(){return r._frameQueue?r._frameQueue.unshift(e,t):e()}))()}_update(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null}_getAll(){if(!this._allItems){var e=[];this.featureStore.forEach((t=>e.push(t))),this._allItems=new U(e,null,this)}return this._allItems}_executeGeometryQuery(e,t){var r=this;return Object(s.a)((function*(){var{geometry:i,outSR:a,spatialRel:o,returnGeometry:l,returnCentroid:c}=e,h=l||c,d=Object(u.i)(a)&&!Object(u.c)(r.spatialReference,a),f=r._geometryQueryCache?d&&h?JSON.stringify({geometry:i,spatialRelationship:o,outSpatialReference:a}):JSON.stringify({geometry:i,spatialRelationship:o}):null;if(f){var p=r._geometryQueryCache.get(f);if(!Object(n.l)(p))return p}var g=function(){var e=Object(s.a)((function*(e){if(d&&h){var t=yield e.project(a);return f&&r._geometryQueryCache.put(f,t,t.size||1),t}return f&&r._geometryQueryCache.put(f,e,e.size||1),e}));return function(t){return e.apply(this,arguments)}}();if(!i)return g(r._getAll());var m=r.featureAdapter;if("esriSpatialRelDisjoint"===o){var v,y,b=r._searchFeatures(r._getQueryBBoxes(i));if(!b.length)return g(r._getAll());var _=new Set;for(var O of b)_.add(m.getObjectId(O));return yield r._reschedule((()=>{var e=0;v=new Array(_.size),r.featureStore.forEach((t=>v[e++]=t)),y=_}),t),g(yield r._reschedule(Object(s.a)((function*(){var e=yield Object(C.c)(o,i,r.geometryType,r.hasZ,r.hasM);return new U(yield r._runSpatialFilter(v,(t=>!y.has(m.getObjectId(t))||e(m.getGeometry(t))),t),i,r)})),t))}var j=r._searchFeatures(r._getQueryBBoxes(i));if(!j.length){var x=new U([],i,r);return f&&r._geometryQueryCache.put(f,x,x.size||1),x}if(r._canExecuteSoloPass(i,e))return g(new U(j,i,r));var w=yield Object(C.c)(o,i,r.geometryType,r.hasZ,r.hasM),I=yield r._runSpatialFilter(j,(e=>w(m.getGeometry(e))),t);return g(new U(I,i,r))}))()}_runSpatialFilter(e,t,r){var i=this;return Object(s.a)((function*(){if(!t)return e;if(!i._budget)return e.filter((e=>t(e)));var a=0,n=new Array,o=function(){var u=Object(s.a)((function*(){for(;a<e.length;){var s=e[a];t(s)&&n.push(s),i._budget.done&&(yield i._reschedule((()=>o()),r)),++a}}));return function(){return u.apply(this,arguments)}}();return i._reschedule((()=>o()),r).then((()=>n))}))()}_canExecuteSoloPass(e,t){var{geometryType:r}=this,{spatialRel:i}=t;return Object(C.a)(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))}_getQueryBBoxes(e){if(Object(C.a)(e)){if(Object(c.d)(e))return[Object(d.n)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(c.g)(e))return e.rings.map((e=>Object(d.n)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[Object(l.a)(Object(d.i)(),e)]}_searchFeatures(e){for(var t of e)this.featureStore.forEachInBounds(t,(e=>{V.add(e)}));var r=new Array(V.size),i=0;return V.forEach((e=>r[i++]=e)),V.clear(),r}_checkQuerySupport(e){var t=this;return Object(s.a)((function*(){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new o.a(B,"Unsupported query options",{query:e});return Promise.all([t._checkAttributesQuerySupport(e),t._checkStatisticsQuerySupport(e),Object(C.b)(e,t.geometryType,t.spatialReference),Object(b.a)(t.spatialReference,e.outSR)]).then((()=>e))}))()}_checkAttributesQuerySupport(e){var{outFields:t,orderByFields:r,returnDistinctValues:i,outStatistics:s}=e,a=s?s.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())):[];if(r&&r.length>0){var n=" asc",u=" desc",l=r.map((e=>{var t=e.toLowerCase();return t.indexOf(n)>-1?t.split(n)[0]:t.indexOf(u)>-1?t.split(u)[0]:e})).filter((e=>-1===a.indexOf(e)));T(this.fieldsIndex,l,"orderByFields contains missing fields")}if(t&&t.length>0)T(this.fieldsIndex,t,"outFields contains missing fields");else if(i)throw new o.a(B,"outFields should be specified for returnDistinctValues",{query:e});!function(e,t){if(!t)return!0;var r=j.get(t,e);if(!r)throw new o.a(x,"invalid SQL expression",{where:t});if(!r.isStandardized)throw new o.a(x,"where clause is not standard",{where:t});T(e,r.fieldNames,"where clause contains missing fields")}(this.fieldsIndex,e.where)}_checkStatisticsQuerySupport(e){var t=this;return Object(s.a)((function*(){var{outStatistics:r,groupByFieldsForStatistics:i,having:s}=e,a=i&&i.length,n=r&&r.length;if(s){if(!a||!n)throw new o.a(B,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});!function(e,t,r){if(!t)return!0;var i=j.get(t,e);if(!i)throw new o.a(x,"invalid SQL expression",{having:t});if(!i.isAggregate)throw new o.a(x,"having does not contain a valid aggregate function",{having:t});var s=i.fieldNames;if(T(e,s,"having contains missing fields"),!i.getExpressions().every((t=>{var{aggregateType:i,field:s}=t,a=e.has(s)&&e.get(s).name;return r.some((t=>{var{onStatisticField:r,statisticType:s}=t;return(e.has(r)&&e.get(r).name)===a&&s.toLowerCase().trim()===i}))})))throw new o.a(x,"expressions in having should also exist in outStatistics",{having:t})}(t.fieldsIndex,s,r)}if(n){if(!function(e){return e.every((e=>"exceedslimit"!==e.statisticType))}(r))return;var u=r.map((e=>e.onStatisticField));for(var l of(T(t.fieldsIndex,u,"onStatisticFields contains missing fields"),a&&T(t.fieldsIndex,i,"groupByFieldsForStatistics contains missing fields"),r)){var{onStatisticField:c,statisticType:h}=l;if("percentile_disc"!==h&&"percentile_cont"!==h||!("statisticParameters"in l)){if("count"!==h&&c&&M(c,t.fieldsIndex))throw new o.a(B,"outStatistics contains non-numeric fields",{definition:l,query:e})}else{var{statisticParameters:d}=l;if(!d)throw new o.a(B,"statisticParamters should be set for percentile type",{definition:l,query:e})}}}}))()}}},782:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return o}));var i=r(91),s=r(80),a=r(92),n=r(282);function o(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?n.a:"esriGeometryPolyline"===e?n.c:n.b}}}function u(e,t){if(Object(s.a)("csp-restrictions"))return()=>Object(i.a)({[t]:null},e);try{var r="this.".concat(t," = null;");for(var a in e)r+="this".concat(a.indexOf(".")?'["'.concat(a,'"]'):".".concat(a)," = ").concat(JSON.stringify(e[a]),";");var n=new Function(r);return()=>new n}catch(o){return()=>Object(i.a)({[t]:null},e)}}function l(e={}){return[{name:"New Feature",description:"",prototype:{attributes:Object(a.a)(e)}}]}},837:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},877:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return I})),r.d(t,"c",(function(){return w}));var i=r(7),s=r(93),a=r(112),n=r(309),o=r(354),u=r(100),l=r(178),c=r(168);function h(e,t){return e?t?4:3:t?3:2}function d(e,t,r,i,s){if(!e)return!1;var a=h(t,r),{coords:n,lengths:o}=e,u=!1,l=0;for(var c of o)u=f(u,n,a,l,c,i,s),l+=c*a;return u}function f(e,t,r,i,s,a,n){for(var o=e,u=i,l=i,c=i+s*r;l<c;l+=r){(u=l+r)===c&&(u=i);var h=t[l],d=t[l+1],f=t[u],p=t[u+1];(d<n&&p>=n||p<n&&d>=n)&&h+(n-d)/(p-d)*(f-h)<a&&(o=!o)}return o}var p=r(400),g=r(668),m="feature-store:unsupported-query",v={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function O(e){return!0===y[e]}function j(e){return!0===b[Object(u.c)(e)]}function x(e){return!0===_[e]}function w(e,t,i,s,a){if(Object(u.g)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var f=Object(c.g)(new l.a,t,!1,!1);return Promise.resolve((e=>function(e,t,r,i){return d(e,t,r,i.coords[0],i.coords[1])}(f,!1,!1,e)))}if(Object(u.g)(t)&&"esriGeometryMultipoint"===i){var p=Object(c.g)(new l.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>function(e,t,r,i,s,a){var n=h(s,a),{coords:o,lengths:u}=i;if(!u)return!1;for(var l=0,c=0;l<u.length;l++,c+=n)if(!d(e,t,r,o[c],o[c+1]))return!1;return!0}(p,!1,!1,e,s,a)))}if(Object(u.d)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>Object(n.e)(t,Object(g.c)(i,s,a,e))));if(Object(u.d)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((e=>Object(n.d)(t,Object(g.c)(i,s,a,e))));if(Object(u.d)(t)&&"esriSpatialRelIntersects"===e){var m=Object(o.b)(i);return Promise.resolve((e=>m(t,Object(g.c)(i,s,a,e))))}return Promise.all([r.e(9),r.e(28)]).then(r.bind(null,788)).then((r=>{var n=r[v[e]].bind(null,t.spatialReference,t);return e=>n(Object(g.c)(i,s,a,e))}))}function I(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(i.a)((function*(e,t,r){var{spatialRel:i,geometry:n}=e;if(n){if(!O(i))throw new s.a(m,"Unsupported query spatial relationship",{query:e});if(Object(a.i)(n.spatialReference)&&Object(a.i)(r)){if(!j(n))throw new s.a(m,"Unsupported query geometry type",{query:e});if(!x(t))throw new s.a(m,"Unsupported layer geometry type",{query:e});if(e.outSR)return Object(p.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}))).apply(this,arguments)}function T(e){if(Object(u.d)(e))return!0;if(Object(u.g)(e)){for(var t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},904:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(407);class s extends i.a{constructor(e,t){super(i.a.createInstance()),this._currentIndex=-1,this._reader=e,this._indices=t}static from(e,t){return new s(e.copy(),t)}get hasNext(){return this._currentIndex+1<this._indices.length}getApproximateSize(){return this._indices.length}getCursor(){return this.copy()}copy(){var e=new s(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e}next(){for(;this._nextIndex()&&!this._reader._passesFilter()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}setArcadeSpatialReference(e){this._reader.setArcadeSpatialReference(e)}attachStorage(e){this._reader.attachStorage(e)}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}getStorage(){return this._reader.getStorage()}getComputedNumeric(e){return this._reader.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this._reader.setComputedNumericAtIndex(t,0)}getComputedString(e){return this._reader.getComputedStringAtIndex(0)}setComputedString(e,t){return this._reader.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._reader.getComputedNumericAtIndex(e)}setComputedNumericAtIndex(e,t){this._reader.setComputedNumericAtIndex(e,t)}getComputedStringAtIndex(e){return this._reader.getComputedStringAtIndex(e)}setComputedStringAtIndex(e,t){return this._reader.setComputedStringAtIndex(e,t)}transform(e,t,r,i){var s=this.copy();return s._reader=this._reader.transform(e,t,r,i),s}extent(e,t,r,i){var s=this.copy();return s._reader=this._reader.extent(e,t,r,i),s}hasFilter(){return this._reader.hasFilter()}readAttribute(e,t=!1){return this._reader.readAttribute(e,t)}readAttributes(){return this._reader.readAttributes()}joinAttributes(e){return this._reader.joinAttributes(e)}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this.readAttribute(e,!0)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(){return this._reader.castToText()}getQuantizationTransform(){return this._reader.getQuantizationTransform()}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}getGroupId(){return this._reader.getGroupId()}setGroupId(e){return this._reader.setGroupId(e)}getXHydrate(){return this._reader.getXHydrate()}getYHydrate(){return this._reader.getYHydrate()}getX(){return this._reader.getX()}getY(){return this._reader.getY()}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readLegacyFeature(){return this._reader.readLegacyFeature()}readOptimizedFeature(){return this._reader.readOptimizedFeature()}readLegacyPointGeometry(){return this._reader.readLegacyPointGeometry()}readLegacyGeometry(){return this._reader.readLegacyGeometry()}readLegacyCentroid(){return this._reader.readLegacyCentroid()}readGeometryArea(){return this._reader.readGeometryArea()}readUnquantizedGeometry(){return this._reader.readUnquantizedGeometry()}readHydratedGeometry(){return this._reader.readHydratedGeometry()}readGeometry(){return this._reader.readGeometry()}readCentroid(){return this._reader.readCentroid()}_passesFilter(){return this._reader._passesFilter()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}}},930:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var i=r(91),s=r(7),a=r(80),n=r(89),o=r(152),u=r(317),l=r(81);var c=function(e,t,r){e.referencesGeometry();var s=t.readArcadeFeature();try{return e.evaluate(Object(i.a)(Object(i.a)({},r),{},{$feature:s}))}catch(a){return l.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}},h=r.e(263).then(r.bind(null,1206));class d{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}invalidate(){this._bitsets.computed.clear()}updateSchema(e,t){var r=this;return Object(s.a)((function*(){var i=Object(u.a)(r._schema,t);if(r._schema=t,t&&!Object(n.j)(i)&&Object(u.b)(i,"attributes")){Object(a.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",i),r._bitsets.computed.clear(),e.targets[t.name]=!0;var s=t.attributes,o=[],l=[];for(var c in s){var h=s[c];switch(h.type){case"field":break;case"expression":o.push(r._createArcadeComputedField(h));break;case"label-expression":o.push(r._createLabelArcadeComputedField(h));break;case"statistic":l.push(h)}}r._computedFields=yield Promise.all(o),r._canCacheExpressionValue=!r._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),r._statisticFields=l}}))()}setComputedAttributes(e,t,r,i){var s=this._bitsets.computed;if(!this._canCacheExpressionValue||!s.has(r))for(var a of(s.set(r),this._computedFields)){var n=this._evaluateField(t,a,i);switch(a.resultType){case"numeric":e.setComputedNumericAtIndex(r,a.fieldIndex,n);break;case"string":e.setComputedStringAtIndex(r,a.fieldIndex,n)}}}_createArcadeComputedField(e){var t=this;return Object(s.a)((function*(){var r=t._sourceInfo.spatialReference,s=t._sourceInfo.fieldsIndex;return Object(i.a)(Object(i.a)({},e),{},{expression:yield Object(o.d)(e.valueExpression,r,s)})}))()}_createLabelArcadeComputedField(e){var t=this;return Object(s.a)((function*(){var r=t._sourceInfo.spatialReference,s=t._sourceInfo.fields,{createLabelFunction:a}=yield h,n=yield a(e.label,s,r);return Object(i.a)(Object(i.a)({},e),{},{builder:n})}))()}_evaluateField(e,t,r){switch(t.type){case"label-expression":var i=e.readArcadeFeature();return t.builder.evaluate(i)||"";case"expression":var{expression:s}=t;return c(s,e,{$view:{scale:r}})}}}},967:function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return y}));var i=r(93),s=r(292),a=r(178);function n(e){var t=[];return e.forEach((e=>t.push(e))),t}var o={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*u(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(var t of e.features)t&&(yield t)}}function l(e){for(var t=0,r=0;r<e.length;r++){var i=e[r],s=e[(r+1)%e.length];t+=i[0]*s[1]-s[0]*i[1]}return t<=0}function c(e){var t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function h(e,t,r){switch(t.type){case"LineString":return function(e,t,r){return p(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(var i of t.coordinates)p(e,i,r);return e}(e,t,r);case"MultiPoint":return function(e,t,r){return p(e,t.coordinates,r),e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(var i of t.coordinates){d(e,i[0],r);for(var s=1;s<i.length;s++)f(e,i[s],r)}return e}(e,t,r);case"Point":return function(e,t,r){return m(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){var i=t.coordinates;d(e,i[0],r);for(var s=1;s<i.length;s++)f(e,i[s],r);return e}(e,t,r)}}function d(e,t,r){var i=c(t);!function(e){return!l(e)}(i)?p(e,i,r):g(e,i,r)}function f(e,t,r){var i=c(t);!function(e){return l(e)}(i)?p(e,i,r):g(e,i,r)}function p(e,t,r){for(var i of t)m(e,i,r);e.lengths.push(t.length)}function g(e,t,r){for(var i=t.length-1;i>=0;i--)m(e,t[i],r);e.lengths.push(t.length)}function m(e,t,r){var[i,s,a]=t;e.coords.push(i,s),r.hasZ&&e.coords.push(a||0)}function v(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function y(e){if(!e)throw new i.a("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new i.a("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});var{crs:t}=e;if(t){var r="string"==typeof t?t:"name"===t.type?t.properties.name:null,s=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!s.test(r))throw new i.a("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}}function b(e,t={}){for(var r,i=u(e),s=[],a=new Set,l=new Set,c=!1,h=Number.NEGATIVE_INFINITY,d=null,f=!1,{geometryType:p=null}=t,g=!1,m=function(){var{value:e,done:t}=i.next();if(t){var u=d&&1===d.length&&d[0]||null;if(u)for(var m of s)m.name===u&&(m.type="esriFieldTypeOID");return{v:{fields:s,geometryType:p,hasZ:c,maxObjectId:Math.max(0,h),objectIdFieldName:u,objectIdFieldType:r,unknownFields:n(l)}}}var{geometry:y,properties:b,id:_}=e;if((!y||(p||(p=o[y.type]),o[y.type]===p))&&(c||(c=function(e){for(;;){var{value:t,done:r}=e.next();if(r)return!1;if(t.length>2)return!0}}(function*(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(var t of e.coordinates)yield*t;break;case"MultiPolygon":for(var r of e.coordinates)for(var i of r)yield*i}}(y))),f||(f=null!=_)&&("number"===(r=typeof _)&&(d=Object.keys(b).filter((e=>b[e]===_)))),f&&"number"===r&&null!=_&&(h=Math.max(h,_),d.length>1?d=d.filter((e=>b[e]===_)):1===d.length&&(d=b[d[0]]===_?d:[])),!g&&b)){var O=!0;for(var j in b)if(!a.has(j)){var x=b[j];if(null!=x){var w=v(x);"unknown"!==w?(l.delete(j),a.add(j),s.push({name:j,alias:j,type:w})):l.add(j)}else O=!1,l.add(j)}g=O}};;){var y=m();if("object"===typeof y)return y.v}}function _(e,t){return function(e){for(var t=[];;){var{value:r,done:i}=e.next();if(i)return t;t.push(r)}}(function*(e,t={}){for(var{geometryType:r,objectIdFieldName:i}=t;;){var{value:n,done:u}=e.next();if(u)return;var{geometry:l,properties:c,id:d}=n;if(!l||o[l.type]===r){var f=c||{};i&&null!=d&&!f[i]&&(f[i]=d);var p=new s.a(l?h(new a.a,l,t):null,f);yield p}}}(u(e),t))}},969:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f}));r(80);var i=r(89),s=r(131),a=r(666),n=r(279),o=r(420),u=r(930),l=r(904);function c(e,t){return e<<16|t}function h(e){return(4294901760&e)>>>16}function d(e){return 65535&e}var f={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class p extends u.a{constructor(e,t,r){super(e,t),this.featureAdapter=f,this.events=new s.a,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._indexSearchCache=new a.a(50),this._index=Object(o.a)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))),this._storage=t,this.mode=r}get storage(){return this._storage}get storeStatistics(){return{featureCount:0,vertexCount:0}}hasInstance(e){return this._featureSetsByInstance.has(e)}onTileData(e,t){if(Object(i.j)(t.addOrUpdate))return t;if(t.addOrUpdate.attachStorage(this._storage),"snapshot"===this.mode){for(var r=t.addOrUpdate.getCursor();r.next();){var s=r.getDisplayId();this.setComputedAttributes(this._storage,r,s,e.scale)}return t}this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate);for(var a=t.addOrUpdate.getCursor();a.next();)this._insertFeature(a,e.scale);return this._spatialIndexInvalid=!0,this.events.emit("changed"),t}search(e){this._rebuildIndex();var t=e.id,r=this._indexSearchCache.find((e=>e.tileId===t));if(Object(i.k)(r))return r.readers;var s=new Map,a=this._searchIndex(e.bounds),n=[];for(var o of a){var u=this._storage.getInstanceId(o),c=h(u),f=d(u);s.has(c)||s.set(c,[]),s.get(c).push(f)}return s.forEach(((e,t)=>{var r=this._featureSetsByInstance.get(t);n.push(l.a.from(r,e))})),this._indexSearchCache.enqueue({tileId:t,readers:n}),n}insert(e){for(var t=e.getCursor(),r=this._storage;t.next();){var i,s=c(t.instance,t.getIndex()),a=t.getObjectId(),n=null!=(i=this._objectIdToDisplayId.get(a))?i:this._storage.createDisplayId();t.setDisplayId(n),r.setInstanceId(n,s),this._objectIdToDisplayId.set(a,n)}this._featureSetsByInstance.set(e.instance,e),this._spatialIndexInvalid=!0}remove(e){var t=this._objectIdToDisplayId.get(e);if(t){var r=this._storage.getInstanceId(t),i=d(r),s=h(r),a=this._featureSetsByInstance.get(s);this._objectIdToDisplayId.delete(e),this._storage.releaseDisplayId(t),a.removeAtIndex(i),a.isEmpty&&this._featureSetsByInstance.delete(s),this._spatialIndexInvalid=!0}}forEach(e){this._objectIdToDisplayId.forEach((t=>{var r=this._storage.getInstanceId(t),i=this._lookupFeature(r);e(i)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{var r=this._storage.getInstanceId(t),i=h(r),s=d(r),a=this._getFeatureSet(i);a.setIndex(s),e(a)}))}forEachInBounds(e,t){var r=this._searchIndex(e);for(var s of r){var a=this.lookupFeatureByDisplayId(s,this._storage);t(Object(i.q)(a))}}forEachBounds(e,t,r){this._rebuildIndex();var i=[0,0,0,0];for(var s of e)if(s.readGeometry()){var a=s.getDisplayId();i[0]=this._storage.getXMin(a),i[1]=this._storage.getYMin(a),i[2]=this._storage.getXMax(a),i[3]=this._storage.getYMax(a),t(Object(n.k)(r,i))}}sweepFeatures(e,t,r){this._spatialIndexInvalid=!0,this._objectIdToDisplayId.forEach(((i,s)=>{e.has(i)||(t.releaseDisplayId(i),r&&r.unsetAttributeData(i),this._objectIdToDisplayId.delete(s))})),this.events.emit("changed")}sweepFeatureSets(e){this._spatialIndexInvalid=!0,this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))}lookupObjectId(e,t){var r=this.lookupFeatureByDisplayId(e,t);return Object(i.j)(r)?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){var r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){var t=this._storage.getInstanceId(e),r=h(t),i=d(t),s=this._getFeatureSet(r);return s?(s.setIndex(i),s):null}_insertFeature(e,t){var r=this._storage,i=e.getObjectId(),s=c(e.instance,e.getIndex());r.getInstanceId(e.getDisplayId());var a=this._objectIdToDisplayId.get(i);a||(a=r.createDisplayId(),this._objectIdToDisplayId.set(i,a),this._spatialIndexInvalid=!0),e.setDisplayId(a),r.setInstanceId(a,s),this.setComputedAttributes(r,e,a,t)}_searchIndex(e){this._rebuildIndex();var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}_rebuildIndex(){if(this._spatialIndexInvalid){var e=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach((t=>{for(var r=t.getCursor();r.next();){var i=r.getDisplayId();this._storage.setBounds(i,r)&&e.push(i)}})):this._objectIdToDisplayId.forEach((t=>{var r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.clear(),this._index.load(e),this._indexSearchCache.clear(),this._spatialIndexInvalid=!1}}_lookupFeature(e){var t=h(e),r=d(e),i=this._getFeatureSet(t);if(!i)return null;var s=i.getCursor();return s.setIndex(r),s}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}}}}]);
//# sourceMappingURL=75.255f47dd.chunk.js.map