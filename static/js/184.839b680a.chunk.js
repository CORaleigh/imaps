(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[184],{1183:function(e,t,n){"use strict";n.r(t),n.d(t,"GraphicsSnappingSource",(function(){return S}));var i=n(80),s=(n(78),n(87)),r=(n(79),n(86),n(83)),a=n(82),o=(n(81),n(84),n(85),n(203)),c=n(91),d=n(93),u=n(113),l=n(124),p=n(232),h=n(227),m=n(281),f=n(160),y=n(162),x=n(312),b=n(548),g=n(872),O=n(765),j=n(864);let S=class extends(Object(y.b)(d.a)){constructor(e){super(e),this.availability=1,this.sources={multipoint:null,point:null,polygon:null,polyline:null},this.loadedWkids=new Set,this.loadedWkts=new Set,this.pendingAdds=[]}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){const e=this.pendingAdds;this.pendingAdds.length=0;for(const t of e)t.task.abort();this.mapSources((e=>this.destroySource(e)))}initialize(){this.handles.add([this.layer.on("graphic-update",(e=>this.onGraphicUpdate(e))),this.updatingHandles.addOnCollectionChange(this.layer.graphics,(e=>this.onGraphicsChanged(e)))]),this.addMany(this.layer.graphics.toArray())}async fetchCandidates(e,t){const n=(await Object(c.k)(this.mapSources((n=>n.queryEngine.executeQueryForSnapping({point:e.coordinateHelper.toPoint(e.point,new u.a).toJSON(),distance:e.distance,types:e.types,query:Object(s.k)(e.filter)?e.filter.createQuery().toJSON():{where:"1=1"}},t).then((({candidates:e})=>e)))))).flat().map((t=>Object(j.a)(t,e.coordinateHelper)));return Object(x.e)(e.point,n),{candidates:n}}refresh(){}onGraphicUpdate(e){switch(e.property){case"geometry":case"visible":this.remove(e.graphic),this.addMany([e.graphic])}}onGraphicsChanged(e){for(const t of e.removed)this.remove(t);this.addMany(e.added)}addMany(e){const t=[],n=new Map;for(const i of e)Object(s.j)(i.geometry)||(this.needsInitializeProjection(i.geometry.spatialReference)?(t.push(i.geometry.spatialReference),n.set(i.uid,i)):this.add(i));this.createPendingAdd(t,n)}createPendingAdd(e,t){if(!e.length)return;const n=Object(c.h)((async n=>{await Object(h.f)(e.map((e=>({source:e,dest:this.spatialReference}))),{signal:n}),this.markLoadedSpatialReferences(e);for(const[,e]of t)this.add(e)}));this.updatingHandles.addPromise(n.promise);const i={task:n,graphics:t},s=()=>Object(o.j)(this.pendingAdds,i);n.promise.then(s,s),this.pendingAdds.push(i)}markLoadedSpatialReferences(e){for(const t of e)null!=t.wkid&&this.loadedWkids.add(t.wkid),null!=t.wkt&&this.loadedWkts.add(t.wkt)}add(e){if(Object(s.j)(e.geometry)||!e.visible)return;let t=e.geometry;if("mesh"===t.type)return;"extent"===t.type&&(t=l.a.fromExtent(t));const n=this.ensureSource(t.type);if(Object(s.j)(n))return;const i=this.createOptimizedFeature(e.uid,t);Object(s.k)(i)&&n.featureStore.add(i)}needsInitializeProjection(e){return(null==e.wkid||!this.loadedWkids.has(e.wkid))&&(null==e.wkt||!this.loadedWkts.has(e.wkt))&&!Object(h.b)(e,this.spatialReference)}createOptimizedFeature(e,t){const n=Object(h.j)(Object(b.a)(t),this.spatialReference);return n?new m.a(Object(f.d)(n,!1,!1),{[w]:e},null,e):null}ensureSource(e){const t=this.sources[e];if(Object(s.k)(t))return t;const n=this.createSource(e);return this.sources[e]=n,n}createSource(e){const t=p.a.toJSON(e),n=new g.a({geometryType:t,hasZ:!1,hasM:!1});return{featureStore:n,queryEngine:new O.a({featureStore:n,fields:[{name:w,type:"esriFieldTypeOID",alias:w}],geometryType:t,hasM:!1,hasZ:!1,objectIdField:w,spatialReference:this.spatialReference,scheduler:Object(s.k)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:e}}remove(e){this.mapSources((t=>this.removeFromSource(t,e)));for(const t of this.pendingAdds)t.graphics.delete(e.uid),0===t.graphics.size&&t.task.abort()}removeFromSource(e,t){const n=t.uid;e.featureStore.has(n)&&e.featureStore.removeById(t.uid)}destroySource(e){e.queryEngine.destroy(),this.sources[e.type]=null}mapSources(e){const{point:t,polygon:n,polyline:i,multipoint:r}=this.sources,a=[];return Object(s.k)(t)&&a.push(e(t)),Object(s.k)(n)&&a.push(e(n)),Object(s.k)(i)&&a.push(e(i)),Object(s.k)(r)&&a.push(e(r)),a}};Object(i.a)([Object(r.b)({constructOnly:!0})],S.prototype,"spatialReference",void 0),Object(i.a)([Object(r.b)({constructOnly:!0})],S.prototype,"layerSource",void 0),Object(i.a)([Object(r.b)({constructOnly:!0})],S.prototype,"view",void 0),Object(i.a)([Object(r.b)({readOnly:!0})],S.prototype,"updating",null),Object(i.a)([Object(r.b)({readOnly:!0})],S.prototype,"availability",void 0),S=Object(i.a)([Object(a.a)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],S);const w="OBJECTID"},548:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(108),s=n(336),r=n(204),a=n(96),o=n(122),c=n(247);function d(e){if(!e)return null;if("mesh"===e.type)return e.toJSON();let t=null;const n=e.spatialReference,o=Object(i.d)(n);if(!o)return e.toJSON();const d=n.isWebMercator?102100:4326,p=c.a[d].maxX,h=c.a[d].minX,m=c.a[d].plus180Line,x=c.a[d].minus180Line;let b;const g=e.toJSON();if(Object(a.f)(g))b=l(g,p,h);else if(Object(a.e)(g))g.points=g.points.map((e=>l(e,p,h))),b=g;else if(Object(a.d)(g))b=u(g,o);else if(Object(a.g)(g)||Object(a.h)(g)){const e=y;Object(r.a)(e,g);const n={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=Object(c.d)(n.xmin,h)*(2*p),a=0===i?g:function(e,t){const n=Object(c.b)(e);for(const i of n)for(const e of i)e[0]+=t;return e}(g,i);n.xmin+=i,n.xmax+=i,Object(s.a)(n,m)&&n.xmax!==p||Object(s.a)(n,x)&&n.xmin!==h?t=a:b=a}else b=e.toJSON();return null!==t?(new f).cut(t,p):b}function u(e,t){if(!t)return e;const n=function(e,t){const n=[],{ymin:i,ymax:s}=e,r=e.xmax-e.xmin,a=e.xmin,o=e.xmax;let c;const[d,u]=t.valid;c=p(e.xmin,t);const l=c.x,m=c.frameId;c=p(e.xmax,t);const f=c.x,y=c.frameId,x=l===f&&r>0;if(r>2*u){const e={xmin:a<o?l:f,ymin:i,xmax:u,ymax:s},t={xmin:d,ymin:i,xmax:a<o?f:l,ymax:s},r={xmin:0,ymin:i,xmax:u,ymax:s},c={xmin:d,ymin:i,xmax:0,ymax:s},p=[],x=[];h(e,r)&&p.push(m),h(e,c)&&x.push(m),h(t,r)&&p.push(y),h(t,c)&&x.push(y);for(let n=m+1;n<y;n++)p.push(n),x.push(n);n.push({extent:e,frameIds:[m]},{extent:t,frameIds:[y]},{extent:r,frameIds:p},{extent:c,frameIds:x})}else l>f||x?n.push({extent:{xmin:l,ymin:i,xmax:u,ymax:s},frameIds:[m]},{extent:{xmin:d,ymin:i,xmax:f,ymax:s},frameIds:[y]}):n.push({extent:{xmin:l,ymin:i,xmax:f,ymax:s},frameIds:[m]});return n}(e,t).map((e=>e.extent));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function l(e,t,n){if(Array.isArray(e)){const i=e[0];if(i>t){const n=Object(c.d)(i,t);e[0]=i+n*(-2*t)}else if(i<n){const t=Object(c.d)(i,n);e[0]=i+t*(-2*n)}}else{const i=e.x;if(i>t){const n=Object(c.d)(i,t);e.x+=n*(-2*t)}else if(i<n){const t=Object(c.d)(i,n);e.x+=t*(-2*n)}}return e}function p(e,t){const[n,i]=t.valid,s=2*i;let r,a=0;return e>i?(r=Math.ceil(Math.abs(e-i)/s),e-=r*s,a=r):e<n&&(r=Math.ceil(Math.abs(e-n)/s),e+=r*s,a=-r),{x:e,frameId:a}}function h(e,t){const{xmin:n,ymin:i,xmax:s,ymax:r}=t;return m(e,n,i)&&m(e,n,r)&&m(e,s,r)&&m(e,s,i)}function m(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}class f{cut(e,t){let n;if(e.rings)this.closed=!0,n=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,n=e.paths,this.minPts=2}const i=n.length,s=-2*t;for(let r=0;r<i;r++){const e=n[r];if(e&&e.length>=this.minPts){const t=[];for(const n of e)t.push([n[0]+s,n[1]]);n.push(t)}}return this.closed?e.rings=n:e.paths=n,e}}const y=Object(o.i)()},864:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(526),s=n(689),r=n(547);class a extends s.a{constructor(e){super({...e,constraint:new r.b(e.coordinateHelper,e.edgeStart,e.edgeEnd)})}get hints(){return[new i.a(1,this.constraint.start,this.constraint.end)]}}var o=n(658);class c extends s.a{constructor(e){super({...e,constraint:new r.d(e.coordinateHelper,e.targetPoint)})}get hints(){return[new o.a(this.targetPoint)]}}function d(e,t){switch(e.type){case"edge":return new a({coordinateHelper:t,edgeStart:t.fromPoint(e.start),edgeEnd:t.fromPoint(e.end),targetPoint:t.fromPoint(e.target),objectId:e.objectId});case"vertex":return new c({coordinateHelper:t,targetPoint:t.fromPoint(e.target),objectId:e.objectId})}}}}]);
//# sourceMappingURL=184.839b680a.chunk.js.map