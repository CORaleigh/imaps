"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[1421],{41421:(e,t,s)=>{s.r(t),s.d(t,{default:()=>X});var i=s(27366),r=s(66978),a=s(68860),n=s(8025),l=(s(63780),s(93169),s(25243),s(49861)),o=s(69912),u=s(69407),h=s(100),c=s(92026),m=s(94172),d=s(79803),p=s(77671),_=(s(59486),s(52639)),v=(s(59166),s(51508),s(5163)),y=s(2170),b=s(15559),w=s(93655),g=s(50951),f=s(59968),C=s(74229),M=s(2346),L=s(45900),k=s(41201),A=s(36257),S=s(7882),D=s(61459),Z=s(16851),O=s(58009),G=s(73268),T=s(16072),I=s(29909),V=s(78952),$=s(80885);const q=1e5;let U=class extends L.m{constructor(e){super(e),this._drawActive=!1,this._handles=new h.Z,this._measurementLayer=new w.Z({internal:!0,listMode:"hide",visible:!1}),this._manipulatorLayer=new w.Z({internal:!0,listMode:"hide",visible:!1}),this._vertices=[],this.geodesicDistanceThreshold=1e5,this.measurement=null,this.measurementLabel=null}initialize(){(0,k.ME)("esri/core/t9n/Units").then((e=>{this.messages=e})),this._handles.add((0,A.qe)((async()=>{this.messages=await(0,k.ME)("esri/core/t9n/Units")})));const e=this.view;this._draw=new f.Z({view:e}),e.map.addMany([this._measurementLayer,this._manipulatorLayer]),e.focus(),this._handles.add([(0,m.YP)((()=>[this.unit,this.geodesicDistanceThreshold,this.palette,this.messages]),(()=>{this._vertices.length>0&&this._updateGraphics()}),m.nn)])}destroy(){const{map:e}=this.view;this._draw.view=null,this._draw=(0,c.SC)(this._draw),e.removeMany([this._measurementLayer,this._manipulatorLayer]),this._handles.removeAll(),this._measurementLayer.removeAll(),this._manipulatorLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._handles=(0,c.SC)(this._handles),this._measurementLayer=(0,c.SC)(this._measurementLayer),this._manipulatorLayer=(0,c.SC)(this._manipulatorLayer)}get cursor(){return this._drawActive?"crosshair":null}set editable(e){this._set("editable",e),e||this._draw.reset()}onActivate(){this._drawActive||0!==this._vertices.length||this._startSketch()}onShow(){this._measurementLayer.visible=!0,this._manipulatorLayer.visible=!0}onHide(){this._measurementLayer.visible=!1,this._manipulatorLayer.visible=!1}reset(){this._vertices=[],this._measurementLayer.removeAll(),this._set("measurement",null),this._set("measurementLabel",null),this._draw.reset(),this._drawActive=!1,this._updateSketch([])}_startSketch(){this._drawActive=!0;const e=this._draw.create("polyline",{mode:"click"});e.on(["vertex-add","vertex-update","vertex-remove","cursor-update","undo","redo"],(e=>this._updateSketch(e.vertices))),e.on("draw-complete",(()=>this._stopSketch()))}_stopSketch(){if(this._vertices.length<3)return this.reset(),void this._startSketch();this.manipulators.forEach((e=>{e.manipulator.interactive=!0})),this._drawActive=!1,this.finishToolCreation()}_updateSketch(e){if(x(this.view.spatialReference)&&!(0,d.kR)())return;if(e.length<2)return this._vertices=[],this.manipulators.removeAll(),void this._measurementLayer.removeAll();const t=this.view.spatialReference;for(;this._vertices.length>e.length;){const{manipulatorId:e}=this._vertices.pop();this.manipulators.remove(e)}for(let l=this._vertices.length;l<e.length;l++){const[s,i]=e[l],r=W(new S.Z({x:s,y:i,spatialReference:t}),this.view,this._manipulatorLayer,this.palette),a=this.manipulators.add(r);(0,C.Xd)(r,((e,t)=>{t.next((0,C.Cf)(this.view)).next((0,C.a9)(e.graphic,g.JY.Local)).next((()=>{const t=e.graphic.geometry;this._vertices[l].coord=[t.x,t.y],this._updateGraphics()}))})),this._vertices.push({manipulatorId:a,coord:[s,i]})}const s=this._vertices.length-1,i=this._vertices[s],[r,a]=e[s];if(i.coord[0]!==r||i.coord[1]!==a){i.coord=[r,a];const e=new S.Z({x:r,y:a,spatialReference:t});this.manipulators.findById(i.manipulatorId).graphic.geometry=e}const n=this._drawActive?this._vertices[s].manipulatorId:null;this.manipulators.forEach((e=>{e.manipulator.interactive=null==n||e.id!==n})),this._updateGraphics()}_updateGraphics(){const e=function(e,t,s){if(2===e.length){const i=new I.Z({paths:e,spatialReference:t});let r;if(t.isGeographic)if((0,b.Gb)(t))r=(0,b.j2)(i,q);else{const e=(0,d.iV)(i,V.Z.WGS84),s=(0,b.j2)(e,q);r=(0,d.iV)(s,t)}else if(t.isWebMercator)r=(0,y.geodesicDensify)(i,q,"meters");else if((0,y.planarLength)(i,"meters")>=s){const e=(0,d.iV)(i,V.Z.WGS84),s=(0,b.j2)(e,q);r=(0,d.iV)(s,t)}else r=i;return{measurement:null,fillGeometry:null,outlineGeometry:r}}e.push(e[0]);const i=new I.Z({paths:[e],spatialReference:t}),r=new $.Z({rings:[e],spatialReference:t});let a,n,l=null,o=null;if(t.isGeographic)if((0,b.Gb)(t)){if(l=(0,b.j2)(i,q),o=(0,b.j2)(r,q),o=(0,y.simplify)(o),!o)return null;a=(0,b.Jf)([i],"meters")[0],n=(0,b.p8)([o],"square-meters")[0]}else{const e=V.Z.WGS84,s=(0,d.iV)(i,e),u=(0,d.iV)(r,e);if(l=(0,b.j2)(s,q),o=(0,b.j2)(u,q),o=(0,y.simplify)(o),!o)return null;a=(0,b.Jf)([s],"meters")[0],n=(0,b.p8)([o],"square-meters")[0],l=(0,d.iV)(l,t),o=(0,d.iV)(o,t)}else if(t.isWebMercator){if(l=(0,y.geodesicDensify)(i,q,"meters"),o=(0,y.geodesicDensify)(r,q,"meters"),o=(0,y.simplify)(o),!o)return null;a=(0,y.geodesicLength)(i,"meters"),n=(0,y.geodesicArea)(o,"square-meters")}else{const e=(0,y.planarLength)(i,"meters");if(e>=s){const e=V.Z.WGS84,s=(0,d.iV)(i,e),u=(0,d.iV)(r,e);if(l=(0,b.j2)(s,q),o=(0,b.j2)(u,q),o=(0,y.simplify)(o),!o)return null;a=(0,b.Jf)([s],"meters")[0],n=(0,b.p8)([o],"square-meters")[0],l=(0,d.iV)(l,t),o=(0,d.iV)(o,t)}else{if(l=i,o=(0,y.simplify)(r),!o)return null;a=e,n=(0,y.planarArea)(o,"square-meters")}}return{measurement:{geometry:o,area:n,perimeter:a},fillGeometry:o,outlineGeometry:l}}(this._vertices.map((e=>e.coord)),this.view.spatialReference,this.geodesicDistanceThreshold);if(!e)return;const{measurement:t,fillGeometry:s,outlineGeometry:i}=e;this._set("measurement",t);const r=t?function(e,t,s){if(!t||!e)return null;const i={area:null,perimeter:null},{area:r,perimeter:n}=t;switch(s){case"metric":i.area=(0,v.ld)(e,r,"square-meters");break;case"imperial":i.area=(0,v.yc)(e,r,"square-meters");break;default:{const t=(0,a.En)(r,"square-meters",s);i.area=(0,v.VG)(e,t,s);break}}const l=function(e){switch(e){case"metric":case"ares":case"hectares":return"metric";case"imperial":case"acres":return"imperial";case"square-inches":return"inches";case"square-feet":return"feet";case"square-yards":return"yards";case"square-miles":return"miles";case"square-us-feet":return"us-feet";case"square-meters":return"meters";case"square-kilometers":return"kilometers";case"square-millimeters":return"millimeters";case"square-centimeters":return"centimeters";case"square-decimeters":return"decimeters";default:return null}}(s);if(l)switch(l){case"metric":i.perimeter=(0,v.Rd)(e,n,"meters");break;case"imperial":i.perimeter=(0,v.Ud)(e,n,"meters");break;default:{const t=(0,a.En)(n,"meters",l);i.perimeter=(0,v.VG)(e,t,l);break}}else i.perimeter="";return i}(this.messages,t,this.unit):null;if(this._set("measurementLabel",r),!s&&!i)return;let n,l,o;const{graphics:u}=this._measurementLayer;if(3===u.length)n=u.getItemAt(0),l=u.getItemAt(1),o=u.getItemAt(2);else{const{fillColor:e,pathColor:t,pathWidth:s}=this.palette;n=new _.Z({symbol:new D.Z({color:e,outline:null})}),l=new _.Z({symbol:new Z.Z({color:t,width:s})}),o=new _.Z({symbol:new O.Z({color:[255,255,255,1],font:new G.Z({size:14,family:"sans-serif"}),haloColor:[0,0,0,.5],haloSize:2})}),u.removeAll(),u.addMany([n,l,o])}n.geometry=s,l.geometry=i,o.geometry=s?.centroid,o.symbol.text=r?.area}};function W(e,t,s,i){const r=new T.Z({style:"circle",color:i.handleColor,size:i.handleWidth,outline:{type:"simple-line",width:0}}),a=new T.Z({style:"circle",color:i.handleColor,size:1.5*i.handleWidth,outline:{type:"simple-line",width:0}}),n=new _.Z({geometry:e,symbol:r});return new M.L({view:t,layer:s,graphic:n,focusedSymbol:a})}function x(e){if(!e)return!1;const{isGeographic:t,isWebMercator:s,isWGS84:i}=e;return t&&!i&&!(0,b.Gb)(e)||!t&&!s}(0,i._)([(0,l.Cb)()],U.prototype,"_drawActive",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],U.prototype,"cursor",null),(0,i._)([(0,l.Cb)({value:!0})],U.prototype,"editable",null),(0,i._)([(0,l.Cb)({type:Number})],U.prototype,"geodesicDistanceThreshold",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],U.prototype,"measurement",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],U.prototype,"measurementLabel",void 0),(0,i._)([(0,l.Cb)()],U.prototype,"messages",void 0),(0,i._)([(0,l.Cb)()],U.prototype,"palette",void 0),(0,i._)([(0,l.Cb)()],U.prototype,"unit",void 0),(0,i._)([(0,l.Cb)({constructOnly:!0})],U.prototype,"view",void 0),U=(0,i._)([(0,o.j)("esri.widgets.AreaMeasurement2D.AreaMeasurement2DTool")],U);var R=s(32845);const j={handleWidth:8,handleColor:[255,128,0,.5],pathWidth:2,pathColor:[255,128,0,1],fillColor:[255,128,0,.3]};let E=class extends R.V{constructor(e){super(e),this.supportedViewType="2d",this.unsupportedErrorMessage="AreaMeasurement2DViewModel is only supported in 2D views.",this._handles=new h.Z,this.geodesicDistanceThreshold=1e5,this.measurement=null,this.measurementLabel=null,this.palette=j}initialize(){this._handles.add([(0,m.YP)((()=>(0,c.Wg)(this.view)?.spatialReference),(()=>this.clear())),(0,m.YP)((()=>this.unit),(e=>{(0,c.pC)(this.tool)&&(this.tool.unit=e)}),m.nn),(0,m.YP)((()=>this.geodesicDistanceThreshold),(e=>{(0,c.pC)(this.tool)&&(this.tool.geodesicDistanceThreshold=e)}),m.nn),(0,m.YP)((()=>this.palette),(e=>{(0,c.pC)(this.tool)&&(this.tool.palette=e)}),m.nn)])}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}get state(){return this.disabled||(0,c.Wi)(this.view)||null==this.view.spatialReference?"disabled":(0,c.pC)(this.tool)&&this.tool.measurement?this.tool.active?"measuring":"measured":"ready"}get unit(){return this._validateUnit(this.defaultUnit)}set unit(e){void 0!==e?this._override("unit",this._validateUnit(e)):this._clearOverride("unit")}get unitOptions(){return a.fN}set unitOptions(e){void 0!==e?this._override("unitOptions",this._validateUnits(e)):this._clearOverride("unitOptions")}async start(){const e=this.view;(0,c.pC)(e)&&(await(0,m.N1)((()=>e.ready)),x(e.spatialReference)&&await(0,d.zD)()),this.createTool({interactive:!0})}clear(){this.removeTool()}constructTool(){return new U({view:(0,c.Wg)(this.view),visible:this.visible,geodesicDistanceThreshold:this.geodesicDistanceThreshold,palette:this.palette,unit:this.unit})}_validateUnit(e){return this.unitOptions.includes(e)?e:this.unitOptions.includes(this.defaultUnit)?this.defaultUnit:this.unitOptions[0]}_validateUnits(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>a.fN.includes(e)));return 0===e.length?a.fN.slice():e}};(0,i._)([(0,l.Cb)(p.Y)],E.prototype,"defaultUnit",void 0),(0,i._)([(0,l.Cb)({type:Number})],E.prototype,"geodesicDistanceThreshold",void 0),(0,i._)([(0,l.Cb)({readOnly:!0,aliasOf:"tool.measurement"})],E.prototype,"measurement",void 0),(0,i._)([(0,l.Cb)({readOnly:!0,aliasOf:"tool.measurementLabel"})],E.prototype,"measurementLabel",void 0),(0,i._)([(0,l.Cb)()],E.prototype,"palette",void 0),(0,i._)([(0,l.Cb)({readOnly:!0})],E.prototype,"state",null),(0,i._)([(0,l.Cb)({type:String})],E.prototype,"unit",null),(0,i._)([(0,l.Cb)({type:[String]})],E.prototype,"unitOptions",null),E=(0,i._)([(0,o.j)("esri.widgets.AreaMeasurement2D.AreaMeasurement2DViewModel")],E);const z=E;var B=s(78088),Y=s(80532),N=s(67005);s(80975);const P="esri-area-measurement-2d",J={buttonDisabled:"esri-button--disabled",widgetIcon:"esri-icon-measure-area",base:`${P} esri-widget esri-widget--panel`,container:`${P}__container`,hint:`${P}__hint`,hintText:`${P}__hint-text`,panelError:`${P}__panel--error`,measurement:`${P}__measurement`,measurementItem:`${P}__measurement-item`,measurementItemDisabled:`${P}__measurement-item--disabled`,measurementItemTitle:`${P}__measurement-item-title`,measurementItemValue:`${P}__measurement-item-value`,settings:`${P}__settings`,units:`${P}__units`,unitsLabel:`${P}__units-label`,unitsSelect:`${P}__units-select esri-select`,unitsSelectWrapper:`${P}__units-select-wrapper`,actionSection:`${P}__actions`,newMeasurementButton:`${P}__clear-button esri-button esri-button--primary`};let H=class extends u.Z{constructor(e,t){super(e,t),this.active=null,this.iconClass=J.widgetIcon,this.label=void 0,this.messages=null,this.messagesUnits=null,this.unit=null,this.unitOptions=null,this.view=null,this.viewModel=new z}render(){const{id:e,viewModel:t,visible:s}=this,{active:i,supported:r,measurementLabel:n,state:l,unit:o,unitOptions:u}=t,h="disabled"===l,c="ready"===l,m="measuring"===l||"measured"===l,{messages:d,messagesUnits:p}=this,_=i&&c?(0,N.u)("section",{key:"hint",class:J.hint},(0,N.u)("p",{class:J.hintText},d.hint)):null,v=r?null:(0,N.u)("section",{key:"unsupported",class:J.panelError},(0,N.u)("p",null,d.unsupported)),y=(e,t,s)=>t?(0,N.u)("div",{key:`${s}-enabled`,class:J.measurementItem},(0,N.u)("span",{class:J.measurementItemTitle},e),(0,N.u)("span",{class:J.measurementItemValue},t)):(0,N.u)("div",{key:`${s}-disabled`,class:this.classes(J.measurementItem,J.measurementItemDisabled),"aria-disabled":"true"},(0,N.u)("span",{class:J.measurementItemTitle},e)),b=m?(0,N.u)("section",{key:"measurement",class:J.measurement},y(d.area,n.area,"area"),y(d.perimeter,n.perimeter,"perimeter")):null,w=`${e}__units`,g=(0,N.u)("section",{key:"units",class:J.units},(0,N.u)("label",{class:J.unitsLabel,for:w},d.unit),(0,N.u)("div",{class:J.unitsSelectWrapper},(0,N.u)("select",{class:J.unitsSelect,id:w,onchange:this._changeUnit,bind:this,value:o},u.map((e=>(0,N.u)("option",{key:e,value:e},(0,a.ZO)(e)?p.systems[e]:p.units[e]?.pluralCapitalized)))))),f=m?(0,N.u)("div",{key:"settings",class:J.settings},g):null,C=!r||i&&!m?null:(0,N.u)("div",{class:J.actionSection},(0,N.u)("button",{disabled:h,class:this.classes(J.newMeasurementButton,h&&J.buttonDisabled),bind:this,onclick:this._newMeasurement,title:d.newMeasurement,type:"button","aria-label":d.newMeasurement},d.newMeasurement)),M=s?(0,N.u)("div",{class:J.container},v,_,f,b,C):null;return(0,N.u)("div",{class:J.base},M)}_newMeasurement(){(0,r.R8)(this.viewModel.start())}_changeUnit(e){const t=e.target,s=t.options[t.selectedIndex];s&&(this.viewModel.unit=s.value)}};(0,i._)([(0,n.B)("viewModel.active")],H.prototype,"active",void 0),(0,i._)([(0,l.Cb)()],H.prototype,"iconClass",void 0),(0,i._)([(0,l.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],H.prototype,"label",void 0),(0,i._)([(0,l.Cb)(),(0,Y.H)("esri/widgets/AreaMeasurement2D/t9n/AreaMeasurement2D")],H.prototype,"messages",void 0),(0,i._)([(0,l.Cb)(),(0,Y.H)("esri/core/t9n/Units")],H.prototype,"messagesUnits",void 0),(0,i._)([(0,l.Cb)()],H.prototype,"uiStrings",void 0),(0,i._)([(0,n.B)("viewModel.unit")],H.prototype,"unit",void 0),(0,i._)([(0,n.B)("viewModel.unitOptions")],H.prototype,"unitOptions",void 0),(0,i._)([(0,n.B)("viewModel.view")],H.prototype,"view",void 0),(0,i._)([(0,l.Cb)({type:z})],H.prototype,"viewModel",void 0),(0,i._)([(0,n.B)("viewModel.visible")],H.prototype,"visible",void 0),(0,i._)([(0,B.h)()],H.prototype,"_newMeasurement",null),(0,i._)([(0,B.h)()],H.prototype,"_changeUnit",null),H=(0,i._)([(0,o.j)("esri.widgets.AreaMeasurement2D")],H);const X=H}}]);
//# sourceMappingURL=1421.fdd69d5d.chunk.js.map