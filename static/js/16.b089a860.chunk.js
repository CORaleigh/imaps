(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[16,231,285],{1003:function(e,t,i){"use strict";i.d(t,"a",(function(){return Z}));var r=i(107),n=i(85),a=i(102),s=i(289),o=i(304),c=i(135),l=i(168),h=i(146),u=i(215),d=i(111),p=i(101);function f(e){return(t=e)instanceof Float32Array&&t.length>=16||function(e){return Array.isArray(e)&&e.length>=16}(e);var t}var b=i(123),g=i(409),m=i(445),v=i(802),O=i(375),y=i(654),_=i(220),j=i(514),x=i(348),w=i(385),M=i(718),S=i(81),E=i(256),T=i(626),P=i(719),A=i(319),C=i(754),D=i(278),R=i(497),I=i(638),z=i(394),L=i(325),V=i(334),F=i(341),k=i(327),G=i(362),U=i(326),B=i(174);class N extends V.a{initializeProgram(e){const t=N.shader.get(),i=this.configuration,r=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new U.a(e.rctx,r,k.a)}bindPass(e,t){Object(z.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),Object(T.b)(this.program,e,t),Object(I.b)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),Object(z.f)(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(C.a)(this.program,t),Object(D.a)(this.program,t)):(Object(P.b)(this.program,t),Object(M.c)(this.program,e,t.camera.pixelRatio||1),Object(R.b)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&Object(A.b)(this.program,t)}bindDraw(e){Object(z.d)(this.program,e),Object(z.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(E.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e,n=this.configuration.polygonOffsetEnabled&&H,a=(i||r)&&4!==t.output?(t.depthEnabled||6===t.output)&&B.d:null;return Object(B.f)({blending:0===t.output||7===t.output||4===t.output?i?q:Object(G.a)(e):null,depthTest:{func:515},depthWrite:a,colorWrite:B.c,polygonOffset:n})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}N.shader=new L.a(M.a,(()=>i.e(307).then(i.bind(null,1301))));const H={factor:0,units:-4},q=Object(B.h)(1,771);class W extends F.a{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!0,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(S.a)([Object(F.b)({count:8})],W.prototype,"output",void 0),Object(S.a)([Object(F.b)()],W.prototype,"occlusionTestEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"sdf",void 0),Object(S.a)([Object(F.b)()],W.prototype,"vvSize",void 0),Object(S.a)([Object(F.b)()],W.prototype,"vvColor",void 0),Object(S.a)([Object(F.b)()],W.prototype,"verticalOffset",void 0),Object(S.a)([Object(F.b)()],W.prototype,"screenSizePerspective",void 0),Object(S.a)([Object(F.b)({count:2})],W.prototype,"screenCenterOffsetUnitsEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"debugDrawBorder",void 0),Object(S.a)([Object(F.b)()],W.prototype,"binaryHighlightOcclusion",void 0),Object(S.a)([Object(F.b)()],W.prototype,"slicePlaneEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"polygonOffsetEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"depthEnabled",void 0),Object(S.a)([Object(F.b)({count:4})],W.prototype,"transparencyPassType",void 0),Object(S.a)([Object(F.b)()],W.prototype,"pixelSnappingEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"isDraped",void 0),Object(S.a)([Object(F.b)()],W.prototype,"multipassGeometryEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"multipassTerrainEnabled",void 0),Object(S.a)([Object(F.b)()],W.prototype,"cullAboveGround",void 0);class Z extends O.a{constructor(e){super(e,be),this.techniqueConfig=new W}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,a,s,o,c){c?this.intersectDrapedHudGeometry(e,a,s,o):this.intersectHudGeometry(e,t,i,r,s,o)}intersectDrapedHudGeometry(e,t,i,r){const a=e.vertexAttributes.get("position"),s=e.vertexAttributes.get("size"),o=this.params,c=Object(M.d)(o);let l=1,h=1;if(Object(n.k)(r)){const e=r(he);l=e[0],h=e[5]}l*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=de*e.screenToWorldRatio;for(let n=0;n<a.data.length/a.size;n++){const r=n*a.size,d=a.data[r],p=a.data[r+1],f=n*s.size;let b;pe[0]=s.data[f]*l,pe[1]=s.data[f+1]*h,o.textureIsSignedDistanceField&&(b=o.outlineSize*e.screenToWorldRatio/2),Q(t,d,p,pe,u,b,o,c)&&i()}}intersectHudGeometry(e,t,i,r,a,o){if(!r.options.selectionMode||!r.options.hud)return;if(Object(w.e)(t))return;const l=this.params;let h=1,u=1;if(Object(s.f)(ae,i),Object(n.k)(o)){const e=o(he);h=e[0],u=e[5],function(e){const t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8],h=1/Math.sqrt(t*t+i*i+r*r),u=1/Math.sqrt(n*n+a*a+s*s),d=1/Math.sqrt(o*o+c*c+l*l);e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=n*u,e[4]=a*u,e[5]=s*u,e[6]=o*d,e[7]=c*d,e[8]=l*d}(ae)}const f=e.vertexAttributes.get("position"),b=e.vertexAttributes.get("size"),g=e.vertexAttributes.get("normal"),m=e.vertexAttributes.get("auxpos1");Object(_.a)(f.size>=3);const v=r.point,O=r.camera,j=Object(M.d)(l);h*=O.pixelRatio,u*=O.pixelRatio;const x="screen"===this.params.centerOffsetUnits;for(let n=0;n<f.data.length/f.size;n++){const e=n*f.size;Object(d.w)(ee,f.data[e],f.data[e+1],f.data[e+2]),Object(d.q)(ee,ee,i);const t=n*b.size;pe[0]=b.data[t]*h,pe[1]=b.data[t+1]*u,Object(d.q)(ee,ee,O.viewMatrix);const s=n*m.size;if(Object(d.w)(ce,m.data[s+0],m.data[s+1],m.data[s+2]),!x&&(ee[0]+=ce[0],ee[1]+=ce[1],0!==ce[2])){const e=ce[2];Object(d.r)(ce,ee),Object(d.j)(ee,ee,Object(d.e)(ce,ce,e))}const o=n*g.size;if(Object(d.w)(te,g.data[o],g.data[o+1],g.data[o+2]),this.normalAndViewAngle(te,ae,O,le),this.applyVerticalOffsetTransformationView(ee,le,O,K),O.applyProjection(ee,ie),ie[0]>-1){let e=Math.floor(ie[0])+this.params.screenOffset[0],t=Math.floor(ie[1])+this.params.screenOffset[1];x&&(e+=ce[0],0!==ce[1]&&(t+=Object(y.b)(ce[1],K.factorAlignment))),Object(y.a)(pe,K.factor,pe);const i=ue*O.pixelRatio;let n;if(l.textureIsSignedDistanceField&&(n=l.outlineSize*O.pixelRatio/2),Q(v,e,t,pe,i,n,l,j)){const e=r.ray;if(Object(d.q)(ne,ee,Object(c.c)(oe,O.viewMatrix)),ie[0]=v[0],ie[1]=v[1],O.unprojectFromRenderScreen(ie,ee)){const t=Object(p.e)();Object(d.k)(t,e.direction);const i=1/Object(d.p)(t);Object(d.e)(t,t,i),a(Object(d.m)(e.origin,ee)*i,t,-1,1,!0,ne)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get("position"),n=e.indices.get("position");return Object(m.b)(r,n,t)}createBufferWriter(){return new me(this)}normalAndViewAngle(e,t,i,r){return f(t)&&(t=Object(s.f)(se,t)),Object(d.x)(r.normal,e,t),Object(d.q)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Object(d.h)(re,fe),r}updateScaleInfo(e,t,i){const r=this.params;r.screenSizePerspective?Object(y.c)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?Object(y.c)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,n,a,s){const o=this.normalAndViewAngle(t,i,n,le);return this.applyVerticalGroundOffsetView(e,o,n,s),this.applyVerticalOffsetTransformationView(s,o,n,a),this.applyPolygonOffsetView(s,o,r[3],n,s),this.applyCenterOffsetView(s,r,s),s}applyShaderOffsetsNDC(e,t,i,r,a){return this.applyCenterOffsetNDC(e,t,i,r),Object(n.k)(a)&&Object(d.k)(a,r),this.applyPolygonOffsetNDC(r,t,i,r),r}applyPolygonOffsetView(e,t,i,n,a){const s=n.aboveGround?1:-1;let o=Object(r.t)(i);0===o&&(o=s);const c=s*o;if(this.params.shaderPolygonOffset<=0)return Object(d.k)(a,e);const l=Object(r.f)(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-l*l)/l/n.viewport[2];return Object(d.e)(a,e,c>0?h:1/h),a}applyVerticalGroundOffsetView(e,t,i,r){const n=Object(d.p)(e),a=i.aboveGround?1:-1,s=.5*i.computeRenderPixelSizeAtDist(n),o=Object(d.e)(ee,t.normal,a*s);return Object(d.f)(r,e,o),r}applyVerticalOffsetTransformationView(e,t,i,r){const n=this.params;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const i=Object(d.p)(e);this.updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=Object(d.p)(e),s=n.screenSizePerspectiveAlignment||n.screenSizePerspective,o=Object(x.i)(i,a,n.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(r,a,t.cosAngle),Object(d.e)(t.normal,t.normal,o),Object(d.f)(e,e,t.normal)}applyCenterOffsetView(e,t,i){const r="screen"!==this.params.centerOffsetUnits;return i!==e&&Object(d.k)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&(Object(d.r)(te,i),Object(d.f)(i,i,Object(d.e)(te,te,t[2])))),i}applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.params.centerOffsetUnits;return r!==e&&Object(d.k)(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}applyPolygonOffsetNDC(e,t,i,n){const a=this.params.shaderPolygonOffset;if(e!==n&&Object(d.k)(n,e),a){const e=i.aboveGround?1:-1,s=e*Object(r.t)(t[3]);n[2]-=(s||e)*a}return n}getGLMaterial(e){return 0===e.output||7===e.output?new Y(e):4===e.output?new X(e):void 0}calculateRelativeScreenBounds(e,t,i=Object(b.l)()){return function(e,t,i,r=J){Object(h.c)(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.params,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class $ extends v.a{constructor(e){super({...e,...e.material.params}),this.updateParameters()}beginSlot(e){return e===(this._material.params.drawInSecondSlot?20:19)||23===e}updateParameters(e){this.updateTexture(this._material.params.textureId),this.selectProgram(e)}selectProgram(e){this._technique=this._techniqueRep.releaseAndAcquire(N,this._material.getTechniqueConfig(this._output,e),this._technique)}ensureParameters(e){this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}}class Y extends ${constructor(e){super(e),this._isOcclusionSlot=!1}beginSlot(e){if(23===e)return!0;const t=this._material.params.drawInSecondSlot?20:19;return this._material.params.occlusionTest?(this._isOcclusionSlot=12===e,12===e||e===t):(this._isOcclusionSlot=!1,e===t)}get technique(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}selectProgram(e){this._technique=this._techniqueRep.releaseAndAcquire(N,this._material.getTechniqueConfig(this._output,e),this._technique),this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(N,this._material.getTechniqueConfig(6,e),this._occlusionTechnique)}bind(e){const t=this.technique;this._isOcclusionSlot||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.params,e)}}class X extends ${constructor(e){super({...e,output:4})}}function Q(e,t,i,r,n,a,s,o){let c=t-n-(o[0]>0?r[0]*o[0]:0),l=c+r[0]+2*n,h=i-n-(o[1]>0?r[1]*o[1]:0),u=h+r[1]+2*n;if(s.textureIsSignedDistanceField){const e=s.distanceFieldBoundingBox;c+=r[0]*e[0],h+=r[1]*e[1],l-=r[0]*(1-e[2]),u-=r[1]*(1-e[3]),c-=a,l+=a,h-=a,u+=a}return e[0]>c&&e[0]<l&&e[1]>h&&e[1]<u}const K={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},J=Object(u.a)(),ee=Object(p.e)(),te=Object(p.e)(),ie=Object(a.e)(),re=Object(p.e)(),ne=Object(p.e)(),ae=Object(o.b)(),se=Object(o.b)(),oe=Object(l.d)(),ce=Object(p.e)(),le={normal:re,cosAngle:0},he=Object(l.d)(),ue=1,de=2,pe=[0,0],fe=Object(p.g)(0,0,1),be={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:Object(u.e)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...O.b},ge=Object(g.a)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class me{constructor(e){this.material=e,this.vertexBufferLayout=ge}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,i,r){Object(j.e)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,r,6),Object(j.d)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get("uv0").data;let n,a,s,o;if(null==e||e.length<4){const e=this.material.params;n=0,a=0,s=e.texCoordScale[0],o=e.texCoordScale[1]}else n=e[0],a=e[1],s=e[2],o=e[3];s=Math.min(1.99999,s+1),o=Math.min(1.99999,o+1);const c=t.indices.get("position").length,l=i.uv0;let h=r;for(let t=0;t<c;++t)l.set(h,0,n),l.set(h,1,a),h+=1,l.set(h,0,s),l.set(h,1,a),h+=1,l.set(h,0,s),l.set(h,1,o),h+=1,l.set(h,0,s),l.set(h,1,o),h+=1,l.set(h,0,n),l.set(h,1,o),h+=1,l.set(h,0,n),l.set(h,1,a),h+=1}Object(j.b)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,i.color,r,6);{const e=t.indices.get("size"),n=t.vertexAttributes.get("size").data,a=e.length,s=i.size;let o=r;for(let t=0;t<a;++t){const i=n[2*e[t]],r=n[2*e[t]+1];for(let e=0;e<6;++e)s.set(o,0,i),s.set(o,1,r),o+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&Object(j.a)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,r,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&Object(j.a)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,i.auxpos2,r,6)}}},1006:function(e,t,i){"use strict";i.d(t,"a",(function(){return z}));var r=i(80),n=i(85),a=i(102),s=i(146),o=i(111),c=i(101),l=i(401),h=i(333),u=i(342),d=i(445),p=i(410),f=i(375),b=i(220),g=i(514),m=i(611),v=i(348),O=i(385),y=i(81),_=i(256),j=i(319),x=i(394),w=i(325),M=i(334),S=i(341),E=i(327),T=i(326),P=i(532),A=i(904),C=i(174);class D extends M.a{constructor(e,t,i){super(e,t,i),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=D.shader.get(),i=this.configuration,r=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new T.a(e.rctx,r,E.a)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(x.c)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const{pixelSize:e,sdfNormalizer:i}=Object(n.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1};this.program.setUniform1f("stipplePatternSDFNormalizer",i),this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/(e*t.camera.pixelRatio)),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(n.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}4===this.configuration.output&&Object(j.b)(this.program,t)}bindDraw(e){Object(x.d)(this.program,e),Object(_.c)(this.program,this.configuration,e),this.program.rebindTextures()}initializePipeline(){const e=this.configuration,t=Object(C.g)(770,1,771,771),i=(t,i=null,r=null)=>Object(C.f)({blending:i,depthTest:P.b,depthWrite:r,colorWrite:C.c,stencilWrite:e.sceneHasOcludees?P.h:null,stencilTest:e.sceneHasOcludees?t?P.d:P.c:null});return 0===e.output?(this._occludeePipelineState=i(!0,e.transparent||e.stippleEnabled?t:null,C.d),i(!1,e.transparent||e.stippleEnabled?t:null,C.d)):i(!1)}get primitiveType(){return 1}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}D.shader=new w.a(A.a,(()=>i.e(313).then(i.bind(null,1307))));class R extends S.a{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.sceneHasOcludees=!1}}Object(y.a)([Object(S.b)({count:8})],R.prototype,"output",void 0),Object(y.a)([Object(S.b)()],R.prototype,"slicePlaneEnabled",void 0),Object(y.a)([Object(S.b)()],R.prototype,"vertexColors",void 0),Object(y.a)([Object(S.b)()],R.prototype,"transparent",void 0),Object(y.a)([Object(S.b)()],R.prototype,"draped",void 0),Object(y.a)([Object(S.b)()],R.prototype,"stippleEnabled",void 0),Object(y.a)([Object(S.b)()],R.prototype,"stippleOffColorEnabled",void 0),Object(y.a)([Object(S.b)()],R.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(y.a)([Object(S.b)()],R.prototype,"sceneHasOcludees",void 0);const I=r.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");class z extends f.a{constructor(e){super(e,F),this.techniqueConfig=new R}getTechniqueConfig(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1,this.techniqueConfig.draped=!1;const t=Object(n.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(n.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,r,n,a,s,o,c){c?Object(v.e)(e,r,a,1,s):this.intersectLineGeometry(e,t,i,r,s)}intersectLineGeometry(e,t,i,r,n){if(!r.options.selectionMode||Object(O.e)(t))return;if(!Object(b.g)(i))return void I.error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get("position").data,c=r.camera,u=Y;Object(s.c)(u,r.point);Object(o.w)(X[0],u[0]-2,u[1]+2,0),Object(o.w)(X[1],u[0]+2,u[1]+2,0),Object(o.w)(X[2],u[0]+2,u[1]-2,0),Object(o.w)(X[3],u[0]-2,u[1]-2,0);for(let s=0;s<4;s++)if(!c.unprojectFromRenderScreen(X[s],Q[s]))return;Object(h.f)(c.eye,Q[0],Q[1],K),Object(h.f)(c.eye,Q[1],Q[2],J),Object(h.f)(c.eye,Q[2],Q[3],ee),Object(h.f)(c.eye,Q[3],Q[0],te);let d=Number.MAX_VALUE;for(let s=0;s<a.length-5;s+=3){if(k[0]=a[s]+i[12],k[1]=a[s+1]+i[13],k[2]=a[s+2]+i[14],G[0]=a[s+3]+i[12],G[1]=a[s+4]+i[13],G[2]=a[s+5]+i[14],Object(h.t)(K,k)<0&&Object(h.t)(K,G)<0||Object(h.t)(J,k)<0&&Object(h.t)(J,G)<0||Object(h.t)(ee,k)<0&&Object(h.t)(ee,G)<0||Object(h.t)(te,k)<0&&Object(h.t)(te,G)<0)continue;if(c.projectToRenderScreen(k,N),c.projectToRenderScreen(G,H),N[2]<0&&H[2]>0){Object(o.j)(U,k,G);const e=c.frustum,t=-Object(h.t)(e[4],k)/Object(o.h)(U,Object(h.q)(e[4]));Object(o.e)(U,U,t),Object(o.f)(k,k,U),c.projectToRenderScreen(k,N)}else if(N[2]>0&&H[2]<0){Object(o.j)(U,G,k);const e=c.frustum,t=-Object(h.t)(e[4],G)/Object(o.h)(U,Object(h.q)(e[4]));Object(o.e)(U,U,t),Object(o.f)(G,G,U),c.projectToRenderScreen(G,H)}else if(N[2]<0&&H[2]<0)continue;N[2]=0,H[2]=0;const e=Object(l.e)(Object(l.f)(N,H,Z),u);e<d&&(d=e,Object(o.k)(q,k),Object(o.k)(W,G))}const p=r.rayBeginPoint,f=r.rayEndPoint;if(d<4){let e=Number.MAX_VALUE;if(Object(l.a)(Object(l.f)(q,W,Z),Object(l.f)(p,f,$),B)){Object(o.j)(B,B,p);const t=Object(o.p)(B);Object(o.e)(B,B,1/t),e=t/Object(o.m)(p,f)}n(e,B)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;const r=i.get("position");return Object(d.a)(r,null,!1,t)}createBufferWriter(){const e=this.params.vertexColors?m.b:m.c;return Object(n.j)(this.params.stipplePattern)?new m.a(e):new V(e.clone().vec3f("auxpos1"))}getGLMaterial(e){return 0===e.output||4===e.output?new L(e):void 0}}class L extends p.a{constructor(e){super(e),this.updateParameters()}updateParameters(){this._technique=this._techniqueRep.releaseAndAcquire(D,this._material.getTechniqueConfig(this._output),this._technique)}beginSlot(e){return 3===e||23===e}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}ensureParameters(e){0===this._output&&this._updateOccludeeState(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}class V{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){Object(g.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.writeAuxpos1(e,t,i,r)}writeAuxpos1(e,t,i,r){const n=i.getField("auxpos1",u.u),a=t.indices.get("position"),s=t.vertexAttributes.get("position").data,o=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;r*=c;for(let h=0;h<a.length;h+=2){const e=3*a[h],t=s[e],i=s[e+1],n=s[e+2],u=o[0]*t+o[4]*i+o[8]*n+o[12],d=o[1]*t+o[5]*i+o[9]*n+o[13],p=o[2]*t+o[6]*i+o[10]*n+o[14];for(let a=0;a<2;++a)l[r]=u,l[r+1]=d,l[r+2]=p,r+=c}}}const F={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...f.b},k=Object(c.e)(),G=Object(c.e)(),U=Object(c.e)(),B=Object(c.e)(),N=Object(a.e)(),H=Object(a.e)(),q=Object(c.e)(),W=Object(c.e)(),Z=Object(l.d)(),$=Object(l.d)(),Y=Object(c.e)(),X=[Object(a.e)(),Object(a.e)(),Object(a.e)(),Object(a.e)()],Q=[Object(c.e)(),Object(c.e)(),Object(c.e)(),Object(c.e)()],K=Object(h.d)(),J=Object(h.d)(),ee=Object(h.d)(),te=Object(h.d)()},1007:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var r=i(85),n=i(630),a=i(96),s=i(511),o=i(233),c=i(141),l=i(83);function h(e){return u[function(e){return e instanceof Blob?e.type:function(e){const t=Object(a.n)(e);return f[t]||d}(e.url)}(e)]||p}const u={},d="text/plain",p=u[d],f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const y in f)u[f[y]]=y;var b=i(201);function g(e){const t=Object(r.k)(e)&&e.origins?e.origins:[void 0];return(i,s)=>{const u=function(e,t,i){if(Object(r.k)(e)&&"resource"===e.type)return function(e,t,i){const s=Object(o.b)(t,i);return{type:String,read:(e,t,i)=>{const r=Object(b.d)(e,t,i);return s.type===String?r:"function"==typeof s.type?new s.type({url:r}):void 0},write:{writer(t,o,l,u){if(!u||!u.resources)return"string"==typeof t?void(o[l]=Object(b.e)(t,u)):void(o[l]=t.write({},u));const d=function(e){return Object(r.j)(e)?null:"string"==typeof e?e:e.url}(t),p=d?Object(b.e)(d,{...u,verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},1):null,f=s.type!==String&&(!Object(n.a)(this)||u&&u.origin&&this.originIdOf(i)>Object(c.d)(u.origin));u&&u.portalItem&&Object(r.k)(p)&&!Object(a.s)(p)?f?function(e,t,i,r,n,s,o,c){const l=o.portalItem.resourceFromPath(r),u=O(i,r,o);h(u)===Object(a.n)(l.path)?(v(e,t,l,u,o.resources.toUpdate),n[s]=r):m(e,t,i,r,n,s,o,c)}(this,i,t,p,o,l,u,e):function(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}(p,o,l,u):u&&u.portalItem&&(Object(r.j)(p)||Object(r.k)(Object(b.b)(p))||Object(a.t)(p)||f)?m(this,i,t,p,o,l,u,e):o[l]=p}}}}(e,t,i);switch(Object(r.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:e,write:t}=b.c;return{read:e,write:t}}}}(e,i,s);for(const e of t){const t=Object(l.c)(i,e,s);for(const e in u)t[e]=u[e]}}}function m(e,t,n,o,c,l,u,d){const p=Object(s.a)(),f=O(n,o,u),b=Object(a.z)(Object(r.i)(d,"prefix"),p),g=`${b}.${h(f)}`,m=u.portalItem.resourceFromPath(g);Object(a.t)(o)&&u.resources.pendingOperations.push(async function(e){const t=(await Promise.resolve().then(i.bind(null,100))).default,{data:r}=await t(e,{responseType:"blob"});return r}(o).then((e=>{m.path=`${b}.${h(e)}`,c[l]=m.itemRelativeUrl})).catch((()=>{}))),v(e,t,m,f,u.resources.toAdd),c[l]=m.itemRelativeUrl}function v(e,t,i,r,n){n.push({resource:i,content:r,finish:i=>{!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function O(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}},1046:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return n})),i.d(t,"g",(function(){return l}));i(79);var r=i(220);function n(e,t,i){switch(e){case"circle":return a(t,i);case"square":return s(t,i);case"cross":return c(t,i);case"x":return l(t,i);case"kite":return o(t,i);case"triangle":return h(t,i);default:return a(t,i)}}function a(e,t){const i=e,n=new Uint8Array(4*i*i),a=i/2-.5,s=t/2;for(let o=0;o<i;o++)for(let t=0;t<i;t++){const c=t+i*o,l=t-a,h=o-a;let u=Math.sqrt(l*l+h*h)-s;u=u/e+.5,Object(r.h)(u,n,4*c)}return n}function s(e,t){return u(e,t,!1)}function o(e,t){return u(e,t,!0)}function c(e,t){return d(e,t,!1)}function l(e,t){return d(e,t,!0)}function h(e,t){const i=new Uint8Array(4*e*e),n=-.5,a=Math.sqrt(1.25),s=(e-t)/2;for(let o=0;o<e;o++)for(let c=0;c<e;c++){const l=o*e+c,h=(c-s)/t,u=(o-s+.75)/t,d=-(1*h+n*u)/a,p=(1*(h-1)+n*-u)/a,f=-u,b=Math.max(d,p,f);Object(r.h)(b*t/e+.5,i,4*l)}return i}function u(e,t,i){i&&(t/=Math.SQRT2);const n=new Uint8Array(4*e*e);for(let a=0;a<e;a++)for(let s=0;s<e;s++){let o=s-.5*e+.25,c=.5*e-a-.75;const l=a*e+s;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}let h=Math.max(Math.abs(o),Math.abs(c))-.5*t;h=h/e+.5,Object(r.h)(h,n,4*l)}return n}function d(e,t,i){i&&(t*=Math.SQRT2);const n=.5*t,a=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let t=0;t<e;t++){let o=t-.5*e,c=.5*e-s-1;const l=s*e+t;if(i){const e=(o+c)/Math.SQRT2;c=(c-o)/Math.SQRT2,o=e}let h;o=Math.abs(o),c=Math.abs(c),h=o>c?o>n?Math.sqrt((o-n)*(o-n)+c*c):c:c>n?Math.sqrt(o*o+(c-n)*(c-n)):o,h=h/e+.5,Object(r.h)(h,a,4*l)}return a}},1047:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r=i(117),n=i(85),a=i(135),s=i(168),o=i(111),c=i(101),l=i(226),h=i(556),u=i(261),d=i(624),p=i(421),f=i(480),b=i(629),g=i(547);class m extends d.a{constructor(e){super(e),this._handles=new r.a,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=Object(c.e)(),this._up=Object(c.e)(),this._right=Object(c.e)(),this._renderOccluded=4,this._color=Object(h.c)(1,0,0,1),this._outlineColor=Object(h.c)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Object(l.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(l.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Object(o.m)(t,e),Object(o.m)(t,i))/3,Object(o.r)(this._up,Object(o.j)(this._up,e,t)),Object(o.r)(this._right,Object(o.j)(this._right,i,t)),Object(o.k)(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new b.a(this.quadMaterialParameters),this._outlineMaterial=new g.a(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=Object(o.f)(u.d.get(),this._up,this._right),i=f.a.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);Object(a.j)(v),Object(a.t)(v,v,this._position),Object(a.g)(v,v,[r,r,r]),Object(n.k)(e)&&(e.transformation=v)}_quadGeometryData(e,t){const i=Object(o.f)(u.d.get(),e,t);return new p.a([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const v=Object(s.d)()},1048:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i(113),n=i(271);function a(){const e=new n.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(r.a`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(r.a`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}var s=Object.freeze({__proto__:null,build:a})},1049:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var r=i(256),n=i(376),a=i(311),s=i(278),o=i(331),c=i(367),l=i(113),h=i(271);function u(e){const t=new h.a;return t.include(n.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(l.a`
    void main(void) {
      vpos = position;
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),t.include(r.a,e),e.multipassTerrainEnabled&&(t.fragment.include(a.a),t.include(s.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(l.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${l.a.float(o.b)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(t.fragment.include(c.a),t.fragment.code.add(l.a`
    void main() {
      discardBySlice(vpos);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${l.a.float(o.b)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),t}var d=Object.freeze({__proto__:null,build:u})},1080:function(e,t,i){"use strict";i.d(t,"a",(function(){return A})),i.d(t,"b",(function(){return R}));var r=i(81),n=i(119),a=(i(79),i(122)),s=i(160),o=i(188),c=i(85),l=i(83),h=(i(84),i(80),i(82)),u=i(455),d=(i(98),i(183)),p=i(87),f=i(112),b=i(885),g=i(501),m=i(264),v=i(105),O=i(716),y=i(204),_=i(110),j=i(134),x=i(125);function w(e,t){const i=new _.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function M(e,t,i){const r=new j.a({paths:e,spatialReference:t});return i&&Object(m.i)(r),r}function S(e,t,i,r=!0){const n=Object(p.a)(e);n.forEach((e=>{const t=e[0],i=e[e.length-1];Object(d.c)(t,i)&&1!==e.length||e.push(e[0])}));let a=new x.a({rings:n,spatialReference:t});return a.rings.forEach((e=>{Object(m.g)(e,!1,!1)||e.reverse()})),i&&Object(m.i)(a),r&&a.isSelfIntersecting&&Object(v.l)(t)&&(a=Object(g.simplify)(a)),a}function E(e,t,i){const r=t.mapToLocalMultiple(e),n=[],a={x:r[0].x,y:r[0].y},s=r[1].x,o=r[1].y,l=Math.round(s-a.x),h=Math.round(o-a.y),u=Math.max(Math.abs(l),Math.abs(h));if(i){const e={x:a.x+u,y:a.y+u},t={x:a.x-u,y:a.y-u};n.push(Object(O.b)(e.x,t.y),Object(O.b)(t.x,t.y),Object(O.b)(t.x,e.y),Object(O.b)(e.x,e.y))}else{const e={x:l>0?a.x+u:a.x-u,y:h>0?a.y+u:a.y-u};n.push(Object(O.b)(a.x,a.y),Object(O.b)(e.x,a.y),Object(O.b)(e.x,e.y),Object(O.b)(a.x,e.y))}return S([Object(c.g)(n.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function T(e,t,i,r){const n=t.mapToLocalMultiple(e);let a=null,s=null;if(i)a=n[0],s=n[1];else{const e=n[0],t=n[1],i=Math.round(t.x-e.x),r=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(r));a=Object(O.b)(i>0?e.x+o/2:e.x-o/2,r>0?e.y+o/2:e.y-o/2),s=Object(O.b)(Math.abs(i)>Math.abs(r)?a.x-o/2:a.x,Math.abs(i)>Math.abs(r)?a.y:a.y-o/2)}const o=t.localToMap(a),l=t.localToMap(s);if(Object(c.j)(o)||Object(c.j)(l))return null;t.doUnnormalization&&Object(m.j)([[o,l]],t.spatialReference);const h=w(o,t.spatialReference),u=w(l,t.spatialReference),d=Object(f.f)(t.spatialReference);let p=0;if(Object(v.l)(t.spatialReference))p=d*Object(g.distance)(h,u,null);else{const e=a.x-s.x,t=a.y-s.y;p=d*Math.sqrt(e*e+t*t)*(r||1)}const y=new b.a({center:h,radius:p,radiusUnit:"meters",spatialReference:t.spatialReference});return S(y.rings,y.spatialReference,!1)}var P=i(562);let A=class extends(Object(s.b)(a.a.EventedMixin(P.a))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new u.a({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.complete()}destroy(){this.drawOperation=Object(c.e)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Object(c.e)(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new n.a({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(Object(o.c)((()=>{Object(c.k)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=Object(c.e)(this._graphic))})),C)}_destroyAllVisualisations(){this.handles.remove(D.outline),this.handles.remove(D.regularVertices),this.handles.remove(D.activeVertex),this.handles.remove(C)}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,r=i.slice();Object(c.k)(t)&&r.push(this.drawOperation.coordinateHelper.pointToArray(t));const n=Object(c.k)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null},s=r.length,o=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=i,a.activeVertex=n,a.full=this.drawOperation.coordinateHelper.arrayToPoint(r[0]);break;case"multipoint":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=function(e,t){return new y.a({points:e,spatialReference:t})}(r,o));break;case"polyline":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=M([r],o,l));break;case"polygon":a.regularVertices=i,a.activeVertex=n,s>0&&(a.full=S([r],o,l,!0));break;case"circle":if(s>0){const t=Object(O.a)(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+I*this.view.resolution,e[1]);a.full=T([e,i],t,!0)}else 2===s&&(a.full=this.forceUniformSize?T(r,t,this.centered):function(e,t,i){const r=t.mapToLocalMultiple(e),n=r[0],a=r[1],s=Math.round(a.x-n.x),o=Math.round(a.y-n.y),l=Object(O.b)(i?n.x:n.x+s/2,i?n.y:n.y+o/2),h=i?s:s/2,u=i?o:o/2,d=[],p=2*Math.PI/60;for(let c=0;c<60;c++){const e=Math.cos(c*p),t=Math.sin(c*p),i=Object(O.b)(h*e+l.x,u*t+l.y);d.push(i)}return d.push(d[0]),S([Object(c.g)(d.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}(r,t,this.centered))}break;case"rectangle":if(s>0){const t=Object(O.a)(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],i=t.makeMapPoint(e[0]+I*this.view.resolution,e[1]);a.full=E([e,i],t,!0)}else 2===s&&(a.full=this.forceUniformSize?E(r,t,this.centered):function(e,t,i){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[Object(O.b)(t.x-e,t.y+e),Object(O.b)(t.x+e,t.y-e),Object(O.b)(t.x+e,t.y-e),Object(O.b)(t.x-e,t.y+e)]}const n=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y};if(i){const e=Math.round(s.x-a.x),t=Math.round(s.y-a.y);n.push(Object(O.b)(a.x-e,a.y-t),Object(O.b)(s.x,a.y-t),Object(O.b)(s.x,s.y),Object(O.b)(a.x-e,s.y))}else n.push(Object(O.b)(a.x,a.y),Object(O.b)(s.x,a.y),Object(O.b)(s.x,s.y),Object(O.b)(a.x,s.y));return S([Object(c.g)(n.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}(r,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":s>1&&(a.outline=M([r],o,l));break;case"circle":case"rectangle":Object(c.k)(a.full)&&"polygon"===a.full.type&&(a.outline=S(a.full.rings,o,l))}return a}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});Object(c.k)(e)&&(t=new n.a({geometry:e.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();Object(c.j)(e)?this._destroyAllVisualisations():(Object(c.k)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),D.outline):this.handles.remove(D.outline),Object(c.k)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),D.regularVertices):this.handles.remove(D.regularVertices),Object(c.k)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),D.activeVertex):this.handles.remove(D.activeVertex),Object(c.k)(e.full)?Object(c.j)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(C))}};Object(r.a)([Object(l.b)({value:!0})],A.prototype,"centered",null),Object(r.a)([Object(l.b)({nonNullable:!0})],A.prototype,"defaultZ",void 0),Object(r.a)([Object(l.b)()],A.prototype,"drawOperation",void 0),Object(r.a)([Object(l.b)({value:!0})],A.prototype,"enabled",null),Object(r.a)([Object(l.b)({value:!0})],A.prototype,"forceUniformSize",null),Object(r.a)([Object(l.b)({constructOnly:!0})],A.prototype,"geometryType",void 0),Object(r.a)([Object(l.b)()],A.prototype,"graphic",null),Object(r.a)([Object(l.b)({constructOnly:!0})],A.prototype,"graphicProperties",void 0),Object(r.a)([Object(l.b)()],A.prototype,"graphicSymbol",void 0),Object(r.a)([Object(l.b)({constructOnly:!0})],A.prototype,"hasZ",void 0),Object(r.a)([Object(l.b)({constructOnly:!0})],A.prototype,"mode",void 0),Object(r.a)([Object(l.b)()],A.prototype,"snappingManager",void 0),Object(r.a)([Object(l.b)()],A.prototype,"snapToScene",void 0),Object(r.a)([Object(l.b)({readOnly:!0})],A.prototype,"type",void 0),Object(r.a)([Object(l.b)({readOnly:!0})],A.prototype,"updating",null),Object(r.a)([Object(l.b)({constructOnly:!0,nonNullable:!0})],A.prototype,"view",void 0),A=Object(r.a)([Object(h.a)("esri.views.draw.DrawGraphicTool")],A);const C="create-operation-graphic",D={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function R(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const I=48},113:function(e,t,i){"use strict";function r(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}i.d(t,"a",(function(){return r})),function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(r||(r={}))},1317:function(e,t,i){"use strict";i.r(t),i.d(t,"DrawGraphicTool3D",(function(){return tt})),i.d(t,"GraphicMoveTool",(function(){return Xt})),i.d(t,"GraphicReshapeTool",(function(){return fi})),i.d(t,"GraphicTransformTool",(function(){return Ci})),i.d(t,"ExtentTransformTool",(function(){return Zr}));var r=i(81),n=i(188),a=i(85),s=i(109),o=i(83),c=i(79),l=i(84),h=i(80),u=i(82),d=i(338),p=i(282),f=i(104),b=i(111),g=i(101),m=i(117),v=i(226),O=i(556),y=i(653),_=i(593),j=i(401),x=i(284),w=i(761),M=i(624),S=i(480),E=i(547);class T extends M.a{constructor(e){super(e),this._ray=Object(x.c)(),this._externalResources=null,this._handles=new m.a,this._isWorldDown=!1,this._start=Object(g.e)(),this._end=Object(g.g)(1,0,0),this._width=1,this._color=Object(O.c)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=Object(O.c)(1,1,1,1),this._stippleIntegerRepeats=!0,this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=I,this.applyProps(e)}createExternalResources(){const e=new E.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()})));const t=new w.a({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){Object(a.k)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){Object(a.k)(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[Object(g.e)(),Object(g.e)()],i=3===this.extensionType;i&&t.push(Object(g.e)(),Object(g.e)());const r=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=S.a.createPolylineGeometry(t,null,r);e.addGeometry(n,Object(a.s)(this._externalResources).material),this.updateVertices(n)}updateVisibility(e){super.updateVisibility(e),Object(a.k)(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,Object(b.k)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Object(b.j)(this._end,e,this._end),Object(x.e)(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,Object(b.o)(this._start,e)||(Object(b.k)(this._start,e),Object(x.e)(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,Object(b.o)(this._end,e)||(Object(b.k)(this._end,e),Object(x.e)(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(v.g)(e,this._color)||(Object(v.c)(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(v.g)(e,this._innerColor)||(Object(v.c)(this._innerColor,e),this.updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a.k)(e)!==Object(a.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(a.j)(e)||Object(a.j)(this._stippleOffColor)||!Object(v.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(a.k)(e)?Object(O.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&Object(a.k)(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,Object(a.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,Object(a.k)(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,Object(a.k)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=Object(a.t)(e,I),this.recreateGeometry()}updateMaterial(){Object(a.j)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){Object(a.k)(this.object)&&this.updateVertices(this.object.geometries[0])}updateVertices(e){const t=3===this._extensionType?this.updateLineSegmentFinite(D):this.updateLineSegmentInfinite(this._extensionType,D);this.updateVertexAttributes(e,t),Object(a.k)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}updateLineSegmentFinite(e){return Object(j.f)(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Object(y.c)(this._ray,P),e){case 0:P.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=Object(a.t)(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&Object(b.s)(P.ray.direction,P.ray.direction),2===this._extensionType&&null!=t&&(P.c1=Math.abs(i-t));break}}if(!Object(_.d)(i.frustum,P))return Object(j.f)(this._start,this._end,t);const r=Object(y.e)(P,A),n=Object(y.d)(P,C);return Object(j.f)(r,n,t)}updateVertexAttributes(e,t){const i=e.getMutableAttribute("position").data;if(3===this.extensionType){const e=Object(j.h)(t,-this.fadedExtensions.start,A);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=Object(j.h)(t,0,A);i[3]=r[0],i[4]=r[1],i[5]=r[2];const n=Object(j.h)(t,1,A);i[6]=n[0],i[7]=n[1],i[8]=n[2];const a=Object(j.h)(t,1+this.fadedExtensions.end,A);i[9]=a[0],i[10]=a[1],i[11]=a[2]}else{const e=Object(j.h)(t,0,A);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=Object(j.h)(t,1,A);i[3]=r[0],i[4]=r[1],i[5]=r[2]}Object(a.k)(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}const P=Object(y.a)(),A=Object(g.e)(),C=Object(g.e)(),D=Object(j.d)(),R=1/3,I={start:R,end:R};var z=i(102),L=i(168),V=i(146);class F extends M.a{constructor(e){super(e),this._handles=new m.a,this._location=Object(g.e)(),this._direction=Object(g.g)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=Object(O.c)(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){Object(b.o)(this._location,e)||(Object(b.k)(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){Object(b.o)(this._direction,e)||(Object(b.k)(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,t){Object(b.r)(this._direction,Object(b.j)(this._direction,t,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){Object(v.g)(e,this._color)||(Object(v.c)(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new E.a(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=S.a.createPolylineGeometry([Object(g.e)(),Object(g.e)()]),i=S.a.createPolylineGeometry([Object(g.e)(),Object(g.e)()]),r=Object(a.s)(this._externalResources).material;e.addGeometry(t,r,L.a),e.addGeometry(i,r,L.a),this.updateVertices(e)}forEachExternalMaterial(e){Object(a.k)(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){Object(a.j)(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;Object(a.j)(e)||this.updateVertices(e)}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,G),Object(b.f)(k,this.location,this.direction),t.projectToScreen(k,U),Object(V.f)(U,Object(V.a)(U,U,G)),this.updateVertexAttributes(t,e,0,G,U,1),this.updateVertexAttributes(t,e,1,G,U,-1)}updateVertexAttributes(e,t,i,r,n,a){const s=t.geometryRecords[i].geometry.getMutableAttribute("position").data,o=Object(V.b)(B,Object(V.s)(B,n[1]*a,n[0]*-a),this.offset+this.width/2),c=Object(V.i)(N,Object(V.i)(N,Object(V.i)(N,r,Object(V.b)(N,n,this.length/2)),o),o),l=Object(V.i)(H,c,Object(V.b)(H,n,-this.length));e.unprojectFromScreen(c,k),s[0]=k[0],s[1]=k[1],s[2]=k[2],e.unprojectFromScreen(l,k),s[3]=k[0],s[4]=k[1],s[5]=k[2],t.geometryVertexAttrsUpdated(i)}}const k=Object(g.e)(),G=Object(z.g)(),U=Object(z.g)(),B=Object(z.g)(),N=Object(z.g)(),H=Object(z.g)();var q=i(107),W=i(221),Z=i(178),$=i(267),Y=i(261),X=i(468),Q=i(597);class K{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return Object(a.k)(this._resources)?this._resources.object:null}get resources(){return Object(a.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(Object(a.j)(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{2===t.type&&e.remove(t)})),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new Q.a({isPickable:!1,updatePolicy:1});e.add(t);const i=new X.a({castShadow:!1}),r=this.resourceFactory.createResources(i,t);r.forEach((t=>e.add(t))),e.add(i),t.add(i),this._syncVisible();const n=this.resourceFactory.cameraChanged?Object(s.a)(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:t,object:i,external:r,cameraHandle:n}}_destroyResources(){if(Object(a.j)(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((t=>{null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){Object(a.j)(this._resources)||this._resources.object.setVisible(this._visible)}}var J=i(478),ee=i(563),te=i(1046),ie=i(692),re=i(1003);class ne{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=Object(W.g)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=Object(W.g)(1,1,1,1),this._elevationInfo=null,this.resources=new K({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),Object(a.k)(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?Object(a.k)(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){Object(v.g)(e,this._color)||(Object(v.c)(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,Object(a.k)(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(v.g)(e,this._outlineColor)||(Object(v.c)(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;Object(a.j)(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(Object(a.j)(e)||Object(a.j)(t))return;const i=e.geometry;if(Object(a.j)(i))return;const r=i.getMutableAttribute("size").data,n=this.geometrySize;r[0]=n,r[1]=n,t.geometryVertexAttrsUpdated(0)}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:se,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/ae}recreateGeometry(e,t){const i=this.createRenderGeometry();return Object(a.k)(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new re.a(this.materialParameters(t.id)),r=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:r,forEach(e){e(t),e(i),Object(a.k)(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return Object(q.f)(Object(q.p)(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new ie.a(Object(te.f)(this._primitive,e,e*ae),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if(Object(a.j)(this.resources.resources)||Object(a.j)(this.resources.resources.geometry))return!1;const t=this.resources.resources.geometry.vertexAttributes.get("position");return Object(Z.u)(t.data,this.view.renderCoordsHelper.spatialReference,oe,this.view.spatialReference),Object($.k)(e,oe),!0}createRenderGeometry(){const e=this.geometry;if(Object(a.j)(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,r=Object(J.e)(e,i,ee.a.fromElevationInfo(this.elevationInfo),t),n=Object(b.w)(Y.d.get(),e.x,e.y,r),s=Y.d.get();Object(Z.u)(n,e.spatialReference,s,t.spatialReference);const o=this.geometrySize;return S.a.createPointGeometry(null,s,null,[o,o],[0,0,0,1])}}const ae=.5,se=[ae/2,ae/2,1-ae/2,1-ae/2],oe=Object(g.e)();var ce=i(1047),le=i(572),he=i(330),ue=i(902);class de extends ue.a{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(new ne({view:a,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:f.a.toUnitRGBA(le.a.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(new ne({view:a,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:f.a.toUnitRGBA(le.a.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,r,a,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t,s=Object(he.a)(e.lineStart,i,r,t.view),o=Object(he.a)(e.lineEnd,i,r,t.view),c=Object(b.i)(o,s,o,.5),l=new F({view:a,attached:!1,offset:le.a.parallelLineHintOffset,length:le.a.parallelLineHintLength,width:le.a.parallelLineHintWidth,color:f.a.toUnitRGBA(le.a.orange),location:c,renderOccluded:16});return l.setDirectionFromPoints(s,c),l.attached=!0,Object(n.a)(l)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,elevationInfo:r,view:a}=t;return Object(n.a)(new ce.a({view:a,attached:!0,color:f.a.toUnitRGBA(le.a.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:f.a.toUnitRGBA(le.a.orange),outlineSize:le.a.rightAngleHintOutlineSize,size:le.a.rightAngleHintSize,geometry:{previous:Object(he.a)(e.previousVertex,i,r,a),center:Object(he.a)(e.centerVertex,i,r,a),next:Object(he.a)(e.nextVertex,i,r,a)}}))}createLineSegmentHintFromMap(e,t,i,r,n,a,s=!0,o=!0){const c=Object(g.e)(),l=Object(g.e)();return Object(he.c)(t,i,r,n,a,c,l),this.createLineSegmentHint(e,a,c,l,s,o)}createLineSegmentHint(e,t,i,r,n=!0,a=!0){const s=new T({view:t,extensionType:3,start:i,end:r,color:f.a.toUnitRGBA(le.a.orange),renderOccluded:16});switch(e){case 0:s.width=le.a.lineHintWidthTarget,s.fadedExtensions={start:0,end:le.a.lineHintFadedExtensions};break;case 2:s.width=le.a.lineHintWidthReference,s.fadedExtensions={start:0,end:0};break;case 1:s.width=le.a.lineHintWidthReference,s.fadedExtensions={start:n?le.a.lineHintFadedExtensions:0,end:a?le.a.lineHintFadedExtensions:0}}return s.attached=!0,s}}var pe=i(484),fe=i(755);const be={main:new f.a([255,127,0]),selected:new f.a([255,255,255]),staged:new f.a([12,207,255]),outline:new f.a([0,0,0,.5]),selectedOutline:new f.a([255,255,255])},ge=.3;function me(e,t){const i=e.clone();return i.a*=t,i}function ve(e,t){const i=e.clone(),r=Object(pe.b)(i);r.s*=t;const n=Object(pe.e)(r);return i.r=n.r,i.g=n.g,i.b=n.b,i}function Oe(e,t){if(t)for(const i in t)e[i]=t[i]}class ye{constructor(e){this.color=be.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,Oe(this,e)}}class _e{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=be.main,this.outlineColor=be.outline,this.renderOccluded=16,this.hoverOutlineColor=be.selectedOutline,Oe(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:Ce(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}class je{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=me(be.main,.5),this.hoverColor=be.main,this.renderOccluded=2,this.minSquaredEdgeLength=900,Oe(this,e)}apply(e,t){const i=this[e];t.setParameterValues({color:Ce(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}class xe{constructor(e){this.vertex=new _e({color:be.main,outlineColor:be.outline}),this.edge=new _e({color:ve(me(be.main,2/3),.5),outlineColor:me(be.outline,.5),size:8,collisionPadding:8}),this.selected=new _e({color:be.selected,outlineColor:be.outline}),this.edgeOffset=new je,Oe(this,e)}}class we{constructor(e){this.color=be.selected,this.width=1.5,this.stipplePattern=Object(fe.a)([5,5]),this.stippleOffColor=be.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=be.selected,this.renderOccluded=4,Oe(this,e)}apply(e){e.color=Ce(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Ce(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Ce(this.innerColor),e.renderOccluded=this.renderOccluded}}class Me{constructor(e){this.color=be.selected,this.size=4,this.outlineSize=1,this.outlineColor=be.outline,this.shape="square",Oe(this,e)}apply(e){e.color=Ce(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Ce(this.outlineColor),e.primitive=this.shape}}class Se{constructor(e){this.innerColor=be.selected,this.innerWidth=1,this.glowColor=be.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=ge,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=be.main,Oe(this,e)}apply(e,t=1){const i={glowColor:f.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:f.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}class Ee{constructor(e){this.outline=new we({color:be.outline,renderOccluded:8,stippleOffColor:be.selected,stipplePattern:Object(fe.a)([5,5]),width:1.5,innerWidth:0}),this.staged=new we({color:be.selected,renderOccluded:8,innerColor:be.staged,stippleOffColor:be.outline,stipplePattern:Object(fe.a)([5,5]),width:1.5}),this.shadowStyle=new Se({globalAlpha:ge,glowColor:be.main,glowFalloff:8,glowWidth:8,innerColor:be.selected,innerWidth:1}),Oe(this,e)}}class Te{constructor(e){this.outline=new Me({color:be.selected,outlineColor:be.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Se({globalAlpha:ge,glowColor:be.main,glowFalloff:1.5,glowWidth:6,innerColor:be.selected,innerWidth:1,radius:2}),Oe(this,e)}}class Pe extends we{constructor(e){super(),this.extensionType=2,Oe(this,e)}}class Ae{constructor(e){this.lineGraphics=new Ee,this.pointGraphics=new Te,this.heightPlane=new Se({globalAlpha:ge,glowColor:be.main,glowFalloff:8,glowWidth:8,innerColor:be.selected,innerWidth:1}),this.heightBox=new Se({globalAlpha:ge,glowColor:be.main,glowFalloff:8,glowWidth:8,innerColor:be.selected,innerWidth:0,heightFillColor:be.main}),this.zVerticalLine=new Pe({color:me(be.main,.5),falloff:2,innerColor:me(be.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,Oe(this,e)}}function Ce(e){return Object(W.d)(f.a.toUnitRGBA(e))}const De=new class{constructor(e){this.visualElements=new Ae,this.reshapeManipulators=new xe,this.zManipulator=new ye,Oe(this,e)}colorToVec4(e){return Ce(e)}};var Re=i(122),Ie=i(373),ze=i(91),Le=i(149);class Ve{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return Object(a.k)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this.resourceFactory.recreateGeometry?Object(a.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?Object(a.j)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this.resourceFactory.createResources();this._resources={layerView:new Fe({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();const i=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;i&&i.registerDrapeSource(this._resources.layerView)}_destroyResources(){var e;if(Object(a.j)(this._resources))return;this.ensureRenderGeometriesRemoved();const t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}ensureRenderGeometriesRemoved(){var e;!Object(a.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}ensureRenderGeometriesAdded(){Object(a.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}let Fe=class extends(Object(Le.a)(ze.a)){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1}};Object(r.a)([Object(o.b)({constructOnly:!0})],Fe.prototype,"view",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Fe.prototype,"drapeSourceType",void 0),Fe=Object(r.a)([Object(u.a)("DrapedVisualElementLayerView")],Fe);var ke=i(721),Ge=i(445),Ue=i(850);class Be{constructor(e){this.view=null,this._attachmentOrigin=Object(Ie.g)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Re.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object(O.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object(O.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new K({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometries.length=0,this.recreateGeometry(t,e.material,e.geometries),e.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this.drapedResources=new Ve({view:e.view,createResources:()=>this.createDrapedResources(),recreateGeometry:e=>{e.geometries=this.createRenderGeometriesDraped(e.material),this.attachmentOriginChanged()}});let t=!0;this._laserline=new w.a({view:e.view});for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}get laserlineAttached(){return this.attached&&this.visible&&Object(a.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}get attached(){return this.resources.attached||this.drapedResources.attached}set attached(e){this.updateAttached(e)}updateAttached(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Object(v.g)(e,this._color)||(Object(v.c)(this._color,e),this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(v.g)(e,this._innerColor)||(Object(v.c)(this._innerColor,e),this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(a.k)(e)!==Object(a.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Object(v.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object(O.a)(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(a.k)(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=Object(a.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(b.w)(qe,0,0,0);let t=0;for(const i of e){const e=i.vertexAttributes.get("position"),r=i.indices.get("position"),n=Object(a.s)(this.resources.resources).material.isClosed(e.data,r);Object(Ge.a)(e,r,n,He)&&(Object(b.f)(qe,qe,He),t++)}return 0===t?null:(Object(b.e)(qe,qe,1/t),this.view.renderCoordsHelper.fromRenderCoords(qe,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}updateMaterial(){Object(a.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(a.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}get isClosed(){return Object(a.k)(this.geometry)&&"polygon"===this.geometry.type}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}get normalizedRenderOccluded(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}recreateGeometry(e,t,i){const r=this.createRenderGeometries();for(const n of r)e.addGeometry(n,t),i.push(n);this.attachmentOriginChanged()}attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}createResources(e){const t=new E.a(this.materialParameters),i=[];return this.recreateGeometry(e,t,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}createDrapedResources(){const e=new E.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}createRenderGeometriesDraped(e){const t=this.geometry;if(Object(a.j)(t))return[];const i=Object(ke.c)(t,this.view.basemapTerrain.spatialReference),r=[];for(const{position:n}of i.lines){const t={attributeData:{position:n},removeDuplicateStartEnd:this.isClosed?1:0},i=new Ue.a(Object(ke.a)(t),e),a=Object($.h)(Ne);Object($.k)(a,n),Object(v.l)(i.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),r.push(i)}return r}calculateMapBounds(e){if(Object(a.j)(this.resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const i of this.resources.resources.geometries){const r=i.vertexAttributes.get("position"),n=new Float64Array(r.data.length);Object(Z.m)(r.data,t.spatialReference,0,n,this.view.spatialReference,0,r.data.length/3),Object($.k)(e,n)}return!0}createRenderGeometries(){var e;const t=this.geometry;if(Object(a.j)(t))return[];const i=Object(ke.b)(t,this.view.elevationProvider,this.view.renderCoordsHelper,ee.a.fromElevationInfo(null!=(e=this.elevationInfo)?e:new p.a({mode:Object(d.d)(t,null)}))),r=[],n=[];for(const{position:a,mapPosition:s}of i.lines){const e={attributeData:{position:a,mapPosition:s},removeDuplicateStartEnd:this.isClosed?1:0};r.push(Object(ke.a)(e)),n.push(a)}return this._laserline.pathVerticalPlane=n,r}}const Ne=Object($.f)(),He=Object(g.e)(),qe=Object(g.e)();var We=i(851),Ze=i(864);class $e extends M.a{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=De.colorToVec4(De.reshapeManipulators.vertex.color),this._size=De.reshapeManipulators.vertex.size,this._outlineColor=De.colorToVec4(De.reshapeManipulators.vertex.outlineColor),this._outlineSize=De.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Object(v.g)(e,this._color)||(Object(v.c)(this._color,e),this.updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Object(v.g)(e,this._outlineColor)||(Object(v.c)(this._outlineColor,e),this.updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}get vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}updateMaterial(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}updateOutlineMaterial(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}createRenderGeometries(){const e=this.vertices;if(Object(a.j)(e)||0===e.length)return[];const t=Object(We.c)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ee.a.fromElevationInfo(this.elevationInfo)),i=[],r=t.numVertices,n=t.position;for(let a=0;a<r;++a){const e=Object(b.w)(Ye,n[3*a+0],n[3*a+1],n[3*a+2]),t=Xe(.5,e),r=Xe(.5,e);i.push({vertexGeometry:t,vertexOutlineGeometry:r})}return i}createGeometries(e){const t=this.createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:r}of t)e.addGeometry(i,this.vertexMaterial),e.addGeometry(r,this.vertexOutlineMaterial)}createExternalResources(){this.vertexMaterial=new Ze.a({...this.vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this.vertexOutlineMaterial=new Ze.a({...this.vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}const Ye=Object(g.e)();function Xe(e,t){return S.a.createSphereGeometry(e,16,16,{offset:t})}let Qe=class extends Re.a.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};Object(r.a)([Object(o.b)({constructOnly:!0})],Qe.prototype,"graphic",void 0),Object(r.a)([Object(o.b)()],Qe.prototype,"tracking",void 0),Object(r.a)([Object(o.b)()],Qe.prototype,"displaying",void 0),Object(r.a)([Object(o.b)()],Qe.prototype,"isDraped",void 0),Qe=Object(r.a)([Object(u.a)("esri.views.3d.layers.graphics.GraphicState")],Qe);var Ke=i(1080),Je=i(815),et=i(800);let tt=class extends Ke.a{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new p.a({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){var t;const i=null==(t=e.hasZ)||t;return{...e,elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}}}return e}initializeGraphic(e){return this._createGraphicState=new Qe({graphic:e}),Object(n.b)([this.view.maskOccludee(e),this.view.trackGraphicState(this._createGraphicState),Object(s.a)(this._createGraphicState,"isDraped",(e=>{Object(a.k)(this._outlineVisualElement)&&(this._outlineVisualElement.isDraped=e)}))])}makeDrawOperation(){return new Je.a({view:this.view,manipulators:this.manipulators,geometryType:Object(Ke.b)(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new et.c(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new et.a(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new de})}onActiveVertexChanged(e){return Object(a.k)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new $e({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:De.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=De.colorToVec4(De.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,Object(n.c)((()=>{this._activeVertexVisualElement=Object(a.e)(this._activeVertexVisualElement)})))}onOutlineChanged(e){if(Object(a.k)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Be({view:this.view,geometry:e,elevationInfo:t,isDraped:Object(a.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(d.c)(this.hasZ,t),attached:!1}),De.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),De.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Object(n.c)((()=>{this._outlineVisualElement=Object(a.e)(this._outlineVisualElement)}))}onRegularVerticesChanged(e){return Object(a.k)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new $e({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:De.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Object(n.c)((()=>{this._verticesVisualElement=Object(a.e)(this._verticesVisualElement)})))}};Object(r.a)([Object(o.b)({constructOnly:!0})],tt.prototype,"elevationInfo",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],tt.prototype,"geometryType",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],tt.prototype,"type",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],tt.prototype,"view",void 0),tt=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],tt);var it=i(103),rt=i(160),nt=i(660);function at(e,t=Object(d.e)(e)){return"on-the-ground"!==t.mode&&!(Object(a.j)(e.geometry)||!e.geometry.hasZ)}var st=i(575);class ot{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator(((e,t)=>{if(0===t&&(this.zManipulator=e),e instanceof st.a&&(e.selected&&(0===this.numSelected&&(this.firstSelected=e),this.numSelected++),Object(a.j)(this.firstGrabbedXY)&&e.grabbing&&1===t&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}}))}}function ct(e){const{view:t,graphic:i}=e,r=new Qe({graphic:i}),a=function(e,t){const{view:i,graphic:r}=e,a=new Be({view:i,geometry:ht(r)?r.geometry:null,elevationInfo:Object(d.e)(r),attached:!1});De.visualElements.lineGraphics.shadowStyle.apply(a);const s=()=>{a.attached=t.displaying};De.visualElements.lineGraphics.outline.apply(a);const o=[t.watch("displaying",s),t.watch("isDraped",(e=>a.isDraped=e)),t.on("changed",(()=>a.geometry=ht(r)?r.geometry:null)),Object(n.a)(a)];return s(),{visualElement:a,remove:()=>Object(n.b)(o).remove()}}(e,r),s=[a,lt(e,a.visualElement,r),t.maskOccludee(i),t.trackGraphicState(r)];return{visualElement:a.visualElement,remove:()=>Object(n.b)(s).remove()}}function lt(e,t,i){const{graphic:r,view:s}=e,o=[],c=Object(d.e)(r),l="on-the-ground"===c.mode||!c.offset&&"absolute-height"!==c.mode,h=new ot,u=new T({view:s,extensionType:De.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});De.visualElements.pointGraphics.shadowStyle.apply(u);const p=Object(q.h)(De.visualElements.heightPlaneAngleCutoff),f=new w.a({view:s,attached:!1,angleCutoff:p});De.visualElements.heightPlane.apply(f);let g=1,m=1;const v=()=>{if(h.update(e),!i.displaying||l&&(i.isDraped||!ht(r)||!r.geometry.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(f.attached=!1);t.laserlineEnabled=!0;{const e=4&h.grabbingState?De.visualElements.laserlineAlphaMultiplier:1;e!==g&&(g=e,De.visualElements.lineGraphics.shadowStyle.apply(t,e),De.visualElements.pointGraphics.shadowStyle.apply(u,e))}{const e=2&h.grabbingState?De.visualElements.laserlineAlphaMultiplier:1;e!==m&&(m=e,De.visualElements.heightPlane.apply(f,e))}(function(e,t){const i=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(a.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(a.k)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1})(u,h),function(e,t,i,r){if(r.numSelected>0){Object(b.w)(ut,0,0,0);let t=0;e.forEachManipulator(((e,i)=>{1===i&&e.selected&&e instanceof st.a&&(Object(b.f)(ut,ut,e.renderLocation),t++)})),t>0?(i.heightManifoldTarget=Object(b.e)(ut,ut,1/t),i.attached=!0):i.attached=!1}else{const r=t.attachmentOrigin;Object(a.k)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,ut)?(i.heightManifoldTarget=ut,i.attached=!0):i.attached=!1}}(e,t,f,h)};De.visualElements.zVerticalLine.apply(u),o.push(i.on("changed",v),i.watch("displaying",v),t.events.on("attachment-origin-changed",v),Object(n.a)(u),Object(n.a)(f));const O=[],y=()=>{Object(n.b)(O).remove(),O.length=0,e.forEachManipulator((e=>O.push(e.events.on("grab-changed",v)))),e.forEachManipulator((e=>O.push(e.events.on("select-changed",v)))),v()};return y(),o.push(e.onManipulatorsChanged(y),Object(n.d)((()=>Object(n.b)(O)))),Object(n.b)(o)}function ht(e){return Object(a.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}const ut=Object(g.e)();var dt=i(123);function pt(e){const{view:t,graphic:i}=e,r=new Qe({graphic:i}),o=[],c=function(e,t,i){const{view:r,graphic:o}=e,c=new ne({view:r,geometry:ft(o),elevationInfo:Object(d.e)(o),attached:!1});return function(e,t,i,r){const o=()=>t.attached=i.displaying;(function(e,t,i,r){const{view:s,graphic:o}=e;let c=null;const l=e=>{Object(a.k)(c)&&(c.remove(),c=null),i.isDraped&&Object(a.k)(e)&&(c=function(e,t,i){const r=e.elevationProvider.spatialReference;Object(Z.q)(t,bt,r);const n=bt[0],a=bt[1];return e.elevationProvider.on("elevation-change",(e=>{Object(dt.j)(e.extent,n,a)&&i()}))}(s,e,(()=>{t.geometry=e})))},h=()=>{const e=ft(o);l(e),t.geometry=e};r.push(i.on("changed",h),Object(n.d)((()=>c))),h()})(e,t,i,r),De.visualElements.pointGraphics.outline.apply(t),r.push(Object(s.a)(i,"displaying",o))}(e,c,t,i),i.push(Object(n.a)(c)),c}(e,r,o);return function(e,t,i,r){const{view:s,graphic:o}=e,c=new T({view:s,extensionType:De.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});De.visualElements.zVerticalLine.apply(c);const l=new w.a({view:s,intersectsLineInfinite:!0,attached:!1});De.visualElements.pointGraphics.shadowStyle.apply(l);const h=Object(q.h)(De.visualElements.heightPlaneAngleCutoff),u=new w.a({view:s,attached:!1,angleCutoff:h});De.visualElements.heightPlane.apply(u);const p=Object(d.e)(e.graphic),f=ee.a.fromElevationInfo(p),g="on-the-ground"===p.mode||!p.offset&&"absolute-height"!==p.mode,m=new ot;let v=1,O=1;const y=()=>{m.update(e);const i=ft(o),n=g&&(t.isDraped||Object(a.j)(i)||!i.hasZ);let h=!0;if(!n&&Object(a.k)(i)){const e=Object(J.e)(i,s.elevationProvider,f,s.renderCoordsHelper);Object(b.w)(bt,i.x,i.y,e),Object(Z.u)(bt,i.spatialReference,bt,s.renderCoordsHelper.spatialReference),c.setStartEndFromWorldDownAtLocation(bt),l.intersectsWorldUpAtLocation=bt}else h=!1;const d=2&m.grabbingState?De.visualElements.laserlineAlphaMultiplier:1;d!==v&&(v=d,De.visualElements.heightPlane.apply(u,d));const p=Object($.h)(gt);!n&&t.displaying&&r.calculateMapBounds(p)&&Object(Z.u)(Object($.q)(p,bt),s.spatialReference,bt,s.renderCoordsHelper.spatialReference)?(u.heightManifoldTarget=bt,u.attached=!0):u.attached=!1;const y=4&m.grabbingState?De.visualElements.laserlineAlphaMultiplier:1;y!==O&&(O=y,De.visualElements.pointGraphics.shadowStyle.apply(l,y));const _=h&&t.displaying&&!n;l.attached=_,c.attached=_};i.push(t.watch(["displaying","isDraped"],y),t.on("changed",y)),e.forEachManipulator((e=>{i.push(e.events.on("grab-changed",y))})),i.push(Object(n.a)(l)),i.push(Object(n.a)(c)),i.push(Object(n.a)(u)),y()}(e,r,o,c),o.push(t.trackGraphicState(r)),{visualElement:c,remove(){Object(n.b)(o).remove()}}}function ft(e){const t=e.geometry;return Object(a.j)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}const bt=Object(g.e)(),gt=Object($.f)();function mt(e){switch(Object(a.s)(e.graphic.geometry).type){case"point":case"mesh":return pt(e);case"polygon":case"polyline":return ct(e);default:return null}}const vt=[1,.5,0],Ot=70,yt=Math.ceil(Ot/3*2),_t=160,jt=5*Math.PI/12,xt=1*Math.PI/3;class wt{constructor(){this._available=!0}set location(e){this.forEachManipulator3D((t=>t.location=e))}set elevationAlignedLocation(e){this.forEachManipulator3D((t=>t.elevationAlignedLocation=e))}set elevationInfo(e){this.forEachManipulator3D((t=>t.elevationInfo=e))}get renderLocation(){let e;return this.forEachManipulator3D((t=>{e||(e=t.renderLocation)})),e}get available(){return this._available}set available(e){this._available=e,this.forEachManipulator3D((t=>t.available=e))}get grabbing(){return this.someManipulator((e=>e.grabbing))}get dragging(){return this.someManipulator((e=>e.dragging))}hasManipulator(e){return this.someManipulator((t=>t===e))}someManipulator(e){let t=!1;return this.forEachManipulator((i=>{!t&&e(i)&&(t=!0)})),t}forEachManipulator3D(e){this.forEachManipulator(((t,i)=>{t instanceof st.a&&e(t,i)}))}}var Mt=i(135),St=i(643),Et=i(400);function Tt(e,t,i,r){const n=e.graphic,a=(e,i)=>t({action:e,graphic:n,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY});return i(((e,t,i)=>{const s=t.next((e=>("start"===e.action&&a("start",e),e))).next(Object(Et.g)(n,r)).next((e=>{switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&a("update",e);break;case"end":a("end",e)}return e}));return i.next(Object(Et.i)(n)).next((()=>{a("end",{screenDeltaX:0,screenDeltaY:0})})),s}))}function Pt(e){if(Object(a.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;const t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;const i=t[0],r=t[1];return Math.atan2(r[1]-i[1],r[0]-i[0])}var At=i(629);class Ct extends wt{constructor(e){super(),this._handles=new m.a,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this.createMaterial(),this._transparentMaterial=this.createMaterial(.5),this._angle=0,this._scale=1,this._radius=Ot,this._updateAfterDrag=!1,this.events=new Re.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._handles=Object(a.e)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){this._arrowManipulatorInfos.map((({manipulator:t})=>e(t,1)))}createGraphicDragPipeline(e,t,i){const r=t.graphic,n=Object(d.e)(r),s=Object(a.s)(r.geometry).spatialReference;return Tt(t,i,(t=>this.createDragPipeline(((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n)),n,s,r)),this._view.state.viewingMode)}createDragPipeline(e,t,i,r){return Object(n.b)(this._arrowManipulatorInfos.map((({manipulator:n},a)=>Object(Et.e)(n,((n,s,o,c,l)=>{const h=s.next((e=>({...e,manipulatorType:1}))).next(Object(Et.f)(this._view,n.elevationAlignedLocation)).next(Object(St.d)(this._view,n.elevationAlignedLocation,t,i,r)).next(Object(Et.d)(n.location,this.angle+(a+1)*Math.PI*.5)).next(Object(Et.c)());e(n,h,o,c,l)})))))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},i){const r=this._radius/Ot,n=54*r,a=n*Math.sqrt(3)/2,s=S.a.createExtrudedTriangle(a,n/2,n/2,.02);S.a.transformInPlace(s,Object(Mt.u)(Y.a.get(),Object(b.w)(Y.d.get(),0,-a/3,0))),e.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],e.radius=a/3*2*1.2;const o=Object(Mt.j)(Y.a.get());Object(Mt.a)(o,i*Math.PI/2);const c=Object(Mt.j)(Y.a.get());Object(Mt.u)(c,Object(b.w)(Y.d.get(),0,100*r,0)),Object(Mt.n)(t,o,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=Object(Mt.j)(Y.a.get());Object(Mt.e)(t,t,e,Object(g.g)(0,0,1));const i=Object(Mt.w)(Y.a.get(),Object(b.w)(Y.d.get(),this.displayScale,this.displayScale,this.displayScale)),r=Object(Mt.j)(Y.a.get());Object(Mt.n)(r,i,t);for(const n of this._arrowManipulatorInfos){const e=Object(Mt.n)(Y.a.get(),r,n.transform);n.manipulator.modelTransform=e}}_createArrowManipulator(e){const t=new st.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(g.g)(0,0,1)}}),i={manipulator:t,transform:Object(L.d)()};return this._updateArrowManipulator(i,e),this._handles.add(t.events.on("drag",(e=>{this._updateAfterDrag&&"end"===e.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)}))),i}createMaterial(e=1){const t=f.a.toUnitRGBA(be.main);return t[3]*=e,new At.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map((({manipulator:e})=>e))}}}class Dt{constructor(){this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Et.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(a.k)(this.lastDragEvent)){const t=this.lastDragEvent.mapEnd,i=this.snap(this.lastDragEvent.screenEnd);if(Object(a.k)(i)){const r={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(r)}}this._enabled=e}snap(e){const t=Object(a.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(a.k)(t)&&Object(a.k)(this.view)&&(t.z=Object(d.g)(t,this.view,this.elevationInfo)),t}createDragEventPipelineStep(e,t){return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,e=>{if(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled){const t=this.snap(e.screenEnd);return Object(a.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}class Rt extends wt{constructor(e){super(),this._handles=new m.a,this._snapToScene=new Dt,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Ot,this._view=e.view,this._tool=e.tool,null!=e.snapToScene&&(this.snapToScene=e.snapToScene),null!=e.radius&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,i){const r=t.graphic,n=Object(d.e)(r),s=Object(a.s)(r.geometry).spatialReference;return Tt(t,i,(t=>this.createDragPipeline(((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n)),n,s,r)),this._view.state.viewingMode)}createDragPipeline(e,t,i,r){const n=this._view;return Object(Et.e)(this._manipulator,((a,s,o,c,l)=>{const h=s.next(Object(Et.f)(n,a.elevationAlignedLocation)).next(Object(St.d)(n,a.elevationAlignedLocation,t,i,r)).next(this._snapToScene.createDragEventPipelineStep(n,t),this._snapToScene.next).next((e=>({...e,manipulatorType:1}))).next(Object(Et.c)());e(a,h,o,c,l)}))}_updateManipulatorTransform(){const e=Object(Mt.w)(Y.a.get(),Object(b.w)(Y.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new st.a({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(g.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=S.a.createCylinderGeometry(.02,1,128,Object(g.g)(0,0,1),Object(g.g)(0,0,0)),t=Object(Mt.w)(Object(L.d)(),Object(g.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/Ot*80}_createMaterial(e=1){const t=f.a.toUnitRGBA(be.main);return t[3]*=e,new At.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{discManipulator:this._manipulator}}}class It extends wt{constructor(e){super(),this._handles=new m.a,this._radius=Ot,this.events=new Re.a,this._tool=e.tool,this._view=e.view,null!=e.radius&&(this._radius=e.radius),this.createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()}))}forEachManipulator(e){e(this._manipulator,0)}createGraphicDragPipeline(e,t,i){const r=Object(a.s)(t.graphic.geometry).spatialReference;return Tt(t,i,(t=>this.createDragPipeline(((i,r,n,a,s)=>t(i,e(i,r,n,a,s),n)),r)),this._view.state.viewingMode)}createDragPipeline(e,t){const i=this._view;return Object(Et.e)(this._manipulator,((r,n,a,s,o)=>{const c=n.next((e=>({...e,manipulatorType:0}))).next(Object(St.i)(i,r.renderLocation,t)).next(Object(Et.c)());e(r,c,a,s,o)}))}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}updateManipulator(){const e=this._radius/Ot,t=De.zManipulator.height*e,i=De.zManipulator.coneHeight*e,r=De.zManipulator.coneWidth*e,n=De.zManipulator.width*e,a=[Object(g.g)(0,0,0),Object(g.g)(0,0,t)],s=S.a.createTubeGeometry(a,n/2,16,!1),o=S.a.createConeGeometry(i,r/2,16,!1),c=[Object(g.g)(0,0,0),Object(g.g)(0,0,t+i)],l=(e=>{const i=Object(L.d)();return Object(Mt.t)(i,i,[0,0,t]),Object(Mt.d)(i,i,Math.PI/2),i})(),h=(e,t)=>{const i=Object(pe.a)(De.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,De.zManipulator.color.a*e]},u=Object(nt.c)(h(1,.25),1),d=Object(nt.c)(h(1,0),1),p=Object(nt.c)(h(.7,0),De.zManipulator.renderOccluded),f=Object(nt.c)(h(.85,0),De.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:o,transform:l,material:u,stateMask:1},{geometry:s,material:u,stateMask:1},{geometry:o,transform:l,material:d,stateMask:2},{geometry:s,material:d,stateMask:2},{geometry:o,transform:l,material:p,stateMask:1},{geometry:s,material:p,stateMask:1},{geometry:o,transform:l,material:f,stateMask:2},{geometry:s,material:f,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}createManipulator(){const e=new st.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=e=>{const t=this._view.state.camera,i=zt;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,i);const r=Object(b.n)(t.eye,i),n=t.computeRenderPixelSizeAtDist(r),a=Object(b.j)(Lt,i,t.eye);Object(b.r)(a,a);const s=Vt;this._view.renderCoordsHelper.worldUpAtPosition(zt,s);const o=Math.abs(Object(b.h)(a,s)),c=Object(b.g)(Lt,a,s),l=Object(b.g)(Lt,c,s),h=Object(q.f)(o,.01,1),u=1-Math.sqrt(1-h*h)/h/t.fullWidth,d=this._radius/Ot,p=De.zManipulator.width*d;Object(b.e)(l,Object(b.r)(l,l),(1/u-1)*r+n*p),e[12]-=Lt[0],e[13]-=Lt[1],e[14]-=Lt[2]},this._manipulator=e,this.updateManipulator()}get test(){return{manipulator:this._manipulator}}}const zt=Object(g.e)(),Lt=Object(g.e)(),Vt=Object(g.e)();class Ft extends wt{constructor(e){super(),this._handles=new m.a,this._angleDeferred=null,this._interactive=!0;const{tool:t,view:i,snapToScene:r,radius:n}=e;this._view=i,this.xyManipulation=new Rt({tool:t,view:i,snapToScene:r,radius:n}),this.xyAxisManipulation=new Ct({tool:t,view:i,radius:n}),this.zManipulation=new It({tool:t,view:i,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this.autoHideXYAxis(),this.forEachManipulator((e=>{this._handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorInteractivity())))}))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,i){return Object(n.b)([this.xyManipulation.createGraphicDragPipeline(((t,i,r,n,a)=>e(0,t,i,r,n,a)),t,i),this.xyAxisManipulation.createGraphicDragPipeline(((t,i,r,n,a)=>e(1,t,i,r,n,a)),t,i),this.zManipulation.createGraphicDragPipeline(((t,i,r,n,a)=>e(2,t,i,r,n,a)),t,i)])}createDragPipeline(e,t,i,r){return Object(n.b)([this.xyManipulation.createDragPipeline(((t,i,r,n,a)=>e(0,t,i,r,n,a)),t,i,r),this.xyAxisManipulation.createDragPipeline(((t,i,r,n,a)=>e(1,t,i,r,n,a)),t,i,r),this.zManipulation.createDragPipeline(((t,i,r,n,a)=>e(2,t,i,r,n,a)),i)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}set angleDeferred(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator((t=>e(t,1))),this.xyAxisManipulation.forEachManipulator((t=>e(t,1))),this.zManipulation.forEachManipulator((t=>e(t,0)))}get xyAxisVisible(){const e=this.xyManipulation.someManipulator((e=>e.focused))||this.xyAxisManipulation.someManipulator((e=>e.focused));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Object(c.a)("esri-mobile"))return;const i=[];t.forEachManipulator((e=>i.push(e))),e.forEachManipulator((e=>i.push(e)));const r=()=>{const t=[];this.xyAxisVisible?Object(a.k)(this._angleDeferred)&&(this.angle=this._angleDeferred()):e.forEachManipulator((e=>t.push(e.disableDisplay()))),this._handles.remove(kt),this._handles.add(t,kt)};for(const n of i)this._handles.add(n.events.on("focus-changed",r));this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",r)),r()}updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator((t=>{t.interactive=!e&&this._interactive||t.grabbing}))}static radiusForSymbol(e){const t=Object(a.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((e=>"icon"===e.type))?yt:Ot}}const kt="disable-xy-axis-display";var Gt=i(661);class Ut extends wt{constructor(e){super(),this._handles=new m.a,this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator((e=>this._tool.manipulators.add(e)))}destroy(){this._handles.destroy(),this.forEachManipulator((e=>{this._tool.manipulators.remove(e),e.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,1)}createGraphicDragPipeline(e){return Tt(this._graphicState,e,(e=>this.createDragPipeline(e)),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,i=this._graphicState.graphic,r=Object(a.k)(i.geometry)?i.geometry.spatialReference:null;return Object(Et.e)(this._manipulator,((n,a,s,o,c)=>{const l=a.next(Object(St.e)(c,t,i,r)).next(Object(Et.b)()).next(Object(Et.c)());e(n,l,s,o,c)}))}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new Gt.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}var Bt=i(965),Nt=i(562),Ht=i(596),qt=i(609),Wt=i(684);class Zt{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class $t{constructor(e,t,i){this.dx=e,this.dy=t,this.allGraphics=i,this.type="graphic-move"}}class Yt{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}}let Xt=class extends(Object(rt.b)(Re.a.EventedMixin(Nt.a))){constructor(e){super(e),this.graphics=new it.a,this.enableZ=!0,this.type="move-3d",this._toolHandles=new m.a,this.snappingPipeline=new Wt.a}initialize(){this._toolHandles.add([this.graphics.on("change",(()=>this._refreshManipulators()))]),this._refreshManipulators(),this.complete()}destroy(){this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter((e=>0===Object(Bt.a)(e))).map((e=>new Qt(e)));e.length&&(this.createManipulators(e),this.createVisualElements(e),this.handles.add(e.map((e=>this.view.trackGraphicState(e.state)))),this.updateMoveManipulation(e))}createManipulators(e){for(const t of e){const i=t.state;t.manipulationXY=new Ut({tool:this,view:this.view,graphicState:i}),t.manipulationXY.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:i.graphic}),e.stopPropagation()}))))),this.handles.add(t.manipulationXY.createDragPipeline(((t,i,r,n)=>this.buildDragEventPipeline(e,0,t,i,r,n))))}this.createMoveManipulation(e)}createMoveManipulation(e){const t=new Ft({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Ft.radiusForSymbol(e[0].graphic.symbol):Ot});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator((e=>{this.handles.add(e.events.on("immediate-click",(i=>{t.zManipulation.hasManipulator(e)||1!==this.graphics.length||this.emit("immediate-click",{...i,graphic:this.graphics.getItemAt(0)}),i.stopPropagation()})))}));const i=()=>this.updateMoveManipulation(e);for(const n of e)this.handles.add([n.state.on("changed",i),n.state.watch("displaying",i)]);const r=e[e.length-1];this.handles.add(r.state.on("changed",(()=>this.updateMoveManipulationAngle(r)))),this.handles.add(t.createDragPipeline(((t,i,r,n,a)=>this.buildDragEventPipeline(e,t,i,r,n,a)),Object(d.e)(r.graphic),Object(a.s)(r.graphic.geometry).spatialReference,r.graphic)),this.updateMoveManipulationAngle(r)}createVisualElements(e){for(const t of e){const i=t.graphic,r=mt({view:this.view,graphic:i,forEachManipulator:e=>{t.manipulationXY.forEachManipulator(e),this._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:()=>Object(n.c)()});Object(a.j)(r)||(t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof Be&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",(()=>{t.state.isDraped||this.updateMoveManipulation(e)})),t.state.watch("isDraped",(()=>this.updateMoveManipulation(e)))]),this.handles.add(r))}}updateMoveManipulationAngle(e){this._moveManipulation.angleDeferred=()=>Pt(e.graphic.geometry)}updateMoveManipulation(e){const t=Object(Ie.g)(0,0,0,this.view.spatialReference);let i=0,r=!1;const n=this._moveManipulation;for(const s of e){if(!s.state.displaying)continue;const e=s.state.graphic;this.enableZ&&at(e)&&(r=!0);const n=s.geometryRepresentation instanceof Be&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Object(nt.f)(this.view,e);Object(a.k)(n)&&(t.x+=n.x,t.y+=n.y,t.z+=n.z,i++)}i>0?(t.x/=i,t.y/=i,t.z/=i,n.location=t,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=r):n.available=!1}buildDragEventPipeline(e,t,i,r,n,a){const s=[],o=[];let c=null,l=null;const h=()=>{for(const e of s)e.dragging=!1;s.length=0,o.length=0,c=null,l=null,this._moveManipulation.interactive=!0};if(1===e.length&&0===t){const t=e[0].graphic;r=this.buildSnappingPipelineSteps(t,Object(d.e)(t),r,n,a)}const u=r.next((t=>{if("start"===t.action){s.length=0,o.length=0;for(const t of e)t.dragging||!t.manipulationXY.hasManipulator(i)&&t.manipulationXY.grabbing||(s.push(t),o.push(t.graphic),t.dragging=!0);if(0!==o.length&&(this._moveManipulation.interactive=!1,c=Object(Et.h)(o,this.view.state.viewingMode),l=Object(Et.j)(o),this.emit("graphic-move-start",new Zt(o)),this.destroyed))return null}return 0!==o.length?t:null})).next((e=>c(e))).next((e=>{switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){const t=this.view.toScreen(e.mapStart),i=this.view.toScreen(e.mapEnd),r=i.x-t.x,n=i.y-t.y;if(this.emit("graphic-move",new $t(r,n,o)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new Yt(o)),this.destroyed)return null;h()}}));return n.next((e=>l(e))).next((()=>{if(this.emit("graphic-move-stop",new Yt(o)),this.destroyed)return null;h()})),u}buildSnappingPipelineSteps(e,t,i,r,n){const s=e.geometry;if(Object(a.j)(s)||"point"!==s.type&&"mesh"!==s.type)return i;const o=("point"===s.type?s:s.anchor).clone(),c=new qt.a({elevationInfo:t,pointer:n,editGeometryOperations:Ht.a.fromGeometry(o,this.view.state.viewingMode),visualizer:new de,excludeFeature:e}),l=this.snappingManager;return i.next((t=>(o.z=Object(d.a)(this.view,o,Object(d.e)(e),{mode:"absolute-height",offset:0}),{...t,snapOrigin:c.coordinateHelper.pointToVector(o)}))).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:r,updatingHandles:this.updatingHandles}),this.snappingPipeline.next)}};Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"view",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Xt.prototype,"graphics",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Xt.prototype,"enableZ",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Xt.prototype,"snappingManager",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Xt.prototype,"type",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Xt.prototype,"updating",null),Xt=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Xt);class Qt{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Qe({graphic:e})}get graphic(){return this.state.graphic}}var Kt=i(966),Jt=i(134),ei=i(406),ti=i(333),ii=i(980);function ri(e,t,i){const r="on-the-ground"===i.mode?1:0;return new ii.a(e,r,t,0)}function ni(e,t,i){const r=Object(g.e)();if(!e.renderCoordsHelper.toRenderCoords(t,r))return null;const n=ai(e,t,Object(ti.q)(i.plane)),s=ai(e,t,i.edgeDirection);if(Object(a.j)(n)||Object(a.j)(s))return null;const o=Object(b.g)(Object(g.e)(),n,s);return Object(ti.g)(r,o,Object(ti.d)())}function ai(e,t,i){const r=Object(Ie.g)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),n=Object(g.e)(),a=Object(g.e)();return e.renderCoordsHelper.toRenderCoords(t,n)&&e.renderCoordsHelper.toRenderCoords(r,a)?Object(b.v)(a,n,a):null}let si=class extends(Re.a.EventedMixin(rt.a)){constructor(e){super(e),this._vertexManipulatorMaterial=Object(nt.c)(De.colorToVec4(De.reshapeManipulators.vertex.color),De.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Object(nt.d)(De.colorToVec4(De.reshapeManipulators.vertex.outlineColor),De.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Object(nt.d)(De.colorToVec4(De.reshapeManipulators.vertex.hoverOutlineColor),De.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=Object(nt.c)(De.colorToVec4(De.reshapeManipulators.edge.color),De.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Object(nt.d)(De.colorToVec4(De.reshapeManipulators.edge.outlineColor),De.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=Object(nt.c)(De.colorToVec4(De.reshapeManipulators.edgeOffset.color),De.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Object(nt.c)(De.colorToVec4(De.reshapeManipulators.edgeOffset.hoverColor),De.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=Object(nt.c)(De.colorToVec4(De.reshapeManipulators.selected.color),De.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Object(nt.d)(De.colorToVec4(De.reshapeManipulators.selected.outlineColor),De.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Object(nt.d)(De.colorToVec4(De.reshapeManipulators.selected.hoverOutlineColor),De.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new m.a,this._manipulatorInfos=[],this._editGeometryOperations=null,this._graphicMoveManipulation=null,this._moveManipulation=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._outlineVisualElement=null,this.tool=null,this.outputGeometry=null,this._snappingPipeline=new Wt.a,this._snappingPipelineHandle=new Wt.a,this._vertexLaserLineVisualElement=null}initialize(){const e=new Qe({graphic:this.graphic});this._graphicState=e,this.handles.add([e.watch("displaying",(e=>{for(const t of this._manipulatorInfos)t.manipulator.available=e})),this.view.trackGraphicState(e)])}destroy(){this._editGeometryOperations=Object(a.e)(this._editGeometryOperations),this._moveManipulation=Object(a.e)(this._moveManipulation),this._graphicMoveManipulation=Object(a.e)(this._graphicMoveManipulation),this._manipulatorHandles=Object(a.e)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}get inputGeometry(){return Object(a.k)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(e){this._recreateEditGeometryAndManipulators(e)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}removeSelectedVertices(){const e=this._manipulatorInfos.filter((e=>e.manipulator.selected&&"vertex"===e.handle.type));this._removeVertices(e)}manipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._moveManipulation=Object(a.e)(this._moveManipulation),this._graphicMoveManipulation=Object(a.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}_resetGrabbingDragging(){this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(Object(a.j)(this._editGeometryOperations))return;const e=Object(d.e)(this.graphic);for(const t of this._editGeometryOperations.data.components){for(const i of t.vertices)this._createVertexOrEdgeManipulator(i,e);for(const i of t.edges)this._createVertexOrEdgeManipulator(i,e)}this._createGraphicMoveManipulators(e)}get canRedo(){return Object(a.k)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return Object(a.k)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(Object(a.j)(this._editGeometryOperations))return null;const e=this._editGeometryOperations.redo();return Object(a.k)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}undo(){if(Object(a.j)(this._editGeometryOperations))return null;this.emit("undo");const e=this._editGeometryOperations.undo();return Object(a.k)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}_recreateManipulators(){this._removeManipulators(),this._resetGrabbingDragging(),this._createManipulators()}_recreateEditGeometryAndManipulators(e=this.inputGeometry){this._removeManipulators(),this._resetGrabbingDragging(),Object(a.j)(e)||(Object(a.e)(this._editGeometryOperations),this._editGeometryOperations=Ht.a.fromGeometry(e,this.view.state.viewingMode),this._createManipulators())}_perGraphicManipulatorDragAction(e,t){if("end"===t.action)return;let i=0;const r=[],n=this._manipulatorInfos.some((e=>"vertex"===e.handle.type&&e.manipulator.selected)),a=1===e&&n;for(const s of this._manipulatorInfos)ci(s)&&(s.manipulator.grabbing||a&&!s.manipulator.selected||r.push(s),i++);if(0!==r.length)if(this._moveVertices(r,t),r.length===i){if(this._updateEventState(1),this.destroyed)return;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(2),this.destroyed)return;this.emit("reshape",{type:"reshape",mover:this.graphic})}}_isMultiVertexSelection(){let e=0;for(const t of this._manipulatorInfos)ci(t)&&t.manipulator.selected&&e++;return e>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;const{mapDeltaX:t,mapDeltaY:i,mapDeltaZ:r}=e;if(!t&&!i&&!r)return;const n=[];for(const a of this._manipulatorInfos)ci(a)&&(a.manipulator.selected&&!a.manipulator.grabbing||a===e.info)&&n.push(a);this._moveVertices(n,e,1),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}_createGraphicMoveManipulators(e){if(this._graphicMoveManipulation=new Ut({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic){let e=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline(((t,i,r)=>{i.next((e=>this._trackNumDragging(e))).next((t=>("start"===t.action&&(e=Object(a.s)(this._editGeometryOperations).createUndoGroup()),t))).next((t=>{this._perGraphicManipulatorDragAction(0,t),"end"===t.action&&(e=Object(a.r)(e))})),r.next(this._cancelDragOperation((()=>e=Object(a.r)(e))))})))}else this._graphicMoveManipulation.forEachManipulator((e=>{e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((e=>this._manipulatorHandles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()}))]))),this._moveManipulation=new Ft({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&at(this.graphic),snapToScene:!1,radius:Ft.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((e=>{this.handles.add([this._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some((e=>e.manipulator.selected))||this.emit("immediate-click",{...t,graphic:this.graphic}),t.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const t=Object(a.s)(this.graphic.geometry).spatialReference;this.handles.add([this._moveManipulation.createDragPipeline(((t,i,r,n,s)=>{const o=r.next((e=>this._trackNumDragging(e))).next((e=>{const t=this._manipulatorInfos.filter((e=>ci(e)&&e.manipulator.selected));return 1===e.manipulatorType&&1===t.length?{...e,info:t[0],snapOrigin:t[0].handle.pos}:{...e,info:null}})).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:e=>!!e.info,cancel:n,snappingManager:this.tool.snappingManager,snappingContext:new qt.a({editGeometryOperations:Object(a.s)(this._editGeometryOperations),elevationInfo:e,pointer:s,excludeFeature:this.graphic,visualizer:new de}),updatingHandles:this.updatingHandles}),this._snappingPipelineHandle.next).next(Object(Et.b)()).next((e=>(this._perGraphicManipulatorDragAction(1,e),e)));return n.next(this._cancelDragOperation()),o}),e,t,this.graphic),Object(s.a)(this._graphicState,"displaying",(()=>{this._updateMoveManipulationPosition()})),this._graphicState.on("changed",(()=>this._updateMoveManipulationPosition())),Object(s.a)(this._graphicState,"isDraped",(()=>{const e="align-move-manipulation";this._graphicState.isDraped?this.handles.add(this.view.elevationProvider.on("elevation-change",(()=>this._updateMoveManipulationPosition())),e):this.handles.remove(e)}))]),this._updateMoveManipulationPosition();const i=mt({view:this.view,graphic:this.graphic,forEachManipulator:e=>{if(!this.destroyed){Object(a.k)(this._graphicMoveManipulation)&&this._graphicMoveManipulation.forEachManipulator(e);for(const t of this._manipulatorInfos)e(t.manipulator,1);this._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:e=>this.on("manipulators-changed",e)});Object(a.k)(i)&&(this._outlineVisualElement=i.visualElement instanceof Be?i.visualElement:null),Object(a.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(()=>this._updateMoveManipulationPosition()))]),this._manipulatorHandles.add(i)}_createEdgeOffsetManipulator(e,t=Object(d.e)(this.graphic)){const i=De.reshapeManipulators.edgeOffset,r=i.size/2,s=r+i.collisionPadding;if(Object(a.j)(this._edgeOffsetManipulatorGeometryInside)||Object(a.j)(this._edgeOffsetManipulatorGeometryOutside)){const e=r/s,t=e*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=S.a.createExtrudedTriangle(t,e/2,e/2,i.height,i.offset),this._edgeOffsetManipulatorGeometryOutside=S.a.createExtrudedTriangle(-t,e/2,e/2,i.height,-i.offset)}const o=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:1},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:2}],c=new st.a({view:this.view,renderObjects:o,elevationInfo:"on-the-ground"!==t.mode||Object(ei.h)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:Object(g.g)(0,0,1)},collisionPriority:1}),l=new st.a({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),h={manipulator:c,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:l,elevationInfo:t,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(h,i.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(h);const u=this._getManipulatorInfoFromHandle(h.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(h))),p=this._getManipulatorInfoFromHandle(h.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateEdgeOffsetManipulator(h)));h.locationUpdateHandle=Object(n.b)([u,p]),this._manipulatorHandles.add(h.locationUpdateHandle,c),this._manipulatorHandles.add([this._watchAndUpdateGrabState(c,!0),this._watchAndUpdateGrabState(l,!0)],c),this._manipulatorHandles.add(Object(Et.e)(c,this._createEdgeOffsetPipeline(h,t)),c),this._manipulatorHandles.add(Object(Et.e)(l,((e,i,r,n)=>{if("touch"===n)this._createEdgeOffsetPipeline(h,t)(e,i,r);else if(this.enableMoveGraphic){const n=this.graphic,s=Object(a.k)(n.geometry)?n.geometry.spatialReference:null;i.next((e=>this._trackNumDragging(e))).next(Object(Et.f)(this.view,e.elevationAlignedLocation)).next(Object(St.d)(this.view,e.elevationAlignedLocation,t,s,n)).next(Object(Et.c)()).next(Object(Et.b)()).next((e=>this._perGraphicManipulatorDragAction(0,e))),r.next(this._cancelDragOperation())}})),c);const f=e=>{this._manipulatorInfos.some((e=>e.manipulator.selected))?this._clearSelection():this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()};return this._manipulatorHandles.add([c.events.on("immediate-click",f),l.events.on("immediate-click",f)],c),this._manipulatorInfos.push(h),this.manipulators.add(c),this.manipulators.add(l),this.emit("manipulators-changed"),h}_autoHideEdgeOffsetManipulator(e,t){const i=e.manipulator,r=e.edgeManipulator,s=()=>{Object(a.r)(e.visibilityHandle);const s=function(e,t,i){const r=i.projectToRenderScreen(e,Object(z.e)()),n=i.projectToRenderScreen(t,Object(z.e)());return Object(a.k)(r)&&Object(a.k)(n)?Object(b.t)(Object(b.j)(r,r,n)):0}(this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,this.view.state.camera)<t;(!i.focused&&!r.focused||s)&&(i.grabbable=!s,r.grabbable=!s,e.visibilityHandle=Object(n.b)([i.disableDisplay(),{remove:()=>{i.grabbable=!0,r.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([i.events.on("focus-changed",s),r.events.on("focus-changed",s),{remove:()=>{Object(a.r)(e.visibilityHandle),this.manipulators.remove(r)}}],i),s()}_updateEdgeOffsetManipulator(e){this._updateManipulatorPosition(e);const t=Object(a.s)(this._editGeometryOperations).data.coordinateHelper,i=ni(this.view,e.manipulator.elevationAlignedLocation,ri(t,e.handle,Object(a.s)(e.manipulator.elevationInfo))),r=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,s=Object(a.k)(i)?function(e,t,i){const r=Object(ti.q)(e),n=Object(b.v)(Object(g.e)(),t,i),a=Object(b.g)(Object(g.e)(),n,r),s=Object(b.g)(Object(g.e)(),n,a);return Object(L.e)(n[0],n[1],n[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],0,0,0,0,1)}(i,r,n):L.a;e.manipulator.modelTransform=s,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=s;const o=Object(b.p)(Object(b.j)(ui,r,n))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}_createEdgeOffsetPipeline(e,t){return(i,r,n)=>{this._clearSelection();const{step:s,cleanup:o}=this._initializeEdgeOffset(e,t);r.next((e=>this._trackNumDragging(e))).next(Object(Et.f)(this.view,i.elevationAlignedLocation)).next(s).next(Object(St.h)(this.view)).next(Object(St.a)(this.view,Object(a.s)(this._editGeometryOperations).data.spatialReference)).next(Object(Et.b)()).next(this._applyEdgeOffsetStep(e)).next((e=>{"end"===e.action&&o()})),n.next((e=>(o(),e))).next(this._cancelDragOperation())}}_initializeEdgeOffset(e,t){const i=Object(a.s)(this._editGeometryOperations),r=ri(i.data.coordinateHelper,e.handle,t),s=i.createUndoGroup(),o=ni(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);const c=()=>new Jt.a({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:Object(a.s)(this._editGeometryOperations).data.spatialReference}),l=new Be({view:this.view,isDraped:this._graphicState.isDraped,geometry:c(),elevationInfo:e.elevationInfo,width:De.visualElements.lineGraphics.outline.width,color:De.colorToVec4(be.main),attached:!0});let h;const u=()=>{this._cleanEdgeOffsetCollapsedEdges(e),h=Object(a.r)(h)},d=this.on("undo",u);return h=Object(n.b)([Object(n.a)(l),this._graphicState.watch("isDraped",(e=>l.isDraped=e)),this._graphicState.on("changed",(()=>l.geometry=c())),s,d]),{step:e=>Object(a.j)(r)||Object(a.j)(o)?(u(),null):{...e,operation:r,plane:o},cleanup:u}}_applyEdgeOffsetStep(e){return t=>{if(this.destroyed||Object(a.j)(t.operation))return t;this._updateEventState(2);const{mapDeltaX:i,mapDeltaY:r,mapDeltaZ:n}=t;return(i||r||n)&&(this._offsetEdge(e,t),this.emit("reshape",{type:"reshape",mover:this.graphic})),t}}_cleanEdgeOffsetCollapsedEdges(e){var t,i;const r=null==(t=e.handle.leftVertex.leftEdge)?void 0:t.leftVertex,n=e.handle.leftVertex,s=null==(i=e.handle.rightVertex.rightEdge)?void 0:i.rightVertex,o=e.handle.rightVertex,c=Object(a.s)(this._editGeometryOperations).data.coordinateHelper,l=1e-6,h=[];r&&c.distance(r.pos,n.pos)<l&&h.push(this._getManipulatorInfoFromHandle(n)),(c.distance(n.pos,o.pos)<l||s&&c.distance(s.pos,o.pos)<l)&&h.push(this._getManipulatorInfoFromHandle(o)),h.length&&this._removeVertices(h)}_computeVertexManipulatorSizeAndOutline(e){const t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}_createVertexOrEdgeManipulator(e,t=Object(d.e)(this.graphic)){if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(Object(a.j)(this._vertexManipulatorGeometry)||Object(a.j)(this._vertexManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(De.reshapeManipulators.vertex);this._vertexManipulatorGeometry=S.a.createSphereGeometry(e,16,16),this._vertexManipulatorOutlineGeometry=S.a.createSphereGeometry(t,16,16)}if(Object(a.j)(this._edgeManipulatorGeometry)||Object(a.j)(this._edgeManipulatorOutlineGeometry)){const{size:e,outlineSize:t}=this._computeVertexManipulatorSizeAndOutline(De.reshapeManipulators.edge);this._edgeManipulatorGeometry=S.a.createSphereGeometry(e,16,16),this._edgeManipulatorOutlineGeometry=S.a.createSphereGeometry(t,16,16)}const i=Object(a.k)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|di.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|di.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|di.Vertex},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}];this.enableMidpoints&&i.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|di.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|di.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|di.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|di.Edge});const r=new st.a({view:this.view,renderObjects:i,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(r,e,t);const s="edge"===e.type?{manipulator:r,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:r,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(r),this._updateManipulatorPosition(s),"edge"===s.type){const e=this._getManipulatorInfoFromHandle(s.handle.leftVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(s))),t=this._getManipulatorInfoFromHandle(s.handle.rightVertex).manipulator.events.on("location-update",(()=>this._updateManipulatorPosition(s)));s.locationUpdateHandle=Object(n.b)([e,t]),this._manipulatorHandles.add(s.locationUpdateHandle,r)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(r,!0),r);const o=Object(Et.e)(r,((e,i,r,n)=>{let o=null;i.next((e=>this._trackNumDragging(e))).next((e=>{if("start"===e.action&&(o=Object(a.s)(this._editGeometryOperations).createUndoGroup()),li(s)){const t=this._splitEdgeManipulator(s);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:s,snapOrigin:s.handle.pos}})).next(Object(Et.f)(this.view,e.elevationAlignedLocation)).next(Object(St.f)(this.view,this.graphic,e.elevationAlignedLocation,e.location.spatialReference,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:r,snappingManager:this.tool.snappingManager,snappingContext:new qt.a({editGeometryOperations:Object(a.s)(this._editGeometryOperations),elevationInfo:t,pointer:n,excludeFeature:this.graphic,visualizer:new de}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next(Object(Et.b)()).next((e=>{this._perVertexManipulatorDragAction(e),"end"===e.action&&(o=Object(a.r)(o))})),r.next(this._cancelDragOperation((()=>o=Object(a.r)(o))))}));return this._manipulatorHandles.add(o,r),this._manipulatorHandles.add([r.events.on("immediate-click",(e=>this._manipulatorClickCallback(e,s))),r.events.on("select-changed",(()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}))],r),this.emit("manipulators-changed"),s}_trackNumDragging(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}_cancelDragOperation(e){return()=>{switch(this._numDragging--,this.undo(),this.outputGeometry=Object(a.k)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null,Object(a.k)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._reshapeEventState){case 0:break;case 1:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(0)}}_setTypeSpecificManipulatorSettings(e,t,i){switch(t.type){case"vertex":e.state=di.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=De.reshapeManipulators.vertex.size/2+De.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=Object(a.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=di.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=De.reshapeManipulators.edge.size/2+De.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||Object(ei.h)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}_watchAndUpdateGrabState(e,t){return e.events.on("grab-changed",(i=>{if("start"===i.action)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==i.pointerType||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((e=>{e.manipulator.interactive=!this._numGrabbing&&Object(a.k)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!this._numGrabbing)})),Object(a.s)(this._graphicMoveManipulation).forEachManipulator((e=>e.interactive=!this._numGrabbing)))}))}_clearSelection(){for(const e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1)}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(e){if(e)for(const t of this._manipulatorInfos)if(e===t.handle)return t;return null}_updateManipulatorPosition(e){if(!e)return;const t=Object(a.s)(this._editGeometryOperations);if("vertex"===e.handle.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,hi),e.manipulator.grabbing&&Object(a.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){const i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,r=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if(Object(a.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){const n=i.location,a=r.location,s=.5,o=n.x+s*(a.x-n.x),c=n.y+s*(a.y-n.y),l=n.hasZ&&a.hasZ?0:void 0;e.manipulator.location=Object(Ie.g)(o,c,l,t.data.spatialReference)}else Object(b.i)(ui,i.renderLocation,r.renderLocation,.5),e.manipulator.renderLocation=ui}}_splitEdgeManipulator(e,t=.5){const i=Object(a.s)(this._editGeometryOperations),r=Object(a.s)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;const n=Object(d.e)(this.graphic);let s;this.enableEdgeOffset?(this._removeManipulator(e),s=this._createVertexOrEdgeManipulator(r)):(s=e,s.handle=r,s.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n)),r.leftEdge&&this._createVertexOrEdgeManipulator(r.leftEdge),r.rightEdge&&this._createVertexOrEdgeManipulator(r.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(s),this._updateSelection(e.manipulator);const o=this._updateEventState(2),c=i.data.coordinateHelper.vectorToArray(s.handle.pos),l=i.data.components.indexOf(r.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:c,componentIndex:l,vertexIndex:Object(a.s)(r.index)}],added:c}),o&&this._updateEventState(0),s}_updateMoveManipulationPosition(){const e=Object(b.w)(ui,0,0,0);let t=0,i=!1,r=null,n=null;for(const s of this._manipulatorInfos)ci(s)&&(s.manipulator.selected?(t++,Object(b.f)(e,e,s.manipulator.renderLocation),Object(a.j)(r)||s.selectedIndex>r.selectedIndex?(n=r,r=s):(Object(a.j)(n)||s.selectedIndex>n.selectedIndex)&&(n=s)):i=!0);if(0!==t){const e=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&at(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&1!==t}else{const e=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&at(this.graphic)}if(0!==t){let e=0;if(Object(a.k)(r)){const t=r.handle.pos,i=Object(a.k)(n)?n.handle.pos:r.handle.leftEdge&&r.handle.leftEdge.leftVertex?r.handle.leftEdge.leftVertex.pos:null,s=!Object(a.k)(n)&&r.handle.rightEdge&&r.handle.rightEdge.rightVertex?r.handle.rightEdge.rightVertex.pos:null;i&&s?this._moveManipulation.xyAxisManipulation.available=!1:i?e=oi(i,t):s&&(e=oi(t,s))}this._moveManipulation.angle=e,this._moveManipulation.radius=yt}else this._moveManipulation.angleDeferred=()=>Pt(Object(a.s)(this.graphic.geometry)),this._moveManipulation.radius=Ft.radiusForSymbol(this.graphic.symbol);0!==t&&i?(Object(b.e)(e,e,1/t),hi.spatialReference=Object(a.s)(this._editGeometryOperations).data.spatialReference,hi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,hi),this._moveManipulation.elevationAlignedLocation=hi):Object(a.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(a.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(nt.g)(this.view,this._moveManipulation,this.graphic)}_removeVertices(e){const t=[],i=Object(a.s)(this._editGeometryOperations);for(const r of e)if("vertex"===r.handle.type&&i.canRemoveVertex()){t.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));const e=Object(a.s)(i.removeVertices([r.handle]).removedVertices[0].createdEdge);e&&this._createVertexOrEdgeManipulator(e)}if(t.length>0){const e=t.map((e=>{const t=i.data.components.indexOf(e.component);return{coordinates:i.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:Object(a.s)(e.index)}}));this.outputGeometry=i.data.geometry;const r=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:e.map((e=>e.coordinates)),vertices:e}),this.destroyed)return;if(r&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(e,t,i=("start"===t.action?0:1)){const r=Object(a.s)(this._editGeometryOperations);r.moveVertices(e.map((e=>e.handle)),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=r.data.geometry;for(const n of e)this._updateManipulatorPosition(n)}_offsetEdge(e,t){if(Object(a.j)(t.operation))return;const i=Object(a.s)(this._editGeometryOperations),r=t.operation.clone();r.distance=t.operation.signedDistanceToPoint(t.mapEnd),i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],r),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),li(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}};function oi(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function ci(e){return"vertex"===e.handle.type}function li(e){return"edge"===e.handle.type}Object(r.a)([Object(o.b)({constructOnly:!0})],si.prototype,"tool",void 0),Object(r.a)([Object(o.b)()],si.prototype,"inputGeometry",null),Object(r.a)([Object(o.b)()],si.prototype,"outputGeometry",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],si.prototype,"updating",null),si=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],si);const hi=Object(Ie.g)(0,0,null,null),ui=Object(g.e)();var di,pi;(pi=di||(di={})).Vertex=16,pi.Edge=32;let fi=class extends(Re.a.EventedMixin(Nt.a)){constructor(e){super(e),this._handles=new m.a,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.snappingManager=null,this.automaticManipulatorSelection=!1}destroy(){this._handles=Object(a.e)(this._handles),this._reshapeOperation=Object(a.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get updating(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.updating)&&e}_updateGeometry(){const e=Object(Kt.a)(this.graphic);this._reshapeOperation.inputGeometry=Object(a.k)(e)?e.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==Object(Kt.b)(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_updateGeometryInternally(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){Object(a.j)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}initialize(){this._reshapeOperation=new si({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),this.view.on("pointer-down",["Shift"],(e=>{e.stopPropagation()})),Object(s.a)(this,"graphic",(()=>{this._updateGraphic()}),!0)]),this.complete()}get canUndo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canUndo)&&e}undo(){Object(a.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(a.k)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){var e,t;return null!=(e=null==(t=this._reshapeOperation)?void 0:t.canRedo)&&e}redo(){Object(a.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(a.k)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};Object(r.a)([Object(o.b)()],fi.prototype,"_reshapeOperation",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],fi.prototype,"view",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],fi.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],fi.prototype,"enableZShape",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],fi.prototype,"enableZVertex",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],fi.prototype,"enableMoveGraphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],fi.prototype,"enableMidpoints",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],fi.prototype,"enableEdgeOffset",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],fi.prototype,"type",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],fi.prototype,"snappingManager",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],fi.prototype,"updating",null),Object(r.a)([Object(o.b)()],fi.prototype,"automaticManipulatorSelection",void 0),fi=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],fi);var bi,gi,mi=i(110),vi=i(229),Oi=i(490);(gi=bi||(bi={})).ScaleIn=32,gi.ScaleOut=64,gi.RotateLeft=128,gi.RotateRight=256,gi.Unlocked=1024,gi.DelayedFocused=2048,gi.TouchInput=32768;class yi{constructor(e){this.mode=null,this._handles=new m.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new Re.a,this.getFocused=()=>this.ringManipulator.focused,this.getScale=()=>Object(a.k)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this.adapter.scale:1,this.tool=e.tool,this.mode=e.mode,this.adapter=e.adapter,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this.ringManipulator.location=e}set elevationAlignedLocation(e){this.ringManipulator.elevationAlignedLocation=e}get grabbing(){return this.ringManipulator.grabbing}set interactive(e){this.ringManipulator.interactive=e}destroy(){Object(a.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=Object(a.e)(this._handles),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Object(vi.a)({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){Object(a.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=Object(a.e)(this._activeAnimation))}forEachManipulator(e){e(this.ringManipulator,4)}createManipulator(){this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);const e=this.ringManipulator,t=this.tool.graphicState.graphic,i=Object(Et.e)(e,((e,i,r)=>{this._scaleRotateDragData=null,this.adapter.restart();const n={mode:"none",origin:Object(g.c)(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=n,this.updateDragState();const s=Y.d.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,s),i.next(Object(St.g)(this.tool.view,Object(ti.g)(e.renderLocation,s,Object(ti.d)()))).next((e=>{const i=Object(ti.q)(e.plane),r=Object(nt.a)(e.renderStart,e.renderEnd,n.origin,i),s=Oi.b.shortestSignedDiff(n.angle,r);n.angleDir=Object(q.f)(n.angleDir+s,-.3,.3),n.angle=r;const o=function(e,t){const i=Object(b.j)(Y.d.get(),t.renderStart,e.origin),r=Object(b.j)(Y.d.get(),t.renderEnd,e.origin),n=Object(b.p)(i),a=Object(b.p)(r);return 0===n?0:a/n}(n,e),c=o-this.adapter.scale;if(n.scaleDir=Object(q.f)(n.scaleDir+c,-.2,.2),this.onScaleChanged(),"none"===n.mode){const i=this.mode||function(e,t,i,r){const{renderStart:n,renderEnd:a}=e,s=_i(n,r,Y.d.get()),o=_i(a,r,Y.d.get());if(Object(b.l)(s,o)<100)return null;const c=Object(b.j)(Y.d.get(),n,i),l=Object(b.g)(Y.d.get(),c,Object(ti.q)(t)),h=n,u=Object(b.f)(Y.d.get(),h,l),d=_i(i,r,Y.d.get()),p=s,f=_i(u,r,Y.d.get()),g=Object(b.j)(Y.d.get(),f,p),m=Object(b.j)(Y.d.get(),s,d),v=Object(x.g)(p,g),O=Object(x.g)(d,m);return Object(x.d)(v,o)<Object(x.d)(O,o)?"rotate":"scale"}(e,e.plane,n.origin,this.tool.view.state.camera);if(Object(a.k)(i)){switch(i){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this.adapter.createUndoRecord()})}n.mode=i}}switch(n.mode){case"rotate":this.adapter.angle=n.initialAngle+r;break;case"scale":this.adapter.scale=o,this.onScaleChanged()}switch(this.updateDragState(),this.updateManipulatorTransform(),e.action){case"start":case"update":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Object(q.r)(n.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:o,yScale:o})}break;case"end":switch(n.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Object(q.r)(n.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:o,yScale:o});break;default:case"none":}}"end"===e.action&&(this.startAnimation(ji(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState())})),r.next((()=>{if(this.adapter.cancel(),Object(a.k)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(ji(this,(()=>this.onScaleChanged()))),this._scaleRotateDragData=null,this.updateDragState()}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(e=>{"focus"===e.action?this.startAnimation(function(e,t){let i=0,r=null;const n=()=>!1;return{start:()=>{r=e.getFocused,e.getFocused=n,i=0,t()},update:e=>(i+=e,!r()||i>200?1:0),destroy:()=>{e.getFocused=r,t()}}}(this,(()=>this.updateDelayedFocusedState()))):this.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(e=>{e.stopPropagation()})),Object(s.a)(this.tool.graphicState,"displaying",(e=>this.ringManipulator.available=e))])}onScaleChanged(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}updateDelayedFocusedState(){this.ringManipulator.updateStateEnabled(bi.DelayedFocused,this.getFocused())}updateDragState(){if(this.ringManipulator.updateStateEnabled(bi.Unlocked,!(Object(a.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(a.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(bi.ScaleIn|bi.ScaleOut,!1),this.ringManipulator.updateStateEnabled(bi.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(bi.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(bi.RotateLeft|bi.RotateRight,!1),this.ringManipulator.updateStateEnabled(bi.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(bi.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(bi.ScaleIn|bi.ScaleOut|bi.RotateLeft|bi.RotateRight,!1)}updateManipulatorTransform(){const e=Object(Mt.j)(Y.a.get()),t=this.adapter.angle;Object(Mt.e)(e,e,t,Object(g.g)(0,0,1));const i=this.getScale(),r=Object(Mt.w)(Y.a.get(),Object(b.w)(Y.d.get(),i,i,i)),n=Object(Mt.j)(Y.a.get());Object(Mt.n)(n,r,e),this.ringManipulator.modelTransform=n}createRingManipulator(){const e=(e,t,i)=>{const r=[],n=Math.ceil(128*(t-e)/(2*Math.PI));for(let a=0;a<n+1;a++){const s=e+a*(t-e)/n;r.push(Object(g.g)(i*Math.cos(s),i*Math.sin(s),0))}return r},t=t=>e(0,2*Math.PI,t),i=(e,t)=>S.a.createPathExtrusionGeometry((e=>[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]])(t),e,[],[],!1),r=t(_t),n=i(r,24),a={left:[],right:[]},s=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,r=Math.PI/2-jt,n=t+r,o=t+Math.PI/2-r,c=e(n,o,190),l=i(c,9);s.push(c),s.push(e(n,o,201)),a.left.push(l),a.right.push(l);for(let e=0;e<2;e++){const t=0===e,i=Object(L.d)();if(t){Object(Mt.g)(i,i,[1,-1,1]),Object(Mt.e)(i,i,-n,[0,0,1]);const e=Math.round(.2*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}else{Object(Mt.e)(i,i,o,[0,0,1]);const e=Math.round(.8*(c.length-1));i[12]=c[e][0],i[13]=c[e][1],i[14]=c[e][2]}const r=S.a.createExtrudedTriangle(60,0,23,.5);S.a.transformInPlace(r,i),(t?a.left:a.right).push(r)}}const o=[];for(let d=0;d<2;d++){const t=d*Math.PI-Math.PI/4,r=Math.PI/2-xt,n=t+r,a=t+Math.PI/2-r,s=e(n,a,213);o.push(i(s,9))}const c=t(190),l=t(213),h=i(c,9),u=i(l,9),p=t(130),f=t(107),b=i(p,9),m=i(f,9),v=this.createMaterial(),O=this.createMaterial(.66),y=this.createMaterial(.5),_=this.createMaterial(.33);let j=[{geometry:n,material:v,stateMask:bi.DelayedFocused},{geometry:n,material:y,stateMask:0}];this.mode&&"scale"!==this.mode||(j=j.concat([{geometry:o,material:v,stateMask:bi.DelayedFocused|bi.Unlocked},{geometry:h,material:O,stateMask:bi.DelayedFocused|bi.ScaleIn},{geometry:u,material:_,stateMask:bi.DelayedFocused|bi.ScaleIn},{geometry:b,material:O,stateMask:bi.DelayedFocused|bi.ScaleOut},{geometry:m,material:_,stateMask:bi.DelayedFocused|bi.ScaleOut}])),this.mode&&"rotate"!==this.mode||(j=j.concat([{geometry:a.right,material:v,stateMask:bi.DelayedFocused|bi.Unlocked},{geometry:a.left,material:v,stateMask:bi.DelayedFocused|bi.RotateLeft},{geometry:a.right,material:v,stateMask:bi.DelayedFocused|bi.RotateRight}]));const x=[r,...s];return new st.a({view:this.tool.view,renderObjects:j,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(d.e)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:x,direction:Object(g.g)(0,0,1)}})}createMaterial(e=1){const t=[...vt,e];return new At.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}get test(){return{ringManipulator:this.ringManipulator}}}function _i(e,t,i){return t.projectToScreen(e,xi),Object(b.w)(i,xi[0],xi[1],0)}function ji(e,t){let i=null,r=1;const n=()=>r;return{start:()=>{r=e.getScale(),i=e.getScale,e.getScale=n,t()},update:e=>(r+=((r+1)/2-r)*Math.min(3*e,1),t(),Math.abs(r-1)<.01?1:0),destroy:()=>{e.getScale=i,t()}}}const xi=Object(z.g)();var wi=i(198),Mi=i(745);function Si(e){return Object(a.k)(e.geometry)&&"mesh"===e.geometry.type?function(e){return Object(a.k)(e.transform)?function(e,t){let i=t.clone(),r=null;return{undo:t=>{r=Object(a.k)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:t=>{i=Object(a.k)(e.transform)?e.transform.clone():null,e.transform=r,t.notifyGeometryChanged()}}}(e,e.transform):function(e){let t,i=e.vertexAttributes.clonePositional();return{undo:r=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,r.notifyGeometryChanged()},redo:r=>{i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,r.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){let t=e.geometry,i=a.o;return{undo(e){i=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=i}}}(e)}let Ei=class extends rt.a{constructor(e){super(e),this.angle=0,this.scale=1,this.initialAngle=0,this.previousAngle=0,this.previousScale=1}initialize(){this.restart()}restart(){this.handles.remove(Ti);const e=this.geometry.transform;if(this.scale=1,Object(a.k)(e)){const t=Object(Mi.c)(e.rotation)[2];Math.abs(t)>.999999&&(this.angle=Object(q.h)(Object(Mi.a)(e.rotation))*Math.sign(t))}this.initialAngle=this.angle,this.previousAngle=this.angle,this.previousScale=this.scale,this.handles.add(Object(wi.b)((()=>({angle:this.angle,scale:this.scale})),(e=>this.update(e))),Ti)}cancel(){this.scale=1,this.angle=this.initialAngle}createUndoRecord(){return Si(this.graphic)}update({scale:e,angle:t}){const i=this.geometry.anchor,r=1===this.viewingMode;e!==this.previousScale&&(this.geometry.scale(e/this.previousScale,{origin:i,geographic:r}),this.previousScale=e,this.graphic.notifyGeometryChanged()),t!==this.previousAngle&&(this.geometry.rotate(0,0,Object(q.r)(t-this.previousAngle),{origin:i,geographic:r}),this.previousAngle=t,this.graphic.notifyGeometryChanged())}};Object(r.a)([Object(o.b)({constructOnly:!0})],Ei.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Ei.prototype,"geometry",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Ei.prototype,"viewingMode",void 0),Object(r.a)([Object(o.b)()],Ei.prototype,"angle",void 0),Object(r.a)([Object(o.b)()],Ei.prototype,"scale",void 0),Ei=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ei);const Ti="scale-heading-update-key";let Pi=class extends rt.a{constructor(e){super(e),this.angle=0,this.scale=1,this.symbol=null,this.initialAngle=0}initialize(){this.restart()}restart(){this.handles.remove(Ai);const e=Object(a.k)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:a.o;if(this.symbol=Object(a.k)(e)?e.clone():null,this.initialSizes=[],Object(a.k)(e)){const t=this.findLayerView();Object(a.k)(t)&&(this.initialSizes=e.symbolLayers.map((i=>"object"===i.type?t.getSymbolLayerSize(e,i):null)).toArray())}this.angle=0,Object(a.k)(e)&&e.symbolLayers.some((e=>!("object"!==e.type||!Object(a.k)(e.heading))&&(this.angle=-Object(q.h)(e.heading),!0))),this.initialAngle=this.angle,this.scale=1,this.handles.add(Object(wi.b)((()=>({angle:this.angle,scale:this.scale})),(e=>this.updateSymbol(e))),Ai)}cancel(){this.graphic.symbol=this.symbol}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:i=>{t=i.symbol,i.symbol=e,this.restart()},redo:i=>{e=i.symbol,i.symbol=t,this.restart()}}}updateSymbol({scale:e,angle:t}){const i=this.graphic.symbol;if(Object(a.j)(this.symbol)||Object(a.j)(i)||"point-3d"!==i.type)return;const r=i.clone(),n=-Object(q.r)(t-this.initialAngle);let s=!1;this.forEachObjectSymbolLayerPair(this.symbol,r,((t,i,r)=>{const o=Object(a.t)(t.heading,0)+n;i.heading!==o&&(i.heading=o,s=!0);const c=this.initialSizes[r];if(Object(a.k)(c)&&"width"in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);const t=c.width*e;i.width!==t&&(i.width=t,s=!0);const r=c.depth*e;i.depth!==r&&(i.depth=r,s=!0);const n=c.height*e;i.height!==n&&(i.height=n,s=!0)}})),s&&(this.graphic.symbol=r)}forEachObjectSymbolLayerPair(e,t,i){e.symbolLayers.forEach(((e,r)=>{const n=t.symbolLayers.getItemAt(r);"object"===e.type&&"object"===n.type&&i(e,n,r)}))}};Object(r.a)([Object(o.b)()],Pi.prototype,"angle",void 0),Object(r.a)([Object(o.b)()],Pi.prototype,"scale",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Pi.prototype,"graphic",void 0),Object(r.a)([Object(o.b)()],Pi.prototype,"symbol",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Pi.prototype,"findLayerView",void 0),Object(r.a)([Object(o.b)({constructOnly:!0})],Pi.prototype,"sizeFilter",void 0),Pi=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Pi);const Ai="scale-heading-update-key";let Ci=class extends(Object(rt.b)(Re.a.EventedMixin(Nt.a))){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.type="transform-3d",this.scaleRotate=null,this.snappingPipeline=new Wt.a}initialize(){this.graphicState=new Qe({graphic:this.graphic}),this.moveManipulation=new Ft({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&at(this.graphic),radius:Ft.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((e=>this.handles.add(e.events.on("immediate-click",(e=>{this.emit("immediate-click",{...e,graphic:this.graphicState.graphic}),e.stopPropagation()}))))),this.moveManipulation.elevationInfo=Object(d.e)(this.graphic);const e=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline(((t,i,r,n,s)=>(Object(a.k)(e)&&0===t&&(r=r.next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new qt.a({elevationInfo:Object(d.e)(this.graphic),pointer:s,editGeometryOperations:Ht.a.fromGeometry(new mi.a({spatialReference:e.spatialReference}),this.view.state.viewingMode),visualizer:new de,excludeFeature:this.graphic}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:n}),this.snappingPipeline.next)),r)),this.graphicState,(e=>{const{action:t,graphic:i,dxScreen:r,dyScreen:n}=e,a={graphic:i,dxScreen:r,dyScreen:n};switch(t){case"start":this.emit("graphic-translate-start",a),this.emit("record-undo",{record:this.createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",a);break;case"end":this.emit("graphic-translate-stop",a)}})),this.moveManipulation.angle=Object(a.k)(this.scaleRotate)?this.scaleRotate.angle:0,this.scaleRotateAdapter=this.createScaleRotateAdapter(),this.handles.add(this.scaleRotateAdapter.watch("angle",(()=>this.updateMoveAngle()))),this.enableScaling||this.enableRotation){const e=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new yi({tool:this,mode:e,adapter:this.scaleRotateAdapter}),this.handles.add(this.scaleRotate.events.on("scale-changed",(()=>this.onScaleChanged())))}this.handles.add([mt({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(n.c)()}),this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(()=>this.updateMoveAngle()))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged(),this.updateMoveAngle(),this.forEachManipulator((e=>{e instanceof st.a&&this.handles.add(e.events.on("grab-changed",(()=>this.updateManipulatorsInteractive())))})),this.complete()}updateManipulatorsInteractive(){Object(a.j)(this.scaleRotate)||(this.scaleRotate.interactive=!this.moveManipulation.grabbing,this.moveManipulation.interactive=!this.scaleRotate.grabbing)}createScaleRotateAdapter(){return Object(a.k)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Ei({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Pi({graphic:this.graphic,sizeFilter:e=>this.enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find((e=>e.layer===this.graphic.layer))})}forEachManipulator(e){this.moveManipulation.forEachManipulator(e),Object(a.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}hideManipulatorsForGraphicState(){return this.graphicState.watch("displaying",(e=>{this.forEachManipulator((t=>t.available=e)),this.moveManipulation.zManipulation.available=e&&this.enableZ&&at(this.graphic)}))}createGeometryUndoRecord(){return Si(this.graphic)}destroy(){this.moveManipulation.destroy(),this.scaleRotate=Object(a.e)(this.scaleRotate),this.scaleRotateAdapter=Object(a.e)(this.scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}set snapToScene(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}get updating(){return this.updatingHandles.updating}set location(e){this.moveManipulation.location=e,Object(a.k)(this.scaleRotate)&&(this.scaleRotate.location=e)}set elevationAlignedLocation(e){this.moveManipulation.elevationAlignedLocation=e,Object(a.k)(this.scaleRotate)&&(this.scaleRotate.elevationAlignedLocation=e)}reset(){}onDetach(){Object(a.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onHide(){Object(a.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}onScaleChanged(){if(Object(a.j)(this.scaleRotate))return;const e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}updateMoveAngle(){2===this.view.state.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.scaleRotateAdapter.angle:this.moveManipulation.angle=0}onGeometryChanged(){Object(nt.g)(this.view,this,this.graphic)}enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this.moveManipulation.renderLocation)}get test(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,zManipulator:this.moveManipulation.zManipulation.test.manipulator,ringManipulator:Object(a.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}};Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Ci.prototype,"view",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Ci.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Ci.prototype,"enableZ",void 0),Object(r.a)([Object(o.b)()],Ci.prototype,"enableRotation",void 0),Object(r.a)([Object(o.b)()],Ci.prototype,"enableScaling",void 0),Object(r.a)([Object(o.b)({value:!1})],Ci.prototype,"snapToScene",null),Object(r.a)([Object(o.b)({constructOnly:!0})],Ci.prototype,"snappingManager",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Ci.prototype,"type",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Ci.prototype,"updating",null),Ci=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Ci);var Di=i(112),Ri=i(215),Ii=i(641),zi=(i(98),i(197),i(485)),Li=i(464);Object(c.a)("mac"),Math.cos(Object(q.h)(45)),Math.cos(Object(q.h)(5));const Vi=[1,.5,0],Fi=[...Vi,1],ki=[1,1,1,1],Gi=[1,.8,.6,1],Ui=[1,.93,.86,1],Bi=[...Vi,1],Ni=[...Vi,1];i(903);var Hi=i(610),qi=i(410),Wi=i(375),Zi=i(611),$i=i(348),Yi=i(394),Xi=i(325),Qi=i(334),Ki=i(327),Ji=i(326),er=i(1048),tr=i(174);class ir extends Qi.a{initializeProgram(e){const t=ir.shader.get().build();return new Ji.a(e.rctx,t,Ki.a)}bindPass(e,t){Object(Yi.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",e.backgroundColor),this.program.setUniform4fv("gridColor",e.gridColor),this.program.setUniform1f("gridWidth",e.gridWidth)}bindDraw(e){Object(Yi.d)(this.program,e),this.program.rebindTextures()}initializePipeline(){return Object(tr.f)({blending:Object(tr.g)(1,1,771,771),depthTest:{func:513},colorWrite:tr.c})}}ir.shader=new Xi.a(er.a,(()=>i.e(318).then(i.bind(null,1305))));Wi.a;class rr extends qi.a{constructor(e){super(e),this._technique=new ir(this._techniqueRep.constructionContext,null),this.updateParameters()}updateParameters(){}beginSlot(e){return 8===e}bind(e){this._technique.bindPass(this._material.params,e)}}Object(r.a)([Object(Hi.c)()],rr.prototype,"_technique",void 0);Wi.b;M.a;var nr=i(688),ar=i(421),sr=i(802),or=i(362),cr=i(256),lr=i(278),hr=i(341),ur=i(532),dr=i(1049);class pr extends Qi.a{initializeProgram(e){const t=pr.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new Ji.a(e.rctx,r,Ki.a)}bindPass(e,t){Object(Yi.c)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("opacity",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(lr.a)(this.program,t))}bindDraw(e){Object(Yi.d)(this.program,e),Object(cr.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(tr.f)({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?fr:Object(or.a)(e),culling:Object(tr.b)(i.cullFace),depthTest:{func:Object(or.b)(e)},depthWrite:r?i.writeDepth&&tr.d:Object(or.c)(e),colorWrite:tr.c,stencilWrite:i.sceneHasOcludees?ur.h:null,stencilTest:i.sceneHasOcludees?t?ur.d:ur.c:null,polygonOffset:r||n?null:Object(or.g)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}pr.shader=new Xi.a(dr.a,(()=>i.e(308).then(i.bind(null,1306))));const fr=Object(tr.h)(1,771);class br extends hr.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(r.a)([Object(hr.b)({count:8})],br.prototype,"output",void 0),Object(r.a)([Object(hr.b)({count:3})],br.prototype,"cullFace",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"slicePlaneEnabled",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"transparent",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"enableOffset",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"writeDepth",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"sceneHasOcludees",void 0),Object(r.a)([Object(hr.b)({count:4})],br.prototype,"transparencyPassType",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"multipassTerrainEnabled",void 0),Object(r.a)([Object(hr.b)()],br.prototype,"cullAboveGround",void 0);class gr extends Wi.a{constructor(e){super(e,vr),this.supportsEdges=!0,this.techniqueConfig=new br}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<or.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,a,s){Object($i.f)(e,t,r,n,a,void 0,s)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new mr(e):void 0}createBufferWriter(){return new Zi.a(Zi.d)}}class mr extends sr.a{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(pr,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 23===e||(4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3))}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const vr={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...Wi.b};var Or,yr=i(1006),_r=i(86),jr=i(87),xr=i(108),wr=i(1007);let Mr=Or=class extends _r.a{constructor(e){super(e),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}clone(){return new Or({position:Object(jr.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(a.k)(this.position)&&Object(a.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}};Object(r.a)([Object(o.b)({readOnly:!0,json:{read:!1,write:!0}})],Mr.prototype,"type",void 0),Object(r.a)([Object(o.b)({type:mi.a}),Object(wr.a)()],Mr.prototype,"position",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(wr.a)(),Object(xr.a)((e=>Oi.a.normalize(Object(l.i)(e),0,!0)))],Mr.prototype,"heading",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(wr.a)(),Object(xr.a)((e=>Oi.a.normalize(Object(l.i)(e),0,!0)))],Mr.prototype,"tilt",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0}),Object(wr.a)()],Mr.prototype,"width",void 0),Object(r.a)([Object(o.b)({type:Number,nonNullable:!0}),Object(wr.a)()],Mr.prototype,"height",void 0),Mr=Or=Object(r.a)([Object(u.a)("esri.widgets.Slice.SlicePlane")],Mr);h.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Sr(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(b.f)(Y.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(b.f)(Y.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(b.j)(Y.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(b.j)(Y.d.get(),e.origin,e.basis2),edge:t}}}function Er(e){const t=Object(b.p)(e.basis1),i=Object(b.p)(e.basis2);return.3*Math.min(t,i)}function Tr(e){return Er(e)}function Pr(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Ar(e,t=1){const i=0===t?40:0,r=[Object(g.g)(i,0,-24),Object(g.g)(i,0,24)],n=function(e,t){const i=Object(b.j)(Object(g.e)(),e[e.length-1],e[e.length-2]);if(Object(b.r)(i,i),Object(b.e)(i,i,12),Object(b.f)(i,i,e[e.length-1]),t){const t=Object(b.j)(Object(g.e)(),e[0],e[1]);return Object(b.r)(t,t),Object(b.e)(t,t,12),Object(b.f)(t,t,e[0]),[t,...e,i]}return[...e,i]}(r,!0),s=(e,t)=>function(e,t,i){const r=r=>{const n=(r?t:e).slice(0),s=Object(b.j)(Y.d.get(),n[0],n[1]);Object(b.r)(s,s);const o=Object(b.j)(Y.d.get(),n[n.length-1],n[n.length-2]);if(Object(b.r)(o,o),i.padding>0){const e=Object(b.e)(Object(g.e)(),o,-i.padding);if(n[n.length-1]=Object(b.f)(e,e,n[n.length-1]),i.bothEnds){const e=Object(b.e)(Object(g.e)(),s,-i.padding);n[0]=Object(b.f)(e,e,n[0])}}const c=r?i.tipFocusMultiplier:1,l=i.tipLength*(i.focusTipLength?c:1),h=i.tipRadius*c,u=Object(Mt.j)(Y.a.get());if(i.padding>0){const e=l/4,t=Object(b.w)(Y.d.get(),0,e,0),r=1+i.padding/e;Object(Mt.t)(u,u,t),Object(Mt.g)(u,u,Object(b.w)(Y.d.get(),r,r,r)),Object(Mt.t)(u,u,Object(b.e)(t,t,-1/r))}const d=Object(Mt.j)(Object(L.d)()),p=Object(g.g)(0,1,0),f=Object(Mt.x)(Object(L.d)(),Object(zi.g)(Y.b.get(),p,o));f[12]=n[n.length-1][0],f[13]=n[n.length-1][1],f[14]=n[n.length-1][2],Object(Mt.n)(f,f,u);const m=[{part:"tube",geometry:Dr(i.tubeRadius*(r?i.tubeFocusMultiplier:1)+i.padding,i.flat,n),transform:d}];let v,O;if(Object(a.k)(i.flat)?v=S.a.createExtrudedTriangle(l,h,h,i.flat.thickness):(v=S.a.createConeGeometry(l,h,24,!1,!1,!0),O=S.a.createConeGeometry(l,h,24,!1,!0,!1)),m.push({part:"tip",geometry:v,transform:f}),O&&m.push({part:"cap",geometry:O,transform:f}),i.bothEnds){const e=Object(Mt.x)(Object(L.d)(),Object(zi.g)(Y.b.get(),p,s));e[12]=n[0][0],e[13]=n[0][1],e[14]=n[0][2],Object(Mt.n)(e,e,u),m.push({part:"tip",geometry:v,transform:e}),O&&m.push({part:"cap",geometry:O,transform:e})}return m};return{normal:r(!1),focused:r(!0)}}(r,r,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t}),o=s(0,!1),c=s(2.25,!0),l=new At.a({color:ki,cullFace:2,renderOccluded:16}),h=new At.a({color:Gi,cullFace:2,renderOccluded:16}),u=new At.a({color:Ui,cullFace:2,renderOccluded:16}),d=new At.a({color:Ni,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),p=S.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),f=S.a.createPolylineGeometry([[i,0,0],[i-40,0,0]]),m=new yr.a({color:Bi,renderOccluded:4});return new st.a({view:e,renderObjects:[...o.normal.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?h:u,transform:i,stateMask:1|Ir}))),...c.normal.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:1|Ir}))),{geometry:p,material:m,stateMask:1|Ir|zr},...o.focused.map((({part:e,geometry:t,transform:i})=>({geometry:t,material:"tip"===e?l:"cap"===e?h:u,transform:i,stateMask:2|Ir}))),...c.focused.map((({geometry:e,transform:t})=>({geometry:e,material:d,transform:t,stateMask:2|Ir}))),{geometry:f,material:m,stateMask:2|Ir|zr}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:11,state:Ir})}function Cr(e,t){const i=Pr(t),r=i?[Object(g.g)(1,0,0),Object(g.g)(0,0,0),Object(g.g)(0,1,0)]:[Object(g.g)(1,0,0),Object(g.g)(-1,0,0)],n=S.a.createPolylineGeometry(r),a=[...Vi,1],s=i?4:1,o=2*s,c=e=>e>1?(e=>new E.a({color:a,width:e,renderOccluded:4}))(e):new yr.a({color:a,renderOccluded:4}),l=[{geometry:n,material:c(s),stateMask:1|Vr},{geometry:n,material:c(o),stateMask:2|Vr},{geometry:n,material:c(1),stateMask:Fr}],h=new st.a({view:e,renderObjects:l,collisionType:{type:"line",paths:[r]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4,idHint:i?1:2});return h.state=Vr,h}function Dr(e,t,i){const r=[];if(Object(a.k)(t))r.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else{const t=12;for(let i=0;i<t;i++){const n=i/t*2*Math.PI;r.push([Math.cos(n)*e,Math.sin(n)*e])}}return S.a.createPathExtrusionGeometry(r,i,[],[],!1)}function Rr(e,t){return Object(Li.b)(t,e.basis2,e.basis1)+Lr}const Ir=16,zr=32,Lr=(Object(x.c)(),Math.PI/2),Vr=16,Fr=32;class kr{constructor(){this.lastDragEvent=null,this.next=new Et.a,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&Object(a.k)(this.lastDragEvent)){const t={...this.lastDragEvent,action:"update"};e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this.lastDragEvent=null,e=>(this.lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this.adjustScaleFactors(e),e)}adjustScaleFactors(e){const t=Pr(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{adjustScaleFactors:e=>this.adjustScaleFactors(e)}}}var Gr=i(979),Ur=i(981),Br=i(982),Nr=i(978);function Hr(e,t){return Wr(e,t,!1)}function qr(e,t){return Wr(e,t,!0)}function Wr(e,t,i){if(e instanceof Nr.a){if(e.operation instanceof Gr.a)return function(e,t,i=!1){const r=i?-1:1,n=Object(g.g)(r*e.dx,r*e.dy,r*e.dz);Object(b.f)(t.origin,t.origin,n)}(e.operation,t,i),!0;if(e.operation instanceof Ur.a)return function(e,t,i=!1){const r=i?-e.angle:e.angle;Object(b.d)(t.basis1,t.basis1,g.b,r),Object(b.d)(t.basis2,t.basis2,g.b,r)}(e.operation,t,i),!0;if(e.operation instanceof Br.a)return function(e,t,i=!1){const r=i?1/e.factor1:e.factor1,n=i?1/e.factor2:e.factor2;Object(b.e)(t.basis1,t.basis1,r),Object(b.e)(t.basis2,t.basis2,n),Object(V.p)(t.origin,t.origin,e.origin,e.axis1,r),Object(V.p)(t.origin,t.origin,e.origin,e.axis2,n)}(e.operation,t,i),!0}return!1}let Zr=class extends(Re.a.EventedMixin(Nt.a)){constructor(e){super(e),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this._preserveAspectRatio=new kr,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this.handles=new m.a,this.moveZManipulator=null,this.resizeManipulators=null,this.rotateManipulator=null,this.attachmentOrigin=null,this.outlineVisualElement=null,this.mapBounds=Object(Ii.a)(),this.mapBoundsStart=Object(Ii.a)(),this.displayBounds=Object(Ii.a)(),this.displayBoundsStart=Object(Ii.a)(),this.displayBoundsMarginStart=0,this.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}]}initialize(){this.graphicState=new Qe({graphic:this.graphic});const e=this.graphic.geometry;this.editGeometryOperations=Ht.a.fromGeometry(e,this.view.state.viewingMode),this.graphicMoveManipulation=new Ut({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this.createMoveXYGraphicDragPipeline()),this.moveZManipulator=Ar(this.view,0),this.moveZManipulator.state|=zr,this.handles.add(this.watch("enableZ",(()=>this.updateManipulatorAvailability(this.moveZManipulator,0)))),this.handles.add(this.createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((e=>{const t=Cr(this.view,e);return this.handles.add(this.watch("enableScaling",(()=>this.updateManipulatorAvailability(t,2)))),t.events.on("grab-changed",(e=>this.onResizeGrab(e))),this.handles.add(this.createResizeDragPipeline(t,e)),t})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new ie.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACuFBMVEUAAAD/AAD/gAD/VQD/gAD/bQD/gAD/cQD/gAD/dAD/eAD/gAD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fQD/gAD/fQD/fQD/egD/fQD/gAD/fQD/ewD/fQD/gAD/gAD/fQD/gAD/fAD/fgD/fgD/fAD/fgD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fQD/fgD/fgD/fQD/fgD/fgD/fQD/fgD/fQD/fQD/fgD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fgD/gAL/fgD/gAb/gAT/gwr/gQj/hA7/hAz/hxH/iBP/ixn/iRf/jBz/jR7/jyP/kCX/kyr/lS7/lCz/li//mTT/mTf/nDr/mjn/nTz/n0H/nT//oET/oEL/okf/oEX/o0r/pU3/o0v/pU//qFL/plH/qFX/qFP/qVb/q1n/rV3/rFz/rmD/rl7/sGL/rmH/tW3/s2v/tW//tW7/t3L/tnD/uHT/unb/unn/unf/vHv/vX3/v4D/vX7/w4n/xY3/xIv/x4//xY3/x5H/yZP/x5H/yJP/y5f/yZX/zZv/y5n/zZ3/zJv/z5//z6D/z6H/0aT/0KP/0qb/06j/1av/06r/1q3/1q//17H/2rb/2rb/2rj/3bz/4MH/38D/38H/4sX/4MT/48f/4sb/4sf/5Mr/5s3/5cz/5s3/59D/59D/6dT/6dP/6dT/6tb/6tX/6tf/69n/69j/7dr/7Nn/7dz/7dv/7t3/7t7/7t3/7+H/8eL/8uX/8eP/8+j/8+f/9On/8+j/9Or/9ez/9e3/9ez/9e3/9+//9+7/+PD/9+//+PH/+PD/+fL/+PH/+fT/+vX/+fT/+vb/+vX/+/b/+vb/+/j/+/j//Pr//Pn//fv//v3//vz//fz//fv//v3//fz//////v7//v3///9vf1WOAAAA53RSTlMAAQIDBgcICQoLERIYGRobKCkqKywtLzAxMjM4OTo+P0BAQUVGR0hPUFFSUlNUWlthYmNlZmdoamtvcHR1dnd4eXx9f4CAgYGCgoODhIWGhoeIiYqLjIyNjo+QkJGSkpOTlJSVlpaXmJiZmZqbnJydnZ6eoqKjo6Skpaanp6ipqqqvsLCxsbKzs7S1tbe3uLi5uru8vL2+wMDBwsTGx8jLzc3O0NDR0dLT1dXW19ja2tvc3N3e3t/f4ODh4uLl5ufn6urr6+zt7u7v8PDx8fLy8/P09fX29vf3+Pn6+vv8/Pz8/f3+/v7EBDCzAAADmklEQVR42qXXd3sUVRQG8BNDKkU3KLYUIFkLLBo0yRJNBszuuwQlGISIDUTFhljAhhUbtlXEYEcjoEJUNCqKPXZUUCDU0FvI+RpkZpa5c9iZzMzD7+/d88yde+95z5CbvIIhIyqrtbo6rboyUlKQR4GcGI7GIMSi4QHkU1bRKDgaVZRF3nKGanClDc4hD4Nq0CvtzAzqRd8L4GlkX3IVGg0fxpxMzjLOgk9hx2VkRuBbJNPh/+cjpQnezkuvcC6Q8vVseItkkKTWP6Pr17HwVkbCQFg+YJ4P3U0vtrS1t//c9u6zM+DgFLH/av+m7Gfe1IhpLf+ysmbxVBxrdD4ptvPzDvdY2trNUvfytBLlZDkdloZt3GPvPk5z8K0EpFMpJacWlmTqmdnBd1dBqMkm01BY4n+waTsb1nd0drHl/2kQSsiQpcHyKKd0MP/YfOt4AJfPWtTOKRumw04z+0MRlNV81PezoNz5JZv+boRdIemisMxkS+ck2M3rZMPHskcZ/Q/KR6y8D2HqWjbMh11/IgrDfoiU7lsgXGNW6GgQB1quYPrClk9+WnuITash3WGWfw02VUR5MUCKX3n7w8m3P1z121xIzazbMg5KLJcK4Ntl5vV4EDYhGgz/XmDdcnmWRsC/iQeM1wibYVSBAL5g3WQoF9JFCOBN1t0PpZo0BDCPdU9BqaU6BPAA65JQLglWYDbrFooCGgJ4jHXPiSUEeokvse4hKNXBtnEF624W2xiBf/GN3GP3pVCG0xAIE57+9h64uZd1bbApFpcpMXfFLuaVcLOKdS/DJiSu87UHucfhOb0+wIEmeZ0pCqWVdX+Nh5MJ61i3BDaVsqVhphkCnyaQrt68SYdvhE0pEQ2AzRI2LBuX3k1a2fAe7PoRyTU0/seGb66ANPkHNqxpEG1dBIvhvkNs2PLMWCiJ5FY27LlbBouMNsOTXWz6p/lqmK57fR2buh+HjDYVrsqCLhWmK5cuXvbZBhUVzzuGK+XUwO6J3exs5yMQLs6mlNMg3PY7O/nlBkiDyDISQv2CHXysrckEpHI5ZEmTXpUzyp+vTOx1yHLIp/icN74y927z54vuiiNNiISwc5hNub6pHoo8xNI5CCSS4T5sw/ewLZ1wNnwbnklOyuBPrJRcnKTBhzEDyVV+OTyV5x/fZ98Z5CG7RIOr2pJs8tanMApH0cI+5FP/sqoYhFhVaT8KJDdUHKkwP/8rhhWHct1+dwRTps/cplDIpwAAAABJRU5ErkJggg==",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){const i=new gr({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),r=40,n=27*1.1,a=e=>{const t=new Uint32Array([0,1,2,2,3,0]);return new ar.a([["position",{size:3,data:[r-e,-e,0,r+e,-e,0,r+e,e,0,r-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},s=S.a.createPolylineGeometry([[0,0,0],[13,0,0]]),o=S.a.createPolylineGeometry([[0,0,0],[r-n,0,0]]),c=new yr.a({color:Fi,renderOccluded:4}),l=[{geometry:a(27),material:i,stateMask:1|Ir},{geometry:s,material:c,stateMask:1|Ir},{geometry:a(n),material:i,stateMask:2|Ir},{geometry:o,material:c,stateMask:2|Ir}];return new st.a({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},collisionPriority:1,radius:13.5,state:Ir})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(()=>this.updateManipulatorAvailability(this.rotateManipulator,3)))),this.rotateManipulator.events.on("grab-changed",(e=>{this.onRotateGrab(e)})),this.handles.add(this.createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds();const t=mt({view:this.view,graphic:this.graphic,forEachManipulator:e=>this.forEachManipulator(e),onManipulatorsChanged:()=>Object(n.c)()});Object(a.k)(t)&&(this.outlineVisualElement=t.visualElement instanceof Be?t.visualElement:null),Object(a.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(()=>this.updateDisplayBounds()))),this.handles.add(t),this.handles.add([this.graphicState.on("changed",(()=>this.onGeometryChanged())),this.graphicState.watch("displaying",(()=>this.updateAllManipulatorAvailability())),Object(s.a)(this.graphicState,"isDraped",(()=>this.graphicDrapedChanged())),this.view.trackGraphicState(this.graphicState)]);const i=this.view.pointsOfInterest;i&&this.handles.add(i.centerOnSurfaceFrequent.watch("location",(()=>this.updateDisplayBounds())));this.forEachManipulator((e=>{this.handles.add(e.events.on("grab-changed",(()=>{this.grabbing=e.grabbing,this.updateAllManipulatorAvailability()})))}));this.forEachManipulator(((e,t)=>{this.handles.add(e.events.on("immediate-click",(e=>{1===t&&this.emit("immediate-click",{...e,graphic:this.graphic}),e.stopPropagation()})))})),this.onGeometryChanged(),this.updateAllManipulatorAvailability(),this.complete()}graphicDrapedChanged(){this.handles.remove($r),this.updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(e=>{Object(a.k)(this.attachmentOrigin)&&Object(dt.j)(e.extent,this.attachmentOrigin.x,this.attachmentOrigin.y)&&this.updateDisplayBounds()})),$r)}updateAllManipulatorAvailability(){this.forEachManipulator(((e,t)=>this.updateManipulatorAvailability(e,t)))}updateManipulatorAvailability(e,t){const i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof st.a){const r=this.graphicState.displaying,n=this.enableZ&&at(this.graphic);switch(t){case 3:e.available=r&&this.enableRotation;break;case 2:e.available=r&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Vr:Fr;break;case 0:e.available=r&&n;break;default:e.available=r}}}forEachManipulator(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((t=>e(t,2))),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}destroy(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._set("view",null),this._set("graphic",null)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}reset(){}onDetach(){this.mapBounds=null,this.displayBounds=null}onGeometryChanged(){this.updateDisplayBounds()}calculateMapBounds(){const e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],r=Object(V.a)(Y.c.get(),i.leftVertex.pos,i.rightVertex.pos);Object(V.f)(r,r);const n=Object(a.t)(Object(nt.f)(this.view,this.graphic),e.extent.center);let s=Xr*this.view.pixelSizeAt(n);const o=this.view.spatialReference;o!==e.spatialReference&&(s*=Object(Di.f)(o)/Object(Di.f)(e.spatialReference)),function(e,t,i,r){r||(r=Object(Ii.a)());const n=Object(V.s)(Y.c.get(),e[1],-e[0]),a=Object(V.s)(Y.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s=Object(V.s)(Y.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=Y.c.get();t.components.forEach((t=>t.vertices.forEach((t=>{const i=t.pos;Object(V.s)(o,Object(V.h)(e,i),Object(V.h)(n,i)),Object(V.v)(a,a,o),Object(V.w)(s,s,o)}))));const c=1e-6,l=Object(V.s)(Y.c.get(),s[0]-a[0]<c?i/2:0,s[1]-a[1]<c?i/2:0);Object(V.a)(a,a,l),Object(V.i)(s,s,l),Object(V.b)(r.basis1,e,(s[0]-a[0])/2),Object(V.b)(r.basis2,n,(s[1]-a[1])/2),Object(V.s)(r.origin,a[0]*e[0]+a[1]*n[0],a[0]*e[1]+a[1]*n[1]),Object(V.i)(r.origin,r.origin,r.basis1),Object(V.i)(r.origin,r.origin,r.basis2)}(r,t,s,this.mapBounds)}updateDisplayBounds(){const e=this.graphic.geometry,t=Object(a.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(a.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(nt.f)(this.view,this.graphic);this.attachmentOrigin=Object(a.t)(t,e.extent.center);const i=Object(a.k)(t)?t.z:Object(J.e)(this.mapBounds.origin,this.view.elevationProvider,ee.a.fromElevationInfo(Object(d.e)(this.graphic)),this.view.renderCoordsHelper),r=Object(Ii.b)(this.mapBounds);r.origin[2]=i,function(e,t,i,r=0,n){n||(n=Object(Ii.a)()),t.toRenderCoords(e.origin,i,n.origin);const a=Y.d.get();Object(b.f)(a,e.origin,e.basis1),Object(b.f)(a,a,e.basis2),t.toRenderCoords(a,i,a);const s=Y.d.get();Object(b.f)(s,e.origin,e.basis1),Object(b.j)(s,s,e.basis2),t.toRenderCoords(s,i,s);const o=Y.d.get();Object(b.j)(o,e.origin,e.basis1),Object(b.j)(o,o,e.basis2),t.toRenderCoords(o,i,o);const c=Y.d.get();Object(b.j)(c,e.origin,e.basis1),Object(b.f)(c,c,e.basis2),t.toRenderCoords(c,i,c);const l=Object(b.i)(Y.d.get(),a,s,.5);Object(b.j)(l,l,n.origin);const h=Object(b.i)(Y.d.get(),o,c,.5);Object(b.j)(h,n.origin,h),Object(b.i)(n.basis1,l,h,.5);const u=Object(b.i)(Y.d.get(),c,a,.5);Object(b.j)(u,u,n.origin);const d=Object(b.i)(Y.d.get(),s,o,.5);Object(b.j)(d,n.origin,d),Object(b.i)(n.basis2,u,d,.5);const p=Object(b.g)(Y.d.get(),n.basis1,n.basis2),f=Object(b.g)(p,p,n.basis1);Object(b.r)(f,f),Object(b.e)(n.basis2,f,Object(b.h)(n.basis2,f)),Object(b.e)(n.basis1,n.basis1,1+r/Object(b.p)(n.basis1)),Object(b.e)(n.basis2,n.basis2,1+r/Object(b.p)(n.basis2)),Object(Ii.j)(n)}(r,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this.updateManipulators()}get displayBoundsMargin(){const e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return Yr*this.view.pixelSizeAt(t)}createMoveXYGraphicDragPipeline(){return this.graphicMoveManipulation.createDragPipeline(((e,t,i)=>this.applyGraphicMoveSteps(t,i)))}createMoveZDragPipeline(){const e=this.view,t=this.editGeometryOperations.data.spatialReference;return Object(Et.e)(this.moveZManipulator,((i,r,n)=>{const a=Object(g.c)(i.renderLocation),s=r.next(Object(St.i)(e,a,t)).next(Object(Et.c)());this.applyGraphicMoveSteps(s,n)}))}applyGraphicMoveSteps(e,t){const i=e.next((e=>("start"===e.action&&(this.inputState={type:"move"},Object(Ii.b)(this.mapBounds,this.mapBoundsStart),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e))).next(Object(Et.b)()).next(this.moveDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&this.emit("graphic-translate",t);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",t)}return e}));return t.next((()=>{Object(a.k)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this.cancel()})),i}moveDragUpdateGeometry(){return e=>{if(Object(a.j)(this.inputState)||"move"!==this.inputState.type)return e;const t=[];for(const r of this.editGeometryOperations.data.components)t.push(...r.vertices);const i="start"===e.action?0:1;return Hr(this.editGeometryOperations.moveVertices(t,e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,i),this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}onResizeGrab(e){if("start"!==e.action)return;const t=this.calculatePickRay(e.screenPoint);Object(ti.m)(this.displayBounds.plane,t,Y.d.get())&&(Object(Ii.b)(this.displayBounds,this.displayBoundsStart),Object(Ii.b)(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}createResizeDragPipeline(e,t){return Object(Et.e)(e,((e,i,r)=>{Object(a.j)(this.inputState)||(i.next((e=>("start"===e.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),e))).next(Object(St.g)(this.view,this.displayBoundsStart.plane)).next((e=>({...e,handle:t}))).next(this.resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this.resizeDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":this.emit("graphic-scale",t);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",t)}return e})),r.next((()=>{Object(a.k)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this.cancel()})))}))}resizeDragRenderPlaneToFactors(){return e=>{const t=this.displayBoundsStart,i=e.handle.direction,r=this.displayBoundsMargin,n=this.displayBoundsMarginStart,a=Object(b.k)(Y.d.get(),t.origin);Object(b.c)(a,a,t.basis1,-i[0]),Object(b.c)(a,a,t.basis2,-i[1]);const s=Object(b.j)(Y.d.get(),e.renderEnd,a),o=Object(b.j)(Y.d.get(),e.renderStart,a),c=Pr(e.handle),l=Tr(t),h=Tr(this.displayBounds)/l,u=(e,t)=>{if(0===e)return 1;let i=Object(b.p)(t),a=.5*e*Object(b.h)(t,s)/i;const l=a<0?-1:1;c&&(a+=(i-.5*e*Object(b.h)(t,o)/i)*l*h);const u=i<1.5*n?1:Qr;return i=Math.max(i-n,Qr),l>0&&(a-=r),l*Math.max(l*(a/i),u)};return{...e,factor1:u(i[0],t.basis1),factor2:u(i[1],t.basis2)}}}resizeDragUpdateGeometry(){return e=>{const t=Object(b.k)(Object(g.e)(),this.mapBoundsStart.origin);Object(b.c)(t,t,this.mapBoundsStart.basis1,-e.handle.direction[0]),Object(b.c)(t,t,this.mapBoundsStart.basis2,-e.handle.direction[1]);const i=Object(V.s)(Object(Ri.a)(),this.mapBoundsStart.basis1[0],this.mapBoundsStart.basis1[1]);Object(V.f)(i,i);const r=[];for(const s of this.editGeometryOperations.data.components)r.push(...s.vertices);const n="start"===e.action?0:1,a=this.editGeometryOperations.scaleVertices(r,t,i,e.factor1,e.factor2,n,1);return Object(Ii.b)(this.mapBoundsStart,this.mapBounds),Hr(a,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}onRotateGrab(e){if("start"!==e.action)return;const t=function(e,t,i,r){const n=t.worldUpAtPosition(e.origin,Y.d.get()),a=Y.d.get();switch(i){case 1:Object(b.k)(a,n);break;case 2:Object(b.k)(a,e.basis1)}return Object(ti.g)(e.origin,a,r)}(this.displayBounds,this.view.renderCoordsHelper,1,Object(ti.d)()),i=this.calculatePickRay(e.screenPoint);Object(ti.m)(t,i,Y.d.get())&&(Object(Ii.b)(this.displayBounds,this.displayBoundsStart),Object(Ii.b)(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}createRotateDragPipeline(e){return Object(Et.e)(e,((e,t,i)=>{const r=this.inputState;Object(a.j)(r)||(t.next((e=>("start"===e.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),e))).next(Object(St.g)(this.view,r.rotatePlane)).next(this.rotateDragRenderPlaneToRotate(r)).next(this.rotateDragUpdateGeometry()).next((e=>{const t={graphic:this.graphic,angle:Object(q.r)(e.rotateAngle)};switch(e.action){case"start":case"update":this.emit("graphic-rotate",t);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",t)}return e})),i.next((()=>{Object(a.k)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this.cancel()})))}))}rotateDragRenderPlaneToRotate(e){return t=>{const i=Object(ti.q)(e.rotatePlane),r=Object(nt.a)(t.renderStart,t.renderEnd,this.displayBounds.origin,i);return{...t,rotateAxis:i,rotateAngle:r}}}rotateDragUpdateGeometry(){return e=>{const t=Object(b.k)(Object(g.e)(),this.mapBoundsStart.origin),i=[];for(const a of this.editGeometryOperations.data.components)i.push(...a.vertices);const r="start"===e.action?0:1,n=this.editGeometryOperations.rotateVertices(i,t,e.rotateAngle,r,1);return Object(Ii.b)(this.mapBoundsStart,this.mapBounds),Hr(n,this.mapBounds),this.graphic.geometry=this.editGeometryOperations.data.geometry,e}}calculatePickRay(e){const t=Object(x.c)(),i=Object(z.j)(e);return Object(nr.b)(this.view.state.camera,i,t),Object(b.r)(t.direction,t.direction),t}updateManipulators(){if(!this.visible)return;const e=function(e,t){return Object(nt.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,Y.a.get());(function(e,t,i,r){const n=r.worldUpAtPosition(i.origin,Y.d.get()),a=Sr(i,0),s=Object(Mt.j)(Y.a.get());Object(Mt.r)(s,s,a.edge*Math.PI/2),Object(Mt.d)(s,s,-Rr(i,n)),Object(Mt.n)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=a.position})(this.rotateManipulator,e,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,e),this.resizeManipulators.forEach(((t,i)=>{!function(e,t,i,r){const n=Object(b.p)(r.basis1),a=Object(b.p)(r.basis2),s=Er(r),o=Tr(r),c=Object(b.w)(Y.d.get(),0,0,0);Object(b.f)(c,Object(b.e)(Y.d.get(),r.basis1,t.direction[0]),Object(b.e)(Y.d.get(),r.basis2,t.direction[1])),Object(b.f)(c,r.origin,c);let l=0,h=1;if(Pr(t))1===t.direction[0]&&-1===t.direction[1]?l=Lr:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),h=o;else{const e=0!==t.direction[0]?1:2;l=1===e?Lr:0,h=(1===e?a:n)-s}const u=Object(Mt.j)(Y.a.get());Object(Mt.r)(u,u,l),Object(Mt.g)(u,u,Object(b.w)(Y.d.get(),h,h,h)),Object(Mt.n)(u,i,u),u[12]=0,u[13]=0,u[14]=0,e.modelTransform=u,e.renderLocation=c}(t,this.resizeHandles[i],e,this.displayBounds)}))}updateZMoveHandle(e,t){const i=this.displayBounds,r={basis:i.basis1,direction:-1,position:Object(b.j)(Y.d.get(),i.origin,i.basis1),edge:2},n=Y.a.get();Object(Mt.r)(n,t,r.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=r.position}cancel(){const e=this.editGeometryOperations.lastOperation;Object(a.j)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,qr(e,this.mapBounds),this.updateDisplayBounds(),this.inputState=null)}get canUndo(){return this.editGeometryOperations.canUndo}undo(){if(Object(a.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,qr(Object(a.s)(e),this.mapBounds),this.updateDisplayBounds()}}get canRedo(){return this.editGeometryOperations.canRedo}redo(){if(this.canRedo){const e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,Hr(Object(a.s)(e),this.mapBounds),this.updateDisplayBounds()}}get test(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator}}};Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Zr.prototype,"view",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Zr.prototype,"graphic",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],Zr.prototype,"enableZ",void 0),Object(r.a)([Object(o.b)()],Zr.prototype,"enableRotation",void 0),Object(r.a)([Object(o.b)()],Zr.prototype,"enableScaling",void 0),Object(r.a)([Object(o.b)()],Zr.prototype,"preserveAspectRatio",null),Object(r.a)([Object(o.b)()],Zr.prototype,"grabbing",void 0),Object(r.a)([Object(o.b)()],Zr.prototype,"inputState",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],Zr.prototype,"type",void 0),Zr=Object(r.a)([Object(u.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Zr);const $r="draped-elevation-changes",Yr=10,Xr=80,Qr=1e-6},179:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(107),n=i(85),a=i(195),s=i(202),o=i(398);class c{constructor(e,t,i=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(s.c.Texture,this),this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...t},34067===this._descriptor.target?this.setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(s.c.Texture,this))}release(){this.dispose()}resize(e,t){const i=this._descriptor;i.width===e&&i.height===t||(i.width=e,i.height=t,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null))}setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this.setData(e,t)}setData(e,t=3553){if(!this._context||!this._context.gl)return;const i=this._context.gl;this._glName||(this._glName=i.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const r=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES),s=this._descriptor;c._validateTexture(this._context,s),i.pixelStorei(i.UNPACK_ALIGNMENT,s.unpackAlignment),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,s.flipped?1:0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.preMultiplyAlpha?1:0);const o=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(o,s.dataType);if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let r=e.width,n=e.height;e instanceof HTMLVideoElement&&(r=e.videoWidth,n=e.videoHeight),s.width&&s.height,i.texImage2D(t,0,l,o,s.dataType,e),Object(a.a)(i),s.hasMipmap&&this.generateMipmap(),void 0===s.width&&(s.width=r),void 0===s.height&&(s.height=n)}else{null!=s.width&&null!=s.height||console.error("Width and height must be specified!"),i.DEPTH24_STENCIL8&&l===i.DEPTH_STENCIL&&(l=i.DEPTH24_STENCIL8);let r=s.width,c=s.height;if(function(e){return Object(n.k)(e)&&"type"in e&&"compressed"===e.type}(e)){const n=Math.round(Math.log(Math.max(r,c))/Math.LN2)+1;s.hasMipmap=s.hasMipmap&&n===e.levels.length;for(let a=0;;++a){const n=e.levels[Math.min(a,e.levels.length-1)];if(i.compressedTexImage2D(t,a,l,r,c,0,n),1===r&&1===c||!s.hasMipmap)break;r=Math.max(1,r>>1),c=Math.max(1,c>>1)}}else if(Object(n.k)(e))i.texImage2D(t,0,l,r,c,0,o,s.dataType,e),Object(a.a)(i),s.hasMipmap&&this.generateMipmap();else for(let e=0;i.texImage2D(t,e,l,r,c,0,o,s.dataType,null),Object(a.a)(i),(1!==r||1!==c)&&s.hasMipmap;++e)r=Math.max(1,r>>1),c=Math.max(1,c>>1)}c._applySamplingMode(i,this._descriptor),c._applyWrapMode(i,this._descriptor),c._applyAnisotropicFilteringParameters(this._context,this._descriptor),Object(a.a)(i),this._context.bindTexture(r,c.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,i,r,n,a,s=3553){a||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,l=this._descriptor,h=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);(t<0||i<0||r>l.width||n>l.height||t+r>l.width||i+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),o.pixelStorei(o.UNPACK_ALIGNMENT,l.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,l.flipped?1:0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.preMultiplyAlpha?1:0),a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?o.texSubImage2D(s,e,t,i,l.pixelFormat,l.dataType,a):o.texSubImage2D(s,e,t,i,r,n,l.pixelFormat,l.dataType,a),this._context.bindTexture(h,c.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,c._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(e.target),this._context.bindTexture(t,c.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,c._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(c._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(c._applyWrapMode(e,t),this._wrapModeDirty=!1)}_deriveInternalFormat(e,t){if("webgl"===this._context.webglVersion)return e;switch(t){case 5126:switch(e){case 6408:return 34836;case 6407:return 34837;default:throw new Error("Unable to derive format")}default:return e}}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const i=Object(r.l)(t.width)&&Object(r.l)(t.height);Object(o.a)(e.gl)||i||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,r=t.samplingMode;9985===i||9987===i?(i=9729,t.hasMipmap||(r=9729)):9984!==i&&9986!==i||(i=9728,t.hasMipmap||(r=9728)),e.texParameteri(t.target,e.TEXTURE_MAG_FILTER,i),e.texParameteri(t.target,e.TEXTURE_MIN_FILTER,r)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(t.target,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(t.target,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var i;const r=e.capabilities.textureFilterAnisotropic;r&&e.gl.texParameterf(t.target,r.TEXTURE_MAX_ANISOTROPY,null!=(i=t.maxAnisotropy)?i:1)}}c.TEXTURE_UNIT_FOR_UPDATES=0},195:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return c}));var r=i(88),n=i(79);const a=i(80).a.getLogger("esri/views/webgl");const s=!!Object(n.a)("enable-feature:webgl-debug");function o(){return s}function c(){return s}function l(e){if(o()){const t=e.getError();if(t){const i=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),n=(new Error).stack;a.error(new r.a("webgl-error","WebGL error occured",{message:i,stack:n}))}}}},202:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n}));const r=33984;var n;!function(e){e[e.Texture=0]="Texture",e[e.Buffer=1]="Buffer",e[e.VAO=2]="VAO",e[e.Program=3]="Program",e[e.Framebuffer=4]="Framebuffer",e[e.Renderbuffer=5]="Renderbuffer",e[e.COUNT=6]="COUNT"}(n||(n={}));const a=33306},220:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return p})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return b})),i.d(t,"i",(function(){return c})),i.d(t,"j",(function(){return l})),i.d(t,"k",(function(){return g}));var r=i(107),n=(i(135),i(146)),a=(i(215),i(101),i(226),i(221));Object(a.e)();class s{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function o(e,t){if(!e){t=t||"assert";const e=new Error(t);throw e.stack&&console.log(e.stack),new s(t)}}function c(e,t,i,r){let n,a=(i[0]-e[0])/t[0],s=(r[0]-e[0])/t[0];a>s&&(n=a,a=s,s=n);let o=(i[1]-e[1])/t[1],c=(r[1]-e[1])/t[1];if(o>c&&(n=o,o=c,c=n),a>c||o>s)return!1;o>a&&(a=o),c<s&&(s=c);let l=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return l>h&&(n=l,l=h,h=n),!(a>h||l>s)&&(h<s&&(s=h),!(s<0))}function l(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function h(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function u(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function d(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function p(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function f(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function b(e,t,i=0){const n=Object(r.f)(e,0,O);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*y(n*m[r]))}function g(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*v[r];return i}const m=[1,256,65536,16777216],v=[1/256,1/65536,1/16777216,1/4294967296],O=g(new Uint8ClampedArray([255,255,255,255]));function y(e){return e-Math.floor(e)}function _(e,t,i,r,a){const s=e;0===e[11]?(r[0]=2/(t*s[0]),r[1]=2/(i*s[5]),r[2]=(1+s[12])/s[0],r[3]=(1+s[13])/s[5],Object(n.s)(a,0,1)):(r[0]=-2/(t*s[0]),r[1]=-2/(i*s[5]),r[2]=(1-s[8])/s[0],r[3]=(1-s[9])/s[5],Object(n.s)(a,1,0))}},240:function(e,t,i){"use strict";function r(){return new Float32Array(2)}function n(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function a(){return r()}function s(){return n(1,1)}function o(){return n(1,0)}function c(){return n(0,1)}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const l=a(),h=s(),u=o(),d=c();Object.freeze({__proto__:null,create:r,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:n,createView:function(e,t){return new Float32Array(e,t,2)},zeros:a,ones:s,unitX:o,unitY:c,ZEROS:l,ONES:h,UNIT_X:u,UNIT_Y:d})},256:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i(85),n=i(111),a=i(101),s=i(113);function o(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const i=s.a`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=s.a`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.sliceHighlightDisabled?s.a`#define highlightSlice(_color_, _pos_) (_color_)`:s.a`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(n)}else{const i=s.a`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i)}}function c(e,t,i){l(e,t,i.slicePlane,i.origin)}function l(e,t,i,s){t.slicePlaneEnabled&&(Object(r.k)(i)?(s?(Object(n.j)(h,i.origin,s),e.setUniform3fv("slicePlaneOrigin",h)):e.setUniform3fv("slicePlaneOrigin",i.origin),e.setUniform3fv("slicePlaneBasis1",i.basis1),e.setUniform3fv("slicePlaneBasis2",i.basis2)):(e.setUniform3fv("slicePlaneBasis1",a.b),e.setUniform3fv("slicePlaneBasis2",a.b),e.setUniform3fv("slicePlaneOrigin",a.b)))}const h=Object(a.e)()},271:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const r=i(80).a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class n{constructor(){this.includedModules=new Map}include(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&r.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))}}class a extends n{constructor(){super(...arguments),this.vertex=new c,this.fragment=new c,this.attributes=new l,this.varyings=new h,this.extensions=new u,this.constants=new d}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),n="vertex"===e?this.vertex:this.fragment,a=n.uniforms.generateSource(),s=n.code.generateSource(),o="vertex"===e?f:p,c=this.constants.generateSource().concat(n.constants.generateSource());return`\n${t.join("\n")}\n\n${o}\n\n${c.join("\n")}\n\n${a.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${s.join("\n")}`}}class s{constructor(){this._entries=new Map}add(e,t,i){const r=`${e}_${t}_${i}`;return this._entries.set(r,{name:e,type:t,arraySize:i}),this}generateSource(){return Array.from(this._entries.values()).map((e=>`uniform ${e.type} ${e.name}${(e=>e?`[${e}]`:"")(e.arraySize)};`))}get entries(){return Array.from(this._entries.values())}}class o{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class c extends n{constructor(){super(...arguments),this.uniforms=new s,this.code=new o,this.constants=new d}get builder(){return this}}class l{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class h{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class u{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?u.ALLOWLIST_VERTEX:u.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}u.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],u.ALLOWLIST_VERTEX=[];class d{constructor(){this._entries=[]}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=d.numberToFloatStr(i);break;case"int":r=d.numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${d.numberToFloatStr(i[0])},                            ${d.numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${d.numberToFloatStr(i[0])},                            ${d.numberToFloatStr(i[1])},                            ${d.numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${d.numberToFloatStr(i[0])},                            ${d.numberToFloatStr(i[1])},                            ${d.numberToFloatStr(i[2])},                            ${d.numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${d.numberToIntStr(i[0])},                             ${d.numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${d.numberToIntStr(i[0])},                             ${d.numberToIntStr(i[1])},                             ${d.numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${d.numberToIntStr(i[0])},                             ${d.numberToIntStr(i[1])},                             ${d.numberToIntStr(i[2])},                             ${d.numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,(e=>d.numberToFloatStr(e))).join(", ")})`}return this._entries.push(`const ${t} ${e} = ${r};`),this}static numberToIntStr(e){return e.toFixed(0)}static numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const p="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",f="precision highp float;\nprecision highp sampler2D;"},278:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i(113);function n(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(r.a`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function a(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}},289:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return n})),i.d(t,"g",(function(){return m})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return l})),i.d(t,"j",(function(){return f})),i.d(t,"k",(function(){return u})),i.d(t,"l",(function(){return a})),i.d(t,"m",(function(){return o}));var r=i(171);function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e,t,i,r,n,a,s,o,c,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=c,e[8]=l,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function o(e,t){if(e===t){const i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function c(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8],u=h*s-o*l,d=-h*a+o*c,p=l*a-s*c;let f=i*u+r*d+n*p;return f?(f=1/f,e[0]=u*f,e[1]=(-h*r+n*l)*f,e[2]=(o*r-n*s)*f,e[3]=d*f,e[4]=(h*i-n*c)*f,e[5]=(-o*i+n*a)*f,e[6]=p*f,e[7]=(-l*i+r*c)*f,e[8]=(s*i-r*a)*f,e):null}function l(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],u=t[8],d=i[0],p=i[1],f=i[2],b=i[3],g=i[4],m=i[5],v=i[6],O=i[7],y=i[8];return e[0]=d*r+p*s+f*l,e[1]=d*n+p*o+f*h,e[2]=d*a+p*c+f*u,e[3]=b*r+g*s+m*l,e[4]=b*n+g*o+m*h,e[5]=b*a+g*c+m*u,e[6]=v*r+O*s+y*l,e[7]=v*n+O*o+y*h,e[8]=v*a+O*c+y*u,e}function h(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],u=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=c,e[6]=d*r+p*s+l,e[7]=d*n+p*o+h,e[8]=d*a+p*c+u,e}function u(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=t[6],h=t[7],u=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*s,e[1]=p*n+d*o,e[2]=p*a+d*c,e[3]=p*s-d*r,e[4]=p*o-d*n,e[5]=p*c-d*a,e[6]=l,e[7]=h,e[8]=u,e}function d(e,t,i){const r=i[0],n=i[1],a=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=a*t[6],e[7]=a*t[7],e[8]=a*t[8],e}function p(e,t,i){const r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e}function f(e,t){const i=t[0],r=t[1],n=t[2],a=t[4],s=t[5],o=t[6],c=t[8],l=t[9],h=t[10],u=h*s-o*l,d=-h*a+o*c,p=l*a-s*c,f=i*u+r*d+n*p;if(!f)return null;const b=1/f;return e[0]=u*b,e[1]=(-h*r+n*l)*b,e[2]=(o*r-n*s)*b,e[3]=d*b,e[4]=(h*i-n*c)*b,e[5]=(-o*i+n*a)*b,e[6]=p*b,e[7]=(-l*i+r*c)*b,e[8]=(s*i-r*a)*b,e}function b(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],b=t[13],g=t[14],m=t[15],v=i*o-r*s,O=i*c-n*s,y=i*l-a*s,_=r*c-n*o,j=r*l-a*o,x=n*l-a*c,w=h*b-u*f,M=h*g-d*f,S=h*m-p*f,E=u*g-d*b,T=u*m-p*b,P=d*m-p*g;let A=v*P-O*T+y*E+_*S-j*M+x*w;return A?(A=1/A,e[0]=(o*P-c*T+l*E)*A,e[1]=(c*S-s*P-l*M)*A,e[2]=(s*T-o*S+l*w)*A,e[3]=(n*T-r*P-a*E)*A,e[4]=(i*P-n*S+a*M)*A,e[5]=(r*S-i*T-a*w)*A,e[6]=(b*x-g*j+m*_)*A,e[7]=(g*y-f*x-m*O)*A,e[8]=(f*j-b*y+m*v)*A,e):null}function g(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function m(e){const t=r.a,i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=e[6],h=e[7],u=e[8];return Math.abs(1-(i*i+s*s+l*l))<=t&&Math.abs(1-(n*n+o*o+h*h))<=t&&Math.abs(1-(a*a+c*c+u*u))<=t}const v=l,O=g;Object.freeze({__proto__:null,fromMat4:n,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:a,identity:s,transpose:o,invert:c,adjoint:function(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],c=t[6],l=t[7],h=t[8];return e[0]=s*h-o*l,e[1]=n*l-r*h,e[2]=r*o-n*s,e[3]=o*c-a*h,e[4]=i*h-n*c,e[5]=n*a-i*o,e[6]=a*l-s*c,e[7]=r*c-i*l,e[8]=i*s-r*a,e},determinant:function(e){const t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],c=e[7],l=e[8];return t*(l*a-s*c)+i*(-l*n+s*o)+r*(c*n-a*o)},multiply:l,translate:h,rotate:u,scale:d,scaleByVec2:p,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,c=n+n,l=i*s,h=r*s,u=r*o,d=n*s,p=n*o,f=n*c,b=a*s,g=a*o,m=a*c;return e[0]=1-u-f,e[3]=h-m,e[6]=d+g,e[1]=h+m,e[4]=1-l-f,e[7]=p-b,e[2]=d-g,e[5]=p+b,e[8]=1-l-u,e},normalFromMat4Legacy:f,normalFromMat4:b,projection:function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},subtract:g,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){const i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=e[6],h=e[7],u=e[8],d=t[0],p=t[1],f=t[2],b=t[3],g=t[4],m=t[5],v=t[6],O=t[7],y=t[8];return Math.abs(i-d)<=r.a*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-p)<=r.a*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-f)<=r.a*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-b)<=r.a*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(o-g)<=r.a*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(c-m)<=r.a*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(l-v)<=r.a*Math.max(1,Math.abs(l),Math.abs(v))&&Math.abs(h-O)<=r.a*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(u-y)<=r.a*Math.max(1,Math.abs(u),Math.abs(y))},isOrthoNormal:m,mul:v,sub:O})},310:function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return j})),i.d(t,"f",(function(){return x})),i.d(t,"g",(function(){return w}));var r=i(85),n=i(95);const a=(e,t,i)=>[t,i],s=(e,t,i)=>[t,i,e[2]],o=(e,t,i)=>[t,i,e[2],e[3]];function c(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function h({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function u(e,t,i){const r=[];let n,a,s,o;for(let c=0;c<i.length;c++){const u=i[c];c>0?(s=l(e,u[0]),o=h(e,u[1]),s===n&&o===a||(r.push(t(u,s-n,o-a)),n=s,a=o)):(n=l(e,u[0]),a=h(e,u[1]),r.push(t(u,n,a)))}return r.length>0?r:null}function d({scale:e,translate:t},i){return i*e[0]+t[0]}function p({scale:e,translate:t},i){return t[1]-i*e[1]}function f(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[n,a]=e.scale;let s=d(e,i[0][0]),o=p(e,i[0][1]);r[0]=t(i[0],s,o);for(let c=1;c<i.length;c++){const e=i[c];s+=e[0]*n,o-=e[1]*a,r[c]=t(e,s,o)}return r}function b(e,t,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=f(e,t,i[n]);return r}function g(e,t,i,r,n){return t.points=function(e,t,i,r){return u(e,i?r?o:s:r?s:a,t)}(e,i.points,r,n),t}function m(e,t,i,r,n){return t.x=l(e,i.x),t.y=h(e,i.y),t!==i&&(r&&(t.z=i.z),n&&(t.m=i.m)),t}function v(e,t,i,r,n){const c=function(e,t,i,r){const n=[],c=i?r?o:s:r?s:a;for(let a=0;a<t.length;a++){const i=u(e,c,t[a]);i&&i.length>=3&&n.push(i)}return n.length?n:null}(e,i.rings,r,n);return c?(t.rings=c,t):null}function O(e,t,i,r,n){const c=function(e,t,i,r){const n=[],c=i?r?o:s:r?s:a;for(let a=0;a<t.length;a++){const i=u(e,c,t[a]);i&&i.length>=2&&n.push(i)}return n.length?n:null}(e,i.paths,r,n);return c?(t.paths=c,t):null}function y(e,t){return e&&t?Object(n.f)(t)?m(e,{},t,!1,!1):Object(n.h)(t)?O(e,{},t,!1,!1):Object(n.g)(t)?v(e,{},t,!1,!1):Object(n.e)(t)?g(e,{},t,!1,!1):Object(n.d)(t)?function(e,t,i,r,n){return t.xmin=l(e,i.xmin),t.ymin=h(e,i.ymin),t.xmax=l(e,i.xmax),t.ymax=h(e,i.ymax),t!==i&&(r&&(t.zmin=i.zmin,t.zmax=i.zmax),n&&(t.mmin=i.mmin,t.mmax=i.mmax)),t}(e,{},t,!1,!1):null:null}function _(e,t,i,n,c){return Object(r.k)(i)&&(t.points=function(e,t,i,r){return f(e,i?r?o:s:r?s:a,t)}(e,i.points,n,c)),t}function j(e,t,i,n,a){return Object(r.j)(i)||(t.x=d(e,i.x),t.y=p(e,i.y),t!==i&&(n&&(t.z=i.z),a&&(t.m=i.m))),t}function x(e,t,i,n,c){return Object(r.k)(i)&&(t.rings=function(e,t,i,r){return b(e,i?r?o:s:r?s:a,t)}(e,i.rings,n,c)),t}function w(e,t,i,n,c){return Object(r.k)(i)&&(t.paths=function(e,t,i,r){return b(e,i?r?o:s:r?s:a,t)}(e,i.paths,n,c)),t}},311:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(431),n=i(113);function a(e){e.include(r.a),e.code.add(n.a`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},318:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return n})),i.d(t,"e",(function(){return s})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return l}));var r=i(171);function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function a(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5];let c=i*a-r*n;return c?(c=1/c,e[0]=a*c,e[1]=-r*c,e[2]=-n*c,e[3]=i*c,e[4]=(n*o-a*s)*c,e[5]=(r*s-i*o)*c,e):null}function s(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=i[0],h=i[1],u=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*l+a*h,e[1]=n*l+s*h,e[2]=r*u+a*d,e[3]=n*u+s*d,e[4]=r*p+a*f+o,e[5]=n*p+s*f+c,e}function o(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=Math.sin(i),h=Math.cos(i);return e[0]=r*h+a*l,e[1]=n*h+s*l,e[2]=r*-l+a*h,e[3]=n*-l+s*h,e[4]=o,e[5]=c,e}function c(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=i[0],h=i[1];return e[0]=r*l,e[1]=n*l,e[2]=a*h,e[3]=s*h,e[4]=o,e[5]=c,e}function l(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=i[0],h=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=r*l+a*h+o,e[5]=n*l+s*h+c,e}function h(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function u(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}const p=s,f=d;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:n,set:function(e,t,i,r,n,a,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=s,e},invert:a,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:s,rotate:o,scale:c,translate:l,fromRotation:h,fromScaling:u,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},subtract:d,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=t[0],h=t[1],u=t[2],d=t[3],p=t[4],f=t[5];return Math.abs(i-l)<=r.a*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-h)<=r.a*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=r.a*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(s-d)<=r.a*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=r.a*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-f)<=r.a*Math.max(1,Math.abs(c),Math.abs(f))},mul:p,sub:f})},319:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));var r=i(221),n=i(113);const a=Object(r.g)(1,1,0,1),s=Object(r.g)(1,0,1,1);function o(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",a).add("unoccludedHighlightFlag","vec4",s),e.fragment.code.add(n.a`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function c(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}},325:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},326:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(85),n=i(180),a=i(195),s=i(577);class o extends s.a{constructor(e,t,i){super(e,t.generateSource("vertex"),t.generateSource("fragment"),i),this._textures=new Map,this._freeTextureUnits=new n.a({deallocator:null}),this._fragmentUniforms=Object(a.b)()?t.fragmentUniforms.entries:null}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(Object(r.j)(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let i=this._textures.get(t);return null==i?(i=this._allocTextureUnit(e),this._textures.set(t,i)):i.texture=e,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(e,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),Object(r.k)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}},327:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));const r=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]])},331:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a}));var r=i(113);const n=.1,a=.001;function s(e,t){const i=e.fragment;switch(t.alphaDiscardMode){case 0:i.code.add(r.a`
        #define discardOrAdjustAlpha(color) { if (color.a < ${r.a.float(a)}) { discard; } }
      `);break;case 1:i.code.add(r.a`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:i.uniforms.add("textureAlphaCutoff","float"),i.code.add(r.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(r.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},334:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(85);class n{constructor(e,t,i=(()=>this.dispose())){this.release=i,t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}dispose(){this._program=Object(r.f)(this._program),this._pipeline=this._config=null}reload(e){Object(r.f)(this._program),this._program=this.initializeProgram(e)}get program(){return this._program}get pipeline(){return this._pipeline}get key(){return this._config.key}get configuration(){return this._config}bindPass(e,t){}bindMaterial(e,t){}bindDraw(e,t,i){}bindPipelineState(e){e.setPipelineState(this.pipeline)}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return 4}}},341:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i(107);class n{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits.map((()=>0))}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function a(e={}){return(t,i)=>{var n,a;t._parameterNames=null!=(n=t._parameterNames)?n:[],t._parameterNames.push(i);const s=t._parameterNames.length-1,o=e.count||2,c=Math.ceil(Object(r.n)(o)),l=null!=(a=t._parameterBits)?a:[0];let h=0;for(;l[h]+c>16;)h++,h>=l.length&&l.push(0);t._parameterBits=l;const u=l[h],d=(1<<c)-1<<u;l[h]+=c,Object.defineProperty(t,i,{get(){return this[s]},set(e){if(this[s]!==e&&(this[s]=e,this._keyDirty=!0,this._parameterBits[h]=this._parameterBits[h]&~d|+e<<u&d,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}},342:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return y})),i.d(t,"c",(function(){return G})),i.d(t,"d",(function(){return H})),i.d(t,"e",(function(){return L})),i.d(t,"f",(function(){return g})),i.d(t,"g",(function(){return m})),i.d(t,"h",(function(){return v})),i.d(t,"i",(function(){return O})),i.d(t,"j",(function(){return T})),i.d(t,"k",(function(){return D})),i.d(t,"l",(function(){return w})),i.d(t,"m",(function(){return p})),i.d(t,"n",(function(){return _})),i.d(t,"o",(function(){return U})),i.d(t,"p",(function(){return q})),i.d(t,"q",(function(){return V})),i.d(t,"r",(function(){return P})),i.d(t,"s",(function(){return R})),i.d(t,"t",(function(){return M})),i.d(t,"u",(function(){return f})),i.d(t,"v",(function(){return j})),i.d(t,"w",(function(){return B})),i.d(t,"x",(function(){return W})),i.d(t,"y",(function(){return F})),i.d(t,"z",(function(){return A})),i.d(t,"A",(function(){return I})),i.d(t,"B",(function(){return S})),i.d(t,"C",(function(){return b})),i.d(t,"D",(function(){return x})),i.d(t,"E",(function(){return N})),i.d(t,"F",(function(){return Z})),i.d(t,"G",(function(){return k})),i.d(t,"H",(function(){return C})),i.d(t,"I",(function(){return z})),i.d(t,"J",(function(){return E}));class r{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=9;const a=this.TypedArrayConstructor;void 0===r&&(r=9*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;for(let o=0;o<9;++o)r[a++]=n[s++]}get buffer(){return this.typedBuffer.buffer}}r.ElementCount=9;class n{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=16;const a=this.TypedArrayConstructor;void 0===r&&(r=16*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;for(let o=0;o<16;++o)r[a++]=n[s++]}get buffer(){return this.typedBuffer.buffer}}n.ElementCount=16;class a{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=1;const a=this.TypedArrayConstructor;void 0===r&&(r=a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}a.ElementCount=1;var s=i(146);class o{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=2;const a=this.TypedArrayConstructor;void 0===r&&(r=2*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(s.s)(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=i}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}o.ElementCount=2;var c=i(111);class l{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=3;const a=this.TypedArrayConstructor;void 0===r&&(r=3*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(c.w)(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}l.ElementCount=3;var h=i(226);class u{constructor(e,t,i=0,r,n){this.TypedArrayConstructor=e,this.elementCount=4;const a=this.TypedArrayConstructor;void 0===r&&(r=4*a.BYTES_PER_ELEMENT);const s=0===t.byteLength?0:i;this.typedBuffer=null==n?new a(t,s):new a(t,s,(n-i)/a.BYTES_PER_ELEMENT),this.typedBufferStride=r/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Object(h.l)(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,t,i){const r=this.typedBuffer,n=t.typedBuffer;let a=e*this.typedBufferStride,s=i*t.typedBufferStride;r[a++]=n[s++],r[a++]=n[s++],r[a++]=n[s++],r[a]=n[s]}get buffer(){return this.typedBuffer.buffer}}u.ElementCount=4;class d extends a{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}static fromTypedArray(e,t){return new d(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}d.ElementType="f32";class p extends o{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static fromTypedArray(e,t){return new p(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}p.ElementType="f32";class f extends l{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}f.ElementType="f32";class b extends u{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(b,e,t)}static fromTypedArray(e,t){return new b(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}b.ElementType="f32";class g extends r{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static fromTypedArray(e,t){return new g(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}g.ElementType="f32";class m extends r{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(m,e,t)}static fromTypedArray(e,t){return new m(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}m.ElementType="f64";class v extends n{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(v,e,t)}static fromTypedArray(e,t){return new v(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}v.ElementType="f32";class O extends n{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(O,e,t)}static fromTypedArray(e,t){return new O(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}O.ElementType="f64";class y extends a{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(y,e,t)}static fromTypedArray(e,t){return new y(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}y.ElementType="f64";class _ extends o{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(_,e,t)}static fromTypedArray(e,t){return new _(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_.ElementType="f64";class j extends l{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(j,e,t)}static fromTypedArray(e,t){return new j(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}j.ElementType="f64";class x extends u{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static fromTypedArray(e,t){return new x(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}x.ElementType="f64";class w extends a{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}w.ElementType="u8";class M extends o{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(M,e,t)}static fromTypedArray(e,t){return new M(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}M.ElementType="u8";class S extends l{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(S,e,t)}static fromTypedArray(e,t){return new S(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}S.ElementType="u8";class E extends u{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(E,e,t)}static fromTypedArray(e,t){return new E(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}E.ElementType="u8";class T extends a{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(T,e,t)}static fromTypedArray(e,t){return new T(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}T.ElementType="u16";class P extends o{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(P,e,t)}static fromTypedArray(e,t){return new P(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}P.ElementType="u16";class A extends l{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(A,e,t)}static fromTypedArray(e,t){return new A(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}A.ElementType="u16";class C extends u{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(C,e,t)}static fromTypedArray(e,t){return new C(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}C.ElementType="u16";class D extends a{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static fromTypedArray(e,t){return new D(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}D.ElementType="u32";class R extends o{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(R,e,t)}static fromTypedArray(e,t){return new R(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}R.ElementType="u32";class I extends l{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}I.ElementType="u32";class z extends u{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(z,e,t)}static fromTypedArray(e,t){return new z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}z.ElementType="u32";class L extends a{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(L,e,t)}static fromTypedArray(e,t){return new L(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}L.ElementType="i8";class V extends o{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(V,e,t)}static fromTypedArray(e,t){return new V(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}V.ElementType="i8";class F extends l{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(F,e,t)}static fromTypedArray(e,t){return new F(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}F.ElementType="i8";class k extends u{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(k,e,t)}static fromTypedArray(e,t){return new k(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}k.ElementType="i8";class G extends a{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static fromTypedArray(e,t){return new G(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}G.ElementType="i16";class U extends o{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(U,e,t)}static fromTypedArray(e,t){return new U(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}U.ElementType="i16";class B extends l{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(B,e,t)}static fromTypedArray(e,t){return new B(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}B.ElementType="i16";class N extends u{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(N,e,t)}static fromTypedArray(e,t){return new N(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}N.ElementType="i16";class H extends a{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(H,e,t)}static fromTypedArray(e,t){return new H(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}H.ElementType="i32";class q extends o{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(q,e,t)}static fromTypedArray(e,t){return new q(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}q.ElementType="i32";class W extends l{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static fromTypedArray(e,t){return new W(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}W.ElementType="i32";class Z extends u{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Z,e,t)}static fromTypedArray(e,t){return new Z(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Z.ElementType="i32"},348:function(e,t,i){"use strict";i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return x})),i.d(t,"d",(function(){return y})),i.d(t,"e",(function(){return M})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return g})),i.d(t,"h",(function(){return w})),i.d(t,"i",(function(){return _}));var r=i(107),n=i(85),a=i(111),s=i(101),o=i(267),c=i(654),l=i(220),h=i(385);const u=Object(o.f)();function d(e,t,i,r,n,a,s){if(!Object(h.e)(t))if(e.boundingInfo){Object(l.a)(0===e.primitiveType);const t=i.tolerance;f(e.boundingInfo,r,n,t,a,s)}else{const t=e.indices.get("position"),i=e.vertexAttributes.get("position");g(r,n,0,t.length/3,t,i,void 0,a,s)}}const p=Object(s.e)();function f(e,t,i,r,s,c){if(Object(n.j)(e))return;const l=function(e,t,i){return Object(a.w)(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}(t,i,p);if(Object(o.y)(u,e.getBBMin()),Object(o.x)(u,e.getBBMax()),Object(n.k)(s)&&s.applyToAabb(u),y(u,t,l,r)){const{primitiveIndices:n,indices:a,position:o}=e,l=n?n.length:a.length/3;if(l>T){const n=e.getChildren();if(void 0!==n){for(let e=0;e<8;++e)void 0!==n[e]&&f(n[e],t,i,r,s,c);return}}g(t,i,0,l,a,o,n,s,c)}}const b=Object(s.e)();function g(e,t,i,r,a,s,o,c,l){if(o)return function(e,t,i,r,a,s,o,c,l){const h=s.data,u=s.stride||s.size,d=e[0],p=e[1],f=e[2],g=t[0]-d,m=t[1]-p,v=t[2]-f;for(let y=i;y<r;++y){const e=o[y];let t=3*e,i=u*a[t++],r=h[i++],s=h[i++],_=h[i];i=u*a[t++];let j=h[i++],x=h[i++],w=h[i];i=u*a[t];let M=h[i++],S=h[i++],E=h[i];Object(n.k)(c)&&([r,s,_]=c.applyToVertex(r,s,_,y),[j,x,w]=c.applyToVertex(j,x,w,y),[M,S,E]=c.applyToVertex(M,S,E,y));const T=j-r,P=x-s,A=w-_,C=M-r,D=S-s,R=E-_,I=m*R-D*v,z=v*C-R*g,L=g*D-C*m,V=T*I+P*z+A*L;if(Math.abs(V)<=Number.EPSILON)continue;const F=d-r,k=p-s,G=f-_,U=F*I+k*z+G*L;if(V>0){if(U<0||U>V)continue}else if(U>0||U<V)continue;const B=k*A-P*G,N=G*T-A*F,H=F*P-T*k,q=g*B+m*N+v*H;if(V>0){if(q<0||U+q>V)continue}else if(q>0||U+q<V)continue;const W=(C*B+D*N+R*H)/V;W>=0&&l(W,O(T,P,A,C,D,R,b),e)}}(e,t,i,r,a,s,o,c,l);const h=s.data,u=s.stride||s.size,d=e[0],p=e[1],f=e[2],g=t[0]-d,m=t[1]-p,v=t[2]-f;for(let y=i,_=3*i;y<r;++y){let e=u*a[_++],t=h[e++],i=h[e++],r=h[e];e=u*a[_++];let s=h[e++],o=h[e++],j=h[e];e=u*a[_++];let x=h[e++],w=h[e++],M=h[e];Object(n.k)(c)&&([t,i,r]=c.applyToVertex(t,i,r,y),[s,o,j]=c.applyToVertex(s,o,j,y),[x,w,M]=c.applyToVertex(x,w,M,y));const S=s-t,E=o-i,T=j-r,P=x-t,A=w-i,C=M-r,D=m*C-A*v,R=v*P-C*g,I=g*A-P*m,z=S*D+E*R+T*I;if(Math.abs(z)<=Number.EPSILON)continue;const L=d-t,V=p-i,F=f-r,k=L*D+V*R+F*I;if(z>0){if(k<0||k>z)continue}else if(k>0||k<z)continue;const G=V*T-E*F,U=F*S-T*L,B=L*E-S*V,N=g*G+m*U+v*B;if(z>0){if(N<0||k+N>z)continue}else if(N>0||k+N<z)continue;const H=(P*G+A*U+C*B)/z;H>=0&&l(H,O(S,E,T,P,A,C,b),y)}}const m=Object(s.e)(),v=Object(s.e)();function O(e,t,i,r,n,s,o){return Object(a.w)(m,e,t,i),Object(a.w)(v,r,n,s),Object(a.g)(o,m,v),Object(a.r)(o,o),o}function y(e,t,i,r){return function(e,t,i,r,n){const a=(e[0]-r-t[0])*i[0],s=(e[3]+r-t[0])*i[0];let o=Math.min(a,s),c=Math.max(a,s);const l=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(c=Math.min(c,Math.max(l,h)),c<0)return!1;if(o=Math.max(o,Math.min(l,h)),o>c)return!1;const u=(e[2]-r-t[2])*i[2],d=(e[5]+r-t[2])*i[2];return c=Math.min(c,Math.max(u,d)),!(c<0)&&(o=Math.max(o,Math.min(u,d)),!(o>c)&&o<n)}(e,t,i,r,1/0)}function _(e,t,i,n,a){let s=(i.screenLength||0)*e.pixelRatio;a&&(s=Object(c.d)(s,n,t,a));const o=s*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Object(r.f)(o*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function j(e,t,i){if(!e)return;const r=e.parameters,n=e.paddingPixelsOverride;t.setUniform4f(i,r.divisor,r.offset,r.minPixelSize,n)}function x(e,t){const i=t?x(t):{};for(const r in e){let t=e[r];t&&t.forEach&&(t=S(t)),null==t&&r in i||(i[r]=t)}return i}function w(e,t){let i=!1;for(const r in t){const n=t[r];void 0!==n&&(i=!0,Array.isArray(n)?e[r]=n.slice():e[r]=n)}return i}function M(e,t,i,n,a){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size"),c=o&&o.data[0],l=i[0],h=i[1],u=((c+n)/2+4)*e.screenToWorldRatio;let d=Number.MAX_VALUE;for(let p=0;p<s.length-5;p+=3){const e=s[p],t=s[p+1],i=l-e,n=h-t,a=s[p+3]-e,o=s[p+4]-t,c=Object(r.f)((a*i+o*n)/(a*a+o*o),0,1),u=a*c-i,f=o*c-n,b=u*u+f*f;b<d&&(d=b)}d<u*u&&a()}function S(e){const t=[];return e.forEach((e=>t.push(e))),t}const E={multiply:1,ignore:2,replace:3,tint:4},T=1e3},362:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return n})),i.d(t,"g",(function(){return u}));var r=i(174);const n=Object(r.g)(770,1,771,771),a=Object(r.h)(1,1),s=Object(r.h)(0,771);function o(e){return 2===e?null:1===e?s:a}function c(e){return 2===e?r.d:null}const l=5e5,h={factor:-1,units:-2};function u(e){return e?h:null}function d(e){return 3===e||2===e?513:515}},367:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e){e.code.add(r.a`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},373:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return h}));i(543),i(79);var r=i(85),n=(i(321),i(234),i(93),i(267)),a=i(123);i(310),i(172),i(155),i(399);class s{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function o(e){return Object(r.k)(e.geometry)}class c{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function h(e){if(Object(r.j)(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function u(e,t){switch(Object(n.h)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(n.l)(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(n.l)(t,e.rings[i],e.hasZ);break;case"multipoint":Object(n.l)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function d(e,t){switch(Object(a.m)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Object(a.p)(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Object(a.p)(t,e.rings[i]);break;case"multipoint":Object(a.p)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(n.f)(),Object(a.l)()},375:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i(85),n=i(465),a=i(327),s=i(348);class o extends n.a{constructor(e,t){super(),this.type=3,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=a.a,this._params=Object(s.c)(e,t),this.validateParameterValues(this._params)}dispose(){}get params(){return this._params}update(e){return!1}setParameterValues(e){Object(s.h)(this._params,e)&&(this.validateParameterValues(this._params),this.parametersChanged())}validateParameterValues(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}isVisibleInPass(e){return!0}get renderOccluded(){return this.params.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(r.k)(this.materialRepository)&&this.materialRepository.materialChanged(this)}}function c(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}const l={renderOccluded:1}},376:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e,t){t.linearDepth?e.vertex.code.add(r.a`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(r.a`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},385:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return f})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return l}));var r=i(85),n=i(135),a=i(168),s=i(623),o=i(220);function c(e,t){return Object(r.j)(e)&&(e=[]),e.push(t),e}function l(e,t){if(Object(r.j)(e))return e;const i=e.filter((e=>e!==t));return 0===i.length?null:i}function h(e){return!!Object(r.k)(e)&&!e.visible}function u(e,t){const i=new Map;return i.set(0,t.acquire(e,0)),i.set(1,t.acquire(e,7)),i.set(4,t.acquire(e,3)),i.set(3,t.acquire(e,2)),i.set(2,t.acquire(e,1)),i.set(5,t.acquire(e,4)),i.set(7,t.acquire(e,3)),i.set(6,t.acquire(e,3)),i}function d(e,t){t.release(e,0),t.release(e,7),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)}function p(e,t,i){const a=e.origin.vec3;Object(o.j)(m,-a[0],-a[1],-a[2]),Object(r.k)(e.transformation)?Object(n.n)(t,m,e.transformation):Object(n.f)(t,m),i&&(Object(n.c)(i,t),Object(n.b)(i,i))}function f(e,t,i,r,n){b[0]=e.get(t,0),b[1]=e.get(t,1),b[2]=e.get(t,2),Object(s.a)(b,g,3),i.set(n,0,g[0]),r.set(n,0,g[1]),i.set(n,1,g[2]),r.set(n,1,g[3]),i.set(n,2,g[4]),r.set(n,2,g[5])}const b=new Float64Array(3),g=new Float32Array(6),m=Object(a.d)()},394:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return c})),i.d(t,"f",(function(){return h}));var r=i(135),n=i(772);function a(e,t,i){e.setUniform3f("camPos",i[3]-t[0],i[7]-t[1],i[11]-t[2])}function s(e,t){e.setUniformMatrix4fv("proj",t)}function o(e,t){e.setUniform2fv("nearFar",t)}function c(e,t,i){Object(r.t)(u,i,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",u)}function l(e,t){c(e,t.origin,t.camera.viewMatrix)}function h(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}const u=Object(n.a)()},398:function(e,t,i){"use strict";function r(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}i.d(t,"a",(function(){return r}))},399:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));i(79),i(85);function r(e,t){return!!n(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function n(e,t){return e===t||e&&t&&e.equals(t)}},400:function(e,t,i){"use strict";i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return d})),i.d(t,"h",(function(){return b})),i.d(t,"i",(function(){return m})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return g})),i.d(t,"l",(function(){return f}));i(188);var r=i(87),n=i(107),a=i(85),s=i(102),o=i(101),c=i(178),l=i(592);function h(e,t){return e.events.on("drag",function(e,t){let i=null,r=null;return n=>{if("cancel"===n.action)return void(Object(a.k)(r)&&(r.execute({action:"cancel"}),i=null,r=null));const s={action:n.action,screenStart:n.start,screenEnd:n.screenPoint};"start"===n.action&&Object(a.j)(i)&&(i=new j,r=new j,t(e,i,r,n.pointerType,s)),Object(a.k)(i)&&i.execute(s),"end"===n.action&&Object(a.k)(i)&&(i=null,r=null)}}(e,t))}function u(e,t){const i=[e.x,e.y,e.z],r=t,n=[Math.cos(r),Math.sin(r)],a=Math.sqrt(n[0]*n[0]+n[1]*n[1]);if(0===a)return null;n[0]/=a,n[1]/=a;const s=e=>{const t=(e.x-i[0])*n[0]+(e.y-i[1])*n[1];e.x=i[0]+t*n[0],e.y=i[1]+t*n[1]};return e=>(s(e.mapStart),s(e.mapEnd),e)}function d(e,t){let i=null;return r=>{if("start"===r.action&&(i=function(e,t,i){const r=e.geometry;if(Object(a.j)(r))return null;if("mesh"===r.type)return function(e,t,i,r){if(Object(a.k)(t.transform))return function(e,t,i,r){const n=p(i.getOriginPoint(t.spatialReference),r),s=t.spatialReference;return Object(a.j)(n)?null:{move:(t,r,h)=>{const u=Object(l.d)(n.clone(),t,r,h);if(u.spatialReference.equals(s))i.origin=Object(o.g)(u.x,u.y,u.z);else{const e=Object(c.k)(u,s);Object(a.k)(e)&&(i.origin=Object(o.g)(e.x,e.y,e.z))}e.notifyGeometryChanged()}}}(e,t,t.transform,i);if(!t.spatialReference.equals(i))return null;let n=0,s=0,h=0;return{move:(i,a,o)=>{const c=i-n,l=a-s,u=o-h;if(c||l||u){const d=t.origin.clone().offset(c,l,u);t.centerAt(d,{geographic:1===r}),e.notifyGeometryChanged(),n=i,s=a,h=o}}}}(e,r,t,i);const n=p(r,t),s=r.spatialReference;return Object(a.j)(n)?null:{move:(t,i,r)=>{const a=Object(l.d)(n.clone(),t,i,r);a.spatialReference.equals(s)?e.geometry=a:e.geometry=Object(c.k)(a,s)}}}(e,r.mapStart.spatialReference,t)),Object(a.j)(i))return null;const n=r.mapEnd.x-r.mapStart.x,s=r.mapEnd.y-r.mapStart.y,h=r.mapEnd.z-r.mapStart.z;return i.move(n,s,h),{...r,translationX:n,translationY:s,translationZ:h}}}function p(e,t){return Object(a.j)(e)?null:e.spatialReference.equals(t)?e.clone():Object(c.k)(e,t)}function f(e,t=null,i){let r=null;const n=Object(a.k)(t)&&!e.spatialReference.equals(t)?e=>Object(a.k)(e)?Object(c.k)(e,t):e:e=>e,s={exclude:[],...i};return t=>{if("start"===t.action&&(r=n(e.toMap(t.screenStart,s))),Object(a.j)(r))return null;const i=n(e.toMap(t.screenEnd,s));return Object(a.k)(i)?{...t,mapStart:r,mapEnd:i}:null}}function b(e,t){const i=e.map((e=>Object(a.s)(d(e,t)))).filter((e=>Object(a.k)(e)));return e=>{const t=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,n=e.mapEnd.z-e.mapStart.z;return i.forEach((t=>t(e))),{...e,translationX:t,translationY:r,translationZ:n}}}function g(e,t){const i=new Map;for(const n of t)i.set(n,Object(r.a)(e[n]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)}function m(e){return Object(a.k)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){const i=Object(a.k)(t.transform)?t.transform.clone():null,r=t.vertexAttributes.clonePositional();return n=>(t.transform=i,t.vertexAttributes=r,e.notifyGeometryChanged(),n)}(e,e.geometry):g(e,["geometry"])}function v(e){const t=e.map((e=>Object(a.s)(m(e)))).filter((e=>Object(a.k)(e)));return e=>(t.forEach((t=>t(e))),e)}function O(){let e=0,t=0,i=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,i=r.mapStart.z);const n=r.mapEnd.x-e,a=r.mapEnd.y-t,s=r.mapEnd.z-i;return e=r.mapEnd.x,t=r.mapEnd.y,i=r.mapEnd.z,{...r,mapDeltaX:n,mapDeltaY:a,mapDeltaZ:s,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function y(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const r=i.screenEnd.x-e,n=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:r,screenDeltaY:n}}}function _(e,t){let i=null,r=0,a=0;return o=>{if("start"===o.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(r=o.screenStart.x-i.x,a=o.screenStart.y-i.y)),null==i)return null;const c=Object(n.f)(o.screenEnd.x-r,0,e.width),l=Object(n.f)(o.screenEnd.y-a,0,e.height),h=Object(s.f)(c,l);return o.screenStart=i,o.screenEnd=h,o}}class j{constructor(){this.execute=()=>{}}next(e,t=new j){return Object(a.k)(e)&&(this.execute=i=>{const r=e(i);Object(a.k)(r)&&t.execute(r)}),t}}},401:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return p})),i.d(t,"i",(function(){return f}));var r=i(107),n=i(393),a=i(111),s=i(101),o=i(261);function c(e){return e?{origin:Object(s.c)(e.origin),vector:Object(s.c)(e.vector)}:{origin:Object(s.e)(),vector:Object(s.e)()}}function l(e,t=c()){return h(e.origin,e.vector,t)}function h(e,t,i=c()){return Object(a.k)(i.origin,e),Object(a.k)(i.vector,t),i}function u(e,t,i=c()){return Object(a.k)(i.origin,e),Object(a.j)(i.vector,t,e),i}function d(e,t){const i=Object(a.j)(o.d.get(),t,e.origin),n=Object(a.h)(e.vector,i),s=Object(a.h)(e.vector,e.vector),c=Object(r.f)(n/s,0,1),l=Object(a.j)(o.d.get(),Object(a.e)(o.d.get(),e.vector,c),i);return Object(a.h)(l,l)}function p(e,t,i){return Object(a.f)(i,e.origin,Object(a.e)(i,e.vector,t))}function f(e,t,i,n,s){const{vector:c,origin:l}=e,h=Object(a.j)(o.d.get(),t,l),u=Object(a.h)(c,h)/Object(a.t)(c);return Object(a.e)(s,c,Object(r.f)(u,i,n)),Object(a.f)(s,s,e.origin)}function b(e,t){if(m(e,function(e,t){const i=O.get();return i.origin=e,i.vector=t,i}(t.origin,t.direction),!1,v)){const{tA:t,pB:i,distance2:r}=v;if(t>=0&&t<=1)return r;if(t<0)return Object(a.l)(e.origin,i);if(t>1)return Object(a.l)(Object(a.f)(o.d.get(),e.origin,e.vector),i)}return null}function g(e,t,i){return!!m(e,t,!0,v)&&(Object(a.k)(i,v.pA),!0)}function m(e,t,i,n){const s=1e-6,c=e.origin,l=Object(a.f)(o.d.get(),c,e.vector),h=t.origin,u=Object(a.f)(o.d.get(),h,t.vector),d=o.d.get(),p=o.d.get();if(d[0]=c[0]-h[0],d[1]=c[1]-h[1],d[2]=c[2]-h[2],p[0]=u[0]-h[0],p[1]=u[1]-h[1],p[2]=u[2]-h[2],Math.abs(p[0])<s&&Math.abs(p[1])<s&&Math.abs(p[2])<s)return!1;const f=o.d.get();if(f[0]=l[0]-c[0],f[1]=l[1]-c[1],f[2]=l[2]-c[2],Math.abs(f[0])<s&&Math.abs(f[1])<s&&Math.abs(f[2])<s)return!1;const b=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],m=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],v=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],O=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*v-g*g;if(Math.abs(O)<s)return!1;let y=(b*g-m*v)/O,_=(b+g*y)/v;i&&(y=Object(r.f)(y,0,1),_=Object(r.f)(_,0,1));const j=o.d.get(),x=o.d.get();return j[0]=c[0]+y*f[0],j[1]=c[1]+y*f[1],j[2]=c[2]+y*f[2],x[0]=h[0]+_*p[0],x[1]=h[1]+_*p[1],x[2]=h[2]+_*p[2],n.tA=y,n.tB=_,n.pA=j,n.pB=x,n.distance2=Object(a.l)(j,x),!0}const v={tA:0,tB:0,pA:Object(s.e)(),pB:Object(s.e)(),distance2:0},O=new n.a((()=>({origin:null,vector:null})))},409:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(342),n=i(634);class a{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fieldNames){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new a(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,i,r){const n=this.stride;if(n%4==0){const a=new Uint32Array(e.buffer,t*n,r*n/4);new Uint32Array(this.buffer,i*n,r*n/4).set(a)}else{const a=new Uint8Array(e.buffer,t*n,r*n);new Uint8Array(this.buffer,i*n,r*n).set(a)}}}class s{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this.appendField(e,r.m,t),this}vec2f64(e,t){return this.appendField(e,r.n,t),this}vec3f(e,t){return this.appendField(e,r.u,t),this}vec3f64(e,t){return this.appendField(e,r.v,t),this}vec4f(e,t){return this.appendField(e,r.C,t),this}vec4f64(e,t){return this.appendField(e,r.D,t),this}mat3f(e,t){return this.appendField(e,r.f,t),this}mat3f64(e,t){return this.appendField(e,r.g,t),this}mat4f(e,t){return this.appendField(e,r.h,t),this}mat4f64(e,t){return this.appendField(e,r.i,t),this}vec4u8(e,t){return this.appendField(e,r.J,t),this}f32(e,t){return this.appendField(e,r.a,t),this}f64(e,t){return this.appendField(e,r.b,t),this}u8(e,t){return this.appendField(e,r.l,t),this}u16(e,t){return this.appendField(e,r.j,t),this}i8(e,t){return this.appendField(e,r.e,t),this}vec2i8(e,t){return this.appendField(e,r.q,t),this}vec2i16(e,t){return this.appendField(e,r.o,t),this}vec2u8(e,t){return this.appendField(e,r.t,t),this}vec4u16(e,t){return this.appendField(e,r.H,t),this}u32(e,t){return this.appendField(e,r.k,t),this}appendField(e,t,i){const r=t.ElementCount*Object(n.a)(t.ElementType),a=this.stride;this.fields.set(e,{size:r,constructor:t,offset:a,optional:i}),this.stride+=r,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new a(this,e)}createView(e){return new a(this,e)}clone(){const e=new s;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,i)=>e.fields.set(i,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function o(){return new s}},410:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(610);class n extends r.a{constructor(e){super(),this._material=e.material,this._techniqueRep=e.techniqueRep,this._output=e.output}get technique(){return this._technique}getPipelineState(e,t){return this.technique.pipeline}ensureResources(e){return 2}ensureParameters(e){}}},421:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i(85),n=i(180),a=i(111),s=i(101),o=i(220);class c{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=Object(s.e)(),Object(o.a)(e.length>=1),Object(o.a)(i.length%this._numIndexPerPrimitive==0),Object(o.a)(i.length>=e.length*this._numIndexPerPrimitive),Object(o.a)(3===r.size||4===r.size);const{data:n,size:c}=r,h=e.length;let u=c*i[this._numIndexPerPrimitive*e[0]];l.clear(),l.push(u),this.bbMin=Object(s.g)(n[u],n[u+1],n[u+2]),this.bbMax=Object(s.c)(this.bbMin);for(let a=0;a<h;++a){const t=this._numIndexPerPrimitive*e[a];for(let e=0;e<this._numIndexPerPrimitive;++e){u=c*i[t+e],l.push(u);let r=n[u];this.bbMin[0]=Math.min(r,this.bbMin[0]),this.bbMax[0]=Math.max(r,this.bbMax[0]),r=n[u+1],this.bbMin[1]=Math.min(r,this.bbMin[1]),this.bbMax[1]=Math.max(r,this.bbMax[1]),r=n[u+2],this.bbMin[2]=Math.min(r,this.bbMin[2]),this.bbMax[2]=Math.max(r,this.bbMax[2])}}Object(a.i)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let d=this.radius*this.radius;for(let a=0;a<l.length;++a){u=l.getItemAt(a);const e=n[u]-this.center[0],t=n[u+1]-this.center[1],i=n[u+2]-this.center[2],r=e*e+t*t+i*i;if(r<=d)continue;const s=Math.sqrt(r),o=.5*(s-this.radius);this.radius=this.radius+o,d=this.radius*this.radius;const c=o/s;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=i*c}l.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(a.l)(this.bbMin,this.bbMax)>1){const e=Object(a.i)(Object(s.e)(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let a=0;a<8;++a)r[a]=0;const{data:n,size:o}=this.position;for(let a=0;a<t;++a){let t=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[a];let c=o*this.indices[s],l=n[c],h=n[c+1],u=n[c+2];for(let e=1;e<this._numIndexPerPrimitive;++e){c=o*this.indices[s+e];const t=n[c],i=n[c+1],r=n[c+2];t<l&&(l=t),i<h&&(h=i),r<u&&(u=r)}l<e[0]&&(t|=1),h<e[1]&&(t|=2),u<e[2]&&(t|=4),i[a]=t,++r[t]}let l=0;for(let a=0;a<8;++a)r[a]>0&&++l;if(l<2)return;const h=new Array(8);for(let a=0;a<8;++a)h[a]=r[a]>0?new Uint32Array(r[a]):void 0;for(let a=0;a<8;++a)r[a]=0;for(let a=0;a<t;++a){const e=i[a];h[e][r[e]++]=this.primitiveIndices[a]}this._children=new Array(8);for(let a=0;a<8;++a)void 0!==h[a]&&(this._children[a]=new c(h[a],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){l.prune()}}const l=new n.a({deallocator:null});var h=i(465),u=i(445);class d extends h.a{constructor(e,t=[],i=0,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=2,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,a]of e)a&&this._vertexAttributes.set(n,{...a});if(null==t||0===t.length){const e=function(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}(this._vertexAttributes),t=Object(u.d)(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const i of this._vertexAttributes.keys())this._indices.set(i,t)}else for(const[n,a]of t)a&&(this._indices.set(n,p(a)),"position"===n&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(r.j)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)}computeAttachmentOriginTriangles(e){const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return Object(u.c)(i,t,e)}computeAttachmentOriginPoints(e){const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return Object(u.b)(i,t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get("position");if(0===e.length)return null;const t=0===this.primitiveType?3:1;Object(o.a)(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=Object(u.d)(e.length/t),r=this.vertexAttributes.get("position");return new c(i,t,e,r)}}function p(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}},431:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e){e.code.add(r.a`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},440:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r,n,a={exports:{}};r=a,void 0!==(n=function(){function e(e,i,n){n=n||2;var a,s,o,l,h,u,d,p=i&&i.length,f=p?i[0]*n:e.length,b=t(e,0,f,n,!0),g=[];if(!b||b.next===b.prev)return g;if(p&&(b=c(e,i,b,n)),e.length>80*n){a=o=e[0],s=l=e[1];for(var m=n;m<f;m+=n)(h=e[m])<a&&(a=h),(u=e[m+1])<s&&(s=u),h>o&&(o=h),u>l&&(l=u);d=0!==(d=Math.max(o-a,l-s))?1/d:0}return r(b,g,n,a,s,d),g}function t(e,t,i,r,n){var a,s;if(n===E(e,t,i,r)>0)for(a=t;a<i;a+=r)s=w(a,e[a],e[a+1],s);else for(a=i-r;a>=t;a-=r)s=w(a,e[a],e[a+1],s);return s&&v(s,s.next)&&(M(s),s=s.next),s}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{if(M(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,c,l,h,u,p){if(e){!p&&u&&d(e,l,h,u);for(var f,b,g=e;e.prev!==e.next;)if(f=e.prev,b=e.next,u?a(e,l,h,u):n(e))t.push(f.i/c),t.push(e.i/c),t.push(b.i/c),M(e),e=b.next,g=b.next;else if((e=b)===g){p?1===p?r(e=s(i(e),t,c),t,c,l,h,u,2):2===p&&o(e,t,c,l,h,u):r(i(e),t,c,l,h,u,1);break}}}function n(e){var t=e.prev,i=e,r=e.next;if(m(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(b(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&m(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,i,r){var n=e.prev,a=e,s=e.next;if(m(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,c=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,l=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,h=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,u=p(o,c,t,i,r),d=p(l,h,t,i,r),f=e.prevZ,g=e.nextZ;f&&f.z>=u&&g&&g.z<=d;){if(f!==e.prev&&f!==e.next&&b(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==e.prev&&g!==e.next&&b(n.x,n.y,a.x,a.y,s.x,s.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&b(n.x,n.y,a.x,a.y,s.x,s.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=d;){if(g!==e.prev&&g!==e.next&&b(n.x,n.y,a.x,a.y,s.x,s.y,g.x,g.y)&&m(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function s(e,t,r){var n=e;do{var a=n.prev,s=n.next.next;!v(a,s)&&O(a,n,n.next,s)&&j(a,s)&&j(s,a)&&(t.push(a.i/r),t.push(n.i/r),t.push(s.i/r),M(n),M(n.next),n=e=s),n=n.next}while(n!==e);return i(n)}function o(e,t,n,a,s,o){var c=e;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&g(c,l)){var h=x(c,l);return c=i(c,c.next),h=i(h,h.next),r(c,t,n,a,s,o),void r(h,t,n,a,s,o)}l=l.next}c=c.next}while(c!==e)}function c(e,r,n,a){var s,o,c,u=[];for(s=0,o=r.length;s<o;s++)(c=t(e,r[s]*a,s<o-1?r[s+1]*a:e.length,a,!1))===c.next&&(c.steiner=!0),u.push(f(c));for(u.sort(l),s=0;s<u.length;s++)n=i(n=h(u[s],n),n.next);return n}function l(e,t){return e.x-t.x}function h(e,t){var r=function(e,t){var i,r=t,n=e.x,a=e.y,s=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var o=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>s){if(s=o,o===n){if(a===r.y)return r;if(a===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i;var c,l=i,h=i.x,d=i.y,p=1/0;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&b(a<d?n:s,a,h,d,a<d?s:n,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(n-r.x),j(r,e)&&(c<p||c===p&&(r.x>i.x||r.x===i.x&&u(i,r)))&&(i=r,p=c)),r=r.next}while(r!==l);return i}(e,t);if(!r)return t;var n=x(r,e),a=i(r,r.next);return i(n,n.next),t===r?a:t}function u(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function d(e,t,i,r){var n=e;do{if(null===n.z&&(n.z=p(n.x,n.y,t,i,r)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,d(e,t,i,r);n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,a,s,o,c,l=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,r=i,o=0,t=0;t<l&&(o++,r=r.nextZ);t++);for(c=l;o>0||c>0&&r;)0!==o&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,c--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,l*=2}while(s>1)}(n)}function p(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function b(e,t,i,r,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(r-o)-(i-s)*(t-o)>=0&&(i-s)*(a-o)-(n-s)*(r-o)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&O(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(j(e,t)&&j(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||v(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function O(e,t,i,r){var n=_(m(e,t,i)),a=_(m(e,t,r)),s=_(m(i,r,e)),o=_(m(i,r,t));return n!==a&&s!==o||!(0!==n||!y(e,i,t))||!(0!==a||!y(e,r,t))||!(0!==s||!y(i,e,r))||!(0!==o||!y(i,t,r))}function y(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function _(e){return e>0?1:e<0?-1:0}function j(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function x(e,t){var i=new S(e.i,e.x,e.y),r=new S(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function w(e,t,i,r){var n=new S(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,i,r){for(var n=0,a=t,s=i-r;a<i;a+=r)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}return e.deviation=function(e,t,i,r){var n=t&&t.length,a=n?t[0]*i:e.length,s=Math.abs(E(e,0,a,i));if(n)for(var o=0,c=t.length;o<c;o++){var l=t[o]*i,h=o<c-1?t[o+1]*i:e.length;s-=Math.abs(E(e,l,h,i))}var u=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,p=r[o+1]*i,f=r[o+2]*i;u+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)i.vertices.push(e[n][a][s]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},e}())&&(r.exports=n);var s=a.exports},443:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return E})),i.d(t,"c",(function(){return w})),i.d(t,"d",(function(){return T})),i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return S})),i.d(t,"g",(function(){return x})),i.d(t,"h",(function(){return P})),i.d(t,"i",(function(){return j})),i.d(t,"j",(function(){return M}));var r=i(107),n=i(85),a=i(135),s=i(168),o=i(215),c=i(101),l=i(226),h=i(221),u=i(178),d=i(267),p=i(123),f=i(382),b=i(264),g=i(373),m=i(533);function v(e,t){if("point"===e.type)return y(e,t,!1);if(Object(m.d)(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(O(e),t,!0);case"mesh":return y(e.origin,t,!1)}else switch(e.type){case"extent":return y(function(e){const t=Object(r.k)(e.zmin);return Object(g.g)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Object(f.b)(e.rings,e.hasZ);return Object(g.g)(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return y(O(e),t,!0)}}function O(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(b.f)(t,Object(b.e)(t)/2);return Object(g.g)(i[0],i[1],i[2],e.spatialReference)}function y(e,t,i){const r=i?e:Object(m.a)(e);return t&&e?Object(u.p)(e,r,t)?r:null:r}function _(e,t,i,r=0){if(e){t||(t=Object(p.l)());const n=e;let a=.5*n.width*(i-1),s=.5*n.height*(i-1);return n.width<1e-7*n.height?a+=s/20:n.height<1e-7*n.width&&(s+=a/20),Object(l.l)(t,n.xmin-a-r,n.ymin-s-r,n.xmax+a+r,n.ymax+s+r),t}return null}function j(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute("auxpos1");r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(i))}}function x(e,t){const i=Object(h.f)(h.a);return Object(n.k)(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),Object(n.k)(t)?i[3]=t:Object(n.k)(e)&&e.length>3&&(i[3]=e[3]),i}function w(e=c.a,t,i,r=1){const a=new Array(3);if(Object(n.j)(t)||Object(n.j)(i))a[0]=1,a[1]=1,a[2]=1;else{let r,n=0;for(let s=2;s>=0;s--){const o=e[s];let c;const l=null!=o,h=0===s&&!r&&!l,u=i[s];"symbol-value"===o||h?c=0!==u?t[s]/u:1:l&&"proportional"!==o&&isFinite(o)&&(c=0!==u?o/u:1),null!=c&&(a[s]=c,r=c,n=Math.max(n,Math.abs(c)))}for(let e=2;e>=0;e--)null==a[e]?a[e]=r:0===a[e]&&(a[e]=.001*n)}for(let n=2;n>=0;n--)a[n]/=r;return Object(c.f)(a)}function M(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),S(e)?null:"Symbol sizes may not be negative values"}function S(e){if(Array.isArray(e)){for(const t of e)if(!S(t))return!1;return!0}return null==e||e>=0}function E(e,t,i,r=Object(s.d)()){const n=e||0,o=t||0,c=i||0;return 0!==n&&Object(a.r)(r,r,-n/180*Math.PI),0!==o&&Object(a.d)(r,r,o/180*Math.PI),0!==c&&Object(a.k)(r,r,c/180*Math.PI),r}function T(e,t){return null!=t.minDemResolution?t.minDemResolution:Object(d.s)(e)?t.minDemResolutionForPoints:.01*Object(d.t)(e)}const P={"bottom-left":Object(o.e)(0,0),bottom:Object(o.e)(.5,0),"bottom-right":Object(o.e)(1,0),left:Object(o.e)(0,.5),center:Object(o.e)(.5,.5),right:Object(o.e)(1,.5),"top-left":Object(o.e)(0,1),top:Object(o.e)(.5,1),"top-right":Object(o.e)(1,1)}},445:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return d})),i.d(t,"e",(function(){return p}));var r=i(111),n=i(101),a=i(393),s=(i(146),i(401));i(261);new a.a(s.d),new a.a((()=>({p0:null,p1:null,p2:null})));const o=Object(n.e)(),c=Object(n.e)();let l=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const h=new Uint16Array([0]),u=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function d(e){if(1===e)return h;if(e<u.length)return new Uint16Array(u.buffer,0,e);if(e>l.length){const t=Math.max(2*l.length,e);l=new Uint32Array(t);for(let e=0;e<l.length;e++)l[e]=e}return new Uint32Array(l.buffer,0,e)}function p(e){if(1===e)return new Uint16Array(h);if(e<u.length)return new Uint16Array(u.slice(0,e));if(e>l.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(l.slice(0,e))}function f(e,t,i){if(!e)return!1;const{size:n,data:a}=e;Object(r.w)(i,0,0,0),Object(r.w)(y,0,0,0);let s=0,l=0;for(let p=0;p<t.length-2;p+=3){const e=t[p+0]*n,f=t[p+1]*n,b=t[p+2]*n;Object(r.w)(m,a[e+0],a[e+1],a[e+2]),Object(r.w)(v,a[f+0],a[f+1],a[f+2]),Object(r.w)(O,a[b+0],a[b+1],a[b+2]);const g=(h=m,u=v,d=O,Object(r.j)(o,u,h),Object(r.j)(c,d,h),Object(r.p)(Object(r.g)(o,o,c))/2);g?(Object(r.f)(m,m,v),Object(r.f)(m,m,O),Object(r.e)(m,m,1/3*g),Object(r.f)(i,i,m),s+=g):(Object(r.f)(y,y,m),Object(r.f)(y,y,v),Object(r.f)(y,y,O),l+=3)}var h,u,d;return(0!==l||0!==s)&&(0!==s?(Object(r.e)(i,i,1/s),!0):0!==l&&(Object(r.e)(i,y,1/l),!0))}function b(e,t,i){if(!e||!t)return!1;const{size:n,data:a}=e;Object(r.w)(i,0,0,0);let s=-1,o=0;for(let r=0;r<t.length;r++){const e=t[r]*n;s!==e&&(i[0]+=a[e+0],i[1]+=a[e+1],i[2]+=a[e+2],o++),s=e}return o>1&&Object(r.e)(i,i,1/o),o>0}function g(e,t,i,n){if(!e)return!1;const{size:a,data:s}=e;Object(r.w)(n,0,0,0),Object(r.w)(y,0,0,0);let o=0,c=0;const l=t?t.length-1:s.length/a-1,h=l+(i?2:0);for(let u=0;u<h;u+=2){const e=u<l?u:l,i=u<l?u+1:0,h=(t?t[e]:e)*a,d=(t?t[i]:i)*a;m[0]=s[h+0],m[1]=s[h+1],m[2]=s[h+2],v[0]=s[d+0],v[1]=s[d+1],v[2]=s[d+2],Object(r.e)(m,Object(r.f)(m,m,v),.5);const p=Object(r.n)(m,v);p>0?(Object(r.f)(n,n,Object(r.e)(m,m,p)),o+=p):(Object(r.f)(y,y,m),c++)}return 0!==o?(Object(r.e)(n,n,1/o),!0):0!==c&&(Object(r.e)(n,y,1/c),!0)}const m=Object(n.e)(),v=Object(n.e)(),O=Object(n.e)(),y=Object(n.e)()},456:function(e,t,i){"use strict";i.d(t,"a",(function(){return P})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return T}));var r=i(81),n=i(91),a=i(80),s=i(85),o=i(357),c=i(180),l=i(89),h=i(370),u=i(109),d=i(83),p=(i(79),i(84),i(82)),f=i(523),b=i(554);const g=a.a.getLogger("esri.views.support.Scheduler");var m,v;(v=m||(m={})).RESOURCE_CONTROLLER="schedule",v.SLIDE="slide",v.STREAM_DATA_LOADER="stream loader",v.ELEVATION_QUERY="elevation query",v.TERRAIN_SURFACE="terrain",v.SURFACE_GEOMETRY_UPDATES="surface geometry updates",v.GRAPHICS_CORE="Graphics3D",v.I3S_CONTROLLER="I3S",v.POINT_CLOUD_LAYER="point cloud",v.FEATURE_TILE_FETCHER="feature fetcher",v.OVERLAY="overlay",v.STAGE="stage",v.GRAPHICS_DECONFLICTOR="graphics deconflictor",v.FILTER_VISIBILITY="Graphics3D filter visibility",v.SCALE_VISIBILITY="Graphics3D scale visibility",v.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",v.POINT_OF_INTEREST_FREQUENT="POI frequent",v.POINT_OF_INTEREST_INFREQUENT="POI infrequent",v.LABELER="labeler",v.FEATURE_QUERY_ENGINE="feature query",v.FEATURE_TILE_TREE="feature tile tree",v.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",v.ELEVATION_ALIGNMENT="elevation alignment",v.TEXT_TEXTURE_ATLAS="text texture atlas",v.TEXTURE_UNLOAD="texture unload",v.LINE_OF_SIGHT_TOOL="line of sight tool",v.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",v.ELEVATION_PROFILE="elevation profile",v.SNAPPING="snapping",v.SHADOW_ACCUMULATOR="shadow accumulator",v[v.TEST_PRIO=1]="TEST_PRIO";const O=new Map([[m.RESOURCE_CONTROLLER,0],[m.SLIDE,0],[m.STREAM_DATA_LOADER,0],[m.ELEVATION_QUERY,0],[m.TERRAIN_SURFACE,1],[m.SURFACE_GEOMETRY_UPDATES,1],[m.GRAPHICS_CORE,2],[m.I3S_CONTROLLER,2],[m.POINT_CLOUD_LAYER,2],[m.FEATURE_TILE_FETCHER,2],[m.OVERLAY,4],[m.STAGE,4],[m.GRAPHICS_DECONFLICTOR,4],[m.FILTER_VISIBILITY,4],[m.SCALE_VISIBILITY,4],[m.FRUSTUM_VISIBILITY,4],[m.POINT_OF_INTEREST_FREQUENT,6],[m.POINT_OF_INTEREST_INFREQUENT,30],[m.LABELER,8],[m.FEATURE_QUERY_ENGINE,8],[m.FEATURE_TILE_TREE,16],[m.FEATURE_TILE_TREE_ACTIVE,0],[m.ELEVATION_ALIGNMENT,12],[m.TEXT_TEXTURE_ATLAS,12],[m.TEXTURE_UNLOAD,12],[m.LINE_OF_SIGHT_TOOL,16],[m.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[m.SNAPPING,0],[m.SHADOW_ACCUMULATOR,30]]);function y(e){return O.has(e)?O.get(e):"number"==typeof e?e:1}const _=Object(h.a)(6.5),j=Object(h.a)(1),x=Object(h.a)(30),w=Object(h.a)(1e3/30),M=Object(h.a)(100);var S,E;!function(e){let t=class extends n.a{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new o.a("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=1,this._tasks=new c.a,this._runQueue=new c.a,this._load=0,this._idleStateCallbacks=new c.a,this._idleUpdatesStartFired=!1,this._maxReschedule=A,this._forceTask=!1,this._debug=!1,this._debugHandle=Object(u.a)(b.a,"SCHEDULER_LOG_SLOW_TASKS",(e=>this._debug=e)),this._budget=new a(e.nowFunc);for(const r of Object.keys(m))this.performanceInfo.tasks.set(m[r],new o.a(m[r]));let t;const i=this;this._test={get state(){return Object(s.j)(t)?i._state:t},set state(e){t=e},FRAME_SAFETY_BUDGET:_,INTERACTING_BUDGET:w,IDLE_BUDGET:M,get budget(){return i._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,t){const r=y(e),n=new i(this,e,t,r);return this._tasks.push(n),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o.a(e)),n}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),2===this.state&&this._idleUpdatesStartFired&&i.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),2===r._state&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return Object(s.j)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=_,i=e.frameDuration,r=j;switch(this.state){case 2:t=Object(h.a)(0),i=Object(h.a)(Math.max(M,e.frameDuration)),r=x;break;case 1:i=Object(h.a)(Math.max(w,e.frameDuration))}return i=Object(h.a)(i-e.elapsedFrameTime-t),2!==this.state&&i<j&&!this._forceTask?(this._forceTask=!0,!1):(i=Object(h.a)(Math.max(i,r)),this._budget.reset(i,this.state),this._maxReschedule=A,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(Object(h.a)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return E.SCHEDULED;let t=E.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=E.READY:t!==E.READY&&(t=E.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?` ${e}x ${i}`:` ${i}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{if(i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority)switch(e=!0,t=Math.max(t,i.basePriority),i.schedulePriority){case 1:i.schedulePriority=0,this._runQueue.push(i);break;default:--i.schedulePriority}})),!e)return this.updating=!1,!1;this._maxReschedule===A&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const i=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)}catch(t){g.error(`Exception in task "${r.name}"`,t)}r.schedulePriority=r.basePriority;const n=this._budget.now()-i;if(r.runtime+=n,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+n),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",r.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(m))this._frameTaskTimes.set(m[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};Object(r.a)([Object(d.b)()],t.prototype,"updating",void 0),Object(r.a)([Object(d.b)()],t.prototype,"nowFunc",void 0),t=Object(r.a)([Object(p.a)("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends n.a{constructor(e,t,i,r){super({}),this._scheduler=e,this.name=t,this._basePriority=r,this.runtime=0,this._queue=new f.a,this.updating=!1,this.schedulePriority=this._basePriority,this.task=Object(s.k)(i)?i:{running:!1,runTask:e=>this.processQueue(e)}}normalizeCtorArgs(){return{}}remove(){this.processQueue(T),this._scheduler.removeTask(this),this.schedule=P.schedule,this.reschedule=P.reschedule}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=y(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this.updating=!0,this._queue.push(e,t,i)}reschedule(e,t,i){return this.updating=!0,this._queue.unshift(e,t,i)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};Object(r.a)([Object(d.b)()],i.prototype,"updating",void 0),i=Object(r.a)([Object(p.a)("esri.views.support.SchedulerTask")],i);class a{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=a}(S||(S={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(E||(E={}));const T=(()=>{const e=new S.Budget((()=>performance.now()));return e.enabled=!1,e})();const P=new class{remove(){}processQueue(){}schedule(e,t,i){try{if(Object(l.n)(t)){const e=Object(l.e)();return i?Promise.resolve(i(e)):Promise.reject(e)}return Object(l.x)(e())}catch(r){return Promise.reject(r)}}reschedule(e,t,i){return this.schedule(e,t,i)}},A=Number.MAX_SAFE_INTEGER},465:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(234);class n{constructor(){this.id=Object(r.a)()}unload(){}}},466:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return o}));var r=i(431),n=i(113);function a(e){e.fragment.include(r.a),e.fragment.uniforms.add("uShadowMapTex","sampler2D"),e.fragment.uniforms.add("uShadowMapNum","int"),e.fragment.uniforms.add("uShadowMapDistance","vec4"),e.fragment.uniforms.add("uShadowMapMatrix","mat4",4),e.fragment.uniforms.add("uDepthHalfPixelSz","float"),e.fragment.code.add(n.a`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)}function s(e,t){t.shadowMappingEnabled&&(t.shadowMap.bind(e),t.shadowMap.bindView(e,t.origin))}function o(e,t,i){t.shadowMappingEnabled&&t.shadowMap.bindView(e,i)}function c(e,t){t.shadowMappingEnabled&&t.shadowMap.bindView(e,t.origin)}},468:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var r=i(85),n=i(135),a=i(168),s=i(111),o=i(101),c=i(430),l=i(490),h=i(465),u=i(192),d=i(234);class p{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,n,a){this.id=Object(d.a)(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=n,this._shaderTransformation=a,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return Object(r.k)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Object(s.q)(e,e,this.getStaticTransformation()),!0)}}p.pool=new u.a(p);var f=i(686),b=i(220),g=i(385);class m extends h.a{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Object(a.d)(),this._bvObjectSpace=new O,this._bvWorldSpace=new O,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new v),this.transformation=Object(a.d)();const{geometries:t,materials:i,transformations:r,origins:n}=e;if(Array.isArray(t)){Object(b.a)(i.length===t.length,"Object3D: materials don't match geometries"),Object(b.a)(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=p.pool.acquire(t[e],i[e],Object(a.c)(r[e]),{highlights:null,occludees:null,visible:!0},n&&n[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){Object(n.f)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){Object(b.a)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}getNumGeometryRecords(){return this._geometryRecords.length}getGeometryRecord(e){return Object(b.a)(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]}addGeometry(e,t,i,n,s,o){i=i||a.a,this._geometries.push(e);const c=p.pool.acquire(e,t,i,n||{highlights:null,occludees:null,visible:!0},s,o);return this._geometryRecords.push(c),this._hasVolatileTransformation=this._hasVolatileTransformation||Object(r.k)(c.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:c}),this._invalidateBoundingVolume(),c}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=Object(r.k)(t.shaderTransformation)?this._geometryRecords.some((e=>Object(r.k)(e.shaderTransformation))):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[e]}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){this._visible=e;for(const t of this._geometryRecords)t.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}maskOccludee(){const e=new f.a(1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(g.b)(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Object(g.g)(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new f.a(0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(g.b)(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Object(g.g)(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return Object(n.n)(Object(r.t)(t,Object(a.d)()),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return t=t||Object(a.d)(),Object(n.n)(t,this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let n=0;n<this._geometryRecords.length;++n){const e=this._geometries[n],t=this._geometryRecords[n],i=e.boundingInfo;Object(r.k)(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Object(s.i)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Object(s.i)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=Object(o.e)(),t=Object(o.e)(),i=Object(l.d)(this.transformation);for(let n=0;n<this._geometryRecords.length;++n){const a=this._geometries[n].boundingInfo;if(Object(r.j)(a))continue;const o=this._geometryRecords[n].getShaderTransformation(),c=Object(l.d)(o);Object(s.q)(e,a.getCenter(),o);const h=Object(s.m)(e,this._bvObjectSpace.bounds),u=a.getBSRadius()*c;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],h+u),Object(s.q)(t,e,this.transformation);const d=Object(s.m)(t,this._bvWorldSpace.bounds),p=u*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],d+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),n=e.getBBMax(),a=Object(o.c)(r),c=Object(o.c)(n);Object(s.q)(a,a,i),Object(s.q)(c,c,i);for(let s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],c[s]),t.max[s]=Math.max(t.max[s],a[s],c[s]);for(let o=0;o<3;++o){Object(s.k)(a,r),Object(s.k)(c,n),a[o]=n[o],c[o]=r[o],Object(s.q)(a,a,i),Object(s.q)(c,c,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],a[e],c[e]),t.max[e]=Math.max(t.max[e],a[e],c[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,Object(r.k)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){Object(r.k)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class v{constructor(){this.min=Object(o.g)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Object(o.g)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class O extends v{constructor(){super(...arguments),this.bounds=Object(c.b)()}init(){Object(s.w)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Object(s.w)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Object(c.a)(this.bounds)}}},478:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return b})),i.d(t,"f",(function(){return m})),i.d(t,"g",(function(){return v}));var r,n,a=i(197),s=i(85),o=i(135),c=i(168),l=i(101),h=i(178),u=i(657),d=i(443),p=i(625);function f(e,t,i,r,n,a,s,o,c,l,u){const d=y[u.mode];let p,f,b=0;if(Object(h.m)(e,t,i,r,c.spatialReference,n,o))return d.requiresAlignment(u)?(b=d.applyElevationAlignmentBuffer(r,n,a,s,o,c,l,u),p=a,f=s):(p=r,f=n),Object(h.m)(p,c.spatialReference,f,a,l.spatialReference,s,o)?b:void 0}function b(e,t,i,r,n){const o=(Object(u.a)(e)?e.z:Object(p.c)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=Object(s.t)(Object(p.b)(t,e,"ground"),0);return n&&(n.verticalDistanceToGround=0,n.sampledElevation=i),i}case"relative-to-ground":{const a=Object(s.t)(Object(p.b)(t,e,"ground"),0),c=i.geometryZWithOffset(o,r);return n&&(n.verticalDistanceToGround=c,n.sampledElevation=a),c+a}case"relative-to-scene":{const a=Object(s.t)(Object(p.b)(t,e,"scene"),0),c=i.geometryZWithOffset(o,r);return n&&(n.verticalDistanceToGround=c,n.sampledElevation=a),c+a}case"absolute-height":{const a=i.geometryZWithOffset(o,r);if(n){const i=Object(s.t)(Object(p.b)(t,e,"ground"),0);n.verticalDistanceToGround=a-i,n.sampledElevation=i}return a}default:return Object(a.a)(i.mode),0}}function g(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?r.UPDATE:e.onTheGroundChanged}function m(e){return"relative-to-ground"===e||"relative-to-scene"===e}function v(e){return"absolute-height"!==e}function O(e,t,i,r,n){const a=b(t,i,n,r,j);Object(d.i)(e,j.verticalDistanceToGround);const s=j.sampledElevation,c=Object(o.f)(_,e.transformation);return x[0]=t.x,x[1]=t.y,x[2]=a,Object(h.d)(t.spatialReference,x,c,r.spatialReference)?e.transformation=c:console.warn("Could not locate symbol object properly, it might be misplaced"),s}(n=r||(r={}))[n.NONE=0]="NONE",n[n.UPDATE=1]="UPDATE",n[n.RECREATE=2]="RECREATE";const y={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a,s,o){const c=o.calculateOffsetRenderUnits(s),l=o.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<n;++h){const n=e[t+0],a=e[t+1],s=e[t+2];i[r+0]=n,i[r+1]=a,i[r+2]=null==l?s+c:c,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a){let o=0;const c=a.spatialReference;t*=3,r*=3;for(let l=0;l<n;++l){const n=e[t+0],l=e[t+1],h=e[t+2],u=Object(s.t)(a.getElevation(n,l,h,c,"ground"),0);o+=u,i[r+0]=n,i[r+1]=l,i[r+2]=u,t+=3,r+=3}return o/n},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a,o,c){let l=0;const h=c.calculateOffsetRenderUnits(o),u=c.featureExpressionInfoContext,d=a.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(s.t)(a.getElevation(n,o,c,d,"ground"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==u?c+p+h:p+h,t+=3,r+=3}return l/n},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,r,n,a,o,c){let l=0;const h=c.calculateOffsetRenderUnits(o),u=c.featureExpressionInfoContext,d=a.spatialReference;t*=3,r*=3;for(let p=0;p<n;++p){const n=e[t+0],o=e[t+1],c=e[t+2],p=Object(s.t)(a.getElevation(n,o,c,d,"scene"),0);l+=p,i[r+0]=n,i[r+1]=o,i[r+2]=null==u?c+p+h:p+h,t+=3,r+=3}return l/n},requiresAlignment:()=>!0}},_=Object(c.d)(),j={verticalDistanceToGround:0,sampledElevation:0},x=Object(l.e)()},480:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r,n,a=i(111),s=i(505),o=i(101),c=i(333),l=i(284);(n=r||(r={})).length=function(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)},n.normalize=function(e,t){const i=e[t],r=e[t+1],n=e[t+2],a=1/Math.sqrt(i*i+r*r+n*n);e[t]*=a,e[t+1]*=a,e[t+2]*=a},n.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},n.add=function(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]+i[r],n[a+1]=e[t+1]+i[r+1],n[a+2]=e[t+2]+i[r+2]},n.subtract=function(e,t,i,r,n,a=t){(n=n||e)[a]=e[t]-i[r],n[a+1]=e[t+1]-i[r+1],n[a+2]=e[t+2]-i[r+2]};var h=i(421),u=i(445),d=i(220);const p=r;var f,b,g,m;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],n=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),s=new Uint16Array(36);for(let c=0;c<6;c++)for(let e=0;e<6;e++)s[6*c+e]=c;const o=new Uint16Array(36);for(let c=0;c<6;c++)o[6*c+0]=0,o[6*c+1]=1,o[6*c+2]=2,o[6*c+3]=2,o[6*c+4]=3,o[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new h.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}],["uv0",{size:2,data:n}]],[["position",a],["normal",s],["uv0",o]])}}(f||(f={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],n=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new h.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}]],[["position",n],["normal",a]])}}(b||(b={})),function(e){const t=.5,i=Object(s.c)(-t,0,-t),r=Object(s.c)(t,0,-t),n=Object(s.c)(0,0,t),o=Object(s.c)(0,.5,0),c=Object(s.b)(),l=Object(s.b)(),u=Object(s.b)(),d=Object(s.b)(),p=Object(s.b)();Object(a.j)(c,i,o),Object(a.j)(l,i,r),Object(a.g)(u,c,l),Object(a.r)(u,u),Object(a.j)(c,r,o),Object(a.j)(l,r,n),Object(a.g)(d,c,l),Object(a.r)(d,d),Object(a.j)(c,n,o),Object(a.j)(l,n,i),Object(a.g)(p,c,l),Object(a.r)(p,p);const f=[i,r,n,o],b=[0,-1,0,u[0],u[1],u[2],d[0],d[1],d[2],p[0],p[1],p[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],m=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=f[i][0]*e[0],t[3*i+1]=f[i][1]*e[1],t[3*i+2]=f[i][2]*e[2];return new h.a([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:b}]],[["position",new Uint16Array(g)],["normal",new Uint16Array(m)]])}}(g||(g={})),function(e){e.createBoxGeometry=f.createGeometry,e.createDiamondGeometry=b.createGeometry,e.createTetrahedronGeometry=g.createGeometry,e.createSphereGeometry=function(e,t,i,r={uv:!0}){const n=-Math.PI,a=2*Math.PI,s=-Math.PI/2,o=Math.PI,c=Math.max(3,Math.floor(t)),l=Math.max(2,Math.floor(i)),u=(c+1)*(l+1),d=new Float32Array(3*u),p=new Float32Array(3*u),f=new Float32Array(2*u),b=[];let g=0;for(let h=0;h<=l;h++){const t=[],i=h/l,r=s+i*o,u=Math.cos(r);for(let s=0;s<=c;s++){const o=s/c,l=n+o*a,h=Math.cos(l)*u,b=Math.sin(r),m=-Math.sin(l)*u;d[3*g]=h*e,d[3*g+1]=b*e,d[3*g+2]=m*e,p[3*g]=h,p[3*g+1]=b,p[3*g+2]=m,f[2*g]=o,f[2*g+1]=i,t.push(g),++g}b.push(t)}const m=new Uint32Array(2*c*(l-1)*3);g=0;for(let h=0;h<l;h++)for(let e=0;e<c;e++){const t=b[h][e],i=b[h][e+1],r=b[h+1][e+1],n=b[h+1][e];0===h?(m[g++]=t,m[g++]=r,m[g++]=n):h===l-1?(m[g++]=t,m[g++]=i,m[g++]=r):(m[g++]=t,m[g++]=i,m[g++]=r,m[g++]=r,m[g++]=n,m[g++]=t)}const v=[["position",m],["normal",m]],O=[["position",{size:3,data:d,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]];return r.uv&&(O.push(["uv0",{size:2,data:f,exclusive:!0}]),v.push(["uv0",m])),r.offset&&(v[0][0]="offset",O[0][0]="offset",v.push(["position",new Uint32Array(m.length)]),O.push(["position",{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new h.a(O,v)},e.createPolySphereGeometry=function(e,t,i){const r=e;let n,a;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;n=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],a=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let h=0;h<n.length;h+=3)p.scale(n,h,e/p.length(n,h));let s={};function o(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(s[r])return s[r];let a=n.length;return n.length+=3,p.add(n,3*t,n,3*i,n,a),p.scale(n,a,e/p.length(n,a)),a/=3,s[r]=a,a}for(let h=0;h<t;h++){const e=a.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=a[i],r=a[i+1],n=a[i+2],s=o(e,r),c=o(r,n),l=o(n,e),h=4*i;t[h]=e,t[h+1]=s,t[h+2]=l,t[h+3]=r,t[h+4]=c,t[h+5]=s,t[h+6]=n,t[h+7]=l,t[h+8]=c,t[h+9]=s,t[h+10]=c,t[h+11]=l}a=t,s={}}const c=new Float32Array(n);for(let h=0;h<c.length;h+=3)p.normalize(c,h);const l=[["position",a],["normal",a]],u=[["position",{size:3,data:new Float32Array(n),exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}]];return new h.a(u,l)},e.createPointGeometry=function(e,t,i,r,n,a,s){const o=t?[t[0],t[1],t[2]]:[0,0,0],c=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];const l=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],u=null!=r&&2===r.length?r:[1,1],d=[["position",{size:3,data:o,exclusive:!0}],["normal",{size:3,data:c,exclusive:!0}],["uv0",{size:a.length,data:a}],["color",{size:4,data:l,exclusive:!0}],["size",{size:2,data:u}]];if(null!=n){const e=new Float32Array([n[0],n[1],n[2],n[3]]);d.push(["auxpos1",{size:4,data:e}])}if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);d.push(["auxpos2",{size:4,data:e}])}return new h.a(d,null,1)},e.updatePointGeometry=function(e,t,i,r,n,a,s,o){if(null!=e){const{data:t}=o.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=o.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=o.getMutableAttribute("color");e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=o.getMutableAttribute("size");e[0]=r[0],e[1]=r[1]}if(null!=n){const{data:e}=o.getMutableAttribute("auxpos1");e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3]}if(null!=a){const{data:e}=o.getMutableAttribute("uv0");e[0]=a[0],e[1]=a[1]}if(null!=s){const{data:e}=o.getMutableAttribute("auxpos2");e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}},e.createPointArrayGeometry=function(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),n=new Uint32Array(e.length),a=new Uint32Array(e.length);for(let s=0;s<e.length;s++)i[3*s]=e[s][0],i[3*s+1]=e[s][1],i[3*s+2]=e[s][2],t&&(r[3*s]=t[s][0],r[3*s+1]=t[s][1],r[3*s+2]=t[s][2]),n[s]=s,a[s]=0;return t||(r[0]=0,r[1]=1,r[2]=0),new h.a([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",n],["normal",t?n:a],["uv0",a]],1)},e.createTriangleGeometry=function(){const e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),i=new Uint16Array([0,0,0]);return new h.a([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",i]])};const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function i(e,t,i,r,n){return!(Math.abs(Object(a.h)(t,e))>n)&&(Object(a.g)(i,e,t),Object(a.r)(i,i),Object(a.g)(r,i,e),Object(a.r)(r,r),!0)}function r(e,t,r,n,a,s,o){return i(e,t,a,s,o)||i(e,r,a,s,o)||i(e,n,a,s,o)}e.createSquareGeometry=function(e=t){const i=new Array(12);for(let t=0;t<4;t++)for(let r=0;r<3;r++)i[3*t+r]=e[t][r];const r=new Uint32Array([0,1,2,2,3,0]),n=new Uint32Array([0,0,0,0,0,0]);return new h.a([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",r],["normal",n],["uv0",r],["color",n]])},e.createConeGeometry=function(e,t,i,r,n=!0,a=!0){let o=0;const c=t,l=e;let u=Object(s.c)(0,o,0),d=Object(s.c)(0,o+l,0),p=Object(s.c)(0,-1,0),f=Object(s.c)(0,1,0);r&&(o=l,d=Object(s.c)(0,0,0),u=Object(s.c)(0,o,0),p=Object(s.c)(0,1,0),f=Object(s.c)(0,-1,0));const b=[d,u],g=[p,f],m=i+2,v=Math.sqrt(l*l+c*c);if(r)for(let h=i-1;h>=0;h--){const e=h*(2*Math.PI/i),t=Object(s.c)(Math.cos(e)*c,o,Math.sin(e)*c);b.push(t);const r=Object(s.c)(l*Math.cos(e)/v,-c/v,l*Math.sin(e)/v);g.push(r)}else for(let h=0;h<i;h++){const e=h*(2*Math.PI/i),t=Object(s.c)(Math.cos(e)*c,o,Math.sin(e)*c);b.push(t);const r=Object(s.c)(l*Math.cos(e)/v,c/v,l*Math.sin(e)/v);g.push(r)}const O=new Uint32Array(2*(i+2)*3),y=new Uint32Array(2*(i+2)*3);let _=0,j=0;if(n){for(let e=3;e<b.length;e++)O[_++]=1,O[_++]=e-1,O[_++]=e,y[j++]=0,y[j++]=0,y[j++]=0;O[_++]=b.length-1,O[_++]=2,O[_++]=1,y[j++]=0,y[j++]=0,y[j++]=0}if(a){for(let e=3;e<b.length;e++)O[_++]=e,O[_++]=e-1,O[_++]=0,y[j++]=e,y[j++]=e-1,y[j++]=1;O[_++]=0,O[_++]=2,O[_++]=b.length-1,y[j++]=1,y[j++]=2,y[j++]=g.length-1}const x=new Float32Array(3*m);for(let s=0;s<m;s++)x[3*s]=b[s][0],x[3*s+1]=b[s][1],x[3*s+2]=b[s][2];const w=new Float32Array(3*m);for(let s=0;s<m;s++)w[3*s]=g[s][0],w[3*s+1]=g[s][1],w[3*s+2]=g[s][2];return new h.a([["position",{size:3,data:x,exclusive:!0}],["normal",{size:3,data:w,exclusive:!0}]],[["position",O],["normal",y]])},e.createCylinderGeometry=function(e,t,i,r,n,o){const c=r?Object(s.a)(r):Object(s.c)(1,0,0),l=n?Object(s.a)(n):Object(s.c)(0,0,0);o=null==o||o;const u=Object(s.b)();Object(a.r)(u,c);const d=Object(s.b)();Object(a.e)(d,u,Math.abs(e));const p=Object(s.b)();Object(a.e)(p,d,-.5),Object(a.f)(p,p,l);const f=Object(s.c)(0,1,0);Math.abs(1-Object(a.h)(u,f))<.2&&Object(a.w)(f,0,0,1);const b=Object(s.b)();Object(a.g)(b,u,f),Object(a.r)(b,b),Object(a.g)(f,b,u);const g=2*i+(o?2:0),m=i+(o?2:0),v=new Float32Array(3*g),O=new Float32Array(3*m),y=new Float32Array(2*g),_=new Uint32Array(3*i*(o?4:2)),j=new Uint32Array(3*i*(o?4:2));o&&(v[3*(g-2)+0]=p[0],v[3*(g-2)+1]=p[1],v[3*(g-2)+2]=p[2],y[2*(g-2)]=0,y[2*(g-2)+1]=0,v[3*(g-1)+0]=v[3*(g-2)+0]+d[0],v[3*(g-1)+1]=v[3*(g-2)+1]+d[1],v[3*(g-1)+2]=v[3*(g-2)+2]+d[2],y[2*(g-1)]=1,y[2*(g-1)+1]=1,O[3*(m-2)+0]=-u[0],O[3*(m-2)+1]=-u[1],O[3*(m-2)+2]=-u[2],O[3*(m-1)+0]=u[0],O[3*(m-1)+1]=u[1],O[3*(m-1)+2]=u[2]);const x=function(e,t,i){_[e]=t,j[e]=i};let w=0;const M=Object(s.b)(),S=Object(s.b)();for(let s=0;s<i;s++){const e=s*(2*Math.PI/i);Object(a.e)(M,f,Math.sin(e)),Object(a.e)(S,b,Math.cos(e)),Object(a.f)(M,M,S),O[3*s+0]=M[0],O[3*s+1]=M[1],O[3*s+2]=M[2],Object(a.e)(M,M,t),Object(a.f)(M,M,p),v[3*s+0]=M[0],v[3*s+1]=M[1],v[3*s+2]=M[2],y[2*s+0]=s/i,y[2*s+1]=0,v[3*(s+i)+0]=v[3*s+0]+d[0],v[3*(s+i)+1]=v[3*s+1]+d[1],v[3*(s+i)+2]=v[3*s+2]+d[2],y[2*(s+i)+0]=s/i,y[2*s+1]=1;const r=(s+1)%i;x(w++,s,s),x(w++,s+i,s),x(w++,r,r),x(w++,r,r),x(w++,s+i,s),x(w++,r+i,r)}if(o){for(let e=0;e<i;e++){const t=(e+1)%i;x(w++,g-2,m-2),x(w++,e,m-2),x(w++,t,m-2)}for(let e=0;e<i;e++){const t=(e+1)%i;x(w++,e+i,m-1),x(w++,g-1,m-1),x(w++,t+i,m-1)}}return new h.a([["position",{size:3,data:v,exclusive:!0}],["normal",{size:3,data:O,exclusive:!0}],["uv0",{size:2,data:y,exclusive:!0}]],[["position",_],["normal",j],["uv0",_]])},e.createTubeGeometry=function(t,i,r,n,a){r=r||10,n=null==n||n,Object(d.a)(t.length>1);const s=[],o=[];for(let e=0;e<r;e++){s.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;o.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(o,t,[[0,0,0]],s,n,a)},e.createPathExtrusionGeometry=function(e,t,i,n,u,d=Object(s.c)(0,0,0)){const p=e.length,f=new Float32Array(t.length*p*3+(6*i.length||0)),b=new Float32Array(t.length*p*3+(i?6:0)),g=(t.length-1)*p*6+3*n.length*2,m=new Uint32Array(g),O=new Uint32Array(g);let y=0,_=0,j=0,x=0;const w=Object(s.b)(),M=Object(s.b)(),S=Object(s.b)(),E=Object(s.b)(),T=Object(s.b)(),P=Object(s.b)(),A=Object(s.b)(),C=Object(o.e)(),D=Object(s.b)(),R=Object(s.b)(),I=Object(s.b)(),z=Object(s.b)(),L=Object(s.b)(),V=Object(c.d)();Object(a.w)(D,0,1,0),Object(a.j)(M,t[1],t[0]),Object(a.r)(M,M),u?(Object(a.f)(C,t[0],d),Object(a.r)(S,C)):Object(a.w)(S,0,0,1),r(M,S,D,D,T,S,v),Object(a.k)(E,S),Object(a.k)(z,T);for(let r=0;r<i.length;r++)Object(a.e)(P,T,i[r][0]),Object(a.e)(C,S,i[r][2]),Object(a.f)(P,P,C),Object(a.f)(P,P,t[0]),f[y++]=P[0],f[y++]=P[1],f[y++]=P[2];b[_++]=-M[0],b[_++]=-M[1],b[_++]=-M[2];for(let r=0;r<n.length;r++)m[j++]=n[r][0]>0?n[r][0]:-n[r][0]-1+i.length,m[j++]=n[r][1]>0?n[r][1]:-n[r][1]-1+i.length,m[j++]=n[r][2]>0?n[r][2]:-n[r][2]-1+i.length,O[x++]=0,O[x++]=0,O[x++]=0;let F=i.length;const k=i.length-1;for(let s=0;s<t.length;s++){let i=!1;s>0&&(Object(a.k)(w,M),s<t.length-1?(Object(a.j)(M,t[s+1],t[s]),Object(a.r)(M,M)):i=!0,Object(a.f)(R,w,M),Object(a.r)(R,R),Object(a.f)(I,t[s-1],E),Object(c.g)(t[s],R,V),Object(c.m)(V,Object(l.g)(I,w),C)?(Object(a.j)(C,C,t[s]),Object(a.r)(S,C),Object(a.g)(T,R,S),Object(a.r)(T,T)):r(R,E,z,D,T,S,v),Object(a.k)(E,S),Object(a.k)(z,T)),u&&(Object(a.f)(C,t[s],d),Object(a.r)(L,C));for(let r=0;r<p;r++)if(Object(a.e)(P,T,e[r][0]),Object(a.e)(C,S,e[r][1]),Object(a.f)(P,P,C),Object(a.r)(A,P),b[_++]=A[0],b[_++]=A[1],b[_++]=A[2],Object(a.f)(P,P,t[s]),f[y++]=P[0],f[y++]=P[1],f[y++]=P[2],!i){const e=(r+1)%p;m[j++]=F+r,m[j++]=F+p+r,m[j++]=F+e,m[j++]=F+e,m[j++]=F+p+r,m[j++]=F+p+e;for(let t=0;t<6;t++)O[x++]=m[j-6+t]-k}F+=p}const G=t[t.length-1];for(let r=0;r<i.length;r++)Object(a.e)(P,T,i[r][0]),Object(a.e)(C,S,i[r][1]),Object(a.f)(P,P,C),Object(a.f)(P,P,G),f[y++]=P[0],f[y++]=P[1],f[y++]=P[2];const U=_/3;b[_++]=M[0],b[_++]=M[1],b[_++]=M[2];const B=F-p;for(let r=0;r<n.length;r++)m[j++]=n[r][0]>=0?F+n[r][0]:-n[r][0]-1+B,m[j++]=n[r][2]>=0?F+n[r][2]:-n[r][2]-1+B,m[j++]=n[r][1]>=0?F+n[r][1]:-n[r][1]-1+B,O[x++]=U,O[x++]=U,O[x++]=U;return new h.a([["position",{size:3,data:f,exclusive:!0}],["normal",{size:3,data:b,exclusive:!0}]],[["position",m],["normal",O]])},e.createPolylineGeometry=function(e,t,i){Object(d.a)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),Object(d.a)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),Object(d.a)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),Object(d.a)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),n=new Uint32Array(2*(e.length-1));let a=0,s=0;for(let l=0;l<e.length;l++){for(let t=0;t<3;t++)r[a++]=e[l][t];l>0&&(n[s++]=l-1,n[s++]=l)}const o=[],c=[];if(o.push(["position",n]),c.push(["position",{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let n=0;n<e.length;n++)for(let e=0;e<3;e++)i[r++]=t[n][e];o.push(["normal",n]),c.push(["normal",{size:3,data:i,exclusive:!0}])}return i&&(c.push(["color",{size:4,data:i}]),o.push(["color",Object(u.d)(i.length/4)])),new h.a(c,o,2)},e.createExtrudedTriangle=function(e,t,i,r,n=0){const a=new Array(18),s=[[-t,n,r/2],[i,n,r/2],[0,e+n,r/2],[-t,n,-r/2],[i,n,-r/2],[0,e+n,-r/2]],o=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let c=0;c<6;c++)a[3*c]=s[c][0],a[3*c+1]=s[c][1],a[3*c+2]=s[c][2];return new h.a([["position",{size:3,data:a,exclusive:!0}]],[["position",o]])},e.transformInPlace=function(e,t){const i=e.getMutableAttribute("position").data;for(let r=0;r<i.length;r+=3){const e=i[r],n=i[r+1],s=i[r+2];Object(a.w)(O,e,n,s),Object(a.q)(O,O,t),i[r]=O[0],i[r+1]=O[1],i[r+2]=O[2]}},e.cgToGIS=function(e,t=e){const i=e.vertexAttributes,r=i.get("position").data,n=i.get("normal").data;if(n){const e=t.getMutableAttribute("normal").data;for(let t=0;t<n.length;t+=3){const i=n[t+1];e[t+1]=-n[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute("position").data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t},e.makeOrthoBasisDirUp=i,e.makeOrthoBasisDirUpFallback=r}(m||(m={}));const v=.99619469809,O=Object(s.b)();var y=m},484:function(e,t,i){"use strict";function r(e){return"h"in e&&"s"in e&&"v"in e}function n(e){return"l"in e&&"a"in e&&"b"in e}function a(e){return"l"in e&&"c"in e&&"h"in e}function s(e){return"x"in e&&"y"in e&&"z"in e}i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return y})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return v}));const o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],c=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function l(e,t){const i=[];let r,n;if(e[0].length!==t.length)throw"dimensions do not match";const a=e.length,s=e[0].length;let o=0;for(r=0;r<a;r++){for(o=0,n=0;n<s;n++)o+=e[r][n]*t[n];i.push(o)}return i}function h(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=l(o,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function u(e){const t=l(c,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function d(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function f(e){return d(h(e))}function b(e){return u(p(e))}function g(e){return function(e){const t=e.l,i=e.a,r=e.b,n=Math.sqrt(i*i+r*r);let a=Math.atan2(r,i);return a=a>0?a:a+2*Math.PI,{l:t,c:n,h:a}}(d(h(e)))}function m(e){return u(p(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}function v(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:a(e)?m(e):n(e)?b(e):s(e)?u(e):r(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,n=r*i,a=n*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:n,g:a,b:0};break;case 1:s={r:a,g:n,b:0};break;case 2:s={r:0,g:n,b:a};break;case 3:s={r:0,g:a,b:n};break;case 4:s={r:a,g:0,b:n};break;case 5:case 6:s={r:n,g:0,b:a};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+r-n),s.g=Math.round(s.g+r-n),s.b=Math.round(s.b+r-n),s}(e):e}function O(e){return r(e)?e:function(e){const t=e.r,i=e.g,r=e.b,n=Math.max(t,i,r),a=n-Math.min(t,i,r);let s=n,o=0===a?0:n===t?(i-r)/a%6:n===i?(r-t)/a+2:(t-i)/a+4,c=0===a?0:a/s;return o<0&&(o+=6),o*=60,c*=100,s*=100/255,{h:o,s:c,v:s}}(v(e))}function y(e){return n(e)?e:f(v(e))}function _(e){return a(e)?e:g(v(e))}function j(e,t){const i=f(e);return i.l*=1-t,b(i)}},485:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return P})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return C})),i.d(t,"h",(function(){return l}));var r=i(304),n=i(384),a=i(101),s=i(171),o=i(111),c=i(226);function l(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function h(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>s.a?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function u(e,t,i){const r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],c=i[1],l=i[2],h=i[3];return e[0]=r*h+s*o+n*l-a*c,e[1]=n*h+s*c+a*o-r*l,e[2]=a*h+s*l+r*c-n*o,e[3]=s*h-r*o-n*c-a*l,e}function d(e,t,i,r){const n=t[0],a=t[1],o=t[2],c=t[3];let l,h,u,d,p,f=i[0],b=i[1],g=i[2],m=i[3];return h=n*f+a*b+o*g+c*m,h<0&&(h=-h,f=-f,b=-b,g=-g,m=-m),1-h>s.a?(l=Math.acos(h),u=Math.sin(l),d=Math.sin((1-r)*l)/u,p=Math.sin(r*l)/u):(d=1-r,p=r),e[0]=d*n+p*f,e[1]=d*a+p*b,e[2]=d*o+p*g,e[3]=d*c+p*m,e}function p(e,t){const i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=a*o,e}function f(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function b(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const n=(i+1)%3,a=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*n+n]-t[3*a+a]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*n+a]-t[3*a+n])*r,e[n]=(t[3*n+i]+t[3*i+n])*r,e[a]=(t[3*a+i]+t[3*i+a])*r}return e}function g(e,t,i,r){const n=.5*Math.PI/180;t*=n,i*=n,r*=n;const a=Math.sin(t),s=Math.cos(t),o=Math.sin(i),c=Math.cos(i),l=Math.sin(r),h=Math.cos(r);return e[0]=a*c*h-s*o*l,e[1]=s*o*h+a*c*l,e[2]=s*c*l-a*o*h,e[3]=s*c*h+a*o*l,e}const m=c.c,v=c.l,O=c.a,y=u,_=c.b,j=c.d,x=c.j,w=c.e,M=w,S=c.f,E=S,T=c.k,P=c.g,A=c.h;function C(e,t,i){const r=Object(o.h)(t,i);return r<-.999999?(Object(o.g)(D,R,t),Object(o.y)(D)<1e-6&&Object(o.g)(D,I,t),Object(o.r)(D,D),l(e,D,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o.g)(D,t,i),e[0]=D[0],e[1]=D[1],e[2]=D[2],e[3]=1+r,T(e,e))}const D=Object(a.e)(),R=Object(a.g)(1,0,0),I=Object(a.g)(0,1,0);const z=Object(n.b)(),L=Object(n.b)();const V=Object(r.b)();Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:l,getAxisAngle:h,multiply:u,rotateX:function(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+s*o,e[1]=n*c+a*o,e[2]=a*c-n*o,e[3]=s*c-r*o,e},rotateY:function(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c-a*o,e[1]=n*c+s*o,e[2]=a*c+r*o,e[3]=s*c-n*o,e},rotateZ:function(e,t,i){i*=.5;const r=t[0],n=t[1],a=t[2],s=t[3],o=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*o,e[1]=n*c-r*o,e[2]=a*c+s*o,e[3]=s*c-a*o,e},calculateW:function(e,t){const i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},slerp:d,random:function(e){const t=Object(s.b)(),i=Object(s.b)(),r=Object(s.b)(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},invert:p,conjugate:f,fromMat3:b,fromEuler:g,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:m,set:v,add:O,mul:y,scale:_,dot:j,lerp:x,length:w,len:M,squaredLength:S,sqrLen:E,normalize:T,exactEquals:P,equals:A,rotationTo:C,sqlerp:function(e,t,i,r,n,a){return d(z,t,n,a),d(L,i,r,a),d(e,z,L,2*a*(1-a)),e},setAxes:function(e,t,i,r){const n=V;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-t[0],n[5]=-t[1],n[8]=-t[2],T(e,b(e,n))}})},490:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return c})),i.d(t,"d",(function(){return s})),i.d(t,"e",(function(){return p})),i.d(t,"f",(function(){return o})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return u})),i.d(t,"i",(function(){return l}));var r=i(107),n=i(111),a=i(101);function s(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function o(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),a=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return Object(n.w)(e,i,r,a),e}function c(e,t,i){i=i||e;const r=Object(n.h)(e,t);Object(n.w)(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),Object(n.r)(i,i)}function l(e,t,i){Math.abs(e[0])>Math.abs(e[1])?Object(n.w)(t,0,1,0):Object(n.w)(t,1,0,0),Object(n.g)(i,e,t),Object(n.r)(t,t),Object(n.g)(t,i,e),Object(n.r)(i,i)}function h(e,t,i,r=Object(a.e)()){const s=Object(n.p)(e),o=Object(n.p)(t),c=Object(n.h)(e,t)/(s*o);if(c<.9999999999999999){const a=Math.acos(c),l=((1-i)*s+i*o)/Math.sin(a),h=l/s*Math.sin((1-i)*a),u=l/o*Math.sin(i*a);return Object(n.e)(O,e,h),Object(n.e)(y,t,u),Object(n.f)(r,O,y)}return Object(n.i)(r,e,t,i)}function u(e,t,i,r=Object(a.e)(),s=Object(a.e)()){const o=Object(n.p)(e),c=Object(n.p)(t),l=Object(n.h)(e,t)/(o*c);if(l<.9999999999999999){const a=Math.acos(l),h=Math.sin(a),u=Math.sin(i*a),d=Math.sin((1-i)*a),p=(1-i)*o+i*c;{const i=p/h,a=i/c*u;Object(n.e)(O,e,i/o*d),Object(n.e)(y,t,a),Object(n.f)(r,O,y)}{const r=1/o*(-Math.cos((1-i)*a)*a*p+d*(-o+c));Object(n.e)(O,e,r);const l=1/c*(Math.cos(i*a)*a*p+u*(-o+c));Object(n.e)(y,t,l),Object(n.f)(s,O,y),Object(n.e)(s,s,1/h)}return s}return Object(n.i)(r,e,t,i),Object(n.j)(s,t,e),Object(n.r)(s,s),s}class d{constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,i,r=0,n=!1){return(i-=r)<e?i+=this.ndiff(e-i):i>t&&(i-=this.ndiff(i-t)),n&&i===t&&(i=e),i+r}normalize(e,t=0,i=!1){return this._normalize(this.min,this.max,e,t,i)}clamp(e,t=0){return Object(r.f)(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+this.ndiff(e-t,i)}minimalMonotonic(e,t,i){return this._normalize(e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(r)?i:r}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}function p(e,t,i,r){Object(n.j)(f,t,e),Object(n.j)(b,i,e),Object(n.g)(r,f,b),Object(n.r)(r,r),r[3]=-Object(n.h)(e,r)}const f=Object(a.e)(),b=Object(a.e)();function g(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}g(new d(0,2*Math.PI));const m=g(new d(-Math.PI,Math.PI)),v=g(new d(0,360)),O=(Object(a.e)(),Object(a.e)()),y=Object(a.e)()},497:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return s}));var r=i(113);function n(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(r.a`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(r.a`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?r.a`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(r.a`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(r.a`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?r.a`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(r.a`vec4 vvColor() { return vec4(1.0); }`)}function a(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function s(e,t){a(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function o(e,t){a(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}},501:function(e,t,i){"use strict";i.r(t),i.d(t,"buffer",(function(){return E})),i.d(t,"clip",(function(){return o})),i.d(t,"contains",(function(){return l})),i.d(t,"convexHull",(function(){return _})),i.d(t,"crosses",(function(){return h})),i.d(t,"cut",(function(){return c})),i.d(t,"densify",(function(){return V})),i.d(t,"difference",(function(){return j})),i.d(t,"disjoint",(function(){return g})),i.d(t,"distance",(function(){return u})),i.d(t,"equals",(function(){return d})),i.d(t,"extendedSpatialReferenceInfo",(function(){return s})),i.d(t,"flipHorizontal",(function(){return I})),i.d(t,"flipVertical",(function(){return z})),i.d(t,"generalize",(function(){return L})),i.d(t,"geodesicArea",(function(){return U})),i.d(t,"geodesicBuffer",(function(){return T})),i.d(t,"geodesicDensify",(function(){return F})),i.d(t,"geodesicLength",(function(){return B})),i.d(t,"intersect",(function(){return w})),i.d(t,"intersects",(function(){return p})),i.d(t,"isSimple",(function(){return O})),i.d(t,"nearestCoordinate",(function(){return P})),i.d(t,"nearestVertex",(function(){return A})),i.d(t,"nearestVertices",(function(){return C})),i.d(t,"offset",(function(){return S})),i.d(t,"overlaps",(function(){return m})),i.d(t,"planarArea",(function(){return k})),i.d(t,"planarLength",(function(){return G})),i.d(t,"relate",(function(){return v})),i.d(t,"rotate",(function(){return R})),i.d(t,"simplify",(function(){return y})),i.d(t,"symmetricDifference",(function(){return x})),i.d(t,"touches",(function(){return f})),i.d(t,"union",(function(){return M})),i.d(t,"within",(function(){return b}));var r=i(522),n=i(502);function a(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return r.G.extendedSpatialReferenceInfo(e)}function o(e,t){return r.G.clip(n.hydratedAdapter,a(e),e,t)}function c(e,t){return r.G.cut(n.hydratedAdapter,a(e),e,t)}function l(e,t){return r.G.contains(n.hydratedAdapter,a(e),e,t)}function h(e,t){return r.G.crosses(n.hydratedAdapter,a(e),e,t)}function u(e,t,i){return r.G.distance(n.hydratedAdapter,a(e),e,t,i)}function d(e,t){return r.G.equals(n.hydratedAdapter,a(e),e,t)}function p(e,t){return r.G.intersects(n.hydratedAdapter,a(e),e,t)}function f(e,t){return r.G.touches(n.hydratedAdapter,a(e),e,t)}function b(e,t){return r.G.within(n.hydratedAdapter,a(e),e,t)}function g(e,t){return r.G.disjoint(n.hydratedAdapter,a(e),e,t)}function m(e,t){return r.G.overlaps(n.hydratedAdapter,a(e),e,t)}function v(e,t,i){return r.G.relate(n.hydratedAdapter,a(e),e,t,i)}function O(e){return r.G.isSimple(n.hydratedAdapter,a(e),e)}function y(e){return r.G.simplify(n.hydratedAdapter,a(e),e)}function _(e,t=!1){return r.G.convexHull(n.hydratedAdapter,a(e),e,t)}function j(e,t){return r.G.difference(n.hydratedAdapter,a(e),e,t)}function x(e,t){return r.G.symmetricDifference(n.hydratedAdapter,a(e),e,t)}function w(e,t){return r.G.intersect(n.hydratedAdapter,a(e),e,t)}function M(e,t=null){return r.G.union(n.hydratedAdapter,a(e),e,t)}function S(e,t,i,s,o,c){return r.G.offset(n.hydratedAdapter,a(e),e,t,i,s,o,c)}function E(e,t,i,s=!1){return r.G.buffer(n.hydratedAdapter,a(e),e,t,i,s)}function T(e,t,i,s,o,c){return r.G.geodesicBuffer(n.hydratedAdapter,a(e),e,t,i,s,o,c)}function P(e,t,i=!0){return r.G.nearestCoordinate(n.hydratedAdapter,a(e),e,t,i)}function A(e,t){return r.G.nearestVertex(n.hydratedAdapter,a(e),e,t)}function C(e,t,i,s){return r.G.nearestVertices(n.hydratedAdapter,a(e),e,t,i,s)}function D(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function R(e,t,i){var n;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;if(null==(i=null!=(n=i)?n:D(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(r.G.rotate(e,t,i));return s.spatialReference=a,s}function I(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(t=null!=(i=t)?i:D(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r.G.flipHorizontal(e,t));return a.spatialReference=n,a}function z(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const n=e.spatialReference;if(null==(t=null!=(i=t)?i:D(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r.G.flipVertical(e,t));return a.spatialReference=n,a}function L(e,t,i,s){return r.G.generalize(n.hydratedAdapter,a(e),e,t,i,s)}function V(e,t,i){return r.G.densify(n.hydratedAdapter,a(e),e,t,i)}function F(e,t,i,s=0){return r.G.geodesicDensify(n.hydratedAdapter,a(e),e,t,i,s)}function k(e,t){return r.G.planarArea(n.hydratedAdapter,a(e),e,t)}function G(e,t){return r.G.planarLength(n.hydratedAdapter,a(e),e,t)}function U(e,t,i){return r.G.geodesicArea(n.hydratedAdapter,a(e),e,t,i)}function B(e,t,i){return r.G.geodesicLength(n.hydratedAdapter,a(e),e,t,i)}},502:function(e,t,i){"use strict";i.r(t),i.d(t,"hydratedAdapter",(function(){return c}));var r=i(99),n=i(204),a=i(110),s=i(125),o=i(134);const c={convertToGEGeometry:function(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){const r=e.hasZ(t),n=e.hasM(t),s=new a.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(s.z=e.getPointZ(t)),n&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s},exportPolygon:function(e,t,i){const r=new s.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportPolyline:function(e,t,i){const r=new o.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,i){const r=new n.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r},exportExtent:function(e,t,i){const n=e.hasZ(t),a=e.hasM(t),s=new r.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(n){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(a){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s.cache._geVersion=t,s}}},505:function(e,t,i){"use strict";function r(){return new Float32Array(3)}function n(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(){return r()}function o(){return a(1,1,1)}function c(){return a(1,0,0)}function l(){return a(0,1,0)}function h(){return a(0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const u=s(),d=o(),p=c(),f=l(),b=h();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:function(e,t){return new Float32Array(e,t,3)},zeros:s,ones:o,unitX:c,unitY:l,unitZ:h,ZEROS:u,ONES:d,UNIT_X:p,UNIT_Y:f,UNIT_Z:b})},506:function(e,t,i){"use strict";function r(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){let t=0,i=0;for(let r=0;r<e.length;r++){const n=e[r].size;"number"==typeof n&&(t+=n,i++)}return t/i}(e.stops):t}function a(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:r}=t;return(n(i,e)+n(r,e))/2}));let r=0;const a=i.length;if(0===a)return e;for(let n=0;n<a;n++)r+=i[n];const s=Math.floor(r/a);return Math.max(s,e)}function s(e){const t=e&&e.renderer,i="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return i;const n="visualVariables"in t?a(i,t.visualVariables):i;if("simple"===t.type)return r(n,t.symbol);if("unique-value"===t.type){let e=n;return t.uniqueValueInfos.forEach((t=>{e=r(e,t.symbol)})),e}if("class-breaks"===t.type){let e=n;return t.classBreakInfos.forEach((t=>{e=r(e,t.symbol)})),e}return t.type,n}i.d(t,"a",(function(){return s}))},513:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(431),n=i(113);function a(e,t){e.fragment.include(r.a),3===t.output?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(n.a`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===t.output&&e.fragment.code.add(n.a`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},514:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return p})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return l}));var r=i(135),n=i(342),a=i(220);function s(e,t,i,r){const n=i.typedBuffer,a=i.typedBufferStride,s=e.length;r*=a;for(let o=0;o<s;++o){const i=2*e[o];n[r]=t[i],n[r+1]=t[i+1],r+=a}}function o(e,t,i,r,n){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,null==n||1===n)for(let c=0;c<o;++c){const i=3*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}else for(let c=0;c<o;++c){const i=3*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],r+=s}}function c(e,t,i,r,n=1){const a=i.typedBuffer,s=i.typedBufferStride,o=e.length;if(r*=s,1===n)for(let c=0;c<o;++c){const i=4*e[c];a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}else for(let c=0;c<o;++c){const i=4*e[c];for(let e=0;e<n;++e)a[r]=t[i],a[r+1]=t[i+1],a[r+2]=t[i+2],a[r+3]=t[i+3],r+=s}}function l(e,t,i,r,n,a=1){if(!i)return void o(e,t,r,n,a);const s=r.typedBuffer,c=r.typedBufferStride,l=e.length,h=i[0],u=i[1],d=i[2],p=i[4],f=i[5],b=i[6],g=i[8],m=i[9],v=i[10],O=i[12],y=i[13],_=i[14];if(n*=c,1===a)for(let o=0;o<l;++o){const i=3*e[o],r=t[i],a=t[i+1],l=t[i+2];s[n]=h*r+p*a+g*l+O,s[n+1]=u*r+f*a+m*l+y,s[n+2]=d*r+b*a+v*l+_,n+=c}else for(let o=0;o<l;++o){const i=3*e[o],r=t[i],l=t[i+1],j=t[i+2],x=h*r+p*l+g*j+O,w=u*r+f*l+m*j+y,M=d*r+b*l+v*j+_;for(let e=0;e<a;++e)s[n]=x,s[n+1]=w,s[n+2]=M,n+=c}}function h(e,t,i,n,a,s=1){if(!i)return void o(e,t,n,a,s);const c=i,l=n.typedBuffer,h=n.typedBufferStride,u=e.length,d=c[0],p=c[1],f=c[2],b=c[4],g=c[5],m=c[6],v=c[8],O=c[9],y=c[10],_=!Object(r.q)(c),j=1e-6,x=1-j;if(a*=h,1===s)for(let r=0;r<u;++r){const i=3*e[r],n=t[i],s=t[i+1],o=t[i+2];let c=d*n+b*s+v*o,u=p*n+g*s+O*o,w=f*n+m*s+y*o;if(_){const e=c*c+u*u+w*w;if(e<x&&e>j){const t=1/Math.sqrt(e);c*=t,u*=t,w*=t}}l[a+0]=c,l[a+1]=u,l[a+2]=w,a+=h}else for(let r=0;r<u;++r){const i=3*e[r],n=t[i],o=t[i+1],c=t[i+2];let u=d*n+b*o+v*c,w=p*n+g*o+O*c,M=f*n+m*o+y*c;if(_){const e=u*u+w*w+M*M;if(e<x&&e>j){const t=1/Math.sqrt(e);u*=t,w*=t,M*=t}}for(let e=0;e<s;++e)l[a+0]=u,l[a+1]=w,l[a+2]=M,a+=h}}function u(e,t,i,n,a,s=1){if(!i)return void c(e,t,n,a,s);const o=i,l=n.typedBuffer,h=n.typedBufferStride,u=e.length,d=o[0],p=o[1],f=o[2],b=o[4],g=o[5],m=o[6],v=o[8],O=o[9],y=o[10],_=!Object(r.q)(o),j=1e-6,x=1-j;if(a*=h,1===s)for(let r=0;r<u;++r){const i=4*e[r],n=t[i],s=t[i+1],o=t[i+2],c=t[i+3];let u=d*n+b*s+v*o,w=p*n+g*s+O*o,M=f*n+m*s+y*o;if(_){const e=u*u+w*w+M*M;if(e<x&&e>j){const t=1/Math.sqrt(e);u*=t,w*=t,M*=t}}l[a+0]=u,l[a+1]=w,l[a+2]=M,l[a+3]=c,a+=h}else for(let r=0;r<u;++r){const i=4*e[r],n=t[i],o=t[i+1],c=t[i+2],u=t[i+3];let w=d*n+b*o+v*c,M=p*n+g*o+O*c,S=f*n+m*o+y*c;if(_){const e=w*w+M*M+S*S;if(e<x&&e>j){const t=1/Math.sqrt(e);w*=t,M*=t,S*=t}}for(let e=0;e<s;++e)l[a+0]=w,l[a+1]=M,l[a+2]=S,l[a+3]=u,a+=h}}function d(e,t,i,r,n,a=1){const s=r.typedBuffer,o=r.typedBufferStride,c=e.length;if(n*=o,1===a){if(4===i)for(let l=0;l<c;++l){const i=4*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}else if(4===i)for(let l=0;l<c;++l){const i=4*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=t[i+3],n+=o}else if(3===i)for(let l=0;l<c;++l){const i=3*e[l];for(let e=0;e<a;++e)s[n]=t[i],s[n+1]=t[i+1],s[n+2]=t[i+2],s[n+3]=255,n+=o}}function p(e,t,i,r,o,c){for(const p of t.fieldNames){const t=e.vertexAttributes.get(p),f=e.indices.get(p);if(t&&f)switch(p){case"position":{Object(a.a)(3===t.size);const e=o.getField(p,n.u);e&&l(f,t.data,i,e,c);break}case"normal":{Object(a.a)(3===t.size);const e=o.getField(p,n.u);e&&h(f,t.data,r,e,c);break}case"uv0":{Object(a.a)(2===t.size);const e=o.getField(p,n.m);e&&s(f,t.data,e,c);break}case"color":{Object(a.a)(3===t.size||4===t.size);const e=o.getField(p,n.J);e&&d(f,t.data,t.size,e,c);break}case"symbolColor":{Object(a.a)(3===t.size||4===t.size);const e=o.getField(p,n.J);e&&d(f,t.data,t.size,e,c);break}case"tangent":{Object(a.a)(4===t.size);const e=o.getField(p,n.C);e&&u(f,t.data,r,e,c);break}}}}},515:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(r.a`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(r.a`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(r.a`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},523:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(89);class n{constructor(){this._tasks=new Array}get length(){return this._tasks.length}push(e,t,i){return new Promise(((r,n)=>this._tasks.push(new a(r,n,e,t,i))))}unshift(e,t,i){return new Promise(((r,n)=>this._tasks.unshift(new a(r,n,e,t,i))))}process(){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const t=Object(r.n)(e.signal);if(t&&!e.abortCallback)e.reject(Object(r.e)());else{const i=t?e.abortCallback(Object(r.e)()):e.callback();Object(r.o)(i)?i.then(e.resolve,e.reject):e.resolve(i)}}catch(a){e.reject(a)}return!0}cancelAll(){const e=Object(r.e)();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,i,r,n){this.resolve=e,this.reject=t,this.callback=i,this.signal=r,this.abortCallback=n}}},531:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c}));i(98);var r=i(85),n=i(112),a=i(506),s=i(99);function o(e,t,i,a=new s.a){let o;if("2d"===i.type)o=t*i.resolution;else if("3d"===i.type){const a=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;o=Object(r.k)(s)&&!s.equals(i.spatialReference)?Object(n.f)(s)/Object(n.f)(i.spatialReference):t*a}const c=e.x-o,l=e.y-o,h=e.x+o,u=e.y+o,{spatialReference:d}=i;return a.xmin=Math.min(c,h),a.ymin=Math.min(l,u),a.xmax=Math.max(c,h),a.ymax=Math.max(l,u),a.spatialReference=d,a}function c(e,t,i){const n=i.toMap(e);return!Object(r.j)(n)&&o(n,Object(a.a)(),i,l).intersects(t)}const l=new s.a},532:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return l})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return a}));const r={func:513},n={func:519},a={mask:255},s={mask:0},o={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},c={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},l={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},h={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}},533:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return l}));var r=i(119),n=(i(79),i(87)),a=i(85),s=i(321),o=i(95),c=i(373);function l(e){return"declaredClass"in e}function h(e){return"declaredClass"in e}function u(e,t){if(!e)return null;if("declaredClass"in e)return e;const i=new r.a({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=Object(n.a)(e.symbol),i.attributes=Object(n.a)(e.attributes),i.geometry=d(e.geometry),i}function d(e){return Object(a.j)(e)?null:l(e)?e:Object(o.a)(function(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:n,m:a}=e;return{x:i,y:r,z:n,m:a,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:n}=e;return{rings:p(i),hasZ:r,hasM:n,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:n}=e;return{paths:p(i),hasZ:r,hasM:n,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:h,hasM:u}=e;return{xmin:i,xmax:r,ymin:n,ymax:a,zmin:s,zmax:o,mmin:c,mmax:l,hasZ:h,hasM:u,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:n}=e;return{points:b(i)?f(i):i,hasZ:r,hasM:n,spatialReference:t}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return b(t);return!1}(e)?e.map((e=>f(e))):e}function f(e){return e.map((e=>Object(s.n)(e)))}function b(e){return e.length&&(Object(s.d)(e[0])||Object(s.e)(e[0]))}function g(e,t){if(!e)return null;let i;if(h(e)){if(null==t)return e.clone();if(h(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Object(c.g)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}},543:function(e,t,i){"use strict";function r(e){return 32+e.length}function n(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const n=e[i];switch(typeof n){case"string":t+=r(n);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function a(e,t){return 32+e.length*t}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}))},547:function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var r=i(80),n=i(107),a=i(85),s=i(102),o=i(146),c=i(111),l=i(101),h=i(401),u=i(333),d=i(409),p=i(445),f=i(410),b=i(375),g=i(220),m=i(751),v=i(385),O=i(81),y=i(256),_=i(319),j=i(278),x=i(497),w=i(394),M=i(325),S=i(334),E=i(341),T=i(362),P=i(326),A=i(532),C=i(717),D=i(174);const R=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);class I extends S.a{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=I.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:i.draped,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:i.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new P.a(e.rctx,r,R)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(Object(w.c)(this.program,t.camera.projectionMatrix),4===this.configuration.output&&Object(_.b)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(j.a)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),Object(x.d)(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const{pixelSize:i,sdfNormalizer:r}=Object(a.k)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1};if(this.program.setUniform1f("stipplePatternSDFNormalizer",r),this.configuration.draped?(this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.program.setUniform1f("worldToScreenRatio",1/t.screenToWorldRatio)):this.program.setUniform1f("stipplePatternPixelSizeInv",1/(i*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){const t=Object(a.s)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",Object(a.t)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){Object(w.d)(this.program,e),Object(y.c)(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(D.f)({blending:0===i.output||7===i.output?r?T.f:Object(T.a)(e):null,depthTest:{func:Object(T.b)(e)},depthWrite:r?!i.transparent&&i.writeDepth&&D.d:Object(T.c)(e),colorWrite:D.c,stencilWrite:i.sceneHasOcludees?A.h:null,stencilTest:i.sceneHasOcludees?t?A.d:A.c:null,polygonOffset:r||n?i.polygonOffset&&z:T.d})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&z;return e.occluder&&(this._occluderPipelineTransparent=Object(D.f)({blending:T.f,polygonOffset:t,depthTest:A.a,depthWrite:null,colorWrite:D.c,stencilWrite:null,stencilTest:A.f}),this._occluderPipelineOpaque=Object(D.f)({blending:T.f,polygonOffset:t,depthTest:A.a,depthWrite:null,colorWrite:D.c,stencilWrite:A.g,stencilTest:A.e}),this._occluderPipelineMaskWrite=Object(D.f)({blending:null,polygonOffset:t,depthTest:A.b,depthWrite:null,colorWrite:null,stencilWrite:A.h,stencilTest:A.d})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}I.shader=new M.a(C.a,(()=>i.e(316).then(i.bind(null,1299))));const z={factor:0,units:-4};class L extends E.a{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(O.a)([Object(E.b)({count:8})],L.prototype,"output",void 0),Object(O.a)([Object(E.b)()],L.prototype,"occluder",void 0),Object(O.a)([Object(E.b)()],L.prototype,"slicePlaneEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"transparent",void 0),Object(O.a)([Object(E.b)()],L.prototype,"polygonOffset",void 0),Object(O.a)([Object(E.b)()],L.prototype,"writeDepth",void 0),Object(O.a)([Object(E.b)()],L.prototype,"draped",void 0),Object(O.a)([Object(E.b)()],L.prototype,"stippleEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"stippleOffColorEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"roundCaps",void 0),Object(O.a)([Object(E.b)()],L.prototype,"roundJoins",void 0),Object(O.a)([Object(E.b)()],L.prototype,"vvSize",void 0),Object(O.a)([Object(E.b)()],L.prototype,"vvColor",void 0),Object(O.a)([Object(E.b)()],L.prototype,"vvOpacity",void 0),Object(O.a)([Object(E.b)()],L.prototype,"falloffEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"innerColorEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"sceneHasOcludees",void 0),Object(O.a)([Object(E.b)({count:4})],L.prototype,"transparencyPassType",void 0),Object(O.a)([Object(E.b)()],L.prototype,"multipassTerrainEnabled",void 0),Object(O.a)([Object(E.b)()],L.prototype,"cullAboveGround",void 0);const V=r.a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class F extends b.a{constructor(e){super(e,G),this._vertexAttributeLocations=R,this.techniqueConfig=new L,this.layout=this.createLayout()}isClosed(e,t){return H(this.params,e,t)}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e,t){this.techniqueConfig.output=e;const i=Object(a.k)(t)&&23===t.slot;this.techniqueConfig.draped=i;const r=Object(a.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleIntegerRepeatsEnabled=r&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=r&&Object(a.k)(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&Object(a.k)(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,n,a,s,o,c){c?this.intersectDrapedLineGeometry(e,r,a,s):this.intersectLineGeometry(e,t,i,r,this.params.width,s)}intersectDrapedLineGeometry(e,t,i,r){if(!t.options.selectionMode)return;const a=e.vertexAttributes.get("position").data,s=e.vertexAttributes.get("size");let o=this.params.width;if(this.params.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];o*=Object(n.f)(this.params.vvSizeOffset[0]+t*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else s&&(o*=s.data[0]);const c=i[0],l=i[1],h=(o/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE;for(let d=0;d<a.length-5;d+=3){const e=a[d],t=a[d+1],i=c-e,r=l-t,s=a[d+3]-e,o=a[d+4]-t,h=Object(n.f)((s*i+o*r)/(s*s+o*o),0,1),p=s*h-i,f=o*h-r,b=p*p+f*f;b<u&&(u=b)}u<h*h&&r()}intersectLineGeometry(e,t,i,r,a,s){if(!r.options.selectionMode||Object(v.e)(t))return;if(!Object(g.g)(i))return void V.error("intersection assumes a translation-only matrix");const l=e.vertexAttributes,d=l.get("position").data;let p=a;if(this.params.vvSizeEnabled){const e=l.get("sizeFeatureAttribute").data[0];p*=Object(n.f)(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else l.has("size")&&(p*=l.get("size").data[0]);const f=r.camera,b=Q;Object(o.c)(b,r.point);const m=p*f.pixelRatio/2+4*f.pixelRatio;Object(c.w)(oe[0],b[0]-m,b[1]+m,0),Object(c.w)(oe[1],b[0]+m,b[1]+m,0),Object(c.w)(oe[2],b[0]+m,b[1]-m,0),Object(c.w)(oe[3],b[0]-m,b[1]-m,0);for(let n=0;n<4;n++)if(!f.unprojectFromRenderScreen(oe[n],ce[n]))return;Object(u.f)(f.eye,ce[0],ce[1],le),Object(u.f)(f.eye,ce[1],ce[2],he),Object(u.f)(f.eye,ce[2],ce[3],ue),Object(u.f)(f.eye,ce[3],ce[0],de);let O=Number.MAX_VALUE;const y=N(this.params,l,e.indices)?d.length-2:d.length-5;for(let n=0;n<y;n+=3){Z[0]=d[n]+i[12],Z[1]=d[n+1]+i[13],Z[2]=d[n+2]+i[14];const e=(n+3)%d.length;if($[0]=d[e]+i[12],$[1]=d[e+1]+i[13],$[2]=d[e+2]+i[14],Object(u.t)(le,Z)<0&&Object(u.t)(le,$)<0||Object(u.t)(he,Z)<0&&Object(u.t)(he,$)<0||Object(u.t)(ue,Z)<0&&Object(u.t)(ue,$)<0||Object(u.t)(de,Z)<0&&Object(u.t)(de,$)<0)continue;if(f.projectToRenderScreen(Z,K),f.projectToRenderScreen($,J),K[2]<0&&J[2]>0){Object(c.j)(Y,Z,$);const e=f.frustum,t=-Object(u.t)(e[4],Z)/Object(c.h)(Y,Object(u.q)(e[4]));Object(c.e)(Y,Y,t),Object(c.f)(Z,Z,Y),f.projectToRenderScreen(Z,K)}else if(K[2]>0&&J[2]<0){Object(c.j)(Y,$,Z);const e=f.frustum,t=-Object(u.t)(e[4],$)/Object(c.h)(Y,Object(u.q)(e[4]));Object(c.e)(Y,Y,t),Object(c.f)($,$,Y),f.projectToRenderScreen($,J)}else if(K[2]<0&&J[2]<0)continue;K[2]=0,J[2]=0;const t=Object(h.e)(Object(h.f)(K,J,ie),b);t<O&&(O=t,Object(c.k)(ee,Z),Object(c.k)(te,$))}const _=r.rayBeginPoint,j=r.rayEndPoint;if(O<m*m){let e=Number.MAX_VALUE;if(Object(h.a)(Object(h.f)(ee,te,ie),Object(h.f)(_,j,re),X)){Object(c.j)(X,X,_);const t=Object(c.p)(X);Object(c.e)(X,X,1/t),e=t/Object(c.m)(_,j)}s(e,X)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices,n=i.get("position");return Object(p.a)(n,r?r.get("position"):null,r&&N(this.params,i,r),t)}createLayout(){const e=Object(d.a)().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.params.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.params.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.params.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new U(this.layout,this.params)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new k(e):void 0}validateParameterValues(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return Object(a.k)(e)&&e[3]<1&&e[3]>0}}class k extends f.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(I,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 23===e||(this._technique.configuration.occluder?3===e||10===e||11===e:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(e,t)}}const G={width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...b.b,...m.a.Default};class U{constructor(e,t){switch(this.params=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=W}}isClosed(e){return N(this.params,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return q}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,i=e.indices.get("position").length/2+1,r=this.isClosed(e);let n=r?2:2*t;const a=r?0:1,s=r?i:i-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=a;e<s;++e)n+=4+2*t[e]}else n+=(s-a)*(2*this.numJoinSubdivisions+4);return n+=2,n}write(e,t,i,r){const n=ne,a=ae,s=se,o=t.vertexAttributes.get("position").data,l=t.indices&&t.indices.get("position"),h=this.numCapSubdivisions(t);l&&l.length!==2*(o.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let u=null;t.vertexAttributes.has("subdivisions")&&(u=t.vertexAttributes.get("subdivisions").data);let d=1,p=0;this.params.vvSizeEnabled?p=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(d=t.vertexAttributes.get("size").data[0]);let f=[1,1,1,1],b=0;this.params.vvColorEnabled?b=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(f=t.vertexAttributes.get("color").data);let g=0;this.params.vvOpacityEnabled&&(g=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const m=o.length/3,v=e.transformation,O=new Float32Array(i.buffer),y=this.vertexBufferLayout.stride/4;let _=r*y;const j=_;let x=0;const w=(e,t,i,r,n,a,s,o)=>{if(O[_++]=t[0],O[_++]=t[1],O[_++]=t[2],O[_++]=r,O[_++]=o,O[_++]=a+n/10,O[_++]=e[0],O[_++]=e[1],O[_++]=e[2],O[_++]=i[0],O[_++]=i[1],O[_++]=i[2],this.params.vvSizeEnabled?O[_++]=p:O[_++]=d,this.params.vvColorEnabled)O[_++]=b;else{const e=Math.min(4*s,f.length-4);O[_++]=f[e+0],O[_++]=f[e+1],O[_++]=f[e+2],O[_++]=f[e+3]}this.params.vvOpacityEnabled&&(O[_++]=g)};_+=y,Object(c.w)(a,o[0],o[1],o[2]),v&&Object(c.q)(a,a,v);const M=this.isClosed(t);if(M){const e=o.length-3;Object(c.w)(n,o[e],o[e+1],o[e+2]),v&&Object(c.q)(n,n,v)}else{Object(c.k)(n,a),Object(c.w)(s,o[3],o[4],o[5]),v&&Object(c.q)(s,s,v);for(let e=0;e<h;++e){const t=1-e/h;w(n,a,s,t,1,-4,0,x),w(n,a,s,t,1,4,0,x)}w(n,a,s,0,0,-4,0,x),w(n,a,s,0,0,4,0,x),Object(c.k)(n,a),Object(c.k)(a,s)}const S=M?0:1,E=M?m:m-1;for(let T=S;T<E;T++){const e=(T+1)%m*3;Object(c.w)(s,o[e+0],o[e+1],o[e+2]),v&&Object(c.q)(s,s,v),x+=Object(c.m)(n,a),w(n,a,s,0,1,-1,T,x),w(n,a,s,0,1,1,T,x);const t=u?u[T]:this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);w(n,a,s,e,1,-2,T,x),w(n,a,s,e,1,2,T,x)}w(n,a,s,1,0,-2,T,x),w(n,a,s,1,0,2,T,x),Object(c.k)(n,a),Object(c.k)(a,s)}if(M)Object(c.w)(s,o[3],o[4],o[5]),v&&Object(c.q)(s,s,v),x+=Object(c.m)(n,a),w(n,a,s,0,1,-1,S,x),w(n,a,s,0,1,1,S,x);else{x+=Object(c.m)(n,a),w(n,a,s,0,1,-5,E,x),w(n,a,s,0,1,5,E,x);for(let e=0;e<h;++e){const t=(e+1)/h;w(n,a,s,t,1,-5,E,x),w(n,a,s,t,1,5,E,x)}}B(O,j+y,O,j,y),_=B(O,_-y,O,_,y)}}function B(e,t,i,r,n){for(let a=0;a<n;a++)i[r++]=e[t++];return r}function N(e,t,i){return H(e,t.get("position").data,i?i.get("position"):null)}function H(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const q=3,W=1,Z=Object(l.e)(),$=Object(l.e)(),Y=Object(l.e)(),X=Object(l.e)(),Q=Object(l.e)(),K=Object(s.e)(),J=Object(s.e)(),ee=Object(l.e)(),te=Object(l.e)(),ie=Object(h.d)(),re=Object(h.d)(),ne=Object(l.e)(),ae=Object(l.e)(),se=Object(l.e)(),oe=[Object(s.e)(),Object(s.e)(),Object(s.e)(),Object(s.e)()],ce=[Object(l.e)(),Object(l.e)(),Object(l.e)(),Object(l.e)()],le=Object(u.d)(),he=Object(u.d)(),ue=Object(u.d)(),de=Object(u.d)()},554:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(81),n=i(91),a=i(83),s=(i(79),i(84),i(80),i(82));let o=class extends n.a{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};Object(r.a)([Object(a.b)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=Object(r.a)([Object(s.a)("esri.views.support.DebugFlags")],o);const c=new o},556:function(e,t,i){"use strict";function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function a(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function s(){return r()}function o(){return a(1,1,1,1)}function c(){return a(1,0,0,0)}function l(){return a(0,1,0,0)}function h(){return a(0,0,1,0)}function u(){return a(0,0,0,1)}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const d=s(),p=o(),f=c(),b=l(),g=h(),m=u();Object.freeze({__proto__:null,create:r,clone:n,fromValues:a,createView:function(e,t){return new Float32Array(e,t,4)},zeros:s,ones:o,unitX:c,unitY:l,unitZ:h,unitW:u,ZEROS:d,ONES:p,UNIT_X:f,UNIT_Y:b,UNIT_Z:g,UNIT_W:m})},562:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(81),n=i(91),a=i(80),s=i(85),o=i(89),c=i(83),l=(i(79),i(84),i(82)),h=i(595),u=i(636);const d=a.a.getLogger("esri.views.interactive.InteractiveToolBase");let p=class extends n.a{constructor(e){super(e),this.toolState="pending",this.completed=!1,this.manipulators=new u.a,this.updating=!1,this.automaticManipulatorSelection=!0,this._creationStartedResolver=Object(o.g)(),this._creationFinishedResolver=Object(o.g)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._set("visible",e),e||this.active&&(this.view.activeTool=null),this.attached&&(e?this._show():this._hide())}set editable(e){this._set("editable",e),this.manipulators.isToolEditable=e,this._updateManipulatorAttachment(),this.notifyChange("editable"),this.onEditableChange()}get attached(){return this._get("attached")}get created(){return"created"===this.toolState}get cursor(){return null}attach(){this.attached?d.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):d.error("Tool isn't currently attached. Ignoring detach request.")}activate(){Object(s.j)(this.view)?d.error("Can't activate tool if view is not defined."):this.active?d.warn("Tool is already active, ignoring activation request."):(Object(h.b)(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.active?this.onDeactivate():d.warn("Tool is not active, ignoring deactivation request.")}handleInputEvent(e){this.attached?this.onInputEvent(e):d.warn("handleInputEvent() called on detached tool")}handleInputEventAfter(e){this.attached?this.onInputEventAfter(e):d.warn("handleInputEventAfter() called on detached tool")}destroy(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)}whenCreationStarted(){return this._creationStartedResolver.promise}when(){return this._creationFinishedResolver.promise}rejectCreation(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}onActivate(){}onDeactivate(){}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}startToolCreation(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}}complete(){this.finishToolCreation(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible&&this.editable?this.manipulators.attach():this.manipulators.detach()}};Object(r.a)([Object(c.b)()],p.prototype,"toolState",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],p.prototype,"view",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"active",null),Object(r.a)([Object(c.b)({value:!0})],p.prototype,"visible",null),Object(r.a)([Object(c.b)({value:!0})],p.prototype,"editable",null),Object(r.a)([Object(c.b)({value:!1,readOnly:!0})],p.prototype,"attached",null),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"created",null),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"completed",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"manipulators",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"updating",void 0),Object(r.a)([Object(c.b)()],p.prototype,"cursor",null),Object(r.a)([Object(c.b)()],p.prototype,"automaticManipulatorSelection",void 0),p=Object(r.a)([Object(l.a)("esri.views.interactive.InteractiveToolBase")],p)},563:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(85),n=i(499),a=i(753);class s{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=Object(n.a)(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=Object(a.d)(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=Object(n.c)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=Object(r.t)(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(Object(r.j)(e))return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&Object(r.k)(t)&&Object(r.k)(i)?(this._featureExpressionInfoContext=Object(a.a)(e),Object(a.f)(this._featureExpressionInfoContext,Object(a.c)(n.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new s;return Object(r.k)(e)&&t.setFromElevationInfo(e),t}}},564:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e,t){0===t.output&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(r.a`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===t.output||3===t.output?(e.varyings.add("linearDepth","float"),e.vertex.uniforms.add("cameraNearFar","vec2"),e.vertex.code.add(r.a`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):e.vertex.code.add(r.a`void forwardLinearDepth() {}`)}},573:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e){e.vertex.code.add(r.a`const float PI = 3.141592653589793;`),e.fragment.code.add(r.a`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},574:function(e,t,i){"use strict";i.d(t,"a",(function(){return y}));var r=i(80),n=i(107),a=i(85),s=i(102),o=i(135),c=i(168),l=i(146),h=i(215),u=i(111),d=i(101),p=i(226),f=i(221),b=i(593),g=i(284),m=i(464),v=i(220);const O=r.a.getLogger("esri.views.3d.webgl-engine.lib.Camera");class y{constructor(e=null,t=null,i=null){this._viewUp=Object(d.e)(),this._viewForward=Object(d.e)(),this._viewRight=Object(d.e)(),this._ray=Object(g.c)(),this._viewport=Object(f.g)(0,0,1,1),this._padding=Object(f.g)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Object(h.e)(1,1e3),this._viewDirty=!0,this._viewMatrix=Object(c.d)(),this._projectionDirty=!0,this._projectionMatrix=Object(c.d)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Object(c.d)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Object(c.d)(),this._frustumDirty=!0,this._frustum=Object(b.b)(),this._fullViewport=Object(f.e)(),this.pixelRatio=1,this.relativeElevation=0,Object(a.k)(e)&&Object(u.k)(this._ray.origin,e),this._center=Object(a.k)(t)?Object(d.c)(t):Object(d.e)(),this._up=Object(a.k)(i)?Object(d.c)(i):Object(d.g)(0,0,1)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center)}get ray(){return Object(u.j)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){Object(o.f)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),Object(p.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Object(o.n)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this.aspect;Object(o.l)(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-i*(1+2*this._padding[2]/t),i*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}set projectionMatrix(e){Object(o.f)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Object(v.b)(this._fov,this.width,this.height)}set fovX(e){this._fov=Object(v.d)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Object(v.c)(this._fov,this.width,this.height)}set fovY(e){this._fov=Object(v.e)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Object(u.m)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Object(o.c)(this._viewInverseTransposeMatrix,this.viewMatrix),Object(o.b)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){Object(u.k)(this._ray.origin,e.eye),Object(u.k)(this._center,e.center),Object(u.k)(this._up,e.up),Object(p.c)(this._viewport,e.viewport),Object(p.c)(this._padding,e.padding),Object(l.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(Object(o.f)(this._viewMatrix,e.viewMatrix),Object(u.k)(this._viewRight,e.viewRight),Object(u.k)(this._viewUp,e.viewUp),Object(u.k)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:(Object(o.f)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(Object(b.a)(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Object(o.f)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Object(p.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new y).copyFrom(this)}equals(e){return Object(u.o)(this.eye,e.eye)&&Object(u.o)(this._center,e.center)&&Object(u.o)(this._up,e.up)&&Object(p.g)(this._viewport,e.viewport)&&Object(p.g)(this._padding,e.padding)&&Object(l.k)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;const t=5e-4;Object(u.A)(x,e.eye,e.center),Object(u.A)(w,this.eye,this._center);const i=Object(u.h)(x,w),r=Object(u.B)(x),n=Object(u.B)(w);return i*i>=(1-1e-10)*r*n&&Object(u.C)(e.eye,this.eye)<Math.max(r,n)*t*t&&Object(p.i)(e.padding,this._padding)<.5&&Object(p.i)(e.viewport,this._viewport)<.5}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}viewDirectionDistance(e){return Math.abs(Object(m.d)(this.viewForward,Object(u.j)(x,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=Object(s.g)()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,i=.5){return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t,i=!1){e!==_&&Object(u.k)(_,e),_[3]=1,i&&(t[2]=-_[2]),Object(p.m)(_,_,this.projectionMatrix),Object(u.e)(_,_,1/Math.abs(_[3]));const r=this.fullViewport;return t[0]=Object(n.m)(0,r[0]+r[2],.5+.5*_[0]),t[1]=Object(n.m)(0,r[1]+r[3],.5+.5*_[1]),i||(t[2]=.5*(_[2]+1)),t}projectToScreen(e,t){this.projectToRenderScreen(e,M),this.renderToScreen(M,t)}projectToRenderScreen(e,t){if(_[0]=e[0],_[1]=e[1],_[2]=e[2],_[3]=1,Object(p.m)(_,_,this.viewProjectionMatrix),0===_[3])return null;Object(u.e)(_,_,1/Math.abs(_[3]));const i=this.fullViewport;return"x"in t?(t.x=Object(n.m)(0,i[0]+i[2],.5+.5*_[0]),t.y=Object(n.m)(0,i[1]+i[3],.5+.5*_[1])):(t[0]=Object(n.m)(0,i[0]+i[2],.5+.5*_[0]),t[1]=Object(n.m)(0,i[1]+i[3],.5+.5*_[1]),t.length>2&&(t[2]=.5*(_[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,M),t)}unprojectFromRenderScreen(e,t){if(Object(o.n)(j,this.projectionMatrix,this.viewMatrix),!Object(o.c)(j,j))return null;const i=this.fullViewport;return _[0]=2*(e[0]-i[0])/i[2]-1,_[1]=2*(e[1]-i[1])/i[3]-1,_[2]=2*e[2]-1,_[3]=1,Object(p.m)(_,_,j),0===_[3]?null:(t[0]=_[0]/_[3],t[1]=_[1]/_[3],t[2]=_[2]/_[3],t)}constrainWindowSize(e,t,i,r=i){const n=e*this.pixelRatio,a=t*this.pixelRatio,s=Math.max(n-i/2,0),o=Math.max(this.fullHeight-a-r/2,0),c=-Math.min(n-i/2,0),l=-Math.min(this.fullHeight-a-r/2,0);return[s,o,i-c- -Math.min(this.fullWidth-n-i/2,0),r-l- -Math.min(a-r/2,0)]}computeUp(e){1===e?this.computeUpGlobal():this.computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}computeUpGlobal(){Object(u.j)(x,this.center,this.eye);const e=Object(u.p)(this.center);e<1?(Object(u.w)(this._up,0,0,1),this._markViewDirty()):Math.abs(Object(u.h)(x,this.center))>.9999*Object(u.p)(x)*e||(Object(u.g)(this._up,x,this.center),Object(u.g)(this._up,this._up,x),Object(u.r)(this._up,this._up),this._markViewDirty())}computeUpLocal(){Object(u.v)(x,this.eye,this.center),Math.abs(x[2])<=.9999&&(Object(u.e)(x,x,x[2]),Object(u.w)(this._up,-x[0],-x[1],1-x[2]),Object(u.r)(this._up,this._up),this._markViewDirty())}_compareAndSetView(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?Object(u.o)(e,t)||(Object(u.k)(t,e),this._markViewDirty()):O.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Object(b.c)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(Object(o.m)(this._viewMatrix,this.eye,this._center,this._up),Object(u.w)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),Object(u.w)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),Object(u.w)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const _=Object(f.e)(),j=Object(c.d)(),x=Object(d.e)(),w=Object(d.e)(),M=Object(s.e)()},575:function(e,t,i){"use strict";i.d(t,"a",(function(){return A}));i(98);var r=i(197),n=i(122),a=i(107),s=i(85),o=i(102),c=i(120),l=i(289),h=i(304),u=i(135),d=i(168),p=i(146),f=i(111),b=i(101),g=i(178),m=i(163),v=i(123),O=i(401),y=i(333),_=i(284),j=i(261),x=i(533),w=i(625),M=i(688),S=i(574),E=i(468),T=i(597),P=i(110);class A{constructor(e){this.idHint=0,this.camera=new S.a,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=Object(d.d)(),this._worldFrame=null,this._renderLocation=Object(b.e)(),this._renderLocationDirty=!0,this._location=new P.a({x:0,y:0,z:0}),this._elevationAlignedLocation=new P.a,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new n.a.EventEmitter,this._screenLocation={screenPointArray:Object(o.g)(),renderScreenPointArray:Object(o.e)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:Object(c.d)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){C(e)&&(this._screenLocationDirty=!0),Object(u.f)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=Object(d.d)()),function(e,t,i){switch(e.viewingMode){case"local":return Object(u.j)(i),!0;case"global":{const r=Object(m.e)(e.renderCoordsHelper.spatialReference);Object(g.x)(t,0,k,0,r.radius),Object(g.c)(Object(a.h)(k[0]),Object(a.h)(k[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Object(x.a)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Object(x.a)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=Object(s.k)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this.ensureScreenLocation(),this._screenLocation}ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,C(this._modelTransform)){const t=this._calculateModelTransformOffset(H);e=Object(f.f)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}intersectionDistance(e,t){if(!this.available)return null;const i=Object(o.j)(e,D),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Object(p.j)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,V),c=n*this.screenLocation.pixelSize,l=Object(M.b)(this.camera,i,I);if(Object(s.j)(l))return null;for(const i of e){if(0===i.length)continue;const e=Object(f.q)(k,i[0],r);for(let t=1;t<i.length;t++){const n=Object(f.q)(G,i[t],r),s=Object(O.b)(Object(O.f)(e,n,R),l);if(null!=s&&s<c*c){const t=Object(f.f)(j.d.get(),e,n);Object(f.e)(t,t,.5);const i=Object(o.a)(j.d.get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(f.k)(e,n)}}break}case"disc":{var c;const e=this.collisionType.direction,t=null!=(c=this.collisionType.offset)?c:b.b,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,V),h=n*this.screenLocation.pixelSize,u=Object(M.b)(this.camera,i,I);if(Object(s.j)(u))return null;const d=Object(l.f)(z,o),p=Object(f.x)(B,e,d),g=Object(f.q)(N,t,o);Object(y.g)(g,p,F);const m=U;if(Object(y.m)(F,u,m)&&Object(f.l)(m,g)<h*h)return this.screenLocation.renderScreenPointArray[2]+a;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(r,V),h=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),u=Object(M.b)(this.camera,i,I);if(Object(s.j)(u))return null;const d=Object(l.f)(z,c),p=Object(f.x)(B,t,d),b=this._calculateModelTransformPosition(N);Object(y.g)(b,p,F);const g=U;if(!Object(y.m)(F,u,g))break;for(const i of e){if(0===i.length)continue;const e=Object(f.q)(k,i[0],c);for(let t=1;t<i.length;t++){const r=Object(f.q)(G,i[t],c),n=Object(O.e)(Object(O.f)(e,r,R),g);if(null!=n&&n<h*h){const t=Object(f.f)(j.d.get(),e,r);Object(f.e)(t,t,.5);const i=Object(o.a)(j.d.get());return this.camera.projectToRenderScreen(t,i),i[2]+a}Object(f.k)(e,r)}}break}default:Object(r.a)(this.collisionType)}return null}attach(e={manipulator3D:{}}){var t;if(!this.view._stage)return;const i=e.manipulator3D;if(Object(s.j)(i.engineLayerId)){const e=new T.a({isPickable:!1,updatePolicy:1});this.view._stage.add(e),i.engineLayerId=e.id,this._engineLayer=e}else null!=(t=this.view._stage)&&t.getObject&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,Object(s.j)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Object(g.b)(this._location.spatialReference,this.view.spatialReference)||(this.location=new P.a({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){Object(g.p)(this.location,q,e.spatialReference),Object(v.h)(e.extent,q)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(Object(s.j)(this.elevationInfo))return!1;let t=null,i=0;const r=Object(s.t)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=Object(s.t)(Object(w.b)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=Object(s.t)(Object(w.b)(this.view.elevationProvider,e,"ground"),0)+r;break;case"relative-to-scene":i=Object(s.t)(Object(w.b)(this.view.elevationProvider,e,"scene"),0)+r;break;case"absolute-height":i=r}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=V;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?2:1)|(this.selected?8:4),n=this._noDisplayCount>0;for(const{stateMask:a,objects:s}of i){if(n){for(const e of s)e.setVisible(!1);continue}const e=!(0!=(15&a))||(r&a)==(15&a),i=!(0!=(65520&a))||(this.state&a)==(65520&a);if(e&&i)for(const r of s)r.setVisible(!0),r.transformation=t;else for(const t of s)t.setVisible(!1)}}_ensureEngineResources(){if(Object(s.j)(this._engineResources)){const e=Object(s.s)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((({material:e})=>{i.has(e)||(t.push(e),i.add(e))}));const r=(e,t)=>{const{geometry:i,material:r,transform:n}=t;Array.isArray(i)?i.forEach((t=>e.addGeometry(t,r,n))):e.addGeometry(i,r,n)},n=new Map;this._renderObjects.forEach((e=>{const t=new E.a({castShadow:!1});r(t,e);const i=e.stateMask||0,a=n.get(i)||[];a.push(t),n.set(i,a)}));const a=[];n.forEach(((e,t)=>a.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:e,layer:t,materials:i}=this._engineResources;i.forEach((e=>{const t=Object(s.s)(this._materialIdReferences),i=t.get(e.id)||0;0===i&&this.view._stage.add(e),t.set(e.id,i+1)})),e.forEach((({objects:e})=>{t.addMany(e),this.view._stage.addMany(e)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||Object(s.j)(this._engineResources))return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;t.forEach((({objects:e})=>{i.removeMany(e),this.view._stage.removeMany(e)})),r.forEach((e=>{const t=Object(s.s)(this._materialIdReferences),i=t.get(e.id);1===i?(this.view._stage.remove(e),t.delete(e.id)):t.set(e.id,i-1)})),e&&this.view._stage.remove(i),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,L);return Object(f.w)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return Object(f.j)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return Object(u.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Object(u.n)(t,t,this._worldFrame),Object(u.n)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,Object(s.k)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(Object(s.k)(this._engineResources))for(const t in this._engineResources.objectsByState){const i=this._engineResources.objectsByState[t];for(const t of i.objects)if(t.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function C(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const D=Object(o.g)(),R=Object(O.d)(),I=Object(_.c)(),z=Object(h.b)(),L=Object(d.d)(),V=Object(d.d)(),F=Object(y.d)(),k=Object(b.e)(),G=Object(b.e)(),U=Object(b.e)(),B=Object(b.e)(),N=Object(b.e)(),H=Object(b.e)(),q=new P.a({x:0,y:0,z:0,spatialReference:null})},578:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(113);function n(e){const t=e.fragment.code;t.add(r.a`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(r.a`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(r.a`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var a=i(573);function s(e,t){const i=e.fragment.code;e.include(a.a),3===t.pbrMode||4===t.pbrMode?(i.add(r.a`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(r.a`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(r.a`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(r.a`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(r.a`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):1!==t.pbrMode&&2!==t.pbrMode||(e.include(n),i.add(r.a`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(r.a`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(r.a`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(r.a`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(r.a`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(r.a`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},590:function(e,t,i){"use strict";function r(e,t=0){const i=e.stride;return e.fieldNames.filter((t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)})).map((r=>{const a=e.fields.get(r),s=a.constructor.ElementCount,o=n(a.constructor.ElementType),c=a.offset,l=!(!a.optional||!a.optional.glNormalized);return{name:r,stride:i,count:s,type:o,offset:c,normalized:l,divisor:t}}))}function n(e){const t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}i.d(t,"a",(function(){return r}));const a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},593:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return g})),i.d(t,"e",(function(){return b}));var r=i(393),n=i(135),a=i(111),s=i(101),o=i(226),c=i(221),l=i(653),h=i(333),u=i(261);function d(e){return e?[Object(h.d)(e[0]),Object(h.d)(e[1]),Object(h.d)(e[2]),Object(h.d)(e[3]),Object(h.d)(e[4]),Object(h.d)(e[5])]:[Object(h.d)(),Object(h.d)(),Object(h.d)(),Object(h.d)(),Object(h.d)(),Object(h.d)()]}function p(e,t=d()){for(let i=0;i<6;i++)Object(h.c)(e[i],t[i])}function f(e,t,i,r=v){const s=Object(n.n)(u.a.get(),t,e);Object(n.c)(s,s);for(let n=0;n<8;++n){const e=Object(o.m)(u.e.get(),m[n],s);Object(a.w)(r[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}!function(e,t){Object(h.f)(t[4],t[0],t[3],e[0]),Object(h.f)(t[1],t[5],t[6],e[1]),Object(h.f)(t[4],t[5],t[1],e[2]),Object(h.f)(t[3],t[2],t[6],e[3]),Object(h.f)(t[0],t[1],t[2],e[4]),Object(h.f)(t[5],t[4],t[7],e[5])}(i,r)}function b(e,t){for(let i=0;i<6;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function g(e,t){for(let i=0;i<6;i++){const r=e[i];if(!Object(h.b)(r,t))return!1}return!0}const m=[Object(c.g)(-1,-1,-1,1),Object(c.g)(1,-1,-1,1),Object(c.g)(1,1,-1,1),Object(c.g)(-1,1,-1,1),Object(c.g)(-1,-1,1,1),Object(c.g)(1,-1,1,1),Object(c.g)(1,1,1,1),Object(c.g)(-1,1,1,1)],v=(new r.a(l.a),[Object(s.e)(),Object(s.e)(),Object(s.e)(),Object(s.e)(),Object(s.e)(),Object(s.e)(),Object(s.e)(),Object(s.e)()])},597:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var r=i(122),n=i(117),a=i(85),s=i(180),o=i(465);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var l=i(750);class h extends o.a{constructor(e,t=""){var i,a,o;super(),this.apiLayerUid=t,this.type=0,this.events=new r.a,this.isSliceable=!1,this._objects=new s.a,this._stageHandles=new n.a,this.apiLayerUid=t,this.isVisible=null==(i=null==e?void 0:e.isVisible)||i,this.isPickable=null==(a=null==e?void 0:e.isPickable)||a,this.updatePolicy=null!=(o=null==e?void 0:e.updatePolicy)?o:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of c)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),Object(a.k)(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),Object(a.k)(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),Object(a.k)(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),Object(a.k)(this._octree)&&this._octree.remove(t)}}sync(){Object(a.k)(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){Object(a.k)(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return Object(a.j)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Object(a.e)(this._octree)}_createOctree(){this._octree=new l.a((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}},610:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a}));const r=e=>class extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const i=this[t];this[t]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class n extends(r(class{})){}function a(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}}},611:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s}));var r=i(409),n=i(514);const a=Object(r.a)().vec3f("position"),s=Object(r.a)().vec3f("position").vec2f("uv0"),o=Object(r.a)().vec3f("position").vec4u8("color");class c{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){Object(n.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}},613:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l}));var r=i(327);const n=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],a=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];var s=i(212),o=i(179),c=i(216);function l(e,t=n,i=r.a,o=-1,l=1){let h=null;switch(t){case a:h=new Float32Array([o,o,0,0,l,o,1,0,o,l,0,1,l,l,1,1]);break;case n:default:h=new Float32Array([o,o,l,o,o,l,l,l])}return new c.a(e,i,{geometry:t},{geometry:s.a.createVertex(e,35044,h)})}function h(e){return new o.a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}},623:function(e,t,i){"use strict";function r(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function n(e,t,i,n){for(let o=0;o<n;++o)a[0]=e[o],r(a,s,1),t[o]=s[0],i[o]=s[1]}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return n}));const a=new Float64Array(1),s=new Float32Array(2)},624:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(85),n=i(135),a=i(168),s=i(685),o=i(468),c=i(597);class l extends s.a{constructor(e){super(e.view),this._resources=null,this._transform=Object(a.d)()}get object(){return Object(r.k)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Object(n.f)(this._transform,e),Object(r.k)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(Object(r.j)(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new c.a({isPickable:!1,updatePolicy:1});e.add(t);const i=new o.a({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!Object(r.j)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){Object(r.j)(this._resources)||this._resources.object.setVisible(e)}}},625:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return s}));var r=i(85),n=i(657);class a{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function s(e){return"array"in e}function o(e,t,i="ground"){if(Object(n.a)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(s(t)){let n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,Object(r.t)(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},626:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(638),n=i(113);function a(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(r.a),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(n.a`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?n.a`vec3 worldNormal = normalize(worldPos + localOrigin);`:n.a`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?n.a`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:n.a`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(n.a`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function s(e,t,i){if(!t.verticalOffset)return;const r=o(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),n=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",r.screenLength*n,r.perDistance,r.minWorldLength,r.maxWorldLength)}function o(e,t,i,r=c){return r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*i),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}const c={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},627:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return O})),i.d(t,"c",(function(){return v}));var r=i(85),n=i(289),a=i(304),s=i(135),o=i(168),c=i(485),l=i(384),h=i(111),u=i(505),d=i(101),p=i(221),f=i(430);class b{constructor(){this._transform=Object(o.d)(),this._transformInverse=new g({value:this._transform},s.c,o.d),this._transformInverseTranspose=new g(this._transformInverse,s.b,o.d),this._transformTranspose=new g({value:this._transform},s.b,o.d),this._transformInverseRotation=new g({value:this._transform},n.j,a.b)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Object(s.f)(this._transform,e)}multiplyTransform(e){Object(s.n)(this._transform,this._transform,e)}set(e){Object(s.f)(this._transform,e),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()}}class g{constructor(e,t,i){this.original=e,this.update=t,this.dirty=!0,this.transform=i()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const m=new class{constructor(e=0){this.offset=e,this.sphere=Object(f.b)(),this.tmpVertex=Object(d.e)()}applyToVertex(e,t,i){const r=this.objectTransform.transform;let n=r[0]*e+r[4]*t+r[8]*i+r[12],a=r[1]*e+r[5]*t+r[9]*i+r[13],s=r[2]*e+r[6]*t+r[10]*i+r[14];const o=this.offset/Math.sqrt(n*n+a*a+s*s);n+=n*o,a+=a*o,s+=s*o;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*a+c[8]*s+c[12],this.tmpVertex[1]=c[1]*n+c[5]*a+c[9]*s+c[13],this.tmpVertex[2]=c[2]*n+c[6]*a+c[10]*s+c[14],this.tmpVertex}applyToMinMax(e,t){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}};function v(e){return Object(r.k)(e)?(m.offset=e,m):null}new class{constructor(e=0){this.offset=e,this.componentLocalOriginLength=0,this.tmpVertex=Object(d.e)(),this.mbs=Object(p.e)(),this.obb={center:Object(d.e)(),halfSize:Object(u.b)(),quaternion:null}}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,t,i){const r=e,n=t,a=i+this.componentLocalOriginLength,s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){const t=e[0],i=e[1],r=e[2]+this.componentLocalOriginLength,n=e[3],a=e[4],s=e[5]+this.componentLocalOriginLength,o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(n*n+a*a+s*s);return e[3]+=n*c,e[4]+=a*c,e[5]+=s*c,e}applyToMbs(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/t;return this.mbs[0]=e[0]+e[0]*i,this.mbs[1]=e[1]+e[1]*i,this.mbs[2]=e[2]+e[2]*i,this.mbs[3]=e[3]+e[3]*this.offset/t,this.mbs}applyToObb(e){const t=e.center,i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.obb.center[0]=t[0]+t[0]*i,this.obb.center[1]=t[1]+t[1]*i,this.obb.center[2]=t[2]+t[2]*i,Object(h.u)(this.obb.halfSize,e.halfSize,e.quaternion),Object(h.f)(this.obb.halfSize,this.obb.halfSize,e.center);const r=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*r,this.obb.halfSize[1]+=this.obb.halfSize[1]*r,this.obb.halfSize[2]+=this.obb.halfSize[2]*r,Object(h.j)(this.obb.halfSize,this.obb.halfSize,e.center),Object(c.a)(y,e.quaternion),Object(h.u)(this.obb.halfSize,this.obb.halfSize,y),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=e.quaternion,this.obb}};new class{constructor(e=0){this.offset=e,this.tmpVertex=Object(d.e)()}applyToVertex(e,t,i){const r=e+this.localOrigin[0],n=t+this.localOrigin[1],a=i+this.localOrigin[2],s=this.offset/Math.sqrt(r*r+n*n+a*a);return this.tmpVertex[0]=e+r*s,this.tmpVertex[1]=t+n*s,this.tmpVertex[2]=i+a*s,this.tmpVertex}applyToAabb(e){const t=e[0]+this.localOrigin[0],i=e[1]+this.localOrigin[1],r=e[2]+this.localOrigin[2],n=e[3]+this.localOrigin[0],a=e[4]+this.localOrigin[1],s=e[5]+this.localOrigin[2],o=this.offset/Math.sqrt(t*t+i*i+r*r);e[0]+=t*o,e[1]+=i*o,e[2]+=r*o;const c=this.offset/Math.sqrt(n*n+a*a+s*s);return e[3]+=n*c,e[4]+=a*c,e[5]+=s*c,e}};const O="terrain",y=Object(l.b)()},629:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i(410),n=i(375),a=i(362),s=i(611),o=i(348),c=i(81),l=i(256),h=i(319),u=i(278),d=i(394),p=i(325),f=i(334),b=i(341),g=i(327),m=i(326),v=i(532),O=i(720),y=i(174);class _ extends f.a{initializeProgram(e){const t=_.shader.get(),i=this.configuration,r=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new m.a(e.rctx,r,g.a)}bindPass(e,t){Object(d.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&Object(h.b)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(u.a)(this.program,t))}bindDraw(e){Object(d.d)(this.program,e),this.program.rebindTextures(),Object(l.c)(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,r=3===e,n=2===e;return Object(y.f)({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?a.f:Object(a.a)(e),culling:Object(y.b)(i.cullFace),depthTest:{func:Object(a.b)(e)},depthWrite:r||n?i.writeDepth&&y.d:null,colorWrite:y.c,stencilWrite:i.sceneHasOcludees?v.h:null,stencilTest:i.sceneHasOcludees?t?v.d:v.c:null,polygonOffset:r||n?i.polygonOffset&&j:Object(a.g)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}_.shader=new p.a(O.a,(()=>i.e(305).then(i.bind(null,1302))));const j={factor:1,units:1};class x extends b.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(c.a)([Object(b.b)({count:8})],x.prototype,"output",void 0),Object(c.a)([Object(b.b)({count:3})],x.prototype,"cullFace",void 0),Object(c.a)([Object(b.b)()],x.prototype,"slicePlaneEnabled",void 0),Object(c.a)([Object(b.b)()],x.prototype,"vertexColors",void 0),Object(c.a)([Object(b.b)()],x.prototype,"transparent",void 0),Object(c.a)([Object(b.b)()],x.prototype,"polygonOffset",void 0),Object(c.a)([Object(b.b)()],x.prototype,"enableOffset",void 0),Object(c.a)([Object(b.b)()],x.prototype,"writeDepth",void 0),Object(c.a)([Object(b.b)()],x.prototype,"sceneHasOcludees",void 0),Object(c.a)([Object(b.b)({count:4})],x.prototype,"transparencyPassType",void 0),Object(c.a)([Object(b.b)()],x.prototype,"multipassTerrainEnabled",void 0),Object(c.a)([Object(b.b)()],x.prototype,"cullAboveGround",void 0);class w extends n.a{constructor(e){super(e,S),this.supportsEdges=!0,this.techniqueConfig=new x}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<a.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,r,n,a,s){Object(o.f)(e,t,r,n,a,void 0,s)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new M(e):void 0}createBufferWriter(){return new s.a(s.b)}}class M extends r.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(_,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 23===e||(4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3))}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const S={color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...n.b}},630:function(e,t,i){"use strict";function r(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,"a",(function(){return r}))},634:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return s}));i(79);function r(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:return}}function n(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function a(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function s(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}},636:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(103),n=i(85);class a{constructor(){this._isToolEditable=!0,this._manipulators=new r.a,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){return this.addMany([e],t)[0]}addMany(e,t=0){return e.map((e=>{const i=this._nextManipulatorId++,r={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r),i}))}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this._manipulators.forEach((({manipulator:e})=>{e.destroy&&e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,r=Number.MAX_VALUE;return this._manipulators.forEach((({id:a,manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const c=s.intersectionDistance(e,t);Object(n.k)(c)&&c<r&&(r=c,i={id:a,manipulator:s})})),i}findById(e){if(Object(n.j)(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}},637:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(r.a`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}},638:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(113),n=i(348);function a(e){e.vertex.code.add(r.a`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(r.a`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(r.a`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(r.a`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(r.a`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(r.a`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`),e.vertex.code.add(r.a`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function s(e,t){if(t.screenSizePerspective){Object(n.a)(t.screenSizePerspective,e,"screenSizePerspective");const i=t.screenSizePerspectiveAlignment||t.screenSizePerspective;Object(n.a)(i,e,"screenSizePerspectiveAlignment")}}},639:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(81),n=i(91),a=i(83),s=(i(79),i(84),i(80),i(82));let o=class extends n.a{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.SCENEVIEW_LOCKING_LOG=!1,this.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,this.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_UPDATE_THRESHOLDS=!1,this.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,this.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.ENABLE_PROFILE_DEPTH_RANGE=!1,this.DISABLE_FAST_UPDATES=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1}};Object(r.a)([Object(a.b)()],o.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),Object(r.a)([Object(a.b)()],o.prototype,"SCENEVIEW_LOCKING_LOG",void 0),Object(r.a)([Object(a.b)()],o.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),Object(r.a)([Object(a.b)()],o.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DECONFLICTOR_SHOW_GRID",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LABELS_SHOW_BORDER",void 0),Object(r.a)([Object(a.b)()],o.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"OVERLAY_SHOW_CENTER",void 0),Object(r.a)([Object(a.b)()],o.prototype,"SHOW_POI",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"I3S_TREE_SHOW_TILES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"I3S_SHOW_MODIFICATIONS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),Object(r.a)([Object(a.b)()],o.prototype,"DISABLE_FAST_UPDATES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),Object(r.a)([Object(a.b)()],o.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),Object(r.a)([Object(a.b)()],o.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),o=Object(r.a)([Object(s.a)("esri.views.3d.support.DebugFlags")],o);const c=new o},640:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var r=i(135),n=i(168),a=i(111),s=i(101),o=i(226),c=i(221),l=(i(641),i(284)),h=i(468);class u{constructor(){this.min=new d,this.max=new d,this.hud=new d,this.ground=new d}init(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.ground.init(e),this.all=[]}}class d{constructor(e){this.normal=Object(s.e)(),this.transformation=Object(n.d)(),this._ray=Object(l.c)(),this.init(e)}get ray(){return this._ray}get hasIntersectionPoint(){return null!=this.dist}get distanceInRenderSpace(){if(null!=this.dist)return Object(a.e)(p,this.ray.direction,this.dist),Object(a.p)(p)}getIntersectionPoint(e){return!!this.hasIntersectionPoint&&(Object(a.e)(p,this.ray.direction,this.dist),Object(a.f)(e,this.ray.origin,p),!0)}getTransformedNormal(e){return Object(a.k)(f,this.normal),f[3]=0,Object(o.m)(f,f,this.transformation),Object(a.k)(e,f),Object(a.r)(e,e),e}init(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?Object(l.b)(e,this._ray):this._ray=Object(l.c)()}set(e,t,i,n,o,c,l,u,d,p){e instanceof h.a&&(e={type:"stage",obj:e}),this.dist=i,Object(a.k)(this.normal,n),Object(r.f)(this.transformation,o),this.target=e,this.name=t,this.drapedLayerOrder=c,this.center=l?Object(s.c)(l):null,this.geometryId=u,this.triangleNr=d,this.drapedLayerGraphicOrder=p}copyFrom(e){Object(l.b)(e.ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?Object(s.c)(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,Object(a.k)(this.normal,e.normal),Object(r.f)(this.transformation,e.transformation)}}Object(s.e)();const p=Object(s.e)(),f=Object(c.e)()},641:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return m})),i.d(t,"c",(function(){return P})),i.d(t,"d",(function(){return v})),i.d(t,"e",(function(){return T})),i.d(t,"f",(function(){return _})),i.d(t,"g",(function(){return j})),i.d(t,"h",(function(){return D})),i.d(t,"i",(function(){return C})),i.d(t,"j",(function(){return O}));i(79);var r=i(80),n=i(107),a=i(393),s=i(135),o=i(168),c=i(111),l=i(101),h=i(401),u=i(333),d=i(284),p=i(464),f=i(261);const b=r.a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function g(e=V){return{plane:Object(u.d)(e.plane),origin:Object(l.c)(e.origin),basis1:Object(l.c)(e.basis1),basis2:Object(l.c)(e.basis2)}}function m(e,t=g()){return v(e.origin,e.basis1,e.basis2,t)}function v(e,t,i,r=g()){return Object(c.k)(r.origin,e),Object(c.k)(r.basis1,t),Object(c.k)(r.basis2,i),O(r),function(e,t){Math.abs(Object(c.h)(e.basis1,e.basis2)/(Object(c.p)(e.basis1)*Object(c.p)(e.basis2)))>1e-6&&b.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Object(c.h)(e.basis1,D(e)))>1e-6&&b.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Object(c.h)(D(e),e.origin)-e.plane[3])>1e-6&&b.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function O(e){Object(u.i)(e.basis2,e.basis1,e.origin,e.plane)}function y(e,t,i){e!==i&&m(e,i);const r=Object(c.e)(f.d.get(),D(e),t);return Object(c.f)(i.origin,i.origin,r),i.plane[3]-=t,i}function _(e,t=g()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return Object(c.w)(t.origin,e[0]+i,e[1]+r,0),Object(c.w)(t.basis1,i,0,0),Object(c.w)(t.basis2,0,r,0),Object(u.h)(0,0,1,0,t.plane),t}function j(e,t,i){return!!Object(u.m)(e.plane,t,i)&&R(e,i)}function x(e,t,i){const r=F.get();L(e,t,r,F.get());let a=Number.POSITIVE_INFINITY;for(const s of B){const o=z(e,s,k.get()),l=f.d.get();if(Object(u.k)(r,o,l)){const e=Object(c.v)(f.d.get(),t.origin,l),r=Math.abs(Object(n.b)(Object(c.h)(t.direction,e)));r<a&&(a=r,Object(c.k)(i,l))}}return a===Number.POSITIVE_INFINITY?w(e,t,i):i}function w(e,t,i){if(j(e,t,i))return i;const r=F.get(),n=F.get();L(e,t,r,n);let a=Number.POSITIVE_INFINITY;for(const s of B){const o=z(e,s,k.get()),l=f.d.get();if(Object(u.l)(r,o,l)){const e=Object(d.d)(t,l);if(!Object(u.o)(n,l))continue;e<a&&(a=e,Object(c.k)(i,l))}}return E(e,t.origin)<a&&M(e,t.origin,i),i}function M(e,t,i){const r=Object(u.r)(e.plane,t,f.d.get()),n=Object(h.i)(I(e,e.basis1),r,-1,1,f.d.get()),a=Object(h.i)(I(e,e.basis2),r,-1,1,f.d.get());return Object(c.j)(i,Object(c.f)(f.d.get(),n,a),e.origin),i}function S(e,t,i){const{origin:r,basis1:n,basis2:a}=e,s=Object(c.j)(f.d.get(),t,r),o=Object(p.d)(n,s),l=Object(p.d)(a,s),h=Object(p.d)(D(e),s);return Object(c.w)(i,o,l,h)}function E(e,t){const i=S(e,t,f.d.get()),{basis1:r,basis2:n}=e,a=Object(c.p)(r),s=Object(c.p)(n),o=Math.max(Math.abs(i[0])-a,0),l=Math.max(Math.abs(i[1])-s,0),h=i[2];return o*o+l*l+h*h}function T(e,t){return Math.sqrt(E(e,t))}function P(e,t){return Object(u.o)(e.plane,t)&&R(e,t)}function A(e,t){const i=-e.plane[3];return Object(p.d)(D(e),t)-i}function C(e,t,i,r){return e!==r&&m(e,r),Object(s.e)(H,Object(s.j)(H),t,i),Object(c.q)(r.basis1,e.basis1,H),Object(c.q)(r.basis2,e.basis2,H),O(r),r}function D(e){return Object(u.q)(e.plane)}function R(e,t){const i=Object(c.j)(f.d.get(),t,e.origin),r=Object(c.t)(e.basis1),n=Object(c.t)(e.basis2),a=Object(c.h)(e.basis1,i),s=Object(c.h)(e.basis2,i);return-a-r<0&&a-r<0&&-s-n<0&&s-n<0}function I(e,t){const i=k.get();return Object(c.k)(i.origin,e.origin),Object(c.k)(i.vector,t),i}function z(e,t,i){const{basis1:r,basis2:n,origin:a}=e,s=Object(c.e)(f.d.get(),r,t.origin[0]),o=Object(c.e)(f.d.get(),n,t.origin[1]);Object(c.f)(i.origin,s,o),Object(c.f)(i.origin,i.origin,a);const l=Object(c.e)(f.d.get(),r,t.direction[0]),h=Object(c.e)(f.d.get(),n,t.direction[1]);return Object(c.e)(i.vector,Object(c.f)(l,l,h),2),i}function L(e,t,i,r){const n=D(e);Object(u.i)(n,t.direction,t.origin,i),Object(u.i)(Object(u.q)(i),n,t.origin,r)}const V={plane:Object(u.d)(),origin:Object(l.g)(0,0,0),basis1:Object(l.g)(1,0,0),basis2:Object(l.g)(0,1,0)},F=new a.a(u.d),k=new a.a(h.d),G=Object(l.e)(),U=new a.a((()=>({origin:null,basis1:null,basis2:null,plane:null}))),B=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],N=Object(o.d)(),H=Object(o.d)();Object.freeze({__proto__:null,BoundedPlaneClass:class{constructor(){this.plane=Object(u.d)(),this.origin=Object(l.e)(),this.basis1=Object(l.e)(),this.basis2=Object(l.e)()}},create:g,wrap:function(e,t,i){const r=U.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=Object(u.u)(0,0,0,0),O(r),r},copy:m,copyWithoutVerify:function(e,t){Object(c.k)(t.origin,e.origin),Object(c.k)(t.basis1,e.basis1),Object(c.k)(t.basis2,e.basis2),Object(u.c)(e.plane,t.plane)},fromValues:v,updateUnboundedPlane:O,elevate:y,setExtent:function(e,t,i){return _(t,i),y(i,A(e,e.origin),i),i},fromAABoundingRect:_,intersectRay:j,intersectRayClosestSilhouette:function(e,t,i){if(j(e,t,i))return i;const r=x(e,t,f.d.get());return Object(c.f)(i,t.origin,Object(c.e)(f.d.get(),t.direction,Object(c.m)(t.origin,r)/Object(c.p)(t.direction))),i},closestPointOnSilhouette:x,closestPoint:w,projectPoint:M,projectPointLocal:S,distance2:E,distance:T,distanceToSilhouette:function(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of B){const n=z(e,r,k.get()),a=Object(h.e)(n,t);a>i&&(i=a)}return Math.sqrt(i)},extrusionContainsPoint:P,axisAt:function(e,t,i,r){return function(e,t,i){switch(t){case 0:Object(c.k)(i,e.basis1),Object(c.r)(i,i);break;case 1:Object(c.k)(i,e.basis2),Object(c.r)(i,i);break;case 2:Object(c.k)(i,D(e))}return i}(e,i,r)},altitudeAt:A,setAltitudeAt:function(e,t,i,r){const n=A(e,t),a=Object(c.e)(G,D(e),i-n);return Object(c.f)(r,t,a),r},equals:function(e,t){return Object(c.o)(e.basis1,t.basis1)&&Object(c.o)(e.basis2,t.basis2)&&Object(c.o)(e.origin,t.origin)},transform:function(e,t,i){return e!==i&&m(e,i),Object(s.c)(N,t),Object(s.b)(N,N),Object(c.q)(i.basis1,e.basis1,N),Object(c.q)(i.basis2,e.basis2,N),Object(c.q)(Object(u.q)(i.plane),Object(u.q)(e.plane),N),Object(c.q)(i.origin,e.origin,t),Object(u.s)(i.plane,i.origin,i.plane),i},rotate:C,normal:D,UP:V})},642:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(659),n=i(113);function a(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(r.b),e.fragment.code.add(n.a`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function s(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},643:function(e,t,i){"use strict";i.d(t,"a",(function(){return M})),i.d(t,"b",(function(){return S})),i.d(t,"c",(function(){return E})),i.d(t,"d",(function(){return _})),i.d(t,"e",(function(){return x})),i.d(t,"f",(function(){return j})),i.d(t,"g",(function(){return v})),i.d(t,"h",(function(){return O})),i.d(t,"i",(function(){return w}));var r=i(107),n=i(85),a=i(102),s=i(111),o=i(101),c=i(178),l=i(333),h=i(284),u=i(464),d=i(261),p=i(338),f=i(688),b=i(736),g=i(627),m=i(400);function v(e,t){return y(e,(()=>t))}function O(e){return y(e,(e=>e.plane))}function y(e,t){const i=Object(o.e)(),r=Object(o.e)();let s=!1;return o=>{const c=t(o);if("start"===o.action){const t=Object(a.j)(o.screenStart,Object(a.c)(d.c.get())),r=Object(f.b)(e.state.camera,t,A);Object(n.k)(r)&&(s=Object(l.m)(c,r,i))}if(!s)return null;const h=Object(a.j)(o.screenEnd,Object(a.c)(d.c.get())),u=Object(f.b)(e.state.camera,h,A);return Object(n.j)(u)?null:Object(l.m)(c,u,r)?{...o,renderStart:i,renderEnd:r,plane:c,ray:u}:null}}function _(e,t,i,r=null,s=null){return function(e,t,i,r=null,s=null){let o=null;return l=>{if("start"===l.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(a.g)(l.screenStart.x,l.screenStart.y),t,i,s),Object(n.k)(o)&&Object(n.k)(r)&&!Object(c.p)(o,o,r)))return null;if(Object(n.j)(o))return null;const h=e.sceneIntersectionHelper.intersectElevationFromScreen(Object(a.g)(l.screenEnd.x,l.screenEnd.y),t,i,s);return Object(n.k)(h)?Object(n.k)(r)&&!Object(c.p)(h,h,r)?null:{...l,mapStart:o,mapEnd:h}:null}}(e,i,Object(p.g)(t,e,i),r,s)}function j(e,t,i,r=null,n=null){return _(e,i,Object(p.e)(t),r,n)}function x(e,t,i,r){const a=t.toMap(e.screenStart,{include:[i]});return Object(n.k)(a)?j(t,i,a,r):null}function w(e,t,i){let n=null;const a=new m.a;return a.next(v(e,function(e,t){const i=T,r=P,n=Object(l.d)();e.renderCoordsHelper.worldUpAtPosition(t,i);const a=Object(s.g)(n,i,Object(s.j)(r,t,e.state.camera.eye));return Object(s.g)(a,a,i),Object(l.g)(t,a,n)}(e,t))).next(function(e,t){const i=Object(o.e)(),n=Object(s.p)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);const a=Object(o.e)(),c=Object(o.e)(),l=a=>(Object(s.j)(a,a,t),Object(u.c)(i,a,a),"global"===e.viewingMode&&Object(s.p)(a)*Object(r.t)(Object(s.h)(i,a))<.001-n&&Object(s.j)(a,Object(s.e)(a,i,.001),t),Object(s.f)(a,a,t),a);return e=>(e.renderStart=l(Object(s.k)(a,e.renderStart)),e.renderEnd=l(Object(s.k)(c,e.renderEnd)),e)}(e,t)).next(M(e,i)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),e=>(n=null,a.execute(e),n)}function M(e,t){const i=e.renderCoordsHelper;return e=>{const r=i.fromRenderCoords(e.renderStart,t),a=i.fromRenderCoords(e.renderEnd,t);return Object(n.k)(r)&&Object(n.k)(a)?{...e,mapStart:r,mapEnd:a}:null}}function S(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":Object(n.k)(t)&&(t.remove(),t=null)}return i}}function E(e,t=null){const i=new b.a(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=0,i.options.hud=!1;const r=Object(a.g)(),s={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},c=Object(o.e)(),l=Object(n.t)(t,e.spatialReference),h=t=>{e.map.ground&&e.map.ground.opacity<1?s.exclude.add(g.b):s.exclude.delete(g.b),e.sceneIntersectionHelper.intersectIntersectorScreen(Object(a.j)(t,r),i,s);const n=i.results.min;let o;if(n.getIntersectionPoint(c))o="TerrainRenderer"===n.intersector?0:1;else{if(!i.results.ground.getIntersectionPoint(c))return null;o=0}return{location:e.renderCoordsHelper.fromRenderCoords(c,l),surfaceType:o}};let u;return e=>{if("start"===e.action){const t=h(e.screenStart);u=Object(n.k)(t)?t.location:null}if(Object(n.j)(u))return null;const t=h(e.screenEnd);return Object(n.k)(t)&&Object(n.k)(t.location)?{...e,mapStart:u,mapEnd:t.location,surfaceType:t.surfaceType}:null}}const T=Object(o.e)(),P=Object(o.e)(),A=Object(h.c)()},647:function(e,t,i){"use strict";function r(){return[1,0,0,1,0,0]}function n(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,create:r,clone:n,fromValues:function(e,t,i,r,n,a){return[e,t,i,r,n,a]},createView:function(e,t){return new Float64Array(e,t,6)}})},649:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(107);function n(e,t,i){var n;const l=e.byteLength/(4*t),h=new Uint32Array(e,0,l*t);let u=new Uint32Array(l);const d=null!=(n=null==i?void 0:i.minReduction)?n:0,p=(null==i?void 0:i.originalIndices)||null,f=p?p.length:0,b=(null==i?void 0:i.componentOffsets)||null;let g=0;if(b)for(let r=0;r<b.length-1;r++){const e=b[r+1]-b[r];e>g&&(g=e)}else g=l;const m=Math.floor(1.1*g)+1;(null==c||c.length<2*m)&&(c=new Uint32Array(Object(r.p)(2*m)));for(let r=0;r<2*m;r++)c[r]=0;let v=0;const O=!!b&&!!p,y=O?f:l,_=O?new Uint32Array(f):null,j=1.96;let x=0!==d?Math.ceil(4*j*j/(d*d)*d*(1-d)):y,w=1,M=b?b[1]:y;for(let r=0;r<y;r++){if(r===x){const e=1-v/r;if(e+j*Math.sqrt(e*(1-e)/r)<d)return null;x*=2}if(r===M){for(let e=0;e<2*m;e++)c[e]=0;if(p)for(let e=b[w-1];e<b[w];e++)_[e]=u[p[e]];M=b[++w]}const e=O?p[r]:r,i=e*t,n=o(h,i,t);let s=n%m,l=v;for(;0!==c[2*s+1];){if(c[2*s]===n){const e=c[2*s+1]-1;if(a(h,i,e*t,t)){l=u[e];break}}s++,s>=m&&(s-=m)}l===v&&(c[2*s]=n,c[2*s+1]=e+1,v++),u[e]=l}if(0!==d&&1-v/l<d)return null;if(O){for(let e=b[w-1];e<_.length;e++)_[e]=u[p[e]];u=_}const S=new Uint32Array(t*v);v=0;for(let r=0;r<y;r++)u[r]===v&&(s(h,(O?p[r]:r)*t,S,v*t,t),v++);if(p&&!O){const e=new Uint32Array(f);for(let t=0;t<e.length;t++)e[t]=u[p[t]];u=e}return{buffer:S.buffer,indices:u,uniqueCount:v}}function a(e,t,i,r){for(let n=0;n<r;n++)if(e[t+n]!==e[i+n])return!1;return!0}function s(e,t,i,r,n){for(let a=0;a<n;a++)i[r+a]=e[t+a]}function o(e,t,i){let r=0;for(let n=0;n<i;n++)r=e[t+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let c=null},652:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));const r=["freehand","hybrid","click"],n="click"},653:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return l}));var r=i(393),n=i(111),a=i(284);i(261);function s(e){return e?{ray:Object(a.c)(e.ray),c0:e.c0,c1:e.c1}:{ray:Object(a.c)(),c0:0,c1:Number.MAX_VALUE}}function o(e,t=s()){return Object(a.b)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c(e,t,i=s()){const r=Object(n.p)(e.vector);return Object(a.f)(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function l(e,t){return u(e,e.c0,t)}function h(e,t){return u(e,e.c1,t)}function u(e,t,i){return Object(n.f)(i,e.ray.origin,Object(n.e)(i,e.ray.direction,t))}new r.a((()=>({c0:0,c1:0,ray:null})))},654:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return l}));var r=i(107);function n(e,t,i){const r=i.parameters,n=i.paddingPixelsOverride;return h.scale=Math.min(r.divisor/(t-r.offset),1),h.factor=function(e){return Math.abs(e*e*e)}(e),h.minPixelSize=r.minPixelSize,h.paddingPixels=n,h}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(Object(r.m)(e*t.scale,e,t.factor),a(e,t))}function o(e,t,i,r){r.scale=function(e,t,i){const r=n(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,s(1,r)}(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function c(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function l(e,t,i,r){return s(e,n(t,i,r))}Object(r.h)(10),Object(r.h)(12),Object(r.h)(70),Object(r.h)(40);const h={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},655:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i(107),n=i(695),a=i(637),s=i(113),o=i(271);const c=Object(r.h)(6);function l(e){const t=new o.a;return t.extensions.add("GL_OES_standard_derivatives"),t.include(a.a),t.include(n.a,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(s.a`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.pointDistanceEnabled&&t.fragment.code.add(s.a`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.intersectsLineEnabled&&t.fragment.code.add(s.a`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(s.a`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.fragment.code.add(s.a`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled&&t.fragment.code.add(s.a`{
float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
color = max(color, heightManifoldColor * heightManifoldAlpha);
}`),e.pointDistanceEnabled&&t.fragment.code.add(s.a`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`),e.lineVerticalPlaneEnabled&&t.fragment.code.add(s.a`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`),e.intersectsLineEnabled&&t.fragment.code.add(s.a`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`),t.fragment.code.add(s.a`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}var h=Object.freeze({__proto__:null,defaultAngleCutoff:c,build:l})},656:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(431),n=i(113);function a(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){e.fragment.include(r.a),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),t.draped&&e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),t.draped?e.fragment.code.add(n.a`float getStippleValue() {
return rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUv * stipplePatternPixelSizeInv, 1.0), 0.5)));
}`):e.fragment.code.add(n.a`
      float getStippleValue() {
        float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
        ${t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}
        return rgba2float(texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)));
      }
    `),e.fragment.code.add(n.a`float getStippleSDF() {
return (getStippleValue() * 2.0 - 1.0) * stipplePatternSDFNormalizer;
}
float getStippleAlpha() {
return clamp(getStippleSDF() + 0.5, 0.0, 1.0);
}`),t.stippleOffColorEnabled?e.fragment.code.add(n.a`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(n.a`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(n.a`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}},657:function(e,t,i){"use strict";function r(e){return"point"===e.type}i.d(t,"a",(function(){return r}))},658:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(101);class n{constructor(e,t){this.vec3=e,this.id=t}}function a(e,t,i,a){return new n(Object(r.g)(e,t,i),a)}},659:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n}));var r=i(113);function n(e){e.fragment.code.add(r.a`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function a(e){e.fragment.code.add(r.a`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},660:function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return f})),i.d(t,"d",(function(){return b})),i.d(t,"e",(function(){return g})),i.d(t,"f",(function(){return O})),i.d(t,"g",(function(){return y}));var r=i(85),n=i(135),a=i(111),s=i(221),o=i(261),c=i(533),l=i(575),h=i(443),u=i(480),d=i(629),p=i(864);function f(e,t=4,i=!0){const r=Object(s.g)(e[0],e[1],e[2],e.length>3?e[3]:1),n=e[3]<1;return i?new p.a({color:r,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t}):new d.a({color:r,transparent:n,writeDepth:!0,cullFace:2,renderOccluded:t})}function b(e,t=4){const i=Object(s.g)(e[0],e[1],e[2],4===e.length?e[3]:1);return new d.a({color:i,transparent:!0,writeDepth:!0,cullFace:1,renderOccluded:t})}function g(e,t,i){return new l.a({view:e,renderObjects:[{geometry:u.a.createSphereGeometry(1,32,32),material:f(Object(s.g)(t[0],t[1],t[2],null!=i?i:1))}]})}function m(e,t,i,r){const s=Object(a.j)(o.d.get(),e,i),c=v(s,Object(a.g)(o.d.get(),r,s),i,o.a.get());Object(n.c)(c,c);const l=Object(a.q)(o.d.get(),t,c);return Math.atan2(l[1],l[0])}function v(e,t,i,r){const n=Object(a.r)(o.d.get(),e),s=Object(a.r)(o.d.get(),t),c=Object(a.g)(o.d.get(),n,s);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=s[0],r[5]=s[1],r[6]=s[2],r[7]=0,r[8]=c[0],r[9]=c[1],r[10]=c[2],r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function O(e,t){const i=e.getViewForGraphic(t);return Object(r.k)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function y(e,t,i){const n=O(e,i);Object(r.k)(n)?t.elevationAlignedLocation=n:function(e,t){if(Object(r.j)(t))return;const i="mesh"===t.type?t.anchor:Object(h.a)(t);Object(r.j)(i)||(e.location=Object(c.b)(i))}(t,i.geometry)}},661:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var r=i(81),n=i(91),a=i(122),s=i(85),o=i(102),c=i(83),l=(i(79),i(84),i(80),i(82)),h=i(146),u=i(111),d=i(101),p=i(178),f=i(338),b=i(255),g=i(282),m=i(531);let v=class extends n.a{constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new a.a.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(f.f)(this.graphic),i=e?e.offset:0;return new g.a({mode:t,offset:i})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(Object(s.j)(i))return null;const r=this._get("focusedSymbol"),n=Object(s.k)(r)?r:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,n):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),Object(s.k)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(s.k)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(e=>{Object(s.k)(e)&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&Object(s.k)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){Object(s.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(s.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,r){if(r=r||Object(b.h)(i),Object(s.j)(r))return null;let n=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==r.type)return Object(m.b)(t,i,e)?1:null;if(Object(s.j)(n)||!n.originalPoint.equals(i)){const t=i,a=e.spatialReference;if(Object(p.b)(t.spatialReference,a)){const e=Object(p.k)(t,a);n={originalPoint:t.clone(),mapPoint:e,radiusPx:Object(o.h)(r.size)},this._circleCollisionCache=n}}if(Object(s.k)(n)){const i=Object(o.j)(t,y),a=e.toScreen(n.mapPoint),s=n.radiusPx,c=a.x+Object(o.h)(r.xoffset),l=a.y-Object(o.h)(r.yoffset);return Object(h.j)(i,[c,l])<s*s?1:null}return null}_intersectDistance3D(e,t,i){const r=e.toMap(t,{include:[i]});return r&&Object(p.q)(r,O,e.renderSpatialReference)?Object(u.m)(O,e.state.camera.eye):null}};Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],v.prototype,"graphic",null),Object(r.a)([Object(c.b)({readOnly:!0})],v.prototype,"elevationInfo",null),Object(r.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],v.prototype,"view",void 0),Object(r.a)([Object(c.b)({value:null})],v.prototype,"focusedSymbol",null),Object(r.a)([Object(c.b)({constructOnly:!0})],v.prototype,"layer",void 0),Object(r.a)([Object(c.b)()],v.prototype,"interactive",void 0),Object(r.a)([Object(c.b)()],v.prototype,"selectable",void 0),Object(r.a)([Object(c.b)()],v.prototype,"grabbable",void 0),Object(r.a)([Object(c.b)({value:!1})],v.prototype,"grabbing",null),Object(r.a)([Object(c.b)()],v.prototype,"dragging",void 0),Object(r.a)([Object(c.b)()],v.prototype,"hovering",null),Object(r.a)([Object(c.b)({value:!1})],v.prototype,"selected",null),Object(r.a)([Object(c.b)()],v.prototype,"cursor",void 0),v=Object(r.a)([Object(l.a)("esri.views.interactive.GraphicManipulator")],v);const O=Object(d.e)(),y=Object(o.g)()},666:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var r=i(311),n=i(113);function a(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add(n.a`vec2 reprojectionCoordinate(vec3 projectionCoordinate)
{
vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
reprojectedCoord.xy /= reprojectedCoord.w;
return reprojectedCoord.xy * 0.5 + 0.5;
}`)}function s(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(r.a),e.include(a),e.fragment.code.add(n.a`
  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}function o(e,t){var i,r;t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),r=t,(i=e).bindTexture(r.lastFrameColorTexture,"lastFrameColorMap"),i.setUniformMatrix4fv("reprojectionMat",r.reprojectionMat),i.setUniformMatrix4fv("rpProjectionMat",r.camera.projectionMatrix))}},681:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i(440),n=i(264),a=i(649);function s(e){const t=o(e.rings,e.hasZ,1),i=[];let n=0,s=0;for(const a of t.polygons){const e=a.count,o=a.index,c=new Float64Array(t.position.buffer,3*o*t.position.BYTES_PER_ELEMENT,3*e),l=a.holeIndices.map((e=>e-o)),h=new Uint32Array(Object(r.a)(c,l,3));i.push({position:c,faces:h}),n+=c.length,s+=h.length}const c=function(e,t,i){if(1===e.length)return e[0];const r=new Float64Array(t),n=new Uint32Array(i);let a=0,s=0,o=0;for(const c of e){for(let e=0;e<c.position.length;e++)r[a++]=c.position[e];for(let e=0;e<c.faces.length;e++)n[s++]=c.faces[e]+o;o=a/3}return{position:r,faces:n}}(i,n,s),l=Object(a.a)(c.position.buffer,6,{originalIndices:c.faces});return c.position=new Float64Array(l.buffer),c.faces=l.indices,c}function o(e,t,i){const r=e.length,n=new Array(r),a=new Array(r),s=new Array(r);let o=0,h=0,u=0,d=0;for(let c=0;c<r;++c)d+=e[c].length;const p=new Float64Array(3*d);let f=0;for(let b=r-1;b>=0;b--){const d=e[b],g=1===i&&l(d);if(g&&1!==r)n[o++]=d;else{let e=d.length;for(let t=0;t<o;++t)e+=n[t].length;const i={index:f,pathLengths:new Array(o+1),count:e,holeIndices:new Array(o)};i.pathLengths[0]=d.length,d.length>0&&(s[u++]={index:f,count:d.length}),f=g?c(d,d.length-1,-1,p,f,d.length,t):c(d,0,1,p,f,d.length,t);for(let r=0;r<o;++r){const e=n[r];i.holeIndices[r]=f,i.pathLengths[r+1]=e.length,e.length>0&&(s[u++]={index:f,count:e.length}),f=c(e,0,1,p,f,e.length,t)}o=0,i.count>0&&(a[h++]=i)}}for(let l=0;l<o;++l){const e=n[l];e.length>0&&(s[u++]={index:f,count:e.length}),f=c(e,0,1,p,f,e.length,t)}return h<r&&(a.length=h),u<r&&(s.length=u),{position:p,polygons:a,outlines:s}}function c(e,t,i,r,n,a,s){n*=3;for(let o=0;o<a;++o){const a=e[t];r[n++]=a[0],r[n++]=a[1],r[n++]=s?a[2]:0,t+=i}return n/3}function l(e){return!Object(n.g)(e,!1,!1)}},684:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var r=i(85),n=i(89),a=i(399),s=i(400),o=i(609),c=i(456);class l{constructor(){this.next=new s.a}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:l,updatingHandles:h}){if(Object(r.j)(i))return e=>e;let u=null,d=null;const p=()=>{u=Object(r.a)(u),i.doneSnapping(),Object(r.k)(d)&&d.frameTask.remove(),d=null};return t.next((e=>(p(),e))),this.next=new s.a,t=>{if(!e(t))return t;if(u=Object(r.a)(u),"start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(c.b.SNAPPING):c.a;d={context:new o.a({editGeometryOperations:l.editGeometryOperations,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:Object(r.k)(t.info)?t.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:Object(r.k)(t.snapOrigin)?l.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(Object(r.k)(d)){const e=d.context.coordinateHelper.vectorToDehydratedPoint(d.context.coordinateHelper.arrayToVector([d.originalPos.x,d.originalPos.y,d.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const r=t.mapStart.x-d.originalPos.x,s=t.mapStart.y-d.originalPos.y,o={...t,action:"udpate"},c=d.context,l=i.update(e,d.context);if(t.mapEnd.x=l.x+r,t.mapEnd.y=l.y+s,"end"!==t.action){const t=d.frameTask;u=Object(n.h)((async n=>{const h=await t.schedule((()=>i.snap(e,c,n)),n);if(h.valid){const e=await t.schedule((()=>h.apply()),n);Object(a.a)(e,l)||(o.mapEnd.x=e.x+r,o.mapEnd.y=e.y+s,this.next.execute(o))}})),h.addPromise(u.promise)}}return"end"===t.action&&p(),t}}}},685:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));class r{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},686:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(234);class n{constructor(e){this.channel=e,this.id=Object(r.a)()}}},687:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e,t){1===t.viewingMode?e.vertex.code.add(r.a`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(r.a`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),1===t.viewingMode?e.vertex.code.add(r.a`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(r.a`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},688:function(e,t,i){"use strict";i.d(t,"a",(function(){return h})),i.d(t,"b",(function(){return l}));var r=i(85),n=i(102),a=i(146),s=i(111),o=i(284),c=i(261);function l(e,t,i=Object(o.c)()){return h(e,e.screenToRender(t,Object(n.b)(c.d.get())),i)}function h(e,t,i=Object(o.c)()){const l=Object(n.b)(Object(a.c)(c.d.get(),t));if(l[2]=0,!e.unprojectFromRenderScreen(l,i.origin))return null;const h=Object(n.b)(Object(a.c)(c.d.get(),t));h[2]=1;const u=e.unprojectFromRenderScreen(h,c.d.get());return Object(r.j)(u)?null:(Object(s.j)(i.direction,u,i.origin),i)}},692:function(e,t,i){"use strict";i.d(t,"a",(function(){return V}));var r=i(197),n=i(88),a=i(122),s=i(107),o=i(85),c=i(89),l=i(321),h=i(96),u=i(710),d=i(422),p=i(132);let f;var b=i(179),g=i(555);let m=null,v=null;async function O(){return Object(o.j)(v)&&(v=function(){if(Object(o.j)(f)){const e=e=>Object(p.a)(`esri/libs/basisu/${e}`);f=Promise.all([i.e(200),i.e(239)]).then(i.bind(null,1300)).then((function(e){return e.b})).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return f}(),m=await v),v}function y(e,t,i,r,n){const a=Object(g.b)(t?37496:37492),s=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*a*s)}function _(e){return e.getNumImages()>=1&&!e.isUASTC()}function j(e){return e.getFaces()>=1&&e.isETC1S()}function x(e,t,i,r,n,a,s,o){const{compressedTextureETC:c,compressedTextureS3TC:l}=e.capabilities,[h,u]=c?r?[1,37496]:[0,37492]:l?r?[3,33779]:[2,33776]:[13,6408],d=t.hasMipmap?i:Math.min(1,i),p=[];for(let b=0;b<d;b++)p.push(new Uint8Array(s(b,h))),o(b,h,p[b]);const f=p.length>1,g=f?9987:9729,m={...t,samplingMode:g,hasMipmap:f,internalFormat:u,width:n,height:a};return new b.a(e,m,{type:"compressed",levels:p})}var w=i(465);const M=i(80).a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),S=542327876,E=131072;function T(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const P=T("DXT1"),A=T("DXT3"),C=T("DXT5");function D(e,t,i){const{textureData:r,internalFormat:n,width:a,height:o}=function(e,t){const i=new Int32Array(e,0,31);if(i[0]!==S)return M.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return M.error("Unsupported format, must contain a FourCC code"),null;const r=i[21];let n,a;switch(r){case P:n=8,a=33776;break;case A:n=16,a=33778;break;case C:n=16,a=33779;break;default:return M.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(r)),null}let o=1,c=i[4],l=i[3];0==(3&c)&&0==(3&l)||(M.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,l=l+3&-4);const h=c,u=l;let d,p;i[2]&E&&!1!==t&&(o=Math.max(1,i[7])),1===o||Object(s.l)(c)&&Object(s.l)(l)||(M.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let f=i[1]+4;const b=[];for(let s=0;s<o;++s)p=(c+3>>2)*(l+3>>2)*n,d=new Uint8Array(e,f,p),b.push(d),f+=p,c=Math.max(1,c>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:b},internalFormat:a,width:h,height:u}}(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=n,t.width=a,t.height=o,new b.a(e,t,r)}var R=i(613),I=i(220),z=i(241),L=i(398);class V extends w.a{constructor(e,t){super(),this.data=e,this.type=4,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new a.a,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=V.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;Object(o.j)(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){Object(h.t)(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){Object(h.u)(e.src)||Object(h.t)(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if(Object(o.j)(e))return 0;if(Object(l.c)(e)||Object(l.k)(e))return t.encoding===V.KTX2_ENCODING?function(e,t){if(Object(o.j)(m))return e.byteLength;const i=new m.KTX2File(new Uint8Array(e)),r=j(i)?y(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}(e,t.mipmap):t.encoding===V.BASIS_ENCODING?function(e,t){if(Object(o.j)(m))return e.byteLength;const i=new m.BasisFile(new Uint8Array(e)),r=_(i)?y(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?V.getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}load(e,t){if(Object(o.k)(this.glTexture))return this.glTexture;if(Object(o.k)(this.loadingPromise))return this.loadingPromise;const i=this.data;return Object(o.j)(i)?(this.glTexture=new b.a(e,this.createDescriptor(e),null),this.glTexture):"string"==typeof i?this.loadFromURL(e,t,i):i instanceof Image?this.loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(e,i,t):(Object(l.c)(i)||Object(l.k)(i))&&this.params.encoding===V.DDS_ENCODING?this.loadFromDDSData(e,i):(Object(l.c)(i)||Object(l.k)(i))&&this.params.encoding===V.KTX2_ENCODING?this.loadFromKTX2(e,i):(Object(l.c)(i)||Object(l.k)(i))&&this.params.encoding===V.BASIS_ENCODING?this.loadFromBasis(e,i):Object(l.k)(i)?this.loadFromPixelData(e,i):Object(l.c)(i)?this.loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||Object(o.j)(this.glTexture))return i;if(this.data.readyState<2||i===this.data.currentTime)return i;if(Object(o.k)(this.powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:n}=this.powerOfTwoStretchInfo;n.setData(this.data),this.drawStretchedTexture(e,t,i,r,n,this.glTexture)}else{const{width:e,height:t}=this.data,{width:i,height:r}=this.glTexture.descriptor;e!==i||t!==r?this.glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this.glTexture=D(e,this.createDescriptor(e),t),this.glTexture}loadFromKTX2(e,t){return this.loadAsync((()=>async function(e,t,i){Object(o.j)(m)&&(m=await O());const r=new m.KTX2File(new Uint8Array(i));if(!j(r))return null;r.startTranscoding();const n=x(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),((e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,i)=>r.transcodeImage(i,e,0,0,t,0,-1,-1)));return r.close(),r.delete(),n}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromBasis(e,t){return this.loadAsync((()=>async function(e,t,i){Object(o.j)(m)&&(m=await O());const r=new m.BasisFile(new Uint8Array(i));if(!_(r))return null;r.startTranscoding();const n=x(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),((e,t)=>r.getImageTranscodedSizeInBytes(0,e,t)),((e,t,i)=>r.transcodeImage(i,0,e,t,0,0)));return r.close(),r.delete(),n}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromPixelData(e,t){Object(I.a)(this.params.width>0&&this.params.height>0);const i=this.createDescriptor(e);return i.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,i.width=this.params.width,i.height=this.params.height,this.glTexture=new b.a(e,i,t),this.glTexture}loadAsync(e){const t=Object(c.d)();this.loadingController=t;const i=e(t.signal);this.loadingPromise=i;const r=()=>{this.loadingController===t&&(this.loadingController=null),this.loadingPromise===i&&(this.loadingPromise=null)};return i.then(r,r),i}loadFromURL(e,t,i){return this.loadAsync((async r=>{const n=await Object(u.a)(i,{signal:r});return this.loadFromImage(e,n,t)}))}loadFromImageElement(e,t,i){return i.complete?this.loadFromImage(e,i,t):this.loadAsync((async r=>{const n=await Object(d.a)(i,i.src,!1,r);return this.loadFromImage(e,n,t)}))}loadFromVideoElement(e,t,i){return i.readyState>=2?this.loadFromImage(e,i,t):this.loadFromVideoElementAsync(e,t,i)}loadFromVideoElementAsync(e,t,i){return this.loadAsync((r=>new Promise(((a,s)=>{const l=()=>{i.removeEventListener("loadeddata",h),i.removeEventListener("error",u),Object(o.k)(d)&&d.remove()},h=()=>{i.readyState>=2&&(l(),a(this.loadFromImage(e,i,t)))},u=e=>{l(),s(e||new n.a("Failed to load video"))};i.addEventListener("loadeddata",h),i.addEventListener("error",u);const d=Object(c.q)(r,(()=>u(Object(c.e)())))}))))}loadFromImage(e,t,i){const r=V.getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const n=this.createDescriptor(e);return n.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,n)||Object(s.l)(r.width)&&Object(s.l)(r.height)?(n.width=r.width,n.height=r.height,this.glTexture=new b.a(e,n,t),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,r,n,i),this.glTexture)}requiresPowerOfTwo(e,t){const i=33071,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Object(L.a)(e.gl)&&(t.hasMipmap||!r)}makePowerOfTwoTexture(e,t,i,n,a){const{width:o,height:c}=i,l=Object(s.p)(o),h=Object(s.p)(c);let u;switch(n.width=l,n.height=h,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[o/l,c/h],u=new b.a(e,n),u.updateData(0,0,0,o,c,t);break;case 1:case null:case void 0:u=this.stretchToPowerOfTwo(e,t,n,a);break;default:Object(r.a)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&u.generateMipmap(),u}stretchToPowerOfTwo(e,t,i,r){const n=new b.a(e,i),a=new z.a(e,{colorTarget:0,depthStencilTarget:0},n),s=new b.a(e,{target:3553,pixelFormat:i.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),o=Object(R.b)(e);return this.drawStretchedTexture(e,r,a,o,s,n),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:o,sourceTexture:s,framebuffer:a}:(o.dispose(!0),s.dispose(),a.detachColorTexture(),e.bindFramebuffer(null),a.dispose()),n}drawStretchedTexture(e,t,i,r,n,a){e.bindFramebuffer(i);const s=e.getViewport();e.setViewport(0,0,a.descriptor.width,a.descriptor.height);const o=t.program;e.useProgram(o),o.setUniform4f("color",1,1,1,1),o.bindTexture(n,"tex"),e.bindVAO(r),e.setPipelineState(t.pipeline),e.drawArrays(5,0,Object(g.f)(r,"geometry")),e.bindFramebuffer(null),e.setViewport(s.x,s.y,s.width,s.height)}unload(){if(Object(o.k)(this.powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this.powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(Object(o.k)(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),Object(o.k)(this.loadingController)){const e=this.loadingController;this.loadingController=null,this.loadingPromise=null,e.abort()}this.events.emit("unloaded")}}V.DDS_ENCODING="image/vnd-ms.dds",V.KTX2_ENCODING="image/ktx2",V.BASIS_ENCODING="image/x.basis"},695:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i(311),n=i(113);function a(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(n.a`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function s(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(r.a),e.include(a),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(n.a`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),e.fragment.code.add(n.a`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),e.fragment.code.add(n.a`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),e.fragment.code.add(n.a`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?e.fragment.code.add(n.a`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):e.fragment.code.add(n.a`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},710:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(100);async function n(e,t){const{data:i}=await Object(r.default)(e,{responseType:"image",...t});return i}},716:function(e,t,i){"use strict";i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return d}));i(98);var r=i(85),n=i(318),a=i(647),s=i(485),o=i(384),c=i(111),l=i(101),h=i(110);function u(e,t,i=null){return Object(r.k)(i)?[e,t,i]:[e,t]}function d(e,t,i=null){return Object(r.k)(i)?{x:e,y:t,z:i}:{x:e,y:t}}class p{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return Object(r.g)(e.map((e=>this.mapToLocal(e))))}get doUnnormalization(){return!1}}class f extends p{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=Object(a.b)(),this.transformInv=Object(a.b)(),this.transform=Object(a.a)(e),Object(n.a)(this.transformInv,this.transform)}makeMapPoint(e,t){return u(e,t,this.defaultZ)}mapToLocal(e){return d(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return u(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class b extends p{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=Object(l.e)(),this.tangentFrameUpWS=Object(l.e)(),this.tangentFrameRightWS=Object(l.e)(),this.tangentFrameForwardWS=Object(l.e)(),this.localFrameRightWS=Object(l.e)(),this.localFrameUpWS=Object(l.e)(),this.worldToLocalTransform=Object(o.b)(),this.localToWorldTransform=Object(o.b)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const r=Object(l.e)();Object(c.e)(r,this.tangentFrameForwardWS,Object(c.h)(i,this.tangentFrameForwardWS)),Object(c.j)(this.localFrameRightWS,i,r),Object(c.r)(this.localFrameRightWS,this.localFrameRightWS),Object(c.g)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Object(s.g)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Object(s.c)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return u(e,t,this.defaultZ)}mapToLocal(e){const t=Object(l.e)();this.view.renderCoordsHelper.toRenderCoords(new h.a({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(c.u)(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r.k)(i)?d(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=Object(l.e)();this.view.renderCoordsHelper.toRenderCoords(new h.a({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(c.u)(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r.k)(i)?u(i.x,i.y,this.defaultZ):null}}function g(e,t){if("2d"===e.type)return new f(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new h.a({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new h.a({x:t[0],y:t[1],spatialReference:e.spatialReference});return new b(e,i)}return null}},717:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var r=i(256),n=i(752),a=i(513),s=i(311),o=i(656),c=i(278),l=i(573),h=i(331),u=i(367),d=i(113),p=i(271);function f(e){const t=new p.a;t.extensions.add("GL_OES_standard_derivatives"),t.include(l.a),t.include(n.a,e),t.include(o.a,e),1===e.output&&t.include(a.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const i=e.falloffEnabled,f=e.draped&&e.stippleEnabled&&e.roundCaps,b=e.innerColorEnabled||f;return f&&t.varyings.add("stippleCapRadius","float"),b&&t.varyings.add("vLineDistance","float"),i&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(d.a`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(d.a`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(d.a`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(d.a`void main(void) {
float uvY = floor(uv0.y);
float uvZ = fract(uv0.y) * 10.0;
float coverage = 1.0;
vpos = position;
if (uvY == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
bool isStartVertex = abs(abs(uvY)-3.0) == 1.0;
bool isJoin = abs(uvY)-3.0 < 0.0;
float lineWidth = getSize() * pixelRatio;
if (lineWidth < 1.0) {
coverage = lineWidth;
lineWidth = 1.0;
}else{
lineWidth = floor(lineWidth + 0.5);
}
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
vec4 next = view * vec4(auxpos2.xyz, 1.0);
clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),e.stippleEnabled&&t.vertex.code.add(d.a`vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uvZ);
vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;
vec2 stippleSegment = stippleSegmentInfo.zw;`),t.vertex.code.add(d.a`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uvY > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(d.a`vec2 startDir;
vec2 endDir;
if (leftLen < 0.001) {
startDir = right;
}
else{
startDir = left;
}
startDir = normalize(startDir);
startDir = PERPENDICULAR(startDir);
if (rightLen < 0.001) {
endDir = left;
}
else{
endDir = right;
}
endDir = normalize(endDir);
endDir = PERPENDICULAR(endDir);
float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
joinDisplacementDir = rotate(startDir, -sign(uvY) * subdivisionFactor * rotationAngle);`):t.vertex.code.add(d.a`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(d.a`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;`),e.roundCaps?t.vertex.code.add(d.a`float angle = subdivisionFactor*PI*0.5;
joinDisplacementDir *= cos(angle);
capDisplacementDir *= sin(angle);`):t.vertex.code.add(d.a`capDisplacementDir *= subdivisionFactor;`),t.vertex.code.add(d.a`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uvY) * displacementLen + capDisplacementDir * displacementLen;

  ${f?d.a`stippleCapRadius = lineWidth;`:""}

  ${i||b?d.a`float lineDist = lineWidth * sign(uvY) * pos.w;`:""}

  ${b?d.a`vLineDistance = lineDist;`:""}
  ${i?d.a`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `),e.stippleEnabled&&(e.draped?t.vertex.code.add(d.a`{
stipplePatternUv = uv0.x;
float stippleSegmentScreenLength = length(stippleSegment);
float stippleSegmentRenderLength = length(mix(auxpos2 - position, position - auxpos1, uvZ));
if (stippleSegmentScreenLength >= 0.001) {
vec2 stippleDisplacement = pos.xy - stippleSegmentOrigin;
float stippleDisplacementFactor = dot(stippleSegment, stippleDisplacement) / (stippleSegmentScreenLength * stippleSegmentScreenLength);
stipplePatternUv += (stippleDisplacementFactor - uvZ) * stippleSegmentRenderLength;
}
stipplePatternUv *= worldToScreenRatio;
}`):(t.vertex.code.add(d.a`{
vec2 posVec = pos.xy - stippleSegmentOrigin;
float stippleSegmentDirectionLength = length(stippleSegment);`),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(d.a`float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
stipplePatternUvMax = roundedNumberOfPatternRepeats;`),t.vertex.code.add(d.a`
        if (stippleSegmentDirectionLength >= 0.001) {
          // Project the vertex position onto the line segment.
          float projectedLength = dot(stippleSegment, posVec) / stippleSegmentDirectionLength * 0.5;
          ${e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"}
          stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `))),t.vertex.code.add(d.a`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(c.b,e)),t.include(r.a,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(u.a),t.fragment.code.add(d.a`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),f?t.fragment.code.add(d.a`vec2 stipplePosition = vec2(
clamp(stippleCapRadius - getStippleSDF(), 0.0, stippleCapRadius),
vLineDistance
) / stippleCapRadius;
float stippleRadius = dot(stipplePosition, stipplePosition);
float stippleAlpha = step(stippleRadius, 1.0);`):t.fragment.code.add(d.a`float stippleAlpha = getStippleAlpha();`),t.fragment.code.add(d.a`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(d.a`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),t.fragment.code.add(d.a`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(d.a`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`),t.fragment.code.add(d.a`
    if (finalColor.a < ${d.a.float(h.c)}) {
      discard;
    }

    ${7===e.output?d.a`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?d.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?d.a`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?d.a`outputDepth(linearDepth);`:""}
  }
  `),t}var b=Object.freeze({__proto__:null,build:f})},718:function(e,t,i){"use strict";i.d(t,"a",(function(){return j})),i.d(t,"b",(function(){return v})),i.d(t,"c",(function(){return O})),i.d(t,"d",(function(){return y}));var r=i(146),n=i(215),a=i(221),s=i(256),o=i(849),c=i(719),l=i(983),h=i(319),u=i(497),d=i(331),p=i(367),f=i(431),b=i(638),g=i(113),m=i(271);function v(e){const t=new m.a,i=e.signedDistanceFieldEnabled;if(t.include(o.a),t.include(c.a,e),t.include(s.a,e),6===e.output)return t.include(l.a,e),t;t.include(b.a),t.fragment.include(f.a),t.fragment.include(p.a),t.include(u.a,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(g.a`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?g.a`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:g.a`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const r=g.a`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,n=e.pixelSnappingEnabled?i?g.a`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:g.a`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:g.a`posProj += quadOffset;`;t.vertex.code.add(g.a`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${r}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${g.a.float(d.c)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${g.a.float(d.c)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${n}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?g.a`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const a=e.debugDrawBorder?g.a`(isBorder > 0.0 ? 0.0 : ${g.a.float(d.b)})`:g.a.float(d.b),v=g.a`
    ${e.debugDrawBorder?g.a`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?g.a`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${g.a.float(d.c)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:g.a`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?g.a`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(g.a`
      void main() {
        ${v}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(g.a`
    void main() {
      ${v}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(h.a),t.fragment.code.add(g.a`
    void main() {
      ${v}
      ${e.binaryHighlightOcclusionEnabled?g.a`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function O(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",a.b),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",y(t))}function y(e,t=_){return e.textureIsSignedDistanceField?function(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):Object(r.c)(t,e.anchorPos),t}const _=Object(n.a)();var j=Object.freeze({__proto__:null,build:v,bindHUDMaterialUniforms:O,calculateAnchorPosForRendering:y})},719:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s}));var r=i(638),n=i(113);function a(e,t){const i=e;i.include(r.a),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(n.a`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.vertex.code.add(n.a`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||i.vertex.code.add(n.a`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),i.vertex.code.add(n.a`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?n.a`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?n.a`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(n.a`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function s(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},720:function(e,t,i){"use strict";i.d(t,"a",(function(){return b})),i.d(t,"b",(function(){return f}));var r=i(256),n=i(376),a=i(515),s=i(513),o=i(319),c=i(311),l=i(278),h=i(331),u=i(367),d=i(113),p=i(271);function f(e){const t=new p.a,i=1===e.output;return t.include(n.a,{linearDepth:i}),t.include(a.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(s.a,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(d.a`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?d.a`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:d.a`transformPosition(proj, view, vpos);`}
    }
  `),t.include(r.a,e),t.fragment.include(u.a),e.multipassTerrainEnabled&&(t.fragment.include(c.a),t.include(l.b,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(o.a),t.fragment.code.add(d.a`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${d.a.float(h.c)}) {
      discard;
    }

    ${7===e.output?d.a`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?d.a`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?d.a`outputHighlight();`:""};
    ${1===e.output?d.a`outputDepth(linearDepth);`:""};
  }
  `),t}var b=Object.freeze({__proto__:null,build:f})},721:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return m}));var r=i(107),n=i(85),a=i(321),s=i(111),o=i(101),c=i(178),l=i(681),h=i(722),u=i(478),d=i(732),p=i(421);function f(e){const t=[],i=[];!function(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:n}=e,s=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&1===n,o=r.length/3-(s?1:0),c=new Uint32Array(2*(o-1)),l=s?Object(a.m)(r,0,r.length-3):r;let h=0;for(let a=0;a<o-1;a++)c[h++]=a,c[h++]=a+1;t.push(["position",{size:3,data:l,exclusive:s}]),i.push(["position",c])}(e,i,t);const o=i[0][1].data,c=t[0][1].length,l=new Uint16Array(c);return function(e,t,i){const r=e.attributeData.mapPosition;Object(n.j)(r)||(i.push(["mapPos",i[0][1]]),t.push(["mapPos",{size:3,data:r}]))}(e,i,t),function(e,t,i,r){if(Object(n.k)(e.attributeData.colorFeature))return;const a=e.attributeData.color;t.push(["color",{size:4,data:Object(n.t)(a,h.c)}]),i.push(["color",r])}(e,i,t,l),function(e,t,i,r){if(Object(n.k)(e.attributeData.sizeFeature))return;const a=e.attributeData.size;t.push(["size",{size:1,data:[Object(n.t)(a,1)]}]),i.push(["size",r])}(e,i,t,l),function(e,t,i,r){const a=e.attributeData.colorFeature;Object(n.j)(a)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["color",r]))}(e,i,t,l),function(e,t,i,r){const a=e.attributeData.sizeFeature;Object(n.j)(a)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["sizeFeatureAttribute",r]))}(e,i,t,l),function(e,t,i,r){const a=e.attributeData.opacityFeature;Object(n.j)(a)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([a])}]),i.push(["opacityFeatureAttribute",r]))}(e,i,t,l),function(e,t,i,a){if("round"!==e.join)return;const o=a.length/3,c=new Float32Array(o),l=O,h=y;Object(s.w)(l,0,0,0);const u=Object(n.t)(e.uniformSize,1);for(let n=-1;n<o;++n){const e=n<0?o+n:n,t=(n+1)%o;if(Object(s.w)(h,a[3*t+0]-a[3*e+0],a[3*t+1]-a[3*e+1],a[3*t+2]-a[3*e+2]),Object(s.r)(h,h),n>=0){const e=(Math.PI-Object(r.b)(Object(s.h)(l,h)))*_*1*v(u);c[n]=Math.max(Math.floor(e),0)}Object(s.e)(l,h,-1)}t.push(["subdivisions",{size:1,data:c}]),i.push(["subdivisions",i[0][1]])}(e,i,t,o),new p.a(i,t,2)}function b(e,t,i,r){const n="polygon"===e.type?1:0,a="polygon"===e.type?e.rings:e.paths,{position:s,outlines:o}=Object(l.a)(a,e.hasZ,n),c=new Float64Array(s.length),h=Object(u.c)(s,e.spatialReference,0,c,0,s,0,s.length/3,t,i,r),d=null!=h;return{lines:d?g(o,s,c):[],projectionSuccess:d,sampledElevation:h}}function g(e,t,i){const r=new Array;for(const{index:n,count:a}of e){if(a<=1)continue;const e=3*n,s=e+3*a;r.push({position:t.subarray(e,s),mapPosition:i?i.subarray(e,s):void 0})}return r}function m(e,t){const i="polygon"===e.type?1:0,r="polygon"===e.type?e.rings:e.paths,{position:n,outlines:a}=Object(l.a)(r,!1,i),s=Object(c.m)(n,e.spatialReference,0,n,t,0,n.length/3);for(let o=2;o<n.length;o+=3)n[o]=d.a;return{lines:s?g(a,n):[],projectionSuccess:s}}function v(e){return 1.863798+-2.0062872/(1+e/18.2313)**.8856294}const O=Object(o.e)(),y=Object(o.e)(),_=4/Math.PI},722:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return s}));var r=i(221);const n=1.2,a=r.b,s=r.a},723:function(e,t,i){"use strict";i.d(t,"a",(function(){return v})),i.d(t,"b",(function(){return m}));var r=i(564),n=i(256),a=i(376),s=i(319),o=i(311),c=i(278),l=i(687),h=i(466),u=i(763),d=i(642),p=i(331),f=i(367),b=i(113),g=i(271);function m(e){const t=new g.a;return t.include(a.a,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(l.a,e),t.include(r.a,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add(b.a`
      void main(void) {
        if (waterColor.a < ${b.a.float(p.c)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${0===e.output?"forwardLinearDepth();":""}
      }
    `)),e.multipassTerrainEnabled&&(t.fragment.include(o.a),t.include(c.b,e)),7===e.output&&(t.include(n.a,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b.a`
        void main() {
          discardBySlice(vpos);
          ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),0===e.output&&(t.include(d.a,e),t.include(n.a,e),e.receiveShadows&&t.include(h.a,e),t.include(u.a,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(f.a),t.fragment.code.add(b.a`
      void main() {
        discardBySlice(vpos);
        ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        float shadow = ${e.receiveShadows?b.a`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),2===e.output&&(t.include(l.a,e),t.include(d.a,e),t.include(n.a,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(b.a`
        void main(void) {
          if (waterColor.a < ${b.a.float(p.c)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add(b.a`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(b.a`
        void main(void) {
          if (waterColor.a < ${b.a.float(p.c)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add(b.a`void main() {
gl_FragColor = waterColor;
}`)),4===e.output&&(t.include(s.a),t.varyings.add("vpos","vec3"),t.vertex.code.add(b.a`
      void main(void) {
        if (waterColor.a < ${b.a.float(p.c)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(n.a,e),t.fragment.code.add(b.a`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}var v=Object.freeze({__proto__:null,build:m})},724:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i(637),n=i(113),a=i(271);function s(){const e=new a.a;return e.include(r.a),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add(n.a`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * color;
}`),e}var o=Object.freeze({__proto__:null,build:s})},725:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return a}));var r=i(113);function n(e){e.vertex.uniforms.add("camPos","vec3").add("perScreenPixelRatio","float").add("screenSize","float"),e.vertex.code.add(r.a`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - camPos));
return viewDirectionDistance*perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSize * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function a(e,t,i){e.setUniform1f("perScreenPixelRatio",i.camera.perScreenPixelRatio),e.setUniform1f("screenSize",t.screenSize)}},732:function(e,t,i){"use strict";i.d(t,"a",(function(){return tt}));var r=i(81),n=i(91),a=i(122),s=i(117),o=i(80),c=i(414),l=i(85),h=i(180),u=i(412),d=i(109),p=i(83),f=(i(79),i(84),i(82)),b=i(135),g=i(215),m=i(101),v=i(639),O=i(107),y=i(123),_=i(658);class j{constructor(e,t){this.index=e,this.renderTargets=t,this.extent=Object(y.l)(),this.resolution=0,this.renderLocalOrigin=Object(_.a)(0,0,0,"O"),this.pixelRatio=1,this.canvasGeometries={extents:[Object(y.l)(),Object(y.l)(),Object(y.l)()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(t.renderTargets.length).fill(!1)}getValidTarget(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}getNormalTexture(e){const t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}draw(e,t){const i=this.computeRenderTargetValidityBitfield(),r=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)1===n.type&&!1===r?this.validTargets[n.type]=!1:this.validTargets[n.type]=e.drawTarget(this,n,t);return i^this.computeRenderTargetValidityBitfield()?0:1}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this.extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(y.u)(this.extent,e.range,0,t)}if(this.extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Object(y.u)(this.extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Object(y.k)(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}applyViewport(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}var x=i(240),w=i(212),M=i(241),S=(i(195),i(202),i(263),i(174)),E=i(179),T=i(216);class P{constructor(e,t){this.size=Object(x.a)(),this._fbo=null,this._fbo=new M.a(e,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Object(l.f)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var e;null==(e=this._fbo)||e.resize(0,0)}get gpuMemoryUsage(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}class A{constructor(e){this.renderTargets=null;const t=(t,i,r=!0)=>({type:i,fbo:new P(e,r),renderPass:t,valid:!1,lastUsed:1/0});this.renderTargets=[t(0,0),t(0,1),t(5,2,!1),t(3,3),t(0,4)]}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,t,i){if(e)t.lastUsed=i;else if(i-t.lastUsed>C)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce(((e,t)=>e+t.fbo.gpuMemoryUsage),0)}}const C=1e3;class D{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}class R{constructor(e){this._context=e,this._perConstructorInstances=new Map,this._frameCounter=0,this._keepAliveFrameCount=I}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.dispose())))),this._perConstructorInstances.clear()}acquire(e,t){const i=t.key;let r=this._perConstructorInstances.get(e);r||(r=new Map,this._perConstructorInstances.set(e,r));let n=r.get(i);if(void 0===n){const a=new e(this._context,t,(()=>this.release(a)));n=new D(a),r.set(i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,t,i){if(Object(l.k)(i)){if(t.key===i.key)return i;i.release()}return this.acquire(e,t)}release(e){if(Object(l.j)(e))return;const t=this._perConstructorInstances.get(e.constructor).get(e.key);--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter)}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==I&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((t,i)=>{0===t.refCount&&t.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(t.technique.dispose(),e.delete(i))})),0===e.size&&this._perConstructorInstances.delete(t)}))}async hotReload(){const e=new Array;this._perConstructorInstances.forEach(((t,i)=>{e.push((async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach((e=>{e.technique.reload(this._context)})))})(t,i))})),await Promise.all(e)}}const I=-1;var z=i(610),L=i(574);const V=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];function F(e,t){return e+"_"+V.find((e=>e.output===t)).name}var k=i(220);const G=o.a.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");class U{constructor(e){this.refCnt=0,this.glMaterial=e}incRefCnt(){++this.refCnt}decRefCnt(){--this.refCnt,Object(k.a)(this.refCnt>=0)}getRefCnt(){return this.refCnt}getGLMaterial(){return this.glMaterial}}class B{constructor(e,t,i){this._textureRep=e,this._techniqueRep=t,this.onMaterialChanged=i,this._id2glMaterialRef=new Map}dispose(){this._textureRep.dispose()}acquire(e,t){this.ownMaterial(e);const i=F(e.id,t);let r=this._id2glMaterialRef.get(i);if(null==r){const n=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:t});return r=new U(n),r.incRefCnt(),this._id2glMaterialRef.set(i,r),n}return r.incRefCnt(),r.getGLMaterial()}release(e,t){const i=F(e.id,t),r=this._id2glMaterialRef.get(i);if(r.decRefCnt(),0===r.getRefCnt()){const e=r.getGLMaterial();e&&e.dispose(),this._id2glMaterialRef.delete(i)}}materialChanged(e){for(const t of V)if(5!==t.output&&6!==t.output){const i=this._id2glMaterialRef.get(F(e.id,t.output));if(i&&i.getGLMaterial()){const e=i.getGLMaterial();e.updateParameters&&e.updateParameters()}}this.onMaterialChanged&&this.onMaterialChanged(e)}ownMaterial(e){Object(l.k)(e.materialRepository)&&e.materialRepository!==this&&G.error("Material is already owned by a different material repository"),e.materialRepository=this}}var N=i(613),H=i(756),q=i(640);class W{constructor(e){this.rctx=e,this.camera=null,this.lastFrameCamera=new L.a,this.pass=0,this.slot=0,this.highlightDepthTexture=null,this.renderOccludedMask=Z,this.hasOccludees=!1}resetRenderOccludedMask(){this.renderOccludedMask=Z}get isHighlightPass(){return 5===this.pass}}const Z=13;class ${constructor(){this.adds=new h.a,this.removes=new h.a,this.updates=new h.a({allocator:e=>e||new Y,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Y{}class X{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Q=i(375);function K(e){return e.data.indexCount>=1}var J=i(168),ee=i(590);class te{constructor(e){null==e?e=16:e<65536&&(e=Object(O.p)(e)),this._array=new Float32Array(e),this._size=0}resize(e,t){if(this._size=e,this._size>this._array.length){let e=this._array.length||1;for(;e<this._size;)e*=2;const i=new Float32Array(e);return t&&i.set(this._array),this._array=i,!0}const i=2*this._size;if(i<=this._array.length){let e=this._array.length;for(;e>=i;)e=Math.floor(e/2);const r=new Float32Array(e);return t&&r.set(this._array.subarray(0,e)),this._array=r,!0}return!1}append(e){const t=this._size;this.resize(this._size+e.length,!0),this._array.set(e,t)}erase(e,t){for(let i=e;i<t;++i)this._array[i]=0}get array(){return this._array}get size(){return this._size}}var ie=i(757);class re{constructor(e,t,i,r,n,a){this.from=e,this.to=t,this.isVisible=i,this.hasHighlights=r,this.hasOccludees=n,this.transformation=a,null!=a&&(this.transformationNormal=Object(J.c)(a),Object(b.c)(this.transformationNormal,this.transformationNormal),Object(b.b)(this.transformationNormal,this.transformationNormal))}}function ne(e,t){const i=e=>({first:e.from,count:e.to-e.from});if(0===e.length)return void e.push(i(t));const r=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(r,t)){const e=t.from-r.first+t.to-t.from;r.count=e}else e.push(i(t))}var ae=i(385),se=i(357);i(120);function oe(e,t,i){Object(l.k)(i)&&(i.drawCalls+=e,i.triangles+=t)}se.a;var ce=i(555);class le{constructor(e,t,i){this.type="MergedRenderer",this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._rctx=e,this._material=i,this._materialRep=t,this._glMaterials=Object(ae.a)(this._material,this._materialRep),this._bufferWriter=i.createBufferWriter()}dispose(){Object(ae.f)(this._material,this._materialRep),this._dataByOrigin&&(this._dataByOrigin.forEach((e=>{e.vao.dispose(!0),e.vao=null})),this._dataByOrigin.clear(),this._dataByOrigin=null),this._glMaterials&&(this._glMaterials.forEach((e=>{e&&e.dispose()})),this._glMaterials.clear(),this._glMaterials=null)}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&Object(c.c)(this._glMaterials,(e=>e instanceof ie.a))}get rendersOccluded(){return!this.isEmpty&&1!==this._material.renderOccluded}modify(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}addAndRemoveGeometries(e,t){const i=this._bufferWriter,r=i.vertexBufferLayout,n=r.stride/4,a=this._dataByOrigin,s=function(e,t,i,r){const n=new Map,a=t.vertexBufferLayout.stride/4,s=(i,r)=>{const s=i.origin;if(Object(l.j)(s))return;const o=e.get(s.id);let c=n.get(s.id);null==c&&(c={optimalCount:null==o?0:o.optimalCount,sparseCount:null==o?0:o.buffer.size,toAdd:[],toRemove:[],origin:s.vec3},n.set(s.id,c));const h=t.elementCount(i.data)*a;r?(c.optimalCount+=h,c.sparseCount+=h,c.toAdd.push(i)):(c.optimalCount-=h,c.toRemove.push(i))};for(const o of i)s(o,!0);for(const o of r)s(o,!1);return n}(a,i,e,t);s.forEach(((e,t)=>{s.delete(t);const i=e.optimalCount,o=e.sparseCount;let c=a.get(t);if(null==c)Object(k.a)(i>0),c=this.createData(r,i,e.origin),a.set(t,c);else if(0===i)return c.vao.dispose(!0),c.vao=null,void a.delete(t);const l=i<e.sparseCount/2,h=l?i:o,u=ue,d=c.buffer.size,p=c.buffer.array,f=c.buffer.resize(h,!1);l||f?this.removeAndRebuild(c,e.toRemove,n,p,u):e.toRemove.length>0?(this.removeByErasing(c,e.toRemove,n,u),e.toAdd.length>0&&(u.end=d)):(u.begin=d,u.end=d);const b=de;Object(k.j)(b,-e.origin[0],-e.origin[1],-e.origin[2]),this.append(c,e.toAdd,n,b,u);const g=c.vao.vertexBuffers.geometry;if(g.byteSize!==c.buffer.array.buffer.byteLength)g.setData(c.buffer.array);else{const{begin:e,end:t}=u;if(e<t){const i=c.buffer.array,r=4,n=e*r,a=t*r;g.setSubData(i,n,n,a)}}c.drawCommandsDirty=!0}))}updateGeometries(e){const t=this._bufferWriter,i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.updateType,n=r.renderGeometry,a=this._dataByOrigin.get(n.origin.id),s=a&&a.instances.get(n.id);if(!s)return;if(1&e&&(s.isVisible=n.instanceParameters.visible),9&e){const e=n.instanceParameters.visible;s.hasHighlights=!!n.instanceParameters.highlights&&e}if(16&e&&(s.hasOccludees=!!n.instanceParameters.occludees),6&e){const e=a.buffer.array,r=a.vao;Object(ae.c)(n,pe,fe),t.write({transformation:pe,invTranspTransformation:fe},n.data,t.vertexBufferLayout.createView(e.buffer),s.from),Object(k.a)(s.from+t.elementCount(n.data)===s.to,"material VBO layout has changed"),r.vertexBuffers.geometry.setSubData(e,s.from*i*4,s.from*i*4,s.to*i*4)}a.drawCommandsDirty=!0}}updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,Object(c.c)(e.instances,(t=>(t.isVisible?(t.hasHighlights&&(this._hasHighlights=!0,e.hasHighlights=!0),t.hasOccludees&&(this._hasOccludees=!0,e.hasOccludees=!0)):e.hasHiddenInstances=!0,e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees)))}));this._dataByOrigin.forEach((e=>{e.drawCommandsDirty&&((e=>{if(e.drawCommandsDefault=null,e.drawCommandsHighlight=null,e.drawCommandsOccludees=null,e.drawCommandsShadowHighlightRest=null,e.stats={default:0,highlight:0,occludees:0,shadowHighlightRest:0},0===e.instances.size)return;if(!he(e)){const t=4*e.buffer.size/Object(ce.d)(e.vao.layout.geometry);return e.drawCommandsDefault=[{first:0,count:t}],void(e.stats={default:t,highlight:0,occludees:0,shadowHighlightRest:0})}const t=function(e){return e.sort(((e,t)=>e.from===t.from?e.to>t.to?1:e.to<t.to?-1:0:e.from>t.from?1:e.from<t.from?-1:0))}([...e.instances.values()]);e.drawCommandsDefault=[],e.drawCommandsHighlight=[],e.drawCommandsOccludees=[],e.drawCommandsShadowHighlightRest=[];for(const r of t)r.isVisible&&(r.hasOccludees?ne(e.drawCommandsOccludees,r):ne(e.drawCommandsDefault,r),r.hasHighlights?ne(e.drawCommandsHighlight,r):ne(e.drawCommandsShadowHighlightRest,r));const i=e=>{let t=0;for(const i of e)t+=i.count;return t/3};e.stats={default:i(e.drawCommandsDefault),highlight:i(e.drawCommandsHighlight),occludees:i(e.drawCommandsOccludees),shadowHighlightRest:i(e.drawCommandsShadowHighlightRest)}})(e),e.drawCommandsDirty=!1)}))}updateLogic(e){return this._material.update(e)}render(e,t,i,r){const n=this._rctx,a=this._glMaterials.get(t),s=5===t||7===t,o=6===t,c=!(s||o);if(!a||2!==a.ensureResources(n)||null!=e&&!a.beginSlot(e)||s&&!this._hasHighlights)return!1;a.ensureParameters(i);const h=a.getPipelineState(e,!1);n.setPipelineState(h);const u=a.technique;n.useProgram(u.program),a.bind(i);let d=!1;return this._dataByOrigin.forEach((t=>{if(Object(l.j)(t.drawCommandsDefault)&&Object(l.j)(t.drawCommandsHighlight)&&Object(l.j)(t.drawCommandsOccludees)&&Object(l.j)(t.drawCommandsShadowHighlightRest))return;if(s&&!t.hasHighlights)return;i.origin=t.origin,u.bindDraw(i,{},{}),u.ensureAttributeLocations(t.vao),n.bindVAO(t.vao);const p=u.primitiveType,f=s?t.drawCommandsHighlight:o&&he(t)?t.drawCommandsShadowHighlightRest:t.drawCommandsDefault;if(Object(l.k)(f)){this.renderCommands(n,p,f);const e=s?t.stats.highlight:o&&he(t)?t.stats.shadowHighlightRest:t.stats.default;oe(f.length,e,r),d=!0}if(c){const i=t.drawCommandsOccludees;if(Object(l.k)(i)){const s=a.getPipelineState(e,!0);n.setPipelineState(s),this.renderCommands(n,p,i),n.setPipelineState(h),oe(i.length,t.stats.occludees,r),d=!0}}})),d}renderCommands(e,t,i){for(let r=0;r<i.length;r++)e.drawArrays(t,i[r].first,i[r].count)}createData(e,t,i){return{instances:new Map,vao:new T.a(this._rctx,this._material.vertexAttributeLocations,{geometry:Object(ee.a)(e)},{geometry:w.a.createVertex(this._rctx,35044)}),buffer:new te(t),optimalCount:0,origin:i,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,drawCommandsShadowHighlightRest:null,stats:{default:0,highlight:0,occludees:0,shadowHighlightRest:0}}}removeAndRebuild(e,t,i,r,n){for(const h of t){const t=h.id,r=e.instances.get(t);e.optimalCount-=(r.to-r.from)*i,e.instances.delete(t)}let a=0;const s=e.buffer.array;n.begin=0,n.end=0;let o=-1,c=-1,l=0;e.instances.forEach((e=>{const t=e.from*i,n=e.to*i,h=n-t;o!==c&&c!==t?(s.set(r.subarray(o,c),l),l+=c-o,o=t):-1===o&&(o=t),c=n,e.from=a/i,a+=h,e.to=a/i})),o!==c&&s.set(r.subarray(o,c),l),n.end=a}removeByErasing(e,t,i,r){r.begin=1/0,r.end=-1/0;let n=-1,a=-1;for(const s of t){const t=s.id,o=e.instances.get(t),c=o.from*i,l=o.to*i;n!==a&&a!==c?(e.buffer.erase(n,a),n=c):-1===n&&(n=c),a=l,e.instances.delete(t),e.optimalCount-=l-c,c<r.begin&&(r.begin=c),l>r.end&&(r.end=l)}n!==a&&e.buffer.erase(n,a)}append(e,t,i,r,n){const a=this._bufferWriter;for(const s of t){const t=Object(l.k)(s.transformation)?Object(b.n)(pe,r,s.transformation):r;Object(b.c)(fe,t),Object(b.b)(fe,fe);const o=n.end;a.write({transformation:t,invTranspTransformation:fe},s.data,a.vertexBufferLayout.createView(e.buffer.array.buffer),n.end/i);const c=a.elementCount(s.data)*i,h=o+c;Object(k.a)(null==e.instances.get(s.id));const u=s.instanceParameters.visible,d=!!s.instanceParameters.highlights&&u,p=!!s.instanceParameters.occludees,f=new re(o/i,h/i,u,d,p);e.instances.set(s.id,f),e.optimalCount+=c,n.end+=c}}get test(){return{material:this._material,glMaterials:this._glMaterials}}}function he(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}const ue={begin:0,end:0},de=Object(J.d)(),pe=Object(J.d)(),fe=Object(J.d)();let be=class extends n.a{constructor(){super(...arguments),this._pending=new ge,this._changes=new $,this._materialRenderers=new Map,this._sortedMaterialRenderers=new h.a,this._hasHighlights=!1,this._hasWater=!1}dispose(){this._changes.prune(),this._materialRenderers.forEach((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Object(c.c)(this._materialRenderers,(e=>e.rendersOccluded))}get isEmpty(){return!this.updating&&0===this._materialRenderers.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=function(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new X,t.set(e,i)),i};return e.adds.forAll((e=>{K(e)&&i(e.material).adds.push(e)})),e.removes.forAll((e=>{K(e)&&i(e.material).removes.push(e)})),e.updates.forAll((e=>{K(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}(this._changes);let t=!1,i=!1,r=!1;return e.forEach(((e,n)=>{let a=this._materialRenderers.get(n);if(!a&&e.adds.length>0&&(a=new le(this.rctx,this.materialRepository,n),this._materialRenderers.set(n,a),t=!0,i=!0,r=!0),!a)return;const s=i||a.hasHighlights,o=r||a.hasWater;a.modify(e),i=i||s!==a.hasHighlights,r=r||o!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(n),a.dispose(),t=!0)})),this._changes.clear(),t&&this.updateSortedMaterialRenderers(),i&&(this._hasHighlights=Object(c.c)(this._materialRenderers,(e=>e.hasHighlights))),r&&(this._hasWater=Object(c.c)(this._materialRenderers,(e=>e.hasWater))),this.notifyChange("updating"),!0}add(e){if(0===e.length)return;const t=this._pending.empty;for(const i of e)this._pending.adds.add(i);t&&this.notifyChange("updating")}remove(e){const t=this._pending.empty;for(const i of e)this._pending.adds.has(i)?(this._pending.removed.add(i),this._pending.adds.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i);t&&!this._pending.empty&&this.notifyChange("updating")}modify(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=r,e.updateType=t}i&&this._changes.updates.length>0&&this.notifyChange("updating")}updateLogic(e){let t=!1;return this._sortedMaterialRenderers.forAll((({materialRenderer:i})=>t=i.updateLogic(e)||t)),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];Object(Q.c)(r.material,e)&&r.materialRenderer.render(t.slot,e.pass,t,null)}}updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach(((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})})),this._sortedMaterialRenderers.sort(((e,t)=>{const i=t.material.renderPriority-e.material.renderPriority;return 0!==i?i:e.material.insertOrder-t.material.insertOrder}))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};Object(r.a)([Object(p.b)()],be.prototype,"rctx",void 0),Object(r.a)([Object(p.b)()],be.prototype,"materialRepository",void 0),Object(r.a)([Object(p.b)()],be.prototype,"updating",null),be=Object(r.a)([Object(f.a)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],be);class ge{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}var me=i(724),ve=i(325),Oe=i(334),ye=i(341),_e=i(327),je=i(326);class xe extends Oe.a{initializeProgram(e){const t=xe.shader.get().build();return new je.a(e.rctx,t,_e.a)}initializePipeline(){return this.configuration.hasAlpha?Object(S.f)({blending:Object(S.g)(770,1,771,771),colorWrite:S.c}):Object(S.f)({colorWrite:S.c})}}xe.shader=new ve.a(me.a,(()=>i.e(303).then(i.bind(null,1303))));class we extends ye.a{constructor(){super(...arguments),this.hasAlpha=!1}}Object(r.a)([Object(ye.b)()],we.prototype,"hasAlpha",void 0);class Me{constructor(e=Object(m.e)()){this.intensity=e}}class Se{constructor(e=Object(m.e)(),t=Object(m.g)(.57735,.57735,.57735)){this.intensity=e,this.direction=t}}class Ee{constructor(e=Object(m.e)(),t=Object(m.g)(.57735,.57735,.57735),i=!0){this.intensity=e,this.direction=t,this.castShadows=i}}class Te{constructor(){this.r=[0],this.g=[0],this.b=[0]}}var Pe=i(111);function Ae(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function Ce(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function De(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function Re(e){return(e+1)*(e+1)}function Ie(e,t,i){const r=e[0],n=e[1],a=e[2],s=i||[];return s.length=Re(t),t>=0&&(s[0]=.28209479177),t>=1&&(s[1]=.4886025119*r,s[2]=.4886025119*a,s[3]=.4886025119*n),t>=2&&(s[4]=1.09254843059*r*n,s[5]=1.09254843059*n*a,s[6]=.31539156525*(3*a*a-1),s[7]=1.09254843059*r*a,s[8]=.54627421529*(r*r-n*n)),s}function ze(e,t){const i=(r=t.r.length,Object(O.f)(Math.floor(Math.sqrt(r)-1),0,2));var r;for(const n of e)Object(Pe.s)(Be,n.direction),Ie(Be,i,Ge),Ae(Ge,Ne),Ce(Ge,n.intensity[0],Ue),De(t.r,Ue),Ce(Ge,n.intensity[1],Ue),De(t.g,Ue),Ce(Ge,n.intensity[2],Ue),De(t.b,Ue);return t}function Le(e,t,i,r){(function(e,t){const i=Re(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0})(t,r),Object(Pe.w)(i.intensity,0,0,0);let n=!1;const a=Ve,s=Fe,o=ke;a.length=0,s.length=0,o.length=0;for(const c of e)c instanceof Ee&&!n?(Object(Pe.k)(i.direction,c.direction),i.intensity[0]=c.intensity[0],i.intensity[1]=c.intensity[1],i.intensity[2]=c.intensity[2],i.castShadows=c.castShadows,n=!0):c instanceof Ee||c instanceof Se?a.push(c):c instanceof Me?s.push(c):c instanceof Te&&o.push(c);ze(a,r),function(e,t){Ie(Be,0,Ge);for(const i of e)t.r[0]+=Ge[0]*Ne[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Ge[0]*Ne[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Ge[0]*Ne[0]*i.intensity[2]*4*Math.PI}(s,r);for(const c of o)De(r.r,c.r),De(r.g,c.g),De(r.b,c.b)}const Ve=[],Fe=[],ke=[],Ge=[0],Ue=[0],Be=Object(m.e)(),Ne=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class He{constructor(){this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:Object(m.e)(),ambient:{color:Object(m.e)(),intensity:1},diffuse:{color:Object(m.e)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new Te,this._mainLight={intensity:Object(m.e)(),direction:Object(m.g)(1,0,0),castShadows:!1}}get lightingMainDirection(){return this._mainLight.direction}setLightDirectionUniform(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}setUniforms(e,t=!1){const i=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",i),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);const r=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",r.r[0],r.r[1],r.r[2],r.r[3]),e.setUniform4f("lightingAmbientSH_G",r.g[0],r.g[1],r.g[2],r.g[3]),e.setUniform4f("lightingAmbientSH_B",r.b[0],r.b[1],r.b[2],r.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]),e.setUniform4f("lightingAmbientSH_R1",r.r[1],r.r[2],r.r[3],r.r[4]),e.setUniform4f("lightingAmbientSH_G1",r.g[1],r.g[2],r.g[3],r.g[4]),e.setUniform4f("lightingAmbientSH_B1",r.b[1],r.b[2],r.b[3],r.b[4]),e.setUniform4f("lightingAmbientSH_R2",r.r[5],r.r[6],r.r[7],r.r[8]),e.setUniform4f("lightingAmbientSH_G2",r.g[5],r.g[6],r.g[7],r.g[8]),e.setUniform4f("lightingAmbientSH_B2",r.b[5],r.b[6],r.b[7],r.b[8]))}set(e){Le(e,this._shOrder,this._mainLight,this._sphericalHarmonics),Object(Pe.k)(this._oldSunlight.direction,this._mainLight.direction);const t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,Object(Pe.e)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),Object(Pe.k)(qe,this._oldSunlight.diffuse.color),Object(Pe.e)(qe,qe,this._ambientBoost*this.globalFactor),Object(Pe.f)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,qe)}get old(){return this._oldSunlight}}const qe=Object(m.e)();class We{constructor(e){this._rctx=e,this.cache=new Map}dispose(){this.cache.forEach((e=>e.texture=Object(l.f)(e.texture))),this.cache.clear()}acquire(e){if(Object(l.j)(e))return null;const t=this.patternId(e),i=this.cache.get(t);if(i)return i.refCount++,i.bind;const{encodedData:r,sdfNormalizer:n}=this.patternToTextureData(e,2),a=r.length/4,s=a/2,o={refCount:1,texture:null,bind:e=>(Object(l.j)(o.texture)&&(o.texture=new E.a(this._rctx,{width:a,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},r)),e.bindTexture(o.texture,"stipplePatternTexture"),{pixelSize:s,sdfNormalizer:n})};return this.cache.set(t,o),o.bind}release(e){if(Object(l.j)(e))return;const t=this.patternId(e),i=this.cache.get(t);i&&(i.refCount--,0===i.refCount&&(Object(l.k)(i.texture)&&i.texture.dispose(),this.cache.delete(t)))}swap(e,t){const i=this.acquire(t);return this.release(e),i}patternId(e){return e.join(",")}patternToTextureData(e,t){const i=Math.floor(e.reduce(((e,t)=>e+t))*t),r=.5*(e.reduce(((e,t)=>Math.max(e,t)))+1)*t,n=new Uint8Array(4*i);let a=1,s=0;for(const o of e){const e=o*t;for(let t=0;t<e;t++){const i=a*(Math.min(t,e-t)+.5);Object(k.h)(i/r*.5+.5,n,s),s+=4}a=-a}return{encodedData:n,sdfNormalizer:r}}}var Ze=i(456);const $e=o.a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");let Ye=class extends(Object(z.b)(n.a)){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._lighting=new He,this._handles=new s.a,this._layerRenderers=new Map,this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers=new h.a,this._geometries=new Map,this.worldToPCSRatio=1,this.events=new a.a,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext,this._renderContext=new W(this._rctx);const t=e.waterTextureRepository;this._stippleTextureRepository=new We(e.renderingContext),this._shaderTechniqueRepository=new R({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._handles.add([Object(d.a)(t,"loadingState",(()=>this.events.emit("content-changed"))),Object(d.a)(this,"spatialReference",(e=>this._localOrigins=new H.a(e)))]),this._materialRepository=new B(e.textureRepository,this._shaderTechniqueRepository),this._materialRepository.onMaterialChanged=e=>{(e.renderOccluded&it)>0!==this._rendersOccluded&&this.updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new Me(Object(m.g)(1,1,1))]),this._bindParameters={slot:23,highlightDepthTexture:Object(N.a)(this._rctx),camera:Ke,inverseViewport:Object(g.a)(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMat:null,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._handles.add(this.view.resourceController.scheduler.registerTask(Ze.b.STAGE,this))}dispose(){this._handles.destroy(),this._layerRenderers.forEach((e=>e.dispose())),this._layerRenderers.clear(),this._debugTextureTechnique=Object(l.q)(this._debugTextureTechnique),this._debugPatternTexture=Object(l.f)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Object(l.f)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Object(l.f)(this._shaderTechniqueRepository),this._temporaryFBO=Object(l.f)(this._temporaryFBO),this._quadVAO=Object(l.f)(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedLayerRenderersDirty||Object(c.c)(this._layerRenderers,(e=>e.updating))}get hasOverlays(){return Object(l.k)(this._overlays)&&Object(l.k)(this._overlayRenderTarget)}get gpuMemoryUsage(){return Object(l.k)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}collectUnusedRenderTargetMemory(e){let t=!1;if(Object(l.k)(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Object(l.t)(this._overlays,[])}ensureDrapeTargets(e){Object(l.k)(this._overlays)&&this._overlays.forEach((t=>{t.hasTargetWithoutRasterImage=Object(u.a)(e,(e=>1===e.drapeTargetType))}))}ensureDrapeSources(e){Object(l.k)(this._overlays)&&this._overlays.forEach((t=>{t.hasDrapedFeatureSource=Object(c.c)(e,((e,t)=>1===t.drapeSourceType)),t.hasDrapedRasterSource=Object(c.c)(e,((e,t)=>0===t.drapeSourceType))}))}ensureOverlays(e,t){Object(l.j)(this._overlays)&&(this._overlayRenderTarget=new A(this._rctx),this._overlays=[new j(0,this._overlayRenderTarget),new j(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Object(l.f)(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=(()=>!0)){let i=!1;for(const[r,n]of this._layerRenderers){if(e.done)break;t(r)&&(n.commitChanges()&&(i=!0,e.madeProgress()),n.isEmpty&&(this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(r),this._handles.remove(r)))}this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),i=!0),i&&(Object(l.k)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}processSyncLayers(){this.runTask(Ze.c,(e=>1===e.updatePolicy))}addGeometries(e,t,i){for(const r of e)Object(l.j)(r.origin)&&(r.origin=this._localOrigins.getOrigin(r.boundingSphere)),this._geometries.set(r.id,r);this.ensureLayerRenderer(t).add(e),2===i&&this.notifyGraphicGeometryChanged(e,t)}removeGeometries(e,t,i){for(const n of e)this._geometries.delete(Object(l.s)(n.id));const r=this._layerRenderers.get(t);r&&(r.remove(e),2===i&&this.notifyGraphicGeometryChanged(e,t))}updateGeometries(e,t,i){const r=this._layerRenderers.get(t);if(r)switch(r.modify(e,i),i){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else $e.warn("Attempted to update geometry for nonexistent layer")}notifyGraphicGeometryChanged(e,t){if(Object(l.j)(t.notifyGraphicGeometryChanged))return;let i;for(const r of e){const e=r.graphicUid;Object(l.k)(e)&&e!==i&&(t.notifyGraphicGeometryChanged(e),i=e)}}notifyGraphicVisibilityChanged(e,t){if(Object(l.j)(t.notifyGraphicVisibilityChanged))return;let i;for(const r of e){const e=r.graphicUid;Object(l.k)(e)&&e!==i&&(t.notifyGraphicVisibilityChanged(e),i=e)}}updateHighlights(e,t){const i=this._layerRenderers.get(t);i?i.modify(e,8):$e.warn("Attempted to update highlights for nonexistent layer")}isEmpty(){return 0===this._geometries.size&&!v.a.OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateLogic(e){let t=!1;return this._layerRenderers.forEach((i=>t=i.updateLogic(e)||t)),t}updateLayerOrder(){this._sortedLayerRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(0===r.numViews)return!1;const n=e.pixelRatio*i;this._screenToWorldRatio=n*Math.abs(r.extents[0][2]-r.extents[0][0])/e.resolution;const a=t.renderPass;if(this.isEmpty()||5===a&&!this.hasHighlights||3===a&&!this.hasWater)return!1;if(!e.hasSomeSizedView())return!1;const s=t.fbo,o=2*e.resolution,c=e.resolution,h=1===t.type?2:4===t.type?1:0;if(!s.isValid())return!1;s.resize(o,c);const u=this._rctx;if(Ke.pixelRatio=n||1,this._renderContext.pass=a,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===a?24:23,e.applyViewport(this._rctx),s.bind(u),0===e.index&&(u.setClearColor(0,0,0,0),u.clearSafe(16384)),1===h&&(this._renderContext.renderOccludedMask=it),v.a.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==h)for(let l=0;l<r.numViews;l++)this.setViewParameters(r.extents[l],e,Ke),this.drawDebugTexture(e.resolution,Qe[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((({layerView:t,renderer:i})=>{if(2===h&&Object(l.k)(t)&&0===t.drapeSourceType)return;const n=Object(l.k)(t)&&Object(l.k)(t.fullOpacity)&&t.fullOpacity<1&&0===a;n&&(this.bindTemporaryFramebuffer(this._rctx,o,c),u.clearSafe(16384));for(let a=0;a<r.numViews;a++)this.setViewParameters(r.extents[a],e,Ke),i.render(this._renderContext,this._bindParameters);n&&Object(l.k)(this._temporaryFBO)&&(s.bind(u),this.view._stage.renderView.compositingHelper.composite(this._temporaryFBO.getTexture(),2,Object(l.s)(Object(l.s)(t).fullOpacity),3,e.index))})),u.bindFramebuffer(null),s.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){Object(l.j)(this._temporaryFBO)&&(this._temporaryFBO=new P(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.hotReload()}intersect(e,t,i){let r=0;this._geometries.forEach((n=>{if(i&&!i(n))return;this.intersectRenderGeometry(n,t,0,e,r);const a=this.longitudeCyclical;a&&(n.boundingSphere[0]-n.boundingSphere[3]<a.min&&this.intersectRenderGeometry(n,t,a.range,e,r),n.boundingSphere[0]+n.boundingSphere[3]>a.max&&this.intersectRenderGeometry(n,t,-a.range,e,r)),r++}))}intersectRenderGeometry(e,t,i,r,n){if(!e.instanceParameters.visible)return;let a=0;Object(l.k)(e.transformation)&&(i+=e.transformation[12],a=e.transformation[13]),Je[0]=t[0]-i,Je[1]=t[1]-a,Je[2]=1,et[0]=t[0]-i,et[1]=t[1]-a,et[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),r,Je,et,((t,i,a)=>{this.addIntersectionResult(a,e.material.renderPriority,n,r,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,!0)}addIntersectionResult(e,t,i,r,n,a){const s={type:"external",metadata:{layerUid:n,graphicUid:a}},o=n=>{n.set(s,null,r.results.ground.dist,r.results.ground.normal,r.results.ground.transformation,t,null,null,e,i),n.intersector="OverlayRenderer"};if((null==r.results.min.drapedLayerOrder||t>=r.results.min.drapedLayerOrder)&&(null==r.results.min.dist||r.results.ground.dist<=r.results.min.dist)&&o(r.results.min),0!==r.options.store&&(null==r.results.max.drapedLayerOrder||t<r.results.max.drapedLayerOrder)&&(null==r.results.max.dist||r.results.ground.dist>r.results.max.dist)&&o(r.results.max),2===r.options.store){const e=new q.a(r.ray);o(e),r.results.all.push(e)}}ensureLayerRenderer(e){let t=this._layerRenderers.get(e);return t||(t=new be({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,t),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(()=>this.events.emit("content-changed"))),e),this._handles.add(Object(d.a)(t,"updating",(()=>this.notifyChange("updating"))),e)),t}updateSortedLayerRenderers(){if(!this._sortedLayerRenderersDirty)return;if(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0===this._layerRenderers.size)return;const e=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach((t=>{const i=t,r=this._layerRenderers.get(i);r&&(this._sortedLayerRenderers.push(new Xe(i,r)),e.delete(r))})),e.forEach((e=>this._sortedLayerRenderers.push(new Xe(null,e))))}setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,Object(b.p)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),Object(b.j)(i.viewMatrix),Object(b.t)(i.viewMatrix,i.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=i,this._bindParameters.camera=i,this._bindParameters.inverseViewport[0]=1/i.fullViewport[2],this._bindParameters.inverseViewport[1]=1/i.fullViewport[3]}updateHasWater(){const e=Object(c.c)(this._layerRenderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}updateHasHighlights(){const e=Object(c.c)(this._layerRenderers,(e=>e.hasHighlights));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}updateRendersOccluded(){const e=Object(c.c)(this._layerRenderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}drawDebugTexture(e,t){const i=this._rctx;this.ensureDebugPatternResources(e,e);const r=this._debugTextureTechnique.program;i.useProgram(r),i.setPipelineState(this._debugTextureTechnique.pipeline),r.setUniform4f("color",t[0],t[1],t[2],1),r.bindTexture(this._debugPatternTexture,"tex"),i.bindVAO(this._quadVAO),i.drawArrays(5,0,Object(ce.f)(this._quadVAO,"geometry"))}ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let a=0;a<t;a++)for(let n=0;n<e;n++){const s=Math.floor(n/10),o=Math.floor(a/10);s<2||o<2||10*s>e-20||10*o>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&s&&1&o?1&n^1&a?0:255:1&s^1&o?0:128)}this._debugPatternTexture=new E.a(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},i);const n=new we;n.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(xe,n),this._quadVAO=Object(N.b)(this._rctx)}get test(){return{layerRenderers:this._layerRenderers}}};Object(r.a)([Object(z.c)()],Ye.prototype,"_shaderTechniqueRepository",void 0),Object(r.a)([Object(z.c)()],Ye.prototype,"_stippleTextureRepository",void 0),Object(r.a)([Object(p.b)({constructOnly:!0})],Ye.prototype,"view",void 0),Object(r.a)([Object(p.b)()],Ye.prototype,"worldToPCSRatio",void 0),Object(r.a)([Object(p.b)()],Ye.prototype,"spatialReference",void 0),Object(r.a)([Object(p.b)({type:Boolean,readOnly:!0})],Ye.prototype,"updating",null),Ye=Object(r.a)([Object(f.a)("esri.views.3d.terrain.OverlayRenderer")],Ye);class Xe{constructor(e,t){this.layerView=e,this.renderer=t}}const Qe=[[1,.5,.5],[.5,.5,1]],Ke=new L.a;Ke.near=1,Ke.far=1e4,Ke.relativeElevation=null;const Je=Object(m.e)(),et=Object(m.e)(),tt=-2,it=4},736:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));i(79);var r=i(85),n=i(168),a=i(111),s=i(101),o=i(284);class c{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}}var l=i(640),h=i(627),u=i(385);const d=1e-5;class p{constructor(e){this.options=new c,this.results=new l.b,this.transform=new h.a,this.performanceInfo={queryDuration:0,numObjectsTested:0},this.tolerance=d,this.verticalOffset=null,this._ray={origin:Object(s.e)(),direction:Object(s.e)()},this._rayEndPoint=Object(s.e)(),this._rayStartPointTransformed=Object(s.e)(),this._rayEndPointTransformed=Object(s.e)(),this.viewingMode=null==e?1:e}get ray(){return this._ray}get rayBeginPoint(){return this._ray.origin}get rayEndPoint(){return this._rayEndPoint}reset(e,t){this.resetWithRay(Object(o.e)(e,t,this._ray))}resetWithRay(e){e!==this._ray&&Object(o.b)(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Object(a.f)(this._rayEndPoint,this._ray.origin,this._ray.direction),this._numObjectsTested=0,this.results.init(this._ray)}intersect(e=null,t,i,n,a,s){this.point=t,this.camera=i,this.filterPredicate=a,this.tolerance=null==n?d:n;const o=Object(h.c)(this.verticalOffset);if(Object(r.k)(e)&&e.length>0){const t=s?e=>{s(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){const e=i.getSpatialQueryAccelerator&&i.getSpatialQueryAccelerator();Object(r.k)(e)?(Object(r.k)(o)?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,o):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){this._numObjectsTested++;const t=e.geometryRecords;if(!t)return;const i=e.id,s=e.transformation;let o;const c=Object(h.c)(this.verticalOffset);for(const h of t){const{geometry:t,material:d,instanceParameters:p}=h;if(Object(u.e)(p))continue;o=t.id,this.transform.setAndInvalidateLazyTransforms(s,h.getShaderTransformation()),Object(a.q)(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse),Object(a.q)(this._rayEndPointTransformed,this._rayEndPoint,this.transform.inverse);const f=this.transform.transform;Object(r.k)(c)&&(c.objectTransform=this.transform),d.intersect(t,p,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,((t,a,s,c,h,u)=>{if(t>=0){if(Object(r.k)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEndPoint,t))return;const d=`Object3D ${i}`;if(h)return void((null==this.results.hud.dist||t<this.results.hud.dist)&&this.results.hud.set(e,d,t,a,n.a,c,u,o,s));const p=i=>i.set(e,d,t,a,f,c,null,o,s);if((null==this.results.min.drapedLayerOrder||c>=this.results.min.drapedLayerOrder)&&(null==this.results.min.dist||t<this.results.min.dist)&&p(this.results.min),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||c<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||t>this.results.max.dist)&&p(this.results.max),2===this.options.store){const e=new l.a(this._ray);p(e),this.results.all.push(e)}}}),h.shaderTransformation)}}sortResults(){this.results.all.sort(((e,t)=>e.dist!==t.dist?e.dist-t.dist:e.drapedLayerOrder!==t.drapedLayerOrder?(void 0!==e.drapedLayerOrder?e.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==t.drapedLayerOrder?t.drapedLayerOrder:Number.MAX_VALUE):(void 0!==t.drapedLayerGraphicOrder?t.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==e.drapedLayerGraphicOrder?e.drapedLayerGraphicOrder:Number.MIN_VALUE)))}}p.DEFAULT_TOLERANCE=d},745:function(e,t,i){"use strict";i.d(t,"a",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return l})),i.d(t,"e",(function(){return o})),i.d(t,"f",(function(){return c}));var r=i(107),n=i(485),a=i(384),s=i(111);function o(e=p){return[e[0],e[1],e[2],e[3]]}function c(e,t,i=o()){return Object(s.k)(i,e),i[3]=t,i}function l(e,t,i=o()){return Object(n.h)(f,e,d(e)),Object(n.h)(b,t,d(t)),Object(n.f)(f,b,f),function(e,t){return e[3]=t,e}(i,Object(r.r)(Object(n.b)(i,f)))}function h(e){return e}function u(e){return e[3]}function d(e){return Object(r.h)(e[3])}const p=[0,0,1,0],f=Object(a.b)(),b=Object(a.b)();o()},750:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i(85),n=i(192),a=i(180),s=i(111),o=i(101),c=i(593),l=i(284),h=i(430),u=i(220);class d{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new p,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),p.clearPool(),w[0]=null,P.prune(),z.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=p.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}p.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=p.acquire();for(const n of e){const e=Object(r.k)(t)?t:Object(h.d)(this._objectToBoundingSphere(n),A);y(e[3])?(i.init(this._root),this._remove(n,e,i)):this._degenerateObjects.delete(n)}p.release(i),this._shrink()}update(e,t){if(!y(t[3])&&this._isDegenerate(e))return;const i=function(e){return w[0]=e,w}(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=Object(l.g)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,r){const n=Object(l.g)(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNodeWithOffset(n,e,r))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(n,e,r)&&i(e)})),!0}))}forEach(e){this._forEachNode(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),n=1/0){let a=1/0,o=1/0,l=null;const u=v(e,t),d=s=>{if(--n,!r(s))return;const u=this._objectToBoundingSphere(s);if(!Object(c.e)(i,u))return;const d=O(e,t,Object(h.c)(u)),p=d-u[3],f=d+u[3];p<a&&(a=p,o=f,l=s)};return this._forEachNodeDepthOrdered(this._root,(r=>{if(n<=0||!Object(c.e)(i,r.bounds))return!1;if(Object(s.e)(S,u,r.halfSize),Object(s.f)(S,S,r.bounds),O(e,t,S)>o)return!1;const a=r.node;return a.terminals.forAll((e=>d(e))),null!==a.residents&&a.residents.forAll((e=>d(e))),!0}),e,t),l}forEachInDepthRange(e,t,i,r,n,a,o){let l=-1/0,u=1/0;const d={setRange:e=>{1===i?(l=Math.max(l,e.near),u=Math.min(u,e.far)):(l=Math.max(l,-e.far),u=Math.min(u,-e.near))}};d.setRange(r);const p=O(t,i,e),f=v(t,i),b=v(t,-i),g=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),s=Object(h.c)(r),f=O(t,i,s)-p,b=f-r[3],g=f+r[3];b>u||g<l||!Object(c.e)(a,r)||n(e,d)};this._forEachNodeDepthOrdered(this._root,(e=>{if(!Object(c.e)(a,e.bounds))return!1;if(Object(s.e)(S,f,e.halfSize),Object(s.f)(S,S,e.bounds),O(t,i,S)-p>u)return!1;if(Object(s.e)(S,b,e.halfSize),Object(s.f)(S,S,e.bounds),O(t,i,S)-p<l)return!1;const r=e.node;return r.terminals.forAll((e=>g(e))),null!==r.residents&&r.residents.forAll((e=>g(e))),!0}),t,i)}forEachNode(e){this._forEachNode(this._root,(t=>e(t.node,t.bounds,t.halfSize)))}_intersectsNode(e,t){return g(t.bounds,2*-t.halfSize,E),g(t.bounds,2*t.halfSize,T),Object(u.i)(e.origin,e.direction,E,T)}_intersectsNodeWithOffset(e,t,i){return g(t.bounds,2*-t.halfSize,E),g(t.bounds,2*t.halfSize,T),i.applyToMinMax(E,T),Object(u.i)(e.origin,e.direction,E,T)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||Object(h.e)(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||Object(h.e)(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=p.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(p.acquire().init(i).advance(e));p.release(i)}}_forEachNodeDepthOrdered(e,t,i,r=1){let n=p.acquire().init(e);const a=[n];for(function(e,t,i){if(!z.length)for(let r=0;r<8;++r)z.push({index:0,distance:0});for(let r=0;r<8;++r){const i=_[r];z.data[r].index=r,z.data[r].distance=O(e,t,i)}z.sort(((e,t)=>e.distance-t.distance));for(let r=0;r<8;++r)i[r]=z.data[r].index}(i,r,L);0!==a.length;){if(n=a.pop(),t(n)&&!n.isLeaf())for(let e=7;e>=0;--e){const t=L[e];n.node.children[t]&&a.push(p.acquire().init(n).advance(t))}p.release(n)}}_remove(e,t,i){P.clear();const r=i.advanceTo(t,((e,t)=>{P.push(e.node),P.push(t)}))?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let n=P.length-2;n>=0;n-=2){const e=P.data[n],t=P.data[n+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new a.a({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=p.acquire().init(e);this._add(t.getItemAt(i),r),p.release(r)}}_grow(e,t){if(0!==t&&(m(e,t,(e=>this._objectToBoundingSphere(e)),C),y(C[3])&&!this._fitsInsideTree(C)))if(this._nodeIsEmpty(this._root.node))Object(h.d)(C,this._root.bounds),this._root.halfSize=1.25*C[3];else{const e=this._rootBoundsForRootAsSubNode(C);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(C,e):this._growRootAsSubNode(e),p.release(e)}}_rebuildTree(e,t){Object(s.k)(D,t.bounds),D[3]=t.halfSize,m([e,D],2,(e=>e),R);const i=p.acquire().init(this._root);this._root.initFrom(null,R,1.25*R[3]),this._forEachNode(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),p.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const n=this._root.bounds,a=this._root.halfSize;for(let s=0;s<3;s++){const e=n[s]-a-(i[s]-t),o=i[s]+t-(n[s]+a),c=Math.max(0,Math.ceil(e/(2*a))),l=Math.max(0,Math.ceil(o/(2*a)))+1,h=2**Math.ceil(Math.log(c+l)*Math.LOG2E);r=Math.max(r,h),I[s].min=c,I[s].max=l}for(let s=0;s<3;s++){let e=I[s].min,t=I[s].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const o=n[s]-a-e*a*2;M[s]=o+(t+e)*a}return M[3]=r*a*x,p.acquire().initFrom(null,M,r*a,0)}_growRootAsSubNode(e){const t=this._root.node;Object(s.k)(C,this._root.bounds),C[3]=this._root.halfSize,this._root.init(e),e.advanceTo(C,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!y(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class p{constructor(){this.bounds=Object(h.b)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,n=this.depth){return this.node=Object(r.k)(e)?e:p.createEmptyNode(),Object(r.k)(t)&&Object(h.d)(t,this.bounds),this.halfSize=i,this.depth=n,this}advance(e){let t=this.node.children[e];t||(t=p.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=_[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*x,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new a.a({shrink:!0}),residents:new a.a({shrink:!0})}}static acquire(){return p._pool.acquire()}static release(e){p._pool.release(e)}static clearPool(){p._pool.prune()}}function f(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function b(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function g(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function m(e,t,i,r){if(1===t){const t=i(e[0]);Object(h.d)(t,r)}else{E[0]=1/0,E[1]=1/0,E[2]=1/0,T[0]=-1/0,T[1]=-1/0,T[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);y(t[3])&&(f(E,t),b(T,t))}Object(s.i)(r,E,T,.5),r[3]=Math.max(T[0]-E[0],T[1]-E[1],T[2]-E[2])/2}}function v(e,t){let i=1/0,r=null;for(let n=0;n<8;++n){const a=O(e,t,j[n]);a<i&&(i=a,r=j[n])}return r}function O(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function y(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}p._pool=new n.a(p);const _=[Object(o.g)(-1,-1,-1),Object(o.g)(1,-1,-1),Object(o.g)(-1,1,-1),Object(o.g)(1,1,-1),Object(o.g)(-1,-1,1),Object(o.g)(1,-1,1),Object(o.g)(-1,1,1),Object(o.g)(1,1,1)],j=[Object(o.g)(-1,-1,-1),Object(o.g)(-1,-1,1),Object(o.g)(-1,1,-1),Object(o.g)(-1,1,1),Object(o.g)(1,-1,-1),Object(o.g)(1,-1,1),Object(o.g)(1,1,-1),Object(o.g)(1,1,1)],x=Math.sqrt(3),w=[null];const M=Object(h.b)(),S=Object(o.e)(),E=Object(o.e)(),T=Object(o.e)(),P=new a.a,A=Object(h.b)(),C=Object(h.b)(),D=Object(h.b)(),R=Object(h.b)(),I=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],z=new a.a,L=[0,0,0,0,0,0,0,0]},751:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r,n=i(304),a=i(505);!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:Object(a.c)(1,1,1),vvSizeMaxSize:Object(a.c)(100,100,100),vvSizeOffset:Object(a.c)(0,0,0),vvSizeFactor:Object(a.c)(1,1,1),vvSizeValue:Object(a.c)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:Object(n.b)()}}(r||(r={}));var s=r},752:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(r.a`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add("size","float"),e.vertex.code.add(r.a`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(r.a`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(r.a`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(r.a`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add("color","vec4"),e.vertex.code.add(r.a`vec4 getColor(){
return applyOpacity(color);
}`))}},753:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return p}));var r=i(80),n=i(533),a=i(157);const s=r.a.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function o(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}async function c(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const n=b(r);if(null!=n)return{cachedResult:n};const s=await Object(a.e)(),o=s.arcadeUtils,c=o.createSyntaxTree(r);return o.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(c),context:o.createExecContext(null,{sr:t}),modules:s}}}function l(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function h(e,t){if(null!=e&&!f(e)){if(!t||!e.arcade)return void s.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Object(n.b)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function u(e){if(null!=e){if(f(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}function d(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const p={cachedResult:0};function f(e){return null!=e.cachedResult}function b(e){return"0"===e?0:null}},754:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return a}));var r=i(311),n=i(113);function a(e){e.include(r.a),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(n.a`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function s(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},755:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return c}));var r=i(85);const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},a={dash:n.dash,"dash-dot":[...n.dash,...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null};function s(e){return Object(r.j)(e)?e:e.slice()}function o(e){return[e,e]}function c(e,t){return Object(r.c)(e,(e=>e.map((e=>e*t))))}function l(e){return Object(r.c)(e,(e=>s(a[e])))}},756:function(e,t,i){"use strict";i.d(t,"a",(function(){return f}));var r=i(85),n=i(168),a=i(111),s=i(101),o=i(178),c=i(421),l=i(658),h=i(468),u=i(597),d=i(547);let p=0;class f{constructor(e){this._originSR=e,this.ROOT_ORIGIN_ID="rg_root_"+p++,this._origins=new Map,this._gridSize=125e4,this._objects=new Map}getOrigin(e){const t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){if(Object(r.k)(b))return this._origins.set(this.ROOT_ORIGIN_ID,Object(l.a)(b[0],b[1],b[2],this.ROOT_ORIGIN_ID)),this.getOrigin(e);const t=Object(l.a)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,t),t}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),c=`rg_${n}/${s}/${o}`;let h=this._origins.get(c);const u=.5*i;if(Object(a.j)(g,e,t.vec3),g[0]=Math.abs(g[0]),g[1]=Math.abs(g[1]),g[2]=Math.abs(g[2]),g[0]<u&&g[1]<u&&g[2]<u){if(h){const t=Math.max(...g);if(Object(a.j)(g,e,h.vec3),g[0]=Math.abs(g[0]),g[1]=Math.abs(g[1]),g[2]=Math.abs(g[2]),Math.max(...g)<t)return h}return t}return h||(h=Object(l.a)(n*i,s*i,o*i,c),this._origins.set(c,h)),h}_drawOriginBox(e,t=[1,1,0,1]){const i=window.view,r=i._stage,a=t.toString();if(!this._objects.has(a)){this._material=new d.a({width:2,color:t}),r.add(this._material);const e=new u.a({isPickable:!1}),i=new h.a({castShadow:!1});r.add(i),e.add(i),r.add(e),this._objects.set(a,i)}const s=this._objects.get(a),l=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],p=l.length,f=new Array(3*p),b=new Uint16Array(2*(p-1)),g=.5*this._gridSize;for(let n=0;n<p;n++)f[3*n+0]=e[0]+(1&l[n]?g:-g),f[3*n+1]=e[1]+(2&l[n]?g:-g),f[3*n+2]=e[2]+(4&l[n]?g:-g),n>0&&(b[2*n+0]=n-1,b[2*n+1]=n);Object(o.m)(f,this._originSR,0,f,i.renderSpatialReference,0,p);const m=new c.a([["position",{size:3,data:f,exclusive:!0}]],[["position",b]],2);r.add(m),s.addGeometry(m,this._material,n.a)}get test(){const e=this;return{get gridSize(){return e._gridSize},set gridSize(t){e._gridSize=t}}}}let b=null;const g=Object(s.e)()},757:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(410),n=i(758);class a extends r.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(n.a,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(2===this._output)return 24===e;if(5===this._output)return 23===e;if(4===this._output)return 3===e||23===e;let t=3;return this._material.params.transparent&&(t=this._material.params.writeDepth?5:8),e===t}setElapsedTimeUniform(e){const t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.params.animationSpeed)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.params.receiveShadows&&this._material.setParameterValues({receiveShadows:e.shadowMappingEnabled})}_updateSSRState(e){e.ssrEnabled!==this._material.params.ssrEnabled&&this._material.setParameterValues({ssrEnabled:e.ssrEnabled})}ensureResources(e){return this._technique.ensureResource(e)}ensureParameters(e){0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.params,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(this._technique.program)}}},758:function(e,t,i){"use strict";i.d(t,"a",(function(){return O})),i.d(t,"b",(function(){return y}));var r=i(81),n=i(256),a=i(319),s=i(278),o=i(466),c=i(666),l=i(642),h=i(394),u=i(325),d=i(334),p=i(341),f=i(327),b=i(362),g=i(326),m=i(723),v=i(174);class O extends d.a{constructor(e,t,i){super(e,t,i),this._textureRepository=e.waterTextureRepository}initializeProgram(e){const t=O.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,viewingMode:e.viewingMode,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:i.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:i.useSSR,highStepCount:!0,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new g.a(e.rctx,r,f.a)}ensureResource(e){return this._textureRepository.ready||this._textureRepository.updating||this._textureRepository.loadTextures(e),this._textureRepository.ready?2:1}bindPass(e,t){Object(h.c)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(s.a)(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),Object(c.b)(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||(Object(l.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&Object(a.b)(this.program,t)}bindDraw(e){Object(h.d)(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||Object(h.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&Object(o.b)(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||Object(n.c)(this.program,this.configuration,e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e;return Object(v.f)({blending:2!==t.output&&4!==t.output&&t.transparent?i?b.f:Object(b.a)(e):null,depthTest:{func:Object(b.b)(e)},depthWrite:i?t.writeDepth&&v.d:Object(b.c)(e),colorWrite:v.c,polygonOffset:i||r?null:Object(b.g)(t.enableOffset)})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}O.shader=new u.a(m.a,(()=>i.e(319).then(i.bind(null,997))));class y extends p.a{constructor(){super(...arguments),this.output=0,this.receiveShadows=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.useSSR=!1,this.isDraped=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(r.a)([Object(p.b)({count:8})],y.prototype,"output",void 0),Object(r.a)([Object(p.b)()],y.prototype,"receiveShadows",void 0),Object(r.a)([Object(p.b)()],y.prototype,"slicePlaneEnabled",void 0),Object(r.a)([Object(p.b)()],y.prototype,"transparent",void 0),Object(r.a)([Object(p.b)()],y.prototype,"enableOffset",void 0),Object(r.a)([Object(p.b)()],y.prototype,"writeDepth",void 0),Object(r.a)([Object(p.b)()],y.prototype,"useSSR",void 0),Object(r.a)([Object(p.b)()],y.prototype,"isDraped",void 0),Object(r.a)([Object(p.b)({count:4})],y.prototype,"transparencyPassType",void 0),Object(r.a)([Object(p.b)()],y.prototype,"multipassTerrainEnabled",void 0),Object(r.a)([Object(p.b)()],y.prototype,"cullAboveGround",void 0)},761:function(e,t,i){"use strict";i.d(t,"a",(function(){return K}));var r=i(85),n=i(111),a=i(101),s=i(401),o=i(685),c=i(107),l=i(215),h=i(226),u=i(221),d=i(653),p=i(593),f=i(333),b=i(284),g=i(430),m=i(590),v=i(409),O=i(81),y=i(135),_=i(168),j=i(325),x=i(334),w=i(341),M=i(326),S=i(801),E=i(174);class T extends x.a{initializeProgram(e){const t=T.shader.get(),i=this.configuration,r=t.build(i);return new M.a(e.rctx,r,T.attributeLocations)}bind(e,t,i){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",i.projectionMatrix),Object(y.t)(A,i.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",A),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}initializePipeline(){return Object(E.f)({blending:Object(E.h)(1,771),colorWrite:E.c})}bindPipelineState(e){e.setPipelineState(this.pipeline)}}T.shader=new j.a(S.a,(()=>i.e(309).then(i.bind(null,1297)))),T.attributeLocations=new Map([["start",0],["end",1],["up",2],["extrude",3]]);class P extends w.a{constructor(){super(...arguments),this.contrastControlEnabled=!1}}Object(O.a)([Object(w.b)()],P.prototype,"contrastControlEnabled",void 0);const A=Object(_.d)();var C=i(212),D=i(216);class R{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=Object(a.e)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1],t[i++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);Object(n.w)(this._origin,e[t+0],e[t+1],e[t+2])}else Object(n.w)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this.ensureVAO(e);Object(r.k)(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}dispose(){Object(r.k)(this._vao)&&this._vao.dispose()}ensureVAO(e){return Object(r.j)(this._buffers)?null:(Object(r.j)(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const i=this.createDataBuffer(t);return this._dirty=!1,new D.a(e,T.attributeLocations,{data:Object(m.a)(L)},{data:C.a.createVertex(e,35044,i)})}ensureVertexData(e,t){if(!this._dirty)return;const i=this.createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}numberOfRenderVertices(e){return 2*(e.length/3-1)*3}createDataBuffer(e){const t=e.reduce(((e,t)=>e+this.numberOfRenderVertices(t)),0);this._count=t;const i=L.createBuffer(t),r=this._origin;let a=0,s=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=Object(n.w)(z,o[e+0],o[e+1],o[e+2]);0===e?s=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,s);const c=this._renderCoordsHelper.worldUpAtPosition(t,I),l=a+2*e,h=Object(n.j)(z,t,r);if(e<o.length-3){i.up.setVec(l,c),i.up.setVec(l+3,c),i.up.setVec(l+5,c);for(let e=0;e<6;e++)i.start.setVec(l+e,h);i.extrude.setValues(l+0,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,c),i.up.setVec(l-4,c),i.up.setVec(l-5,c);for(let e=-6;e<0;e++)i.end.setVec(l+e,h)}}a+=this.numberOfRenderVertices(o)}return i.buffer}}const I=Object(a.e)(),z=Object(a.e)(),L=Object(v.a)().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude");var V=i(613),F=i(220),k=i(348),G=i(327),U=i(655);class B extends x.a{initializeProgram(e){const t=B.shader.get(),i=this.configuration,r=t.build(i);return new M.a(e.rctx,r,G.a)}bind(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);const i=null!=e.angleCutoff?e.angleCutoff:U.c;this.program.setUniform2f("angleCutoff",Math.cos(i),Math.cos(Math.max(0,i-Object(c.h)(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}initializePipeline(){return Object(E.f)({blending:Object(E.h)(1,771),colorWrite:E.c})}}B.shader=new j.a(U.a,(()=>i.e(310).then(i.bind(null,1298))));class N extends w.a{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1}}Object(O.a)([Object(w.b)()],N.prototype,"heightManifoldEnabled",void 0),Object(O.a)([Object(w.b)()],N.prototype,"pointDistanceEnabled",void 0),Object(O.a)([Object(w.b)()],N.prototype,"lineVerticalPlaneEnabled",void 0),Object(O.a)([Object(w.b)()],N.prototype,"intersectsLineEnabled",void 0),Object(O.a)([Object(w.b)()],N.prototype,"contrastControlEnabled",void 0);const H=Object(a.e)(),q=Object(u.e)(),W={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Object(c.h)(6),globalAlphaContrastBoost:2};function Z(e,t,i,r){const a=H,s=q;Object(n.q)(a,t,r),Object(n.k)(s,i),s[3]=0,Object(h.m)(s,s,r),Object(f.g)(a,s,e)}class ${constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=Object(u.e)(),this._zScale=Object(l.a)(),this._heightManifoldEnabled=!1,this._heightManifoldTarget=Object(a.e)(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=Object(a.e)(),this._pointDistanceTarget=Object(a.e)(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=Object(s.d)(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=Object(s.d)(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=Object(a.e)(),this._tempDir=Object(a.e)(),this._tempUp=Object(a.e)(),this._tempVec3A=Object(a.e)(),this._tempVec3B=Object(a.e)(),this._tempVec4=Object(u.e)(),this._tempPlane=Object(f.d)(),this._tempSphere=Object(g.b)(),this._params=Object(k.c)(t,W)}get renderSlots(){return[this._config.contrastControlEnabled?18:17]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){Object(n.k)(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){Object(n.k)(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){Object(n.k)(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){Object(s.c)(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){Object(s.c)(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,Object(r.k)(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){Object(r.j)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new R(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){Object(r.j)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new R(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameterValues(e){Object(k.h)(this._params,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=Object(V.b)(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new N;const i=new P;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(T,i)}uninitializeRenderContext(){this._quadVAO=Object(r.f)(this._quadVAO),this._technique=Object(r.q)(this._technique),this._pathVerticalPlaneData=Object(r.f)(this._pathVerticalPlaneData),this._pathTechnique=Object(r.q)(this._pathTechnique)}render(e){const t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,i=this.pathVerticalPlaneEnabled;if(!t&&!i)return!0;const r=e.camera;return Object(F.f)(r.projectionMatrix,r.fullWidth,r.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),i&&this.renderPath(e),!0}renderUnified(e){const t=e.rctx,i=this._selectTechnique(),r=i.program;t.useProgram(r),i.bindPipelineState(t),this._bindGlobalUniforms(e,r),this.bindHeightManifoldUniforms(e,r),this.bindPointDistanceUniforms(e,r),this.bindLineVerticalPlaneUniforms(e,r),this.bindIntersectsLineUniforms(e,r),i.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}renderPath(e){if(Object(r.j)(this._pathVerticalPlaneData)||Object(r.j)(this._pathTechnique))return;const t=e.rctx,i=this._pathTechnique,n=i.program;t.useProgram(n),i.bindPipelineState(t),this._bindGlobalUniforms(e,n),i.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,r=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),Z(r,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",r)}bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,r=this._tempSphere;Object(n.k)(r,this._pointDistanceOrigin),Object(n.q)(r,r,i.viewMatrix),r[3]=Object(n.m)(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r[0],r[1],r[2],r[3])}bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,r=e.camera,a=this._tempPlane,o=this._tempVec3A,c=this._tempUp,l=this._tempDir,h=this._tempNormal;Object(s.h)(this._lineVerticalPlaneSegment,.5,o),i.worldUpAtPosition(o,c),Object(n.r)(l,this._lineVerticalPlaneSegment.vector),Object(n.g)(h,c,l),Object(n.r)(h,h),Z(a,this._lineVerticalPlaneSegment.origin,h,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",a);const u=this._tempVec3A;Object(n.k)(u,this._lineVerticalPlaneSegment.origin),i.setAltitude(u,0),Object(n.q)(u,u,r.viewMatrix),t.setUniform3fv("lineVerticalStart",u);const d=this._tempVec3B;Object(n.f)(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(d,0),Object(n.q)(d,d,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",d)}bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=X,r=Q;if(this._intersectsLineInfinite){const t=e.camera;if(Object(d.c)(Object(b.g)(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),Y),Y.c0=-Number.MAX_VALUE,!Object(p.d)(t.frustum,Y))return;Object(d.e)(Y,i),Object(d.d)(Y,r)}else Object(n.k)(i,this._intersectsLineSegment.origin),Object(n.f)(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const a=this._tempVec3A;Object(n.q)(a,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",a);const s=this._tempVec4;Object(n.k)(s,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Object(h.m)(this._tempVec4,this._tempVec4,e.camera.viewMatrix),Object(n.q)(r,r,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),Object(n.r)(s,s),t.setUniform3f("intersectsLineDirection",s[0],s[1],s[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}_bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",i.near,i.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor")}_requestRender(){this._context&&this._context.requestRender()}_selectTechnique(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(B,this._techniqueConfig,this._technique),this._technique}}const Y=Object(d.a)(),X=Object(a.e)(),Q=Object(a.e)();class K extends o.a{constructor(e){super(e.view),this._angleCutoff=U.c,this._style={},this._heightManifoldTarget=Object(a.e)(),this._heightManifoldEnabled=!1,this._intersectsLine=Object(s.d)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this.ensureRenderer()}destroyResources(){this.disposeRenderer()}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this.syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){Object(r.k)(e)?(Object(n.k)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(Object(r.j)(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,J);this.intersectsLine=Object(s.g)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){Object(r.k)(e)?(Object(s.c)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=Object(r.k)(e)?Object(s.c)(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=Object(r.k)(e)?{origin:Object(a.c)(e.origin),target:Object(a.c)(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||Object(r.k)(this._pointDistanceLine)||Object(r.k)(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}ensureRenderer(){Object(r.k)(this.renderer)||(this.renderer=new $(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}syncStyle(){Object(r.j)(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}syncAngleCutoff(){Object(r.j)(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})}syncHeightManifold(){Object(r.j)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}syncIntersectsLine(){Object(r.j)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}syncIntersectsLineInfinite(){Object(r.j)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}syncPathVerticalPlane(){Object(r.j)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=Object(r.k)(this._pathVerticalPlaneBuffers)&&this.visible,Object(r.k)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}syncLineVerticalPlane(){Object(r.j)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=Object(r.k)(this._lineVerticalPlaneSegment)&&this.visible,Object(r.k)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}syncPointDistance(){Object(r.j)(this.renderer)||(this.renderer.pointDistanceEnabled=Object(r.k)(this._pointDistanceLine)&&this.visible,Object(r.k)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}disposeRenderer(){Object(r.k)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const J=Object(a.e)()},763:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i(659),n=i(113);function a(e){e.fragment.code.add(n.a`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var s=i(578),o=i(666);function c(e,t){e.include(s.a,t),e.include(a),e.include(r.a),t.ssrEnabled&&e.include(o.a,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add(n.a`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),e.fragment.code.add(n.a`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {
float reflectionHit = 0.;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}`),t.ssrEnabled?e.fragment.code.add(n.a`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);
float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
}
float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
}`):e.fragment.code.add(n.a`return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
}`)}},800:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return l})),i.d(t,"c",(function(){return c}));var r=i(85),n=i(102),a=i(373),s=i(338);class o{constructor(e,t,i,r=null){this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=r}screenToMap(e){if(Object(r.k)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.g)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(n.g)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(r.k)(t)&&(t.z=void 0),t}mapToScreen(e){const t=Object(a.g)(e.x,e.y,Object(s.a)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class c{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return Object(r.k)(t)&&(t.z=Object(s.g)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return Object(r.k)(this.elevationInfo)&&(t=Object(a.g)(e.x,e.y,Object(s.a)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class l{constructor(e){this.view=e,this.screenToMap=t=>e.toMap(t),this.mapToScreen=t=>e.toScreen(t)}}},801:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var r=i(695),n=i(113),a=i(271);function s(e){const t=new a.a;return t.include(r.a,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(n.a`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = uModelViewMatrix * vec4(pos, 1);
vec4 projPos = uProjectionMatrix * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;
vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(n.a`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}var o=Object.freeze({__proto__:null,build:s})},802:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(85),n=i(410);class a extends n.a{constructor(e){super(e),this._textureIDs=new Set,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._initTransparent=!!e.initTextureTransparent,this._texture=this._acquire(this._textureId),this._textureNormal=this._acquire(e.normalTextureId),this._textureEmissive=this._acquire(e.emissiveTextureId),this._textureOcclusion=this._acquire(e.occlusionTextureId),this._textureMetallicRoughness=this._acquire(e.metallicRoughnessTextureId)}dispose(){this._textureIDs.forEach((e=>this._textureRepository.release(e))),this._textureIDs.clear()}updateTexture(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))}bindTextures(e){Object(r.k)(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),Object(r.k)(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(r.k)(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(r.k)(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(r.k)(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(e){const t=Object(r.k)(this._texture)&&this._texture.glTexture;t&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(e){if(!Object(r.j)(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}_release(e){Object(r.j)(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}},803:function(e,t,i){"use strict";i.d(t,"a",(function(){return p})),i.d(t,"b",(function(){return d}));var r=i(725),n=i(256),a=i(376),s=i(311),o=i(278),c=i(331),l=i(367),h=i(113),u=i(271);function d(e){const t=new u.a;return t.include(a.a,{linearDepth:!1}),t.include(r.a,{}),t.include(n.a,e),t.fragment.include(l.a),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.fragment.uniforms.add("color","vec4"),t.attributes.add("position","vec3"),t.varyings.add("vWorldPosition","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add("offset","vec3"),e.shadingEnabled&&(t.vertex.uniforms.add("viewNormal","mat4"),t.fragment.uniforms.add("shadedColor","vec4").add("shadingDirection","vec3"),t.attributes.add("normal","vec3"),t.varyings.add("vViewNormal","vec3")),t.vertex.code.add(h.a`
    void main(void) {
      vWorldPosition = ${e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),e.shadingEnabled&&t.vertex.code.add(h.a`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),t.vertex.code.add(h.a`
    ${e.multipassTerrainEnabled?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),e.multipassTerrainEnabled&&(t.fragment.include(s.a),t.include(o.b,e)),t.fragment.code.add(h.a`
    void main() {
      discardBySlice(vWorldPosition);
      ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),e.shadingEnabled?t.fragment.code.add(h.a`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(color, shadedColor, shadingFactor);`):t.fragment.code.add(h.a`vec4 finalColor = color;`),t.fragment.code.add(h.a`
      if (finalColor.a < ${h.a.float(c.c)}) {
        discard;
      }
      ${7===e.output?h.a`gl_FragColor = vec4(finalColor.a);`:""}

      ${0===e.output?h.a`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),t}var p=Object.freeze({__proto__:null,build:d})},815:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var r=i(81),n=i(122),a=i(160),s=i(87),o=i(85),c=i(89),l=i(102),h=i(83),u=(i(84),i(79),i(80),i(82)),d=i(399);class p{constructor({grabbableForEvent:e}){this.events=new n.a,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}var f=i(652),b=i(683),g=i(400),m=i(517),v=i(596),O=i(609),y=i(684),_=i(456);let j=class extends(n.a.EventedMixin(a.a)){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingPipeline=new y.a,this._snappingTask=null,this._stagedVertex=null,this.snapToSceneEnabled=null,Object(o.j)(e.elevationInfo)&&(this.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0})}initialize(){var e,t;this.coordinateHelper=Object(b.a)(this.hasZ,this.hasM,this.view.spatialReference);const i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=i?i.registerTask(_.b.SNAPPING):_.a;const r="viewingMode"in this.view.state?this.view.state.viewingMode:2,n="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new v.a(new m.c(n,this.coordinateHelper,r)),this._activeComponent=new m.a(this.spatialReference,r),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),i=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}}))),this._manipulator=new p({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(e=>this._onImmediateClick(e))),this._manipulator.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e)))])}destroy(){this._editGeometryOperations=Object(o.e)(this._editGeometryOperations),this._frameTask=Object(o.r)(this._frameTask)}get _snappingEnabled(){return Object(o.k)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}set drawingMode(e){this._set("drawingMode",null!=e?e:f.a)}get hasStagedVertex(){return Object(o.k)(this._stagedVertex)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return Object(o.k)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get spatialReference(){return this.view.spatialReference}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if(Object(o.j)(e))this.discardStagedVertex();else if(!Object(o.k)(this._stagedVertex)||!Object(d.a)(this._stagedVertex,e)){if(Object(o.j)(this._stagedVertex))this._stagedVertex=Object(s.a)(e);else{if(Object(d.a)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return Object(o.k)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingTask=Object(o.a)(this._snappingTask),Object(o.k)(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;Object(o.a)(this._snappingTask),Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();const i="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"})}discardStagedVertex(){this._stagedVertex=null}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Object(g.e)(e,((e,t,i,r)=>{const n="touch"===r&&this._snappingEnabled;!this.isCompleted&&n&&(t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||n&&0===this.numVertices)&&this.commitStagedVertex()),e))).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>n,cancel:i,snappingManager:this.snappingManager,snappingContext:new O.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((e=>(n&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e))),i.next((()=>{n&&Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping()})))}))}_createManipulatorDragPipelineFreehand(e){return Object(g.e)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return Object(g.e)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}_getDrawSurface(){if(Object(o.j)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;Object(o.k)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(o.k)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(o.k)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_onHold(e){Object(o.a)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if(Object(o.k)(i))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();const r=this._screenToMap(e.screenPoint);if(Object(o.k)(r))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),this.complete());break;case"click":case"hybrid":this._snappingTask=Object(o.a)(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){if(Object(o.a)(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=Object(l.f)(e.x,e.y),i=this._closeOnClickVertexIndex(t);if(Object(o.k)(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);if(this._manipulator.cursor=Object(o.k)(i)?"crosshair":null,Object(o.k)(i))if(Object(o.k)(this.snappingManager)){const t=this.snappingManager,r=new O.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=t.update(i,r),this._snappingTask=Object(c.h)((async e=>{const n=await this._frameTask.schedule((()=>t.snap(i,r,e)),e);n.valid&&await this._frameTask.schedule((()=>{this.stagedVertex=n.apply()}),e)})),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=i}e.stopPropagation()}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),Object(o.j)(e))return null;const i=this._screenToMap(t.screenEnd);return Object(o.k)(i)?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!Object(o.k)(i)&&function(e,t,i){const r=e.x-t.x,n=e.y-t.y;return r*r+n*n<=i}(i,t,25)}};Object(r.a)([Object(h.b)()],j.prototype,"defaultZ",void 0),Object(r.a)([Object(h.b)({value:f.a})],j.prototype,"drawingMode",null),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"elevationDrawSurface",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"elevationInfo",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"geometryType",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"hasM",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"hasZ",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"manipulators",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"drawSurface",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"snappingManager",void 0),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"snappingVisualizer",void 0),Object(r.a)([Object(h.b)()],j.prototype,"snapToSceneEnabled",void 0),Object(r.a)([Object(h.b)({readOnly:!0})],j.prototype,"updating",null),Object(r.a)([Object(h.b)({constructOnly:!0})],j.prototype,"view",void 0),j=Object(r.a)([Object(u.a)("esri.views.draw.DrawOperation")],j)},849:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i(113);function n(e){const t=r.a`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=r.a`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}},850:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(85),n=i(234),a=i(135),s=i(168),o=i(111),c=i(221),l=i(490),h=i(445),u=i(686),d=i(385);class p{constructor(e,t,i=null,r=null,a=Object(n.a)(),o=null,l=null,h=!1){this.data=e,this.material=t,this.layerUid=i,this.graphicUid=r,this.id=a,this.boundingInfo=o,this.calculateShaderTransformation=l,this.castShadow=h,this.boundingSphere=Object(c.e)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=Object(s.d)(),this._shaderTransformationDirty=!0}get transformation(){return this._transformation}updateTransformation(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(e,t,i=Object(l.d)(e)){Object(r.j)(this.boundingInfo)||(Object(o.q)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*i)}get hasShaderTransformation(){return Object(r.k)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return Object(r.j)(this.calculateShaderTransformation)?Object(r.t)(this.transformation,s.a):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Object(s.d)()),Object(a.f)(this._shaderTransformation,this.calculateShaderTransformation(Object(r.t)(this.transformation,s.a))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(r.k)(this._transformation)&&Object(o.q)(e,e,this._transformation),!0);const t=this.indices.get("position"),i=this.vertexAttributes.get("position");return!!Object(h.c)(i,t,e)&&(Object(r.k)(this._transformation)&&Object(o.q)(e,e,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const e=new u.a(0),t=this.instanceParameters;return t.highlights=Object(d.b)(t.highlights,e),e}removeHighlight(e){const t=this.instanceParameters;t.highlights=Object(d.g)(t.highlights,e)}}},851:function(e,t,i){"use strict";i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return b})),i.d(t,"c",(function(){return m})),i.d(t,"d",(function(){return g}));var r=i(85),n=i(168),a=i(101),s=i(178),o=i(267),c=i(264),l=i(373),h=i(478),u=i(443),d=i(468);const p=Object(a.e)();function f(e,t,i,a,c,l,u,f,b,g){const m=i?i.length:0,v=e.clippingExtent;if(Object(s.q)(t,p,e.elevationProvider.spatialReference),Object(r.k)(v)&&!Object(o.e)(v,p))return null;const O=e.renderCoordsHelper.spatialReference;Object(s.q)(t,p,O);const y=e.localOriginFactory.getOrigin(p),_=new d.a({castShadow:!1,metadata:{layerUid:f,graphicUid:b,usesVerticalDistanceToGround:!0}});for(let r=0;r<m;r++){const e=c?c[r]:n.a;_.addGeometry(i[r],a[r],e,l,y,g)}return{object:_,sampledElevation:Object(h.b)(_,t,e.elevationProvider,e.renderCoordsHelper,u)}}function b(e,t,i){const r=e.elevationContext,n=i.spatialReference;Object(s.q)(t,p,n),r.centerPointInElevationSR=Object(l.g)(p[0],p[1],t.hasZ?p[2]:0,n)}function g(e){switch(e.type){case"point":return e;case"polygon":case"extent":return Object(u.a)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=Object(c.f)(t,Object(c.e)(t)/2);return Object(l.g)(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function m(e,t,i,r,n){const a=new Float64Array(3*e.length),s=new Float64Array(a.length);e.forEach(((e,t)=>{a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));const o=Object(h.c)(a,t,0,s,0,a,0,a.length/3,i,r,n),c=null!=o;return{numVertices:e.length,position:a,mapPosition:s,projectionSuccess:c,sampledElevation:o}}},864:function(e,t,i){"use strict";i.d(t,"a",(function(){return A}));var r=i(111),n=i(101),a=i(267),s=i(342),o=i(409),c=i(410),l=i(375),h=i(220),u=i(514),d=i(348),p=i(81),f=i(221),b=i(725),g=i(256),m=i(278),v=i(394),O=i(325),y=i(334),_=i(341),j=i(362),x=i(326),w=i(803),M=i(174);class S extends y.a{initializeProgram(e){const t=S.shader.get(),i=this.configuration,r=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new x.a(e.rctx,r,T)}bindPass(e,t){const{screenSizeEnabled:i,shadingEnabled:r}=this.configuration,{color:n,shadingTint:a,shadingDirection:s}=e;Object(v.c)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("color",n),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Object(m.a)(this.program,t)),r&&(this.program.setUniform4fv("shadedColor",this.blendColor(P,a,n)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix)),i&&Object(b.b)(this.program,e,t)}bindDraw(e){Object(v.d)(this.program,e),Object(v.a)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),Object(g.c)(this.program,this.configuration,e),this.program.rebindTextures()}blendColor(e,t,i){const r=1-t[3],n=t[3]+i[3]*r;return 0===n?(e[3]=n,e):(e[0]=(t[0]*t[3]+i[0]*i[3]*r)/n,e[1]=(t[1]*t[3]+i[1]*i[3]*r)/n,e[2]=(t[2]*t[3]+i[2]*i[3]*r)/n,e[3]=i[3],e)}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e;return Object(M.f)({blending:0!==t.output&&7!==t.output||!t.transparent?null:i?j.f:Object(j.a)(e),culling:Object(M.b)(t.cullFace),depthTest:{func:r?513:t.shadingEnabled?515:513},depthWrite:i?t.writeDepth&&M.d:Object(j.c)(e),colorWrite:M.c,polygonOffset:i||r?null:j.d})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}S.shader=new O.a(w.a,(()=>i.e(317).then(i.bind(null,1304))));class E extends _.a{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Object(p.a)([Object(_.b)({count:8})],E.prototype,"output",void 0),Object(p.a)([Object(_.b)({count:3})],E.prototype,"cullFace",void 0),Object(p.a)([Object(_.b)()],E.prototype,"slicePlaneEnabled",void 0),Object(p.a)([Object(_.b)()],E.prototype,"transparent",void 0),Object(p.a)([Object(_.b)()],E.prototype,"writeDepth",void 0),Object(p.a)([Object(_.b)()],E.prototype,"screenSizeEnabled",void 0),Object(p.a)([Object(_.b)()],E.prototype,"shadingEnabled",void 0),Object(p.a)([Object(_.b)({count:4})],E.prototype,"transparencyPassType",void 0),Object(p.a)([Object(_.b)()],E.prototype,"multipassTerrainEnabled",void 0),Object(p.a)([Object(_.b)()],E.prototype,"cullAboveGround",void 0);const T=new Map([["position",0],["normal",1],["offset",2]]),P=Object(f.e)();class A extends l.a{constructor(e){super(e,D),this.supportsEdges=!0,this.techniqueConfig=new E,this._vertexAttributeLocations=T}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.screenSizeEnabled=this.params.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.params.shadingEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,n,s,o,c){if(this.params.screenSizeEnabled){const i=e.vertexAttributes.get("offset"),l={applyToVertex:(e,t,a,s)=>{const o=Object(r.w)(I,i.data[3*s+0],i.data[3*s+1],i.data[3*s+2]),c=Object(r.w)(z,e,t,a);return Object(r.e)(o,o,this.params.screenSize*n.camera.computeRenderPixelSizeAt(o)),Object(r.f)(c,c,o),[c[0],c[1],c[2]]},applyToAabb:e=>{const t=Object(a.d)(e,I);return Object(a.v)(e,this.params.screenSize*n.camera.computeRenderPixelSizeAt(t))}};Object(d.f)(e,t,n,s,o,l,c)}else Object(d.f)(e,t,n,s,o,void 0,c)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new C(e):void 0}createBufferWriter(){return new R(this.params.screenSizeEnabled)}}class C extends c.a{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(S,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(4===this._output)return 3===e;let t=3;return this._technique.configuration.transparent&&(t=this._technique.configuration.writeDepth?5:8),e===t||23===e}ensureParameters(e){this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}}const D={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:Object(r.r)(Object(n.e)(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,screenSizeEnabled:!1,screenSize:14,shadingEnabled:!0,...l.b};class R{constructor(e){this.screenSizeEnabled=e;const t=Object(o.a)().vec3f("position").vec3f("normal");this.screenSizeEnabled&&t.vec3f("offset"),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){if(Object(u.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r),this.screenSizeEnabled){if(!t.vertexAttributes.has("offset"))throw new Error("offset vertex attribute required for screenSizeEnabled ShadedColorMaterial");{const n=t.vertexAttributes.get("offset"),a=t.indices.get("offset");Object(h.a)(3===n.size);const o=i.getField("offset",s.u);if(!o)throw new Error("unable to acquire view for offset");Object(u.e)(a,n.data,e.invTranspTransformation,o,r)}}}}const I=Object(n.e)(),z=Object(n.e)()},903:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var r=i(85),n=i(135),a=i(168),s=i(111),o=i(101),c=i(226),l=i(556),h=i(624),u=i(721),d=i(547);class p extends h.a{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=Object(l.c)(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromRenderSpacePoint(e){const t=1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}setGeometryFromExtent(e){const t=this.view.spatialReference,i=Object(o.e)(),r=Object(o.e)(),n=100,a=[];Object(s.w)(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),Object(s.w)(i,e[2],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),Object(s.w)(i,e[2],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),Object(s.w)(i,e[0],e[3],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),Object(s.w)(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),Object(s.w)(i,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(i,t,r),a.push([r[0],r[1],r[2]]),this.geometry=[a]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromBoundedPlane(e){const t=[],i=e.origin,r=e.basis1,n=e.basis2,a=.5,s=Object(o.e)(),c=Object(o.e)(),l=Object(o.e)(),h=Object(o.e)();s[0]=i[0]-r[0]*a-n[0]*a,s[1]=i[1]-r[1]*a-n[1]*a,s[2]=i[2]-r[2]*a-n[2]*a,c[0]=i[0]-r[0]*a+n[0]*a,c[1]=i[1]-r[1]*a+n[1]*a,c[2]=i[2]-r[2]*a+n[2]*a,l[0]=i[0]+r[0]*a+n[0]*a,l[1]=i[1]+r[1]*a+n[1]*a,l[2]=i[2]+r[2]*a+n[2]*a,h[0]=i[0]+r[0]*a-n[0]*a,h[1]=i[1]+r[1]*a-n[1]*a,h[2]=i[2]+r[2]*a-n[2]*a,t.push([s[0],s[1],s[2]]),t.push([c[0],c[1],c[2]]),t.push([l[0],l[1],l[2]]),t.push([h[0],h[1],h[2]]),t.push([s[0],s[1],s[2]]),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;Object(n.j)(f),Object(n.t)(f,f,t),this.transform=f;const{points:i}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[i]}setGeometryFromSegments(e,t=o.b){Object(n.j)(f),Object(n.t)(f,f,t),this.transform=f,this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Object(c.g)(e,this._color)||(Object(c.c)(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Object(r.k)(e)?!Object(r.j)(this._innerColor)&&Object(c.g)(e,this._innerColor)||(this._innerColor=Object(c.c)(Object(l.b)(),e),this._updateMaterial()):Object(r.k)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=Object(r.k)(e)!==Object(r.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(Object(r.j)(e)||Object(r.j)(this._stippleOffColor)||!Object(c.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(r.k)(e)?Object(l.a)(e):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new d.a(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let i=0;i<t.length;++i){const r=Object(u.a)(t[i]);e.addGeometry(r,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameterValues(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if(Object(r.j)(e)||0===e.length)return[];const t=[];return e.forEach((e=>{const i=e.length,r=new Float64Array(3*i);e.forEach(((e,t)=>{r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e[2]}));const n={attributeData:{position:r},removeDuplicateStartEnd:0};t.push(n)})),t}}const f=Object(a.d)()},904:function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return u}));var r=i(256),n=i(376),a=i(515),s=i(319),o=i(656),c=i(331),l=i(113),h=i(271);function u(e){const t=new h.a;return t.include(n.a,{linearDepth:!1}),t.include(a.a,e),t.include(o.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(l.a`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(l.a`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `)),t.vertex.code.add(l.a`}`),4===e.output&&t.include(s.a),t.include(r.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(l.a`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${l.a.float(c.c)}) {
      discard;
    }

    ${0===e.output?l.a`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===e.output?l.a`outputHighlight();`:""}
  }
  `),t}var d=Object.freeze({__proto__:null,build:u})},983:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i(311),n=i(754),a=i(431),s=i(113);function o(e,t){t.multipassGeometryEnabled&&e.vertex.include(n.b),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(s.a`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?s.a`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(r.a),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(a.a),e.fragment.code.add(s.a`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?s.a`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}}}]);
//# sourceMappingURL=16.b089a860.chunk.js.map