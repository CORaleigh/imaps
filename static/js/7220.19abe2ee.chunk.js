"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[7220],{85981:(t,e,n)=>{n.d(e,{AR:()=>_,Gr:()=>m,JG:()=>d,Jk:()=>h,KU:()=>f,Ue:()=>a,al:()=>u,ct:()=>l,nF:()=>p,zk:()=>g});var i=n(16889),o=n(21530),s=n(11186),r=n(71353),c=n(11185);function a(t){return t?{origin:(0,r.a)(t.origin),vector:(0,r.a)(t.vector)}:{origin:(0,r.c)(),vector:(0,r.c)()}}function d(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a();return u(t.origin,t.vector,e)}function u(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a();return(0,s.c)(n.origin,t),(0,s.c)(n.vector,e),n}function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a();return(0,s.c)(n.origin,t),(0,s.b)(n.vector,e,t),n}function h(t,e){const n=(0,s.b)(c.WM.get(),e,t.origin),o=(0,s.e)(t.vector,n),r=(0,s.e)(t.vector,t.vector),a=(0,i.uZ)(o/r,0,1),d=(0,s.b)(c.WM.get(),(0,s.g)(c.WM.get(),t.vector,a),n);return(0,s.e)(d,d)}function p(t,e,n){return l(t,e,0,1,n)}function f(t,e,n){return(0,s.a)(n,t.origin,(0,s.g)(n,t.vector,e))}function l(t,e,n,o,r){const{vector:a,origin:d}=t,u=(0,s.b)(c.WM.get(),e,d),g=(0,s.e)(a,u)/(0,s.p)(a);return(0,s.g)(r,a,(0,i.uZ)(g,n,o)),(0,s.a)(r,r,t.origin)}function m(t,e){if(b(t,function(t,e){const n=M.get();return n.origin=t,n.vector=e,n}(e.origin,e.direction),!1,v)){const{tA:e,pB:n,distance2:i}=v;if(e>=0&&e<=1)return i;if(e<0)return(0,s.d)(t.origin,n);if(e>1)return(0,s.d)((0,s.a)(c.WM.get(),t.origin,t.vector),n)}return null}function _(t,e,n){return!!b(t,e,!0,v)&&((0,s.c)(n,v.pA),!0)}function b(t,e,n,o){const r=1e-6,a=t.origin,d=(0,s.a)(c.WM.get(),a,t.vector),u=e.origin,g=(0,s.a)(c.WM.get(),u,e.vector),h=c.WM.get(),p=c.WM.get();if(h[0]=a[0]-u[0],h[1]=a[1]-u[1],h[2]=a[2]-u[2],p[0]=g[0]-u[0],p[1]=g[1]-u[1],p[2]=g[2]-u[2],Math.abs(p[0])<r&&Math.abs(p[1])<r&&Math.abs(p[2])<r)return!1;const f=c.WM.get();if(f[0]=d[0]-a[0],f[1]=d[1]-a[1],f[2]=d[2]-a[2],Math.abs(f[0])<r&&Math.abs(f[1])<r&&Math.abs(f[2])<r)return!1;const l=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],m=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],_=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],b=p[0]*p[0]+p[1]*p[1]+p[2]*p[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*b-m*m;if(Math.abs(v)<r)return!1;let M=(l*m-_*b)/v,w=(l+m*M)/b;n&&(M=(0,i.uZ)(M,0,1),w=(0,i.uZ)(w,0,1));const E=c.WM.get(),C=c.WM.get();return E[0]=a[0]+M*f[0],E[1]=a[1]+M*f[1],E[2]=a[2]+M*f[2],C[0]=u[0]+w*p[0],C[1]=u[1]+w*p[1],C[2]=u[2]+w*p[2],o.tA=M,o.tB=w,o.pA=E,o.pB=C,o.distance2=(0,s.d)(E,C),!0}const v={tA:0,tB:0,pA:(0,r.c)(),pB:(0,r.c)(),distance2:0},M=new o.x((()=>a()))},97731:(t,e,n)=>{n.d(e,{E6:()=>d,T:()=>r,ep:()=>a,hu:()=>s,kG:()=>g,u_:()=>u,yK:()=>c});var i=n(6394);n(90045);(0,n(67077).c)();class o{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function s(t,e){if(!t){e=e||"Assertion";const t=new Error(e).stack;throw new o(`${e} at ${t}`)}}function r(t,e){t||(e=e||"",console.warn("Verify failed: "+e+"\n"+new Error("verify").stack))}function c(t,e,n,i){let o,s=(n[0]-t[0])/e[0],r=(i[0]-t[0])/e[0];s>r&&(o=s,s=r,r=o);let c=(n[1]-t[1])/e[1],a=(i[1]-t[1])/e[1];if(c>a&&(o=c,c=a,a=o),s>a||c>r)return!1;c>s&&(s=c),a<r&&(r=a);let d=(n[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return d>u&&(o=d,d=u,u=o),!(s>u||d>r)&&(u<r&&(r=u),!(r<0))}function a(t,e,n,o,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,i.a)();const c=(o[s]-n[s])*(e[0]-t[0])-(o[0]-n[0])*(e[s]-t[s]),a=(o[0]-n[0])*(t[s]-n[s])-(o[s]-n[s])*(t[0]-n[0]);if(0===c)return!1;const d=a/c;return r[0]=t[0]+d*(e[0]-t[0]),r[1]=t[s]+d*(e[s]-t[s]),!0}function d(t,e){return Math.log(t)/Math.log(e)}function u(t,e,n,i){t[12]=e,t[13]=n,t[14]=i}function g(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}},50319:(t,e,n)=>{n.r(e),n.d(e,{default:()=>m});var i=n(27366),o=n(92026),s=n(66978),r=(n(32718),n(25243),n(63780),n(10064),n(93169),n(69912)),c=n(11186),a=n(71353),d=n(85981),u=n(23470),g=n(92536),h=n(78329),p=n(83715);function f(t,e,n){const i=(0,u.c)(),o=(0,u.g)(i);return(0,c.z)(o,o,t,.5),(0,c.z)(o,o,e,.5),i[3]=(0,c.i)(o,t),(0,c.a)(o,o,n),i}let l=class{constructor(){this._idToComponent=new Map,this._components=new h.Z((t=>t.bounds)),this._edges=new h.Z((t=>t.bounds)),this._tmpLineSegment=(0,d.Ue)(),this._tmpP1=(0,a.c)(),this._tmpP2=(0,a.c)(),this._tmpP3=(0,a.c)(),this.remoteClient=null}async fetchCandidates(t,e){await Promise.resolve(),(0,s.k_)(e),await this._ensureEdgeLocations(t,e);const n=[];return this._edges.forEachNeighbor((e=>(this._addCandidates(t,e,n),n.length<1e3)),t.bounds),{result:{candidates:n}}}async _ensureEdgeLocations(t,e){const n=[];if(this._components.forEachNeighbor((t=>{if((0,o.Wi)(t.info)){const{id:e,uid:i}=t;n.push({id:e,uid:i})}return!0}),t.bounds),!n.length)return;const i={components:n},s=await this.remoteClient.invoke("fetchAllEdgeLocations",i,(0,o.Pt)(e,{}));for(const o of s.components)this._setFetchEdgeLocations(o)}async add(t){const e=new _(t.id,t.bounds);return this._idToComponent.set(e.id,e),this._components.add([e]),{result:{}}}async remove(t){const e=this._idToComponent.get(t.id);if(e){const t=[];this._edges.forEachNeighbor((n=>(n.component===e&&t.push(n),!0)),e.bounds),this._edges.remove(t),this._components.remove([e]),this._idToComponent.delete(e.id)}return{result:{}}}_setFetchEdgeLocations(t){const e=this._idToComponent.get(t.id);if((0,o.Wi)(e)||t.uid!==e.uid)return;const n=p.n_.createView(t.locations),i=new Array(n.count),s=(0,a.c)(),r=(0,a.c)();for(let o=0;o<n.count;o++){n.position0.getVec(o,s),n.position1.getVec(o,r);const c=f(s,r,t.origin),a=new b(e,o,c);i[o]=a}this._edges.add(i);const{objectIds:c,origin:d}=t;e.info={locations:n,objectIds:c,origin:d}}_addCandidates(t,e,n){const{info:i}=e.component,{origin:o,objectIds:s}=i,r=i.locations,a=r.position0.getVec(e.index,this._tmpP1),d=r.position1.getVec(e.index,this._tmpP2);(0,c.a)(a,a,o),(0,c.a)(d,d,o);const u=s[r.componentIndex.get(e.index)];this._addEdgeCandidate(t,u,a,d,n),this._addVertexCandidate(t,u,a,n),this._addVertexCandidate(t,u,d,n)}_addEdgeCandidate(t,e,n,i,o){if(!(t.types&g.r.EDGE))return;const s=(0,u.g)(t.bounds),r=(0,d.zk)(n,i,this._tmpLineSegment),h=(0,d.nF)(r,s,this._tmpP3);(0,u.m)(t.bounds,h)&&o.push({type:"edge",objectId:e,target:(0,a.a)(h),distance:(0,c.i)(s,h),start:(0,a.a)(n),end:(0,a.a)(i)})}_addVertexCandidate(t,e,n,i){if(!(t.types&g.r.VERTEX))return;const o=(0,u.g)(t.bounds);(0,u.m)(t.bounds,n)&&i.push({type:"vertex",objectId:e,target:(0,a.a)(n),distance:(0,c.i)(o,n)})}};l=(0,i._)([(0,r.j)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],l);const m=l;class _{constructor(t,e){this.id=t,this.bounds=e,this.info=null,this.uid=++_.uid}}_.uid=0;class b{constructor(t,e,n){this.component=t,this.index=e,this.bounds=n}}}}]);
//# sourceMappingURL=7220.19abe2ee.chunk.js.map