(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[216],{1182:function(e,t,i){},1398:function(e,t,i){"use strict";i.r(t),i.d(t,"PropertyPanel",(function(){return u}));var r=i(1),n=i(91);const o=e=>{const t=e.map((e=>e.getAttribute("PIN_NUM"))),i=new URL(window.location.toString());if(t){i.searchParams.set("pin",t.toString());const e={pin:t.toString()};history.state?history.state.pin!=e.pin&&history.pushState({pin:t.toString()},"",i.href):history.pushState({pin:t.toString()},"",i.href)}else history.replaceState(history.state,"",i.href)};i(1182);var l=i(1384),s=i(0);const a=Object(r.lazy)((()=>Promise.all([i.e(3),i.e(4),i.e(17),i.e(22),i.e(92)]).then(i.bind(null,1403)))),c=Object(r.lazy)((()=>Promise.all([i.e(1),i.e(2),i.e(3),i.e(4),i.e(67)]).then(i.bind(null,1404)))),d=Object(r.lazy)((()=>Promise.all([i.e(3),i.e(4),i.e(17),i.e(22),i.e(106)]).then(i.bind(null,1385)))),u=e=>{const t=Object(r.useRef)({pin:""}),i=Object(r.useRef)(null),u=Object(r.useRef)(null),[p,b]=Object(r.useState)(!1),[v,f]=Object(r.useState)(!0),[h,y]=Object(r.useState)(),j=Object(r.useRef)(),[m,g]=Object(r.useState)("OBJECTID IS NULL"),[O,S]=Object(r.useState)("OBJECTID IS NULL"),[I,N]=Object(r.useState)(),[E,P]=Object(r.useState)("list"),[w,U]=Object(r.useState)(!1),[C,T]=Object(r.useState)(),M=Object(r.useRef)(),[R,x]=Object(r.useState)(),[A,L]=Object(r.useState)(!1),k=e=>{const t=document.querySelector(`calcite-tab-title[tab=${e}]`),i=new KeyboardEvent("keydown",{altKey:!1,bubbles:!0,cancelable:!0,charCode:0,code:"Enter",composed:!0,ctrlKey:!1,detail:0,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1});t.dispatchEvent(i),U(!0)},_=()=>{f(!0),j.current=void 0,e.featureSelected(void 0),g("OBJECTID IS NULL"),k("list"),P("list"),e.propertiesSelected([]);const t=null===h||void 0===h?void 0:h.graphics.filter((e=>"buffer"===e.getAttribute("type")));(null===t||void 0===t?void 0:t.length)&&(null===h||void 0===h||h.graphics.removeMany(t))};return Object(r.useEffect)((()=>{if(!p){(e=>{N(e.map.allTables.find((e=>e.title.includes("Condo")&&"feature"===e.type))),T(e.map.allTables.find((e=>e.title.includes("Address")&&"feature"===e.type))),x(e.map.allLayers.find((e=>e.title.includes("Property")&&"feature"===e.type))),b(!0),y(e)})(e.view),document.querySelectorAll("calcite-tab").forEach((e=>{const t=new MutationObserver((e=>{if(e.length){var i;const r=null===(i=e[0].target)||void 0===i?void 0:i.shadowRoot;r&&(r.innerHTML+="<style>:host([active]) section { display: block !important; visibility: visible !important;} section {display: block !important; visiblity: hidden !important;}</style>"),t.disconnect()}else t.disconnect()}));e.innerHTML="<style>:host([active]) {display: block !important; visibility: visible !important;} :host { display: block; visibility: hidden !important;} calcite-tab {display: block !important; z-index: 1; visibility: hidden !important;} calcite-tab[active] { z-index: 100; visibility: visible !important;;} </style>",t.observe(e,{attributes:!0})})),window.addEventListener("popstate",(e=>{var i,r,n,o,l;(null===(i=e.state)||void 0===i?void 0:i.pin)===(null===(r=t.current)||void 0===r?void 0:r.pin)?history.back():(null===(n=e.state)||void 0===n?void 0:n.pin.length)>0&&(S(`PIN_NUM in ('${decodeURIComponent(null===(o=history.state)||void 0===o?void 0:o.pin.split(",").join("','"))}')`),g(`PIN_NUM in ('${decodeURIComponent(null===(l=history.state)||void 0===l?void 0:l.pin.split(",").join("','"))}')`));t.current=e.state}));const i=new URL(document.URL).searchParams.get("pin");i&&i.length>0&&(S(`PIN_NUM in ('${decodeURIComponent(i.split(",").join("','"))}')`),g(`PIN_NUM in ('${decodeURIComponent(i.split(",").join("','"))}')`))}}),[]),Object(r.useEffect)((()=>{((e,t,i)=>n.c(((r,n)=>{void 0!=i&&(null===t||void 0===t||t.queryFeatures({geometry:i,outFields:["OBJECTID","REID","PIN_NUM"],returnGeometry:!0,outSpatialReference:null===e||void 0===e?void 0:e.spatialReference}).then((e=>{const i=e.features.map((e=>e.getObjectId()));t.queryRelatedFeatures({relationshipId:0,objectIds:i,outFields:["*"]}).then((t=>{const o=[],l=[];i.forEach((e=>{var i;null===(i=t[e])||void 0===i||i.features.forEach((e=>{o.push(e.getAttribute("OBJECTID")),l.push(e)}))})),o.length?r({where:`OBJECTID in (${o.toString()})`,features:l,properties:e.features}):n()}))})))})))(h,R,e.geometry).then((t=>{if(void 0!=e.geometry){if(L(!0),g(t.where),M.current=t.properties,1===t.features.length){var i,r;const n=t.features[0];n.layer=I,n.popupTemplate=null===I||void 0===I?void 0:I.popupTemplate;const l=t.features[0];l.geometry=null===(i=t.properties)||void 0===i||null===(r=i.find((e=>e.getAttribute("PIN_NUM")===l.getAttribute("PIN_NUM"))))||void 0===r?void 0:r.geometry,j.current=l,e.featureSelected(l),f(!1),o([l]),k("info"),P("info")}else o([]),f(!0),j.current=void 0,k("list"),P("list");e.propertiesSelected(t.properties)}else _()})).catch((()=>{_()}))}),[e.geometry,e.propertiesSelected,e.featureSelected,e.selectedProperties]),Object(s.jsxs)("div",{className:"panel",id:"propertyPanel",children:[p&&Object(s.jsx)(r.Suspense,{fallback:"",children:Object(s.jsx)(a,{view:h,condosTable:I,addressTable:C,propertyLayer:R,where:O,clear:_,searchComplete:t=>{var i;t.feature||1===t.features.length?(j.current=t.features[0],e.featureSelected(t.features[0]),f(!1),o([t.features[0]]),k("info"),P("info")):(o([]),f(!0),j.current=void 0,k("list"),P("list"));const r=null===t||void 0===t?void 0:t.features.map((e=>e.getAttribute("OBJECTID")));g(`OBJECTID in (${r.toString()})`),M.current=t.properties,null===(i=e.selectedProperties)||void 0===i||i.forEach((e=>{e.setAttribute("selected",0)})),e.propertiesSelected(M.current);const n=e.view.graphics.filter((e=>"buffer"===e.getAttribute("type")));e.view.graphics.removeMany(n)}})}),Object(s.jsxs)(l.F,{position:"below",layout:"center",children:[Object(s.jsxs)(l.D,{slot:"tab-nav",onCalciteTabChange:e=>{U(0===e.detail.tab||"list"===e.detail.tab)},children:[Object(s.jsx)(l.E,{tab:"list",active:!0,ref:u,children:"List"}),Object(s.jsx)(l.E,{tab:"info",ref:i,disabled:!!v||void 0,children:"Info"})]}),Object(s.jsx)(l.C,{tab:"list",children:p&&Object(s.jsx)(r.Suspense,{fallback:"",children:Object(s.jsx)(d,{view:h,layer:I,filter:m,loading:A,reloadTable:w,selectedTab:E,featureSelected:t=>{if(t){var i,r,n,l,s;null===(i=M.current)||void 0===i||i.forEach((e=>{(null===e||void 0===e?void 0:e.getAttribute("PIN_NUM"))!=(null===t||void 0===t?void 0:t.getAttribute("PIN_NUM"))&&(null===e||void 0===e||e.setAttribute("selected",0))}));const a=null===(r=M.current)||void 0===r?void 0:r.find((e=>(null===e||void 0===e?void 0:e.getAttribute("PIN_NUM"))===(null===t||void 0===t?void 0:t.getAttribute("PIN_NUM"))));null===a||void 0===a||a.setAttribute("selected",1),null===(n=M.current)||void 0===n||n.splice(null===(l=M.current)||void 0===l?void 0:l.indexOf(a),1),null===(s=M.current)||void 0===s||s.push(a),t.geometry=null===a||void 0===a?void 0:a.geometry,null===h||void 0===h||h.goTo(t.geometry,{duration:1e3,easing:"ease"}),j.current=t,e.featureSelected(t),f(!1),e.propertiesSelected(M.current),o([t]),k("info"),P("info")}}})})}),Object(s.jsx)(l.C,{tab:"info",children:p&&Object(s.jsx)(r.Suspense,{fallback:"",children:Object(s.jsx)(c,{view:h,feature:j.current})})})]})]})};t.default=u}}]);
//# sourceMappingURL=216.514a5028.chunk.js.map