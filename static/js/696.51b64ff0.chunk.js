"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[696],{48976:(t,e,n)=>{n.d(e,{c:()=>f,g:()=>u,i:()=>d,j:()=>z,k:()=>g,m:()=>h,r:()=>Z,s:()=>c});var a=n(11873),i=n(98131),r=n(71353),o=n(26277),s=n(11186),l=n(90045);function c(t,e,n){n*=.5;const a=Math.sin(n);return t[0]=a*e[0],t[1]=a*e[1],t[2]=a*e[2],t[3]=Math.cos(n),t}function u(t,e){const n=2*Math.acos(e[3]),a=Math.sin(n/2);return a>(0,o.g)()?(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a):(t[0]=1,t[1]=0,t[2]=0),n}function h(t,e,n){const a=e[0],i=e[1],r=e[2],o=e[3],s=n[0],l=n[1],c=n[2],u=n[3];return t[0]=a*u+o*s+i*c-r*l,t[1]=i*u+o*l+r*s-a*c,t[2]=r*u+o*c+a*l-i*s,t[3]=o*u-a*s-i*l-r*c,t}function p(t,e,n,a){const i=e[0],r=e[1],s=e[2],l=e[3];let c,u,h,p,d,f=n[0],m=n[1],g=n[2],y=n[3];return u=i*f+r*m+s*g+l*y,u<0&&(u=-u,f=-f,m=-m,g=-g,y=-y),1-u>(0,o.g)()?(c=Math.acos(u),h=Math.sin(c),p=Math.sin((1-a)*c)/h,d=Math.sin(a*c)/h):(p=1-a,d=a),t[0]=p*i+d*f,t[1]=p*r+d*m,t[2]=p*s+d*g,t[3]=p*l+d*y,t}function d(t,e){const n=e[0],a=e[1],i=e[2],r=e[3],o=n*n+a*a+i*i+r*r,s=o?1/o:0;return t[0]=-n*s,t[1]=-a*s,t[2]=-i*s,t[3]=r*s,t}function f(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function m(t,e){const n=e[0]+e[4]+e[8];let a;if(n>0)a=Math.sqrt(n+1),t[3]=.5*a,a=.5/a,t[0]=(e[5]-e[7])*a,t[1]=(e[6]-e[2])*a,t[2]=(e[1]-e[3])*a;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const i=(n+1)%3,r=(n+2)%3;a=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*r+r]+1),t[n]=.5*a,a=.5/a,t[3]=(e[3*i+r]-e[3*r+i])*a,t[i]=(e[3*i+n]+e[3*n+i])*a,t[r]=(e[3*r+n]+e[3*n+r])*a}return t}function g(t,e,n,a){const i=.5*Math.PI/180;e*=i,n*=i,a*=i;const r=Math.sin(e),o=Math.cos(e),s=Math.sin(n),l=Math.cos(n),c=Math.sin(a),u=Math.cos(a);return t[0]=r*l*u-o*s*c,t[1]=o*s*u+r*l*c,t[2]=o*l*c-r*s*u,t[3]=o*l*u+r*s*c,t}const y=l.c,v=l.s,M=l.a,b=h,x=l.b,E=l.d,_=l.l,C=l.e,S=C,w=l.f,P=w,W=l.n,z=l.g,A=l.h;function Z(t,e,n){const a=(0,s.e)(e,n);return a<-.999999?((0,s.f)(R,T,e),(0,s.u)(R)<1e-6&&(0,s.f)(R,k,e),(0,s.n)(R,R),c(t,R,Math.PI),t):a>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):((0,s.f)(R,e,n),t[0]=R[0],t[1]=R[1],t[2]=R[2],t[3]=1+a,W(t,t))}const R=(0,r.c)(),T=(0,r.f)(1,0,0),k=(0,r.f)(0,1,0);const I=(0,i.a)(),O=(0,i.a)();const q=(0,a.c)();Object.freeze(Object.defineProperty({__proto__:null,add:M,calculateW:function(t,e){const n=e[0],a=e[1],i=e[2];return t[0]=n,t[1]=a,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-a*a-i*i)),t},conjugate:f,copy:y,dot:E,equals:A,exactEquals:z,fromEuler:g,fromMat3:m,getAxisAngle:u,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},invert:d,len:S,length:C,lerp:_,mul:b,multiply:h,normalize:W,random:function(t){const e=o.R,n=e(),a=e(),i=e(),r=Math.sqrt(1-n),s=Math.sqrt(n);return t[0]=r*Math.sin(2*Math.PI*a),t[1]=r*Math.cos(2*Math.PI*a),t[2]=s*Math.sin(2*Math.PI*i),t[3]=s*Math.cos(2*Math.PI*i),t},rotateX:function(t,e,n){n*=.5;const a=e[0],i=e[1],r=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l+o*s,t[1]=i*l+r*s,t[2]=r*l-i*s,t[3]=o*l-a*s,t},rotateY:function(t,e,n){n*=.5;const a=e[0],i=e[1],r=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l-r*s,t[1]=i*l+o*s,t[2]=r*l+a*s,t[3]=o*l-i*s,t},rotateZ:function(t,e,n){n*=.5;const a=e[0],i=e[1],r=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=a*l+i*s,t[1]=i*l-a*s,t[2]=r*l+o*s,t[3]=o*l-r*s,t},rotationTo:Z,scale:x,set:v,setAxes:function(t,e,n,a){const i=q;return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=a[0],i[4]=a[1],i[7]=a[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],W(t,m(t,i))},setAxisAngle:c,slerp:p,sqlerp:function(t,e,n,a,i,r){return p(I,e,i,r),p(O,n,a,r),p(t,I,O,2*r*(1-r)),t},sqrLen:P,squaredLength:w,str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}},Symbol.toStringTag,{value:"Module"}))},37818:(t,e,n)=>{n.d(e,{D:()=>v,Ou:()=>u,WG:()=>y,kB:()=>d,mW:()=>p});n(59486);var a=n(52639),i=(n(93169),n(84652)),r=n(92026),o=n(18722),s=n(77981),l=n(65618),c=n(78952);function u(t){return"declaredClass"in t}function h(t){return"declaredClass"in t}function p(t,e){return t?"declaredClass"in t?t:new a.Z({layer:e,sourceLayer:e,visible:t.visible,symbol:(0,i.d9)(t.symbol),attributes:(0,i.d9)(t.attributes),geometry:d(t.geometry)}):null}function d(t){return(0,r.Wi)(t)?null:u(t)?t:(0,s.im)(function(t){const{wkid:e,wkt:n,latestWkid:a}=t.spatialReference,i={wkid:e,wkt:n,latestWkid:a};switch(t.type){case"point":{const{x:e,y:n,z:a,m:r}=t;return{x:e,y:n,z:a,m:r,spatialReference:i}}case"polygon":{const{rings:e,hasZ:n,hasM:a}=t;return{rings:f(e),hasZ:n,hasM:a,spatialReference:i}}case"polyline":{const{paths:e,hasZ:n,hasM:a}=t;return{paths:f(e),hasZ:n,hasM:a,spatialReference:i}}case"extent":{const{xmin:e,xmax:n,ymin:a,ymax:r,zmin:o,zmax:s,mmin:l,mmax:c,hasZ:u,hasM:h}=t;return{xmin:e,xmax:n,ymin:a,ymax:r,zmin:o,zmax:s,mmin:l,mmax:c,hasZ:u,hasM:h,spatialReference:i}}case"multipoint":{const{points:e,hasZ:n,hasM:a}=t;return{points:g(e)?m(e):e,hasZ:n,hasM:a,spatialReference:i}}default:return}}(t))}function f(t){return function(t){for(const e of t)if(0!==e.length)return g(e);return!1}(t)?t.map((t=>m(t))):t}function m(t){return t.map((t=>Array.from(t)))}function g(t){return t.length>0&&((0,o.xZ)(t[0])||(0,o.fS)(t[0]))}function y(t,e){if(!t)return null;let n;if(h(t)){if(null==e)return t.clone();if(h(e))return e.copy(t)}return null!=e?(n=e,n.x=t.x,n.y=t.y,n.spatialReference=t.spatialReference,t.hasZ?(n.z=t.z,n.hasZ=t.hasZ):(n.z=void 0,n.hasZ=!1),t.hasM?(n.m=t.m,n.hasM=!0):(n.m=void 0,n.hasM=!1)):(n=(0,l.Tx)(t.x,t.y,t.z,t.spatialReference),t.hasM&&(n.m=t.m,n.hasM=!0)),n}function v(t){const{wkid:e,wkt:n,latestWkid:a}=t,i={wkid:e,wkt:n,latestWkid:a};return c.Z.fromJSON(i)}},45900:(t,e,n)=>{n.d(e,{m:()=>p});var a=n(27366),i=n(85015),r=n(32718),o=n(92026),s=n(66978),l=n(49861),c=(n(25243),n(63780),n(69912)),u=n(99034),h=n(92853);let p=class extends i.Z{constructor(t){super(t),this.manipulators=new h.D,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[u.bH.MANAGER,!0],[u.bH.USER,!0]]),this._creationFinishedResolver=(0,s.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._get("visible")!==t&&(this._set("visible",t),this._syncVisible())}get editable(){return this.getEditableFlag(u.bH.USER)}set editable(t){this.setEditableFlag(u.bH.USER,t)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){(0,o.Wi)(this.view)?r.Z.getLogger(this.declaredClass).error("Can't activate tool if view is not defined."):(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(t){this.onInputEvent(t)}handleInputEventAfter(t){this.onInputEventAfter(t)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),t===u.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(t){return this._editableFlags.get(t)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(u.bH.USER)&&this.getEditableFlag(u.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,a._)([(0,l.Cb)({constructOnly:!0})],p.prototype,"view",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],p.prototype,"active",null),(0,a._)([(0,l.Cb)({value:!0})],p.prototype,"visible",null),(0,a._)([(0,l.Cb)({value:!0})],p.prototype,"editable",null),(0,a._)([(0,l.Cb)({readOnly:!0})],p.prototype,"manipulators",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],p.prototype,"updating",null),(0,a._)([(0,l.Cb)()],p.prototype,"cursor",null),(0,a._)([(0,l.Cb)({readOnly:!0})],p.prototype,"automaticManipulatorSelection",void 0),(0,a._)([(0,l.Cb)()],p.prototype,"hasFocusedManipulators",null),(0,a._)([(0,l.Cb)()],p.prototype,"hasGrabbedManipulators",void 0),(0,a._)([(0,l.Cb)()],p.prototype,"hasHoveredManipulators",void 0),(0,a._)([(0,l.Cb)()],p.prototype,"firstGrabbedManipulator",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],p.prototype,"created",void 0),(0,a._)([(0,l.Cb)({readOnly:!0})],p.prototype,"removeIncompleteOnCancel",void 0),p=(0,a._)([(0,c.j)("esri.views.interactive.InteractiveToolBase")],p)},92853:(t,e,n)=>{n.d(e,{D:()=>s});var a,i,r=n(40281),o=n(92026);(i=a||(a={}))[i.WhenToolEditable=0]="WhenToolEditable",i[i.WhenToolNotEditable=1]="WhenToolNotEditable",i[i.Always=2]="Always";class s{constructor(){this._isToolEditable=!0,this._manipulators=new r.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.WhenToolEditable;this.addMany([t],e)}addMany(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.WhenToolEditable;for(const n of t){const t={manipulator:n,visibilityPredicate:e,attached:!1};this._manipulators.add(t),this._attached&&this._updateManipulatorAttachment(t)}}remove(t){for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).manipulator===t){const t=this._manipulators.splice(e,1)[0];this._detachManipulator(t);break}}removeAll(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((t=>{this._updateManipulatorAttachment(t)})),this._attached=!0}detach(){this._manipulators.forEach((t=>{this._detachManipulator(t)})),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach((t=>{let{manipulator:e}=t;e.destroy&&e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(t,e){return this._manipulators.on(t,(t=>{e(t)}))}forEach(t){for(const e of this._manipulators.items)t(e)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach((e=>t.push(e.manipulator))),t}intersect(t,e){let n=null,a=Number.MAX_VALUE;return this._manipulators.forEach((i=>{let{manipulator:r,attached:s}=i;if(!s||!r.interactive)return;const l=r.intersectionDistance(t,e);(0,o.pC)(l)&&l<a&&(a=l,n=r)})),n}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const e=t.manipulator;e.grabbing=!1,e.dragging=!1,e.hovering=!1,e.selected=!1,e.detach&&e.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===a.Always||(this._isToolEditable?t.visibilityPredicate===a.WhenToolEditable:t.visibilityPredicate===a.WhenToolNotEditable)}}},74229:(t,e,n)=>{n.d(e,{AN:()=>_,BS:()=>W,Cf:()=>v,M2:()=>m,Mz:()=>A,QY:()=>E,Xd:()=>f,a9:()=>g,bD:()=>x,di:()=>b,hM:()=>P,kY:()=>S,oq:()=>M,zh:()=>C});n(59486),n(93169);var a=n(84652),i=n(16889),r=n(92026),o=n(17842),s=n(71353),l=n(79803),c=n(37818),u=n(74509),h=n(50951),p=n(20008),d=n(585);function f(t,e){return t.events.on("drag",function(t,e){let n=null,a=null;return i=>{if("cancel"===i.action)return void((0,r.pC)(a)&&(a.execute({action:"cancel"}),n=null,a=null));const o={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};"start"===i.action&&(0,r.Wi)(n)&&(n=new P,a=new P,e(t,n,a,i.pointerType,o)),(0,r.pC)(n)&&n.execute(o),"end"===i.action&&(0,r.pC)(n)&&(n=null,a=null)}}(t,e))}function m(t,e){const n=[t.x,t.y,t.z??0],a=e,i=[Math.cos(a),Math.sin(a)],r=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(0===r)return null;i[0]/=r,i[1]/=r;const o=t=>{const e=(t.x-n[0])*i[0]+(t.y-n[1])*i[1];t.x=n[0]+e*i[0],t.y=n[1]+e*i[1]};return t=>(o(t.mapStart),o(t.mapEnd),{...t,axis:i})}function g(t,e){let n=null;return a=>{if("start"===a.action&&(n=function(t,e,n){const a=t.geometry,i=(0,c.D)(e);if((0,r.Wi)(a))return null;if("mesh"===a.type)return function(t,e,n,a){if((0,r.pC)(e.transform))return function(t,e,n,a){const i=y(n.getOriginPoint(e.spatialReference),a),o=e.spatialReference;return(0,r.Wi)(i)?null:{move:(e,a,c)=>{const u=(0,p.pB)(i.clone(),e,a,c);if(u.spatialReference.equals(o))n.origin=(0,s.f)(u.x,u.y,u.z);else{const t=(0,l.iV)(u,o);(0,r.pC)(t)&&(n.origin=(0,s.f)(t.x,t.y,t.z))}t.notifyMeshTransformChanged(),t.notifyGeometryChanged()}}}(t,e,e.transform,n);if(!e.spatialReference.equals(n))return null;let i=0,o=0,c=0;return{move:(n,r,s)=>{const l=n-i,u=r-o,p=s-c;if(l||u||p){const f=new d.Z(e.origin.x+l,e.origin.y+u,e.origin.z+p,e.origin.spatialReference);e.centerAt(f,{geographic:a===h.JY.Global}),t.notifyGeometryChanged(),i=n,o=r,c=s}}}}(t,a,i,n);const o=y(a,i),u=a.spatialReference;return(0,r.Wi)(o)?null:{move:(e,n,a)=>{const i=(0,p.pB)(o.clone(),e,n,a);i.spatialReference.equals(u)?t.geometry=i:t.geometry=(0,l.iV)(i,u)}}}(t,a.mapStart.spatialReference,e)),(0,r.Wi)(n))return null;const i=a.mapEnd.x-a.mapStart.x,o=a.mapEnd.y-a.mapStart.y,u=a.mapEnd.z-a.mapStart.z;return n.move(i,o,u),{...a,translationX:i,translationY:o,translationZ:u}}}function y(t,e){return(0,r.Wi)(t)?null:t.spatialReference.equals(e)?t.clone():(0,l.iV)(t,e)}function v(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,a=null;const i=(0,r.pC)(e)&&!t.spatialReference?.equals(e)?t=>(0,r.pC)(t)?(0,l.iV)(t,e):t:t=>t,o={exclude:[],...n};return e=>{if("start"===e.action&&(a=i(t.toMap(e.screenStart,o))),(0,r.Wi)(a))return null;const n=i(t.toMap(e.screenEnd,o));return(0,r.pC)(n)?{...e,mapStart:a,mapEnd:n}:null}}function M(t,e){const n=t.map((t=>(0,r.Wg)(g(t,e)))).filter((t=>(0,r.pC)(t)));return t=>{const e=t.mapEnd.x-t.mapStart.x,a=t.mapEnd.y-t.mapStart.y,i=t.mapEnd.z-t.mapStart.z;return n.forEach((e=>e(t))),{...t,translationX:e,translationY:a,translationZ:i}}}function b(t,e){const n=new Map;for(const i of e)n.set(i,(0,a.d9)(t[i]));return e=>(n.forEach(((e,n)=>{t[n]=e})),e)}function x(t){return(0,r.pC)(t.geometry)&&"mesh"===t.geometry.type?function(t,e){const n=(0,r.pC)(e.transform)?e.transform.clone():null,a=e.vertexAttributes.clonePositional();return i=>(e.transform=n,e.vertexAttributes=a,t.notifyGeometryChanged(),i)}(t,t.geometry):b(t,["geometry"])}function E(t){const e=t.map((t=>(0,r.Wg)(x(t)))).filter((t=>(0,r.pC)(t)));return t=>(e.forEach((e=>e(t))),t)}function _(){let t=0,e=0,n=0;return a=>{"start"===a.action&&(t=a.mapStart.x,e=a.mapStart.y,n=a.mapStart.z);const i=a.mapEnd.x-t,r=a.mapEnd.y-e,o=a.mapEnd.z-n;return t=a.mapEnd.x,e=a.mapEnd.y,n=a.mapEnd.z,{...a,mapDeltaX:i,mapDeltaY:r,mapDeltaZ:o,mapDeltaSpatialReference:a.mapStart.spatialReference}}}function C(){let t=0,e=0;return n=>{"start"===n.action&&(t=n.screenStart.x,e=n.screenStart.y);const a=n.screenEnd.x-t,i=n.screenEnd.y-e;return t=n.screenEnd.x,e=n.screenEnd.y,{...n,screenDeltaX:a,screenDeltaY:i}}}function S(t,e){let n=null,a=0,r=0;return s=>{if("start"===s.action&&(n=t.toScreen?.(e),null!=n&&(n.x<0||n.x>t.width||n.y<0||n.y>t.height?n=null:(a=s.screenStart.x-n.x,r=s.screenStart.y-n.y))),null==n)return null;const l=(0,i.uZ)(s.screenEnd.x-a,0,t.width),c=(0,i.uZ)(s.screenEnd.y-r,0,t.height),u=(0,o.vW)(l,c);return s.screenStart=n,s.screenEnd=u,s}}const w=()=>{};class P{constructor(){this.execute=w}next(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P;return(0,r.pC)(t)&&(this.execute=n=>{const a=t(n);(0,r.pC)(a)&&e.execute(a)}),e}}function W(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if("2d"===t.type)return t=>t;let a=null;return i=>{"start"===i.action&&(a=t.toMap(i.screenStart,{exclude:n}),(0,r.pC)(a)&&(a.z=(0,u.Ou)(a,t,e)));const o=t.toMap(i.screenEnd,{exclude:n});(0,r.pC)(o)&&(o.z=(0,u.Ou)(o,t,e));const s=(0,r.pC)(a)&&(0,r.pC)(o)?{sceneStart:a,sceneEnd:o}:null;return{...i,scenePoints:s}}}function z(t,e,n){const a=(0,r.WG)(e.elevationProvider.getElevation(t.x,t.y,t.z??0,t.spatialReference,"scene"))??0,i=(0,c.WG)(t);return i.z=a,i.hasZ=!0,i.z=(0,u.Ou)(i,e,n),i}function A(t,e){if("2d"===t.type)return t=>t;let n=null;return a=>{"start"===a.action&&(n=z(a.mapStart,t,e));const i=z(a.mapEnd,t,e),o=(0,r.pC)(n)&&(0,r.pC)(i)?{sceneStart:n,sceneEnd:i}:null;return{...a,scenePoints:o}}}},80151:(t,e,n)=>{n.d(e,{W:()=>h});var a=n(92026),i=n(66978),r=n(94172),o=n(70178),s=n(37818),l=n(74229),c=n(34019),u=n(78307);function h(t){let{predicate:e=(()=>!0),snappingManager:n,snappingContext:s,updatingHandles:h,useZ:g=!0}=t;const y=new l.hM;if((0,a.Wi)(n))return{snappingStep:[m,y],cancelSnapping:m};let v,M=null,b=null,x=null;const E=()=>{M=(0,a.IM)(M),n.doneSnapping(),(0,a.pC)(b)&&b.frameTask.remove(),b=null,v=(0,a.hw)(v),x=null},_=(C=n,S=g,w=y,(0,i.Ds)((async(t,e)=>{let{frameTask:n,point:i,scenePoint:r,context:s,event:l,delta:c,getLastState:u}=t;const h=await n.schedule((()=>C.snap({point:i,scenePoint:r,context:s,signal:e})),e);if(h.valid){let t=await n.schedule((()=>h.apply()),e);const r=u();(0,a.pC)(r.point)&&i!==r.point&&(t=C.update({point:r.point,scenePoint:r.scenePoint,context:s})),!(0,a.Wi)(r.updatePoint)&&(0,o.k)(t,r.updatePoint)||(f(l.mapEnd,t,c,S),w.execute(l))}})));var C,S,w;let P=null,W=null,z=null;return{snappingStep:[t=>{if(!e(t))return t;const{action:o}=t;if("start"===o){const{info:e}=t,i=function(t){return"3d"===t.type?t.resourceController.scheduler.registerTask(u.T8.SNAPPING):u.sq}(n.view);if(b=function(t,e,n){return{context:new c.N({editGeometryOperations:t.editGeometryOperations,elevationInfo:t.elevationInfo,pointer:t.pointer,vertexHandle:(0,a.pC)(e.info)?e.info.handle:null,excludeFeature:t.excludeFeature,visualizer:t.visualizer}),originalPos:(0,a.pC)(e.snapOrigin)?t.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,originalScenePos:(0,a.pC)(e.scenePoints)?e.scenePoints.sceneStart:null,frameTask:n}}(s,t,i),b.context.selfSnappingZ=null,!g&&(0,a.pC)(e)){const t=function(t,e){if(!t.hasZ())return null;const n=e.vertices;let i=null;for(const r of n){const e=t.getZ(r.pos);if((0,a.pC)(i)&&(0,a.pC)(e)&&Math.abs(e-i)>1e-6)return null;(0,a.Wi)(i)&&(i=e)}return i}(s.coordinateHelper,e.handle.component);(0,a.pC)(t)&&(b.context.selfSnappingZ={value:t,elevationInfo:s.elevationInfo})}}if((0,a.pC)(b)){const{context:e,originalScenePos:s,originalPos:l}=b,{mapEnd:c,mapStart:u,scenePoints:m}=t,y=p(l,d(c,u)),E=d(u,l),C={...t,action:"update"},S=b.context,w=function(t,e){return(0,a.Wi)(t)||(0,a.Wi)(e)?null:p(t,d(e.sceneEnd,e.sceneStart))}(s,m),A=n.update({point:y,scenePoint:w,context:e});if(z=A,f(c,A,E,g),P=y,W=w,"end"!==o){const{frameTask:t}=b;(0,a.Wi)(M)&&(M=new AbortController),x=e=>{h.addPromise((0,i.R8)(_({frameTask:t,event:C,context:S,point:y,scenePoint:w,delta:E,getLastState:()=>({point:P,scenePoint:W,updatePoint:e.forceUpdate?null:z})},(0,a.Wg)(M).signal)))},x({forceUpdate:!1}),(0,a.Wi)(v)&&(v=(0,r.YP)((()=>n.options.effectiveEnabled),(()=>x?.({forceUpdate:!0}))))}}return"end"===o&&E(),t},y],cancelSnapping:t=>(E(),t)}}function p(t,e){let[n,a,i]=e;const r=(0,s.WG)(t);return r.x+=n,r.y+=a,r.hasZ&&(r.z+=i),r}function d(t,e){const n=t.hasZ&&e.hasZ?t.z-e.z:0;return[t.x-e.x,t.y-e.y,n]}function f(t,e,n,a){let[i,r,o]=n;t.x=e.x+i,t.y=e.y+r,a&&t.hasZ&&e.hasZ&&(t.z=e.z+o)}function m(t){return t}}}]);
//# sourceMappingURL=696.51b64ff0.chunk.js.map