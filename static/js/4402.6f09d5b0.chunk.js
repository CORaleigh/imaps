"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[4402],{94402:(e,t,l)=>{l.r(t),l.d(t,{Layers:()=>v,default:()=>A});var i=l(85580),r=l(72791),a=l(36279),n=l(40281),s=l(9676),o=l(35387),d=l(1250),c=l(80184);const u=e=>{const t=(0,r.useRef)(!1),[l,a]=(0,r.useState)(0),[n,s]=(0,r.useState)(0);return(0,r.useEffect)((()=>{e.layer&&e.datefield&&!t.current&&(t.current=!0,(async(t,l)=>{e.layer.queryFeatures({where:`EXTRACT(YEAR,${l}) >= 2010`,returnGeometry:!1,outStatistics:[{statisticType:"max",onStatisticField:l,outStatisticFieldName:"MAX_DATE"},{statisticType:"min",onStatisticField:l,outStatisticFieldName:"MIN_DATE"}],outFields:["MAX_DATE","MIN_DATE"]}).then((l=>{if(null!==l&&void 0!==l&&l.features.length){const i=new Date(l.features[0].getAttribute("MAX_DATE")).getFullYear(),r=new Date(l.features[0].getAttribute("MIN_DATE")).getFullYear();t.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${r}\n            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${i}\n            `,t.refresh(),a(i),s(r)}})).catch((e=>{console.log(e)}))})(e.layer,e.datefield).then((()=>{})))}),[]),(0,c.jsx)("div",{children:(0,c.jsx)(i.XQ,{labelHandles:!0,labelTicks:!0,min:n,max:l,maxValue:l,minValue:l-1,minLabel:n.toString(),maxLabel:l.toString(),onCalciteSliderChange:t=>{e.layer.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${t.target.minValue}\n            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${t.target.maxValue}\n            `,e.layer.refresh()}})})},p=(0,r.lazy)((()=>l.e(516).then(l.bind(l,50516))));function y(e,t){return new Promise(((l,i)=>{(function(e){return new Promise(((t,l)=>{const i=new a.Z({portalItem:{id:"95092428774c4b1fb6a3b6f5fed9fbc4"}});i.loadAll().then((()=>{e.map.allLayers.filter((e=>"group"===e.type)).toArray().forEach((e=>{const t=i.allLayers.find((t=>"group"===t.type&&t.title===e.title)),l=t.layers.slice(),r=t.layers.filter((t=>{const l=e.findLayerById(t.id);return void 0!==l&&"feature"===l.type&&(l.popupTemplate=t.popupTemplate,l.renderer=t.renderer),void 0===e.findLayerById(t.id)}));e.addMany(r.toArray()),e.layers.forEach((t=>{let i=l.findIndex((e=>t.id===e.id));e.reorder(t,i)})),l.destroy()})),t(!0)}))}))})(t).then((()=>{const i=new o.Z({view:t,container:e,listItemCreatedFunction:b});i.on("trigger-action",(e=>{"Property"===e.item.layer.title&&m(e)})),l(i)}))}))}const m=e=>{if("Property"===e.item.layer.title){t=e.item.layer,(l=e.item.actionsSections).length>1&&((e,t)=>{const l=e.renderer.clone();t?(l.symbol.outline.color.r=0,l.symbol.outline.color.g=0,l.symbol.outline.color.b=0):(l.symbol.outline.color.r=255,l.symbol.outline.color.g=255,l.symbol.outline.color.b=255),e.renderer=l})(t,!l.getItemAt(1).getItemAt(0).value),e.item.layer.labelsVisible||(e.item.layer.labelsVisible=!0);const i=e.item.actionsSections.getItemAt(0).filter((e=>e.value)).map((e=>e.title)),r=f.filter((e=>i.includes(e.title))),a=r.map((e=>e.expression)),n=a.join("+ TextFormatting.NewLine+");e.item.layer.labelingInfo=[],e.item.layer.labelingInfo=[{symbol:{type:"text",color:"black",haloColor:"white",haloSize:1,font:{family:"AvenirNext LT Pro Regular",style:"normal",weight:"bold"}},labelExpressionInfo:{expression:n},maxScale:0,minScale:5e3}]}var t,l},f=[{expression:"First(Split($feature['SITE_ADDRESS'], ' '))",title:"Address"},{expression:"$feature['PIN_NUM']",title:"PIN"},{expression:"$feature['REID']",title:"REID"},{expression:'When(IsEmpty($feature["SALE_DATE"]),null, Concatenate(Month($feature["SALE_DATE"])+1, \'/\',Day($feature["SALE_DATE"]), \'/\',Year($feature["SALE_DATE"])))',title:"Sale Date"},{expression:"Text($feature.TOTSALPRICE,'$#,###')",title:"Sale Price"}],h=e=>{if(e.visible&&!e.panel&&"group"!==e.layer.type&&void 0!==e.layer.type){const t=document.createElement("slider-container");(0,d.createRoot)(t).render((0,c.jsx)(r.Suspense,{fallback:"",children:(0,c.jsx)(p,{value:e.layer.opacity,layer:e.layer})})),e.panel={content:[t,"legend"],open:!1},(e=>{if(e.layer.title.includes("Development Plans")&&"group"!==e.layer.type&&0===e.actionsSections.length){const t=document.createElement("filter-container");(0,d.createRoot)(t).render((0,c.jsx)(r.Suspense,{fallback:"",children:(0,c.jsx)(u,{datefield:"apply_date",layer:e.layer})})),e.panel.content.push(t)}})(e)}},b=e=>{const t=e.item;h(t),t.open=t.layer.visible,t.layer.watch("visible",(e=>{t.open=e,h(t),e&&(t.layer.parent&&"group"===t.layer.parent.type&&(t.layer.parent.visible=!0),t.layer.parent.parent&&"group"===t.layer.parent.parent.type&&(t.layer.parent.parent.visible=!0))})),(e=>{if("Property"===e.layer.title&&"group"!==e.layer.type&&0===e.actionsSections.length){let t=new n.Z;t.addMany(f.map((t=>{var l;return new s.Z({value:null===(l=e.layer.labelingInfo)||void 0===l?void 0:l.find((l=>{var i;return(null===(i=l.labelExpressionInfo)||void 0===i?void 0:i.expression.includes(t.expression))&&e.layer.labelsVisible})),title:t.title,visible:!0})}))),e.actionsSections.push(t),t=new n.Z,t.add(new s.Z({value:e.layer.renderer.symbol.outline.color.isBright,title:"Light Outline",visible:!0})),e.actionsSections.push(t),e.actionsOpen=!0,setTimeout((()=>{const e=document.createElement("h4");e.id="labels-actions-title",e.textContent="Labels",e.setAttribute("style","padding: 0.5em;margin: 0;");const t=document.querySelector(".esri-layer-list__item-actions");null!==t&&void 0!==t&&t.parentElement&&!document.getElementById("labels-actions-title")&&t.prepend(e)}),500)}})(t)},E={title:"Layer List Tips",tips:[{title:"Group Layers",text:"Layers in the layer list are now grouped based on category, making it easier to find layers."}]},g=e=>{const t=(0,r.useRef)(),l=(0,r.useRef)(!1),[i,a]=(0,r.useState)(),[n,s]=(0,r.useState)(!0),[o,d]=(0,r.useState)(!1);(0,r.useEffect)((()=>(l.current||(l.current=!0,y(t.current,e.view).then((e=>{a(e),e.when((()=>{s(!1)}))}))),()=>{i&&(null===i||void 0===i||i.destroy())})),[]),(0,r.useEffect)((()=>{d(e.isActive)}),[e.isActive]);const c=(0,r.useCallback)((t=>{e.panelDismissed()}),[]),u=(0,r.useCallback)((t=>{e.showTips(E)}),[]);return{ref:t,layerList:i,isLoading:n,isActive:o,panelDismissed:c,tipsClicked:u}},v=e=>{const{ref:t,layerList:l,isLoading:r,isActive:a,panelDismissed:n,tipsClicked:s}=g(e);return(0,c.jsxs)(i.N$,{id:"layers-panel",heading:"Layers",hidden:!a,closed:!a||void 0,closable:!0,onCalcitePanelClose:n,children:[(0,c.jsx)(i.G1,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:s}),(0,c.jsx)(i.$A,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),(0,c.jsxs)("div",{className:"layers",children:[l&&(0,c.jsxs)("div",{className:"row sticky",children:[(0,c.jsx)(i.e,{clearable:!0,placeholder:"Filter by layer name",scale:"m",onCalciteInputInput:e=>{l&&((e,t)=>{e||(e=""),t.operationalItems.forEach((l=>{if("group"===l.layer.type){let u=!1;var i,r,a,n,s,o,d,c;l.layer.layers.forEach((t=>{t.title.toLowerCase().includes(e.toLowerCase())?(t.listMode="show",u=!0):t.listMode="hide","group"===t.type&&t.layers.forEach((l=>{l.title.toLowerCase().includes(e.toLowerCase())?(t.listMode="show",l.listMode="show",u=!0):l.listMode="hide"}))})),l.open=e.length>0&&u,(!e.length||u)&&(null===(i=document.getElementById(`${t.id}_${l.uid}__title`))||void 0===i||null===(r=i.parentElement)||void 0===r||null===(a=r.parentElement)||void 0===a||null===(n=a.parentElement)||void 0===n||n.removeAttribute("hidden")),u||null===(s=document.getElementById(`${t.id}_${l.uid}__title`))||void 0===s||null===(o=s.parentElement)||void 0===o||null===(d=o.parentElement)||void 0===d||null===(c=d.parentElement)||void 0===c||c.setAttribute("hidden","")}}))})(e.target.value,l)}}),(0,c.jsx)(i.G1,{text:"clear",icon:"viewHide",scale:"s",onClick:()=>{var e;(null===(e=l)||void 0===e?void 0:e.view.map.allLayers.filter((e=>"group"===e.type))).forEach((e=>{e.visible="Property"===e.title,e.layers.forEach((e=>{e.visible="Property"===e.title}))}))}})]}),(0,c.jsx)("div",{ref:t}),(0,c.jsx)(i.Ed,{loading:!0,hidden:!r||void 0})]})]})},A=v}}]);
//# sourceMappingURL=4402.6f09d5b0.chunk.js.map