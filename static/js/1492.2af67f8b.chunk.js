(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[1492],{67435:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=67435,e.exports=t},37903:(e,t,n)=>{"use strict";n.r(t),n.d(t,{MapView:()=>T,default:()=>k});var i=n(72791),o=n(4473),l=n(26834),a=n(9337),r=n(21524),s=n(81102),d=n(34365),c=n(67520),u=n(16912),p=n(16455),m=n(79850),y=n(61459),f=n(53866),g=n(90899),b=n(40281),v=n(93655),h=n(52639),w=n(2170),E=n(94172);const L=(e,t,n)=>{e.addMany(t.layers.filter((e=>{const t=e.labelingInfo;return!!t&&(!!t.length&&(e.visible&&"feature"===e.type&&(t[0].minScale>=n.scale||0===t[0].minScale)))})))},x=(e,t)=>{e.removeAll(),(e=>{const t=new b.Z;return e.map.layers.forEach((n=>{if("group"===n.type&&n.visible){const i=n,o=i.layers.filter((e=>"group"===e.type));L(t,i,e),o.forEach((n=>{n.visible&&L(t,n,e)}))}})),t})(t).forEach((n=>{(e=>{var t;e.labelingInfo&&null!==(t=e.labelingInfo[0])&&void 0!==t&&t.labelExpression&&(e.labelsVisible=!1)})(n),t.whenLayerView(n).then((i=>{i.queryFeatures({geometry:t.extent,returnGeometry:!0,outFields:["*"]}).then((i=>{i.features.forEach((i=>{if(n.labelingInfo&&n.labelingInfo[0].labelExpression){const o=n.labelingInfo[0].symbol.clone();o.text=i.getAttribute(n.labelingInfo[0].labelExpression.replace("[","").replace("]",""));const l=w.clip(i.geometry,t.extent);if(l){0===e.graphics.filter((e=>w.distance(l.centroid,e.geometry,9002)<5)).length&&w.within(l.centroid,l)&&e.graphics.add(new h.Z({symbol:o,geometry:l.centroid}))}}}))}))}))}))},S=(e,t)=>e.on("click",(n=>{t.queryFeatures({geometry:n.mapPoint,outFields:["*"],returnGeometry:!0,outSpatialReference:e.spatialReference,distance:5,units:"feet"}).then((i=>{i.features.length&&(i.features.forEach((e=>{e.set("popupTemplate",t.popupTemplate)})),e.popup.open({location:n.mapPoint,features:e.popup.features.concat(i.features)}))}))})),C=e=>{setTimeout((()=>{(e=>{const t=new v.Z({id:"polygon-labels",listMode:"hide",title:"labels"});(e=>e.map.allLayers.filter((e=>"feature"===e.type&&"polygon"===e.geometryType||"group"===e.type)))(e).forEach((n=>{n.watch("visible",(()=>{t.removeAll(),setTimeout((()=>{x(t,e)}),1e3)}))})),e.map.add(t),E.gx((()=>e.stationary),(()=>{x(t,e)}))})(e)}),5e3);const t=[],n=(e=>{const t=document.createElement("div");t.classList.add("identify-widget"),t.classList.add("esri-component"),t.classList.add("esri-widget--button"),t.classList.add("esri-widget"),t.classList.add("active"),t.classList.add("map-tool"),t.setAttribute("role","button"),t.setAttribute("aria-label","Identify features"),t.setAttribute("title","Identify features");const n=document.createElement("span");n.classList.add("esri-icon"),n.classList.add("esri-icon-description"),n.setAttribute("aria-hidden","true");const i=document.createElement("span");return i.classList.add("esri-icon-font-fallback-text"),i.textContent="Idenfity features",t.appendChild(n),t.appendChild(i),e.popup.autoOpenEnabled=!0,t})(e);t.push(n),e.ui.add(n,"top-left");const i=(()=>{const e=document.createElement("div");e.classList.add("streetview-widget"),e.classList.add("esri-component"),e.classList.add("esri-widget--button"),e.classList.add("esri-widget"),e.classList.add("map-tool"),e.setAttribute("role","button"),e.setAttribute("aria-label","Open streetview"),e.setAttribute("title","Open streetview");const t=document.createElement("calcite-icon");t.setAttribute("icon","360-view");const n=document.createElement("span");return n.classList.add("esri-icon-font-fallback-text"),n.textContent="Open streetview",e.appendChild(t),e.appendChild(n),e})();t.push(i),e.ui.add(i,"top-left");const o=new d.Z({view:e,goToOverride:e=>{e.goTo(new f.Z({xmin:-79.65669272952547,xmax:-77.64619468265059,ymin:35.02761892388883,ymax:36.52937589457206,spatialReference:{wkid:4326}}))}});e.ui.add(o,"top-left"),t.push(o);const l=new r.Z({view:e});e.ui.add(l,"top-left"),t.push(l);const a=new s.Z({view:e});e.ui.add(a,"top-left"),t.push(a);const u=new c.Z({view:e});return e.ui.add(u,"bottom-left"),t.push(u),t};var I=n(54164),A=n(80184);const T=e=>{const t=(0,i.useRef)(null),[r,s]=(0,i.useState)(!1),[d,c]=(0,i.useState)(),[f,v]=(0,i.useState)(),h=(0,i.useRef)(),w=(0,i.useRef)([]),L=()=>{var e,t,n,i;null===(e=h.current)||void 0===e||e.map.removeMany(null===(t=h.current)||void 0===t?void 0:t.map.allLayers.filter((e=>"group"===e.type&&!e.layers.length)).toArray());const o=(null===(n=h.current)||void 0===n?void 0:n.map).toJSON();o.initialState.viewpoint.targetGeometry=null===(i=h.current)||void 0===i?void 0:i.extent,window.localStorage.setItem("imaps",JSON.stringify(o))};return(0,i.useEffect)((()=>{const d={id:e.id},f={};return o.default.on("dialog-create",(()=>{const e=new MutationObserver((t=>{var n,i,o;t.length?(null===(n=t[0])||void 0===n||null===(i=n.target)||void 0===i||null===(o=i.querySelector(".esri-button--secondary"))||void 0===o||o.click(),e.disconnect()):e.disconnect()})),t=o.default.dialog.container;e.observe(t,{childList:!0})})),r||(console.log("creating map view"),((e,t,n)=>{const i=new l.Z({portalItem:t});return n.map=i,n.container=e,n.constraints={minZoom:9,maxScale:0,geometry:{type:"polygon",rings:[[[-78.75745863699996,36.07002718000007],[-78.70607066199995,36.08235327400007],[-78.49934382399994,36.01263877200006],[-78.41242341499998,35.97099564700005],[-78.39138092199994,35.94414115500007],[-78.34901264499996,35.93119994500006],[-78.33915947999998,35.91373151400006],[-78.28787057699998,35.89119995200008],[-78.24532674699998,35.82017932400004],[-78.46565083499996,35.70069565700004],[-78.70889932799997,35.519481978000044],[-78.75843785699999,35.53222101800003],[-78.99507250999994,35.61017849700005],[-78.94938517999998,35.753017484000054],[-78.94926766099996,35.795162885000025],[-78.93436763399995,35.83411397700007],[-78.90607903799997,35.868106451000074],[-78.83252015399995,35.86833376000004],[-78.81153242799996,35.92940419300004],[-78.76548003999994,35.921115857000075],[-78.75440329099996,35.93625837800005],[-78.72001086699998,35.962579521000066],[-78.70055074099997,36.00774804200006],[-78.75636187099997,36.02728012400007],[-78.75745863699996,36.07002718000007]]]}},new a.Z(n)})(t.current,d,f).when((t=>{if((e=>{const t=e.map.allTables.filter((e=>e.title.includes("Condo")&&"feature"===e.type)),n=e.map.allTables.filter((e=>e.title.includes("Address")&&"feature"===e.type));return e.map.allLayers.filter((e=>e.title.includes("Property")&&"feature"===e.type)).length>0&&t.length>0&&n.length>0})(t)){var o,a;s(!0),e.initialized(t),w.current.push(C(t));const r=(e=>{const t=new u.Z({mode:"floating",expandIconClass:"esri-icon-overview-arrow-top-left",collapseIconClass:"esri-icon-overview-arrow-bottom-right"});return e.ui.add(t,"bottom-right"),t})(t);E.N1((()=>r.expanded)).then((()=>{const e=(0,i.lazy)((()=>n.e(6861).then(n.bind(n,66861))));I.render((0,A.jsx)(i.Suspense,{fallback:"",children:(0,A.jsx)(e,{view:t,expand:r})}),document.createElement("div"))})),v(t),(e=>{const t=e.map.allLayers.find((e=>"feature"===e.type&&e.title.startsWith("Property")));e.whenLayerView(t).then((()=>{t&&t.popupTemplate&&(t.popupTemplate.actions=new b.Z([{title:"Select",id:"property-select",className:"esri-icon-search"}]))}));const n=e.map.allLayers.find((e=>"feature"===e.type&&"Streets"===e.title));if(n){let t=S(e,n);e.popup.watch("autoOpenEnabled",(i=>{var o,l;i?(null===(o=document.querySelector(".identify-widget"))||void 0===o||o.classList.add("active"),t=S(e,n)):(null===(l=document.querySelector(".identify-widget"))||void 0===l||l.classList.remove("active"),t.remove())}))}})(t),t.popup.on("trigger-action",(n=>{"Select"===n.action.title&&e.geometryChanged(t.popup.location)})),h.current=t;const d=(e=>new p.default({source:[],editingEnabled:!0,listMode:"hide",legendEnabled:!1,geometryType:"polygon",spatialReference:e.spatialReference,id:"selection-layer",objectIdField:"OBJECTID",fields:[{name:"OBJECTID",type:"oid"},{name:"selected",type:"small-integer"},{name:"PIN_NUM",type:"string"}],renderer:new m.Z({field:"selected",defaultSymbol:new y.Z({style:"none",outline:{color:[255,255,0],width:2}}),uniqueValueInfos:[{value:1,symbol:new y.Z({style:"none",outline:{color:"#da4246",width:3}}),label:"single"},{value:0,symbol:new y.Z({style:"none",outline:{color:"#ffe44b",width:2}}),label:"multiple"}]}),orderBy:[{order:"descending",field:"selected"}]}))(t);c(d),null===(o=h.current)||void 0===o||o.map.add(d),null===(a=h.current)||void 0===a||a.on("hold",(t=>{e.geometryChanged(t.mapPoint)})),(e=>{if(window.localStorage.getItem("imaps")){const t=l.Z.fromJSON(JSON.parse(window.localStorage.getItem("imaps")));t.load().then((()=>{e.map.allLayers.forEach((e=>{const n=t.allLayers.find((t=>e.id===t.id));e.visible=null===n||void 0===n?void 0:n.visible,e.opacity=null===n||void 0===n?void 0:n.opacity}))})),e.map.basemap=t.basemap,e.extent=t.initialViewProperties.viewpoint.targetGeometry.extent}})(t),((e,t)=>{const n=e.watch("loaded",(i=>{if(i){const i=g.zy({basemap:e,geometryType:"polygon"}),o=t.map.allLayers.find((e=>"feature"===e.type&&e.title.startsWith("Property"))),l=o.renderer.clone();"light"===i.basemapTheme&&(l.symbol.outline.color.r=0,l.symbol.outline.color.g=0,l.symbol.outline.color.b=0);const a=e.baseLayers.filter((e=>"imagery"===e.type)).length>0;("dark"===i.basemapTheme||a||e.title.toLocaleLowerCase().includes("dark"))&&(l.symbol.outline.color.r=255,l.symbol.outline.color.g=255,l.symbol.outline.color.b=255),o.renderer=l,n.remove()}}))})(t.map.basemap,t)}else(()=>{const e=document.createElement("calcite-alert");e.setAttribute("scale","m"),e.setAttribute("color","red"),e.setAttribute("icon","exclamation-mark-triangle"),e.classList.add(document.body.classList.contains("dark")?"calcite-theme-dark":"calcite-theme-light");const t=document.createElement("div");t.slot="title",t.textContent="Required layers missing from web map";const n=document.createElement("div");n.slot="message",n.textContent="iMAPS cannot load, please contact";const i=document.createElement("a");i.slot="link",i.href="mailto:gis@wakegov.com",i.textContent="Wake County GIS",e.appendChild(t),e.appendChild(n),e.append(i),document.body.appendChild(e),e.setAttribute("active","")})(),s(!0),e.mapError()}))),window.addEventListener("pagehide",L),()=>{window.removeEventListener("pagehide",L)}}),[]),(0,i.useEffect)((()=>{if(e.selectedProperties){var t,n;if(e.selectedProperties.forEach((e=>{null===e||void 0===e||e.setAttribute("selected",0)})),null!==(t=e.selectedFeature)&&void 0!==t&&t.attributes)null===(n=e.selectedProperties.find((t=>t.attributes.PIN_NUM===e.selectedFeature.attributes.PIN_NUM)))||void 0===n||n.setAttribute("selected",1);null===d||void 0===d||d.queryFeatures({where:"1=1",returnGeometry:!0}).then((t=>{null===d||void 0===d||d.applyEdits({deleteFeatures:t.features}).then((t=>{null===d||void 0===d||d.applyEdits({addFeatures:e.selectedProperties}).then((e=>{console.log(e)}))}))}))}}),[e.selectedProperties]),(0,A.jsx)("div",{ref:t})},k=T}}]);
//# sourceMappingURL=1492.2af67f8b.chunk.js.map