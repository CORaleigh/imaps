{"version":3,"sources":["Components/PropertyPanel/utils/property.ts","Components/PropertyPanel/PropertyPanel.tsx"],"names":["setSearchParams","features","pin","map","feature","getAttribute","url","URL","window","location","toString","searchParams","set","state","history","pushState","href","replaceState","PropertySearch","lazy","PropertyInfo","PropertyList","PropertyPanel","props","useRef","infoTab","listTab","loaded","setLoaded","useState","infoTabDisabled","setInfoTabDisabled","view","setView","featureRef","filter","setFilter","where","setWhere","table","setTable","selectedTab","setSelectedTab","reloadTable","setReloadTable","addressTable","setAddressTable","properties","layer","setLayer","loading","setLoading","theme","useContext","ThemeContext","toggleTabs","tabTitle","title","document","querySelector","ev","KeyboardEvent","altKey","bubbles","cancelable","charCode","code","composed","ctrlKey","detail","isComposing","key","keyCode","metaKey","repeat","shiftKey","dispatchEvent","clear","current","undefined","featureSelected","propertiesSelected","graphics","graphic","length","removeMany","useEffect","mapView","allTables","find","includes","type","allLayers","mapViewLoaded","querySelectorAll","forEach","tab","observer","MutationObserver","mutations","shadow","target","shadowRoot","innerHTML","disconnect","observe","attributes","addEventListener","e","back","decodeURIComponent","split","join","get","geometry","promiseUtils","resolve","reject","queryFeatures","outFields","returnGeometry","outSpatialReference","spatialReference","then","featureSet","oids","getObjectId","queryRelatedFeatures","relationshipId","objectIds","result","reloids","oid","push","geometryChanged","data","f","popupTemplate","prop","catch","selectedProperties","className","id","fallback","condosTable","propertyLayer","searchComplete","setAttribute","class","position","layout","slot","onCalciteTabChange","event","active","ref","disabled","match","splice","indexOf","goTo","duration","easing"],"mappings":"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","file":"static/js/216.1bd90d5c.chunk.js","sourcesContent":["import * as promiseUtils from '@arcgis/core/core/promiseUtils';\nexport const geometryChanged = (\n  view: __esri.MapView,\n  layer: __esri.FeatureLayer,\n  geometry: __esri.Geometry,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): Promise<any> => {\n  return promiseUtils.create((resolve, reject) => {\n    if (geometry != undefined) {\n      layer\n        ?.queryFeatures({\n          geometry: geometry,\n          outFields: ['OBJECTID', 'REID', 'PIN_NUM'],\n          returnGeometry: true,\n          outSpatialReference: view?.spatialReference,\n        })\n        .then((featureSet) => {\n          //view?.goTo(featureSet.features, { duration: 1000, easing: 'ease' });\n          const oids = featureSet.features.map((feature) => {\n            return feature.getObjectId();\n          });\n          layer.queryRelatedFeatures({ relationshipId: 0, objectIds: oids, outFields: ['*'] }).then((result) => {\n            const reloids: number[] = [];\n            const features: __esri.Graphic[] = [];\n            oids.forEach((oid) => {\n              result[oid]?.features.forEach((feature: __esri.Graphic) => {\n                reloids.push(feature.getAttribute('OBJECTID'));\n                features.push(feature);\n              });\n            });\n            if (reloids.length) {\n              resolve({\n                where: `OBJECTID in (${reloids.toString()})`,\n                features: features,\n                properties: featureSet.features,\n              });\n            } else {\n              reject();\n            }\n          });\n        });\n    }\n  });\n};\n\nexport const setSearchParams = (features: __esri.Graphic[]): void => {\n  const pin: string[] = features.map((feature: __esri.Graphic) => {\n    return feature.getAttribute('PIN_NUM');\n  });\n  const url = new URL(window.location.toString());\n  //const searchParams = new URLSearchParams();\n  if (pin) {\n    url.searchParams.set('pin', pin.toString());\n    const state = { pin: pin.toString() };\n    if (history.state) {\n      if (history.state.pin != state.pin) {\n        history.pushState({ pin: pin.toString() }, '', url.href);\n      }\n    } else {\n      history.pushState({ pin: pin.toString() }, '', url.href);\n    }\n\n    //url.searchParams\n  } else {\n    history.replaceState(history.state, '', url.href);\n  }\n};\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/explicit-module-boundary-types */\nimport React, { lazy, Suspense, useContext, useEffect, useRef, useState } from 'react';\nconst PropertySearch = lazy(() => import('./PropertySearch/PropertySearch'));\nconst PropertyInfo = lazy(() => import('./PropertyInfo/PropertyInfo'));\nconst PropertyList = lazy(() => import('./PropertyList/PropertyList'));\nimport { geometryChanged, setSearchParams } from './utils/property';\nimport './PropertyPanel.scss';\nimport { CalciteTabs, CalciteTabNav, CalciteTabTitle, CalciteTab } from '@esri/calcite-components-react';\nimport ThemeContext from '../ThemeContext';\nexport const PropertyPanel = (props: any) => {\n  const state = useRef({ pin: '' });\n  const infoTab = useRef<HTMLCalciteTabTitleElement>(null);\n  const listTab = useRef<HTMLCalciteTabTitleElement>(null);\n\n  const [loaded, setLoaded] = useState(false);\n  const [infoTabDisabled, setInfoTabDisabled] = useState(true);\n  const [view, setView] = useState<__esri.MapView>();\n  // const [feature, setFeature] = useState<__esri.Graphic>();\n  const featureRef = useRef<__esri.Graphic>();\n  const [filter, setFilter] = useState('OBJECTID IS NULL');\n  const [where, setWhere] = useState('OBJECTID IS NULL');\n\n  const [table, setTable] = useState<__esri.FeatureLayer>();\n\n  const [selectedTab, setSelectedTab] = useState('list');\n  const [reloadTable, setReloadTable] = useState(false);\n\n  const [addressTable, setAddressTable] = useState<__esri.FeatureLayer>();\n  const properties = useRef<__esri.Graphic[]>();\n  const [layer, setLayer] = useState<__esri.FeatureLayer>();\n  const [loading, setLoading] = useState(false);\n  const { theme } = useContext(ThemeContext);\n\n  const mapViewLoaded = (mapView: __esri.MapView) => {\n    setTable(\n      mapView.map.allTables.find((layer) => {\n        return layer.title.includes('Condo') && layer.type === 'feature';\n      }) as __esri.FeatureLayer,\n    );\n\n    setAddressTable(\n      mapView.map.allTables.find((layer) => {\n        return layer.title.includes('Address') && layer.type === 'feature';\n      }) as __esri.FeatureLayer,\n    );\n    setLayer(\n      mapView.map.allLayers.find((layer) => {\n        return layer.title.includes('Property') && layer.type === 'feature';\n      }) as __esri.FeatureLayer,\n    );\n    setLoaded(true);\n    setView(mapView);\n    //new FeatureTable({ container: panelRef.current as HTMLDivElement, layer: layer, view: mapView });\n  };\n  const toggleTabs = (tabTitle: string) => {\n    //setSelectedTab(tabTitle);\n    //const tabnav: HTMLCalciteTabNavElement = document.querySelector('calcite-tab-nav') as HTMLCalciteTabNavElement;\n\n    //tabnav?.dispatchEvent(new CustomEvent('calciteTabChange', { detail: { tab: tabTitle } }));\n    const title: HTMLCalciteTabTitleElement = document.querySelector(\n      `calcite-tab-title[tab=${tabTitle}]`,\n    ) as HTMLCalciteTabTitleElement;\n    // title.focus();\n    //title.click();\n    const ev = new KeyboardEvent('keydown', {\n      altKey: false,\n      bubbles: true,\n      cancelable: true,\n      charCode: 0,\n      code: 'Enter',\n      composed: true,\n      ctrlKey: false,\n      detail: 0,\n      isComposing: false,\n      key: 'Enter',\n      keyCode: 13,\n      location: 0,\n      metaKey: false,\n      repeat: false,\n      shiftKey: false,\n    });\n\n    title.dispatchEvent(ev);\n    // setTimeout(() => {\n    //   const tab: HTMLElement = document.querySelector(\n    //     `calcite-tab-title:${tabTitle === 'list' ? 'first' : 'last'}-child`,\n    //   ) as HTMLElement;\n    //   const indicator: HTMLCalciteTabNavElement = document\n    //     ?.querySelector('calcite-tab-nav')\n    //     ?.shadowRoot?.querySelector('.tab-nav-active-indicator') as HTMLCalciteTabNavElement;\n    //   tab.focus();\n    //   indicator.setAttribute(\n    //     'style',\n    //     `transition-duration: 0.3s; width: ${tab.clientWidth}px; left: ${tab.offsetLeft}px;`,\n    //   );\n    // }, 500);\n    setReloadTable(true);\n  };\n  const searchComplete = (result: any) => {\n    if (result.feature || result.features.length === 1) {\n      featureRef.current = result.features[0];\n      props.featureSelected(result.features[0]);\n      setInfoTabDisabled(false);\n      //featureRef.current = result.features[0];\n      setSearchParams([result.features[0]]);\n      toggleTabs('info');\n      setSelectedTab('info');\n    } else {\n      setSearchParams([]);\n      setInfoTabDisabled(true);\n      featureRef.current = undefined;\n      toggleTabs('list');\n      setSelectedTab('list');\n    }\n\n    const oids = result?.features.map((feature: __esri.Graphic) => {\n      return feature.getAttribute('OBJECTID');\n    });\n    setFilter(`OBJECTID in (${oids.toString()})`);\n    properties.current = result.properties;\n    props.selectedProperties?.forEach((prop: __esri.Graphic) => {\n      prop.setAttribute('selected', 0);\n    });\n\n    props.propertiesSelected(properties.current);\n    const graphics = (props.view as __esri.MapView).graphics.filter((graphic) => {\n      return graphic.getAttribute('type') === 'buffer';\n    });\n    props.view.graphics.removeMany(graphics);\n  };\n  const tableFeatureSelected = (feature: __esri.Graphic) => {\n    if (feature) {\n      properties.current?.forEach((prop: __esri.Graphic) => {\n        if (prop?.getAttribute('PIN_NUM') != feature?.getAttribute('PIN_NUM')) {\n          prop?.setAttribute('selected', 0);\n        }\n      });\n      const match: __esri.Graphic = properties.current?.find((prop: __esri.Graphic) => {\n        return prop?.getAttribute('PIN_NUM') === feature?.getAttribute('PIN_NUM');\n      }) as __esri.Graphic;\n      match?.setAttribute('selected', 1);\n      properties.current?.splice(properties.current?.indexOf(match), 1);\n      properties.current?.push(match);\n\n      feature.geometry = match?.geometry as __esri.Geometry;\n\n      view?.goTo(feature.geometry, { duration: 1000, easing: 'ease' });\n      featureRef.current = feature;\n\n      props.featureSelected(feature);\n      setInfoTabDisabled(false);\n      props.propertiesSelected(properties.current);\n\n      //featureRef.current = feature;\n      setSearchParams([feature]);\n\n      toggleTabs('info');\n      setSelectedTab('info');\n    }\n  };\n\n  const clear = () => {\n    setInfoTabDisabled(true);\n    featureRef.current = undefined;\n    props.featureSelected(undefined);\n    setFilter('OBJECTID IS NULL');\n    toggleTabs('list');\n    setSelectedTab('list');\n    props.propertiesSelected([]);\n    const graphics = view?.graphics.filter((graphic) => {\n      return graphic.getAttribute('type') === 'buffer';\n    });\n    if (graphics?.length) {\n      view?.graphics.removeMany(graphics);\n    }\n  };\n\n  useEffect(() => {\n    if (!loaded) {\n      const mapView = props.view as __esri.MapView;\n      mapViewLoaded(mapView);\n      // document.querySelectorAll('calcite-tab-nav').forEach((tab) => {\n      //   tab.addEventListener('calciteTabChange', (event) => {\n      //     setReloadTable((event as any).detail.tab === 0 || (event as any).detail.tab === 'list');\n      //   });\n      // });\n\n      //workaround to make calcite-tab used visibility instead of display for hiding/unhiding to handle FeatureTable\n      document.querySelectorAll('calcite-tab').forEach((tab) => {\n        const observer: MutationObserver = new MutationObserver((mutations) => {\n          if (mutations.length) {\n            const shadow = (mutations[0].target as HTMLElement)?.shadowRoot;\n            if (shadow) {\n              shadow.innerHTML +=\n                '<style>:host([active]) section { display: block !important; visibility: visible !important;} section {display: block !important; visiblity: hidden !important;}</style>';\n            }\n\n            observer.disconnect();\n          } else {\n            observer.disconnect();\n          }\n        });\n        tab.innerHTML =\n          '<style>:host([active]) {display: block !important; visibility: visible !important;} :host { display: block; visibility: hidden !important;} calcite-tab {display: block !important; z-index: 1; visibility: hidden !important;} calcite-tab[active] { z-index: 100; visibility: visible !important;;} </style>';\n        observer.observe(tab as Node, { attributes: true });\n      });\n      window.addEventListener('popstate', (e) => {\n        if (e.state?.pin === state.current?.pin) {\n          history.back();\n        } else {\n          if (e.state?.pin.length > 0) {\n            setWhere(`PIN_NUM in ('${decodeURIComponent(history.state?.pin.split(',').join(`','`))}')`);\n            setFilter(`PIN_NUM in ('${decodeURIComponent(history.state?.pin.split(',').join(`','`))}')`);\n          }\n        }\n        state.current = e.state;\n      });\n      const url = new URL(document.URL);\n      const pin = url.searchParams.get('pin');\n\n      if (pin) {\n        if (pin.length > 0) {\n          setWhere(`PIN_NUM in ('${decodeURIComponent(pin.split(',').join(`','`))}')`);\n          setFilter(`PIN_NUM in ('${decodeURIComponent(pin.split(',').join(`','`))}')`);\n        }\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    geometryChanged(view as __esri.MapView, layer as __esri.FeatureLayer, props.geometry)\n      .then((data) => {\n        if (props.geometry != undefined) {\n          setLoading(true);\n          setFilter(data.where);\n          properties.current = data.properties;\n          if (data.features.length === 1) {\n            const f = data.features[0] as __esri.Graphic;\n            f.layer = table as __esri.FeatureLayer;\n            f.popupTemplate = table?.popupTemplate as __esri.PopupTemplate;\n            const feature = data.features[0] as __esri.Graphic;\n            feature.geometry = data.properties?.find((prop: __esri.Graphic) => {\n              return prop.getAttribute('PIN_NUM') === feature.getAttribute('PIN_NUM');\n            })?.geometry;\n            featureRef.current = feature;\n            props.featureSelected(feature);\n            setInfoTabDisabled(false);\n            setSearchParams([feature]);\n\n            toggleTabs('info');\n            setSelectedTab('info');\n          } else {\n            setSearchParams([]);\n            setInfoTabDisabled(true);\n            featureRef.current = undefined;\n            toggleTabs('list');\n            setSelectedTab('list');\n          }\n          props.propertiesSelected(data.properties);\n        } else {\n          clear();\n        }\n      })\n      .catch(() => {\n        clear();\n      });\n  }, [props.geometry, props.propertiesSelected, props.featureSelected, props.selectedProperties]);\n  return (\n    <div className=\"panel\" id=\"propertyPanel\">\n      {loaded && (\n        <Suspense fallback={''}>\n          <PropertySearch\n            view={view}\n            condosTable={table}\n            addressTable={addressTable}\n            propertyLayer={layer}\n            where={where}\n            clear={clear}\n            searchComplete={searchComplete}\n          ></PropertySearch>\n        </Suspense>\n      )}\n\n      <CalciteTabs class={`shell calcite-theme-${theme}`} position=\"below\" layout=\"center\">\n        <CalciteTabNav\n          slot=\"tab-nav\"\n          onCalciteTabChange={(event: any) => {\n            setReloadTable((event as any).detail.tab === 0 || (event as any).detail.tab === 'list');\n          }}\n        >\n          <CalciteTabTitle tab=\"list\" active ref={listTab}>\n            List\n          </CalciteTabTitle>\n          <CalciteTabTitle tab=\"info\" ref={infoTab} disabled={infoTabDisabled ? true : undefined}>\n            Info\n          </CalciteTabTitle>\n        </CalciteTabNav>\n\n        <CalciteTab tab=\"list\">\n          {loaded && (\n            <Suspense fallback={''}>\n              <PropertyList\n                view={view}\n                layer={table}\n                filter={filter}\n                loading={loading}\n                reloadTable={reloadTable}\n                selectedTab={selectedTab}\n                featureSelected={tableFeatureSelected}\n              ></PropertyList>\n            </Suspense>\n          )}\n        </CalciteTab>\n\n        <CalciteTab tab=\"info\">\n          {loaded && (\n            <Suspense fallback={''}>\n              <PropertyInfo view={view} feature={featureRef.current} />\n            </Suspense>\n          )}\n        </CalciteTab>\n      </CalciteTabs>\n    </div>\n  );\n};\n\nexport default PropertyPanel;\n"],"sourceRoot":""}