{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/ExportWMSImageParameters.js","../node_modules/@arcgis/core/views/layers/WMSLayerView.js","../node_modules/@arcgis/core/views/2d/layers/WMSLayerView2D.js"],"names":["a","visible","l","e","scale","this","_get","_set","handles","remove","add","sublayers","on","notifyChange","propertyName","visibleSublayers","filter","name","map","join","commitProperty","layer","r","s","t","forEach","o","minScale","maxScale","unshift","layers","format","imageFormat","request","service","styles","transparent","imageTransparency","version","prototype","readOnly","type","Number","i","exportImageParameters","p","destroy","Promise","reject","popupEnabled","createFetchPopupFeaturesQuery","resolve","extent","width","height","m","x","n","y","u","fetchFeatureInfo","getLogger","view","supportsSpatialReference","spatialReference","addResolvingPromise","strategy","update","catch","error","imageMaxHeight","imageMaxWidth","_bitmapContainer","h","container","addChild","d","fetchSource","fetchImage","bind","requestUpdate","imageRotationSupported","imageNormalizationSupported","hidpi","watch","removeChild","removeAllChildren","children","some","resolution","c","xmin","ymin","xmax","ymax","Math","round","updating","updateRequested","timeExtent","timestamp","refreshTimestamp"],"mappings":"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","file":"static/js/130.9dcd17d6.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import t from\"../../core/Accessor.js\";import{HandleOwnerMixin as o}from\"../../core/HandleOwner.js\";const a={visible:\"visibleSublayers\"};let l=class extends(o(t)){constructor(e){super(e),this.scale=0}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.sublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"wms-sublayer-update\",(e=>this.notifyChange(a[e.propertyName])))],\"layer\"))}get layers(){const{visibleSublayers:e}=this;return e.filter((e=>e.name)).map((e=>e.name)).join(\",\")}get version(){this.commitProperty(\"layers\");const e=this.layer;return e&&e.commitProperty(\"imageTransparency\"),(this._get(\"version\")||0)+1}get visibleSublayers(){const{layer:e,scale:r}=this,s=null==e?void 0:e.sublayers,t=[],o=e=>{const{minScale:s,maxScale:a,sublayers:l,visible:i}=e;i&&(0===r||(0===s||r<=s)&&(0===a||r>=a))&&(l?l.forEach(o):t.unshift(e))};return null==s||s.forEach(o),t}toJSON(){const{layer:e,layers:r}=this,{imageFormat:s,imageTransparency:t,version:o}=e;return{format:s,request:\"GetMap\",service:\"WMS\",styles:\"\",transparent:t,version:o,layers:r}}};e([r()],l.prototype,\"layer\",null),e([r({readOnly:!0})],l.prototype,\"layers\",null),e([r({type:Number})],l.prototype,\"scale\",void 0),e([r({readOnly:!0})],l.prototype,\"version\",null),e([r({readOnly:!0})],l.prototype,\"visibleSublayers\",null),l=e([s(\"esri.layers.support.ExportWMSImageParameters\")],l);export{l as ExportWMSImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{combinedViewLayerTimeExtentProperty as s}from\"../../layers/support/commonProperties.js\";import{ExportWMSImageParameters as p}from\"../../layers/support/ExportWMSImageParameters.js\";const i=i=>{let a=class extends i{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}fetchPopupFeatures(e){const{layer:r}=this;if(!e)return Promise.reject(new o(\"wmslayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:r}));const{popupEnabled:t}=r;if(!t)return Promise.reject(new o(\"wmslayerview:fetchPopupFeatures\",\"popupEnabled should be true\",{popupEnabled:t}));const s=this.createFetchPopupFeaturesQuery(e);if(!s)return Promise.resolve([]);const{extent:p,width:i,height:a,x:m,y:n}=s;if(!(p&&i&&a))throw new o(\"wmslayerview:fetchPopupFeatures\",\"WMSLayer does not support fetching features.\",{extent:p,width:i,height:a});const u=r.fetchFeatureInfo(p,i,a,m,n);return Promise.resolve(u?[u]:[])}};return e([r()],a.prototype,\"exportImageParameters\",void 0),e([r({readOnly:!0})],a.prototype,\"exportImageVersion\",null),e([r()],a.prototype,\"layer\",void 0),e([r(s)],a.prototype,\"timeExtent\",void 0),a=e([t(\"esri.layers.mixins.WMSLayerView\")],a),a};export default i;export{i as WMSLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as a}from\"../../../core/promiseUtils.js\";import o from\"../../../geometry/Extent.js\";import{RefreshableLayerView as n}from\"../../layers/RefreshableLayerView.js\";import p from\"../../layers/LayerView.js\";import{WMSLayerView as m}from\"../../layers/WMSLayerView.js\";import{BitmapContainer as h}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as c}from\"./LayerView2D.js\";import d from\"./support/ExportStrategy.js\";const l=t.getLogger(\"esri.views.2d.layers.WMSLayerView2D\");let u=class extends(m(n(c(p)))){initialize(){const{layer:e,view:t}=this;e.supportsSpatialReference(t.spatialReference)||this.addResolvingPromise(Promise.reject(new s(\"layerview:spatial-reference-incompatible\",\"The spatial references supported by this WMS layer are incompatible with the spatial reference of the view\",{layer:e})))}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{a(e)||l.error(e)}))}attach(){const{layer:e}=this,{imageMaxHeight:t,imageMaxWidth:r}=e;this._bitmapContainer=new h,this.container.addChild(this._bitmapContainer),this.strategy=new d({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:t,imageMaxWidth:r,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.handles.add(this.watch(\"exportImageVersion\",(()=>this.requestUpdate())),\"exportImageVersion\")}detach(){this.handles.remove(\"exportImageVersion\"),this.strategy.destroy(),this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQuery(e){const{view:t}=this,r=this._bitmapContainer,{x:i,y:s}=e,{spatialReference:a}=t;let n=null,p=0,m=0;if(r.children.some((e=>{const{width:t,height:r,resolution:h,x:c,y:d}=e,l=c+h*t,u=d-h*r;return i>=c&&i<=l&&s<=d&&s>=u&&(n=new o({xmin:c,ymin:u,xmax:l,ymax:d,spatialReference:a}),p=t,m=r,!0)})),!n)return null;const h=n.width/p,c=Math.round((i-n.xmin)/h),d=Math.round((n.ymax-s)/h);return{extent:n,width:p,height:m,x:c,y:d}}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.timeExtent,timestamp:this.refreshTimestamp,...i})}};e([r()],u.prototype,\"strategy\",void 0),e([r()],u.prototype,\"updating\",void 0),u=e([i(\"esri.views.2d.layers.WMSLayerView2D\")],u);var y=u;export default y;\n"],"sourceRoot":""}