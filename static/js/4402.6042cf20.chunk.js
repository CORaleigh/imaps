"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[4402],{94402:(e,t,l)=>{l.r(t),l.d(t,{Layers:()=>w,default:()=>T});var i=l(85580),a=l(72791),r=l(36279),n=l(40281),s=l(9676),o=l(35387),d=l(1250),c=l(80184);const y=e=>{const t=(0,a.useRef)(!1),[l,r]=(0,a.useState)(0),[n,s]=(0,a.useState)(0);return(0,a.useEffect)((()=>{e.layer&&e.datefield&&!t.current&&(t.current=!0,(async(t,l)=>{const i=await e.layer.queryFeatures({where:`EXTRACT(YEAR,${l}) >= 2010`,returnGeometry:!1,outStatistics:[{statisticType:"max",onStatisticField:l,outStatisticFieldName:"MAX_DATE"},{statisticType:"min",onStatisticField:l,outStatisticFieldName:"MIN_DATE"}],outFields:["MAX_DATE","MIN_DATE"]});if(null!==i&&void 0!==i&&i.features.length){const l=new Date(i.features[0].getAttribute("MAX_DATE")).getFullYear(),a=new Date(i.features[0].getAttribute("MIN_DATE")).getFullYear();t.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${a}\n            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${l}\n            `,t.refresh(),r(l),s(a)}})(e.layer,e.datefield))}),[]),(0,c.jsx)("div",{children:(0,c.jsx)(i.XQ,{labelHandles:!0,labelTicks:!0,min:n,max:l,maxValue:l,minValue:l-1,minLabel:n.toString(),maxLabel:l.toString(),onCalciteSliderChange:t=>{e.layer.definitionExpression=`EXTRACT(YEAR FROM ${e.datefield}) >= ${t.target.minValue}\n            AND EXTRACT(YEAR FROM ${e.datefield}) <= ${t.target.maxValue}\n            `,e.layer.refresh()}})})};var u=l(37958);const p=(0,a.lazy)((()=>l.e(516).then(l.bind(l,50516))));let m;const f=async(e,t)=>{const l=new r.Z({portalItem:{id:"a07528d1d37542b79fade50370f2305f"}});await l.loadAll().catch((e=>{console.log(e)})).then((async()=>{if(l.layers.length){const t=e.map.layers.find((e=>{var t;return e.id===(null===(t=l.layers.getItemAt(0))||void 0===t?void 0:t.id)}));if(t){await l.layers.getItemAt(0).load();const e=l.allLayers.find((e=>"group"===e.type&&e.title===t.title));if(e){const l=e.layers.slice(),i=e.layers.filter((e=>{const l=t.findLayerById(e.id);return void 0!==l&&"feature"===l.type&&(l.popupTemplate=e.popupTemplate,l.renderer=e.renderer),void 0===t.findLayerById(e.id)}));t.addMany(i.toArray()),t.layers.forEach((e=>{let i=l.findIndex((t=>e.id===t.id));t.reorder(e,i)})),l.destroy()}}else e.map.addMany(l.layers.toArray())}}))},h=async e=>{const t=new r.Z({portalItem:{id:"95092428774c4b1fb6a3b6f5fed9fbc4"}});await t.loadAll().catch((e=>{console.log(e)})).then((()=>(e.map.allLayers.filter((e=>"group"===e.type)).toArray().forEach((e=>{const l=t.allLayers.find((t=>"group"===t.type&&t.title===e.title));if(l){const t=l.layers.slice(),i=l.layers.filter((t=>{const l=e.findLayerById(t.id);return void 0!==l&&"feature"===l.type&&(l.popupTemplate=t.popupTemplate,l.renderer=t.renderer),void 0===e.findLayerById(t.id)}));e.addMany(i.toArray()),e.layers.forEach((l=>{l.title;let i=t.findIndex((e=>l.id===e.id));"Raleigh Zoning"===l.title&&console.log(i),e.reorder(l,i)})),t.destroy()}})),!0)))},g=e=>{if("Property"===e.item.layer.title){t=e.item.layer,(l=e.item.actionsSections).length>1&&((e,t)=>{const l=e.renderer.clone();t?(l.symbol.outline.color.r=0,l.symbol.outline.color.g=0,l.symbol.outline.color.b=0):(l.symbol.outline.color.r=255,l.symbol.outline.color.g=255,l.symbol.outline.color.b=255),e.renderer=l})(t,!l.getItemAt(1).getItemAt(0).value),e.item.layer.labelsVisible||(e.item.layer.labelsVisible=!0);const i=e.item.actionsSections.getItemAt(0).filter((e=>e.value)).map((e=>e.title)),a=b.filter((e=>i.includes(e.title))),r=a.map((e=>e.expression)),n=r.join("+ TextFormatting.NewLine+");e.item.layer.labelingInfo=[],e.item.layer.labelingInfo=[{symbol:{type:"text",color:"black",haloColor:"white",haloSize:1,font:{family:"AvenirNext LT Pro Regular",style:"normal",weight:"bold"}},labelExpressionInfo:{expression:n},maxScale:0,minScale:5e3}]}var t,l},b=[{expression:"First(Split($feature['SITE_ADDRESS'], ' '))",title:"Address"},{expression:"$feature['PIN_NUM']",title:"PIN"},{expression:"$feature['REID']",title:"REID"},{expression:'When(IsEmpty($feature["SALE_DATE"]),null, Concatenate(Month($feature["SALE_DATE"])+1, \'/\',Day($feature["SALE_DATE"]), \'/\',Year($feature["SALE_DATE"])))',title:"Sale Date"},{expression:"Text($feature.TOTSALPRICE,'$#,###')",title:"Sale Price"}],v=e=>{if(e.visible&&!e.panel&&"group"!==e.layer.type&&void 0!==e.layer.type){const t=document.createElement("slider-container");(0,d.createRoot)(t).render((0,c.jsx)(a.Suspense,{fallback:"",children:(0,c.jsx)(p,{value:e.layer.opacity,layer:e.layer})})),e.panel={content:[t,"legend"],open:!1},(e=>{if(e.layer.title.includes("Development Plans")&&"group"!==e.layer.type&&0===e.actionsSections.length){const t=document.createElement("filter-container");(0,d.createRoot)(t).render((0,c.jsx)(a.Suspense,{fallback:"",children:(0,c.jsx)(y,{datefield:"apply_date",layer:e.layer})})),e.panel.content.push(t)}})(e)}},E=e=>{const t=e.item;v(t),t.open=t.layer.visible,t.layer.watch("visible",(e=>{(0,u.do)(m.view),t.open=e,v(t),e&&(t.layer.parent&&"group"===t.layer.parent.type&&(t.layer.parent.visible=!0),t.layer.parent.parent&&"group"===t.layer.parent.parent.type&&(t.layer.parent.parent.visible=!0))})),(e=>{if("Property"===e.layer.title&&"group"!==e.layer.type&&0===e.actionsSections.length){let t=new n.Z;t.addMany(b.map((t=>{var l;return new s.Z({value:null===(l=e.layer.labelingInfo)||void 0===l?void 0:l.find((l=>{var i;return(null===(i=l.labelExpressionInfo)||void 0===i?void 0:i.expression.includes(t.expression))&&e.layer.labelsVisible})),title:t.title,visible:!0})}))),e.actionsSections.push(t),t=new n.Z,t.add(new s.Z({value:e.layer.renderer.symbol.outline.color.isBright,title:"Light Outline",visible:!0})),e.actionsSections.push(t),e.actionsOpen=!0,setTimeout((()=>{const e=document.createElement("h4");e.id="labels-actions-title",e.textContent="Labels",e.setAttribute("style","padding: 0.5em;margin: 0;");const t=document.querySelector(".esri-layer-list__item-actions");null!==t&&void 0!==t&&t.parentElement&&!document.getElementById("labels-actions-title")&&t.prepend(e)}),500)}})(t)},A={title:"Layer List Tips",tips:[{title:"Group Layers",text:"Layers in the layer list are now grouped based on category, making it easier to find layers."}]},x=e=>{const t=(0,a.useRef)(),l=(0,a.useRef)(!1),[i,r]=(0,a.useState)(),[n,s]=(0,a.useState)(!0),[d,c]=(0,a.useState)(!1);(0,a.useEffect)((()=>(l.current||(l.current=!0,(async(e,t)=>{await h(t);const l=new URL(window.location);return l.searchParams.get("config")&&"puma"===l.searchParams.get("config")&&await f(t,"a07528d1d37542b79fade50370f2305f"),m=new o.Z({view:t,container:e,listItemCreatedFunction:E}),m.on("trigger-action",(e=>{"Property"===e.item.layer.title&&g(e)})),m})(t.current,e.view).then((e=>{r(e),e.when((()=>{s(!1)}))}))),()=>{i&&(null===i||void 0===i||i.destroy())})),[]),(0,a.useEffect)((()=>{c(e.isActive)}),[e.isActive]);const y=(0,a.useCallback)((t=>{e.panelDismissed()}),[]),u=(0,a.useCallback)((t=>{e.showTips(A)}),[]);return{ref:t,layerList:i,isLoading:n,isActive:d,panelDismissed:y,tipsClicked:u}},w=e=>{const{ref:t,layerList:l,isLoading:a,isActive:r,panelDismissed:n,tipsClicked:s}=x(e);return(0,c.jsxs)(i.N$,{id:"layers-panel",heading:"Layers",hidden:!r,closed:!r||void 0,closable:!0,onCalcitePanelClose:n,children:[(0,c.jsx)(i.G1,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:s}),(0,c.jsx)(i.$A,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),(0,c.jsxs)("div",{className:"layers",children:[l&&(0,c.jsxs)("div",{className:"row sticky",children:[(0,c.jsx)(i.e,{clearable:!0,placeholder:"Filter by layer name",scale:"m",onCalciteInputInput:e=>{l&&((e,t)=>{e||(e=""),t.operationalItems.forEach((l=>{if("group"===l.layer.type){let y=!1;var i,a,r,n,s,o,d,c;l.layer.layers.forEach((t=>{t.title.toLowerCase().includes(e.toLowerCase())?(t.listMode="show",y=!0):t.listMode="hide","group"===t.type&&t.layers.forEach((l=>{l.title.toLowerCase().includes(e.toLowerCase())?(t.listMode="show",l.listMode="show",y=!0):l.listMode="hide"}))})),l.open=e.length>0&&y,(!e.length||y)&&(null===(i=document.getElementById(`${t.id}_${l.uid}__title`))||void 0===i||null===(a=i.parentElement)||void 0===a||null===(r=a.parentElement)||void 0===r||null===(n=r.parentElement)||void 0===n||n.removeAttribute("hidden")),y||null===(s=document.getElementById(`${t.id}_${l.uid}__title`))||void 0===s||null===(o=s.parentElement)||void 0===o||null===(d=o.parentElement)||void 0===d||null===(c=d.parentElement)||void 0===c||c.setAttribute("hidden","")}}))})(e.target.value,l)}}),(0,c.jsx)(i.G1,{text:"clear",icon:"viewHide",scale:"s",onClick:()=>{var e;(null===(e=l)||void 0===e?void 0:e.view.map.allLayers.filter((e=>"group"===e.type))).forEach((e=>{e.visible="Property"===e.title,e.layers.forEach((e=>{e.visible="Property"===e.title}))}))}})]}),(0,c.jsx)("div",{ref:t}),(0,c.jsx)(i.Ed,{loading:!0,hidden:!a||void 0})]})]})},T=w}}]);
//# sourceMappingURL=4402.6042cf20.chunk.js.map