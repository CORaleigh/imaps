(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[12],{135:function(t,e,r){"use strict";function i(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}r.d(e,"a",(function(){return i})),function(t){t.int=function(t){return Math.round(t).toString()},t.float=function(t){return t.toPrecision(8)}}(i||(i={}))},208:function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var i=r(113),n=r(85),s=r(259),o=r(232),a=r(577);class c{constructor(t,e,r=null){this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,t.instanceCounter.increment(o.c.Texture,this),this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...e},34067===this._descriptor.target?this.setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.c.Texture,this))}release(){this.dispose()}resize(t,e){const r=this._descriptor;r.width===t&&r.height===e||(r.width=t,r.height=e,34067===this._descriptor.target?this.setDataCubeMap(null):this.setData(null))}setDataCubeMap(t=null){for(let e=34069;e<=34074;e++)this.setData(t,e)}setData(t,e=3553){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const i=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES),o=this._descriptor;c._validateTexture(this._context,o),r.pixelStorei(r.UNPACK_ALIGNMENT,o.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.preMultiplyAlpha?1:0);const a=o.pixelFormat;let u=o.internalFormat?o.internalFormat:this._deriveInternalFormat(a,o.dataType);if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement){let i=t.width,n=t.height;t instanceof HTMLVideoElement&&(i=t.videoWidth,n=t.videoHeight),o.width&&o.height,r.texImage2D(e,0,u,a,o.dataType,t),Object(s.a)(r),o.hasMipmap&&this.generateMipmap(),void 0===o.width&&(o.width=i),void 0===o.height&&(o.height=n)}else{null!=o.width&&null!=o.height||console.error("Width and height must be specified!"),r.DEPTH24_STENCIL8&&u===r.DEPTH_STENCIL&&(u=r.DEPTH24_STENCIL8);let i=o.width,c=o.height;if(function(t){return Object(n.l)(t)&&"type"in t&&"compressed"===t.type}(t)){const n=Math.round(Math.log(Math.max(i,c))/Math.LN2)+1;o.hasMipmap=o.hasMipmap&&n===t.levels.length;for(let s=0;;++s){const n=t.levels[Math.min(s,t.levels.length-1)];if(r.compressedTexImage2D(e,s,u,i,c,0,n),1===i&&1===c||!o.hasMipmap)break;i=Math.max(1,i>>1),c=Math.max(1,c>>1)}}else if(Object(n.l)(t))r.texImage2D(e,0,u,i,c,0,a,o.dataType,t),Object(s.a)(r),o.hasMipmap&&this.generateMipmap();else for(let t=0;r.texImage2D(e,t,u,i,c,0,a,o.dataType,null),Object(s.a)(r),(1!==i||1!==c)&&o.hasMipmap;++t)i=Math.max(1,i>>1),c=Math.max(1,c>>1)}c._applySamplingMode(r,this._descriptor),c._applyWrapMode(r,this._descriptor),c._applyAnisotropicFilteringParameters(this._context,this._descriptor),Object(s.a)(r),this._context.bindTexture(i,c.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,e,r,i,n,s,o=3553){s||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,u=this._descriptor,l=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);(e<0||r<0||i>u.width||n>u.height||e+i>u.width||r+n>u.height)&&console.error("An attempt to update out of bounds of the texture!"),a.pixelStorei(a.UNPACK_ALIGNMENT,u.unpackAlignment),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,u.flipped?1:0),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u.preMultiplyAlpha?1:0),s instanceof ImageData||s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement?a.texSubImage2D(o,t,e,r,u.pixelFormat,u.dataType,s):a.texSubImage2D(o,t,e,r,i,n,u.pixelFormat,u.dataType,s),this._context.bindTexture(l,c.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;t.hasMipmap||(t.hasMipmap=!0,this._samplingModeDirty=!0,c._validateTexture(this._context,t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);const e=this._context.bindTexture(this,c.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(t.target),this._context.bindTexture(e,c.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,c._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,e=this._descriptor;this._samplingModeDirty&&(c._applySamplingMode(t,e),this._samplingModeDirty=!1),this._wrapModeDirty&&(c._applyWrapMode(t,e),this._wrapModeDirty=!1)}_deriveInternalFormat(t,e){if("webgl"===this._context.webglVersion)return t;if(5126===e)switch(t){case 6408:return 34836;case 6407:return 34837;default:throw new Error("Unable to derive format")}return t}static _validateTexture(t,e){(e.width<0||e.height<0)&&console.error("Negative dimension parameters are not allowed!");const r=Object(i.j)(e.width)&&Object(i.j)(e.height);Object(a.a)(t.gl)||r||("number"==typeof e.wrapMode?33071!==e.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===e.wrapMode.s&&33071===e.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,e){let r=e.samplingMode,i=e.samplingMode;9985===r||9987===r?(r=9729,e.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,e.hasMipmap||(i=9728)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}static _applyWrapMode(t,e){"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,e){var r;const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,null!=(r=e.maxAnisotropy)?r:1)}}c.TEXTURE_UNIT_FOR_UPDATES=0},232:function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return n}));const i=33984;var n;!function(t){t[t.Texture=0]="Texture",t[t.Buffer=1]="Buffer",t[t.VAO=2]="VAO",t[t.VertexShader=3]="VertexShader",t[t.FragmentShader=4]="FragmentShader",t[t.Program=5]="Program",t[t.Framebuffer=6]="Framebuffer",t[t.Renderbuffer=7]="Renderbuffer",t[t.COUNT=8]="COUNT"}(n||(n={}));const s=33306},244:function(t,e,r){"use strict";function i(){return[0,0,0,0]}function n(t){return[t[0],t[1],t[2],t[3]]}function s(t,e,r,i){return[t,e,r,i]}function o(t){const e=[0,0,0,0],r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function a(t,e){return new Float64Array(t,e,4)}function c(){return[0,0,0,0]}function u(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function h(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function f(){return s(0,0,0,1)}r.d(e,"a",(function(){return m})),r.d(e,"b",(function(){return p})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return n})),r.d(e,"e",(function(){return i})),r.d(e,"f",(function(){return o})),r.d(e,"g",(function(){return s}));const p=[0,0,0,0],m=u(),g=l(),b=h(),_=d(),v=f();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,fromArray:o,createView:a,zeros:c,ones:u,unitX:l,unitY:h,unitZ:d,unitW:f,ZEROS:p,ONES:m,UNIT_X:g,UNIT_Y:b,UNIT_Z:_,UNIT_W:v})},259:function(t,e,r){"use strict";r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return c}));var i=r(88),n=r(82);const s=r(87).a.getLogger("esri/views/webgl");const o=!!Object(n.a)("enable-feature:webgl-debug");function a(){return o}function c(){return o}function u(t){if(a()){const e=t.getError();if(e){const r=function(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(t,e),n=(new Error).stack;s.error(new i.a("webgl-error","WebGL error occured",{message:r,stack:n}))}}}},265:function(t,e,r){"use strict";r.d(e,"a",(function(){return h}));var i=r(87),n=r(85),s=r(259),o=r(232),a=r(793),c=r(208),u=r(762);const l=i.a.getLogger("esri.views.webgl.FrameBufferObject");class h{constructor(t,e,r=null,i=null){if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...e},t.instanceCounter.increment(o.c.Framebuffer,this),Object(n.l)(r)){Array.isArray(r)||(r=[r]);for(let e=0;e<r.length;++e){var s,u;const i=r[e];let n;d(i)?(n=i.descriptor,this._colorAttachments.set(36064+e,i)):(n=i,this._colorAttachments.set(36064+e,new c.a(t,i))),0!==(null==(s=this._desc)?void 0:s.colorTarget)&&2!==(null==(u=this._desc)?void 0:u.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateColorAttachmentPoint(36064+e),this._validateTextureDimensions(n,this._desc)}}if(i instanceof a.a){var l;const t=null!=(l=this._desc.depthStencilTarget)?l:3;2===t?this._stencilAttachment=i:1===t||3===t?this._depthAttachment=i:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),f(i.descriptor,this._desc)}else if(Object(n.l)(i)){let t;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),d(i)?(this._depthStencilTexture=i,t=i.descriptor):this._depthStencilTexture=new c.a(this._context,i),this._validateTextureDimensions(t,this._desc)}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(o.c.Framebuffer,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(36064);return t&&d(t)?t:null}get colorAttachment(){return this._colorAttachments.get(36064)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return Object(u.c)(this.colorAttachment)+Object(u.c)(this.depthStencilAttachment)}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&d(e)?e:null}framebufferTexture2D(t,e,r=36064,i=3553,n=0){e.framebufferTexture2D(e.FRAMEBUFFER,r,i,t,n)}attachColorTexture(t,e=36064){if(!t)return;this._validateColorAttachmentPoint(e);const r=t.descriptor;this._validateTextureDimensions(r,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(t.glName,this._context.gl,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=36064){const e=this._colorAttachments.get(t);if(d(e)){const r=e;return this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,t)),this._colorAttachments.delete(t),r}}attachDepthStencilTexture(t){if(Object(n.k)(t))return;const e=t.descriptor;34041!==e.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==e.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(e,this._desc),this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(t.glName,this._context.gl,o.b)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,o.b)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(Object(n.k)(t))return;const e=t.descriptor;if(34041!==e.internalFormat&&33189!==e.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),f(e,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===e.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl,r=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,e=this._depthAttachment;if(e&&this._initialized){this._context.bindFramebuffer(this);const e=1===this._desc.depthStencilTarget?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,null)}return this._depthAttachment=null,e}detachAll(){this.detachColorTexture(),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,e,r,i,n,s,o){(t<0||e<0||n<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const a=this._desc,u=o.descriptor;3553!==o.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(t+r>a.width||e+i>a.height||n+r>u.width||s+i>u.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const l=this._context,h=l.bindTexture(o,c.a.TEXTURE_UNIT_FOR_UPDATES);l.bindFramebuffer(this),l.gl.copyTexSubImage2D(3553,0,n,s,t,e,r,i),l.bindTexture(h,c.a.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,r,i,n,s,o){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,r,i,n,s,o)}resize(t,e){const r=this._desc;if(r.width!==t||r.height!==e){if(!this._initialized)return r.width=t,r.height=e,this._colorAttachments.forEach((r=>{r&&r.resize(t,e)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,e));r.width=t,r.height=e,this._colorAttachments.forEach((r=>{r&&r.resize(t,e)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(t,e):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,e),this._stencilAttachment&&this._stencilAttachment.resize(t,e)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=3553){var e,r,i,n;const o=this._context.gl;if(this._initialized)return void o.bindFramebuffer(o.FRAMEBUFFER,this.glName);this._glName&&o.deleteFramebuffer(this._glName);const u=this._context,l=o.createFramebuffer(),h=this._desc,f=null!=(e=h.colorTarget)?e:1,p=null!=(r=h.width)?r:1,m=null!=(i=h.height)?i:1;if(o.bindFramebuffer(o.FRAMEBUFFER,l),0===this._colorAttachments.size)if(0===f)this._colorAttachments.set(36064,function(t,e,r){return new c.a(t,{target:r,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e.width,height:e.height})}(u,h,2===this.descriptor.colorTarget?34067:3553));else{const t=new a.a(u,{internalFormat:32854,width:p,height:m});this._colorAttachments.set(36064,t)}this._colorAttachments.forEach(((e,r)=>{e&&(d(e)?this.framebufferTexture2D(e.glName,o,r,t):o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,e.glName))}));const g=null!=(n=h.depthStencilTarget)?n:0;switch(g){case 1:case 3:{this._depthAttachment||(this._depthAttachment=new a.a(u,{internalFormat:1===h.depthStencilTarget?33189:34041,width:p,height:m}));const t=1===g?o.DEPTH_ATTACHMENT:o.DEPTH_STENCIL_ATTACHMENT;o.framebufferRenderbuffer(o.FRAMEBUFFER,t,o.RENDERBUFFER,this._depthAttachment.glName);break}case 2:this._stencilAttachment||(this._stencilAttachment=new a.a(u,{internalFormat:36168,width:p,height:m})),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){u.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const t={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:p,height:m};this._depthStencilTexture=new c.a(u,t)}this.framebufferTexture2D(this._depthStencilTexture.glName,o,o.DEPTH_STENCIL_ATTACHMENT,t)}Object(s.c)()&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=l,this._initialized=!0}_disposeColorAttachments(){this._colorAttachments.forEach(((t,e)=>{if(d(t))this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,this._context.gl,e)),t.dispose();else if(t instanceof WebGLRenderbuffer){const r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,e,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}})),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const e=1===this._desc.depthStencilTarget?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this.framebufferTexture2D(null,t,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateTextureDimensions(t,e){3553!==t.target&&34067!==t.target&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),void 0!==e.width&&e.width>=0&&void 0!==e.height&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}_validateColorAttachmentPoint(t){if(-1===h._MAX_COLOR_ATTACHMENTS){const t=this._context.capabilities.drawBuffers;if(t){const e=this._context.gl;h._MAX_COLOR_ATTACHMENTS=e.getParameter(t.MAX_COLOR_ATTACHMENTS)}else h._MAX_COLOR_ATTACHMENTS=1}const e=t-36064;e+1>h._MAX_COLOR_ATTACHMENTS&&l.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function d(t){return"type"in t&&"texture"===t.type}function f(t,e){void 0!==e.width&&e.width>=0&&void 0!==e.height&&e.height>=0?e.width===t.width&&e.height===t.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=t.width,e.height=t.height)}h._MAX_COLOR_ATTACHMENTS=-1},270:function(t,e,r){"use strict";r.d(e,"a",(function(){return m})),r.d(e,"b",(function(){return g})),r.d(e,"c",(function(){return d})),r.d(e,"d",(function(){return f})),r.d(e,"e",(function(){return p}));var i=r(313),n=r(329),s=r(197),o=r(397),a=r(222),c=r(106),u=r(244);class l{constructor(t,e,r){this.itemByteSize=t,this.itemCreate=e,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){0===this._itemsPtr&&Object(i.a)((()=>this.reset()));const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const t=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let e=0;e<this._itemsPerBuffer;++e)this._items.push(this.itemCreate(t,e*this.itemByteSize));this._buffers.push(t)}return this._items[this._itemsPtr++]}reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=h){return new l(16,a.c,t)}static createVec3f64(t=h){return new l(24,c.e,t)}static createVec4f64(t=h){return new l(32,u.c,t)}static createMat3f64(t=h){return new l(72,n.a,t)}static createMat4f64(t=h){return new l(128,s.b,t)}static createQuatf64(t=h){return new l(32,o.d,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const h=4096,d=l.createVec2f64(),f=l.createVec3f64(),p=l.createVec4f64(),m=(l.createMat3f64(),l.createMat4f64()),g=l.createQuatf64()},306:function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return c}));var i=r(85),n=r(116),s=r(106),o=r(135);function a(t,e){if(e.slicePlaneEnabled){t.extensions.add("GL_OES_standard_derivatives"),e.sliceEnabledForVertexPrograms&&(t.vertex.uniforms.add("slicePlaneOrigin","vec3"),t.vertex.uniforms.add("slicePlaneBasis1","vec3"),t.vertex.uniforms.add("slicePlaneBasis2","vec3")),t.fragment.uniforms.add("slicePlaneOrigin","vec3"),t.fragment.uniforms.add("slicePlaneBasis1","vec3"),t.fragment.uniforms.add("slicePlaneBasis2","vec3");const r=o.a`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,i=o.a`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=e.sliceHighlightDisabled?o.a`#define highlightSlice(_color_, _pos_) (_color_)`:o.a`
        ${i}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;e.sliceEnabledForVertexPrograms&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(n)}else{const r=o.a`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;e.sliceEnabledForVertexPrograms&&t.vertex.code.add(r),t.fragment.code.add(r)}}function c(t,e,r){u(t,e,r.slicePlane,r.origin)}function u(t,e,r,o){e.slicePlaneEnabled&&(Object(i.l)(r)?(o?(Object(n.j)(l,r.origin,o),t.setUniform3fv("slicePlaneOrigin",l)):t.setUniform3fv("slicePlaneOrigin",r.origin),t.setUniform3fv("slicePlaneBasis1",r.basis1),t.setUniform3fv("slicePlaneBasis2",r.basis2)):(t.setUniform3fv("slicePlaneBasis1",s.c),t.setUniform3fv("slicePlaneBasis2",s.c),t.setUniform3fv("slicePlaneOrigin",s.c)))}const l=Object(s.f)()},311:function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return d})),r.d(e,"c",(function(){return f})),r.d(e,"d",(function(){return l})),r.d(e,"e",(function(){return h})),r.d(e,"f",(function(){return p})),r.d(e,"g",(function(){return u})),r.d(e,"h",(function(){return a})),r.d(e,"i",(function(){return c}));r(113),r(149);var i=r(148),n=(r(222),r(106),r(236),r(244));Object(n.e)();class s{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function o(t,e){if(!t){e=e||"assert";const t=new Error(e);throw t.stack&&console.log(t.stack),new s(e)}}function a(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],c=(i[1]-t[1])/e[1];if(a>c&&(n=a,a=c,c=n),s>c||a>o)return!1;a>s&&(s=a),c<o&&(o=c);let u=(r[2]-t[2])/e[2],l=(i[2]-t[2])/e[2];return u>l&&(n=u,u=l,l=n),!(s>l||u>o)&&(l<o&&(o=l),!(o<0))}function c(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function u(t){return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&1===t[15]}function l(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function h(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function d(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function f(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function p(t,e,r,n,s){const o=t;0===t[11]?(n[0]=2/(e*o[0]),n[1]=2/(r*o[5]),n[2]=(1+o[12])/o[0],n[3]=(1+o[13])/o[5],Object(i.s)(s,0,1)):(n[0]=-2/(e*o[0]),n[1]=-2/(r*o[5]),n[2]=(1-o[8])/o[0],n[3]=(1-o[9])/o[5],Object(i.s)(s,1,0))}},330:function(t,e,r){"use strict";r.d(e,"a",(function(){return f})),r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return d})),r.d(e,"e",(function(){return l})),r.d(e,"f",(function(){return h})),r.d(e,"g",(function(){return c}));r(84);var i=r(411),n=r(116),s=r(106),o=r(270);function a(t){return t?{origin:Object(s.d)(t.origin),direction:Object(s.d)(t.direction)}:{origin:Object(s.f)(),direction:Object(s.f)()}}function c(t,e){const r=p.get();return r.origin=t,r.direction=e,r}function u(t,e=a()){return h(t.origin,t.direction,e)}function l(t,e,r=a()){return Object(n.k)(r.origin,t),Object(n.j)(r.direction,e,t),r}function h(t,e,r=a()){return Object(n.k)(r.origin,t),Object(n.k)(r.direction,e),r}function d(t,e){const r=Object(n.g)(o.d.get(),Object(n.r)(o.d.get(),t.direction),Object(n.j)(o.d.get(),e,t.origin));return Object(n.h)(r,r)}function f(t,e,r){const i=Object(n.h)(t.direction,Object(n.j)(r,e,t.origin));return Object(n.f)(r,t.origin,Object(n.e)(r,t.direction,i)),r}const p=new i.a((function(){return{origin:null,direction:null}}))},342:function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));const i=r(87).a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class n{constructor(){this.includedModules=new Map}include(t,e){this.includedModules.has(t)?this.includedModules.get(t)!==e&&i.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(t,e),t(this.builder,e))}}class s extends n{constructor(){super(...arguments),this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new l,this.extensions=new h,this.constants=new d}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(t){const e=this.extensions.generateSource(t),r=this.attributes.generateSource(t),i=this.varyings.generateSource(),n="vertex"===t?this.vertex:this.fragment,s=n.uniforms.generateSource(),o=n.code.generateSource(),a="vertex"===t?p:f,c=this.constants.generateSource().concat(n.constants.generateSource());return`\n${e.join("\n")}\n\n${a}\n\n${c.join("\n")}\n\n${s.join("\n")}\n\n${r.join("\n")}\n\n${i.join("\n")}\n\n${o.join("\n")}`}}class o{constructor(){this._entries=new Map}add(t,e,r){const i=`${t}_${e}_${r}`;return this._entries.set(i,{name:t,type:e,arraySize:r}),this}generateSource(){return Array.from(this._entries.values()).map((t=>`uniform ${t.type} ${t.name}${(t=>t?`[${t}]`:"")(t.arraySize)};`))}get entries(){return Array.from(this._entries.values())}}class a{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class c extends n{constructor(){super(...arguments),this.uniforms=new o,this.code=new a,this.constants=new d}get builder(){return this}}class u{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`attribute ${t[1]} ${t[0]};`))}}class l{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(){return this._entries.map((t=>`varying ${t[1]} ${t[0]};`))}}class h{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?h.ALLOWLIST_VERTEX:h.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}}h.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],h.ALLOWLIST_VERTEX=[];class d{constructor(){this._entries=[]}add(t,e,r){let i="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":i=d.numberToFloatStr(r);break;case"int":i=d.numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${d.numberToFloatStr(r[0])},                            ${d.numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${d.numberToFloatStr(r[0])},                            ${d.numberToFloatStr(r[1])},                            ${d.numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${d.numberToFloatStr(r[0])},                            ${d.numberToFloatStr(r[1])},                            ${d.numberToFloatStr(r[2])},                            ${d.numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${d.numberToIntStr(r[0])},                             ${d.numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${d.numberToIntStr(r[0])},                             ${d.numberToIntStr(r[1])},                             ${d.numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${d.numberToIntStr(r[0])},                             ${d.numberToIntStr(r[1])},                             ${d.numberToIntStr(r[2])},                             ${d.numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${e}(${Array.prototype.map.call(r,(t=>d.numberToFloatStr(t))).join(", ")})`}return this._entries.push(`const ${e} ${t} = ${i};`),this}static numberToIntStr(t){return t.toFixed(0)}static numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const f="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",p="precision highp float;\nprecision highp sampler2D;"},352:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return n}));var i=r(135);function n(t,e){t.fragment.uniforms.add("terrainDepthTexture","sampler2D"),t.fragment.uniforms.add("cameraNearFar","vec2"),t.fragment.uniforms.add("inverseViewport","vec2"),t.fragment.code.add(i.a`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function s(t,e){e.multipassTerrainEnabled&&e.terrainLinearDepthTexture&&t.bindTexture(e.terrainLinearDepthTexture,"terrainDepthTexture")}},389:function(t,e,r){"use strict";function i(t,e,r=32774,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function n(t,e,r,i,n=32774,s=32774,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}r.d(e,"a",(function(){return L})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return u})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return o})),r.d(e,"f",(function(){return _})),r.d(e,"g",(function(){return n})),r.d(e,"h",(function(){return i}));const s={face:1029,mode:2305},o={face:1028,mode:2305},a=t=>2===t?s:1===t?o:null,c={zNear:0,zFar:1},u={r:!0,g:!0,b:!0,a:!0};function l(t){return T.intern(t)}function h(t){return S.intern(t)}function d(t){return M.intern(t)}function f(t){return y.intern(t)}function p(t){return F.intern(t)}function m(t){return P.intern(t)}function g(t){return z.intern(t)}function b(t){return C.intern(t)}function _(t){return R.intern(t)}class v{constructor(t,e){this.makeKey=t,this.makeRef=e,this.interns=new Map}intern(t){if(!t)return null;const e=this.makeKey(t),r=this.interns;return r.has(e)||r.set(e,this.makeRef(t)),r.get(e)}}function x(t){return"["+t.join(",")+"]"}const T=new v(O,(t=>({__tag:"Blending",...t})));function O(t){return t?x([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const S=new v(w,(t=>({__tag:"Culling",...t})));function w(t){return t?x([t.face,t.mode]):null}const M=new v(A,(t=>({__tag:"PolygonOffset",...t})));function A(t){return t?x([t.factor,t.units]):null}const y=new v(j,(t=>({__tag:"DepthTest",...t})));function j(t){return t?x([t.func]):null}const F=new v(E,(t=>({__tag:"StencilTest",...t})));function E(t){return t?x([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const P=new v(I,(t=>({__tag:"DepthWrite",...t})));function I(t){return t?x([t.zNear,t.zFar]):null}const z=new v(D,(t=>({__tag:"ColorWrite",...t})));function D(t){return t?x([t.r,t.g,t.b,t.a]):null}const C=new v(N,(t=>({__tag:"StencilWrite",...t})));function N(t){return t?x([t.mask]):null}const R=new v((function(t){return t?x([O(t.blending),w(t.culling),A(t.polygonOffset),j(t.depthTest),E(t.stencilTest),I(t.depthWrite),D(t.colorWrite),N(t.stencilWrite)]):null}),(t=>({blending:l(t.blending),culling:h(t.culling),polygonOffset:d(t.polygonOffset),depthTest:f(t.depthTest),stencilTest:p(t.stencilTest),depthWrite:m(t.depthWrite),colorWrite:g(t.colorWrite),stencilWrite:b(t.stencilWrite)})));class L{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this.setBlending(t.blending),this.setCulling(t.culling),this.setPolygonOffset(t.polygonOffset),this.setDepthTest(t.depthTest),this.setStencilTest(t.stencilTest),this.setDepthWrite(t.depthWrite),this.setColorWrite(t.colorWrite),this.setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}setBlending(t){this._blending=this.setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}setCulling(t){this._culling=this.setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}setPolygonOffset(t){this._polygonOffset=this.setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}setDepthTest(t){this._depthTest=this.setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}setStencilTest(t){this._stencilTest=this.setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}setDepthWrite(t){this._depthWrite=this.setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}setColorWrite(t){this._colorWrite=this.setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}setStencilWrite(t){this._stencilWrite=this.setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}setSubState(t,e,r,i){return(r||t!==e)&&(i(t),this._pipelineInvalid=!0),t}}},398:function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(632),n=r(135);function s(t){t.include(i.a),t.code.add(n.a`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},399:function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return c}));var i=r(244),n=r(135);const s=Object(i.g)(1,1,0,1),o=Object(i.g)(1,0,1,1);function a(t){t.fragment.uniforms.add("depthTex","sampler2D"),t.fragment.uniforms.add("highlightViewportPixelSz","vec4"),t.fragment.constants.add("occludedHighlightFlag","vec4",s).add("unoccludedHighlightFlag","vec4",o),t.fragment.code.add(n.a`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function c(t,e){t.bindTexture(e.highlightDepthTexture,"depthTex"),t.setUniform4f("highlightViewportPixelSz",0,0,e.inverseViewport[0],e.inverseViewport[1])}},405:function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return s}));var i=r(135);const n=.1,s=.001;function o(t,e){const r=t.fragment;switch(e.alphaDiscardMode){case 0:r.code.add(i.a`
        #define discardOrAdjustAlpha(color) { if (color.a < ${i.a.float(s)}) { discard; } }
      `);break;case 1:r.code.add(i.a`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:r.uniforms.add("textureAlphaCutoff","float"),r.code.add(i.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:t.fragment.uniforms.add("textureAlphaCutoff","float"),t.fragment.code.add(i.a`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},411:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(313);class n{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this.grow()}get(){return 0===this._itemsPtr&&Object(i.a)((()=>this.reset())),this._itemsPtr===this._items.length&&this.grow(),this._items[this._itemsPtr++]}reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*s);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,s));t++)this._items.push(this.allocator())}}const s=1024},418:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));class i{constructor(t,e){this._module=t,this._loadModule=e}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}},419:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r(85),n=r(219),s=r(259),o=r(572);class a extends o.a{constructor(t,e,r){super(t,e.generateSource("vertex"),e.generateSource("fragment"),r),this._textures=new Map,this._freeTextureUnits=new n.a({deallocator:null}),this._fragmentUniforms=Object(s.b)()?e.fragmentUniforms.entries:null}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,e){if(Object(i.k)(t)||null==t.glName){const t=this._textures.get(e);return t&&(this._context.bindTexture(null,t.unit),this._freeTextureUnit(t),this._textures.delete(e)),null}let r=this._textures.get(e);return null==r?(r=this._allocTextureUnit(t),this._textures.set(e,r)):r.texture=t,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(t,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((t,e)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(e,t.unit)})),Object(i.l)(this._fragmentUniforms)&&this._fragmentUniforms.forEach((t=>{if(("sampler2D"===t.type||"samplerCube"===t.type)&&!this._textures.has(t.name))throw new Error(`Texture sampler ${t.name} has no bound texture`)}))}_allocTextureUnit(t){return{texture:t,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}},425:function(t,e,r){"use strict";r.d(e,"a",(function(){return O})),r.d(e,"b",(function(){return y})),r.d(e,"c",(function(){return S})),r.d(e,"d",(function(){return x})),r.d(e,"e",(function(){return M})),r.d(e,"f",(function(){return d})),r.d(e,"g",(function(){return g})),r.d(e,"h",(function(){return w})),r.d(e,"i",(function(){return T}));var i=r(113),n=r(85),s=r(116),o=r(106),a=r(220),c=r(851),u=r(311),l=r(525);const h=Object(a.f)();function d(t,e,r,i,n,s,o){if(!Object(l.d)(e))if(t.boundingInfo){Object(u.a)(0===t.primitiveType);const e=r.tolerance;p(t.boundingInfo,i,n,e,s,o)}else{const e=t.indices.get("position"),r=t.vertexAttributes.get("position");g(i,n,0,e.length/3,e,r,void 0,s,o)}}const f=Object(o.f)();function p(t,e,r,i,o,c){if(Object(n.k)(t))return;const u=function(t,e,r){return Object(s.w)(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}(e,r,f);if(Object(a.y)(h,t.getBBMin()),Object(a.x)(h,t.getBBMax()),Object(n.l)(o)&&o.applyToAabb(h),x(h,e,u,i)){const{primitiveIndices:n,indices:s,position:a}=t,u=n?n.length:s.length/3;if(u>j){const n=t.getChildren();if(void 0!==n){for(let t=0;t<8;++t)void 0!==n[t]&&p(n[t],e,r,i,o,c);return}}g(e,r,0,u,s,a,n,o,c)}}const m=Object(o.f)();function g(t,e,r,i,s,o,a,c,u){if(a)return function(t,e,r,i,s,o,a,c,u){const l=o.data,h=o.stride||o.size,d=t[0],f=t[1],p=t[2],g=e[0]-d,b=e[1]-f,_=e[2]-p;for(let x=r;x<i;++x){const t=a[x];let e=3*t,r=h*s[e++],i=l[r++],o=l[r++],T=l[r];r=h*s[e++];let O=l[r++],S=l[r++],w=l[r];r=h*s[e];let M=l[r++],A=l[r++],y=l[r];Object(n.l)(c)&&([i,o,T]=c.applyToVertex(i,o,T,x),[O,S,w]=c.applyToVertex(O,S,w,x),[M,A,y]=c.applyToVertex(M,A,y,x));const j=O-i,F=S-o,E=w-T,P=M-i,I=A-o,z=y-T,D=b*z-I*_,C=_*P-z*g,N=g*I-P*b,R=j*D+F*C+E*N;if(Math.abs(R)<=Number.EPSILON)continue;const L=d-i,U=f-o,B=p-T,H=L*D+U*C+B*N;if(R>0){if(H<0||H>R)continue}else if(H>0||H<R)continue;const V=U*E-F*B,k=B*j-E*L,W=L*F-j*U,G=g*V+b*k+_*W;if(R>0){if(G<0||H+G>R)continue}else if(G>0||H+G<R)continue;const q=(P*V+I*k+z*W)/R;q>=0&&u(q,v(j,F,E,P,I,z,m),t,!1)}}(t,e,r,i,s,o,a,c,u);const l=o.data,h=o.stride||o.size,d=t[0],f=t[1],p=t[2],g=e[0]-d,b=e[1]-f,_=e[2]-p;for(let x=r,T=3*r;x<i;++x){let t=h*s[T++],e=l[t++],r=l[t++],i=l[t];t=h*s[T++];let o=l[t++],a=l[t++],O=l[t];t=h*s[T++];let S=l[t++],w=l[t++],M=l[t];Object(n.l)(c)&&([e,r,i]=c.applyToVertex(e,r,i,x),[o,a,O]=c.applyToVertex(o,a,O,x),[S,w,M]=c.applyToVertex(S,w,M,x));const A=o-e,y=a-r,j=O-i,F=S-e,E=w-r,P=M-i,I=b*P-E*_,z=_*F-P*g,D=g*E-F*b,C=A*I+y*z+j*D;if(Math.abs(C)<=Number.EPSILON)continue;const N=d-e,R=f-r,L=p-i,U=N*I+R*z+L*D;if(C>0){if(U<0||U>C)continue}else if(U>0||U<C)continue;const B=R*j-y*L,H=L*A-j*N,V=N*y-A*R,k=g*B+b*H+_*V;if(C>0){if(k<0||U+k>C)continue}else if(k>0||U+k<C)continue;const W=(F*B+E*H+P*V)/C;W>=0&&u(W,v(A,y,j,F,E,P,m),x,!1)}}const b=Object(o.f)(),_=Object(o.f)();function v(t,e,r,i,n,o,a){return Object(s.w)(b,t,e,r),Object(s.w)(_,i,n,o),Object(s.g)(a,b,_),Object(s.r)(a,a),a}function x(t,e,r,i){return function(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),c=Math.max(s,o);const u=(t[1]-i-e[1])*r[1],l=(t[4]+i-e[1])*r[1];if(c=Math.min(c,Math.max(u,l)),c<0)return!1;if(a=Math.max(a,Math.min(u,l)),a>c)return!1;const h=(t[2]-i-e[2])*r[2],d=(t[5]+i-e[2])*r[2];return c=Math.min(c,Math.max(h,d)),!(c<0)&&(a=Math.max(a,Math.min(h,d)),!(a>c)&&a<n)}(t,e,r,i,1/0)}function T(t,e,r,n,s){let o=(r.screenLength||0)*t.pixelRatio;s&&(o=Object(c.d)(o,n,e,s));const a=o*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Object(i.e)(a*e,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)}function O(t,e,r){if(!t)return;const i=t.parameters,n=t.paddingPixelsOverride;e.setUniform4f(r,i.divisor,i.offset,i.minPixelSize,n)}function S(t,e){const r=e?S(e):{};for(const i in t){let e=t[i];e&&e.forEach&&(e=A(e)),null==e&&i in r||(r[i]=e)}return r}function w(t,e){let r=!1;for(const i in e){const n=e[i];void 0!==n&&(r=!0,Array.isArray(n)?t[i]=n.slice():t[i]=n)}return r}function M(t,e,r,n,s,o){if(!e.options.selectionMode)return;const a=t.vertexAttributes.get("position").data,c=t.vertexAttributes.get("size"),u=c&&c.data[0],l=n[0],h=n[1],d=((u+s)/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,p=0;for(let m=0;m<a.length-5;m+=3){const t=a[m],e=a[m+1],r=l-t,n=h-e,s=a[m+3]-t,o=a[m+4]-e,c=Object(i.e)((s*r+o*n)/(s*s+o*o),0,1),u=s*c-r,d=o*c-n,g=u*u+d*d;g<f&&(f=g,p=m/3)}f<d*d&&o(r.dist,r.normal,p,!1)}function A(t){const e=[];return t.forEach((t=>e.push(t))),e}const y={multiply:1,ignore:2,replace:3,tint:4},j=1e3},430:function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return d})),r.d(e,"c",(function(){return c})),r.d(e,"d",(function(){return l})),r.d(e,"e",(function(){return u})),r.d(e,"f",(function(){return o})),r.d(e,"g",(function(){return n})),r.d(e,"h",(function(){return h}));var i=r(389);const n=Object(i.g)(770,1,771,771),s=Object(i.h)(1,1),o=Object(i.h)(0,771);function a(t){return 2===t?null:1===t?o:s}function c(t){return 2===t?i.d:null}const u=5e5,l={factor:-1,units:-2};function h(t){return t?l:null}function d(t){return 3===t||2===t?513:515}},431:function(t,e,r){"use strict";function i(){return new Float32Array(3)}function n(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function o(){return i()}function a(){return s(1,1,1)}function c(){return s(1,0,0)}function u(){return s(0,1,0)}function l(){return s(0,0,1)}r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return i})),r.d(e,"c",(function(){return s}));const h=o(),d=a(),f=c(),p=u(),m=l();Object.freeze({__proto__:null,create:i,clone:n,fromValues:s,createView:function(t,e){return new Float32Array(t,e,3)},zeros:o,ones:a,unitX:c,unitY:u,unitZ:l,ZEROS:h,ONES:d,UNIT_X:f,UNIT_Y:p,UNIT_Z:m})},432:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(85);class n{constructor(t,e,r=(()=>this.dispose())){this.release=r,e&&(this._config=e.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t)}dispose(){this._program=Object(i.f)(this._program),this._pipeline=this._config=null}reload(t){Object(i.f)(this._program),this._program=this.initializeProgram(t)}get program(){return this._program}get key(){return this._config.key}get configuration(){return this._config}bindPass(t,e){}bindMaterial(t,e){}bindDraw(t){}bindPipelineState(t,e=null,r){t.setPipelineState(this.getPipelineState(e,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return 4}getPipelineState(t,e){return this._pipeline}}},433:function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return n}));class i{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map((()=>0)):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,e={key:this.key};for(const r of t)e[r]=this[r];return e}}function n(t={}){return(e,r)=>{var i,n;e._parameterNames=null!=(i=e._parameterNames)?i:[],e._parameterNames.push(r);const s=e._parameterNames.length-1,o=t.count||2,a=Math.ceil(Math.log2(o)),c=null!=(n=e._parameterBits)?n:[0];let u=0;for(;c[u]+a>16;)u++,u>=c.length&&c.push(0);e._parameterBits=c;const l=c[u],h=(1<<a)-1<<l;c[u]+=a,Object.defineProperty(e,r,{get(){return this[s]},set(t){if(this[s]!==t&&(this[s]=t,this._keyDirty=!0,this._parameterBits[u]=this._parameterBits[u]&~h|+t<<l&h,"number"!=typeof t&&"boolean"!=typeof t))throw"Configuration value for "+r+" must be boolean or number, got "+typeof t}})}}},434:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));const i=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]])},440:function(t,e,r){"use strict";r.d(e,"a",(function(){return _})),r.d(e,"b",(function(){return g})),r.d(e,"c",(function(){return m})),r.d(e,"d",(function(){return T})),r.d(e,"e",(function(){return x})),r.d(e,"f",(function(){return w})),r.d(e,"g",(function(){return z})),r.d(e,"h",(function(){return b}));r(82);var i=r(87),n=r(113),s=r(85),o=r(149),a=r(116),c=r(106),u=r(236),l=r(244),h=r(330),d=r(447),f=r(270);const p=i.a.getLogger("esri.geometry.support.sphere");function m(){return Object(l.e)()}function g(t,e=m()){return Object(u.c)(e,t)}function b(t){return t}function _(t){t[0]=t[1]=t[2]=t[3]=0}function v(t){return Array.isArray(t)?t[3]:t}function x(t){return Array.isArray(t)?t:P}function T(t,e,r,i){return Object(l.g)(t,e,r,i)}function O(t,e,r){if(Object(s.k)(e))return!1;const{origin:i,direction:n}=e,o=S;o[0]=i[0]-t[0],o[1]=i[1]-t[1],o[2]=i[2]-t[2];const a=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=2*(n[0]*o[0]+n[1]*o[1]+n[2]*o[2]),u=c*c-4*a*(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]-t[3]*t[3]);if(u<0)return!1;const l=Math.sqrt(u);let h=(-c-l)/(2*a);const d=(-c+l)/(2*a);return(h<0||d<h&&d>0)&&(h=d),!(h<0)&&(r&&(r[0]=i[0]+n[0]*h,r[1]=i[1]+n[1]*h,r[2]=i[2]+n[2]*h),!0)}const S=Object(c.f)();function w(t,e){return O(t,e,null)}function M(t,e,r){const i=f.d.get(),n=f.a.get();Object(a.g)(i,e.origin,e.direction);const s=v(t);Object(a.g)(r,i,e.origin),Object(a.e)(r,r,1/Object(a.p)(r)*s);const c=y(t,e.origin),u=Object(d.a)(e.origin,r);return Object(o.j)(n),Object(o.f)(n,n,u+c,i),Object(a.q)(r,r,n),r}function A(t,e,r){const i=Object(a.j)(f.d.get(),e,x(t)),n=Object(a.e)(f.d.get(),i,t[3]/Object(a.p)(i));return Object(a.f)(r,n,x(t))}function y(t,e){const r=Object(a.j)(f.d.get(),e,x(t)),i=Object(a.p)(r),s=v(t),o=s+Math.abs(s-i);return Object(n.b)(s/o)}const j=Object(c.f)();function F(t,e,r,i){const s=Object(a.j)(j,e,x(t));switch(r){case 0:{const t=Object(n.d)(s,j)[2];return Object(a.w)(i,-Math.sin(t),Math.cos(t),0)}case 1:{const t=Object(n.d)(s,j),e=t[1],r=t[2],o=Math.sin(e);return Object(a.w)(i,-o*Math.cos(r),-o*Math.sin(r),Math.cos(e))}case 2:return Object(a.r)(i,s);default:return}}function E(t,e){const r=Object(a.j)(I,e,x(t));return Object(a.p)(r)-t[3]}const P=Object(c.f)(),I=Object(c.f)(),z=Object.freeze({__proto__:null,create:m,copy:g,fromCenterAndRadius:function(t,e){return Object(l.g)(t[0],t[1],t[2],e)},wrap:b,clear:_,fromRadius:function(t){return t},getRadius:v,getCenter:x,fromValues:T,elevate:function(t,e,r){return t!==r&&Object(a.k)(r,t),r[3]=t[3]+e,r},setExtent:function(t,e,r){return p.error("sphere.setExtent is not yet supported"),t===r?r:g(t,r)},intersectRay:O,intersectsRay:w,intersectRayClosestSilhouette:function(t,e,r){if(O(t,e,r))return r;const i=M(t,e,f.d.get());return Object(a.f)(r,e.origin,Object(a.e)(f.d.get(),e.direction,Object(a.m)(e.origin,i)/Object(a.p)(e.direction))),r},closestPointOnSilhouette:M,closestPoint:function(t,e,r){return O(t,e,r)?r:(Object(h.a)(e,x(t),r),A(t,r,r))},projectPoint:A,distanceToSilhouette:function(t,e){const r=Object(a.j)(f.d.get(),e,x(t)),i=Object(a.t)(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))},angleToSilhouette:y,axisAt:F,altitudeAt:E,setAltitudeAt:function(t,e,r,i){const n=E(t,e),s=F(t,e,2,I),o=Object(a.e)(I,s,r-n);return Object(a.f)(i,e,o)}})},441:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(135);function n(t,e){e.linearDepth?t.vertex.code.add(i.a`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):t.vertex.code.add(i.a`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},447:function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return o})),r.d(e,"d",(function(){return a}));var i=r(113),n=r(116),s=r(106);function o(t,e,r){const i=Object(n.h)(t,e)/Object(n.h)(t,t);return Object(n.e)(r,t,i)}function a(t,e){return Object(n.h)(t,e)/Object(n.p)(t)}function c(t,e){const r=Object(n.h)(t,e)/(Object(n.p)(t)*Object(n.p)(e));return-Object(i.b)(r)}function u(t,e,r){Object(n.r)(l,t),Object(n.r)(h,e);const s=Object(n.h)(l,h),o=Object(i.b)(s),a=Object(n.g)(l,l,h);return Object(n.h)(a,r)<0?2*Math.PI-o:o}const l=Object(s.f)(),h=Object(s.f)()},452:function(t,e,r){"use strict";r.d(e,"a",(function(){return g})),r.d(e,"b",(function(){return m})),r.d(e,"c",(function(){return u})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return d})),r.d(e,"f",(function(){return h})),r.d(e,"g",(function(){return l})),r.d(e,"h",(function(){return f})),r.d(e,"i",(function(){return p}));var i=r(113),n=r(411),s=r(116),o=r(106),a=r(270);function c(t){return t?{origin:Object(o.d)(t.origin),vector:Object(o.d)(t.vector)}:{origin:Object(o.f)(),vector:Object(o.f)()}}function u(t,e=c()){return l(t.origin,t.vector,e)}function l(t,e,r=c()){return Object(s.k)(r.origin,t),Object(s.k)(r.vector,e),r}function h(t,e,r=c()){return Object(s.k)(r.origin,t),Object(s.j)(r.vector,e,t),r}function d(t,e){const r=Object(s.j)(a.d.get(),e,t.origin),n=Object(s.h)(t.vector,r),o=Object(s.h)(t.vector,t.vector),c=Object(i.e)(n/o,0,1),u=Object(s.j)(a.d.get(),Object(s.e)(a.d.get(),t.vector,c),r);return Object(s.h)(u,u)}function f(t,e,r){return Object(s.f)(r,t.origin,Object(s.e)(r,t.vector,e))}function p(t,e,r,n,o){const{vector:c,origin:u}=t,l=Object(s.j)(a.d.get(),e,u),h=Object(s.h)(c,l)/Object(s.t)(c);return Object(s.e)(o,c,Object(i.e)(h,r,n)),Object(s.f)(o,o,t.origin)}function m(t,e){if(b(t,function(t,e){const r=v.get();return r.origin=t,r.vector=e,r}(e.origin,e.direction),!1,_)){const{tA:e,pB:r,distance2:i}=_;if(e>=0&&e<=1)return i;if(e<0)return Object(s.l)(t.origin,r);if(e>1)return Object(s.l)(Object(s.f)(a.d.get(),t.origin,t.vector),r)}return null}function g(t,e,r){return!!b(t,e,!0,_)&&(Object(s.k)(r,_.pA),!0)}function b(t,e,r,n){const o=1e-6,c=t.origin,u=Object(s.f)(a.d.get(),c,t.vector),l=e.origin,h=Object(s.f)(a.d.get(),l,e.vector),d=a.d.get(),f=a.d.get();if(d[0]=c[0]-l[0],d[1]=c[1]-l[1],d[2]=c[2]-l[2],f[0]=h[0]-l[0],f[1]=h[1]-l[1],f[2]=h[2]-l[2],Math.abs(f[0])<o&&Math.abs(f[1])<o&&Math.abs(f[2])<o)return!1;const p=a.d.get();if(p[0]=u[0]-c[0],p[1]=u[1]-c[1],p[2]=u[2]-c[2],Math.abs(p[0])<o&&Math.abs(p[1])<o&&Math.abs(p[2])<o)return!1;const m=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],g=f[0]*p[0]+f[1]*p[1]+f[2]*p[2],b=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],_=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],v=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*_-g*g;if(Math.abs(v)<o)return!1;let x=(m*g-b*_)/v,T=(m+g*x)/_;r&&(x=Object(i.e)(x,0,1),T=Object(i.e)(T,0,1));const O=a.d.get(),S=a.d.get();return O[0]=c[0]+x*p[0],O[1]=c[1]+x*p[1],O[2]=c[2]+x*p[2],S[0]=l[0]+T*f[0],S[1]=l[1]+T*f[1],S[2]=l[2]+T*f[2],n.tA=x,n.tB=T,n.pA=O,n.pB=S,n.distance2=Object(s.l)(O,S),!0}const _={tA:0,tB:0,pA:Object(o.f)(),pB:Object(o.f)(),distance2:0},v=new n.a((()=>({origin:null,vector:null})))},461:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(135);function n(t){t.code.add(i.a`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},474:function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return c}));var i=r(85),n=r(598),s=r(434),o=r(425);class a extends n.a{constructor(t,e){super(),this.type=3,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=s.a,this._parameters=Object(o.c)(t,e),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t){Object(o.h)(this._parameters,t)&&(this.validateParameters(this._parameters),this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&0!=(this.renderOccluded&t.renderOccludedMask)}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){Object(i.l)(this.repository)&&this.repository.materialChanged(this)}}const c={renderOccluded:1}},508:function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var i=r(400),n=r(679);class s{constructor(t,e){this.layout=t,this.buffer="number"==typeof e?new ArrayBuffer(e*t.stride):e;for(const r of t.fieldNames){const e=t.fields.get(r);this[r]=new e.constructor(this.buffer,e.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,e){const r=this[t];return r&&r.elementCount===e.ElementCount&&r.elementType===e.ElementType?r:null}slice(t,e){return new s(this.layout,this.buffer.slice(t*this.stride,e*this.stride))}copyFrom(t,e,r,i){const n=this.stride;if(n%4==0){const s=new Uint32Array(t.buffer,e*n,i*n/4);new Uint32Array(this.buffer,r*n,i*n/4).set(s)}else{const s=new Uint8Array(t.buffer,e*n,i*n);new Uint8Array(this.buffer,r*n,i*n).set(s)}}}class o{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,e){return this.appendField(t,i.m,e),this}vec2f64(t,e){return this.appendField(t,i.n,e),this}vec3f(t,e){return this.appendField(t,i.u,e),this}vec3f64(t,e){return this.appendField(t,i.v,e),this}vec4f(t,e){return this.appendField(t,i.C,e),this}vec4f64(t,e){return this.appendField(t,i.D,e),this}mat3f(t,e){return this.appendField(t,i.f,e),this}mat3f64(t,e){return this.appendField(t,i.g,e),this}mat4f(t,e){return this.appendField(t,i.h,e),this}mat4f64(t,e){return this.appendField(t,i.i,e),this}vec4u8(t,e){return this.appendField(t,i.J,e),this}f32(t,e){return this.appendField(t,i.a,e),this}f64(t,e){return this.appendField(t,i.b,e),this}u8(t,e){return this.appendField(t,i.l,e),this}u16(t,e){return this.appendField(t,i.j,e),this}i8(t,e){return this.appendField(t,i.e,e),this}vec2i8(t,e){return this.appendField(t,i.q,e),this}vec2i16(t,e){return this.appendField(t,i.o,e),this}vec2u8(t,e){return this.appendField(t,i.t,e),this}vec4u16(t,e){return this.appendField(t,i.H,e),this}u32(t,e){return this.appendField(t,i.k,e),this}appendField(t,e,r){const i=e.ElementCount*Object(n.a)(e.ElementType),s=this.stride;this.fields.set(t,{size:i,constructor:e,offset:s,optional:r}),this.stride+=i,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.indexOf(t)>=0}createBuffer(t){return new s(this,t)}createView(t){return new s(this,t)}clone(){const t=new o;return t.stride=this.stride,t.fields=new Map,this.fields.forEach(((e,r)=>t.fields.set(r,e))),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function a(){return new o}},525:function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return h})),r.d(e,"c",(function(){return d})),r.d(e,"d",(function(){return l})),r.d(e,"e",(function(){return u}));var i=r(85),n=r(149),s=r(197),o=r(311),a=r(763);function c(t,e){return Object(i.k)(t)&&(t=[]),t.push(e),t}function u(t,e){if(Object(i.k)(t))return null;const r=t.filter((t=>t!==e));return 0===r.length?null:r}function l(t){return!!Object(i.l)(t)&&!t.visible}function h(t,e,r){const s=t.origin.vec3;Object(o.i)(m,-s[0],-s[1],-s[2]),Object(i.l)(t.transformation)?Object(n.n)(e,m,t.transformation):Object(n.d)(e,m),r&&(Object(n.c)(r,e),Object(n.t)(r,r))}function d(t,e,r,i,n){f[0]=t.get(e,0),f[1]=t.get(e,1),f[2]=t.get(e,2),Object(a.a)(f,p,3),r.set(n,0,p[0]),i.set(n,0,p[1]),r.set(n,1,p[2]),i.set(n,1,p[3]),r.set(n,2,p[4]),i.set(n,2,p[5])}const f=new Float64Array(3),p=new Float32Array(6),m=Object(s.d)()},526:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return o})),r.d(e,"d",(function(){return u})),r.d(e,"e",(function(){return c})),r.d(e,"f",(function(){return l}));var i=r(149),n=r(1022);function s(t,e,r){t.setUniform3f("camPos",r[3]-e[0],r[7]-e[1],r[11]-e[2])}function o(t,e){t.setUniformMatrix4fv("proj",e)}function a(t,e){t.setUniform2fv("nearFar",e)}function c(t,e,r){Object(i.b)(h,r,e),t.setUniform3fv("localOrigin",e),t.setUniformMatrix4fv("view",h)}function u(t,e){c(t,e.origin,e.camera.viewMatrix)}function l(t,e){t.setUniform4fv("viewport",e.camera.fullViewport)}const h=Object(n.a)()},537:function(t,e,r){"use strict";r.d(e,"a",(function(){return g})),r.d(e,"b",(function(){return m})),r.d(e,"c",(function(){return p})),r.d(e,"d",(function(){return d})),r.d(e,"e",(function(){return f}));var i=r(116),n=r(106),s=r(411),o=(r(148),r(452));r(270);new s.a(o.d),new s.a((()=>({p0:null,p1:null,p2:null})));const a=Object(n.f)(),c=Object(n.f)();let u=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const l=new Uint16Array([0]),h=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function d(t){if(1===t)return l;if(t<h.length)return new Uint16Array(h.buffer,0,t);if(t>u.length){const e=Math.max(2*u.length,t);u=new Uint32Array(e);for(let t=0;t<u.length;t++)u[t]=t}return new Uint32Array(u.buffer,0,t)}function f(t){if(1===t)return new Uint16Array(l);if(t<h.length)return new Uint16Array(h.slice(0,t));if(t>u.length){const e=new Uint32Array(t);for(let t=0;t<e.length;t++)e[t]=t;return e}return new Uint32Array(u.slice(0,t))}function p(t,e,r){if(!t)return!1;const{size:n,data:s}=t;Object(i.w)(r,0,0,0),Object(i.w)(x,0,0,0);let o=0,u=0;for(let f=0;f<e.length-2;f+=3){const t=e[f+0]*n,p=e[f+1]*n,m=e[f+2]*n;Object(i.w)(b,s[t+0],s[t+1],s[t+2]),Object(i.w)(_,s[p+0],s[p+1],s[p+2]),Object(i.w)(v,s[m+0],s[m+1],s[m+2]);const g=(l=b,h=_,d=v,Object(i.j)(a,h,l),Object(i.j)(c,d,l),Object(i.p)(Object(i.g)(a,a,c))/2);g?(Object(i.f)(b,b,_),Object(i.f)(b,b,v),Object(i.e)(b,b,1/3*g),Object(i.f)(r,r,b),o+=g):(Object(i.f)(x,x,b),Object(i.f)(x,x,_),Object(i.f)(x,x,v),u+=3)}var l,h,d;return(0!==u||0!==o)&&(0!==o?(Object(i.e)(r,r,1/o),!0):0!==u&&(Object(i.e)(r,x,1/u),!0))}function m(t,e,r){if(!t||!e)return!1;const{size:n,data:s}=t;Object(i.w)(r,0,0,0);let o=-1,a=0;for(let i=0;i<e.length;i++){const t=e[i]*n;o!==t&&(r[0]+=s[t+0],r[1]+=s[t+1],r[2]+=s[t+2],a++),o=t}return a>1&&Object(i.e)(r,r,1/a),a>0}function g(t,e,r,n){if(!t)return!1;const{size:s,data:o}=t;Object(i.w)(n,0,0,0),Object(i.w)(x,0,0,0);let a=0,c=0;const u=e?e.length-1:o.length/s-1,l=u+(r?2:0);for(let h=0;h<l;h+=2){const t=h<u?h:u,r=h<u?h+1:0,l=(e?e[t]:t)*s,d=(e?e[r]:r)*s;b[0]=o[l+0],b[1]=o[l+1],b[2]=o[l+2],_[0]=o[d+0],_[1]=o[d+1],_[2]=o[d+2],Object(i.e)(b,Object(i.f)(b,b,_),.5);const f=Object(i.n)(b,_);f>0?(Object(i.f)(n,n,Object(i.e)(b,b,f)),a+=f):(Object(i.f)(x,x,b),c++)}return 0!==a?(Object(i.e)(n,n,1/a),!0):0!==c&&(Object(i.e)(n,x,1/c),!0)}const b=Object(n.f)(),_=Object(n.f)(),v=Object(n.f)(),x=Object(n.f)()},561:function(t,e,r){"use strict";r.d(e,"a",(function(){return d}));var i=r(85),n=r(219),s=r(116),o=r(106),a=r(311);class c{constructor(t,e,r,i){this.primitiveIndices=t,this._numIndexPerPrimitive=e,this.indices=r,this.position=i,this.center=Object(o.f)(),Object(a.a)(t.length>=1),Object(a.a)(r.length%this._numIndexPerPrimitive==0),Object(a.a)(r.length>=t.length*this._numIndexPerPrimitive),Object(a.a)(3===i.size||4===i.size);const{data:n,size:c}=i,l=t.length;let h=c*r[this._numIndexPerPrimitive*t[0]];u.clear(),u.push(h),this.bbMin=Object(o.h)(n[h],n[h+1],n[h+2]),this.bbMax=Object(o.d)(this.bbMin);for(let s=0;s<l;++s){const e=this._numIndexPerPrimitive*t[s];for(let t=0;t<this._numIndexPerPrimitive;++t){h=c*r[e+t],u.push(h);let i=n[h];this.bbMin[0]=Math.min(i,this.bbMin[0]),this.bbMax[0]=Math.max(i,this.bbMax[0]),i=n[h+1],this.bbMin[1]=Math.min(i,this.bbMin[1]),this.bbMax[1]=Math.max(i,this.bbMax[1]),i=n[h+2],this.bbMin[2]=Math.min(i,this.bbMin[2]),this.bbMax[2]=Math.max(i,this.bbMax[2])}}Object(s.i)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let d=this.radius*this.radius;for(let s=0;s<u.length;++s){h=u.getItemAt(s);const t=n[h]-this.center[0],e=n[h+1]-this.center[1],r=n[h+2]-this.center[2],i=t*t+e*e+r*r;if(i<=d)continue;const o=Math.sqrt(i),a=.5*(o-this.radius);this.radius=this.radius+a,d=this.radius*this.radius;const c=a/o;this.center[0]+=t*c,this.center[1]+=e*c,this.center[2]+=r*c}u.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Object(s.l)(this.bbMin,this.bbMax)>1){const t=Object(s.i)(Object(o.f)(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,r=new Uint8Array(e),i=new Array(8);for(let s=0;s<8;++s)i[s]=0;const{data:n,size:a}=this.position;for(let s=0;s<e;++s){let e=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[s];let c=a*this.indices[o],u=n[c],l=n[c+1],h=n[c+2];for(let t=1;t<this._numIndexPerPrimitive;++t){c=a*this.indices[o+t];const e=n[c],r=n[c+1],i=n[c+2];e<u&&(u=e),r<l&&(l=r),i<h&&(h=i)}u<t[0]&&(e|=1),l<t[1]&&(e|=2),h<t[2]&&(e|=4),r[s]=e,++i[e]}let u=0;for(let s=0;s<8;++s)i[s]>0&&++u;if(u<2)return;const l=new Array(8);for(let s=0;s<8;++s)l[s]=i[s]>0?new Uint32Array(i[s]):void 0;for(let s=0;s<8;++s)i[s]=0;for(let s=0;s<e;++s){const t=r[s];l[t][i[t]++]=this.primitiveIndices[s]}this._children=new Array(8);for(let s=0;s<8;++s)void 0!==l[s]&&(this._children[s]=new c(l[s],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){u.prune()}}const u=new n.a({deallocator:null});var l=r(598),h=r(537);class d extends l.a{constructor(t,e=[],r=0,i=-1){super(),this._primitiveType=r,this.edgeIndicesLength=i,this.type=2,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,s]of t)s&&this._vertexAttributes.set(n,{...s});if(null==e||0===e.length){const t=function(t){const e=t.values().next().value;return null==e?0:e.data.length/e.size}(this._vertexAttributes),e=Object(h.d)(t);this.edgeIndicesLength=this.edgeIndicesLength<0?t:this.edgeIndicesLength;for(const r of this._vertexAttributes.keys())this._indices.set(r,e)}else for(const[n,s]of e)s&&(this._indices.set(n,f(s)),"position"===n&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const e=this._vertexAttributes.get(t);return e&&!e.exclusive&&(e.data=Array.from(e.data),e.exclusive=!0),e}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return Object(i.k)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(t):this.computeAttachmentOriginPoints(t)}computeAttachmentOriginTriangles(t){const e=this.indices.get("position"),r=this.vertexAttributes.get("position");return Object(h.c)(r,e,t)}computeAttachmentOriginPoints(t){const e=this.indices.get("position"),r=this.vertexAttributes.get("position");return Object(h.b)(r,e,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get("position");if(0===t.length)return null;const e=0===this.primitiveType?3:1;Object(a.a)(t.length%e==0,"Indexing error: "+t.length+" not divisible by "+e);const r=Object(h.d)(t.length/e),i=this.vertexAttributes.get("position");return new c(r,e,t,i)}}function f(t){if(t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return t;for(const e of t)if(e>=65536)return t;return new Uint16Array(t)}},570:function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));class i{constructor(t){this._material=t.material,this._techniqueRep=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRep.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,e,r=this._output){return this._technique=this._techniqueRep.releaseAndAcquire(t,this._material.getTechniqueConfig(r,e),this._technique),this._technique}ensureResources(t){return 2}}},577:function(t,e,r){"use strict";function i(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}r.d(e,"a",(function(){return i}))},598:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(257);class n{constructor(){this.id=Object(i.a)()}unload(){}}},599:function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return d})),r.d(e,"c",(function(){return f})),r.d(e,"d",(function(){return l})),r.d(e,"e",(function(){return u}));var i=r(149),n=r(400),s=r(311);function o(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length;i*=s;for(let a=0;a<o;++a){const r=2*t[a];n[i]=e[r],n[i+1]=e[r+1],i+=s}}function a(t,e,r,i,n){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,null==n||1===n)for(let c=0;c<a;++c){const r=3*t[c];s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],i+=o}else for(let c=0;c<a;++c){const r=3*t[c];for(let t=0;t<n;++t)s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],i+=o}}function c(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,1===n)for(let c=0;c<a;++c){const r=4*t[c];s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],s[i+3]=e[r+3],i+=o}else for(let c=0;c<a;++c){const r=4*t[c];for(let t=0;t<n;++t)s[i]=e[r],s[i+1]=e[r+1],s[i+2]=e[r+2],s[i+3]=e[r+3],i+=o}}function u(t,e,r,i,n,s=1){if(!r)return void a(t,e,i,n,s);const o=i.typedBuffer,c=i.typedBufferStride,u=t.length,l=r[0],h=r[1],d=r[2],f=r[4],p=r[5],m=r[6],g=r[8],b=r[9],_=r[10],v=r[12],x=r[13],T=r[14];if(n*=c,1===s)for(let a=0;a<u;++a){const r=3*t[a],i=e[r],s=e[r+1],u=e[r+2];o[n]=l*i+f*s+g*u+v,o[n+1]=h*i+p*s+b*u+x,o[n+2]=d*i+m*s+_*u+T,n+=c}else for(let a=0;a<u;++a){const r=3*t[a],i=e[r],u=e[r+1],O=e[r+2],S=l*i+f*u+g*O+v,w=h*i+p*u+b*O+x,M=d*i+m*u+_*O+T;for(let t=0;t<s;++t)o[n]=S,o[n+1]=w,o[n+2]=M,n+=c}}function l(t,e,r,n,s,o=1){if(!r)return void a(t,e,n,s,o);const c=r,u=n.typedBuffer,l=n.typedBufferStride,h=t.length,d=c[0],f=c[1],p=c[2],m=c[4],g=c[5],b=c[6],_=c[8],v=c[9],x=c[10],T=!Object(i.l)(c),O=1e-6,S=1-O;if(s*=l,1===o)for(let i=0;i<h;++i){const r=3*t[i],n=e[r],o=e[r+1],a=e[r+2];let c=d*n+m*o+_*a,h=f*n+g*o+v*a,w=p*n+b*o+x*a;if(T){const t=c*c+h*h+w*w;if(t<S&&t>O){const e=1/Math.sqrt(t);c*=e,h*=e,w*=e}}u[s+0]=c,u[s+1]=h,u[s+2]=w,s+=l}else for(let i=0;i<h;++i){const r=3*t[i],n=e[r],a=e[r+1],c=e[r+2];let h=d*n+m*a+_*c,w=f*n+g*a+v*c,M=p*n+b*a+x*c;if(T){const t=h*h+w*w+M*M;if(t<S&&t>O){const e=1/Math.sqrt(t);h*=e,w*=e,M*=e}}for(let t=0;t<o;++t)u[s+0]=h,u[s+1]=w,u[s+2]=M,s+=l}}function h(t,e,r,n,s,o=1){if(!r)return void c(t,e,n,s,o);const a=r,u=n.typedBuffer,l=n.typedBufferStride,h=t.length,d=a[0],f=a[1],p=a[2],m=a[4],g=a[5],b=a[6],_=a[8],v=a[9],x=a[10],T=!Object(i.l)(a),O=1e-6,S=1-O;if(s*=l,1===o)for(let i=0;i<h;++i){const r=4*t[i],n=e[r],o=e[r+1],a=e[r+2],c=e[r+3];let h=d*n+m*o+_*a,w=f*n+g*o+v*a,M=p*n+b*o+x*a;if(T){const t=h*h+w*w+M*M;if(t<S&&t>O){const e=1/Math.sqrt(t);h*=e,w*=e,M*=e}}u[s+0]=h,u[s+1]=w,u[s+2]=M,u[s+3]=c,s+=l}else for(let i=0;i<h;++i){const r=4*t[i],n=e[r],a=e[r+1],c=e[r+2],h=e[r+3];let w=d*n+m*a+_*c,M=f*n+g*a+v*c,A=p*n+b*a+x*c;if(T){const t=w*w+M*M+A*A;if(t<S&&t>O){const e=1/Math.sqrt(t);w*=e,M*=e,A*=e}}for(let t=0;t<o;++t)u[s+0]=w,u[s+1]=M,u[s+2]=A,u[s+3]=h,s+=l}}function d(t,e,r,i,n,s=1){const o=i.typedBuffer,a=i.typedBufferStride,c=t.length;if(n*=a,1===s){if(4===r)for(let u=0;u<c;++u){const r=4*t[u];o[n]=e[r],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=e[r+3],n+=a}else if(3===r)for(let u=0;u<c;++u){const r=3*t[u];o[n]=e[r],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=255,n+=a}}else if(4===r)for(let u=0;u<c;++u){const r=4*t[u];for(let t=0;t<s;++t)o[n]=e[r],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=e[r+3],n+=a}else if(3===r)for(let u=0;u<c;++u){const r=3*t[u];for(let t=0;t<s;++t)o[n]=e[r],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=255,n+=a}}function f(t,e,r,i,a,c){for(const f of e.fieldNames){const e=t.vertexAttributes.get(f),p=t.indices.get(f);if(e&&p)switch(f){case"position":{Object(s.a)(3===e.size);const t=a.getField(f,n.u);t&&u(p,e.data,r,t,c);break}case"normal":{Object(s.a)(3===e.size);const t=a.getField(f,n.u);t&&l(p,e.data,i,t,c);break}case"uv0":{Object(s.a)(2===e.size);const t=a.getField(f,n.m);t&&o(p,e.data,t,c);break}case"color":{Object(s.a)(3===e.size||4===e.size);const t=a.getField(f,n.J);t&&d(p,e.data,e.size,t,c);break}case"symbolColor":{Object(s.a)(3===e.size||4===e.size);const t=a.getField(f,n.J);t&&d(p,e.data,e.size,t,c);break}case"tangent":{Object(s.a)(4===e.size);const t=a.getField(f,n.C);t&&h(p,e.data,i,t,c);break}}}}},600:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(135);function n(t,e){e.attributeColor?(t.attributes.add("color","vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(i.a`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(i.a`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(i.a`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},601:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return c})),r.d(e,"d",(function(){return a}));var i=r(632),n=r(135);function s(t){t.fragment.include(i.a),t.fragment.uniforms.add("uShadowMapTex","sampler2D"),t.fragment.uniforms.add("uShadowMapNum","int"),t.fragment.uniforms.add("uShadowMapDistance","vec4"),t.fragment.uniforms.add("uShadowMapMatrix","mat4",4),t.fragment.uniforms.add("uDepthHalfPixelSz","float"),t.fragment.code.add(n.a`int chooseCascade(float _linearDepth, out mat4 mat) {
vec4 distance = uShadowMapDistance;
float depth = _linearDepth;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? uShadowMapMatrix[0] : i == 1 ? uShadowMapMatrix[1] : i == 2 ? uShadowMapMatrix[2] : uShadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= uShadowMapNum) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, uDepthHalfPixelSz, uShadowMapTex);
}`)}function o(t,e){e.shadowMappingEnabled&&(e.shadowMap.bind(t),e.shadowMap.bindView(t,e.origin))}function a(t,e,r){e.shadowMappingEnabled&&e.shadowMap.bindView(t,r)}function c(t,e){e.shadowMappingEnabled&&e.shadowMap.bindView(t,e.origin)}},622:function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return o}));var i=r(135);function n(t,e){e.vvInstancingEnabled&&(e.vvSize||e.vvColor)&&t.attributes.add("instanceFeatureAttribute","vec4"),e.vvSize?(t.vertex.uniforms.add("vvSizeMinSize","vec3"),t.vertex.uniforms.add("vvSizeMaxSize","vec3"),t.vertex.uniforms.add("vvSizeOffset","vec3"),t.vertex.uniforms.add("vvSizeFactor","vec3"),t.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),t.vertex.uniforms.add("vvSymbolAnchor","vec3"),t.vertex.code.add(i.a`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),t.vertex.code.add(i.a`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.vvInstancingEnabled?i.a`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):t.vertex.code.add(i.a`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(t.vertex.constants.add("vvColorNumber","int",8),t.vertex.code.add(i.a`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.vvInstancingEnabled?i.a`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):t.vertex.code.add(i.a`vec4 vvColor() { return vec4(1.0); }`)}function s(t,e){e.vvSizeEnabled&&(t.setUniform3fv("vvSizeMinSize",e.vvSizeMinSize),t.setUniform3fv("vvSizeMaxSize",e.vvSizeMaxSize),t.setUniform3fv("vvSizeOffset",e.vvSizeOffset),t.setUniform3fv("vvSizeFactor",e.vvSizeFactor)),e.vvColorEnabled&&(t.setUniform1fv("vvColorValues",e.vvColorValues),t.setUniform4fv("vvColorColors",e.vvColorColors))}function o(t,e){s(t,e),e.vvOpacityEnabled&&(t.setUniform1fv("vvOpacityValues",e.vvOpacityValues),t.setUniform1fv("vvOpacityOpacities",e.vvOpacityOpacities))}function a(t,e){s(t,e),e.vvSizeEnabled&&(t.setUniform3fv("vvSymbolAnchor",e.vvSymbolAnchor),t.setUniformMatrix3fv("vvSymbolRotationMatrix",e.vvSymbolRotationMatrix))}},632:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(135);function n(t){t.code.add(i.a`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},633:function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(632),n=r(135);function s(t,e){t.fragment.include(i.a),3===e.output?(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.code.add(n.a`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===e.output&&t.fragment.code.add(n.a`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},650:function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return i})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return u})),r.d(e,"f",(function(){return l})),r.d(e,"g",(function(){return o})),r.d(e,"h",(function(){return s}));const i={func:513},n={func:519},s={mask:255},o={mask:0},a={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},c={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},u={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},l={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}},679:function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return n})),r.d(e,"d",(function(){return o}));r(82);function i(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function n(t){switch(t){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function s(t){switch(t){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function o(t){switch(t){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}},703:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));var i=r(809),n=r(135);function s(t,e){const r=t.vertex.code;e.verticalOffsetEnabled?(t.vertex.uniforms.add("verticalOffset","vec4"),e.screenSizePerspectiveEnabled&&(t.include(i.a),t.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),r.add(n.a`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===e.viewingMode?n.a`vec3 worldNormal = normalize(worldPos + localOrigin);`:n.a`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${e.screenSizePerspectiveEnabled?n.a`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:n.a`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):r.add(n.a`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function o(t,e,r){if(!e.verticalOffset)return;const i=a(e.verticalOffset,r.camera.fovY,r.camera.fullViewport[3]),n=r.camera.pixelRatio||1;t.setUniform4f("verticalOffset",i.screenLength*n,i.perDistance,i.minWorldLength,i.maxWorldLength)}function a(t,e,r,i=c){return i.screenLength=t.screenLength,i.perDistance=Math.tan(.5*e)/(.5*r),i.minWorldLength=t.minWorldLength,i.maxWorldLength=t.maxWorldLength,i}const c={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}},704:function(t,e,r){"use strict";r.d(e,"a",(function(){return m})),r.d(e,"b",(function(){return v})),r.d(e,"c",(function(){return _}));var i=r(85),n=r(269),s=r(329),o=r(149),a=r(197),c=r(546),u=r(397),l=r(116),h=r(431),d=r(106),f=r(244),p=r(440);class m{constructor(){this._transform=Object(a.d)(),this._transformInverse=new g({value:this._transform},o.c,a.d),this._transformInverseTranspose=new g(this._transformInverse,o.t,a.d),this._transformTranspose=new g({value:this._transform},o.t,a.d),this._transformInverseRotation=new g({value:this._transform},n.j,s.b)}invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Object(o.d)(this._transform,t)}multiplyTransform(t){Object(o.n)(this._transform,this._transform,t)}set(t){Object(o.d)(this._transform,t),this.invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this.invalidateLazyTransforms()}}class g{constructor(t,e,r){this.original=t,this.update=e,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const b=new class{constructor(t=0){this.offset=t,this.sphere=Object(p.c)(),this.tmpVertex=Object(d.f)()}applyToVertex(t,e,r){const i=this.objectTransform.transform;let n=i[0]*t+i[4]*e+i[8]*r+i[12],s=i[1]*t+i[5]*e+i[9]*r+i[13],o=i[2]*t+i[6]*e+i[10]*r+i[14];const a=this.offset/Math.sqrt(n*n+s*s+o*o);n+=n*a,s+=s*a,o+=o*a;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*s+c[8]*o+c[12],this.tmpVertex[1]=c[1]*n+c[5]*s+c[9]*o+c[13],this.tmpVertex[2]=c[2]*n+c[6]*s+c[10]*o+c[14],this.tmpVertex}applyToMinMax(t,e){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/e;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/e,this.sphere}};function _(t){return Object(i.l)(t)?(b.offset=t,b):null}new class{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=Object(d.f)(),this.mbs=Object(f.e)(),this.obb={center:Object(d.f)(),halfSize:Object(h.b)(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,e,r){const i=t,n=e,s=r+this.componentLocalOriginLength,o=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=t+i*o,this.tmpVertex[1]=e+n*o,this.tmpVertex[2]=r+s*o,this.tmpVertex}applyToAabb(t){const e=t[0],r=t[1],i=t[2]+this.componentLocalOriginLength,n=t[3],s=t[4],o=t[5]+this.componentLocalOriginLength,a=this.offset/Math.sqrt(e*e+r*r+i*i);t[0]+=e*a,t[1]+=r*a,t[2]+=i*a;const c=this.offset/Math.sqrt(n*n+s*s+o*o);return t[3]+=n*c,t[4]+=s*c,t[5]+=o*c,t}applyToMbs(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/e;return this.mbs[0]=t[0]+t[0]*r,this.mbs[1]=t[1]+t[1]*r,this.mbs[2]=t[2]+t[2]*r,this.mbs[3]=t[3]+t[3]*this.offset/e,this.mbs}applyToObb(t){const e=t.center,r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);this.obb.center[0]=e[0]+e[0]*r,this.obb.center[1]=e[1]+e[1]*r,this.obb.center[2]=e[2]+e[2]*r,Object(l.u)(this.obb.halfSize,t.halfSize,t.quaternion),Object(l.f)(this.obb.halfSize,this.obb.halfSize,t.center);const i=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*i,this.obb.halfSize[1]+=this.obb.halfSize[1]*i,this.obb.halfSize[2]+=this.obb.halfSize[2]*i,Object(l.j)(this.obb.halfSize,this.obb.halfSize,t.center),Object(c.a)(x,t.quaternion),Object(l.u)(this.obb.halfSize,this.obb.halfSize,x),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}};new class{constructor(t=0){this.offset=t,this.tmpVertex=Object(d.f)()}applyToVertex(t,e,r){const i=t+this.localOrigin[0],n=e+this.localOrigin[1],s=r+this.localOrigin[2],o=this.offset/Math.sqrt(i*i+n*n+s*s);return this.tmpVertex[0]=t+i*o,this.tmpVertex[1]=e+n*o,this.tmpVertex[2]=r+s*o,this.tmpVertex}applyToAabb(t){const e=t[0]+this.localOrigin[0],r=t[1]+this.localOrigin[1],i=t[2]+this.localOrigin[2],n=t[3]+this.localOrigin[0],s=t[4]+this.localOrigin[1],o=t[5]+this.localOrigin[2],a=this.offset/Math.sqrt(e*e+r*r+i*i);t[0]+=e*a,t[1]+=r*a,t[2]+=i*a;const c=this.offset/Math.sqrt(n*n+s*s+o*o);return t[3]+=n*c,t[4]+=s*c,t[5]+=o*c,t}};const v="terrain",x=Object(u.b)()},705:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(135);function n(t,e){0===e.output&&e.receiveShadows?(t.varyings.add("linearDepth","float"),t.vertex.code.add(i.a`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):1===e.output||3===e.output?(t.varyings.add("linearDepth","float"),t.vertex.uniforms.add("cameraNearFar","vec2"),t.vertex.code.add(i.a`void forwardLinearDepth() {
linearDepth = (-position_view().z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);
}`)):t.vertex.code.add(i.a`void forwardLinearDepth() {}`)}},748:function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var i=r(135);function n(t){const e=t.fragment.code;e.add(i.a`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(i.a`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(i.a`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var s=r(900);function o(t,e){const r=t.fragment.code;t.include(s.a),3===e.pbrMode||4===e.pbrMode?(r.add(i.a`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),r.add(i.a`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(i.a`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(i.a`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(i.a`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):1!==e.pbrMode&&2!==e.pbrMode||(t.include(n),r.add(i.a`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(i.a`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(i.a`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),r.add(i.a`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(i.a`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(i.a`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},763:function(t,e,r){"use strict";function i(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function n(t,e,r,n){for(let a=0;a<n;++a)s[0]=t[a],i(s,o,1),e[a]=o[0],r[a]=o[1]}r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return n}));const s=new Float64Array(1),o=new Float32Array(2)},793:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(232);class n{constructor(t,e){this._context=t,this._desc=e,this._context.instanceCounter.increment(i.c.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,e.internalFormat,e.width,e.height)}get descriptor(){return this._desc}resize(t,e){const r=this._desc;if(r.width===t&&r.height===e)return;r.width=t,r.height=e;const i=this._context.gl;this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(i.c.Renderbuffer,this),this._context=null)}}},809:function(t,e,r){"use strict";r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return o}));var i=r(135),n=r(425);function s(t){t.vertex.code.add(i.a`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(i.a`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(i.a`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(i.a`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(i.a`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(i.a`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`),t.vertex.code.add(i.a`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function o(t,e){if(e.screenSizePerspective){Object(n.a)(e.screenSizePerspective,t,"screenSizePerspective");const r=e.screenSizePerspectiveAlignment||e.screenSizePerspective;Object(n.a)(r,t,"screenSizePerspectiveAlignment")}}},816:function(t,e,r){"use strict";r.d(e,"a",(function(){return R}));var i=r(210),n=r(88),s=r(131),o=r(113),a=r(85),c=r(91),u=r(550),l=r(100),h=r(946),d=r(585),f=r(158);let p;var m=r(208),g=r(762);let b=null,_=null;async function v(){return Object(a.k)(_)&&(_=function(){if(Object(a.k)(p)){const t=t=>Object(f.a)(`esri/libs/basisu/${t}`);p=Promise.all([r.e(244),r.e(259)]).then(r.bind(null,1349)).then((t=>t.b)).then((({default:e})=>e({locateFile:t}).then((t=>(t.initializeBasis(),delete t.then,t)))))}return p}(),b=await _),_}function x(t,e,r,i,n){const s=Object(g.b)(e?37496:37492),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function T(t){return t.getNumImages()>=1&&!t.isUASTC()}function O(t){return t.getFaces()>=1&&t.isETC1S()}function S(t,e,r,i,n,s,o,a){const{compressedTextureETC:c,compressedTextureS3TC:u}=t.capabilities,[l,h]=c?i?[1,37496]:[0,37492]:u?i?[3,33779]:[2,33776]:[13,6408],d=e.hasMipmap?r:Math.min(1,r),f=[];for(let m=0;m<d;m++)f.push(new Uint8Array(o(m,l))),a(m,l,f[m]);const p=f.length>1,g=p?9987:9729,b={...e,samplingMode:g,hasMipmap:p,internalFormat:h,width:n,height:s};return new m.a(t,b,{type:"compressed",levels:f})}var w=r(598);const M=r(87).a.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),A=542327876,y=131072;function j(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const F=j("DXT1"),E=j("DXT3"),P=j("DXT5");function I(t,e,r){const{textureData:i,internalFormat:n,width:s,height:a}=function(t,e){const r=new Int32Array(t,0,31);if(r[0]!==A)return M.error("Invalid magic number in DDS header"),null;if(!(4&r[20]))return M.error("Unsupported format, must contain a FourCC code"),null;const i=r[21];let n,s;switch(i){case F:n=8,s=33776;break;case E:n=16,s=33778;break;case P:n=16,s=33779;break;default:return M.error("Unsupported FourCC code:",function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}(i)),null}let a=1,c=r[4],u=r[3];0==(3&c)&&0==(3&u)||(M.warn("Rounding up compressed texture size to nearest multiple of 4."),c=c+3&-4,u=u+3&-4);const l=c,h=u;let d,f;r[2]&y&&!1!==e&&(a=Math.max(1,r[7])),1===a||Object(o.j)(c)&&Object(o.j)(u)||(M.warn("Ignoring mipmaps of non power of two sized compressed texture."),a=1);let p=r[1]+4;const m=[];for(let o=0;o<a;++o)f=(c+3>>2)*(u+3>>2)*n,d=new Uint8Array(t,p,f),m.push(d),p+=f,c=Math.max(1,c>>1),u=Math.max(1,u>>1);return{textureData:{type:"compressed",levels:m},internalFormat:s,width:l,height:h}}(r,e.hasMipmap);return e.samplingMode=i.levels.length>1?9987:9729,e.hasMipmap=i.levels.length>1,e.internalFormat=n,e.width=s,e.height=a,new m.a(t,e,i)}var z=r(818),D=r(311),C=r(265),N=r(577);class R extends w.a{constructor(t,e){super(),this.data=t,this.type=4,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new s.a,this.params=e||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=R.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const t=this.data;Object(a.k)(t)||(t instanceof HTMLVideoElement?this.startPreloadVideoElement(t):t instanceof HTMLImageElement&&this.startPreloadImageElement(t))}startPreloadVideoElement(t){Object(l.t)(t.src)||"auto"===t.preload&&t.crossOrigin||(t.preload="auto",t.crossOrigin="anonymous",t.src=t.src)}startPreloadImageElement(t){Object(l.u)(t.src)||Object(l.t)(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static estimateTexMemRequired(t,e){if(Object(a.k)(t))return 0;if(Object(u.c)(t)||Object(u.k)(t))return e.encoding===R.KTX2_ENCODING?function(t,e){if(Object(a.k)(b))return t.byteLength;const r=new b.KTX2File(new Uint8Array(t)),i=O(r)?x(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}(t,e.mipmap):e.encoding===R.BASIS_ENCODING?function(t,e){if(Object(a.k)(b))return t.byteLength;const r=new b.BasisFile(new Uint8Array(t)),i=T(r)?x(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}(t,e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?R.getDataDimensions(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(t){var e;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(e=this.params.maxAnisotropy)?e:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,e){if(Object(a.l)(this._glTexture))return this._glTexture;if(Object(a.l)(this._loadingPromise))return this._loadingPromise;const r=this.data;return Object(a.k)(r)?(this._glTexture=new m.a(t,this.createDescriptor(t),null),this._glTexture):"string"==typeof r?this.loadFromURL(t,e,r):r instanceof Image?this.loadFromImageElement(t,e,r):r instanceof HTMLVideoElement?this.loadFromVideoElement(t,e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this.loadFromImage(t,r,e):(Object(u.c)(r)||Object(u.k)(r))&&this.params.encoding===R.DDS_ENCODING?this.loadFromDDSData(t,r):(Object(u.c)(r)||Object(u.k)(r))&&this.params.encoding===R.KTX2_ENCODING?this.loadFromKTX2(t,r):(Object(u.c)(r)||Object(u.k)(r))&&this.params.encoding===R.BASIS_ENCODING?this.loadFromBasis(t,r):Object(u.k)(r)?this.loadFromPixelData(t,r):Object(u.c)(r)?this.loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,e,r){if(!(this.data instanceof HTMLVideoElement)||Object(a.k)(this._glTexture))return r;if(this.data.readyState<2||r===this.data.currentTime)return r;if(Object(a.l)(this._powerOfTwoStretchInfo)){const{framebuffer:r,vao:i,sourceTexture:n}=this._powerOfTwoStretchInfo;n.setData(this.data),this.drawStretchedTexture(t,e,r,i,n,this._glTexture)}else{const{width:t,height:e}=this.data,{width:r,height:i}=this._glTexture.descriptor;t!==r||e!==i?this._glTexture.updateData(0,0,0,Math.min(t,r),Math.min(e,i),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(t,e){return this._glTexture=I(t,this.createDescriptor(t),e),this._glTexture}loadFromKTX2(t,e){return this.loadAsync((()=>async function(t,e,r){Object(a.k)(b)&&(b=await v());const i=new b.KTX2File(new Uint8Array(r));if(!O(i))return null;i.startTranscoding();const n=S(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),((t,e)=>i.getImageTranscodedSizeInBytes(t,0,0,e)),((t,e,r)=>i.transcodeImage(r,t,0,0,e,0,-1,-1)));return i.close(),i.delete(),n}(t,this.createDescriptor(t),e).then((t=>(this._glTexture=t,t)))))}loadFromBasis(t,e){return this.loadAsync((()=>async function(t,e,r){Object(a.k)(b)&&(b=await v());const i=new b.BasisFile(new Uint8Array(r));if(!T(i))return null;i.startTranscoding();const n=S(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),((t,e)=>i.getImageTranscodedSizeInBytes(0,t,e)),((t,e,r)=>i.transcodeImage(r,0,t,e,0,0)));return i.close(),i.delete(),n}(t,this.createDescriptor(t),e).then((t=>(this._glTexture=t,t)))))}loadFromPixelData(t,e){Object(D.a)(this.params.width>0&&this.params.height>0);const r=this.createDescriptor(t);return r.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,r.width=this.params.width,r.height=this.params.height,this._glTexture=new m.a(t,r,e),this._glTexture}loadFromURL(t,e,r){return this.loadAsync((async i=>{const n=await Object(h.a)(r,{signal:i});return this.loadFromImage(t,n,e)}))}loadFromImageElement(t,e,r){return r.complete?this.loadFromImage(t,r,e):this.loadAsync((async i=>{const n=await Object(d.a)(r,r.src,!1,i);return this.loadFromImage(t,n,e)}))}loadFromVideoElement(t,e,r){return r.readyState>=2?this.loadFromImage(t,r,e):this.loadFromVideoElementAsync(t,e,r)}loadFromVideoElementAsync(t,e,r){return this.loadAsync((i=>new Promise(((s,o)=>{const u=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",h),Object(a.s)(d)},l=()=>{r.readyState>=2&&(u(),s(this.loadFromImage(t,r,e)))},h=t=>{u(),o(t||new n.a("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",h);const d=Object(c.p)(i,(()=>h(Object(c.d)())))}))))}loadFromImage(t,e,r){const i=R.getDataDimensions(e);this.params.width=i.width,this.params.height=i.height;const n=this.createDescriptor(t);return n.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(t,n)||Object(o.j)(i.width)&&Object(o.j)(i.height)?(n.width=i.width,n.height=i.height,this._glTexture=new m.a(t,n,e),this._glTexture):(this._glTexture=this.makePowerOfTwoTexture(t,e,i,n,r),this._glTexture)}loadAsync(t){const e=new AbortController;this._loadingController=e;const r=t(e.signal);this._loadingPromise=r;const i=()=>{this._loadingController===e&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(i,i),r}requiresPowerOfTwo(t,e){const r=33071,i="number"==typeof e.wrapMode?e.wrapMode===r:e.wrapMode.s===r&&e.wrapMode.t===r;return!Object(N.a)(t.gl)&&(e.hasMipmap||!i)}makePowerOfTwoTexture(t,e,r,n,s){const{width:a,height:c}=r,u=Object(o.l)(a),l=Object(o.l)(c);let h;switch(n.width=u,n.height=l,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[a/u,c/l],h=new m.a(t,n),h.updateData(0,0,0,a,c,e);break;case 1:case null:case void 0:h=this.stretchToPowerOfTwo(t,e,n,s());break;default:Object(i.a)(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&h.generateMipmap(),h}stretchToPowerOfTwo(t,e,r,i){const n=new m.a(t,r),s=new C.a(t,{colorTarget:0,depthStencilTarget:0},n),o=new m.a(t,{target:3553,pixelFormat:r.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},e),a=Object(z.b)(t),c=t.getBoundFramebufferObject();return this.drawStretchedTexture(t,i,s,a,o,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:a,sourceTexture:o,framebuffer:s}:(a.dispose(!0),o.dispose(),s.detachColorTexture(),s.dispose()),t.bindFramebuffer(c),n}drawStretchedTexture(t,e,r,i,n,s){t.bindFramebuffer(r);const o=t.getViewport();t.setViewport(0,0,s.descriptor.width,s.descriptor.height);const a=e.program;t.useProgram(a),a.setUniform4f("color",1,1,1,1),a.bindTexture(n,"tex"),t.bindVAO(i),e.bindPipelineState(t),t.drawArrays(5,0,Object(g.e)(i,"geometry")),t.bindFramebuffer(null),t.setViewport(o.x,o.y,o.width,o.height)}unload(){if(Object(a.l)(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:e,sourceTexture:r}=this._powerOfTwoStretchInfo;e.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(Object(a.l)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),Object(a.l)(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}R.DDS_ENCODING="image/vnd-ms.dds",R.KTX2_ENCODING="image/ktx2",R.BASIS_ENCODING="image/x.basis"},818:function(t,e,r){"use strict";r.d(e,"a",(function(){return l})),r.d(e,"b",(function(){return u}));var i=r(434);const n=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],s=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];var o=r(250),a=r(208),c=r(251);function u(t,e=n,r=i.a,a=-1,u=1){let l=null;return l=e===s?new Float32Array([a,a,0,0,u,a,1,0,a,u,0,1,u,u,1,1]):new Float32Array([a,a,u,a,a,u,u,u]),new c.a(t,r,{geometry:e},{geometry:o.a.createVertex(t,35044,l)})}function l(t){return new a.a(t,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}},851:function(t,e,r){"use strict";r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return a})),r.d(e,"d",(function(){return u}));var i=r(113);function n(t,e,r){const i=r.parameters,n=r.paddingPixelsOverride;return l.scale=Math.min(i.divisor/(e-i.offset),1),l.factor=function(t){return Math.abs(t*t*t)}(t),l.minPixelSize=i.minPixelSize,l.paddingPixels=n,l}function s(t,e){return 0===t?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function o(t,e){return Math.max(Object(i.k)(t*e.scale,t,e.factor),s(t,e))}function a(t,e,r,i){i.scale=function(t,e,r){const i=n(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,o(1,i)}(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function c(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,s(t[1],e)/t[1]),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function u(t,e,r,i){return o(t,n(e,r,i))}Object(i.g)(10),Object(i.g)(12),Object(i.g)(70),Object(i.g)(40);const l={scale:0,factor:0,minPixelSize:0,paddingPixels:0}},900:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(135);function n(t){t.vertex.code.add(i.a`const float PI = 3.141592653589793;`),t.fragment.code.add(i.a`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},946:function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var i=r(102);async function n(t,e){const{data:r}=await Object(i.default)(t,{responseType:"image",...e});return r}},955:function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));var i=r(85),n=r(570);class s extends n.a{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId).then((t=>this._texture=t)),this._acquire(t.normalTextureId).then((t=>this._textureNormal=t)),this._acquire(t.emissiveTextureId).then((t=>this._textureEmissive=t)),this._acquire(t.occlusionTextureId).then((t=>this._textureOcclusion=t)),this._acquire(t.metallicRoughnessTextureId).then((t=>this._textureMetallicRoughness=t))}dispose(){this._texture=Object(i.r)(this._texture),this._textureNormal=Object(i.r)(this._textureNormal),this._textureEmissive=Object(i.r)(this._textureEmissive),this._textureOcclusion=Object(i.r)(this._textureOcclusion),this._textureMetallicRoughness=Object(i.r)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return 0===this._numLoading?2:1}updateTexture(t){(Object(i.k)(this._texture)||t!==this._texture.id)&&(this._texture=Object(i.r)(this._texture),this._textureId=t,this._acquire(this._textureId).then((t=>this._texture=t)))}bindTextures(t){Object(i.l)(this._texture)&&t.bindTexture(this._texture.glTexture,"tex"),Object(i.l)(this._textureNormal)&&t.bindTexture(this._textureNormal.glTexture,"normalTexture"),Object(i.l)(this._textureEmissive)&&t.bindTexture(this._textureEmissive.glTexture,"texEmission"),Object(i.l)(this._textureOcclusion)&&t.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),Object(i.l)(this._textureMetallicRoughness)&&t.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(t){const e=Object(i.l)(this._texture)?this._texture.glTexture:null;Object(i.l)(e)&&e.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",e.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(t){return Object(i.k)(t)?Promise.resolve(null):(++this._numLoading,this._textureRepository.acquire(t).then((t=>this._disposed?(Object(i.r)(t),null):t)).finally((()=>--this._numLoading)))}}}}]);
//# sourceMappingURL=12.a60c75f4.chunk.js.map