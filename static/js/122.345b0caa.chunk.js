(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[122],{279:function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return m})),r.d(t,"d",(function(){return n})),r.d(t,"e",(function(){return x})),r.d(t,"f",(function(){return F})),r.d(t,"g",(function(){return s})),r.d(t,"h",(function(){return o})),r.d(t,"i",(function(){return d})),r.d(t,"j",(function(){return u})),r.d(t,"k",(function(){return j})),r.d(t,"l",(function(){return a})),r.d(t,"m",(function(){return y})),r.d(t,"n",(function(){return S})),r.d(t,"o",(function(){return _})),r.d(t,"p",(function(){return g})),r.d(t,"q",(function(){return v})),r.d(t,"r",(function(){return b})),r.d(t,"s",(function(){return I})),r.d(t,"t",(function(){return p}));var i=r(89);r(103),r(125);function n(e=A){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,r,i,a,s,u=n()){return u[0]=e,u[1]=t,u[2]=r,u[3]=i,u[4]=a,u[5]=s,u}function s(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function u(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function o(e,t,r=0,i=t.length/3){for(var n=e[0],a=e[1],s=e[2],u=e[3],o=e[4],d=e[5],l=0;l<i;l++)n=Math.min(n,t[r+3*l]),a=Math.min(a,t[r+3*l+1]),s=Math.min(s,t[r+3*l+2]),u=Math.max(u,t[r+3*l]),o=Math.max(o,t[r+3*l+1]),d=Math.max(d,t[r+3*l+2]);e[0]=n,e[1]=a,e[2]=s,e[3]=u,e[4]=o,e[5]=d}function d(e,t,r){var i=t.length,n=e[0],a=e[1],s=e[2],u=e[3],o=e[4],d=e[5];if(r)for(var l=0;l<i;l++){var c=t[l];n=Math.min(n,c[0]),a=Math.min(a,c[1]),s=Math.min(s,c[2]),u=Math.max(u,c[0]),o=Math.max(o,c[1]),d=Math.max(d,c[2])}else for(var h=0;h<i;h++){var f=t[h];n=Math.min(n,f[0]),a=Math.min(a,f[1]),u=Math.max(u,f[0]),o=Math.max(o,f[1])}e[0]=n,e[1]=a,e[2]=s,e[3]=u,e[4]=o,e[5]=d}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function c(e){return e[1]>=e[4]?0:e[4]-e[1]}function h(e){return e[2]>=e[5]?0:e[5]-e[2]}function f(e,t=[0,0,0]){return t[0]=e[0]+l(e)/2,t[1]=e[1]+c(e)/2,t[2]=e[2]+h(e)/2,t}function p(e,t=[0,0,0]){return t[0]=l(e),t[1]=c(e),t[2]=h(e),t}function _(e){return Math.max(l(e),h(e),c(e))}function m(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function g(e,t,r=e){var i=e[0]+l(e)/2,n=e[1]+c(e)/2,a=e[2]+h(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=n+(e[1]-n)*t,r[2]=a+(e[2]-a)*t,r[3]=i+(e[3]-i)*t,r[4]=n+(e[4]-n)*t,r[5]=a+(e[5]-a)*t,r}function y(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function I(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function b(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function v(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function x(e){return e?v(e,w):n(w)}function j(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function O(e){return 6===e.length}function S(e){return 0===l(e)&&0===c(e)&&0===h(e)}function F(e,t,r){if(Object(i.j)(e)||Object(i.j)(t))return e===t;if(!O(e)||!O(t))return!1;if(r){for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1}else for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var w=[1/0,1/0,1/0,-1/0,-1/0,-1/0],A=[0,0,0,0,0,0];n()},666:function(e,t,r){"use strict";var i=r(89);t.a=class{constructor(e=Number.POSITIVE_INFINITY){this.size=0,this._start=0,this.maxSize=e,this._buffer=isFinite(e)?new Array(e):[]}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return isFinite(this.maxSize)?this._buffer[(this._start+this.size++)%this.maxSize]=e:this._buffer[this._start+this.size++]=e,null}dequeue(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}find(e){if(0===this.size)return null;for(var t of this._buffer)if(Object(i.k)(t)&&e(t))return t;return null}clear(e){for(var t=this.dequeue();Object(i.k)(t);)e&&e(t),t=this.dequeue()}}},668:function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"b",(function(){return R})),r.d(t,"c",(function(){return v})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return b}));var i=r(7),n=r(89),a=r(95),s=r(112),u=r(371),o=r(100),d=r(117),l=r(236),c=r(178),h=r(168),f=(r(469),r(400)),p=new a.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),_=Object.freeze({}),m=new c.a,g=new c.a,y=new c.a,I={esriGeometryPoint:h.m,esriGeometryPolyline:h.o,esriGeometryPolygon:h.n,esriGeometryMultipoint:h.l};function b(e,t,r,i=e.hasZ,n=e.hasM){var a=e.hasZ&&i,s=e.hasM&&n;if(r){var u=Object(h.u)(y,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,n);return Object(h.m)(u,a,s)}return Object(h.m)(t,a,s)}function v(e,t,r,i,n,a,s=t,u=r){var o=t&&s,d=r&&u,l=i?"coords"in i?i:i.geometry:null;if(!l)return null;if(n){var c=Object(h.q)(g,l,t,r,e,n,s,u);return a&&(c=Object(h.u)(y,c,o,d,e,a)),I[e](c,o,d)}if(a){var f=Object(h.u)(y,l,t,r,e,a,s,u);return I[e](f,o,d)}return Object(h.x)(m,l,t,r,s,u),I[e](m,o,d)}function x(e,t,r){return j.apply(this,arguments)}function j(){return(j=Object(i.a)((function*(e,t,r){var{outFields:i,orderByFields:n,groupByFieldsForStatistics:a,outStatistics:s}=e;if(i)for(var u=0;u<i.length;u++)i[u]=i[u].trim();if(n)for(var o=0;o<n.length;o++)n[o]=n[o].trim();if(a)for(var d=0;d<a.length;d++)a[d]=a[d].trim();if(s)for(var l=0;l<s.length;l++)s[l].onStatisticField&&(s[l].onStatisticField=s[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),O(e,t,r)}))).apply(this,arguments)}function O(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(i.a)((function*(e,t,r){if(!e)return null;var{where:i}=e;if(e.where=i=i&&i.trim(),(!i||/^1 *= *1$/.test(i)||t&&t===i)&&(e.where=null),!e.geometry)return e;var a=yield F(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){var{spatialReference:s}=e.geometry;(a=Object(u.a)(a)).spatialReference=s}e.geometry=a,yield Object(f.a)(a.spatialReference,r);var d=(yield Object(l.a)(Object(o.a)(a)))[0];if(Object(n.j)(d))throw _;var c=d.toJSON(),h=yield Object(f.b)(c,c.spatialReference,r);if(!h)throw _;return h.spatialReference=r,e.geometry=h,e}))).apply(this,arguments)}function F(e){return w.apply(this,arguments)}function w(){return(w=Object(i.a)((function*(e){var{geometry:t,distance:r,units:i}=e;if(null==r||"vertexAttributes"in t)return t;var n=t.spatialReference,a=i?p.fromJSON(i):Object(d.h)(n),u=n&&(Object(s.f)(n)||Object(s.m)(n))?t:yield Object(f.a)(n,s.a).then((()=>Object(f.b)(t,s.a)));return(yield A())(u.spatialReference,u,r,a)}))).apply(this,arguments)}function A(){return T.apply(this,arguments)}function T(){return(T=Object(i.a)((function*(){return(yield Promise.all([r.e(9),r.e(28)]).then(r.bind(null,788))).geodesicBuffer}))).apply(this,arguments)}function R(e){return e&&M in e?JSON.parse(JSON.stringify(e,C)):e}var M="_geVersion",C=(e,t)=>e!==M?t:void 0},709:function(e,t,r){"use strict";r.r(t);var i=r(7),n=r(89),a=r(81),s=r(93),u=r(210),o=r(125),d=r(132),l=r(668),c=r(877),h=r(755),f=r(969),p=a.a.getLogger("esri.views.2d.layers.features.support.whereUtils"),_={getAttribute:(e,t)=>e.field(t)};function m(){return(m=Object(i.a)((function*(e,t){var i=yield r.e(11).then(r.bind(null,272));try{var n=i.WhereClause.create(e,t);if(!n.isStandardized){var a=new s.a("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",n);p.error(a)}return e=>{var t=e.readArcadeFeature();return n.testFeature(t,_)}}catch(n){return p.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}))).apply(this,arguments)}var g=a.a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");t.default=class{constructor(e){this._geometryBounds=Object(o.i)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach(((e,t)=>{this._idToVisibility.set(t,0)}))}setKnownIds(e){for(var t of e)this._idToVisibility.set(t,1)}setTrue(e){var t=[],r=[],i=new Set(e);return this._idToVisibility.forEach(((e,n)=>{var a=!!(1&this._idToVisibility.get(n)),s=i.has(n);!a&&s?t.push(n):a&&!s&&r.push(n),this._idToVisibility.set(n,s?3:0)})),{show:t,hide:r}}createQuery(){var{geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:n}=this;return d.a.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:n})}update(e,t){var r=this;return Object(i.a)((function*(){r._hash=JSON.stringify(e);var i=yield Object(l.e)(e,null,t);yield Promise.all([r._setGeometryFilter(i),r._setIdFilter(i),r._setAttributeFilter(i),r._setTimeFilter(i)])}))()}_setAttributeFilter(e){var t=this;return Object(i.a)((function*(){if(!e||!e.where)return t._clause=null,void(t.where=null);t._clause=yield function(e,t){return m.apply(this,arguments)}(e.where,t._serviceInfo.fieldsIndex),t.where=e.where}))()}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}_setGeometryFilter(e){var t=this;return Object(i.a)((function*(){if(!e||!e.geometry)return t._spatialQueryOperator=null,t.geometry=null,void(t.spatialRel=null);var r=e.geometry,i=e.spatialRel||"esriSpatialRelIntersects",n=yield Object(c.c)(i,r,t._serviceInfo.geometryType,t._serviceInfo.hasZ,t._serviceInfo.hasM);Object(u.a)(t._geometryBounds,r),t._spatialQueryOperator=n,t.geometry=r,t.spatialRel=i}))()}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=Object(h.b)(this._serviceInfo.timeInfo,e.timeExtent,f.b);else{var t=new s.a("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);g.error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return!Object(n.k)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){var e=[];return this._idToVisibility.forEach(((t,r)=>{1&t||(this._idToVisibility.set(r,1),e.push(r))})),e}}},755:function(e,t,r){"use strict";function i(e,t){if(!e)return null;var r=t.featureAdapter,{startTimeField:i,endTimeField:n}=e,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(i&&n)t.forEach((e=>{var t=r.getAttribute(e,i),u=r.getAttribute(e,n);null==t||isNaN(t)||(a=Math.min(a,t)),null==u||isNaN(u)||(s=Math.max(s,u))}));else{var u=i||n;t.forEach((e=>{var t=r.getAttribute(e,u);null==t||isNaN(t)||(a=Math.min(a,t),s=Math.max(s,t))}))}return{start:a,end:s}}function n(e,t,r){if(!t||!e)return null;var{startTimeField:i,endTimeField:n}=e;if(!i&&!n)return null;var{start:a,end:s}=t;return null===a&&null===s?null:void 0===a&&void 0===s?()=>!1:i&&n?function(e,t,r,i,n){return null!=i&&null!=n?a=>{var s=e.getAttribute(a,t),u=e.getAttribute(a,r);return(null==s||s<=n)&&(null==u||u>=i)}:null!=i?t=>{var n=e.getAttribute(t,r);return null==n||n>=i}:null!=n?r=>{var i=e.getAttribute(r,t);return null==i||i<=n}:void 0}(r,i,n,a,s):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e.getAttribute(i,t)===r:null!=r&&null!=i?n=>{var a=e.getAttribute(n,t);return a>=r&&a<=i}:null!=r?i=>e.getAttribute(i,t)>=r:null!=i?r=>e.getAttribute(r,t)<=i:void 0}(r,i||n,a,s)}r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return n}))},877:function(e,t,r){"use strict";r.d(t,"a",(function(){return w})),r.d(t,"b",(function(){return S})),r.d(t,"c",(function(){return O}));var i=r(7),n=r(93),a=r(112),s=r(309),u=r(354),o=r(100),d=r(178),l=r(168);function c(e,t){return e?t?4:3:t?3:2}function h(e,t,r,i,n){if(!e)return!1;var a=c(t,r),{coords:s,lengths:u}=e,o=!1,d=0;for(var l of u)o=f(o,s,a,d,l,i,n),d+=l*a;return o}function f(e,t,r,i,n,a,s){for(var u=e,o=i,d=i,l=i+n*r;d<l;d+=r){(o=d+r)===l&&(o=i);var c=t[d],h=t[d+1],f=t[o],p=t[o+1];(h<s&&p>=s||p<s&&h>=s)&&c+(s-h)/(p-h)*(f-c)<a&&(u=!u)}return u}var p=r(400),_=r(668),m="feature-store:unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},y={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},I={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function v(e){return!0===y[e]}function x(e){return!0===I[Object(o.c)(e)]}function j(e){return!0===b[e]}function O(e,t,i,n,a){if(Object(o.g)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var f=Object(l.g)(new d.a,t,!1,!1);return Promise.resolve((e=>function(e,t,r,i){return h(e,t,r,i.coords[0],i.coords[1])}(f,!1,!1,e)))}if(Object(o.g)(t)&&"esriGeometryMultipoint"===i){var p=Object(l.g)(new d.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>function(e,t,r,i,n,a){var s=c(n,a),{coords:u,lengths:o}=i;if(!o)return!1;for(var d=0,l=0;d<o.length;d++,l+=s)if(!h(e,t,r,u[l],u[l+1]))return!1;return!0}(p,!1,!1,e,n,a)))}if(Object(o.d)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>Object(s.e)(t,Object(_.c)(i,n,a,e))));if(Object(o.d)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((e=>Object(s.d)(t,Object(_.c)(i,n,a,e))));if(Object(o.d)(t)&&"esriSpatialRelIntersects"===e){var m=Object(u.b)(i);return Promise.resolve((e=>m(t,Object(_.c)(i,n,a,e))))}return Promise.all([r.e(9),r.e(28)]).then(r.bind(null,788)).then((r=>{var s=r[g[e]].bind(null,t.spatialReference,t);return e=>s(Object(_.c)(i,n,a,e))}))}function S(e,t,r){return F.apply(this,arguments)}function F(){return(F=Object(i.a)((function*(e,t,r){var{spatialRel:i,geometry:s}=e;if(s){if(!v(i))throw new n.a(m,"Unsupported query spatial relationship",{query:e});if(Object(a.i)(s.spatialReference)&&Object(a.i)(r)){if(!x(s))throw new n.a(m,"Unsupported query geometry type",{query:e});if(!j(t))throw new n.a(m,"Unsupported layer geometry type",{query:e});if(e.outSR)return Object(p.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}))).apply(this,arguments)}function w(e){if(Object(o.d)(e))return!0;if(Object(o.g)(e)){for(var t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},904:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(407);class n extends i.a{constructor(e,t){super(i.a.createInstance()),this._currentIndex=-1,this._reader=e,this._indices=t}static from(e,t){return new n(e.copy(),t)}get hasNext(){return this._currentIndex+1<this._indices.length}getApproximateSize(){return this._indices.length}getCursor(){return this.copy()}copy(){var e=new n(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e}next(){for(;this._nextIndex()&&!this._reader._passesFilter()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}setArcadeSpatialReference(e){this._reader.setArcadeSpatialReference(e)}attachStorage(e){this._reader.attachStorage(e)}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}getStorage(){return this._reader.getStorage()}getComputedNumeric(e){return this._reader.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this._reader.setComputedNumericAtIndex(t,0)}getComputedString(e){return this._reader.getComputedStringAtIndex(0)}setComputedString(e,t){return this._reader.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._reader.getComputedNumericAtIndex(e)}setComputedNumericAtIndex(e,t){this._reader.setComputedNumericAtIndex(e,t)}getComputedStringAtIndex(e){return this._reader.getComputedStringAtIndex(e)}setComputedStringAtIndex(e,t){return this._reader.setComputedStringAtIndex(e,t)}transform(e,t,r,i){var n=this.copy();return n._reader=this._reader.transform(e,t,r,i),n}extent(e,t,r,i){var n=this.copy();return n._reader=this._reader.extent(e,t,r,i),n}hasFilter(){return this._reader.hasFilter()}readAttribute(e,t=!1){return this._reader.readAttribute(e,t)}readAttributes(){return this._reader.readAttributes()}joinAttributes(e){return this._reader.joinAttributes(e)}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this.readAttribute(e,!0)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(){return this._reader.castToText()}getQuantizationTransform(){return this._reader.getQuantizationTransform()}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}getGroupId(){return this._reader.getGroupId()}setGroupId(e){return this._reader.setGroupId(e)}getXHydrate(){return this._reader.getXHydrate()}getYHydrate(){return this._reader.getYHydrate()}getX(){return this._reader.getX()}getY(){return this._reader.getY()}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readLegacyFeature(){return this._reader.readLegacyFeature()}readOptimizedFeature(){return this._reader.readOptimizedFeature()}readLegacyPointGeometry(){return this._reader.readLegacyPointGeometry()}readLegacyGeometry(){return this._reader.readLegacyGeometry()}readLegacyCentroid(){return this._reader.readLegacyCentroid()}readGeometryArea(){return this._reader.readGeometryArea()}readUnquantizedGeometry(){return this._reader.readUnquantizedGeometry()}readHydratedGeometry(){return this._reader.readHydratedGeometry()}readGeometry(){return this._reader.readGeometry()}readCentroid(){return this._reader.readCentroid()}_passesFilter(){return this._reader._passesFilter()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}}},930:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(91),n=r(7),a=r(80),s=r(89),u=r(152),o=r(317),d=r(81);var l=function(e,t,r){e.referencesGeometry();var n=t.readArcadeFeature();try{return e.evaluate(Object(i.a)(Object(i.a)({},r),{},{$feature:n}))}catch(a){return d.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}},c=r.e(263).then(r.bind(null,1206));class h{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}invalidate(){this._bitsets.computed.clear()}updateSchema(e,t){var r=this;return Object(n.a)((function*(){var i=Object(o.a)(r._schema,t);if(r._schema=t,t&&!Object(s.j)(i)&&Object(o.b)(i,"attributes")){Object(a.a)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",i),r._bitsets.computed.clear(),e.targets[t.name]=!0;var n=t.attributes,u=[],d=[];for(var l in n){var c=n[l];switch(c.type){case"field":break;case"expression":u.push(r._createArcadeComputedField(c));break;case"label-expression":u.push(r._createLabelArcadeComputedField(c));break;case"statistic":d.push(c)}}r._computedFields=yield Promise.all(u),r._canCacheExpressionValue=!r._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),r._statisticFields=d}}))()}setComputedAttributes(e,t,r,i){var n=this._bitsets.computed;if(!this._canCacheExpressionValue||!n.has(r))for(var a of(n.set(r),this._computedFields)){var s=this._evaluateField(t,a,i);switch(a.resultType){case"numeric":e.setComputedNumericAtIndex(r,a.fieldIndex,s);break;case"string":e.setComputedStringAtIndex(r,a.fieldIndex,s)}}}_createArcadeComputedField(e){var t=this;return Object(n.a)((function*(){var r=t._sourceInfo.spatialReference,n=t._sourceInfo.fieldsIndex;return Object(i.a)(Object(i.a)({},e),{},{expression:yield Object(u.d)(e.valueExpression,r,n)})}))()}_createLabelArcadeComputedField(e){var t=this;return Object(n.a)((function*(){var r=t._sourceInfo.spatialReference,n=t._sourceInfo.fields,{createLabelFunction:a}=yield c,s=yield a(e.label,n,r);return Object(i.a)(Object(i.a)({},e),{},{builder:s})}))()}_evaluateField(e,t,r){switch(t.type){case"label-expression":var i=e.readArcadeFeature();return t.builder.evaluate(i)||"";case"expression":var{expression:n}=t;return l(n,e,{$view:{scale:r}})}}}},969:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return f}));r(80);var i=r(89),n=r(131),a=r(666),s=r(279),u=r(420),o=r(930),d=r(904);function l(e,t){return e<<16|t}function c(e){return(4294901760&e)>>>16}function h(e){return 65535&e}var f={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class p extends o.a{constructor(e,t,r){super(e,t),this.featureAdapter=f,this.events=new n.a,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._indexSearchCache=new a.a(50),this._index=Object(u.a)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))),this._storage=t,this.mode=r}get storage(){return this._storage}get storeStatistics(){return{featureCount:0,vertexCount:0}}hasInstance(e){return this._featureSetsByInstance.has(e)}onTileData(e,t){if(Object(i.j)(t.addOrUpdate))return t;if(t.addOrUpdate.attachStorage(this._storage),"snapshot"===this.mode){for(var r=t.addOrUpdate.getCursor();r.next();){var n=r.getDisplayId();this.setComputedAttributes(this._storage,r,n,e.scale)}return t}this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate);for(var a=t.addOrUpdate.getCursor();a.next();)this._insertFeature(a,e.scale);return this._spatialIndexInvalid=!0,this.events.emit("changed"),t}search(e){this._rebuildIndex();var t=e.id,r=this._indexSearchCache.find((e=>e.tileId===t));if(Object(i.k)(r))return r.readers;var n=new Map,a=this._searchIndex(e.bounds),s=[];for(var u of a){var o=this._storage.getInstanceId(u),l=c(o),f=h(o);n.has(l)||n.set(l,[]),n.get(l).push(f)}return n.forEach(((e,t)=>{var r=this._featureSetsByInstance.get(t);s.push(d.a.from(r,e))})),this._indexSearchCache.enqueue({tileId:t,readers:s}),s}insert(e){for(var t=e.getCursor(),r=this._storage;t.next();){var i,n=l(t.instance,t.getIndex()),a=t.getObjectId(),s=null!=(i=this._objectIdToDisplayId.get(a))?i:this._storage.createDisplayId();t.setDisplayId(s),r.setInstanceId(s,n),this._objectIdToDisplayId.set(a,s)}this._featureSetsByInstance.set(e.instance,e),this._spatialIndexInvalid=!0}remove(e){var t=this._objectIdToDisplayId.get(e);if(t){var r=this._storage.getInstanceId(t),i=h(r),n=c(r),a=this._featureSetsByInstance.get(n);this._objectIdToDisplayId.delete(e),this._storage.releaseDisplayId(t),a.removeAtIndex(i),a.isEmpty&&this._featureSetsByInstance.delete(n),this._spatialIndexInvalid=!0}}forEach(e){this._objectIdToDisplayId.forEach((t=>{var r=this._storage.getInstanceId(t),i=this._lookupFeature(r);e(i)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{var r=this._storage.getInstanceId(t),i=c(r),n=h(r),a=this._getFeatureSet(i);a.setIndex(n),e(a)}))}forEachInBounds(e,t){var r=this._searchIndex(e);for(var n of r){var a=this.lookupFeatureByDisplayId(n,this._storage);t(Object(i.q)(a))}}forEachBounds(e,t,r){this._rebuildIndex();var i=[0,0,0,0];for(var n of e)if(n.readGeometry()){var a=n.getDisplayId();i[0]=this._storage.getXMin(a),i[1]=this._storage.getYMin(a),i[2]=this._storage.getXMax(a),i[3]=this._storage.getYMax(a),t(Object(s.k)(r,i))}}sweepFeatures(e,t,r){this._spatialIndexInvalid=!0,this._objectIdToDisplayId.forEach(((i,n)=>{e.has(i)||(t.releaseDisplayId(i),r&&r.unsetAttributeData(i),this._objectIdToDisplayId.delete(n))})),this.events.emit("changed")}sweepFeatureSets(e){this._spatialIndexInvalid=!0,this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))}lookupObjectId(e,t){var r=this.lookupFeatureByDisplayId(e,t);return Object(i.j)(r)?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){var r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){var t=this._storage.getInstanceId(e),r=c(t),i=h(t),n=this._getFeatureSet(r);return n?(n.setIndex(i),n):null}_insertFeature(e,t){var r=this._storage,i=e.getObjectId(),n=l(e.instance,e.getIndex());r.getInstanceId(e.getDisplayId());var a=this._objectIdToDisplayId.get(i);a||(a=r.createDisplayId(),this._objectIdToDisplayId.set(i,a),this._spatialIndexInvalid=!0),e.setDisplayId(a),r.setInstanceId(a,n),this.setComputedAttributes(r,e,a,t)}_searchIndex(e){this._rebuildIndex();var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}_rebuildIndex(){if(this._spatialIndexInvalid){var e=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach((t=>{for(var r=t.getCursor();r.next();){var i=r.getDisplayId();this._storage.setBounds(i,r)&&e.push(i)}})):this._objectIdToDisplayId.forEach((t=>{var r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.clear(),this._index.load(e),this._indexSearchCache.clear(),this._spatialIndexInvalid=!1}}_lookupFeature(e){var t=c(e),r=h(e),i=this._getFeatureSet(t);if(!i)return null;var n=i.getCursor();return n.setIndex(r),n}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}}}}]);
//# sourceMappingURL=122.345b0caa.chunk.js.map