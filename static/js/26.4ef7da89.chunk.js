(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[26],{1085:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return m})),r.d(t,"c",(function(){return b})),r.d(t,"d",(function(){return h})),r.d(t,"e",(function(){return y})),r.d(t,"f",(function(){return f})),r.d(t,"g",(function(){return p})),r.d(t,"h",(function(){return g}));var i=r(6),a=r(43),n=(r(78),r(2)),s=r(3),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;Object(n.a)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return Object(s.a)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var a=i.get(r);return a.refCount--,a.refCount<=0&&(i.delete(r),a.controller&&a.controller.abort()),a.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var a=i.get(r);return a.ts=Date.now(),a.refCount++,i.delete(r),i.set(r,a),a.block}return null}},{key:"putBlock",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this._cachedBlocks,n=e+"/"+t;if(a.has(n)){var s=a.get(n);s.ts=Date.now(),s.refCount++}else a.set(n,{block:r,ts:Date.now(),refCount:1,controller:i});this.trim(),this.updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)}},{key:"updateMaxSize",value:function(e){this._size=e,this.trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this.clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),i=Date.now(),a=0;a<r.length&&r[a][1].ts<=i-e._duration;a++)t.delete(r[a][0]);0===t.size&&e.clearTimer()}),this._interval)}}},{key:"trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),o=r(934),u=new Map,c=new l;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(u.has(e)){var i=u.get(e);return i.push(r),i.length-1}return u.set(e,[r]),0}function p(e,t){if(u.has(e)){var r=u.get(e);r[t]=null,r.some((function(e){return null!=e}))||u.delete(e)}}function d(e,t,r){if(!u.has(e))return null==t?c.decreaseRefCount(e,r):0;var i=u.get(e);if(null==i[t])return c.decreaseRefCount(e,r);var a=i[t].cache;if(a.has(r)){var n=a.get(r);if(n.refCount--,0===n.refCount){a.delete(r);for(var s=0;s<i.length;s++)i[s]&&i[s].cache.has(r)&&i[s].cache.delete(r);n.controller&&n.controller.abort()}return n.refCount}return 0}function b(e,t,r){if(!u.has(e))return null==t?c.getBlock(e,r):null;var i=u.get(e);if(null==i[t]){for(var a=0;a<i.length;a++)if(i[a]&&i[a].cache.has(r)){var n=i[a].cache.get(r);return n.refCount++,n.block}return c.getBlock(e,r)}var s=i[t].cache;if(s.has(r)){var l=s.get(r);return l.refCount++,l.block}for(var o=0;o<i.length;o++)if(o!==t&&i[o]&&i[o]&&i[o].cache.has(r)){var h=i[o].cache.get(r);return h.refCount++,s.set(r,h),h.block}return null}function y(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u.has(e)){var n=u.get(e);if(null!=n[t]){var s={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:a};i.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),n[t].cache.set(r,s)}else c.putBlock(e,r,i,a)}else null==t&&c.putBlock(e,r,i,a)}function m(e,t,r){if(u.has(e)){var i=u.get(e);null!=i[t]?i[t].cache.delete(r):c.deleteBlock(e,r)}else null==t&&c.deleteBlock(e,r)}function v(e,t){if(!u.has(e))return null;var r=u.get(e);return null==r[t]?null:r[t]}function g(e,t,r,n,s,l){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=v(e,t),h=c.extent,f=c.cache,p=c.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){for(var d=r.clone().normalize(),b=p.spatialReference,y=p.transform,m=new Set,g=0;g<d.length;g++){var x=d[g];if(!(x.xmax-x.xmin<=n||x.ymax-x.ymin<=n)){var j=Object(o.e)(x,b,u);Object(i.k)(y)&&(j=y.inverseTransform(j));var _=new a.a({x:n,y:n,spatialReference:x.spatialReference});if(null==s&&!(s=Object(o.g)(_,b,x,u)))return;var O=Object(o.h)(s,p,l||"closest"),k=O.pyramidLevel,w=O.pyramidResolution,R=O.excessiveReading;if(R)return;for(var T=p.storageInfo,I=T.origin,P={x:Math.max(0,Math.floor((j.xmin-I.x)/w.x)),y:Math.max(0,Math.floor((I.y-j.ymax)/w.y))},S=Math.ceil((j.xmax-j.xmin)/w.x-.1),M=Math.ceil((j.ymax-j.ymin)/w.y-.1),C=k>0?T.pyramidBlockWidth:T.blockWidth,z=k>0?T.pyramidBlockHeight:T.blockHeight,U=1,B=Math.max(0,Math.floor(P.x/C)-U),q=Math.max(0,Math.floor(P.y/z)-U),V=Math.floor((P.x+S-1)/C)+U,G=Math.floor((P.y+M-1)/z)+U,L=q;L<=G;L++)for(var F=B;F<=V;F++)m.add("".concat(k,"/").concat(L,"/").concat(F))}}f.forEach((function(e,t){if(!m.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}},1242:function(e,t,r){"use strict";r.r(t);var i=r(29),a=r(7),n=r.n(a),s=r(16),l=r(2),o=r(3),u=r(4),c=r(5),h=r(0),f=(r(14),r(6)),p=r(12),d=(r(17),r(1)),b=r(8),y=(r(11),r(18),r(19),r(24)),m=r(43),v=r(57),g=(r(78),r(37)),x=r(72),j=r(901),_=r(25),O=r(131),k=r(902),w=r(934),R=r(1085),T=r(431),I=r(439),P=r(539),S=r(652),M=r(653),C=r(845),z=r(873),U=r(20),B=r(938),q=function(e){var t=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(l.a)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.fullExtent=null,e.tileInfo=null,e.datumTransformation=null,e}return Object(o.a)(r,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"fetchPopupFeatures",value:function(){var e=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,l,o,u,c,h,p,d,b,y,m,v,g,j,_;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new U.a("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i})));case 3:if(a=i.popupEnabled,s=Object(B.a)(i,r),a&&Object(f.k)(s)){e.next=6;break}throw new U.a("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:s});case 6:return l=[],e.next=9,i.identify(t);case 9:if(o=e.sent,u=o.value){if(p=u.join(", "),(d={ObjectId:0})[b="Raster.ServicePixelValue"]=this._formatAttributeValue(p,b),(y=null==(c=i.rasterInfo)||null==(h=c.attributeTable)?void 0:h.features)&&y.length>0&&(m=y.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===p}))).length>0&&(v=m[0]))for(g in v.attributes)v.attributes.hasOwnProperty(g)&&(j=this._rasterFieldPrefix+g,d[j]=this._formatAttributeValue(v.attributes[g],j));(_=new x.a(this.fullExtent.clone(),null,d)).layer=i,_.sourceLayer=_.layer,l.push(_)}return e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateFullExtent",value:function(){var e,t=this.layer.tileInfo;t&&t.spatialReference||(e=new U.a("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));var r=Object(w.b)(this.layer.fullExtent,this.view.spatialReference,!1),i=Object(w.e)(this.layer.fullExtent,this.view.spatialReference,r);return null==i&&(e=new U.a("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})),this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=Object(w.b)(this.layer.fullExtent,this.view.spatialReference,!0)),e?Promise.reject(e):Promise.resolve()}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var r,i,a=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,n=this._getFieldInfo(a,t),s=n&&n.format;if(s)return e.trim().indexOf(",")>-1?(i=(r=",")+" ",this._formatDelimitedString(e,r,i,s)):e.trim().indexOf(" ")>-1?(r=i=" ",this._formatDelimitedString(e,r,i,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var r,i=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_"))&&(r=e,!0)})),r}}},{key:"_formatDelimitedString",value:function(e,t,r,i){var a=this;return e&&t&&r&&i?e.trim().split(t).map((function(e){return a._formatNumberFromString(e,i)})).join(r):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var r=Number(e);return isNaN(r)?e:t.format(r)}}]),r}(e);return Object(h.a)([Object(d.b)()],t.prototype,"layer",void 0),Object(h.a)([Object(d.b)()],t.prototype,"view",void 0),Object(h.a)([Object(d.b)()],t.prototype,"fullExtent",void 0),Object(h.a)([Object(d.b)()],t.prototype,"tileInfo",void 0),Object(h.a)([Object(d.b)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=Object(h.a)([Object(b.a)("esri.views.layers.ImageryTileLayerView")],t)},V=r(32),G=r(30),L=r(28),F=r(105),E=r(119),D=r(821),N=r(918),A=r(859),W=r(542),Q=r(145),H=r(276),J=r(513),Z=r(543),K=r(271),X={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"},Y=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(l.a)(this,r),(e=t.call(this))._textureInvalidated=!0,e._memoryUsed=null,e._supportsBilinear=!0,e.stencilRef=0,e.coordScale=[1,1],e._symbolizerParameters=null,e.height=null,e.isRendereredSource=!1,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e.rawPixelData=null,e._suspended=!1,e._bandIds=null,e._interpolation=null,e._transformGrid=null,e.width=null,e.x=0,e.y=0,e.transforms={dvs:Object(H.b)()},e.source=i,e.transformGrid=a,e.interpolation=n,e}return Object(o.a)(r,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||X},set:function(e){this._symbolizerParameters=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._memoryUsed=null)}},{key:"suspended",get:function(){return this._suspended},set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e,this.invalidateTexture()}},{key:"interpolation",get:function(){return this._interpolation},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode(!this._supportsBilinear||"bilinear"!==e&&"cubic"!==e?9728:9729)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null,this._memoryUsed=null)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}},{key:"setTransform",value:function(e){var t=Object(Q.e)(this.transforms.dvs),r=e.toScreenNoRotation([0,0],this.x,this.y),a=Object(i.a)(r,2),n=a[0],s=a[1],l=this.resolution/this.pixelRatio/e.resolution,o=l*this.width,u=l*this.height,c=Math.PI*this.rotation/180;Object(Q.a)(t,t,Object(J.b)(n,s)),Object(Q.a)(t,t,Object(J.b)(o/2,u/2)),Object(Q.i)(t,t,-c),Object(Q.a)(t,t,Object(J.b)(-o/2,-u/2)),Object(Q.f)(t,t,Object(J.b)(o,u)),Object(Q.g)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"getTextures",value:function(){if(!this._rasterTexture)return null;var e=[],t=[];return this._transformGridTexture&&(t.push(this._transformGridTexture),e.push("u_transformGrid")),this._rasterTexture&&(t.push(this._rasterTexture),e.push("u_image")),this._colormapTexture&&(t.push(this._colormapTexture),e.push("u_colormap")),{names:e,textures:t}}},{key:"getMemoryUsage",value:function(){if(Object(f.j)(this._memoryUsed)){var e=this.getTextures();if(null==e)return 0;this._memoryUsed=e.textures.map((function(e){return e.descriptor.width*e.descriptor.height*4})).reduce((function(e,t){return e+t}))}return this._memoryUsed}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}},{key:"updateTexture",value:function(e){var t,r,i,a=e.context;if(!this.stage)return null==(t=this._rasterTexture)||t.dispose(),null==(r=this._transformGridTexture)||r.dispose(),null==(i=this._colormapTexture)||i.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);if(this._textureInvalidated){this._textureInvalidated=!1;var n=this.source,s=n&&n.pixels&&n.pixels.length>0;this._createOrDestroyRasterTexture(a),this._rasterTexture&&(s?(this._updateColormapTexture(a),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=Object(K.c)(a,this.transformGrid))):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender())}}},{key:"_createOrDestroyRasterTexture",value:function(e){var t,r,i=this.source?Object(k.h)(this.source,this.bandIds):null;if(i&&i.pixels&&i.pixels.length>0){var a=null==this._rasterTextureBandIds&&null==this.bandIds||this._rasterTextureBandIds&&this.bandIds&&this._rasterTextureBandIds.join("")===this.bandIds.join("");if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}var n=this.interpolation||"nearest",s=this.isRendereredSource||!(null!=(t=e.capabilities.textureFloat)&&t.textureFloat);this._rasterTexture=Object(K.b)(e,i,n,s),this._supportsBilinear=null==(r=e.capabilities.textureFloat)?void 0:r.textureFloatLinear,this._rasterTextureBandIds=this.bandIds}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}},{key:"_updateColormapTexture",value:function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=Object(K.a)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=Object(K.a)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}]),r}(Z.a),$=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(e,i,a){var n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(l.a)(this,r),(n=t.call(this,e,i,a)).bitmap=new Y(s,null,null),n.bitmap.coordScale=a,n.bitmap.once("isReady",(function(){return n.ready()})),n}return Object(o.a)(r,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"getMemoryUsage",value:function(){return this.bitmap.getMemoryUsage()}},{key:"setTransform",value:function(e,t){Object(G.a)(Object(L.a)(r.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"release",value:function(){return this.destroy(),this.bitmap=null,this.stage=null,!0}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(W.a),ee=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(l.a)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return Object(o.a)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e);return new $(e,t,this._tileInfoView.tileInfo.size)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"bitmap (tile)",brushes:[N.a.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:D.c.MAP});return[].concat(Object(V.a)(Object(G.a)(Object(L.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===D.c.MAP&&Object(G.a)(Object(L.a)(r.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds(Object(F.i)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,i=Object(E.o)(r.spatialReference);if(i){var a=r.lodAt(e.level).resolution,n=i/a%r.size[0],s=n?(r.size[0]-n)*a:0;t[0]-=s*e.world,t[2]-=s*e.world}}return t}}]),r}(A.a),te=r(846),re=p.a.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),ie=[0,0],ae=function(e){Object(u.a)(r,e);var t=Object(c.a)(r);function r(){var e;return Object(l.a)(this,r),(e=t.apply(this,arguments))._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._bitmapView=null,e._emptyTilePixelBlock=null,e._srcResolutions=null,e._previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._globalUpdateRequested=!1,e._isCustomTilingScheme=!1,e.useWebGLForProcessing=!0,e._redrawDebounced=Object(y.i)((function(t){return e._redrawImage(t)}),2e3),e}return Object(o.a)(r,[{key:"initialize",value:function(){var e=this.updateFullExtent();this.addResolvingPromise(e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;this._tileStrategy&&this.useProgressiveUpdate!==e&&(this._tileStrategy.destroy(),this._bitmapView.removeAllChildren(),this._tileStrategy=new M.a({cachePolicy:e?"keep":"purge",resampling:!1,acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:e?40:0,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.requestUpdate())}},{key:"hitTest",value:function(e,t){if(this.suspended)return Promise.resolve(null);var r=this.view.toMap(Object(g.f)(e,t));return Promise.resolve(new x.a({attributes:{},geometry:r}))}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,i=t.resolution,a=t.scale,n=this._tileInfoView.getClosestInfoForScale(a);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var l=this._srcResolutions[n.level],o=r.toJSON?r:v.a.fromJSON(r);Object(R.h)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,o,i,l,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this._previousLOD)?void 0:s.level)!==n.level&&(this._previousLOD=n,null!=this._symbolizerParams&&this._updateSymbolizerParams())}this.notifyChange("updating")}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),Object(T.a)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this.layer.raster&&(this.layer.raster.ioConfig.allowPartialFill=!0),this._initializeTileInfo(),this._tileInfoView=new P.a(this.tileInfo,this.fullExtent),this._fetchQueue=new S.a({tileInfoView:this._tileInfoView,concurrency:10,process:function(t,r){return e.fetchTile(t,r)}}),this._tileStrategy=new M.a({cachePolicy:this.useProgressiveUpdate?"keep":"purge",resampling:!1,acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:this.useProgressiveUpdate?40:0,tileInfoView:this._tileInfoView}),this._bitmapView=new ee(this._tileInfoView),this._bitmapView.isCustomTilingScheme=this._isCustomTilingScheme,this.container.addChild(this._bitmapView),this.handles.add([Object(_.d)(this,["layer.bandIds","layer.renderer"],(function(){return e._redrawDebounced().catch((function(e){Object(y.m)(e)||re.error(e)}))})),Object(_.d)(this,["layer.interpolation"],(function(t,r){"majority"!==t&&"majority"!==r||!e._canUseMajorityInterpolationOnDataSource()?e._redrawDebounced().catch((function(e){Object(y.m)(e)||re.error(e)})):e.refreshDebounced()})),Object(_.d)(this,["layer.multidimensionalDefinition"],this.refreshDebounced)],"attach"),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,Object(R.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){var e=this;!this.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=Object(y.d)(),0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.requestUpdate()}))),this.requestUpdate()}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return Object(z.a)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=Object(s.a)(n.a.mark((function e(){var t=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateRequested||this.suspended||(this.layer.updateRenderer(),this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((function(e){return t._enqueueTileFetch(e)})),this.notifyChange("updating"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this._fetchQueue.length>0||this._globalUpdateRequested}},{key:"acquireTile",value:function(e){var t,r,a,n,s=this._bitmapView.createTile(e),l=s.bitmap;return t=this._tileInfoView.getTileCoords(ie,s.key),r=Object(i.a)(t,2),l.x=r[0],l.y=r[1],l.resolution=this._tileInfoView.getTileResolution(s.key),a=this._tileInfoView.tileInfo.size,n=Object(i.a)(a,2),l.width=n[0],l.height=n[1],this._enqueueTileFetch(s),this.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.hasTilingEffects||!this.useProgressiveUpdate,s}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",(function(){e.destroy(),t.requestUpdate()})),this.requestUpdate()}},{key:"fetchTile",value:function(e,t){var r=!Object(f.j)(t)&&t.signal,i=this._canUseWebGLForProcessing(),a={tileInfo:this.tileInfo,signal:Object(f.q)(r),registryId:this._blockCacheRegistryId,requestRawData:i,srcResolution:this._srcResolutions[e.level],datumTransformation:this.datumTransformation,interpolation:i?"nearest":this.layer.interpolation};return this.layer.fetchTile(e.level,e.row,e.col,a)}},{key:"_canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&this._canUseMajorityInterpolationOnDataSource())}},{key:"_initializeTileInfo",value:function(){var e=this.view.spatialReference,t=new m.a({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:e}),r=Object(w.a)(this.layer.rasterInfo,e),i=r.scales,a=r.srcResolutions,n=r.isCustomTilingScheme,s=O.a.create({spatialReference:e,size:512,scales:i});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=n,this._set("tileInfo",s),this._srcResolutions=null!=a?a:[]}},{key:"_enqueueTileFetch",value:function(){var e=Object(s.a)(n.a.mark((function e(t,r){var i,a,s,l,o,u,c,h=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=41;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(i=e.sent,a=this.layer.bandIds,s=!this.useProgressiveUpdate||this.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.moving||0!==this._fetchQueue.length){e.next=18;break}return s=!1,e.prev=9,e.next=12,this._redrawImage(this._abortController&&this._abortController.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),Object(y.m)(e.t0)&&re.error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:if((l=this._canUseWebGLForProcessing())&&!this.hasTilingEffects&&null==this._symbolizerParams&&this._updateSymbolizerParams(),!i||!i.pixelBlock){e.next=32;break}if(!l){e.next=24;break}t.bitmap.source=i.pixelBlock,t.bitmap.isRendereredSource=!1,e.next=29;break;case 24:return o={extent:i.extent,pixelBlock:i.pixelBlock},e.next=27,this.layer.applyRenderer(o,this.hasTilingEffects&&this._globalSymbolizerParams&&"stretch"===this._globalSymbolizerParams.type?this._globalSymbolizerParams:null);case 27:u=e.sent,t.bitmap.rawPixelData=o,t.bitmap.source=u,t.bitmap.isRendereredSource=!0;case 29:t.bitmap.symbolizerParameters=l?this._globalSymbolizerParams||this._symbolizerParams:null,l?t.bitmap.transformGrid||(t.bitmap.transformGrid=i.transformGrid):t.bitmap.transformGrid=null,e.next=34;break;case 32:c=this._createEmptyTilePixelBlock(),t.bitmap.source=c,t.bitmap.symbolizerParameters=l?this._symbolizerParams:null,t.bitmap.transformGrid=null;case 34:t.bitmap.bandIds=a,t.bitmap.width=this._tileInfoView.tileInfo.size[0],t.bitmap.height=this._tileInfoView.tileInfo.size[1],t.bitmap.interpolation=this._getLayerInterpolation(),t.bitmap.suspended=s,t.bitmap.invalidateTexture(),t.once("attach",(function(){return h.requestUpdate()})),this._bitmapView.addChild(t),e.next=40;break;case 37:e.prev=37,e.t1=e.catch(1),Object(y.m)(e.t1)||re.error(e.t1);case 40:this.requestUpdate();case 41:case"end":return e.stop()}}),e,this,[[1,37],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var r,i,a=this;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer.updateRenderer(),!this.hasTilingEffects){e.next=6;break}return e.next=4,this._updateGlobalSymbolizerParams(t);case 4:e.next=7;break;case 6:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 7:return r=this.layer.bandIds,i=this._bitmapView.children.map(function(){var e=Object(s.a)(n.a.mark((function e(t){var i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=a._canUseWebGLForProcessing())){e.next=5;break}t.bitmap.isRendereredSource=!1,e.next=9;break;case 5:return e.next=7,a.layer.applyRenderer(t.bitmap.rawPixelData,a.hasTilingEffects&&a._globalSymbolizerParams&&"stretch"===a._globalSymbolizerParams.type?a._globalSymbolizerParams:null);case 7:t.bitmap.source=e.sent,t.bitmap.isRendereredSource=!0;case 9:t.bitmap.symbolizerParameters=i?a._globalSymbolizerParams||a._symbolizerParams:null,t.bitmap.bandIds=r,t.bitmap.interpolation=a._getLayerInterpolation(),t.bitmap.suspended=!1;case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=10,Object(y.j)(i);case 10:this.container.requestRender();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createEmptyTilePixelBlock",value:function(){if(!this._emptyTilePixelBlock){var e=this._tileInfoView.tileInfo.size[0],t=this._tileInfoView.tileInfo.size[1];this._emptyTilePixelBlock=new j.a({width:e,height:t,pixels:[new Uint8Array(e*t)],mask:new Uint8Array(e*t),pixelType:"u8"})}return this._emptyTilePixelBlock}},{key:"_updateGlobalSymbolizerParams",value:function(){var e=Object(s.a)(n.a.mark((function e(t){var r,i,a;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this._previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.view.extent,this.view.width,this.view.height,r);case 3:if((i=e.sent)&&i.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:a=this.layer.symbolizer.generateWebGLParameters({pixelBlock:Object(k.h)(i.pixelBlock,this.layer.bandIds),isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds}),!this._canUseWebGLForProcessing()&&a&&"stretch"===a.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(a.factor=a.factor.map((function(e){return 255*e})),a.outMin=Math.round(255*a.outMin),a.outMax=Math.round(255*a.outMax)),this._globalSymbolizerParams=a;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.view.spatialReference.isGeographic,resolution:{x:this._previousLOD.resolution,y:this._previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=t.url,i=t.rasterInfo,a=t.multidimensionalDefinition,n=t.raster,s=null!=i&&i.multidimensionalInfo?n.getSliceIndex(a):null,l=Object(R.d)(r,s);if(l!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&Object(R.g)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=Object(R.f)(l,this.layer.raster.rasterInfo),e){var o=this._tileInfoView.getClosestInfoForScale(this.view.scale),u=this._srcResolutions[o.level];Object(R.h)(l,this._blockCacheRegistryId,this.view.extent,this.view.resolution,u,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=l}}},{key:"_canUseMajorityInterpolationOnDataSource",value:function(){var e=this.layer.rasterInfo,t=e.bandCount,r=e.attributeTable,i=e.colormap,a=e.pixelType;return 1===t&&(null!=r||null!=i||"u8"===a||"s8"===a)}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;return"raster-colormap"===e||"unique-value"===e||"class-breaks"===e?"nearest":this.layer.interpolation}}]),r}(q(Object(I.a)(Object(te.a)(C.a))));Object(h.a)([Object(d.b)()],ae.prototype,"useProgressiveUpdate",null);var ne=ae=Object(h.a)([Object(b.a)("esri.views.2d.layers.ImageryTileLayerView2D")],ae);t.default=ne},845:function(e,t,r){"use strict";var i=r(2),a=r(3),n=r(4),s=r(5),l=r(0),o=(r(14),r(12)),u=(r(17),r(1)),c=r(8),h=(r(11),r(18),r(19),r(31)),f=r(70),p=r(179),d=r(181),b=r(99),y=function(e){Object(n.a)(r,e);var t=Object(s.a)(r);function r(e){var a;return Object(i.a)(this,r),(a=t.call(this,e)).layer=null,a.parent=null,a}return Object(a.a)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";throw o.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(r,"')"),t),t}}))}},{key:"fullOpacity",get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){return!this.suspended&&!0===this.layer.legendEnabled}},{key:"updating",get:function(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}},{key:"visible",get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}(Object(b.b)(Object(p.a)(Object(d.b)(f.a.EventedMixin(h.a)))));Object(l.a)([Object(u.b)()],y.prototype,"fullOpacity",null),Object(l.a)([Object(u.b)()],y.prototype,"layer",void 0),Object(l.a)([Object(u.b)()],y.prototype,"parent",void 0),Object(l.a)([Object(u.b)({readOnly:!0})],y.prototype,"suspended",null),Object(l.a)([Object(u.b)({readOnly:!0})],y.prototype,"suspendInfo",null),Object(l.a)([Object(u.b)({readOnly:!0})],y.prototype,"legendEnabled",null),Object(l.a)([Object(u.b)({type:Boolean,readOnly:!0})],y.prototype,"updating",null),Object(l.a)([Object(u.b)()],y.prototype,"visible",null);var m=y=Object(l.a)([Object(c.a)("esri.views.layers.LayerView")],y);t.a=m},846:function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));var i,a=r(2),n=r(3),s=r(30),l=r(28),o=r(4),u=r(5),c=r(0),h=(r(14),r(12),r(17),r(1)),f=r(8),p=(r(11),r(18),r(19),r(40)),d=r(171),b=r(25),y=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){return Object(a.a)(this,r),t.apply(this,arguments)}return r}(r(22).a),m=y=Object(c.a)([Object(f.a)("esri.views.layers.support.ClipArea")],y),v=i=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="rect",e.left=null,e.right=null,e.top=null,e.bottom=null,e}return Object(n.a)(r,[{key:"clone",value:function(){return new i({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(m);Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"left",void 0),Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"right",void 0),Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"top",void 0),Object(c.a)([Object(h.b)({type:[Number,String],json:{write:!0}})],v.prototype,"bottom",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],v.prototype,"version",null);var g,x=v=i=Object(c.a)([Object(f.a)("esri.views.layers.support.ClipRect")],v),j=r(881),_=r(136),O=r(57),k=r(95),w=r(67),R=(r(78),{base:_.a,key:"type",typeMap:{extent:O.a,polygon:k.a}}),T=g=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="geometry",e.geometry=null,e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}},{key:"clone",value:function(){return new g({geometry:this.geometry.clone()})}}]),r}(m);Object(c.a)([Object(h.b)({types:R,json:{read:w.a,write:!0}})],T.prototype,"geometry",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],T.prototype,"version",null);var I=T=g=Object(c.a)([Object(f.a)("esri.views.layers.support.Geometry")],T),P=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).type="path",e.path=[],e}return Object(n.a)(r,[{key:"version",get:function(){return(this._get("version")||0)+1}}]),r}(m);Object(c.a)([Object(h.b)({type:[[[Number]]],json:{write:!0}})],P.prototype,"path",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],P.prototype,"version",null);var S=P=Object(c.a)([Object(f.a)("esri.views.layers.support.Path")],P),M=p.a.ofType({key:"type",base:m,typeMap:{rect:x,path:S,geometry:I}}),C=function(e){var t=function(e){Object(o.a)(r,e);var t=Object(u.a)(r);function r(){var e;return Object(a.a)(this,r),(e=t.apply(this,arguments)).clips=new M,e.moving=!1,e.attached=!1,e.lastUpdateId=-1,e.updateRequested=!1,e}return Object(n.a)(r,[{key:"initialize",value:function(){var e,t=this;this.container||(this.container=new j.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(b.a)(this,"suspended",(function(e){t.container&&(t.container.visible=!e),t.view&&!e&&t.updateRequested&&t.view.requestUpdate()}),!0),Object(b.a)(this,["layer.opacity","container"],(function(){var e,r;t.container&&(t.container.opacity=null!=(e=null==(r=t.layer)?void 0:r.opacity)?e:1)}),!0),Object(b.a)(this,["layer.blendMode"],(function(e){t.container&&(t.container.blendMode=e)}),!0),Object(b.a)(this,["layer.effect"],(function(e){t.container&&(t.container.effect=e)}),!0),this.clips.on("change",(function(){t.container.clips=t.clips,t.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e!==t||t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){})):this.when().then((function(){t.attached||t.destroyed||(t.attach(),t.requestUpdate(),t.attached=!0)}),(function(){}))}},{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}},{key:"isVisibleAtScale",value:function(e){var t=!0,r=this.layer,i=r.minScale,a=r.maxScale;if(null!=i&&null!=a){var n=!i,s=!a;!n&&e<=i&&(n=!0),!s&&e>=a&&(s=!0),t=n&&s}return t}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"isUpdating",value:function(){return!1}},{key:"isRendering",value:function(){return!1}},{key:"canResume",value:function(){return!!Object(s.a)(Object(l.a)(r.prototype),"canResume",this).call(this)&&this.isVisibleAtScale(this.view.scale)}}]),r}(e);return Object(c.a)([Object(h.b)({type:M,set:function(e){var t=Object(d.b)(e,this._get("clips"),M);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(c.a)([Object(h.b)()],t.prototype,"moving",void 0),Object(c.a)([Object(h.b)()],t.prototype,"attached",void 0),Object(c.a)([Object(h.b)()],t.prototype,"container",void 0),Object(c.a)([Object(h.b)()],t.prototype,"suspended",void 0),Object(c.a)([Object(h.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(c.a)([Object(h.b)()],t.prototype,"updateRequested",void 0),Object(c.a)([Object(h.b)()],t.prototype,"updating",null),Object(c.a)([Object(h.b)()],t.prototype,"view",void 0),t=Object(c.a)([Object(f.a)("esri.views.2d.layers.LayerView2D")],t)}},859:function(e,t,r){"use strict";var i=r(15),a=r(32),n=r(10),s=r(2),l=r(3),o=r(30),u=r(28),c=r(4),h=r(5),f=r(821),p=r(897),d=r(895),b=r(879),y=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},m=function(e){Object(c.a)(r,e);var t=Object(h.a)(r);function r(e){var i;return Object(s.a)(this,r),(i=t.call(this))._tileInfoView=e,i}return Object(l.a)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(y),this.setStencilReference(),Object(o.a)(Object(u.a)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state;return Object(n.a)(Object(n.a)({},Object(o.a)(Object(u.a)(r.prototype),"createRenderParams",this).call(this,e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"stencil",brushes:[d.a],drawPhase:f.c.DEBUG|f.c.MAP|f.c.HIGHLIGHT,target:function(){return t.getStencilTarget()}}),n=e.registerRenderPass({name:"tileInfo",brushes:[p.a],drawPhase:f.c.DEBUG,target:function(){return t.children},has:"esri-tiles-debug"});return[].concat(Object(a.a)(Object(o.a)(Object(u.a)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i,n])}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,r=Object(i.a)(this.children);try{for(r.s();!(t=r.n()).done;){var a=t.value,n=this._tileInfoView.getTileResolution(a.key);a.setTransform(e,n)}}catch(s){r.e(s)}finally{r.f()}}},{key:"setStencilReference",value:function(){var e,t=1,r=Object(i.a)(this.children);try{for(r.s();!(e=r.n()).done;){e.value.stencilRef=t++}}catch(a){r.e(a)}finally{r.f()}}}]),r}(b.a);t.a=m},863:function(e,t,r){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function a(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,i=0;i<e.length;i++){var a=e[i].size;"number"==typeof a&&(t+=a,r++)}return t/r}(e.stops):t}function n(e,t){if(!t)return e;var r=t.filter((function(e){return"size"===e.type})).map((function(t){var r=t.maxSize,i=t.minSize;return(a(r,e)+a(i,e))/2})),i=0,n=r.length;if(0===n)return e;for(var s=0;s<n;s++)i+=r[s];var l=Math.floor(i/n);return Math.max(l,e)}function s(e){var t=e&&e.renderer,r="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return r;var a="visualVariables"in t?n(r,t.visualVariables):r;if("simple"===t.type)return i(a,t.symbol);if("unique-value"===t.type){var s=a;return t.uniqueValueInfos.forEach((function(e){s=i(s,e.symbol)})),s}if("class-breaks"===t.type){var l=a;return t.classBreakInfos.forEach((function(e){l=i(l,e.symbol)})),l}return t.type,a}r.d(t,"a",(function(){return s}))},873:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o}));var i=r(6),a=r(57),n=(r(78),r(62)),s=r(863);function l(e,t,r){var s,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new a.a;if("2d"===r.type)s=t*r.resolution;else if("3d"===r.type){var o=r.overlayPixelSizeInMapUnits(e),u=r.basemapSpatialReference;s=Object(i.k)(u)&&!u.equals(r.spatialReference)?Object(n.f)(u)/Object(n.f)(r.spatialReference):t*o}var c=e.x-s,h=e.y-s,f=e.x+s,p=e.y+s,d=r.spatialReference;return l.xmin=Math.min(c,f),l.ymin=Math.min(h,p),l.xmax=Math.max(c,f),l.ymax=Math.max(h,p),l.spatialReference=d,l}function o(e,t,r){var a=r.toMap(e);return!Object(i.j)(a)&&l(a,Object(s.a)(),r,u).intersects(t)}var u=new a.a},934:function(e,t,r){"use strict";r.d(t,"a",(function(){return R})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return k})),r.d(t,"d",(function(){return m})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return x})),r.d(t,"h",(function(){return w}));var i=r(7),a=r.n(i),n=r(29),s=r(16),l=r(20),o=r(56),u=r(59),c=r(43),h=r(57),f=(r(78),r(62)),p=r(130),d=5e-4,b=function(e,t){var r=(e.isWGS84||e.isWebMercator)&&(t.isWGS84||t.isWebMercator);return!(e.equals(t)||r)},y=function(e,t){var r=(e[0]+e[4]+e[4*t.cols]+e[4*t.cols+4])/4,i=(e[1]+e[5]+e[4*t.rows+1]+e[4*t.rows+5])/4;return[Math.abs(r-e[2*t.rows+2]),Math.abs(i-e[2*t.rows+3])]};function m(){return v.apply(this,arguments)}function v(){return(v=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(p.g)()&&Object(p.h)()){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,Object(p.i)();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,r){if(!b(e.spatialReference,t))return null;if(!Object(p.g)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");return r?Object(p.e)(t,e.spatialReference,e):Object(p.e)(e.spatialReference,t,e)}function x(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e.spatialReference.equals(t))return e;var a=b(e.spatialReference,t);if(a&&!Object(p.g)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var n=r.center,s=new h.a({xmin:n.x-e.x/2,xmax:n.x+e.x/2,ymin:n.y-e.y/2,ymax:n.y+e.y/2,spatialReference:e.spatialReference}),o=a?Object(p.j)(s,t,i):Object(u.d)(s,t);return null==o?null:{x:o.xmax-o.xmin,y:o.ymax-o.ymin}}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;return Object(f.f)(e)?t/Object(f.f)(e):0}function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.spatialReference;if(a.equals(t))return e;var s=b(a,t);if(s&&!Object(p.g)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");var c=s?Object(p.j)(e,t,r):Object(u.d)(e,t);if(c&&i&&t.isGeographic){var h,f,y=a.isWebMercator?Object(o.d)(a).origin:null!=(h=null==(f=Object(o.d)(a))?void 0:f.valid)?h:[],m=Object(n.a)(y,2),v=m[0],g=m[1],x=j(a);x&&null!=v&&null!=g&&(Math.abs(e.x-v)<x&&Math.abs(180-c.x)<d?c.x-=360:Math.abs(e.x-g)<x&&Math.abs(180+c.x)<d&&(c.x+=360))}return c}function O(e,t){var r,i,a,s,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],y=e.spatialReference;if(y.equals(t))return e;var m=b(y,t);if(m&&!Object(p.g)())throw new l.a("rasterprojectionhelper-projectExtent","projection engine is not loaded");var v=m?Object(p.j)(e,t,h):Object(u.d)(e,t),g=null!=(r=null==(i=Object(o.d)(y))?void 0:i.origin)?r:[],x=Object(n.a)(g,2),O=x[0],k=x[1];if(v&&f&&y.isWebMercator&&t.isGeographic&&null!=O&&null!=k){var w=.001,R=1e3;if(Math.abs(e.xmin-O)<w&&Math.abs(k-e.xmax)>R&&Math.abs(180-v.xmax)<d){v.xmin=-180;var T=[];T.push(new c.a(e.xmax,e.ymin,y)),T.push(new c.a(e.xmax,(e.ymin+e.ymax)/2,y)),T.push(new c.a(e.xmax,e.ymax,y));var I=T.map((function(e){return _(e,t,h)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));v.xmax=Math.max.apply(null,I)}if(Math.abs(e.xmax-k)<w&&Math.abs(O-e.xmin)>R&&Math.abs(180+v.xmin)<d){v.xmax=180;var P=[];P.push(new c.a(e.xmin,e.ymin,y)),P.push(new c.a(e.xmin,(e.ymin+e.ymax)/2,y)),P.push(new c.a(e.xmin,e.ymax,y));var S=P.map((function(e){return _(e,t,h)})).filter((function(e){return!isNaN(null==e?void 0:e.x)})).map((function(e){return e.x}));v.xmin=Math.min.apply(null,S)}}var M=t.isWebMercator?Object(o.d)(t).origin:null!=(a=null==(s=Object(o.d)(t))?void 0:s.valid)?a:[],C=Object(n.a)(M,2);O=C[0],k=C[1];var z=j(t);return z&&null!=O&&null!=k&&(Math.abs(v.xmin-O)<z&&(v.xmin=O),Math.abs(v.xmax-k)<z&&(v.xmax=k)),v}function k(e,t,r){var i,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[32,32];if(b(e.spatialReference,t.spatialReference)&&!Object(p.g)())throw new l.a("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(e&&t&&r))return null;for(var d,m=e.xmin,v=e.ymin,g=e.xmax,x=e.ymax,j=e.spatialReference,O=t.spatialReference,k=null!=(i=null==(a=Object(o.d)(j))?void 0:a.valid)?i:[],w=Object(n.a)(k,2),R=w[0],T=w[1],I={x:f[0]*r.x,y:f[1]*r.y},P={cols:Math.ceil((g-m)/I.x-.1)+1,rows:Math.ceil((x-v)/I.y-.1)+1},S=I.x,M=I.y,C=[],z=!1,U=0;U<P.cols;U++){for(var B=[],q=0;q<P.rows;q++){var V=_(new c.a({x:m+S*U,y:x-M*q,spatialReference:j}),O,s);u&&(V=u.inverseTransform(V)),B.push(V),U>0&&h&&V&&d[q]&&null!=R&&V.x<d[q].x&&(V.x+=T-R),V?(C.push((V.x-t.xmin)/(t.xmax-t.xmin)),C.push((t.ymax-V.y)/(t.ymax-t.ymin))):(C.push(NaN),C.push(NaN),z=!0)}d=B}for(var G=y(C,P),L=new Float32Array((P.cols-1)*(P.rows-1)*2*6),F=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),E=new Float32Array([-1,1,0,0,-1,1,1,0,0]),D=0;D<P.cols-1;D++){for(var N=0;N<P.rows-1;N++){for(var A=D*P.rows*2+2*N,W=C[A],Q=C[A+1],H=C[A+2],J=C[A+3],Z=C[A+=2*P.rows],K=C[A+1],X=C[A+2],Y=C[A+3],$=0,ee=12*(N*(P.cols-1)+D),te=0;te<3;te++)L[ee++]=F[$++]*W+F[$++]*H+F[$++]*X;$=0;for(var re=0;re<3;re++)L[ee++]=F[$++]*Q+F[$++]*J+F[$++]*Y;$=0;for(var ie=0;ie<3;ie++)L[ee++]=E[$++]*W+E[$++]*Z+E[$++]*X;$=0;for(var ae=0;ae<3;ae++)L[ee++]=E[$++]*Q+E[$++]*K+E[$++]*Y}if(z)for(var ne=0;ne<L.length;ne++)isNaN(L[ne])&&(L[ne]=-1)}return{offsets:C,error:G,coefficients:L,spacing:f,size:[P.cols-1,P.rows-1]}}function w(e,t,r){var i=Math.log(e.x/t.pixelSize.x)/Math.LN2,a=Math.log(e.y/t.pixelSize.y)/Math.LN2,n=t.storageInfo.maximumPyramidLevel||0,s="down"===r?Math.floor(Math.min(i,a)):"up"===r?Math.ceil(Math.max(i,a)):Math.round((i+a)/2),l=!1;s<0?s=0:s>n&&(l=s>n+3,s=n);var o=Math.pow(2,s);return{pyramidLevel:s,pyramidResolution:new c.a({x:o*t.nativePixelSize.x,y:o*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}function R(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=e.extent,n=e.spatialReference,s=e.pixelSize,l=x(new c.a({x:s.x,y:s.y,spatialReference:n}),t,a);if(null==l)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};var o=(l.x+l.y)/2,u=Object(f.f)(t),h=o*u*96*39.37,p=t.isGeographic?512/r*295828763.7958547:512/r*591657527.591555,d=!1,b=O(a,t);i&&(t.isGeographic||t.isWebMercator)&&(d=b.xmin*b.xmax<0);var y,m=h,v=1.001;if(d){m=p;var g=.29858214164761665,j=g*(96*u*39.37);(y=x(new c.a({x:g,y:g,spatialReference:{wkid:3857}}),n,b)).x*=m/j,y.y*=m/j}else{y={x:s.x,y:s.y};for(var _=Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),k=0;m<p*(v/2)&&k<_;)k++,m*=2,y.x*=2,y.y*=2;Math.max(m,p)/Math.min(m,p)<=v&&(m=p)}for(var w=[m],R=[{x:y.x,y:y.y}],T=70.5310735,I=Math.min(T,h)/v;m>=I;)m/=2,y.x/=2,y.y/=2,w.push(m),R.push({x:y.x,y:y.y});return{projectedPixelSize:l,scales:w,srcResolutions:R,isCustomTilingScheme:!d}}},938:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return u}));var i=r(7),a=r.n(i),n=r(32),s=r(16),l=r(6),o=r(65);function u(e){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(a.a.mark((function e(t){var r,i,s,u,c,h,f,p,d,b=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>1&&void 0!==b[1]?b[1]:t.popupTemplate,Object(l.k)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fields);case 5:if(i=e.sent,s=r.lastEditInfoEnabled,u=t.objectIdField,c=t.typeIdField,h=t.globalIdField,f=t.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!s){e.next=19;break}return e.next=16,Object(o.o)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,d=Object(o.k)(t.fields,[].concat(Object(n.a)(i),Object(n.a)(p))),e.abrupt("return",(c&&d.push(c),d&&u&&Object(o.t)(t.fields,u)&&-1===d.indexOf(u)&&d.push(u),d&&h&&Object(o.t)(t.fields,h)&&-1===d.indexOf(h)&&d.push(h),f&&f.forEach((function(e){var r=e.keyField;d&&r&&Object(o.t)(t.fields,r)&&-1===d.indexOf(r)&&d.push(r)})),d));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){return e.popupTemplate?e.popupTemplate:Object(l.k)(t)&&t.defaultPopupTemplateEnabled&&Object(l.k)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=26.4ef7da89.chunk.js.map