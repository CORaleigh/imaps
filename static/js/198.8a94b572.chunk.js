(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[198],{1261:function(e,t,n){"use strict";n.r(t),n.d(t,"GraphicsSnappingSource",(function(){return S}));var i=n(76),s=n(89),r=n(171),a=n(147),o=n(80),c=n(84),d=n(78),u=(n(74),n(79),n(75),n(77)),l=n(104),p=n(116),h=n(168),m=n(569),f=n(163),y=n(153),x=n(246),b=n(825),O=n(752),g=n(317),j=n(933);let S=class extends(Object(a.b)(s.a)){constructor(e){super(e),this.availability=1,this.sources={multipoint:null,point:null,polygon:null,polyline:null},this.loadedWkids=new Set,this.loadedWkts=new Set,this.pendingAdds=[]}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){const e=this.pendingAdds;this.pendingAdds.length=0;for(const t of e)t.task.abort();this.mapSources((e=>this.destroySource(e)))}initialize(){this.handles.add([this.layer.on("graphic-update",(e=>this.onGraphicUpdate(e))),this.updatingHandles.addOnCollectionChange(this.layer.graphics,(e=>this.onGraphicsChanged(e)))]),this.addMany(this.layer.graphics.toArray())}async fetchCandidates(e,t){const n=(await Object(c.k)(this.mapSources((n=>n.queryEngine.executeQueryForSnapping({point:e.coordinateHelper.toPoint(e.point,new l.a).toJSON(),distance:e.distance,types:e.types,query:Object(o.k)(e.filter)?e.filter.createQuery().toJSON():{where:"1=1"}},t).then((({candidates:e})=>e)))))).flat().map((t=>Object(j.a)(t,e.coordinateHelper)));return Object(g.e)(e.point,n),n}refresh(){}onGraphicUpdate(e){switch(e.property){case"geometry":case"visible":this.remove(e.graphic),this.addMany([e.graphic])}}onGraphicsChanged(e){for(const t of e.removed)this.remove(t);this.addMany(e.added)}addMany(e){const t=[],n=new Map;for(const i of e)Object(o.j)(i.geometry)||(this.needsInitializeProjection(i.geometry.spatialReference)?(t.push(i.geometry.spatialReference),n.set(i.uid,i)):this.add(i));this.createPendingAdd(t,n)}createPendingAdd(e,t){if(!e.length)return;const n=Object(c.h)((async n=>{await Object(h.f)(e.map((e=>({source:e,dest:this.spatialReference}))),{signal:n}),this.markLoadedSpatialReferences(e);for(const[,e]of t)this.add(e)}));this.updatingHandles.addPromise(n.promise);const i={task:n,graphics:t},s=()=>Object(r.j)(this.pendingAdds,i);n.promise.then(s,s),this.pendingAdds.push(i)}markLoadedSpatialReferences(e){for(const t of e)null!=t.wkid&&this.loadedWkids.add(t.wkid),null!=t.wkt&&this.loadedWkts.add(t.wkt)}add(e){if(Object(o.j)(e.geometry)||!e.visible)return;let t=e.geometry;if("mesh"===t.type)return;"extent"===t.type&&(t=p.a.fromExtent(t));const n=this.ensureSource(t.type);if(Object(o.j)(n))return;const i=this.createOptimizedFeature(e.uid,t);Object(o.k)(i)&&n.featureStore.add(i)}needsInitializeProjection(e){return(null==e.wkid||!this.loadedWkids.has(e.wkid))&&(null==e.wkt||!this.loadedWkts.has(e.wkt))&&!Object(h.b)(e,this.spatialReference)}createOptimizedFeature(e,t){const n=Object(h.k)(Object(m.a)(t),this.spatialReference);return n?new x.a(Object(y.d)(n,!1,!1),{[k]:e},null,e):null}ensureSource(e){const t=this.sources[e];if(Object(o.k)(t))return t;const n=this.createSource(e);return this.sources[e]=n,n}createSource(e){const t=f.a.toJSON(e),n=new b.a({geometryType:t,hasZ:!1,hasM:!1});return{featureStore:n,queryEngine:new O.a({featureStore:n,fields:[{name:k,type:"esriFieldTypeOID",alias:k}],geometryType:t,hasM:!1,hasZ:!1,objectIdField:k,spatialReference:this.spatialReference,scheduler:Object(o.k)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:e}}remove(e){this.mapSources((t=>this.removeFromSource(t,e)));for(const t of this.pendingAdds)t.graphics.delete(e.uid),0===t.graphics.size&&t.task.abort()}removeFromSource(e,t){const n=t.uid;e.featureStore.has(n)&&e.featureStore.removeById(t.uid)}destroySource(e){e.queryEngine.destroy(),this.sources[e.type]=null}mapSources(e){const{point:t,polygon:n,polyline:i,multipoint:s}=this.sources,r=[];return Object(o.k)(t)&&r.push(e(t)),Object(o.k)(n)&&r.push(e(n)),Object(o.k)(i)&&r.push(e(i)),Object(o.k)(s)&&r.push(e(s)),r}};Object(i.a)([Object(d.b)({constructOnly:!0})],S.prototype,"spatialReference",void 0),Object(i.a)([Object(d.b)({constructOnly:!0})],S.prototype,"layerSource",void 0),Object(i.a)([Object(d.b)({constructOnly:!0})],S.prototype,"view",void 0),Object(i.a)([Object(d.b)({readOnly:!0})],S.prototype,"updating",null),Object(i.a)([Object(d.b)({readOnly:!0})],S.prototype,"availability",void 0),S=Object(i.a)([Object(u.a)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],S);const k="OBJECTID"},569:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(117),s=n(284),r=n(242),a=n(93),o=n(239),c=n(100);function d(e){if(!e)return null;if("mesh"===e.type)return e.toJSON();let t=null;const n=e.spatialReference,i=Object(c.d)(n);if(!i)return e.toJSON();const d=n.isWebMercator?102100:4326,p=o.a[d].maxX,h=o.a[d].minX,m=o.a[d].plus180Line,x=o.a[d].minus180Line;let b;const O=e.toJSON();if(Object(a.f)(O))b=l(O,p,h);else if(Object(a.e)(O))O.points=O.points.map((e=>l(e,p,h))),b=O;else if(Object(a.d)(O))b=u(O,i);else if(Object(a.g)(O)||Object(a.h)(O)){const e=y;Object(s.a)(e,O);const n={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=Object(o.d)(n.xmin,h)*(2*p),a=0===i?O:function(e,t){const n=Object(o.b)(e);for(const i of n)for(const e of i)e[0]+=t;return e}(O,i);n.xmin+=i,n.xmax+=i,Object(r.b)(n,m)&&n.xmax!==p||Object(r.b)(n,x)&&n.xmin!==h?t=a:b=a}else b=e.toJSON();return null!==t?(new f).cut(t,p):b}function u(e,t){if(!t)return e;const n=function(e,t){const n=[],{ymin:i,ymax:s}=e,r=e.xmax-e.xmin,a=e.xmin,o=e.xmax;let c;const[d,u]=t.valid;c=p(e.xmin,t);const l=c.x,m=c.frameId;c=p(e.xmax,t);const f=c.x,y=c.frameId,x=l===f&&r>0;if(r>2*u){const e={xmin:a<o?l:f,ymin:i,xmax:u,ymax:s},t={xmin:d,ymin:i,xmax:a<o?f:l,ymax:s},r={xmin:0,ymin:i,xmax:u,ymax:s},c={xmin:d,ymin:i,xmax:0,ymax:s},p=[],x=[];h(e,r)&&p.push(m),h(e,c)&&x.push(m),h(t,r)&&p.push(y),h(t,c)&&x.push(y);for(let n=m+1;n<y;n++)p.push(n),x.push(n);n.push({extent:e,frameIds:[m]},{extent:t,frameIds:[y]},{extent:r,frameIds:p},{extent:c,frameIds:x})}else l>f||x?n.push({extent:{xmin:l,ymin:i,xmax:u,ymax:s},frameIds:[m]},{extent:{xmin:d,ymin:i,xmax:f,ymax:s},frameIds:[y]}):n.push({extent:{xmin:l,ymin:i,xmax:f,ymax:s},frameIds:[m]});return n}(e,t).map((e=>e.extent));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function l(e,t,n){if(Array.isArray(e)){const i=e[0];if(i>t){const n=Object(o.d)(i,t);e[0]=i+n*(-2*t)}else if(i<n){const t=Object(o.d)(i,n);e[0]=i+t*(-2*n)}}else{const i=e.x;if(i>t){const n=Object(o.d)(i,t);e.x+=n*(-2*t)}else if(i<n){const t=Object(o.d)(i,n);e.x+=t*(-2*n)}}return e}function p(e,t){const[n,i]=t.valid,s=2*i;let r,a=0;return e>i?(r=Math.ceil(Math.abs(e-i)/s),e-=r*s,a=r):e<n&&(r=Math.ceil(Math.abs(e-n)/s),e+=r*s,a=-r),{x:e,frameId:a}}function h(e,t){const{xmin:n,ymin:i,xmax:s,ymax:r}=t;return m(e,n,i)&&m(e,n,r)&&m(e,s,r)&&m(e,s,i)}function m(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}class f{cut(e,t){let n;if(e.rings)this.closed=!0,n=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,n=e.paths,this.minPts=2}const i=n.length,s=-2*t;for(let r=0;r<i;r++){const e=n[r];if(e&&e.length>=this.minPts){const t=[];for(const n of e)t.push([n[0]+s,n[1]]);n.push(t)}}return this.closed?e.rings=n:e.paths=n,e}}const y=Object(i.k)()},933:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(816),s=n(549),r=n(741),a=n(669);class o extends r.a{constructor(e){super({...e,constraint:new s.d(e.coordinateHelper,e.targetPoint)})}get hints(){return[new a.a(this.targetPoint)]}}function c(e,t){switch(e.type){case"edge":return new i.a({coordinateHelper:t,edgeStart:t.fromPoint(e.start),edgeEnd:t.fromPoint(e.end),targetPoint:t.fromPoint(e.target),objectId:e.objectId});case"vertex":return new o({coordinateHelper:t,targetPoint:t.fromPoint(e.target),objectId:e.objectId})}}}}]);
//# sourceMappingURL=198.8a94b572.chunk.js.map