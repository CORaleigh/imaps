"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[3220],{67077:(e,t,r)=>{function n(){return[0,0,0,0]}function o(e){return[e[0],e[1],e[2],e[3]]}function i(e,t,r,n){return[e,t,r,n]}function s(e){const t=[0,0,0,0],r=Math.min(4,e.length);for(let n=0;n<r;++n)t[n]=e[n];return t}function a(e,t){return new Float64Array(e,t,4)}function c(){return[0,0,0,0]}function l(){return i(1,1,1,1)}function u(){return i(1,0,0,0)}function d(){return i(0,1,0,0)}function f(){return i(0,0,1,0)}function h(){return i(0,0,0,1)}r.d(t,{O:()=>p,Z:()=>y,a:()=>a,b:()=>s,c:()=>n,d:()=>o,f:()=>i});const y=[0,0,0,0],p=l(),m=u(),w=d(),M=f(),_=h();Object.freeze(Object.defineProperty({__proto__:null,create:n,clone:o,fromValues:i,fromArray:s,createView:a,zeros:c,ones:l,unitX:u,unitY:d,unitZ:f,unitW:h,ZEROS:y,ONES:p,UNIT_X:m,UNIT_Y:w,UNIT_Z:M,UNIT_W:_},Symbol.toStringTag,{value:"Module"}))},27811:(e,t,r)=>{r.d(t,{AJ:()=>l,If:()=>y,QM:()=>f,hy:()=>h,k0:()=>c,nu:()=>a,uI:()=>d,wx:()=>p});var n=r(16889),o=r(17842),i=r(90045),s=r(67077);const a=2.4;function c(e){return(0,o.Wz)(e*a)}function l(e){return(0,o.F2)(e)/a}function u(e,t,r,o){let{color:s,ratio:a}=t,{color:c,ratio:l}=r;if(l===a){const e=1e-6;1===l?a-=e:l+=e}const u=(0,n.uZ)((o-a)/(l-a),0,1);(0,i.l)(e,s.toArray(),c.toArray(),u)}function d(e){const t=new Uint8ClampedArray(2048);if(e=e.filter((e=>{let{ratio:t}=e;return t>=0&&t<=1})).sort(((e,t)=>e.ratio-t.ratio)).map((e=>{let{color:t,ratio:r}=e;return{color:t,ratio:Math.max(r,.001)}})),e.length<1)return t;let r=e[0],n=e[0],o=1;const i=(0,s.c)();for(let s=0;s<512;s++){const a=(s+.5)/512;for(;a>n.ratio&&o<e.length;)r=n,n=e[o++];u(i,r,n,a),t.set(i,4*s)}return t}function f(e,t,r,n){const{radius:i,fieldOffset:s,field:a}=t,c=Math.round((0,o.F2)(i)),l=new Float64Array(r*n);let u,d=Number.NEGATIVE_INFINITY;const f=function(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):r=>+r.readAttribute(e)+t:e=>1}(a,s),h=new Set;for(const o of e){const e=o.getCursor();for(;e.next();){const t=e.getObjectId();if(h.has(t))continue;h.add(t);const o=e.readLegacyPointGeometry(),i=128;if(o.x<-i||o.x>=r+i||o.y<-i||o.y>n+i)continue;const s=+f(e),a=Math.max(0,Math.round(o.x)-c),p=Math.max(0,Math.round(o.y)-c),m=Math.min(n,Math.round(o.y)+c),w=Math.min(r,Math.round(o.x)+c);for(let e=p;e<m;e++)for(let t=a;t<w;t++){const n=e*r+t,i=y(o.x-t,o.y-e,c);u=l[n]+=i*s,u>d&&(d=u)}}}return{matrix:l.buffer,max:d}}function h(e,t,r,o,i,s){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const a=e.getImageData(0,0,t,t);r&&o&&a.data.set(new Uint8ClampedArray(function(e,t,r,o,i){const s=new Uint32Array(e*e),a="buffer"in t?t:new Float64Array(t),c="buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer),l=c.length/(i-o);for(let u=0;u<a.length;u++){const e=a[u],t=Math.floor((e-o)*l);s[u]=c[(0,n.uZ)(t,0,c.length-1)]}return s.buffer}(t,r,o,i,s))),e.putImageData(a,0,0)}function y(e,t,r){const n=Math.sqrt(e**2+t**2)/r;return n>1?0:3/(Math.PI*r**2)*(1-n**2)**2}function p(e,t){return"function"==typeof e?e:e?"string"==typeof t?t=>-1*+t[e]:r=>+r[e]+t:()=>1}},81735:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(27366),o=r(41691),i=r(49861),s=(r(63780),r(93169),r(25243),r(69912));let a=class extends o.r{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,n._)([(0,i.Cb)({readOnly:!0})],a.prototype,"supportsTileUpdates",null),(0,n._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"remoteClient",void 0),(0,n._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"service",void 0),(0,n._)([(0,i.Cb)()],a.prototype,"spatialReference",null),(0,n._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"tileInfo",void 0),(0,n._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"tileStore",void 0),a=(0,n._)([(0,s.j)("esri.views.2d.layers.features.processors.BaseProcessor")],a);const c=a},63220:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r(27366),o=(r(93169),r(92026)),i=(r(32718),r(25243),r(63780),r(75366),r(69912)),s=r(48732),a=r(27811),c=r(94109),l=r(81735),u=r(35092);class d{constructor(e,t){this.offset=e,this.extent=t}}let f=class extends l.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&(0,s.Hg)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const n=this._tileKeyToFeatureSets.get(e.key.id);if((0,o.pC)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&n.set(t.addOrUpdate.instance,t),t.end){const t=[],n=function(e){const t=e.key,r=new Map,n=256,o=c.I_,i=e.tileInfoView.tileInfo.isWrappable;return r.set((0,u.M)(t,-1,-1,i).id,new d([-o,-o],[o-n,o-n,o,o])),r.set((0,u.M)(t,0,-1,i).id,new d([0,-o],[0,o-n,o,o])),r.set((0,u.M)(t,1,-1,i).id,new d([o,-o],[0,o-n,n,o])),r.set((0,u.M)(t,-1,0,i).id,new d([-o,0],[o-n,0,o,o])),r.set((0,u.M)(t,1,0,i).id,new d([o,0],[0,0,n,o])),r.set((0,u.M)(t,-1,1,i).id,new d([-o,o],[o-n,0,o,n])),r.set((0,u.M)(t,0,1,i).id,new d([0,o],[0,0,o,n])),r.set((0,u.M)(t,1,1,i).id,new d([o,o],[0,0,n,n])),r}(e);this._tileKeyToFeatureSets.forEach(((r,i)=>{if(i===e.key.id)r.forEach((e=>(0,o.yw)(e.addOrUpdate,(e=>t.push(e)))));else if(n.has(i)){const e=n.get(i),[s,a]=e.offset;r.forEach((e=>(0,o.yw)(e.addOrUpdate,(e=>{const r=e.transform(s,a,1,1);t.push(r)}))))}}));const i=(0,a.QM)(t,this._schema.mesh,512,512),s={tileKey:e.key.id,intensityInfo:i},l=[i.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",s,{...r,transferList:l})}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}};f=(0,n._)([(0,i.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const h=f},35092:(e,t,r)=>{r.d(t,{M:()=>n});r(67906);function n(e,t,r,n){const o=e.clone(),i=1<<o.level,s=o.col+t,a=o.row+r;return n&&s<0?(o.col=s+i,o.world-=1):s>=i?(o.col=s-i,o.world+=1):o.col=s,o.row=a,o}}}]);
//# sourceMappingURL=3220.4d5bb80a.chunk.js.map