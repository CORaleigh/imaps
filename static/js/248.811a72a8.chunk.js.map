{"version":3,"sources":["../node_modules/@arcgis/core/renderers/support/DictionaryLoader.js","../node_modules/@arcgis/core/symbols/CIMSymbol.js"],"names":["f","o","getLogger","h","type","lineSymbol","symbolLayers","width","color","y","constructor","e","t","s","this","config","fieldMap","url","_ongoingRequests","Map","_symbolCache","i","getSymbolFields","_symbolFields","_dictionaryPromise","fetchResources","b","n","attributes","a","c","l","toString","m","get","catch","pop","split","r","includes","substr","length","map","Number","toRgba","push","primitiveName","propertyName","value","_itemNames","has","u","geometry","hasZ","p","_cimPartsToCIMSymbol","put","error","abortOptions","responseType","query","data","Promise","all","expression","authoringInfo","_refSymbolUrlTemplate","cimRefTemplateUrl","Set","itemsNames","symbol","configuration","hasOwnProperty","name","fields","filter","spatialReference","then","scale","repurposeFeature","evaluate","$feature","$view","Array","_getSymbolPart","_combineSymbolParts","replace","set","delete","reject","unshift","callout","primitiveOverrides","enable","markerGraphics","super","readData","writeData","valueExpressionInfo","clone","hash","JSON","stringify","json","write","prototype","CIMSymbolReference","readOnly","d"],"mappings":"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","file":"static/js/248.811a72a8.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../Color.js\";import t from\"../../request.js\";import s from\"../../core/Error.js\";import o from\"../../core/Logger.js\";import i from\"../../core/LRUCache.js\";import{isSome as r}from\"../../core/maybe.js\";import{isAbortError as n}from\"../../core/promiseUtils.js\";import{numericHash as l}from\"../../core/string.js\";import{loadArcade as a,createDictionaryExpression as c}from\"../../support/arcadeOnDemand.js\";import m from\"../../symbols/CIMSymbol.js\";const f=o.getLogger(\"esri.renderers.support.DictionaryLoader\"),h={type:\"CIMSimpleLineCallout\",lineSymbol:{type:\"CIMLineSymbol\",symbolLayers:[{type:\"CIMSolidStroke\",width:.5,color:[0,0,0,255]}]}};class y{constructor(e,t,s){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new i(100),this.url=e,this.config=t,this.fieldMap=s}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,s){let o;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{o=await this._dictionaryPromise}catch(b){if(n(b))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const e of this._symbolFields){const s=this.fieldMap[e];if(s&&null!=t.attributes[s]){const o=\"\"+t.attributes[s];i[e]=o}else i[e]=\"\"}const a=o(i,s);if(!a||\"string\"!=typeof a)return null;const c=l(a).toString(),m=this._symbolCache.get(c);if(m)return m.catch((()=>{this._symbolCache.pop(c)})),m;const f=a.split(\";\"),h=[],y=[];for(const r of f)if(r)if(r.includes(\"po:\")){const t=r.substr(3).split(\"|\");if(3===t.length){const s=t[0],o=t[1];let i=t[2];if(\"DashTemplate\"===o)i=i.split(\" \").map((e=>Number(e)));else if(\"Color\"===o){const t=new e(i).toRgba();i=[t[0],t[1],t[2],255*t[3]]}else i=Number(i);y.push({primitiveName:s,propertyName:o,value:i})}}else if(r.includes(\"|\")){for(const e of r.split(\"|\"))if(this._itemNames.has(e)){h.push(e);break}}else this._itemNames.has(r)&&h.push(r);const u=!r(t.geometry)||!t.geometry.hasZ&&\"point\"===t.geometry.type,p=this._cimPartsToCIMSymbol(h,y,u,s);return this._symbolCache.put(c,p,1),p}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void f.error(\"no valid URL!\");const o=r(e)?e.abortOptions:null,i=t(this.url+\"/resources/styles/dictionary-info.json\",{responseType:\"json\",query:{f:\"json\"},...o}),[{data:n}]=await Promise.all([i,a()]);if(!n)throw this._dictionaryPromise=null,new s(\"esri.renderers.DictionaryRenderer\",\"Bad dictionary data!\");const l=n.expression,m=n.authoringInfo;this._refSymbolUrlTemplate=this.url+\"/\"+n.cimRefTemplateUrl,this._itemNames=new Set(n.itemsNames),this._symbolFields=m.symbol;const h={};if(this.config){const e=this.config;for(const t in e)h[t]=e[t]}if(m.configuration)for(const t of m.configuration)h.hasOwnProperty(t.name)||(h[t.name]=t.value);const y=[];if(r(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const s=this.fieldMap[t],o=e.fields.filter((e=>e.name===s));o.length>0&&y.push({...o[0],name:t})}return this._dictionaryPromise=c(l,r(e)?e.spatialReference:null,y,h).then((e=>{const t={scale:0};return(s,o)=>{const i=e.repurposeFeature({geometry:null,attributes:s});return t.scale=r(o)?o.scale:void 0,e.evaluate({$feature:i,$view:t})}})).catch((e=>(f.error(\"Creating dictinoary expression failed:\",e),null))),this._dictionaryPromise}async _cimPartsToCIMSymbol(e,t,s,o){const i=new Array(e.length);for(let l=0;l<e.length;l++)i[l]=this._getSymbolPart(e[l],o);const r=await Promise.all(i),n=this.fieldMap;for(const l of r)u(l,n);return new m({data:this._combineSymbolParts(r,t,s)})}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const o=this._refSymbolUrlTemplate.replace(/\\{itemName\\}/gi,e),i=t(o,{responseType:\"json\",query:{f:\"json\"},...s});this._ongoingRequests.set(e,i);try{return(await i).data}catch(r){return this._ongoingRequests.delete(e),Promise.reject(r)}}_combineSymbolParts(e,t,s){if(!e||0===e.length)return null;const o={...e[0]};if(e.length>1){o.symbolLayers=[];for(const t of e){const e=t;o.symbolLayers.unshift(...e.symbolLayers)}}return s&&(o.callout=h),{type:\"CIMSymbolReference\",symbol:o,primitiveOverrides:t}}}function u(e,t){if(!e)return;const s=e.symbolLayers;if(!s)return;let o=s.length;for(;o--;){const e=s[o];if(e&&!1!==e.enable&&\"CIMVectorMarker\"===e.type)p(e,t)}}function p(e,t){const s=e.markerGraphics;if(s)for(const o of s){if(!o)continue;const e=o.symbol;if(e)switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":u(e,t);break;case\"CIMTextSymbol\":e.fieldMap=t}}}export{y as DictionaryLoader};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../chunks/tslib.es6.js\";import{clone as o}from\"../core/lang.js\";import{numericHash as t}from\"../core/string.js\";import{property as e}from\"../core/accessorSupport/decorators/property.js\";import\"../core/accessorSupport/ensureType.js\";import{enumeration as s}from\"../core/accessorSupport/decorators/enumeration.js\";import{reader as a}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as p}from\"../core/accessorSupport/decorators/writer.js\";import{collectArcadeFieldNames as c}from\"../layers/support/fieldUtils.js\";import n from\"./Symbol.js\";var m;let l=m=class extends n{constructor(r){super(r),this.data=null,this.type=\"cim\"}readData(r,o){return o}writeData(r,o){if(r)for(const t in r)o[t]=r[t]}async collectRequiredFields(r,o){if(\"CIMSymbolReference\"===this.data.type){const t=this.data.primitiveOverrides;if(t){const e=t.map((t=>{const e=t.valueExpressionInfo;return c(r,o,e.expression)}));await Promise.all(e)}}}clone(){return new m({data:o(this.data)})}hash(){return t(JSON.stringify(this.data)).toString()}};r([e({json:{write:!1}})],l.prototype,\"color\",void 0),r([e({json:{write:!0}})],l.prototype,\"data\",void 0),r([a(\"data\",[\"symbol\"])],l.prototype,\"readData\",null),r([p(\"data\",{})],l.prototype,\"writeData\",null),r([s({CIMSymbolReference:\"cim\"},{readOnly:!0})],l.prototype,\"type\",void 0),l=m=r([i(\"esri.symbols.CIMSymbol\")],l);const d=l;export{d as default};\n"],"sourceRoot":""}