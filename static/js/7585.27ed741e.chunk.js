"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[7585],{47585:(e,t,l)=>{l.r(t),l.d(t,{default:()=>E});var a=l(72791),n=l(54901),r=l(64326),i=l(73937),o=l(81734),s=l(61524),d=l(91946),u=l(64128);let c,m;function h(e,t){return new Promise(((l,a)=>{(function(e){return new Promise(((t,l)=>{const a=new r.default({portalItem:{id:"318be24592ea4dcba042511b3125fd53"},layerId:2});m=a,a.load().then((l=>{const a=new r.default({source:[],fields:l.fields,geometryType:"point",spatialReference:e.spatialReference,popupTemplate:l.popupTemplate,objectIdField:l.objectIdField,displayField:l.displayField,id:"feature-table"});a.fields.forEach((e=>{e.nullable=!0,"DEED_DATE"===e.name&&(e.type="string")})),e.map.allTables.add(a),a.load().then((e=>{t(e)})).catch((e=>{console.log(e)}))}))}))})(t).then((a=>{var r;c=new n.Z({container:e,view:t,editingEnabled:!1,multiSortEnabled:!0,visibleElements:{selectionColumn:!1,menuItems:{refreshData:!1,toggleColumns:!1}},menuConfig:{items:[new s.Z({label:"Export",iconClass:"esri-icon-download",clickFunction:()=>{p(c)}})]},tableTemplate:f(a),layer:a}),null===(r=c)||void 0===r||r.when((()=>{l(c),function(e){e.findColumn("ADDRESS").width=150,e.findColumn("FEATURETYPE").width=150,setTimeout((()=>{const t=e.container.querySelector("vaadin-grid");null===t||void 0===t||t.addEventListener("click",(l=>{if("VAADIN-GRID-CELL-CONTENT"===l.target.nodeName){var a;e.highlightIds.removeAll();const n=(null===(a=t.getEventContext(l))||void 0===a?void 0:a.item).feature;e.highlightIds.add(n.getAttribute("OBJECTID"))}}))}),2e3)}(c),c.on("selection-change",(e=>{e.added.length&&c.layer.queryFeatures({objectIds:[e.added[0].feature.getObjectId()],returnGeometry:!0}).then((e=>{if(e.features.length){const l=e.features[0];l.setAttribute("type","address"),l.symbol=new d.Z({url:"assets/pin.svg",height:24,width:24}),(0,u.l)(t),t.graphics.add(l),t.goTo({target:l,zoom:18},{easing:"ease-in-out",duration:1e3})}}))}))}))}))}))}function f(e){return new o.Z({columnTemplates:[new i.Z({label:"Address",fieldName:"ADDRESS",editable:!1,initialSortPriority:0,direction:"asc"}),new i.Z({label:"Type",fieldName:"FEATURETYPE",editable:!1,initialSortPriority:1,direction:"asc"})]})}const p=e=>{e.layer.queryFeatures({where:"1=1",outFields:["*"],orderByFields:["ADDRESS","FEATURETYPE"]}).then((t=>{let l="";e.tableTemplate.columnTemplates.forEach((e=>{l+=`${e.label},`})),l+="\r\n",t.features.forEach((t=>{e.tableTemplate.columnTemplates.forEach((e=>{t.attributes[e.fieldName]?l+=`"${t.attributes[e.fieldName]}",`:l+='"",'})),l+="\r\n"}));let a=(new Date).toISOString();a=a.replaceAll(":","").replaceAll("-","");const n=`imaps_addresses_export_${a}.csv`,r=new Blob([l],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(r);i.setAttribute("href",e),i.setAttribute("download",n),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}))};var b=l(80184);function y(e){const t=(0,a.useRef)(),l=(0,a.useRef)(!1);return(0,a.useEffect)((()=>(l.current||(l.current=!0,h(t.current,e.view).then((t=>{!function(e,t){var l;t&&((0,u.l)(t.view),null===(l=m)||void 0===l||l.queryFeatures({geometry:e.geometry,outFields:["ADDRESS","FEATURETYPE"],returnGeometry:!0,where:"1=1"}).then((e=>{t.layer.queryFeatures({where:"1=1",returnGeometry:!0}).then((l=>{t.layer.applyEdits({deleteFeatures:l.features}).then((l=>{t.layer.applyEdits({addFeatures:e.features}).then((e=>{t.refresh()})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}))})))}(e.property,t)}))),()=>{})),[]),(0,b.jsx)("div",{id:"address-table",ref:t})}const E=a.memo(y)}}]);
//# sourceMappingURL=7585.27ed741e.chunk.js.map