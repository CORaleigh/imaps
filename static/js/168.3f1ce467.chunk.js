(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[168],{1040:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return E}));var s=i(81),r=(i(103),i(125)),o=i(120),a=i(87),n=i(85),c=i(110),h=i(83),l=(i(84),i(79),i(80),i(82)),p=i(478),d=i(582),v=i(790);class y{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-click"}}class b{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-double-click"}}class u{constructor(t,e,i,s,r,o,a,n,c,h){this.graphic=t,this.allGraphics=e,this.index=i,this.x=s,this.y=r,this.dx=o,this.dy=a,this.totalDx=n,this.totalDy=c,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move-start"}preventDefault(){this.defaultPrevented=!0}}class m{constructor(t,e,i,s,r,o,a,n,c,h){this.graphic=t,this.allGraphics=e,this.index=i,this.x=s,this.y=r,this.dx=o,this.dy=a,this.totalDx=n,this.totalDy=c,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move"}preventDefault(){this.defaultPrevented=!0}}class g{constructor(t,e,i,s,r,o,a,n,c,h){this.graphic=t,this.allGraphics=e,this.index=i,this.x=s,this.y=r,this.dx=o,this.dy=a,this.totalDx=n,this.totalDy=c,this.viewEvent=h,this.defaultPrevented=!1,this.type="graphic-move-stop"}preventDefault(){this.defaultPrevented=!0}}class _{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-over"}}class f{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-out"}}class O{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-down"}}class x{constructor(t,e,i,s,r){this.graphic=t,this.index=e,this.x=i,this.y=s,this.viewEvent=r,this.type="graphic-pointer-up"}}var G=i(412),j=i(705),w=i(477),k=i(235),S=i(183),M=i(172);let V=class extends r.a.EventedAccessor{constructor(t){super(t),this._activeGraphic=null,this._indicators=[],this._dragEvent=null,this._handles=new o.a,this._hoverGraphic=null,this._initialDragGeometry=null,this._viewHandles=new o.a,this._manipulators=[],this.type="graphic-mover",this.callbacks={onGraphicClick(){},onGraphicDoubleClick(){},onGraphicMoveStart(){},onGraphicMove(){},onGraphicMoveStop(){},onGraphicPointerOver(){},onGraphicPointerOut(){},onGraphicPointerDown(){},onGraphicPointerUp(){}},this.enableMoveAllGraphics=!1,this.graphics=[],this.indicatorsEnabled=!0,this.layer=new p.a({listMode:"hide",internal:!0,title:"GraphicMover highlight layer"}),this.view=null}initialize(){Object(v.a)(this.view,this.layer),this.refresh(),this._handles.add([Object(c.d)(this,["graphics","graphics.length"],(()=>this.refresh())),Object(c.j)(this,"view.ready",(()=>{this._viewHandles.add([this.view.on("immediate-click",(t=>this._clickHandler(t)),G.b.TOOL),this.view.on("double-click",(t=>this._doubleClickHandler(t)),G.b.TOOL),this.view.on("pointer-down",(t=>this._pointerDownHandler(t)),G.b.TOOL),this.view.on("pointer-move",(t=>this._pointerMoveHandler(t)),G.b.TOOL),this.view.on("pointer-up",(t=>this._pointerUpHandler(t)),G.b.TOOL),this.view.on("drag",(t=>this._dragHandler(t)),G.b.TOOL),this.view.on("key-down",(t=>this._keyDownHandler(t)),G.b.TOOL)])}))])}destroy(){var t;this._removeIndicators(),null==(t=this.view.map)||t.remove(this.layer),this.layer.destroy(),this.reset(),this._manipulators.forEach((t=>t.destroy())),this._manipulators=null,this._handles=Object(n.e)(this._handles),this._viewHandles=Object(n.e)(this._viewHandles)}get state(){const t=!!this.get("view.ready"),e=!!this.get("graphics.length"),i=this._activeGraphic;return t&&e?i?"moving":"active":t?"ready":"disabled"}refresh(){this._setUpIndicators(),this._setUpManipulators()}reset(){this._activeGraphic=null,this._hoverGraphic=null,this._dragEvent=null}updateGeometry(t,e){const i=this.graphics[t];i&&(i.set("geometry",e),this._setUpIndicators())}_clickHandler(t){const e=this._findTargetGraphic(Object(w.a)(t));if(e){const i=new y(e,this.graphics.indexOf(e),t.x,t.y,t);this.emit("graphic-click",i),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(i)}}_doubleClickHandler(t){const e=this._findTargetGraphic(Object(w.a)(t));if(e){const i=new b(e,this.graphics.indexOf(e),t.x,t.y,t);this.emit("graphic-double-click",i),this.callbacks.onGraphicDoubleClick&&this.callbacks.onGraphicDoubleClick(i)}}_pointerDownHandler(t){const e=this._findTargetGraphic(Object(w.a)(t));if(e){this._activeGraphic=e;const{x:i,y:s}=t,r=new O(e,this.graphics.indexOf(e),i,s,t);this.emit("graphic-pointer-down",r),this.callbacks.onGraphicPointerDown&&this.callbacks.onGraphicPointerDown(r)}else this._activeGraphic=null}_pointerUpHandler(t){if(this._activeGraphic){const{x:e,y:i}=t,s=this.graphics.indexOf(this._activeGraphic),r=new x(this._activeGraphic,s,e,i,t);this.emit("graphic-pointer-up",r),this.callbacks.onGraphicPointerUp&&this.callbacks.onGraphicPointerUp(r)}}_pointerMoveHandler(t){if(this._dragEvent)return;const e=this._findTargetGraphic(Object(w.a)(t));if(e){const{x:i,y:s}=t;if(this._hoverGraphic){if(this._hoverGraphic===e)return;const r=this.graphics.indexOf(this._hoverGraphic),o=new f(this.graphics[r],r,i,s,t);this._hoverGraphic=null,this.emit("graphic-pointer-out",o),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(o)}const r=this.graphics.indexOf(e),o=new _(e,r,i,s,t);return this._hoverGraphic=e,this.emit("graphic-pointer-over",o),void(this.callbacks.onGraphicPointerOver&&this.callbacks.onGraphicPointerOver(o))}if(this._hoverGraphic){const{x:e,y:i}=t,s=this.graphics.indexOf(this._hoverGraphic),r=new f(this.graphics[s],s,e,i,t);this._hoverGraphic=null,this.emit("graphic-pointer-out",r),this.callbacks.onGraphicPointerOut&&this.callbacks.onGraphicPointerOut(r)}}_dragHandler(t){if("start"!==t.action&&!this._dragEvent||!this._activeGraphic||!this._activeGraphic.geometry)return;"start"===t.action&&this._removeIndicators(),t.stopPropagation();const{action:e,x:i,y:s}=t,r=this.graphics.indexOf(this._activeGraphic),o=this._activeGraphic.geometry,n=this._dragEvent?i-this._dragEvent.x:0,c=this._dragEvent?s-this._dragEvent.y:0,h=i-t.origin.x,l=s-t.origin.y,p=Object(d.a)(o,n,c,this.view);if(this._activeGraphic.geometry=p,this.enableMoveAllGraphics&&this.graphics.forEach((t=>{t!==this._activeGraphic&&(t.geometry=Object(d.a)(t.geometry,n,c,this.view))})),this._dragEvent=t,"start"===e){this._initialDragGeometry=Object(a.a)(o);const e=new u(this._activeGraphic,this.graphics,r,i,s,n,c,h,l,t);this.emit("graphic-move-start",e),this.callbacks.onGraphicMoveStart&&this.callbacks.onGraphicMoveStart(e),e.defaultPrevented&&this._activeGraphic.set("geometry",o)}else if("update"===e){const e=new m(this._activeGraphic,this.graphics,r,i,s,n,c,h,l,t);this.emit("graphic-move",e),this.callbacks.onGraphicMove&&this.callbacks.onGraphicMove(e),e.defaultPrevented&&(this._activeGraphic.geometry=o)}else{const e=new g(this._activeGraphic,this.graphics,r,i,s,n,c,h,l,t);this._dragEvent=null,this._activeGraphic=null,this._setUpIndicators(),this.emit("graphic-move-stop",e),this.callbacks.onGraphicMoveStop&&this.callbacks.onGraphicMoveStop(e),e.defaultPrevented&&(this.graphics[r].set("geometry",this._initialDragGeometry),this._setUpIndicators()),this._initialDragGeometry=null}}_keyDownHandler(t){"a"!==t.key&&"d"!==t.key&&"n"!==t.key||"moving"!==this.state||t.stopPropagation()}_findTargetGraphic(t){let e=null,i=Number.MAX_VALUE;return this._manipulators.forEach((s=>{const r=s.intersectionDistance(t);Object(n.k)(r)&&r<i&&(i=r,e=s.graphic)})),e}_setUpManipulators(){const{graphics:t,view:e}=this;this._manipulators.forEach((t=>t.destroy())),this._manipulators=null!=t&&t.length?t.map((t=>new j.a({graphic:t,view:e}))):[]}_setUpIndicators(){var t;this._removeIndicators(),this.indicatorsEnabled&&(this._indicators=(null==(t=this.graphics)?void 0:t.map((t=>{const e=t.clone();return e.symbol=this._getSymbolForIndicator(t),e})))||[],this.layer.addMany(this._indicators))}_removeIndicators(){this._indicators.length&&(this.layer.removeMany(this._indicators),this._indicators.forEach((t=>t.destroy())),this._indicators=[])}_getSymbolForIndicator(t){if(Object(n.j)(t.symbol))return null;switch(t.symbol.type){case"cim":return new k.a({style:"circle",size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}});case"picture-marker":{const{xoffset:e,yoffset:i,height:s,width:r}=t.symbol,o=s===r?r:Math.max(s,r);return new k.a({xoffset:e,yoffset:i,size:o,style:"square",color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-marker":{const{xoffset:e,yoffset:i,size:s,style:r}=t.symbol;return new k.a({xoffset:e,yoffset:i,style:"circle"===r?"circle":"square",size:s+2,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}case"simple-fill":return new M.a({color:[0,0,0,0],outline:{style:"dash",color:[255,127,0,1],width:1}});case"simple-line":return new S.a({color:[255,127,0,1],style:"dash",width:1});case"text":{const{xoffset:e,yoffset:i}=t.symbol;return new k.a({xoffset:e,yoffset:i,size:12,color:[0,0,0,0],outline:{color:[255,127,0,1],width:1}})}default:return null}}};Object(s.a)([Object(h.b)()],V.prototype,"_activeGraphic",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],V.prototype,"type",void 0),Object(s.a)([Object(h.b)()],V.prototype,"callbacks",void 0),Object(s.a)([Object(h.b)()],V.prototype,"enableMoveAllGraphics",void 0),Object(s.a)([Object(h.b)()],V.prototype,"graphics",void 0),Object(s.a)([Object(h.b)()],V.prototype,"indicatorsEnabled",void 0),Object(s.a)([Object(h.b)()],V.prototype,"layer",void 0),Object(s.a)([Object(h.b)({readOnly:!0})],V.prototype,"state",null),Object(s.a)([Object(h.b)()],V.prototype,"view",void 0),V=Object(s.a)([Object(l.a)("esri.views.draw.support.GraphicMover")],V);var E=V},1227:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return N}));var s=i(81),r=(i(97),i(122)),o=i(106),a=i(88),n=i(125),c=i(120),h=i(80),l=i(85),p=i(91),d=i(110),v=i(83),y=(i(79),i(84),i(82)),b=i(301),u=i(478),m=i(235),g=i(890),_=i(582),f=i(1040),O=i(790),x=i(800),G=i(412),j=i(616),w=i(589),k=i(607),S=i(150),M=i(114);class V{constructor(t,e,i){this.graphic=t,this.mover=e,this.selected=i,this.type="reshape-start"}}class E{constructor(t,e,i){this.graphic=t,this.mover=e,this.selected=i,this.type="reshape"}}class C{constructor(t,e,i){this.graphic=t,this.mover=e,this.selected=i,this.type="reshape-stop"}}class I{constructor(t,e,i){this.mover=t,this.dx=e,this.dy=i,this.type="move-start"}}class D{constructor(t,e,i){this.mover=t,this.dx=e,this.dy=i,this.type="move"}}class H{constructor(t,e,i){this.mover=t,this.dx=e,this.dy=i,this.type="move-stop"}}class R{constructor(t){this.added=t,this.type="vertex-select"}}class P{constructor(t){this.removed=t,this.type="vertex-deselect"}}class T{constructor(t,e,i,s){this.added=t,this.graphic=e,this.oldGraphic=i,this.vertices=s,this.type="vertex-add"}}class U{constructor(t,e,i,s){this.removed=t,this.graphic=e,this.oldGraphic=i,this.vertices=s,this.type="vertex-remove"}}const z=x.b.reshapeGraphics,A={vertices:{default:new m.a({style:"circle",size:z.vertex.size,color:z.vertex.color,outline:{color:z.vertex.outlineColor,width:1}}),hover:new m.a({style:"circle",size:z.vertex.hoverSize,color:z.vertex.hoverColor,outline:{color:z.vertex.hoverOutlineColor,width:1}}),selected:new m.a({style:"circle",size:z.selected.size,color:z.selected.color,outline:{color:z.selected.outlineColor,width:1}})},midpoints:{default:new m.a({style:"circle",size:z.midpoint.size,color:z.midpoint.color,outline:{color:z.midpoint.outlineColor,width:1}}),hover:new m.a({style:"circle",size:z.midpoint.size,color:z.midpoint.color,outline:{color:z.midpoint.outlineColor,width:1}})}},F="esri.views.draw.support.Reshape",L=h.a.getLogger(F);let q=class extends n.a.EventedAccessor{constructor(t){super(t),this._activeOperationInfo=null,this._editGeometryOperations=null,this._handles=new c.a,this._graphicAttributes={esriSketchTool:"box"},this._mover=null,this._snappingTask=null,this._stagedVertex=null,this._viewHandles=new c.a,this.callbacks={onReshapeStart(){},onReshape(){},onReshapeStop(){},onMoveStart(){},onMove(){},onMoveStop(){},onGraphicClick(){}},this.enableMidpoints=!0,this.enableMovement=!0,this.enableVertices=!0,this.graphic=null,this.vertexGraphics=new o.a,this.layer=null,this.midpointGraphics=new o.a,this.midpointSymbol=new m.a({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),this.selectedVertices=[],this.snappingManager=null,this.type="reshape",this.view=null}initialize(){this._setup(),this._handles.add([Object(d.j)(this,"view.ready",(()=>{const{layer:t,view:e}=this;Object(O.a)(e,t),this._viewHandles.add([e.on("key-down",(t=>this._keyDownHandler(t)),G.b.TOOL)])})),Object(d.c)(this,"graphic",(()=>this.refresh())),Object(d.c)(this,"layer",((t,e)=>{e&&(this._clearSelection(),this._resetGraphics(e)),this.refresh()})),Object(d.c)(this,"enableMidpoints",(()=>{this.refresh()}))])}destroy(){var t;this._reset(),null==(t=this._mover)||t.destroy(),this._mover=null,this._handles=Object(l.e)(this._handles),this._viewHandles=Object(l.e)(this._viewHandles)}get state(){const t=!!this.get("view.ready"),e=!(!this.get("graphic")||!this.get("layer"));return t&&e?"active":t?"ready":"disabled"}set symbols(t){const{midpoints:e=A.midpoints,vertices:i=A.vertices}=t||{};this._set("symbols",{midpoints:e,vertices:i})}isUIGraphic(t){const e=[];return this.graphic&&e.push(this.graphic),e.concat(this.vertexGraphics.items,this.midpointGraphics.items),e.length&&e.includes(t)}refresh(){this._reset(),this._setup()}reset(){this.graphic=null}clearSelection(){this._clearSelection()}removeSelectedVertices(){this.selectedVertices.length&&this._removeVertices(this.selectedVertices)}_setup(){const{graphic:t,layer:e}=this;if(!e||!t||Object(l.j)(t.geometry))return;const i=t.geometry;"mesh"!==i.type&&"extent"!==i.type?(this._setupGraphics(),this._setupMover()):this._logGeometryTypeError()}_setUpGeometryHelper(){const t=this.graphic.geometry;if(Object(l.j)(t)||"mesh"===t.type||"extent"===t.type)return void this._logGeometryTypeError();const e="multipoint"===t.type?new S.a({paths:t.points,spatialReference:t.spatialReference}):t;this._editGeometryOperations=w.a.fromGeometry(e,2)}_saveSnappingContextForHandle(t,e){var i;this._snappingGraphicsLayer=new u.a({listMode:"hide",internal:!0,title:"Reshape snapping layer"}),this.view.map.layers.add(this._snappingGraphicsLayer),this._snappingContext=new k.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:(null==(i=e.viewEvent)?void 0:i.pointerType)||"mouse",excludeFeature:this.graphic,visualizer:new g.a(this._snappingGraphicsLayer),vertexHandle:this._getVertexFromEditGeometry(t)})}_reset(){this._clearSelection(),this._resetGraphics(),this._resetSnappingStateVars(),this._activeOperationInfo=null,this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}_resetSnappingStateVars(){Object(l.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),Object(l.k)(this._snappingGraphicsLayer)&&(this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy()),this._editGeometryOperations=Object(l.e)(this._editGeometryOperations),this._snappingTask=Object(l.a)(this._snappingTask),this._snappingTask=null,this._snappingContext=null,this._stagedVertex=null}_resetGraphics(t){this._removeMidpointGraphics(t),this._removeVertexGraphics(t),this._set("selectedVertices",[])}_removeMidpointGraphics(t){const e=t||this.layer;e&&e.removeMany(this.midpointGraphics.items),this.midpointGraphics.items.forEach((t=>t.destroy())),this.midpointGraphics.removeAll()}_removeVertexGraphics(t){const e=t||this.layer;e&&e.removeMany(this.vertexGraphics.items),this.vertexGraphics.items.forEach((t=>t.destroy())),this.vertexGraphics.removeAll()}_getCoordinatesForUI(t){const e=Object(b.b)(t.clone());if("polygon"===t.type)for(const i of e){const t=i[i.length-1];i[0][0]===t[0]&&i[0][1]===t[1]&&i.length>2&&i.pop()}return e}_setupGraphics(){const t=this.graphic.geometry;if(Object(l.k)(t)&&("polyline"===t.type||"polygon"===t.type)){const e=this._getCoordinatesForUI(t);this.enableMidpoints&&this._setUpMidpointGraphics(e),this.enableVertices&&this._setUpVertexGraphics(e)}}_setUpMidpointGraphics(t){this._removeMidpointGraphics();const e=this._createMidpointGraphics(t);this.midpointGraphics.addMany(e),this.layer.addMany(e)}_setUpVertexGraphics(t){this._removeVertexGraphics();const e=this._createVertexGraphics(t);this.vertexGraphics.addMany(e),this._storeRelatedVertexIndices(),this.layer.addMany(e)}_createVertexGraphics(t){const{_graphicAttributes:e,symbols:i,view:{spatialReference:s}}=this,o=[];return null==t||t.forEach(((t,a)=>{t.forEach(((t,n)=>{var c;const[h,l]=t;o.push(new r.a({geometry:new M.a({x:h,y:l,spatialReference:s}),symbol:null==i||null==(c=i.vertices)?void 0:c.default,attributes:{...e,pathIndex:a,pointIndex:n}}))}))})),o}_createMidpointGraphics(t){const{_graphicAttributes:e,symbols:i,view:{spatialReference:s}}=this,o=[];return null==t||t.forEach(((t,a)=>{t.forEach(((n,c)=>{const[h,p]=n,d=t[c+1]?c+1:0;if("polygon"===Object(l.i)(this.graphic.geometry,"type")||0!==d){const[n,l]=t[d],[v,y]=Object(b.d)([h,p],[n,l]);o.push(new r.a({geometry:new M.a({x:v,y:y,spatialReference:s}),symbol:i.midpoints.default,attributes:{...e,pathIndex:a,pointIndexStart:c,pointIndexEnd:d}}))}}))})),o}_storeRelatedVertexIndices(){const t=this.vertexGraphics.items;if(!t)return;const e=t.map((({geometry:t})=>({x:t.x,y:t.y})));for(let i=0;i<e.length;i++){const s=[];for(let t=0;t<e.length;t++){if(i===t)continue;const r=e[i],o=e[t];r.x===o.x&&r.y===o.y&&s.push(t)}t[i].attributes.relatedGraphicIndices=s}}_setupMover(){const{enableMovement:t,graphic:e,midpointGraphics:i,vertexGraphics:s,view:r}=this,o=Object(l.i)(e.geometry,"type"),a="point"===o||"multipoint"===o,n=s.concat(i).items;t&&n.push(e),this._mover=new f.default({enableMoveAllGraphics:!1,indicatorsEnabled:a,graphics:n,view:r,callbacks:{onGraphicClick:t=>this._onGraphicClickCallback(t),onGraphicMoveStart:t=>this._onGraphicMoveStartCallback(t),onGraphicMove:t=>this._onGraphicMoveCallback(t),onGraphicMoveStop:t=>this._onGraphicMoveStopCallback(t),onGraphicPointerOver:t=>this._onGraphicPointerOverCallback(t),onGraphicPointerOut:t=>this._onGraphicPointerOutCallback(t)}})}_onGraphicClickCallback(t){t.viewEvent.stopPropagation();const e=t.graphic;if(e===this.graphic)this.clearSelection(),this.emit("graphic-click",t),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(t);else if(this._isMidpoint(e)){if(2===t.viewEvent.button)return;const i=this.graphic.clone(),s=this._createVertexFromMidpoint(e);this.refresh(),this._emitVertexAddEvent([e],i,s)}else this._isVertex(e)&&(t.viewEvent.stopPropagation(),2===t.viewEvent.button?this._removeVertices(e):(t.viewEvent.native.shiftKey||this._clearSelection(),this.selectedVertices.includes(e)?this._removeFromSelection(e,!0):this._addToSelection(e)))}_setUpOperation(t){const{graphic:e,dx:i,dy:s}=t,r=e===this.graphic;this._resetSnappingStateVars(),this._setUpGeometryHelper(),this._saveSnappingContextForHandle(e,t),this._activeOperationInfo={target:this.graphic,mover:e,operationType:r?"move":"reshape",totalDx:i,totalDy:s}}_onGraphicMoveStartCallback(t){const e=t.graphic,{dx:i,dy:s}=t;if(e===this.graphic)return this._clearSelection(),this._resetGraphics(),this._setUpOperation(t),this._emitMoveStartEvent(i,s),void("point"===this._editGeometryOperations.data.type&&this._onHandleMove(e,i,s,t,(()=>this._emitMoveEvent(i,s))));if(!this.selectedVertices.includes(e)){if(this._clearSelection(),this._isMidpoint(e)){const t=this.graphic.clone(),i=this._createVertexFromMidpoint(e);this._emitVertexAddEvent([e],t,i)}this._addToSelection(e)}this._setUpOperation(t),this._emitReshapeStartEvent(e),this._onHandleMove(e,i,s,t,(()=>this._emitReshapeEvent(e)))}_onGraphicMoveCallback(t){const{graphic:e,dx:i,dy:s}=t;this._activeOperationInfo.totalDx+=i,this._activeOperationInfo.totalDy+=s;const{operationType:r}=this._activeOperationInfo;"move"===r?"point"===this._editGeometryOperations.data.type?this._onHandleMove(e,i,s,t,(()=>this._emitMoveEvent(i,s))):this._emitMoveEvent(i,s):this._onHandleMove(e,i,s,t,(()=>this._emitReshapeEvent(e)))}_onGraphicMoveStopCallback(t){const{graphic:e,dx:i,dy:s}=t;this._activeOperationInfo.totalDx+=i,this._activeOperationInfo.totalDy+=s,e===this.graphic?(this._emitMoveStopEvent(),this.refresh()):(this._onHandleMove(e,i,s,t,(()=>this._emitReshapeStopEvent(e))),this._resetSnappingStateVars(),this._activeOperationInfo=null,this._isMidpoint(e)&&this.refresh())}_updateMidpointGraphicLocations(t){for(const e of this.midpointGraphics){const{pathIndex:i,pointIndexStart:s,pointIndexEnd:r}=e.attributes,[o,a]=t[i][s],[n,c]=t[i][r],[h,l]=Object(b.d)([o,a],[n,c]);e.geometry=new M.a({x:h,y:l,spatialReference:this.view.spatialReference})}}_getIndicesForVertexGraphic({attributes:t}){return[(null==t?void 0:t.pathIndex)||0,(null==t?void 0:t.pointIndex)||0]}_getVertexFromEditGeometry(t){const[e,i]=this._getIndicesForVertexGraphic(t);return this._editGeometryOperations.data.components[e].vertices[i]}_onHandleMove(t,e,i,s,r){if(Object(l.a)(this._snappingTask),!this._snappingContext)return;const o=this.view.toMap({x:s.x,y:s.y}),a="graphic-move-stop"===s.type;if(Object(l.k)(this.snappingManager)&&this.selectedVertices.length<2&&!a){const s=this.snappingManager;this._stagedVertex=s.update(o,this._snappingContext),this._syncGeometryAfterVertexMove(t,new M.a(this._stagedVertex),e,i,a),r(),this._snappingTask=Object(p.h)((async n=>{const c=await s.snap(o,this._snappingContext,n);c.valid&&(this._stagedVertex=c.apply(),this._syncGeometryAfterVertexMove(t,new M.a(this._stagedVertex),e,i,a),r())}))}else{const s=Object(l.k)(this._stagedVertex)?new M.a(this._stagedVertex):o;this._syncGeometryAfterVertexMove(t,s,e,i,a),r()}}async _syncGeometryAfterVertexMove(t,e,i,s,r=!1){const o=this._editGeometryOperations.data.geometry;if("point"===o.type)t.geometry=e;else{const{x:a,y:n}=e,[c,h]=this._getIndicesForVertexGraphic(t);let l=Object(b.b)(o);const p=l[c].length-1;l[c][h]=[a,n],"polygon"===o.type&&(0===h?l[c][p]=[a,n]:h===p&&(l[c][0]=[a,n])),this._isVertex(t)&&(l=this._moveRelatedCoordinates(l,t,a,n),l=this._moveSelectedHandleCoordinates(l,t,i,s,"polygon"===o.type),this._updateMidpointGraphicLocations(l)),this.graphic.geometry=o.clone();const d=this._getVertexFromEditGeometry(t),v=a-d.pos[0],y=n-d.pos[1];this._editGeometryOperations.moveVertices([d],v,y,0),r&&(this._mover?this._mover.updateGeometry(this._mover.graphics.indexOf(t),e):t.geometry=e)}}_moveRelatedCoordinates(t,e,i,s){const{relatedGraphicIndices:r}=e.attributes;for(const o of r){const r=this.vertexGraphics.getItemAt(o),{pathIndex:a,pointIndex:n}=r.attributes;t[a][n]=[i,s],r.geometry=e.geometry}return t}_moveSelectedHandleCoordinates(t,e,i,s,r){for(const o of this.selectedVertices)if(o!==e){const{pathIndex:e,pointIndex:a,relatedGraphicIndices:n}=o.attributes,c=Object(_.a)(o.geometry,i,s,this.view),h=t[e].length-1;t[e][a]=[c.x,c.y],o.geometry=c,r&&(0===a?t[e][h]=[c.x,c.y]:a===h&&(t[e][0]=[c.x,c.y]));for(const i of n){const e=this.vertexGraphics.getItemAt(i),{pathIndex:s,pointIndex:r}=e.attributes;t[s][r]=[c.x,c.y],e.geometry=c}}return t}_onGraphicPointerOverCallback(t){const e=t.graphic;this._isVertex(e)&&!this._isSelected(e)&&(e.symbol=this.symbols.vertices.hover),this._updateHoverCursor(e)}_onGraphicPointerOutCallback(t){const e=t.graphic;this._isVertex(e)&&!this._isSelected(e)&&(e.symbol=this.symbols.vertices.default),this.view.cursor="default"}_createVertexFromMidpoint(t){const{_graphicAttributes:e,graphic:i}=this,s=i.geometry;if(Object(l.j)(s)||"polygon"!==s.type&&"polyline"!==s.type)return[];const r=s.clone(),o=[],{pathIndex:a,pointIndexStart:n,pointIndexEnd:c}=t.attributes,{x:h,y:p}=t.geometry,d=0===c?n+1:c,v=Object(b.b)(r);return v[a].splice(d,0,[h,p]),t.attributes={...e,pathIndex:a,pointIndex:d,relatedGraphicIndices:[]},o.push({coordinates:v[a][d],componentIndex:a,vertexIndex:d}),this.graphic.geometry=r,o}_addToSelection(t){t instanceof r.a&&(t=[t]);for(const e of t)e.symbol=this.symbols.vertices.selected;this._set("selectedVertices",this.selectedVertices.concat(t)),this._emitSelectEvent(t)}_removeFromSelection(t,e){const{vertices:i}=this.symbols,s=e?i.hover:i.default;t instanceof r.a&&(t=[t]);for(const r of t)this.selectedVertices.splice(this.selectedVertices.indexOf(r),1),this._set("selectedVertices",this.selectedVertices),r.set("symbol",s);this._emitDeselectEvent(t)}_clearSelection(){if(this.selectedVertices.length){const t=this.selectedVertices;for(const e of this.selectedVertices)e.set("symbol",this.symbols.vertices.default);this._set("selectedVertices",[]),this._emitDeselectEvent(t)}}_keyDownHandler(t){j.a.delete.includes(t.key)&&!t.repeat&&this.selectedVertices.length&&this._removeVertices(this.selectedVertices)}_removeVertices(t){const e=this.graphic.geometry;if(Object(l.j)(e)||"polygon"!==e.type&&"polyline"!==e.type)return;if("polygon"===e.type&&this.vertexGraphics.length<4||this.vertexGraphics.length<3)return;t instanceof r.a&&(t=[t]);const i=this.graphic.clone(),s=e.clone();let o=Object(b.b)(s);const a=[];t instanceof r.a&&(t=[t]);for(const r of t){const{x:t,y:e}=r.geometry;for(let i=0;i<o.length;i++){const s=o[i];for(let r=0;r<s.length;r++){const[n,c]=s[r];t===n&&e===c&&(a.push({coordinates:o[i][r],componentIndex:i,vertexIndex:r}),o[i].splice(Number(r),1))}}}if("polygon"===s.type)o=o.filter((t=>{if(t.length<2)return!1;const[e,i]=t[0],[s,r]=t[t.length-1];return(2!==t.length||e!==s||i!==r)&&(e===s&&i===r||t.push(t[0]),!0)})),s.rings=o;else{for(const t of o)1===t.length&&o.splice(o.indexOf(t),1);s.paths=o}this.graphic.geometry=s,this.refresh(),this._emitVertexRemoveEvent(t,i,a)}_isVertex(t){return this.vertexGraphics.includes(t)}_isSelected(t){return this._isVertex(t)&&this.selectedVertices.includes(t)}_isMidpoint(t){return this.midpointGraphics.includes(t)}_updateHoverCursor(t){this.view.cursor=this._isMidpoint(t)?"copy":"move"}_emitMoveStartEvent(t,e){const i=new I(this.graphic,t,e);this.emit("move-start",i),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(i)}_emitMoveEvent(t,e){const i=new D(this.graphic,t,e);this.emit("move",i),this.callbacks.onMove&&this.callbacks.onMove(i)}_emitMoveStopEvent(){const{totalDx:t,totalDy:e}=this._activeOperationInfo,i=new H(this.graphic,t,e);this.emit("move-stop",i),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(i)}_emitReshapeStartEvent(t){const e=new V(this.graphic,t,this.selectedVertices);this.emit("reshape-start",e),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(e)}_emitReshapeEvent(t){const e=new E(this.graphic,t,this.selectedVertices);this.emit("reshape",e),this.callbacks.onReshape&&this.callbacks.onReshape(e)}_emitReshapeStopEvent(t){const e=new C(this.graphic,t,this.selectedVertices);this.emit("reshape-stop",e),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(e)}_emitSelectEvent(t){const e=new R(t);this.emit("select",e),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(e)}_emitDeselectEvent(t){const e=new P(t);this.emit("deselect",e),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(e)}_emitVertexAddEvent(t,e,i){const s=new T(t,this.graphic,e,i);this.emit("vertex-add",s),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(s)}_emitVertexRemoveEvent(t,e,i){const s=new U(t,this.graphic,e,i);this.emit("vertex-remove",s),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(s)}_logGeometryTypeError(){L.error(new a.a("reshape:invalid-geometry","Reshape operation not supported for the provided graphic. The geometry type is not supported."))}};Object(s.a)([Object(v.b)()],q.prototype,"callbacks",void 0),Object(s.a)([Object(v.b)()],q.prototype,"enableMidpoints",void 0),Object(s.a)([Object(v.b)()],q.prototype,"enableMovement",void 0),Object(s.a)([Object(v.b)()],q.prototype,"enableVertices",void 0),Object(s.a)([Object(v.b)()],q.prototype,"graphic",void 0),Object(s.a)([Object(v.b)({readOnly:!0})],q.prototype,"vertexGraphics",void 0),Object(s.a)([Object(v.b)()],q.prototype,"layer",void 0),Object(s.a)([Object(v.b)({readOnly:!0})],q.prototype,"midpointGraphics",void 0),Object(s.a)([Object(v.b)()],q.prototype,"midpointSymbol",void 0),Object(s.a)([Object(v.b)({readOnly:!0})],q.prototype,"selectedVertices",void 0),Object(s.a)([Object(v.b)()],q.prototype,"snappingManager",void 0),Object(s.a)([Object(v.b)({readOnly:!0})],q.prototype,"state",null),Object(s.a)([Object(v.b)({value:A})],q.prototype,"symbols",null),Object(s.a)([Object(v.b)({readOnly:!0})],q.prototype,"type",void 0),Object(s.a)([Object(v.b)()],q.prototype,"view",void 0),q=Object(s.a)([Object(y.a)(F)],q);var N=q},546:function(t,e,i){"use strict";function s(t,e){return e?"xoffset"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):"yoffset"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function r(t,e){return"number"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,i=0;for(let s=0;s<t.length;s++){const r=t[s].size;"number"==typeof r&&(e+=r,i++)}return e/i}(t.stops):e}function o(t,e){if(!e)return t;const i=e.filter((t=>"size"===t.type)).map((e=>{const{maxSize:i,minSize:s}=e;return(r(i,t)+r(s,t))/2}));let s=0;const o=i.length;if(0===o)return t;for(let r=0;r<o;r++)s+=i[r];const a=Math.floor(s/o);return Math.max(a,t)}function a(t){const e=t&&t.renderer,i="touch"===(t&&t.event&&t.event.pointerType)?9:6;if(!e)return i;const r="visualVariables"in e?o(i,e.visualVariables):i;if("simple"===e.type)return s(r,e.symbol);if("unique-value"===e.type){let t=r;return e.uniqueValueInfos.forEach((e=>{t=s(t,e.symbol)})),t}if("class-breaks"===e.type){let t=r;return e.classBreakInfos.forEach((e=>{t=s(t,e.symbol)})),t}return e.type,r}i.d(e,"a",(function(){return a}))},568:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return c}));i(97);var s=i(85),r=i(116),o=i(546),a=i(99);function n(t,e,i,o=new a.a){let n;if("2d"===i.type)n=e*i.resolution;else if("3d"===i.type){const o=i.overlayPixelSizeInMapUnits(t),a=i.basemapSpatialReference;n=Object(s.k)(a)&&!a.equals(i.spatialReference)?Object(r.f)(a)/Object(r.f)(i.spatialReference):e*o}const c=t.x-n,h=t.y-n,l=t.x+n,p=t.y+n,{spatialReference:d}=i;return o.xmin=Math.min(c,l),o.ymin=Math.min(h,p),o.xmax=Math.max(c,l),o.ymax=Math.max(h,p),o.spatialReference=d,o}function c(t,e,i){const r=i.toMap(t);return!Object(s.j)(r)&&n(r,Object(o.a)(),i,h).intersects(e)}const h=new a.a},705:function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var s=i(81),r=i(96),o=i(125),a=i(85),n=i(100),c=i(83),h=(i(79),i(84),i(80),i(82)),l=i(136),p=i(111),d=i(105),v=i(187),y=i(362),b=i(262),u=i(300),m=i(568);let g=class extends r.a{constructor(t){super(t),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.events=new o.a.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}set graphic(t){this._circleCollisionCache=null,this._originalSymbol=t.symbol,this._set("graphic",t),this.attachSymbolChanged()}get elevationInfo(){const t="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,e=Object(y.f)(this.graphic),i=t?t.offset:0;return new u.a({mode:e,offset:i})}set focusedSymbol(t){t!==this._get("focusedSymbol")&&(this._set("focusedSymbol",t),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(t){t!==this._get("grabbing")&&(this._set("grabbing",t),this._updateGraphicSymbol())}set hovering(t){t!==this._get("hovering")&&(this._set("hovering",t),this._updateGraphicSymbol())}set selected(t){t!==this._get("selected")&&(this._set("selected",t),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:t?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(t){const e=this.graphic;if(!1===e.visible)return null;const i=e.geometry;if(Object(a.j)(i))return null;const s=this._get("focusedSymbol"),r=Object(a.k)(s)?s:e.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,t,i,r):this._intersectDistance3D(this.view,t,e)}attach(){this.attachSymbolChanged(),Object(a.k)(this.layer)&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(a.k)(this.layer)&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(t=>{Object(a.k)(t)&&t!==this.focusedSymbol&&t!==this._originalSymbol&&(this._originalSymbol=t,this._focused&&Object(a.k)(this.focusedSymbol)&&(this.graphic.symbol=this.focusedSymbol))}),!0)}detachSymbolChanged(){Object(a.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&Object(a.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,e,i,s){if(s=s||Object(b.h)(i),Object(a.j)(s))return null;let r=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==s.type)return Object(m.b)(e,i,t)?1:null;if(Object(a.j)(r)||!r.originalPoint.equals(i)){const e=i,o=t.spatialReference;if(Object(v.b)(e.spatialReference,o)){const t=Object(v.k)(e,o);r={originalPoint:e.clone(),mapPoint:t,radiusPx:Object(n.h)(s.size)},this._circleCollisionCache=r}}if(Object(a.k)(r)){const i=Object(n.j)(e,f),o=t.toScreen(r.mapPoint),a=r.radiusPx,c=o.x+Object(n.h)(s.xoffset),h=o.y-Object(n.h)(s.yoffset);return Object(l.j)(i,[c,h])<a*a?1:null}return null}_intersectDistance3D(t,e,i){const s=t.toMap(e,{include:[i]});return s&&Object(v.q)(s,_,t.renderSpatialReference)?Object(p.m)(_,t.state.camera.eye):null}};Object(s.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],g.prototype,"graphic",null),Object(s.a)([Object(c.b)({readOnly:!0})],g.prototype,"elevationInfo",null),Object(s.a)([Object(c.b)({constructOnly:!0,nonNullable:!0})],g.prototype,"view",void 0),Object(s.a)([Object(c.b)({value:null})],g.prototype,"focusedSymbol",null),Object(s.a)([Object(c.b)({constructOnly:!0})],g.prototype,"layer",void 0),Object(s.a)([Object(c.b)()],g.prototype,"interactive",void 0),Object(s.a)([Object(c.b)()],g.prototype,"selectable",void 0),Object(s.a)([Object(c.b)()],g.prototype,"grabbable",void 0),Object(s.a)([Object(c.b)({value:!1})],g.prototype,"grabbing",null),Object(s.a)([Object(c.b)()],g.prototype,"dragging",void 0),Object(s.a)([Object(c.b)()],g.prototype,"hovering",null),Object(s.a)([Object(c.b)({value:!1})],g.prototype,"selected",null),Object(s.a)([Object(c.b)()],g.prototype,"cursor",void 0),g=Object(s.a)([Object(h.a)("esri.views.interactive.GraphicManipulator")],g);const _=Object(d.e)(),f=Object(n.g)()}}]);
//# sourceMappingURL=168.3f1ce467.chunk.js.map