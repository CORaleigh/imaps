(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[109],{1124:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var r=i(79),s=i(131),n=i(81),a=(i(84),i(82),i(83),i(80));let o=class extends s.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const t=this.get("tileStore.tileScheme.spatialReference");return t&&t.toJSON()||null}};Object(r.a)([Object(n.b)({readOnly:!0})],o.prototype,"supportsTileUpdates",null),Object(r.a)([Object(n.b)({constructOnly:!0})],o.prototype,"remoteClient",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],o.prototype,"service",void 0),Object(r.a)([Object(n.b)()],o.prototype,"spatialReference",null),Object(r.a)([Object(n.b)({constructOnly:!0})],o.prototype,"tileInfo",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],o.prototype,"tileStore",void 0),o=Object(r.a)([Object(a.a)("esri.views.2d.layers.features.processors.BaseProcessor")],o);const l=o},1415:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return O}));var r=i(79),s=i(318),n=(i(88),i(82)),a=i(87),o=i(85),l=i(91),c=(i(83),i(84),i(174),i(80)),h=i(252),u=i(94),f=i(293),d=i(625),y=i(626),x=i(499),m=i(616),p=i(478),_=i(1124);class g{constructor(t){this._remoteClient=t,this._resourceMap=new Map,this._inFlightResourceMap=new Map}destroy(){}async fetchResource(t,e){const i=this._resourceMap,r=i.get(t);if(r)return r;let s=this._inFlightResourceMap.get(t);if(s)return s;try{s=this._remoteClient.invoke("tileRenderer.fetchResource",{url:t},{...e}),this._inFlightResourceMap.set(t,s),s.then((e=>(this._inFlightResourceMap.delete(t),i.set(t,e),e)))}catch(n){return Object(l.l)(n)?null:{width:0,height:0}}return s}getResource(t){var e;return null!=(e=this._resourceMap.get(t))?e:null}}function b(t,e){return(!t.minScale||t.minScale>=e)&&(!t.maxScale||t.maxScale<=e)}function v(t){const e=t.message,i={message:{data:{},tileKey:e.tileKey,tileKeyOrigin:e.tileKeyOrigin},transferList:new Array};for(const r in e.data){const t=e.data[r];if(i.message.data[r]=null,Object(o.l)(t)){const e=t.stride,s=t.indices.slice(0),n=t.vertices.slice(0),a=t.records.slice(0),l={stride:e,indices:s,vertices:n,records:a,metrics:Object(o.b)(t.metrics,(t=>t.slice(0)))};i.transferList.push(s,n,a),i.message.data[r]=l}}return i}a.a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let M=class extends _.a{constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new g(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(t){this._bufferIds.forEach((e=>{e.forEach(t)}))}async update(t,e){const i=e.schema.processors[0];if("symbol"!==i.type)return;const r=Object(h.a)(this._schema,i);Object(h.b)(r,"mesh")&&(Object(n.a)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",r),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=i,this._factory=this._createFactory(i),this._factory.update(i,this.tileStore.tileScheme.tileInfo))}onTileMessage(t,e,i,r){return Object(l.u)(r),this._onTileData(t,e,i,r)}onTileClear(t){return this._bufferData.delete(t.key.id),this._bufferIds.delete(t.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:{clear:!0}})}onTileError(t,e,i){const r=i.signal,s={tileKey:t.id,error:e};return this.remoteClient.invoke("tileRenderer.onTileError",s,{signal:r})}onTileUpdate(t){for(const e of t.removed)this._bufferData.has(e.key.id)&&this._bufferData.delete(e.key.id),this._bufferIds.has(e.key.id)&&this._bufferIds.delete(e.key.id);for(const e of t.added)this._bufferData.forEach((t=>{for(const i of t)i.message.tileKey===e.id&&this._updateTileMesh("append",e,v(i),[],!1,!1,null)}))}_addBufferData(t,e){this._bufferData.has(t)||this._bufferData.set(t,[]),this._bufferData.get(t).push(v(e))}_createFactory(t){const{geometryType:e,objectIdField:i,fields:r}=this.service,s={geometryType:e,fields:r,spatialReference:u.a.fromJSON(this.spatialReference)},n=new x.a(((t,e)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",t,e)),this.tileStore.tileScheme.tileInfo),{matcher:a,aggregateMatcher:l}=t.mesh;return this._store=n,this._matchers.feature=Object(m.a)(a,n,s,this._resourceManagerProxy),this._matchers.aggregate=Object(o.b)(l,(t=>Object(m.a)(t,n,s,this._resourceManagerProxy))),new y.a(e,i,n)}async _onTileData(t,e,i,r){Object(l.u)(r);const{type:s,addOrUpdate:n,remove:a}=e,c=e.end,h=!!this._schema.mesh.sortKey;if(!n){const e={type:s,addOrUpdate:null,remove:a,clear:!1,end:c,sort:h};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:e},r)}const u=this._processFeatures(t,n,i,r);try{const i=await u;if(Object(o.k)(i)){const e={type:s,addOrUpdate:null,remove:a,clear:!1,end:c,sort:h};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:e},r)}const n=[];for(const e of i){let i=!1;const r=e.message.bufferIds,s=t.key.id,a=e.message.tileKey;if(s!==a&&Object(o.l)(r)){if(!this.tileStore.get(a)){this._addBufferData(s,e),n.push(e);continue}let t=this._bufferIds.get(a);t||(t=new Set,this._bufferIds.set(a,t));const o=Array.from(r);for(const e of o){if(t.has(e)){i=!0;break}t.add(e)}}i||(this._addBufferData(s,e),n.push(e))}await Object(l.b)(n.map((i=>{const n=t.key.id===i.message.tileKey,a=n?e.remove:[],o=n&&e.end;return this._updateTileMesh(s,t,i,a,o,e.clear,r.signal)})))}catch(f){this._handleError(t,f,r)}}async _updateTileMesh(t,e,i,r,s,n,a){const c=t,h=i.message.tileKey,u=!!this._schema.mesh.sortKey;h!==e.key.id&&(s=!1);const f=Object(o.b)(i,(t=>t.message)),d=Object(o.b)(i,(t=>t.transferList))||[],y={type:c,addOrUpdate:f,remove:r,clear:!1,end:s,sort:u},x={transferList:Object(o.t)(d)||[],signal:a};return Object(l.u)(x),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:h,data:y},x)}async _processFeatures(t,e,i,r){if(Object(o.k)(e)||!e.hasFeatures)return null;const s={transform:t.transform,hasZ:!1,hasM:!1},n=this._factory,a={viewingMode:"",scale:t.scale},c=await this._matchers.feature,h=await this._matchers.aggregate;Object(l.u)(r);const u=this._getLabelInfos(t,e);return await n.analyze(e.getCursor(),this._resourceManagerProxy,c,h,s,a),Object(l.u)(r),this._writeFeatureSet(t,e,s,u,n,i)}_writeFeatureSet(t,e,i,r,s,n){const a=e.getSize(),l=new d.a(t.key.id,{features:a,records:a,metrics:0},this._schema.mesh.matcher.stride,n,!0),c={viewingMode:"",scale:t.scale},h=e.getCursor();for(;h.next();)try{const e=h.getDisplayId(),n=Object(o.l)(r)?r.get(e):null;s.writeCursor(l,h,i,c,t.level,n)}catch(f){}const u=t.tileInfoView.tileInfo.isWrappable;return l.serialize(u)}_handleError(t,e,i){if(!Object(l.l)(e)){const r={tileKey:t.id,error:e.message};return this.remoteClient.invoke("tileRenderer.onTileError",r,{signal:i.signal})}}_getLabelingSchemaForScale(t){const e=this._schema.mesh.labels;if(Object(o.k)(e))return null;if("subtype"===e.type){const i={type:"subtype",classes:{}};let r=!1;for(const s in e.classes){const n=e.classes[s].filter((e=>b(e,t.scale)));r=r||!!n.length,i.classes[s]=n}return r?i:null}const i=e.classes.filter((e=>b(e,t.scale)));return i.length?{type:"simple",classes:i}:null}_getLabels(t,e){if("subtype"===e.type){var i;const r=this.service.subtypeField,s=Object(o.v)(r,"Expected to find subtype Field"),n=t.readAttribute(s);return null==n?[]:null!=(i=e.classes[n])?i:[]}return e.classes}_getLabelInfos(t,e){const i=this._getLabelingSchemaForScale(t);if(Object(o.k)(i))return null;const r=new Map,n=e.getCursor();for(;n.next();){const t=n.getDisplayId(),e=[],a=Object(f.h)(t),o=a&&1!==n.readAttribute("cluster_count")?"aggregate":"feature",l=this._getLabels(n,i);for(const i of l){if(i.target!==o)continue;const r=n.getStorage(),l=a&&"feature"===o?r.getComputedStringAtIndex(n.readAttribute("referenceId"),i.fieldIndex):r.getComputedStringAtIndex(t,i.fieldIndex);if(!l)continue;const c=Object(s.a)(l.toString()),h=c[0],u=c[1];this._store.getMosaicItem(i.symbol,Object(p.a)(h)).then((t=>{e[i.index]={glyphs:t.glyphMosaicItems,rtl:u,index:i.index}}))}r.set(t,e)}return r}};M=Object(r.a)([Object(c.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],M);const O=M},145:function(t,e,i){"use strict";i.d(e,"a",(function(){return x})),i.d(e,"b",(function(){return y})),i.d(e,"c",(function(){return s})),i.d(e,"d",(function(){return C})),i.d(e,"e",(function(){return j})),i.d(e,"f",(function(){return o})),i.d(e,"g",(function(){return f})),i.d(e,"h",(function(){return z})),i.d(e,"i",(function(){return g})),i.d(e,"j",(function(){return v})),i.d(e,"k",(function(){return b})),i.d(e,"l",(function(){return m})),i.d(e,"m",(function(){return a})),i.d(e,"n",(function(){return _})),i.d(e,"o",(function(){return M})),i.d(e,"p",(function(){return O})),i.d(e,"q",(function(){return I})),i.d(e,"r",(function(){return S})),i.d(e,"s",(function(){return n})),i.d(e,"t",(function(){return w})),i.d(e,"u",(function(){return p})),i.d(e,"v",(function(){return d})),i.d(e,"w",(function(){return h})),i.d(e,"x",(function(){return u}));var r=i(176);function s(t,e){return t[0]=e[0],t[1]=e[1],t}function n(t,e,i){return t[0]=e,t[1]=i,t}function a(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function o(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function l(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function c(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function h(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function u(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function f(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function d(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function y(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function x(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function m(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function p(t){const e=t[0],i=t[1];return e*e+i*i}function _(t,e){return t[0]=-e[0],t[1]=-e[1],t}function g(t,e){const i=e[0],r=e[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t}function b(t,e){return t[0]*e[0]+t[1]*e[1]}function v(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function M(t,e,i,r){const s=e[0],n=e[1];return t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t}function O(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s,t[1]=i[1]*r+i[3]*s,t}function w(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[2]*s+i[4],t[1]=i[1]*r+i[3]*s+i[5],t}function S(t,e,i,r){const s=e[0]-i[0],n=e[1]-i[1],a=Math.sin(r),o=Math.cos(r);return t[0]=s*o-n*a+i[0],t[1]=s*a+n*o+i[1],t}function j(t,e){return t[0]===e[0]&&t[1]===e[1]}function I(t,e,i,r,s){let n=e[0]-i[0],a=e[1]-i[1];const o=(r[0]*n+r[1]*a)*(s-1);return n=r[0]*o,a=r[1]*o,t[0]=e[0]+n,t[1]=e[1]+a,t}const T=m,z=o,L=l,P=c,C=y,k=x,V=p;Object.freeze({__proto__:null,copy:s,set:n,add:a,subtract:o,multiply:l,divide:c,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:h,max:u,round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:f,scaleAndAdd:d,distance:y,squaredDistance:x,length:m,squaredLength:p,negate:_,inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:g,dot:b,cross:v,lerp:M,random:function(t,e){e=e||1;const i=2*Object(r.b)()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},transformMat2:O,transformMat2d:w,transformMat3:function(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[3]*s+i[6],t[1]=i[1]*r+i[4]*s+i[7],t},transformMat4:function(t,e,i){const r=e[0],s=e[1];return t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13],t},rotate:S,angle:function(t,e){const i=t[0],r=t[1],s=e[0],n=e[1];let a=i*i+r*r;a>0&&(a=1/Math.sqrt(a));let o=s*s+n*n;o>0&&(o=1/Math.sqrt(o));const l=(i*s+r*n)*a*o;return l>1?0:l<-1?Math.PI:Math.acos(l)},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:j,equals:function(t,e){const i=t[0],s=t[1],n=e[0],a=e[1];return Math.abs(i-n)<=r.a*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(s-a)<=r.a*Math.max(1,Math.abs(s),Math.abs(a))},projectAndScale:I,len:T,sub:z,mul:L,div:P,dist:C,sqrDist:k,sqrLen:V})},154:function(t,e,i){"use strict";i.d(e,"a",(function(){return d})),i.d(e,"b",(function(){return p})),i.d(e,"c",(function(){return x})),i.d(e,"d",(function(){return y})),i.d(e,"e",(function(){return l})),i.d(e,"f",(function(){return m})),i.d(e,"g",(function(){return a})),i.d(e,"h",(function(){return o}));var r=i(88),s=i(130),n=i(680);function a(t,e){switch(t){case s.d.FILL:return d.from(e);case s.d.LINE:return x.from(e);case s.d.MARKER:return y.from(e);case s.d.TEXT:return m.from(e);case s.d.LABEL:return p.from(e);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${t}`)}}function o(t){switch(l.load(t).geometryType){case s.d.MARKER:return new y(t);case s.d.FILL:return new d(t);case s.d.LINE:return new x(t);case s.d.TEXT:return new m(t);case s.d.LABEL:return new p(t)}}class l{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case s.d.FILL:return"fill";case s.d.MARKER:return"marker";case s.d.LINE:return"line";case s.d.TEXT:return"text";case s.d.LABEL:return"label";default:throw new r.a(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(t,e){const i=1<<t;e?this._data|=i:this._data&=~i}bit(t){return(this._data&1<<t)>>t}setBits(t,e,i){for(let r=e,s=0;r<i;r++,s++)this.setBit(r,0!=(t&1<<s))}bits(t,e){let i=0;for(let r=t,s=0;r<e;r++,s++)i|=this.bit(r)<<s;return i}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}l.shared=new l(0);const c=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,e){super.setVV(t,e);const i=function(t,e){const i=s.e.SIZE_FIELD_STOPS|s.e.SIZE_MINMAX_VALUE|s.e.SIZE_SCALE_STOPS|s.e.SIZE_UNIT_VALUE,r=(t&(s.f.FIELD_TARGETS_OUTLINE|s.f.MINMAX_TARGETS_OUTLINE|s.f.SCALE_TARGETS_OUTLINE|s.f.UNIT_TARGETS_OUTLINE))>>>4;return e.isOutline||e.isOutlinedFill?i&r:i&~r}(t,e)&t;this.vvSizeMinMaxValue=!!(i&s.e.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&s.e.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&s.e.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&s.e.SIZE_SCALE_STOPS)}},h=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,e){super.setVV(t,e),this.vvRotation=!e.isOutline&&!!(t&s.e.ROTATION)}},u=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,e){super.setVV(t,e),this.vvColor=!e.isOutline&&!!(t&s.e.COLOR)}},f=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,e){super.setVV(t,e),this.vvOpacity=!e.isOutline&&!!(t&s.e.OPACITY)}};class d extends(u(f(c(l)))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=s.d.FILL,e.dotDensity="dot-density"===t.stride.fill,e.simple="simple"===t.stride.fill,e.outlinedFill=t.isOutlinedFill,e.dotDensity||e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}get simple(){return!!this.bit(22)}set simple(t){this.setBit(22,t)}get outlinedFill(){return!!this.bit(21)}set outlinedFill(t){this.setBit(21,t)}}d.shared=new d(0);class y extends(u(f(h(c(l))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=s.d.MARKER,e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class x extends(u(f(c(l)))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=s.d.LINE,e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class m extends(u(f(h(c(l))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=s.d.TEXT,e.setVV(t.vvFlags,t),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0);class p extends(c(l)){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=s.d.LABEL,e.setVV(t.vvFlags,t),e.mapAligned=Object(n.a)(t.placement),e.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}p.shared=new p(0)},229:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return l})),i.d(e,"d",(function(){return h})),i.d(e,"e",(function(){return u})),i.d(e,"f",(function(){return c})),i.d(e,"g",(function(){return o})),i.d(e,"h",(function(){return n}));const r=0,s=100;function n(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function a(t,e){return Math.sqrt(t*t+e*e)}function o(t){const e=a(t[0],t[1]);t[0]/=e,t[1]/=e}function l(t,e){return a(t[0]-e[0],t[1]-e[1])}function c(t){return"function"==typeof t}function h(t=2){return 1/Math.max(t,1)}function u(t,e){return[!!t.minScale&&e.scaleToZoom(t.minScale)||r,!!t.maxScale&&e.scaleToZoom(t.maxScale)||s]}},235:function(t,e,i){"use strict";function r(){return new Float32Array(2)}function s(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function n(){return r()}function a(){return s(1,1)}function o(){return s(1,0)}function l(){return s(0,1)}i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return s}));const c=n(),h=a(),u=o(),f=l();Object.freeze({__proto__:null,create:r,clone:function(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},fromValues:s,createView:function(t,e){return new Float32Array(t,e,2)},zeros:n,ones:a,unitX:o,unitY:l,ZEROS:c,ONES:h,UNIT_X:u,UNIT_Y:f})},259:function(t,e,i){"use strict";i.d(e,"a",(function(){return _})),i.d(e,"b",(function(){return f})),i.d(e,"c",(function(){return d})),i.d(e,"d",(function(){return x})),i.d(e,"e",(function(){return y}));var r=i(102),s=i(88),n=i(91),a=i(100),o=i(172),l=i(275),c=i(82);const h={};function u(t,e,i){const r=e&&e.portal||o.a.getDefault();let n;const a=`${r.url} - ${r.user&&r.user.username} - ${t}`;return h[a]||(h[a]=function(t,e,i){return e.load(i).then((()=>{const r=new l.a({disableExtraQuery:!0,query:`owner:${m} AND type:${p} AND typekeywords:"${t}"`});return e.queryItems(r,i)})).then((({results:e})=>{let r=null;const n=t.toLowerCase();if(e&&Array.isArray(e))for(const t of e)if(t.typeKeywords.some((t=>t.toLowerCase()===n))&&t.type===p&&t.owner===m){r=t;break}if(!r)throw new s.a("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return r.load(i)}))}(t,r,i).then((t=>(n=t,t.fetchData()))).then((e=>({data:e,baseUrl:n.itemUrl,styleName:t})))),h[a]}function f(t,e,i){return t.styleUrl?async function(t,e){try{return{data:(await x(t,e)).data,baseUrl:Object(a.G)(t),styleUrl:t}}catch(i){return Object(n.t)(i),null}}(t.styleUrl,i):t.styleName?u(t.styleName,e,i):Promise.reject(new s.a("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function d(t){return null===t||"CIMSymbolReference"===t.type?t:{type:"CIMSymbolReference",symbol:t}}function y(t,e){if("cimRef"===e)return t.cimRef;if(t.formatInfos&&!Object(c.a)("enable-feature:force-wosr"))for(const i of t.formatInfos)if("gltf"===i.type)return i.href;return t.webRef}function x(t,e){const i={responseType:"json",query:{f:"json"},...e};return Object(r.default)(Object(a.D)(t),i)}const m="esri_en",p="Style",_="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},282:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var r=i(239);class s{constructor(t,e){this._storage=new r.c,this._storage.maxSize=t,e&&this._storage.registerRemoveFunc("",e)}put(t,e,i){this._storage.put(t,e,i,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}},302:function(t,e,i){"use strict";function r(t,e,i,r){return function(t){return"function"==typeof t}(t)?t(e,i,r):t}function s(t){return[t.r,t.g,t.b,t.a]}function n(t,e,i){const r=t=>{let e=t.length;for(;e--;)if(-1===" /-,\n".indexOf(t.charAt(e)))return!1;return!0},s=[];let n=0,o=-1;do{if(o=e.indexOf("[",n),o>=n){if(o>n){const t=e.substr(n,o-n);s.push([t,null,r(t)])}if(n=o+1,o=e.indexOf("]",n),o>=n){if(o>n){const i=t[e.substr(n,o-n)];i&&s.push([null,i,!1])}n=o+1}}}while(-1!==o);if(n<e.length-1){const t=e.substr(n);s.push([t,null,r(t)])}return t=>{let e="",r=null;for(const i of s){const[s,n,a]=i;if(s)a?r=s:(r&&(e+=r,r=null),e+=s);else{const i=t.attributes[n];i&&(r&&(e+=r,r=null),e+=i)}}return a(e,i)}}function a(t,e){switch("string"!=typeof t&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function o(t,e,i,r,s,n,a=!0){const o=e/s,l=i/n,c=Math.ceil(o/2),h=Math.ceil(l/2);for(let u=0;u<n;u++)for(let i=0;i<s;i++){const f=4*(i+(a?n-u-1:u)*s);let d=0,y=0,x=0,m=0,p=0,_=0,g=0;const b=(u+.5)*l;for(let r=Math.floor(u*l);r<(u+1)*l;r++){const s=Math.abs(b-(r+.5))/h,n=(i+.5)*o,a=s*s;for(let l=Math.floor(i*o);l<(i+1)*o;l++){let i=Math.abs(n-(l+.5))/c;const s=Math.sqrt(a+i*i);s>=-1&&s<=1&&(d=2*s*s*s-3*s*s+1,d>0&&(i=4*(l+r*e),g+=d*t[i+3],x+=d,t[i+3]<255&&(d=d*t[i+3]/250),m+=d*t[i],p+=d*t[i+1],_+=d*t[i+2],y+=d))}}r[f]=m/y,r[f+1]=p/y,r[f+2]=_/y,r[f+3]=g/x}}function l(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function c(t){var e;return null==(e=t.data)?void 0:e.symbol}function h(t){return"CIMVectorMarker"===t.type||"CIMPictureMarker"===t.type||"CIMBarChartMarker"===t.type||"CIMCharacterMarker"===t.type||"CIMPieChartMarker"===t.type||"CIMStackedBarChartMarker"===t.type}function u(t){return"CIMGradientStroke"===t.type||"CIMPictureStroke"===t.type||"CIMSolidStroke"===t.type}function f(t){return"CIMGradientFill"===t.type||"CIMHatchFill"===t.type||"CIMPictureFill"===t.type||"CIMSolidFill"===t.type||"CIMWaterFill"===t.type}function d(t){return"CIMMarkerPlacementAlongLineRandomSize"===t.type||"CIMMarkerPlacementAlongLineSameSize"===t.type||"CIMMarkerPlacementAlongLineVariableSize"===t.type||"CIMMarkerPlacementAtExtremities"===t.type||"CIMMarkerPlacementAtMeasuredUnits"===t.type||"CIMMarkerPlacementAtRatioPositions"===t.type||"CIMMarkerPlacementOnLine"===t.type||"CIMMarkerPlacementOnVertices"===t.type}i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"d",(function(){return r})),i.d(e,"e",(function(){return l})),i.d(e,"f",(function(){return x})),i.d(e,"g",(function(){return f})),i.d(e,"h",(function(){return h})),i.d(e,"i",(function(){return d})),i.d(e,"j",(function(){return u})),i.d(e,"k",(function(){return o})),i.d(e,"l",(function(){return c})),i.d(e,"m",(function(){return y}));const y=t=>t&&t.toLowerCase().replace(/\s+/g,"-"),x=t=>isNaN(t)||!t?0:t},330:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var r=i(85),s=i(496);class n{bindFeature(t,e,i){}write(t,e,i){var n;if(Object(r.k)(this._effects)||0===(null==(n=this._effects)?void 0:n.length))return this._write(t,e);const a=s.a.executeEffects(this._effects,e.readLegacyGeometryForDisplay());let o=s.a.next(a);for(;o;)this._write(t,e,o),o=s.a.next(a)}_write(t,e,i){}}},345:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return u})),i.d(e,"d",(function(){return s})),i.d(e,"e",(function(){return a})),i.d(e,"f",(function(){return o})),i.d(e,"g",(function(){return l})),i.d(e,"h",(function(){return c}));var r=i(176);function s(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function n(t,e){const i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],o=e[5];let l=i*n-r*s;return l?(l=1/l,t[0]=n*l,t[1]=-r*l,t[2]=-s*l,t[3]=i*l,t[4]=(s*o-n*a)*l,t[5]=(r*a-i*o)*l,t):null}function a(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=i[0],h=i[1],u=i[2],f=i[3],d=i[4],y=i[5];return t[0]=r*c+n*h,t[1]=s*c+a*h,t[2]=r*u+n*f,t[3]=s*u+a*f,t[4]=r*d+n*y+o,t[5]=s*d+a*y+l,t}function o(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=Math.sin(i),h=Math.cos(i);return t[0]=r*h+n*c,t[1]=s*h+a*c,t[2]=r*-c+n*h,t[3]=s*-c+a*h,t[4]=o,t[5]=l,t}function l(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r*c,t[1]=s*c,t[2]=n*h,t[3]=a*h,t[4]=o,t[5]=l,t}function c(t,e,i){const r=e[0],s=e[1],n=e[2],a=e[3],o=e[4],l=e[5],c=i[0],h=i[1];return t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=r*c+n*h+o,t[5]=s*c+a*h+l,t}function h(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function u(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function f(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}const d=a,y=f;Object.freeze({__proto__:null,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:s,set:function(t,e,i,r,s,n,a){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t},invert:n,determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:a,rotate:o,scale:l,translate:c,fromRotation:h,fromScaling:u,fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},subtract:f,multiplyScalar:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},multiplyScalarAndAdd:function(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},equals:function(t,e){const i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],l=t[5],c=e[0],h=e[1],u=e[2],f=e[3],d=e[4],y=e[5];return Math.abs(i-c)<=r.a*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-h)<=r.a*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-u)<=r.a*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-f)<=r.a*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-d)<=r.a*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(l-y)<=r.a*Math.max(1,Math.abs(l),Math.abs(y))},mul:d,sub:y})},349:function(t,e,i){"use strict";function r(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function s(t,e,i,r){const s=e[r],n=e[r+1];t[r]=i[0]*s+i[2]*n+i[4],t[r+1]=i[1]*s+i[3]*n+i[5]}function n(t,e,i,r=0,n=0,a=2){const o=n||e.length/a;for(let l=r;l<o;l++)s(t,e,i,l*a)}i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return n}));Object.freeze({__proto__:null,create:r,clone:function(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},fromValues:function(t,e,i,r,s,n){const a=new Float32Array(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=r,a[4]=s,a[5]=n,a},createView:function(t,e){return new Float32Array(t,e,6)},transform:s,transformMany:n})},368:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var r=i(88);function s(t,e){if(t&&"name"in t){const i=t;return e&&e.error(new r.a(i.name,i.message,i.details)),!1}return!0}},373:function(t,e,i){"use strict";i.d(e,"a",(function(){return _})),i.d(e,"b",(function(){return p}));var r=i(464),s=i(130),n=i(154);const a={marker:s.d.MARKER,fill:s.d.FILL,line:s.d.LINE,text:s.d.TEXT};class o{constructor(t,e,i,r){const s={minScale:null==e?void 0:e.minScale,maxScale:null==e?void 0:e.maxScale},o=function(t){return t.minScale||t.maxScale?t.minScale+"-"+t.maxScale:""}(s);this.layers=t,this.data=e,this.hash=this._createHash()+o,this.rendererKey=i;const l={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:i};for(const c of t){const t=a[c.type];c.materialKey=Object(n.g)(t,l),c.maxVVSize=r,c.scaleInfo=s,c.templateHash+=o}}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}var l=i(436),c=i(88),h=i(91),u=i(100),f=i(172),d=i(160),y=i(259);async function x(t,e,i){if(!t.name)return Promise.reject(new c.a("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(t.styleName&&"Esri2DPointSymbolsStyle"===t.styleName)return async function(t,e){const r=y.a.replace(/\{SymbolName\}/gi,t.name);try{const t=await Object(y.d)(r,e);return Object(y.c)(t.data)}catch(i){return Object(h.u)(i),null}}(t,i);try{return async function(t,e,i,r){const s=t.data,n={portal:i&&i.portal||f.a.getDefault(),url:Object(u.K)(t.baseUrl),origin:"portal-item"},a=s.items.find((t=>t.name===e));if(!a)throw new c.a("symbolstyleutils:symbol-name-not-found",`The symbol name '${e}' could not be found`,{symbolName:e});let o=Object(d.a)(Object(y.e)(a,"cimRef"),n);Object(l.b)()&&(o=Object(l.a)(o));try{const t=await Object(y.d)(o,r);return Object(y.c)(t.data)}catch(x){return Object(h.u)(x),null}}(await Object(y.b)(t,e,i),t.name,e,i)}catch(r){return Object(h.u)(r),null}}const m=async(t,e,i)=>new o(await Object(r.b)(t.data,e,i),t.data,t.rendererKey,t.maxVVSize),p=async(t,e,i,r)=>{if(!t)return null;if("cim"===t.type)return m(t,e,i);if("web-style"===t.type){const s={type:"cim",data:await x(t,null,r),rendererKey:t.rendererKey,maxVVSize:t.maxVVSize};return m(s,e,i)}return t};function _(t){if(!t)return null;const{type:e,cim:i,url:r,materialHash:s}=t,n={cim:i,type:e,mosaicHash:s,url:r,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(e){case"marker":n.size=t.size,n.path=t.path;break;case"line":n.dashTemplate=t.dashTemplate;break;case"text":n.text=t.text,n.fontName=t.fontName}return n}},398:function(t,e,i){"use strict";i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return n}));var r=i(113);function s(t,e,i=0){const s=Object(r.e)(t,0,l);for(let r=0;r<4;r++)e[i+r]=Math.floor(256*c(s*a[r]))}function n(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*o[r];return i}const a=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],l=n(new Uint8ClampedArray([255,255,255,255]));function c(t){return t-Math.floor(t)}},424:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));class r{constructor(t,e){this._pos=0;const i=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}get length(){return this._pos}_roundToNearest(t,e){const i=Math.round(t);return i+(e-i%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.25*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(e),r=new this._ctor(i);r.set(this._buffer,0),this._array=i,this._buffer=r,this._i16View=new Int16Array(this._array)}}ensureSize(t){this._ensureSize(t)}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}i1616Add(t,e,i){this._i16View[2*t]+=e,this._i16View[2*t+1]+=i}getValue(t){return this._buffer[t]}incr(t){if(this._buffer.length<t)throw new Error("Increment index overflows the target buffer");this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}writeManyFrom(t,e,i){this._ensureSize(i-e);for(let r=e;r!==i;r++)this.writeFixed(t._buffer[r])}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){const t=this._array,e=[];for(let i=0;i<t.byteLength/4;i++)e.push(t[i]);return e}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}},429:function(t,e,i){"use strict";i.d(e,"a",(function(){return h})),i.d(e,"b",(function(){return l})),i.d(e,"c",(function(){return c})),i.d(e,"d",(function(){return o}));Number.POSITIVE_INFINITY;const r=Math.PI,s=128/r,n=1/Math.LN2;function a(t,e){return(t%=e)>=0?t:t+e}function o(t){return a(t*s,256)}function l(t){return a(.7111111111111111*t,256)}function c(t){return Math.log(t)*n}function h(t,e,i){return t>=e&&t<=i||t>=i&&t<=e}},436:function(t,e,i){"use strict";function r(t){return t=t||globalThis.location.hostname,c.some((e=>{var i;return null!=(null==(i=t)?void 0:i.match(e))}))}function s(t,e){return t&&(e=e||globalThis.location.hostname)?null!=e.match(n)||null!=e.match(o)?t.replace("static.arcgis.com","staticdev.arcgis.com"):null!=e.match(a)||null!=e.match(l)?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return r}));const n=/^devext.arcgis.com$/,a=/^qaext.arcgis.com$/,o=/^[\w-]*\.mapsdevext.arcgis.com$/,l=/^[\w-]*\.mapsqa.arcgis.com$/,c=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,n,a,/^jsapps.esri.com$/,o,l]},447:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var r=i(88),s=i(87),n=i(350);function a(t,e,i,r,n){const a=t.referencesGeometry()&&n?l(e,r,n):e,o=t.repurposeFeature(a);try{return t.evaluate({...i,$feature:o})}catch(c){return s.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}const o=new Map;function l(t,e,i){const{transform:a,hasZ:l,hasM:c}=i;o.has(e)||o.set(e,function(t){const e={};switch(t){case"esriGeometryPoint":return(t,i,r,s)=>Object(n.e)(i,e,t,r,s);case"esriGeometryPolygon":return(t,i,r,s)=>Object(n.f)(i,e,t,r,s);case"esriGeometryPolyline":return(t,i,r,s)=>Object(n.g)(i,e,t,r,s);case"esriGeometryMultipoint":return(t,i,r,s)=>Object(n.d)(i,e,t,r,s);default:return s.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.a("mapview-arcade",`Unable to handle geometryType: ${t}`)),t=>t}}(e));const h=o.get(e)(t.geometry,a,l,c);return{...t,geometry:h}}},455:function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return l}));var r=i(151),s=i(82);let n=null,a=null;async function o(){return n||(n=async function(){const t=Object(s.a)("esri-csp-restrictions")?await Promise.all([i.e(159),i.e(258)]).then(i.bind(null,748)).then((t=>t.l)):await i.e(195).then(i.bind(null,749)).then((t=>t.l));a=await t.load({locateFile:()=>Object(r.a)("esri/core/libs/libtess/libtess.wasm")})}()),n}function l(t,e){const i=Math.max(t.length,128e3);return a.triangulate(t,e,i)}},478:function(t,e,i){"use strict";function r(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}i.d(e,"a",(function(){return r}))},493:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var r=i(318),s=i(101),n=i(292),a=i(220),o=i(115),l=i(161),c=i(154),h=i(229),u=i(494),f=i(330);class d extends(Object(u.a)(f.a)){constructor(t,e,i,r,a,h,u,f,d,y,x,m,p,_,g,b,v,M,O=!1,w,S){super(),this._xOffset=Object(s.g)(p),this._yOffset=Object(s.g)(_),this._decoration=y||"none",this._color=a,this._haloColor=h,this._haloSize=Math.min(Math.floor(5*Object(s.g)(Object(s.j)(i))),127),this._size=Math.min(Math.round(Object(s.g)(e)),127);const j=Math.min(Math.round(Object(s.g)(r||e)),127);this._referenceSize=Math.round(Math.sqrt(256*j)),this._scale=this._size/o.o,this._angle=m,this._justify=Object(n.d)(u||"center"),this._xAlignD=Object(n.e)(u||"center"),this._yAlignD=Object(n.g)(f||"baseline"),this._baseline="baseline"===(f||"baseline"),this._bitset=(1===d?1:0)|(x?1:0)<<1;const I=c.e.load(t);I.sdf=!0,this._materialKey=I.data,this._lineWidth=Object(s.g)(g)||512,this._lineHeight=b||1,this._textPlacement=v,this._effects=M,this._isCIM=O,this._minMaxZoom=Object(l.a)(Math.round(w*o.t),Math.round(S*o.t))}static fromText(t,e){const i=new d(t.materialKey,t.font.size,t.haloSize||0,t.font.size,t.color&&Object(a.d)(t.color)||0,t.haloColor&&Object(a.d)(t.haloColor)||0,t.horizontalAlignment,t.verticalAlignment,0,t.font.decoration,!1,t.angle||0,t.xoffset,t.yoffset,t.lineWidth,t.lineHeight,null,null,!1,h.b,h.a),[,s]=Object(r.a)(t.text);return i.bindTextInfo(e,s),i._vertexBoundsScale=t.maxVVSize?t.maxVVSize/t.font.size:1,i}static fromCIMText(t,e,i){const s=t.scaleFactor||1,n=t.size*t.sizeRatio*s,[o,l]=Object(h.e)(t.scaleInfo,i),c=new d(t.materialKey,n,t.outlineSize*t.sizeRatio,t.referenceSize,Object(a.c)(t.color),Object(a.c)(t.outlineColor),t.horizontalAlignment,t.verticalAlignment,t.alignment,t.decoration,t.colorLocked,t.angle,t.offsetX*t.sizeRatio*s,t.offsetY*t.sizeRatio*s,512,1,t.markerPlacement,t.effects,!0,o,l),[,u]=Object(r.a)(t.text);return c.bindTextInfo(e,u),c._vertexBoundsScale=t.maxVVSize?t.maxVVSize/n:1,c}}},494:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var r=i(85),s=i(101),n=i(180),a=i(495),o=i(115),l=i(130),c=i(161),h=i(154),u=i(355);const f=t=>class extends t{constructor(...t){super(...t),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=l.d.TEXT,this._aux=Object(c.b)(0,0,this._referenceSize,this._bitset)}bindTextInfo(t,e){t&&t.length?this._shapingInfo=Object(r.b)(t,(t=>Object(u.a)(t,e,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:o.r*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM}))):this._shapingInfo=null}_write(t,e,i){const r=e.getDisplayId();this._writeGeometry(t,e,r,i)}_writeGeometry(t,e,i,s){const a=this._shapingInfo;if(Object(r.k)(a))return;if(Object(r.l)(this._textPlacement)){const r=null!=s?s:e.readLegacyGeometryForDisplay();return this._writePlacedText(t,i,r,a)}const o=s?Object(n.p)(Object(n.d)(s),2):"esriGeometryPolygon"===e.geometryType?e.readCentroid():e.readGeometryForDisplay();if(!Object(r.k)(o)){if(o.isPoint){const[e,r]=o.coords;if(!t.hasAggregates&&t.hasPixelBufferEnabled&&(e<0||e>=512||r<0||r>=512))return;return this._writeGlyphs(t,i,{x:e,y:r},a)}o.forEachVertex(((e,r)=>this._writeGlyphs(t,i,{x:e,y:r},a)))}}_writePlacedText(t,e,i,n){const o=Object(r.t)(this._textPlacement),l=a.a.getPlacement(i,o,Object(s.g)(1));if(!l)return;let c=l.next();for(;null!=c;){const i=c.getAngle();n.setRotation(i);const r=c.tx,s=c.ty;r<0||r>=512||s<0||s>=512||(this._writeGlyphs(t,e,{x:r,y:s},n),n.setRotation(-i)),c=l.next()}}_writeGlyphs(t,e,i,r){const s=h.e.load(this._materialKey),n=Object(c.a)(Math.round(8*i.x),Math.round(8*i.y)),a=this._vertexBoundsScale,o=r.bounds,l=2*Math.max(o.width,o.height);for(const c of r.glyphs)s.textureBinding=c.textureBinding,t.recordStart(e,s.data,this.geometryType,!0),t.vertexBounds(i.x+o.x+this._xOffset,i.y+o.y-this._yOffset,l*a,l*a),this._writeVertices(t,e,n,c),t.recordEnd()}_writeGlyph(t,e,i,r,s){const n=h.e.load(this._materialKey),a=Object(c.a)(Math.round(8*i),Math.round(8*r));n.textureBinding=s.textureBinding,t.recordStart(e,n.data,this.geometryType,!0);const o=s.bounds,l=this._vertexBoundsScale;t.vertexBounds(i+o.x*l,r+o.y*l,o.width*l,o.height*l),this._writeVertices(t,e,a,s),t.recordEnd()}_writeVertices(t,e,i,r){const s=t.vertexCount();this._writeVertexCommon(t,e,i,r),t.vertexWrite(r.offsets.upperLeft),t.vertexWrite(r.texcoords.upperLeft),t.vertexEnd(),this._writeVertexCommon(t,e,i,r),t.vertexWrite(r.offsets.upperRight),t.vertexWrite(r.texcoords.upperRight),t.vertexEnd(),this._writeVertexCommon(t,e,i,r),t.vertexWrite(r.offsets.lowerLeft),t.vertexWrite(r.texcoords.lowerLeft),t.vertexEnd(),this._writeVertexCommon(t,e,i,r),t.vertexWrite(r.offsets.lowerRight),t.vertexWrite(r.texcoords.lowerRight),t.vertexEnd(),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}_writeVertexCommon(t,e,i,r){const s=this._color,n=this._haloColor,a=Object(c.b)(0,0,this._referenceSize,this._bitset),o=Object(c.b)(0,0,this._size,this._haloSize);t.vertexWrite(i),t.vertexWrite(e),t.vertexWrite(s),t.vertexWrite(n),t.vertexWrite(o),t.vertexWrite(a),t.vertexWrite(this._minMaxZoom)}}},495:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var r=i(141),s=i(407);class n{static getPlacement(t,e,i){const n=Object(s.b)(e);if(!n)return null;const a=Object(r.c)(t);return n.execute(a,e,i)}}},497:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var r=i(85),s=i(101),n=i(349),a=i(235),o=i(220),l=i(115),c=i(161),h=i(154),u=i(229),f=i(498),d=i(330);class y extends(Object(f.a)(d.a)){constructor(t,e,i,r,s,o,u,f,d,y,x,m,p,_,g,b,v,M,O,w,S,j,I){super(),this.angle=r,this.height=u,this.width=o,this.xOffset=e*O,this.yOffset=i*O,this._markerPlacement=w,this._effects=S,this._anchorX=.5-(.5+b)*g.width/g.width,this._anchorY=.5-(.5+v)*g.height/g.height,this._minMaxZoom=Object(c.a)(Math.round(j*l.t),Math.round(I*l.t));const T=(1===_?l.f:l.g)|(x?l.d:0)|(p?l.h:0)|(m?l.i:0),z=g&&g.sdf,L=h.d.load(t);L.sdf=z,L.pattern=!0,L.textureBinding=g.textureBinding,this._materialKey=L.data,this._fillColor=s,this._outlineColor=d,this._sizeOutlineWidth=Object(c.b)(Math.round(Math.min(Math.sqrt(128*o),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*f),255)));const P=g.rect.x+l.x,C=g.rect.y+l.x,k=P+g.width,V=C+g.height;this._offsets.xUpperLeft=P,this._offsets.yUpperLeft=C,this._offsets.xUpperRight=k,this._offsets.yUpperRight=C,this._offsets.xBottomLeft=P,this._offsets.yBottomLeft=V,this._offsets.xBottomRight=k,this._offsets.yBottomRight=V,this._texUpperLeft=Object(c.a)(P,C),this._texUpperRight=Object(c.a)(k,C),this._texBottomLeft=Object(c.a)(P,V),this._texBottomRight=Object(c.a)(k,V),o*=M,u*=M,o*=O,u*=O;const F=Math.round(64*M);this._bitestAndDistRatio=Object(c.a)(T,F),this._computedWidth=o,this._computedHeight=u;const E=Object(a.a)(),R=Object(n.a)();this._applyTransformation(R,E)}static fromCIMMarker(t,e,i){const n=e&&e.width||1,a=e&&e.height||1,l=t.size,c=n/a*t.scaleX,h=t.scaleSymbolsProportionally&&t.frameHeight?l/t.frameHeight:1;let f=Object(o.c)(t.color);const d=Object(o.c)(t.outlineColor),x=Object(s.g)(l),m=x*c,p=Object(s.g)(t.offsetX||0),_=Object(s.g)(t.offsetY||0),g=Object(s.g)(t.outlineWidth||0)*h,b=t.alignment||0,v=Object(s.g)(t.referenceSize),[M,O]=Object(u.e)(t.scaleInfo,i);e.sdf||0!==f||(f=-1);let w=t.rotation||0;t.rotateClockwise||(w=-w);let S=0,j=0;const I=t.anchorPoint;I&&(t.isAbsoluteAnchorPoint?l&&(S=-I.x/(l*c),j=I.y/l):(S=I.x,j=I.y));const T=new y(t.materialKey,p,_,w,f,m,x,v,d,g,t.colorLocked,t.scaleSymbolsProportionally,!1,b,e,S,j,t.sizeRatio,Object(r.u)(t.scaleFactor,1),t.markerPlacement,t.effects,M,O);return T._vertexBoundsScaleX=t.maxVVSize?t.maxVVSize/m:1,T._vertexBoundsScaleY=t.maxVVSize?t.maxVVSize/x:1,T}static fromPictureMarker(t,e){const i=Math.round(Object(s.g)(t.width)),r=Math.round(Object(s.g)(t.height)),n=l.w,a=Math.round(Object(s.g)(t.xoffset||0)),o=Math.round(Object(s.g)(t.yoffset||0)),c=new y(t.materialKey,a,o,t.angle,n,i,r,r,0,0,!1,!1,!1,0,e,0,0,1,1,null,null,u.b,u.a);return c._vertexBoundsScaleX=t.maxVVSize?t.maxVVSize/t.width:1,c._vertexBoundsScaleY=t.maxVVSize?t.maxVVSize/t.height:1,c}static fromSimpleMarker(t,e){const i=Object(o.d)(t.color),r=Math.round(Object(s.g)(t.size)),n=r,a=Math.round(Object(s.g)(t.xoffset||0)),l=Math.round(Object(s.g)(t.yoffset||0)),c=t.style,h=t.outline,f=0|(h&&h.color&&Object(o.d)(h.color)),d=0|(h&&h.width&&Math.round(Object(s.g)(h.width))),x=new y(t.materialKey,a,l,t.angle,i,r,n,n,f,d,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,e,0,0,126/64,1,null,null,u.b,u.a);return x.boundsType="esriSMSCircle"===c?"circle":"square",x._vertexBoundsScaleX=t.maxVVSize?t.maxVVSize/t.size:1,x._vertexBoundsScaleY=t.maxVVSize?t.maxVVSize/t.size:1,x}static fromLineSymbolMarker(t,e){const i=Object(o.d)(t.color),r=Math.round(Object(s.g)(6*t.lineWidth)),n=r,a="cross"===t.style||"x"===t.style;let l;switch(t.placement){case"begin-end":l="Both";break;case"begin":l="JustBegin";break;case"end":l="JustEnd";break;default:l="None"}const c={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:l,offsetAlongLine:0},h=new y(t.materialKey,0,0,0,i,r,n,n/6,i,a?Math.round(Object(s.g)(t.lineWidth)):0,!1,!1,a,1,e,0,0,126/64,1,c,null,u.b,u.a);return h.boundsType="circle"===t.style?"circle":"square",h}}},498:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var r=i(85),s=i(101),n=i(345),a=i(349),o=i(145),l=i(235),c=i(180),h=i(495),u=i(130),f=i(161);const d=3.14159265359/180,y=t=>class extends t{constructor(...t){super(...t),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=u.d.MARKER}_write(t,e,i){const r=e.getDisplayId();t.recordStart(r,this._materialKey,this.geometryType,!0),this._writeGeometry(t,e,r,i),t.recordEnd()}_writeGeometry(t,e,i,s){if(Object(r.l)(this._markerPlacement))return this._writePlacedMarkers(t,e,s);const n=s?Object(c.p)(Object(c.d)(s),2):"esriGeometryPolygon"===e.geometryType?e.readCentroid():e.readGeometryForDisplay();if(!Object(r.k)(n)){if(n.isPoint){const[e,r]=n.coords;if(!t.hasAggregates&&t.hasPixelBufferEnabled&&(e<0||e>=512||r<0||r>=512))return;return this._writeVertices(t,i,this._getPos(e,r),e,r)}n.forEachVertex(((e,r)=>this._writeVertices(t,i,this._getPos(e,r),e,r)))}}_writePlacedMarkers(t,e,i){const n=null!=i?i:e.readLegacyGeometryForDisplay(),o=h.a.getPlacement(n,Object(r.t)(this._markerPlacement),Object(s.g)(1));if(!o)return;const c=e.getDisplayId(),u=Object(l.a)(),f=Object(a.a)();let y=o.next();for(;null!=y;){const{tx:e,ty:i}=y;e>=-128&&e<=640&&i>=-128&&i<=640&&(this._applyTransformation(f,u,y.getAngle()/d),this._writeVertices(t,c,this._getPos(e,i),e,i)),y=o.next()}}_writeVertices(t,e,i,r,s){const n=t.vertexCount();t.vertexBounds(r+this.xOffset,s-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY),t.vertexWrite(i),t.vertexWrite(this._offsetUpperLeft),t.vertexWrite(this._texUpperLeft),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.vertexWrite(i),t.vertexWrite(this._offsetUpperRight),t.vertexWrite(this._texUpperRight),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.vertexWrite(i),t.vertexWrite(this._offsetBottomLeft),t.vertexWrite(this._texBottomLeft),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.vertexWrite(i),t.vertexWrite(this._offsetBottomRight),t.vertexWrite(this._texBottomRight),t.vertexWrite(this._bitestAndDistRatio),t.vertexWrite(e),t.vertexWrite(this._fillColor),t.vertexWrite(this._outlineColor),t.vertexWrite(this._sizeOutlineWidth),t.vertexWrite(this._minMaxZoom),t.vertexEnd(),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}_applyTransformation(t,e,i=0){Object(n.d)(t),Object(n.h)(t,t,Object(l.b)(this.xOffset,-this.yOffset)),this.angle+i!==0&&Object(n.f)(t,t,d*(this.angle+i));const r=this._computedWidth,s=this._computedHeight,a=(this._anchorX-.5)*r,c=(this._anchorY-.5)*s;Object(o.s)(e,a,c),Object(o.t)(e,e,t),this._offsetUpperLeft=Object(f.a)(16*e[0],16*e[1]),this._offsets.xUpperLeft=e[0],this._offsets.yUpperLeft=e[1],Object(o.s)(e,a+r,c),Object(o.t)(e,e,t),this._offsetUpperRight=Object(f.a)(16*e[0],16*e[1]),this._offsets.xUpperRight=e[0],this._offsets.yUpperRight=e[1],Object(o.s)(e,a,c+s),Object(o.t)(e,e,t),this._offsetBottomLeft=Object(f.a)(16*e[0],16*e[1]),this._offsets.xBottomLeft=e[0],this._offsets.yBottomLeft=e[1],Object(o.s)(e,a+r,c+s),Object(o.t)(e,e,t),this._offsetBottomRight=Object(f.a)(16*e[0],16*e[1]),this._offsets.xBottomRight=e[0],this._offsets.yBottomRight=e[1]}_getPos(t,e){return Object(f.a)(Math.round(8*t),Math.round(8*e))}}},499:function(t,e,i){"use strict";i.d(e,"a",(function(){return Wt})),i.d(e,"b",(function(){return At}));var r=i(88),s=i(87),n=i(91),a=i(274),o=i(130),l=i(154),c=i(101),h=i(220),u=i(115),f=i(429),d=i(161),y=i(229),x=i(85),m=i(180),p=(i(558),i(455)),_=i(188),g=i(587);function b(t,e,i,r,s,n,a){K=0;const o=(r-i)*n,l=s&&s.length,c=l?(s[0]-i)*n:o;let h,u,f,d,y,x=v(e,i,r,0,c,n,!0);if(x&&x.next!==x.prev){if(l&&(x=function(t,e,i,r,s,n){const a=new Array;for(let o=0,l=r.length;o<l;o++){const s=v(t,e,i,r[o]*n,o<l-1?r[o+1]*n:i*n,n,!1);s===s.next&&(s.steiner=!0),a.push(T(s))}a.sort(R);for(const o of a)z(o,s),s=M(s,s.next);return s}(e,i,r,s,x,n)),o>80*n){h=f=e[0+i*n],u=d=e[1+i*n];for(let t=n;t<c;t+=n){const r=e[t+i*n],s=e[t+1+i*n];h=Math.min(h,r),u=Math.min(u,s),f=Math.max(f,r),d=Math.max(d,s)}y=Math.max(f-h,d-u),y=0!==y?1/y:0}O(x,t,n,h,u,y,a,0)}}function v(t,e,i,r,s,n,a){let o;if(a===function(t,e,i,r,s,n){let a=0;for(let o=r,l=s-n;o<s;o+=n)a+=(t[l+e*n]-t[o+e*n])*(t[o+1+e*n]+t[l+1+e*n]),l=o;return a}(t,e,0,r,s,n)>0)for(let l=r;l<s;l+=n)o=j(l+e*n,t[l+e*n],t[l+1+e*n],o);else for(let l=s-n;l>=r;l-=n)o=j(l+e*n,t[l+e*n],t[l+1+e*n],o);return o&&E(o,o.next)&&(I(o),o=o.next),o}function M(t,e=t){if(!t)return t;let i,r=t;do{if(i=!1,r.steiner||!E(r,r.next)&&0!==P(r.prev,r,r.next))r=r.next;else{if(I(r),r=e=r.prev,r===r.next)break;i=!0}}while(i||r!==e);return e}function O(t,e,i,r,s,n,a,o){if(!t)return;!o&&n&&(t=L(t,r,s,n));let l=t;for(;t.prev!==t.next;){const c=t.prev,h=t.next;if(n?S(t,r,s,n):w(t))e.push(c.index/i+a),e.push(t.index/i+a),e.push(h.index/i+a),I(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?O(t=A(t,e,i,a),e,i,r,s,n,a,2):2===o&&W(t,e,i,r,s,n,a):O(M(t),e,i,r,s,n,a,1);break}}}function w(t){const e=t.prev,i=t,r=t.next;if(P(e,i,r)>=0)return!1;let s=t.next.next;const n=s;let a=0;for(;s!==t.prev&&(0===a||s!==n);){if(a++,k(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&P(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function S(t,e,i,r){const s=t.prev,n=t,a=t.next;if(P(s,n,a)>=0)return!1;const o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,c=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,h=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,u=F(o,l,e,i,r),f=F(c,h,e,i,r);let d=t.prevZ,y=t.nextZ;for(;d&&d.z>=u&&y&&y.z<=f;){if(d!==t.prev&&d!==t.next&&k(s.x,s.y,n.x,n.y,a.x,a.y,d.x,d.y)&&P(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,y!==t.prev&&y!==t.next&&k(s.x,s.y,n.x,n.y,a.x,a.y,y.x,y.y)&&P(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&k(s.x,s.y,n.x,n.y,a.x,a.y,d.x,d.y)&&P(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;y&&y.z<=f;){if(y!==t.prev&&y!==t.next&&k(s.x,s.y,n.x,n.y,a.x,a.y,y.x,y.y)&&P(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function j(t,e,i,r){const s=N.create(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function I(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function T(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function z(t,e){if(e=function(t,e){let i=e;const r=t.x,s=t.y;let n,a=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const t=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=r&&t>a){if(a=t,t===r){if(s===i.y)return i;if(s===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(r===a)return n.prev;const o=n,l=n.x,c=n.y;let h,u=1/0;for(i=n.next;i!==o;)r>=i.x&&i.x>=l&&r!==i.x&&k(s<c?r:a,s,l,c,s<c?a:r,s,i.x,i.y)&&(h=Math.abs(s-i.y)/(r-i.x),(h<u||h===u&&i.x>n.x)&&V(i,t)&&(n=i,u=h)),i=i.next;return n}(t,e)){const i=D(e,t);M(i,i.next)}}function L(t,e,i,r){for(let s;s!==t;s=s.next){if(s=s||t,null===s.z&&(s.z=F(s.x,s.y,e,i,r)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,L(t,e,i,r);s.prevZ=s.prev,s.nextZ=s.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,i=1;for(;;){let r,s=t;t=null,e=null;let n=0;for(;s;){n++,r=s;let a=0;for(;a<i&&r;a++)r=r.nextZ;let o=i;for(;a>0||o>0&&r;){let i;0===a?(i=r,r=r.nextZ,o--):0!==o&&r?s.z<=r.z?(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}s=r}if(e.nextZ=null,i*=2,n<2)return t}}(t)}function P(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function C(t,e,i,r){return!!(E(t,e)&&E(i,r)||E(t,r)&&E(i,e))||P(t,e,i)>0!=P(t,e,r)>0&&P(i,r,t)>0!=P(i,r,e)>0}function k(t,e,i,r,s,n,a,o){return(s-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0}function V(t,e){return P(t.prev,t,t.next)<0?P(t,e,t.next)>=0&&P(t,t.prev,e)>=0:P(t,e,t.prev)<0||P(t,t.next,e)<0}function F(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function E(t,e){return t.x===e.x&&t.y===e.y}function R(t,e){return t.x-e.x}function A(t,e,i,r){let s=t;do{const n=s.prev,a=s.next.next;!E(n,a)&&C(n,s,s.next,a)&&V(n,a)&&V(a,n)&&(e.push(n.index/i+r),e.push(s.index/i+r),e.push(a.index/i+r),I(s),I(s.next),s=t=a),s=s.next}while(s!==t);return s}function W(t,e,i,r,s,n,a){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.index!==t.index&&B(o,t)){let l=D(o,t);return o=M(o,o.next),l=M(l,l.next),O(o,e,i,r,s,n,a,0),void O(l,e,i,r,s,n,a,0)}t=t.next}o=o.next}while(o!==t)}function B(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&C(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&V(t,e)&&V(e,t)&&function(t,e){let i=t,r=!1;const s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function D(t,e){const i=N.create(t.index,t.x,t.y),r=N.create(e.index,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}class N{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const r=K<Z.length?Z[K++]:new N;return r.index=t,r.x=e,r.y=i,r.prev=null,r.next=null,r.z=null,r.prevZ=null,r.nextZ=null,r.steiner=!1,r}}const Z=new Array;let K=0;for(let Dt=0;Dt<8096;Dt++)Z.push(new N);const G=new g.b(0,0,0,1,0),q=new g.b(0,0,0,1,0);function U(t,e,i){let r=0;for(let s=1;s<i;s++){const i=t[2*(e+s-1)],n=t[2*(e+s-1)+1];r+=(t[2*(e+s)]-i)*(t[2*(e+s)+1]+n)}return r}function X(t,e,i,r,s){let n=0;for(let a=i;a<r;a+=3){const i=2*(t.getValue(a)-s),r=2*(t.getValue(a+1)-s),o=2*(t.getValue(a+2)-s);n+=Math.abs((e[i]-e[o])*(e[r+1]-e[i+1])-(e[i]-e[r])*(e[o+1]-e[i+1]))}return n}G.setExtent(u.L),q.setExtent(u.L);var Y=i(159),H=i(588);const $=16,Q=t=>class extends t{constructor(...t){super(...t),this.tessellationProperties={},this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},this.geometryType=o.d.LINE}writeGeometry(t,e,i,r){this._writeGeometry(t,e,i,r)}_initializeTessellator(t){const e=l.c.load(this._materialKey),i=l.a.load(this._materialKey),r=this._tessellationOptions,s=e.vvSizeFieldStops||e.vvSizeMinMaxValue||e.vvSizeScaleStops||e.vvSizeUnitValue,n=this.tessellationProperties._halfWidth<u.K&&!t&&!s;this.tessellationProperties.minMaxZoom=this._minMaxZoom,r.wrapDistance=65535,r.textured=this._isDashed||this._hasPattern,r.offset=this.tessellationProperties.offset,r.halfWidth=this.tessellationProperties._halfWidth;const a=n?0:1,o=i.outlinedFill?tt:J;this._lineTessellator=new H.a(o(this.tessellationProperties,a,a),et(this.tessellationProperties),n)}_write(t,e,i){const r="esriGeometryPoint"===e.geometryType;t.recordStart(e.getDisplayId(),this._materialKey,this.geometryType,r),this._writeGeometry(t,e,i,r),t.recordEnd()}_writeGeometry(t,e,i,r){const s=null!=i?i:e.readLegacyGeometryForDisplay(),n=this._getLines(s,r);Object(x.k)(n)||this._writeVertices(t,e,n)}_getLines(t,e){if(Object(x.k)(t))return null;const i=t.paths||t.rings;return Object(x.k)(i)?null:function(t,e){q.setPixelMargin(e);const i=q,r=-e,s=u.L+e;let n=[],a=!1,o=0;for(;o<t.length;){const e=[],l=t[o];if(!l)return null;i.reset(2);let[c,h]=l[0];if(a)i.moveTo(c,h);else{if(c<r||c>s||h<r||h>s){a=!0;continue}e.push({x:c,y:h})}let u=!1;const f=l.length;for(let t=1;t<f;++t)if(c+=l[t][0],h+=l[t][1],a)i.lineTo(c,h);else{if(c<r||c>s||h<r||h>s){u=!0;break}e.push({x:c,y:h})}if(u)a=!0;else{if(a){const t=i.resultWithStarts();if(t)for(const e of t)n.push(e)}else n.push({line:e,start:0});o++,a=!1}}return n=n.filter((t=>t.line.length>1)),0===n.length?null:n}(i,e?256:16)}_writeVertices(t,e,i){const r=e.getDisplayId(),s=t.vertexCount(),n=this.tessellationProperties,a=this._tessellationOptions;n.out=t,n.id=r,n.indexCount=0,n.vertexCount=0,n.offset=s,a.capType=this._capType,a.joinType=this._joinType;const o=l.a.load(this._materialKey);this.tessellationProperties.key=o.outlinedFill?o:l.c.load(this._materialKey);for(const{line:l,start:c}of i)a.initialDistance=c%65535,this._lineTessellator.tessellate(l,a)}},J=(t,e,i)=>(r,s,n,a,o,l,c,h,u,f,y)=>{const x=Object(d.a)(y,Math.ceil($*t._halfWidth)),m=Object(d.b)(Math.round($*c),Math.round($*h),Math.round($*u),Math.round($*f)),p=Object(d.b)($*o,$*l,0,t._bitset),_=t.out;return _.vertexBounds(r,s,e,i),_.vertexWrite(Object(d.a)(8*r,8*s)),_.vertexWrite(t.id),_.vertexWrite(t._fillColor),_.vertexWrite(m),_.vertexWrite(x),_.vertexWrite(t._tl),_.vertexWrite(t._br),_.vertexWrite(p),_.vertexWrite(Object(d.a)(Math.ceil($*t._halfReferenceWidth),0)),_.vertexWrite(t.minMaxZoom),_.vertexEnd(),t.offset+t.vertexCount++},tt=(t,e,i)=>(r,s,n,a,o,l,c,h,u,f,y)=>{const x=Object(d.b)(0,0,$*t._halfWidth,$*t._halfReferenceWidth),m=Object(d.b)($*c+128,$*h+128,$*u+128,$*f+128),p=t.out,_=t._bitset<<24|t.id;return p.vertexBounds(r,s,e,i),p.vertexWrite(Object(d.a)(8*r,8*s)),p.vertexWrite(_),p.vertexWrite(t._fillColor),t.key.simple||(p.vertexWrite(0),p.vertexWrite(0)),p.vertexWrite(x),p.vertexWrite(m),t.key.simple||p.vertexWrite(t.minMaxZoom),p.vertexEnd(),t.offset+t.vertexCount++},et=t=>(e,i,r)=>{const s=t.out;s.indexWrite(e),s.indexWrite(i),s.indexWrite(r),t.indexCount+=3};var it=i(330);const rt=s.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class st extends(Q(it.a)){constructor(t,e,i,r,s,n,a,o,c,h,f,x,m,p,_,g,b,v,M){super();const O=l.c.load(t);e&&(O.sdf=e.sdf,O.pattern=!0,O.textureBinding=e.textureBinding),this._capType=r,this._joinType=s,this._miterLimitCosine=Object(y.d)(n),this.tessellationProperties._fillColor=a,this.tessellationProperties._tl=o,this.tessellationProperties._br=c,this._hasPattern=h,this._isDashed=f,this._zOrder=g,this._effects=b,this._minMaxZoom=Object(d.a)(Math.round(v*u.t),Math.round(M*u.t)),this._materialKey=O.data;const w=(m?u.d:0)|(p?u.j:0)|(x?u.e:0);this.tessellationProperties._bitset=w,this.tessellationProperties._halfWidth=.5*i,this.tessellationProperties._halfReferenceWidth=.5*_,this.tessellationProperties.offset=0,this._initializeTessellator(!1)}static fromCIMLine(t,e,i){const r=t.color,s=t.scaleFactor||1,n=!!t.dashTemplate;let a=t.cap;n&&1===a&&(a=2);const o=t.join,l=Object(c.g)(t.width)*s,f=Object(c.g)(t.referenceWidth),x=Object(c.g)(t.miterLimit),m=r&&Object(h.c)(r)||0,[p,_]=Object(y.e)(t.scaleInfo,i);if(!e)return new st(t.materialKey,e,l,a,o,x,m,0,0,!1,n,t.scaleDash,t.colorLocked,!1,f,t.zOrder,t.effects,p,_);const{rect:g,width:b,height:v}=e,M=g.x+u.x,O=g.y+u.x,w=M+b,S=O+v,j=Object(d.a)(M,O),I=Object(d.a)(w,S);return new st(t.materialKey,e,l,a,o,x,m,j,I,!0,n,t.scaleDash,t.colorLocked,!1,f,t.zOrder,t.effects,p,_)}static fromFillOutline(t){var e;return t.isOutlinedFill&&t.outline&&"esriSLSSolid"===(null==(e=t.outline)?void 0:e.style)?st.fromSimpleLine({hash:"",materialKey:t.materialKey,...t.outline},null,!0):null}static fromSimpleLine(t,e,i=!1){const{color:r}=t,s="esriSLSSolid"!==t.style&&"esriSLSNull"!==t.style,n=Object(Y.i)(t.cap||"round"),a=Object(Y.j)(t.join||"round");let o=r&&"esriSLSNull"!==t.style&&Object(h.d)(r)||0;"esriSLSNull"===t.style&&(o=0);const l=Object(c.g)(t.width),f=t.miterLimit;if(!e)return new st(t.materialKey,e,l,n,a,f,o,0,0,!1,s,!0,!1,i,l,0,null,y.b,y.a);const{rect:x,width:m,height:p}=e,_=x.x+u.x,g=x.y+u.x,b=_+m,v=g+p,M=Object(d.a)(_,g),O=Object(d.a)(b,v);return new st(t.materialKey,e,l,n,a,f,o,M,O,!0,s,!0,!1,i,l,0,null,y.b,y.a)}static fromPictureLineSymbol(t,e,i,r){return rt.error("PictureLineSymbol support does not exist!"),null}}const nt=t=>class extends t{constructor(...t){super(...t),this.forceLibtess=!1,this._bitset=0,this._lineTemplate=null,this.geometryType=o.d.FILL}_maybeAddLineTemplate(t){this._lineTemplate=st.fromFillOutline(t)}_write(t,e,i){const r="esriGeometryPoint"===e.geometryType,s=l.a.load(this._materialKey);t.recordStart(e.getDisplayId(),this._materialKey,this.geometryType,r),this._writeGeometry(t,e,s,i,r),s.outlinedFill&&Object(x.l)(this._lineTemplate)&&this._lineTemplate.writeGeometry(t,e,i,r),t.recordEnd()}_writeGeometry(t,e,i,r,s){const n=this._getGeometry(e,r,s);if(Object(x.k)(n))return;const a=t.indexCount();if(!(n.maxLength>100)&&!this.forceLibtess&&function(t,e){const{coords:i,lengths:r,hasIndeterminateRingOrder:s}=e,n=t.indexWriter(),a=t.vertexCount();if(s)return!1;const o=n.length;let l=0;for(let c=0;c<r.length;){let t=c,e=r[c],s=U(i,l,e);const h=[];for(;++t<r.length;){const n=r[t],a=U(i,l+e,n);if(!(a>0))break;s+=a,h.push(l+e),e+=n}const u=n.length;b(n,i,l,l+e,h,2,a);const f=X(n,i,u,n.length,a),d=Math.abs(s);if(Math.abs((f-d)/Math.max(1e-7,d))>1e-5)return n.seek(o),!1;c=t,l+=e}return!0}(t,n))return void(!(a===t.indexCount())&&this._writeVertices(t,e,n.coords,n.lengths,i));const o=function(t,e){const i=t.indexWriter(),r=t.vertexCount(),{coords:s,lengths:n}=e,{buffer:a,vertexCount:o}=Object(p.b)(s,n);i.ensureSize(o);for(let l=0;l<o;l++)i.push(l+r);return a}(t,n);a!==t.indexCount()&&this._writeVertices(t,e,o,[o.length/2],i)}_writeVertices(t,e,i,r,s){const n=e.getDisplayId(),a=this._bitset<<24|n;let o=0;const l=r.reduce(((t,e)=>t+e)),c=s.dotDensity?4:10;t.vertexEnsureSize(c*l);for(const h of r){const r=h+o;for(let n=o;n<r;n++){const r=i[2*n],o=i[2*n+1],l=Object(d.a)(1*r,1*o);t.vertexBounds(r,o,0,0),t.vertexWrite(l),t.vertexWrite(a),s.dotDensity?t.vertexWriteF32(1/Math.abs(e.readGeometryArea())):(t.vertexWrite(this.fillColor),s.simple||(t.vertexWrite(this.tl),t.vertexWrite(this.br)),t.vertexWrite(this.aux2),t.vertexWrite(this.aux3),s.simple||t.vertexWrite(this._minMaxZoom))}o+=h}}_getGeometry(t,e,i){const r=e?Object(m.p)(Object(m.d)(e),2):t.readGeometryForDisplay();return r?function(t,e){if(Object(x.k)(t))return null;if(!function(t,e,i){let r=0;for(let s=0;s<t.lengths.length;s++){const n=t.lengths[s];for(let s=0;s<n;s++){const n=t.coords[2*(s+r)],a=t.coords[2*(s+r)+1];if(n<e||n>i||a<e||a>i)return!0}r+=n}return!1}(t,-128,u.L+128))return t;G.setPixelMargin(e),G.reset(3);let i=0;for(let a=0;a<t.lengths.length;a++){const e=t.lengths[a];let r=t.coords[2*(0+i)],s=t.coords[2*(0+i)+1];G.moveTo(r,s);for(let n=1;n<e;n++)r=t.coords[2*(n+i)],s=t.coords[2*(n+i)+1],G.lineTo(r,s);G.close(),i+=e}const r=G.result(!1);if(!r)return null;const s=[],n=[];for(const a of r){let t=0;for(const e of a)n.push(e.x),n.push(e.y),t++;s.push(t)}return new _.a(s,n)}(r,i?256:8):null}};var at=i(464),ot=i(302);const lt=s.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class ct extends it.a{constructor(t){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=t}analyze(t,e,i,r,s){const n=e.readLegacyFeature(),a=this._materialCache,o=this._cimLayer.materialHash;if(!o)return lt.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);const l="function"==typeof o?o(n,i,r):o;if(a.has(l)){const t=a.get(l);return Promise.resolve(t)}if(this._ongoingMaterialRequestMap.has(l))return this._ongoingMaterialRequestMap.get(l);const c=this._cimLayer,h=Object(at.a)(c.cim,this._cimLayer.materialOverrides),{type:u,url:f}=c,d={cim:h,type:u,mosaicHash:l,url:f,size:null,dashTemplate:null,text:null,fontName:null};switch(u){case"marker":d.size=Object(ot.d)(c.size,n,i,r);break;case"line":d.dashTemplate=c.dashTemplate;break;case"text":d.text=Object(ot.d)(c.text,n,i,r),d.fontName=Object(ot.d)(c.fontName,n,i,r)}const y=t.getMosaicItem(d,s).then((t=>(this._ongoingMaterialRequestMap.delete(l),a.set(l,t),t))).catch((t=>(this._ongoingMaterialRequestMap.delete(l),lt.error(".analyze()",t.message),null)));return this._ongoingMaterialRequestMap.set(l,y),y}}var ht=i(368);const ut=128;class ft extends(nt(ct)){constructor(t,e,i){var r;if(super(t),this._minMaxZoom=Object(d.a)(Math.round(e*u.t),Math.round(i*u.t)),Object(y.f)(t.color)){const e=(e,i,r)=>{const s=t.color(e,i,r);return s&&Object(h.c)(s)||0};this._dynamicPropertyMap.set("fillColor",e)}else{const e=t.color;this.fillColor=e&&Object(h.c)(e)||0}let s=0;Object(y.f)(t.height)||(s=t.height||0);const n="CIMMarkerPlacementInsidePolygon"===(null==(r=t.cim.placement)?void 0:r.type)&&t.cim.placement.shiftOddRows?2:1;this._dynamicPropertyMap.set("_height",((e,i,r)=>Object(y.f)(t.height)?t.height(e,i,r)*n:s*n));let a=0;Object(y.f)(t.offsetX)||(a=Object(c.g)(t.offsetX||0)+ut,a>255&&(a=255));this._dynamicPropertyMap.set("_offsetX",((e,i,r)=>{if(Object(y.f)(t.offsetX)){let s=Object(c.g)(t.offsetX(e,i,r))+ut;return s>255&&(s=255),s}return a}));let o=1;Object(y.f)(t.scaleX)||(o=t.scaleX||1);this._dynamicPropertyMap.set("_scaleX",((e,i,r)=>Object(y.f)(t.scaleX)?t.scaleX(e,i,r):o));let x=0;Object(y.f)(t.offsetY)||(x=Object(c.g)(-t.offsetY||0)+ut,x>255&&(x=255));this._dynamicPropertyMap.set("_offsetY",((e,i,r)=>{if(Object(y.f)(t.offsetY)){let s=Object(c.g)(-t.offsetY(e,i,r))+ut;return s>255&&(s=255),s}return x}));let m=0;Object(y.f)(t.angle)||(m=Object(f.d)(t.angle)||0);this._dynamicPropertyMap.set("_angle",((e,i,r)=>Object(y.f)(t.angle)?Object(f.d)(t.angle(e,i,r)):m)),this._effects=t.effects,this._cimFillLayer=t,this._fillMaterialKey=l.a.load(t.materialKey)}static fromCIMFill(t,e){const[i,r]=Object(y.e)(t.scaleInfo,e);return new ft(t,i,r)}bindFeature(t,e,i){const r=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,s)=>{this[s]=t(r,e,i)}));const s=this._fillMaterialKey,n=this._materialCache,a=(0,this._cimFillLayer.materialHash)(r,e,i),o=n.get(a);let l=null;if(o&&Object(ht.a)(o.spriteMosaicItem)&&(l=o.spriteMosaicItem),l){const{rect:t,width:e,height:i}=l,r=t.x+u.x,n=t.y+u.x,a=r+e,o=n+i;let h=Math.round(Object(c.g)(this._height));h>255?h=255:h<=0&&(h=o-n);let f=Math.round(Object(c.g)(this._height/i*e||0));f>255?f=255:f<=0&&(f=a-r);const y=this._scaleX,x=1;this.tl=Object(d.a)(r,n),this.br=Object(d.a)(a,o),this.aux2=Object(d.b)(f,h,this._offsetX,this._offsetY),this.aux3=Object(d.b)(y,x,this._angle,0),s.sdf=l.sdf,s.pattern=!0,s.textureBinding=l.textureBinding}else this.tl=0,this.br=0,this.aux2=0,this.aux3=0,s.sdf=!1,s.pattern=!1,s.textureBinding=0;this._materialKey=s.data}}class dt extends(Q(ct)){constructor(t,e,i){super(t),this._minMaxZoom=Object(d.a)(Math.round(e*u.t),Math.round(i*u.t)),this._cimLineLayer=t;let r=0;Object(y.f)(t.width)||(r=.5*Object(c.g)(t.width));if(this._dynamicPropertyMap.set("_halfWidth",((e,i,s)=>Object(y.f)(t.width)?.5*Object(c.g)(t.width(e,i,s)):r)),Object(y.f)(t.cap)?this._dynamicPropertyMap.set("_capType",t.cap):this._capType=t.cap,Object(y.f)(t.join)?this._dynamicPropertyMap.set("_joinType",t.join):this._joinType=t.join,Object(y.f)(t.color)){const e=(e,i,r)=>{const s=t.color(e,i,r);return s&&Object(h.c)(s)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this._fillColor=e&&Object(h.c)(e)||0}if(Object(y.f)(t.miterLimit)){const e=(e,i,r)=>Object(y.d)(t.miterLimit(e,i,r));this._dynamicPropertyMap.set("_miterLimitCosine",e)}else this._miterLimitCosine=Object(y.d)(t.miterLimit);this._scaleFactor=t.scaleFactor||1,this._isDashed=null!=t.dashTemplate,this._effects=t.effects,this.tessellationProperties._bitset=(t.colorLocked?1:0)|(t.scaleDash?1:0)<<1,this._materialKey=t.materialKey,this._initializeTessellator(!0)}static fromCIMLine(t,e){const[i,r]=Object(y.e)(t.scaleInfo,e);return new dt(t,i,r)}bindFeature(t,e,i){const r=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,s)=>{this[s]=t(r,e,i)})),this._halfWidth*=this._scaleFactor;const s=this._materialCache,n=(0,this._cimLineLayer.materialHash)(r,e,i),a=s.get(n);let o=null;if(a&&Object(ht.a)(a.spriteMosaicItem)&&(o=a.spriteMosaicItem),o){this._hasPattern=!0;const{rect:t,width:e,height:i}=o,r=t.x+u.x,s=t.y+u.x,n=r+e,a=s+i;this.tessellationProperties._tl=Object(d.a)(r,s),this.tessellationProperties._br=Object(d.a)(n,a)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const c=l.c.load(this._materialKey);o&&(c.sdf=o.sdf,c.pattern=!0,c.textureBinding=o.textureBinding),this._materialKey=c.data}}var yt=i(349),xt=i(235),mt=i(498);const pt=Object(xt.a)(),_t=Object(yt.a)(),gt=s.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class bt extends(Object(mt.a)(ct)){constructor(t,e,i){if(super(t),this._cimMarkerLayer=t,this._minMaxZoom=Object(d.a)(Math.round(e*u.t),Math.round(i*u.t)),Object(y.f)(t.color)){const e=(e,i,r)=>Object(h.c)(t.color(e,i,r));this._dynamicPropertyMap.set("_fillColor",e)}else this._fillColor=Object(h.c)(t.color);if(Object(y.f)(t.outlineColor)){const e=(e,i,r)=>Object(h.c)(t.outlineColor(e,i,r));this._dynamicPropertyMap.set("_outlineColor",e)}else this._outlineColor=Object(h.c)(t.outlineColor);if(Object(y.f)(t.size)){const e=(e,i,r)=>Object(c.g)(t.size(e,i,r));this._dynamicPropertyMap.set("_size",e)}else this._size=Object(c.g)(t.size)||0;if(Object(y.f)(t.scaleX)?this._dynamicPropertyMap.set("_scaleX",t.scaleX):this._scaleX=t.scaleX||1,Object(y.f)(t.offsetX)){const e=(e,i,r)=>Object(c.g)(t.offsetX(e,i,r));this._dynamicPropertyMap.set("xOffset",e)}else this.xOffset=Object(c.g)(t.offsetX)||0;if(Object(y.f)(t.offsetY)){const e=(e,i,r)=>Object(c.g)(t.offsetY(e,i,r));this._dynamicPropertyMap.set("yOffset",e)}else this.yOffset=Object(c.g)(t.offsetY)||0;if(Object(y.f)(t.outlineWidth)){const e=(e,i,r)=>Object(c.g)(t.outlineWidth(e,i,r));this._dynamicPropertyMap.set("_outlineWidth",e)}else this._outlineWidth=Object(c.g)(t.outlineWidth)||0;Object(y.f)(t.rotation)?this._dynamicPropertyMap.set("_angle",t.rotation):this._angle=t.rotation||0,this._scaleFactor=Object(x.u)(t.scaleFactor,1),this._markerPlacement=t.markerPlacement,this._effects=t.effects,this._bitSet=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1|(t.scaleSymbolsProportionally?1:0)<<3,this._materialKey=t.materialKey}static fromCIMMarker(t,e){const[i,r]=Object(y.e)(t.scaleInfo,e);return new bt(t,i,r)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)}));const n=this._cimMarkerLayer.materialHash,a="function"==typeof n?n(s,e,i):n,o=this._materialCache.get(a);if(!o||!Object(ht.a)(o.spriteMosaicItem)||!o.spriteMosaicItem)return void gt.error(new r.a("mapview-cim","Encountered an error when binding feature"));const h=o.spriteMosaicItem,f=this._cimMarkerLayer.sizeRatio,y=h.width/h.height*this._scaleX,x=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let m=this._size,p=m*y;const _=this.xOffset,g=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const b=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(c.g)(this._cimMarkerLayer.frameHeight):1,v=this._outlineWidth*b,M=Object(c.g)(this._cimMarkerLayer.referenceSize);let O=0,w=0;const S=this._cimMarkerLayer.anchorPoint;S&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(O=-S.x/(this._size*y),w=S.y/this._size):(O=S.x,w=S.y)),this._sizeOutlineWidth=Object(d.b)(Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*M),255))),this.angle=x;const j=Math.round(64*f);this._bitestAndDistRatio=Object(d.a)(this._bitSet,j);const I=h.rect.x+u.x,T=h.rect.y+u.x,z=I+h.width,L=T+h.height;this._texUpperLeft=Object(d.a)(I,T),this._texUpperRight=Object(d.a)(z,T),this._texBottomLeft=Object(d.a)(I,L),this._texBottomRight=Object(d.a)(z,L);const P=l.d.load(this._materialKey);P.sdf=h.sdf,P.pattern=!0,P.textureBinding=h.textureBinding,this._materialKey=P.data,this._anchorX=.5-(.5+O)*h.width/h.width,this._anchorY=.5-(.5+w)*h.height/h.height,p*=f,m*=f,p*=this._scaleFactor,m*=this._scaleFactor,p*=h.rect.width/h.width,m*=h.rect.height/h.height,this._computedWidth=p,this._computedHeight=m,this._applyTransformation(_t,pt),this.xOffset=_,this.yOffset=g}}var vt=i(292),Mt=i(494),Ot=i(478);class wt extends(Object(Mt.a)(ct)){constructor(t,e,i){super(t),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map,this._minMaxZoom=Object(d.a)(Math.round(e*u.t),Math.round(i*u.t));const r=t.scaleFactor||1;if(this._cimTextLayer=t,Object(y.f)(t.color)){const e=(e,i,r)=>Object(h.c)(t.color(e,i,r));this._dynamicPropertyMap.set("_color",e)}else this._color=Object(h.c)(t.color);if(Object(y.f)(t.color)){const e=(e,i,r)=>Object(h.c)(t.outlineColor(e,i,r));this._dynamicPropertyMap.set("_haloColor",e)}else this._haloColor=Object(h.c)(t.outlineColor);let s;Object(y.f)(t.size)||(s=Math.min(Math.round(Object(c.g)(t.size*t.sizeRatio)),127));if(this._dynamicPropertyMap.set("_size",((e,i,r)=>Object(y.f)(t.size)?Math.min(Math.round(Object(c.g)(t.size(e,i,r)*t.sizeRatio)),127):s)),Object(y.f)(t.outlineSize)){const e=(e,i,r)=>Math.min(Math.floor(5*Object(c.g)(t.outlineSize(e,i,r)*t.sizeRatio)),127);this._dynamicPropertyMap.set("_haloSize",e)}else this._haloSize=Math.min(Math.floor(5*Object(c.g)(t.outlineSize*t.sizeRatio)),127);let n;Object(y.f)(t.offsetX)||(n=Math.round(Object(c.g)(t.offsetX*t.sizeRatio)));let a;this._dynamicPropertyMap.set("_xOffset",((e,i,r)=>Object(y.f)(t.offsetX)?Math.round(Object(c.g)(t.offsetX(e,i,r)*t.sizeRatio)):n)),Object(y.f)(t.offsetY)||(a=Math.round(Object(c.g)(t.offsetY*t.sizeRatio)));this._dynamicPropertyMap.set("_yOffset",((e,i,r)=>Object(y.f)(t.offsetY)?Math.round(Object(c.g)(t.offsetY(e,i,r)*t.sizeRatio)):a)),Object(y.f)(t.angle)?this._dynamicPropertyMap.set("_angle",t.angle):this._angle=t.angle,Object(y.f)(t.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",t.horizontalAlignment):this._horizontalAlignment=t.horizontalAlignment,Object(y.f)(t.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",t.verticalAlignment):this._verticalAlignment=t.verticalAlignment,this._scaleFactor=r,Object(y.f)(t.text)?this._dynamicPropertyMap.set("_text",t.text):this._text=t.text;const o=Math.min(Math.round(Object(c.g)(t.referenceSize*t.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*o)),this._materialKey=t.materialKey;const f=l.f.load(this._materialKey);f.sdf=!0,this._bitset=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1,this._materialKey=f.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=t.markerPlacement,this._effects=t.effects,this._isCIM=!0}static fromCIMText(t,e){const[i,r]=Object(y.e)(t.scaleInfo,e);return new wt(t,i,r)}async analyze(t,e,i,r){const s=e.readLegacyFeature(),n=function(t,e,i,r){return"string"==typeof t.text?t.text:"function"==typeof t.text?t.text(e,i,r):""}(this._cimTextLayer,s,i,r),a=await super.analyze(t,e,i,r,Object(Ot.a)(n));return this._textToGlyphs.set(n,a.glyphMosaicItems),a}bindFeature(t,e,i){const r=t.readLegacyFeature();if(this._dynamicPropertyMap.forEach(((t,s)=>{this[s]=t(r,e,i)})),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/u.o,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(vt.e)(this._horizontalAlignment||"center"),this._yAlignD=Object(vt.g)(this._verticalAlignment||"baseline");const s=this._textToGlyphs.get(this._text);this.bindTextInfo(s,!1)}}const St=128;class jt extends(nt(it.a)){constructor(t,e,i,r,s,n,a,o,c,h,f,y,x,m,p,_){super(),this._effects=m;const g=l.a.load(t);e&&(g.sdf=e.sdf,g.pattern=!0,g.textureBinding=e.textureBinding),this.fillColor=i,this.tl=r,this.br=s,this.aux2=Object(d.b)(n,a,o,c),this.aux3=Object(d.b)(h,f,y,0),this._bitset=x,this._minMaxZoom=Object(d.a)(Math.round(p*u.t),Math.round(_*u.t)),this._materialKey=g.data}static fromCIMFill(t,e,i){const r=t.color,s=r&&Object(h.c)(r)||0,n=t.materialKey,[a,o]=Object(y.e)(t.scaleInfo,i);if(!e)return new jt(n,null,s,0,0,0,0,0,0,0,0,0,t.colorLocked?1:0,t.effects,a,o);const{rect:l,width:x,height:m}=e,p=t.scaleX||1,_=l.x+u.x,g=l.y+u.x,b=_+x,v=g+m,M=t.height,O=p*M;let w=Math.round(M);w>255?w=255:w<=0&&(w=v-g);let S=Math.round(O);S>255?S=255:S<=0&&(S=b-_);let j=Object(c.g)(t.offsetX||0)+St;j>255&&(j=255);let I=Object(c.g)(-t.offsetY||0)+St;I>255&&(I=255);const T=Object(d.a)(_,g),z=Object(d.a)(b,v);return new jt(n,e,s,T,z,S,w,j,I,St,St,Object(f.b)(t.angle),t.colorLocked?1:0,t.effects,a,o)}static fromSimpleFill(t,e,i=!1){const{color:r}=t,s=r&&"esriSFSNull"!==t.style&&Object(h.d)(r)||0,n=i?u.d:0,a=t.materialKey;let o;if(e){const{rect:t,width:i,height:r}=e,l=t.x+u.x,c=t.y+u.x,h=l+i,f=c+r,x=Object(d.a)(l,c),m=Object(d.a)(h,f);o=new jt(a,e,s,x,m,i,r,0,0,St,St,0,n,null,y.b,y.a)}else o=new jt(a,null,s,0,0,0,0,0,0,0,0,0,n,null,y.b,y.a);return o._maybeAddLineTemplate(t),o}static fromPictureFill(t,e,i=!1){const r=u.w,{rect:s,width:n,height:a}=e,o=s.x+u.x,l=s.y+u.x,h=o+n,f=l+a,x=Object(d.a)(o,l),m=Object(d.a)(h,f);let p=Math.round(Object(c.g)(t.width));p>255&&(p=255);let _=Math.round(Object(c.g)(t.height));_>255&&(_=255);let g=Object(c.g)(t.xoffset)+St;g>255&&(g=255);let b=Object(c.g)(-t.yoffset)+St;b>255&&(b=255);const v=t.materialKey,M=i?u.d:0,O=new jt(v,e,r,x,m,p,_,g,b,St*t.xscale,St*t.yscale,0,M,null,y.b,y.a);return O._maybeAddLineTemplate(t),O}}var It=i(497),Tt=i(493);class zt{constructor(){this._resolver=null}isHeld(){return!!this._resolver}async acquire(){if(!this._resolver)return this._resolver=Object(n.f)(),Promise.resolve();await this._resolver.promise,await this.acquire()}release(){const t=this._resolver;this._resolver=null,t.resolve()}}var Lt=i(373);const Pt=s.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Ct=new Array,kt={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:0},Vt={...a.g,hash:JSON.stringify(a.g),materialKey:Object(l.g)(o.d.MARKER,kt)},Ft={...a.i,hash:JSON.stringify(a.i),materialKey:Object(l.g)(o.d.LINE,kt)},Et={...a.h,hash:JSON.stringify(a.h),materialKey:Object(l.g)(o.d.FILL,kt)};function Rt(t,e){const i=t.length;return t.push(null),e.then((e=>t[i]=e)),t}function At(t){return!!(1&t)}class Wt{constructor(t,e){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new zt,this._fetchResource=t,this._tileInfo=e}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(t,e){this._initErrorTemplates();const i=t.hash;if(this._symbolToTemplate.has(i))return this._symbolToTemplate.get(i);const r=new Array;e&&this._createMeshTemplates(r,e,!0),this._createMeshTemplates(r,t,!1);const s=this._createGroupId("expanded-cim"===t.type&&Bt(t));return this._idToTemplateGroup.set(s,r),this._symbolToTemplate.set(i,s),s}getTemplateGroup(t){return this._idToTemplateGroup.has(t)?this._idToTemplateGroup.get(t):Ct}getDynamicTemplateGroup(t){return this._idToTemplateGroup.has(t)?(At(t)||Pt.error("mapview-template-store",`Id ${t} does not refer to a dynamic template`),this._idToTemplateGroup.get(t)):Ct}getMosaicItem(t,e){const i=this._createTemplateId(),r=new Promise((t=>this._idToResolver.set(i,t)));return this._fetchQueue.push({symbol:t,id:i,glyphIds:e}),r}finalize(t){return this._fetchQueue.length||this._lock.isHeld()?async function(t,e,i){try{await t.acquire(),await e(i),t.release()}catch(r){throw t.release(),r}}(this._lock,this._fetchAllQueuedResources.bind(this),t):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Et,!1),marker:this._createMeshTemplates([],Vt,!1),line:this._createMeshTemplates([],Ft,!1)})}_fetchAllQueuedResources(t){if(!this._fetchQueue.length)return Promise.resolve();const e=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(i).then((()=>this._fetchResource(e,t).then((t=>{for(const{id:e,mosaicItem:i}of t)this._idToResolver.get(e)(i),this._idToResolver.delete(e)})))).catch((t=>{Object(n.l)(t)?this._fetchQueue=this._fetchQueue.concat(e):"worker:port-closed"===t.name||Pt.error(new r.a("mapview-template-store","Unable to fetch requested texture resources",t))}))}_createGroupId(t){return this._idCounter++<<1|(t?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(ht.a)(e,Pt)?It.a.fromSimpleMarker(t,e):this._markerError}async _createPMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(ht.a)(e,Pt)?It.a.fromPictureMarker(t,e):this._markerError}async _createSFS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return Object(ht.a)(i,Pt)?jt.fromSimpleFill(t,i,e):this._fillError}async _createPFS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return Object(ht.a)(i,Pt)?jt.fromPictureFill(t,i,e):this._fillError}async _createSLS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return Object(ht.a)(i,Pt)?st.fromSimpleLine(t,i):this._lineError}async _createLMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(ht.a)(e,Pt)?It.a.fromLineSymbolMarker(t,e):this._markerError}async _createTS(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t);return Tt.a.fromText(t,e)}async _createCIMText(t){const{glyphMosaicItems:e}=await this.getMosaicItem(Object(Lt.a)(t),Object(Ot.a)(t.text));return Object(ht.a)(e,Pt)?Tt.a.fromCIMText(t,e,this._tileInfo):this._textError}async _createCIMFill(t){const{spriteMosaicItem:e}=await this.getMosaicItem(Object(Lt.a)(t));return Object(ht.a)(e,Pt)?jt.fromCIMFill(t,e,this._tileInfo):this._fillError}async _createCIMLine(t){const{spriteMosaicItem:e}=await this.getMosaicItem(Object(Lt.a)(t));return Object(ht.a)(e,Pt)?st.fromCIMLine(t,e,this._tileInfo):this._lineError}async _createCIMMarker(t){const{spriteMosaicItem:e}=await this.getMosaicItem(Object(Lt.a)(t));return Object(ht.a)(e,Pt)?It.a.fromCIMMarker(t,e,this._tileInfo):this._markerError}async _createCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let i;switch(t.type){case"marker":i=this._createCIMMarker(t);break;case"line":i=this._createCIMLine(t);break;case"fill":i=this._createCIMFill(t);break;case"text":i=this._createCIMText(t)}return i.then((t=>this._cimTemplateCache.set(e,t))),i}_createDynamicCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let i;switch(t.type){case"marker":i=bt.fromCIMMarker(t,this._tileInfo);break;case"line":i=dt.fromCIMLine(t,this._tileInfo);break;case"fill":i=ft.fromCIMFill(t,this._tileInfo);break;case"text":i=wt.fromCIMText(t,this._tileInfo)}return this._cimTemplateCache.set(e,i),i}_createPrimitiveMeshTemplates(t,e,i){switch(e.type){case"esriSMS":return Rt(t,this._createSMS(e));case"esriPMS":return Rt(t,this._createPMS(e));case"esriSFS":return Rt(t,this._createSFS(e,i));case"line-marker":return Rt(t,this._createLMS(e));case"esriPFS":return Rt(t,this._createPFS(e,i));case"esriSLS":return Rt(t,this._createSLS(e,!1));case"esriTS":return Rt(t,this._createTS(e));default:return Pt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),t}}_createMeshTemplates(t,e,i){if(-1!==e.type.indexOf("3d"))return Pt.error("3D symbols are not supported with MapView"),t;if("expanded-cim"===e.type){for(const i of e.layers)"function"==typeof i.materialHash?t.push(this._createDynamicCIM(i)):Rt(t,this._createCIM(i));return t}if("composite-symbol"===e.type){for(const r of e.layers)this._createPrimitiveMeshTemplates(t,r,i);return t}return"cim"===e.type||"label"===e.type||"web-style"===e.type?t:this._createPrimitiveMeshTemplates(t,e,i)}}const Bt=t=>{if(!t.layers)return!1;for(const e of t.layers)if("function"==typeof e.materialHash)return!0;return!1}},548:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));class r{constructor(t,e){this.x=t,this.y=e}clone(){return new r(this.x,this.y)}equals(t,e){return t===this.x&&e===this.y}isEqual(t){return t.x===this.x&&t.y===this.y}setCoords(t,e){this.x=t,this.y=e}normalize(){const t=this.x,e=this.y,i=Math.sqrt(t*t+e*e);this.x/=i,this.y/=i}rightPerpendicular(){const t=this.x;this.x=this.y,this.y=-t}move(t,e){this.x+=t,this.y+=e}assign(t){this.x=t.x,this.y=t.y}assignAdd(t,e){this.x=t.x+e.x,this.y=t.y+e.y}assignSub(t,e){this.x=t.x-e.x,this.y=t.y-e.y}rotate(t,e){const i=this.x,r=this.y;this.x=i*t-r*e,this.y=i*e+r*t}scale(t){this.x*=t,this.y*=t}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}static distance(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}static add(t,e){return new r(t.x+e.x,t.y+e.y)}static sub(t,e){return new r(t.x-e.x,t.y-e.y)}}},558:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var r,s,n,a={exports:{}};r=a,s=function(){function t(t,i,s){s=s||2;var n,a,o,c,h,u,f,d=i&&i.length,y=d?i[0]*s:t.length,x=e(t,0,y,s,!0),m=[];if(!x||x.next===x.prev)return m;if(d&&(x=l(t,i,x,s)),t.length>80*s){n=o=t[0],a=c=t[1];for(var p=s;p<y;p+=s)(h=t[p])<n&&(n=h),(u=t[p+1])<a&&(a=u),h>o&&(o=h),u>c&&(c=u);f=0!==(f=Math.max(o-n,c-a))?1/f:0}return r(x,m,s,n,a,f),m}function e(t,e,i,r,s){var n,a;if(s===T(t,e,i,r)>0)for(n=e;n<i;n+=r)a=S(n,t[n],t[n+1],a);else for(n=i-r;n>=e;n-=r)a=S(n,t[n],t[n+1],a);if(a&&g(a,a.next)){var o=a.next;j(a),a=o}return a}function i(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!g(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{var s=r.prev;if(j(r),(r=e=s)===r.next)break;i=!0}}while(i||r!==e);return e}function r(t,e,l,c,h,u,f){if(t){!f&&u&&d(t,c,h,u);for(var y,x,m=t;t.prev!==t.next;)if(y=t.prev,x=t.next,u?n(t,c,h,u):s(t))e.push(y.i/l),e.push(t.i/l),e.push(x.i/l),j(t),t=x.next,m=x.next;else if((t=x)===m){f?1===f?r(t=a(i(t),e,l),e,l,c,h,u,2):2===f&&o(t,e,l,c,h,u):r(i(t),e,l,c,h,u,1);break}}}function s(t){var e=t.prev,i=t,r=t.next;if(_(e,i,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(m(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&_(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function n(t,e,i,r){var s=t.prev,n=t,a=t.next;if(_(s,n,a)>=0)return!1;for(var o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,c=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,h=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,u=y(o,l,e,i,r),f=y(c,h,e,i,r),d=t.prevZ,x=t.nextZ;d&&d.z>=u&&x&&x.z<=f;){if(d!==t.prev&&d!==t.next&&m(s.x,s.y,n.x,n.y,a.x,a.y,d.x,d.y)&&_(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,x!==t.prev&&x!==t.next&&m(s.x,s.y,n.x,n.y,a.x,a.y,x.x,x.y)&&_(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&m(s.x,s.y,n.x,n.y,a.x,a.y,d.x,d.y)&&_(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;x&&x.z<=f;){if(x!==t.prev&&x!==t.next&&m(s.x,s.y,n.x,n.y,a.x,a.y,x.x,x.y)&&_(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function a(t,e,r){var s=t;do{var n=s.prev,a=s.next.next;!g(n,a)&&b(n,s,s.next,a)&&O(n,a)&&O(a,n)&&(e.push(n.i/r),e.push(s.i/r),e.push(a.i/r),j(s),j(s.next),s=t=a),s=s.next}while(s!==t);return i(s)}function o(t,e,s,n,a,o){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&p(l,c)){var h=w(l,c);return l=i(l,l.next),h=i(h,h.next),r(l,e,s,n,a,o),void r(h,e,s,n,a,o)}c=c.next}l=l.next}while(l!==t)}function l(t,r,s,n){var a,o,l,h=[];for(a=0,o=r.length;a<o;a++)(l=e(t,r[a]*n,a<o-1?r[a+1]*n:t.length,n,!1))===l.next&&(l.steiner=!0),h.push(x(l));for(h.sort(c),a=0;a<h.length;a++)s=i(s=u(h[a],s),s.next);return s}function c(t,e){return t.x-e.x}function h(t){if(t.next.prev===t)return t;let e=t;for(;;){const i=e.next;if(i.prev===e||i===e||i===t)break;e=i}return e}function u(t,e){var r=function(t,e){var i,r=e,s=t.x,n=t.y,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=s&&o>a){if(a=o,o===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(s===a)return i;var l,c=i,h=i.x,u=i.y,d=1/0;r=i;do{s>=r.x&&r.x>=h&&s!==r.x&&m(n<u?s:a,n,h,u,n<u?a:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),O(r,t)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&f(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(t,e);if(!r)return e;var s=w(r,t),n=i(r,r.next);let a=h(s);return i(a,a.next),n=h(n),h(e===r?n:e)}function f(t,e){return _(t.prev,t,e.prev)<0&&_(e.next,t,t.next)<0}function d(t,e,i,r){var s=t;do{if(null===s.z&&(s.z=y(s.x,s.y,e,i,r)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,d(t,e,i,r);s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,i,r,s,n,a,o,l,c=1;do{for(i=t,t=null,n=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ);e++);for(l=c;o>0||l>0&&r;)0!==o&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:t=s,s.prevZ=n,n=s;i=r}n.nextZ=null,c*=2}while(a>1)}(s)}function y(t,e,i,r,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function x(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,r,s,n,a,o){return(s-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&b(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(O(t,e)&&O(e,t)&&function(t,e){var i=t,r=!1,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)&&(_(t.prev,t,e.prev)||_(t,e.prev,e))||g(t,e)&&_(t.prev,t,t.next)>0&&_(e.prev,e,e.next)>0)}function _(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,i,r){var s=M(_(t,e,i)),n=M(_(t,e,r)),a=M(_(i,r,t)),o=M(_(i,r,e));return s!==n&&a!==o||!(0!==s||!v(t,i,e))||!(0!==n||!v(t,r,e))||!(0!==a||!v(i,t,r))||!(0!==o||!v(i,e,r))}function v(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function M(t){return t>0?1:t<0?-1:0}function O(t,e){return _(t.prev,t,t.next)<0?_(t,e,t.next)>=0&&_(t,t.prev,e)>=0:_(t,e,t.prev)<0||_(t,t.next,e)<0}function w(t,e){var i=new I(t.i,t.x,t.y),r=new I(e.i,e.x,e.y),s=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function S(t,e,i,r){var s=new I(t,e,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function j(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function T(t,e,i,r){for(var s=0,n=e,a=i-r;n<i;n+=r)s+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return s}return t.deviation=function(t,e,i,r){var s=e&&e.length,n=s?e[0]*i:t.length,a=Math.abs(T(t,0,n,i));if(s)for(var o=0,l=e.length;o<l;o++){var c=e[o]*i,h=o<l-1?e[o+1]*i:t.length;a-=Math.abs(T(t,c,h,i))}var u=0;for(o=0;o<r.length;o+=3){var f=r[o]*i,d=r[o+1]*i,y=r[o+2]*i;u+=Math.abs((t[f]-t[y])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[y+1]-t[f+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},t.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,s=0;s<t.length;s++){for(var n=0;n<t[s].length;n++)for(var a=0;a<e;a++)i.vertices.push(t[s][n][a]);s>0&&(r+=t[s-1].length,i.holes.push(r))}return i},t},void 0!==(n=s())&&(r.exports=n);const o=a.exports},586:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));i(665);function r(t,e,i,r){const s=t.clone(),n=1<<s.level,a=s.col+e,o=s.row+i;return r&&a<0?(s.col=a+n,s.world-=1):a>=n?(s.col=a-n,s.world+=1):s.col=a,s.row=o,s}},587:function(t,e,i){"use strict";i.d(e,"a",(function(){return l})),i.d(e,"b",(function(){return o}));var r=i(115),s=i(548),n=i(429);class a{constructor(t,e,i){this.ratio=t,this.x=e,this.y=i}}class o{constructor(t,e,i,s=8,n=8){this.lines=[],this.starts=[],this.validateTessellation=!0,this.pixelRatio=s,this.pixelMargin=n,this.tileSize=r.L*s,this.dz=t,this.yPos=e,this.xPos=i}setPixelMargin(t){t!==this.pixelMargin&&(this.pixelMargin=t,this.setExtent(this._extent))}setExtent(t){this._extent=t,this.finalRatio=this.tileSize/t*(1<<this.dz);let e=this.pixelRatio*this.pixelMargin;e/=this.finalRatio;const i=t>>this.dz;e>i&&(e=i),this.margin=e,this.xmin=i*this.xPos-e,this.ymin=i*this.yPos-e,this.xmax=this.xmin+i+2*e,this.ymax=this.ymin+i+2*e}reset(t){this.type=t,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(t,e){this._pushLine(),this._prevIsIn=this._isIn(t,e),this._moveTo(t,e,this._prevIsIn),this._prevPt=new s.a(t,e),this._firstPt=new s.a(t,e),this._dist=0}lineTo(t,e){const i=this._isIn(t,e),r=new s.a(t,e),n=s.a.distance(this._prevPt,r);let o,l,c,h,u,f,d,y;if(i)this._prevIsIn?this._lineTo(t,e,!0):(o=this._prevPt,l=r,c=this._intersect(l,o),this.start=this._dist+n*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,o=r,c=this._intersect(l,o),this._lineTo(c.x,c.y,!0),this._lineTo(o.x,o.y,!1);else{const t=this._prevPt,e=r;if(t.x<=this.xmin&&e.x<=this.xmin||t.x>=this.xmax&&e.x>=this.xmax||t.y<=this.ymin&&e.y<=this.ymin||t.y>=this.ymax&&e.y>=this.ymax)this._lineTo(e.x,e.y,!1);else{const i=[];if((t.x<this.xmin&&e.x>this.xmin||t.x>this.xmin&&e.x<this.xmin)&&(h=(this.xmin-t.x)/(e.x-t.x),y=t.y+h*(e.y-t.y),y<=this.ymin?f=!1:y>=this.ymax?f=!0:i.push(new a(h,this.xmin,y))),(t.x<this.xmax&&e.x>this.xmax||t.x>this.xmax&&e.x<this.xmax)&&(h=(this.xmax-t.x)/(e.x-t.x),y=t.y+h*(e.y-t.y),y<=this.ymin?f=!1:y>=this.ymax?f=!0:i.push(new a(h,this.xmax,y))),(t.y<this.ymin&&e.y>this.ymin||t.y>this.ymin&&e.y<this.ymin)&&(h=(this.ymin-t.y)/(e.y-t.y),d=t.x+h*(e.x-t.x),d<=this.xmin?u=!1:d>=this.xmax?u=!0:i.push(new a(h,d,this.ymin))),(t.y<this.ymax&&e.y>this.ymax||t.y>this.ymax&&e.y<this.ymax)&&(h=(this.ymax-t.y)/(e.y-t.y),d=t.x+h*(e.x-t.x),d<=this.xmin?u=!1:d>=this.xmax?u=!0:i.push(new a(h,d,this.ymax))),0===i.length)u?f?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):f?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this.start=this._dist+n*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this.start=this._dist+n*i[0].ratio;for(let t=0;t<i.length;t++)this._lineTo(i[t].x,i[t].y,!0)}this._lineTo(e.x,e.y,!1)}}this._dist+=n,this._prevIsIn=i,this._prevPt=r}close(){if(this.line.length>2){const t=this._firstPt,e=this._prevPt;t.x===e.x&&t.y===e.y||this.lineTo(t.x,t.y);const i=this.line;let r=i.length;for(;r>=4&&(i[0].x===i[1].x&&i[0].x===i[r-2].x||i[0].y===i[1].y&&i[0].y===i[r-2].y);)i.pop(),i[0].x=i[r-2].x,i[0].y=i[r-2].y,--r}}result(t=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&t&&c.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error("Only valid for lines");this._pushLine();const t=this.lines,e=t.length;if(0===e)return null;const i=[];for(let r=0;r<e;r++)i.push({line:t[r],start:this.starts[r]||0});return i}_isIn(t,e){return t>=this.xmin&&t<=this.xmax&&e>=this.ymin&&e<=this.ymax}_intersect(t,e){let i,r,n;if(e.x>=this.xmin&&e.x<=this.xmax)r=e.y<=this.ymin?this.ymin:this.ymax,n=(r-t.y)/(e.y-t.y),i=t.x+n*(e.x-t.x);else if(e.y>=this.ymin&&e.y<=this.ymax)i=e.x<=this.xmin?this.xmin:this.xmax,n=(i-t.x)/(e.x-t.x),r=t.y+n*(e.y-t.y);else{r=e.y<=this.ymin?this.ymin:this.ymax,i=e.x<=this.xmin?this.xmin:this.xmax;const s=(i-t.x)/(e.x-t.x),a=(r-t.y)/(e.y-t.y);s<a?(n=s,r=t.y+s*(e.y-t.y)):(n=a,i=t.x+a*(e.x-t.x))}return this._r=n,new s.a(i,r)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(t,e,i){3!==this.type?i&&(t=Math.round((t-(this.xmin+this.margin))*this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line.push(new s.a(t,e))):(i||(t<this.xmin&&(t=this.xmin),t>this.xmax&&(t=this.xmax),e<this.ymin&&(e=this.ymin),e>this.ymax&&(e=this.ymax)),t=Math.round((t-(this.xmin+this.margin))*this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line.push(new s.a(t,e)),this._is_h=!1,this._is_v=!1)}_lineTo(t,e,i){let r,n;if(3!==this.type)if(i){if(t=Math.round((t-(this.xmin+this.margin))*this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(r=this.line[this.line.length-1],r.equals(t,e)))return;this.line.push(new s.a(t,e))}else this.line&&this.line.length>0&&this._pushLine();else if(i||(t<this.xmin&&(t=this.xmin),t>this.xmax&&(t=this.xmax),e<this.ymin&&(e=this.ymin),e>this.ymax&&(e=this.ymax)),t=Math.round((t-(this.xmin+this.margin))*this.finalRatio),e=Math.round((e-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){r=this.line[this.line.length-1];const i=r.x===t,a=r.y===e;if(i&&a)return;this._is_h&&i||this._is_v&&a?(r.x=t,r.y=e,n=this.line[this.line.length-2],n.x===t&&n.y===e?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(n=this.line[this.line.length-2],this._is_h=n.x===t,this._is_v=n.y===e)):(this._is_h=n.x===t,this._is_v=n.y===e)):(this.line.push(new s.a(t,e)),this._is_h=i,this._is_v=a)}else this.line.push(new s.a(t,e))}}class l{setExtent(t){this._ratio=4096===t?1:4096/t}get validateTessellation(){return this._ratio<1}reset(t){this.lines=[],this.line=null}moveTo(t,e){this.line&&this.lines.push(this.line),this.line=[];const i=this._ratio;this.line.push(new s.a(t*i,e*i))}lineTo(t,e){const i=this._ratio;this.line.push(new s.a(t*i,e*i))}close(){const t=this.line;t&&!t[0].isEqual(t[t.length-1])&&t.push(t[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:this.lines}}class c{static simplify(t,e,i){if(!i)return;const r=-e,s=t+e,n=-e,a=t+e,o=[],l=[],h=i.length;for(let c=0;c<h;++c){const t=i[c];if(!t||t.length<2)continue;let e,h=t[0];const u=t.length;for(let i=1;i<u;++i)e=t[i],h.x===e.x&&(h.x<=r&&(h.y>e.y?(o.push(c),o.push(i),o.push(0),o.push(-1)):(l.push(c),l.push(i),l.push(0),l.push(-1))),h.x>=s&&(h.y<e.y?(o.push(c),o.push(i),o.push(1),o.push(-1)):(l.push(c),l.push(i),l.push(1),l.push(-1)))),h.y===e.y&&(h.y<=n&&(h.x<e.x?(o.push(c),o.push(i),o.push(2),o.push(-1)):(l.push(c),l.push(i),l.push(2),l.push(-1))),h.y>=a&&(h.x>e.x?(o.push(c),o.push(i),o.push(3),o.push(-1)):(l.push(c),l.push(i),l.push(3),l.push(-1)))),h=e}if(0===o.length||0===l.length)return;c.fillParent(i,l,o),c.fillParent(i,o,l);const u=[];c.calcDeltas(u,l,o),c.calcDeltas(u,o,l),c.addDeltas(u,i)}static fillParent(t,e,i){const r=i.length,s=e.length;for(let a=0;a<s;a+=4){const s=e[a],o=e[a+1],l=e[a+2],c=t[s][o-1],h=t[s][o];let u=8092,f=-1;for(let e=0;e<r;e+=4){if(i[e+2]!==l)continue;const r=i[e],s=i[e+1],a=t[r][s-1],o=t[r][s];switch(l){case 0:case 1:if(Object(n.a)(c.y,a.y,o.y)&&Object(n.a)(h.y,a.y,o.y)){const t=Math.abs(o.y-a.y);t<u&&(u=t,f=e)}break;case 2:case 3:if(Object(n.a)(c.x,a.x,o.x)&&Object(n.a)(h.x,a.x,o.x)){const t=Math.abs(o.x-a.x);t<u&&(u=t,f=e)}}}e[a+3]=f}}static calcDeltas(t,e,i){const r=e.length;for(let s=0;s<r;s+=4){const r=[],n=c.calcDelta(s,e,i,r);t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(n)}}static calcDelta(t,e,i,r){const s=e[t+3];if(-1===s)return 0;const n=r.length;return n>1&&r[n-2]===s?0:(r.push(s),c.calcDelta(s,i,e,r)+1)}static addDeltas(t,e){const i=t.length;let r=0;for(let s=0;s<i;s+=4){const e=t[s+3];e>r&&(r=e)}for(let s=0;s<i;s+=4){const i=e[t[s]],n=t[s+1],a=r-t[s+3];switch(t[s+2]){case 0:i[n-1].x-=a,i[n].x-=a,1===n&&(i[i.length-1].x-=a),n===i.length-1&&(i[0].x-=a);break;case 1:i[n-1].x+=a,i[n].x+=a,1===n&&(i[i.length-1].x+=a),n===i.length-1&&(i[0].x+=a);break;case 2:i[n-1].y-=a,i[n].y-=a,1===n&&(i[i.length-1].y-=a),n===i.length-1&&(i[0].y-=a);break;case 3:i[n-1].y+=a,i[n].y+=a,1===n&&(i[i.length-1].y+=a),n===i.length-1&&(i[0].y+=a)}}}}},588:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var r=i(115);function s(t,e){return t.x===e.x&&t.y===e.y}function n(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let r=1;r<e;r++)s(t[r],t[i])||++i===r||(t[i]=t[r]);t.length=i+1}function a(t,e){return t.x=e.y,t.y=-e.x,t}function o(t,e){return t.x=-e.y,t.y=e.x,t}function l(t,e){return t.x=e.x,t.y=e.y,t}function c(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function u(t,e){return t.x*e.y-t.y*e.x}function f(t,e){return t.x*e.x+t.y*e.y}function d(t,e,i,r){return t.x=e.x*i+e.y*r,t.y=e.x*r-e.y*i,t}class y{constructor(t,e,i){this.writeVertex=t,this.writeTriangle=e,this.canUseThinTessellation=i,this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.textureNormalLeft={x:0,y:1},this.textureNormalRight={x:0,y:-1},this.textureNormal={x:void 0,y:void 0},this.joinNormal={x:void 0,y:void 0},this.inner={x:void 0,y:void 0},this.outer={x:void 0,y:void 0},this.roundStart={x:void 0,y:void 0},this.roundEnd={x:void 0,y:void 0},this.startBreak={x:void 0,y:void 0},this.endBreak={x:void 0,y:void 0},this.innerPrev={x:void 0,y:void 0},this.innerNext={x:void 0,y:void 0},this.bevelStart={x:void 0,y:void 0},this.bevelEnd={x:void 0,y:void 0},this.bevelMiddle={x:void 0,y:void 0}}tessellate(t,e){n(t),this.canUseThinTessellation&&e.halfWidth<r.K&&!e.offset?this.tessellateThin_(t,e):this.tessellate_(t,e)}tessellateThin_(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let r=e.initialDistance||0,s=!1,n=t[0].x,a=t[0].y;const o=t.length;for(let l=1;l<o;++l){s&&(s=!1,r=0);let e=t[l].x,o=t[l].y,c=e-n,h=o-a,u=Math.sqrt(c*c+h*h);if(c/=u,h/=u,r+u>i){s=!0;const t=(i-r)/u;u=i-r,e=(1-t)*n+t*e,o=(1-t)*a+t*o,--l}const f=this.writeVertex(n,a,0,0,c,h,h,-c,0,-1,r),d=this.writeVertex(n,a,0,0,c,h,-h,c,0,1,r);r+=u;const y=this.writeVertex(e,o,0,0,c,h,h,-c,0,-1,r),x=this.writeVertex(e,o,0,0,c,h,-h,c,0,1,r);this.writeTriangle(f,d,y),this.writeTriangle(d,y,x),n=e,a=o}}tessellate_(t,e){const i=t[0],r=t[t.length-1],n=s(i,r),y=n?3:2;if(t.length<y)return;const x=e.pixelCoordRatio,m=null!=e.capType?e.capType:0,p=null!=e.joinType?e.joinType:2,_=null!=e.miterLimit?Math.min(e.miterLimit,4):2,g=null!=e.roundLimit?Math.min(e.roundLimit,1.05):1.05,b=null!=e.halfWidth?e.halfWidth:2,v=!!e.textured;let M,O,w=null,S=null;const j=this.prevNormal,I=this.nextNormal;let T=-1,z=-1;const L=this.joinNormal;let P,C;const k=this.textureNormalLeft,V=this.textureNormalRight,F=this.textureNormal;let E=-1,R=-1;const A=e.wrapDistance||65535;let W=e.initialDistance||0;const B=this.writeVertex,D=this.writeTriangle,N=function(t,e,i,r,s,n){const a=B(M,O,P,C,i,r,t,e,s,n,W);return E>=0&&R>=0&&a>=0&&D(E,R,a),E=R,R=a,a};n&&(w=t[t.length-2],I.x=r.x-w.x,I.y=r.y-w.y,z=h(I),I.x/=z,I.y/=z);let Z=!1;for(let s=0;s<t.length;++s){if(Z&&(Z=!1,W=0),w&&(j.x=-I.x,j.y=-I.y,T=z,W+T>A&&(Z=!0)),Z){const e=(A-W)/T;T=A-W,w={x:(1-e)*w.x+e*t[s].x,y:(1-e)*w.y+e*t[s].y},--s}else w=t[s];M=w.x,O=w.y;const e=s<=0&&!Z,i=s===t.length-1;if(e||(W+=T),S=i?n?t[1]:null:t[s+1],S?(I.x=S.x-M,I.y=S.y-O,z=h(I),I.x/=z,I.y/=z):(I.x=void 0,I.y=void 0),!n){if(e){o(L,I),P=L.x,C=L.y,2===m&&(N(-I.y-I.x,I.x-I.y,I.x,I.y,0,-1),N(I.y-I.x,-I.x-I.y,I.x,I.y,0,1)),1===m&&(N(-I.y-I.x,I.x-I.y,I.x,I.y,-1,-1),N(I.y-I.x,-I.x-I.y,I.x,I.y,-1,1)),1!==m&&0!==m||(N(-I.y,I.x,I.x,I.y,0,-1),N(I.y,-I.x,I.x,I.y,0,1));continue}if(i){a(L,j),P=L.x,C=L.y,1!==m&&0!==m||(N(j.y,-j.x,-j.x,-j.y,0,-1),N(-j.y,j.x,-j.x,-j.y,0,1)),2===m&&(N(j.y-j.x,-j.x-j.y,-j.x,-j.y,0,-1),N(-j.y-j.x,j.x-j.y,-j.x,-j.y,0,1)),1===m&&(N(j.y-j.x,-j.x-j.y,-j.x,-j.y,1,-1),N(-j.y-j.x,j.x-j.y,-j.x,-j.y,1,1));continue}}let r,y,B=-u(j,I);if(Math.abs(B)<.01)f(j,I)>0?(L.x=j.x,L.y=j.y,B=1,r=Number.MAX_VALUE,y=!0):(o(L,I),B=1,r=1,y=!1);else{L.x=(j.x+I.x)/B,L.y=(j.y+I.y)/B,r=h(L);const t=(r-1)*b*x;y=r>4||t>T&&t>z}P=L.x,C=L.y;let D=p;switch(p){case 0:r<1.05&&(D=2);break;case 1:r<g&&(D=2);break;case 2:r>_&&(D=0)}switch(D){case 2:if(N(L.x,L.y,-j.x,-j.y,0,-1),N(-L.x,-L.y,-j.x,-j.y,0,1),i)break;if(v){const t=Z?0:W;E=this.writeVertex(M,O,P,C,I.x,I.y,L.x,L.y,0,-1,t),R=this.writeVertex(M,O,P,C,I.x,I.y,-L.x,-L.y,0,1,t)}break;case 0:{const t=B<0;let e,r,s,n;if(t){const t=E;E=R,R=t,e=k,r=V}else e=V,r=k;if(y)s=t?o(this.innerPrev,j):a(this.innerPrev,j),n=t?a(this.innerNext,I):o(this.innerNext,I);else{const e=t?c(this.inner,L):l(this.inner,L);s=e,n=e}const h=t?a(this.bevelStart,j):o(this.bevelStart,j);N(s.x,s.y,-j.x,-j.y,e.x,e.y);const u=N(h.x,h.y,-j.x,-j.y,r.x,r.y);if(i)break;const f=t?o(this.bevelEnd,I):a(this.bevelEnd,I);if(y){const t=this.writeVertex(M,O,P,C,-j.x,-j.y,0,0,0,0,W);E=this.writeVertex(M,O,P,C,I.x,I.y,n.x,n.y,e.x,e.y,W),R=this.writeVertex(M,O,P,C,I.x,I.y,f.x,f.y,r.x,r.y,W),this.writeTriangle(u,t,R)}else{if(v){const t=this.bevelMiddle;t.x=(h.x+f.x)/2,t.y=(h.y+f.y)/2,d(F,t,-j.x,-j.y),N(t.x,t.y,-j.x,-j.y,F.x,F.y),d(F,t,I.x,I.y),E=this.writeVertex(M,O,P,C,I.x,I.y,t.x,t.y,F.x,F.y,W),R=this.writeVertex(M,O,P,C,I.x,I.y,n.x,n.y,e.x,e.y,W)}else{const t=E;E=R,R=t}N(f.x,f.y,I.x,I.y,r.x,r.y)}if(t){const t=E;E=R,R=t}break}case 1:{const t=B<0;let e,s;if(t){const t=E;E=R,R=t,e=k,s=V}else e=V,s=k;const n=t?c(this.inner,L):l(this.inner,L);let h,u;y?(h=t?o(this.innerPrev,j):a(this.innerPrev,j),u=t?a(this.innerNext,I):o(this.innerNext,I)):(h=n,u=n);const x=t?a(this.roundStart,j):o(this.roundStart,j),m=t?o(this.roundEnd,I):a(this.roundEnd,I),p=N(h.x,h.y,-j.x,-j.y,e.x,e.y),_=N(x.x,x.y,-j.x,-j.y,s.x,s.y);if(i)break;const g=this.writeVertex(M,O,P,C,-j.x,-j.y,0,0,0,0,W);y||this.writeTriangle(E,R,g);const b=c(this.outer,n),w=this.writeVertex(M,O,P,C,I.x,I.y,m.x,m.y,s.x,s.y,W);let S,T;const z=r>2;if(z){let e;r!==Number.MAX_VALUE?(b.x/=r,b.y/=r,e=f(j,b),e=(r*(e*e-1)+1)/e):e=-1,S=t?a(this.startBreak,j):o(this.startBreak,j),S.x+=j.x*e,S.y+=j.y*e,T=t?o(this.endBreak,I):a(this.endBreak,I),T.x+=I.x*e,T.y+=I.y*e}d(F,b,-j.x,-j.y);const A=this.writeVertex(M,O,P,C,-j.x,-j.y,b.x,b.y,F.x,F.y,W);d(F,b,I.x,I.y);const D=v?this.writeVertex(M,O,P,C,I.x,I.y,b.x,b.y,F.x,F.y,W):A,Z=g,K=v?this.writeVertex(M,O,P,C,I.x,I.y,0,0,0,0,W):g;let G=-1,q=-1;if(z&&(d(F,S,-j.x,-j.y),G=this.writeVertex(M,O,P,C,-j.x,-j.y,S.x,S.y,F.x,F.y,W),d(F,T,I.x,I.y),q=this.writeVertex(M,O,P,C,I.x,I.y,T.x,T.y,F.x,F.y,W)),v?z?(this.writeTriangle(Z,_,G),this.writeTriangle(Z,G,A),this.writeTriangle(K,D,q),this.writeTriangle(K,q,w)):(this.writeTriangle(Z,_,A),this.writeTriangle(K,D,w)):z?(this.writeTriangle(g,_,G),this.writeTriangle(g,G,q),this.writeTriangle(g,q,w)):(this.writeTriangle(g,_,A),this.writeTriangle(g,D,w)),y?(E=this.writeVertex(M,O,P,C,I.x,I.y,u.x,u.y,e.x,e.y,W),R=w):(E=v?this.writeVertex(M,O,P,C,I.x,I.y,u.x,u.y,e.x,e.y,W):p,this.writeTriangle(E,K,w),R=w),t){const t=E;E=R,R=t}break}}}}}},616:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var r=i(88),s=i(87),n=i(282),a=i(126),o=i(302),l=i(447),c=i(373);const h=s.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");async function u(t,e,i,r){switch(t.type){case"simple":return f.fromBasicRenderer(t,e,i,r);case"map":return x.fromUVRenderer(t,e,i,r);case"interval":return y.fromCBRenderer(t,e,i,r);case"dictionary":return _.fromDictionaryRenderer(t,e,i,r);case"subtype":return d.fromSubtypes(t,e,i,r)}}class f{constructor(){this.type="feature",this._defaultResult=null}static async fromBasicRenderer(t,e,i,r){const s=new f;if(t.symbol){const n=await Object(c.b)(t.symbol,i,r),a=e.createTemplateGroup(n,null);s.setDefault(a)}return s}size(){return 1}getDefault(){return this._defaultResult}setDefault(t){this._defaultResult=t}match(t,e,i,r,s){return this.getDefault()}async analyze(t,e,i,r,s,n){return null}}class d extends f{constructor(t,e){super(),this._subMatchers=t,this._subtypeField=e}static async fromSubtypes(t,e,i,r){const s=new Map,n=[];for(const a in t.renderers){const o=parseInt(a,10),l=u(t.renderers[a],e,i,r).then((t=>s.set(o,t)));n.push(l)}return await Promise.all(n),new d(s,t.subtypeField)}match(t,e,i,r,s){const n=e.readAttribute(this._subtypeField),a=this._subMatchers.get(n);return a?a.match(t,e,i,r,s):null}}class y extends f{constructor(t,e,i,r){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=e,this._fieldIndex=r,this._field=t,this._normalizationInfo=i}static async fromCBRenderer(t,e,i,r){const{isMaxInclusive:s,normalizationField:n,normalizationTotal:a,normalizationType:o}=t,l=t.field,h=new y(l,s,{normalizationField:n,normalizationTotal:a,normalizationType:o},t.fieldIndex),u=await Object(c.b)(t.backgroundFillSymbol,i,r);await Promise.all(t.intervals.map((async t=>{const s=await Object(c.b)(t.symbol,i,r),n=await e.createTemplateGroup(s,u),a={min:t.min,max:t.max};h.add(a,n)})));const f=await Object(c.b)(t.defaultSymbol,i,r);if(f){const t=await e.createTemplateGroup(f,u);h.setDefault(t)}return h}add(t,e){this._intervals.push({interval:t,result:e}),this._intervals.sort(((t,e)=>t.interval.min-e.interval.min))}size(){return super.size()+this._intervals.length}match(t,e,i,r,s){if(null==this._fieldIndex&&!this._field)return this.getDefault();const n=null!=this._fieldIndex?e.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(e);if(!n&&(null==n||isNaN(n)))return this.getDefault();for(let a=0;a<this._intervals.length;a++){const{interval:t,result:e}=this._intervals[a],i=n>=t.min,r=this._isMaxInclusive?n<=t.max:n<t.max;if(i&&r)return e}return this.getDefault()}_needsNormalization(){const t=this._normalizationInfo;return t&&(t.normalizationField||t.normalizationTotal||t.normalizationType)}_getValueFromField(t){const e=t.readAttribute(this._field);if(!this._needsNormalization()||null==e)return e;const{normalizationField:i,normalizationTotal:r,normalizationType:s}=this._normalizationInfo,n=!!i&&t.readAttribute(i);if(s)switch(s){case"esriNormalizeByField":return n?e/n:void 0;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return e/r*100;default:return void h.error(`Found unknown normalization type: ${s}`)}else h.error("Normalization is required, but no type was set!")}}class x extends f{constructor(t,e,i){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=i,this._fields=t,this._seperator=e||""}static async fromUVRenderer(t,e,i,r){const s=t.fieldDelimiter,n=[t.field];t.field2&&n.push(t.field2),t.field3&&n.push(t.field3);const a=await Object(c.b)(t.backgroundFillSymbol,i,r),o=new x(n,s,t.fieldIndex);await Promise.all(t.map.map((async t=>{const s=await Object(c.b)(t.symbol,i,r),n=await e.createTemplateGroup(s,a);"<Null>"===t.value?o.setNullResult(n):o.add(t.value,n)})));const l=await Object(c.b)(t.defaultSymbol,i,r);if(l){const t=await e.createTemplateGroup(l,a);o.setDefault(t)}return o}setNullResult(t){this._nullResult=t}add(t,e){this._resultsMap.set(t.toString(),e)}size(){return super.size()+this._resultsMap.size}match(t,e,i,r,s){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const n=null!=this._fieldsIndex?e.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(e);if(null!==this._nullResult&&(null==n||""===n||"<Null>"===n))return this._nullResult;if(!n&&null==n)return this.getDefault();const a=n.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()}_getValueFromFields(t){const e=[];for(const i of this._fields){const r=t.readAttribute(i);null==r||""===r?e.push("<Null>"):e.push(r)}return e.join(this._seperator)}}let m;async function p(){return m||(m=Promise.all([i.e(3),i.e(4),i.e(13),i.e(19),i.e(119)]).then(i.bind(null,503))),m}class _ extends f{constructor(t,e,i,r,s){super(),this.type="dictionary",this._groupIdCache=new n.a(100),this._renderer=t,this._fieldMap=t.fieldMap,this._symbolFields=t.getSymbolFields(),this._templates=e,this._info=i,this._scaleFn=r,this._schemaUtilsModule=s}static async fromDictionaryRenderer(t,e,r,s){const[{default:n},o]=await Promise.all([Promise.all([i.e(3),i.e(4),i.e(13),i.e(149)]).then(i.bind(null,208)),p()]),c=n.fromJSON(t.renderer);await c.fetchResources({spatialReference:r.spatialReference,fields:r.fields});const h=await async function(t,e){const i=t||1;if("number"==typeof i)return(t,e,r)=>i;const r=await Object(a.d)(i,e.spatialReference,e.fields);return(t,i,s)=>Object(l.a)(r,t,{$view:s},e.geometryType,i)||1}(c.scaleExpression,r);return new _(c,e,r,h,o)}async _analyzeFeature(t,e,i,s,n){const a=t.readLegacyFeature(),l=this._scaleFn(a,i,s),u=this._attributeHash(a)+"-"+l,f=this._groupIdCache.get(u);if(f)return f;const d={...s,spatialReference:this._info.spatialReference,abortOptions:n,fields:this._info.fields},y=await this._renderer.getSymbolAsync(a,d),x=this._schemaUtilsModule.createSymbolSchema(y,this._renderer),m=Object(c.b)(x,this._info,e,n).then((t=>{if("expanded-cim"!==t.type)return h.error(new r.a("mapview-bad-type",`Found unexpected type ${t.type} in dictionary response`)),null;t.hash+="-"+l;for(const e of t.layers)e.scaleFactor=l,e.templateHash+="-"+l,"text"===e.type&&"string"==typeof e.text&&e.text.indexOf("[")>-1&&(e.text=Object(o.c)(this._fieldMap,e.text,e.cim.textCase));return this._templates.createTemplateGroup(t,null)}));return this._groupIdCache.put(u,m,1),m}async analyze(t,e,i,r,s,n){const a=e.getCursor(),o=[];for(;a.next();)o.push(this._analyzeFeature(a,i,r,s,n));return Promise.all(o)}match(t,e,i,r,s){return null}_attributeHash(t){let e="";for(const i of this._symbolFields){const r=this._fieldMap[i];r&&(e+=t.attributes[r]+"-")}return e}}},625:function(t,e,i){"use strict";i.d(e,"a",(function(){return x}));i(679),i(578);var r=i(329),s=(i(641),i(662),i(115)),n=i(293),a=i(130),o=i(159);const l=new Map;l.set(a.d.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),l.set(a.d.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),l.set(a.d.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),l.set(a.d.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),l.set(a.d.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var c=i(424);class h{constructor(t,e,i){this._start={index:0,vertex:0};const r=function(t,e,i){const{indicesPerRecord:r,multiplier:n,verticesPerRecord:a}=l.get(t);return{recordBytes:i*s.k*Uint32Array.BYTES_PER_ELEMENT,indexBytes:n*r*i*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:n*a*i*e}}(t,e,i),n=e/4;this.geometryType=t,this._records=new c.a(Int32Array,r.recordBytes),this._indices=new c.a(Uint32Array,r.indexBytes),this._vertices=new c.a(Uint32Array,r.vertexBytes),this._metrics=new c.a(Float32Array,0),this._strideInt=n}serialize(t){const e=this._records.buffer(),i=this._indices.buffer(),r=this._vertices.buffer(),s=this._metrics.length?this._metrics.buffer():null,n=4*this._strideInt;return t.push(e,i,r),{stride:n,records:e,indices:i,vertices:r,metrics:s}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/s.k}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(t){this._vertices.ensureSize(t)}indexEnsureSize(t){this._indices.ensureSize(t)}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(t,e,i,r,s,n,a,o){this._records.push(t),this._records.push(e),this._records.push(i),this._records.push(r),this._records.push(s),this._records.push(n),this._records.push(a),this._records.writeF32(o)}writeIndex(t){this._indices.push(t)}writeVertex(t){this._vertices.push(t)}writeVertexF32(t){this._vertices.writeF32(t)}copyLastFrom(t,e,i){const r=t._records.length-s.k,n=t._records.getValue(r),a=t._records.getValue(r+1),o=t._records.getValue(r+2),l=t._records.getValue(r+4),c=t._records.getValue(r+6),h=t._records.getValue(r+7),u=this._vertices.length,f=(t._start.vertex-this._vertices.length)/this._strideInt,d=this._indices.length,y=this.vertexCount;for(let s=t._start.index;s!==t._indices.length;s++){const e=t._indices.getValue(s);this._indices.push(e-f)}for(let s=t._start.vertex;s!==t._vertices.length;s++){const e=t._vertices.getValue(s);this._vertices.push(e)}for(let s=u;s<=this._vertices.length;s+=this._strideInt)this._vertices.i1616Add(s,e,i);this._records.push(n),this._records.push(a),this._records.push(o),this._records.push(d),this._records.push(l),this._records.push(y),this._records.push(c),this._records.push(h)}}var u=i(586);const f=128;function d(t){switch(t){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case f:return 1}}function y(t){switch(t){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case f:return 1}}class x{constructor(t,e,i,r,s){this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=e,this.tileKey=t,this._hasAggregate=r,this._pixelBufferEnabled=s,this._strideOptions=i}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(t){const e=[];return e.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach(((i,s)=>{const n=1<<s,a=d(n),o=y(n),l=Object(u.a)(new r.a(this.tileKey),a,o,t),c=this._serializeTileVertexData(this.tileKey,l.id,i.vertexData);c.message.bufferIds=i.displayIds,e.push(c)})),e}_serializeTileVertexData(t,e,i){var r,s,n,o,l;const c=new Array;return{message:{tileKeyOrigin:t,tileKey:e,data:{[a.d.MARKER]:null==(r=i.get(a.d.MARKER))?void 0:r.serialize(c),[a.d.FILL]:null==(s=i.get(a.d.FILL))?void 0:s.serialize(c),[a.d.LINE]:null==(n=i.get(a.d.LINE))?void 0:n.serialize(c),[a.d.TEXT]:null==(o=i.get(a.d.TEXT))?void 0:o.serialize(c),[a.d.LABEL]:null==(l=i.get(a.d.LABEL))?void 0:l.serialize(c)}},transferList:c}}featureStart(t,e){this._current.insertAfter=t,this._current.sortKey=e}featureEnd(){}recordStart(t,e,i,r){this._current.writer=this._getVertexWriter(i),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=r,this._current.id=t,this._current.materialKey=e,this._current.geometryType=i,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexEnsureSize(t){this._current.writer.vertexEnsureSize(t)}indexEnsureSize(t){this._current.writer.indexEnsureSize(t)}vertexBounds(t,e,i,r){this._current.bufferingEnabled&&this._addOverlap(t,e,i,r)}vertexWrite(t){this._current.writer.writeVertex(t)}vertexWriteF32(t){this._current.writer.writeVertexF32(t)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(t){this._current.writer.writeIndex(t)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(t,e,i,r,s,o,l,c){this._current.writer=this._getVertexWriter(a.d.LABEL);const h=this._current.writer.metricWriter;h.push(Object(n.f)(t)),h.push(e),h.push(i),h.push(r),h.push(s),h.push(o),h.push(l),h.push(c),h.push(255),this._current.metricBoxLenPointer=h.push(0)}metricEnd(){const t=this._current.writer.metricWriter;0===t.getValue(this._current.metricBoxLenPointer)&&t.seek(t.length-10)}metricBoxWrite(t,e,i,r){const s=this._current.writer.metricWriter;s.incr(this._current.metricBoxLenPointer),s.push(0),s.push(0),s.push(t),s.push(e),s.push(i),s.push(r)}recordEnd(){const t=this._current.indexStart,e=this._current.writer.indexCount;if(t===e)return!1;this.hasRecords=!0;const i=e-t,r=this._current.vertStart,n=this._current.writer.vertexCount-r;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,t,i,r,n,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===a.d.LABEL)return!0;const l=this._current.writer;for(let a=0;a<8;a++){const t=1<<a;if(this._current.overlaps&t){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});const e=this._data.neighbors[a],i=this._current.geometryType;if(!e.vertexData.has(i)){const t=Object(o.n)(i,this._strideOptions).geometry,r=new h(i,t,s.v);e.vertexData.set(i,r)}const r=e.vertexData.get(this._current.geometryType),n=8,c=512*-d(t)*n,u=512*-y(t)*n;r.copyLastFrom(l,c,u),e.displayIds.add(this._current.id)}}return!0}_addOverlap(t,e,i,r){const n=255^((t<0+i?148:t>=s.L-i?41:189)|(e<0+r?224:e>=s.L-r?7:231));this._current.overlaps|=n}_getVertexWriter(t){if(!this._data.self.has(t)){const e=this._data.self,i=Object(o.n)(t,this._strideOptions).geometry;e.set(t,new h(t,i,this.hint.records))}return this._data.self.get(t)}}},626:function(t,e,i){"use strict";i.d(e,"a",(function(){return V}));i(82);var r=i(85),s=i(91),n=i(455),a=i(293),o=i(88),l=i(87),c=i(113),h=i(101),u=i(292),f=i(220),d=i(115),y=i(130),x=i(161),m=i(154),p=i(680),_=i(229);function g(t){return t.length-1}function b(t){let e=0;for(let i=0;i<g(t);i++)e+=v(t,i);return e}function v(t,e,i=1){const[r,s]=function(t,e){return t[e+1]}(t,e);return Math.sqrt(r*r+s*s)*i}class M{constructor(t,e,i,r,s){this._segments=t,this._index=e,this._distance=i,this._xStart=r,this._yStart=s,this._done=!1}static create(t){return new M(t,0,0,t[0][0],t[0][1])}clone(){return new M(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let i=Math.acos(e);return t>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<g(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const i=this.backwardLength;if(t<=i)return this._distance=(i-t)/this.length,this;let r=this.backwardLength;for(;this.prev();){if(r+this.length>t)return this._seekBackwards(t-r);r+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>t)return this.seek(t-i,e);i+=this.length}return this._distance=1,e?this:null}}function O(t,e,i,r=!0){const s=b(t),n=M.create(t),a=s/2;if(!r)return n.seek(a),void i(n.clone(),0,a+0*e,s);const o=Math.max((s-e)/2,0),l=Math.floor(o/e),c=a-l*e;n.seek(c);for(let h=-l;h<=l;h++)n.x<512&&n.x>=0&&n.y<512&&n.y>=0&&i(n.clone(),h,a+h*e,s),n.seek(e)}function w(t,e){const i=1e-6;if(e<=0)return;const r=t.length;if(r<3)return;const s=[];let n=0;s.push(0);for(let u=1;u<r;u++)n+=Object(_.c)(t[u],t[u-1]),s.push(n);e=Math.min(e,.2*n);const a=[];a.push(t[0][0]),a.push(t[0][1]);const o=t[r-1][0],l=t[r-1][1],c=Object(_.h)([0,0],t[0],t[1]);Object(_.g)(c),t[0][0]+=e*c[0],t[0][1]+=e*c[1],Object(_.h)(c,t[r-1],t[r-2]),Object(_.g)(c),t[r-1][0]+=e*c[0],t[r-1][1]+=e*c[1];for(let u=1;u<r;u++)s[u]+=e;s[r-1]+=e;const h=.5*e;for(let u=1;u<r-1;u++){let n=0,o=0,l=0;for(let r=u-1;r>=0&&!(s[r+1]<s[u]-h);r--){const a=h+s[r+1]-s[u],c=s[r+1]-s[r],f=s[u]-s[r]<h?1:a/c;if(Math.abs(f)<i)break;const d=f*f,y=f*a-.5*d*c,x=f*c/e,m=t[r+1],p=t[r][0]-m[0],_=t[r][1]-m[1];n+=x/y*(m[0]*f*a+.5*d*(a*p-c*m[0])-d*f*c*p/3),o+=x/y*(m[1]*f*a+.5*d*(a*_-c*m[1])-d*f*c*_/3),l+=x}for(let a=u+1;a<r&&!(s[a-1]>s[u]+h);a++){const r=h-s[a-1]+s[u],c=s[a]-s[a-1],f=s[a]-s[u]<h?1:r/c;if(Math.abs(f)<i)break;const d=f*f,y=f*r-.5*d*c,x=f*c/e,m=t[a-1],p=t[a][0]-m[0],_=t[a][1]-m[1];n+=x/y*(m[0]*f*r+.5*d*(r*p-c*m[0])-d*f*c*p/3),o+=x/y*(m[1]*f*r+.5*d*(r*_-c*m[1])-d*f*c*_/3),l+=x}a.push(n/l),a.push(o/l)}a.push(o),a.push(l);for(let u=0,f=0;u<r;u++)t[u][0]=a[f++],t[u][1]=a[f++]}var S=i(493);const j=l.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");const I=function(t){const e=new Map;return i=>(e.has(i)||e.set(i,t(i)),e.get(i))}((t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e})),T=t=>Math.floor(127*t+127),z=t=>Math.floor(10*t),L=t=>Math.round(t*(254/360));class P extends S.a{constructor(t,e,i,r){var s,n,a;super(t,i.font.size,i.haloSize||0,i.font.size,i.color&&Object(f.d)(i.color)||0,i.haloColor&&Object(f.d)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,Object(p.a)(e.labelPlacement)?1:0,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null,null,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=y.d.LABEL,this._allowOverrun=null!=(s=e.allowOverrun)&&s,this._repeatLabel=null==(n=e.repeatLabel)||n,this._labelPosition=null!=(a=e.labelPosition)?a:"curved";const o=function(t,e){const i=!!t.minScale&&e.scaleToZoom(t.minScale)||0;return Object(c.e)(i,0,25.5)}(e,r),l=function(t,e){const i=!!t.maxScale&&e.scaleToZoom(t.maxScale)||255;return Object(c.e)(i,0,25.5)}(e,r),x=e.labelPlacement,[_,g]=Object(u.c)(x);this._xAlignD=_,this._yAlignD=g,this._minZoom=o,this._maxZoom=l,this._refPlacementPadding=Object(h.g)(i.haloSize)+d.J,this._repeatLabelDistance=e.repeatLabelDistance?Object(h.g)(e.repeatLabelDistance):128;const b=m.b.load(t);b.sdf=!0,this._materialKey=b.data}static fromLabelClass(t,e){if("esriServerLinePlacementCenterAlong"===t.labelPlacement){const e=t.symbol;e.xoffset=0,e.yoffset=0,e.angle=0,e.font.decoration="none"}return new P(t.materialKey,t,t.symbol,e)}get _shapedBox(){return Object(r.t)(this._shapingInfo).bounds}setZoomLevel(t){this._zoomLevel=t}bindReferenceTemplate(t){let e=Object(u.f)(this._xAlignD),i=Object(u.h)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(r.k)(t))return void(this._refSymbolAndPlacementOffset=Object(x.b)(0,0,T(e),T(i)));if("circle"===t.boundsType&&(e||i)){const t=Math.sqrt(e*e+i*i);e/=t,i/=t}const s=Math.max(t.height,t.width),n=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(x.b)(n,s,T(e),T(i)),this._referenceSize=s,this._refPlacementDirX=e,this._refPlacementDirY=i,this._refOffsetX=t.xOffset,this._refOffsetY=t.yOffset}_write(t,e){if(Object(r.k)(this._shapingInfo))return;const i=this._shapingInfo,s=e.getDisplayId(),n="esriGeometryPolygon"===e.geometryType?e.readLegacyCentroid():e.readLegacyGeometry();if(n)switch(this.current={out:t,inId:s,inShaping:i,zoomLevel:this._zoomLevel},e.geometryType){case"esriGeometryPolyline":this._placeLineLabels(n);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(n);break;default:((t,e="mapview-labeling")=>{j.error(new o.a(e,t))})("mapview-labeling",`Geometry of type ${e.geometryType} is not supported`)}}_isVisible(t,e){const i=z(this.current.zoomLevel);return z(t)<=i&&i<=z(e)}_placePointLabels(t){const{out:e,inId:i,inShaping:r}=this.current;this._writeGlyphs(e,i,t,r)}_placeLineLabels(t){const e=function(t,e){const i=e;for(let r=0;r<t.length;r++){let e=t[r];const s=[];s.push(e[0]);for(let t=1;t<e.length;t++){let[i,r]=s[t-1];i+=e[t][0],r+=e[t][1],s.push([i,r])}w(s,i);const n=[];n.push(s[0]);for(let t=1;t<s.length;t++){const[e,i]=s[t-1],[r,a]=s[t],o=Math.round(r-e),l=Math.round(a-i);n.push([o,l])}t[r]=n,e=n}return t}(t.paths,this.current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),r=(this._shapedBox.width+this._repeatLabelDistance)/2;for(const s of e)O(s,r,i,this._repeatLabel)}_placeSubdivGlyphs(t,e,i,r){const s=I(e),n=this._shapedBox.width/2,a=Math.sqrt(this._repeatLabelDistance)/2,o=Math.min(i,r-i),l=Math.log2(o/(a+n/2)),c=0===e?l:Math.min(s,l),h=Math.max(this._minZoom,this.current.zoomLevel+1-c),u=this.current.zoomLevel-h,f=this._shapedBox.width/2*2**u;this.current.inShaping.isMultiline?0===e&&this._placeStraight(t,h):this._allowOverrun&&u<0?this._placeStraightAlong(t,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(t,h):"curved"===this._labelPosition&&this._placeCurved(t,h,f)}_placeStraight(t,e){const{out:i,inId:r,inShaping:s}=this.current;this._writeGlyphs(i,r,t,s,e)}_placeCurved(t,e,i){const{out:r,inId:s}=this.current;r.metricStart(s,e,t.x,t.y,0,0,0,0);const n=t.clone(),a=t.angle*(180/Math.PI)%360,o=(t.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=L(a),this._placeFirst(n,e,1),this._placeBack(t,n,e,i,1),this._placeForward(t,n,e,i,1),this._outLineLabelAngle=L(o),this._placeFirst(n,e,0),this._placeBack(t,n,e,i,0),this._placeForward(t,n,e,i,0),r.metricEnd()}_placeStraightAlong(t,e){const{out:i,inId:r}=this.current;i.metricStart(r,e,t.x,t.y,0,0,0,0);const s=t.clone(),n=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=L(n),this._placeFirst(s,e,1,!0),this._outLineLabelAngle=L(a),this._placeFirst(s,e,0,!0),i.metricEnd()}_placeBack(t,e,i,r,s){const n=t.clone();let a=t.backwardLength+0;for(;n.prev()&&!(a>=r);)this._placeOnSegment(n,e,a,i,-1,s),a+=n.length+0}_placeForward(t,e,i,r,s){const n=t.clone();let a=t.remainingLength+0;for(;n.next()&&!(a>=r);)this._placeOnSegment(n,e,a,i,1,s),a+=n.length+0}_placeFirst(t,e,i,r=!1){const s=t,n=this.current.inShaping,a=n.glyphs,o=this.current.zoomLevel,{out:l,inId:c}=this.current;for(const h of a){const a=h.x>n.bounds.x?i:1-i,u=a*t.remainingLength+(1-a)*t.backwardLength,f=Math.abs(h.x+h.width/2-n.bounds.x),d=Math.max(0,o+Math.log2(f/(u+0))),y=Math.max(e,r?0:d);if(h.maxZoom=25,h.angle=t.angle+(1-i)*Math.PI,h.minZoom=y,this._writeGlyph(l,c,s.x,s.y,h),i&&this._isVisible(h.minZoom,h.maxZoom)){const t=h.bounds;l.metricBoxWrite(t.center[0],t.center[1],t.width,t.height)}}}_placeOnSegment(t,e,i,r,s,n){const a=this.current.inShaping.glyphs,{out:o,inId:l}=this.current,c=this.current.inShaping,h=this.current.zoomLevel,u=t.dx/t.length,f=t.dy/t.length,d={x:t.x+i*-s*u,y:t.y+i*-s*f};for(const y of a){const a=y.x>c.bounds.x?n:1-n;if(!(a&&1===s||!a&&-1===s))continue;const u=Math.abs(y.x+y.width/2-c.bounds.x),f=Math.max(0,h+Math.log2(u/i)-.1),x=Math.max(r,h+Math.log2(u/(i+t.length+0)));if(0!==f&&(y.angle=t.angle+(1-n)*Math.PI,y.minZoom=x,y.maxZoom=f,this._writeGlyph(o,l,d.x,d.y,y),n&&this._isVisible(y.minZoom,y.maxZoom))){const i=y.bounds,r=t.x-e.x,s=t.y-e.y;o.metricBoxWrite(i.center[0]+r,i.center[1]+s,i.width,i.height)}}}_writeGlyphs(t,e,i,r,s=this._minZoom){if(i.x<0||i.x>=512||i.y<0||i.y>=512)return;const n=i.x+this._refOffsetX,a=i.y-this._refOffsetY;for(const h of r.glyphs)h.minZoom=s,h.maxZoom=this._maxZoom,this._writeGlyph(t,e,n,a,h);const o=this._refPlacementDirX,l=this._refPlacementDirY,c=r.boundsT;t.metricStart(e,s,n,a,o,l,this._referenceSize,this._materialKey),t.metricBoxWrite(c.center[0],c.center[1],c.width,c.height),t.metricEnd()}_writeVertexCommon(t,e,i,r){const s=this._color,n=this._haloColor,a=Object(x.b)(0,0,this._size,this._haloSize),o=Math.max(r.minZoom,this._minZoom),l=Math.min(r.maxZoom,this._maxZoom),c=Object(x.b)(z(o),z(l),this._outLineLabelAngle,0);t.vertexWrite(i),t.vertexWrite(e),t.vertexWrite(s),t.vertexWrite(n),t.vertexWrite(a),t.vertexWrite(this._refSymbolAndPlacementOffset),t.vertexWrite(c)}}var C=i(497),k=i(499);class V{constructor(t,e,i){this._loadPromise=Object(n.a)(),this._geometryType=t,this._idField=e,this._templateStore=i}update(t,e){Object(r.l)(t.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(t.mesh.labels,e)),this._schema=t}_createLabelTemplates(t,e){const i=new Map;if("simple"===t.type){for(const r of t.classes){const t=P.fromLabelClass(r,e);i.set(r.index,t)}return i}for(const r in t.classes){const s=t.classes[r];for(const t of s){const r=P.fromLabelClass(t,e);i.set(t.index,r)}}return i}get templates(){return this._templateStore}async analyze(t,e,i,n,o,l,c){if(Object(s.m)(c))return;let h;"dictionary"===i.type&&(h=await i.analyze(this._idField,t.copy(),e,o,l,c));let u=0;for(;t.next();){let e;if(e=h?h[u++]:Object(r.l)(n)&&Object(a.h)(t.getDisplayId())&&1!==t.readAttribute("cluster_count")?n.match(this._idField,t,this._geometryType,o,l):i.match(this._idField,t,this._geometryType,o,l),t.setGroupId(e),Object(k.b)(e)){const i=this._templateStore.getDynamicTemplateGroup(e);for(const e of i)e&&e.analyze&&e.analyze(this._templateStore,t,o,l)}}return await this._loadPromise,this._templateStore.finalize(c)}async analyzeGraphics(t,e,i,r,n,a){if(Object(s.m)(a))return;const o=t.getCursor();for(i&&await i.analyze(this._idField,o.copy(),e,r,n,a);o.next();){let t=o.getGroupId();if(null!=t&&-1!==t||(t=i.match(this._idField,o,o.geometryType,r,n),o.setGroupId(t)),Object(k.b)(t)){const e=this._templateStore.getDynamicTemplateGroup(t);for(const t of e)t&&t.analyze&&t.analyze(this._templateStore,o,r,n)}o.setGroupId(t)}return await this._loadPromise,this._templateStore.finalize(a)}writeGraphic(t,e,i){const r=e.getGroupId(),s=e.getDisplayId(),n=this._templateStore.getTemplateGroup(r);if(t.featureStart(e.insertAfter,0),null!=s){if(Object(k.b)(r))for(const t of n)t&&t.bindFeature(e,null,null);if(n){for(const r of n)r&&r.write(t,e,i);t.featureEnd()}}}writeCursor(t,e,i,s,n,a){const o=e.getGroupId(),l=e.getDisplayId(),c=this._templateStore.getTemplateGroup(o),h=this._schema.mesh.sortKey;let u=0;if(Object(r.l)(h)&&(u=null!=h.fieldIndex?e.getComputedNumericAtIndex(h.fieldIndex):null!=h.field?e.readAttribute(h.field):e.readAttribute(this._idField),u*="asc"===h.order?1:-1),t.featureStart(0,null==u||isNaN(u)?0:u),null!=l&&c){if(Object(k.b)(o))for(const t of c)t.bindFeature(e,i,s);for(const i of c)i.write(t,e,n);if(Object(r.l)(a)&&t.hasRecords){const i=a&&this._findLabelRef(c);this._writeLabels(t,e,a,i,n)}t.featureEnd()}}_findLabelRef(t){for(const e of t)if(e instanceof C.a)return e;return null}_writeLabels(t,e,i,s,n){for(const a of i)if(Object(r.l)(a)&&a){const{glyphs:i,rtl:r,index:o}=a,l=this._labelTemplates.get(o);l.setZoomLevel(n),l.bindReferenceTemplate(s),l.bindTextInfo(i,r),l.write(t,e,null)}}}},641:function(t,e,i){"use strict";i.d(e,"a",(function(){return y}));var r=i(79),s=i(99),n=i(81),a=(i(84),i(82),i(83),i(80)),o=i(145),l=i(759);const c=new Set,h=[],u=new Map,f=[0,0];let d=class extends s.a{constructor(t){super(t),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:t,process:e,strategy:i}=this;this._queue=new l.a({concurrency:t,process:(t,i)=>{const r=this._keyToItem.get(t);return e(r,{signal:i})},peeker:"scale-first"===i?t=>this._peekByScaleFirst(t):t=>this._peekByCenterFirst(t)})}destroy(){this.clear(),this._queue.destroy(),this._queue=null}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(t){const e="string"==typeof t?t:t.id;this._queue.abort(e)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(t){return"string"==typeof t?this._keyToItem.has(t):this._keyToItem.has(t.id)}isOngoing(t){const e="string"==typeof t?t:t.id;return this.has(e)&&this._queue.isOngoing(e)}pause(){this._queue.pause()}push(t){const e=t.key.id;if(this._queue.has(e))return this._queue.get(e);const i=this._queue.push(e),r=()=>{this._keyToItem.delete(e),this.notifyChange("updating")};return this._keyToItem.set(e,t),i.then(r,r),this.notifyChange("updating"),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(t){if(!this.state)return t.values().next().value;const e=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;t.forEach((t=>{const e=this._keyToItem.get(t),s=this.tileInfoView.getTileScale(e.key);u.has(s)||(u.set(s,[]),i=Math.max(s,i),r=Math.min(s,r)),u.get(s).push(e.key),c.add(s)}));let s=this.state.scale;u.has(s)||(function(t,e){t.length=0,e.forEach((e=>t.push(e)))}(h,c),h.sort(((t,e)=>t-e)),s=h.reduce(((t,e)=>Math.abs(e-s)<Math.abs(t-s)?e:t),h[0])),s=Math.min(s,i),s=Math.max(s,r);const n=u.get(s),a=e.getClosestInfoForScale(s),o=a.getColumnForX(this.state.center[0]),l=a.getRowForY(this.state.center[1]);return n.sort(((t,e)=>{const i=a.denormalizeCol(t.col,t.world),r=a.denormalizeCol(e.col,e.world);return Math.sqrt((o-i)*(o-i)+(l-t.row)*(l-t.row))-Math.sqrt((o-r)*(o-r)+(l-e.row)*(l-e.row))})),c.clear(),u.clear(),n[0].id}_peekByCenterFirst(t){if(!this.state)return t.values().next().value;const e=this.tileInfoView,i=this.state.center;let r=Number.POSITIVE_INFINITY,s=null;return t.forEach((t=>{const n=this._keyToItem.get(t);e.getTileCoords(f,n.key);const a=Object(o.b)(f,i);a<r&&(r=a,s=n.key)})),s.id}};Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"concurrency",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"process",void 0),Object(r.a)([Object(n.b)()],d.prototype,"state",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"strategy",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"tileInfoView",void 0),Object(r.a)([Object(n.b)({readOnly:!0})],d.prototype,"updating",null),d=Object(r.a)([Object(a.a)("esri.views.2d.tiling.TileQueue")],d);const y=d},662:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var r=i(118),s=i(145);class n{constructor(t,e,i){this.maxSize=t,this.tileInfoView=e,this.removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(t){return this._tilePerId.has(t)}get(t){return this._tilePerId.get(t)}pop(t){const e=this._tilePerId.get(t);if(!e)return null;const i=e.key.level,r=this._tileKeysPerLevel[i];a(this._tilePerId,t);for(let s=0;s<r.length;s++)if(r[s].id===t){r.splice(s,1);break}return e.visible=!0,e}add(t){t.visible=!1;const e=t.key,i=e.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,t);const r=e.level;this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(e)}prune(t,e,i){let r=this._tilePerId.size;if(r<=this.maxSize)return;let s=this._tileKeysPerLevel.length-1;for(;r>this.maxSize&&s>=0;)s!==t&&(r=this._pruneAroundCenterTile(r,e,i,s)),s--;r>this.maxSize&&(r=this._pruneAroundCenterTile(r,e,i,t))}_pruneAroundCenterTile(t,e,i,r){const n=this._tileKeysPerLevel[r];if(!n||0===n.length)return t;const{size:a,origin:o}=this.tileInfoView.tileInfo,l=i*a[0],c=i*a[1],h=[0,0],u=[0,0];for(n.sort(((t,i)=>(h[0]=o.x+l*(t.col+.5),h[1]=o.y-c*(t.row+.5),u[0]=o.x+l*(i.col+.5),u[1]=o.y-c*(i.row+.5),Object(s.a)(h,e)-Object(s.a)(u,e))));n.length>0;){const e=n.pop();if(this._removeTile(e.id),--t===this.maxSize)break}return t}_removeTile(t){const e=this._tilePerId.get(t);this.removedFunc&&this.removedFunc(e),a(this._tilePerId,t)}}function a(t,e){t.delete(e)}var o=i(729);const l=new(i(329).a)(0,0,0,0),c=new Map,h=[],u=[];class f{constructor(t){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.resampling=null==t.resampling||!!t.resampling,t.cachePolicy&&(this.cachePolicy=t.cachePolicy),t.coveragePolicy&&(this.coveragePolicy=t.coveragePolicy),null!=t.buffer&&(this.buffer=t.buffer),t.cacheSize&&(this._tileCache=new n(t.cacheSize,this.tileInfoView,(t=>{this.releaseTile(t)})))}destroy(){this.tileIndex.clear()}update(t){const{resampling:e,tileIndex:i}=this,r=this.tileInfoView.getTileCoverage(t.state,this.buffer,this.coveragePolicy);if(u.length=0,h.length=0,c.clear(),!r)return;const{minScale:s,maxScale:n}=this.tileInfoView.tileInfo,{spans:a,lodInfo:f}=r,{level:d}=f,{scale:y,center:x,resolution:m}=t.state,p=!t.stationary&&y>this._previousScale;if(this._previousScale=y,this.tiles.length=0,!e&&(y>s||y<n))return this.tiles.length=0,c.clear(),i.forEach((t=>{this.releaseTile(t)})),i.clear(),u.length=0,h.length=0,c.clear(),o.a.pool.release(r),!0;i.forEach((t=>t.visible=!0));let _=0,g=0;if(a.length>0)for(const{row:o,colFrom:h,colTo:u}of a)for(let t=h;t<=u;t++){_++;const e=l.set(d,o,f.normalizeCol(t),f.getWorldForColumn(t)).id;if(i.has(e)){const t=i.get(e);t.isReady?(c.set(e,t),g++):p||this._addParentTile(e,c)}else{let t;if(this._tileCache&&this._tileCache.has(e)){if(t=this._tileCache.pop(e),this.tileIndex.set(e,t),t.isReady){c.set(e,t),g++;continue}}else t=this.acquireTile(l),this.tileIndex.set(e,t);p||this._addParentTile(e,c)}}const b=g===_;i.forEach(((t,e)=>{if(l.set(e),c.has(e))return;const i=this.tileInfoView.intersects(r,l),s="purge"===this.cachePolicy?l.level!==d:l.level>d;!i||!p&&b?!s&&i||h.push(e):t.isReady?s&&"purge"===this.cachePolicy&&this._hasReadyAncestor(l,d)?h.push(e):u.push(e):s&&h.push(e)}));for(const o of u){const t=i.get(o);t&&t.isReady&&c.set(o,t)}for(const o of h){const t=i.get(o);this._tileCache?this._tileCache.add(t):this.releaseTile(t),i.delete(o)}return c.forEach((t=>this.tiles.push(t))),i.forEach((t=>{c.has(t.key.id)||(t.visible=!1)})),this._tileCache&&this._tileCache.prune(d,x,m),o.a.pool.release(r),c.clear(),b}clear(t=!0){const{tileIndex:e}=this;t&&e.forEach((t=>{this.releaseTile(t)})),e.clear()}updateCacheSize(t){this._tileCache&&(this._tileCache.maxSize=t)}_addParentTile(t,e){let i=t,r=null;for(;i=this.tileInfoView.getTileParentId(i),i;)if(this.tileIndex.has(i)){if(r=this.tileIndex.get(i),r&&r.isReady){e.has(r.key.id)||e.set(r.key.id,r);break}}else if(this._tileCache&&this._tileCache.has(i)&&(r=this._tileCache.pop(i),this.tileIndex.set(i,r),r&&r.isReady)){e.has(r.key.id)||e.set(r.key.id,r);break}}_hasReadyAncestor(t,e){const i=Object(r.l)();this.tileInfoView.getTileBounds(i,t,!0);for(const s of this.tileIndex.values())if(s.isReady&&s.key.level>=e&&s.key.level<t.level){const t=Object(r.l)();if(this.tileInfoView.getTileBounds(t,s.key,!0),Object(r.f)(t,i))return!0}return!1}}},679:function(t,e,i){"use strict";var r=i(79),s=i(99),n=i(81),a=(i(84),i(82),i(83),i(80)),o=i(145),l=i(759);const c=new Set,h=[],u=new Map,f=[0,0];let d=class extends s.a{constructor(t){super(t),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:t,process:e}=this;this._queue=new l.a({concurrency:t,process:(t,i)=>{const r=this._keyToItem.get(t);return e(r,{signal:i})},peeker:t=>t.values().next().value})}destroy(){this.clear(),this._queue.destroy(),this._queue=null}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(t){const e="string"==typeof t?t:t.id;this._queue.abort(e)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(t){return"string"==typeof t?this._keyToItem.has(t):this._keyToItem.has(t.id)}isOngoing(t){const e="string"==typeof t?t:t.id;return this.has(e)&&this._queue.isOngoing(e)}pause(){this._queue.pause()}push(t,e){const i=t.key.id+"-"+e;if(this.has(i))return this.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i),this.notifyChange("updating")};return this._keyToItem.set(i,t),r.then(s,s),this.notifyChange("updating"),r}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(t){if(!this.state)return t.values().next().value;const e=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;t.forEach((t=>{const e=this._keyToItem.get(t),s=this.tileInfoView.getTileScale(e.key);u.has(s)||(u.set(s,[]),i=Math.max(s,i),r=Math.min(s,r)),u.get(s).push(e.key),c.add(s)}));let s=this.state.scale;u.has(s)||(function(t,e){t.length=0,e.forEach((e=>t.push(e)))}(h,c),h.sort(((t,e)=>t-e)),s=h.reduce(((t,e)=>Math.abs(e-s)<Math.abs(t-s)?e:t),h[0])),s=Math.min(s,i),s=Math.max(s,r);const n=u.get(s),a=e.getClosestInfoForScale(s),o=a.getColumnForX(this.state.center[0]),l=a.getRowForY(this.state.center[1]);return n.sort(((t,e)=>{const i=a.denormalizeCol(t.col,t.world),r=a.denormalizeCol(e.col,e.world);return Math.sqrt((o-i)*(o-i)+(l-t.row)*(l-t.row))-Math.sqrt((o-r)*(o-r)+(l-e.row)*(l-e.row))})),c.clear(),u.clear(),n[0].id}_peekByCenterFirst(t){if(!this.state)return t.values().next().value;const e=this.tileInfoView,i=this.state.center;let r=Number.POSITIVE_INFINITY,s=null;return t.forEach((t=>{const n=this._keyToItem.get(t);e.getTileCoords(f,n.key);const a=Object(o.b)(f,i);a<r&&(r=a,s=n.key)})),s.id}};Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"concurrency",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"process",void 0),Object(r.a)([Object(n.b)()],d.prototype,"state",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"strategy",void 0),Object(r.a)([Object(n.b)({constructOnly:!0})],d.prototype,"tileInfoView",void 0),Object(r.a)([Object(n.b)({readOnly:!0})],d.prototype,"updating",null),d=Object(r.a)([Object(a.a)("esri.views.2d.tiling.PagedTileQueue")],d)},680:function(t,e,i){"use strict";function r(t){switch(t){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}i.d(e,"a",(function(){return r}))}}]);
//# sourceMappingURL=109.147a4d61.chunk.js.map