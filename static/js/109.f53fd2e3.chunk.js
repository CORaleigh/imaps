(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[109,42],{1060:function(e,t,r){"use strict";r.d(t,"a",(function(){return v}));var i=r(89),a=r(305),s=r(395),n=r(683),o=(r(80),r(110),r(208),r(325)),l=r(326),h=(r(192),r(775));class u{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this.data=e,this.memoryUsed=e.byteLength;var r=1,i=new Uint32Array(e);this.layerUIDs=[];for(var a=i[r++],s=0;s<a;s++)this.layerUIDs[s]=i[r++];this.bufferDataOffset=r,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return Object(i.j)(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){Object(i.j)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}class c extends u{constructor(e,t){super(e,t),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;var r=new Uint32Array(e),i=this.bufferDataOffset;this.lineIndexStart=r[i++],this.lineIndexCount=r[i++],this.bufferDataOffset=i}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){Object(i.k)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),Object(i.k)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),Object(i.k)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){var i=new Uint32Array(t),a=new Int32Array(i.buffer),s=i[r++];this.lineVertexBuffer=o.a.createVertex(e,35044,new Int32Array(a.buffer,4*r,s)),r+=s;var n=i[r++];this.lineIndexBuffer=o.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,n)),r+=n;var h=this.layer.lineMaterial;this.lineVertexArrayObject=new l.a(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class d extends u{constructor(e,t){super(e,t),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;var r=new Uint32Array(e),i=this.bufferDataOffset;this.fillIndexStart=r[i++],this.fillIndexCount=r[i++],this.outlineIndexStart=r[i++],this.outlineIndexCount=r[i++],this.bufferDataOffset=i}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){Object(i.k)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),Object(i.k)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),Object(i.k)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,Object(i.k)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),Object(i.k)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),Object(i.k)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){var i=new Uint32Array(t),a=new Int32Array(i.buffer),s=i[r++];this.fillVertexBuffer=o.a.createVertex(e,35044,new Int32Array(a.buffer,4*r,s)),r+=s;var n=i[r++];this.fillIndexBuffer=o.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,n)),r+=n;var h=i[r++];this.outlineVertexBuffer=o.a.createVertex(e,35044,new Int32Array(a.buffer,4*r,h)),r+=h;var u=i[r++];this.outlineIndexBuffer=o.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,u)),r+=u;var c=this.layer,d=c.fillMaterial,p=c.outlineMaterial;this.fillVertexArrayObject=new l.a(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new l.a(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class p extends u{constructor(e,t,r){super(e,t),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];var i=new Uint32Array(e),a=new Int32Array(e),s=new Float32Array(e),n=this.bufferDataOffset;this.isIconSDF=!!i[n++];for(var o=i[n++],l=0;l<o;l++){var u=i[n++],c=i[n++],d=i[n++];this.iconPerPageElementsMap.set(u,[c,d])}for(var p=i[n++],y=0;y<p;y++){var f=i[n++],v=i[n++],g=i[n++];this.glyphPerPageElementsMap.set(f,[v,g])}var m=i[n++],b=i[n++];this.iconOpacity=new Int32Array(m),this.textOpacity=new Int32Array(b),n=Object(h.b)(i,a,s,n,this.symbols,r),this.bufferDataOffset=n}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){var e=0;for(var[t,r]of this.iconPerPageElementsMap)e+=r[1];for(var[i,a]of this.glyphPerPageElementsMap)e+=a[1];return e/3}doDestroy(){Object(i.k)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),Object(i.k)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),Object(i.k)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),Object(i.k)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,Object(i.k)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),Object(i.k)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),Object(i.k)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),Object(i.k)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(this.opacityChanged){this.opacityChanged=!1;var e=Object(i.q)(this.iconOpacity),t=Object(i.q)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var r=Object(i.q)(this.textOpacity),a=Object(i.q)(this.textOpacityBuffer);r.length>0&&r.byteLength===a.size&&a.setSubData(r)}}doPrepareForRendering(e,t,r){var a=new Uint32Array(t),s=new Int32Array(a.buffer),n=a[r++];this.iconVertexBuffer=o.a.createVertex(e,35044,new Int32Array(s.buffer,4*r,n)),r+=n;var h=a[r++];this.iconIndexBuffer=o.a.createIndex(e,35044,new Uint32Array(a.buffer,4*r,h)),r+=h;var u=a[r++];this.textVertexBuffer=o.a.createVertex(e,35044,new Int32Array(s.buffer,4*r,u)),r+=u;var c=a[r++];this.textIndexBuffer=o.a.createIndex(e,35044,new Uint32Array(a.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=o.a.createVertex(e,35044,Object(i.q)(this.iconOpacity).buffer),this.textOpacityBuffer=o.a.createVertex(e,35044,Object(i.q)(this.textOpacity).buffer);var d=this.layer,p=d.iconMaterial,y=d.textMaterial;this.iconVertexArrayObject=new l.a(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new l.a(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class y extends u{constructor(e,t){super(e,t),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;var r=new Uint32Array(e),i=this.bufferDataOffset;this.circleIndexStart=r[i++],this.circleIndexCount=r[i++],this.bufferDataOffset=i}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){Object(i.k)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),Object(i.k)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),Object(i.k)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(e,t,r){var i=new Uint32Array(t),a=new Int32Array(i.buffer),s=i[r++];this.circleVertexBuffer=o.a.createVertex(e,35044,new Int32Array(a.buffer,4*r,s)),r+=s;var n=i[r++];this.circleIndexBuffer=o.a.createIndex(e,35044,new Uint32Array(i.buffer,4*r,n)),r+=n;var h=this.layer.circleMaterial;this.circleVertexArrayObject=new l.a(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}var f=r(404);class v extends f.a{constructor(e,t,r,i,a=null){super(e,r,i,[4096,4096]),this._memCache=a,this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=t,this.id=e.id,this.transforms.tileUnitsToPixels=Object(s.b)()}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<n.d}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<n.d)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){var t=!1;for(var r of e)if(this.layerData.has(r)){var a=this.layerData.get(r);this._memoryUsedByLayerData-=a.memoryUsed,3===a.type&&this.symbols.has(r)&&(this.symbols.delete(r),t=!0),a.destroy(),this.layerData.delete(r),this.layerCount--}Object(i.k)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){"unloaded"!==this.status&&(g.delete(this),v._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}getMemoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(e){var t=!1;if(e){var r=this._createRenderBuckets(e);for(var[a,s]of r){if(this.layerData.has(a)){var n=this.layerData.get(a);this._memoryUsedByLayerData-=s.memoryUsed,n.destroy(),this.layerData.delete(a),this.layerCount--}3===s.type&&(this.symbols.set(a,s.symbols),t=!0),this._memoryUsedByLayerData+=s.memoryUsed,this.layerData.set(a,s),this.layerCount++}Object(i.k)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}for(var[o,l]of(this._hasSymbolBuckets=!1,this.layerData))3===l.type&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e,t){super.setTransform(e,t);var r=t/(e.resolution*e.pixelRatio),i=this.size[0]/this.coordRange[0]*r,s=this.size[1]/this.coordRange[1]*r,n=[0,0];e.toScreen(n,this.coords);var o=this.transforms.tileUnitsToPixels;Object(a.e)(o),Object(a.a)(o,o,n),Object(a.i)(o,o,Math.PI*e.rotation/180),Object(a.c)(o,o,[i,s,1])}static _destroyRenderBuckets(e){if(e){var t=new Set;e.forEach((e=>{t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}_createRenderBuckets(e){var t=new Map,r=new Map;for(var i of e){var a=this._deserializeBucket(i,r);for(var s of a.layerUIDs)t.set(s,a)}return t}_deserializeBucket(e,t){var r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case 1:r=new d(e,this.styleRepository);break;case 2:r=new c(e,this.styleRepository);break;case 3:r=new p(e,this.styleRepository,this);break;case 4:r=new y(e,this.styleRepository)}return t.set(e,r),r}}var g=new Map},1227:function(e,t,r){"use strict";r.r(t);var i=r(7),a=r(82),s=r(80),n=r(89),o=r(81),l=(r(88),r(85)),h=r(84),u=r(93),c=(r(83),r(86),r(87),r(94)),d=r(123),p=r(115),y=r(125),f=r(317),v=r(774),g=r(577),m=r(1060),b=r(382),_=r(384),w=r(91),x=r(106),O=r(403),T=r(275),I=r(245),S=r(822),D=(r(208),r(263),r(205)),P=(r(192),r(446));var L=class{constructor(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new P.a(0,0,e,t))}get width(){return this._width}get height(){return this._height}allocate(e,t){if(e>this._width||t>this._height)return new P.a;for(var r=null,i=-1,a=0;a<this._free.length;++a){var s=this._free[a];e<=s.width&&t<=s.height&&(null===r||s.y<=r.y&&s.x<=r.x)&&(r=s,i=a)}return null===r?new P.a:(this._free.splice(i,1),r.width<r.height?(r.width>e&&this._free.push(new P.a(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new P.a(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new P.a(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new P.a(r.x,r.y+t,e,r.height-t))),new P.a(r.x,r.y,e,t))}release(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}};var j=class{constructor(e,t,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=e,this.height=t,this._glyphSource=r,this._binPack=new L(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(e,t){var r=[],i=this._glyphSource,a=new Set;for(var s of t){var n=Math.floor(.00390625*s);a.add(n)}var o=[];return a.forEach((t=>{if(t<=256){var r=e+t;if(this._rangePromises.has(r))o.push(this._rangePromises.get(r));else{var a=i.getRange(e,t).then((()=>{this._rangePromises.delete(r)}),(()=>{this._rangePromises.delete(r)}));this._rangePromises.set(r,a),o.push(a)}}})),Promise.all(o).then((()=>{var a=this._glyphIndex[e];for(var s of(a||(a={},this._glyphIndex[e]=a),t)){var n=a[s];if(n)r[s]={sdf:!0,rect:n.rect,metrics:n.metrics,page:n.page,code:s};else{var o=i.getGlyph(e,s);if(o&&o.metrics){var l=o.metrics,h=void 0;if(0===l.width)h=new P.a(0,0,0,0);else{var u=l.width+6,c=l.height+6,d=u%4?4-u%4:4,p=c%4?4-c%4:4;1===d&&(d=5),1===p&&(p=5),(h=this._binPack.allocate(u+d,c+p)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new L(this.width-4,this.height-4),h=this._binPack.allocate(u+d,c+p));var y=this._glyphData[this._currentPage],f=o.bitmap,v=void 0,g=void 0;if(f)for(var m=0;m<c;m++){v=u*m,g=this.width*(h.y+m+1)+h.x;for(var b=0;b<u;b++)y[g+b+1]=f[v+b]}}a[s]={rect:h,metrics:l,tileIDs:null,page:this._currentPage},r[s]={sdf:!0,rect:h,metrics:l,page:this._currentPage,code:s},this._dirties[this._currentPage]=!0}}}return r}))}removeGlyphs(e){for(var t in this._glyphIndex){var r=this._glyphIndex[t];if(r){var i=void 0;for(var a in r)if((i=r[a]).tileIDs.delete(e),0===i.tileIDs.size){for(var s=this._glyphData[i.page],n=i.rect,o=void 0,l=void 0,h=0;h<n.height;h++)for(o=this.width*(n.y+h)+n.x,l=0;l<n.width;l++)s[o+l]=0;delete r[a],this._dirties[i.page]=!0}}}}bind(e,t,r,i=0){this._textures[r]||(this._textures[r]=new D.a(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var a=this._textures[r];a.setSamplingMode(t),this._dirties[r]&&a.setData(this._glyphData[r]),e.bindTexture(a,i),this._dirties[r]=!1}dispose(){for(var e of(this._binPack=null,this._textures))e&&e.dispose();this._textures.length=0}},k=r(362);class R{constructor(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var r=t.getMessage(),i=void 0,a=void 0,s=void 0,n=void 0,o=void 0,l=void 0,h=void 0;r.next();)switch(r.tag()){case 1:i=r.getUInt32();break;case 2:a=r.getBytes();break;case 3:s=r.getUInt32();break;case 4:n=r.getUInt32();break;case 5:o=r.getSInt32();break;case 6:l=r.getSInt32();break;case 7:h=r.getUInt32();break;default:r.skip()}r.release(),i&&(this._metrics[i]={width:s,height:n,left:o,top:l,advance:h},this._bitmaps[i]=a);break;default:t.skip()}t.release();break;default:e.skip()}}getMetrics(e){return this._metrics[e]}getBitmap(e){return this._bitmaps[e]}}class C{constructor(){this._ranges=[]}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}var A=class{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(e,t){var r=this._getFontStack(e);if(r.getRange(t))return Promise.resolve();var i=256*t,a=i+255,s=this._baseURL.replace("{fontstack}",e).replace("{range}",i+"-"+a);return Object(x.default)(s,{responseType:"array-buffer"}).then((e=>{r.addRange(t,new R(new k.a(new Uint8Array(e.data),new DataView(e.data))))})).catch((()=>{r.addRange(t,new R)}))}getGlyph(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256);if(!(i>256)){var a=r.getRange(i);return a?{metrics:a.getMetrics(t),bitmap:a.getBitmap(t)}:void 0}}}_getFontStack(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new C),t}};class M{constructor(e,t,r=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,r>0&&(this._maxItemSize=r),this._binPack=new L(e-4,t-4)}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new L(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight),i=new Uint32Array(t*r);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e,t=!1){var r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var i=this._sprites.getSpriteInfo(e);if(!i||!i.width||!i.height||i.width<0||i.height<0)return null;var a=i.width,s=i.height,[n,o,l]=this._allocateImage(a,s);return n.width<=0?null:(this._copy(n,i,o,l,t),r={rect:n,width:a,height:s,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:o},this._mosaicRects[e]=r,r)}getSpriteItems(e){var t={};for(var r of e)t[r]=this.getSpriteItem(r);return t}getMosaicItemPosition(e,t){var r=this.getSpriteItem(e,t),i=r&&r.rect;if(!i)return null;i.width=r.width,i.height=r.height;var a=r.width,s=r.height,n=this._size[r.page];return{size:[r.width,r.height],tl:[(i.x+2)/n[0],(i.y+2)/n[1]],br:[(i.x+2+a)/n[0],(i.y+2+s)/n[1]],page:r.page}}bind(e,t,r=0,i=0){this._textures[r]||(this._textures[r]=new D.a(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var a=this._textures[r];a.setSamplingMode(t),this._dirties[r]&&a.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(a,i),this._dirties[r]=!1}static _copyBits(e,t,r,i,a,s,n,o,l,h,u){var c=i*t+r,d=o*s+n;if(u){d-=s;for(var p=-1;p<=h;c=((++p+h)%h+i)*t+r,d+=s)for(var y=-1;y<=l;y++)a[d+y]=e[c+(y+l)%l]}else for(var f=0;f<h;f++){for(var v=0;v<l;v++)a[d+v]=e[c+v];c+=t,d+=s}}_copy(e,t,r,i,a,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var n=new Uint32Array(s?s.buffer:this._sprites.image.buffer),o=this._mosaicsData[r];o&&n||console.error("Source or target images are uninitialized!");var l=s?t.width:this._sprites.width;M._copyBits(n,l,t.x,t.y,o,i[0],e.x+2,e.y+2,t.width,t.height,a),this._dirties[r]=!0}}_allocateImage(e,t){e+=2,t+=2;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var i=new P.a(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}var a=e%4?4-e%4:4,s=t%4?4-t%4:4;1===a&&(a=5),1===s&&(s=5);var n=this._binPack.allocate(e+a,t+s);return n.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new L(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[n,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){for(var e of(this._binPack=null,this._mosaicRects={},this._textures))e&&e.dispose();this._textures.length=0}}var E=M;function U(e,t,r,i,a,s){e.fillStyle=t,e.fillRect(r,i,a,s)}function B(e,t,r,i,a,s){e.strokeStyle=t,e.strokeRect(r,i,a,s)}function z(e,t){e.strokeStyle="black";for(var r=t.cellSize,i=t.rows,a=t.columns,s=0;s<i;s++)for(var n=t.cells[s],o=s*r,l=(s+1)*r,h=0;h<a;h++){var u=n[h],c=h*r,d=(h+1)*r;e.strokeRect(c,o,d-c,l-o),e.fillText("cells:".concat(u.length),c+4,o+12)}}function V(e,t){for(var r=window.COLLISION_XRAY,i=0;i<t.length;++i){var a=!t[i].unique.show;if(r||!a)for(var s of t[i].colliders)if(s.enabled){var n=!t[i].unique.parts[s.partIndex].show;if(r||!n){var o=s.xScreen,l=s.yScreen,h=s.dxScreen,u=s.dyScreen;e.globalAlpha=a||n?.2:1,U(e,"green",o-1,l-1,3,3),B(e,"red",o+h,l+u,s.width,s.height),U(e,"blue",o+h-1,l+u-1,3,3),e.globalAlpha=1}}}}var F=new O.a(10),q=new Map;class N{constructor(e,t,r){this._vectorTileLayer=e,this._styleRepository=t,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}destroy(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}get spriteMosaic(){return this._spriteSourcePromise.then((()=>this._spriteMosaic))}get glyphMosaic(){return this._glyphMosaic}start(e){var t=this;return Object(i.a)((function*(){var r=t._vectorTileLayer,i=r.sourceNameToSource,a=[];for(var n in i)a.push(t._fetchTileMap(i[n],e));t._spriteSourcePromise=t._vectorTileLayer.loadSpriteSource(t.devicePixelRatio,e),t._spriteSourcePromise.then((e=>{t._spriteMosaic=new E(1024,1024,250),t._spriteMosaic.setSpriteSource(e)}));var o=t._styleRepository,l=new A(o.glyphs);return t._glyphMosaic=new j(1024,1024,l),t._broadcastPromise=Object(T.b)("WorkerTileHandler",{client:t,scheduler:e.scheduler,signal:e.signal}).then((i=>(t._connection=i,Promise.all(t._connection.broadcast("setStyle",{style:r.currentStyleInfo.style,vectorTileLayerMaxBuffers:Object(s.a)("vectortilelayer-max-buffers")},e))))),Promise.all(a)}))()}updateStyle(e){var t=this;return Object(i.a)((function*(){return yield t._broadcastPromise,t._broadcastPromise=new Promise(((r,i)=>{Promise.all(t._connection.broadcast("updateStyle",e)).then(r,i)})),t._broadcastPromise}))()}setStyle(e,t){var r=this;return Object(i.a)((function*(){yield r._broadcastPromise,r._styleRepository=e;var i=r._vectorTileLayer.sourceNameToSource,a=[];for(var n in i)a.push(r._fetchTileMap(i[n],null));r._spriteSourcePromise=r._vectorTileLayer.loadSpriteSource(r.devicePixelRatio,null),r._spriteSourcePromise.then((e=>{r._spriteMosaic=new E(1024,1024,250),r._spriteMosaic.setSpriteSource(e)}));var o=new A(e.glyphs);return r._glyphMosaic=new j(1024,1024,o),r._broadcastPromise=new Promise(((e,i)=>{Promise.all(r._connection.broadcast("setStyle",{style:t,vectorTileLayerMaxBuffers:Object(s.a)("vectortilelayer-max-buffers")})).then(e,i)})),a.push(r._broadcastPromise),Promise.all(a)}))()}fetchTileData(e,t){return this._getRefKeys(e,t).then((e=>{var r=this._vectorTileLayer.sourceNameToSource,i=[];for(var a in r)i.push(a);return this._getSourcesData(i,e,t)}))}parseTileData(e,t){var r=e&&e.data;if(!r)return Promise.resolve(null);var{sourceName2DataAndRefKey:i,transferList:a}=r;return 0===Object.keys(i).length?Promise.resolve(null):this._broadcastPromise.then((()=>this._connection.getAvailableClient().then((r=>r.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:i,styleLayerUIDs:e.styleLayerUIDs},Object(w.a)(Object(w.a)({},t),{},{transferList:a})).then((e=>({tileData:e})))))))}getSprites(e){var t=this;return Object(i.a)((function*(){return yield t._spriteSourcePromise,t._spriteMosaic.getSpriteItems(e)}))()}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}perfReport({key:e,milliseconds:t}){!function(e,t,r){if(window.PERFORMANCE_RECORDING_STORAGE){var i=window.PERFORMANCE_RECORDING_STORAGE;i.perf=i.perf||{};var a=i.perf;a[e]=a[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:r},a[e].time+=t,a[e].samples.push(t),(null==a[e].min||t<a[e].min)&&(a[e].min=t),(null==a[e].max||t>a[e].max)&&(a[e].max=t)}}(e,t,"ms")}_getTilePayload(e,t,r){var a=this;return Object(i.a)((function*(){var i=I.a.pool.acquire(e.id),s=a._vectorTileLayer.sourceNameToSource[t].getSourceTileUrl(i.level,i.row,i.col);I.a.pool.release(i);try{return{protobuff:yield a.request(s,r),sourceName:t}}catch(n){if(Object(c.m)(n))throw n;return{protobuff:null,sourceName:t}}}))()}request(e,t){return Object(x.default)(e,Object(w.a)({responseType:"array-buffer"},t)).then((({data:e})=>e))}_fetchTileMap(e,t){return Object(i.a)((function*(){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return Promise.resolve();if(e.tileMapURL){var r,i=F.get(e.tileMapURL);if(i)e.tileIndex=i;else if(q.has(e.tileMapURL))try{r=yield q.get(e.tileMapURL),e.tileIndex=new S.a(r.data)}catch(s){if(Object(c.m)(s))throw s}else{var a=Object(x.default)(e.tileMapURL,t);q.set(e.tileMapURL,a);try{r=yield a,q.delete(e.tileMapURL),F.put(e.tileMapURL,e.tileIndex),e.tileIndex=new S.a(r.data)}catch(s){if(q.delete(e.tileMapURL),Object(c.m)(s))throw s}}}}))()}_getRefKeys(e,t){var r=this._vectorTileLayer.sourceNameToSource,i=new Array;for(var a in r){var s=r[a].getRefKey(e,t);i.push(s)}return Object(c.j)(i)}_getSourcesData(e,t,r){for(var i=[],a=0;a<t.length;a++)if(null==t[a].value||null==e[a])i.push(null);else{var s=this._getTilePayload(t[a].value,e[a],r);i.push(s)}return Object(c.j)(i).then((e=>{for(var r={},i=[],a=0;a<e.length;a++)if(e[a].value&&e[a].value&&e[a].value.protobuff&&e[a].value.protobuff.byteLength>0){var s=t[a].value.id;r[e[a].value.sourceName]={refKey:s,protobuff:e[a].value.protobuff},i.push(e[a].value.protobuff)}return{sourceName2DataAndRefKey:r,transferList:i}}))}}var H=r(235),J=r(513),Q=(e,t)=>e+1/(1<<2*t);class G{constructor(e,t){this._tiles=new Map,this._tileCache=new H.a(40,(e=>e.dispose())),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this._container=t}destroy(){for(var[e,t]of this._tiles)t.dispose();this._tiles=null,this._tileCache.clear(),this._tileCache=null}update(e){this._updateCacheSize(e);var t=this.tileInfoView,r=t.getTileCoverage(e.state,0,"smallest"),{spans:i,lodInfo:a}=r,{level:s}=a,n=new Set,o=new Set;for(var{row:l,colFrom:h,colTo:u}of i)for(var c=h;c<=u;c++){var d=I.a.getId(s,l,a.normalizeCol(c),a.getWorldForColumn(c)),p=this._getOrAcquireTile(d);n.add(d),p.processed()?this._addToContainer(p):o.add(new I.a(d))}for(var[y,f]of this._tiles)f.isCoverage=n.has(y);for(var v of o)this._findPlaceholdersForMissingTiles(v,n);var g=!1;for(var[m,b]of this._tiles)b.neededForCoverage=n.has(m),b.neededForCoverage||b.isHoldingForFade&&t.intersects(r,b.key)&&n.add(m),b.isFading&&(g=!0);for(var[_,w]of this._tiles)n.has(_)||this._releaseTile(_);return J.a.pool.release(r),!g}clear(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}_findPlaceholdersForMissingTiles(e,t){var r=[];for(var[i,a]of this._tiles)this._addPlaceholderChild(r,a,e,t);var s=r.reduce(Q,0);Math.abs(1-s)<1e-6||this._addPlaceholderParent(e.id,t)}_addPlaceholderChild(e,t,r,i){t.key.level<=r.level||!t.hasData()||function(e,t){var r=t.level-e.level;return e.row===t.row>>r&&e.col===t.col>>r&&e.world===t.world}(r,t.key)&&(this._addToContainer(t),i.add(t.id),e.push(t.key.level-r.level))}_addPlaceholderParent(e,t){for(var r=e;;){if(!(r=W(r))||t.has(r))return;var i=this._getTile(r);if(i&&i.hasData())return this._addToContainer(i),void t.add(i.id)}}_getOrAcquireTile(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new I.a(e))),this._tiles.set(e,t),t)}_getTile(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))&&this._tiles.set(e,t),t)}_releaseTile(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}_addToContainer(e){var t,r=[],i=this._container;if(!i.contains(e)){var a=this._visibleTiles;for(var[s,o]of a)this._canConnectDirectly(e,o)&&r.push(o),Object(n.j)(t)&&this._canConnectDirectly(o,e)&&(t=o);if(Object(n.k)(t)){for(var l of r)t.childrenTiles.delete(l),e.childrenTiles.add(l),l.parentTile=e;t.childrenTiles.add(e),e.parentTile=t}else for(var h of r)e.childrenTiles.add(h),h.parentTile=e;a.set(e.id,e),i.addChild(e)}}_removeFromContainer(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),Object(n.k)(e.parentTile))for(var t of(e.parentTile.childrenTiles.delete(e),e.childrenTiles))Object(n.k)(e.parentTile)&&e.parentTile.childrenTiles.add(t);for(var r of e.childrenTiles)r.parentTile=e.parentTile;e.parentTile=null,e.childrenTiles.clear()}_canConnectDirectly(e,t){for(var r=e.key,{level:i,row:a,col:s,world:n}=t.key,o=this._visibleTiles;i>0;){if(i--,a>>=1,s>>=1,r.level===i&&r.row===a&&r.col===s&&r.world===n)return!0;if(o.has("".concat(i,"/").concat(a,"/").concat(s,"/").concat(n)))return!1}return!1}_updateCacheSize(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var r=Math.ceil(t[0]/512)+1,i=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*r*i}}}function W(e){var[t,r,i,a]=e.split("/"),s=parseInt(t,10);return 0===s?null:"".concat(s-1,"/").concat(parseInt(r,10)>>1,"/").concat(parseInt(i,10)>>1,"/").concat(parseInt(a,10))}var Y=r(404),K=r(127),Z=r(432),$=r(131),X=r(683),ee=r(896),te=r(775),re=r(395);function ie(e,t,r,i,a,s){var{iconRotationAlignment:n,textRotationAlignment:o,iconTranslate:l,iconTranslateAnchor:h,textTranslate:u,textTranslateAnchor:c}=i,d=0;for(var p of e.colliders){var[y,f]=0===p.partIndex?l:u,v=0===p.partIndex?h:c,g=p.minLod<=s&&s<=p.maxLod;d+=g?0:1,p.enabled=g,p.xScreen=p.xTile*a[0]+p.yTile*a[3]+a[6],p.yScreen=p.xTile*a[1]+p.yTile*a[4]+a[7],0===v?(p.xScreen+=r*y-t*f,p.yScreen+=t*y+r*f):(p.xScreen+=y,p.yScreen+=f),1===(0===p.partIndex?n:o)?(p.dxScreen=p.dxPixels,p.dyScreen=p.dyPixels):(p.dxScreen=r*(p.dxPixels+p.width/2)-t*(p.dyPixels+p.height/2)-p.width/2,p.dyScreen=t*(p.dxPixels+p.width/2)+r*(p.dyPixels+p.height/2)-p.height/2)}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}class ae{constructor(e,t,r,i,a,s){for(var n of(this._symbols=e,this._styleRepository=i,this._zoom=a,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new te.a(t,r,X.a),this._si=Math.sin(Math.PI*s/180),this._co=Math.cos(Math.PI*s/180),e))for(var o of n.symbols)this._allNeededMatrices.has(o.tile)||this._allNeededMatrices.set(o.tile,Object(re.a)(o.tile.transforms.tileUnitsToPixels))}work(e){var t=this._gridIndex;function r(e){for(var r=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,a=r+e.width,s=i+e.height,[n,o,l,h]=t.getCellSpan(r,i,a,s),u=o;u<=h;u++)for(var c=n;c<=l;c++){var d=t.cells[u][c];for(var p of d){var y=p.xScreen+p.dxScreen,f=p.yScreen+p.dyScreen,v=y+p.width,g=f+p.height;if(!(a<y||r>v||s<f||i>g))return!0}}return!1}for(var i=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var a=this._symbols[this._currentLayerCursor],s=this._getProperties(a.styleLayerUID);this._currentSymbolCursor<a.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;var n=a.symbols[this._currentSymbolCursor];if(n.unique.show){ie(n,this._si,this._co,s,this._allNeededMatrices.get(n.tile),this._zoom);var o=n.unique;if(o.show){var{iconAllowOverlap:l,iconIgnorePlacement:h,textAllowOverlap:u,textIgnorePlacement:c}=s;for(var d of n.colliders)if(d.enabled){var p=o.parts[d.partIndex];p.show&&!(d.partIndex?u:l)&&r(d)&&(d.hard?o.show=!1:p.show=!1)}if(o.show)for(var y of n.colliders)if(y.enabled&&!(y.partIndex?c:h)&&o.parts[y.partIndex].show)for(var f=y.xScreen+y.dxScreen,v=y.yScreen+y.dyScreen,g=f+y.width,m=v+y.height,[b,_,w,x]=this._gridIndex.getCellSpan(f,v,g,m),O=_;O<=x;O++)for(var T=b;T<=w;T++)this._gridIndex.cells[O][T].push(y)}}}return!0}_getProperties(e){var t=this._styleProps.get(e);if(t)return t;var r=this._zoom,i=this._styleRepository.getStyleLayerByUID(e),a=0!==i.getLayoutValue("symbol-placement",r),s=i.getLayoutValue("icon-rotation-alignment",r);2===s&&(s=a?0:1);var n=i.getLayoutValue("text-rotation-alignment",r);2===n&&(n=a?0:1);var o=i.getPaintValue("icon-translate",r),l=i.getPaintValue("icon-translate-anchor",r),h=i.getPaintValue("text-translate",r),u=i.getPaintValue("text-translate-anchor",r),c={iconAllowOverlap:i.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:i.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:i.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:i.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:s,textRotationAlignment:n,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:u,textTranslate:h};return this._styleProps.set(e,c),c}}function se(e,t){if(e.priority-t.priority)return e.priority-t.priority;var r=e.tile.key,i=t.tile.key;return r.world-i.world?r.world-i.world:r.level-i.level?r.level-i.level:r.row-i.row?r.row-i.row:r.col-i.col?r.col-i.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}class ne{constructor(e,t,r,i,a,s){this._visibleTiles=e,this._symbolRepository=t,this._createCollisionJob=r,this._assignTileSymbolsOpacity=i,this._symbolLayerSorter=a,this._isLayerVisible=s,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}get running(){return this._running}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var r=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var i=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}return this._running=!1,!0}_createSelectionJob(){var e=this._symbolRepository.uniqueSymbols,t=[],r=0,i=0,a=this._isLayerVisible;var s=this._symbolLayerSorter;return{work:function(s){for(var n,o=performance.now();i<e.length;i++,r=0){var l=e[i],h=l.styleLayerUID;if(a(h)){t[i]=t[i]||{styleLayerUID:h,symbols:[]};for(var u=t[i];r<l.uniqueSymbols.length;r++){if(n=l.uniqueSymbols[r],r%100==99&&performance.now()-o>s)return!1;var c=null,d=!1,p=!1;for(var y of n.tileSymbols)if(y.selectedForRendering=!1,!p||!d){var f=y.tile;(!c||f.isCoverage||f.neededForCoverage&&!d)&&(c=y,(f.neededForCoverage||f.isCoverage)&&(p=!0),f.isCoverage&&(d=!0))}if(c.selectedForRendering=!0,p)for(var v of(u.symbols.push(c),n.show=!0,n.parts))v.show=!0;else n.show=!1}}else t[i]||(t[i]={styleLayerUID:h,symbols:[]})}for(var g of t)g.symbols.sort(se);return!0},get sortedSymbols(){return t.sort(s)}}}_createOpacityJob(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,r=0;function i(t,r){var a=t.symbols;for(var[s,n]of a)oe(n,r);for(var o of(e(t,r),t.childrenTiles))i(o,r)}return{work(e){for(var a=performance.now();r<t.length;r++){if(performance.now()-a>e)return!1;var s=t[r];Object(n.k)(s.parentTile)||i(s,performance.now())}return!0}}}}function oe(e,t){for(var r of e){var i=r.unique;for(var a of i.parts){var s=a.targetOpacity>.5?1:-1;a.startOpacity+=s*((t-a.startTime)/X.d),a.startOpacity=Math.min(Math.max(a.startOpacity,0),1),a.startTime=t,a.targetOpacity=i.show&&a.show?1:0}}}class le{constructor(e,t,r){this.tileCoordRange=e,this._visibleTiles=t,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}get uniqueSymbols(){return Object(n.j)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}add(e,t){this._uniqueSymbolLayerArray=null;var r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));var i=new Map;if(t)for(var a of t)r.symbols.has(a)&&(i.set(a,r.symbols.get(a)),r.symbols.delete(a));else for(var[s,n]of e.layerData)r.symbols.has(s)&&(i.set(s,r.symbols.get(s)),r.symbols.delete(s));this._removeSymbols(i);var o=e.symbols,l=new Map;for(var[h,u]of o){var c=u.length;if(c>=32){var d=this.tileCoordRange;do{d/=2,c/=4}while(c>8&&d>64);var p=new te.a(this.tileCoordRange,this.tileCoordRange,d);for(var y of(l.set(h,{flat:u,index:p}),r.symbols.set(h,{flat:u,index:p}),u))p.getCell(y.xTile,y.yTile).push(y)}else l.set(h,{flat:u}),r.symbols.set(h,{flat:u})}this._addSymbols(e.key,o)}deleteStyleLayers(e){for(var[t,r]of(this._uniqueSymbolLayerArray=null,this._tiles)){var i=new Map;for(var a of e)r.symbols.has(a)&&(i.set(a,r.symbols.get(a)),r.symbols.delete(a));this._removeSymbols(i),0===r.symbols.size&&this._tiles.delete(t)}}removeTile(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var r=new Map;for(var[i,a]of e.symbols)t.symbols.has(i)&&(r.set(i,t.symbols.get(i)),t.symbols.delete(i));this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}_removeSymbols(e){for(var[t,{flat:r}]of e)for(var i of r){for(var a=i.unique,s=a.tileSymbols,n=s.length-1,o=0;o<n;o++)if(s[o]===i){s[o]=s[n];break}if(s.length=n,0===n){var l=this._uniqueSymbolsReferences.get(t);l.delete(a),0===l.size&&this._uniqueSymbolsReferences.delete(t)}i.unique=null}}_addSymbols(e,t){if(0!==t.size){var r=this._visibleTiles;for(var i of r)i.parentTile||i.key.world!==e.world||i.key.level===e.level&&!i.key.equals(e)||this._matchSymbols(i,e,t);for(var[a,s]of t)for(var o of s)if(Object(n.j)(o.unique)){var l=this._createUnique();o.unique=l,l.tileSymbols.push(o);var h=this._uniqueSymbolsReferences.get(a);h||(h=new Set,this._uniqueSymbolsReferences.set(a,h)),h.add(l)}}}_matchSymbols(e,t,r){if(e.key.level>t.level){var i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){var a=t.level-e.key.level;if(t.row>>a!==e.key.row||t.col>>a!==e.key.col)return}if(t.equals(e.key))for(var s of e.childrenTiles)this._matchSymbols(s,t,r);else{var o=new Map;for(var[l,h]of r){var u=[];for(var c of h){var d=Object(te.c)(this.tileCoordRange,c.xTile,t.level,t.col,e.key.level,e.key.col),p=Object(te.c)(this.tileCoordRange,c.yTile,t.level,t.row,e.key.level,e.key.row);d>=0&&d<this.tileCoordRange&&p>=0&&p<this.tileCoordRange&&u.push({symbol:c,xTransformed:d,yTransformed:p})}var y=[],f=e.key.level<t.level?1:1<<e.key.level-t.level,v=this._tiles.get(e.id).symbols.get(l);if(v){var g=v.flat;for(var m of u){var b,_=!1,w=m.xTransformed,x=m.yTransformed;b=Object(n.k)(v.index)?v.index.getCell(w,x):g;var O=m.symbol,T=O.hash;for(var I of b)if(T===I.hash&&Math.abs(w-I.xTile)<=f&&Math.abs(x-I.yTile)<=f){var S=I.unique;O.unique=S,S.tileSymbols.push(O),_=!0;break}_||y.push(O)}}y.length>0&&o.set(l,y)}for(var D of e.childrenTiles)this._matchSymbols(D,t,o)}}_createUniqueSymbolLayerArray(){var e,t=this._uniqueSymbolsReferences,r=new Array(t.size),i=0;for(var[a,s]of t){var n=new Array(s.size);for(var o of(e=0,s))n[e++]=o;r[i]={styleLayerUID:a,uniqueSymbols:n},i++}return r}}class he extends $.a{constructor(e,t){super(),this.styleRepository=e,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._completed=!1,this._symbolRepository=new le(4096,t,(()=>new ee.b)),this._symbolDeclutterer=new ne(t,this._symbolRepository,((e,t,r)=>new ae(e,t,r,this.styleRepository,this._zoom,this._viewState.rotation)),((e,t)=>{e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,Object(te.d)(e,t,!0),e.decluttered=!0,e.requestRender()}),((e,t)=>this.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-this.styleRepository.getStyleLayerByUID(t.styleLayerUID).z),(e=>{var t=this.styleRepository.getStyleLayerByUID(e).getLayoutProperty("visibility");return!t||1!==t.getValue()}))}addTile(e){e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(()=>{this._symbolRepository.add(e),this.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}removeTile(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}update(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((e=>e.remove())),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(e){this._symbolRepository.deleteStyleLayers(e)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(X.b),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){Object(n.k)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((()=>{this._stableNotificationHandle=null,this.emit("fade-complete")}),1.5*X.d)}_notifyUnstable(){Object(n.k)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}var ue=1e-6;function ce(e,t){if(e){var r=e.getLayoutProperty("visibility");if(!r||1!==r.getValue()&&(void 0===e.minzoom||e.minzoom<t+ue)&&(void 0===e.maxzoom||e.maxzoom>=t-ue))return!0}return!1}class de extends Z.a{constructor(e){super(e),this._backgroundTiles=[],this._pointToCallbacks=new Map,this._fading=!1}destroy(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),Object(n.k)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}setStyleResources(e,t,r){if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=r,Object(n.j)(this._symbolFader)){var i=new he(this._styleRepository,this.children);i.on("fade-start",(()=>{this.emit("fade-start"),this._fading=!0,this.requestRender()})),i.on("fade-complete",(()=>{this.emit("fade-complete"),this._fading=!1,this.requestRender()})),this._symbolFader=i}Object(n.q)(this._symbolFader).styleRepository=r}deleteStyleLayers(e){Object(n.k)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}hitTest(e,t){var r=this;return Object(i.a)((function*(){var i=[e,t],a=Object(c.g)();return r._pointToCallbacks.set(i,a),r.requestRender(),a.promise}))()}enterTileInvalidation(){for(var e of this.children)e.invalidating=!0}createRenderParams(e){return Object(w.a)(Object(w.a)({},super.createRenderParams(e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}doRender(e){!this.visible||e.drawPhase!==K.c.MAP&&e.drawPhase!==K.c.DEBUG||void 0===this._spriteMosaic||super.doRender(e)}addChild(e){return super.addChild(e),Object(n.k)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}removeChild(e){return Object(n.k)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),super.removeChild(e)}renderChildren(e){if(e.drawPhase!==K.c.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){var{context:t}=e,r=t.getBoundFramebufferObject();e.drawPhase=K.c.HITTEST;var i=e.painter.effects.hittest;i.bind(e),this._doRender(e),i.draw(e,this._pointToCallbacks),t.bindFramebuffer(r)}}else super.renderChildren(e)}removeAllChildren(){for(var e=0;e<this.children.length;e++){var t=this.children[e];Object(n.k)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter((e=>e.neededForCoverage&&e.hasData()))}restartDeclutter(){Object(n.k)(this._symbolFader)&&this._symbolFader.restartDeclutter()}_doRender(e){var t=this,{context:r}=e,i=this._styleRepository;if(i){var a=i.layers,s=!0;e.drawPhase===K.c.HITTEST&&(s=!1),i.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,i.backgroundBucketIds)),super.renderChildren(e),e.drawPhase===K.c.MAP&&this._fade(e.displayLevel,e.state);var o=this.children.filter((e=>e.visible&&e.hasData()));if(o&&0!==o.length){for(var l of o)l.triangleCount=0;r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(7680,7680,7681),r.setStencilTestEnabled(!0),r.setBlendingEnabled(!1),r.setDepthTestEnabled(!0),r.setDepthWriteEnabled(!0),r.setDepthFunction(515),r.setClearDepth(1),r.clear(r.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var h=a.length-1;h>=0;h--)this._renderStyleLayer(a[h],e,o);r.setDepthWriteEnabled(!1),r.setBlendingEnabled(s),r.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(var u=0;u<a.length;u++)this._renderStyleLayer(a[u],e,o);r.setDepthTestEnabled(!1),e.renderPass="symbol";for(var c=0;c<a.length;c++)this._renderStyleLayer(a[c],e,o);if(r.bindVAO(),r.setStencilTestEnabled(!0),r.setBlendingEnabled(!0),e.drawPhase===K.c.MAP){var d=window.COLLISION_DEBUG_CTX;if(d&&Object(n.k)(this._symbolFader)&&(d.clearRect(0,0,d.canvas.width,d.canvas.height),!this._fading||window.COLLISION_XRAY))for(var p of this.children){var y,f,v;if(p.symbols)!function(){var e=[];if(p.symbols.forEach((t=>{e.push(...t)})),window.COLLISION_SHOW_GRID){var r=null==(y=t._symbolFader)||null==(f=y._symbolDeclutterer)||null==(v=f._collisionJob)?void 0:v._gridIndex;r&&z(d,r)}V(d,e)}()}}}}}_fade(e,t){Object(n.k)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}_renderStyleLayer(e,t,r){var{painter:i,renderPass:a}=t;if(void 0!==e){var s=e.getLayoutProperty("visibility");if(!s||1!==s.getValue()){var n;switch(e.type){case 0:return;case 1:if("opaque"!==a&&"translucent"!==t.renderPass)return;n="vtlFill";break;case 2:if("translucent"!==a)return;n="vtlLine";break;case 4:if("symbol"!==a)return;n="vtlCircle";break;case 3:if("symbol"!==a)return;n="vtlSymbol"}if(r=3===e.type?r.filter((e=>e.decluttered)):r.filter((e=>e.neededForCoverage)),"vtlSymbol"!==n){var o=t.displayLevel;if(0===r.length||void 0!==e.minzoom&&e.minzoom>=o+ue||void 0!==e.maxzoom&&e.maxzoom<o-ue)return}var l=e.uid;for(var h of(t.styleLayerUID=l,t.styleLayer=e,r))if(h.layerData.has(l)){i.renderObjects(t,r,n);break}}}}_renderBackgroundLayers(e,t){var{context:r,displayLevel:i,painter:a,state:s}=e,o=this._styleRepository,l=!1;for(var h of t)if(ce(o.getLayerById(h),i)){l=!0;break}if(l){var u=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),{spans:c,lodInfo:d}=u,{level:p}=d,f=Object(y.i)(),v=[];if(this._renderPasses){var g=this._renderPasses[0];Object(n.k)(this._clippingInfos)&&(g.brushes[0].prepareState(e,this._clippingInfos[0]),g.brushes[0].drawMany(e,this._clippingInfos))}var m,b=this._backgroundTiles,_=0;for(var{row:w,colFrom:x,colTo:O}of c)for(var T=x;T<=O;T++){if(_<b.length)(m=b[_]).key.set(p,w,d.normalizeCol(T),d.getWorldForColumn(T)),this._tileInfoView.getTileBounds(f,m.key,!1),m.bounds=f,m.coords[0]=f[0],m.coords[1]=f[3];else{var S=new I.a(p,w,d.normalizeCol(T),d.getWorldForColumn(T));m=new Y.a(S,this._tileInfoView.getTileBounds(Object(y.i)(),S),[512,512],[4096,4096]),b.push(m)}m.setTransform(s,this._tileInfoView.getTileResolution(m.key)),v.push(m),_++}r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(7680,7680,7681),r.setStencilFunction(514,0,255);var D=!0;for(var P of(e.drawPhase===K.c.HITTEST&&(D=!1),r.setStencilTestEnabled(D),t)){var L=o.getLayerById(P);ce(L,i)&&(e.styleLayerUID=L.uid,e.styleLayer=L,a.renderObjects(e,v,"vtlBackground"))}J.a.pool.release(u)}}}var pe=r(336),ye=r(508);class fe extends ye.a{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(e){var t=I.a.pool.acquire(e),r=0===t.level?null:I.a.getId(t.level-1,t.row>>1,t.col>>1,t.world);return I.a.pool.release(t),r}getTileCoverage(e,t,r){var i=super.getTileCoverage(e,t,r);if(!i)return i;var a=1<<i.lodInfo.level;return i.spans=i.spans.filter((e=>e.row>=0&&e.row<a)),i}scaleToLevel(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,r,i=this._fullCacheLodInfos;if(e>i[0].scale)return i[0].level;for(var a=0;a<i.length-1;a++)if(e>(r=i[a+1]).scale)return(t=i[a]).level+(t.scale-e)/(t.scale-r.scale);return i[i.length-1].level}_initializeFullCacheLODs(e){var t;if(0===e[0].level)t=e.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})));else{var r=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=pe.a.create({size:r,spatialReference:i}).lods.map((e=>({level:e.level,resolution:e.resolution,scale:e.scale})))}for(var a=0;a<t.length;a++)this._levelByScale[t[a].scale]=t[a].level;this._fullCacheLodInfos=t}}var ve=fe,ge=o.a.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),me=class extends(Object(_.a)(b.a)){constructor(){super(...arguments),this._styleChanges=[],this._handles=new p.a,this._fetchQueue=null,this._parseQueue=null,this._isTileHandlerReady=!1,this.fading=!1}initialize(){var e=this.layer.tileInfo;if((e&&e.spatialReference).equals(this.view.spatialReference)){var{style:t,spriteUrl:r,glyphsUrl:i}=this.layer.currentStyleInfo;this._styleRepository=new v.a(t,{spriteUrl:r,glyphsUrl:i}),this._tileInfoView=new ve(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new de(this._tileInfoView),this._tileHandler=new N(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this.handles.add([this._vectorTileContainer.on("fade-start",(()=>{this.fading=!0,this.notifyChange("updating"),this.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(()=>{this.fading=!1,this.notifyChange("updating"),this.requestUpdate()}))])}else this.addResolvingPromise(Promise.reject(new u.a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))}destroy(){var e;this._stop(),this.container.removeAllChildren(),this._vectorTileContainer&&(this._vectorTileContainer.destroy(),this._vectorTileContainer=null),null==(e=this._tileHandler)||e.destroy(),this._tileHandler=null}hitTest(e,t){var r=this;return Object(i.a)((function*(){if(r.suspended||!r._tileHandlerPromise)return null;yield r._tileHandlerPromise;var i=yield r._vectorTileContainer.hitTest(e,t);if(!i||0===i.length)return null;var a=i[0]-1,s=r._styleRepository,n=s.getStyleLayerByUID(a);if(!n)return null;var o=s.getStyleLayerIndex(n.id),l=new d.a({attributes:{layerId:o,layerName:n.id,layerUID:a}});return l.layer=r.layer,l.sourceLayer=r.layer,l}))()}update(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}attach(){this._start(),this._handles.add([this.layer.on("paint-change",(e=>{if(e.isDataDriven)this._styleChanges.push({type:0,data:e}),this.notifyChange("updating"),this.requestUpdate();else{var t=this._styleRepository,r=t.getLayerById(e.layerName);if(!r)return;var i=3===r.type;t.setPaintProperties(e.layerName,e.paint),i&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(e=>{var t=this._styleRepository,r=t.getLayerById(e.layer);if(r){var i=Object(f.a)(r.layout,e.layout);if(!Object(n.j)(i)){if(Object(f.b)(i,"visibility")&&1===function(e){if(Object(n.j)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(i))return t.setLayoutProperties(e.layer,e.layout),3===r.type&&this._vectorTileContainer.restartDeclutter(),void this._vectorTileContainer.requestRender();this._styleChanges.push({type:1,data:e}),this.notifyChange("updating"),this.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(e=>{var t=this._styleRepository,r=t.getLayerById(e.layer);r&&(t.setStyleLayerVisibility(e.layer,e.visibility),3===r.type&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(e=>{this._styleChanges.push({type:2,data:e}),this.notifyChange("updating"),this.requestUpdate()})),this.layer.on("delete-style-layer",(e=>{this._styleChanges.push({type:3,data:e}),this.notifyChange("updating"),this.requestUpdate()})),this.layer.on("load-style",(()=>this._loadStyle()))])}detach(){this._stop(),this._handles.removeAll()}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}canResume(){var e=super.canResume(),t=this.layer;if(e&&t.currentStyleInfo){var r=this.view.scale,i=t.currentStyleInfo;if(i&&i.layerDefinition){var a=i.layerDefinition;a.minScale&&a.minScale<r&&(e=!1),a.maxScale&&a.maxScale>r&&(e=!1)}}return e}isUpdating(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((e=>e.invalidating)).length>0||this.fading}acquireTile(e){var t=this._createVectorTile(e);return this._tileHandlerPromise.then((()=>{this._fetchQueue.push(t.key).then((e=>this._parseQueue.push({key:t.key,data:e}))).then((e=>{t.once("attach",(()=>this.requestUpdate())),e&&(t.setData(e.tileData),this.requestUpdate(),this.notifyChange("updating"))})).catch((e=>{this.notifyChange("updating"),Object(c.m)(e)||ge.error(e)}))})),t}releaseTile(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}_start(){if(this._stop(),this._tileManager=new G({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var e=new AbortController,t=this._tileHandler.start({signal:e.signal}).then((()=>{this._fetchQueue=new g.a({tileInfoView:this._tileInfoView,process:(e,t)=>this._getTileData(e,t),concurrency:15}),this._parseQueue=new g.a({tileInfoView:this._tileInfoView,process:(e,t)=>this._parseTileData(e,t),concurrency:8}),this.requestUpdate(),this._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((e=>{this._vectorTileContainer.setStyleResources(e,this._tileHandler.glyphMosaic,this._styleRepository),this.requestUpdate()})),this._tileHandlerAbortController=e,this._tileHandlerPromise=t}}_stop(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}_getTileData(e,t){var r=this;return Object(i.a)((function*(){var i=yield r._tileHandler.fetchTileData(e,t);return r.notifyChange("updating"),i}))()}_parseTileData(e,t){var r=this;return Object(i.a)((function*(){return r._tileHandler.parseTileData(e,t)}))()}_applyStyleChanges(){var e=this;return Object(i.a)((function*(){e._isTileHandlerReady=!1,e._fetchQueue.pause(),e._parseQueue.pause(),e._fetchQueue.clear(),e._parseQueue.clear(),e._tileManager.clearCache();var t=e._styleChanges;try{yield e._tileHandler.updateStyle(t)}catch(c){ge.error("error applying vector-tiles style update",c.message),e._fetchQueue.resume(),e._parseQueue.resume(),e._isTileHandlerReady=!0}var r=e._styleRepository,i=[];t.forEach((e=>{if(3===e.type){var t=e.data,a=r.getLayerById(t.layerName);a&&i.push(a.uid)}}));var a,s=[];t.forEach((e=>{var t=e.type,i=e.data;switch(t){case 0:r.setPaintProperties(i.layerName,i.paint),a=i.layerName;break;case 1:r.setLayoutProperties(i.layerName,i.layout),a=i.layerName;break;case 3:return void r.deleteStyleLayer(i.layerName);case 2:r.setStyleLayer(i.layer,i.index),a=i.layer.id}var n=r.getLayerById(a);n&&s.push(n.uid)}));var n=e._vectorTileContainer.children;if(i.length>0)for(var o of(e._vectorTileContainer.deleteStyleLayers(i),n))o.deleteLayerData(i);if(e._fetchQueue.resume(),e._parseQueue.resume(),s.length>0){var l=[],h=function(t){var r=e._fetchQueue.push(t.key).then((r=>e._parseQueue.push({key:t.key,data:r,styleLayerUIDs:s}))).then((e=>t.setData(e.tileData)));l.push(r)};for(var u of n)h(u);yield Promise.all(l)}e._styleChanges=[],e._isTileHandlerReady=!0,e.notifyChange("updating"),e.requestUpdate()}))()}_loadStyle(){var e=this;return Object(i.a)((function*(){var{style:t,spriteUrl:r,glyphsUrl:i}=e.layer.currentStyleInfo;e._isTileHandlerReady=!1,e._fetchQueue.pause(),e._parseQueue.pause(),e._fetchQueue.clear(),e._parseQueue.clear(),e.notifyChange("updating"),e._styleRepository=new v.a(t,{spriteUrl:r,glyphsUrl:i}),e._vectorTileContainer.destroy(),e._tileManager.clear(),e._tileHandlerAbortController.abort(),e._tileHandlerAbortController=Object(c.d)();var{signal:a}=e._tileHandlerAbortController;try{e._tileHandlerPromise=e._tileHandler.setStyle(e._styleRepository,t),yield e._tileHandlerPromise}catch(n){if(!Object(c.m)(n))throw n}if(a.aborted)return e._fetchQueue.resume(),e._parseQueue.resume(),e._isTileHandlerReady=!0,e.notifyChange("updating"),void e.requestUpdate();var s=yield e._tileHandler.spriteMosaic;e._vectorTileContainer.setStyleResources(s,e._tileHandler.glyphMosaic,e._styleRepository),e._fetchQueue.resume(),e._parseQueue.resume(),e._isTileHandlerReady=!0,e.notifyChange("updating"),e.requestUpdate()}))()}_createVectorTile(e){var t=this._tileInfoView.getTileBounds(Object(y.i)(),e);return new m.a(e,this._styleRepository,t,[512,512])}};Object(a.a)([Object(l.b)()],me.prototype,"_fetchQueue",void 0),Object(a.a)([Object(l.b)()],me.prototype,"_parseQueue",void 0),Object(a.a)([Object(l.b)()],me.prototype,"_isTileHandlerReady",void 0),Object(a.a)([Object(l.b)()],me.prototype,"suspended",void 0),Object(a.a)([Object(l.b)()],me.prototype,"fading",void 0),Object(a.a)([Object(l.b)()],me.prototype,"updating",void 0);var be=me=Object(a.a)([Object(h.a)("esri.views.2d.layers.VectorTileLayerView2D")],me);t.default=be},382:function(e,t,r){"use strict";var i=r(82),a=(r(80),r(81)),s=(r(88),r(85)),n=r(84),o=(r(83),r(86),r(87),r(97)),l=r(131),h=r(266),u=r(227),c=r(167),d=class extends(Object(c.b)(Object(h.a)(Object(u.b)(l.a.EventedMixin(o.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t=this.layer&&this.layer.id||"no id",r=this.layer&&this.layer.title||"no title";throw a.a.getLogger(this.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(t,"')"),e),e}}))}get fullOpacity(){var e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i.a)([Object(s.b)()],d.prototype,"fullOpacity",null),Object(i.a)([Object(s.b)()],d.prototype,"layer",void 0),Object(i.a)([Object(s.b)()],d.prototype,"parent",void 0),Object(i.a)([Object(s.b)({readOnly:!0})],d.prototype,"suspended",null),Object(i.a)([Object(s.b)({readOnly:!0})],d.prototype,"suspendInfo",null),Object(i.a)([Object(s.b)({readOnly:!0})],d.prototype,"legendEnabled",null),Object(i.a)([Object(s.b)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),Object(i.a)([Object(s.b)()],d.prototype,"visible",null);var p=d=Object(i.a)([Object(n.a)("esri.views.layers.LayerView")],d);t.a=p},384:function(e,t,r){"use strict";r.d(t,"a",(function(){return D}));var i,a=r(82),s=(r(80),r(81),r(88),r(85)),n=r(84),o=(r(83),r(86),r(87),r(107)),l=r(293),h=r(108),u=r(90),c=class extends u.a{},d=c=Object(a.a)([Object(n.a)("esri.views.layers.support.ClipArea")],c),p=i=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new i({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],p.prototype,"left",void 0),Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],p.prototype,"right",void 0),Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],p.prototype,"top",void 0),Object(a.a)([Object(s.b)({type:[Number,String],json:{write:!0}})],p.prototype,"bottom",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],p.prototype,"version",null);var y,f=p=i=Object(a.a)([Object(n.a)("esri.views.layers.support.ClipRect")],p),v=r(492),g=r(166),m=r(103),b=r(130),_=r(100),w=(r(101),{base:g.a,key:"type",typeMap:{extent:m.a,polygon:b.a}}),x=y=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new y({geometry:this.geometry.clone()})}};Object(a.a)([Object(s.b)({types:w,json:{read:_.a,write:!0}})],x.prototype,"geometry",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],x.prototype,"version",null);var O=x=y=Object(a.a)([Object(n.a)("esri.views.layers.support.Geometry")],x),T=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(a.a)([Object(s.b)({type:[[[Number]]],json:{write:!0}})],T.prototype,"path",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],T.prototype,"version",null);var I=T=Object(a.a)([Object(n.a)("esri.views.layers.support.Path")],T),S=o.a.ofType({key:"type",base:d,typeMap:{rect:f,path:I,geometry:O}}),D=e=>{var t=class extends e{constructor(){super(...arguments),this.clips=new S,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new v.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.a)(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),Object(h.a)(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),Object(h.a)(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),Object(h.a)(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){var t=!0,r=this.layer,i=r.minScale,a=r.maxScale;if(null!=i&&null!=a){var s=!i,n=!a;!s&&e<=i&&(s=!0),!n&&e>=a&&(n=!0),t=s&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(a.a)([Object(s.b)({type:S,set(e){var t=Object(l.b)(e,this._get("clips"),S);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(a.a)([Object(s.b)()],t.prototype,"moving",void 0),Object(a.a)([Object(s.b)()],t.prototype,"attached",void 0),Object(a.a)([Object(s.b)()],t.prototype,"container",void 0),Object(a.a)([Object(s.b)()],t.prototype,"suspended",void 0),Object(a.a)([Object(s.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(a.a)([Object(s.b)()],t.prototype,"updateRequested",void 0),Object(a.a)([Object(s.b)()],t.prototype,"updating",null),Object(a.a)([Object(s.b)()],t.prototype,"view",void 0),t=Object(a.a)([Object(n.a)("esri.views.2d.layers.LayerView2D")],t)}},404:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r(80);var i=r(305),a=r(245),s=r(395),n=r(415);class o extends n.a{constructor(e,t,r,i=r){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:Object(s.b)(),tileMat3:Object(s.b)()},this.triangleCount=0,this.key=new a.a(e),this.bounds=t,this.size=r,this.coordRange=i}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,t){var r=t/(e.resolution*e.pixelRatio),a=this.transforms.tileMat3,[s,n]=e.toScreenNoRotation([0,0],this.coords),o=this.size[0]/this.coordRange[0]*r,l=this.size[1]/this.coordRange[1]*r;Object(i.j)(a,o,0,0,0,l,0,s,n,1),Object(i.g)(this.transforms.dvs,e.displayViewMat3,a)}}},432:function(e,t,r){"use strict";var i=r(91),a=r(127),s=r(593),n=r(588),o=r(510),l=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends o.a{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(l),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){var{state:t}=e;return Object(i.a)(Object(i.a)({},super.createRenderParams(e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}prepareRenderPasses(e){var t=e.registerRenderPass({name:"stencil",brushes:[n.a],drawPhase:a.c.DEBUG|a.c.MAP|a.c.HIGHLIGHT,target:()=>this.getStencilTarget()}),r=e.registerRenderPass({name:"tileInfo",brushes:[s.a],drawPhase:a.c.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(e),t,r]}getStencilTarget(){return this.children}updateTransforms(e){for(var t of this.children){var r=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,r)}}setStencilReference(){var e=1;for(var t of this.children)t.stencilRef=e++}}t.a=h},446:function(e,t,r){"use strict";t.a=class{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},466:function(e,t,r){"use strict";function i(e){return"h"in e&&"s"in e&&"v"in e}function a(e){return"l"in e&&"a"in e&&"b"in e}function s(e){return"l"in e&&"c"in e&&"h"in e}function n(e){return"x"in e&&"y"in e&&"z"in e}r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return w})),r.d(t,"e",(function(){return m}));var o=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){var r,i,a=[];if(e[0].length!==t.length)throw"dimensions do not match";var s=e.length,n=e[0].length,o=0;for(r=0;r<s;r++){for(o=0,i=0;i<n;i++)o+=e[r][i]*t[i];a.push(o)}return a}function u(e){var t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4))),r=h(o,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function c(e){var t=h(l,[e.x/100,e.y/100,e.z/100]).map((e=>{var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function d(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function p(e){var t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function y(e){return d(u(e))}function f(e){return c(p(e))}function v(e){return function(e){var t=e.l,r=e.a,i=e.b,a=Math.sqrt(r*r+i*i),s=Math.atan2(i,r);return{l:t,c:a,h:s=s>0?s:s+2*Math.PI}}(d(u(e)))}function g(e){return c(p(function(e){var t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}function m(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:s(e)?g(e):a(e)?f(e):n(e)?c(e):i(e)?function(e){var t,r=(e.h+360)%360/60,i=e.s/100,a=e.v/100*255,s=a*i,n=s*(1-Math.abs(r%2-1));switch(Math.floor(r)){case 0:t={r:s,g:n,b:0};break;case 1:t={r:n,g:s,b:0};break;case 2:t={r:0,g:s,b:n};break;case 3:t={r:0,g:n,b:s};break;case 4:t={r:n,g:0,b:s};break;case 5:case 6:t={r:s,g:0,b:n};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+a-s),t.g=Math.round(t.g+a-s),t.b=Math.round(t.b+a-s),t}(e):e}function b(e){return i(e)?e:function(e){var t=e.r,r=e.g,i=e.b,a=Math.max(t,r,i),s=a-Math.min(t,r,i),n=a,o=0===s?0:a===t?(r-i)/s%6:a===r?(i-t)/s+2:(t-r)/s+4,l=0===s?0:s/n;return o<0&&(o+=6),{h:o*=60,s:l*=100,v:n*=100/255}}(m(e))}function _(e){return a(e)?e:y(m(e))}function w(e){return s(e)?e:v(m(e))}function x(e,t){var r=y(e);return r.l*=1-t,f(r)}},592:function(e,t,r){"use strict";r.d(t,"a",(function(){return S}));var i=r(7),a=r(91),s=r(82),n=(r(80),r(81)),o=r(85),l=r(116),h=r(84),u=r(93),c=r(83),d=(r(86),r(87),r(176)),p=r(94),y=r(241),f=r(97),v=r(106),g=r(115),m=r(108),b=r(235),_=r(92),w=r(209);class x{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),i=r%8,a=r>>3,s=this._tileAvailabilityBitSet;return a<0||a>s.length?"unknown":s[a]&1<<i?"available":"unavailable"}_updateFromData(e){for(var t=this.location.width,r=this.location.height,i=!0,a=!0,s=Math.ceil(t*r/8),n=new Uint8Array(s),o=0,l=0;l<e.length;l++){var h=l%8;e[l]?(a=!1,n[o]|=1<<h):i=!1,7===h&&++o}a?this._allAvailability="unavailable":i?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)}static fromDefinition(e,t){var r=e.service.request||v.default,{row:i,col:s,width:n,height:o}=e,l={query:{f:"json"}};return t=t?Object(a.a)(Object(a.a)({},l),t):l,r(function(e){var t;if("vector-tile"===e.service.type)t="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);else{var r=e.service.tileServers;t="".concat(r&&r.length?r[e.row%r.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var i=e.service.query;return i&&(t="".concat(t,"?").concat(i)),t}(e),t).then((e=>e.data)).catch((e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:i,left:s,width:n,height:o},valid:!0,data:Object(w.b)(n*o,0)};throw e})).then((e=>{if(e.location&&(e.location.top!==i||e.location.left!==s||e.location.width!==n||e.location.height!==o))throw new u.a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:i,left:s,width:n,height:o}});return x.fromJSON(e)}))}static fromJSON(e){x.validateJSON(e);var t=new x;return t.location=Object.freeze(Object(_.a)(e.location)),t._updateFromData(e.data),Object.freeze(t)}static validateJSON(e){if(!e||!e.location)throw new u.a("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new u.a("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new u.a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new u.a("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new u.a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function O(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var T,I=n.a.getLogger("esri.layers.support.TilemapCache"),S=T=class extends f.a{constructor(e){super(e),this._handles=new g.a,this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=v.default,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new b.a(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(()=>this._initializeTilemapDefinition())),Object(m.a)(this,"layer.tileInfo.lods",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}castLevels(e){return e<=2?(I.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,r,i){if(!this._availableLevels[e])return Promise.reject(new u.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var s=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,r,s);if(n)return Promise.resolve(n);var o=i&&i.signal;return i=Object(a.a)(Object(a.a)({},i),{},{signal:null}),new Promise(((e,t)=>{Object(p.p)(o,(()=>t(Object(p.e)())));var r=O(s),a=this._pendingTilemapRequests[r];if(!a){a=x.fromDefinition(s,i).then((e=>(this._tilemapCache.put(r,e,e.byteSize),e)));var n=()=>delete this._pendingTilemapRequests[r];this._pendingTilemapRequests[r]=a,a.then(n,n)}a.then(e,t)}))}getAvailability(e,t,r){if(!this._availableLevels[e])return"unavailable";var i=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return i?i.getAvailability(t,r):"unknown"}getAvailabilityUpsample(e,t,r,i){i.level=e,i.row=t,i.col=r;var a=this.layer.tileInfo;for(a.updateTileInfo(i);;){var s=this.getAvailability(i.level,i.row,i.col);if("unavailable"!==s)return s;if(!a.upsampleTile(i))return"unavailable"}}fetchAvailability(e,t,r,i){return this._availableLevels[e]?this.fetchTilemap(e,t,r,i).catch((e=>e)).then((i=>{if(i instanceof x){var a=i.getAvailability(t,r);return"unavailable"===a?Promise.reject(new u.a("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})):a}if(Object(p.m)(i))throw i;return"unknown"})):Promise.reject(new u.a("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")))}fetchAvailabilityUpsample(e,t,r,i,a){i.level=e,i.row=t,i.col=r;var s=this.layer.tileInfo;s.updateTileInfo(i);var n=this.fetchAvailability(e,t,r,a).catch((e=>{if(Object(p.m)(e))throw e;if(s.upsampleTile(i))return this.fetchAvailabilityUpsample(i.level,i.row,i.col,i);throw e}));return this._fetchAvailabilityUpsamplePrefetch(i.id,e,t,r,a,n),n}_fetchAvailabilityUpsamplePrefetch(e,t,r,s,n,o){var l=this;return Object(i.a)((function*(){if(l._prefetchingEnabled){var i="prefetch-".concat(e);if(!l._handles.has(i)){var h=Object(p.d)();o.then((()=>h.abort()),(()=>h.abort()));var u=!1,c={remove(){u||(u=!0,h.abort())}};if(l._handles.add(c,i),yield Object(y.c)(10,h.signal).catch((()=>{})),u||(u=!0,l._handles.remove(i)),!Object(p.n)(h))for(var d={id:e,level:t,row:r,col:s},f=Object(a.a)(Object(a.a)({},n),{},{signal:h.signal}),v=l.layer.tileInfo,g=function(e){var t=l.fetchAvailability(d.level,d.row,d.col,f);T._prefetches.push(t);var r=()=>{T._prefetches.removeUnordered(t)};t.then(r,r)},m=0;T._prefetches.length<T._maxPrefetch&&v.upsampleTile(d);++m)g()}}}))()}_initializeTilemapDefinition(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Object(c.D)(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}}_tilemapFromCache(e,t,r,i){i.level=e,i.row=t-t%this.size,i.col=r-r%this.size;var a=O(i);return this._tilemapCache.get(a)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,r,i)=>!!e._tilemapFromCache(t,r,i,e._tmpTilemapDefinition)}}};S._maxPrefetch=4,S._prefetches=new d.a({initialSize:T._maxPrefetch}),Object(s.a)([Object(o.b)({constructOnly:!0,type:Number})],S.prototype,"levels",void 0),Object(s.a)([Object(l.a)("levels")],S.prototype,"castLevels",null),Object(s.a)([Object(o.b)({readOnly:!0,type:Number})],S.prototype,"size",null),Object(s.a)([Object(o.b)({constructOnly:!0,type:Number})],S.prototype,"cacheByteSize",void 0),Object(s.a)([Object(o.b)({constructOnly:!0})],S.prototype,"layer",void 0),Object(s.a)([Object(o.b)({constructOnly:!0})],S.prototype,"request",void 0),S=T=Object(s.a)([Object(h.a)("esri.layers.support.TilemapCache")],S)},644:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return i})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return d})),r.d(t,"f",(function(){return c})),r.d(t,"g",(function(){return h})),r.d(t,"h",(function(){return u}));var i=Number.POSITIVE_INFINITY,a=Math.PI,s=2*a,n=128/a,o=a/180,l=1/Math.LN2;function h(e,t){return(e%=t)>=0?e:e+t}function u(e){return h(e*n,256)}function c(e){return Math.log(e)*l}function d(e,t,r){return e*(1-r)+t*r}},749:function(e,t,r){"use strict";t.a=class{constructor(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}static i8816to32(e,t,r){return 255&e|(255&t)<<8|r<<16}}},774:function(e,t,r){"use strict";var i=r(796);class a{constructor(e,t){if(this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.sprite=t?t.spriteUrl:e.sprite,this.glyphs=t?t.glyphsUrl:e.glyphs,this.layers=e.layers.map(((e,t,r)=>this._create(e,t,r))),this.layers)for(var r,i=0;i<this.layers.length;i++)r=this.layers[i],this._layerByName[r.id.toLowerCase()]=r,this._uidToLayer.set(r.uid,r),0===r.type&&this.backgroundBucketIds.push(r.id);this._identifyRefLayers()}isPainterDataDriven(e){var t=this._layerByName[e.toLowerCase()];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){var t=this._uidToLayer.get(e);return null!=t?t:null}getStyleLayerIndex(e){var t=this._layerByName[e.toLowerCase()];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(e&&e.id){t&&t>=this.layers.length&&(t=this.layers.length-1);var r,i=!0,s=this._layerByName[e.id.toLowerCase()];if(s){var n=this.layers.indexOf(s);t||(t=n),t===n?(i=!1,r=a._recreateLayer(e,s),this.layers[t]=r):(this.layers.splice(n,1),r=this._create(e,t,this.layers),this.layers.splice(t,0,r))}else r=this._create(e,t,this.layers),!t||t>=this.layers.length?this.layers.push(r):this.layers.splice(t,0,r);this._layerByName[e.id.toLowerCase()]=r,this._uidToLayer.set(r.uid,r),i&&this._recomputeZValues(),this._identifyRefLayers()}}getStyleLayer(e){var t=this._layerByName[e.toLowerCase()];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){var t=this._layerByName[e.toLowerCase()];if(t){delete this._layerByName[e.toLowerCase()],this._uidToLayer.delete(t.uid);var r=this.layers.indexOf(t);this.layers.splice(r,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e.toLowerCase()]}getLayoutProperties(e){var t=this._layerByName[e.toLowerCase()];return t?t.layout:null}getPaintProperties(e){var t=this._layerByName[e.toLowerCase()];return t?t.paint:null}setPaintProperties(e,t){var r=this._layerByName[e.toLowerCase()];if(!r)return"";var i={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:t},s=a._recreateLayer(i,r),n=this.layers.indexOf(r);return this.layers[n]=s,this._layerByName[r.id.toLowerCase()]=s,this._uidToLayer.set(r.uid,s),r.id}setLayoutProperties(e,t){var r=this._layerByName[e.toLowerCase()];if(!r)return"";var i={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:t,paint:r.paint},s=a._recreateLayer(i,r),n=this.layers.indexOf(r);return this.layers[n]=s,this._layerByName[r.id.toLowerCase()]=s,this._uidToLayer.set(r.uid,s),r.id}setStyleLayerVisibility(e,t){var r=this._layerByName[e.toLowerCase()];if(r){var i=r.layout||{};i.visibility=t;var s={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:i,paint:r.paint},n=a._recreateLayer(s,r),o=this.layers.indexOf(r);this.layers[o]=n,this._layerByName[r.id.toLowerCase()]=n,this._uidToLayer.set(r.uid,n)}}getStyleLayerVisibility(e){var t,r=this._layerByName[e.toLowerCase()];if(!r)return"none";var i=r.layout;return null!=(t=null==i?void 0:i.visibility)?t:"visible"}_recomputeZValues(){for(var e=this.layers,t=1/(e.length+1),r=0;r<e.length;r++)e[r].z=1-(1+r)*t}_identifyRefLayers(){var e=[],t=[],r=0;for(var i of this.layers){if(1===i.type){var a=i,s=i.source+"|"+i.sourceLayer;s+="|"+JSON.stringify(i.layout&&i.layout.visibility),s+="|"+JSON.stringify(i.minzoom),s+="|"+JSON.stringify(i.maxzoom),s+="|"+JSON.stringify(i.filter),(a.hasDataDrivenFill||a.hasDataDrivenOutline)&&(s+="|"+JSON.stringify(r)),e.push({key:s,layer:i})}if(2===i.type){var n=i,o=i.source+"|"+i.sourceLayer;o+="|"+JSON.stringify(i.layout&&i.layout.visibility),o+="|"+JSON.stringify(i.minzoom),o+="|"+JSON.stringify(i.maxzoom),o+="|"+JSON.stringify(i.filter),o+="|"+JSON.stringify(i.layout&&i.layout["line-cap"]),o+="|"+JSON.stringify(i.layout&&i.layout["line-join"]),n.hasDataDrivenLine&&(o+="|"+JSON.stringify(r)),t.push({key:o,layer:i})}++r}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){var t,r;e.sort(((e,t)=>e.key<t.key?-1:e.key>t.key?1:0));for(var i=e.length,a=0;a<i;a++){var s=e[a];if(s.key===t)s.layer.refLayerId=r;else if(t=s.key,r=s.layer.id,1===s.layer.type&&!s.layer.getPaintProperty("fill-outline-color"))for(var n=a+1;n<i;n++){var o=e[n];if(o.key!==t)break;if(o.layer.getPaintProperty("fill-outline-color")){e[a]=o,e[n]=s,r=o.layer.id;break}}}}_create(e,t,r){var a=1-(1+t)*(1/(r.length+1)),s=this._runningId++;switch(e.type){case"background":return new i.a(0,e,a,s);case"fill":return new i.c(1,e,a,s);case"line":return new i.e(2,e,a,s);case"symbol":return new i.f(3,e,a,s);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new i.b(4,e,a,s)}throw new Error("Unknown vector tile layer")}static _recreateLayer(e,t){switch(e.type){case"background":return new i.a(0,e,t.z,t.uid);case"fill":return new i.c(1,e,t.z,t.uid);case"line":return new i.e(2,e,t.z,t.uid);case"symbol":return new i.f(3,e,t.z,t.uid);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new i.b(4,e,t.z,t.uid)}}}t.a=a},775:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"d",(function(){return o}));r(89);var i=r(896);function a(e,t,r,i,a,s){var n=r-a;if(n>=0)return(t>>n)+(i-(s<<n))*(e>>n);var o=-n;return t-(s-(i<<o))*(e>>o)<<o}class s{constructor(e,t,r){this._rows=Math.ceil(t/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(var i=0;i<this._rows;i++){this.cells[i]=new Array(this._columns);for(var a=0;a<this._columns;a++)this.cells[i][a]=[]}}getCell(e,t){var r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][i]||null}getCellSpan(e,t,r,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function n(e,t,r,a,s,n){for(var o=t[a++],l=0;l<o;l++){var h=new i.a(n);h.xTile=t[a++],h.yTile=t[a++],h.hash=t[a++],h.priority=t[a++];for(var u=t[a++],c=0;c<u;c++){var d=t[a++],p=t[a++],y=t[a++],f=t[a++],v=!!t[a++],g=t[a++],m=r[a++],b=r[a++],_=t[a++],w=t[a++];h.colliders.push({xTile:d,yTile:p,dxPixels:y,dyPixels:f,hard:v,partIndex:g,width:_,height:w,minLod:m,maxLod:b})}for(var x=e[a++],O=0;O<x;O++)h.textVertexRanges.push([e[a++],e[a++]]);for(var T=e[a++],I=0;I<T;I++)h.iconVertexRanges.push([e[a++],e[a++]]);s.push(h)}return a}function o(e,t,r){for(var[i,a]of e.symbols)l(e,t,r,a,i)}function l(e,t,r,i,a){var s=e.layerData.get(a);if(3===s.type){for(var n of i){var o=n.unique,l=void 0;if(n.selectedForRendering){var h=o.parts[0],u=h.startOpacity,c=h.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===c;var d=r?Math.floor(127*u)|c<<7:c?255:0;l=d<<24|d<<16|d<<8|d}else l=0;for(var[p,y]of n.iconVertexRanges)for(var f=p;f<p+y;f+=4)s.iconOpacity[f/4]=l;if(n.selectedForRendering){var v=o.parts[1],g=v.startOpacity,m=v.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===m;var b=r?Math.floor(127*g)|m<<7:m?255:0;l=b<<24|b<<16|b<<8|b}else l=0;for(var[_,w]of n.textVertexRanges)for(var x=_;x<_+w;x+=4)s.textOpacity[x/4]=l}s.lastOpacityUpdate=t,s.opacityChanged=!0}}},796:function(e,t,r){"use strict";r.d(t,"a",(function(){return Ie})),r.d(t,"b",(function(){return Le})),r.d(t,"c",(function(){return Se})),r.d(t,"d",(function(){return je})),r.d(t,"e",(function(){return De})),r.d(t,"f",(function(){return Pe})),r.d(t,"g",(function(){return ke}));var i=r(91),a=r(373),s=r(749);class n{constructor(e){this._color=Object(a.b)(),this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._locations||this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,r,i){var a=this.getUniforms();for(var s in a){var n=a[s];switch(n.type){case"float":e.setUniform1f(n.name,n.getValue(r,t,i));break;case"vec2":e.setUniform2fv(n.name,n.getValue(r,t,i));break;case"vec4":var o=n.getValue(r,t,i),l=o[3];this._color[0]=l*o[0],this._color[1]=l*o[1],this._color[2]=l*o[2],this._color[3]=l,e.setUniform4fv(n.name,this._color)}}}encodeAttributes(e,t,r){var i=this.attributesInfo(),a=this.getEncodingInfos(),s=[];for(var n of Object.keys(a)){var o,l=a[n],{type:h,precisionFactor:u,isLayout:c}=i[n],d=c?r.getLayoutProperty(n):r.getPaintProperty(n),p=null==(o=d.interpolator)?void 0:o.getInterpolationRange(t),y=0;for(var f of l){f.dataIndex>=s.length&&s.push(0);var v=d.getValue(p?p[y]:t,e);switch(h){case 0:s[f.dataIndex]|=this._encodeByte(v*(u||1),8*f.offset);break;case 1:s[f.dataIndex]|=this._encodeByte(v*(u||1)+128,8*f.offset);break;case 2:s[f.dataIndex]=this._encodeColor(v);break;default:throw new Error("Unsupported encoding type")}++y}}return s}getAtributeState(e){var t=0,r=3+2*e;return t|=this._bit(r),t|=this._bit(r+1)<<1}_buildAttributesInfo(){var e=[],t={},r={},i=-1,a=this.attributesInfo(),s=this.attributes(),o=-1;for(var l of s){++o;var h=this.getAtributeState(o);if(0!==h){var u=a[l],c=[];t[l]=c;for(var d=u.type,p=0;p<h;++p){var{dataType:y,bytesPerElement:f,count:v,normalized:g}=n._encodingInfo[d],m=y<<2|v,b=r[m];b&&4!==b.offset||(++i,r[m]=b={dataIndex:i,offset:0},e.push({location:-1,name:"a_data_"+i,count:4/f,type:y,normalized:g})),c.push({dataIndex:b.dataIndex,offset:b.offset}),b.offset+=f*v}}}this._buildVertexBufferLayout(e);var _={},w=0,x=this._layoutInfo.geometry;for(var O of x)_[O.name]=w++;var T=this._layoutInfo.opacity;if(T)for(var I of T)_[I.name]=w++;this._buildShaderInfo(e,t),this._propertyEncodingInfo=t,this._locations=_}_buildVertexBufferLayout(e){var t={},r=this.geometryInfo(),a=r[0].stride;if(0===e.length)t.geometry=r;else{var s=[],n=a;for(var l of(a+=4*e.length,r)){var h=Object(i.a)({},l);h.stride=a,s.push(h)}for(var u of e)s.push({name:u.name,count:u.count,type:u.type,offset:n,stride:a,normalized:u.normalized||!1,divisor:0}),n+=o(u.type)*u.count;t.geometry=s}this.opacityInfo()&&(t.opacity=this.opacityInfo()),this._layoutInfo=t,this._stride=a}_buildShaderInfo(e,t){var r=this,i="\n",a="\n",s=[];for(var o of e)i+="attribute ".concat(this._getType(o.count)," ").concat(o.name,";\n");var l=this.attributes(),h=this.attributesInfo(),u=-1,c=function(e){++u;var{name:o,type:l,precisionFactor:c,isLayout:d}=h[e],p=c&&1!==c?" * "+1/c:"",{bytesPerElement:y,count:f}=n._encodingInfo[l],v=e=>{var t=2===l?"":"[".concat(e.offset/y,"]");return"a_data_".concat(e.dataIndex).concat(t)};switch(r.getAtributeState(u)){case 0:var g=r._getType(f),m="u_".concat(o);s.push({name:m,type:g,getValue:(t,r)=>d?t.getLayoutValue(e,r):t.getPaintValue(e,r)}),i+="uniform ".concat(g," ").concat(m,";\n"),a+="".concat(g," ").concat(o," = ").concat(m,";\n");break;case 1:var b=v(t[e][0]);a+="".concat(r._getType(f)," ").concat(o," = ").concat(b).concat(p,";\n");break;case 2:var _="u_t_".concat(o);s.push({name:_,type:"float",getValue:(t,r,i)=>(d?t.getLayoutProperty(e):t.getPaintProperty(e)).interpolator.interpolationUniformValue(i,r)}),i+="uniform float ".concat(_,";\n");var w=v(t[e][0]),x=v(t[e][1]);a+="".concat(r._getType(f)," ").concat(o," = mix(").concat(w).concat(p,", ").concat(x).concat(p,", ").concat(_,");\n")}};for(var d of l)c(d);this._shaderHeader=i,this._shaderMain=a,this._uniforms=s}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){var t=255*e[3];return s.a.i8888to32(e[0]*t,e[1]*t,e[2]*t,t)}_encodeByte(e,t){return(255&e)<<t}}n._encodingInfo=[{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:1,normalized:!1},{dataType:5121,bytesPerElement:1,count:4,normalized:!0}];var o=e=>{switch(e){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1}};class l extends n{constructor(e){super(e)}geometryInfo(){return l.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return l.ATTRIBUTES}attributesInfo(){return l.ATTRIBUTES_INFO}}l.ATTRIBUTES=[],l.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}],l.ATTRIBUTES_INFO={};class h extends n{constructor(e){super(e)}geometryInfo(){return h.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return h.ATTRIBUTES}attributesInfo(){return h.ATTRIBUTES_INFO}}h.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],h.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],h.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:0},"circle-color":{name:"color",type:2},"circle-opacity":{name:"opacity",type:0,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:0,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:2},"circle-stroke-opacity":{name:"stroke_opacity",type:0,precisionFactor:100},"circle-blur":{name:"blur",type:0,precisionFactor:32}};class u extends n{constructor(e){super(e)}geometryInfo(){return u.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return u.ATTRIBUTES}attributesInfo(){return u.ATTRIBUTES_INFO}}u.ATTRIBUTES=["fill-color","fill-opacity"],u.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],u.ATTRIBUTES_INFO={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};class c extends n{constructor(e,t){super(e),this.usefillColor=t}geometryInfo(){return c.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this.usefillColor?c.ATTRIBUTES_FILL:c.ATTRIBUTES_OUTLINE}attributesInfo(){return this.usefillColor?c.ATTRIBUTES_INFO_FILL:c.ATTRIBUTES_INFO_OUTLINE}}c.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],c.ATTRIBUTES_FILL=["fill-color","fill-opacity"],c.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}],c.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}},c.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:2},"fill-opacity":{name:"opacity",type:0,precisionFactor:100}};class d extends n{constructor(e){super(e)}geometryInfo(){return d.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return d.ATTRIBUTES}attributesInfo(){return d.ATTRIBUTES_INFO}}d.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width"],d.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}],d.ATTRIBUTES_INFO={"line-width":{name:"width",type:0,precisionFactor:2},"line-gap-width":{name:"gap_width",type:0,precisionFactor:2},"line-offset":{name:"offset",type:1,precisionFactor:2},"line-color":{name:"color",type:2},"line-opacity":{name:"opacity",type:0,precisionFactor:100},"line-blur":{name:"blur",type:0,precisionFactor:4}};var p=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],y=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];class f extends n{constructor(e){super(e)}geometryInfo(){return p}opacityInfo(){return y}attributes(){return f.ATTRIBUTES}attributesInfo(){return f.ATTRIBUTES_INFO}}f.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],f.ATTRIBUTES_INFO={"icon-color":{name:"color",type:2},"icon-opacity":{name:"opacity",type:0,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:2},"icon-halo-width":{name:"halo_width",type:0,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"icon-size":{name:"size",type:0,precisionFactor:32,isLayout:!0}};class v extends n{constructor(e){super(e)}geometryInfo(){return p}opacityInfo(){return y}attributes(){return v.ATTRIBUTES}attributesInfo(){return v.ATTRIBUTES_INFO}}v.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],v.ATTRIBUTES_INFO={"text-color":{name:"color",type:2},"text-opacity":{name:"opacity",type:0,precisionFactor:100},"text-halo-color":{name:"halo_color",type:2},"text-halo-width":{name:"halo_width",type:0,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:0,precisionFactor:4},"text-size":{name:"size",type:0,isLayout:!0}};var g=r(109),m={kind:"null"},b={kind:"number"},_={kind:"string"},w={kind:"boolean"},x={kind:"color"},O={kind:"object"},T={kind:"value"};function I(e,t){return{kind:"array",itemType:e,n:t}}var S=[m,b,_,w,x,O,I(T)];function D(e){if("array"===e.kind){var t=D(e.itemType);return"number"==typeof e.n?"array<".concat(t,", ").concat(e.n,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}function P(e){if(null===e)return m;if("string"==typeof e)return _;if("boolean"==typeof e)return w;if("number"==typeof e)return b;if(e instanceof g.a)return x;if(Array.isArray(e)){var t;for(var r of e){var i=P(r);if(t){if(t!==i){t=T;break}}else t=i}return I(t||T,e.length)}return"object"==typeof e?O:T}function L(e,t){if("array"===t.kind)return"array"===e.kind&&(0===e.n&&"value"===e.itemType.kind||L(e.itemType,t.itemType))&&("number"!=typeof t.n||t.n===e.n);if("value"===t.kind)for(var r of S)if(L(e,r))return!0;return t.kind===e.kind}function j(e){if(null===e)return"";var t=typeof e;return"string"===t?e:"number"===t||"boolean"===t?String(e):e instanceof g.a?e.toString():JSON.stringify(e)}var k=r(466),R=r(731),C=r(644);class A{constructor(e){this.parent=e,this.vars={}}add(e,t){this.vars[e]=t}get(e){return this.vars[e]?this.vars[e]:this.parent?this.parent.get(e):null}}class M{constructor(){this.type=T}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new M}evaluate(e,t){return e.id||null}}class E{constructor(){this.type=_}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new E}evaluate(e,t){switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}class U{constructor(){this.type=O}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new U}evaluate(e,t){return e.values}}class B{constructor(){this.type=b}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new B}evaluate(e,t){return t}}class z{constructor(e,t,r){this.lhs=e,this.rhs=t,this.compare=r,this.type=w}static parse(e,t,r){if(3!==e.length&&4!==e.length)throw new Error('"'.concat(e[0],'" expects 2 or 3 arguments'));if(4===e.length)throw new Error('"'.concat(e[0],'" collator not supported'));return new z(ve(e[1],t),ve(e[2],t),r)}evaluate(e,t){return this.compare(this.lhs.evaluate(e,t),this.rhs.evaluate(e,t))}}class V{constructor(e){this.arg=e,this.type=w}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new V(ve(e[1],t))}evaluate(e,t){return!this.arg.evaluate(e,t)}}class F{constructor(e){this.args=e,this.type=w}static parse(e,t){for(var r=[],i=1;i<e.length;i++)r.push(ve(e[i],t));return new F(r)}evaluate(e,t){for(var r of this.args)if(!r.evaluate(e,t))return!1;return!0}}class q{constructor(e){this.args=e,this.type=w}static parse(e,t){for(var r=[],i=1;i<e.length;i++)r.push(ve(e[i],t));return new q(r)}evaluate(e,t){for(var r of this.args)if(r.evaluate(e,t))return!0;return!1}}class N{constructor(e){this.args=e,this.type=w}static parse(e,t){for(var r=[],i=1;i<e.length;i++)r.push(ve(e[i],t));return new N(r)}evaluate(e,t){for(var r of this.args)if(r.evaluate(e,t))return!1;return!0}}class H{constructor(e,t,r){this.type=e,this.args=t,this.fallback=r}static parse(e,t,r){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');for(var i,a=[],s=1;s<e.length-1;s+=2){var n=ve(e[s],t),o=ve(e[s+1],t,r);i||(i=o.type),a.push({condition:n,output:o})}var l=ve(e[e.length-1],t,r);return i||(i=l.type),new H(i,a,l)}evaluate(e,t){for(var r of this.args)if(r.condition.evaluate(e,t))return r.output.evaluate(e,t);return this.fallback.evaluate(e,t)}}class J{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');for(var r,i=[],a=1;a<e.length;a++){var s=ve(e[a],t);r||(r=s.type),i.push(s)}return new J(r,i)}evaluate(e,t){for(var r of this.args){var i=r.evaluate(e,t);if(null!==i)return i}return null}}class Q{constructor(e,t,r,i,a){this.type=e,this.input=t,this.labels=r,this.outputs=i,this.fallback=a}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');for(var r,i,a=ve(e[1],t),s=[],n={},o=2;o<e.length-1;o+=2){var l=e[o];for(var h of(Array.isArray(l)||(l=[l]),l)){var u=typeof h;if("string"!==u&&"number"!==u)throw new Error('"match" requires string or number literal as labels');if(i){if(u!==i)throw new Error('"match" requires labels to have the same type')}else i=u;n[h]=s.length}var c=ve(e[o+1],t);r||(r=c.type),s.push(c)}return new Q(r,a,n,s,ve(e[e.length-1],t))}evaluate(e,t){var r=this.input.evaluate(e,t);return(this.outputs[this.labels[r]]||this.fallback).evaluate(e,t)}}class G{constructor(e,t,r,i,a){this.operator=e,this.type=t,this.interpolation=r,this.input=i,this.stops=a}static parse(e,t,r){var i=e[0];if(e.length<5)throw new Error('"'.concat(i,'" expects at least 4 arguments'));var a=e[1];if(!Array.isArray(a)||0===a.length)throw new Error('"'.concat(a,'" is not a valid interpolation'));switch(a[0]){case"linear":if(1!==a.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==a.length||"number"!=typeof a[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==a.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var s=1;s<5;s++){var n=a[s];if("number"!=typeof n||n<0||n>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error('"'.concat(e[0],'" unknown interpolation type "').concat(a[0],'"'))}if(e.length%2!=1)throw new Error('"'.concat(i,'" expects an even number of arguments'));var o,l=ve(e[2],t,b);"interpolate-hcl"===i||"interpolate-lab"===i?o=x:r&&"value"!==r.kind&&(o=r);for(var h=[],u=3;u<e.length;u+=2){var c=e[u];if("number"!=typeof c)throw new Error('"'.concat(i,'" requires stop inputs as literal numbers'));if(h.length&&h[h.length-1][0]>=c)throw new Error('"'.concat(i,'" requires strictly ascending stop inputs'));var d=ve(e[u+1],t,o);o||(o=d.type),h.push([c,d])}if(o&&o!==x&&o!==b&&("array"!==o.kind||o.itemType!==b))throw new Error('"'.concat(i,'" cannot interpolate type ').concat(D(o)));return new G(i,o,a,l,h)}evaluate(e,t){var r=this.stops;if(1===r.length)return r[0][1].evaluate(e,t);var a=this.input.evaluate(e,t);if(a<=r[0][0])return r[0][1].evaluate(e,t);if(a>=r[r.length-1][0])return r[r.length-1][1].evaluate(e,t);for(var s=0;++s<r.length&&!(a<r[s][0]););var n=r[s-1][0],o=r[s][0],l=G.interpolationRatio(this.interpolation,a,n,o),h=r[s-1][1].evaluate(e,t),u=r[s][1].evaluate(e,t);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(h)&&Array.isArray(u))return h.map(((e,t)=>Object(C.e)(e,u[t],l)));if("color"===this.type.kind&&h instanceof g.a&&u instanceof g.a){var c=new g.a(h),d=new g.a(u);return new g.a([Object(C.e)(c.r,d.r,l),Object(C.e)(c.g,d.g,l),Object(C.e)(c.b,d.b,l),Object(C.e)(c.a,d.a,l)])}if("number"===this.type.kind&&"number"==typeof h&&"number"==typeof u)return Object(C.e)(h,u,l);throw new Error('"'.concat(this.operator,'" cannot interpolate type ').concat(D(this.type)))}if("interpolate-hcl"===this.operator){var p=Object(k.d)(h),y=Object(k.d)(u),f=y.h-p.h,v=Object(k.e)({h:p.h+l*(f>180||f<-180?f-360*Math.round(f/360):f),c:Object(C.e)(p.c,y.c,l),l:Object(C.e)(p.l,y.l,l)});return new g.a(Object(i.a)({a:Object(C.e)(h.a,u.a,l)},v))}if("interpolate-lab"===this.operator){var m=Object(k.c)(h),b=Object(k.c)(u),_=Object(k.e)({l:Object(C.e)(m.l,b.l,l),a:Object(C.e)(m.a,b.a,l),b:Object(C.e)(m.b,b.b,l)});return new g.a(Object(i.a)({a:Object(C.e)(h.a,u.a,l)},_))}throw new Error('Unexpected operator "'.concat(this.operator,'"'))}interpolationUniformValue(e,t){var r=this.stops;if(1===r.length)return 0;if(e>=r[r.length-1][0])return 0;for(var i=0;++i<r.length&&!(e<r[i][0]););var a=r[i-1][0],s=r[i][0];return G.interpolationRatio(this.interpolation,t,a,s)}getInterpolationRange(e){var t=this.stops;if(1===t.length){var r=t[0][0];return[r,r]}var i=t[t.length-1][0];if(e>=i)return[i,i];for(var a=0;++a<t.length&&!(e<t[a][0]););return[t[a-1][0],t[a][0]]}static interpolationRatio(e,t,r,i){var a=0;return"linear"===e[0]?a=G.exponentialInterpolationRatio(t,1,r,i):"exponential"===e[0]?a=G.exponentialInterpolationRatio(t,e[1],r,i):"cubic-bezier"===e[0]&&(a=Object(R.c)(e[1],e[2],e[3],e[4])(G.exponentialInterpolationRatio(t,1,r,i),1e-5)),a<0?a=0:a>1&&(a=1),a}static exponentialInterpolationRatio(e,t,r,i){var a=i-r;if(0===a)return 0;var s=e-r;return 1===t?s/a:(Math.pow(t,s)-1)/(Math.pow(t,a)-1)}}class W{constructor(e,t,r){this.type=e,this.input=t,this.stops=r}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');var r,i=ve(e[1],t,b),a=[];a.push([-1/0,ve(e[2],t)]);for(var s=3;s<e.length;s+=2){var n=e[s];if("number"!=typeof n)throw new Error('"step" requires stop inputs as literal numbers');if(a.length&&a[a.length-1][0]>=n)throw new Error('"step" requires strictly ascending stop inputs');var o=ve(e[s+1],t);r||(r=o.type),a.push([n,o])}return new W(r,i,a)}evaluate(e,t){var r=this.stops;if(1===r.length)return r[0][1].evaluate(e,t);for(var i=this.input.evaluate(e,t),a=0;++a<r.length&&!(i<r[a][0]););return this.stops[a-1][1].evaluate(e,t)}}class Y{constructor(e,t){this.type=e,this.output=t}static parse(e,t,r){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');for(var i=new A(t),a=1;a<e.length-1;a+=2){var s=e[a];if("string"!=typeof s)throw new Error('"let" requires a string to define variable names - found '.concat(s));i.add(s,ve(e[a+1],t))}var n=ve(e[e.length-1],i,r);return new Y(n.type,n)}evaluate(e,t){return this.output.evaluate(e,t)}}class K{constructor(e,t){this.type=e,this.output=t}static parse(e,t,r){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');var i=t.get(e[1]);if(!i)throw new Error("".concat(e[1],' must be defined before being used in a "var" expression'));return new K(r||T,i)}evaluate(e,t){return this.output.evaluate(e,t)}}class Z{constructor(e,t,r){this.type=e,this.index=t,this.array=r}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');var r=ve(e[1],t,b),i=ve(e[2],t);return new Z(i.type.itemType,r,i)}evaluate(e,t){var r=this.index.evaluate(e,t),i=this.array.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"at" index out of bounds');if(r!==Math.floor(r))throw new Error('"at" index must be an integer');return i[r]}}class ${constructor(e,t){this.key=e,this.obj=t,this.type=T}static parse(e,t){var r,i;switch(e.length){case 2:return r=ve(e[1],t),new $(r);case 3:return r=ve(e[1],t),i=ve(e[2],t),new $(r,i);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){var r=this.key.evaluate(e,t);return this.obj?this.obj.evaluate(e,t)[r]:e.values[r]}}class X{constructor(e,t){this.key=e,this.obj=t,this.type=w}static parse(e,t){var r,i;switch(e.length){case 2:return r=ve(e[1],t),new X(r);case 3:return r=ve(e[1],t),i=ve(e[2],t),new X(r,i);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){var r=this.key.evaluate(e,t);return this.obj?r in this.obj.evaluate(e,t):void 0!==e.values[r]}}class ee{constructor(e,t){this.key=e,this.vals=t,this.type=w}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new ee(ve(e[1],t),ve(e[2],t))}evaluate(e,t){var r=this.key.evaluate(e,t);return-1!==this.vals.evaluate(e,t).indexOf(r)}}class te{constructor(e,t,r){this.item=e,this.array=t,this.from=r,this.type=b}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');var r=ve(e[1],t),i=ve(e[2],t);if(4===e.length){var a=ve(e[3],t,b);return new te(r,i,a)}return new te(r,i)}evaluate(e,t){var r=this.item.evaluate(e,t),i=this.array.evaluate(e,t);if(this.from){var a=this.from.evaluate(e,t);if(a!==Math.floor(a))throw new Error('"index-of" index must be an integer');return i.indexOf(r,a)}return i.indexOf(r)}}class re{constructor(e){this.arg=e,this.type=b}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');var r=ve(e[1],t);return new re(r)}evaluate(e,t){var r=this.arg.evaluate(e,t);if("string"==typeof r)return r.length;if(Array.isArray(r))return r.length;throw new Error('"length" expects string or array')}}class ie{constructor(e,t,r,i){this.type=e,this.array=t,this.from=r,this.to=i}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');var r=ve(e[1],t),i=ve(e[2],t,b);if(i.type!==b)throw new Error('"slice" index must return a number');if(4===e.length){var a=ve(e[3],t,b);if(a.type!==b)throw new Error('"slice" index must return a number');return new ie(r.type,r,i,a)}return new ie(r.type,r,i)}evaluate(e,t){var r=this.array.evaluate(e,t);if(!Array.isArray(r)&&"string"!=typeof r)throw new Error('"slice" input must be an array or a string');var i=this.from.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"slice" index out of bounds');if(i!==Math.floor(i))throw new Error('"slice" index must be an integer');if(this.to){var a=this.to.evaluate(e,t);if(a<0||a>=r.length)throw new Error('"slice" index out of bounds');if(a!==Math.floor(a))throw new Error('"slice" index must be an integer');return r.slice(i,a)}return r.slice(i)}}class ae{constructor(){this.type=w}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new ae}evaluate(e,t){return void 0!==e.id}}class se{constructor(e,t){this.args=e,this.calculate=t,this.type=b}static parse(e,t,r){var i=e.slice(1).map((e=>ve(e,t)));return new se(i,r)}evaluate(e,t){var r;return this.args&&(r=this.args.map((r=>r.evaluate(e,t)))),this.calculate(r)}}class ne{constructor(e,t){this.args=e,this.calculate=t,this.type=b}static parse(e,t){var r=e.slice(1).map((e=>ve(e,t)));return new ne(r,ne.ops[e[0]])}evaluate(e,t){var r;return this.args&&(r=this.args.map((r=>r.evaluate(e,t)))),this.calculate(r)}}ne.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])};class oe{constructor(e){this.args=e,this.type=_}static parse(e,t){return new oe(e.slice(1).map((e=>ve(e,t))))}evaluate(e,t){return this.args.map((r=>r.evaluate(e,t))).join("")}}class le{constructor(e,t){this.arg=e,this.calculate=t,this.type=_}static parse(e,t){if(2!==e.length)throw new Error("".concat(e[0]," expects 1 argument"));var r=ve(e[1],t);return new le(r,le.ops[e[0]])}evaluate(e,t){return this.calculate(this.arg.evaluate(e,t))}}le.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()};class he{constructor(e){this.args=e,this.type=x}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');var r=e.slice(1).map((e=>ve(e,t)));return new he(r)}evaluate(e,t){var r=this._validate(this.args[0].evaluate(e,t)),i=this._validate(this.args[1].evaluate(e,t)),a=this._validate(this.args[2].evaluate(e,t));return new g.a({r:r,g:i,b:a})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error("".concat(e,": invalid color component"));return Math.round(e)}}class ue{constructor(e){this.args=e,this.type=x}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');var r=e.slice(1).map((e=>ve(e,t)));return new ue(r)}evaluate(e,t){var r=this._validate(this.args[0].evaluate(e,t)),i=this._validate(this.args[1].evaluate(e,t)),a=this._validate(this.args[2].evaluate(e,t)),s=this._validateAlpha(this.args[3].evaluate(e,t));return new g.a({r:r,g:i,b:a,a:s})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error("".concat(e,": invalid color component"));return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error("".concat(e,": invalid alpha color component"));return e}}class ce{constructor(e){this.color=e,this.type=I(b,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');var r=ve(e[1],t);return new ce(r)}evaluate(e,t){return new g.a(this.color.evaluate(e,t)).toRgba()}}class de{constructor(e,t){this.type=e,this.args=t}static parse(e,t){var r=e[0];if(e.length<2)throw new Error("".concat(r," expects at least one argument"));var i,a=1;if("array"===r){if(e.length>2){switch(e[1]){case"string":i=_;break;case"number":i=b;break;case"boolean":i=w;break;default:throw new Error('"array" type argument must be string, number or boolean')}a++}else i=T;var s;if(e.length>3){if(null!==(s=e[2])&&("number"!=typeof s||s<0||s!==Math.floor(s)))throw new Error('"array" length argument must be a positive integer literal');a++}i=I(i,s)}else switch(r){case"string":i=_;break;case"number":i=b;break;case"boolean":i=w;break;case"object":i=O}for(var n=[];a<e.length;a++){var o=ve(e[a],t);n.push(o)}return new de(i,n)}evaluate(e,t){var r;for(var i of this.args){var a=i.evaluate(e,t);if(L(r=P(a),this.type))return a}throw new Error("Expected ".concat(D(this.type)," but got ").concat(D(r)))}}class pe{constructor(e,t){this.type=e,this.args=t}static parse(e,t){var r=e[0],i=pe.types[r];if(i===w||i===_){if(2!==e.length)throw new Error("".concat(r," expects one argument"))}else if(e.length<2)throw new Error("".concat(r," expects at least one argument"));for(var a=[],s=1;s<e.length;s++){var n=ve(e[s],t);a.push(n)}return new pe(i,a)}evaluate(e,t){if(this.type===w)return Boolean(this.args[0].evaluate(e,t));if(this.type===_)return j(this.args[0].evaluate(e,t));if(this.type===b){for(var r of this.args){var i=Number(r.evaluate(e,t));if(!isNaN(i))return i}return null}if(this.type===x){for(var a of this.args)try{var s=pe.toColor(a.evaluate(e,t));if(s instanceof g.a)return s}catch(n){}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return j(e)}static toNumber(e){var t=Number(e);if(isNaN(t))throw new Error('"'.concat(e,'" is not a number'));return t}static toColor(e){if(e instanceof g.a)return e;if("string"==typeof e){var t=g.a.fromString(e);if(t)return t;throw new Error('"'.concat(e,'" is not a color'))}if(Array.isArray(e))return g.a.fromArray(e);throw new Error('"'.concat(e,'" is not a color'))}}pe.types={"to-boolean":w,"to-color":x,"to-number":b,"to-string":_};class ye{constructor(e){this.val=e,this.type=P(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new ye(e[1])}evaluate(e,t){return this.val}}class fe{constructor(e){this.arg=e,this.type=_}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new fe(ve(e[1],t))}evaluate(e,t){return D(P(this.arg.evaluate(e,t)))}}function ve(e,t,r){var i=typeof e;if("string"===i||"boolean"===i||"number"===i||null===e){if(r)switch(r.kind){case"string":"string"!==i&&(e=pe.toString(e));break;case"number":"number"!==i&&(e=pe.toNumber(e));break;case"color":e=pe.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");var a=e[0];if("string"!=typeof a)throw new Error("First element of expression must be a string");var s=ge[a];if(void 0===s)throw new Error('Invalid expression operator "'.concat(a,'"'));if(!s)throw new Error('Unimplemented expression operator "'.concat(a,'"'));return s.parse(e,t,r)}var ge={array:de,boolean:de,collator:null,format:null,image:null,literal:ye,number:de,"number-format":null,object:de,string:de,"to-boolean":pe,"to-color":pe,"to-number":pe,"to-string":pe,typeof:fe,accumulated:null,"feature-state":null,"geometry-type":E,id:M,"line-progress":null,properties:U,at:Z,get:$,has:X,in:ee,"index-of":te,length:re,slice:ie,"!":V,"!=":class extends z{static parse(e,t){return z.parse(e,t,((e,t)=>e!==t))}},"<":class extends z{static parse(e,t){return z.parse(e,t,((e,t)=>e<t))}},"<=":class extends z{static parse(e,t){return z.parse(e,t,((e,t)=>e<=t))}},"==":class extends z{static parse(e,t){return z.parse(e,t,((e,t)=>e===t))}},">":class extends z{static parse(e,t){return z.parse(e,t,((e,t)=>e>t))}},">=":class extends z{static parse(e,t){return z.parse(e,t,((e,t)=>e>=t))}},all:F,any:q,case:H,coalesce:J,match:Q,within:null,interpolate:G,"interpolate-hcl":G,"interpolate-lab":G,step:W,let:Y,var:K,concat:oe,downcase:le,"is-supported-script":null,"resolved-locale":null,upcase:le,rgb:he,rgba:ue,"to-rgba":ce,"-":class extends se{static parse(e,t){switch(e.length){case 2:return se.parse(e,t,(e=>-e[0]));case 3:return se.parse(e,t,(e=>e[0]-e[1]));default:throw new Error('"-" expects 1 or 2 arguments')}}},"*":class extends se{static parse(e,t){return se.parse(e,t,(e=>{var t=1;for(var r of e)t*=r;return t}))}},"/":class extends se{static parse(e,t){if(3===e.length)return se.parse(e,t,(e=>e[0]/e[1]));throw new Error('"/" expects 2 arguments')}},"%":class extends se{static parse(e,t){if(3===e.length)return se.parse(e,t,(e=>e[0]%e[1]));throw new Error('"%" expects 2 arguments')}},"^":class extends se{static parse(e,t){if(3===e.length)return se.parse(e,t,(e=>Math.pow(e[0],e[1])));throw new Error('"^" expects 1 or 2 arguments')}},"+":class extends se{static parse(e,t){return se.parse(e,t,(e=>{var t=0;for(var r of e)t+=r;return t}))}},abs:ne,acos:ne,asin:ne,atan:ne,ceil:ne,cos:ne,e:ne,floor:ne,ln:ne,ln2:ne,log10:ne,log2:ne,max:ne,min:ne,pi:ne,round:ne,sin:ne,sqrt:ne,tan:ne,zoom:B,"heatmap-density":null,"has-id":ae,none:N};class me{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(r){return console.log(r.message),!0}}static createFilter(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{var t=ve(e,null,w);return new me(t)}catch(t){return console.log(t.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":return!0;case"any":case"all":for(var t=1;t<e.length;t++)if(!this.isLegacyFilter(e[1]))return!1;return!0;case"none":return!0;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);case"!has":return!0;default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;var t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return me.convertComparison("==",e[1],e[2]);case"!=":return me.negate(me.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return me.convertComparison(t,e[1],e[2]);case"in":return me.convertIn(e[1],e.slice(2));case"!in":return me.negate(me.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return me.convertCombining(t,e.slice(1));case"has":return me.convertHas(e[1]);case"!has":return me.negate(me.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,r){switch(t){case"$type":return[e,["geometry-type"],r];case"$id":return[e,["id"],r];default:return[e,["get",t],r]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}var be=me;class _e{}_e.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},_e.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},_e.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},_e.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}},_e.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},_e.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},_e.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},_e.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}},_e.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},_e.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},_e.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};class we{constructor(e,t){var r;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":r=!0;break;case"array":r="number"===e.value;break;default:r=!1}if(null==t&&(t=e.default),Array.isArray(t)&&t.length>0&&ge[t[0]]){var i={number:b,color:x,string:_,boolean:w,enum:_};try{var a=ve(t,null,"array"===e.type?I(i[e.value]||T,e.length):i[e.type]);this.getValue=this._buildExpression(a,e),this.isDataDriven=!0,a instanceof G&&a.input instanceof B&&(this.interpolator=a)}catch(o){console.log(o.message),this.getValue=this._buildSimple(e.default)}}else{r&&"interval"===t.type&&(r=!1);var s=t&&t.stops&&t.stops.length>0;if(s)for(var n of t.stops)n[1]=this._validate(n[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),s)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=r?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else s?this.getValue=r?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}}_validate(e,t){if("number"===t.type){if(e<t.minimum)return t.minimum;if(e>t.maximum)return t.maximum}else"color"===t.type?e=we._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map((r=>"string"==typeof e?t.values.indexOf(r):r)):"string"===t.type&&(e=j(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(r,i)=>{try{var a=e.evaluate(i,r);return void 0===a?t.default:this._validate(a,t)}catch(s){return console.log(s.message),t.default}}}_buildIdentity(e,t){return(r,i)=>{var a;return i&&(a=i.values[e.property]),void 0!==a?this._validate(a,t):void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(r,i)=>{var a;return i&&(a=i.values[e.property]),void 0!==(a=this._categorical(a,e.stops))?a:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(r,i)=>{var a;return i&&(a=i.values[e.property]),"number"==typeof a?this._interval(a,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(r,i)=>{var a;return i&&(a=i.values[e.property]),"number"==typeof a?this._interpolate(a,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){for(var r=t.length,i=0;i<r;i++)if(t[i][0]===e)return t[i][1]}_interval(e,t){for(var r=t.length,i=0,a=0;a<r&&t[a][0]<=e;a++)i=a;return t[i][1]}_interpolate(e,t,r){for(var i,a,s=t.length,n=0;n<s;n++){var o=t[n];if(!(o[0]<=e)){a=o;break}i=o}if(i&&a){var l=a[0]-i[0],h=e-i[0],u=1===r?h/l:(Math.pow(r,h)-1)/(Math.pow(r,l)-1);if(Array.isArray(i[1])){for(var c=i[1],d=a[1],p=[],y=0;y<c.length;y++)p.push(Object(C.e)(c[y],d[y],u));return p}return Object(C.e)(i[1],a[1],u)}return i?i[1]:a?a[1]:void 0}static _isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:("string"==typeof e&&(e=new g.a(e)),e instanceof g.a?this._isEmpty(e)?void 0:g.a.toUnitRGBA(e):e)}}var xe=we,Oe=r(122);class Te{constructor(e,t,r,i){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=r,this.uid=i,e){case 0:this._layoutDefinition=_e.backgroundLayoutDefinition,this._paintDefinition=_e.backgroundPaintDefinition;break;case 1:this._layoutDefinition=_e.fillLayoutDefinition,this._paintDefinition=_e.fillPaintDefinition;break;case 2:this._layoutDefinition=_e.lineLayoutDefinition,this._paintDefinition=_e.linePaintDefinition;break;case 3:this._layoutDefinition=_e.symbolLayoutDefinition,this._paintDefinition=_e.symbolPaintDefinition;break;case 4:this._layoutDefinition=_e.circleLayoutDefinition,this._paintDefinition=_e.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=be.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,r){var i,a=this._layoutProperties[e];return a&&(i=a.getValue(t,r)),void 0===i&&(i=this._layoutDefinition[e].default),i}getPaintValue(e,t,r){var i,a=this._paintProperties[e];return a&&(i=a.getValue(t,r)),void 0===i&&(i=this._paintDefinition[e].default),i}isPainterDataDriven(){var e=this._paintProperties;if(e)for(var t in e)if(e[t].isDataDriven)return!0;return!1}_parseLayout(e){var t={};for(var r in e){var i=this._layoutDefinition[r];i&&(t[r]=new xe(i,e[r]))}return t}_parsePaint(e){var t={};for(var r in e){var i=this._paintDefinition[r];i&&(t[r]=new xe(i,e[r]))}return t}computeAttributesKey(e,t){var r=0,i=0;for(var a of t){var s="icon-size"===a||"text-size"===a?this.getLayoutProperty(a):this.getPaintProperty(a);i|=(null!=s&&s.interpolator?2:null!=s&&s.isDataDriven?1:0)<<r,r+=2}return i<<3|e}}class Ie extends Te{constructor(e,t,r,i){super(e,t,r,i),this.backgroundMaterial=new l(this.computeAttributesKey(0,l.ATTRIBUTES))}}class Se extends Te{constructor(e,t,r,i){super(e,t,r,i);var a=this.getPaintProperty("fill-color"),s=this.getPaintProperty("fill-opacity"),n=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=null==a?void 0:a.isDataDriven,this.hasDataDrivenOpacity=null==s?void 0:s.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||(null==n?void 0:n.isDataDriven);var o=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!o,this.hasDataDrivenOutlineColor=null==o?void 0:o.isDataDriven,this.hasDataDrivenOutline=o?o.isDataDriven:!!a&&a.isDataDriven,this.hasDataDrivenOutline=(o?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new u(this.computeAttributesKey(1,u.ATTRIBUTES)),this.outlineMaterial=new c(this.computeAttributesKey(2,this.outlineUsesFillColor?c.ATTRIBUTES_FILL:c.ATTRIBUTES_OUTLINE),this.outlineUsesFillColor)}}class De extends Te{constructor(e,t,r,i){var a,s,n,o,l,h,u;super(e,t,r,i),this.lineMaterial=new d(this.computeAttributesKey(3,d.ATTRIBUTES)),this.hasDataDrivenLine=(null==(a=this.getPaintProperty("line-blur"))?void 0:a.isDataDriven)||(null==(s=this.getPaintProperty("line-color"))?void 0:s.isDataDriven)||(null==(n=this.getPaintProperty("line-gap-width"))?void 0:n.isDataDriven)||(null==(o=this.getPaintProperty("line-offset"))?void 0:o.isDataDriven)||(null==(l=this.getPaintProperty("line-opacity"))?void 0:l.isDataDriven)||(null==(h=this.getPaintProperty("line-pattern"))?void 0:h.isDataDriven)||(null==(u=this.getPaintProperty("line-width"))?void 0:u.isDataDriven);var c=t.paint["line-width"];c||(c=_e.linePaintDefinition["line-width"].default);var p=this.getPaintProperty("line-width");this.isThinLine=!(null!=p&&p.isDataDriven)&&"number"==typeof c&&c<Oe.D}}class Pe extends Te{constructor(e,t,r,i){var a,s,n,o,l,h,u,c,d,p,y,g;super(e,t,r,i),this.iconMaterial=new f(this.computeAttributesKey(4,f.ATTRIBUTES)),this.textMaterial=new v(this.computeAttributesKey(6,v.ATTRIBUTES)),this.hasDataDrivenIcon=(null==(a=this.getPaintProperty("icon-color"))?void 0:a.isDataDriven)||(null==(s=this.getPaintProperty("icon-halo-blur"))?void 0:s.isDataDriven)||(null==(n=this.getPaintProperty("icon-halo-color"))?void 0:n.isDataDriven)||(null==(o=this.getPaintProperty("icon-halo-width"))?void 0:o.isDataDriven)||(null==(l=this.getPaintProperty("icon-opacity"))?void 0:l.isDataDriven)||(null==(h=this.getLayoutProperty("icon-size"))?void 0:h.isDataDriven),this.hasDataDrivenText=(null==(u=this.getPaintProperty("text-color"))?void 0:u.isDataDriven)||(null==(c=this.getPaintProperty("text-halo-blur"))?void 0:c.isDataDriven)||(null==(d=this.getPaintProperty("text-halo-color"))?void 0:d.isDataDriven)||(null==(p=this.getPaintProperty("text-halo-width"))?void 0:p.isDataDriven)||(null==(y=this.getPaintProperty("text-opacity"))?void 0:y.isDataDriven)||(null==(g=this.getLayoutProperty("text-size"))?void 0:g.isDataDriven)}}class Le extends Te{constructor(e,t,r,i){super(e,t,r,i),this.circleMaterial=new h(this.computeAttributesKey(5,h.ATTRIBUTES))}}class je{constructor(e,t,r){var i,a,s,n,o,l;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),null!=(i=l=e.getLayoutProperty("icon-anchor"))&&i.isDataDriven?this._anchorProp=l:this.anchor=e.getLayoutValue("icon-anchor",t),null!=(a=l=e.getLayoutProperty("icon-offset"))&&a.isDataDriven?this._offsetProp=l:this.offset=e.getLayoutValue("icon-offset",t),null!=(s=l=e.getLayoutProperty("icon-padding"))&&s.isDataDriven?this._paddingProp=l:this.padding=e.getLayoutValue("icon-padding",t),null!=(n=l=e.getLayoutProperty("icon-rotate"))&&n.isDataDriven?this._rotateProp=l:this.rotate=e.getLayoutValue("icon-rotate",t),null!=(o=l=e.getLayoutProperty("icon-size"))&&o.isDataDriven?this._sizeProp=l:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}}class ke{constructor(e,t,r){var i,a,s,n,o,l,h,u,c,d,p,y;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),null!=(i=y=e.getLayoutProperty("text-anchor"))&&i.isDataDriven?this._anchorProp=y:this.anchor=e.getLayoutValue("text-anchor",t),null!=(a=y=e.getLayoutProperty("text-justify"))&&a.isDataDriven?this._justifyProp=y:this.justify=e.getLayoutValue("text-justify",t),null!=(s=y=e.getLayoutProperty("text-letter-spacing"))&&s.isDataDriven?this._letterSpacingProp=y:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),null!=(n=y=e.getLayoutProperty("text-line-height"))&&n.isDataDriven?this._lineHeightProp=y:this.lineHeight=e.getLayoutValue("text-line-height",t),null!=(o=y=e.getLayoutProperty("text-max-angle"))&&o.isDataDriven?this._maxAngleProp=y:this.maxAngle=e.getLayoutValue("text-max-angle",t),null!=(l=y=e.getLayoutProperty("text-max-width"))&&l.isDataDriven?this._maxWidthProp=y:this.maxWidth=e.getLayoutValue("text-max-width",t),null!=(h=y=e.getLayoutProperty("text-offset"))&&h.isDataDriven?this._offsetProp=y:this.offset=e.getLayoutValue("text-offset",t),null!=(u=y=e.getLayoutProperty("text-padding"))&&u.isDataDriven?this._paddingProp=y:this.padding=e.getLayoutValue("text-padding",t),null!=(c=y=e.getLayoutProperty("text-rotate"))&&c.isDataDriven?this._rotateProp=y:this.rotate=e.getLayoutValue("text-rotate",t),null!=(d=y=e.getLayoutProperty("text-size"))&&d.isDataDriven?this._sizeProp=y:this.size=e.getLayoutValue("text-size",t),null!=(p=y=e.getLayoutProperty("text-writing-mode"))&&p.isDataDriven?this._writingModeProp=y:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}}},822:function(e,t,r){"use strict";var i=r(94),a=r(592),s=r(245);t.a=class{constructor(e){if(e instanceof a.a)this._tilemapCache=e;else{if(!e||!("index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}dataKey(e,t){if(this._tilemapCache){var{level:r,row:a,col:n}=e,o=new s.a(e);return this._tilemapCache.fetchAvailabilityUpsample(r,a,n,o,t).then((()=>(o.world=e.world,o))).catch((e=>{if(Object(i.m)(e))throw e;return null}))}return this._getIndexedDataKey(e)}forEach(e,t,r,i,a){this._callback=a,this._maxLevel=t+e,this._forEach(this._tilemap,t,r,i)}_forEach(e,t,r,i){0!==e&&(this._callback(t,r,i),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*r,2*i),this._forEach(e[1],t+1,2*r,2*i+1),this._forEach(e[2],t+1,2*r+1,2*i),this._forEach(e[3],t+1,2*r+1,2*i+1)))}_getIndexedDataKey(e){var t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Promise.resolve(null);for(var r=e;0!==r.level;)r=new s.a(r.level-1,r.row>>1,r.col>>1,r.world),t.push(r);var i,a,n=this._tilemap,o=t.pop();if(1===n)return Promise.resolve(o);for(;t.length;)if(a=(1&(i=t.pop()).col)+((1&i.row)<<1),n){if(0===n[a]){o=null;break}if(1===n[a]){o=i;break}o=i,n=n[a]}return Promise.resolve(o)}}},896:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return a}));class i{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}}class a{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}}}]);
//# sourceMappingURL=109.f53fd2e3.chunk.js.map