"use strict";(globalThis.webpackChunkimaps=globalThis.webpackChunkimaps||[]).push([[8820],{68820:(t,e,o)=>{o.r(e),o.d(e,{Bookmarks:()=>Q,default:()=>tt});var i=o(72791),s=o(85580),a=o(9283);const r={title:"Bookmarks Tips",tips:[{title:"Saving Bookmarks",text:"Bookmarks are automatically saved to your local storage in your browser.  Next time you open iMAPS in the same browser you will see the bookmarks from your last session."}]};var n=o(27366),d=o(98928),l=o(100),u=o(92026),k=o(94172),m=o(49861),c=o(89125),h=(o(63780),o(69912)),b=o(76969),p=o(26838),_=o(69407),g=o(85015);o(25243);let B=class extends g.Z{constructor(t){super(t)}get editedBookmark(){const{bookmark:t}=this;return t?this._get("editedBookmark")||t.clone():null}get state(){return this._get("state")}set state(t){this.validationState=void 0,this.loading=void 0,this._set("state",t)}};(0,n._)([(0,m.Cb)()],B.prototype,"bookmark",void 0),(0,n._)([(0,m.Cb)({readOnly:!0})],B.prototype,"editedBookmark",null),(0,n._)([(0,m.Cb)()],B.prototype,"state",null),(0,n._)([(0,m.Cb)()],B.prototype,"validationState",void 0),(0,n._)([(0,m.Cb)()],B.prototype,"loading",void 0),B=(0,n._)([(0,h.j)("esri.widgets.Bookmarks.UserState")],B);const v=B;var f=o(13894),w=o(40281),E=o(10064),I=o(91505),C=o(2284),y=o(99505);const S=w.Z.ofType(C.Z),x={width:128,height:128,format:"png"},T={takeScreenshot:!0,captureViewpoint:!0,captureRotation:!0,captureScale:!0,captureTimeExtent:!0},A={time:!0};let $=class extends((0,y._)(I.Z.EventedAccessor)){constructor(t){super(t),this.abilities={...A},this.activeBookmark=null,this.view=null}destroy(){this.view=null,this._set("activeBookmark",null)}castAbilities(t){return{...A,...t}}get bookmarks(){return this.view?.map?.bookmarks??new S}set bookmarks(t){this._overrideIfSome("bookmarks",t)}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...T,...t})}get defaultCreateOptions(){return T}set defaultEditOptions(t){this._set("defaultEditOptions",{...T,...t})}get defaultEditOptions(){return T}get state(){const t=this.get("view");return t&&!t.ready?"loading":"ready"}async createBookmark(t){const{view:e,defaultCreateOptions:o,abilities:i}=this;if(!e)throw new E.Z("create-bookmark:invalid-view","Cannot create a bookmark without a view.");const{takeScreenshot:s,screenshotSettings:a,captureViewpoint:r,captureRotation:n,captureScale:d,captureTimeExtent:l}={...o,...t},k=s?await this._createThumbnail(a):void 0,m=i.time&&l&&(0,u.pC)(e.timeExtent)?e.timeExtent.clone():void 0;return new C.Z({...k&&{thumbnail:k},...l&&{timeExtent:m},...r&&{viewpoint:this._createViewpoint({view:e,captureScale:d,captureRotation:n})}})}async editBookmark(t,e){const{view:o,defaultEditOptions:i}=this;if(!o)throw new E.Z("edit-bookmark:invalid-view","Cannot edit a bookmark without a view.");const{takeScreenshot:s,screenshotSettings:a,captureViewpoint:r,captureRotation:n,captureScale:d,captureTimeExtent:l}={...i,...e},k=s?await this._createThumbnail(a):void 0;return k&&(t.thumbnail=k),r&&(t.viewpoint=this._createViewpoint({view:o,captureScale:d,captureRotation:n})),l&&(0,u.pC)(o.timeExtent)&&(t.timeExtent=o.timeExtent.clone()),this.emit("bookmark-edit",{bookmark:t}),t}goTo(t){const{abilities:e,view:o}=this;if(!o)throw new E.Z("go-to:invalid-view","Cannot go to a bookmark without a view");const i=t?.viewpoint;if(!i)throw new E.Z("go-to:invalid-bookmark","Cannot go to a bookmark that does not contain a 'viewpoint'.",{bookmark:t});this._set("activeBookmark",t);const s={target:i},a=this.callGoTo(s),r=t?.timeExtent;return e.time&&r&&(o.timeExtent=r),this.emit("bookmark-select",{bookmark:t}),a.catch((()=>{})).then((()=>this._set("activeBookmark",null))),a}async _createThumbnail(t){const e=await this.view.takeScreenshot({...x,...t});return new p.A({url:e.dataUrl})}_createViewpoint(t){let{view:e,captureRotation:o,captureScale:i}=t;const s=e.viewpoint?.clone();return new f.Z({targetGeometry:e.extent?.clone(),rotation:o&&s?.rotation||0,scale:i&&s?.scale||0})}};(0,n._)([(0,m.Cb)()],$.prototype,"abilities",void 0),(0,n._)([(0,c.p)("abilities")],$.prototype,"castAbilities",null),(0,n._)([(0,m.Cb)({readOnly:!0})],$.prototype,"activeBookmark",void 0),(0,n._)([(0,m.Cb)({type:S})],$.prototype,"bookmarks",null),(0,n._)([(0,m.Cb)()],$.prototype,"defaultCreateOptions",null),(0,n._)([(0,m.Cb)()],$.prototype,"defaultEditOptions",null),(0,n._)([(0,m.Cb)({readOnly:!0})],$.prototype,"state",null),(0,n._)([(0,m.Cb)()],$.prototype,"view",void 0),$=(0,n._)([(0,h.j)("esri.widgets.Bookmarks.BookmarksViewModel")],$);const U=$,M="esri-bookmarks",N=`${M}__authoring`,O=`${M}__bookmark`,D=`${M}__time-extent`,H={base:`${M} esri-widget--panel`,loaderContainer:`${M}__loader-container`,loader:`${M}__loader`,fadeIn:`${M}--fade-in`,bookmarkList:`${M}__list`,bookmarkListSortable:`${M}__list--sortable`,bookmark:O,bookmarkButton:`${O}-button`,bookmarkImageContainer:`${O}-image-container`,bookmarkImageContainerHasImage:`${O}-image-container--has-image`,bookmarkEditButtonContainer:`${O}-edit-button-container`,bookmarkEditButton:`${O}-edit-button`,bookmarkDragHandle:`${M}_bookmark-drag-handle`,bookmarkDragHandleIcon:`${M}_bookmark-drag-handle-icon`,bookmarkIcon:`${O}-icon`,bookmarkImage:`${M}__image`,bookmarkLabel:`${O}-label`,bookmarkName:`${O}-name`,bookmarkTimeExtent:`${O}-time-extent`,bookmarkActive:`${O}--active`,noBookmarksContainer:"esri-widget__content--empty",noBookmarksHeader:`${M}__no-bookmarks-heading`,noBookmarksIcon:"esri-widget__no-bookmark-icon",noBookmarksDescription:`${M}__no-bookmarks-description`,addingBookmark:`${M}__adding-bookmark`,addBookmark:`${M}__add-bookmark`,addBookmarkButton:`${M}__add-bookmark-button`,addBookmarkIcon:`${M}__add-bookmark-icon`,authoringCard:`${N}-card`,authoringContainer:`${N}-container`,authoringForm:`${N}-form`,authoringLabel:`${N}-label`,authoringActions:`${N}-actions`,authoringInputInvalid:`${N}-input--invalid`,authoringDeleteButton:`${N}-delete-button`,authoringCancelButton:`${N}-cancel-button`,timeExtentContainer:`${D}-container`,timeExtent:D,timeExtentGroup:`${D}-group`,timeExtentDate:`${D}-date`,timeExtentTime:`${D}-time`,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",esriButton:"esri-button",esriButtonTertiary:"esri-button--tertiary",esriInput:"esri-input",iconHandle:"esri-icon-handle-vertical",iconPlus:"esri-icon-plus",iconEdit:"esri-icon-edit",iconHandleHorizontal:"esri-icon-handle-horizontal",iconRefresh:"esri-icon-refresh",iconLink:"esri-icon-link",iconRemove:"esri-icon-erase",widgetIcon:"esri-icon-bookmark",header:"esri-widget__heading",loading:"esri-icon-loading-indicator",rotating:"esri-rotating"};var R=o(70098),L=o(61524),Z=o(96919),F=o(80975),P=o(80532),V=o(28907),j=o(67005),q=o(70281);const G="data-bookmark-uid",z={addBookmark:!0,thumbnail:!0,time:!0},W=/^https:\/\/.*/i;let K=class extends _.Z{constructor(t,e){super(t,e),this._handles=new l.Z,this._addInputNode=null,this._editInputNode=null,this._urlEditInputNode=null,this._addBookmarkButtonNode=null,this._focusAddBookmarkButton=!1,this._focusEditInputBox=!1,this._focusAddInputBox=!1,this._focusUrlEditInputBox=!1,this._sortable=null,this._sortableNode=null,this._focusSortUid=null,this._selectedSortUid=null,this._sortableSavedItems=null,this._editIncludeTimeExtent=null,this._userState=null,this.disabled=!1,this.editingEnabled=!1,this.headingLevel=2,this.iconClass=H.widgetIcon,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this.viewModel=new U,this.visibleElements={...z}}initialize(){this.addHandles([(0,k.YP)((()=>this.viewModel?.bookmarks),(()=>this._bookmarksInitialized()),k.nn),(0,k.YP)((()=>this.editingEnabled),(()=>this._toggleSorting()),k.nn)])}destroy(){this._destroySortable(),this._handles.destroy(),this._handles=null,this._editMenu.destroy()}loadDependencies(){return Promise.all([Promise.resolve().then(o.bind(o,67777)),Promise.resolve().then(o.bind(o,39754))])}get _editMenuItems(){const{messages:t,_userState:e}=this,o=e?.editedBookmark?.thumbnail?.url;return[new L.Z({label:t?.menu.refreshThumbnail,iconClass:H.iconRefresh,clickFunction:()=>this._refreshThumbnail()}),new L.Z({label:W.test(o)?t?.menu.editImageUrl:t?.menu.useImageUrl,iconClass:H.iconLink,clickFunction:()=>this._startUseImageUrl()}),o?new L.Z({label:t?.menu.removeThumbnail,iconClass:H.iconRemove,clickFunction:()=>this._removeThumbnail()}):null].filter(Boolean)}get _editMenu(){const{_editMenuItems:t,messages:e,disabled:o}=this,i=this._get("_editMenu");i&&i.destroy();const s=new R.Z({disabled:o,iconClass:H.iconHandleHorizontal,label:e?.menu.label});return s.items=t,s}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(t){this.viewModel.defaultCreateOptions=t}get defaultEditOptions(){return this.viewModel.defaultEditOptions}set defaultEditOptions(t){this.viewModel.defaultEditOptions=t}get bookmarks(){return this.viewModel.bookmarks}set bookmarks(t){this.viewModel.bookmarks=t}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(t){this.viewModel.goToOverride=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}castVisibleElements(t){return{...z,...t}}endAddBookmark(){this._userState=null}goTo(t){return this.viewModel.goTo(t)}render(){const{state:t}=this.viewModel,e="loading"===t?this.renderLoading():this.renderBookmarks();return(0,j.u)("div",{class:this.classes(H.base,H.esriWidget,{[H.esriWidgetDisabled]:this.disabled})},e)}startAddBookmark(){this._userState=new v({state:"add"}),this._focusAddInputBox=!0,this.scheduleRender()}renderLoading(){return(0,j.u)("div",{class:H.loaderContainer,key:"loader",tabIndex:this.disabled?-1:null},(0,j.u)("div",{class:H.loader}))}renderNoBookmarksContainer(){const{messages:t,disabled:e}=this;return(0,j.u)("div",{class:H.noBookmarksContainer,key:"no-bookmarks",tabIndex:e?-1:null},(0,j.u)("span",{"aria-hidden":"true",class:this.classes(H.noBookmarksIcon,H.widgetIcon)}),(0,j.u)(Z.X6,{level:this.headingLevel,class:this.classes(H.header,H.noBookmarksHeader)},t?.noBookmarksHeading),(0,j.u)("p",{class:H.noBookmarksDescription},t?.noBookmarksDescription))}renderAddBookmarkLoading(){return(0,j.u)("div",{key:"adding-bookmark",class:H.addingBookmark},(0,j.u)("span",{"aria-hidden":"true",class:this.classes(H.loading,H.rotating)}),this.messages?.addingBookmark)}renderBookmarkItems(t){if(!t)return null;const{_userState:e,editingEnabled:o}=this;return t.map((t=>o&&t&&e&&("edit"===e.state||"edit-thumbnail"===e.state)&&e.bookmark===t?"edit-thumbnail"===e.state?this.renderEditingBookmarkUrl(e.editedBookmark):this.renderEditingBookmark(e.editedBookmark):this.renderBookmark(t))).toArray()}renderBookmarksContainer(t){const{_userState:e,editingEnabled:o,disabled:i}=this,s="add"===e?.state,a=o&&!s?this.renderAddBookmarkButton():null,r=o?s&&e.loading?this.renderAddBookmarkLoading():"add"===e?.state?this.renderAddingBookmark():null:null;return[(0,j.u)("ul",{key:"bookmark-list","aria-label":this.messages?.widgetLabel,class:this.classes(H.bookmarkList,{[H.bookmarkListSortable]:this.editingEnabled}),afterCreate:this._sortNodeCreated,afterRemoved:this._destroySortable,"data-node-ref":"_sortableNode",bind:this,tabIndex:i?-1:null},this.renderBookmarkItems(t)),a,r]}renderAddBookmarkButton(){return this.visibleElements.addBookmark?(0,j.u)("div",{key:"add-bookmark-item",class:H.addBookmark},(0,j.u)("button",{class:this.classes(H.esriButton,H.esriButtonTertiary,H.addBookmarkButton),disabled:this.disabled,onclick:this.startAddBookmark,afterCreate:this._storeAddBookmarkButton,afterUpdate:this._storeAddBookmarkButton,"data-node-ref":"_addBookmarkButtonNode",bind:this,type:"button"},(0,j.u)("span",{"aria-hidden":"true",class:this.classes(H.addBookmarkIcon,H.iconPlus)}),this.messages?.addBookmark)):null}renderBookmarks(){const{bookmarks:t}=this.viewModel,e=t&&t.filter(Boolean),o=e&&e.length,i=o||this.editingEnabled?this.renderBookmarksContainer(e):null;return[o?null:this.renderNoBookmarksContainer(),i]}renderEditContainer(t){const{messagesCommon:e,disabled:o}=this,i=this._getBookmarkTitle(t);return(0,j.u)("div",{class:H.bookmarkEditButtonContainer,key:"edit-container"},(0,j.u)("button",{disabled:o,title:`${e?.edit} ${i}`,"aria-label":`${e?.edit} ${i}`,"data-bookmark":t,onclick:this._showEditBookmarkForm,bind:this,class:H.bookmarkEditButton,type:"button"},(0,j.u)("span",{"aria-hidden":"true",class:H.iconEdit})))}renderDragHandle(t){const{messagesCommon:e,disabled:o}=this,i=this._getBookmarkTitle(t),s={[G]:t.uid};return(0,j.u)("div",{role:"button",tabIndex:o?-1:0,key:"drag-handle",bind:this,class:H.bookmarkDragHandle,onkeydown:this._dragHandleKeydown,afterCreate:this._focusDragHandle,afterUpdate:this._focusDragHandle,onblur:this._dragHandleBlur,"aria-pressed":this._selectedSortUid===t.uid?"true":"false","aria-label":`${e?.dragHandleTitle} ${i}`,title:`${e?.dragHandleTitle} ${i}`,...s},(0,j.u)("span",{"aria-hidden":"true",class:this.classes(H.bookmarkDragHandleIcon,H.iconHandle)}))}renderBookmarkImageIcon(){return(0,j.u)("span",{"aria-hidden":"true",class:this.classes(H.bookmarkIcon,H.widgetIcon)})}renderBookmarkImage(t){const{visibleElements:e}=this,{thumbnail:o}=t,i=o&&o.url||"";return e.thumbnail&&i?(0,j.u)("img",{src:i,alt:"",class:H.bookmarkImage}):null}renderBookmarkTimeSwitch(t){const{messages:e,disabled:o}=this,{timeExtent:i}=t,{view:s}=this.viewModel;return s.timeExtent||i?(0,j.u)("calcite-label",{layout:"inline-space-between"},e.includeTimeExtent,(0,j.u)("calcite-switch",{scale:"s",disabled:o,checked:!!i,onCalciteSwitchChange:t=>{const e=t.currentTarget;this._editIncludeTimeExtent=!!e.checked}})):null}renderBookmarkTimeExtent(t){const{visibleElements:e}=this,{timeExtent:o}=t;return o?(0,j.u)("span",{class:H.timeExtent},[(0,u.pC)(o.start)&&(0,j.u)("span",{key:"start-date-group",class:H.timeExtentGroup},(0,j.u)("span",{key:"start-date",class:H.timeExtentDate},this._formatDate(o.start)),e.time&&(0,j.u)("span",{key:"start-time",class:H.timeExtentTime},this._formatTime(o.start))),(0,u.pC)(o.end)&&((0,u.Wi)(o.start)||o.start.getTime()!==o.end.getTime())&&(0,j.u)("span",{key:"end-date-group",class:H.timeExtentGroup},(0,j.u)("span",{key:"end-date",class:H.timeExtentDate},this._formatDate(o.end)),e.time&&(0,j.u)("span",{key:"end-time",class:H.timeExtentTime},this._formatTime(o.end)))]):null}renderBookmarkButton(t){const{disabled:e}=this,{timeExtent:o}=t,{abilities:i}=this.viewModel,s=this._getBookmarkTitle(t),{thumbnail:a}=t,r=(0,j.u)("div",{class:this.classes(H.bookmarkImageContainer,a&&a.url?H.bookmarkImageContainerHasImage:null)},this.renderBookmarkImage(t)||this.renderBookmarkImageIcon()),n=i.time&&o?(0,j.u)("span",{key:"time-extent",class:H.bookmarkTimeExtent},this.renderBookmarkTimeExtent(t)):null;return(0,j.u)("button",{disabled:e,key:"bookmark-button",class:H.bookmarkButton,bind:this,"data-bookmark":t,onclick:this._goToBookmark,type:"button"},r,(0,j.u)("div",{class:H.bookmarkLabel},(0,j.u)("span",{key:"bookmark-title",class:H.bookmarkName},s),n))}renderBookmark(t){const{activeBookmark:e}=this.viewModel,o={[H.bookmarkActive]:e===t},i=this.editingEnabled?this.renderEditContainer(t):null,s={[G]:t.uid},a=this.editingEnabled?this.renderDragHandle(t):null;return(0,j.u)("li",{key:t,class:this.classes(H.bookmark,o),...s},a,this.renderBookmarkButton(t),i)}renderEditingBookmarkName(t){const{messages:e,_userState:o,disabled:i}=this,s="name-required"===o.validationState;return(0,j.u)("label",{class:H.authoringLabel},e?.title,s?(0,j.u)("strong",null,e?.invalidTitle):null,(0,j.u)("input",{required:!0,disabled:i,bind:this,class:this.classes(H.esriInput,s?H.authoringInputInvalid:null),type:"text",value:t.name,afterCreate:this._storeEditInput,afterUpdate:this._focusEditInput,"data-bookmark":t,"data-node-ref":"_editInputNode",placeholder:e?.titlePlaceholder}))}renderEditingBookmarkUrlActions(){const{messagesCommon:t,disabled:e}=this;return(0,j.u)("div",{class:H.authoringActions},(0,j.u)("input",{type:"button",disabled:e,value:t?.back,class:this.classes(H.esriButton,H.esriButtonTertiary),onclick:this._closeUrlEditBookmarkForm,bind:this}),(0,j.u)("input",{class:H.esriButton,disabled:e,type:"submit",value:t?.add}))}renderEditingBookmarkActions(){const{messagesCommon:t,disabled:e}=this,{bookmark:o}=this._userState;return(0,j.u)("div",{class:H.authoringActions},(0,j.u)("input",{type:"button",disabled:e,value:t?.delete,class:this.classes(H.esriButton,H.esriButtonTertiary,H.authoringDeleteButton),"data-bookmark":o,onclick:this._deleteBookmark,bind:this}),(0,j.u)("input",{disabled:e,type:"button",value:t?.cancel,class:this.classes(H.esriButton,H.esriButtonTertiary),onclick:this._closeEditBookmarkForm,bind:this}),(0,j.u)("input",{class:H.esriButton,disabled:e,type:"submit",value:t?.save}))}renderEditingBookmarkUrlInput(t){const{messages:e,_userState:o,disabled:i}=this,s=t.thumbnail?.url,a=W.test(s)?s:null,r="absolute-url-required"===o.validationState;return(0,j.u)("label",{class:H.authoringLabel},r?(0,j.u)("strong",null,e?.invalidImageUrl):null,(0,j.u)("input",{required:!0,disabled:i,bind:this,class:this.classes(H.esriInput,r?H.authoringInputInvalid:null),type:"text",value:a,afterCreate:this._storeUrlEditInput,afterUpdate:this._focusUrlEditInput,"data-bookmark":t,"data-node-ref":"_urlEditInputNode",title:e?.imageUrlTooltip,placeholder:e&&`https://<${e.imageUrlPlaceholder}>`}))}renderEditingBookmarkUrl(t){const e={[G]:t.uid};return(0,j.u)("li",{key:"edit-bookmark-url-form",class:H.authoringCard,...e},(0,j.u)("form",{class:H.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkUrlSubmit,bind:this},this.renderEditingBookmarkUrlInput(t),this.renderEditingBookmarkUrlActions()))}renderEditingBookmark(t){const e={[G]:t.uid},{abilities:o}=this.viewModel,i=o.time?(0,j.u)("div",{key:"edit-bookmark-time-container",class:H.timeExtentContainer},this.renderBookmarkTimeSwitch(t),this._editIncludeTimeExtent&&this.renderBookmarkTimeExtent(t)):null;return(0,j.u)("li",{key:"edit-bookmark-form",class:H.authoringCard,...e},(0,j.u)("form",{class:H.authoringForm,disabled:this.disabled,onsubmit:this._editBookmarkSubmit,bind:this},(0,j.u)("div",{class:H.authoringContainer},(0,j.u)("div",{class:H.bookmarkImageContainer},this.renderBookmarkImage(t),this._editMenu.render()),this.renderEditingBookmarkName(t)),i,this.renderEditingBookmarkActions()))}renderAddingBookmarkName(){const{_userState:t,messages:e,disabled:o}=this,i="name-required"===t.validationState;return(0,j.u)("label",{class:H.authoringLabel},e?.title,i?(0,j.u)("strong",null,e?.invalidTitle):null,(0,j.u)("input",{required:!0,disabled:o,bind:this,class:this.classes(H.esriInput,i?H.authoringInputInvalid:null),type:"text",afterCreate:this._storeAddInput,afterUpdate:this._focusAddInput,"data-node-ref":"_addInputNode",value:"",placeholder:e?.titlePlaceholder}))}renderAddingBookmarkActions(){const{messagesCommon:t,disabled:e}=this;return(0,j.u)("div",{class:this.classes(H.authoringActions)},(0,j.u)("input",{type:"button",disabled:e,value:t?.cancel,class:this.classes(H.esriButton,H.esriButtonTertiary,H.authoringCancelButton),onclick:this._endAddBookmark.bind(this),bind:this}),(0,j.u)("input",{class:H.esriButton,disabled:e,type:"submit",value:t?.add}))}renderAddingBookmark(){return(0,j.u)("div",{key:"add-bookmark-form",class:H.authoringCard},(0,j.u)("form",{class:H.authoringForm,onsubmit:this._addBookmarkSubmit,bind:this},this.renderAddingBookmarkName(),this.renderAddingBookmarkActions()))}_getBookmarkTitle(t){return t.name||this.messagesCommon?.untitled}_formatDate(t){return t?(0,b.p6)(t,(0,b.Ze)("short-date")):null}_formatTime(t){return t?(0,b.p6)(t,(0,b.Ze)("long-time")):null}_dragHandleBlur(){this._selectedSortUid=null,this.scheduleRender()}_dragHandleKeydown(t){const{_sortableSavedItems:e}=this,o=(0,d.kK)(t);if(!["ArrowDown","ArrowUp","Escape","Tab"," ","Enter"].includes(o))return;const{_sortable:i,_selectedSortUid:s}=this,a=i.toArray(),r=t.target.getAttribute(G),n=a.indexOf(r);if((0,F.pf)(o)){const t=s&&s===r;return this._selectedSortUid=t?null:r,this._sortableSavedItems=t?null:this._sortable.toArray(),void this.scheduleRender()}if("Tab"===o)return this._selectedSortUid=null,void this.scheduleRender();if("Escape"===o&&e)return t.stopPropagation(),this._selectedSortUid=null,this._updateSortItems(e,i,r),void this.scheduleRender();if(-1===n||!s)return;const l="ArrowUp"===o?n-1:n+1;l>=a.length||l<=-1||(function(t,e,o){t.splice(o,0,t.splice(e,1)[0])}(a,n,l),this._updateSortItems(a,i,r))}_updateSortItems(t,e,o){e.sort(t),this._sortBookmarks(e),this._focusSortUid=o,this._selectedSortUid=o}_focusDragHandle(t){const{_focusSortUid:e}=this;t&&e&&t.getAttribute(G)===e&&(t.focus(),this._focusSortUid=null)}_toggleSorting(){const{_sortable:t,_sortableNode:e,editingEnabled:o,disabled:i}=this;if(e)if(t)t.option("disabled",i||!o);else{const t=q.ZP.create(e,{dataIdAttr:G,handle:`.${H.bookmarkDragHandle}`,group:"bookmarks",disabled:i||!o,onSort:()=>this._sortBookmarks(t)});this._sortable=t}}_sortNodeCreated(t){this._sortableNode=t,this._toggleSorting()}_sortBookmarks(t){const{bookmarks:e}=this.viewModel;if(!e)return;const o=t.toArray();e.sort(((t,e)=>{const i=o.indexOf(t.uid),s=o.indexOf(e.uid);return i>s?1:i<s?-1:0}))}_destroySortable(){const{_sortable:t}=this;t&&t.destroy(),this._sortable=null}_endAddBookmark(){this._focusAddBookmarkButton=!0,this.endAddBookmark()}_bookmarksInitialized(){const t="bookmarks-init",{_handles:e}=this;e.remove(t),e.add((0,k.on)((()=>this.viewModel?.bookmarks),"change",(()=>this._bookmarksChanged())),t)}_bookmarksChanged(){const t="bookmarks-change",{bookmarks:e}=this.viewModel,{_handles:o}=this;o.remove(t);const i=e.map((t=>(0,k.YP)((()=>[t?.name,t?.thumbnail?.url]),(()=>this.scheduleRender()))));o.add(i,t),this.scheduleRender()}_showEditBookmarkForm(t){const e=t.currentTarget["data-bookmark"];this._editIncludeTimeExtent=!!e.timeExtent,this._focusEditInputBox=!0,this._userState=new v({bookmark:e,state:"edit"}),this.viewModel.goTo(e),this.scheduleRender()}_closeUrlEditBookmarkForm(){this._focusEditInputBox=!0,this._userState.state="edit"}_closeEditBookmarkForm(){this._userState=null}_addBookmarkSubmit(t){t.preventDefault();const{_addInputNode:e,_userState:o}=this,i=e&&e.value.trim();i?(o.loading=!0,this.viewModel.createBookmark().then((t=>{t.name=i,this.viewModel.bookmarks.add(t),this._endAddBookmark()}))):o.validationState="name-required"}async _editBookmarkAndClose(t,e){const{viewModel:o}=this;await o.editBookmark(t,{...o.defaultEditOptions,...e}),this._closeEditBookmarkForm()}_editBookmarkSubmit(t){t.preventDefault();const{_editInputNode:e,_userState:o,_editIncludeTimeExtent:i}=this,s=e&&e.value.trim();s?(o.bookmark.name=s,o.bookmark.thumbnail=o.editedBookmark.thumbnail,i||(o.bookmark.timeExtent=null),this._editBookmarkAndClose(o.bookmark,{takeScreenshot:!1,captureTimeExtent:i})):o.validationState="name-required"}_storeAddBookmarkButton(t){this._addBookmarkButtonNode=t,this._focusAddBookmark()}_storeEditInput(t){this._editInputNode=t,this._focusEditInput()}_storeAddInput(t){this._addInputNode=t,this._focusAddInput()}_storeUrlEditInput(t){this._urlEditInputNode=t,this._focusUrlEditInput()}_focusUrlEditInput(){this._urlEditInputNode&&this._focusUrlEditInputBox&&(this._focusUrlEditInputBox=!1,this._urlEditInputNode.focus())}_focusAddInput(){this._addInputNode&&this._focusAddInputBox&&(this._focusAddInputBox=!1,this._addInputNode.focus())}_focusAddBookmark(){this._addBookmarkButtonNode&&this._focusAddBookmarkButton&&(this._focusAddBookmarkButton=!1,this._addBookmarkButtonNode.focus())}_focusEditInput(){this._editInputNode&&this._focusEditInputBox&&(this._focusEditInputBox=!1,this._editInputNode.focus())}_deleteBookmark(t){const e=t.currentTarget["data-bookmark"];this.viewModel.bookmarks.remove(e)}_goToBookmark(t){const e=t.currentTarget["data-bookmark"];this.endAddBookmark(),this._closeEditBookmarkForm(),this.viewModel.goTo(e)}async _refreshThumbnail(){const{_userState:t,_editMenu:e,viewModel:o}=this;t.validationState=void 0,await o.editBookmark(this._userState.editedBookmark,{takeScreenshot:!0,captureViewpoint:!1,captureRotation:!1,captureScale:!1,captureTimeExtent:!1}),e.open=!1,this._focusEditInputBox=!0,this.scheduleRender()}_removeThumbnail(){const{_userState:t,_editMenu:e}=this;t.editedBookmark.thumbnail=null,t.validationState=void 0,e.open=!1,this._focusEditInputBox=!0,this.scheduleRender()}_startUseImageUrl(){this._userState.state="edit-thumbnail",this._editMenu.open=!1,this._focusUrlEditInputBox=!0,this.scheduleRender()}_editBookmarkUrlSubmit(t){t.preventDefault();const{_urlEditInputNode:e,_userState:o}=this,i=e.value;W.test(i)?(i&&(o.editedBookmark.thumbnail=new p.A({url:i})),this._closeUrlEditBookmarkForm()):o.validationState="absolute-url-required"}};(0,n._)([(0,m.Cb)()],K.prototype,"_editIncludeTimeExtent",void 0),(0,n._)([(0,m.Cb)({type:v})],K.prototype,"_userState",void 0),(0,n._)([(0,m.Cb)({readOnly:!0})],K.prototype,"_editMenuItems",null),(0,n._)([(0,m.Cb)({readOnly:!0})],K.prototype,"_editMenu",null),(0,n._)([(0,m.Cb)()],K.prototype,"defaultCreateOptions",null),(0,n._)([(0,m.Cb)()],K.prototype,"defaultEditOptions",null),(0,n._)([(0,m.Cb)()],K.prototype,"bookmarks",null),(0,n._)([(0,m.Cb)()],K.prototype,"disabled",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"editingEnabled",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"headingLevel",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"goToOverride",null),(0,n._)([(0,m.Cb)()],K.prototype,"iconClass",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"label",null),(0,n._)([(0,m.Cb)(),(0,P.H)("esri/widgets/Bookmarks/t9n/Bookmarks")],K.prototype,"messages",void 0),(0,n._)([(0,m.Cb)(),(0,P.H)("esri/t9n/common")],K.prototype,"messagesCommon",void 0),(0,n._)([(0,m.Cb)(),(0,P.H)("esri/core/t9n/Units")],K.prototype,"messagesUnits",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"uiStrings",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"view",null),(0,n._)([(0,m.Cb)({type:U}),(0,V.s)(["select-bookmark","bookmark-edit","bookmark-select"])],K.prototype,"viewModel",void 0),(0,n._)([(0,m.Cb)()],K.prototype,"visibleElements",void 0),(0,n._)([(0,c.p)("visibleElements")],K.prototype,"castVisibleElements",null),(0,n._)([(0,m.Cb)()],K.prototype,"endAddBookmark",null),(0,n._)([(0,m.Cb)()],K.prototype,"startAddBookmark",null),K=(0,n._)([(0,h.j)("esri.widgets.Bookmarks")],K);const Y=K;const X=t=>{const e=(0,i.useRef)(),o=(0,i.useRef)(!1),[s,a]=(0,i.useState)(),[n,d]=(0,i.useState)(!1);(0,i.useEffect)((()=>{var i,r;return o.current||(o.current=!0,a((i=e.current,r=t.view,new Y({view:r,container:i,editingEnabled:!0})))),()=>{s&&s.destroy()}}),[]),(0,i.useEffect)((()=>{d(t.isActive)}),[t.isActive]);const l=(0,i.useCallback)((e=>{t.toolDismissed()}),[]),u=(0,i.useCallback)((e=>{t.showTips(r)}),[]);return{bookmarkRef:e,isActive:n,toolDismissed:l,tipsClicked:u}};var J=o(80184);const Q=t=>{const{bookmarkRef:e,isActive:o,toolDismissed:i,tipsClicked:r}=X(t);return(0,J.jsxs)(s.N$,{id:"bookmarks-panel",heading:"Bookmarks","data-panel":"bookmarks",hidden:!o,closed:!o||void 0,closable:!0,onCalcitePanelClose:i,children:[(0,J.jsx)(s.G1,{id:"tip",icon:"lightbulb",text:"Tips",slot:"header-actions-end",onClick:r}),(0,J.jsx)(s.G1,{id:"collapseTool",icon:"chevron-up",text:"",slot:"header-actions-end",onClick:a.F$}),(0,J.jsx)(s.$A,{label:"Show Tip",referenceElement:"tip",closeOnClick:!0,children:"Show Tip"}),(0,J.jsx)(s.$A,{label:"Collapse",referenceElement:"collapseTool",closeOnClick:!0,children:"Collapse"}),(0,J.jsx)("div",{ref:e})]})},tt=i.memo(Q)}}]);
//# sourceMappingURL=8820.86dc43be.chunk.js.map