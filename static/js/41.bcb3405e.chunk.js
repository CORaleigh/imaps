(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[41],{104:function(e,t,n){"use strict";function r(){return[0,0,0]}function i(e){return[e[0],e[1],e[2]]}function a(e,t,n){return[e,t,n]}function o(e){for(var t=[0,0,0],n=Math.min(3,e.length),r=0;r<n;++r)t[r]=e[r];return t}function l(e,t){return new Float64Array(e,t,3)}function s(){return[0,0,0]}function u(){return a(1,1,1)}function c(){return a(1,0,0)}function f(){return a(0,1,0)}function h(){return a(0,0,1)}n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return a}));var d=[0,0,0],p=u(),v=c(),m=f(),y=h();Object.freeze({__proto__:null,create:r,clone:i,fromValues:a,fromArray:o,createView:l,zeros:s,ones:u,unitX:c,unitY:f,unitZ:h,ZEROS:d,ONES:p,UNIT_X:v,UNIT_Y:m,UNIT_Z:y})},111:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return _})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return b})),n.d(t,"g",(function(){return T})),n.d(t,"h",(function(){return g})),n.d(t,"i",(function(){return u})),n.d(t,"j",(function(){return o})),n.d(t,"k",(function(){return v})),n.d(t,"l",(function(){return O})),n.d(t,"m",(function(){return C})),n.d(t,"n",(function(){return p})),n.d(t,"o",(function(){return a})),n.d(t,"p",(function(){return q})),n.d(t,"q",(function(){return x})),n.d(t,"r",(function(){return m})),n.d(t,"s",(function(){return y})),n.d(t,"t",(function(){return M})),n.d(t,"u",(function(){return E})),n.d(t,"v",(function(){return l})),n.d(t,"w",(function(){return j})),n.d(t,"x",(function(){return k})),n.d(t,"y",(function(){return z})),n.d(t,"z",(function(){return D}));var r=n(104),i=n(184);function a(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function l(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function s(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function u(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function c(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function f(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function h(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function d(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function p(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function v(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function m(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function y(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function x(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function T(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function b(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],l=n[1],s=n[2];return e[0]=i*s-a*l,e[1]=a*o-r*s,e[2]=r*l-i*o,e}function g(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}function O(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12],e[1]=n[1]*r+n[5]*i+n[9]*a+n[13],e[2]=n[2]*r+n[6]*i+n[10]*a+n[14],e}function j(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function M(e,t,n){var r=n[0],i=n[1],a=n[2],o=n[3],l=t[0],s=t[1],u=t[2],c=i*u-a*s,f=a*l-r*u,h=r*s-i*l,d=i*h-a*f,p=a*c-r*h,v=r*f-i*c,m=2*o;return c*=m,f*=m,h*=m,d*=2,p*=2,v*=2,e[0]=l+c+d,e[1]=s+f+p,e[2]=u+h+v,e}function _(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}var R=Object(r.e)(),w=Object(r.e)();function q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var E=u,I=c,A=f,D=p,z=v,C=a,k=m;Object.freeze({__proto__:null,length:a,copy:o,set:l,add:s,subtract:u,multiply:c,divide:f,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:h,scaleAndAdd:d,distance:p,squaredDistance:v,squaredLength:m,negate:y,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:x,dot:T,cross:b,lerp:g,hermite:function(e,t,n,r,i,a){var o=a*a,l=o*(2*a-3)+1,s=o*(a-2)+a,u=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*l+n[0]*s+r[0]*u+i[0]*c,e[1]=t[1]*l+n[1]*s+r[1]*u+i[1]*c,e[2]=t[2]*l+n[2]*s+r[2]*u+i[2]*c,e},bezier:function(e,t,n,r,i,a){var o=1-a,l=o*o,s=a*a,u=l*o,c=3*a*l,f=3*s*o,h=s*a;return e[0]=t[0]*u+n[0]*c+r[0]*f+i[0]*h,e[1]=t[1]*u+n[1]*c+r[1]*f+i[1]*h,e[2]=t[2]*u+n[2]*c+r[2]*f+i[2]*h,e},random:function(e,t){t=t||1;var n=2*Object(i.b)()*Math.PI,r=2*Object(i.b)()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e},transformMat4:O,transformMat3:j,transformQuat:M,rotateX:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateZ:_,angle:function(e,t){o(R,e),o(w,t),x(R,R),x(w,w);var n=T(R,w);return n>1?0:n<-1?Math.PI:Math.acos(n)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:q,equals:function(e,t){var n=e[0],r=e[1],a=e[2],o=t[0],l=t[1],s=t[2];return Math.abs(n-o)<=i.a*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-l)<=i.a*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-s)<=i.a*Math.max(1,Math.abs(a),Math.abs(s))},sub:E,mul:I,div:A,dist:D,sqrDist:z,len:C,sqrLen:k})},1117:function(e,t,n){"use strict";n.r(t),n.d(t,"ElevationQuery",(function(){return w})),n.d(t,"GeometryDescriptor",(function(){return q})),n.d(t,"getFinestLodIndex",(function(){return D}));var r=n(91),i=n(7),a=n(89),o=n(93),l=n(94),s=n(113),u=n(225),c=n(141),f=n(201),h=n(117),d=n(125),p=n(223),v=(n(80),n(81)),m=n(161),y=n(309),x=(n(101),v.a.getLogger("esri.layers.support.ElevationSampler"));class T{queryElevation(e){return function(e,t){var n=O(e,t.spatialReference);if(!n)return null;switch(e.type){case"point":!function(e,t,n){e.z=Object(a.r)(n.elevationAt(t),0)}(e,n,t);break;case"polyline":!function(e,t,n){j.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,i=0;i<e.paths.length;i++)for(var o=e.paths[i],l=t.paths[i],s=0;s<o.length;s++){var u=o[s],c=l[s];j.x=c[0],j.y=c[1],r&&(u[3]=u[2]),u[2]=Object(a.r)(n.elevationAt(j),0)}e.hasZ=!0}(e,n,t);break;case"multipoint":!function(e,t,n){j.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,i=0;i<e.points.length;i++){var o=e.points[i],l=t.points[i];j.x=l[0],j.y=l[1],r&&(o[3]=o[2]),o[2]=Object(a.r)(n.elevationAt(j),0)}e.hasZ=!0}(e,n,t)}return e}(e.clone(),this)}on(){return M}projectIfRequired(e,t){return O(e,t)}}class b extends T{constructor(e,t,n){super(),this.tile=e,this.noDataValue=n,this.extent=Object(d.r)(e.tile.extent,t.spatialReference);var r=Object(h.f)(t.spatialReference),i=t.lodAt(e.tile.level).resolution*r;this.demResolution={min:i,max:i}}get spatialReference(){return this.extent.spatialReference}contains(e){var t=this.projectIfRequired(e,this.spatialReference);return Object(y.e)(this.extent,t)}elevationAt(e){var t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;if(!this.contains(e)){var n=this.extent,r="".concat(n.xmin,", ").concat(n.ymin,", ").concat(n.xmax,", ").concat(n.ymax);x.warn("#elevationAt()","Point used to sample elevation (".concat(e.x,", ").concat(e.y,") is outside of the sampler extent (").concat(r,")"))}return this.tile.sample(t.x,t.y)}}class g extends T{constructor(e,t,n){var r;super(),"number"==typeof t?(this.noDataValue=t,r=null):(r=t,this.noDataValue=n),this.samplers=r?e.map((e=>new b(e,r,this.noDataValue))):e;var i=this.samplers[0];if(i){this.extent=i.extent.clone();var{min:a,max:o}=i.demResolution;this.demResolution={min:a,max:o};for(var l=1;l<this.samplers.length;l++){var s=this.samplers[l];this.extent.union(s.extent),this.demResolution.min=Math.min(this.demResolution.min,s.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,s.demResolution.max)}}else this.extent=Object(d.r)(Object(d.i)(),r.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(e){var t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;for(var n of this.samplers)if(n.contains(t))return n.elevationAt(t);return x.warn("#elevationAt()","Point used to sample elevation (".concat(e.x,", ").concat(e.y,") is outside of the sampler")),null}}function O(e,t){var n=e.spatialReference;return n.equals(t)?e:Object(m.a)(n,t)?Object(m.d)(e,t):(x.error("Cannot project geometry spatial reference (wkid:".concat(n.wkid,") to elevation sampler spatial reference (wkid:").concat(t.wkid,")")),null)}var j=new s.a,M={remove(){}};class _{constructor(e,t){if(this.tile=e,t){var n=this.tile.extent;this.samplerData={pixelData:t.values,width:t.width,height:t.height,safeWidth:.99999999*(t.width-1),noDataValue:t.noDataValue,dx:(t.width-1)/(n[2]-n[0]),dy:(t.width-1)/(n[3]-n[1]),x0:n[0],y1:n[3]}}else this.samplerData=null}sample(e,t){if(this.samplerData)return function(e,t,n){var{safeWidth:r,width:i,pixelData:a,noDataValue:o}=e,l=R(e.dy*(e.y1-n),0,r),s=R(e.dx*(t-e.x0),0,r),u=Math.floor(l),c=Math.floor(s),f=u*i+c,h=f+i,d=a[f],p=a[h],v=a[f+1],m=a[h+1];if(d!==o&&p!==o&&v!==o&&m!==o){var y=s-c,x=d+(v-d)*y;return x+(p+(m-p)*y-x)*(l-u)}}(this.samplerData,e,t)}}function R(e,t,n){return e<t?t:e>n?n:e}class w{queryAll(e,t,n){var a=this;return Object(i.a)((function*(){if(!(e=n&&n.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new o.a("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");var i=q.fromGeometry(t),l=!1;n&&n.returnSampleInfo||(l=!0);var s=Object(r.a)(Object(r.a)(Object(r.a)({},z),n),{},{returnSampleInfo:!0}),u=yield a.query(e[e.length-1],i,s),c=yield a._queryAllContinue(e,u,s);return c.geometry=c.geometry.export(),l&&delete c.sampleInfo,c}))()}query(e,t,n){var a=this;return Object(i.a)((function*(){if(!e)throw new o.a("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!t||!(t instanceof q)&&"point"!==t.type&&"multipoint"!==t.type&&"polyline"!==t.type)throw new o.a("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");var i=Object(r.a)(Object(r.a)({},z),n),l=new I(e,t.spatialReference,i),s=i.signal;return yield e.load({signal:s}),yield a._createGeometryDescriptor(l,t,s),yield a._selectTiles(l,s),yield a._populateElevationTiles(l,s),a._sampleGeometryWithElevation(l),a._createQueryResult(l,s)}))()}createSampler(e,t,n){var a=this;return Object(i.a)((function*(){if(!e)throw new o.a("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");if(!t||"extent"!==t.type)throw new o.a("elevation-query:invalid-extent","Invalid or undefined extent");var i=Object(r.a)(Object(r.a)({},z),n);return a._createSampler(e,t,i)}))()}createSamplerAll(e,t,n){var a=this;return Object(i.a)((function*(){if(!(e=n&&n.ignoreInvisibleLayers?e.filter((e=>e.visible)):e.slice()).length)throw new o.a("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");if(!t||"extent"!==t.type)throw new o.a("elevation-query:invalid-extent","Invalid or undefined extent");var i=Object(r.a)(Object(r.a)(Object(r.a)({},z),n),{},{returnSampleInfo:!0}),l=yield a._createSampler(e[e.length-1],t,i);return a._createSamplerAllContinue(e,t,l,i)}))()}_createSampler(e,t,n,r){var a=this;return Object(i.a)((function*(){var i=n.signal;yield e.load({signal:i});var o=t.spatialReference,l=e.tileInfo.spatialReference;o.equals(l)||(yield Object(p.f)([{source:o,dest:l}],{signal:i}),t=Object(p.j)(t,l));var s=new A(e,t,n,r);return yield a._selectTiles(s,i),yield a._populateElevationTiles(s,i),new g(s.elevationTiles,s.layer.tileInfo,s.options.noDataValue)}))()}_createSamplerAllContinue(e,t,n,r){var a=this;return Object(i.a)((function*(){if(e.pop(),!e.length)return n;var i=n.samplers.map((e=>Object(d.m)(e.extent))),o=yield a._createSampler(e[e.length-1],t,r,i);if(0===o.samplers.length)return n;var l=n.samplers.concat(o.samplers),s=new g(l,r.noDataValue);return a._createSamplerAllContinue(e,t,s,r)}))()}_queryAllContinue(e,t,n){var r=this;return Object(i.a)((function*(){for(var i=e.pop(),a=t.geometry.coordinates,o=[],l=[],s=0;s<a.length;s++){var u=t.sampleInfo[s];u.demResolution>=0?u.source||(u.source=i):e.length&&(o.push(a[s]),l.push(s))}if(!e.length||0===o.length)return t;var c=t.geometry.clone(o),f=yield r.query(e[e.length-1],c,n);return l.forEach(((e,n)=>{a[e].z=f.geometry.coordinates[n].z,t.sampleInfo[e].demResolution=f.sampleInfo[n].demResolution})),r._queryAllContinue(e,t,n)}))()}_createQueryResult(e,t){var n=this;return Object(i.a)((function*(){var r={geometry:(yield e.geometry.project(e.outSpatialReference,t)).export(),noDataValue:e.options.noDataValue};return e.options.returnSampleInfo&&(r.sampleInfo=n._extractSampleInfo(e)),e.geometry.coordinates.forEach((e=>{e.tile=null,e.elevationTile=null})),r}))()}_createGeometryDescriptor(e,t,n){return Object(i.a)((function*(){var r,i=e.layer.tileInfo.spatialReference;if(t instanceof q?r=yield t.project(i,n):(yield Object(p.f)([{source:t.spatialReference,dest:i}],{signal:n}),r=Object(p.j)(t,i)),!r)throw new o.a("elevation-query:spatial-reference-mismatch","Cannot query elevation in '".concat(t.spatialReference.wkid,"' on an elevation service in '").concat(i.wkid,"'"));e.geometry=q.fromGeometry(r)}))()}_selectTiles(e,t){var n=this;return Object(i.a)((function*(){var r=e.options.demResolution;if("geometry"===e.type&&n._preselectOutsideLayerExtent(e),"number"==typeof r)n._selectTilesClosestResolution(e);else if("finest-contiguous"===r)yield n._selectTilesFinestContiguous(e,t);else{if("auto"!==r)throw new o.a("elevation-query:invalid-dem-resolution","Invalid dem resolution value '".concat(r,'\', expected a number, "finest-contiguous" or "auto"'));yield n._selectTilesAuto(e,t)}}))()}_preselectOutsideLayerExtent(e){var t=new _(null);t.sample=()=>e.options.noDataValue,e.outsideExtentTile=t;var n=e.layer.fullExtent;e.geometry.coordinates.forEach((e=>{var r=e.x,i=e.y;(r<n.xmin||r>n.xmax||i<n.ymin||i>n.ymax)&&(e.elevationTile=t)}))}_selectTilesClosestResolution(e){var t=e.layer.tileInfo,n=this._findNearestDemResolutionLODIndex(t,e.options.demResolution);e.selectTilesAtLOD(n)}_findNearestDemResolutionLODIndex(e,t){for(var n=t/Object(h.f)(e.spatialReference),r=e.lods[0],i=0,a=1;a<e.lods.length;a++){var o=e.lods[a];Math.abs(o.resolution-n)<Math.abs(r.resolution-n)&&(r=o,i=a)}return i}_selectTilesFinestContiguous(e,t){var n=this;return Object(i.a)((function*(){var r=D(e.layer.tileInfo,e.options.minDemResolution);yield n._selectTilesFinestContiguousAt(e,r,t)}))()}_selectTilesFinestContiguousAt(e,t,n){var r=this;return Object(i.a)((function*(){var i=e.layer;if(e.selectTilesAtLOD(t),!(t<0)){var a=i.tilemapCache,s=e.getTilesToFetch();try{if(a)yield Object(l.x)(Promise.all(s.map((e=>a.fetchAvailability(e.level,e.row,e.col,{signal:n})))),n);else if(yield r._populateElevationTiles(e,n),!e.allElevationTilesFetched())throw e.clearElevationTiles(),new o.a("elevation-query:has-unavailable-tiles")}catch(u){Object(l.t)(u),yield r._selectTilesFinestContiguousAt(e,t-1,n)}}}))()}_populateElevationTiles(e,t){return Object(i.a)((function*(){var n=e.getTilesToFetch(),r={},o=e.options.cache,s=e.options.noDataValue,u=n.map(function(){var n=Object(i.a)((function*(n){var i="".concat(e.layer.uid,":").concat(n.id,":").concat(s),l=Object(a.k)(o)?o.get(i):null,u=Object(a.k)(l)?l:yield e.layer.fetchTile(n.level,n.row,n.col,{noDataValue:s,signal:t});Object(a.k)(o)&&o.put(i,u),r[n.id]=new _(n,u)}));return function(e){return n.apply(this,arguments)}}());yield Object(l.x)(Object(l.j)(u),t),e.populateElevationTiles(r)}))()}_selectTilesAuto(e,t){var n=this;return Object(i.a)((function*(){n._selectTilesAutoFinest(e),n._reduceTilesForMaximumRequests(e);var r=e.layer.tilemapCache;if(!r)return n._selectTilesAutoPrefetchUpsample(e,t);var a=e.getTilesToFetch(),o={},s=a.map(function(){var e=Object(i.a)((function*(e){var n={id:null,level:0,row:0,col:0,extent:Object(d.i)()},i=yield Object(f.c)(r.fetchAvailabilityUpsample(e.level,e.row,e.col,n,{signal:t}));!1===i.ok?Object(l.t)(i.error):o[e.id]=n}));return function(t){return e.apply(this,arguments)}}());yield Object(l.x)(Promise.all(s),t),e.remapTiles(o)}))()}_reduceTilesForMaximumRequests(e){var t=e.layer.tileInfo,n=0,r={},i=e=>{e.id in r?r[e.id]++:(r[e.id]=1,n++)},a=e=>{var t=r[e.id];1===t?(delete r[e.id],n--):r[e.id]=t-1};e.forEachTileToFetch(i,a);for(var o=!0;o&&(o=!1,e.forEachTileToFetch((r=>{n<=e.options.maximumAutoTileRequests||(a(r),t.upsampleTile(r)&&(o=!0),i(r))}),a),o););}_selectTilesAutoFinest(e){var t=D(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}_selectTilesAutoPrefetchUpsample(e,t){var n=this;return Object(i.a)((function*(){var r=e.layer.tileInfo;yield n._populateElevationTiles(e,t);var i=!1;e.forEachTileToFetch(((e,t)=>{r.upsampleTile(e)?i=!0:t()})),i&&(yield n._selectTilesAutoPrefetchUpsample(e,t))}))()}_sampleGeometryWithElevation(e){e.geometry.coordinates.forEach((t=>{var n=t.elevationTile,r=e.options.noDataValue;if(n){var i=n.sample(t.x,t.y);void 0!==i?r=i:t.elevationTile=null}t.z=r}))}_extractSampleInfo(e){var t=e.layer.tileInfo,n=Object(h.f)(t.spatialReference);return e.geometry.coordinates.map((r=>{var i=-1;return r.elevationTile&&r.elevationTile!==e.outsideExtentTile&&(i=t.lodAt(r.elevationTile.tile.level).resolution*n),{demResolution:i}}))}}class q{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){var t=new q;return t.geometry=this.geometry,t.spatialReference=this.spatialReference,t.coordinates=e||this.coordinates.map((e=>this._cloneCoordinate(e))),t._exporter=this._exporter,t}project(e,t){var n=this;return Object(i.a)((function*(){if(n.spatialReference.equals(e))return n.clone();yield Object(p.f)([{source:n.spatialReference,dest:e}],{signal:t});var r=new u.a({spatialReference:n.spatialReference,points:n.coordinates.map((e=>[e.x,e.y]))}),i=Object(p.j)(r,e);if(!i)return null;var a=n.coordinates.map(((e,t)=>{var r=n._cloneCoordinate(e),a=i.points[t];return r.x=a[0],r.y=a[1],r})),o=n.clone(a);return o.spatialReference=e,o}))()}_cloneCoordinate(e){return{x:e.x,y:e.y,z:e.z,m:e.m,tile:null,elevationTile:null}}static fromGeometry(e){var t=new q;if(t.geometry=e,t.spatialReference=e.spatialReference,e instanceof q)t.coordinates=e.coordinates.map((e=>t._cloneCoordinate(e))),t._exporter=(t,n)=>{var r=e.clone(t);return r.spatialReference=n,r};else switch(e.type){case"point":var n=e,{hasZ:r,hasM:i}=n;t.coordinates=r&&i?[{x:n.x,y:n.y,z:n.z,m:n.m}]:r?[{x:n.x,y:n.y,z:n.z}]:i?[{x:n.x,y:n.y,m:n.m}]:[{x:n.x,y:n.y}],t._exporter=(t,n)=>e.hasM?new s.a(t[0].x,t[0].y,t[0].z,t[0].m,n):new s.a(t[0].x,t[0].y,t[0].z,n);break;case"multipoint":var a=e,{hasZ:o,hasM:l}=a;t.coordinates=o&&l?a.points.map((e=>({x:e[0],y:e[1],z:e[2],m:e[3]}))):o?a.points.map((e=>({x:e[0],y:e[1],z:e[2]}))):l?a.points.map((e=>({x:e[0],y:e[1],m:e[2]}))):a.points.map((e=>({x:e[0],y:e[1]}))),t._exporter=(t,n)=>e.hasM?new u.a({points:t.map((e=>[e.x,e.y,e.z,e.m])),hasZ:!0,hasM:!0,spatiaReference:n}):new u.a(t.map((e=>[e.x,e.y,e.z])),n);break;case"polyline":var f=e,h=[],d=[],{hasZ:p,hasM:v}=e,m=0;for(var y of f.paths)if(d.push([m,m+y.length]),m+=y.length,p&&v)for(var x of y)h.push({x:x[0],y:x[1],z:x[2],m:x[3]});else if(p)for(var T of y)h.push({x:T[0],y:T[1],z:T[2]});else if(v)for(var b of y)h.push({x:b[0],y:b[1],m:b[2]});else for(var g of y)h.push({x:g[0],y:g[1]});t.coordinates=h,t._exporter=(t,n)=>{var r=e.hasM?t.map((e=>[e.x,e.y,e.z,e.m])):t.map((e=>[e.x,e.y,e.z])),i=d.map((e=>r.slice(e[0],e[1])));return new c.a({paths:i,hasM:e.hasM,hasZ:!0,spatialReference:n})}}return t}}class E{constructor(e,t){this.layer=e,this.options=t}}class I extends E{constructor(e,t,n){super(e,n),this.outSpatialReference=t,this.type="geometry"}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach((e=>e.tile=null));else{var t=this.layer.tileInfo,n=t.lods[e].level;this.geometry.coordinates.forEach((e=>{e.tile=t.tileAt(n,e.x,e.y)}))}}allElevationTilesFetched(){return!this.geometry.coordinates.some((e=>!e.elevationTile))}clearElevationTiles(){for(var e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(var t of this.geometry.coordinates)!t.elevationTile&&t.tile&&(t.elevationTile=e[t.tile.id])}remapTiles(e){for(var t of this.geometry.coordinates)t.tile=e[t.tile.id]}getTilesToFetch(){var e={},t=[];for(var n of this.geometry.coordinates){var r=n.tile;n.elevationTile||!n.tile||e[r.id]||(e[r.id]=r,t.push(r))}return t}forEachTileToFetch(e){var t=function(t){t.tile&&!t.elevationTile&&e(t.tile,(()=>t.tile=null))};for(var n of this.geometry.coordinates)t(n)}}class A extends E{constructor(e,t,n,r){super(e,n),this.type="extent",this.elevationTiles=[],this.candidateTiles=[],this.fetchedCandidates=new Set,this.extent=t.intersection(e.fullExtent),this.maskExtents=r}selectTilesAtLOD(e,t){var n=this._maximumLodForRequests(t),r=Math.min(n,e);r<0?this.candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(r)}_maximumLodForRequests(e){var t=this.layer.tileInfo;if(!e)return t.lods.length-1;for(var n=this.extent,r=t.lods.length-1;r>=0;r--){var i=t.lods[r],a=i.resolution*t.size[0],o=i.resolution*t.size[1];if(Math.ceil(n.width/a)*Math.ceil(n.height/o)<=e)return r}return-1}allElevationTilesFetched(){return this.candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this.fetchedCandidates.clear()}populateElevationTiles(e){for(var t of this.candidateTiles){var n=e[t.id];n&&(this.fetchedCandidates.add(t),this.elevationTiles.push(n))}}remapTiles(e){this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles.map((t=>e[t.id])))}getTilesToFetch(){return this.candidateTiles}forEachTileToFetch(e,t){var n=this.candidateTiles;this.candidateTiles=[],n.forEach((n=>{if(this.fetchedCandidates.has(n))t&&t(n);else{var r=!1;e(n,(()=>r=!0)),r?t&&t(n):this.candidateTiles.push(n)}})),this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles,t)}_uniqueNonOverlappingTiles(e,t){var n={},r=[];for(var i of e)n[i.id]?t&&t(i):(n[i.id]=i,r.push(i));var a=r.sort(((e,t)=>e.level-t.level));return a.filter(((e,n)=>{for(var r=0;r<n;r++)if(Object(d.d)(a[r].extent,e.extent))return t&&t(e),!1;return!0}))}_selectCandidateTilesCoveringExtentAt(e){this.candidateTiles.length=0;for(var t=this.layer.tileInfo,n=t.lods[e],r=this.extent,i=t.tileAt(n.level,r.xmin,r.ymin),a=n.resolution*t.size[0],o=n.resolution*t.size[1],l=Math.ceil((r.xmax-i.extent[0])/a),s=Math.ceil((r.ymax-i.extent[1])/o),u=0;u<s;u++)for(var c=0;c<l;c++){var f={id:null,level:i.level,row:i.row-u,col:i.col+c};t.updateTileInfo(f),this._tileIsMasked(f)||this.candidateTiles.push(f)}}_tileIsMasked(e){return!!this.maskExtents&&this.maskExtents.some((t=>Object(d.d)(t,e.extent)))}}function D(e,t){var n=e.lods.length-1;if(t>0){var r=e.lods.findIndex((e=>e.resolution<t));0===r?n=0:r>0&&(n=r-1)}return n}var z={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0};t.default=w},184:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return l}));var r=1e-6,i=Math.random,a=Math.PI/180,o=180/Math.PI;function l(e){return e*a}function s(e){return e*o}Object.freeze({__proto__:null,EPSILON:r,RANDOM:i,toRadian:l,toDegree:s,equals:function(e,t){return Math.abs(e-t)<=r*Math.max(1,Math.abs(e),Math.abs(t))}})},201:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return l}));var r=n(94);function i(e,t,n){return Object(r.j)(e.map(((e,r)=>t.apply(n,[e,r]))))}function a(e,t,n){return Object(r.j)(e.map(((e,r)=>t.apply(n,[e,r])))).then((e=>e.map((e=>e.value))))}function o(e){return e.then((e=>({ok:!0,value:e}))).catch((e=>({ok:!1,error:e})))}function l(e){return e.then((e=>({ok:!0,value:e}))).catch((e=>(Object(r.t)(e),{ok:!1,error:e})))}}}]);
//# sourceMappingURL=41.bcb3405e.chunk.js.map