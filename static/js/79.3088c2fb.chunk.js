(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[79,17,21,43],{1178:function(e,t,r){"use strict";r.r(t);var i=r(91),s=r(7),a=r(82),n=(r(80),r(89)),o=(r(81),r(88),r(85)),l=r(84),h=r(83),c=(r(86),r(87),r(99)),u=r(161),d=r(103),f=r(107),p=r(160),m=r(106),_=r(115),g=r(223),v=r(142),y=r(547),x=r(905),b=r(382),O=r(573),w=r(602),S=r(590),j=r(697),M=r(384);class T{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}var E=class extends(Object(M.a)(b.a)){constructor(){super(...arguments),this._handles=new _.a,this._bitmapIndex=new Map,this._mapImageContainer=new j.a,this._kmlVisualData=new T,this.allVisiblePoints=new y.a,this.allVisiblePolylines=new y.a,this.allVisiblePolygons=new y.a,this.allVisibleMapImages=new f.a}hitTest(e,t){if(this.suspended||!this._pointsView&&!this._polylinesView&&!this._polygonsView)return Promise.resolve(null);var r=[this._pointsView.hitTest(e,t),this._polylinesView.hitTest(e,t),this._polygonsView.hitTest(e,t)];return Promise.all(r).then((e=>e.filter((e=>(e&&(e.layer=this.layer,e.sourceLayer=this.layer),!!e)))[0]||null))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._handles.add([this.allVisibleMapImages.on("change",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))}))]),this.container.addChild(this._mapImageContainer),this._polygonsView=new O.a({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new w.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new O.a({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new w.a(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new O.a({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new w.a(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.watch("layer.visibleSublayers",(e=>{for(var[t,r]of this._kmlVisualData.allSublayers)r.visibility=0;for(var i of e){var s=this._kmlVisualData.allSublayers.get(i.id);s&&(s.visibility=1)}this._refreshCollections()})),this._fetchingPromise=this._fetchService().then((()=>{this._fetchingPromise=null,this.notifyChange("updating")}))}detach(){this._handles.removeAll(),this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return null!=this._fetchingPromise||this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&Object(m.default)(e.href,{responseType:"image"}).then((({data:t})=>{var r=d.a.fromJSON(e.extent);Object(u.a)(r,this.view.spatialReference)&&(r=Object(u.d)(r,this.view.spatialReference));var i=new S.a(t,"standard");i.x=r.xmin,i.y=r.ymax,i.resolution=r.width/t.naturalWidth,i.rotation=e.rotation,this._mapImageContainer.addChild(i),this._bitmapIndex.set(e,i)}))}_getViewDependentUrl(e,t){return Object(s.a)((function*(){var{viewFormat:r,viewBoundScale:s,httpQuery:a}=e;if(Object(n.k)(r)){if(Object(n.j)(t))throw new Error("Loading this network link requires a view state.");var o;if(yield Object(g.i)(),Object(n.k)(s)&&1!==s){var l=new d.a(t.extent);l.expand(s),o=l}else o=t.extent;o=Object(g.j)(o,c.a.WGS84);var u=Object(g.j)(o,c.a.WebMercator),f=o.xmin,m=o.xmax,_=o.ymin,y=o.ymax,x=t.size[0]*t.pixelRatio,b=t.size[1]*t.pixelRatio,O=Math.max(u.width,u.height),w={"[bboxWest]":f.toString(),"[bboxEast]":m.toString(),"[bboxSouth]":_.toString(),"[bboxNorth]":y.toString(),"[lookatLon]":o.center.x.toString(),"[lookatLat]":o.center.y.toString(),"[lookatRange]":O.toString(),"[lookatTilt]":"0","[lookatHeading]":t.rotation.toString(),"[lookatTerrainLon]":o.center.x.toString(),"[lookatTerrainLat]":o.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":o.center.x.toString(),"[cameraLat]":o.center.y.toString(),"[cameraAlt]":O.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":x.toString(),"[vertPixels]":b.toString(),"[terrainEnabled]":"0","[clientVersion]":p.d,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},S=e=>{for(var t in e)for(var r in w)e[t]=e[t].replace(r,w[r])},j=Object(h.E)(r);S(j);var M={};Object(n.k)(a)&&S(M=Object(h.E)(a));var T=Object(v.c)(e.href);return T.query=Object(i.a)(Object(i.a)(Object(i.a)({},T.query),j),M),"".concat(T.path,"?").concat(Object(h.D)(j))}return e.href}))()}_fetchService(){var e=this;return Object(s.a)((function*(){var t=new T;yield e._loadVisualData(e.layer.url,t),e._kmlVisualData=t,e._refreshCollections()}))()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e)))}_isSublayerVisible(e){var t=this._kmlVisualData.allSublayers.get(e);return!!t.visibility&&(-1===t.parentFolderId||this._isSublayerVisible(t.parentFolderId))}_loadVisualData(e,t){var r=this;return this._fetchParsedKML(e).then(function(){var e=Object(s.a)((function*(e){var i=function*(e){t.allSublayers.set(e.id,e);var i=e.points?yield Object(x.c)(e.points):[],s=e.polylines?yield Object(x.c)(e.polylines):[],a=e.polygons?yield Object(x.c)(e.polygons):[],n=e.mapImages||[];if(t.allPoints.push(...i.map((t=>({item:t,sublayerId:e.id})))),t.allPolylines.push(...s.map((t=>({item:t,sublayerId:e.id})))),t.allPolygons.push(...a.map((t=>({item:t,sublayerId:e.id})))),t.allMapImages.push(...n.map((t=>({item:t,sublayerId:e.id})))),e.networkLink){var o=yield r._getViewDependentUrl(e.networkLink,r.view.state);yield r._loadVisualData(o,t)}};for(var s of e.sublayers)yield*i(s)}));return function(t){return e.apply(this,arguments)}}())}_fetchParsedKML(e){return Object(x.b)(e,this.view.spatialReference,this.layer.refreshInterval).then((e=>Object(x.d)(e.data)))}_removeMapImage(e){var t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))}};Object(a.a)([Object(o.b)()],E.prototype,"_pointsView",void 0),Object(a.a)([Object(o.b)()],E.prototype,"_polylinesView",void 0),Object(a.a)([Object(o.b)()],E.prototype,"_polygonsView",void 0),Object(a.a)([Object(o.b)()],E.prototype,"_fetchingPromise",void 0),Object(a.a)([Object(o.b)()],E.prototype,"updating",void 0);var C=E=Object(a.a)([Object(l.a)("esri.views.2d.layers.KMLLayerView2D")],E);t.default=C},153:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return v})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return u})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return _})),r.d(t,"g",(function(){return m})),r.d(t,"h",(function(){return d})),r.d(t,"i",(function(){return f})),r.d(t,"j",(function(){return g}));var i=r(92),s=r(100),a=r(284);function n(e){var t,r=Object(i.a)(e);return(t=r)&&(Object(s.g)(t)?c(t.rings):Object(s.h)(t)?c(t.paths):Object(s.e)(t)&&h(t.points)),r}function o(e){if(e)for(var t=e.length-1;t>0;--t)e[t][0]-=e[t-1][0],e[t][1]-=e[t-1][1]}function l(e){if(e)for(var t of e)o(t)}function h(e){if(e)for(var t=e.length,r=1;r<t;++r)e[r][0]+=e[r-1][0],e[r][1]+=e[r-1][1]}function c(e){if(e)for(var t of e)h(t)}function u(e){e&&(Object(s.g)(e)?l(e.rings):Object(s.h)(e)?l(e.paths):Object(s.e)(e)&&o(e.points))}function d(e){if(e)for(var t of e)f(t)}function f(e){e&&e.reverse()}function p(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}function m(e){return!(!e||0===e.length)&&e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function _(e){return e[4]}function g(e,t){e[4]=t}class v{constructor(e,t,r,i){this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=i,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1,e&&(Object(s.g)(e)?t&&(this.multiPath=e.rings,this.isClosed=!0):Object(s.h)(e)?r&&(this.multiPath=e.paths,this.isClosed=!1):Object(s.d)(e)&&t&&(this.multiPath=x(e).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length)),this.internalPlacement=new a.a}next(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var e=this.processPath(this.multiPath[this.pathIndex]);if(e)return e}return this.pathCount=-1,this.pathIndex=-1,this.multiPath=null,null}}class y{constructor(e,t,r,i){this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=i,this.pathCount=-1,this.pathIndex=-1,this.iteratePath=!1}next(){for(;;){if(!this.multiPath){for(var e=this.inputGeometries.next();e;){if(Object(s.g)(e)?this.acceptPolygon&&(this.multiPath=e.rings,this.isClosed=!0):Object(s.h)(e)?this.acceptPolyline&&(this.multiPath=e.paths,this.isClosed=!1):Object(s.d)(e)&&this.acceptPolygon&&(this.multiPath=x(e).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length,this.pathIndex=-1;break}e=this.inputGeometries.next()}if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var t=this.processPath(this.multiPath[this.pathIndex]);if(t)return t}this.pathCount=-1,this.pathIndex=-1,this.multiPath=null}}}function x(e){return{rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}}},232:function(e,t,r){"use strict";function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t){return Math.sqrt(e*e+t*t)}function a(e){var t=s(e[0],e[1]);e[0]/=t,e[1]/=t}function n(e,t){return s(e[0]-t[0],e[1]-t[1])}function o(e){return"function"==typeof e}function l(e){return 1/Math.max(e,1)}r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return i}))},279:function(e,t,r){"use strict";r.d(t,"a",(function(){return T})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return _})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return O})),r.d(t,"f",(function(){return M})),r.d(t,"g",(function(){return n})),r.d(t,"h",(function(){return l})),r.d(t,"i",(function(){return h})),r.d(t,"j",(function(){return o})),r.d(t,"k",(function(){return w})),r.d(t,"l",(function(){return a})),r.d(t,"m",(function(){return v})),r.d(t,"n",(function(){return j})),r.d(t,"o",(function(){return m})),r.d(t,"p",(function(){return g})),r.d(t,"q",(function(){return b})),r.d(t,"r",(function(){return x})),r.d(t,"s",(function(){return y})),r.d(t,"t",(function(){return p}));var i=r(89);r(103),r(125);function s(e=E){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function a(e,t,r,i,a,n,o=s()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o[4]=a,o[5]=n,o}function n(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function o(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function l(e,t,r=0,i=t.length/3){for(var s=e[0],a=e[1],n=e[2],o=e[3],l=e[4],h=e[5],c=0;c<i;c++)s=Math.min(s,t[r+3*c]),a=Math.min(a,t[r+3*c+1]),n=Math.min(n,t[r+3*c+2]),o=Math.max(o,t[r+3*c]),l=Math.max(l,t[r+3*c+1]),h=Math.max(h,t[r+3*c+2]);e[0]=s,e[1]=a,e[2]=n,e[3]=o,e[4]=l,e[5]=h}function h(e,t,r){var i=t.length,s=e[0],a=e[1],n=e[2],o=e[3],l=e[4],h=e[5];if(r)for(var c=0;c<i;c++){var u=t[c];s=Math.min(s,u[0]),a=Math.min(a,u[1]),n=Math.min(n,u[2]),o=Math.max(o,u[0]),l=Math.max(l,u[1]),h=Math.max(h,u[2])}else for(var d=0;d<i;d++){var f=t[d];s=Math.min(s,f[0]),a=Math.min(a,f[1]),o=Math.max(o,f[0]),l=Math.max(l,f[1])}e[0]=s,e[1]=a,e[2]=n,e[3]=o,e[4]=l,e[5]=h}function c(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function d(e){return e[2]>=e[5]?0:e[5]-e[2]}function f(e,t=[0,0,0]){return t[0]=e[0]+c(e)/2,t[1]=e[1]+u(e)/2,t[2]=e[2]+d(e)/2,t}function p(e,t=[0,0,0]){return t[0]=c(e),t[1]=u(e),t[2]=d(e),t}function m(e){return Math.max(c(e),d(e),u(e))}function _(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function g(e,t,r=e){var i=e[0]+c(e)/2,s=e[1]+u(e)/2,a=e[2]+d(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=s+(e[1]-s)*t,r[2]=a+(e[2]-a)*t,r[3]=i+(e[3]-i)*t,r[4]=s+(e[4]-s)*t,r[5]=a+(e[5]-a)*t,r}function v(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function y(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r}function x(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function O(e){return e?b(e,T):s(T)}function w(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function S(e){return 6===e.length}function j(e){return 0===c(e)&&0===u(e)&&0===d(e)}function M(e,t,r){if(Object(i.j)(e)||Object(i.j)(t))return e===t;if(!S(e)||!S(t))return!1;if(r){for(var s=0;s<e.length;s++)if(!r(e[s],t[s]))return!1}else for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var T=[1/0,1/0,1/0,-1/0,-1/0,-1/0],E=[0,0,0,0,0,0];s()},284:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rz_c&&0!==this.rz_s)&&(this.rz=Math.atan2(this.rz_s,this.rz_c)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rz_c=1,this.rz_s=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rz_c=e,this.rz_s=t}setRotate(e){this.rz=e,this.rz_c=void 0,this.rz_s=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}}},285:function(e,t,r){"use strict";var i,s;function a(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":case"justify":return i.Center}}function n(e){switch(e){case"top":return s.Top;case"middle":return s.Center;case"baseline":return s.Baseline;case"bottom":return s.Bottom}}function o(e){switch(e){case"above-left":return[i.Right,s.Bottom];case"above-center":case"above-along":return[i.Center,s.Bottom];case"above-right":return[i.Left,s.Bottom];case"center-left":return[i.Right,s.Center];case"center-center":case"center-along":return[i.Center,s.Center];case"center-right":return[i.Left,s.Center];case"below-left":return[i.Right,s.Top];case"below-center":case"below-along":return[i.Center,s.Top];case"below-right":return[i.Left,s.Top];case"always-horizontal":return[i.Center,s.Baseline];default:return console.debug("Found invalid placement type ".concat(e)),[i.Center,s.Center]}}function l(e){switch(e){case i.Right:return-1;case i.Center:return 0;case i.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}function h(e){switch(e){case s.Top:return 1;case s.Center:return 0;case s.Bottom:case s.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}function c(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":case"justify":return i.Center}}r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return o})),r.d(t,"c",(function(){return c})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return n})),r.d(t,"g",(function(){return h})),function(e){e[e.Left=-1]="Left",e[e.Center=0]="Center",e[e.Right=1]="Right"}(i||(i={})),function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(s||(s={}))},287:function(e,t,r){"use strict";var i=r(89),s=r(153),a=r(445),n=r(369);class o{static executeEffects(e,t){var r=Object(s.c)(t),i=new a.a(r);for(var o of e){var l=Object(n.a)(o);l&&(i=l.execute(i,o,1.3333333333333333))}return i}static next(e){var t=e.next();return Object(s.d)(t),t}}t.a=class{bindFeature(e,t,r){}write(e,t){if(Object(i.j)(this._effects))return this._write(e,t);for(var r=o.executeEffects(this._effects,t.readLegacyGeometry()),s=o.next(r);s;)this._write(e,t,s),s=o.next(r)}_write(e,t,r){}}},311:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return _})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return x})),r.d(t,"e",(function(){return b})),r.d(t,"f",(function(){return O})),r.d(t,"g",(function(){return w}));var i=r(100);var s=(e,t,r)=>[t,r],a=(e,t,r)=>[t,r,e[2]],n=(e,t,r)=>[t,r,e[2],e[3]];function o(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function h({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function c(e,t,r){for(var i,s,a,n,o=[],c=0;c<r.length;c++){var u=r[c];c>0?(a=l(e,u[0]),n=h(e,u[1]),a===i&&n===s||(o.push(t(u,a-i,n-s)),i=a,s=n)):(i=l(e,u[0]),s=h(e,u[1]),o.push(t(u,i,s)))}return o.length>0?o:null}function u({scale:e,translate:t},r){return r*e[0]+t[0]}function d({scale:e,translate:t},r){return t[1]-r*e[1]}function f(e,t,r){var i=new Array(r.length);if(!r.length)return i;var[s,a]=e.scale,n=u(e,r[0][0]),o=d(e,r[0][1]);i[0]=t(r[0],n,o);for(var l=1;l<r.length;l++){var h=r[l];n+=h[0]*s,o-=h[1]*a,i[l]=t(h,n,o)}return i}function p(e,t,r){for(var i=new Array(r.length),s=0;s<r.length;s++)i[s]=f(e,t,r[s]);return i}function m(e,t,r,i,o){return t.points=function(e,t,r,i){return c(e,r?i?n:a:i?a:s,t)}(e,r.points,i,o),t}function _(e,t,r,i,s){return t.x=l(e,r.x),t.y=h(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function g(e,t,r,i,o){var l=function(e,t,r,i){for(var o=[],l=r?i?n:a:i?a:s,h=0;h<t.length;h++){var u=c(e,l,t[h]);u&&u.length>=3&&o.push(u)}return o.length?o:null}(e,r.rings,i,o);return l?(t.rings=l,t):null}function v(e,t,r,i,o){var l=function(e,t,r,i){for(var o=[],l=r?i?n:a:i?a:s,h=0;h<t.length;h++){var u=c(e,l,t[h]);u&&u.length>=2&&o.push(u)}return o.length?o:null}(e,r.paths,i,o);return l?(t.paths=l,t):null}function y(e,t){return e&&t?Object(i.f)(t)?_(e,{},t,!1,!1):Object(i.h)(t)?v(e,{},t,!1,!1):Object(i.g)(t)?g(e,{},t,!1,!1):Object(i.e)(t)?m(e,{},t,!1,!1):Object(i.d)(t)?(n=!1,o=!1,(s={}).xmin=l(r=e,(a=t).xmin),s.ymin=h(r,a.ymin),s.xmax=l(r,a.xmax),s.ymax=h(r,a.ymax),s!==a&&(n&&(s.zmin=a.zmin,s.zmax=a.zmax),o&&(s.mmin=a.mmin,s.mmax=a.mmax)),s):null:null;var r,s,a,n,o}function x(e,t,r,i,o){return t.points=function(e,t,r,i){return f(e,r?i?n:a:i?a:s,t)}(e,r.points,i,o),t}function b(e,t,r,i,s){return t.x=u(e,r.x),t.y=d(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function O(e,t,r,i,o){return t.rings=function(e,t,r,i){return p(e,r?i?n:a:i?a:s,t)}(e,r.rings,i,o),t}function w(e,t,r,i,o){return t.paths=function(e,t,r,i){return p(e,r?i?n:a:i?a:s,t)}(e,r.paths,i,o),t}},319:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(93);function s(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new i.a(r.name,r.message,r.details)),!1}return!0}},337:function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return M})),r.d(t,"d",(function(){return F})),r.d(t,"e",(function(){return D})),r.d(t,"f",(function(){return V})),r.d(t,"g",(function(){return B})),r.d(t,"h",(function(){return C})),r.d(t,"i",(function(){return j})),r.d(t,"j",(function(){return E})),r.d(t,"k",(function(){return z})),r.d(t,"l",(function(){return T}));r(80);var i=r(89),s=r(112),a=r(210),n=r(100),o=r(105),l=r(125),h=r(243),c=r(236),u=r(135),d=r(321),f=r(290),p=r(238),m=r(285),_=r(454),g=r(365),v=r(352),y=Math.PI/180,x=.04,b=Object(f.a)(),O=Object(p.a)(),w=512,S=50;function j(e,t){if(!t.isWrappable)return null;var[r,i]=Object(h.c)(t);return e[2]>i?[Object(l.i)([e[0],e[1],i,e[3]]),Object(l.i)([r,e[1],r+e[2]-i,e[3]])]:e[0]<r?[Object(l.i)([r,e[1],e[2],e[3]]),Object(l.i)([i-(r-e[0]),e[1],i,e[3]])]:null}function M(e,t,r,i,o,l,h){if(!i||!r.symbol)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var u=i;if(!Object(n.f)(u)){Object(a.a)(e,u);var d=t[0];0===d&&(d=G(r),t[0]=d);var f=o*d/2;return e[0]-=f,e[1]-=f,e[2]+=f,e[3]+=f,e}var p=u.x,m=u.y;return"esriTS"===r.symbol.type&&0===t[2]&&0===t[3]&&B(t,r.symbol,r.mosaicItem),function(e,t,r,i,a,n,o,l){var h;switch(i.type){case"esriSMS":case"esriPMS":h=D(t,r,i,n,o,0);break;case"esriTS":h=V(t,r,i,a,n,0);break;case"cim":case"CIMSymbolReference":case"expanded-cim":h=F(t,r,i,n,o,0)}for(var u,d,f=0,p=0;p<h.rings[0].length-1;p++)u=(t-(d=h.rings[0][p])[0])*(t-d[0])+(r-d[1])*(r-d[1]),f=Math.max(f,u);f=Math.sqrt(f);var m=Object(c.b)(t-f,l),_=Object(c.b)(t+f,l);if(m>_){var g=Object(s.d)(l);if(g){var[v,y]=g.valid;m=v,_=y}}e[0]=m,e[1]=r-f,e[2]=_,e[3]=r+f}(e,p,m,r.symbol,t,o,l,h),e}function T(e){return"text"===e||"esriTS"===e}function E(e){return"simple-marker"===e||"picture-marker"===e||"esriSMS"===e||"esriPMS"===e}function C(e){switch(Object(i.q)(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}var I=Object(p.a)(),P=Object(p.a)(),L=Object(p.a)(),k=Object(p.a)(),R=Object(p.a)(),N=Object(p.a)(),A=Object(p.a)();function z(e,t,r,i){Object(u.r)(L,t,r);for(var s,a,n,o,l,h,c,d,f,p=e.paths,m=1/0,_=0;_<p.length;_++){var g=p[_];if(!(g.length<2))for(var v=1;v<g.length;v++)s=g[v-1][0],n=g[v-1][1],a=g[v][0],o=g[v][1],l=Math.min(s,a)-i,h=Math.min(n,o)-i,c=Math.max(s,a)+i,d=Math.max(n,o)+i,t<l||t>c||r<h||r>d||(Object(u.r)(I,s,n),Object(u.r)(P,a,o),Object(u.d)(k,P,I),Object(u.d)(R,I,L),Object(u.a)(N,k,Object(u.g)(k,R)/Object(u.g)(k,k)),Object(u.d)(A,R,N),m>(f=Object(u.g)(A,A))&&(m=f))}return Math.sqrt(m)<=i}function D(e,t,r,i,s,a){var n,l,h=Object(o.h)(r.xoffset),c=Object(o.h)(r.yoffset),f=y*r.angle,p=y*a;switch(r.type){case"esriSMS":n=l=Object(o.h)(r.size);break;case"esriPMS":n=Object(o.h)(r.width),l=Object(o.h)(r.height)}s<x&&(i=x*i/s);var m=Object(d.d)(b);Object(d.h)(m,m,Object(u.r)(O,e,t)),Object(d.f)(m,m,p-f),Object(d.g)(m,m,Object(u.r)(O,i,-i)),Object(d.h)(m,m,Object(u.r)(O,h,-c));var _=[0,0];Object(u.s)(_,Object(u.r)(O,-.5*n,-.5*l),m);var g=[0,0];Object(u.s)(g,Object(u.r)(O,-.5*n,.5*l),m);var v=[0,0];Object(u.s)(v,Object(u.r)(O,.5*n,-.5*l),m);var w=[0,0];return Object(u.s)(w,Object(u.r)(O,.5*n,.5*l),m),{rings:[[_,v,w,g,_]]}}function F(e,t,r,i,s,a){var n=v.a.getEnvelope(r.data);if(!n)return null;s<x&&(i=x*i/s);var l=Object(o.h)(n.width),h=Object(o.h)(n.height),c=Object(o.h)(n.x),f=Object(o.h)(n.y),p=0*y,m=y*a,_=Object(d.d)(b);Object(d.h)(_,_,Object(u.r)(O,e,t)),Object(d.f)(_,_,m-p),Object(d.g)(_,_,Object(u.r)(O,i,i));var g=[0,0];Object(u.s)(g,Object(u.r)(O,c,f+h),_);var w=[0,0];Object(u.s)(w,Object(u.r)(O,c,f),_);var S=[0,0];Object(u.s)(S,Object(u.r)(O,c+l,f+h),_);var j=[0,0];return Object(u.s)(j,Object(u.r)(O,c+l,f),_),{rings:[[g,S,j,w,g]]}}function V(e,t,r,i,s,a){var n=Object(o.h)(r.xoffset),l=Object(o.h)(r.yoffset),h=y*r.angle,c=y*a,f=Object(d.d)(b);Object(d.h)(f,f,Object(u.r)(O,e,t)),Object(d.f)(f,f,c),Object(d.g)(f,f,Object(u.r)(O,s,-s));var p=i[0]+i[2]/2,m=i[1]+i[3]/2;Object(d.h)(f,f,Object(u.r)(O,n,-l)),Object(d.h)(f,f,Object(u.r)(O,p,m)),Object(d.f)(f,f,h),Object(d.h)(f,f,Object(u.r)(O,-p,-m));var _=[0,0];Object(u.s)(_,Object(u.r)(O,i[0],i[1]),f);var g=[0,0];Object(u.s)(g,Object(u.r)(O,i[0],i[1]+i[3]),f);var v=[0,0];Object(u.s)(v,Object(u.r)(O,i[0]+i[2],i[1]),f);var x=[0,0];return Object(u.s)(x,Object(u.r)(O,i[0]+i[2],i[1]+i[3]),f),{rings:[[_,v,x,g,_]]}}function G(e){switch(e.symbol.type){case"esriSFS":case"esriPFS":var t=e.symbol.outline;return t?t.width:0;case"esriSLS":return Object(o.h)(e.symbol.width);case"esriSMS":return Object(o.h)(e.symbol.size);case"esriPMS":return Object(o.h)(Math.max(e.symbol.width,e.symbol.height));case"esriTS":var r=[0,0,0,0];B(r,e.symbol,e.mosaicItem);var i=Math.max(Math.abs(r[0]),Math.abs(r[1]));return Math.max(r[2],r[3])+i;case"expanded-cim":var s=v.a.getEnvelope(e.symbol.data);return s.width!==-1/0&&s.height!==-1/0||(s.width=10,s.height=10,s.x=0,s.y=0),Object(o.h)(Math.sqrt(s.width*s.width+s.height*s.height));case"composite-symbol":if(!e.symbol.layers.length)return 0;var a=e.symbol.layers.length-1;return G({symbol:e.symbol.layers[a],mosaicItem:null});case"label":default:return 0}}function B(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var i=Object(g.a)(t.text)[1],s=r.glyphMosaicItems,a=Object(_.a)(s,i,{scale:Object(o.h)(t.font.size)/24,angle:t.angle,xOffset:t.xoffset,yOffset:t.yoffset,hAlign:Object(m.d)(t.horizontalAlignment||"center"),vAlign:Object(m.f)(t.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(t.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(t.lineHeight||1,4)),decoration:t.font.decoration||"none",isCIM:!1}).bounds;return e[0]=Object(o.h)(a.x-a.halfWidth),e[1]=Object(o.h)(a.y-a.halfHeight),e[2]=Object(o.h)(a.width),e[3]=Object(o.h)(a.height),e}},350:function(e,t,r){"use strict";t.a=class{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},352:function(e,t,r){"use strict";r.d(t,"a",(function(){return j})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return M}));var i=r(91),s=r(81),a=r(110),n=r(109),o=r(284),l=r(210),h=r(100),c=r(125),u=r(445),d=r(369),f=r(350),p=Math.PI/180,m=s.a.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class _{constructor(e){this._t=e}static createIdentity(){return new _([1,0,0,0,1,0])}clone(){var e=this._t;return new _(e.slice())}transform(e){var t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new _([e,0,0,0,t,0])}scale(e,t){var r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new _([0,0,e,0,0,t])}translate(e,t){var r=this._t;return r[2]+=e,r[5]+=t,this}static createRotate(e){var t=Math.cos(e),r=Math.sin(e);return new _([t,-r,0,r,t,0])}rotate(e){return this.multiply(_.createRotate(e))}multiply(e){var t=this._t,r=e._t,i=t[0]*r[0]+t[3]*r[1],s=t[1]*r[0]+t[4]*r[1],a=t[2]*r[0]+t[5]*r[1]+r[2],n=t[0]*r[3]+t[3]*r[4],o=t[1]*r[3]+t[4]*r[4],l=t[2]*r[3]+t[5]*r[4]+r[5];return t[0]=i,t[1]=s,t[2]=a,t[3]=n,t[4]=o,t[5]=l,this}}class g{constructor(e){this._transfos=[],this._sizeTransfos=[],this._transfos.push(e||_.createIdentity()),this._sizeTransfos.push(e?e.scaleRatio():1)}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}back(){return this._transfos[this._transfos.length-1]}push(e,t){var r=t?e.scaleRatio():1;e.multiply(this.back()),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t)}}drawMultiLayerSymbol(e,t){if(e){var r=e.symbolLayers;if(r){var i=e.effects;if(i){var s=this.executeEffects(i,t);if(s)for(var a=s.next();a;)this.drawSymbolLayers(r,a),a=s.next()}else this.drawSymbolLayers(r,t)}}}executeEffects(e,t){var r=new u.a(t);for(var i of e){var s=Object(d.a)(i);s&&(r=s.execute(r,i,1))}return r}drawSymbolLayers(e,t){for(var r=e.length;r--;){var i=e[r];if(i&&!1!==i.enable){var s=i.effects;if(s){var a=this.executeEffects(s,t);if(a)for(var n=a.next();n;)this.drawSymbolLayer(i,n),n=a.next()}else this.drawSymbolLayer(i,t)}}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color);break;case"CIMHatchFill":this.drawHatchFill(e,t);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){var r=this._buildHatchPolyline(e,t,1);r&&(this.pushClipPath(t),this.drawMultiLayerSymbol(e.lineSymbol,r),this.popClipPath())}drawMarkerLayer(e,t){var r=e.markerPlacement;if(r){var i=Object(d.b)(r);if(i){var s="CIMMarkerPlacementInsidePolygon"===r.type;s&&this.pushClipPath(t);var a=i.execute(t,r,1);if(a)for(var n=a.next();n;)this.drawMarker(e,n),n=a.next();s&&this.popClipPath()}}else{var l=new o.a;l.tx=t.x,l.ty=t.y,this.drawMarker(e,l)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(e){var r=e.size||10,i=_.createIdentity(),s=e.anchorPoint;if(s){var a=s.x,n=s.y;"Absolute"!==e.anchorPointUnits&&(a*=r,n*=r),i.translate(-a,-n)}e.rotation&&i.rotate(e.rotation*p),i.translate(e.offsetX||0,e.offsetY||0),i.translate(t.tx,t.ty),this.push(i,!1),this.drawImage(e.url,r,e.scaleX),this.pop()}}drawVectorMarker(e,t){if(e){var r=e.markerGraphics;if(r){var i=e.size,s=e.frame,a=s?s.ymax-s.ymin:0,n=i&&a?i/a:1,o=_.createIdentity();s&&o.translate(.5*-(s.xmax+s.xmin),.5*-(s.ymax+s.ymin));var l=e.anchorPoint;if(l){var h=l.x,c=l.y;"Absolute"!==e.anchorPointUnits&&s&&(h*=s.xmax-s.xmin,c*=s.ymax-s.ymin),o.translate(-h,-c)}for(var u of(1!==n&&o.scale(n,n),e.rotation&&o.rotate(e.rotation*p),o.translate(e.offsetX||0,e.offsetY||0),o.translate(t.tx,t.ty),this.push(o,e.scaleSymbolsProportionally),r))u&&u.symbol&&u.geometry||m.error("Invalid marker graphic",u),this.drawSymbol(u.symbol,u.geometry);this.pop()}}}_buildHatchPolyline(e,t,r){var i=(void 0!==e.separation?e.separation:4)*r,s=void 0!==e.rotation?e.rotation:0;if(0===i)return null;i<0&&(i=-i);for(var a=0,n=.5*i;a>n;)a-=i;for(;a<-n;)a+=i;var o=Object(c.i)();Object(l.a)(o,t),o[0]-=n,o[1]-=n,o[2]+=n,o[3]+=n;for(var h=[[o[0],o[1]],[o[0],o[3]],[o[2],o[3]],[o[2],o[1]]];s>180;)s-=180;for(;s<0;)s+=180;var u,d,f,m,_=Math.cos(s*p),g=Math.sin(s*p),v=-i*g,y=i*_;for(var x of(a=(void 0!==e.offsetX?e.offsetX*r:0)*g-(void 0!==e.offsetY?e.offsetY*r:0)*_,u=f=Number.MAX_VALUE,d=m=-Number.MAX_VALUE,h)){var b=x[0],O=x[1],w=_*b+g*O,S=-g*b+_*O;u=Math.min(u,w),f=Math.min(f,S),d=Math.max(d,w),m=Math.max(m,S)}for(var j=_*u-g*(f=Math.floor(f/i)*i)-v*a/i,M=g*u+_*f-y*a/i,T=_*d-g*f-v*a/i,E=g*d+_*f-y*a/i,C=1+Math.round((m-f)/i),I=[],P=0;P<C;P++)j+=v,M+=y,T+=v,E+=y,I.push([[j,M],[T,E]]);return{paths:I}}}class v extends g{constructor(){super(),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new f.a(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}drawSolidFill(e){!e||this._clipCount>0||(Object(h.g)(e)?this._processPath(e.rings,0):Object(h.h)(e)&&this._processPath(e.paths,0))}drawSolidStroke(e,t,r){if(e&&!(this._clipCount>0)){var i=.5*this.transformSize(r);Object(h.g)(e)?this._processPath(e.rings,i):Object(h.h)(e)&&this._processPath(e.paths,i)}}pushClipPath(e){this.drawSolidFill(e),++this._clipCount}popClipPath(){--this._clipCount}drawImage(e,t,r){var i=t/2;this._merge(this.transformPt([0,0]),i)}_processPath(e,t){if(e)for(var r of e){var i=r?r.length:0;if(i>1){this._merge(this.transformPt(r[0]),t);for(var s=1;s<i;++s)this._merge(this.transformPt(r[s]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}}class y extends g{constructor(e,t){super(t),this._ctx=e}drawSolidFill(e,t){if(e){if(Object(h.g)(e))this._buildPath(e.rings,!0);else{if(!Object(h.h)(e))return;this._buildPath(e.paths,!0)}var r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",r.fill("evenodd")}}drawSolidStroke(e,t,r,i,s,a){if(e&&t&&0!==r){if(Object(h.g)(e))this._buildPath(e.rings,!0);else{if(!Object(h.h)(e))return;this._buildPath(e.paths,!1)}var n=this._ctx;n.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+t[3]/255+")",n.lineWidth=this.transformSize(r)+.5,this._setCapStyle(i),this._setJoinStyle(s),n.miterLimit=a,n.stroke()}}pushClipPath(e){this._ctx.save(),Object(h.g)(e)?this._buildPath(e.rings,!0):Object(h.h)(e)&&this._buildPath(e.paths,!0),this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t,r){}_buildPath(e,t){var r=this._ctx;if(r.beginPath(),e)for(var i of e){var s=i?i.length:0;if(s>1){var a=this.transformPt(i[0]);r.moveTo(a[0],a[1]);for(var n=1;n<s;++n)a=this.transformPt(i[n]),r.lineTo(a[0],a[1]);t&&r.closePath()}}}_setCapStyle(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}}var x=r(427),b=Math.PI,O=b/2,w=s.a.getLogger("esri.symbols.cim.CIMSymbolHelper");function S(e,t){switch(t.type){case"CIMSymbolReference":e.drawSymbol(t.symbol,{type:"point",x:0,y:0});break;case"CIMPointSymbol":e.drawSymbol(t,{type:"point",x:0,y:0});break;case"CIMTextSymbol":break;case"CIMVectorMarker":var r=new o.a;e.drawMarker(t,r)}return e.envelope()}class j{static getEnvelope(e){var t=new v;if(Array.isArray(e)){var r;for(var i of e)r?r.union(S(t,i)):r=S(t,i);return r}return S(t,e)}static getTextureAnchor(e){var t=this.getEnvelope(e);if(!t||t.width<=0||t.height<=0)return[0,0,0];var r=96/72,i=(t.x+.5*t.width)*r,s=-(t.y+.5*t.height)*r,a=t.width*r+2,n=t.height*r+2;return[i/a,s/n,n]}static rasterize(e,t,r,i=!0){var s=r||this.getEnvelope(t);if(!s||s.width<=0||s.height<=0)return[null,0,0,0,0];var a=96/72,n=(s.x+.5*s.width)*a,l=(s.y+.5*s.height)*a;e.width=s.width*a,e.height=s.height*a,r||(e.width+=2,e.height+=2);var h=e.getContext("2d"),c=_.createScale(a,-a);c.translate(.5*e.width-n,.5*e.height+l);var u=new y(h,c);switch(t.type){case"CIMPointSymbol":u.drawSymbol(t,{type:"point",x:0,y:0});break;case"CIMVectorMarker":var d=new o.a;u.drawMarker(t,d)}var f=h.getImageData(0,0,e.width,e.height),p=new Uint8Array(f.data);if(i)for(var m,g=0;g<p.length;g+=4)m=p[g+3]/255,p[g]=p[g]*m,p[g+1]=p[g+1]*m,p[g+2]=p[g+2]*m;return[p,e.width,e.height,-n/e.width,-l/e.height]}static fromSimpleMarker(e){var t,r,i,s=50,a=e.style;if("circle"===a||"esriSMSCircle"===a){var n=Math.acos(.995),o=Math.ceil(b/n/4);0===o&&(o=1),n=O/o,o*=4;var l=[];l.push([s,0]);for(var h=1;h<o;h++)l.push([s*Math.cos(h*n),-s*Math.sin(h*n)]);l.push([s,0]),t={rings:[l]},r={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("cross"===a||"esriSMSCross"===a){t={rings:[[[0,s],[0,0],[s,0],[s,-0],[0,-0],[0,-s],[-0,-s],[-0,-0],[-s,-0],[-s,0],[-0,0],[-0,s],[0,s]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("diamond"===a||"esriSMSDiamond"===a)t={rings:[[[-s,0],[0,s],[s,0],[0,-s],[-s,0]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("square"===a||"esriSMSSquare"===a)t={rings:[[[-s,-s],[-s,s],[s,s],[s,-s],[-s,-s]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("x"===a||"esriSMSX"===a){t={rings:[[[0,0],[50,s],[s,50],[0,0],[s,-50],[50,-s],[0,-0],[-50,-s],[-s,-50],[-0,0],[-s,50],[-50,s],[0,0]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("triangle"===a||"esriSMSTriangle"===a){var c=57.735026918962575,u=-c,d=2/3*100,f=d-100;t={rings:[[[u,f],[0,d],[c,f],[u,f]]]},r={xmin:u,ymin:f,xmax:c,ymax:d}}else"arrow"!==a&&"esriSMSArrow"!==a||(t={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s});if(t&&r){var p=[{type:"CIMSolidFill",enable:!0,color:e.color}];e.outline&&p.push({type:"CIMSolidStroke",enable:!0,width:e.outline.width,color:e.outline.color});var m={type:"CIMPolygonSymbol",symbolLayers:p};i={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:e.angle,size:e.size,offsetX:e.xoffset,offsetY:e.yoffset,frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t,symbol:m}]}]}}return i}static fromCIMHatchFill(e){for(var t=void 0!==e.separation?e.separation:4,r=t/2,i=this._getLineSymbolPeriod(e.lineSymbol)||4;i<4;)i*=2;var s=i/2;return{type:"CIMVectorMarker",frame:{xmin:-s,xmax:s,ymin:-r,ymax:r},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-s,0],[s,0]]]},symbol:e.lineSymbol}],size:t}}static _getLineSymbolPeriod(e){if(e){var t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(var r of e.symbolLayers){var i=this._getEffectsRepeat(r.effects);if(i)return i;if(r){var s=this._getPlacementRepeat(r.markerPlacement);if(s)return s}}}return 0}static _getEffectsRepeat(e){if(e)for(var t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":var r=t.dashTemplate;if(r&&r.length){var i=0;for(var s of r)i+=s;return 1&r.length&&(i*=2),i}break;case"CIMGeometricEffectWave":return t.period;default:w.error("unsupported geometric effect type ".concat(t.type))}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":var t=e.placementTemplate;if(t&&t.length){var r=0;for(var i of t)r+=i;return 1&t.length&&(r*=2),r}}return 0}static fromCIMInsidePolygon(e){var t,r,s,a,n=e.markerPlacement,o=Object(i.a)({type:e.type},e);return o.markerPlacement=null,o.anchorPoint=null,!0===n.shiftOddRows?(r=n.stepX/2,s=n.stepY,a=2*n.stepY,t=[{x:-r,y:0},{x:r,y:0},{x:0,y:s},{x:0,y:-s}].map((e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[o]}})))):(r=n.stepX/2,s=n.stepY/2,a=n.stepY,t=[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMPointSymbol",symbolLayers:[o]}}]),{type:"CIMVectorMarker",frame:{xmin:-r,xmax:r,ymin:-s,ymax:s},markerGraphics:t,size:a}}static getFillColor(e){if(!e)return null;switch(e.type){case"CIMPolygonSymbol":if(e.symbolLayers)for(var t of e.symbolLayers){var r=j.getFillColor(t);if(null!=r)return r}break;case"CIMTextSymbol":return j.getFillColor(e.symbol);case"CIMSolidFill":return e.color}}static getStrokeColor(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(var t of e.symbolLayers){var r=j.getStrokeColor(t);if(void 0!==r)return r}break;case"CIMTextSymbol":return j.getStrokeColor(e.symbol);case"CIMSolidStroke":return e.color}}static getStrokeWidth(e){if(e)switch(e.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(e.symbolLayers)for(var t of e.symbolLayers){var r=j.getStrokeWidth(t);if(void 0!==r)return r}break;case"CIMTextSymbol":return j.getStrokeWidth(e.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return e.width}}static getSize(e){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":var t=0;if(e.symbolLayers)for(var r of e.symbolLayers){var i=j.getSize(r);i>t&&(t=i)}return t;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":return e.width;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":return e.size}}static getMarkerScaleRatio(e){if(e)switch(e.type){case"CIMVectorMarker":if(!1!==e.scaleSymbolsProportionally&&e.frame){var t=e.frame.ymax-e.frame.ymin;return e.size/t}}return 1}}class M{static rasterizeSimpleFill(e,t,r){"solid"!==t&&"none"!==t&&"esriSFSSolid"!==t&&"esriSFSNull"!==t||console.error("Unexpected: style does not require rasterization");var i=Object(a.p)(Math.ceil(r)),s=this._isHorizontalOrVertical(t)?8*i:16*i,n=2*i;e.width=s,e.height=s;var o=e.getContext("2d");o.strokeStyle="#FFFFFF",o.lineWidth=i,o.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(o.moveTo(s/2,-n),o.lineTo(s/2,s+n)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(o.moveTo(-n,s/2),o.lineTo(s+n,s/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(o.moveTo(-n,-n),o.lineTo(s+n,s+n),o.moveTo(s-n,-n),o.lineTo(s+n,n),o.moveTo(-n,s-n),o.lineTo(n,s+n)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(o.moveTo(s+n,-n),o.lineTo(-n,s+n),o.moveTo(n,-n),o.lineTo(-n,n),o.moveTo(s+n,s-n),o.lineTo(s-n,s+n)),o.stroke();for(var l,h=o.getImageData(0,0,e.width,e.height),c=new Uint8Array(h.data),u=0;u<c.length;u+=4)l=c[u+3]/255,c[u]=c[u]*l,c[u+1]=c[u+1]*l,c[u+2]=c[u+2]*l;return[c,e.width,e.height]}static rasterizeSimpleLine(e,t){var r;switch(t){case"butt":r="Butt";break;case"square":r="Square";break;default:r="Round"}var i,s="Butt"===r;switch(e){case"dash":case"esriSLSDash":i=s?[4,3]:[3,4];break;case"dash-dot":case"esriSLSDashDot":i=s?[4,3,1,3]:[3,4,0,4];break;case"dot":case"esriSLSDot":i=s?[1,3]:[0,4];break;case"long-dash":case"esriSLSLongDash":i=s?[8,3]:[7,4];break;case"long-dash-dot":case"esriSLSLongDashDot":i=s?[8,3,1,3]:[7,4,0,4];break;case"long-dash-dot-dot":case"esriSLSDashDotDot":i=s?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case"short-dash":case"esriSLSShortDash":i=s?[4,1]:[3,2];break;case"short-dash-dot":case"esriSLSShortDashDot":i=s?[4,1,1,1]:[3,2,0,2];break;case"short-dash-dot-dot":case"esriSLSShortDashDotDot":i=s?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case"short-dot":case"esriSLSShortDot":i=s?[1,1]:[0,2];break;case"solid":case"esriSLSSolid":case"none":w.error("Unexpected: style does not require rasterization"),i=[0,0];break;default:w.error("Tried to rasterize SLS, but found an unexpected style: ".concat(e,"!")),i=[0,0]}return this.rasterizeDash(i,r)}static rasterizeDash(e,t){var r="Butt"===t,i="Square"===t,s=!r&&!i,a=15,n=0;for(var o of e)n+=o;for(var l=n*a,h=31*l,c=new Float32Array(h),u=s?225:a,d=0;d<h;++d)c[d]=u;var f=7.5,p=0,m=0,_=!0;for(var g of e){p=m,m+=g*a;for(var v=p;v<m;){for(var y=0;y<31;){var b=y*l+v,O=s?(y-15)*(y-15):Math.abs(y-15);c[b]=_?r?Math.max(Math.max(p+f-v,O),Math.max(v-m+f,O)):O:s?Math.min((v-p)*(v-p)+O,(v-m)*(v-m)+O):i?Math.min(Math.max(v-p,O),Math.max(m-v,O)):Math.min(Math.max(v-p+f,O),Math.max(m+f-v,O)),y++}v++}_=!_}for(var w=c.length,S=new Uint8Array(4*w),j=0;j<w;++j){var M=(s?Math.sqrt(c[j]):c[j])/a;Object(x.a)(M,S,4*j)}return[S,l,31]}static _isHorizontalOrVertical(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}}class T{static findApplicableOverrides(e,t,r){if(t){if(e.primitiveName){var i=!1;for(var s of r)if(s.primitiveName===e.primitiveName){i=!0;break}if(!i)for(var a of t)a.primitiveName===e.primitiveName&&r.push(a)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(var n of e.effects)T.findApplicableOverrides(n,t,r);if(e.symbolLayers)for(var o of e.symbolLayers)T.findApplicableOverrides(o,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(var l of e.effects)T.findApplicableOverrides(l,t,r);if(e.markerPlacement&&T.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(var h of e.markerGraphics)T.findApplicableOverrides(h,t,r),T.findApplicableOverrides(h.symbol,t,r)}else"CIMCharacterMarker"===e.type?T.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type&&T.findApplicableOverrides(e.lineSymbol,t,r)}}}static applyOverrides(e,t,r,i){if(t){var s=e=>e?e.charAt(0).toLowerCase()+e.substr(1):e;if(e.primitiveName)for(var a of t)if(a.primitiveName===e.primitiveName){var n=s(a.propertyName);if(i&&i.push({cim:e,nocapPropertyName:n,value:e[n]}),a.expression&&(a.value=T.toValue(a.propertyName,a.expression)),r){var o=!1;for(var l of r)l.primitiveName===e.primitiveName&&(o=!0);o||r.push(a)}e[n]=a.value}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(var h of e.effects)T.applyOverrides(h,t,r,i);if(e.symbolLayers)for(var c of e.symbolLayers)T.applyOverrides(c,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(var u of e.effects)T.applyOverrides(u,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(var d of e.markerGraphics)T.applyOverrides(d,t,r,i),T.applyOverrides(d.symbol,t,r,i)}}}static restoreOverrides(e){for(var t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){var t="";for(var r of e)void 0!==r.value&&(t+="".concat(r.primitiveName).concat(r.propertyName).concat(JSON.stringify(r.value)));return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){var r=new n.a(t).toRgba();return r[3]*=255,r}return t}}},360:function(e,t,r){"use strict";r.d(t,"a",(function(){return N})),r.d(t,"b",(function(){return T})),r.d(t,"c",(function(){return j}));var i=r(91),s=r(80),a=r(92),n=r(89),o=r(81),l=r(93),h=r(105),c=(r(128),r(341)),u=(r(229),r(231),r(197),r(199),r(198),r(194)),d=(r(244),r(511)),f=r(127),p=r(156),m=r(151),_=r(406);var g=r(507),v=r(535),y=r(494),x=o.a.getLogger("esri.views.2d.layers.features.schemaUtils"),b="ValidationError",O={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function w(e){return Object(p.h)(e)}function S(e){switch(e.type){case"line-marker":var t;return{type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style};default:return Object(c.a)(e.toJSON()).toJSON()}}function j(e,t,r){if(!e)return null;var s=0,a=!1,o=0;switch(Object(n.k)(t)&&(o=Object(g.b)(t),"visualVariables"in t&&(s=function(e){if(!e)return f.e.NONE;var t=0;for(var r of e)if("size"===r.type){var i=Object(_.a)(r);t|=i,"outline"===r.target&&(t|=i<<4)}else"color"===r.type?t|=f.e.COLOR:"opacity"===r.type?t|=f.e.OPACITY:"rotation"===r.type&&(t|=f.e.ROTATION);return t}(t.visualVariables||[]),a="dot-density"===t.type)),e.type){case"simple-fill":case"picture-fill":return function(e,t,r,s){var a=Object(p.g)(f.d.FILL,t,!1,r),n=s?w(a):a,o=e.clone(),l=o.outline;o.outline=null;var h=[],c=Object(i.a)({materialKey:n,hash:o.hash()},S(o));if(h.push(c),l){var u=Object(p.g)(f.d.LINE,t,!0,!1),d=Object(i.a)({materialKey:s?w(u):u,hash:l.hash()},S(l));h.push(d)}return{type:"composite-symbol",layers:h,hash:h.reduce(((e,t)=>t.hash+e),"")}}(e,s,a,r);case"simple-marker":case"picture-marker":return function(e,t,r,s){var a=Object(p.g)(f.d.MARKER,t,!1,!1),n=s?w(a):a,o=S(e);return Object(i.a)(Object(i.a)({materialKey:n,hash:e.hash()},o),{},{angle:e.angle,maxVVSize:r})}(e,s,o,r);case"simple-line":return function(e,t,r){var s=Object(p.g)(f.d.LINE,t,!1,!1),a=r?w(s):s,n=e.clone(),o=n.marker;n.marker=null;var l=[];if(l.push(Object(i.a)({materialKey:a,hash:n.hash()},S(n))),o){var h,c=Object(p.g)(f.d.MARKER,t,!1,!1),u=r?w(c):c;o.color=null!=(h=o.color)?h:n.color,l.push(Object(i.a)({materialKey:u,hash:o.hash(),lineWidth:n.width},S(o)))}return{type:"composite-symbol",layers:l,hash:l.reduce(((e,t)=>t.hash+e),"")}}(e,s,r);case"text":return function(e,t,r,s){var a=Object(p.g)(f.d.TEXT,t,!1,!1),n=s?w(a):a,o=S(e);return Object(i.a)(Object(i.a)({materialKey:n,hash:e.hash()},o),{},{angle:e.angle,maxVVSize:r})}(e,s,o,r);case"label":return function(e,t,r){var s=Object(p.g)(f.d.LABEL,t,!1,!1,e.labelPlacement);return Object(i.a)(Object(i.a)({materialKey:r?w(s):s,hash:e.hash()},e.toJSON()),{},{labelPlacement:e.labelPlacement})}(e,s,r);case"cim":return{type:"cim",rendererKey:s,data:e.data,maxVVSize:o};case"web-style":return Object(i.a)(Object(i.a)({},S(e)),{},{type:"web-style",hash:e.hash(),rendererKey:s,maxVVSize:o});default:throw new Error("symbol not supported ".concat(e.type))}}function M(e,t){var r=Object(a.a)(e);return r.some((e=>function(e,t){var r=e.labelPlacement,i=O[t];if(!e.symbol)return x.warn("No LabelClass symbol specified."),!0;if(!i)return x.error(new l.a("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, ".concat(t," is not supported"))),!0;if(!i.some((e=>e===r))){var s=i[0];r&&x.warn("Found invalid label placement type ".concat(r," for ").concat(t,". Defaulting to ").concat(s)),e.labelPlacement=s}return!1}(e,t)))?[]:r}function T(e){return Object(s.a)("esri-2d-update-debug")&&console.debug("Created new schema",E(e,!0)),E(e)}function E(e,t=!1){try{var r,i,s=function(e,t=!1){var r=new Array;return r.push(function(e,t,r=!1){var i={indexCount:0,fields:{}},s="featureReduction"in e&&e.featureReduction,a=s?"aggregate":"feature";switch(e.renderer.type){case"heatmap":var{blurRadius:n,fieldOffset:o,field:h}=e.renderer;return{type:"heatmap",aggregateFields:[],attributes:i,target:a,storage:null,mesh:{blurRadius:n,fieldOffset:o,field:L(i,{target:a,field:h,resultType:"numeric"}).field}};default:var c=[],f="aggregate"===a?Object(d.b)(c,e.renderer,s,null):e.renderer;!function(e,t){var r={mesh:!0,storage:!0};for(var i of t){var{name:s,outStatistic:a}=i,{statisticType:n,onStatisticField:o}=a,l=null,h=null,c=null,u="numeric",d="feature";"onStatisticValueExpression"in a?h=k(e,{type:"expression",target:d,valueExpression:a.onStatisticValueExpression,resultType:u}).fieldIndex:"onStatisticNormalizationField"in a?(l=k(e,{type:"field",target:d,field:o,resultType:u}).field,c=a.onStatisticNormalizationField):l=k(e,{type:"field",target:d,field:o,resultType:u}).field,k(e,{type:"statistic",target:"aggregate",name:s,context:r,inField:l,inNormalizationField:c,inFieldIndex:h,statisticType:n})}}(i,c);var p=N(i,a,f,r),_=null,g=function(e,t,r){switch(r.type){case"dot-density":return function(e,t,r){return r&&r.length?{type:"dot-density",mapping:r.map(((r,i)=>{var{field:s,fieldIndex:a}=L(e,{valueExpression:r.valueExpression,field:r.field,resultType:"numeric",target:t});return{binding:i,field:s,fieldIndex:a}})),target:t}:{type:"dot-density",mapping:[],target:t}}(e,t,r.attributes);case"simple":case"class-breaks":case"unique-value":return function(e,t,r){if(!r||!r.length)return{type:"visual-variable",mapping:[],target:t};var i={storage:!0},s="numeric";return{type:"visual-variable",mapping:Object(v.b)(r).map((r=>{var a,n=Object(m.m)(r.type),{field:o,fieldIndex:l}=L(e,{target:t,valueExpression:r.valueExpression,field:r.field,context:i,resultType:s});switch(r.type){case"size":return"$view.scale"===r.valueExpression?null:{type:"size",binding:n,field:o,fieldIndex:l,normalizationField:L(e,{target:t,field:r.normalizationField,context:i,resultType:s}).field,valueRepresentation:null!=(a=r.valueRepresentation)?a:null};case"color":return{type:"color",binding:n,field:o,fieldIndex:l,normalizationField:L(e,{target:t,field:r.normalizationField,context:i,resultType:s}).field};case"opacity":return{type:"opacity",binding:n,field:o,fieldIndex:l,normalizationField:L(e,{target:t,field:r.normalizationField,context:i,resultType:s}).field};case"rotation":return{type:"rotation",binding:n,field:o,fieldIndex:l}}})).filter((e=>e)),target:t}}(e,t,r.visualVariables);case"heatmap":case"dictionary":return null}}(i,a,f),x=Object(y.a)(e.geometryType),O=e.labelsVisible&&e.labelingInfo||[],w=[];if(s){if("selection"===s.type)throw new l.a(b,"Mapview does not support `selection` reduction type",s);if(s.symbol){var S=new u.a({symbol:s.symbol,visualVariables:"visualVariables"in f?f.visualVariables:null});_=N(i,a,S,r)}w=s&&s.labelsVisible&&s.labelingInfo||[]}O=M(O,x),w=M(w,x);var j=0,T=[...O.map((e=>R(f,i,e,"feature",j++,r))),...w.map((e=>R(f,i,e,"aggregate",j++,r)))];return{type:"symbol",target:a,attributes:i,aggregateFields:c,storage:g,mesh:{matcher:p,labels:T,aggregateMatcher:_}}}}(e,t)),r}(e,t),a={};return s.map((t=>function(e,t,r){switch(r.target){case"feature":return void P(e,I(t),r);case"aggregate":var i=t.featureReduction;if("selection"===i.type)throw new l.a(b,"Mapview does not support `selection` reduction type",i);return P(e,I(t),r),void function(e,t,r){e.aggregate||(e.aggregate={name:"aggregate",input:"feature",filters:null,attributes:{},params:{clusterRadius:Object(h.h)(t.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(Object(h.h)(t.clusterMaxSize)/64),fields:r.aggregateFields}}),C(e.aggregate,r.attributes.fields)}(e,i,r)}}(a,e,t))),{source:{definitionExpression:e.definitionExpression,fields:e.fields.map((e=>e.toJSON())),gdbVersion:e.gdbVersion,historicMoment:null==(r=e.historicMoment)?void 0:r.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null==(i=e.timeExtent)?void 0:i.toJSON()},attributes:{fields:{},indexCount:0},processors:s,targets:a}}catch(n){if(n.fieldName===b)return x.error(n),null;throw n}}function C(e,t){for(var r in t){var i=t[r];if(i.target===e.name){var s=e.attributes[r];s?(s.context.mesh=s.context.mesh||i.context.mesh,s.context.storage=s.context.storage||i.context.storage):e.attributes[r]=i}}return e}function I(e){var t,r,i,s,a;return[null!=(t=null==(r=e.filter)?void 0:r.toJSON())?t:null,null!=(i=null==(s=e.effect)||null==(a=s.filter)?void 0:a.toJSON())?i:null]}function P(e,t,r){return e.feature||(e.feature={name:"feature",input:"source",filters:t,attributes:{}}),C(e.feature,r.attributes.fields),e}function L(e,t){return t.field?k(e,Object(i.a)(Object(i.a)({},t),{},{type:"field",field:t.field})):t.valueExpression?k(e,Object(i.a)(Object(i.a)({},t),{},{type:"expression",valueExpression:t.valueExpression})):{field:null,fieldIndex:null}}function k(e,t){switch(t.type){case"expression":var r=t.valueExpression;if(!e.fields[r]){var s=e.indexCount++;e.fields[r]=Object(i.a)(Object(i.a)({},t),{},{name:r,fieldIndex:s})}return{fieldIndex:e.fields[r].fieldIndex};case"label-expression":var a=JSON.stringify(t.label);if(!e.fields[a]){var n=e.indexCount++;e.fields[a]=Object(i.a)(Object(i.a)({},t),{},{name:a,fieldIndex:n})}return{fieldIndex:e.fields[a].fieldIndex};case"field":var o=t.field;return"aggregate"===t.target&&e.fields[o]||(e.fields[o]=Object(i.a)(Object(i.a)({},t),{},{name:o})),{field:o};case"statistic":return e.fields[t.name]=Object(i.a)({},t),{field:t.name}}}function R(e,t,r,s,a,n=!1){var o=k(t,{type:"label-expression",target:s,context:{mesh:!0},resultType:"string",label:{labelExpression:r.labelExpression,labelExpressionInfo:r.labelExpressionInfo?{expression:r.labelExpressionInfo.expression}:null,symbol:!!r.symbol,where:r.where}}),{fieldIndex:l}=o;return Object(i.a)(Object(i.a)({},j(r,e,n)),{},{fieldIndex:l,target:s,index:a})}function N(e,t,r,s=!1){var a=Object(n.r)(e,{indexCount:0,fields:{}});switch(r.type){case"simple":case"dot-density":return function(e,t,r,i=!1){var s=t.getSymbols();return{type:"simple",symbol:j(s.length?s[0]:null,t,i),isDotDensity:r}}(0,r,"dot-density"===r.type,s);case"class-breaks":return function(e,t,r,i=!1){var s={mesh:!0,use:"renderer.field"},a=r.backgroundFillSymbol,{field:n,fieldIndex:o}=L(e,{target:t,field:r.field,valueExpression:r.valueExpression,resultType:"numeric",context:s}),l=r.normalizationType,h="log"===l?"esriNormalizeByLog":"percent-of-total"===l?"esriNormalizeByPercentOfTotal":"field"===l?"esriNormalizeByField":null,c=r.classBreakInfos.map((e=>({symbol:j(e.symbol,r,i),min:e.minValue,max:e.maxValue}))).sort(((e,t)=>e.min-t.min));return{type:"interval",attributes:e.fields,field:n,fieldIndex:o,backgroundFillSymbol:j(a,r,i),defaultSymbol:j(r.defaultSymbol,r,i),intervals:c,normalizationField:r.normalizationField,normalizationTotal:r.normalizationTotal,normalizationType:h,isMaxInclusive:r.isMaxInclusive}}(a,t,r,s);case"unique-value":return function(e,t,r,s=!1){var a=[],n=r.backgroundFillSymbol,o={target:t,context:{mesh:!0},resultType:"string"};if(r.field&&"string"!=typeof r.field)throw new l.a(b,"Expected renderer.field to be a string",r);var{field:h,fieldIndex:c}=L(e,Object(i.a)(Object(i.a)({},o),{},{field:r.field,valueExpression:r.valueExpression}));for(var u of r.uniqueValueInfos)a.push({value:""+u.value,symbol:j(u.symbol,r,s)});return{type:"map",attributes:e.fields,field:h,fieldIndex:c,field2:L(e,Object(i.a)(Object(i.a)({},o),{},{field:r.field2})).field,field3:L(e,Object(i.a)(Object(i.a)({},o),{},{field:r.field3})).field,fieldDelimiter:r.fieldDelimiter,backgroundFillSymbol:j(n,r),defaultSymbol:j(r.defaultSymbol,r),map:a}}(a,t,r,s);case"dictionary":return function(e,t,r=!1){return{type:"dictionary",renderer:t.toJSON()}}(0,r,s)}}},365:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=new(r(524).a);function s(e){return i.hasBidiChar(e)?(t="rtl"===i.checkContextual(e)?"IDNNN":"ICNNN",[i.bidiTransform(e,t,"VLYSN"),!0]):[e,!1];var t}},366:function(e,t,r){"use strict";r.d(t,"b",(function(){return y})),r.d(t,"c",(function(){return x}));var i=r(7),s=r(80),a=r(89),n=r(81),o=r(93),l=r(94),h=r(110),c=r(317),u=r(207),d=r(122),f=r(151),p=r(429),m=r(520),_=n.a.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=Object(p.b)(p.a,_),v=e=>(2147483648&e)>>>31,y=e=>2147483647&e;function x(e){return 1===v(e)}var b={sharedArrayBuffer:Object(s.a)("esri-shared-array-buffer"),atomics:Object(s.a)("esri-atomics")};function O(e,t){return r=>t(e(r))}class w{constructor(e,t,r,i){this.size=0,this.texelSize=4;var{pixelType:s,layout:a,textureOnly:n}=i;this.textureOnly=n||!1,this.pixelType=s,this._ctype=t,this.layout=a,this._resetRange(),this._shared=e,this.size=r,n||(this.data=this._initData(s,r,e,t))}get buffer(){return Object(a.b)(this.data,(e=>e.buffer))}unsetComponentAllTexels(e,t){for(var r=Object(a.q)(this.data),i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){for(var r=Object(a.q)(this.data),i=0;i<this.size*this.size;i++)r[i*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,r){var i=Object(a.q)(this.data);for(var s of r)i[s*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)}setComponentTexel(e,t,r){Object(a.q)(this.data)[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}unsetComponentTexel(e,t,r){Object(a.q)(this.data)[r*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}getData(e,t){var r=y(e);return Object(a.q)(this.data)[r*this.texelSize+t]}setData(e,t,r){var i=y(e),s=1<<t;0!=(this.layout&s)?(this.data[i*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)):_.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&b.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&b.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(e){if(this.size=e,!this.textureOnly){var t=this._initData(this.pixelType,e,this._shared,this._ctype),r=Object(a.q)(this.data);t.set(r),this.data=t}}toMessage(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),s=this.pixelType,n=this.layout,o=Object(a.q)(this.data);return o.slice?{start:e,end:t,data:i&&o.slice(e*r,(t+1)*r)||null,pixelType:s,layout:n}:i?{start:e,end:t,data:new(Object(f.j)(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:s,layout:n}:{start:e,end:t,data:null,pixelType:s,layout:n}}_initData(e,t,r,i){for(var s=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,a=Object(f.j)(e),n=new a(new s(t*t*4*a.BYTES_PER_ELEMENT)),o=0;o<n.length;o+=4)n[o+1]=255;return n}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}t.a=class{constructor(e,t){this._client=e,this.config=t,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(d.m),this._targetType=0,this._abortController=Object(l.d)(),this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;var r=t.supportsTextureFloat?5126:5121;g("Creating AttributeStore ".concat(b.sharedArrayBuffer?"with":"without"," shared memory")),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:r,layout:15},{pixelType:r,layout:15}],this._blocks=this._blockDescriptors.map((()=>null))}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,t){this.config=t;var r=t.schema.processors[0].storage,i=Object(c.a)(this._schema,r);if((e.targets.feature||e.targets.aggregate)&&(e.storage.data=!0),i&&(Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",i),e.storage.data=!0,this._schema=r,this._attributeComputeMap.clear(),!Object(a.j)(r))){switch(r.target){case"feature":this._targetType=0;break;case"aggregate":this._targetType=1}for(var n of r.mapping)this._bindAttribute(n)}}onTileData(e,t){if(!Object(a.j)(t.addOrUpdate))for(var r=t.addOrUpdate.getCursor();r.next();){var i=r.getDisplayId();this.setAttributeData(i,r)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=Object(l.d)()}setHighlight(e,t){var r=this;return Object(i.a)((function*(){var i=r._getBlock(0),s=t.map((e=>y(e)));for(var a of(i.lock(),i.unsetComponentAllTexels(0,1),i.setComponent(0,1,s),i.unlock(),r._idsToHighlight.clear(),e))r._idsToHighlight.add(a);yield r.sendUpdates()}))()}updateFilters(e,t){var r=this;return Object(i.a)((function*(){var{config:i,service:a,spatialReference:n}=t,{filters:o}=i,l=o.map(((e,t)=>r._updateFilter(e,t,a,n)));(yield Promise.all(l)).some((e=>e))&&(e.storage.filters=!0,Object(s.a)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))}))()}setData(e,t,r,i){var s=y(e);this._ensureSizeForTexel(s),this._getBlock(t).setData(e,r,i)}getData(e,t,r){return this._getBlock(t).getData(e,r)}getHighlightFlag(e){return this._idsToHighlight.has(e)?d.j:0}unsetAttributeData(e){var t=y(e);this._getBlock(0).setData(t,0,0)}setAttributeData(e,t){var r=y(e);if(this._ensureSizeForTexel(r),this._getBlock(0).setData(r,0,this.getFilterFlags(t)),this._targetType===v(e)){var i=this._attributeComputeMap,s=this.config.supportsTextureFloat?1:2;i.size&&i.forEach(((e,i)=>{var a=i*s%4,n=Math.floor(i*s/4),o=this._getBlock(n+d.b),l=e(t);if(this.config.supportsTextureFloat)o.setData(r,a,l);else if(l===d.n)o.setData(r,a,255),o.setData(r,a+1,255);else{var c=Object(h.d)(Math.round(l),-32767,32766)+32768,u=255&c,f=(65280&c)>>8;o.setData(r,a,u),o.setData(r,a+1,f)}}))}}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=Object(l.g)(),this._nextUpdate.promise;var e={blocks:this._blocks.map((e=>Object(a.k)(e)?e.toMessage():null))};return this._currUpdate=this._createResources().then((()=>{var t=()=>{if(this._currUpdate=null,this._nextUpdate){var e=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then((()=>e.resolve()))}},r=this._client.update(e,this._signal).then(t).catch(t);return this._client.render(this._signal),r})).catch((e=>Object(l.m)(e)?(this._createResourcesPromise=null,this._createResources()):(_.error(new o.a("mapview-attribute-store","Encountered an error during client update",e)),Promise.resolve()))),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){var t;if(null!=e.fieldIndex)e.normalizationField&&_.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),t=t=>t.getComputedNumericAtIndex(e.fieldIndex);else{if(!e.field)return;t=e.normalizationField?t=>{var r=t.readAttribute(e.normalizationField);return r?t.readAttribute(e.field)/r:null}:t=>t.readAttribute(e.field)}e.valueRepresentation&&(t=O(t,(t=>Object(m.b)(t,e.valueRepresentation))));this._attributeComputeMap.set(e.binding,O(t,(e=>null===e||isNaN(e)||e===1/0?d.n:e)))}_createResources(){if(Object(a.k)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(d.a),g("Initializing AttributeStore");var e={shared:b.sharedArrayBuffer&&!("local"===this._client.type),size:this._size,blocks:Object(a.m)(this._blocks,(e=>({textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType})))},t=this._client.initialize(e,this._signal).catch((e=>{Object(l.m)(e)?this._createResourcesPromise=null:_.error(new o.a("mapview-attribute-store","Encountered an error during client initialization",e))}));return this._createResourcesPromise=t,t.then((()=>Object(a.j)(this._createResourcesPromise)?this._createResources():void 0)),t}_getBlock(e){var t=this._blocks[e];if(Object(a.k)(t))return t;g("Initializing AttributeBlock at index ".concat(e));var r=b.sharedArrayBuffer,i=this._client.type,s=new w(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=s,this._createResourcesPromise=null,s}_expand(){if(this._size<this.config.maxTextureSize){var e=this._size<<=1;return g("Expanding block size to",e,this._blocks),Object(a.h)(this._blocks,(t=>t.expand(e))),this._createResourcesPromise=null,this._size=e,0}return _.error(new o.a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateFilter(e,t,r,s){var n=this;return Object(i.a)((function*(){var i=n._filters[t],o=Object(a.k)(i)&&i.hash;if(!i&&!e)return!1;if(o===JSON.stringify(e))return!1;if(Object(a.j)(e)){var l=1<<t+1,h=n._getBlock(0);return n._filters[t]=null,h.setComponentAllTexels(0,l),n.sendUpdates(),!0}var c=yield n._getFilter(t,r);return yield c.update(e,s),!0}))()}_getFilter(e,t){var s=this;return Object(i.a)((function*(){var i=s._filters[e];if(Object(a.k)(i))return i;var{default:n}=yield r.e(122).then(r.bind(null,709)),o=new n({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new u.a(t.fields)});return s._filters[e]=o,o}))()}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){for(var t=0,r=(e=>1===v(e)?254:255)(e.getDisplayId()),i=0;i<this._filters.length;i++){var s=!!(r&1<<i),n=this._filters[i];t|=(!s||Object(a.j)(n)||n.check(e)?1:0)<<i}var o=0;if(this._idsToHighlight.size){var l=e.getObjectId();o=this.getHighlightFlag(l)}return t<<1|o}}},369:function(e,t,r){"use strict";r.d(t,"a",(function(){return ae})),r.d(t,"b",(function(){return ne}));var i=r(92),s=r(100),a=r(153);class n{static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r){return new o(e,t,r)}}n.instance=null;class o{constructor(e,t,r){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){for(var e=this._inputGeometries.next();e;){if(Object(s.g)(e)){this._isClosed=!0;var t=Object(i.a)(e);return this._processMultipath(t.rings),t}if(Object(s.h)(e)){this._isClosed=!1;var r=Object(i.a)(e);return this._processMultipath(r.paths),r}if(Object(s.d)(e)){if(this._maxCosAngle)return e;this._isClosed=!0;var a=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];return this._processPath(a),{rings:[a]}}e=this._inputGeometries.next()}return null}_processMultipath(e){if(e)for(var t of e)this._processPath(t)}_processPath(e){if(e){var t,r,i,s,n,o,l=e.length,h=e[0];this._isClosed&&++l;for(var c=1;c<l;++c){var u,d=(u=this._isClosed&&c===l-1?e[0]:e[c])[0]-h[0],f=u[1]-h[1],p=Math.sqrt(d*d+f*f);c>1&&p>0&&i>0&&(t*d+r*f)/p/i<=this._maxCosAngle&&Object(a.j)(h,1),1===c&&(s=d,n=f,o=p),p>0&&(h=u,t=d,r=f,i=p)}this._isClosed&&i>0&&o>0&&(t*s+r*n)/o/i<=this._maxCosAngle&&Object(a.j)(e[0],1)}}}var l=.03;class h{constructor(){this._path=[]}path(){return this._path}addPath(e,t){t||e.reverse(),Array.prototype.push.apply(this._path,e),t||e.reverse()}static mergePath(e,t){t&&Array.prototype.push.apply(e,t)}startPath(e){this._path.push(e)}lineTo(e){this._path.push(e)}close(){var e=this._path;e.length>1&&(e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]))}}class c{constructor(e=0,t=!1){}normalize(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]/=t,e[1]/=t}calculateLength(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}calculateSegLength(e,t){return this.calculateLength(e[t],e[t+1])}calculatePathLength(e){for(var t=0,r=e?e.length:0,i=0;i<r-1;++i)t+=this.calculateSegLength(e,i);return t}calculatePathArea(e){for(var t=0,r=e?e.length:0,i=0;i<r-1;++i)t+=(e[i+1][0]-e[i][0])*(e[i+1][1]+e[i][1]);return t/2}getCoord2D(e,t,r){return[e[0]+(t[0]-e[0])*r,e[1]+(t[1]-e[1])*r]}getSegCoord2D(e,t,r){return this.getCoord2D(e[t],e[t+1],r)}getAngle(e,t,r){var i=t[0]-e[0],s=t[1]-e[1];return Math.atan2(s,i)}getSegAngle(e,t,r){return this.getAngle(e[t],e[t+1],r)}getAngleCS(e,t,r){var i=t[0]-e[0],s=t[1]-e[1],a=Math.sqrt(i*i+s*s);return a>0?[i/a,s/a]:[1,0]}getSegAngleCS(e,t,r){return this.getAngleCS(e[t],e[t+1],r)}cut(e,t,r,i){return[r<=0?e[t]:this.getSegCoord2D(e,t,r),i>=1?e[t+1]:this.getSegCoord2D(e,t,i)]}addSegment(e,t,r){r&&e.push(t[0]),e.push(t[1])}getSubCurve(e,t,r){var i=[];return this.appendSubCurve(i,e,t,r)?i:null}appendSubCurve(e,t,r,i){for(var s=t?t.length-1:0,a=0,n=!0,o=0;o<s;){var l=this.calculateSegLength(t,o);if(0!==l){if(n){if(a+l>r){var h=(r-a)/l,c=1,u=!1;a+l>=i&&(c=(i-a)/l,u=!0);var d=this.cut(t,o,h,c);if(d&&this.addSegment(e,d,n),u)break;n=!1}}else{if(a+l>i){var f=this.cut(t,o,0,(i-a)/l);f&&this.addSegment(e,f,n);break}this.addSegment(e,[t[o],t[o+1]],n)}a+=l,++o}else++o}return!0}getCIMPointAlong(e,t){for(var r=e?e.length-1:0,i=0,s=-1;s<r;){++s;var a=this.calculateSegLength(e,s);if(0!==a){if(i+a>t){var n=(t-i)/a;return this.getCoord2D(e[s],e[s+1],n)}i+=a}}return null}isEmpty(e,t){if(!e||e.length<=1)return!0;for(var r=e?e.length-1:0,i=-1;i<r;){if(e[++i+1][0]!==e[i][0]||e[i+1][1]!==e[i][1])return!1;if(t&&e[i+1][2]!==e[i][2])return!1}return!0}offset(e,t,r,i,s){if(!e||e.length<2)return null;var a=e.length,n=e[0][0]===e[a-1][0]&&e[0][1]===e[a-1][1];if(n){if(e.length<3)return null;--a}for(var o=[],l=n?e[a-1]:null,h=e[0],c=0;c<a;c++){var u=c===a-1?n?e[0]:null:e[c+1];if(l)if(u){var d=[u[0]-h[0],u[1]-h[1]];this.normalize(d);var f=[h[0]-l[0],h[1]-l[1]];this.normalize(f);var p=f[0]*d[1]-f[1]*d[0],m=f[0]*d[0]+f[1]*d[1];if(p>=0==t<=0){var _=[d[0]-f[0],d[1]-f[1]];this.normalize(_);var g=Math.sqrt((1+m)/2),v=-Math.abs(t)/g;o.push([h[0]-_[0]*v,h[1]-_[1]*v])}else switch(r){case"Mitered":var y=Math.sqrt((1+m)/2);if(y>0&&1/y<i){var x=[d[0]-f[0],d[1]-f[1]];this.normalize(x);var b=Math.abs(t)/y;o.push([h[0]-x[0]*b,h[1]-x[1]*b]);break}case"Bevelled":o.push([h[0]+f[1]*t,h[1]-f[0]*t]),o.push([h[0]+d[1]*t,h[1]-d[0]*t]);break;case"Rounded":o.push([h[0]+f[1]*t,h[1]-f[0]*t]);for(var O=.2,w=1;w<5;w++,O+=.2){var S=[f[1]*(1-O)+d[1]*O,-f[0]*(1-O)-d[0]*O];this.normalize(S),o.push([h[0]+S[0]*t,h[1]+S[1]*t])}o.push([h[0]+d[1]*t,h[1]-d[0]*t]);break;case"Square":default:if(p<0)o.push([h[0]+(f[1]+f[0])*t,h[1]+(f[1]-f[0])*t]),o.push([h[0]+(d[1]-d[0])*t,h[1]-(d[0]+d[1])*t]);else{var j=Math.sqrt((1+Math.abs(m))/2),M=[d[0]-f[0],d[1]-f[1]];this.normalize(M);var T=t/j;o.push([h[0]-M[0]*T,h[1]-M[1]*T])}}}else{var E=[h[0]-l[0],h[1]-l[1]];this.normalize(E),o.push([h[0]+E[1]*t,h[1]-E[0]*t])}else{var C=[u[0]-h[0],u[1]-h[1]];this.normalize(C),o.push([h[0]+C[1]*t,h[1]-C[0]*t])}l=h,h=u}return n&&o.push([o[0][0],o[0][1]]),o}}var u=1.7320508075688772;class d{static local(){return null===d.instance&&(d.instance=new d),d.instance}execute(e,t,r){return new f(e,t,r)}}d.instance=null;class f extends a.a{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new c,this._width=(void 0!==t.width?t.width:5)*r,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:"OpenEnded",this._offsetFlattenError=l*r}processPath(e){switch(this._arrowType){case"OpenEnded":default:return this._constructSimpleArrow(e,!0);case"Block":return this._constructSimpleArrow(e,!1);case"Crossed":return this._constructCrossedArrow(e)}}_constructSimpleArrow(e,t){var r=this._curveHelper.calculatePathLength(e),i=this._width;r<2*i&&(i=r/2);var s=this._curveHelper.getSubCurve(e,0,r-i);if(!s)return null;var a=i/2;if(this._curveHelper.isEmpty(s,!1))return null;var n=this._constructOffset(s,-a);if(!n)return null;var o=this._constructOffset(s,a);if(!o)return null;var l=this._constructArrowBasePoint(n,-a/2);if(!l)return null;var c=this._constructArrowBasePoint(o,a/2);if(!c)return null;var u=e[e.length-1];t||(this._makeControlPoint(o,!0),this._makeControlPoint(n,!0));var d=new h;return d.addPath(o,!0),d.lineTo(c),this._makeControlPoint(d.path()),d.lineTo(u),this._makeControlPoint(d.path()),d.lineTo(l),this._makeControlPoint(d.path()),d.addPath(n,!1),t?{paths:[d.path()]}:(d.close(),{rings:[d.path()]})}_constructCrossedArrow(e){var t=this._curveHelper.calculatePathLength(e),r=this._width;t<3.732050807568877*r&&(r=t/3.732050807568877);var i=this._curveHelper.getSubCurve(e,0,t-r*(1+u));if(!i)return null;var s=r/2;if(this._curveHelper.isEmpty(i,!1))return null;var a=this._constructOffset(i,s);if(!a)return null;var n=this._constructOffset(i,-s);if(!n)return null;var o=this._curveHelper.getSubCurve(e,0,t-r);if(!o)return null;if(this._curveHelper.isEmpty(o,!1))return null;var l=this._constructOffset(o,s);if(!l)return null;var c=this._constructOffset(o,-s);if(!c)return null;var d=l[l.length-1],f=this._constructArrowBasePoint(l,s/2);if(!f)return null;var p=c[c.length-1],m=this._constructArrowBasePoint(c,-s/2);if(!m)return null;var _=e[e.length-1];this._makeControlPoint(a,!1),this._makeControlPoint(n,!1);var g=new h;return g.addPath(a,!0),this._makeControlPoint(g.path()),g.lineTo(p),g.lineTo(m),this._makeControlPoint(g.path()),g.lineTo(_),this._makeControlPoint(g.path()),g.lineTo(f),this._makeControlPoint(g.path()),g.lineTo(d),this._makeControlPoint(g.path()),g.addPath(n,!1),{paths:[g.path()]}}_constructOffset(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;var r=e[e.length-2],i=e[e.length-1],s=[i[0]-r[0],i[1]-r[1]];return this._curveHelper.normalize(s),[i[0]+s[1]*t,i[1]-s[0]*t]}_makeControlPoint(e,t=!1){Object(a.j)(t?e[0]:e[e.length-1],1)}}class p{static local(){return null===p.instance&&(p.instance=new p),p.instance}execute(e,t,r){return new m(e,t,r)}}p.instance=null;class m{constructor(e,t,r){this._inputGeometries=e,this._curveHelper=new c,this._size=(void 0!==t.size?t.size:1)*r,this._offsetFlattenError=l*r}next(){for(var e=this._inputGeometries.next();e;){if(Object(s.d)(e))if(this._size>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],r=this._curveHelper.offset(t,this._size,"Rounded",4,this._offsetFlattenError);if(r)return{rings:[r]}}else{if(!(this._size<0))return e;if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._size>0)return{xmin:e.xmin-this._size,xmax:e.xmax+this._size,ymin:e.ymin-this._size,ymax:e.ymax+this._size}}if(Object(s.g)(e)){if(0===this._size)return e;var i=[];for(var a of e.rings){var n=this._curveHelper.offset(a,this._size,"Rounded",4,this._offsetFlattenError);n&&i.push(n)}if(i.length)return{rings:i}}if(Object(s.h)(e)&&this._size>0){var o=[];for(var l of e.paths)if(l&&l.length>1){var h=this._curveHelper.offset(l,this._size,"Rounded",4,this._offsetFlattenError),c=this._curveHelper.offset(l,-this._size,"Rounded",4,this._offsetFlattenError);if(h&&c){for(var u=c.length-1;u>=0;u--)h.push(c[u]);h.push([h[0][0],h[0][1]]),o.push(h)}}if(o.length)return{rings:o}}Object(s.f)(e)&&this._size,e=this._inputGeometries.next()}return null}}class _{static local(){return null===_.instance&&(_.instance=new _),_.instance}execute(e,t,r){return new g(e,t,r)}}_.instance=null;class g extends a.a{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new c,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*r,this._endCut=(void 0!==t.endCut?t.endCut:1)*r,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*r,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){var t=this._beginCut,r=this._endCut,i=this._middleCut,s=this._curveHelper.calculatePathLength(e),a=[];if(this._invert)if(0===t&&0===r&&0===i);else if(t+r+i>=s)a.push(e);else{var n=this._curveHelper.getSubCurve(e,0,t);n&&a.push(n),(n=this._curveHelper.getSubCurve(e,.5*(s-i),.5*(s+i)))&&a.push(n),(n=this._curveHelper.getSubCurve(e,s-r,r))&&a.push(n)}else if(0===t&&0===r&&0===i)a.push(e);else if(t+r+i>=s);else if(0===i){var o=this._curveHelper.getSubCurve(e,t,s-r);o&&a.push(o)}else{var l=this._curveHelper.getSubCurve(e,t,.5*(s-i));l&&a.push(l),(l=this._curveHelper.getSubCurve(e,.5*(s+i),s-r))&&a.push(l)}return 0===a.length?null:{paths:a}}}class v{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,r=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(var i=0;i<e.length;i++){var s=Math.abs(e[i]);r&&s<1e-7&&(s=1e-7),this._values.push(s),this._length+=s}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){for(var t=this._values?this._values.length:0,r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}}class y{constructor(){this.reset()}reset(){this.segment=-1,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return-1!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class x extends c{constructor(e=0,t=!1){super(e,t),this._tolerance=l,this._currentPosition=new y}updateTolerance(e){this._tolerance=l*e}init(e,t,r=!0){return r?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._path=e,this._seg=-1,this.setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=0){var r=new y;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);var[t,r]=this._getAngle(this._currentPosition);e.ca=t,e.sa=r}nextPointAndAngle(e,t,r=0){var i=new y;if(!this._nextPosition(e,i,null,r))return!1;i.copyTo(this._currentPosition),t.pt=this._getPoint(i);var[s,a]=this._getAngle(i);return t.ca=s,t.sa=a,!0}nextCurve(e){if(0===e)return null;var t=[],r=new y;return this._nextPosition(e,r,t,1)?(r.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){if(-1===this._currentPosition.segment)throw new Error("missing segment");return this._path[this._currentPosition.segment+1]}_nextPosition(e,t,r,i){if(this._currentPosition.isPathEnd)return!1;var s=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(s/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.length)if(0===s){var a=this._path[t.segment];r.push([a[0],a[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,s));var n=this._path[t.segment+1];r.push([n[0],n[1]])}if(s=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this.nextSegment(),t.segmentLength=this.calculateSegLength(this._path,t.segment),t.abscissa=0,this._partSegCount--;else{if(!this.setPosAtNextPart())return 0!==i&&(t.segmentLength=this.calculateSegLength(this._path,t.segment),t.isPartEnd=!0,1===i?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){if(0===r.length)if(0===s){var o=this._path[t.segment];r.push([o[0],o[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,s));var l=t.abscissa/t.segmentLength;if(1===l){var h=this._path[t.segment+1];r.push([h[0],h[1]])}else r.push(this.getSegCoord2D(this._path,t.segment,l))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._path,e.segment,t)}_getAngle(e){if(-1===e.segment)throw new Error("missing segment");var t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegAngleCS(this._path,e.segment,t)}setPosAtNextPart(){for(;this._partSegCount;)this.hasNextSegment()&&this.nextSegment(),this._partSegCount--;if(!this.hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this.hasNextSegment();)if(this._partLength+=this.calculateSegLength(this._path,this.nextSegment()),this._partSegCount++,1===Object(a.f)(this._path[this.getEndPointIndex()])){this._partIsLast=!this.hasNextSegment();break}for(var e=this._partSegCount;e;)this.previousSegment(),--e;this._currentPosition.segment=this.nextSegment(),this._currentPosition.segmentLength=this.calculateSegLength(this._path,this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;var t=this.getStartPointIndex();this._ctrlPtBegin=1===Object(a.f)(this._path[t]);var r=t+this._partSegCount+1;if(r>=this._path.length&&(r=0),this._ctrlPtEnd=1===Object(a.f)(this._path[r]),this._patternLength>0){var i=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,s=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap,n=Math.round((this._partLength-(i+s))/this._patternLength);n<=0&&(n=i+s>0?0:1),this._partLengthRatio=this._partLength/(i+s+n*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}hasNextSegment(){return this._seg<this._path.length-2}previousSegment(){return--this._seg}nextSegment(){return++this._seg}getStartPointIndex(){return this._seg}getEndPointIndex(){return this._seg+1}}class b{static local(){return null===b.instance&&(b.instance=new b),b.instance}execute(e,t,r){return new O(e,t,r)}}b.instance=null;class O extends a.a{constructor(e,t,r){super(e,!0,!0),this._walker=new x,this._walker.updateTolerance(r),this._endings=t.lineDashEnding,this._customDashPos=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._offsetAtEnd=void 0!==t.customEndingOffset?t.customEndingOffset*r:0,this._pattern=new v,this._pattern.init(t.dashTemplate,!0),this._pattern.scale(r)}processPath(e){if(0===this._pattern.length())return this.iteratePath=!1,{paths:[e]};if(!this.iteratePath){var t=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(t=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}var r=this._walker.calculatePathLength(e);if(this._pattern.isEmpty()||r<.1*this._pattern.length())return{paths:[e]};if(!this._walker.init(e,this._pattern,t))return{paths:[e]}}var i;if(this.iteratePath)i=this._pattern.nextValue();else{var s;switch(this._endings){case"HalfPattern":default:s=.5*this._pattern.firstValue();break;case"HalfGap":s=.5*-this._pattern.lastValue();break;case"FullGap":s=-this._pattern.lastValue();break;case"FullPattern":s=0;break;case"NoConstraint":case"Custom":s=-this._customDashPos}var a=s/this._pattern.length();s=(a-=Math.floor(a))*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();for(var n=!1;s>=i;)s-=i,i=this._pattern.nextValue(),n=!n;i-=s,n?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}var o=this._walker.nextCurve(i);return o?this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(this._firstCurve.splice(0,1),h.mergePath(o,this._firstCurve),this._firstCurve=null)):(i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(o=this._firstCurve,this._firstCurve=null)):this.iteratePath=!0):(this.iteratePath=!1,o=this._firstCurve,this._firstCurve=null),{paths:[o]}}}class w{static local(){return null===w.instance&&(w.instance=new w),w.instance}execute(e,t,r){return new S(e,t,r)}}w.instance=null;class S{constructor(e,t,r){switch(this._inputGeometries=e,this._curveHelper=new c,this._width=(void 0!==t.width?t.width:2)*r,t.method){case"Mitered":default:this._method="Mitered";break;case"Bevelled":this._method="Bevelled";break;case"Rounded":case"TrueBuffer":this._method="Rounded";break;case"Square":this._method="Square"}this._option=t.option,this._offsetFlattenError=l*r}next(){for(var e=this._inputGeometries.next();e;){if(Object(s.d)(e)&&this._width>0){if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)-2*this._width<0)return e;var t=[];return t.push([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t.push([[e.xmin+this._width,e.ymin+this._width],[e.xmax-this._width,e.ymin+this._width],[e.xmax-this._width,e.ymax-this._width],[e.xmin+this._width,e.ymax-this._width],[e.xmin+this._width,e.ymin+this._width]]),{rings:t}}if(Object(s.g)(e)&&this._width>0){var r=[];for(var i of e.rings){var a=this._curveHelper.calculatePathLength(i),n=this._curveHelper.offset(i,this._width,this._method,4,this._offsetFlattenError);n&&(a<0&&n.reverse(),r.push(n))}if(r.length)return{rings:r}}e=this._inputGeometries.next()}return null}}class j{static local(){return null===j.instance&&(j.instance=new j),j.instance}execute(e,t,r){return new M(e,t,r)}}j.instance=null;class M extends a.a{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new c,this._length=(void 0!==t.length?t.length:20)*r,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){if(this._curveHelper.isEmpty(e,!1))return null;var t=e[0],r=e[e.length-1],i=[r[0]-t[0],r[1]-t[1]];this._curveHelper.normalize(i);var s=[t[0]+(r[0]-t[0])*this._position/100,t[1]+(r[1]-t[1])*this._position/100],a=Math.cos((90-this._angle)/180*Math.PI),n=Math.sin((90-this._angle)/180*Math.PI);return this._mirror&&(n=-n),this._mirror=!this._mirror,{paths:[[t,[s[0]-this._length/2*a,s[1]-this._length/2*n],[s[0]+this._length/2*a,s[1]+this._length/2*n],r]]}}}class T{static local(){return null===T.instance&&(T.instance=new T),T.instance}execute(e,t,r){return new E(e,t,r)}}T.instance=null;class E{constructor(e,t,r){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?-t.offsetY*r:0}next(){for(var e=this._inputGeometries.next();e;){if(Object(s.d)(e))return{xmin:e.xmin+this._offsetX,xmax:e.xmax+this._offsetX,ymin:e.ymin+this._offsetY,ymax:e.ymax+this._offsetY};if(Object(s.g)(e)){var t=Object(i.a)(e);return this._moveMultipath(t.rings,this._offsetX,this._offsetY),t}if(Object(s.h)(e)){var r=Object(i.a)(e);return this._moveMultipath(r.paths,this._offsetX,this._offsetY),r}if(Object(s.e)(e)){var a=Object(i.a)(e);return this._movePath(a.points,this._offsetX,this._offsetY),a}if(Object(s.f)(e))return{x:e.x+this._offsetX,y:e.y+this._offsetY};e=this._inputGeometries.next()}return null}_moveMultipath(e,t,r){if(e)for(var i of e)this._movePath(i,t,r)}_movePath(e,t,r){if(e)for(var i of e)i[0]+=t,i[1]+=r}}class C{static local(){return null===C.instance&&(C.instance=new C),C.instance}execute(e,t,r){return new I(e,t,r)}}C.instance=null;class I{constructor(e,t,r){this._inputGeometries=e,this._curveHelper=new c,this._offset=(void 0!==t.offset?t.offset:1)*r,this._method=t.method,this._option=t.option,this._offsetFlattenError=l*r}next(){for(var e=this._inputGeometries.next();e;){if(0===this._offset)return e;if(Object(s.d)(e)){if("Rounded"===this._method&&this._offset>0){var t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],r=this._curveHelper.offset(t,this._offset,this._method,4,this._offsetFlattenError);return r?{rings:[r]}:null}if(Math.min(e.xmax-e.xmin,e.ymax-e.ymin)+2*this._offset>0)return{xmin:e.xmin-this._offset,xmax:e.xmax+this._offset,ymin:e.ymin-this._offset,ymax:e.ymax+this._offset}}if(Object(s.g)(e)){var i=[];for(var a of e.rings){var n=this._curveHelper.offset(a,this._offset,this._method,4,this._offsetFlattenError);n&&i.push(n)}if(i.length)return{rings:i}}if(Object(s.h)(e)){var o=[];for(var l of e.paths){var h=this._curveHelper.offset(l,this._offset,this._method,4,this._offsetFlattenError);h&&o.push(h)}if(o.length)return{paths:o}}e=this._inputGeometries.next()}return null}}class P{static local(){return null===P.instance&&(P.instance=new P),P.instance}execute(e,t,r){return new L(e,t,r)}}P.instance=null;class L{constructor(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){for(var e=this._inputGeometries.next();e;){if(!this._reverse)return e;if(Object(s.h)(e)){var t=Object(i.a)(e);return Object(a.h)(t.paths),t}e=this._inputGeometries.next()}return null}}var k,R,N=r(210),A=r(125);class z{static local(){return null===z.instance&&(z.instance=new z),z.instance}execute(e,t,r){return new D(e,t,r)}}z.instance=null;class D{constructor(e,t,r){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?-t.angle*Math.PI/180:0}next(){for(var e=this._inputGeometries.next();e;){if(0===this._rotateAngle)return e;var t=Object(A.i)();Object(N.a)(t,e);var r=(t[2]+t[0])/2,a=(t[3]+t[1])/2;if(Object(s.d)(e)){var n={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._rotateMultipath(n.rings,r,a),n}if(Object(s.g)(e)){var o=Object(i.a)(e);return this._rotateMultipath(o.rings,r,a),o}if(Object(s.h)(e)){var l=Object(i.a)(e);return this._rotateMultipath(l.paths,r,a),l}if(Object(s.e)(e)){var h=Object(i.a)(e);return this._rotatePath(h.points,r,a),h}if(Object(s.f)(e))return e;e=this._inputGeometries.next()}return null}_rotateMultipath(e,t,r){if(e)for(var i of e)this._rotatePath(i,t,r)}_rotatePath(e,t,r){if(e){var i=Math.cos(this._rotateAngle),s=Math.sin(this._rotateAngle);for(var a of e){var n=a[0]-t,o=a[1]-r;a[0]=t+n*i-o*s,a[1]=r+n*s+o*i}}}}class F{static local(){return null===F.instance&&(F.instance=new F),F.instance}execute(e,t,r){return new V(e,t,r)}}F.instance=null;class V{constructor(e,t,r){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){for(var e=this._inputGeometries.next();e;){if(1===this._xFactor&&1===this._yFactor)return e;var t=Object(A.i)();Object(N.a)(t,e);var r=(t[2]+t[0])/2,a=(t[3]+t[1])/2;if(Object(s.d)(e)){var n={rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]};return this._scaleMultipath(n.rings,r,a),n}if(Object(s.g)(e)){var o=Object(i.a)(e);return this._scaleMultipath(o.rings,r,a),o}if(Object(s.h)(e)){var l=Object(i.a)(e);return this._scaleMultipath(l.paths,r,a),l}if(Object(s.e)(e)){var h=Object(i.a)(e);return this._scalePath(h.points,r,a),h}if(Object(s.f)(e))return e;e=this._inputGeometries.next()}return null}_scaleMultipath(e,t,r){if(e)for(var i of e)this._scalePath(i,t,r)}_scalePath(e,t,r){if(e)for(var i of e){var s=(i[0]-t)*this._xFactor,a=(i[1]-r)*this._yFactor;i[0]=t+s,i[1]=r+a}}}class G{static local(){return null===G.instance&&(G.instance=new G),G.instance}execute(e,t,r){return new B(e,t,r)}}G.instance=null;class B{constructor(e,t,r){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*r,this._period=(void 0!==t.period?t.period:3)*r,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new v,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new x,this._walker.updateTolerance(r)}next(){for(var e=this._inputGeometries.next();e;){if(0===this._height||0===this._period)return e;if(Object(s.h)(e)){var t=this._processGeom(e.paths);if(t.length)return{paths:t}}if(Object(s.g)(e)){var r=this._processGeom(e.rings);if(r.length)return{rings:r}}e=this._inputGeometries.next()}return null}_processGeom(e){var t=[];for(var r of e)if(this._walker.init(r,this._pattern))switch(this._style){case"Sinus":default:t.push(this._constructCurve(r,!1));break;case"Square":t.push(this._constructSquare(r));break;case"Triangle":t.push(this._constructTriangle(r));break;case"Random":t.push(this._constructCurve(r,!0))}else t.push(r);return t}_constructCurve(e,t){var r=new h,i=this._walker.calculatePathLength(e),s=Math.round(i/this._period);0===s&&(s=1);var a=16*s+1,n=i/s,o=this._period/16,l=1/a,c=2*Math.PI*i/n,u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=2*Math.PI*Math.random(),p=.75-Math.random()/2,m=.75-Math.random()/2,_={};this._walker.curPointAndAngle(_),r.startPath(_.pt);for(var g=0;;){if(!this._walker.nextPointAndAngle(o,_)){r.lineTo(e[e.length-1]);break}var v=g,y=void 0;if(g+=l,t){var x=this._height/2*(1+.3*Math.sin(p*c*v+u));y=x*Math.sin(c*v+d),y+=x*Math.sin(m*c*v+f),y/=2}else y=.5*this._height*Math.sin(.5*c*v);r.lineTo([_.pt[0]-y*_.sa,_.pt[1]+y*_.ca])}return r.path()}_constructSquare(e){var t=new h,r=this._walker.calculatePathLength(e),i=Math.round(r/this._period);0===i&&(i=1);for(var s=!0;;){var a=!1;if(this._walker.curPositionIsValid()){var n={};this._walker.curPointAndAngle(n);var o={};if(this._walker.nextPointAndAngle(this._period,o)){var l={};this._walker.nextPointAndAngle(this._period,l)&&(s?(t.startPath(n.pt),s=!1):t.lineTo(n.pt),t.lineTo([n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca]),t.lineTo([o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca]),t.lineTo([o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca]),t.lineTo([l.pt[0]+this._height/2*l.sa,l.pt[1]-this._height/2*l.ca]),a=!0)}}if(!a){t.lineTo(this._walker.getPathEnd());break}}return t.path()}_constructTriangle(e){var t=new h,r=this._walker.calculatePathLength(e),i=Math.round(r/this._period);0===i&&(i=1);for(var s=!0;;){var a=!1;if(this._walker.curPositionIsValid()){var n={};this._walker.curPointAndAngle(n);var o={};if(this._walker.nextPointAndAngle(this._period/2,o)){var l={};this._walker.nextPointAndAngle(this._period,l)&&(this._walker.nextPosition(this._period/2)&&(s?(t.startPath(n.pt),s=!1):t.lineTo(n.pt),t.lineTo([o.pt[0]-this._height/2*o.sa,o.pt[1]+this._height/2*o.ca]),t.lineTo([l.pt[0]+this._height/2*l.sa,l.pt[1]-this._height/2*l.ca])),a=!0)}}if(!a){t.lineTo(this._walker.getPathEnd());break}}return t.path()}}(R=k||(k={})).NoConstraint="NoConstraint",R.WithMarkers="WithMarkers",R.WithFullGap="WithFullGap",R.WithHalfGap="WithHalfGap",R.Custom="Custom";class U{static local(){return null===U.instance&&(U.instance=new U),U.instance}execute(e,t,r){return new W(e,t,r)}}U.instance=null;class W extends a.b{constructor(e,t,r){super(e,!0,!0),this._grometryWalker=new x,this._grometryWalker.updateTolerance(r),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._originalEndings=t.endings,this._offsetAtEnd=void 0!==t.customEndingOffset?t.customEndingOffset*r:0,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._pattern=new v,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===k.WithFullGap&&this.isClosed?this._endings=k.WithMarkers:this._endings=this._originalEndings,this._pattern.extPtGap=0;var r,i=!0;switch(this._endings){case k.NoConstraint:r=-this._position,r=this._adjustPosition(r),i=!1;break;case k.WithHalfGap:default:r=-this._pattern.lastValue()/2;break;case k.WithFullGap:r=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case k.WithMarkers:r=0;break;case k.Custom:r=-this._position,r=this._adjustPosition(r),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._grometryWalker.init(e,this._pattern,i))return null;this._pattern.reset();for(var s=0;r>s;)r-=s,s=this._pattern.nextValue();t=s-=r,this.iteratePath=!0}var a={};return this._grometryWalker.nextPointAndAngle(t,a)?this._endings===k.WithFullGap&&this._grometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===k.WithMarkers&&this._grometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(a.pt[0]+this._offset*a.sa,a.pt[1]-this._offset*a.ca),this._angleToLine&&this.internalPlacement.setRotateCS(a.ca,a.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){var t=e/this._pattern.length();return(t-=Math.floor(t))*this._pattern.length()}}class q{static local(){return null===q.instance&&(q.instance=new q),q.instance}execute(e,t,r){return new H(e,t,r)}}q.instance=null;class H extends a.b{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new c,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._beginProcessed=!1}processPath(e){var t;switch(this._type){case"Both":default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);break;case"None":}return t}_atExtremities(e,t,r){var i=e.length;if(i<2)return null;for(var s,n=r?1:i-2,o=r?i:-1,l=r?1:-1,h=0,c=r?e[0]:e[i-1],u=n;u!==o;u+=l){s=c,c=e[u];var d=this._curveHelper.calculateLength(s,c);if(h+d>t){var f=(t-h)/d,[p,m]=this._curveHelper.getAngleCS(s,c,f),_=Object(a.e)(s,c,f);return this.internalPlacement.setTranslate(_[0]-this._offset*m,_[1]+this._offset*p),this._angleToLine&&this.internalPlacement.setRotateCS(-p,-m),this.internalPlacement}h+=d}return null}}class X{static local(){return null===X.instance&&(X.instance=new X),X.instance}execute(e,t,r){return new Y(e,t,r)}}X.instance=null;class Y extends a.b{constructor(e,t,r){super(e,!0,!0),this._walker=new x,this._walker.updateTolerance(r),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*r:0,this._endGap=void 0!==t.endPosition?t.endPosition*r:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new v,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;var t;if(this.iteratePath){var r=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+r;t=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=this._walker.calculatePathLength(e)-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();var s=this._pattern.nextValue()*this._subPathLen,a=this._beginGap+s;t=a-this._prevPos,this._prevPos=a,this.iteratePath=!0}var n={};if(!this._walker.nextPointAndAngle(t,n,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(n.pt[0]+this._offset*n.sa,n.pt[1]-this._offset*n.ca);var o,l,h=this._isFirst&&this._flipFirst;return this._angleToLine?(o=n.ca,l=n.sa):(o=1,l=0),h&&(o=-o,l=-l),this.internalPlacement.setRotateCS(o,l),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}var K=r(284);class Z{static local(){return null===Z.instance&&(Z.instance=new Z),Z.instance}execute(e,t,r){return new J(e,t,r)}}Z.instance=null;class J{constructor(e,t,r){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._stepX=(void 0!==t.stepX?Math.abs(t.stepX):16)*r,this._stepY=(void 0!==t.stepY?Math.abs(t.stepY):16)*r,0!==this._stepX&&0!==this._stepY&&e&&function(e){return void 0!==e.rings}(e)&&e.rings){if(this._gridType=void 0!==t.gridType?t.gridType:"Fixed","Random"===this._gridType)this._randomness=void 0!==t.randomness?t.randomness/100:1,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0;else{if(this._randomness=0,this._gridAngle=void 0!==t.gridAngle?t.gridAngle:0,this._shiftOddRows=void 0!==t.shiftOddRows&&t.shiftOddRows,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}this._graphicOriginX=0,this._graphicOriginY=0,this._internalPlacement=new K.a,this._calculateMinMax(e),this._geometry=e}}next(){return this._geometry?this._nextInside():null}_calculateMinMax(e){var t,r,i,s,a,n,o,l;for(var h of(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,a=n=Number.MAX_VALUE,o=l=-Number.MAX_VALUE,e.rings))for(var c=h?h.length:0,u=0;u<c;++u)t=h[u][0]-this._graphicOriginX-this._offsetX,r=h[u][1]-this._graphicOriginY-this._offsetY,i=this._cosAngle*t-this._sinAngle*r,s=this._sinAngle*t+this._cosAngle*r,a=Math.min(a,i),o=Math.max(o,i),n=Math.min(n,s),l=Math.max(l,s);a+=this._graphicOriginX,o+=this._graphicOriginX,n+=this._graphicOriginY,l+=this._graphicOriginY,this._xMin=Math.round(a/this._stepX),this._xMax=Math.round(o/this._stepX),this._yMin=Math.round(n/this._stepY),this._yMax=Math.round(l/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}var e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);var t=this._currentY*this._stepY+this._offsetY,r=void 0,i=void 0;return this._currentX++,"Random"===this._gridType?(r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-Math.random())*2/3,i=this._graphicOriginY+t+this._stepY*this._randomness*(.5-Math.random())*2/3):(r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,i=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t),this._internalPlacement.setTranslate(r,i),this._internalPlacement}}}class Q{static local(){return null===Q.instance&&(Q.instance=new Q),Q.instance}execute(e,t,r){return new $(e,t,r)}}Q.instance=null;class $ extends a.b{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new c,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*r:0,this._epsilon=.001*r}processPath(e){var t=this._position;if("SegmentMidpoint"===this._relativeTo){for(this.iteratePath||(this._segmentCount=e.length,this._curSegment=1,this.iteratePath=!0);this._curSegment<this._segmentCount;){var r=this._curSegment;this._curSegment++;var i=e[r-1],s=e[r],n=this._curveHelper.calculateLength(i,s);if(!(n<this._epsilon)){var o=.5+this._position/n,[l,h]=this._curveHelper.getAngleCS(i,s,o),c=Object(a.e)(i,s,o);return this.internalPlacement.setTranslate(c[0]-this._offset*h,c[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,h),this.internalPlacement}}return this.iteratePath=!1,null}"LineEnd"===this._relativeTo&&Object(a.i)(e);var u=this.onLine(e,t);return"LineEnd"===this._relativeTo&&Object(a.i)(e),u}onLine(e,t){var r,i=!1;switch(this._relativeTo){case"LineMiddle":default:r=this._curveHelper.calculatePathLength(e)/2+t;break;case"LineBeginning":r=t;break;case"LineEnd":r=t,i=!0}for(var s,n=e.length,o=0,l=e[0],h=1;h<n;++h){s=l,l=e[h];var c=this._curveHelper.calculateLength(s,l);if(o+c>r){var u=(r-o)/c,[d,f]=this._curveHelper.getAngleCS(s,l,u),p=Object(a.e)(s,l,u),m=i?this._offset:-this._offset;return this.internalPlacement.setTranslate(p[0]-m*f,p[1]+m*d),this._angleToLine&&(i?this.internalPlacement.setRotateCS(-d,-f):this.internalPlacement.setRotateCS(d,f)),this.internalPlacement}o+=c}return null}}class ee{static local(){return null===ee.instance&&(ee.instance=new ee),ee.instance}execute(e,t,r){return new te(e,t,r)}}ee.instance=null;class te extends a.b{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new c,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;var t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);var r=t[0],i=t[1];if(0!==this._offset){var s=Math.cos(t[2]),a=Math.sin(t[2]);r-=this._offset*a,i+=this._offset*s}return this.internalPlacement.setTranslate(r,i),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0;for(var t,r,i=Object(a.g)(e),s=e.length-1,n=0,o=0,l=0,h=0,c=0;n<s;){t=e[++n-1],r=e[n];var u=Object(a.f)(t),d=Object(a.f)(r);(this._angleToLine||0!==this._offset)&&(h=this._curveHelper.getAngle(t,r,0)),1===n?i?(o=h,l=u):this._endPoints&&this._tags.push([t[0],t[1],h]):1===u?this._controlPoints&&this._tags.push([t[0],t[1],re(c,h)]):this._regularVertices&&this._tags.push([t[0],t[1],re(c,h)]),(this._angleToLine||0!==this._offset)&&(c=this._curveHelper.getAngle(t,r,1)),n===s&&(i?1===d||1===l?this._controlPoints&&this._tags.push([r[0],r[1],re(c,o)]):this._regularVertices&&this._tags.push([r[0],r[1],re(c,o)]):this._endPoints&&this._tags.push([r[0],r[1],c]))}this._tagIterator=0}}function re(e,t){for(var r=Math.PI;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}class ie{static local(){return null===ie.instance&&(ie.instance=new ie),ie.instance}execute(e,t,r){return new se(e,t,r)}}ie.instance=null;class se{constructor(e,t,r){this._geometry=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._method=void 0!==t.method?t.method:"OnPolygon",this._internalPlacement=new K.a}next(){var e=this._geometry;return this._geometry=null,e&&function(e){return void 0!==e.rings}(e)?this._polygonCenter(e):null}_polygonCenter(e){var t=!1;switch(this._method){case"OnPolygon":default:case"CenterOfMass":case"BoundingBoxCenter":var r=Object(A.i)();Object(N.a)(r,e),this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2-this._offsetY),t=!0}return t?this._internalPlacement:null}}function ae(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return n.local();case"CIMGeometricEffectArrow":return d.local();case"CIMGeometricEffectBuffer":return p.local();case"CIMGeometricEffectCut":return _.local();case"CIMGeometricEffectDashes":return b.local();case"CIMGeometricEffectDonut":return w.local();case"CIMGeometricEffectJog":return j.local();case"CIMGeometricEffectMove":return T.local();case"CIMGeometricEffectOffset":return C.local();case"CIMGeometricEffectReverse":return P.local();case"CIMGeometricEffectRotate":return z.local();case"CIMGeometricEffectScale":return F.local();case"CIMGeometricEffectWave":return G.local()}return null}function ne(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return U.local();case"CIMMarkerPlacementAtExtremities":return q.local();case"CIMMarkerPlacementAtRatioPositions":return X.local();case"CIMMarkerPlacementInsidePolygon":return Z.local();case"CIMMarkerPlacementOnLine":return Q.local();case"CIMMarkerPlacementOnVertices":return ee.local();case"CIMMarkerPlacementPolygonCenter":return ie.local()}return null}},381:function(e,t,r){"use strict";t.a=class{constructor(e,t){this._pos=0;var r=t?this._roundToNearest(t,e.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(r),this._buffer=new e(this._array),this._ctor=e,this._i16View=new Int16Array(this._array)}get length(){return this._pos}_roundToNearest(e,t){var r=Math.round(e);return r+(t-r%t)}_ensureSize(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.5*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),i=new this._ctor(r);i.set(this._buffer,0),this._array=r,this._buffer=i,this._i16View=new Int16Array(this._array)}}writeF32(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}push(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}writeFixed(e){this._buffer[this._pos++]=e}setValue(e,t){this._buffer[e]=t}i1616Add(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}getValue(e){return this._buffer[e]}incr(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}decr(e){this._buffer[e]--}writeRegion(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}writeManyFrom(e,t,r){this._ensureSize(r-t);for(var i=t;i!==r;i++)this.writeFixed(e._buffer[i])}buffer(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}toArray(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}seek(e){this._pos=e}destroy(){this._array=null,this._buffer=null}}},382:function(e,t,r){"use strict";var i=r(82),s=(r(80),r(81)),a=(r(88),r(85)),n=r(84),o=(r(83),r(86),r(87),r(97)),l=r(131),h=r(266),c=r(227),u=r(167),d=class extends(Object(u.b)(Object(h.a)(Object(c.b)(l.a.EventedMixin(o.a))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t=this.layer&&this.layer.id||"no id",r=this.layer&&this.layer.title||"no title";throw s.a.getLogger(this.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(t,"')"),e),e}}))}get fullOpacity(){var e=e=>null==e?1:e;return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer.legendEnabled}get updating(){return!!(this.updatingHandles&&this.updatingHandles.updating||this.isUpdating())}get visible(){return!0===this.get("layer.visible")}set visible(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}canResume(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1}getSuspendInfo(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};Object(i.a)([Object(a.b)()],d.prototype,"fullOpacity",null),Object(i.a)([Object(a.b)()],d.prototype,"layer",void 0),Object(i.a)([Object(a.b)()],d.prototype,"parent",void 0),Object(i.a)([Object(a.b)({readOnly:!0})],d.prototype,"suspended",null),Object(i.a)([Object(a.b)({readOnly:!0})],d.prototype,"suspendInfo",null),Object(i.a)([Object(a.b)({readOnly:!0})],d.prototype,"legendEnabled",null),Object(i.a)([Object(a.b)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),Object(i.a)([Object(a.b)()],d.prototype,"visible",null);var f=d=Object(i.a)([Object(n.a)("esri.views.layers.LayerView")],d);t.a=f},384:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));var i,s=r(82),a=(r(80),r(81),r(88),r(85)),n=r(84),o=(r(83),r(86),r(87),r(107)),l=r(293),h=r(108),c=r(90),u=class extends c.a{},d=u=Object(s.a)([Object(n.a)("esri.views.layers.support.ClipArea")],u),f=i=class extends d{constructor(){super(...arguments),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new i({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}get version(){return(this._get("version")||0)+1}};Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],f.prototype,"left",void 0),Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],f.prototype,"right",void 0),Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],f.prototype,"top",void 0),Object(s.a)([Object(a.b)({type:[Number,String],json:{write:!0}})],f.prototype,"bottom",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],f.prototype,"version",null);var p,m=f=i=Object(s.a)([Object(n.a)("esri.views.layers.support.ClipRect")],f),_=r(492),g=r(166),v=r(103),y=r(130),x=r(100),b=(r(101),{base:g.a,key:"type",typeMap:{extent:v.a,polygon:y.a}}),O=p=class extends d{constructor(){super(...arguments),this.type="geometry",this.geometry=null}get version(){return(this._get("version")||0)+1}clone(){return new p({geometry:this.geometry.clone()})}};Object(s.a)([Object(a.b)({types:b,json:{read:x.a,write:!0}})],O.prototype,"geometry",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],O.prototype,"version",null);var w=O=p=Object(s.a)([Object(n.a)("esri.views.layers.support.Geometry")],O),S=class extends d{constructor(){super(...arguments),this.type="path",this.path=[]}get version(){return(this._get("version")||0)+1}};Object(s.a)([Object(a.b)({type:[[[Number]]],json:{write:!0}})],S.prototype,"path",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],S.prototype,"version",null);var j=S=Object(s.a)([Object(n.a)("esri.views.layers.support.Path")],S),M=o.a.ofType({key:"type",base:d,typeMap:{rect:m,path:j,geometry:w}}),T=e=>{var t=class extends e{constructor(){super(...arguments),this.clips=new M,this.moving=!1,this.attached=!1,this.lastUpdateId=-1,this.updateRequested=!1}initialize(){var e;this.container||(this.container=new _.a),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([Object(h.a)(this,"suspended",(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),!0),Object(h.a)(this,["layer.opacity","container"],(()=>{var e,t;this.container&&(this.container.opacity=null!=(e=null==(t=this.layer)?void 0:t.opacity)?e:1)}),!0),Object(h.a)(this,["layer.blendMode"],(e=>{this.container&&(this.container.blendMode=e)}),!0),Object(h.a)(this,["layer.effect"],(e=>{this.container&&(this.container.effect=e)}),!0),this.clips.on("change",(()=>{this.container.clips=this.clips,this.notifyChange("clips")}))]),null!=(e=this.view)&&e.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e!==this||this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{})):this.when().then((()=>{this.attached||this.destroyed||(this.attach(),this.requestUpdate(),this.attached=!0)}),(()=>{}))}destroy(){this.attached&&(this.detach(),this.attached=!1),this.handles.remove("initialize"),this.updateRequested=!1}get updating(){return!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())}isVisibleAtScale(e){var t=!0,r=this.layer,i=r.minScale,s=r.maxScale;if(null!=i&&null!=s){var a=!i,n=!s;!a&&e<=i&&(a=!0),!n&&e>=s&&(n=!0),t=a&&n}return t}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}isUpdating(){return!1}isRendering(){return!1}canResume(){return!!super.canResume()&&this.isVisibleAtScale(this.view.scale)}};return Object(s.a)([Object(a.b)({type:M,set(e){var t=Object(l.b)(e,this._get("clips"),M);this._set("clips",t)}})],t.prototype,"clips",void 0),Object(s.a)([Object(a.b)()],t.prototype,"moving",void 0),Object(s.a)([Object(a.b)()],t.prototype,"attached",void 0),Object(s.a)([Object(a.b)()],t.prototype,"container",void 0),Object(s.a)([Object(a.b)()],t.prototype,"suspended",void 0),Object(s.a)([Object(a.b)({readOnly:!0})],t.prototype,"updateParameters",void 0),Object(s.a)([Object(a.b)()],t.prototype,"updateRequested",void 0),Object(s.a)([Object(a.b)()],t.prototype,"updating",null),Object(s.a)([Object(a.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(n.a)("esri.views.2d.layers.LayerView2D")],t)}},400:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return _})),r.d(t,"c",(function(){return v}));var i=r(7),s=r(112),a=r(161),n=r(223),o=r(428),l=[0,0];function h(e,t){if(!t)return null;if("x"in t){var r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,l),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){var i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,l),[i.xmax,i.ymax]=e(t.xmax,t.ymax,l),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:u(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:void 0}function c(e,t){var r=[];for(var i of e)r.push(u(i,t));return r}function u(e,t){var r=[];for(var i of e){var s=t(i[0],i[1],[0,0]);r.push(s),i.length>2&&s.push(i[2]),i.length>3&&s.push(i[3])}return r}function d(e,t){return f.apply(this,arguments)}function f(){return(f=Object(i.a)((function*(e,t){if(t){var r=Array.isArray(e)?e.map((e=>{var t;return null==(t=e.geometry)?void 0:t.spatialReference})):[e];yield Object(n.f)(r.map((e=>({source:e,dest:t}))))}}))).apply(this,arguments)}var p=h.bind(null,a.c),m=h.bind(null,a.g);function _(e,t,r){return e?(r||(r=t,t=e.spatialReference),Object(s.i)(t)&&Object(s.i)(r)&&!Object(s.c)(t,r)?Object(a.a)(t,r)?Object(s.m)(r)?p(e):m(e):Object(n.m)(o.a,[e],t,r,null)[0]:e):e}var g=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(e,t,r){var a=this;return Object(i.a)((function*(){!e||!e.length||!t||!r||Object(s.c)(t,r);var i={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return a._jobs.push(i),new Promise((e=>{i.resolve=e,null===a._timer&&(a._timer=setTimeout(a._process,10))}))}))()}_process(){this._timer=null;var e=this._jobs.shift();if(e){var{geometries:t,inSpatialReference:r,outSpatialReference:i,resolve:l}=e;Object(a.a)(r,i)?Object(s.m)(i)?l(t.map(p)):l(t.map(m)):l(Object(n.m)(o.a,t,r,i,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}}};function v(e,t,r){return y.apply(this,arguments)}function y(){return(y=Object(i.a)((function*(e,t,r){return g.push(e,t,r)}))).apply(this,arguments)}},404:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r(80);var i=r(305),s=r(245),a=r(395),n=r(415);class o extends n.a{constructor(e,t,r,i=r){super(),this.triangleCountReportedInDebug=0,this.transforms={dvs:Object(a.b)(),tileMat3:Object(a.b)()},this.triangleCount=0,this.key=new s.a(e),this.bounds=t,this.size=r,this.coordRange=i}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}get coords(){return this._coords}get bounds(){return this._bounds}set bounds(e){this._coords=[e[0],e[3]],this._bounds=e}setTransform(e,t){var r=t/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,[a,n]=e.toScreenNoRotation([0,0],this.coords),o=this.size[0]/this.coordRange[0]*r,l=this.size[1]/this.coordRange[1]*r;Object(i.j)(s,o,0,0,0,l,0,a,n,1),Object(i.g)(this.transforms.dvs,e.displayViewMat3,s)}}},405:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t){this._mask=0,this._buf=e,this._mask=t}static fromBuffer(e,t){return new i(e,t)}static create(e,t=4294967295){var r=new Uint32Array(Math.ceil(e/32));return new i(r,t)}_getIndex(e){return Math.floor(e/32)}has(e){var t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){for(var r=e,i=t;r%32&&r!==i;){if(this.has(r))return!0;r++}for(;i%32&&r!==i;){if(this.has(r))return!0;i--}if(r===i)return!1;for(var s=r/32;s!==i/32;s++)if(this._buf[s])return!0;return!1}set(e){var t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]|=i}setRange(e,t){for(var r=e,i=t;r%32&&r!==i;)this.set(r++);for(;i%32&&r!==i;)this.set(i--);if(r!==i)for(var s=r/32;s!==i/32;s++)this._buf[s]=4294967295}unset(e){var t=this._mask&e,r=this._getIndex(t),i=1<<t%32;this._buf[r]&=4294967295^i}resize(e){var t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(var t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(var t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(var t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(var t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(var t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(var t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(var e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(var t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new i(this._buf.slice(),this._mask)}clear(){for(var e=0;e<this._buf.length;e++)this._buf[e]=0}forEachSet(e){for(var t=0;t<this._buf.length;t++){var r=this._buf[t],i=32*t;if(r)for(;r;)1&r&&e(i),r>>>=1,i++}}countSet(){var e=0;return this.forEachSet((t=>{e++})),e}}},406:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(81),s=r(93),a=r(127),n=r(151),o=i.a.getLogger("esri.views.2d.engine.webgl");function l(e){return Object(n.o)(e.minDataValue)&&Object(n.o)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.e.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.e.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.e.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.e.SIZE_UNIT_VALUE:(o.error(new s.a("mapview-bad-type","Found invalid size VisualVariable",e)),a.e.NONE)}},407:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));r(80);var i=r(89),s=r(100),a=(r(101),r(178)),n=r(168),o=r(469),l=r(405),h=0;class c{constructor(e){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._xmin=-1,this._xmax=0,this._ymin=0,this._ymax=0,this._deleted=null,this._joined=[],this.instance=e}static createInstance(){return h=++h>65535?0:h}get isEmpty(){return Object(i.k)(this._deleted)&&this._deleted.countSet()===this.getApproximateSize()}get _hasFilter(){return-1!==this._xmin}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,i){var s=this.copy();return s._tx+=e,s._ty+=t,s._sx*=r,s._sy*=i,s}extent(e,t,r,i){var s=this.copy();return s._xmin=e,s._xmax=r,s._ymin=t,s._ymax=i,s}hasFilter(){return this._hasFilter}readAttribute(e,t=!1){var r=this._readAttribute(e,t);if(void 0!==r)return r;for(var i of this._joined){i.setIndex(this.getIndex());var s=i._readAttribute(e,t);if(void 0!==s)return s}}readAttributes(){return this._readAttributes()}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){var e=this.readHydratedGeometry(),t=Object(n.k)(e,this.geometryType,this.hasZ,this.hasM),r=Object(s.a)(t);return r.spatialReference=this._arcadeSpatialReference,r}field(e){return this.readAttribute(e,!0)}hasField(e){return!0}setField(e,t){}keys(){return[]}castToText(){return""}removeAtIndex(e){Object(i.j)(this._deleted)&&(this._deleted=l.a.create(this.getApproximateSize())),this._deleted.set(e)}_getExists(){return Object(i.j)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;var e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;var t=Object(i.r)(this.getQuantizationTransform(),null);return Object(o.a)(new a.a,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._xmin=this._xmin,e._xmax=this._xmax,e._ymin=this._ymin,e._ymax=this._ymax}}},418:function(e,t,r){"use strict";r.d(t,"a",(function(){return G})),r.d(t,"b",(function(){return b}));var i=r(91),s=r(7),a=r(143),n=r(81),o=r(152),l=r(109),h=r(105),c=r(320),u=r(419),d=r(352),f=r(493),p=n.a.getLogger("esri.symbols.cim.cimAnalyzer");function m(e){switch(e){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function _(e){switch(e){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function g(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function v(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function y(e,t,r,i){var s;e[t]?s=e[t]:(s={},e[t]=s),s[r]=i}function x(e){var t=e.markerPlacement;return t&&t.angleToLine?1:0}function b(e,t,r,i){return O.apply(this,arguments)}function O(){return(O=Object(s.a)((function*(e,t,r,i){var s,a,n=r||[];if(!e)return n;var l={};if("CIMSymbolReference"!==e.type)return p.error("Expect cim type to be 'CIMSymbolReference'"),n;if(s=e.symbol,a=e.primitiveOverrides){var h=[],c=function(e){var r=e.valueExpressionInfo;if(r&&t){var i=r.expression,s=Object(o.d)(i,t.spatialReference,t.fields).then((t=>{t&&y(l,e.primitiveName,e.propertyName,t)}));h.push(s)}else null!=e.value&&y(l,e.primitiveName,e.propertyName,e.value)};for(var u of a)c(u);yield Promise.all(h)}switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":w(s,a,l,t,n,i)}return n}))).apply(this,arguments)}function w(e,t,r,i,s,a){if(e){var n=e.symbolLayers;if(n){var o,l=d.a.getSize(e);"CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(o=1);for(var h=n.length;h--;){var c=n[h];if(c&&!1!==c.enable){var u=[];switch(d.b.findApplicableOverrides(c,t,u),c.type){case"CIMSolidFill":S(c,r,u,i,s);break;case"CIMPictureFill":j(c,r,u,i,s);break;case"CIMHatchFill":M(c,r,u,i,s);break;case"CIMGradientFill":T(c,r,u,i,s);break;case"CIMSolidStroke":E(c,r,u,i,s,"CIMPolygonSymbol"===e.type,l);break;case"CIMPictureStroke":C(c,r,u,i,s,"CIMPolygonSymbol"===e.type,l);break;case"CIMGradientStroke":I(c,r,u,i,s,"CIMPolygonSymbol"===e.type,l);break;case"CIMCharacterMarker":if(P(c,r,u,i,s))break;break;case"CIMPictureMarker":if(P(c,r,u,i,s))break;"CIMLineSymbol"===e.type&&(o=x(c)),L(c,r,u,i,s,o,l);break;case"CIMVectorMarker":if(P(c,r,u,i,s))break;"CIMLineSymbol"===e.type&&(o=x(c)),k(c,r,u,i,s,o,l,a);break;default:p.error("Cannot analyze CIM layer",c.type)}}}}}}function S(e,t,r,i,s){var n=e.primitiveName,o=Object(c.e)(e.color),l=Object(a.b)(JSON.stringify(e)).toString();s.push({type:"fill",templateHash:l,materialHash:0===r.length?l:()=>l,cim:e,materialOverrides:null,colorLocked:e.colorLocked,color:F(n,t,"Color",i,o,D),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:e.effects})}function j(e,t,r,i,s){var n=e.primitiveName,o=e.tintColor?Object(c.e)(e.tintColor):{r:255,g:255,b:255,a:1},l=Object(a.b)(JSON.stringify(e)).toString(),h=Object(a.b)("".concat(e.url).concat(JSON.stringify(e.colorSubstitutions))).toString();s.push({type:"fill",templateHash:l,materialHash:0===r.length?h:()=>h,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:F(n,t,"TintColor",i,o,D),height:F(n,t,"Height",i,e.height),scaleX:F(n,t,"ScaleX",i,e.scaleX),angle:F(n,t,"Rotation",i,e.rotation),offsetX:F(n,t,"OffsetX",i,e.offsetX),offsetY:F(n,t,"OffsetY",i,e.offsetY)})}function M(e,t,r,i,s){var n=["Rotation","OffsetX","OffsetY"],o=r.filter((t=>t.primitiveName!==e.primitiveName&&-1===n.indexOf(t.propertyName))),l=e.primitiveName,h=Object(a.b)(JSON.stringify(e)).toString(),c=Object(a.b)("".concat(e.separation).concat(JSON.stringify(e.lineSymbol))).toString();s.push({type:"fill",templateHash:h,materialHash:0===r.length?c:V(c,t,o,i),cim:e,materialOverrides:o,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:F(l,t,"Separation",i,e.separation),scaleX:1,angle:F(l,t,"Rotation",i,e.rotation),offsetX:F(l,t,"OffsetX",i,e.offsetX),offsetY:F(l,t,"OffsetY",i,e.offsetY)})}function T(e,t,r,i,s){var n=Object(a.b)(JSON.stringify(e)).toString();s.push({type:"fill",templateHash:n,materialHash:0===r.length?n:V(n,t,r,i),cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function E(e,t,r,i,s,n,o){var l=Object(a.b)(JSON.stringify(e)).toString(),h=e.primitiveName,u=Object(c.e)(e.color),d=void 0!==e.width?e.width:4,f=m(e.capStyle),p=_(e.joinStyle),g=e.miterLimit;s.push({type:"line",templateHash:l,materialHash:0===r.length?l:()=>l,cim:e,materialOverrides:null,isOutline:n,colorLocked:e.colorLocked,effects:e.effects,color:F(h,t,"Color",i,u,D),width:F(h,t,"Width",i,d),cap:F(h,t,"CapStyle",i,f),join:F(h,t,"JoinStyle",i,p),miterLimit:F(h,t,"MiterLimit",i,g),referenceWidth:o,zOrder:z(e.name),isDashed:!1})}function C(e,t,r,i,s,n,o){var l=Object(a.b)("".concat(e.url).concat(JSON.stringify(e.colorSubstitutions))).toString(),h=e.primitiveName,u=Object(c.e)(e.tintColor),d=void 0!==e.width?e.width:4,f=m(e.capStyle),p=_(e.joinStyle),g=e.miterLimit,v=Object(a.b)(JSON.stringify(e)).toString();s.push({type:"line",templateHash:v,materialHash:0===r.length?l:()=>l,cim:e,materialOverrides:null,isOutline:n,colorLocked:e.colorLocked,effects:e.effects,color:F(h,t,"TintColor",i,u,D),width:F(h,t,"Width",i,d),cap:F(h,t,"CapStyle",i,f),join:F(h,t,"JoinStyle",i,p),miterLimit:F(h,t,"MiterLimit",i,g),referenceWidth:o,zOrder:z(e.name),isDashed:!1})}function I(e,t,r,i,s,n,o){var l=e.primitiveName,h=void 0!==e.width?e.width:4,c=m(e.capStyle),u=_(e.joinStyle),d=e.miterLimit,f=Object(a.b)(JSON.stringify(e)).toString();s.push({type:"line",templateHash:f,materialHash:0===r.length?f:V(f,t,r,i),cim:e,materialOverrides:null,isOutline:n,colorLocked:e.colorLocked,effects:e.effects,color:{r:128,g:128,b:128,a:1},width:F(l,t,"Width",i,h),cap:F(l,t,"CapStyle",i,c),join:F(l,t,"JoinStyle",i,u),miterLimit:F(l,t,"MiterLimit",i,d),referenceWidth:o,zOrder:z(e.name),isDashed:!1})}function P(e,t,r,i,s){var n=e.markerPlacement;if(!n||"CIMMarkerPlacementInsidePolygon"!==n.type)return!1;var o=n,l=["Rotation","OffsetX","OffsetY"],h=r.filter((t=>t.primitiveName!==e.primitiveName&&-1===l.indexOf(t.propertyName))),c=Object(a.b)(JSON.stringify(e)).toString();return s.push({type:"fill",templateHash:c,materialHash:0===r.length?c:V(c,t,h,i),cim:e,materialOverrides:h,colorLocked:e.colorLocked,effects:e.effects,color:{r:255,g:255,b:255,a:1},height:F(o.primitiveName,t,"StepY",i,o.stepY),scaleX:1,angle:F(o.primitiveName,t,"GridAngle",i,o.gridAngle),offsetX:F(o.primitiveName,t,"OffsetX",i,o.offsetX),offsetY:F(o.primitiveName,t,"OffsetY",i,o.offsetY)}),!0}function L(e,t,r,i,s,n,o){var l=e.primitiveName,h=e.size,u=e.scaleX,d=e.rotation,f=e.offsetX,p=e.offsetY,m=Object(c.e)(e.tintColor),_=Object(a.b)("".concat(e.url).concat(JSON.stringify(e.colorSubstitutions))).toString(),g=!1,v="";for(var y of r)y.primitiveName===l&&(void 0!==y.value?v+="-".concat(y.primitiveName,"-").concat(y.propertyName,"-").concat(JSON.stringify(y.value)):y.valueExpressionInfo&&(g=!0));s.push({type:"marker",templateHash:Object(a.b)(JSON.stringify(e)+v).toString(),materialHash:g?()=>_:_,cim:e,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:!1,alignment:n,size:F(l,t,"Size",i,h),scaleX:F(l,t,"ScaleX",i,u),rotation:F(l,t,"Rotation",i,d),offsetX:F(l,t,"OffsetX",i,f),offsetY:F(l,t,"OffsetY",i,p),color:F(l,t,"TintColor",i,m,D),anchorPoint:e.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:e.rotateClockwise,referenceSize:o,sizeRatio:1,markerPlacement:e.markerPlacement})}function k(e,t,r,i,s,a,n,o){var l=e.markerGraphics;if(l){var h=0;if(e.scaleSymbolsProportionally){var c=e.frame;c&&(h=c.ymax-c.ymin)}for(var u of l)if(u){var d=u.symbol;if(!d)continue;switch(d.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":N(e,u,r,t,i,s,a,n,h,o);break;case"CIMTextSymbol":R(e,u,t,r,i,s,a,n,h)}}}}function R(e,t,r,s,n,o,l,h,u){d.b.findApplicableOverrides(t,s,[]);var f=t.geometry;if("x"in f&&"y"in f){var p,m=t.symbol,_=(p=m).underline?"underline":p.strikethrough?"line-through":"none",y=function(e){var t="normal",r="normal";if(e){var i=e.toLowerCase();-1!==i.indexOf("italic")?t="italic":-1!==i.indexOf("oblique")&&(t="oblique"),-1!==i.indexOf("bold")?r="bold":-1!==i.indexOf("light")&&(r="lighter")}return{style:t,weight:r}}(m.fontStyleName);m.font=Object(i.a)({family:m.fontFamilyName,decoration:_},y);var x=e.frame,b=f.x-.5*(x.xmin+x.xmax),O=f.y-.5*(x.ymin+x.ymax),w=e.size/u,S=e.primitiveName,j=(m.height||0)*w,M=m.angle||0,T=((m.offsetX||0)+b)*w,E=((m.offsetY||0)+O)*w,C=Object(c.e)(d.a.getFillColor(m)),I=Object(c.e)(d.a.getStrokeColor(m)),P=d.a.getStrokeWidth(m);P||(I=Object(c.e)(d.a.getFillColor(m.haloSymbol)),P=m.haloSize*w);var L="";for(var k of s)k.primitiveName===S&&void 0!==k.value&&(L+="-".concat(k.primitiveName,"-").concat(k.propertyName,"-").concat(JSON.stringify(k.value)));var R=JSON.stringify(e.effects)+Number(e.colorLocked)+JSON.stringify(e.anchorPoint)+e.anchorPointUnits+JSON.stringify(e.markerPlacement),N=Object(a.b)(JSON.stringify(t)+R+L).toString();o.push({type:"text",templateHash:N,materialHash:()=>Object(a.b)(JSON.stringify(m.font)).toString(),cim:m,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,alignment:l,anchorPoint:{x:e.anchorPoint?e.anchorPoint.x:0,y:e.anchorPoint?e.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,fontName:m.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:F(S,r,"Size",n,j),angle:F(S,r,"Rotation",n,M),offsetX:F(S,r,"OffsetX",n,T),offsetY:F(S,r,"OffsetY",n,E),horizontalAlignment:g(m.horizontalAlignment),verticalAlignment:v(m.verticalAlignment),text:F(t.primitiveName,r,"TextString",n,t.textString,c.a,m.textCase),color:C,outlineColor:I,outlineSize:P,referenceSize:h,sizeRatio:1,markerPlacement:e.markerPlacement})}}function N(e,t,r,s,n,o,l,h,u,p){var m=t.symbol,_=t.geometry;if(_){var g=m.symbolLayers;if(g)if(p)A(e,t,s,r,n,o,l,h,u);else for(var v=g.length;v--;){var y=g[v];if(y&&!1!==y.enable)switch(y.type){case"CIMSolidFill":case"CIMSolidStroke":var x=function(){var p=Object(f.b)(_);if(!p)return"continue";var[m,g,v]=Object(f.d)(p,e.frame,e.size,e.anchorPoint,"Relative"!==e.anchorPointUnits),x="CIMSolidFill"===y.type,b={type:"sdf",geom:_,asFill:x},O=e.primitiveName,w=e.size,S=e.rotation||0,j=e.offsetX,M=e.offsetY,T=y.primitiveName,E=Object(c.e)(x?d.a.getFillColor(y):d.a.getStrokeColor(y)),C=x?{r:0,g:0,b:0,a:0}:Object(c.e)(d.a.getStrokeColor(y)),I=d.a.getStrokeWidth(y);if(!x&&!I)return"break";var P=!1,L="";for(var k of r)k.primitiveName!==T&&k.primitiveName!==O||(void 0!==k.value?L+="-".concat(k.primitiveName,"-").concat(k.propertyName,"-").concat(JSON.stringify(k.value)):k.valueExpressionInfo&&(P=!0));var R=JSON.stringify(Object(i.a)(Object(i.a)({},e),{},{markerGraphics:null})),N=Object(a.b)(JSON.stringify(b)).toString(),A={type:"marker",templateHash:Object(a.b)(JSON.stringify(t)+JSON.stringify(y)+R+L).toString(),materialHash:P?()=>N:N,cim:b,materialOverrides:null,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:l,anchorPoint:{x:g,y:v},isAbsoluteAnchorPoint:!1,size:F(e.primitiveName,s,"Size",n,w),rotation:F(e.primitiveName,s,"Rotation",n,S),offsetX:F(e.primitiveName,s,"OffsetX",n,j),offsetY:F(e.primitiveName,s,"OffsetY",n,M),scaleX:1,frameHeight:u,rotateClockwise:e.rotateClockwise,referenceSize:h,sizeRatio:m,color:F(T,s,"Color",n,E,D),outlineColor:F(T,s,"Color",n,C,D),outlineWidth:F(T,s,"Width",n,I),markerPlacement:e.markerPlacement};return o.push(A),"break"}();if("continue"===x)continue;if("break"===x)break;default:A(e,t,s,r,n,o,l,h,u)}}}}function A(e,t,r,i,s,n,o,l,c){var u,f=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath,effects:e.effects}}(e,t),p=["Rotation","OffsetX","OffsetY"];u=i.filter((t=>t.primitiveName!==e.primitiveName||-1===p.indexOf(t.propertyName)));var m="";for(var _ of i)void 0!==_.value&&(m+="-".concat(_.primitiveName,"-").concat(_.propertyName,"-").concat(JSON.stringify(_.value)));var[g,v,y]=d.a.getTextureAnchor(f),x=e.primitiveName,b=e.rotation||0,O=e.offsetX||0,w=e.offsetY||0,S=Object(a.b)(JSON.stringify(f)+m).toString(),j={type:"marker",templateHash:S,materialHash:0===u.length?S:V(S,r,u,s),cim:f,materialOverrides:u,colorLocked:e.colorLocked,effects:e.effects,scaleSymbolsProportionally:e.scaleSymbolsProportionally,alignment:o,anchorPoint:{x:g,y:v},isAbsoluteAnchorPoint:!1,size:e.size,rotation:F(x,r,"Rotation",s,b),offsetX:F(x,r,"OffsetX",s,O),offsetY:F(x,r,"OffsetY",s,w),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:c,rotateClockwise:e.rotateClockwise,referenceSize:l,sizeRatio:y/Object(h.h)(e.size),markerPlacement:e.markerPlacement};n.push(j)}function z(e){if(e&&0===e.indexOf("Level_")){var t=parseInt(e.substr(6),10);if(NaN!==t)return t}return 0}function D(e){if(!e||0===e.length)return null;var t=new l.a(e).toRgba();return{r:t[0],g:t[1],b:t[2],a:t[3]}}function F(e,t,r,i,s,a,n){var l=t[e];if(l){var h=l[r];if("string"==typeof h||"number"==typeof h||h instanceof Array)return a?a.call(null,h,n):h;if(null!=h&&h instanceof o.a)return(e,t,r)=>{var o=Object(u.a)(h,e,{$view:r},i.geometryType,t);return null!==o&&a&&(o=a.call(null,o,n)),null!==o?o:s}}return s}function V(e,t,r,i){for(var s of r)s.valueExpressionInfo&&function(){var e=t[s.primitiveName]&&t[s.primitiveName][s.propertyName];e instanceof o.a&&(s.fn=(t,r,s)=>Object(u.a)(e,t,{$view:s},i.geometryType,r))}();return(t,i,s)=>{for(var n of r)n.fn&&(n.value=n.fn(t,i,s));return Object(a.b)(e+d.b.buildOverrideKey(r)).toString()}}function G(e,t){if(!t||0===t.length)return e;var r=JSON.parse(JSON.stringify(e));return d.b.applyOverrides(r,t),r}},419:function(e,t,r){"use strict";var i=r(91),s=r(81),a=r(93),n=r(311);var o=new Map;function l(e,t,r){var{transform:l,hasZ:h,hasM:c}=r;o.has(t)||o.set(t,function(e){var t={};switch(e){case"esriGeometryPoint":return(e,r,i,s)=>Object(n.e)(r,t,e,i,s);case"esriGeometryPolygon":return(e,r,i,s)=>Object(n.f)(r,t,e,i,s);case"esriGeometryPolyline":return(e,r,i,s)=>Object(n.g)(r,t,e,i,s);case"esriGeometryMultipoint":return(e,r,i,s)=>Object(n.d)(r,t,e,i,s);default:return s.a.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a.a("mapview-arcade","Unable to handle geometryType: ".concat(e))),e=>e}}(t));var u=o.get(t)(e.geometry,l,h,c);return Object(i.a)(Object(i.a)({},e),{},{geometry:u})}t.a=function(e,t,r,a,n){var o=e.referencesGeometry()&&n?l(t,a,n):t,h=e.repurposeFeature(o);try{return e.evaluate(Object(i.a)(Object(i.a)({},r),{},{$feature:h}))}catch(c){return s.a.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",c),null}}},420:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(497);function s(e,t){if(!(this instanceof s))return new s(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function a(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function n(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,i,s){s||(s=g(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var a,n=t;n<r;n++)a=e.children[n],l(s,e.leaf?i(a):a);return s}function l(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function h(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,s-r)*Math.max(0,a-i)}function m(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function g(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,t,r,s,a){for(var n,o=[t,r];o.length;)(r=o.pop())-(t=o.pop())<=s||(n=t+Math.ceil((r-t)/s/2)*s,Object(i.a)(e,n,t,r,a),o.push(t,n,n,r))}s.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],i=this.toBBox;if(!_(e,t))return r;for(var s,a,n,o,l=[];t;){for(s=0,a=t.children.length;s<a;s++)n=t.children[s],_(e,o=t.leaf?i(n):n)&&(t.leaf?r.push(n):m(e,o)?this._all(n,r):l.push(n));t=l.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!_(e,t))return!1;for(var i,s,a,n,o=[];t;){for(i=0,s=t.children.length;i<s;i++)if(a=t.children[i],_(e,n=t.leaf?r(a):a)){if(t.leaf||m(e,n))return!0;o.push(a)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var s=this.data;this.data=i,i=s}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=g([]),this},remove:function(e,t){if(!e)return this;for(var r,i,s,n,o=this.data,l=this.toBBox(e),h=[],c=[];o||h.length;){if(o||(o=h.pop(),i=h[h.length-1],r=c.pop(),n=!0),o.leaf&&-1!==(s=a(e,o.children,t)))return o.children.splice(s,1),h.push(o),this._condense(h),this;n||o.leaf||!m(o,l)?i?(r++,o=i.children[r],n=!1):o=null:(h.push(o),c.push(r),r=0,i=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:h,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,i){var s,a=r-t+1,o=this._maxEntries;if(a<=o)return n(s=g(e.slice(t,r+1)),this.toBBox),s;i||(i=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,i-1))),(s=g([])).leaf=!1,s.height=i;var l,h,c,u,d=Math.ceil(a/o),f=d*Math.ceil(Math.sqrt(o));for(v(e,t,r,f,this.compareMinX),l=t;l<=r;l+=f)for(v(e,l,c=Math.min(l+f-1,r),d,this.compareMinY),h=l;h<=c;h+=d)u=Math.min(h+d-1,c),s.children.push(this._build(e,h,u,i-1));return n(s,this.toBBox),s},_chooseSubtree:function(e,t,r,i){for(var s,a,n,o,l,h,c,d;i.push(t),!t.leaf&&i.length-1!==r;){for(c=d=1/0,s=0,a=t.children.length;s<a;s++)l=u(n=t.children[s]),(h=f(e,n)-l)<d?(d=h,c=l<c?l:c,o=n):h===d&&l<c&&(c=l,o=n);t=o||t.children[0]}return t},_insert:function(e,t,r){var i=this.toBBox,s=r?e:i(e),a=[],n=this._chooseSubtree(s,this.data,t,a);for(n.children.push(e),l(n,s);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(s,a,t)},_split:function(e,t){var r=e[t],i=r.children.length,s=this._minEntries;this._chooseSplitAxis(r,s,i);var a=this._chooseSplitIndex(r,s,i),o=g(r.children.splice(a,r.children.length-a));o.height=r.height,o.leaf=r.leaf,n(r,this.toBBox),n(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(r,o)},_splitRoot:function(e,t){this.data=g([e,t]),this.data.height=e.height+1,this.data.leaf=!1,n(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var i,s,a,n,l,h,c,d;for(h=c=1/0,i=t;i<=r-t;i++)n=p(s=o(e,0,i,this.toBBox),a=o(e,i,r,this.toBBox)),l=u(s)+u(a),n<h?(h=n,d=i,c=l<c?l:c):n===h&&l<c&&(c=l,d=i);return d},_chooseSplitAxis:function(e,t,r){var i=e.leaf?this.compareMinX:h,s=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,s)&&e.children.sort(i)},_allDistMargin:function(e,t,r,i){e.children.sort(i);var s,a,n=this.toBBox,h=o(e,0,t,n),c=o(e,r-t,r,n),u=d(h)+d(c);for(s=t;s<r-t;s++)a=e.children[s],l(h,e.leaf?n(a):a),u+=d(h);for(s=r-t-1;s>=t;s--)a=e.children[s],l(c,e.leaf?n(a):a),u+=d(c);return u},_adjustParentBBoxes:function(e,t,r){for(var i=r;i>=0;i--)l(t[i],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():n(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},427:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=[1,256,65536,16777216],s=[1/256,1/65536,1/16777216,1/4294967296],a=function(e,t=0){for(var r=0,i=0;i<4;i++)r+=e[t+i]*s[i];return r}(new Uint8ClampedArray([255,255,255,255]));function n(e,t,r=0){for(var s=function(e,t,r){return e<t?t:e>r?r:e}(e,0,a),n=0;n<4;n++)t[r+n]=Math.floor(256*o(s*i[n]))}function o(e){return e-Math.floor(e)}},428:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var i={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){var i=new s(e.getPointX(t),e.getPointY(t),r),a=e.hasZ(t),n=e.hasM(t);return a&&(i.z=e.getPointZ(t)),n&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new n(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){var i=e.hasZ(t),s=e.hasM(t),a=new l(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){var n=e.getZExtent(t);a.zmin=n.vmin,a.zmax=n.vmax}if(s){var o=e.getMExtent(t);a.mmin=o.vmin,a.mmax=o.vmax}return a}};class s{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class a{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class n{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class l{constructor(e,t,r,i,s){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=s,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},429:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return i}));var i=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),s=!1},430:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(315),s=r(103),a=r(125),n=r(250),o=r(245);class l{constructor(e,t){this.key=new o.a(0,0,0,0),this.bounds=Object(a.i)(),this.objectIds=new Set,this.key.set(t);var r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level,this.needsClear=!0}get id(){return this.key.id}get extent(){return s.a.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}get bbox(){var e=this.bounds;return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}clone(){return new l(this.tileInfoView,this.key)}createChildTiles(){for(var e=this.key.getChildKeys(),t=i.a.acquire(),r=0;r<e.length;r++)t[r]=new l(this.tileInfoView,e[r]);return t}getQuantizationParameters(){return n.a.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}},431:function(e,t,r){"use strict";function i(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}r.d(t,"a",(function(){return i}))},432:function(e,t,r){"use strict";var i=r(91),s=r(127),a=r(593),n=r(588),o=r(510),l=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends o.a{constructor(e){super(),this._tileInfoView=e}get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(l),this.setStencilReference(),super.renderChildren(e)}createRenderParams(e){var{state:t}=e;return Object(i.a)(Object(i.a)({},super.createRenderParams(e)),{},{requiredLevel:this._tileInfoView.getClosestInfoForScale(t.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(t.scale)})}prepareRenderPasses(e){var t=e.registerRenderPass({name:"stencil",brushes:[n.a],drawPhase:s.c.DEBUG|s.c.MAP|s.c.HIGHLIGHT,target:()=>this.getStencilTarget()}),r=e.registerRenderPass({name:"tileInfo",brushes:[a.a],drawPhase:s.c.DEBUG,target:()=>this.children,has:"esri-tiles-debug"});return[...super.prepareRenderPasses(e),t,r]}getStencilTarget(){return this.children}updateTransforms(e){for(var t of this.children){var r=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,r)}}setStencilReference(){var e=1;for(var t of this.children)t.stencilRef=e++}}t.a=h},445:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(92);class i{constructor(e){this._geometry=e}next(){var e=this._geometry;return this._geometry=null,e}}},446:function(e,t,r){"use strict";t.a=class{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}},447:function(e,t,r){"use strict";var i=r(105),s=r(285),a=r(365),n=r(156),o=r(187),l=r(448),h=r(287);class c extends(Object(l.a)(h.a)){constructor(e,t,r,a,o,l,h,c,u,d,f,p,m,_,g,v,y,x=!1){super(),this._xOffset=Object(i.h)(p),this._yOffset=Object(i.h)(m),this._decoration=u||"none",this._color=a,this._haloColor=o,this._haloSize=Math.min(Math.floor(5*Object(i.h)(Object(i.k)(r))),127),this._size=Math.min(Math.round(Object(i.h)(t)),127);var b=Math.min(Math.round(Object(i.h)(t)),127);this._referenceSize=Math.round(Math.sqrt(256*b)),this._scale=this._size/24,this._angle=f,this._justify=Object(s.c)(l||"center"),this._xAlignD=Object(s.d)(l||"center"),this._yAlignD=Object(s.f)(h||"baseline"),this._baseline="baseline"===(h||"baseline"),this._bitset=(1===c?1:0)|(d?1:0)<<1;var O=n.e.load(e);O.sdf=!0,this._materialKey=O.data,this._lineWidth=Object(i.h)(_)||512,this._lineHeight=g||1,this._textPlacement=v,this._effects=y,this._isCIM=x}static fromText(e,t){var r=new c(e.materialKey,e.font.size,e.haloSize||0,e.color&&Object(o.d)(e.color)||0,e.haloColor&&Object(o.d)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1),[,i]=Object(a.a)(e.text);return r.bindTextInfo(t,i),r._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,r}static fromCIMText(e,t){var r=e.scaleFactor||1,i=e.size*e.sizeRatio*r,s=new c(e.materialKey,i,e.outlineSize*e.sizeRatio,Object(o.c)(e.color),Object(o.c)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*r,e.offsetY*e.sizeRatio*r,512,1,e.markerPlacement,e.effects,!0),[,n]=Object(a.a)(e.text);return s.bindTextInfo(t,n),s._vertexBoundsScale=e.maxVVSize?e.maxVVSize/i:1,s}}t.a=c},448:function(e,t,r){"use strict";var i=r(89),s=r(105),a=r(168),n=r(122),o=r(164),l=r(454),h=r(127),c=r(156),u=r(449);t.a=e=>class extends e{constructor(...e){super(...e),this._isCIM=!1,this._vertexBoundsScale=1,this.geometryType=h.d.TEXT,this._aux=Object(o.b)(0,0,this._referenceSize,this._bitset)}bindTextInfo(e,t){e&&e.length?this._shapingInfo=Object(i.b)(e,(e=>Object(l.a)(e,t,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:n.l*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM}))):this._shapingInfo=null}_write(e,t,r){var i=t.getDisplayId();this._writeGeometry(e,t,i,r)}_writeGeometry(e,t,r,s){var n=this._shapingInfo;if(!Object(i.j)(n)){if(Object(i.k)(this._textPlacement)){var o=null!=s?s:t.readLegacyGeometry();return this._writePlacedText(e,r,o,n)}var l=s?Object(a.p)(Object(a.d)(s),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readUnquantizedGeometry();if(l){if(l.isPoint){var[h,c]=l.coords;return this._writeGlyphs(e,r,{x:h,y:c},n)}l.forEachVertex(((t,i)=>this._writeGlyphs(e,r,{x:t,y:i},n)))}}}_writePlacedText(e,t,r,a){var n=Object(i.q)(this._textPlacement),o=u.a.getPlacement(r,n,Object(s.h)(1));if(o)for(var l=o.next();null!=l;){var h=l.getAngle();a.setRotation(h),this._writeGlyphs(e,t,{x:l.tx,y:l.ty},a),a.setRotation(-h),l=o.next()}}_writeGlyphs(e,t,r,i){var s=c.e.load(this._materialKey),a=Object(o.a)(Math.round(8*r.x),Math.round(8*r.y));for(var n of i.glyphs){s.textureBinding=n.textureBinding,e.recordStart(t,s.data,this.geometryType,!1,!0);var l=n.bounds,h=this._vertexBoundsScale;e.vertexBounds(l.x*h,l.y*h,l.width*h,l.height*h),this._writeVertices(e,t,a,n),e.recordEnd()}}_writeGlyph(e,t,r,i,s){var a=c.e.load(this._materialKey),n=Object(o.a)(Math.round(8*r),Math.round(8*i));a.textureBinding=s.textureBinding,e.recordStart(t,a.data,this.geometryType,!1,!0);var l=s.bounds,h=this._vertexBoundsScale;e.vertexBounds(l.x*h,l.y*h,l.width*h,l.height*h),this._writeVertices(e,t,n,s),e.recordEnd()}_writeVertices(e,t,r,i){var s=e.vertexCount();this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperLeft),e.vertexWrite(i.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperRight),e.vertexWrite(i.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerLeft),e.vertexWrite(i.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerRight),e.vertexWrite(i.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2)}_writeVertexCommon(e,t,r,i){var s=this._color,a=this._haloColor,n=Object(o.b)(0,0,this._referenceSize,this._bitset),l=Object(o.b)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(s),e.vertexWrite(a),e.vertexWrite(l),e.vertexWrite(n)}}},449:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(153),s=r(369);class a{static getPlacement(e,t,r){var a=Object(s.b)(t);if(!a)return null;var n=Object(i.c)(e);return a.execute(n,t,r)}}},450:function(e,t,r){"use strict";var i=r(89),s=r(105),a=r(122),n=r(290),o=r(238),l=r(164),h=r(156),c=r(187),u=r(287),d=r(451);class f extends(Object(d.a)(u.a)){constructor(e,t,r,i,s,c,u,d,f,p,m,_,g,v,y,x,b,O,w,S,j){super(),this.angle=i,this.height=u,this.width=c,this.xOffset=t*w,this.yOffset=r*w,this._markerPlacement=S,this._effects=j,this._anchorX=.5-(.5+x)*y.width/y.width,this._anchorY=.5-(.5+b)*y.height/y.height;var M=(1===v?1:0)|(m?1:0)<<1|(g?1:0)<<2|(_?1:0)<<3,T=y&&y.sdf,E=h.d.load(e);E.sdf=T,E.pattern=!0,E.textureBinding=y.textureBinding,this._materialKey=E.data,this._fillColor=s,this._outlineColor=f,this._sizeOutlineWidth=Object(l.b)(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*d),255)));var C=y.rect.x+a.q,I=y.rect.y+a.q,P=C+y.width,L=I+y.height;this._offsets.xUpperLeft=C,this._offsets.yUpperLeft=I,this._offsets.xUpperRight=P,this._offsets.yUpperRight=I,this._offsets.xBottomLeft=C,this._offsets.yBottomLeft=L,this._offsets.xBottomRight=P,this._offsets.yBottomRight=L,this._texUpperLeft=Object(l.a)(C,I),this._texUpperRight=Object(l.a)(P,I),this._texBottomLeft=Object(l.a)(C,L),this._texBottomRight=Object(l.a)(P,L),c*=O,u*=O,c*=w,u*=w;var k=Math.round(64*O);this._bitestAndDistRatio=Object(l.a)(M,k),this._computedWidth=c,this._computedHeight=u;var R=Object(o.a)(),N=Object(n.a)();this._applyTransformation(N,R)}static fromCIMMarker(e,t){var r=t&&t.width||1,a=t&&t.height||1,n=e.size,o=r/a*e.scaleX,l=e.scaleSymbolsProportionally&&e.frameHeight?n/e.frameHeight:1,h=Object(c.c)(e.color),u=Object(c.c)(e.outlineColor),d=Object(s.h)(n),p=d*o,m=Object(s.h)(e.offsetX||0),_=Object(s.h)(e.offsetY||0),g=Object(s.h)(e.outlineWidth||0)*l,v=e.alignment||0,y=Object(s.h)(e.referenceSize),x=e.rotation||0;e.rotateClockwise||(x=-x);var b=0,O=0,w=e.anchorPoint;w&&(e.isAbsoluteAnchorPoint?n&&(b=-w.x/(n*o),O=w.y/n):(b=w.x,O=w.y));var S=new f(e.materialKey,m,_,x,h,p,d,y,u,g,e.colorLocked,e.scaleSymbolsProportionally,!1,v,t,b,O,e.sizeRatio,Object(i.r)(e.scaleFactor,1),e.markerPlacement,e.effects);return S._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/p:1,S._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/d:1,S}static fromPictureMarker(e,t){var r=Math.round(Object(s.h)(e.width)),i=Math.round(Object(s.h)(e.height)),n=a.p,o=Math.round(Object(s.h)(e.xoffset||0)),l=Math.round(Object(s.h)(e.yoffset||0)),h=new f(e.materialKey,o,l,e.angle,n,r,i,i,0,0,!1,!1,!1,0,t,0,0,1,1,null,null);return h._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,h._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,h}static fromSimpleMarker(e,t){var r=Object(c.d)(e.color),i=Math.round(Object(s.h)(e.size)),a=i,n=Math.round(Object(s.h)(e.xoffset||0)),o=Math.round(Object(s.h)(e.yoffset||0)),l=e.style,h=e.outline,u=0|(h&&h.color&&Object(c.d)(h.color)),d=0|(h&&h.width&&Math.round(Object(s.h)(h.width))),p=new f(e.materialKey,n,o,e.angle,r,i,a,a,u,d,!1,!1,"esriSMSCross"===l||"esriSMSX"===l,0,t,0,0,126/64,1,null,null);return p.boundsType="esriSMSCircle"===l?"circle":"square",p._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,p._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,p}static fromLineSymbolMarker(e,t){var r,i=Object(c.d)(e.color),a=Math.round(Object(s.h)(6*e.lineWidth)),n=a,o="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":r="Both";break;case"begin":r="JustBegin";break;case"end":r="JustEnd";break;default:r="None"}var l={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:r,offsetAlongLine:0},h=new f(e.materialKey,0,0,0,i,a,n,n/6,i,o?Math.round(Object(s.h)(e.lineWidth)):0,!1,!1,o,1,t,0,0,126/64,1,l,null);return h.boundsType="circle"===e.style?"circle":"square",h}}t.a=f},451:function(e,t,r){"use strict";var i=r(89),s=r(105),a=r(168),n=r(135),o=r(321),l=r(290),h=r(238),c=r(164),u=r(127),d=r(449),f=3.14159265359/180;t.a=e=>class extends e{constructor(...e){super(...e),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this._vertexBoundsScaleX=1,this._vertexBoundsScaleY=1,this._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},this.geometryType=u.d.MARKER}_write(e,t,r){var i=t.getDisplayId();e.recordStart(i,this._materialKey,this.geometryType,!1,!0),this._writeGeometry(e,t,i,r),e.recordEnd()}_writeGeometry(e,t,r,s){if(Object(i.k)(this._markerPlacement))return this._writePlacedMarkers(e,t,s);var n=s?Object(a.p)(Object(a.d)(s),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readUnquantizedGeometry();if(n){if(n.isPoint){var[o,l]=n.coords;if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(o<-1||o>=513||l<-1||l>=513))return;return this._writeVertices(e,r,this._getPos(o,l),o,l)}n.forEachVertex(((t,i)=>this._writeVertices(e,r,this._getPos(t,i),t,i)))}}_writePlacedMarkers(e,t,r){var a=null!=r?r:t.readLegacyGeometry(),n=d.a.getPlacement(a,Object(i.q)(this._markerPlacement),Object(s.h)(1));if(n)for(var o=t.getDisplayId(),c=Object(h.a)(),u=Object(l.a)(),p=n.next();null!=p;){var{tx:m,ty:_}=p;m>=-128&&m<=640&&_>=-128&&_<=640&&(this._applyTransformation(u,c,p.getAngle()/f),this._writeVertices(e,o,this._getPos(m,_),m,_)),p=n.next()}}_writeVertices(e,t,r,i,s){var a=e.vertexCount();e.vertexBounds(i+this.xOffset,s-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY),e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexEnd(),e.indexWrite(a+0),e.indexWrite(a+1),e.indexWrite(a+2),e.indexWrite(a+1),e.indexWrite(a+3),e.indexWrite(a+2)}_applyTransformation(e,t,r=0){Object(o.d)(e),Object(o.h)(e,e,Object(h.b)(this.xOffset,-this.yOffset)),this.angle+r!==0&&Object(o.f)(e,e,f*(this.angle+r));var i=this._computedWidth,s=this._computedHeight,a=(this._anchorX-.5)*i,l=(this._anchorY-.5)*s;Object(n.r)(t,a,l),Object(n.s)(t,t,e),this._offsetUpperLeft=Object(c.a)(16*t[0],16*t[1]),this._offsets.xUpperLeft=t[0],this._offsets.yUpperLeft=t[1],Object(n.r)(t,a+i,l),Object(n.s)(t,t,e),this._offsetUpperRight=Object(c.a)(16*t[0],16*t[1]),this._offsets.xUpperRight=t[0],this._offsets.yUpperRight=t[1],Object(n.r)(t,a,l+s),Object(n.s)(t,t,e),this._offsetBottomLeft=Object(c.a)(16*t[0],16*t[1]),this._offsets.xBottomLeft=t[0],this._offsets.yBottomLeft=t[1],Object(n.r)(t,a+i,l+s),Object(n.s)(t,t,e),this._offsetBottomRight=Object(c.a)(16*t[0],16*t[1]),this._offsets.xBottomRight=t[0],this._offsets.yBottomRight=t[1]}_getPos(e,t){return Object(c.a)(Math.round(8*e),Math.round(8*t))}}},452:function(e,t,r){"use strict";r.d(t,"a",(function(){return Ze})),r.d(t,"b",(function(){return Ke}));var i=r(91),s=r(7),a=r(81),n=r(93),o=r(94),l=r(234),h=r(319),c=r(360),u=r(447),d=r(450),f=r(110),p=r(105),m=r(122),_=r(164),g=r(156),v=r(187),y=r(399),x=r(232),b=r(89),O=r(168),w=r(127),S=r(178),j=(r(536),r(537));function M(e,t,r,i,s,a,n){Z=0;var o,l,h,c,u,d=(i-r)*a,f=s&&s.length,p=f?(s[0]-r)*a:d,m=T(t,r,i,0,p,a,!0);if(m&&m.next!==m.prev){if(f&&(m=function(e,t,r,i,s,a){for(var n=new Array,o=0,l=i.length;o<l;o++){var h=T(e,t,r,i[o]*a,o<l-1?i[o+1]*a:r*a,a,!1);h===h.next&&(h.steiner=!0),n.push(R(h))}for(var c of(n.sort(U),n))N(c,s),s=E(s,s.next);return s}(t,r,i,s,m,a)),d>80*a){o=h=t[0+r*a],l=c=t[1+r*a];for(var _=a;_<p;_+=a){var g=t[_+r*a],v=t[_+1+r*a];o=Math.min(o,g),l=Math.min(l,v),h=Math.max(h,g),c=Math.max(c,v)}u=0!==(u=Math.max(h-o,c-l))?1/u:0}C(m,e,a,o,l,u,n,0)}}function T(e,t,r,i,s,a,n){var o;if(n===function(e,t,r,i,s,a){for(var n=0,o=i,l=s-a;o<s;o+=a)n+=(e[l+t*a]-e[o+t*a])*(e[o+1+t*a]+e[l+1+t*a]),l=o;return n}(e,t,0,i,s,a)>0)for(var l=i;l<s;l+=a)o=L(l+t*a,e[l+t*a],e[l+1+t*a],o);else for(var h=s-a;h>=i;h-=a)o=L(h+t*a,e[h+t*a],e[h+1+t*a],o);return o&&B(o,o.next)&&(k(o),o=o.next),o}function E(e,t=e){if(!e)return e;var r,i=e;do{if(r=!1,i.steiner||!B(i,i.next)&&0!==z(i.prev,i,i.next))i=i.next;else{if(k(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function C(e,t,r,i,s,a,n,o){if(e){!o&&a&&(e=A(e,i,s,a));for(var l=e;e.prev!==e.next;){var h=e.prev,c=e.next;if(a?P(e,i,s,a):I(e))t.push(h.index/r+n),t.push(e.index/r+n),t.push(c.index/r+n),k(e),e=c.next,l=c.next;else if((e=c)===l){o?1===o?C(e=W(e,t,r,n),t,r,i,s,a,n,2):2===o&&q(e,t,r,i,s,a,n):C(E(e),t,r,i,s,a,n,1);break}}}}function I(e){var t=e.prev,r=e,i=e.next;if(z(t,r,i)>=0)return!1;for(var s=e.next.next,a=s,n=0;s!==e.prev&&(0===n||s!==a);){if(n++,F(t.x,t.y,r.x,r.y,i.x,i.y,s.x,s.y)&&z(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function P(e,t,r,i){var s=e.prev,a=e,n=e.next;if(z(s,a,n)>=0)return!1;for(var o=s.x<a.x?s.x<n.x?s.x:n.x:a.x<n.x?a.x:n.x,l=s.y<a.y?s.y<n.y?s.y:n.y:a.y<n.y?a.y:n.y,h=s.x>a.x?s.x>n.x?s.x:n.x:a.x>n.x?a.x:n.x,c=s.y>a.y?s.y>n.y?s.y:n.y:a.y>n.y?a.y:n.y,u=G(o,l,t,r,i),d=G(h,c,t,r,i),f=e.prevZ,p=e.nextZ;f&&f.z>=u&&p&&p.z<=d;){if(f!==e.prev&&f!==e.next&&F(s.x,s.y,a.x,a.y,n.x,n.y,f.x,f.y)&&z(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==e.prev&&p!==e.next&&F(s.x,s.y,a.x,a.y,n.x,n.y,p.x,p.y)&&z(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&F(s.x,s.y,a.x,a.y,n.x,n.y,f.x,f.y)&&z(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==e.prev&&p!==e.next&&F(s.x,s.y,a.x,a.y,n.x,n.y,p.x,p.y)&&z(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function L(e,t,r,i){var s=Y.create(e,t,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function k(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function N(e,t){if(t=function(e,t){var r,i=t,s=e.x,a=e.y,n=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=s&&o>n){if(n=o,o===s){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(s===n)return r.prev;var l,h=r,c=r.x,u=r.y,d=1/0;for(i=r.next;i!==h;)s>=i.x&&i.x>=c&&s!==i.x&&F(a<u?s:n,a,c,u,a<u?n:s,a,i.x,i.y)&&(((l=Math.abs(a-i.y)/(s-i.x))<d||l===d&&i.x>r.x)&&V(i,e)&&(r=i,d=l)),i=i.next;return r}(e,t)){var r=X(t,e);E(r,r.next)}}function A(e,t,r,i){for(var s;s!==e;s=s.next){if(null===(s=s||e).z&&(s.z=G(s.x,s.y,t,r,i)),s.prev.next!==s||s.next.prev!==s)return s.prev.next=s,s.next.prev=s,A(e,t,r,i);s.prevZ=s.prev,s.nextZ=s.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var i=void 0,s=e;e=null,t=null;for(var a=0;s;){a++,i=s;for(var n=0;n<r&&i;n++)i=i.nextZ;for(var o=r;n>0||o>0&&i;){var l=void 0;0===n?(l=i,i=i.nextZ,o--):0!==o&&i?s.z<=i.z?(l=s,s=s.nextZ,n--):(l=i,i=i.nextZ,o--):(l=s,s=s.nextZ,n--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}s=i}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function z(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function D(e,t,r,i){return!!(B(e,t)&&B(r,i)||B(e,i)&&B(r,t))||z(e,t,r)>0!=z(e,t,i)>0&&z(r,i,e)>0!=z(r,i,t)>0}function F(e,t,r,i,s,a,n,o){return(s-n)*(t-o)-(e-n)*(a-o)>=0&&(e-n)*(i-o)-(r-n)*(t-o)>=0&&(r-n)*(a-o)-(s-n)*(i-o)>=0}function V(e,t){return z(e.prev,e,e.next)<0?z(e,t,e.next)>=0&&z(e,e.prev,t)>=0:z(e,t,e.prev)<0||z(e,e.next,t)<0}function G(e,t,r,i,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function B(e,t){return e.x===t.x&&e.y===t.y}function U(e,t){return e.x-t.x}function W(e,t,r,i){var s=e;do{var a=s.prev,n=s.next.next;!B(a,n)&&D(a,s,s.next,n)&&V(a,n)&&V(n,a)&&(t.push(a.index/r+i),t.push(s.index/r+i),t.push(n.index/r+i),k(s),k(s.next),s=e=n),s=s.next}while(s!==e);return s}function q(e,t,r,i,s,a,n){var o=e;do{for(var l=o.next.next;l!==o.prev;){if(o.index!==l.index&&H(o,l)){var h=X(o,l);return o=E(o,o.next),h=E(h,h.next),C(o,t,r,i,s,a,n,0),void C(h,t,r,i,s,a,n,0)}l=l.next}o=o.next}while(o!==e)}function H(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&D(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&V(e,t)&&V(t,e)&&function(e,t){var r=e,i=!1,s=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&s<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)}function X(e,t){var r=Y.create(e.index,e.x,e.y),i=Y.create(t.index,t.x,t.y),s=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}class Y{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,t,r){var i=Z<K.length?K[Z++]:new Y;return i.index=e,i.x=t,i.y=r,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}for(var K=new Array,Z=0,J=0;J<8096;J++)K.push(new Y);var Q=r(538),$=new Q.a,ee=new j.b(0,0,0,1,0),te=new j.b(0,0,0,1,0);function re(e,t,r){for(var i=0,s=1;s<r;s++){var a=e[2*(t+s-1)],n=e[2*(t+s-1)+1];i+=(e[2*(t+s)]-a)*(e[2*(t+s)+1]+n)}return i}function ie(e,t,r,i,s){for(var a=0,n=r;n<i;n+=3){var o=2*(e.getValue(n)-s),l=2*(e.getValue(n+1)-s),h=2*(e.getValue(n+2)-s);a+=Math.abs((t[o]-t[h])*(t[l+1]-t[o+1])-(t[o]-t[l])*(t[h+1]-t[o+1]))}return a}ee.setExtent(m.E),te.setExtent(m.E);var se=e=>class extends e{constructor(...e){super(...e),this.forceLibtess=!1,this.geometryType=w.d.FILL}_write(e,t,r){var i="esriGeometryPoint"===t.geometryType,s=g.a.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,s.dotDensity,i),this._writeGeometry(e,t,s,r,i),e.recordEnd()}_writeGeometry(e,t,r,i,s){var a=this._getGeometry(t,i,s);if(!Object(b.j)(a)){var n=e.indexCount();if(a.lengths[0]>1e3||this.forceLibtess||!function(e,t){var{coords:r,lengths:i,hasIndeterminateRingOrder:s}=t,a=e.indexWriter(),n=e.vertexCount();if(s)return!1;for(var o=a.length,l=0,h=0;h<i.length;){for(var c=h,u=i[h],d=re(r,l,u),f=[];++c<i.length;){var p=i[c],m=re(r,l+u,p);if(!(m>0))break;d+=m,f.push(l+u),u+=p}var _=a.length;M(a,r,l,l+u,f,2,n);var g=ie(a,r,_,a.length,n),v=Math.abs(d);if(Math.abs((g-v)/Math.max(1e-7,v))>1e-5)return a.seek(o),!1;h=c,l+=u}return!0}(e,a)){var o=function(e,t){var r=[],i=[],s=e.indexWriter(),a=e.vertexCount(),{coords:n,lengths:o}=t;$.beginPolygon(r,i);for(var l=0,h=0;h<o.length;h++){var c=t.lengths[h];$.beginContour();for(var u=0;u<c;u++){var d=[n[2*(l+u)],n[2*(l+u)+1],0];$.addVertex(d,d)}$.endContour(),l+=c}$.endPolygon();for(var f=0;f<i.length;f++)s.push(i[f]+a);return r}(e,a);n!==e.indexCount()&&this._writeVertices(e,t,o,[o.length/2],r)}else!(n===e.indexCount())&&this._writeVertices(e,t,a.coords,a.lengths,r)}}_writeVertices(e,t,r,i,s){var a=t.getDisplayId(),n=0;for(var o of i){for(var l=o+n,h=n;h<l;h++){var c=r[2*h],u=r[2*h+1],d=Object(_.a)(1*c,1*u);e.vertexBounds(c,u,0,0),e.vertexWrite(d),e.vertexWrite(a),s.dotDensity?e.vertexWriteF32(1/Math.abs(t.readGeometryArea())):(e.vertexWrite(this.fillColor),e.vertexWrite(this.tl),e.vertexWrite(this.br),e.vertexWrite(this.aux1),e.vertexWrite(this.aux2),e.vertexWrite(this.aux3))}n+=o}}_getGeometry(e,t,r){var i=t?Object(O.p)(Object(O.d)(t),2):e.readUnquantizedGeometry();return i?function(e,t){if(!function(e,t,r){for(var i=0,s=0;s<e.lengths.length;s++){for(var a=e.lengths[s],n=0;n<a;n++){var o=e.coords[2*(n+i)],l=e.coords[2*(n+i)+1];if(o<t||o>r||l<t||l>r)return!0}i+=a}return!1}(e,-128,m.E+128))return e;ee.setPixelMargin(t),ee.reset(3);for(var r=0,i=0;i<e.lengths.length;i++){var s=e.lengths[i],a=e.coords[2*(0+r)],n=e.coords[2*(0+r)+1];ee.moveTo(a,n);for(var o=1;o<s;o++)a=e.coords[2*(o+r)],n=e.coords[2*(o+r)+1],ee.lineTo(a,n);ee.close(),r+=s}var l=ee.result(!1);if(!l)return null;var h=[],c=[];for(var u of l){var d=0;for(var f of u)c.push(f.x),c.push(f.y),d++;h.push(d)}return new S.a(h,c)}(i,r?256:128):null}},ae=r(418),ne=r(287),oe=a.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");class le extends ne.a{constructor(e){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=e}analyze(e,t,r,i){var s=t.readLegacyFeature(),a=this._materialCache,n=this._cimLayer.materialHash;if(!n)return oe.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);var o="function"==typeof n?n(s,r,i):n;if(a.has(o)){var l=a.get(o);return Promise.resolve(l)}if(this._ongoingMaterialRequestMap.has(o))return this._ongoingMaterialRequestMap.get(o);var h=Object(ae.a)(this._cimLayer.cim,this._cimLayer.materialOverrides);h.mosaicHash=o;var c=e.getMosaicItem(h).then((e=>(this._ongoingMaterialRequestMap.delete(o),a.set(o,e),e))).catch((e=>(this._ongoingMaterialRequestMap.delete(o),oe.error(".analyze()",e.message),null)));return this._ongoingMaterialRequestMap.set(o,c),c}}var he=le,ce=128;class ue extends(se(he)){constructor(e){var t;if(super(e),Object(x.c)(e.color)){this._dynamicPropertyMap.set("_fillColor",((t,r,i)=>{var s=e.color(t,r,i);return s&&Object(v.c)(s)||0}))}else{var r=e.color;this.fillColor=r&&Object(v.c)(r)||0}var i=0;Object(x.c)(e.height)||(i=e.height||0);var s="CIMMarkerPlacementInsidePolygon"===(null==(t=e.cim.placement)?void 0:t.type)&&e.cim.placement.shiftOddRows?2:1;this._dynamicPropertyMap.set("_height",((t,r,a)=>Object(x.c)(e.height)?e.height(t,r,a)*s:i*s));var a=0;Object(x.c)(e.offsetX)||(a=Object(p.h)(e.offsetX||0)+ce)>255&&(a=255);this._dynamicPropertyMap.set("_offsetX",((t,r,i)=>{if(Object(x.c)(e.offsetX)){var s=Object(p.h)(e.offsetX(t,r,i))+ce;return s>255&&(s=255),s}return a}));var n=1;Object(x.c)(e.scaleX)||(n=e.scaleX||1);this._dynamicPropertyMap.set("_scaleX",((t,r,i)=>Object(x.c)(e.scaleX)?e.scaleX(t,r,i):n));var o=0;Object(x.c)(e.offsetY)||(o=Object(p.h)(-e.offsetY||0)+ce)>255&&(o=255);this._dynamicPropertyMap.set("_offsetY",((t,r,i)=>{if(Object(x.c)(e.offsetY)){var s=Object(p.h)(-e.offsetY(t,r,i))+ce;return s>255&&(s=255),s}return o}));var l=0;Object(x.c)(e.angle)||(l=Object(y.d)(e.angle)||0);this._dynamicPropertyMap.set("_angle",((t,r,i)=>Object(x.c)(e.angle)?Object(y.d)(e.angle(t,r,i)):l)),this._effects=e.effects,this._cimFillLayer=e,this._fillMaterialKey=g.a.load(e.materialKey)}static fromCIMFill(e){return new ue(e)}bindFeature(e,t,r){var i=e.readLegacyFeature();this._dynamicPropertyMap.forEach(((e,s)=>{this[s]=e(i,t,r)}));var s=this._fillMaterialKey,a=this._materialCache,n=this._cimFillLayer;this.aux3=Object(_.b)(0,0,this._angle,n.colorLocked?1:0);var o=(0,n.materialHash)(i,t,r),l=a.get(o),c=null;if(l&&Object(h.a)(l.spriteMosaicItem)&&(c=l.spriteMosaicItem),c){var{rect:u,width:d,height:g}=c,v=u.x+m.q,y=u.y+m.q,x=v+d,b=y+g,O=Object(f.o)(Object(p.h)(this._height));O>255?O=255:O<=0&&(O=Object(f.o)(b-y));var w=Object(f.o)(Object(p.h)(this._height/g*d||0));w>255?w=255:w<=0&&(w=Object(f.o)(x-v));var S=this._scaleX;this.tl=Object(_.a)(v,y),this.br=Object(_.a)(x,b),this.aux1=Object(_.b)(w,O,this._offsetX,this._offsetY),this.aux2=Object(_.a)(ce*S,128),s.sdf=c.sdf,s.pattern=!0,s.textureBinding=c.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,s.sdf=!1,s.pattern=!1,s.textureBinding=0;this._materialKey=s.data}}var de=ue,fe=r(539),pe=31,me=1024,_e=1/3.8,ge=e=>t=>{var r=e.out,i=Math.ceil(me*e._halfWidth),s=Math.ceil(me*e._halfReferenceWidth);t.entry0=e.offset+e.vertexCount++;var a=Object(_.a)(t.distance,i),n=Object(_.b)(Math.round(pe*t.prevNormal.x),Math.round(pe*t.prevNormal.y),Math.round(0),Math.round(-31)),o=Object(_.b)(0,0,0,e._bitset);r.vertexBounds(t.currentVertex.x,t.currentVertex.y,0,0),r.vertexWrite(Object(_.a)(8*t.currentVertex.x,8*t.currentVertex.y)),r.vertexWrite(e.id),r.vertexWrite(e._fillColor),r.vertexWrite(n),r.vertexWrite(a),r.vertexWrite(e._tl),r.vertexWrite(e._br),r.vertexWrite(o),r.vertexWrite(Object(_.a)(s,0)),r.vertexEnd(),t.entry2=e.offset+e.vertexCount++;var l=Object(_.a)(t.distance,i),h=Object(_.b)(Math.round(pe*-t.prevNormal.x),Math.round(pe*-t.prevNormal.y),Math.round(0),Math.round(31)),c=Object(_.b)(0,0,0,e._bitset);r.vertexBounds(t.currentVertex.x,t.currentVertex.y,0,0),r.vertexWrite(Object(_.a)(8*t.currentVertex.x,8*t.currentVertex.y)),r.vertexWrite(e.id),r.vertexWrite(e._fillColor),r.vertexWrite(h),r.vertexWrite(l),r.vertexWrite(e._tl),r.vertexWrite(e._br),r.vertexWrite(c),r.vertexWrite(Object(_.a)(s,0)),r.vertexEnd(),t.exit0=e.offset+e.vertexCount++;var u=Object(_.a)(t.distance,i),d=Object(_.b)(Math.round(pe*t.nextNormal.x),Math.round(pe*t.nextNormal.y),Math.round(0),Math.round(-31)),f=Object(_.b)(0,0,0,e._bitset);r.vertexBounds(t.currentVertex.x,t.currentVertex.y,0,0),r.vertexWrite(Object(_.a)(8*t.currentVertex.x,8*t.currentVertex.y)),r.vertexWrite(e.id),r.vertexWrite(e._fillColor),r.vertexWrite(d),r.vertexWrite(u),r.vertexWrite(e._tl),r.vertexWrite(e._br),r.vertexWrite(f),r.vertexWrite(Object(_.a)(s,0)),r.vertexEnd(),t.exit2=e.offset+e.vertexCount++;var p=Object(_.a)(t.distance,i),m=Object(_.b)(Math.round(pe*-t.nextNormal.x),Math.round(pe*-t.nextNormal.y),Math.round(0),Math.round(31)),g=Object(_.b)(0,0,0,e._bitset);r.vertexBounds(t.currentVertex.x,t.currentVertex.y,0,0),r.vertexWrite(Object(_.a)(8*t.currentVertex.x,8*t.currentVertex.y)),r.vertexWrite(e.id),r.vertexWrite(e._fillColor),r.vertexWrite(m),r.vertexWrite(p),r.vertexWrite(e._tl),r.vertexWrite(e._br),r.vertexWrite(g),r.vertexWrite(Object(_.a)(s,0)),r.vertexEnd()},ve=e=>t=>{var r=e.out;r.indexWrite(t.leftExit0),r.indexWrite(t.rightEntry0),r.indexWrite(t.leftExit2),r.indexWrite(t.rightEntry0),r.indexWrite(t.rightEntry2),r.indexWrite(t.leftExit2),e.indexCount+=6},ye=e=>(t,r,i,s,a,n,o,l,h)=>{var c=Object(_.a)(h,Math.ceil(me*e._halfWidth)),u=Object(_.b)(Math.round(pe*a),Math.round(pe*n),Math.round(pe*o),Math.round(pe*l)),d=Object(_.b)(pe*i,pe*s,0,e._bitset),f=e.out;return f.vertexBounds(t,r,1,1),f.vertexWrite(Object(_.a)(8*t,8*r)),f.vertexWrite(e.id),f.vertexWrite(e._fillColor),f.vertexWrite(u),f.vertexWrite(c),f.vertexWrite(e._tl),f.vertexWrite(e._br),f.vertexWrite(d),f.vertexWrite(Object(_.a)(Math.ceil(me*e._halfReferenceWidth),0)),f.vertexEnd(),e.offset+e.vertexCount++},xe=e=>(t,r,i)=>{var s=e.out;s.indexWrite(t),s.indexWrite(r),s.indexWrite(i),e.indexCount+=3},be=e=>class extends e{constructor(...e){super(...e),this.tessellationProperties={},this._tessellationOptions={},this.geometryType=w.d.LINE}_initializeTessellator(e){var t=g.c.load(this._materialKey),r=this._tessellationOptions,i=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,s=this.tessellationProperties._halfWidth<m.D/2;if(r.thin=s&&!e&&!i,r.trackDistance=this._isDashed||this._hasPattern,r.wrapDistance=65535,r.innerBisectorAutoSplitThreshold=_e,r.outerBisectorAutoSplitThreshold=_e,r.enableInnerBisectorSplit=this._isDashed||this._hasPattern,r.enableOuterBisectorSplit=this._isDashed||this._hasPattern,r.thin)this._tessellationCallbacks={vertex:ge(this.tessellationProperties),bridge:ve(this.tessellationProperties)};else{var a=new fe.a(ye(this.tessellationProperties),xe(this.tessellationProperties));a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,a.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=a}}_write(e,t,r){var i="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,!1,i),this._writeGeometry(e,t,r,i),e.recordEnd()}_writeGeometry(e,t,r,i){var s=null!=r?r:t.readLegacyGeometry(),a=this._getLines(s,i);Object(b.j)(a)||this._writeVertices(e,t,a)}_getLines(e,t){if(Object(b.j)(e))return null;var r=e.paths||e.rings;return Object(b.j)(r)?null:function(e,t){te.setPixelMargin(t);for(var r=te,i=-t,s=m.E+t,a=[],n=!1,o=0;o<e.length;){var l=[],h=e[o];r.reset(2);var[c,u]=h[0];if(n)r.moveTo(c,u);else{if(c<i||c>s||u<i||u>s){n=!0;continue}l.push({x:c,y:u})}for(var d=!1,f=h.length,p=1;p<f;++p)if(c+=h[p][0],u+=h[p][1],n)r.lineTo(c,u);else{if(c<i||c>s||u<i||u>s){d=!0;break}l.push({x:c,y:u})}if(d)n=!0;else{if(n){var _=r.resultWithStarts();if(_)for(var g of _)a.push(g)}else a.push({line:l,start:0});o++,n=!1}}return 0===(a=a.filter((e=>e.line.length>1))).length?null:a}(r,t?256:16)}_writeVertices(e,t,r){var i=t.getDisplayId(),s=e.vertexCount(),a=this.tessellationProperties;for(var{line:n,start:o}of(a.out=e,a.id=i,a.indexCount=0,a.vertexCount=0,a.offset=s,r))this._tessellationOptions.initialDistance=o%65535,this._tessellationCallbacks instanceof fe.a&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),Object(fe.d)(n,this._tessellationOptions,this._tessellationCallbacks),Object(fe.b)()}};class Oe extends(be(he)){constructor(e){super(e),this._cimLineLayer=e;var t=0;Object(x.c)(e.width)||(t=.5*Object(p.h)(e.width));if(this._dynamicPropertyMap.set("_halfWidth",((r,i,s)=>Object(x.c)(e.width)?.5*Object(p.h)(e.width(r,i,s)):t)),Object(x.c)(e.cap)?this._dynamicPropertyMap.set("_capType",e.cap):this._capType=e.cap,Object(x.c)(e.join)?this._dynamicPropertyMap.set("_joinType",e.join):this._joinType=e.join,Object(x.c)(e.color)){this._dynamicPropertyMap.set("_fillColor",((t,r,i)=>{var s=e.color(t,r,i);return s&&Object(v.c)(s)||0}))}else{var r=e.color;this._fillColor=r&&Object(v.c)(r)||0}if(Object(x.c)(e.miterLimit)){this._dynamicPropertyMap.set("_miterLimitCosine",((t,r,i)=>Object(x.b)(e.miterLimit(t,r,i))))}else this._miterLimitCosine=Object(x.b)(e.miterLimit);this._scaleFactor=e.scaleFactor||1,this._isDashed=e.isDashed,this._effects=e.effects,this.tessellationProperties._bitset=e.colorLocked?1:0,this._materialKey=e.materialKey,this._initializeTessellator(!0)}static fromCIMLine(e){return new Oe(e)}bindFeature(e,t,r){var i=e.readLegacyFeature();this._dynamicPropertyMap.forEach(((e,s)=>{this[s]=e(i,t,r)})),this._halfWidth*=this._scaleFactor;var s=this._materialCache,a=(0,this._cimLineLayer.materialHash)(i,t,r),n=s.get(a),o=null;if(n&&Object(h.a)(n.spriteMosaicItem)&&(o=n.spriteMosaicItem),o){this._hasPattern=!0;var{rect:l,width:c,height:u}=o,d=l.x+m.q,f=l.y+m.q,p=d+c,v=f+u;this.tessellationProperties._tl=Object(_.a)(d,f),this.tessellationProperties._br=Object(_.a)(p,v)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var y=g.c.load(this._materialKey);o&&(y.sdf=o.sdf,y.pattern=!0,y.textureBinding=o.textureBinding),this._materialKey=y.data}}var we=Oe,Se=r(290),je=r(238),Me=r(451),Te=Object(je.a)(),Ee=Object(Se.a)(),Ce=a.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class Ie extends(Object(Me.a)(he)){constructor(e){if(super(e),this._cimMarkerLayer=e,Object(x.c)(e.color)){this._dynamicPropertyMap.set("_fillColor",((t,r,i)=>Object(v.c)(e.color(t,r,i))))}else this._fillColor=Object(v.c)(e.color);if(Object(x.c)(e.outlineColor)){this._dynamicPropertyMap.set("_outlineColor",((t,r,i)=>Object(v.c)(e.outlineColor(t,r,i))))}else this._outlineColor=Object(v.c)(e.outlineColor);if(Object(x.c)(e.size)){this._dynamicPropertyMap.set("_size",((t,r,i)=>Object(p.h)(e.size(t,r,i))))}else this._size=Object(p.h)(e.size);if(Object(x.c)(e.scaleX)?this._dynamicPropertyMap.set("_scaleX",e.scaleX):this._scaleX=e.scaleX,Object(x.c)(e.offsetX)){this._dynamicPropertyMap.set("xOffset",((t,r,i)=>Object(p.h)(e.offsetX(t,r,i))))}else this.xOffset=Object(p.h)(e.offsetX);if(Object(x.c)(e.offsetY)){this._dynamicPropertyMap.set("yOffset",((t,r,i)=>Object(p.h)(e.offsetY(t,r,i))))}else this.yOffset=Object(p.h)(e.offsetY);if(Object(x.c)(e.outlineWidth)){this._dynamicPropertyMap.set("_outlineWidth",((t,r,i)=>Object(p.h)(e.outlineWidth(t,r,i))))}else this._outlineWidth=Object(p.h)(e.outlineWidth);Object(x.c)(e.rotation)?this._dynamicPropertyMap.set("_angle",e.rotation):this._angle=e.rotation,this._scaleFactor=Object(b.r)(e.scaleFactor,1),this._markerPlacement=e.markerPlacement,this._effects=e.effects,this._bitSet=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,this._materialKey=e.materialKey}static fromCIMMarker(e){return new Ie(e)}bindFeature(e,t,r){var i=e.readLegacyFeature();this._dynamicPropertyMap.forEach(((e,s)=>{this[s]=e(i,t,r)}));var s=this._cimMarkerLayer.materialHash,a="function"==typeof s?s(i,t,r):s,o=this._materialCache.get(a);if(o&&Object(h.a)(o.spriteMosaicItem)&&o.spriteMosaicItem){var l=o.spriteMosaicItem,c=this._cimMarkerLayer.sizeRatio,u=l.width/l.height*this._scaleX,d=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,f=this._size,v=f*u,y=this.xOffset,x=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var b=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(p.h)(this._cimMarkerLayer.frameHeight):1,O=this._outlineWidth*b,w=Object(p.h)(this._cimMarkerLayer.referenceSize),S=0,j=0,M=this._cimMarkerLayer.anchorPoint;M&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(S=-M.x/(this._size*u),j=M.y/this._size):(S=M.x,j=M.y)),this._sizeOutlineWidth=Object(_.b)(Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*O),255)),Math.round(Math.min(Math.sqrt(128*w),255))),this.angle=d;var T=Math.round(64*c);this._bitestAndDistRatio=Object(_.a)(this._bitSet,T);var E=l.rect.x+m.q,C=l.rect.y+m.q,I=E+l.width,P=C+l.height;this._texUpperLeft=Object(_.a)(E,C),this._texUpperRight=Object(_.a)(I,C),this._texBottomLeft=Object(_.a)(E,P),this._texBottomRight=Object(_.a)(I,P);var L=g.d.load(this._materialKey);L.sdf=l.sdf,L.pattern=!0,L.textureBinding=l.textureBinding,this._materialKey=L.data,this._anchorX=.5-(.5+S)*l.width/l.width,this._anchorY=.5-(.5+j)*l.height/l.height,v*=c,f*=c,v*=this._scaleFactor,f*=this._scaleFactor,v*=l.rect.width/l.width,f*=l.rect.height/l.height,this._computedWidth=v,this._computedHeight=f,this._applyTransformation(Ee,Te),this.xOffset=y,this.yOffset=x}else Ce.error(new n.a("mapview-cim","Encountered an error when binding feature"))}}var Pe=Ie,Le=r(431),ke=r(285),Re=r(448);class Ne extends(Object(Re.a)(he)){constructor(e){super(e),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map;var t,r=e.scaleFactor||1;if(this._cimTextLayer=e,Object(x.c)(e.color)){this._dynamicPropertyMap.set("_color",((t,r,i)=>Object(v.c)(e.color(t,r,i))))}else this._color=Object(v.c)(e.color);if(Object(x.c)(e.color)){this._dynamicPropertyMap.set("_haloColor",((t,r,i)=>Object(v.c)(e.outlineColor(t,r,i))))}else this._haloColor=Object(v.c)(e.outlineColor);Object(x.c)(e.size)||(t=Math.min(Math.round(Object(p.h)(e.size*e.sizeRatio)),127));var i;if(this._dynamicPropertyMap.set("_size",((r,i,s)=>Object(x.c)(e.size)?Math.min(Math.round(Object(p.h)(e.size(r,i,s)*e.sizeRatio)),127):t)),Object(x.c)(e.outlineSize)){this._dynamicPropertyMap.set("_haloSize",((t,r,i)=>Math.min(Math.floor(5*Object(p.h)(e.outlineSize(t,r,i)*e.sizeRatio)),127)))}else this._haloSize=Math.min(Math.floor(5*Object(p.h)(e.outlineSize*e.sizeRatio)),127);Object(x.c)(e.offsetX)||(i=Math.round(Object(p.h)(e.offsetX*e.sizeRatio)));var s;this._dynamicPropertyMap.set("_xOffset",((t,r,s)=>Object(x.c)(e.offsetX)?Math.round(Object(p.h)(e.offsetX(t,r,s)*e.sizeRatio)):i)),Object(x.c)(e.offsetY)||(s=Math.round(Object(p.h)(e.offsetY*e.sizeRatio)));this._dynamicPropertyMap.set("_yOffset",((t,r,i)=>Object(x.c)(e.offsetY)?Math.round(Object(p.h)(e.offsetY(t,r,i)*e.sizeRatio)):s)),Object(x.c)(e.angle)?this._dynamicPropertyMap.set("_angle",e.angle):this._angle=e.angle,Object(x.c)(e.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):this._horizontalAlignment=e.horizontalAlignment,Object(x.c)(e.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):this._verticalAlignment=e.verticalAlignment,this._scaleFactor=r,Object(x.c)(e.text)?this._dynamicPropertyMap.set("_text",e.text):this._text=e.text;var a=Math.min(Math.round(Object(p.h)(e.referenceSize*e.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*a)),this._materialKey=e.materialKey;var n=g.f.load(this._materialKey);n.sdf=!0,this._bitset=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1,this._materialKey=n.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=e.markerPlacement,this._effects=e.effects,this._isCIM=!0}static fromCIMText(e){return new Ne(e)}analyze(e,t,r,i){var a=this;return Object(s.a)((function*(){var s=t.readLegacyFeature(),n=function(e,t,r,i){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,r,i):""}(a._cimTextLayer,s,r,i),o=yield e.getMosaicItem(a._cimTextLayer.cim,Object(Le.a)(n));return a._textToGlyphs.set(n,o.glyphMosaicItems),o}))()}bindFeature(e,t,r){var i=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach(((e,s)=>{this[s]=e(i,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(ke.d)(this._horizontalAlignment||"center"),this._yAlignD=Object(ke.f)(this._verticalAlignment||"baseline");var s=this._textToGlyphs.get(this._text);this.bindTextInfo(s,!1)}else this._shapingInfo=null}}var Ae=Ne,ze=128;class De extends(se(ne.a)){constructor(e,t,r,i,s,a,n,o,l){super(),this._effects=l;var h=g.a.load(e);t&&(h.sdf=t.sdf,h.pattern=!0,h.textureBinding=t.textureBinding),this.fillColor=r,this.tl=i,this.br=s,this.aux1=a,this.aux2=n,this.aux3=o,this._materialKey=h.data}static fromCIMFill(e,t){var r=e.color,i=r&&Object(v.c)(r)||0,s=e.materialKey;if(!t){var a=Object(_.b)(0,0,0,e.colorLocked?1:0);return new De(s,null,i,0,0,0,0,a,e.effects)}var{rect:n,width:o,height:l}=t,h=n.x+m.q,c=n.y+m.q,u=h+o,d=c+l,g=Object(f.o)(l);g>255?g=255:g<=0&&(g=Object(f.o)(d-c));var x=Object(f.o)(o||0);x>255?x=255:x<=0&&(x=Object(f.o)(u-h));var b=Object(p.h)(e.offsetX||0)+ze;b>255&&(b=255);var O=Object(p.h)(-e.offsetY||0)+ze;O>255&&(O=255);var w=e.scaleX||1,S=Object(_.a)(h,c),j=Object(_.a)(u,d),M=Object(_.b)(x,g,b,O),T=Object(_.a)(ze*w,128),E=Object(_.b)(0,0,Object(y.b)(e.angle),e.colorLocked?1:0);return new De(s,t,i,S,j,M,T,E,e.effects)}static fromSimpleFill(e,t,r=!1){var{color:i}=e,s=i&&"esriSFSNull"!==e.style&&Object(v.d)(i)||0,a=Object(_.b)(0,0,0,r?255:0),n=e.materialKey;if(!t)return new De(n,null,s,0,0,0,0,a,null);var{rect:o,width:l,height:h}=t,c=o.x+m.q,u=o.y+m.q,d=c+l,p=u+h,g=Object(_.a)(c,u),y=Object(_.a)(d,p),x=Object(_.b)(Object(f.o)(d-c),Object(f.o)(p-u),0,0),b=Object(_.a)(ze,ze);return new De(n,t,s,g,y,x,b,a,null)}static fromPictureFill(e,t,r=!1){var i=m.p,{rect:s,width:a,height:n}=t,o=s.x+m.q,l=s.y+m.q,h=o+a,c=l+n,u=Object(_.a)(o,l),d=Object(_.a)(h,c),g=Object(f.o)(Object(p.h)(e.width));g>255&&(g=255);var v=Object(f.o)(Object(p.h)(e.height));v>255&&(v=255);var y=Object(p.h)(e.xoffset)+ze;y>255&&(y=255);var x=Object(p.h)(-e.yoffset)+ze;x>255&&(x=255);var b=Object(_.b)(g,v,y,x),O=Object(_.a)(ze*e.xscale,ze*e.yscale),w=Object(_.b)(0,0,0,r?255:0),S=e.materialKey;return new De(S,t,i,u,d,b,O,w,null)}}var Fe=De,Ve=r(151),Ge=a.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class Be extends(be(ne.a)){constructor(e,t,r,i,s,a,n,o,l,h,c,u,d,f,p,m){super();var _=g.c.load(e);t&&(_.sdf=t.sdf,_.pattern=!0,_.textureBinding=t.textureBinding),this._capType=i,this._joinType=s,this._miterLimitCosine=Object(x.b)(a),this.tessellationProperties._fillColor=n,this.tessellationProperties._tl=o,this.tessellationProperties._br=l,this._hasPattern=h,this._isDashed=c,this._joinOnUTurn=p,this._isColorLocked=u,this._zOrder=f,this._effects=m,this._materialKey=_.data,this.tessellationProperties._bitset=u?1:0,this.tessellationProperties._halfWidth=.5*r,this.tessellationProperties._halfReferenceWidth=.5*d,this._initializeTessellator(!1)}static fromCIMLine(e,t,r){var i=e.color,s=e.scaleFactor||1,a=e.isDashed,n=e.cap;a&&1===n&&(n=2);var o=e.join,l=Object(p.h)(e.width)*s,h=Object(p.h)(e.referenceWidth),c=Object(p.h)(e.miterLimit),u=i&&Object(v.c)(i)||0;if(!t)return new Be(e.materialKey,t,l,n,o,c,u,0,0,!1,a,e.colorLocked,h,e.zOrder,r,e.effects);var{rect:d,width:f,height:g}=t,y=d.x+m.q,x=d.y+m.q,b=y+f,O=x+g,w=Object(_.a)(y,x),S=Object(_.a)(b,O);return new Be(e.materialKey,t,l,n,o,c,u,w,S,!0,a,e.colorLocked,h,e.zOrder,r,e.effects)}static fromSimpleLine(e,t,r){var{color:i}=e,s="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,a=Object(Ve.h)(e.cap||"round",s),n=Object(Ve.i)(e.join||"round"),o=i&&"esriSLSNull"!==e.style&&Object(v.d)(i)||0;"esriSLSNull"===e.style&&(o=0);var l=Object(p.h)(e.width),h=e.miterLimit;if(!t)return new Be(e.materialKey,t,l,a,n,h,o,0,0,!1,s,!1,l,0,r,null);var{rect:c,width:u,height:d}=t,f=c.x+m.q,g=c.y+m.q,y=f+u,x=g+d,b=Object(_.a)(f,g),O=Object(_.a)(y,x);return new Be(e.materialKey,t,l,a,n,h,o,b,O,!0,s,!1,l,0,r,null)}static fromPictureLineSymbol(e,t,r,i){return Ge.error("PictureLineSymbol support does not exist!"),null}}var Ue=Be;function We(){return(We=Object(s.a)((function*(e,t,r){try{yield e.acquire(),yield t(r),e.release()}catch(i){throw e.release(),i}}))).apply(this,arguments)}var qe=class{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){var e=this;return Object(s.a)((function*(){if(!e._resolver)return e._resolver=Object(o.g)(),Promise.resolve();yield e._resolver.promise,yield e.acquire()}))()}release(){var e=this._resolver;this._resolver=null,e.resolve()}},He=a.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Xe=new Array;function Ye(e,t){var r=e.length;return e.push(null),t.then((t=>e[r]=t)),e}function Ke(e){return!!(1&e)}class Ze{constructor(e,t){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new qe,this._fetchResource=e,this._joinOnUTurn=t}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var i=new Array;t&&this._createMeshTemplates(i,t,!0),this._createMeshTemplates(i,e,!1);var s=this._createGroupId("expanded-cim"===e.type);return this._idToTemplateGroup.set(s,i),this._symbolToTemplate.set(r,s),s}getTemplateGroup(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):Xe}getDynamicTemplateGroup(e){return this._idToTemplateGroup.has(e)?(Ke(e)||He.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):Xe}getMosaicItem(e,t){var r=this._createTemplateId(),i=new Promise((e=>this._idToResolver.set(r,e)));return this._fetchQueue.push({symbol:e,id:r,glyphIds:t}),i}finalize(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return We.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Object(c.c)(l.c),!1),marker:this._createMeshTemplates([],Object(c.c)(l.b),!1),line:this._createMeshTemplates([],Object(c.c)(l.d),!1)})}_fetchAllQueuedResources(e){if(!this._fetchQueue.length)return Promise.resolve();var t=this._fetchQueue,r=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(r).then((()=>this._fetchResource(t,e).then((e=>{for(var{id:t,mosaicItem:r}of e)this._idToResolver.get(t)(r),this._idToResolver.delete(t)})))).catch((e=>{Object(o.m)(e)?this._fetchQueue=this._fetchQueue.concat(t):function(e){return"worker:port-closed"===e.name}(e)||He.error(new n.a("mapview-template-store","Unable to fetch requested texture resources",e))}))}_createGroupId(e){return this._idCounter++<<1|(e?1:0)}_createTemplateId(){return this._templateIdCounter++}_createSMS(e){var t=this;return Object(s.a)((function*(){var{spriteMosaicItem:r}=yield t.getMosaicItem(e);return Object(h.a)(r,He)?d.a.fromSimpleMarker(e,r):t._markerError}))()}_createPMS(e){var t=this;return Object(s.a)((function*(){var{spriteMosaicItem:r}=yield t.getMosaicItem(e);return Object(h.a)(r,He)?d.a.fromPictureMarker(e,r):t._markerError}))()}_createSFS(e,t){var r=this;return Object(s.a)((function*(){var{spriteMosaicItem:i}=yield r.getMosaicItem(e);return Object(h.a)(i,He)?Fe.fromSimpleFill(e,i,t):r._fillError}))()}_createPFS(e,t){var r=this;return Object(s.a)((function*(){var{spriteMosaicItem:i}=yield r.getMosaicItem(e);return Object(h.a)(i,He)?Fe.fromPictureFill(e,i,t):r._fillError}))()}_createSLS(e,t){var r=this;return Object(s.a)((function*(){var{spriteMosaicItem:t}=yield r.getMosaicItem(e);return Object(h.a)(t,He)?Ue.fromSimpleLine(e,t,r._joinOnUTurn):r._lineError}))()}_createLMS(e){var t=this;return Object(s.a)((function*(){var{spriteMosaicItem:r}=yield t.getMosaicItem(e);return Object(h.a)(r,He)?d.a.fromLineSymbolMarker(e,r):t._markerError}))()}_createTS(e){var t=this;return Object(s.a)((function*(){var{glyphMosaicItems:r}=yield t.getMosaicItem(e);return u.a.fromText(e,r)}))()}_createCIMText(e){var t=this;return Object(s.a)((function*(){var{glyphMosaicItems:r}=yield t.getMosaicItem(e.cim,Object(Le.a)(e.text));return Object(h.a)(r,He)?u.a.fromCIMText(e,r):t._textError}))()}_createCIMFill(e){var t=this;return Object(s.a)((function*(){var{spriteMosaicItem:r}=yield t.getMosaicItem(e.cim);return Object(h.a)(r,He)?Fe.fromCIMFill(e,r):t._fillError}))()}_createCIMLine(e){var t=this;return Object(s.a)((function*(){var{spriteMosaicItem:r}=yield t.getMosaicItem(e.cim);return Object(h.a)(r,He)?Ue.fromCIMLine(e,r,t._joinOnUTurn):t._lineError}))()}_createCIMMarker(e){var t=this;return Object(s.a)((function*(){var{spriteMosaicItem:r}=yield t.getMosaicItem(e.cim);return Object(h.a)(r,He)?d.a.fromCIMMarker(e,r):t._markerError}))()}_createCIM(e){var t=this;return Object(s.a)((function*(){var r=e.templateHash;if(t._cimTemplateCache.has(r))return t._cimTemplateCache.get(r);var s,a=Object(i.a)(Object(i.a)({},e),{},{cim:Object(i.a)(Object(i.a)({},e.cim),{},{mosaicHash:e.materialHash})});switch(a.type){case"marker":s=t._createCIMMarker(a);break;case"line":s=t._createCIMLine(a);break;case"fill":s=t._createCIMFill(a);break;case"text":s=t._createCIMText(a)}return s.then((e=>t._cimTemplateCache.set(r,e))),s}))()}_createDynamicCIM(e){var t,r=e.templateHash;if(this._cimTemplateCache.has(r))return this._cimTemplateCache.get(r);switch(e.type){case"marker":t=Pe.fromCIMMarker(e);break;case"line":t=we.fromCIMLine(e);break;case"fill":t=de.fromCIMFill(e);break;case"text":t=Ae.fromCIMText(e)}return this._cimTemplateCache.set(r,t),t}_createPrimitiveMeshTemplates(e,t,r){switch(t.type){case"esriSMS":return Ye(e,this._createSMS(t));case"esriPMS":return Ye(e,this._createPMS(t));case"esriSFS":return Ye(e,this._createSFS(t,r));case"line-marker":return Ye(e,this._createLMS(t));case"esriPFS":return Ye(e,this._createPFS(t,r));case"esriSLS":return Ye(e,this._createSLS(t,!1));case"esriTS":return Ye(e,this._createTS(t));default:return He.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}_createMeshTemplates(e,t,r){if(-1!==t.type.indexOf("3d"))return He.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){for(var i of t.layers)"function"==typeof i.materialHash?e.push(this._createDynamicCIM(i)):Ye(e,this._createCIM(i));return e}if("composite-symbol"===t.type){for(var s of t.layers)this._createPrimitiveMeshTemplates(e,s,r);return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}},454:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var i=r(135),s=r(321),a=r(290),n=r(238),o=r(285),l=r(164),h=r(446),c=r(110);class u{constructor(e,t,r,i){this.center=Object(n.b)(e,t),this.centerT=Object(n.a)(),this.halfWidth=r/2,this.halfHeight=i/2,this.width=r,this.height=i}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new u(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){var r=Math.abs(e.centerT[0]-this.centerT[0]),i=Math.abs(e.centerT[1]-this.centerT[1]),s=(e.halfWidth+this.halfWidth+t)/r,a=(e.halfHeight+this.halfHeight+t)/i,n=Math.min(s,a);return Object(c.m)(n)}extend(e){var t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),i=Math.max(this.xmax,e.xmax)-t,s=Math.max(this.ymax,e.ymax)-r,a=t+i/2,n=r+s/2;this.width=i,this.height=s,this.halfWidth=i/2,this.halfHeight=s/2,this.x=a,this.y=n}static deserialize(e){var t=e.readF32(),r=e.readF32(),i=e.readInt32(),s=e.readInt32();return new u(t,r,i,s)}}var d=u,f=Math.PI/180;class p{constructor(e,t,r,i){this._rotationT=Object(a.a)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;var s=r.rect,n=new Float32Array(8);e*=i,t*=i;var o=r.code?s.width*i:r.metrics.width,l=r.code?s.height*i:r.metrics.height;n[0]=e,n[1]=t,n[2]=e+o,n[3]=t,n[4]=e,n[5]=t+l,n[6]=e+o,n[7]=t+l,this._data=n,this._setTextureCoords(s),this._scale=i,this._mosaic=r,this.x=e,this.y=t,this.maxOffset=Math.max(e+o,t+l)}get width(){return this._mosaic.metrics.width*this._scale}get mosaic(){return this._mosaic}set angle(e){this._angle=e,Object(s.d)(this._rotationT),Object(s.f)(this._rotationT,this._rotationT,-e),this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(this._data),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){var{height:e,width:t}=this._mosaic.metrics,r=t*this._scale,i=Math.abs(e)*this._scale,n=new Float32Array(8);n[0]=this.x,n[1]=this.y,n[2]=this.x+r,n[3]=this.y,n[4]=this.x,n[5]=this.y+i,n[6]=this.x+r,n[7]=this.y+i;var o=Object(s.e)(Object(a.a)(),this._rotationT,this._T);Object(a.b)(n,n,o);for(var l=1/0,h=1/0,c=0,u=0,f=0;f<4;f++){var p=n[2*f],m=n[2*f+1];l=Math.min(l,p),h=Math.min(h,m),c=Math.max(c,p),u=Math.max(u,m)}var _=c-l,g=u-h,v=l+_/2,y=h+g/2;this._bounds=new d(v,y,_,g)}return this._bounds}setTransform(e){this._T=e,this._offsets=null}_setOffsets(e){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var t=this._offsets,r=new Float32Array(8),i=Object(s.e)(Object(a.a)(),this._rotationT,this._T);Object(a.b)(r,e,i),t.upperLeft=Object(l.a)(8*r[0],8*r[1]),t.upperRight=Object(l.a)(8*r[2],8*r[3]),t.lowerLeft=Object(l.a)(8*r[4],8*r[5]),t.lowerRight=Object(l.a)(8*r[6],8*r[7])}_setTextureCoords({x:e,y:t,width:r,height:i}){this._texcoords={upperLeft:Object(l.a)(e,t),upperRight:Object(l.a)(e+r,t),lowerLeft:Object(l.a)(e,t+i),lowerRight:Object(l.a)(e+r,t+i)}}}var m=(e,t)=>({code:0,page:0,sdf:!0,rect:new h.a(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});class _{constructor(e,t,r){for(var i of(this._rotation=0,this._decorate(e,t,r),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==r.angle,this._T=this._createGlyphTransform(this.bounds,r),e))i.setTransform(this._T)}setRotation(e){if(0!==e||0!==this._rotation){this._rotation=e;var t=this._T,r=Object(s.b)(Object(a.a)(),e);for(var i of(Object(s.e)(t,r,t),this.glyphs))i.setTransform(this._T)}}_decorate(e,t,r){if(r.decoration&&"none"!==r.decoration&&e.length){var i=r.scale,s="underline"===r.decoration?30:20,a=e[0].textureBinding;for(var n of t){var o=n.startX*i,l=n.startY*i,h=(n.width+n.glyphWidthEnd)*i;e.push(new p(o,l+s*i,m(h,a),1))}}}get boundsT(){var e=this.bounds,t=Object(i.r)(Object(n.a)(),e.x,e.y);if(Object(i.s)(t,t,this._T),this._hasRotation){var r=Math.max(e.width,e.height);return new d(t[0],t[1],r,r)}return new d(t[0],t[1],e.width,e.height)}_createBounds(e){var t=1/0,r=1/0,i=0,s=0;for(var a of e)t=Math.min(t,a.xTopLeft),r=Math.min(r,a.yTopLeft),i=Math.max(i,a.xTopLeft+a.width),s=Math.max(s,a.yBottomRight);var n=i-t,o=s-r;return new d(t+n/2,r+o/2,n,o)}_createGlyphTransform(e,t){var r=f*t.angle,o=Object(a.a)(),l=Object(n.a)();return Object(s.h)(o,o,Object(i.r)(l,t.xOffset,-t.yOffset)),t.isCIM?Object(s.f)(o,o,r):(Object(s.h)(o,o,Object(i.r)(l,e.x,e.y)),Object(s.f)(o,o,r),Object(s.h)(o,o,Object(i.r)(l,-e.x,-e.y))),o}}class g{constructor(e,t,r,i,s,a){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,r)),this.end=Math.max(0,Math.max(t,r)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=i,this.yMin=s,this.yMax=a}}var v=e=>10===e,y=e=>32===e;function x(e,t,r){for(var i=r.scale,s=new Array,a=function(e,t,r){for(var i=new Array,s=1/r.scale,a=r.maxLineWidth*s,n=t?e.length-1:0,o=t?-1:e.length,l=t?-1:1,h=n,c=0,u=0,d=h,f=d,p=0,m=1/0,_=0;h!==o;){var{code:x,metrics:b}=e[h],O=Math.abs(b.top);if(v(x)||y(x)||(m=Math.min(m,O),_=Math.max(_,O+b.height)),v(x))h!==n&&(i.push(new g(e,d,h-l,c,m,_)),m=1/0,_=0),c=0,d=h+l,f=h+l,u=0;else if(y(x))f=h+l,u=0,p=b.advance,c+=b.advance;else if(c>a){if(f!==d){var w=f-2*l;c-=p,i.push(new g(e,d,w,c-u,m,_)),m=1/0,_=0,d=f,c=u}else i.push(new g(e,d,h-l,c,m,_)),m=1/0,_=0,d=h,f=h,c=0;c+=b.advance,u+=b.advance}else c+=b.advance,u+=b.advance;h+=l}var S=new g(e,d,h-l,c,m,_);return S.start>=0&&S.end<e.length&&i.push(S),i}(e,t,r),n=function(e,t){for(var r=0,i=0;i<e.length;i++){var{width:s}=e[i];r=Math.max(s,r)}var a="underline"===t.decoration?4:0,n=e[0].yMin;return{x:0,y:n,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+a-n,width:r}}(a,r),{vAlign:l,hAlign:h}=r,c=l===o.a.Baseline?1:0,u=c?0:l-1,d=(1-c)*-n.y+u*(n.height/2)+-26*(c?1:0),f=0;f<a.length;f++){var{start:m,end:x,width:b}=a[f],O=-1*(h+1)*(b/2)-3,w=f*r.lineHeight+d-3;a[f].startX=O,a[f].startY=w;for(var S=m;S<=x;S++){var j=e[S];if(!v(j.code)){var M=new p(O+j.metrics.left,w-j.metrics.top,j,i);O+=j.metrics.advance,s.push(M)}}}return new _(s,a,r)}},464:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var i=r(7),s=r(546),a=(r(138),r(418)),n=r(127),o=r(156),l={marker:n.d.MARKER,fill:n.d.FILL,line:n.d.LINE,text:n.d.TEXT};class h{constructor(e,t,r,i){for(var s of(this.layers=e,this.data=t,this.hash=this._createHash(),this.rendererKey=r,e)){var a=l[s.type];s.materialKey=Object(o.g)(a,this.rendererKey,!1,!1),s.maxVVSize=i}}get type(){return"expanded-cim"}_createHash(){var e="";for(var t of this.layers)e+=t.templateHash;return e}}var c=function(){var e=Object(i.a)((function*(e,t){return new h(yield Object(a.b)(e.data,t),e.data,e.rendererKey,e.maxVVSize)}));return function(t,r){return e.apply(this,arguments)}}(),u=function(){var e=Object(i.a)((function*(e,t,r){if(!e)return null;if("cim"===e.type)return c(e,t);if("web-style"===e.type){var i=s.a.fromJSON(e),a={type:"cim",data:(yield i.fetchCIMSymbol(r)).data,rendererKey:e.rendererKey,maxVVSize:e.maxVVSize};return c(a,t)}return e}));return function(t,r,i){return e.apply(this,arguments)}}()},469:function(e,t,r){"use strict";function i(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,o){if(!t||!t.lengths.length)return null;var l="upperLeft"===(null==o?void 0:o.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var h=e.coords,c=[],u=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:f}=t,p=i(r,s),m=0;for(var _ of d){var g=a(u,f,m,_,r,s,l);g&&c.push(g),m+=_*p}if(c.sort(((e,t)=>{var i=l*e[2]-l*t[2];return 0===i&&r&&(i=e[4]-t[4]),i})),c.length){var v=6*c[0][2];h[0]=c[0][0]/v,h[1]=c[0][1]/v,r&&(v=6*c[0][4],h[2]=0!==v?c[0][3]/v:0),(h[0]<u[0]||h[0]>u[1]||h[1]<u[2]||h[1]>u[3]||r&&(h[2]<u[4]||h[2]>u[5]))&&(h.length=0)}if(!h.length){var y=t.lengths[0]?n(f,0,d[0],r,s):null;if(!y)return null;h[0]=y[0],h[1]=y[1],r&&y.length>2&&(h[2]=y[2])}return e}function a(e,t,r,s,a,n,o=1){for(var l=i(a,n),h=r,c=r+l,u=0,d=0,f=0,p=0,m=0,_=0,g=s-1;_<g;_++,h+=l,c+=l){var v=t[h],y=t[h+1],x=t[h+2],b=t[c],O=t[c+1],w=t[c+2],S=v*O-b*y;p+=S,u+=(v+b)*S,d+=(y+O)*S,a&&(f+=(x+w)*(S=v*w-b*x),m+=S),v<e[0]&&(e[0]=v),v>e[1]&&(e[1]=v),y<e[2]&&(e[2]=y),y>e[3]&&(e[3]=y),a&&(x<e[4]&&(e[4]=x),x>e[5]&&(e[5]=x))}if(p*o>0&&(p*=-1),m*o>0&&(m*=-1),!p)return null;var j=[u,d,.5*p];return a&&(j[3]=f,j[4]=.5*m),j}function n(e,t,r,s,a){for(var n=i(s,a),u=t,d=t+n,f=0,p=0,m=0,_=0,g=0,v=r-1;g<v;g++,u+=n,d+=n){var y=e[u],x=e[u+1],b=e[u+2],O=e[d],w=e[d+1],S=e[d+2],j=s?l(y,x,b,O,w,S):o(y,x,O,w);if(j)if(f+=j,s){var M=c(y,x,b,O,w,S);p+=j*M[0],m+=j*M[1],_+=j*M[2]}else{var T=h(y,x,O,w);p+=j*T[0],m+=j*T[1]}}return f>0?s?[p/f,m/f,_/f]:[p/f,m/f]:r>0?s?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function o(e,t,r,i){var s=r-e,a=i-t;return Math.sqrt(s*s+a*a)}function l(e,t,r,i,s,a){var n=i-e,o=s-t,l=a-r;return Math.sqrt(n*n+o*o+l*l)}function h(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function c(e,t,r,i,s,a){return[e+.5*(i-e),t+.5*(s-t),r+.5*(a-r)]}r.d(t,"a",(function(){return s}))},481:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return i}));var i={Base64:0,Hex:1,String:2,Raw:3};function s(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e){for(var t=[],r=0,i=8*e.length;r<i;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function n(e){for(var t=[],r=0,i=32*e.length;r<i;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function o(e,t,r,i,a,n){return s(function(e,t){return e<<t|e>>>32-t}(s(s(t,e),s(i,n)),a),r)}function l(e,t,r,i,s,a,n){return o(t&r|~t&i,e,t,s,a,n)}function h(e,t,r,i,s,a,n){return o(t&i|r&~i,e,t,s,a,n)}function c(e,t,r,i,s,a,n){return o(t^r^i,e,t,s,a,n)}function u(e,t,r,i,s,a,n){return o(r^(t|~i),e,t,s,a,n)}function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,i=-271733879,a=-1732584194,n=271733878,o=0;o<e.length;o+=16){var d=r,f=i,p=a,m=n;r=l(r,i,a,n,e[o+0],7,-680876936),n=l(n,r,i,a,e[o+1],12,-389564586),a=l(a,n,r,i,e[o+2],17,606105819),i=l(i,a,n,r,e[o+3],22,-1044525330),r=l(r,i,a,n,e[o+4],7,-176418897),n=l(n,r,i,a,e[o+5],12,1200080426),a=l(a,n,r,i,e[o+6],17,-1473231341),i=l(i,a,n,r,e[o+7],22,-45705983),r=l(r,i,a,n,e[o+8],7,1770035416),n=l(n,r,i,a,e[o+9],12,-1958414417),a=l(a,n,r,i,e[o+10],17,-42063),i=l(i,a,n,r,e[o+11],22,-1990404162),r=l(r,i,a,n,e[o+12],7,1804603682),n=l(n,r,i,a,e[o+13],12,-40341101),a=l(a,n,r,i,e[o+14],17,-1502002290),r=h(r,i=l(i,a,n,r,e[o+15],22,1236535329),a,n,e[o+1],5,-165796510),n=h(n,r,i,a,e[o+6],9,-1069501632),a=h(a,n,r,i,e[o+11],14,643717713),i=h(i,a,n,r,e[o+0],20,-373897302),r=h(r,i,a,n,e[o+5],5,-701558691),n=h(n,r,i,a,e[o+10],9,38016083),a=h(a,n,r,i,e[o+15],14,-660478335),i=h(i,a,n,r,e[o+4],20,-405537848),r=h(r,i,a,n,e[o+9],5,568446438),n=h(n,r,i,a,e[o+14],9,-1019803690),a=h(a,n,r,i,e[o+3],14,-187363961),i=h(i,a,n,r,e[o+8],20,1163531501),r=h(r,i,a,n,e[o+13],5,-1444681467),n=h(n,r,i,a,e[o+2],9,-51403784),a=h(a,n,r,i,e[o+7],14,1735328473),r=c(r,i=h(i,a,n,r,e[o+12],20,-1926607734),a,n,e[o+5],4,-378558),n=c(n,r,i,a,e[o+8],11,-2022574463),a=c(a,n,r,i,e[o+11],16,1839030562),i=c(i,a,n,r,e[o+14],23,-35309556),r=c(r,i,a,n,e[o+1],4,-1530992060),n=c(n,r,i,a,e[o+4],11,1272893353),a=c(a,n,r,i,e[o+7],16,-155497632),i=c(i,a,n,r,e[o+10],23,-1094730640),r=c(r,i,a,n,e[o+13],4,681279174),n=c(n,r,i,a,e[o+0],11,-358537222),a=c(a,n,r,i,e[o+3],16,-722521979),i=c(i,a,n,r,e[o+6],23,76029189),r=c(r,i,a,n,e[o+9],4,-640364487),n=c(n,r,i,a,e[o+12],11,-421815835),a=c(a,n,r,i,e[o+15],16,530742520),r=u(r,i=c(i,a,n,r,e[o+2],23,-995338651),a,n,e[o+0],6,-198630844),n=u(n,r,i,a,e[o+7],10,1126891415),a=u(a,n,r,i,e[o+14],15,-1416354905),i=u(i,a,n,r,e[o+5],21,-57434055),r=u(r,i,a,n,e[o+12],6,1700485571),n=u(n,r,i,a,e[o+3],10,-1894986606),a=u(a,n,r,i,e[o+10],15,-1051523),i=u(i,a,n,r,e[o+1],21,-2054922799),r=u(r,i,a,n,e[o+8],6,1873313359),n=u(n,r,i,a,e[o+15],10,-30611744),a=u(a,n,r,i,e[o+6],15,-1560198380),i=u(i,a,n,r,e[o+13],21,1309151649),r=u(r,i,a,n,e[o+4],6,-145523070),n=u(n,r,i,a,e[o+11],10,-1120210379),a=u(a,n,r,i,e[o+2],15,718787259),i=u(i,a,n,r,e[o+9],21,-343485551),r=s(r,d),i=s(i,f),a=s(a,p),n=s(n,m)}return[r,i,a,n]}function f(e,t=i.Hex){var r=t||i.Base64,s=d(a(e),8*e.length);switch(r){case i.Raw:return s;case i.Hex:return function(e){for(var t="0123456789abcdef",r=[],i=0,s=4*e.length;i<s;i++)r.push(t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15));return r.join("")}(s);case i.String:return n(s);case i.Base64:return function(e){for(var t=[],r=0,i=4*e.length;r<i;r+=3)for(var s=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,a=0;a<4;a++)8*r+6*a>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s>>6*(3-a)&63));return t.join("")}(s)}}},493:function(e,t,r){"use strict";r.d(t,"a",(function(){return c})),r.d(t,"b",(function(){return l})),r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return h}));var i=r(100),s=r(350),a=r(427);function n(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":var t=e.symbolLayers;return t&&1===t.length?n(t[0]):null;case"CIMVectorMarker":var r=e.markerGraphics;if(!r||1!==r.length)return null;var i=r[0];if(!i)return null;var s=i.geometry;if(!s)return null;var a=i.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:{geom:s,asFill:"CIMPolygonSymbol"===a.type};case"sdf":return{geom:e.geom,asFill:e.asFill}}return null}function o(e){var t=1/0,r=-1/0,i=1/0,s=-1/0;for(var a of e)for(var n of a)n[0]<t&&(t=n[0]),n[0]>r&&(r=n[0]),n[1]<i&&(i=n[1]),n[1]>s&&(s=n[1]);return[t,i,r,s]}function l(e){return e?e.rings?o(e.rings):e.paths?o(e.paths):Object(i.d)(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function h(e,t,r,i,s){var[a,n,o,l]=e;if(o<a||l<n)return[0,0,0];var h=o-a,c=l-n,u=Math.floor(31.5),d=(128-2*(u+1))/Math.max(h,c),f=Math.round(h*d)+2*u,p=Math.round(c*d)+2*u,m=1;t&&(m=p/d/(t.ymax-t.ymin));var _=0,g=0;if(i)if(s){if(t&&r&&t.ymax-t.ymin>0){var v=(t.xmax-t.xmin)/(t.ymax-t.ymin);_=i.x/(r*v),g=i.y/r}}else _=i.x,g=i.y;return _=.5*(t.xmax+t.xmin)+_*(t.xmax-t.xmin),g=.5*(t.ymax+t.ymin)+g*(t.ymax-t.ymin),_-=a,g-=n,_*=d,g*=d,[m,(_+=u)/f-.5,-((g+=u)/p-.5)]}function c(e){var t=function(e){return e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}(e.geom),r=function(e){var t=1/0,r=-1/0,i=1/0,a=-1/0;for(var n of e)for(var o of n)o[0]<t&&(t=o[0]),o[0]>r&&(r=o[0]),o[1]<i&&(i=o[1]),o[1]>a&&(a=o[1]);return new s.a(t,i,r-t,a-i)}(t),i=Math.floor(31.5),a=(128-2*(i+1))/Math.max(r.width,r.height),n=Math.round(r.width*a)+2*i,o=Math.round(r.height*a)+2*i,l=[];for(var h of t)if(h&&h.length>1){var c=[];for(var d of h){var[f,p]=d;f-=r.x,p-=r.y,f*=a,p*=a,f+=i-.5,p+=i-.5,c.push([f,p])}if(e.asFill){var m=c.length-1;c[0][0]===c[m][0]&&c[0][1]===c[m][1]||c.push(c[0])}l.push(c)}var _=function(e,t,r,i){for(var s=t*r,a=new Array(s),n=i*i+1,o=0;o<s;++o)a[o]=n;for(var l of e)for(var h=l.length,c=1;c<h;++c){var u=l[c-1],d=l[c],f=void 0,p=void 0,m=void 0,_=void 0;u[0]<d[0]?(f=u[0],p=d[0]):(f=d[0],p=u[0]),u[1]<d[1]?(m=u[1],_=d[1]):(m=d[1],_=u[1]);var g=Math.floor(f)-i,v=Math.floor(p)+i,y=Math.floor(m)-i,x=Math.floor(_)+i;g<0&&(g=0),v>t&&(v=t),y<0&&(y=0),x>r&&(x=r);for(var b=d[0]-u[0],O=d[1]-u[1],w=b*b+O*O,S=g;S<v;S++)for(var j=y;j<x;j++){var M=void 0,T=void 0,E=(S-u[0])*b+(j-u[1])*O;E<0?(M=u[0],T=u[1]):E>w?(M=d[0],T=d[1]):(E/=w,M=u[0]+E*b,T=u[1]+E*O);var C=(S-M)*(S-M)+(j-T)*(j-T),I=(r-j-1)*t+S;C<a[I]&&(a[I]=C)}}for(var P=0;P<s;++P)a[P]=Math.sqrt(a[P]);return a}(l,n,o,i);return e.asFill&&function(e,t,r,i,s){for(var a of e)for(var n=a.length,o=1;o<n;++o){var l=a[o-1],h=a[o],c=void 0,u=void 0,d=void 0,f=void 0;l[0]<h[0]?(c=l[0],u=h[0]):(c=h[0],u=l[0]),l[1]<h[1]?(d=l[1],f=h[1]):(d=h[1],f=l[1]);var p=Math.floor(c),m=Math.floor(u)+1,_=Math.floor(d),g=Math.floor(f)+1;p<i&&(p=i),m>t-i&&(m=t-i),_<i&&(_=i),g>r-i&&(g=r-i);for(var v=_;v<g;++v)if(l[1]>v!=h[1]>v){for(var y=(r-v-1)*t,x=p;x<m;++x)x<(h[0]-l[0])*(v-l[1])/(h[1]-l[1])+l[0]&&(s[y+x]=-s[y+x]);for(var b=i;b<p;++b)s[y+b]=-s[y+b]}}}(l,n,o,i,_),[u(_,i),n,o]}function u(e,t){for(var r=2*t,i=e.length,s=new Uint8Array(4*i),n=0;n<i;++n){var o=.5-e[n]/r;Object(a.a)(o,s,4*n)}return s}},494:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=new(r(95).a)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function s(e){return i.toJSON(e)}},495:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));class i{constructor(e,t){this.x=e,this.y=t}clone(){return new i(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){this.x=e,this.y=t}normalize(){var e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);this.x/=r,this.y/=r}rightPerpendicular(){var e=this.x;this.x=this.y,this.y=-e}move(e,t){this.x+=e,this.y+=t}assign(e){this.x=e.x,this.y=e.y}assignAdd(e,t){this.x=e.x+t.x,this.y=e.y+t.y}assignSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}rotate(e,t){var r=this.x,i=this.y;this.x=r*e-i*t,this.y=r*t+i*e}scale(e){this.x*=e,this.y*=e}length(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}static distance(e,t){var r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static add(e,t){return new i(e.x+t.x,e.y+t.y)}static sub(e,t){return new i(e.x-t.x,e.y-t.y)}}},496:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(89),s=r(168),a=r(407);class n extends a.a{constructor(e,t,r){super(e),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=r,this._features=t}static fromFeatures(e,t,r){for(var i=Object(s.c)([],e,t,!1,!1,r),a=0;a<i.length;a++)i[a].displayId=e[a].displayId;return n.fromOptimizedFeatures(i,t)}static fromFeatureSet(e,t){var r=Object(s.b)(e,t);return n.fromOptimizedFeatureSet(r)}static fromOptimizedFeatureSet(e){var{features:t,geometryType:r}=e,i=n.fromOptimizedFeatures(t,r);for(var s of(i._exceededTransferLimit=e.exceededTransferLimit,i._transform=e.transform,e.fields))"esriFieldTypeDate"===s.type&&i._dateFields.add(s.name);return i}static fromOptimizedFeatures(e,t,r){var i=a.a.createInstance(),s=new n(i,e,t);return s._transform=r,s}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}getApproximateSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){var e="";for(var t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}getGroupId(){return this._current.groupId}setGroupId(e){this._current.groupId=e}copy(){var e=new n(this.instance,this._features,this.geometryType);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._passesFilter()&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return Object(s.i)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){var e=this.readGeometry();return Object(s.k)(e,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){var e=this.readCentroid();return e?{x:e.coords[0]*this._sx+this._tx,y:e.coords[1]*this._sy+this._ty}:null}readGeometryArea(){return Object(s.s)(this._current.geometry,2)}readUnquantizedGeometry(){var e=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!e)return e;var t=e.clone();return function({coords:e,lengths:t}){var r=0;for(var i of t){for(var s=1;s<i;s++)e[2*(r+s)]+=e[2*(r+s)-2],e[2*(r+s)+1]+=e[2*(r+s)-1];r+=i}}(t),t}readHydratedGeometry(){var e=this._current.geometry;if(!e)return null;var t=e.clone();return Object(i.k)(this._transform)&&Object(s.z)(t,t,this.hasZ,this.hasM,this._transform),t}getXHydrate(){var e=this._current.geometry.coords[0],t=this.getQuantizationTransform();return Object(i.j)(t)?e:e*t.scale[0]+t.translate[0]}getYHydrate(){var e=this._current.geometry.coords[1],t=this.getQuantizationTransform();return Object(i.j)(t)?e:t.translate[1]-e*t.scale[1]}getX(){return this._current.geometry.coords[0]*this._sx+this._tx}getY(){return this._current.geometry.coords[1]*this._sy+this._ty}readGeometry(){if(!this._current.hasGeometry)return null;var e=this._current.geometry.clone();if(e.isPoint)return e.coords[0]=e.coords[0]*this._sx+this._tx,e.coords[1]=e.coords[1]*this._sy+this._ty,e;var t=0;for(var r of e.lengths)e.coords[2*t]=e.coords[2*t]*this._sx+this._tx,e.coords[2*t+1]=e.coords[2*t+1]*this._sy+this._ty,t+=r;return e}readCentroid(){if(!this._current.hasGeometry)return null;if(!this._current.centroid){var e=this._computeCentroid();if(!e)return null;e.coords[0]=(e.coords[0]-this._tx)/this._sx,e.coords[1]=(e.coords[1]-this._ty)/this._sy,this._current.centroid=e}var t=this._current.centroid.clone();return t.coords[0]=t.coords[0]*this._sx+this._tx,t.coords[1]=t.coords[1]*this._sx+this._ty,t}_readAttribute(e,t){var r=this._current.attributes[e];if(void 0!==r)return null!=r&&t&&this._dateFields.has(e)?new Date(r):r;var i=this.readAttributes(),s=e.toLocaleLowerCase().trim();for(var a in i)if(a.toLocaleLowerCase().trim()===s){var n=this._current.attributes[a];return null!=n&&t&&this._dateFields.has(a)?new Date(n):n}}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}_passesFilter(){if(!this._hasFilter)return!0;var e=0,t=0;switch(this.geometryType){case"esriGeometryPoint":var r=this._current.geometry;if(!r)return!1;[e,t]=r.coords;break;case"esriGeometryPolygon":var i=this.readCentroid();if(!i)return!1;[e,t]=i.coords,e-=this._tx,t-=this._ty;break;default:return!1}return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}}},497:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var i=r(133),s=Object(i.b)((function(e){var t;void 0!==(t=function(){function e(r,i,s,a,n){for(;a>s;){if(a-s>600){var o=a-s+1,l=i-s+1,h=Math.log(o),c=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*c*(o-c)/o)*(l-o/2<0?-1:1);e(r,i,Math.max(s,Math.floor(i-l*c/o+u)),Math.min(a,Math.floor(i+(o-l)*c/o+u)),n)}var d=r[i],f=s,p=a;for(t(r,s,i),n(r[a],d)>0&&t(r,s,a);f<p;){for(t(r,f,p),f++,p--;n(r[f],d)<0;)f++;for(;n(r[p],d)>0;)p--}0===n(r[s],d)?t(r,s,p):t(r,++p,a),p<=i&&(s=p+1),i<=p&&(a=p-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,s,a,n){e(t,i,s||0,a||t.length-1,n||r)}}())&&(e.exports=t)}))},507:function(e,t,r){"use strict";r.d(t,"a",(function(){return f})),r.d(t,"b",(function(){return u}));var i=r(91),s=r(7),a=r(105),n=r(122),o=r(350),l=r(352),h=r(337),c={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};function u(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];if("stops"===r.transformationType)return r.stops.map((e=>e.size)).reduce(j,0);if("clamped-linear"===r.transformationType){var i,s;return i="number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((e=>e.size)).reduce(j,0),s="number"==typeof r.minSize?r.minSize:r.minSize.stops.map((e=>e.size)).reduce(j,0),Math.max(i,s)}return"real-world-size"===r.transformationType?30:void 0}function d(e){return e.type in c}function f(e,t,r){return p.apply(this,arguments)}function p(){return(p=Object(s.a)((function*(e,t,r){if(!e||r&&"cluster"===r.type)return 0;if("heatmap"===e.type)return Math.round(3*e.blurRadius);if("dot-density"===e.type)return 0;if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?100:200;var i=e.getSymbols(),s=u(e),n=[];for(var o of i)n.push(O(o,s));var l=yield Promise.all(n);return Object(a.h)(l.reduce(j,0))}))).apply(this,arguments)}var m=[0,0,0,0];function _(e,t){return null==e?t:e}function g(e,t){return null==e.outline?t:_(e.outline.width,t)}var v={sdf:!0,code:99,metrics:n.c.metrics,rect:new o.a(0,0,24,24),page:0,textureBinding:2};function y(e){var t=e.text&&e.text.length;if(!t)return{glyphMosaicItems:[v]};for(var r=[],s=0;s<t;s++)r.push(Object(i.a)(Object(i.a)({},v),{},{code:e.text.charCodeAt(s)}));return{glyphMosaicItems:r}}function x(e,t){return b.apply(this,arguments)}function b(){return(b=Object(s.a)((function*(e,t){if("simple-marker"===e.type){var r=Math.max(_(e.size,12),t);return S(e)+.707*r}if("picture-marker"===e.type){var i=Math.max(_(e.height,12),t),s=_(e.width,12)*(i/_(e.height,12))/2,a=i/2;return S(e)+Math.sqrt(s*s+a*a)}if("text"===e.type){var n=y(e);Object(h.g)(m,e.toJSON(),n);var o=Math.abs(m[0]),c=Math.abs(m[1]),u=m[2],d=m[3];return Math.max(o,c)+Math.max(u,d)}if("simple-line"===e.type){var f=e,p=Math.max(_(f.width,.75),t)/2;return f.marker?Math.max(6*f.width,2*t):p}if("simple-fill"===e.type||"picture-fill"===e.type)return Math.max(g(e,0),t)/2;if("cim"===e.type){var v=l.a.getEnvelope(e.data);return v?Math.sqrt(v.width*v.width+v.height*v.height):0}return"web-style"===e.type?x(yield e.fetchCIMSymbol(),t):0}))).apply(this,arguments)}function O(e,t){return w.apply(this,arguments)}function w(){return(w=Object(s.a)((function*(e,t){return d(e)?Math.min(yield x(e,t),75):0}))).apply(this,arguments)}function S(e){var t=_(e.xoffset,0),r=_(e.yoffset,0);return Math.sqrt(t*t+r*r)}function j(e,t){return Math.max(e,t)}},511:function(e,t,r){"use strict";r.d(t,"a",(function(){return S})),r.d(t,"b",(function(){return b})),r.d(t,"c",(function(){return O})),r.d(t,"d",(function(){return j}));var i,s=r(91),a=r(80),n=r(89),o=r(81),l=r(93),h=r(660),c=r(458),u=r(481),d=r(82),f=r(92),p=(r(88),r(85)),m=r(84),_=r(96),g=(r(83),r(86),r(87),r(233)),v=i=class extends c.a{writeLevels(e,t,r){for(var i in e){var s=this.levels[i];return void(t.stops=s)}}clone(){return new i({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(g.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(g.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Object(f.a)(this.levels)})}};Object(d.a)([Object(p.b)()],v.prototype,"levels",void 0),Object(d.a)([Object(_.a)("levels")],v.prototype,"writeLevels",null),v=i=Object(d.a)([Object(m.a)("esri.views.2d.engine.LevelDependentSizeVariable")],v);var y=o.a.getLogger("esri.views.2d.layers.support.clusterUtils");a.a.add("esri-cluster-arcade-enabled",1);var x=Object(a.a)("esri-cluster-arcade-enabled"),b=(e,t,r,i)=>{var s=t.clone();if(!j(s))return s;if(r.fields)for(var a of r.fields)M(e,a);if("visualVariables"in s){var o=(s.visualVariables||[]).filter((e=>"$view.scale"!==e.valueExpression)),l=O(o);o.forEach((t=>{"rotation"===t.type?t.field?t.field=E(e,t.field,"avg_angle"):t.valueExpression&&(t.field=T(e,t.valueExpression,"avg_angle"),t.valueExpression=null):t.normalizationField?(t.field=E(e,t.field,"norm",t.normalizationField),t.normalizationField=null):t.field?t.field=E(e,t.field,"avg"):(t.field=T(e,t.valueExpression,"avg"),t.valueExpression=null)})),Object(n.j)(l)&&!w(o)&&(o.push(S(r,i)),s.dynamicClusterSize=!0),s.visualVariables=o}switch(s.type){case"simple":break;case"unique-value":s.field?s.field=E(e,s.field,"mode"):s.valueExpression&&(s.field=T(e,s.valueExpression,"mode"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=E(e,s.field,"norm",s.normalizationField),s.normalizationField=null):s.field?s.field=E(e,s.field,"avg"):(s.field=T(e,s.valueExpression,"avg"),s.valueExpression=null)}return s},O=e=>{for(var t of e)if("size"===t.type)return t;return null},w=e=>{for(var t of e)if("cluster_count"===t.field)return!0;return!1},S=(e,t)=>{var r=[new h.a({value:0,size:0}),new h.a({value:1})];if(Object(n.j)(t))return new c.a({field:"cluster_count",stops:[...r,new h.a({value:2,size:0})]});var i=Object.keys(t).reduce(((i,a)=>Object(s.a)(Object(s.a)({},i),{},{[a]:[...r,new h.a({value:Math.max(2,t[a].minValue),size:e.clusterMinSize}),new h.a({value:Math.max(3,t[a].maxValue),size:e.clusterMaxSize})]})),{});return new v({field:"cluster_count",levels:i})},j=e=>{var t=t=>y.error(new l.a("Unsupported-renderer",t,{renderer:e}));if("unique-value"===e.type){if(e.field2||e.field3)return t("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===e.type){if(e.normalizationField){var r=e.normalizationType;if("field"!==r)return t("FeatureReductionCluster does not support a normalizationType of ".concat(r)),!1}}else if("simple"!==e.type)return t("FeatureReductionCluster does not support renderers of type ".concat(e.type)),!1;if(!x){if("valueExpression"in e&&e.valueExpression)return t("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some((e=>!(!("valueExpression"in e)||!e.valueExpression))))return t("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function M(e,t){var{name:r,outStatistic:i}=t,{onStatisticField:s,onStatisticValueExpression:a,statisticType:n}=i;if(a){var o=Object(u.a)(a.toLowerCase());e.push({name:r,outStatistic:{onStatisticField:o,onStatisticValueExpression:a,statisticType:n}})}else s?e.push({name:r,outStatistic:{onStatisticField:s,statisticType:n}}):y.error(new l.a("mapview-unsupported-field","Unable to handle field",{field:t}))}function T(e,t,r){var i=Object(u.a)(t),s="mode"===r?"cluster_type_".concat(i):"cluster_avg_".concat(i);return e.some((e=>e.name===s))||e.push({name:s,outStatistic:{onStatisticField:i,onStatisticValueExpression:t,statisticType:r}}),s}function E(e,t,r,i){if("cluster_count"===t||e.some((e=>e.name===t)))return t;var s=function(e,t,r){switch(e){case"avg":case"avg_angle":return"cluster_avg_".concat(t);case"mode":return"cluster_type_".concat(t);case"norm":var i=r,s=t.toLowerCase()+",norm:field,"+i.toLowerCase();return"cluster_avg_"+Object(u.a)(s)}}(r,t,i);return e.some((e=>e.name===s))||("norm"===r?e.push({name:s,outStatistic:{onStatisticField:t,onStatisticNormalizationField:i,statisticType:r}}):e.push({name:s,outStatistic:{onStatisticField:t,statisticType:r}})),s}},519:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(89),s=r(122),a=2147483647;class n{constructor(e){this._head=e,this._cursor=e}static from(e,t=0,r=e.byteLength/o.BYTES_PER_RECORD-t){var i=new o(new Int32Array(e,t*o.BYTES_PER_RECORD,r*o.ELEMENTS_PER_RECORD));return new n(i)}size(){var e,t;return null!=(e=null==(t=this._cursor)?void 0:t.size())?e:0}get id(){return this._cursor.id}set id(e){this._cursor.id=e}get materialKey(){return this._cursor.materialKey}set materialKey(e){this._cursor.materialKey=e}get insertAfter(){return this._cursor.insertAfter}get indexFrom(){return this._cursor.indexFrom}set indexFrom(e){this._cursor.indexFrom=e}get indexCount(){return this._cursor.indexCount}set indexCount(e){this._cursor.indexCount=e}get vertexFrom(){return this._cursor.vertexFrom}set vertexFrom(e){this._cursor.vertexFrom=e}get vertexCount(){return this._cursor.vertexCount}set vertexCount(e){this._cursor.vertexCount=e}get index(){return this._cursor._index}link(e){if(this._head){for(var t=this._head;t._link;)t=t._link;t._link=e._head}else this._head=e._head}getCursor(){return this.copy()}lookup(e){for(this._cursor=this._head;this._cursor&&!this._cursor.lookup(e);){if(!this._cursor._link)return!1;this._cursor=this._cursor._link}return!!this._cursor}copy(){var e,t=new n(null==(e=this._head)?void 0:e.copy());if(!t._head)return t;for(var r=t._head,i=t._head._link;i;)r._link=i.copy(),i=(r=i)._link;return t}next(){return!!this._cursor&&(!!this._cursor.next()||!!this._cursor._link&&(this._cursor=this._cursor._link,this.next()))}peekId(){var e;return null!=(e=this._cursor.peekId())?e:this._cursor._link.peekId()}delete(e){for(var t=this._head,r=null;t;){if(t.delete(e))return t.isEmpty()&&(Object(i.k)(r)&&(r._link=t._link),t===this._head&&(this._head=t._link),t===this._cursor&&(this._cursor=t._link)),!0;r=t,t=t._link}return!1}}n.ELEMENTS_PER_RECORD=s.f,n.BYTES_PER_RECORD=n.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT;class o{constructor(e){this._link=null,this._index=-1,this._deletedCount=0,this._offsets={instance:null},this._packedRecords=e}static from(e,t=0,r=e.byteLength/this.BYTES_PER_RECORD-t){return new o(new Int32Array(e,t*this.BYTES_PER_RECORD,r*this.ELEMENTS_PER_RECORD))}delete(e){var t=this._index,r=this.lookup(e);if(r)for(this.id=a,++this._deletedCount;this.next()&&this.id===e;)this.id=a,++this._deletedCount;return this._index=t,r}isEmpty(){return this._deletedCount===this.size()}link(e){this._link?this._link.link(e):this._link=e}lookup(e){if(Object(i.j)(this._offsets.instance)){this._offsets.instance=new Map;var t=this.copy();t._index=-1;for(var r=0;t.next();)t.id!==r&&(this._offsets.instance.set(t.id,t._index),r=t.id)}if(!this._offsets.instance.has(e))return!1;var s=this._index;return this._index=this._offsets.instance.get(e),this.id!==a||(this._index=s,!1)}get id(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD]}set id(e){this._packedRecords[this._index*o.ELEMENTS_PER_RECORD]=e}get materialKey(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+1]}set materialKey(e){this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+1]=e}get insertAfter(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+2]}get indexFrom(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+3]}set indexFrom(e){this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+3]=e}get indexCount(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+4]}set indexCount(e){this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+4]=e}get vertexFrom(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+5]}set vertexFrom(e){this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+5]=e}get vertexCount(){return this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+6]}set vertexCount(e){this._packedRecords[this._index*o.ELEMENTS_PER_RECORD+6]=e}get index(){return this._index}size(){return this._packedRecords.length/o.ELEMENTS_PER_RECORD}next(){for(;++this._index<this.size()&&this.id===a;);return this._index<this.size()}peekId(){var e=(this._index+1)*o.ELEMENTS_PER_RECORD;return e>=this._packedRecords.length?0:this._packedRecords[e]}getCursor(){return this.copy()}copy(){var e=new o(this._packedRecords);return e._link=this._link,e._index=this._index,e._offsets=this._offsets,e._deletedCount=this._deletedCount,e}}o.ELEMENTS_PER_RECORD=s.f,o.BYTES_PER_RECORD=o.ELEMENTS_PER_RECORD*Int32Array.BYTES_PER_ELEMENT},520:function(e,t,r){"use strict";r.d(t,"a",(function(){return p})),r.d(t,"b",(function(){return c}));var i=r(91),s=r(89),a=r(105),n=r(122),o=r(127),l=r(187),h=r(406);function c(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function u(e){return e.map((e=>function(e){return{value:e.value,size:Object(a.k)(e.size)}}(e)))}function d(e){if("string"==typeof e||"number"==typeof e)return Object(a.k)(e);var t=e;return{type:"size",expression:t.expression,stops:u(t.stops)}}var f=e=>{for(var t=[],r=[],i=u(e),s=i.length,o=0;o<6;o++){var l=i[Math.min(o,s-1)];t.push(l.value),r.push(null==l.size?n.n:Object(a.h)(l.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function p(e){var t=e&&e.length>0?{}:null,r=t?{}:null;if(!t)return{vvFields:t,vvRanges:r};for(var s of e)if(s.field&&(t[s.type]=s.field),"size"===s.type){r.size||(r.size={});var a=s;switch(Object(h.a)(a)){case o.e.SIZE_MINMAX_VALUE:r.size.minMaxValue={minDataValue:a.minDataValue,maxDataValue:a.maxDataValue,minSize:d(a.minSize),maxSize:d(a.maxSize)};break;case o.e.SIZE_SCALE_STOPS:r.size.scaleStops={stops:u(a.stops)};break;case o.e.SIZE_FIELD_STOPS:if(a.levels){var n={};for(var l in a.levels)n[l]=f(a.levels[l]);r.size.fieldStops={type:"level-dependent",levels:n}}else r.size.fieldStops=Object(i.a)({type:"static"},f(a.stops));break;case o.e.SIZE_UNIT_VALUE:r.size.unitValue={unit:a.valueUnit,valueRepresentation:a.valueRepresentation}}}else if("color"===s.type)r.color=g(s);else if("opacity"===s.type)r.opacity=m(s);else if("rotation"===s.type){var c=s;r.rotation={type:c.rotationType}}return{vvFields:t,vvRanges:r}}function m(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,i=0;i<8;++i){var s=r[Math.min(i,r.length-1)];t.values[i]=s.value,t.opacities[i]=s.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var a=e.stops&&e.stops.length>=0&&e.stops[0].opacity,n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=a}return t}function _(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function g(e){if(Object(s.j)(e))return null;if(e.normalizationField)return null;var t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;if(e.stops.length>8)return null;t.field=e.field;for(var r=e.stops,i=0;i<8;++i){var a=r[Math.min(i,r.length-1)];t.values[i]=a.value,_(t.colors,i,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return null;for(var n=e.stops&&e.stops.length>=0&&e.stops[0].color,o=0;o<8;o++)t.values[o]=1/0,_(t.colors,o,n)}for(var h=0;h<32;h+=4)Object(l.b)(t.colors,h,!0);return t}},521:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r(430);function i(e,t,r,i){var s=e.clone(),a=1<<s.level,n=s.col+t,o=s.row+r;return i&&n<0?(s.col=n+a,s.world-=1):n>=a?(s.col=n-a,s.world+=1):s.col=n,s.row=o,s}},524:function(e,t,r){"use strict";var i=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["\xab","\xbb"],["\xbb","\xab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],s=["\u0622","\u0623","\u0625","\u0627"],a=["\ufef5","\ufef7","\ufef9","\ufefb"],n=["\ufef6","\ufef8","\ufefa","\ufefc"],o=["\u0627","\u0628","\u062a","\u062b","\u062c","\u062d","\u062e","\u062f","\u0630","\u0631","\u0632","\u0633","\u0634","\u0635","\u0636","\u0637","\u0638","\u0639","\u063a","\u0641","\u0642","\u0643","\u0644","\u0645","\u0646","\u0647","\u0648","\u064a","\u0625","\u0623","\u0622","\u0629","\u0649","\u0644","\u0645","\u0646","\u0647","\u0648","\u064a","\u0625","\u0623","\u0622","\u0629","\u0649","\u06cc","\u0626","\u0624"],l=["\ufe8d","\ufe8f","\ufe95","\ufe99","\ufe9d","\ufea1","\ufea5","\ufea9","\ufeab","\ufead","\ufeaf","\ufeb1","\ufeb5","\ufeb9","\ufebd","\ufec1","\ufec5","\ufec9","\ufecd","\ufed1","\ufed5","\ufed9","\ufedd","\ufee1","\ufee5","\ufee9","\ufeed","\ufef1","\ufe87","\ufe83","\ufe81","\ufe93","\ufeef","\ufbfc","\ufe89","\ufe85","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe89","\ufe85"],h=["\ufe8e","\ufe90","\ufe96","\ufe9a","\ufe9e","\ufea2","\ufea6","\ufeaa","\ufeac","\ufeae","\ufeb0","\ufeb2","\ufeb6","\ufeba","\ufebe","\ufec2","\ufec6","\ufeca","\ufece","\ufed2","\ufed6","\ufeda","\ufede","\ufee2","\ufee6","\ufeea","\ufeee","\ufef2","\ufe88","\ufe84","\ufe82","\ufe94","\ufef0","\ufbfd","\ufe8a","\ufe86","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe8a","\ufe86"],c=["\ufe8e","\ufe92","\ufe98","\ufe9c","\ufea0","\ufea4","\ufea8","\ufeaa","\ufeac","\ufeae","\ufeb0","\ufeb4","\ufeb8","\ufebc","\ufec0","\ufec4","\ufec8","\ufecc","\ufed0","\ufed4","\ufed8","\ufedc","\ufee0","\ufee4","\ufee8","\ufeec","\ufeee","\ufef4","\ufe88","\ufe84","\ufe82","\ufe94","\ufef0","\ufbff","\ufe8c","\ufe86","\ufe71","\ufe72","\ufe74","\ufe77","\ufe79","\ufe7b","\ufe7d","\ufe7f","\ufe80","\ufe8c","\ufe86"],u=["\ufe8d","\ufe91","\ufe97","\ufe9b","\ufe9f","\ufea3","\ufea7","\ufea9","\ufeab","\ufead","\ufeaf","\ufeb3","\ufeb7","\ufebb","\ufebf","\ufec3","\ufec7","\ufecb","\ufecf","\ufed3","\ufed7","\ufedb","\ufedf","\ufee3","\ufee7","\ufeeb","\ufeed","\ufef3","\ufe87","\ufe83","\ufe81","\ufe93","\ufeef","\ufbfe","\ufe8b","\ufe85","\ufe70","\ufe72","\ufe74","\ufe76","\ufe78","\ufe7a","\ufe7c","\ufe7e","\ufe80","\ufe8b","\ufe85"],d=["\u0621","\u0622","\u0623","\u0624","\u0625","\u0627","\u0629","\u062f","\u0630","\u0631","\u0632","\u0648","\u0649"],f=["\u064b","\u064b","\u064c","\u061f","\u064d","\u061f","\u064e","\u064e","\u064f","\u064f","\u0650","\u0650","\u0651","\u0651","\u0652","\u0652","\u0621","\u0622","\u0622","\u0623","\u0623","\u0624","\u0624","\u0625","\u0625","\u0626","\u0626","\u0626","\u0626","\u0627","\u0627","\u0628","\u0628","\u0628","\u0628","\u0629","\u0629","\u062a","\u062a","\u062a","\u062a","\u062b","\u062b","\u062b","\u062b","\u062c","\u062c","\u062c","\u062c","\u062d","\u062d","\u062d","\u062d","\u062e","\u062e","\u062e","\u062e","\u062f","\u062f","\u0630","\u0630","\u0631","\u0631","\u0632","\u0632","\u0633","\u0633","\u0633","\u0633","\u0634","\u0634","\u0634","\u0634","\u0635","\u0635","\u0635","\u0635","\u0636","\u0636","\u0636","\u0636","\u0637","\u0637","\u0637","\u0637","\u0638","\u0638","\u0638","\u0638","\u0639","\u0639","\u0639","\u0639","\u063a","\u063a","\u063a","\u063a","\u0641","\u0641","\u0641","\u0641","\u0642","\u0642","\u0642","\u0642","\u0643","\u0643","\u0643","\u0643","\u0644","\u0644","\u0644","\u0644","\u0645","\u0645","\u0645","\u0645","\u0646","\u0646","\u0646","\u0646","\u0647","\u0647","\u0647","\u0647","\u0648","\u0648","\u0649","\u0649","\u064a","\u064a","\u064a","\u064a","\ufef5","\ufef6","\ufef7","\ufef8","\ufef9","\ufefa","\ufefb","\ufefc","\u061f","\u061f","\u061f"],p=["\u0621","\u0641"],m=["\u063a","\u064a"],_=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],g=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],v=10,y=11,x=12,b=18,O=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],w=100,S=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],j=[[b,b,b,b,b,b,b,b,b,6,5,6,8,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,5,5,5,6,8,4,4,y,y,y,4,4,4,4,4,v,9,v,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,b,b,b,b,b,b,5,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,9,4,y,y,y,y,4,4,4,4,0,4,4,b,4,4,y,y,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,1,x,1,x,x,1,x,x,1,x,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,y,y,7,9,7,4,4,x,x,x,x,x,x,x,x,x,x,x,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,3,3,3,3,3,3,3,3,3,3,y,3,3,7,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,3,4,x,x,x,x,x,x,7,7,x,x,4,x,x,x,x,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,x,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,x,x,x,x,x,x,x,x,x,x,x,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,x,x,x,x,x,x,x,x,x,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,b,b,b,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,y,y,y,y,y,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,b,b,b,b,b,4,4,4,4,4,b,b,b,b,b,b,2,0,4,4,2,2,2,2,2,2,v,v,4,4,4,0,2,2,2,2,2,2,2,2,2,2,v,v,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,y,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,x,1,1,1,1,1,1,1,1,1,1,v,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,x,x,x,x,x,x,x,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,y,4,4,v,v,4,4,4,4,4,y,y,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,b],[4,4,4,y,y,y,4,4,4,4,4,v,9,v,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,y,y,4,4,4,y,y,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];function M(e,t,r,i,s){var a=function(e,t,r){if(void 0===t.inFormat&&(t.inFormat=r.defInFormat),void 0===t.outFormat&&(t.outFormat=r.defOutFormat),void 0===t.swap&&(t.swap=r.defSwap),t.inFormat===t.outFormat)return t;var i,s=t.inFormat.substring(0,1),a=t.outFormat.substring(0,1),n=t.inFormat.substring(1,4),o=t.outFormat.substring(1,4);return"C"===n.charAt(0)&&(i=T(e),n="ltr"===i||"rtl"===i?i.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=s+n),"C"===o.charAt(0)&&("rtl"===(i=T(e))?o="RTL":"ltr"===i?(i=function(e){var t=e.split("");return t.reverse(),T(t.join(""))}(e),o=i.toUpperCase()):o="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=a+o),t}(e,{inFormat:t,outFormat:r,swap:i},s);if(a.inFormat===a.outFormat)return e;t=a.inFormat,r=a.outFormat,i=a.swap;var n=t.substring(0,1),o=t.substring(1,4),l=r.substring(0,1),h=r.substring(1,4);if(s.inFormat=t,s.outFormat=r,s.swap=i,"L"===n&&"VLTR"===r){if("LTR"===o)return s.dir=$,E(e,s);if("RTL"===o)return s.dir=ee,E(e,s)}if("V"===n&&"V"===l)return s.dir="RTL"===o?ee:$,P(e,s);if("L"===n&&"VRTL"===r)return"LTR"===o?(s.dir=$,e=E(e,s)):(s.dir=ee,e=E(e,s)),P(e);if("VLTR"===t&&"LLTR"===r)return s.dir=$,E(e,s);if("V"===n&&"L"===l&&o!==h)return e=P(e),"RTL"===o?M(e,"LLTR","VLTR",i,s):M(e,"LRTL","VRTL",i,s);if("VRTL"===t&&"LRTL"===r)return M(e,"LRTL","VRTL",i,s);if("L"===n&&"L"===l){var c=s.swap;return s.swap=c.substr(0,1)+"N","RTL"===o?(s.dir=ee,e=E(e,s),s.swap="N"+c.substr(1,2),s.dir=$,e=E(e,s)):(s.dir=$,e=E(e,s),s.swap="N"+c.substr(1,2),e=M(e,"VLTR","LRTL",s.swap,s)),e}return e}function T(e){var t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function E(e,t){var r=e.split(""),i=[];return C(r,i,t),function(e,t,r){if(0!==r.hiLevel&&r.swap.substr(0,1)!==r.swap.substr(1,2))for(var i=0;i<e.length;i++)1===t[i]&&(e[i]=D(e[i]))}(r,i,t),A(2,r,i,t),A(1,r,i,t),K=i,r.join("")}function C(e,t,r){var i=e.length,s=r.dir?g:_,a=0,n=-1,o=[],l=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(var h=0;h<i;h++)o[h]=I(e[h]);for(var c=0;c<i;c++){var u=a,d=z(e,o,l,c,r);l[c]=d;var f=240&(a=s[u][d]),p=s[a&=15][J];if(t[c]=p,f>0)if(16===f){for(var m=n;m<c;m++)t[m]=1;n=-1}else n=-1;if(s[a][Q])-1===n&&(n=c);else if(n>-1){for(var v=n;v<c;v++)t[v]=p;n=-1}5===o[c]&&(t[c]=0),r.hiLevel|=p}r.hasUbatS&&function(e,t,r,i){for(var s=0;s<r;s++)if(6===e[s]){t[s]=i.dir;for(var a=s-1;a>=0&&8===e[a];a--)t[a]=i.dir}}(o,t,i,r)}function I(e){var t=e.charCodeAt(0),r=S[t>>8];return r<w?r:j[r-w][255&t]}function P(e,t){var r=e.split("");if(t){var i=[];C(r,i,t),K=i}return r.reverse(),X.reverse(),r.join("")}function L(e,t,r){for(var i=0;i<t;i++)if(e[i]===r)return i;return-1}function k(e){for(var t=0;t<p.length;t++)if(e>=p[t]&&e<=m[t])return!0;return!1}function R(e,t,r,i){for(;t*r<i&&B(e[t]);)t+=r;return!!(t*r<i&&k(e[t]))}function N(e,t,r,i){for(;t*r<i&&B(e[t]);)t+=r;var a;if(!(t*r<i))return!1;a=e[t];for(var n=0;n<s.length;n++)if(s[n]===a)return!0;return!1}function A(e,t,r,i){if(!(i.hiLevel<e)){if(1===e&&i.dir===ee&&!i.hasUbatB)return t.reverse(),void X.reverse();for(var s,a,n,o,l,h=t.length,c=0;c<h;){if(r[c]>=e){for(s=c+1;s<h&&r[s]>=e;)s++;for(a=c,n=s-1;a<n;a++,n--)o=t[a],t[a]=t[n],t[n]=o,l=X[a],X[a]=X[n],X[n]=l;c=s}c++}}}function z(e,t,r,i,s){var a=t[i];return{UBAT_L:()=>(s.lastArabic=!1,0),UBAT_R:()=>(s.lastArabic=!1,1),UBAT_ON:()=>4,UBAT_AN:()=>3,UBAT_EN:()=>s.lastArabic?3:2,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,1),UBAT_WS:()=>4,UBAT_CS:()=>{var e,a;return i<1||i+1>=t.length||2!==(e=r[i-1])&&3!==e||2!==(a=t[i+1])&&3!==a?4:(s.lastArabic&&(a=3),a===e?a:4)},UBAT_ES:()=>2===(i>0?r[i-1]:5)&&i+1<t.length&&2===t[i+1]?2:4,UBAT_ET:()=>{if(i>0&&2===r[i-1])return 2;if(s.lastArabic)return 4;for(var e=i+1,a=t.length;e<a&&t[e]===y;)e++;return e<a&&2===t[e]?2:4},UBAT_NSM:()=>{if("VLTR"===s.inFormat){for(var a=t.length,n=i+1;n<a&&t[n]===x;)n++;if(n<a){var o=e[i].charCodeAt[0],l=o>=1425&&o<=2303||64286===o,h=t[n];if(l&&(1===h||7===h))return 1}}return i<1||5===t[i-1]?4:r[i-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,4),UBAT_LRE:()=>(s.lastArabic=!1,4),UBAT_RLE:()=>(s.lastArabic=!1,4),UBAT_LRO:()=>(s.lastArabic=!1,4),UBAT_RLO:()=>(s.lastArabic=!1,4),UBAT_PDF:()=>(s.lastArabic=!1,4),UBAT_BN:()=>4}[O[a]]()}function D(e){for(var t,r=0,s=i.length-1;r<=s;)if(t=Math.floor((r+s)/2),e<i[t][0])s=t-1;else{if(!(e>i[t][0]))return i[t][1];r=t+1}return e}function F(e){for(var t=0;t<d.length;t++)if(d[t]===e)return!0;return!1}function V(e){for(var t=0;t<o.length;t++)if(e===o[t])return c[t];return e}function G(e,t){for(var r=0;r<o.length;r++)if(e===o[r])return t[r];return e}function B(e){return e>="\u064b"&&e<="\u0655"}function U(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function W(e,t,r,i){for(;t*r<i&&B(e[t]);)t+=r;return t*r<i&&(e[t]=" ",!0)}function q(e,t){for(var r=0;r<s.length;r++)if(e===s[r])return t[r];return e}function H(e,t,r,i){for(var s=0;s<e.length;s++)(e[s]>t||!r&&e[s]===t)&&(e[s]+=i)}var X=[],Y=[],K=[],Z={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},J=5,Q=6,$=0,ee=1,te=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,re=/[\u0591-\u06ff\ufb1d-\ufefc]/;t.a=class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(e,t,r){if(this.sourceToTarget=[],this.targetToSource=[],!e)return"";if(function(e,t,r){X=[],K=[];for(var i=0;i<r;i++)e[i]=i,t[i]=i,X[i]=i}(this.sourceToTarget,this.targetToSource,e.length),!this.checkParameters(t,r))return e;t=this.inputFormat,r=this.outputFormat;var i,o=Z,c=U(t.charAt(1)),d=U(r.charAt(1)),p=("I"===t.charAt(0)?"L":t.charAt(0))+c,m=("I"===r.charAt(0)?"L":r.charAt(0))+d,_=t.charAt(2)+r.charAt(2);o.defInFormat=p,o.defOutFormat=m,o.defSwap=_;var g=M(e,p,m,_,o),v=!1;return"R"===r.charAt(1)?v=!0:"C"!==r.charAt(1)&&"D"!==r.charAt(1)||(v="rtl"===this.checkContextual(g)),this.sourceToTarget=X,this.targetToSource=function(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[e[r]]=r;return t}(this.sourceToTarget),Y=this.targetToSource,i=t.charAt(3)===r.charAt(3)?g:"S"===r.charAt(3)?function(e,t,r){if(0===t.length)return"";void 0===e&&(e=!0),void 0===r&&(r=!0);var i=(t=String(t)).split(""),s=0,o=1,c=i.length;e||(s=i.length-1,o=-1,c=1);for(var d=function(e,t,r,i,s){for(var o=0,c=[],d=0,f=t;f*r<i;f+=r)if(k(e[f])||B(e[f])){if("\u0644"===e[f]&&N(e,f+r,r,i)){e[f]=q(e[f+r],0===o?a:n),W(e,f+=r,r,i),s&&(c[d]=f,d++),o=0;continue}var p=e[f];1===o?e[f]=R(e,f+r,r,i)?V(e[f]):G(e[f],h):!0===R(e,f+r,r,i)?e[f]=G(e[f],u):e[f]=G(e[f],l),B(p)||(o=1),!0===F(p)&&(o=0)}else o=0;return c}(i,s,o,c,r),f="",p=0;p<i.length;p++)r&&L(d,d.length,p)>-1?(H(Y,p,!e,-1),X.splice(p,1)):f+=i[p];return f}(v,g,!0):function(e,t,r){if(0===e.length)return"";void 0===r&&(r=!0),void 0===t&&(t=!0);for(var i="",a=(e=String(e)).split(""),n=0;n<e.length;n++){var o=!1;if(a[n]>="\ufe70"&&a[n]<"\ufeff"){var l=e.charCodeAt(n);a[n]>="\ufef5"&&a[n]<="\ufefc"?(t?(n>0&&r&&" "===a[n-1]?i=i.substring(0,i.length-1)+"\u0644":(i+="\u0644",o=!0),i+=s[(l-65269)/2]):(i+=s[(l-65269)/2],i+="\u0644",n+1<e.length&&r&&" "===a[n+1]?n++:o=!0),o&&(H(Y,n,!0,1),X.splice(n,0,X[n]))):i+=f[l-65136]}else i+=a[n]}return i}(g,v,!0),this.sourceToTarget=X,this.targetToSource=Y,this.levels=K,i}_inputFormatSetter(e){if(!te.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!te.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){var t=T(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(r){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return re.test(e)}}},534:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var i=r(122),s=r(127),a=new Map;function n(e){return a.get(e)}function o(e,t,r){var{indicesPerRecord:s,multiplier:n,verticesPerRecord:o}=a.get(e);return{recordBytes:r*i.f*Uint32Array.BYTES_PER_ELEMENT,indexBytes:n*s*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:n*o*r*t}}a.set(s.d.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),a.set(s.d.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),a.set(s.d.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),a.set(s.d.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),a.set(s.d.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4})},535:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var i=r(81),s=r(105),a=i.a.getLogger("esri.renderers.visualVariables.support.utils"),n=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;var t=e.clone(),r=t.visualVariables.map((e=>l(e)?h(e):e));return t.visualVariables=r,t};function o(e){return e.map((e=>l(e)?h(e.clone()):e))}function l(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function h(e){return e.stops=function(e,t){return t.length<=8?t:(a.warn("Found ".concat(t.length," Visual Variable stops, but MapView only supports ").concat(8,". Displayed stops will be simplified.")),t.length>16?function(e,t){for(var[r,...i]=t,a=i.pop(),n=i[0].value,o=i[i.length-1].value,l=(o-n)/6,h=[],u=n;u<o;u+=l){for(var d=0;u>=i[d].value;)d++;var f=i[d],p=t[d-1],m=u-p.value,_=f.value===p.value?1:m/(f.value-p.value);if("color"===e){var g=i[d],v=t[d-1],y=g.color.clone();y.r=c(v.color.r,y.r,_),y.g=c(v.color.g,y.g,_),y.b=c(v.color.b,y.b,_),y.a=c(v.color.a,y.a,_),h.push({value:u,color:y,label:g.label})}else if("size"===e){var x=i[d],b=t[d-1],O=Object(s.k)(x.size),w=c(Object(s.k)(b.size),O,_);h.push({value:u,size:w,label:x.label})}else{var S=i[d],j=c(t[d-1].opacity,S.opacity,_);h.push({value:u,opacity:j,label:S.label})}}return[r,...h,a]}(e,t):function(e){for(var[t,...r]=e,i=r.pop();r.length>6;){for(var s=0,a=0,n=1;n<r.length;n++){var o=r[n-1],l=r[n],h=Math.abs(l.value-o.value);h>a&&(a=h,s=n)}r.splice(s,1)}return[t,...r,i]}(t))}(e.type,e.stops),e}function c(e,t,r){return(1-r)*e+r*t}},537:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return o}));var i=r(122),s=r(399),a=r(495);class n{constructor(e,t,r){this.ratio=e,this.x=t,this.y=r}}class o{constructor(e,t,r,s=8,a=8){this.lines=[],this.starts=[],this.validateTessellation=!0,this.pixelRatio=s,this.pixelMargin=a,this.tileSize=i.E*s,this.dz=e,this.yPos=t,this.xPos=r}setPixelMargin(e){e!==this.pixelMargin&&(this.pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this.finalRatio=this.tileSize/e*(1<<this.dz);var t=this.pixelRatio*this.pixelMargin;t/=this.finalRatio;var r=e>>this.dz;t>r&&(t=r),this.margin=t,this.xmin=r*this.xPos-t,this.ymin=r*this.yPos-t,this.xmax=this.xmin+r+2*t,this.ymax=this.ymin+r+2*t}reset(e){this.type=e,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new a.a(e,t),this._firstPt=new a.a(e,t),this._dist=0}lineTo(e,t){var r,i,s,o,l,h,c,u,d=this._isIn(e,t),f=new a.a(e,t),p=a.a.distance(this._prevPt,f);if(d)this._prevIsIn?this._lineTo(e,t,!0):(r=this._prevPt,i=f,s=this._intersect(i,r),this.start=this._dist+p*(1-this._r),this._lineTo(s.x,s.y,!0),this._lineTo(i.x,i.y,!0));else if(this._prevIsIn)i=this._prevPt,r=f,s=this._intersect(i,r),this._lineTo(s.x,s.y,!0),this._lineTo(r.x,r.y,!1);else{var m=this._prevPt,_=f;if(m.x<=this.xmin&&_.x<=this.xmin||m.x>=this.xmax&&_.x>=this.xmax||m.y<=this.ymin&&_.y<=this.ymin||m.y>=this.ymax&&_.y>=this.ymax)this._lineTo(_.x,_.y,!1);else{var g=[];if((m.x<this.xmin&&_.x>this.xmin||m.x>this.xmin&&_.x<this.xmin)&&(o=(this.xmin-m.x)/(_.x-m.x),(u=m.y+o*(_.y-m.y))<=this.ymin?h=!1:u>=this.ymax?h=!0:g.push(new n(o,this.xmin,u))),(m.x<this.xmax&&_.x>this.xmax||m.x>this.xmax&&_.x<this.xmax)&&(o=(this.xmax-m.x)/(_.x-m.x),(u=m.y+o*(_.y-m.y))<=this.ymin?h=!1:u>=this.ymax?h=!0:g.push(new n(o,this.xmax,u))),(m.y<this.ymin&&_.y>this.ymin||m.y>this.ymin&&_.y<this.ymin)&&(o=(this.ymin-m.y)/(_.y-m.y),(c=m.x+o*(_.x-m.x))<=this.xmin?l=!1:c>=this.xmax?l=!0:g.push(new n(o,c,this.ymin))),(m.y<this.ymax&&_.y>this.ymax||m.y>this.ymax&&_.y<this.ymax)&&(o=(this.ymax-m.y)/(_.y-m.y),(c=m.x+o*(_.x-m.x))<=this.xmin?l=!1:c>=this.xmax?l=!0:g.push(new n(o,c,this.ymax))),0===g.length)l?h?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):h?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(g.length>1&&g[0].ratio>g[1].ratio)this.start=this._dist+p*g[1].ratio,this._lineTo(g[1].x,g[1].y,!0),this._lineTo(g[0].x,g[0].y,!0);else{this.start=this._dist+p*g[0].ratio;for(var v=0;v<g.length;v++)this._lineTo(g[v].x,g[v].y,!0)}this._lineTo(_.x,_.y,!1)}}this._dist+=p,this._prevIsIn=d,this._prevPt=f}close(){if(this.line.length>2){var e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);for(var r=this.line,i=r.length;i>=4&&(r[0].x===r[1].x&&r[0].x===r[i-2].x||r[0].y===r[1].y&&r[0].y===r[i-2].y);)r.pop(),r[0].x=r[i-2].x,r[0].y=r[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&e&&h.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error("Only valid for lines");this._pushLine();var e=this.lines,t=e.length;if(0===t)return null;for(var r=[],i=0;i<t;i++)r.push({line:e[i],start:this.starts[i]||0});return r}_isIn(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}_intersect(e,t){var r,i,s;if(t.x>=this.xmin&&t.x<=this.xmax)s=((i=t.y<=this.ymin?this.ymin:this.ymax)-e.y)/(t.y-e.y),r=e.x+s*(t.x-e.x);else if(t.y>=this.ymin&&t.y<=this.ymax)s=((r=t.x<=this.xmin?this.xmin:this.xmax)-e.x)/(t.x-e.x),i=e.y+s*(t.y-e.y);else{i=t.y<=this.ymin?this.ymin:this.ymax;var n=((r=t.x<=this.xmin?this.xmin:this.xmax)-e.x)/(t.x-e.x),o=(i-e.y)/(t.y-e.y);n<o?(s=n,i=e.y+n*(t.y-e.y)):(s=o,r=e.x+o*(t.x-e.x))}return this._r=s,new a.a(r,i)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(e,t,r){3!==this.type?r&&(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new a.a(e,t))):(r||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new a.a(e,t)),this._is_h=!1,this._is_v=!1)}_lineTo(e,t,r){var i,s;if(3!==this.type)if(r){if(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(i=this.line[this.line.length-1]).equals(e,t))return;this.line.push(new a.a(e,t))}else this.line&&this.line.length>0&&this._pushLine();else if(r||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){var n=(i=this.line[this.line.length-1]).x===e,o=i.y===t;if(n&&o)return;this._is_h&&n||this._is_v&&o?(i.x=e,i.y=t,(s=this.line[this.line.length-2]).x===e&&s.y===t?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(s=this.line[this.line.length-2],this._is_h=s.x===e,this._is_v=s.y===t)):(this._is_h=s.x===e,this._is_v=s.y===t)):(this.line.push(new a.a(e,t)),this._is_h=n,this._is_v=o)}else this.line.push(new a.a(e,t))}}class l{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this.lines=[],this.line=null}moveTo(e,t){this.line&&this.lines.push(this.line),this.line=[];var r=this._ratio;this.line.push(new a.a(e*r,t*r))}lineTo(e,t){var r=this._ratio;this.line.push(new a.a(e*r,t*r))}close(){var e=this.line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:this.lines}}class h{static simplify(e,t,r){if(r){for(var i=-t,s=e+t,a=-t,n=e+t,o=[],l=[],c=r.length,u=0;u<c;++u){var d=r[u];if(d&&!(d.length<2))for(var f=void 0,p=d[0],m=d.length,_=1;_<m;++_)f=d[_],p.x===f.x&&(p.x<=i&&(p.y>f.y?(o.push(u),o.push(_),o.push(0),o.push(-1)):(l.push(u),l.push(_),l.push(0),l.push(-1))),p.x>=s&&(p.y<f.y?(o.push(u),o.push(_),o.push(1),o.push(-1)):(l.push(u),l.push(_),l.push(1),l.push(-1)))),p.y===f.y&&(p.y<=a&&(p.x<f.x?(o.push(u),o.push(_),o.push(2),o.push(-1)):(l.push(u),l.push(_),l.push(2),l.push(-1))),p.y>=n&&(p.x>f.x?(o.push(u),o.push(_),o.push(3),o.push(-1)):(l.push(u),l.push(_),l.push(3),l.push(-1)))),p=f}if(0!==o.length&&0!==l.length){h.fillParent(r,l,o),h.fillParent(r,o,l);var g=[];h.calcDeltas(g,l,o),h.calcDeltas(g,o,l),h.addDeltas(g,r)}}}static fillParent(e,t,r){for(var i=r.length,a=t.length,n=0;n<a;n+=4){for(var o=t[n],l=t[n+1],h=t[n+2],c=e[o][l-1],u=e[o][l],d=8092,f=-1,p=0;p<i;p+=4)if(r[p+2]===h){var m=r[p],_=r[p+1],g=e[m][_-1],v=e[m][_];switch(h){case 0:case 1:if(Object(s.a)(c.y,g.y,v.y)&&Object(s.a)(u.y,g.y,v.y)){var y=Math.abs(v.y-g.y);y<d&&(d=y,f=p)}break;case 2:case 3:if(Object(s.a)(c.x,g.x,v.x)&&Object(s.a)(u.x,g.x,v.x)){var x=Math.abs(v.x-g.x);x<d&&(d=x,f=p)}}}t[n+3]=f}}static calcDeltas(e,t,r){for(var i=t.length,s=0;s<i;s+=4){var a=h.calcDelta(s,t,r,[]);e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]),e.push(a)}}static calcDelta(e,t,r,i){var s=t[e+3];if(-1===s)return 0;var a=i.length;return a>1&&i[a-2]===s?0:(i.push(s),h.calcDelta(s,r,t,i)+1)}static addDeltas(e,t){for(var r=e.length,i=0,s=0;s<r;s+=4){var a=e[s+3];a>i&&(i=a)}for(var n=0;n<r;n+=4){var o=t[e[n]],l=e[n+1],h=i-e[n+3];switch(e[n+2]){case 0:o[l-1].x-=h,o[l].x-=h,1===l&&(o[o.length-1].x-=h),l===o.length-1&&(o[0].x-=h);break;case 1:o[l-1].x+=h,o[l].x+=h,1===l&&(o[o.length-1].x+=h),l===o.length-1&&(o[0].x+=h);break;case 2:o[l-1].y-=h,o[l].y-=h,1===l&&(o[o.length-1].y-=h),l===o.length-1&&(o[0].y-=h);break;case 3:o[l-1].y+=h,o[l].y+=h,1===l&&(o[o.length-1].y+=h),l===o.length-1&&(o[0].y+=h)}}}}},538:function(e,t,r){"use strict";var i=r(81),s=r(133),a=Object(s.b)((function(e){var t,r;t=function(){var e={DEBUG:!1,assert:function(t,r){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(r?": "+r:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};return e.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.geom.edgeEval=function(t,r,i){e.assert(e.geom.vertLeq(t,r)&&e.geom.vertLeq(r,i));var s=r.s-t.s,a=i.s-r.s;return s+a>0?s<a?r.t-t.t+(t.t-i.t)*(s/(s+a)):r.t-i.t+(i.t-t.t)*(a/(s+a)):0},e.geom.edgeSign=function(t,r,i){e.assert(e.geom.vertLeq(t,r)&&e.geom.vertLeq(r,i));var s=r.s-t.s,a=i.s-r.s;return s+a>0?(r.t-i.t)*s+(r.t-t.t)*a:0},e.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.geom.transEval=function(t,r,i){e.assert(e.geom.transLeq(t,r)&&e.geom.transLeq(r,i));var s=r.t-t.t,a=i.t-r.t;return s+a>0?s<a?r.s-t.s+(t.s-i.s)*(s/(s+a)):r.s-i.s+(i.s-t.s)*(a/(s+a)):0},e.geom.transSign=function(t,r,i){e.assert(e.geom.transLeq(t,r)&&e.geom.transLeq(r,i));var s=r.t-t.t,a=i.t-r.t;return s+a>0?(r.s-i.s)*s+(r.s-t.s)*a:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.geom.vertCCW=function(e,t,r){return e.s*(t.t-r.t)+t.s*(r.t-e.t)+r.s*(e.t-t.t)>=0},e.geom.interpolate_=function(e,t,r,i){return(e=e<0?0:e)<=(r=r<0?0:r)?0===r?(t+i)/2:t+e/(e+r)*(i-t):i+r/(e+r)*(t-i)},e.geom.edgeIntersect=function(t,r,i,s,a){var n,o,l;e.geom.vertLeq(t,r)||(l=t,t=r,r=l),e.geom.vertLeq(i,s)||(l=i,i=s,s=l),e.geom.vertLeq(t,i)||(l=t,t=i,i=l,l=r,r=s,s=l),e.geom.vertLeq(i,r)?e.geom.vertLeq(r,s)?((n=e.geom.edgeEval(t,i,r))+(o=e.geom.edgeEval(i,r,s))<0&&(n=-n,o=-o),a.s=e.geom.interpolate_(n,i.s,o,r.s)):((n=e.geom.edgeSign(t,i,r))+(o=-e.geom.edgeSign(t,s,r))<0&&(n=-n,o=-o),a.s=e.geom.interpolate_(n,i.s,o,s.s)):a.s=(i.s+r.s)/2,e.geom.transLeq(t,r)||(l=t,t=r,r=l),e.geom.transLeq(i,s)||(l=i,i=s,s=l),e.geom.transLeq(t,i)||(l=t,t=i,i=l,l=r,r=s,s=l),e.geom.transLeq(i,r)?e.geom.transLeq(r,s)?((n=e.geom.transEval(t,i,r))+(o=e.geom.transEval(i,r,s))<0&&(n=-n,o=-o),a.t=e.geom.interpolate_(n,i.t,o,r.t)):((n=e.geom.transSign(t,i,r))+(o=-e.geom.transSign(t,s,r))<0&&(n=-n,o=-o),a.t=e.geom.interpolate_(n,i.t,o,s.t)):a.t=(i.t+r.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var r=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(r,t.vHead),e.mesh.makeVertex_(r.sym,t.vHead),e.mesh.makeFace_(r,t.fHead),r},e.mesh.meshSplice=function(t,r){var i=!1,s=!1;t!==r&&(r.org!==t.org&&(s=!0,e.mesh.killVertex_(r.org,t.org)),r.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(r.lFace,t.lFace)),e.mesh.splice_(r,t),s||(e.mesh.makeVertex_(r,t.org),t.org.anEdge=t),i||(e.mesh.makeFace_(r,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var r=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),i||e.mesh.makeFace_(t,t.lFace)),r.oNext===r?(e.mesh.killVertex_(r.org,null),e.mesh.killFace_(r.lFace,null)):(t.lFace.anEdge=r.oPrev(),r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var r=e.mesh.makeEdgePair_(t),i=r.sym;return e.mesh.splice_(r,t.lNext),r.org=t.dst(),e.mesh.makeVertex_(i,r.org),r.lFace=i.lFace=t.lFace,r},e.mesh.splitEdge=function(t){var r=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,r),t.sym.org=r.org,r.dst().anEdge=r.sym,r.sym.lFace=t.rFace(),r.winding=t.winding,r.sym.winding=t.sym.winding,r},e.mesh.connect=function(t,r){var i=!1,s=e.mesh.makeEdgePair_(t),a=s.sym;return r.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(r.lFace,t.lFace)),e.mesh.splice_(s,t.lNext),e.mesh.splice_(a,r),s.org=t.dst(),a.org=r.org,s.lFace=a.lFace=t.lFace,t.lFace.anEdge=a,i||e.mesh.makeFace_(s,t.lFace),s},e.mesh.zapFace=function(t){var r,i=t.anEdge,s=i.lNext;do{if(s=(r=s).lNext,r.lFace=null,null===r.rFace()){r.oNext===r?e.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev()));var a=r.sym;a.oNext===a?e.mesh.killVertex_(a.org,null):(a.org.anEdge=a.oNext,e.mesh.splice_(a,a.oPrev())),e.mesh.killEdge_(r)}}while(r!==i);var n=t.prev,o=t.next;o.prev=n,n.next=o},e.mesh.meshUnion=function(e,t){var r=e.fHead,i=e.vHead,s=e.eHead,a=t.fHead,n=t.vHead,o=t.eHead;return a.next!==a&&(r.prev.next=a.next,a.next.prev=r.prev,a.prev.next=r,r.prev=a.prev),n.next!==n&&(i.prev.next=n.next,n.next.prev=i.prev,n.prev.next=i,i.prev=n.prev),o.next!==o&&(s.sym.next.sym.next=o.next,o.next.sym.next=s.sym.next,o.sym.next.sym.next=s,s.sym.next=o.sym.next),e},e.mesh.deleteMesh=function(e){},e.mesh.makeEdgePair_=function(t){var r=new e.GluHalfEdge,i=new e.GluHalfEdge,s=t.sym.next;return i.next=s,s.sym.next=r,r.next=t,t.sym.next=i,r.sym=i,r.oNext=r,r.lNext=i,i.sym=r,i.oNext=i,i.lNext=r,r},e.mesh.splice_=function(e,t){var r=e.oNext,i=t.oNext;r.sym.lNext=t,i.sym.lNext=e,e.oNext=i,t.oNext=r},e.mesh.makeVertex_=function(t,r){var i=r.prev,s=new e.GluVertex(r,i);i.next=s,r.prev=s,s.anEdge=t;var a=t;do{a.org=s,a=a.oNext}while(a!==t)},e.mesh.makeFace_=function(t,r){var i=r.prev,s=new e.GluFace(r,i);i.next=s,r.prev=s,s.anEdge=t,s.inside=r.inside;var a=t;do{a.lFace=s,a=a.lNext}while(a!==t)},e.mesh.killEdge_=function(e){var t=e.next,r=e.sym.next;t.sym.next=r,r.sym.next=t},e.mesh.killVertex_=function(e,t){var r=e.anEdge,i=r;do{i.org=t,i=i.oNext}while(i!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},e.mesh.killFace_=function(e,t){var r=e.anEdge,i=r;do{i.lFace=t,i=i.lNext}while(i!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,r,i,s){var a=!1,n=[r,i,s];0===r&&0===i&&0===s&&(e.normal.computeNormal_(t,n),a=!0);var o,l=e.normal.longAxis_(n),h=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(n);var c=[0,0,0],u=[0,0,0];c[l]=0,c[(l+1)%3]=e.normal.S_UNIT_X_,c[(l+2)%3]=e.normal.S_UNIT_Y_;var d=e.normal.dot_(c,n);for(c[0]-=d*n[0],c[1]-=d*n[1],c[2]-=d*n[2],e.normal.normalize_(c),u[0]=n[1]*c[2]-n[2]*c[1],u[1]=n[2]*c[0]-n[0]*c[2],u[2]=n[0]*c[1]-n[1]*c[0],e.normal.normalize_(u),o=h.next;o!==h;o=o.next)o.s=e.normal.dot_(o.coords,c),o.t=e.normal.dot_(o.coords,u)}else{var f=(l+1)%3,p=(l+2)%3,m=n[l]>0?1:-1;for(o=h.next;o!==h;o=o.next)o.s=o.coords[f],o.t=m*o.coords[p]}a&&e.normal.checkOrientation_(t)},e.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.normal.normalize_=function(t){var r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e.assert(r>0),r=Math.sqrt(r),t[0]/=r,t[1]/=r,t[2]/=r},e.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.normal.computeNormal_=function(t,r){var i,s=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],a=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],n=[],o=[],l=t.mesh.vHead;for(i=l.next;i!==l;i=i.next)for(var h=0;h<3;++h){var c=i.coords[h];c<a[h]&&(a[h]=c,o[h]=i),c>s[h]&&(s[h]=c,n[h]=i)}var u=0;if(s[1]-a[1]>s[0]-a[0]&&(u=1),s[2]-a[2]>s[u]-a[u]&&(u=2),a[u]>=s[u])return r[0]=0,r[1]=0,void(r[2]=1);var d=0,f=o[u],p=n[u],m=[0,0,0],_=[f.coords[0]-p.coords[0],f.coords[1]-p.coords[1],f.coords[2]-p.coords[2]],g=[0,0,0];for(i=l.next;i!==l;i=i.next){g[0]=i.coords[0]-p.coords[0],g[1]=i.coords[1]-p.coords[1],g[2]=i.coords[2]-p.coords[2],m[0]=_[1]*g[2]-_[2]*g[1],m[1]=_[2]*g[0]-_[0]*g[2],m[2]=_[0]*g[1]-_[1]*g[0];var v=m[0]*m[0]+m[1]*m[1]+m[2]*m[2];v>d&&(d=v,r[0]=m[0],r[1]=m[1],r[2]=m[2])}d<=0&&(r[0]=r[1]=r[2]=0,r[e.normal.longAxis_(_)]=1)},e.normal.checkOrientation_=function(e){for(var t=0,r=e.mesh.fHead,i=r.next;i!==r;i=i.next){var s=i.anEdge;if(!(s.winding<=0))do{t+=(s.org.s-s.dst().s)*(s.org.t+s.dst().t),s=s.lNext}while(s!==i.anEdge)}if(t<0)for(var a=e.mesh.vHead,n=a.next;n!==a;n=n.next)n.t=-n.t},e.render={},e.render.renderMesh=function(t,r,i){for(var s=!1,a=-1,n=r.fHead.prev;n!==r.fHead;n=n.prev)if(n.inside){s||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),s=!0);var o=n.anEdge;e.assert(o.lNext.lNext.lNext===o,"renderMesh called with non-triangulated mesh");do{if(i){var l=o.rFace().inside?0:1;a!==l&&(a=l,t.callEdgeFlagCallback(!!a))}t.callVertexCallback(o.org.data),o=o.lNext}while(o!==n.anEdge)}s&&t.callEndCallback()},e.render.renderBoundary=function(t,r){for(var i=r.fHead.next;i!==r.fHead;i=i.next)if(i.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var s=i.anEdge;do{t.callVertexCallback(s.org.data),s=s.lNext}while(s!==i.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){var r;for(t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);null!==(r=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!e.geom.vertEq(i,r))break;i=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,r.anEdge,i.anEdge)}e.sweep.sweepEvent_(t,r)}var s=t.dict.getMin().getKey();t.event=s.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},e.sweep.edgeLeq_=function(t,r,i){var s=t.event,a=r.eUp,n=i.eUp;return a.dst()===s?n.dst()===s?e.geom.vertLeq(a.org,n.org)?e.geom.edgeSign(n.dst(),a.org,n.org)<=0:e.geom.edgeSign(a.dst(),n.org,a.org)>=0:e.geom.edgeSign(n.dst(),s,n.org)<=0:n.dst()===s?e.geom.edgeSign(a.dst(),s,a.org)>=0:e.geom.edgeEval(a.dst(),s,a.org)>=e.geom.edgeEval(n.dst(),s,n.org)},e.sweep.deleteRegion_=function(t,r){r.fixUpperEdge&&e.assert(0===r.eUp.winding),r.eUp.activeRegion=null,t.dict.deleteNode(r.nodeUp),r.nodeUp=null},e.sweep.fixUpperEdge_=function(t,r){e.assert(t.fixUpperEdge),e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=r,r.activeRegion=t},e.sweep.topLeftRegion_=function(t){var r=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===r);if(t.fixUpperEdge){var i=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},e.sweep.addRegionBelow_=function(t,r,i){var s=new e.ActiveRegion;return s.eUp=i,s.nodeUp=t.dict.insertBefore(r.nodeUp,s),i.activeRegion=s,s},e.sweep.isWindingInside_=function(t,r){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&r);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==r;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return r>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return r<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return r>=2||r<=-2}return e.assert(!1),!1},e.sweep.computeWinding_=function(t,r){r.windingNumber=r.regionAbove().windingNumber+r.eUp.winding,r.inside=e.sweep.isWindingInside_(t,r.windingNumber)},e.sweep.finishRegion_=function(t,r){var i=r.eUp,s=i.lFace;s.inside=r.inside,s.anEdge=i,e.sweep.deleteRegion_(t,r)},e.sweep.finishLeftRegions_=function(t,r,i){for(var s=r,a=r.eUp;s!==i;){s.fixUpperEdge=!1;var n=s.regionBelow(),o=n.eUp;if(o.org!==a.org){if(!n.fixUpperEdge){e.sweep.finishRegion_(t,s);break}o=e.mesh.connect(a.lPrev(),o.sym),e.sweep.fixUpperEdge_(n,o)}a.oNext!==o&&(e.mesh.meshSplice(o.oPrev(),o),e.mesh.meshSplice(a,o)),e.sweep.finishRegion_(t,s),a=n.eUp,s=n}return a},e.sweep.addRightEdges_=function(t,r,i,s,a,n){var o=!0,l=i;do{e.assert(e.geom.vertLeq(l.org,l.dst())),e.sweep.addRegionBelow_(t,r,l.sym),l=l.oNext}while(l!==s);null===a&&(a=r.regionBelow().eUp.rPrev());for(var h,c=r,u=a;(l=(h=c.regionBelow()).eUp.sym).org===u.org;)l.oNext!==u&&(e.mesh.meshSplice(l.oPrev(),l),e.mesh.meshSplice(u.oPrev(),l)),h.windingNumber=c.windingNumber-l.winding,h.inside=e.sweep.isWindingInside_(t,h.windingNumber),c.dirty=!0,!o&&e.sweep.checkForRightSplice_(t,c)&&(e.sweep.addWinding_(l,u),e.sweep.deleteRegion_(t,c),e.mesh.deleteEdge(u)),o=!1,c=h,u=l;c.dirty=!0,e.assert(c.windingNumber-l.winding===h.windingNumber),n&&e.sweep.walkDirtyRegions_(t,c)},e.sweep.callCombine_=function(t,r,i,s,a){var n=[r.coords[0],r.coords[1],r.coords[2]];r.data=null,r.data=t.callCombineCallback(n,i,s),null===r.data&&(a?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):r.data=i[0])},e.sweep.spliceMergeVertices_=function(t,r,i){var s=[null,null,null,null];s[0]=r.org.data,s[1]=i.org.data,e.sweep.callCombine_(t,r.org,s,[.5,.5,0,0],!1),e.mesh.meshSplice(r,i)},e.sweep.vertexWeights_=function(t,r,i,s,a){var n=e.geom.vertL1dist(r,t),o=e.geom.vertL1dist(i,t),l=a,h=a+1;s[l]=.5*o/(n+o),s[h]=.5*n/(n+o),t.coords[0]+=s[l]*r.coords[0]+s[h]*i.coords[0],t.coords[1]+=s[l]*r.coords[1]+s[h]*i.coords[1],t.coords[2]+=s[l]*r.coords[2]+s[h]*i.coords[2]},e.sweep.getIntersectData_=function(t,r,i,s,a,n){var o=[0,0,0,0],l=[i.data,s.data,a.data,n.data];r.coords[0]=r.coords[1]=r.coords[2]=0,e.sweep.vertexWeights_(r,i,s,o,0),e.sweep.vertexWeights_(r,a,n,o,2),e.sweep.callCombine_(t,r,l,o,!0)},e.sweep.checkForRightSplice_=function(t,r){var i=r.regionBelow(),s=r.eUp,a=i.eUp;if(e.geom.vertLeq(s.org,a.org)){if(e.geom.edgeSign(a.dst(),s.org,a.org)>0)return!1;e.geom.vertEq(s.org,a.org)?s.org!==a.org&&(t.pq.remove(s.org.pqHandle),e.sweep.spliceMergeVertices_(t,a.oPrev(),s)):(e.mesh.splitEdge(a.sym),e.mesh.meshSplice(s,a.oPrev()),r.dirty=i.dirty=!0)}else{if(e.geom.edgeSign(s.dst(),a.org,s.org)<0)return!1;r.regionAbove().dirty=r.dirty=!0,e.mesh.splitEdge(s.sym),e.mesh.meshSplice(a.oPrev(),s)}return!0},e.sweep.checkForLeftSplice_=function(t,r){var i,s=r.regionBelow(),a=r.eUp,n=s.eUp;if(e.assert(!e.geom.vertEq(a.dst(),n.dst())),e.geom.vertLeq(a.dst(),n.dst())){if(e.geom.edgeSign(a.dst(),n.dst(),a.org)<0)return!1;r.regionAbove().dirty=r.dirty=!0,i=e.mesh.splitEdge(a),e.mesh.meshSplice(n.sym,i),i.lFace.inside=r.inside}else{if(e.geom.edgeSign(n.dst(),a.dst(),n.org)>0)return!1;r.dirty=s.dirty=!0,i=e.mesh.splitEdge(n),e.mesh.meshSplice(a.lNext,n.sym),i.rFace().inside=r.inside}return!0},e.sweep.checkForIntersect_=function(t,r){var i=r.regionBelow(),s=r.eUp,a=i.eUp,n=s.org,o=a.org,l=s.dst(),h=a.dst(),c=new e.GluVertex;if(e.assert(!e.geom.vertEq(h,l)),e.assert(e.geom.edgeSign(l,t.event,n)<=0),e.assert(e.geom.edgeSign(h,t.event,o)>=0),e.assert(n!==t.event&&o!==t.event),e.assert(!r.fixUpperEdge&&!i.fixUpperEdge),n===o)return!1;if(Math.min(n.t,l.t)>Math.max(o.t,h.t))return!1;if(e.geom.vertLeq(n,o)){if(e.geom.edgeSign(h,n,o)>0)return!1}else if(e.geom.edgeSign(l,o,n)<0)return!1;e.geom.edgeIntersect(l,n,h,o,c),e.assert(Math.min(n.t,l.t)<=c.t),e.assert(c.t<=Math.max(o.t,h.t)),e.assert(Math.min(h.s,l.s)<=c.s),e.assert(c.s<=Math.max(o.s,n.s)),e.geom.vertLeq(c,t.event)&&(c.s=t.event.s,c.t=t.event.t);var u=e.geom.vertLeq(n,o)?n:o;if(e.geom.vertLeq(u,c)&&(c.s=u.s,c.t=u.t),e.geom.vertEq(c,n)||e.geom.vertEq(c,o))return e.sweep.checkForRightSplice_(t,r),!1;if(!e.geom.vertEq(l,t.event)&&e.geom.edgeSign(l,t.event,c)>=0||!e.geom.vertEq(h,t.event)&&e.geom.edgeSign(h,t.event,c)<=0){if(h===t.event)return e.mesh.splitEdge(s.sym),e.mesh.meshSplice(a.sym,s),s=(r=e.sweep.topLeftRegion_(r)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,r.regionBelow(),i),e.sweep.addRightEdges_(t,r,s.oPrev(),s,s,!0),!0;if(l===t.event){e.mesh.splitEdge(a.sym),e.mesh.meshSplice(s.lNext,a.oPrev()),i=r;var d=(r=e.sweep.topRightRegion_(r)).regionBelow().eUp.rPrev();return i.eUp=a.oPrev(),a=e.sweep.finishLeftRegions_(t,i,null),e.sweep.addRightEdges_(t,r,a.oNext,s.rPrev(),d,!0),!0}return e.geom.edgeSign(l,t.event,c)>=0&&(r.regionAbove().dirty=r.dirty=!0,e.mesh.splitEdge(s.sym),s.org.s=t.event.s,s.org.t=t.event.t),e.geom.edgeSign(h,t.event,c)<=0&&(r.dirty=i.dirty=!0,e.mesh.splitEdge(a.sym),a.org.s=t.event.s,a.org.t=t.event.t),!1}return e.mesh.splitEdge(s.sym),e.mesh.splitEdge(a.sym),e.mesh.meshSplice(a.oPrev(),s),s.org.s=c.s,s.org.t=c.t,s.org.pqHandle=t.pq.insert(s.org),e.sweep.getIntersectData_(t,s.org,n,l,o,h),r.regionAbove().dirty=r.dirty=i.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,r){for(var i=r.regionBelow();;){for(;i.dirty;)r=i,i=i.regionBelow();if(!r.dirty&&(i=r,null===(r=r.regionAbove())||!r.dirty))return;r.dirty=!1;var s=r.eUp,a=i.eUp;if(s.dst()!==a.dst()&&e.sweep.checkForLeftSplice_(t,r)&&(i.fixUpperEdge?(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(a),a=(i=r.regionBelow()).eUp):r.fixUpperEdge&&(e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(s),s=(r=i.regionAbove()).eUp)),s.org!==a.org)if(s.dst()===a.dst()||r.fixUpperEdge||i.fixUpperEdge||s.dst()!==t.event&&a.dst()!==t.event)e.sweep.checkForRightSplice_(t,r);else if(e.sweep.checkForIntersect_(t,r))return;s.org===a.org&&s.dst()===a.dst()&&(e.sweep.addWinding_(a,s),e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(s),r=i.regionAbove())}},e.sweep.connectRightVertex_=function(t,r,i){var s,a=i.oNext,n=r.regionBelow(),o=r.eUp,l=n.eUp,h=!1;o.dst()!==l.dst()&&e.sweep.checkForIntersect_(t,r),e.geom.vertEq(o.org,t.event)&&(e.mesh.meshSplice(a.oPrev(),o),a=(r=e.sweep.topLeftRegion_(r)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,r.regionBelow(),n),h=!0),e.geom.vertEq(l.org,t.event)&&(e.mesh.meshSplice(i,l.oPrev()),i=e.sweep.finishLeftRegions_(t,n,null),h=!0),h?e.sweep.addRightEdges_(t,r,i.oNext,a,a,!0):(s=e.geom.vertLeq(l.org,o.org)?l.oPrev():o,s=e.mesh.connect(i.lPrev(),s),e.sweep.addRightEdges_(t,r,s,s.oNext,s.oNext,!1),s.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,r))},e.sweep.connectLeftDegenerate_=function(t,r,i){var s=r.eUp;if(e.geom.vertEq(s.org,i))return e.assert(e.sweep.TOLERANCE_NONZERO_),void(e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,s,i.anEdge));if(!e.geom.vertEq(s.dst(),i))return e.mesh.splitEdge(s.sym),r.fixUpperEdge&&(e.mesh.deleteEdge(s.oNext),r.fixUpperEdge=!1),e.mesh.meshSplice(i.anEdge,s),void e.sweep.sweepEvent_(t,i);if(e.assert(e.sweep.TOLERANCE_NONZERO_),e.sweep.TOLERANCE_NONZERO_){var a=(r=e.sweep.topRightRegion_(r)).regionBelow(),n=a.eUp.sym,o=n.oNext,l=o;a.fixUpperEdge&&(e.assert(o!==n),e.sweep.deleteRegion_(t,a),e.mesh.deleteEdge(n),n=o.oPrev()),e.mesh.meshSplice(i.anEdge,n),e.geom.edgeGoesLeft(o)||(o=null),e.sweep.addRightEdges_(t,r,n.oNext,l,o,!0)}},e.sweep.connectLeftVertex_=function(t,r){var i=new e.ActiveRegion;i.eUp=r.anEdge.sym;var s=t.dict.search(i).getKey(),a=s.regionBelow(),n=s.eUp,o=a.eUp;if(0!==e.geom.edgeSign(n.dst(),r,n.org)){var l,h=e.geom.vertLeq(o.dst(),n.dst())?s:a;s.inside||h.fixUpperEdge?(l=h===s?e.mesh.connect(r.anEdge.sym,n.lNext):e.mesh.connect(o.dNext(),r.anEdge).sym,h.fixUpperEdge?e.sweep.fixUpperEdge_(h,l):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,s,l)),e.sweep.sweepEvent_(t,r)):e.sweep.addRightEdges_(t,s,r.anEdge,r.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,s,r)},e.sweep.sweepEvent_=function(t,r){t.event=r;for(var i=r.anEdge;null===i.activeRegion;)if((i=i.oNext)===r.anEdge)return void e.sweep.connectLeftVertex_(t,r);var s=e.sweep.topLeftRegion_(i.activeRegion),a=s.regionBelow(),n=a.eUp,o=e.sweep.finishLeftRegions_(t,a,null);o.oNext===n?e.sweep.connectRightVertex_(t,s,o):e.sweep.addRightEdges_(t,s,o.oNext,n,n,!0)},e.sweep.addSentinel_=function(t,r){var i=new e.ActiveRegion,s=e.mesh.makeEdge(t.mesh);s.org.s=e.sweep.SENTINEL_COORD_,s.org.t=r,s.dst().s=-e.sweep.SENTINEL_COORD_,s.dst().t=r,t.event=s.dst(),i.eUp=s,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var r,i=0;null!==(r=t.dict.getMin().getKey());)r.sentinel||(e.assert(r.fixUpperEdge),e.assert(1==++i)),e.assert(0===r.windingNumber),e.sweep.deleteRegion_(t,r);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var r,i=t.mesh.eHead,s=i.next;s!==i;s=r){r=s.next;var a=s.lNext;e.geom.vertEq(s.org,s.dst())&&s.lNext.lNext!==s&&(e.sweep.spliceMergeVertices_(t,a,s),e.mesh.deleteEdge(s),a=(s=a).lNext),a.lNext===s&&(a!==s&&(a!==r&&a!==r.sym||(r=r.next),e.mesh.deleteEdge(a)),s!==r&&s!==r.sym||(r=r.next),e.mesh.deleteEdge(s))}},e.sweep.initPriorityQ_=function(t){var r=new e.PriorityQ;t.pq=r;var i,s=t.mesh.vHead;for(i=s.next;i!==s;i=i.next)i.pqHandle=r.insert(i);r.init()},e.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r){r=i.next;var s=i.anEdge;e.assert(s.lNext!==s),s.lNext.lNext===s&&(e.sweep.addWinding_(s.oNext,s),e.mesh.deleteEdge(s))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){var r=t.anEdge;for(e.assert(r.lNext!==r&&r.lNext.lNext!==r);e.geom.vertLeq(r.dst(),r.org);r=r.lPrev());for(;e.geom.vertLeq(r.org,r.dst());r=r.lNext);for(var i,s=r.lPrev();r.lNext!==s;)if(e.geom.vertLeq(r.dst(),s.org)){for(;s.lNext!==r&&(e.geom.edgeGoesLeft(s.lNext)||e.geom.edgeSign(s.org,s.dst(),s.lNext.dst())<=0);)s=(i=e.mesh.connect(s.lNext,s)).sym;s=s.lPrev()}else{for(;s.lNext!==r&&(e.geom.edgeGoesRight(r.lPrev())||e.geom.edgeSign(r.dst(),r.org,r.lPrev().org)>=0);)i=e.mesh.connect(r,r.lPrev()),r=i.sym;r=r.lNext}for(e.assert(s.lNext!==r);s.lNext.lNext!==r;)s=(i=e.mesh.connect(s.lNext,s)).sym},e.tessmono.tessellateInterior=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside&&e.tessmono.tessellateMonoRegion_(i)},e.tessmono.discardExterior=function(t){for(var r,i=t.fHead.next;i!==t.fHead;i=r)r=i.next,i.inside||e.mesh.zapFace(i)},e.tessmono.setWindingNumber=function(t,r,i){for(var s,a=t.eHead.next;a!==t.eHead;a=s)s=a.next,a.rFace().inside!==a.lFace.inside?a.winding=a.lFace.inside?r:-r:i?e.mesh.deleteEdge(a):a.winding=0},e.Dict=function(t,r){this.head_=new e.DictNode,this.frame_=t,this.leq_=r},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,r){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,r));var i=new e.DictNode(r,t.next,t);return t.next.prev=i,t.next=i,i},e.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},e.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},e.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(e,t,r){this.key=e||null,this.next=t||this,this.prev=r||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,r){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=r;switch(i){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!r);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:var r=this.windingRule;return e.assert(r===e.windingRule.GLU_TESS_WINDING_ODD||r===e.windingRule.GLU_TESS_WINDING_NONZERO||r===e.windingRule.GLU_TESS_WINDING_POSITIVE||r===e.windingRule.GLU_TESS_WINDING_NEGATIVE||r===e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),r;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return e.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(e,t,r){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=r},e.GluTesselator.prototype.gluTessCallback=function(t,r){var i=r||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,r){var i=!1,s=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var a=0;a<3;++a){var n=t[a];n<-e.GLU_TESS_MAX_COORD&&(n=-e.GLU_TESS_MAX_COORD,i=!0),n>e.GLU_TESS_MAX_COORD&&(n=e.GLU_TESS_MAX_COORD,i=!0),s[a]=n}i&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(s,r)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var r=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,r)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,r){var i=this.lastEdge_;null===i?(i=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(i,i.sym)):(e.mesh.splitEdge(i),i=i.lNext),i.org.data=r,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},e.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(e,t,r){return this.combineCallback_&&this.combineCallback_(e,t,r,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},e.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.inside=!1},e.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,r,i,s=this.fHead,a=this.vHead,n=this.eHead,o=s;for(o=s;(r=o.next)!==s;o=r){e.assert(r.prev===o),t=r.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.lFace===r),t=t.lNext}while(t!==r.anEdge)}e.assert(r.prev===o&&null===r.anEdge);var l=a;for(l=a;(i=l.next)!==a;l=i){e.assert(i.prev===l),t=i.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.org===i),t=t.oNext}while(t!==i.anEdge)}e.assert(i.prev===l&&null===i.anEdge&&null===i.data);var h=n;for(h=n;(t=h.next)!==n;h=t)e.assert(t.sym.next===h.sym),e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(null!==t.org),e.assert(null!==t.dst()),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t);e.assert(t.sym.next===h.sym&&t.sym===this.eHeadSym&&t.sym.sym===t&&null===t.org&&null===t.dst()&&null===t.lFace&&null===t.rFace())}},e.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var r,i=(r=this.verts_,function(t,i){return e.geom.vertLeq(r[t],r[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),e.DEBUG){var s=0+this.size_-1;for(t=0;t<s;++t)e.assert(e.geom.vertLeq(this.verts_[this.order_[t+1]],this.verts_[this.order_[t]]))}},e.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var r=this.heap_.minimum();if(e.geom.vertLeq(r,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var r=this.heap_.minimum();if(e.geom.vertLeq(r,t))return r}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),e.assert(t<this.verts_.length&&null!==this.verts_[t]),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(e,t){for(var r=new Array(t),i=0;i<e.length;i++)r[i]=e[i];for(;i<t;i++)r[i]=0;return r},e.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var r,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?r=i:(r=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[r]=t,this.handles_[r]=i,this.heap_[i]=r,this.initialized_&&this.floatUp_(i),r},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,r=this.handles_,i=e[1],s=t[i];return this.size_>0&&(e[1]=e[this.size_],r[e[1]]=1,t[i]=null,r[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),s},e.PriorityQHeap.prototype.remove=function(t){var r=this.heap_,i=this.verts_,s=this.handles_;e.assert(t>=1&&t<=this.max_&&null!==i[t]);var a=s[t];if(r[a]=r[this.size_],s[r[a]]=a,a<=--this.size_)if(a<=1)this.floatDown_(a);else{var n=i[r[a]],o=i[r[a>>1]];e.geom.vertLeq(o,n)?this.floatDown_(a):this.floatUp_(a)}i[t]=null,s[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var r=this.heap_,i=this.verts_,s=this.handles_,a=t,n=r[a];;){var o=a<<1;o<this.size_&&e.geom.vertLeq(i[r[o+1]],i[r[o]])&&(o+=1),e.assert(o<=this.max_);var l=r[o];if(o>this.size_||e.geom.vertLeq(i[n],i[l]))return r[a]=n,void(s[n]=a);r[a]=l,s[l]=a,a=o}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var r=this.heap_,i=this.verts_,s=this.handles_,a=t,n=r[a];;){var o=a>>1,l=r[o];if(0===o||e.geom.vertLeq(i[l],i[n]))return r[a]=n,void(s[n]=a);r[a]=l,s[l]=a,a=o}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e},void 0!==(r=t())&&(e.exports=r)})),n=i.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");t.a=class{constructor(){this._currentVertexIndex=0,this._indexCounter=0,this._triangleIndices=[-1,-1,-1],this.glu=new a.GluTesselator,this.glu.gluTessCallback(a.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this)),this.glu.gluTessCallback(a.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this)),this.glu.gluTessCallback(a.gluEnum.GLU_TESS_END,this._endcallback.bind(this)),this.glu.gluTessCallback(a.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this)),this.glu.gluTessCallback(a.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this)),this.glu.gluTessCallback(a.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this)),this.glu.gluTessProperty(a.gluEnum.GLU_TESS_WINDING_RULE,a.windingRule.GLU_TESS_WINDING_ODD)}beginPolygon(e,t){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0,this._indexCounter=0,this.glu.gluTessBeginPolygon(e),this._indices=t}endPolygon(){this.glu.gluTessEndPolygon()}beginContour(){this.glu.gluTessBeginContour()}endContour(){this.glu.gluTessEndContour()}addVertex(e,t){this.glu.gluTessVertex(e,t)}_vertexCallback(e,t){if(t[t.length]=e[0],t[t.length]=e[1],this._triangleIndices[this._currentVertexIndex]=-1,this._currentVertexIndex>=2){for(var r=0;r<3;r++)-1===this._triangleIndices[r]&&(this._triangleIndices[r]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[r];this._currentVertexIndex=0}else this._currentVertexIndex++}_begincallback(){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0}_endcallback(){this._currentVertexIndex=0}_errorcallback(e){n.error("Encountered error during tesselation: ".concat(e))}_combinecallback(e){return[e[0],e[1],e[2]]}_edgeCallback(){}}},539:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return a}));var i,s=r(232);function a(e,t,r){m.trackDistance=null!=t.trackDistance&&t.trackDistance,m.wrapDistance=null!=t.wrapDistance?t.wrapDistance:65535,m.thin=null!=t.thin&&t.thin,m.initialDistance=null!=t.initialDistance?t.initialDistance:0,m.enableOuterBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,m.outerBisectorAutoSplitThreshold=null!=t.outerBisectorAutoSplitThreshold?t.outerBisectorAutoSplitThreshold:0,m.enableInnerBisectorSplit=null!=t.enableOuterBisectorSplit&&t.enableOuterBisectorSplit,m.innerBisectorAutoSplitThreshold=null!=t.innerBisectorAutoSplitThreshold?t.innerBisectorAutoSplitThreshold:0,i=e,l=r,h=0,c=0,u=0,d=!1,f=null,p=null,_.currentVertex.x=null,_.currentVertex.y=null,_.distance=m.initialDistance;var s=i[0],a=i[i.length-1];_.canSplit=!1,_.closed=s.x===a.x&&s.y===a.y,i.length<2||2===i.length&&_.closed||(m.thin?m.trackDistance?function(){for(g(),v(),b(1);c-u>m.wrapDistance||h<i.length;)g(),v(),b(2),l.bridge(_),_.leftExit0=_.rightExit0,_.leftExit2=_.rightExit2}():function(){for(;h<i.length;){if(h>0&&(_.inbound.x=_.outbound.x,_.inbound.y=_.outbound.y),h<i.length-1){_.outbound.x=i[h+1].x-i[h].x,_.outbound.y=i[h+1].y-i[h].y;var e=Math.sqrt(_.outbound.x*_.outbound.x+_.outbound.y*_.outbound.y);_.distance+=e,_.outbound.x/=e,_.outbound.y/=e}else _.outbound.x=_.inbound.x,_.outbound.y=_.inbound.y;0===h&&(_.inbound.x=_.outbound.x,_.inbound.y=_.outbound.y),_.currentVertex.x=i[h].x,_.currentVertex.y=i[h].y,_.prevNormal.x=-_.inbound.y,_.prevNormal.y=_.inbound.x,_.nextNormal.x=-_.outbound.y,_.nextNormal.y=_.outbound.x,0===h?(l.vertex(_),_.leftEntry0=_.entry0,_.leftEntry2=_.entry2,_.leftExit0=_.exit0,_.leftExit2=_.exit2):(l.vertex(_),_.rightEntry0=_.entry0,_.rightEntry2=_.entry2,_.rightExit0=_.exit0,_.rightExit2=_.exit2,l.bridge(_),_.leftExit0=_.rightExit0,_.leftExit2=_.rightExit2),++h}}():m.enableOuterBisectorSplit||m.outerBisectorAutoSplitThreshold>0||m.enableInnerBisectorSplit||m.innerBisectorAutoSplitThreshold>0?(_.canSplit=!0,function(){for(g(),y(),_.splitInner=_.gapInner=_.splitOuter=_.gapOuter=!1,x(1),_.closure0=_.leftEntry0,_.closure1=_.leftEntry1,_.closure2=_.leftEntry2;c-u>m.wrapDistance||h<i.length-1||h<i.length&&(!_.closed||m.trackDistance);)g(),y(),_.splitInner=_.gapInner=_.splitOuter=_.gapOuter=!1,x(2),l.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2;_.closed&&!m.trackDistance&&(_.rightEntry0=_.closure0,_.rightEntry1=_.closure1,_.rightEntry2=_.closure2,l.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2)}()):function(){for(g(),y(),x(1),_.closure0=_.leftEntry0,_.closure1=_.leftEntry1,_.closure2=_.leftEntry2;c-u>m.wrapDistance||h<i.length-1||h<i.length&&(!_.closed||m.trackDistance);)g(),y(),x(2),l.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2;_.closed&&!m.trackDistance&&(_.rightEntry0=_.closure0,_.rightEntry1=_.closure1,_.rightEntry2=_.closure2,l.bridge(_),_.leftExit0=_.rightExit0,_.leftExit1=_.rightExit1,_.leftExit2=_.rightExit2)}())}function n(){i=null,l=null}function o(){if(_.cosine<m.innerBisectorAutoSplitThreshold){_.splitInner=!0,_.gapInner=!0;var e=Math.max(m.innerBisectorAutoSplitThreshold,_.cosine),t=Math.sqrt(1-e*e)/e;_.leftInner.x=_.nextNormal.x+_.sign*t*_.outbound.x,_.leftInner.y=_.nextNormal.y+_.sign*t*_.outbound.y,_.rightInner.x=_.prevNormal.x-_.sign*t*_.inbound.x,_.rightInner.y=_.prevNormal.y-_.sign*t*_.inbound.y}else m.enableInnerBisectorSplit&&(_.splitInner=!0,_.gapInner=!1,_.leftInner.x=_.rightInner.x=_.bisector.x/_.cosine,_.leftInner.y=_.rightInner.y=_.bisector.y/_.cosine);if(_.cosine<m.outerBisectorAutoSplitThreshold){_.splitOuter=!0,_.gapOuter=!0;var r=Math.max(m.outerBisectorAutoSplitThreshold,_.cosine),i=Math.sqrt(1-r*r)/r;_.leftOuter.x=_.prevNormal.x-_.sign*i*_.inbound.x,_.leftOuter.y=_.prevNormal.y-_.sign*i*_.inbound.y,_.rightOuter.x=_.nextNormal.x+_.sign*i*_.outbound.x,_.rightOuter.y=_.nextNormal.y+_.sign*i*_.outbound.y}else m.enableOuterBisectorSplit&&(_.splitOuter=!0,_.gapOuter=!1,_.leftOuter.x=_.rightOuter.x=_.bisector.x/_.cosine,_.leftOuter.y=_.rightOuter.y=_.bisector.y/_.cosine)}var l,h,c,u,d,f,p,m={},_=new class{constructor(){this.closed=void 0,this.isFirstVertex=void 0,this.isLastVertex=void 0,this.isCap=void 0,this.currentVertex={x:void 0,y:void 0},this.inbound={x:void 0,y:void 0},this.outbound={x:void 0,y:void 0},this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.bisector={x:void 0,y:void 0},this.leftInner={x:void 0,y:void 0},this.rightInner={x:void 0,y:void 0},this.leftOuter={x:void 0,y:void 0},this.rightOuter={x:void 0,y:void 0}}};function g(){if(d)return _.distance=0,_.isCap=_.isFirstVertex=_.isLastVertex=!1,void(d=!1);if(0===c)if(_.isFirstVertex=0===h,p=i[h],0===h){if(c=0,_.closed){_.inbound.x=p.x-i[i.length-2].x,_.inbound.y=p.y-i[i.length-2].y;var e=Math.sqrt(_.inbound.x*_.inbound.x+_.inbound.y*_.inbound.y);_.inbound.x/=e,_.inbound.y/=e}}else _.inbound.x=p.x-f.x,_.inbound.y=p.y-f.y,c=Math.sqrt(_.inbound.x*_.inbound.x+_.inbound.y*_.inbound.y),_.inbound.x/=c,_.inbound.y/=c;if(_.distance+c-u<=m.wrapDistance){if(h<i.length-1){_.outbound.x=i[h+1].x-p.x,_.outbound.y=i[h+1].y-p.y;var t=Math.sqrt(_.outbound.x*_.outbound.x+_.outbound.y*_.outbound.y);_.outbound.x/=t,_.outbound.y/=t}else if(_.closed){_.outbound.x=i[1].x-p.x,_.outbound.y=i[1].y-p.y;var r=Math.sqrt(_.outbound.x*_.outbound.x+_.outbound.y*_.outbound.y);_.outbound.x/=r,_.outbound.y/=r}else _.outbound.x=_.inbound.x,_.outbound.y=_.inbound.y;return 0!==h||_.closed||(_.inbound.x=_.outbound.x,_.inbound.y=_.outbound.y),++h,_.isLastVertex=h===i.length,_.isCap=!_.closed&&(_.isFirstVertex||_.isLastVertex),_.distance+=c-u,c=0,u=0,d=_.distance+c-u===m.wrapDistance,_.currentVertex.x=p.x,_.currentVertex.y=p.y,f=p,void(p=null)}_.outbound.x=_.inbound.x,_.outbound.y=_.inbound.y,u+=m.wrapDistance-_.distance,_.distance=m.wrapDistance,d=!0;var s=u/c;_.currentVertex.x=(1-s)*f.x+s*p.x,_.currentVertex.y=(1-s)*f.y+s*p.y}function v(){_.prevNormal.x=-_.inbound.y,_.prevNormal.y=_.inbound.x,_.nextNormal.x=-_.outbound.y,_.nextNormal.y=_.outbound.x}function y(){v(),_.bisector.x=_.prevNormal.x+_.nextNormal.x,_.bisector.y=_.prevNormal.y+_.nextNormal.y;var e=Math.sqrt(_.bisector.x*_.bisector.x+_.bisector.y*_.bisector.y);if(e<.001)return _.bisector.x=void 0,_.bisector.y=void 0,_.cosine=0,void(_.sign=void 0);_.bisector.x/=e,_.bisector.y/=e,_.cosine=_.bisector.x*_.nextNormal.x+_.bisector.y*_.nextNormal.y,_.sign=_.prevNormal.x*_.nextNormal.y-_.prevNormal.y*_.nextNormal.x>=0?1:-1}function x(e){l.vertex(_),1===e?(_.leftEntry0=_.entry0,_.leftEntry1=_.entry1,_.leftEntry2=_.entry2,_.leftExit0=_.exit0,_.leftExit1=_.exit1,_.leftExit2=_.exit2):2===e&&(_.rightEntry0=_.entry0,_.rightEntry1=_.entry1,_.rightEntry2=_.entry2,_.rightExit0=_.exit0,_.rightExit1=_.exit1,_.rightExit2=_.exit2)}function b(e){l.vertex(_),1===e?(_.leftEntry0=_.entry0,_.leftEntry2=_.entry2,_.leftExit0=_.exit0,_.leftExit2=_.exit2):2===e&&(_.rightEntry0=_.entry0,_.rightEntry2=_.entry2,_.rightExit0=_.exit0,_.rightExit2=_.exit2)}class O{constructor(e,t){this.writeVertex=e,this.writeTriangle=t,this.capType=0,this.joinType=2,this.miterLimitCosine=Object(s.b)(2),this.roundLimitCosine=Math.cos(23*Math.PI/180),this.almostParallelCosine=.97,this.radsPerSlice=.8,this.textured=!1,this.joinOnUTurn=!1}vertex(e){var t=2===this.joinType?this.miterLimitCosine:this.roundLimitCosine,r=e.isCap&&0!==this.capType,i=!1;e.cosine>this.almostParallelCosine?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):e.cosine<1-this.almostParallelCosine?(i=!e.isCap&&this.joinOnUTurn,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.canSplit?(o(),e.sign>0?(e.splitInner?(e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.leftInner.x,e.leftInner.y,0,-1,e.distance),e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.rightInner.x,e.rightInner.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(i=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.splitOuter?(i=i||e.gapOuter,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.leftOuter.x,-e.leftOuter.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.rightOuter.x,-e.rightOuter.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.splitInner?(e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,-e.leftInner.x,-e.leftInner.y,0,1,e.distance),e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,-e.rightInner.x,-e.rightInner.y,0,1,e.distance)):e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(i=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.splitOuter?(i=i||e.gapOuter,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.leftOuter.x,e.leftOuter.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.outbound.x,e.outbound.y,e.rightOuter.x,e.rightOuter.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance))):e.sign>0?(e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,e.inbound.x,e.inbound.y,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance),e.cosine<t?(i=!e.isCap,e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x,-e.prevNormal.y,0,1,e.distance),e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.nextNormal.x,-e.nextNormal.y,0,1,e.distance)):e.entry2=e.exit2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance)):(e.exit2=e.entry2=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.bisector.x/e.cosine,-e.bisector.y/e.cosine,0,1,e.distance),e.cosine<t?(i=!e.isCap,e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x,e.prevNormal.y,0,-1,e.distance),e.exit0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.nextNormal.x,e.nextNormal.y,0,-1,e.distance)):e.exit0=e.entry0=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.bisector.x/e.cosine,e.bisector.y/e.cosine,0,-1,e.distance));var s,a=e.canSplit&&(e.splitInner||e.splitOuter);if(s=e.entry1=e.exit1=a||i||r?this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,0,0,0,0,e.distance):null,i&&1!==this.joinType)this.writeTriangle(s,e.sign>0?e.exit2:e.entry0,e.sign>0?e.entry2:e.exit0);else if(r&&1===this.capType||i&&1===this.joinType){var n,l,h,c,u,d;if(e.isCap){var f=Math.PI;d=f/(u=Math.ceil(f/this.radsPerSlice)),e.isFirstVertex?(n=e.prevNormal.x,l=e.prevNormal.y,h=e.entry0,c=e.entry2):e.isLastVertex&&(n=-e.nextNormal.x,l=-e.nextNormal.y,h=e.exit2,c=e.exit0)}else{var p=2*Math.acos(e.cosine);d=p/(u=Math.ceil(p/this.radsPerSlice)),n=e.sign>0?-e.prevNormal.x:e.nextNormal.x,l=e.sign>0?-e.prevNormal.y:e.nextNormal.y,h=e.sign>0?e.entry2:e.exit0,c=e.sign>0?e.exit2:e.entry0}var m,_,g=Math.cos(d),v=Math.sin(d),y=v*n+g*l;n=g*n-v*l,l=y;for(var x=0;x<u;++x){if(m=_,x<u-1)if(e.isCap){var b=e.isFirstVertex?-1:1;_=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,n,l,b,0,e.distance)}else _=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,n,l,0,e.sign,e.distance);this.writeTriangle(0===x?h:m,s,x===u-1?c:_);var O=v*n+g*l;n=g*n-v*l,l=O}}else if(r&&2===this.capType){var w,S,j=e.isFirstVertex?1:-1;this.textured?(w=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-j*e.inbound.x,e.prevNormal.y-j*e.inbound.y,-j,-1,e.distance),S=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-j*e.inbound.x,-e.prevNormal.y-j*e.inbound.y,-j,1,e.distance)):(w=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,e.prevNormal.x-j*e.inbound.x,e.prevNormal.y-j*e.inbound.y,0,-1,e.distance),S=this.writeVertex(e.currentVertex.x,e.currentVertex.y,0,0,-e.prevNormal.x-j*e.inbound.x,-e.prevNormal.y-j*e.inbound.y,0,1,e.distance)),j>0?(this.writeTriangle(s,e.entry2,S),this.writeTriangle(s,S,w),this.writeTriangle(s,w,e.entry0)):(this.writeTriangle(s,S,e.exit2),this.writeTriangle(s,w,S),this.writeTriangle(s,e.exit0,w))}}bridge(e){this.writeTriangle(e.leftExit0,e.rightEntry0,null!=e.leftExit1?e.leftExit1:e.leftExit2),this.writeTriangle(e.rightEntry0,null!=e.rightEntry1?e.rightEntry1:e.rightEntry2,null!=e.leftExit1?e.leftExit1:e.leftExit2),null!=e.leftExit1&&null!=e.rightEntry1?(this.writeTriangle(e.leftExit1,e.rightEntry1,e.leftExit2),this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)):null!=e.leftExit1?this.writeTriangle(e.leftExit1,e.rightEntry2,e.leftExit2):null!=e.rightEntry1&&this.writeTriangle(e.rightEntry1,e.rightEntry2,e.leftExit2)}}},553:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var i=r(112),s=r(354),a=r(210),n=r(100),o=r(125),l=r(243);function h(e){if(!e)return null;if("mesh"===e.type)return e.toJSON();var t=null,r=e.spatialReference,o=Object(i.d)(r);if(!o)return e.toJSON();var h,d=r.isWebMercator?102100:4326,f=l.a[d].maxX,p=l.a[d].minX,g=l.a[d].plus180Line,v=l.a[d].minus180Line,y=e.toJSON();if(Object(n.f)(y))h=u(y,f,p);else if(Object(n.e)(y))y.points=y.points.map((e=>u(e,f,p))),h=y;else if(Object(n.d)(y))h=c(y,o);else if(Object(n.g)(y)||Object(n.h)(y)){var x=_;Object(a.a)(x,y);var b={xmin:x[0],ymin:x[1],xmax:x[2],ymax:x[3]},O=Object(l.d)(b.xmin,p)*(2*f),w=0===O?y:function(e,t){var r=Object(l.b)(e);for(var i of r)for(var s of i)s[0]+=t;return e}(y,O);b.xmin+=O,b.xmax+=O,Object(s.a)(b,g)&&b.xmax!==f||Object(s.a)(b,v)&&b.xmin!==p?t=w:h=w}else h=e.toJSON();return null!==t?(new m).cut(t,f):h}function c(e,t){if(!t)return e;var r=function(e,t){var r,i=[],{ymin:s,ymax:a}=e,n=e.xmax-e.xmin,o=e.xmin,l=e.xmax,[h,c]=t.valid,u=(r=d(e.xmin,t)).x,p=r.frameId,m=(r=d(e.xmax,t)).x,_=r.frameId,g=u===m&&n>0;if(n>2*c){var v={xmin:o<l?u:m,ymin:s,xmax:c,ymax:a},y={xmin:h,ymin:s,xmax:o<l?m:u,ymax:a},x={xmin:0,ymin:s,xmax:c,ymax:a},b={xmin:h,ymin:s,xmax:0,ymax:a},O=[],w=[];f(v,x)&&O.push(p),f(v,b)&&w.push(p),f(y,x)&&O.push(_),f(y,b)&&w.push(_);for(var S=p+1;S<_;S++)O.push(S),w.push(S);i.push({extent:v,frameIds:[p]},{extent:y,frameIds:[_]},{extent:x,frameIds:O},{extent:b,frameIds:w})}else u>m||g?i.push({extent:{xmin:u,ymin:s,xmax:c,ymax:a},frameIds:[p]},{extent:{xmin:h,ymin:s,xmax:m,ymax:a},frameIds:[_]}):i.push({extent:{xmin:u,ymin:s,xmax:m,ymax:a},frameIds:[p]});return i}(e,t).map((e=>e.extent));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function u(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var s=Object(l.d)(i,t);e[0]=i+s*(-2*t)}else if(i<r){var a=Object(l.d)(i,r);e[0]=i+a*(-2*r)}}else{var n=e.x;if(n>t){var o=Object(l.d)(n,t);e.x+=o*(-2*t)}else if(n<r){var h=Object(l.d)(n,r);e.x+=h*(-2*r)}}return e}function d(e,t){var r,[i,s]=t.valid,a=2*s,n=0;return e>s?(e-=(r=Math.ceil(Math.abs(e-s)/a))*a,n=r):e<i&&(e+=(r=Math.ceil(Math.abs(e-i)/a))*a,n=-r),{x:e,frameId:n}}function f(e,t){var{xmin:r,ymin:i,xmax:s,ymax:a}=t;return p(e,r,i)&&p(e,r,a)&&p(e,s,a)&&p(e,s,i)}function p(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}class m{cut(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,s=-2*t,a=0;a<i;a++){var n=r[a];if(n&&n.length>=this.minPts){var o=[];for(var l of n)o.push([l[0]+s,l[1]]);r.push(o)}}return this.closed?e.rings=r:e.paths=r,e}}var _=Object(o.i)()},554:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var i=r(122),s=r(404);class a extends s.a{constructor(e,t){super(e,t,[i.E,i.E])}}},555:function(e,t,r){"use strict";var i=r(80),s=r(131),a=r(245),n=r(513),o=r(430),l=r(420),h={added:[],removed:[]},c=new Set,u=new a.a(0,0,0,0);class d extends s.a{constructor(e){super(),this._tiles=new Map,this._index=Object(l.a)(9,Object(i.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this.tiles=[],this.tileScheme=e}destroy(){this.clear()}clear(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}has(e){return this._tiles.has(e)}get(e){return this._tiles.get(e)}findByKey(e){return this._tiles.get(e.id)}minLOD(){return Math.min(...this.tiles.map((e=>e.level)))}intersections(e,t){var r="string"==typeof e?this.get(e):e;if(!r)return[];var i=t*r.resolution,s=r.bounds[0]-i,a=r.bounds[1]-i,n=r.bounds[2]+i,o=r.bounds[3]+i,l=[];for(var h of this._index.search({minX:s,minY:a,maxX:n,maxY:o})){var c=h.bounds.slice();c[0]=Math.max(c[0],s),c[1]=Math.max(c[1],a),c[2]=Math.min(c[2],n),c[3]=Math.min(c[3],o),c[2]-c[0]>0&&c[3]-c[1]>0&&l.push({bounds:c,tile:h})}return l}boundsIntersections(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}updateTiles(e){var t={added:[],removed:[]};for(var r of e.added)if(!this.has(r)){var i=new o.a(this.tileScheme,r);this._tiles.set(r,i),this._index.insert(i),t.added.push(i)}for(var s of e.removed)if(this.has(s)){var a=this.get(s);this._tiles.delete(s),this._index.remove(a),t.removed.push(a)}this.tiles.length=0,this._tiles.forEach((e=>this.tiles.push(e))),(t.added.length||t.removed.length)&&this.emit("update",t)}setViewState(e){var t=this.tileScheme.getTileCoverage(e,0);if(t){var{spans:r,lodInfo:i}=t,{level:s}=i;if(r.length>0)for(var{row:a,colFrom:l,colTo:d}of r)for(var f=l;f<=d;f++){var p=u.set(s,a,i.normalizeCol(f),i.getWorldForColumn(f)).id;if(c.add(p),!this.has(p)){var m=new o.a(this.tileScheme,p);this._tiles.set(p,m),this._index.insert(m),this.tiles.push(m),h.added.push(m)}}for(var _=this.tiles.length-1;_>=0;_--){var g=this.tiles[_];c.has(g.id)||(this._tiles.delete(g.id),this.tiles.splice(_,1),this._index.remove(g),h.removed.push(g))}(h.added.length||h.removed.length)&&this.emit("update",h),n.a.pool.release(t),c.clear(),h.added.length=0,h.removed.length=0}}}t.a=d},557:function(e,t,r){"use strict";r.d(t,"a",(function(){return N}));var i=r(7),s=(r(80),r(89)),a=r(94),n=r(366),o=r(81),l=r(93),h=r(110),c=r(105),u=r(122),d=r(285),f=r(164),p=r(127),m=r(633),_=r(156),g=r(187),v=r(232);function y(e){return e.length-1}function x(e){for(var t=0,r=0;r<y(e);r++)t+=b(e,r);return t}function b(e,t,r=1){var[i,s]=function(e,t){return e[t+1]}(e,t);return Math.sqrt(i*i+s*s)*r}class O{constructor(e,t,r,i,s){this._segments=e,this._index=t,this._distance=r,this._xStart=i,this._yStart=s,this._done=!1}static create(e){return new O(e,0,0,e[0][0],e[0][1])}clone(){return new O(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){var{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<y(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var i=this.backwardLength;this.prev();){if(i+this.length>e)return this._seekBackwards(e-i);i+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}function w(e,t,r){var i=x(e),s=O.create(e),a=i/2,n=(i-t)/2,o=Math.floor(n/t),l=a-o*t;s.seek(l);for(var h=-o;h<=o;h++)s.x<512&&s.x>=0&&s.y<512&&s.y>=0&&r(s.clone(),h,a+h*t,i),s.seek(t)}function S(e,t){var r=1e-6;if(!(t<=0)){var i=e.length;if(!(i<3)){var s=[],a=0;s.push(0);for(var n=1;n<i;n++)a+=Object(v.a)(e[n],e[n-1]),s.push(a);t=Math.min(t,.2*a);var o=[];o.push(e[0][0]),o.push(e[0][1]);var l=e[i-1][0],h=e[i-1][1],c=Object(v.e)([0,0],e[0],e[1]);Object(v.d)(c),e[0][0]+=t*c[0],e[0][1]+=t*c[1],Object(v.e)(c,e[i-1],e[i-2]),Object(v.d)(c),e[i-1][0]+=t*c[0],e[i-1][1]+=t*c[1];for(var u=1;u<i;u++)s[u]+=t;s[i-1]+=t;for(var d=.5*t,f=1;f<i-1;f++){for(var p=0,m=0,_=0,g=f-1;g>=0&&!(s[g+1]<s[f]-d);g--){var y=d+s[g+1]-s[f],x=s[g+1]-s[g],b=s[f]-s[g]<d?1:y/x;if(Math.abs(b)<r)break;var O=b*b,w=b*y-.5*O*x,S=b*x/t,j=e[g+1],M=e[g][0]-j[0],T=e[g][1]-j[1];p+=S/w*(j[0]*b*y+.5*O*(y*M-x*j[0])-O*b*x*M/3),m+=S/w*(j[1]*b*y+.5*O*(y*T-x*j[1])-O*b*x*T/3),_+=S}for(var E=f+1;E<i&&!(s[E-1]>s[f]+d);E++){var C=d-s[E-1]+s[f],I=s[E]-s[E-1],P=s[E]-s[f]<d?1:C/I;if(Math.abs(P)<r)break;var L=P*P,k=P*C-.5*L*I,R=P*I/t,N=e[E-1],A=e[E][0]-N[0],z=e[E][1]-N[1];p+=R/k*(N[0]*P*C+.5*L*(C*A-I*N[0])-L*P*I*A/3),m+=R/k*(N[1]*P*C+.5*L*(C*z-I*N[1])-L*P*I*z/3),_+=R}o.push(p/_),o.push(m/_)}o.push(l),o.push(h);for(var D=0,F=0;D<i;D++)e[D][0]=o[F++],e[D][1]=o[F++]}}}var j=r(447),M=o.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var T=function(e){var t=new Map;return r=>(t.has(r)||t.set(r,e(r)),t.get(r))}((e=>{var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})),E=e=>Math.floor(127*e+127),C=e=>Math.floor(10*e),I=e=>Math.round(e*(254/360));class P extends j.a{constructor(e,t,r,i){super(e,r.font.size,r.haloSize||0,r.color&&Object(g.d)(r.color)||0,r.haloColor&&Object(g.d)(r.haloColor)||0,r.horizontalAlignment,r.verticalAlignment,Object(m.a)(t.labelPlacement)?1:0,r.font.decoration,!1,r.angle||0,r.xoffset,r.yoffset,r.lineWidth,r.lineHeight,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this._zoomLevel=0,this.geometryType=p.d.LABEL;var s=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return Object(h.d)(r,0,25.5)}(t,i),a=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return Object(h.d)(r,0,25.5)}(t,i),n=t.labelPlacement,[o,l]=Object(d.b)(n);this._xAlignD=o,this._yAlignD=l,this._minZoom=s,this._maxZoom=a,this._refPlacementPadding=Object(c.h)(r.haloSize)+u.C;var f=_.b.load(e);f.sdf=!0,this._materialKey=f.data}static fromLabelClass(e,t){if("center-along"===e.labelPlacement){var r=e.symbol;r.xoffset=0,r.yoffset=0,r.angle=0,r.font.decoration="none"}return new P(e.materialKey,e,e.symbol,t)}get _shapedBox(){return Object(s.q)(this._shapingInfo).bounds}setZoomLevel(e){this._zoomLevel=e}bindReferenceTemplate(e){var t=Object(d.e)(this._xAlignD),r=Object(d.g)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(s.j)(e))this._refSymbolAndPlacementOffset=Object(f.b)(0,0,E(t),E(r));else{if("circle"===e.boundsType&&(t||r)){var i=Math.sqrt(t*t+r*r);t/=i,r/=i}var a=Math.max(e.height,e.width),n=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(f.b)(n,a,E(t),E(r)),this._referenceSize=a,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}_write(e,t){if(!Object(s.j)(this._shapingInfo)){var r=this._shapingInfo,i=t.getDisplayId(),a="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(a)switch(this.current={out:e,inId:i,inShaping:r,zoomLevel:this._zoomLevel},t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(a);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(a);break;default:((e,t="mapview-labeling")=>{M.error(new l.a(t,e))})("mapview-labeling","Geometry of type ".concat(t.geometryType," is not supported"))}}}_isVisible(e,t){var r=C(this.current.zoomLevel);return C(e)<=r&&r<=C(t)}_placePointLabels(e){var{out:t,inId:r,inShaping:i}=this.current;this._writeGlyphs(t,r,e,i)}_placeLineLabels(e){var t=function(e,t){for(var r=t,i=0;i<e.length;i++){var s=e[i],a=[];a.push(s[0]);for(var n=1;n<s.length;n++){var[o,l]=a[n-1];o+=s[n][0],l+=s[n][1],a.push([o,l])}S(a,r);var h=[];h.push(a[0]);for(var c=1;c<a.length;c++){var[u,d]=a[c-1],[f,p]=a[c],m=Math.round(f-u),_=Math.round(p-d);h.push([m,_])}e[i]=h,s=h}return e}(e.paths,this.current.inShaping.bounds.width),r=this._placeSubdivGlyphs.bind(this),i=(this._shapedBox.width+128)/2;for(var s of t)w(s,i,r)}_placeSubdivGlyphs(e,t,r,i){var s=T(t),a=this._shapedBox.width/2,n=Math.min(r,i-r),o=Object(h.m)(n/(8+a/2)),l=0===t?o:Math.min(s,o),c=Math.max(this._minZoom,this.current.zoomLevel+1-l),u=this.current.zoomLevel-c,d=this._shapedBox.width/2*Math.pow(2,u);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,c):this._placeCurved(e,c,d)}_placeStraight(e,t){var{out:r,inId:i,inShaping:s}=this.current;this._writeGlyphs(r,i,e,s,t)}_placeCurved(e,t,r){var{out:i,inId:s}=this.current;i.metricStart(s,t,e.x,e.y,0,0,0,0);var a=e.clone(),n=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=I(n),this._placeFirst(a,t,1),this._placeBack(e,a,t,r,1),this._placeForward(e,a,t,r,1),this._outLineLabelAngle=I(o),this._placeFirst(a,t,0),this._placeBack(e,a,t,r,0),this._placeForward(e,a,t,r,0),i.metricEnd()}_placeBack(e,t,r,i,s){for(var a=e.clone(),n=e.backwardLength+0;a.prev()&&!(n>=i);)this._placeOnSegment(a,t,n,r,-1,s),n+=a.length+0}_placeForward(e,t,r,i,s){for(var a=e.clone(),n=e.remainingLength+0;a.next()&&!(n>=i);)this._placeOnSegment(a,t,n,r,1,s),n+=a.length+0}_placeFirst(e,t,r){var i=e,s=this.current.inShaping,a=s.glyphs,n=this.current.zoomLevel,{out:o,inId:l}=this.current;for(var c of a){var u=c.x>s.bounds.x?r:1-r,d=u*e.remainingLength+(1-u)*e.backwardLength,f=Math.abs(c.x+c.width/2-s.bounds.x),p=Math.max(0,n+Object(h.m)(f/(d+0))),m=Math.max(t,p);if(c.maxZoom=25,c.angle=e.angle+(1-r)*Math.PI,c.minZoom=m,!(i.x<0||i.x>=512||i.y<0||i.y>=512)&&(this._writeGlyph(o,l,i.x,i.y,c),r&&this._isVisible(c.minZoom,c.maxZoom))){var _=c.bounds;o.metricBoxWrite(_.center[0],_.center[1],_.width,_.height)}}}_placeOnSegment(e,t,r,i,s,a){var n=this.current.inShaping.glyphs,{out:o,inId:l}=this.current,c=this.current.inShaping,u=this.current.zoomLevel,d=e.dx/e.length,f=e.dy/e.length,p={x:e.x+r*-s*d,y:e.y+r*-s*f};for(var m of n){var _=m.x>c.bounds.x?a:1-a;if(_&&1===s||!_&&-1===s){var g=Math.abs(m.x+m.width/2-c.bounds.x),v=Math.max(0,u+Object(h.m)(g/r)-.1),y=Math.max(i,u+Object(h.m)(g/(r+e.length+0)));if(0!==v&&(m.angle=e.angle+(1-a)*Math.PI,m.minZoom=y,m.maxZoom=v,!(p.x<0||p.x>=512||p.y<0||p.y>=512)&&(this._writeGlyph(o,l,p.x,p.y,m),a&&this._isVisible(m.minZoom,m.maxZoom)))){var x=m.bounds,b=e.x-t.x,O=e.y-t.y;o.metricBoxWrite(x.center[0]+b,x.center[1]+O,x.width,x.height)}}}}_writeGlyphs(e,t,r,i,s=this._minZoom){if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){var a=r.x+this._refOffsetX,n=r.y-this._refOffsetY;for(var o of i.glyphs)o.minZoom=s,o.maxZoom=this._maxZoom,this._writeGlyph(e,t,a,n,o);var l=_.b.load(this._materialKey),h=this._refPlacementDirX,c=this._refPlacementDirY,u=l.vvSizeFieldStops||l.vvSizeMinMaxValue||l.vvSizeScaleStops||l.vvSizeUnitValue,d=i.boundsT;e.metricStart(t,s,a,n,h,c,this._referenceSize,u?1:0),e.metricBoxWrite(d.center[0],d.center[1],d.width,d.height),e.metricEnd()}}_writeVertexCommon(e,t,r,i){var s=this._color,a=this._haloColor,n=Object(f.b)(0,0,this._size,this._haloSize),o=Math.max(i.minZoom,this._minZoom),l=Math.min(i.maxZoom,this._maxZoom),h=Object(f.b)(C(o),C(l),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(s),e.vertexWrite(a),e.vertexWrite(n),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(h)}}var L=P,k=r(450),R=r(452);class N{constructor(e,t,r){this._geometryType=e,this._idField=t,this._templateStore=r}update(e,t){Object(s.k)(e.mesh.labels)&&this._setLabelTemplates(e.mesh.labels,t)}_setLabelTemplates(e,t){this._labelTemplates=e.map((e=>L.fromLabelClass(e,t)))}get templates(){return this._templateStore}analyze(e,t,r,o,l,h){var c=this;return Object(i.a)((function*(){if(!Object(a.n)(h)){var i;"dictionary"===t.type&&(i=yield t.analyze(c._idField,e.copy(),o,l,h));for(var u=0;e.next();){var d;if(d=i?i[u++]:Object(s.k)(r)&&Object(n.c)(e.getDisplayId())&&1!==e.readAttribute("cluster_count")?r.match(c._idField,e,c._geometryType,o,l):t.match(c._idField,e,c._geometryType,o,l),e.setGroupId(d),Object(R.b)(d)){var f=c._templateStore.getDynamicTemplateGroup(d);for(var p of f)p&&p.analyze&&p.analyze(c._templateStore,e,o,l)}}return c._templateStore.finalize(h)}}))()}analyzeGraphics(e,t,r,s,n){var o=this;return Object(i.a)((function*(){if(!Object(a.n)(n)){var i=e.getCursor();for(t&&(yield t.analyze(o._idField,i.copy(),r,s,n));i.next();){var l=i.getGroupId();if(null!=l&&-1!==l||(l=t.match(o._idField,i,i.geometryType,r,s),i.setGroupId(l)),Object(R.b)(l)){var h=o._templateStore.getDynamicTemplateGroup(l);for(var c of h)c&&c.analyze&&c.analyze(o._templateStore,i,r,s)}i.setGroupId(l)}return o._templateStore.finalize(n)}}))()}writeGraphic(e,t){var r=t.getGroupId(),i=t.getDisplayId(),s=this._templateStore.getTemplateGroup(r);if(e.featureStart(t.insertAfter),null!=i){if(Object(R.b)(r))for(var a of s)a.bindFeature(t,null,null);if(s){for(var n of s)n&&n.write(e,t);e.featureEnd()}}}writeCursor(e,t,r,i,a,n){var o=t.getGroupId(),l=t.getDisplayId(),h=this._templateStore.getTemplateGroup(o);if(t.getObjectId(),null!=l&&h){if(Object(R.b)(o))for(var c of h)c.bindFeature(t,r,i);for(var u of h)u.write(e,t);if(Object(s.k)(n)&&e.hasRecords){var d=n&&this._findLabelRef(h);this._writeLabels(e,t,n,d,a)}}}_findLabelRef(e){for(var t of e)if(t instanceof k.a)return t;return null}_writeLabels(e,t,r,i,a){for(var n of r)if(Object(s.k)(n)&&n){var{glyphs:o,rtl:l,index:h}=n,c=this._labelTemplates[h];c.setZoomLevel(a),c.bindReferenceTemplate(i),c.bindTextInfo(o,l),c.write(e,t)}}}},558:function(e,t,r){"use strict";r.d(t,"a",(function(){return I}));var i=r(91),s=r(7),a=r(94),n=r(459),o=r(80),l=r(89),h=r(81),c=r(93),u=r(122),d=(r(208),r(263),r(205)),f=r(192),p=r(151),m=r(429),_=h.a.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),g=Object(m.b)(m.a,_),v=e=>2147483647&e;class y{constructor(e,t,r){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;var{buffer:i,pixelType:s,textureOnly:a}=e,n=Object(p.j)(s);this.shared=r,this.pixelType=s,this.size=t,this.textureOnly=a,a||(this.data=new n(Object(l.q)(i))),this._resetRange()}destroy(){var e=this;Object(l.b)(this._texture,(e=>e.dispose()));var t=function(t){Object(l.b)(e._fbos[t],(e=>{"0"===t&&e.detachColorTexture(),e.dispose()})),e._fbos[t]=null};for(var r in this._fbos)t(r);this._texture=null}get _textureDesc(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}}setData(e,t,r){var i=v(e),s=Object(l.q)(this.data),a=i*this.texelSize+t;!s||a>=s.length||(s[a]=r,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i))}getData(e,t){if(Object(l.j)(this.data))return null;var r=v(e)*this.texelSize+t;return!this.data||r>=this.data.length?null:this.data[r]}getTexture(e){return Object(l.r)(this._texture,(()=>this._initTexture(e)))}getFBO(e,t=0){if(Object(l.j)(this._fbos[t])){var r=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new f.a(e,{colorTarget:0,depthStencilTarget:0},r)}return this._fbos[t]}get locked(){return!(5121!==this.pixelType||!this.shared||this.textureOnly||!Object(o.a)("esri-atomics")||!this.data)&&1===Atomics.load(this.data,0)}updateTexture(e){if(!this.locked)try{var t=this.dirtyStart,r=this.dirtyEnd;if(t>r)return;this._resetRange();var i=Object(l.q)(this.data).buffer,s=this.getTexture(e),a=(t-t%this.size)/this.size,n=(r-r%this.size)/this.size,o=a,h=this.size,u=n,d=a*this.size*4,f=4*(h+u*this.size)-d,m=Object(p.j)(this.pixelType),g=m.BYTES_PER_ELEMENT;try{new m(i,d*g,f)}catch(b){}var v=new m(i,d*g,f),y=this.size,x=u-o+1;if(x>this.size)return void _.error(new c.a("mapview-webgl","Out-of-bounds index when updating AttributeData"));s.updateData(0,0,o,y,x,v)}catch(b){}}update(e){var{data:t,start:r,end:i}=e;if(Object(l.k)(t))for(var s=this.data,a=r*this.texelSize,n=0;n<t.length;n++){var o=1<<n%this.texelSize;e.layout&o&&(s[a+n]=t[n])}this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,i)}resize(e,t){var r=this.size;if(this.size=t,this.textureOnly)r!==this.size&&(this._lastTexture=this._texture,this._texture=null);else{var i=Object(p.j)(this.pixelType);this.destroy(),this.data=new i(Object(l.q)(e.buffer))}}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(e){var t=new d.a(e,this._textureDesc,Object(l.r)(this.data,void 0));if(Object(l.k)(this._lastTexture)&&this._fbos[0]){var r=this._lastTexture.descriptor.width,i=this._lastTexture.descriptor.height,s=this._lastTexture.descriptor.dataType,a=this._lastTexture.descriptor.pixelFormat,n=this.getFBO(e),o=Object(p.k)(s),h=new(Object(p.j)(s))(new ArrayBuffer(r*i*o*this.texelSize)),c=e.getBoundFramebufferObject(),{x:u,y:f,width:m,height:_}=e.getViewport();e.bindFramebuffer(n),n.readPixels(0,0,r,i,a,s,h),t.updateData(0,0,0,2*r,i/2,h),e.setViewport(u,f,m,_),e.bindFramebuffer(c)}return this.destroy(),this._texture=t,this._texture}}class x{constructor(e){this._onUpdate=e,this._initialized=!1,this._forceNextUpload=!1,this._locked=!1}initialize(e){var{blocks:t,shared:r,size:i}=e;if(this.shared=r,this.size=i,g("Initializing AttributeStoreView",e),Object(l.j)(this._data))this._data=Object(l.m)(t,(e=>new y(e,i,r)));else for(var s=0;s<this._data.length;s++){var a=this._data[s],n=t[s];Object(l.k)(n)&&(Object(l.j)(a)?this._data[s]=new y(n,i,r):a.resize(n,i))}this._initialized=!0}destroy(){Object(l.b)(this._data,(e=>Object(l.m)(e,(e=>e.destroy())))),Object(l.b)(this._defaultTexture,(e=>e.dispose()))}getBlock(e){return Object(l.j)(this._data)?null:this._data[e]}setLabelMinZoom(e,t){this.setData(e,0,1,t)}getLabelMinZoom(e){return this.getData(e,0,1,255)}getFilterFlags(e){return this.getData(e,0,0,0)}getVVSize(e){return this.getData(e,u.b,0,0)}getData(e,t,r,i){if(!this._data)return 0;var s=Object(l.q)(this._data)[t];if(Object(l.j)(s))return 0;var a=s.getData(e,r);return Object(l.k)(a)?a:i}setData(e,t,r,i){var s=Object(l.q)(this._data)[t];Object(l.q)(s).setData(e,r,i)}lockTextureUpload(){this._locked=!0}unlockTextureUpload(){this._locked=!1}forceTextureUpload(){this._forceNextUpload=!0}requestUpdate(e){var t=this;return Object(s.a)((function*(){if(!t._pendingAttributeUpdate){var r=Object(a.g)();return g("AttributeStoreView Update Requested",e),t._pendingAttributeUpdate={data:e,resolver:r},r.promise}_.error(new c.a("mapview-webgl","Tried to update attribute data with a pending update"))}))()}update(){if(this._initialized&&(this._onUpdate(),Object(l.k)(this._pendingAttributeUpdate))){for(var{data:e,resolver:t}=this._pendingAttributeUpdate,r=Object(l.q)(this._data),i=function(t){var i=e.blocks[t],s=r[t];Object(l.b)(s,(e=>Object(l.b)(i,(r=>{g("Updating block ".concat(t),r),e.update(r)}))))},s=0;s<e.blocks.length;s++)i(s);this._pendingAttributeUpdate=null,t()}}bindTextures(e){this.update();var t=this._getDefaultTexture(e);if(!this._initialized)return e.bindTexture(t,u.r),e.bindTexture(t,u.s),e.bindTexture(t,u.t),void e.bindTexture(t,u.u);var r=Object(l.q)(this._data);this._locked&&!this._forceNextUpload||(Object(l.h)(r,(t=>t.updateTexture(e))),this._forceNextUpload=!1),e.bindTexture(Object(l.n)(r[0],t,(t=>t.getTexture(e))),u.r),e.bindTexture(Object(l.n)(r[1],t,(t=>t.getTexture(e))),u.s),e.bindTexture(Object(l.n)(r[2],t,(t=>t.getTexture(e))),u.t),e.bindTexture(Object(l.n)(r[3],t,(t=>t.getTexture(e))),u.u)}_getDefaultTexture(e){if(Object(l.j)(this._defaultTexture)){this._defaultTexture=new d.a(e,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4))}return this._defaultTexture}}var b=r(432),O=r(109),w=r(105),S=r(117),j=r(193),M=r(444);function T(e,t){var r=t.length;if(e<t[0].value||1===r)return t[0].size;for(var i=1;i<r;i++)if(e<t[i].value){var s=(e-t[i-1].value)/(t[i].value-t[i-1].value);return t[i-1].size+s*(t[i].size-t[i-1].size)}return t[r-1].size}function E(e,t,r=0){if(Object(l.j)(t))return e[r+0]=0,e[r+1]=0,e[r+2]=0,void(e[r+3]=0);var{r:i,g:s,b:a,a:n}=t;e[r+0]=i*n/255,e[r+1]=s*n/255,e[r+2]=a*n/255,e[r+3]=n}class C{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1}}getSizeVVFieldStops(e){var t=this._vvSizeFieldStops;switch(t.type){case"static":return t;case"level-dependent":return Object(l.r)(t.levels[e],(()=>{var r=1/0,i=0;for(var s in t.levels){var a=parseFloat(s),n=Math.abs(e-a);n<r&&(r=n,i=a)}if(r===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};var o=Math.pow(2,(e-i)/2),h=Object(l.q)(t.levels[i]),c=new Float32Array(h.values);return c[2]*=o,c[3]*=o,{sizes:Object(l.q)(h.sizes),values:c}}))}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){Object(l.k)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,r){switch(Object(l.k)(r)&&r.forEach((e=>this._updateEffects(e))),this._vvInfo=t,e.type){case"dot-density":this._updateDotDensityInfo(e)}}getVariation(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:Object(M.a)().supportsTextureFloat}}getVariationHash(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}_updateEffects(e){Object(l.k)(e)&&e.filter&&e.filter.enabled&&(this.outsideLabelsVisible=e.excludedLabelsVisible)}_updateVisualVariables(e,t){var r=this._vvMaterialParameters;if(r.vvOpacityEnabled=!1,r.vvSizeEnabled=!1,r.vvColorEnabled=!1,r.vvRotationEnabled=!1,e){var i=e.size;if(i){if(r.vvSizeEnabled=!0,i.minMaxValue){var s,a,n=i.minMaxValue;if(Object(p.n)(n.minSize)&&Object(p.n)(n.maxSize))if(Object(p.o)(n.minSize)&&Object(p.o)(n.maxSize))s=Object(w.h)(n.minSize),a=Object(w.h)(n.maxSize);else{var o=t.scale;s=Object(w.h)(T(o,n.minSize.stops)),a=Object(w.h)(T(o,n.maxSize.stops))}this.vvSizeMinMaxValue.set([n.minDataValue,n.maxDataValue,s,a])}if(i.scaleStops&&(this.vvSizeScaleStopsValue=Object(w.h)(T(t.scale,i.scaleStops.stops))),i.unitValue){var l=Object(S.f)(t.spatialReference)/j.a[i.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=l/t.resolution}i.fieldStops&&(this._vvSizeFieldStops=i.fieldStops)}var h=e.color;h&&(r.vvColorEnabled=!0,this.vvColorValues.set(h.values),this.vvColors.set(h.colors));var c=e.opacity;c&&(r.vvOpacityEnabled=!0,this.vvOpacityValues.set(c.values),this.vvOpacities.set(c.opacities));var u=e.rotation;u&&(r.vvRotationEnabled=!0,r.vvRotationType=u.type)}}_updateDotDensityInfo(e){var t=e.attributes;this.ddDotValue=e.dotValue,this.ddDotScale=e.referenceScale,this.ddDotSize=e.dotSize,this.ddDotBlending=e.dotBlendingEnabled,this.ddSeed=e.seed;for(var r=0;r<u.g;r++){var i=r>=t.length?new O.a([0,0,0,0]):t[r].color;E(this.ddColors,i,4*r)}for(var s=0;s<8;s++)this.ddActiveDots[s]=s<e.attributes.length?1:0;E(this.ddBackgroundColor,e.backgroundColor)}}class I extends b.a{constructor(e){super(e),this._rendererInfo=new C,this._materialItemsRequestQueue=new n.a,this.attributeView=new x((()=>this.onAttributeStoreUpdate()))}destroy(){this.removeAllChildren(),this.children.forEach((e=>e.destroy())),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(e,t,r){this._rendererInfo.setInfo(e,t,r),this.requestRender()}getMaterialItems(e,t){var r=this;return Object(s.a)((function*(){if(!e||0===e.length)return null;var i=Object(a.g)();return r._materialItemsRequestQueue.push({items:e,abortOptions:t,resolver:i}),r.requestRender(),i.promise}))()}doRender(e){if(e.context.capabilities.enable("textureFloat"),e.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0)for(var t=this._materialItemsRequestQueue.pop();t;)this._processMaterialItemRequest(e,t),t=this._materialItemsRequestQueue.pop();super.doRender(e)}renderChildren(e){for(var t of this.children)t.commit(e);this._rendererInfo.update(e.state),super.renderChildren(e)}createRenderParams(e){return Object(i.a)(Object(i.a)({},super.createRenderParams(e)),{},{rendererInfo:this._rendererInfo,attributeView:this.attributeView})}onAttributeStoreUpdate(){}_processMaterialItemRequest(e,{items:t,abortOptions:r,resolver:i}){var{painter:s,pixelRatio:a}=e,n=t.map((e=>s.textureManager.rasterizeItem(e.symbol,a,e.glyphIds,r)));Promise.all(n).then((e=>{if(this.stage){var r=e.map(((e,r)=>({id:t[r].id,mosaicItem:e})));i.resolve(r)}else i.reject()}),i.reject)}}},561:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var i=r(245),s=r(122),a=(r(642),r(508),r(577),r(607),r(127)),n=r(151),o=r(534),l=r(381);class h{constructor(e,t,r){this._start={index:0,vertex:0};var i=Object(o.b)(e,t,r),s=t/4;this.geometryType=e,this._records=new l.a(Int32Array,i.recordBytes),this._indices=new l.a(Uint32Array,i.indexBytes),this._vertices=new l.a(Uint32Array,i.vertexBytes),this._metrics=new l.a(Float32Array,0),this._strideInt=s}serialize(e){var t=this._records.buffer(),r=this._indices.buffer(),i=this._vertices.buffer(),s=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,i),{stride:a,records:t,indices:r,vertices:i,metrics:s}}get strideInt(){return this._strideInt}get recordCount(){return this._records.length/s.f}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}recordStart(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}recordEnd(e,t,r,i,s,a,n){this._records.push(e),this._records.push(t),this._records.push(r),this._records.push(i),this._records.push(s),this._records.push(a),this._records.push(n)}writeIndex(e){this._indices.push(e)}writeVertex(e){this._vertices.push(e)}writeVertexF32(e){this._vertices.writeF32(e)}copyLastFrom(e,t,r){for(var i=e._records.length-7,s=e._records.getValue(i),a=e._records.getValue(i+1),n=e._records.getValue(i+2),o=e._records.getValue(i+4),l=e._records.getValue(i+6),h=this._vertices.length,c=(e._start.vertex-this._vertices.length)/this._strideInt,u=this._indices.length,d=this.vertexCount,f=e._start.index;f!==e._indices.length;f++){var p=e._indices.getValue(f);this._indices.push(p-c)}for(var m=e._start.vertex;m!==e._vertices.length;m++){var _=e._vertices.getValue(m);this._vertices.push(_)}for(var g=h;g<=this._vertices.length;g+=this._strideInt)this._vertices.i1616Add(g,t,r);this._records.push(s),this._records.push(a),this._records.push(n),this._records.push(u),this._records.push(o),this._records.push(d),this._records.push(l)}}var c=r(366),u=r(521),d=128;function f(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case d:return 1}}function p(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case d:return 1}}class m{constructor(e,t,r,i,s){this._hasDotDensity=!1,this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=t,this.tileKey=e,this._hasDotDensity=r,this._hasAggregate=i,this._pixelBufferEnabled=s}get hasAggregates(){return this._hasAggregate}get hasPixelBufferEnabled(){return this._pixelBufferEnabled}serialize(e){var t=[];return t.push(this._serializeTileVertexData(this.tileKey,this._data.self)),this._data.neighbors.forEach(((r,s)=>{var a=1<<s,n=f(a),o=p(a),l=Object(u.a)(new i.a(this.tileKey),n,o,e);t.push(this._serializeTileVertexData(l.id,r))})),t}_serializeTileVertexData(e,t){var r,i,s,n,o,l=new Array;return{message:{tileKey:e,data:{[a.d.MARKER]:null==(r=t.get(a.d.MARKER))?void 0:r.serialize(l),[a.d.FILL]:null==(i=t.get(a.d.FILL))?void 0:i.serialize(l),[a.d.LINE]:null==(s=t.get(a.d.LINE))?void 0:s.serialize(l),[a.d.TEXT]:null==(n=t.get(a.d.TEXT))?void 0:n.serialize(l),[a.d.LABEL]:null==(o=t.get(a.d.LABEL))?void 0:o.serialize(l)}},transferList:l}}featureStart(e=0){this._current.insertAfter=e}featureEnd(){}recordStart(e,t,r,i,s){this._current.writer=this._getVertexWriter(r,i),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=s,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}recordCount(){return this._current.writer.recordCount}vertexCount(){return this._current.writer.vertexCount}indexCount(){return this._current.writer.indexCount}vertexBounds(e,t,r,i){this._current.bufferingEnabled&&this._addOverlap(e,t,r,i)}vertexWrite(e){this._current.writer.writeVertex(e)}vertexWriteF32(e){this._current.writer.writeVertexF32(e)}vertexEnd(){}vertexWriter(){return this._current.writer.vertexWriter}indexWrite(e){this._current.writer.writeIndex(e)}indexWriter(){return this._current.writer.indexWriter}metricWriter(){return this._current.writer.metricWriter}metricStart(e,t,r,i,s,n,o,l){this._current.writer=this._getVertexWriter(a.d.LABEL,!1);var h=this._current.writer.metricWriter;h.push(Object(c.b)(e)),h.push(t),h.push(r),h.push(i),h.push(s),h.push(n),h.push(o),h.push(l),h.push(255),this._current.metricBoxLenPointer=h.push(0)}metricEnd(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}metricBoxWrite(e,t,r,i){var s=this._current.writer.metricWriter;s.incr(this._current.metricBoxLenPointer),s.push(0),s.push(0),s.push(e),s.push(t),s.push(r),s.push(i)}recordEnd(){var e=this._current.indexStart,t=this._current.writer.indexCount;if(e===t)return!1;this.hasRecords=!0;var r=t-e,i=this._current.vertStart,o=this._current.writer.vertexCount-i;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,e,r,i,o),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===a.d.LABEL)return!0;for(var l=this._current.writer,c=0;c<8;c++){var u=1<<c;if(this._current.overlaps&u){if(!this._data.neighbors[c]){var d=new Map;this._data.neighbors[c]=d}var m=this._data.neighbors[c],_=this._current.geometryType;if(!m.has(_)){var g=Object(n.l)(_,this._current.isDotDensity).geometry;m.set(_,new h(_,g,s.o))}var v=m.get(this._current.geometryType),y=512*-f(u)*8,x=512*-p(u)*8;v.copyLastFrom(l,y,x)}}return!0}_addOverlap(e,t,r,i){var a=255^((e<0+r?148:e>=s.E-r?41:189)|(t<0+i?224:t>=s.E-i?7:231));this._current.overlaps|=a}_getVertexWriter(e,t){if(!this._data.self.has(e)){var r=this._data.self,i=Object(n.l)(e,this._hasDotDensity).geometry;r.set(e,new h(e,i,8e3))}return this._data.self.get(e)}}},562:function(e,t,r){"use strict";r.d(t,"a",(function(){return x}));var i=r(7),s=r(81),a=r(93),n=r(91),o=r(152),l=r(320),h=r(235),c=r(419),u=r(464),d=r(360),f=s.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");class p{constructor(){this.type="feature",this._defaultResult=null}static fromBasicRenderer(e,t,r){return Object(i.a)((function*(){var i=new p;if(e.symbol){var s=yield Object(u.a)(e.symbol,r),a=t.createTemplateGroup(s,null);i.setDefault(a)}return i}))()}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}match(e,t,r,i,s){return this.getDefault()}analyze(e,t,r,s,a){return Object(i.a)((function*(){return null}))()}}class m extends p{constructor(e,t,r,i){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=t,this._fieldIndex=i,this._field=e,this._normalizationInfo=r}static fromCBRenderer(e,t,r){return Object(i.a)((function*(){var{isMaxInclusive:s,normalizationField:a,normalizationTotal:n,normalizationType:o}=e,l=e.field,h=new m(l,s,{normalizationField:a,normalizationTotal:n,normalizationType:o},e.fieldIndex),c=yield Object(u.a)(e.backgroundFillSymbol,r);yield Promise.all(e.intervals.map(function(){var e=Object(i.a)((function*(e){var i=yield Object(u.a)(e.symbol,r),s=yield t.createTemplateGroup(i,c),a={min:e.min,max:e.max};h.add(a,s)}));return function(t){return e.apply(this,arguments)}}()));var d=yield Object(u.a)(e.defaultSymbol,r);if(d){var f=yield t.createTemplateGroup(d,c);h.setDefault(f)}return h}))()}add(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort(((e,t)=>e.interval.min-t.interval.min))}size(){return super.size()+this._intervals.length}match(e,t,r,i,s){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(var n=0;n<this._intervals.length;n++){var{interval:o,result:l}=this._intervals[n],h=a>=o.min,c=this._isMaxInclusive?a<=o.max:a<o.max;if(h&&c)return l}return this.getDefault()}_needsNormalization(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}_getValueFromField(e){var t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;var{normalizationField:r,normalizationTotal:i,normalizationType:s}=this._normalizationInfo,a=!!r&&e.readAttribute(r);if(s)switch(s){case"esriNormalizeByField":return a?t/a:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/i*100;default:return void f.error("Found unknown normalization type: ".concat(s))}else f.error("Normalization is required, but no type was set!")}}class _ extends p{constructor(e,t,r){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=r,this._fields=e,this._seperator=t||""}static fromUVRenderer(e,t,r){return Object(i.a)((function*(){var s=e.fieldDelimiter,a=[e.field];e.field2&&a.push(e.field2),e.field3&&a.push(e.field3);var n=yield Object(u.a)(e.backgroundFillSymbol,r),o=new _(a,s,e.fieldIndex);yield Promise.all(e.map.map(function(){var e=Object(i.a)((function*(e){var i=yield Object(u.a)(e.symbol,r),s=yield t.createTemplateGroup(i,n);"<Null>"===e.value?o.setNullResult(s):o.add(e.value,s)}));return function(t){return e.apply(this,arguments)}}()));var l=yield Object(u.a)(e.defaultSymbol,r);if(l){var h=yield t.createTemplateGroup(l,n);o.setDefault(h)}return o}))()}setNullResult(e){this._nullResult=e}add(e,t){this._resultsMap.set(e.toString(),t)}size(){return super.size()+this._resultsMap.size}match(e,t,r,i,s){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();var n=a.toString();return this._resultsMap.has(n)?this._resultsMap.get(n):this.getDefault()}_getValueFromFields(e){var t=[];for(var r of this._fields){var i=e.readAttribute(r);t.push(i)}return t.join(this._seperator)}}function g(){return(g=Object(i.a)((function*(e,t){var r=e||1;if("number"==typeof r)return(e,t,i)=>r;var i=yield Object(o.d)(r,t.spatialReference,t.fields);return(e,r,s)=>Object(c.a)(i,e,{$view:s},t.geometryType,r)||1}))).apply(this,arguments)}class v extends p{constructor(e,t,r,i){super(),this.type="dictionary",this._groupIdCache=new h.a(100),this._renderer=e,this._fieldMap=e.fieldMap,this._symbolFields=e.getSymbolFields(),this._templates=t,this._info=r,this._scaleFn=i}static fromDictionaryRenderer(e,t,s){return Object(i.a)((function*(){var i=(yield Promise.resolve().then(r.bind(null,197))).default.fromJSON(e.renderer);yield i.fetchResources({spatialReference:s.spatialReference,fields:s.fields});var a=yield function(e,t){return g.apply(this,arguments)}(i.scaleExpression,s);return new v(i,t,s,a)}))()}_analyzeFeature(e,t,r,s){var o=this;return Object(i.a)((function*(){var i=e.readLegacyFeature(),h=o._scaleFn(i,t,r),c=o._attributeHash(i)+"-"+h,p=o._groupIdCache.get(c);if(p)return p;var m=Object(n.a)(Object(n.a)({},r),{},{spatialReference:o._info.spatialReference,abortOptions:s,fields:o._info.fields}),_=yield o._renderer.getSymbolAsync(i,m),g=Object(d.c)(_,o._renderer),v=Object(u.a)(g,o._info,s).then((e=>{if("expanded-cim"!==e.type)return f.error(new a.a("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;for(var t of(e.hash+="-"+h,e.layers))t.scaleFactor=h,t.templateHash+="-"+h,"text"===t.type&&"string"==typeof t.text&&t.text.indexOf("[")>-1&&(t.text=Object(l.c)(o._fieldMap,t.text,t.cim.textCase));return o._templates.createTemplateGroup(e,null)}));return o._groupIdCache.put(c,v,1),v}))()}analyze(e,t,r,s,a){var n=this;return Object(i.a)((function*(){for(var e=t.getCursor(),i=[];e.next();)i.push(n._analyzeFeature(e,r,s,a));return Promise.all(i)}))()}match(e,t,r,i,s){return null}_attributeHash(e){var t="";for(var r of this._symbolFields){var i=this._fieldMap[r];i&&(t+=e.attributes[i]+"-")}return t}}var y=s.a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");function x(e,t,r){return b.apply(this,arguments)}function b(){return(b=Object(i.a)((function*(e,t,r){switch(e.type){case"simple":return p.fromBasicRenderer(e,t,r);case"map":return _.fromUVRenderer(e,t,r);case"interval":return m.fromCBRenderer(e,t,r);case"dictionary":return v.fromDictionaryRenderer(e,t,r);default:return y.error(new a.a("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}))).apply(this,arguments)}},563:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var i=r(405),s=2147483648;class a{constructor(){this._freeIds=[],this._idCounter=1}createId(e=!1){return function(e,t){return((t?s:0)|e)>>>0}(this._getFreeId(),e)}releaseId(e){this._freeIds.push(e)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}function n(e,t,r){if(!(e.length>t))for(;e.length<=t;)e.push(r)}var o=2147483647;class l{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new a,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){var e=this._bitsets.length;return this._bitsets.push(i.a.create(this._allocatedSize,o)),e+1}getBitset(e){return this._bitsets[e-1]}_expand(){for(var e of(this._allocatedSize<<=1,this._bitsets))e.resize(this._allocatedSize)}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),n(this._numerics[e],t,0)}_ensureInstanceId(e){n(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),n(this._strings[e],t,null)}createDisplayId(e=!1){var t=this._idGenerator.createId();return t>this._allocatedSize&&this._expand(),((e,t)=>((t?2147483648:0)|e)>>>0)(t,e)}releaseDisplayId(e){for(var t of this._bitsets)t.unset(e);return this._idGenerator.releaseId(e&o)}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(e&o,0)}setComputedNumeric(e,t,r){return this.setComputedNumericAtIndex(e&o,r,0)}getComputedString(e,t){return this.getComputedStringAtIndex(e&o,0)}setComputedString(e,t,r){return this.setComputedStringAtIndex(e&o,0,r)}getComputedNumericAtIndex(e,t){var r=e&o;return this._ensureNumeric(t,r),this._numerics[t][r]}setComputedNumericAtIndex(e,t,r){var i=e&o;this._ensureNumeric(t,i),this._numerics[t][i]=r}getInstanceId(e){var t=e&o;return this._ensureInstanceId(t),this._instanceIds[t]}setInstanceId(e,t){var r=e&o;this._ensureInstanceId(r),this._instanceIds[r]=t}getComputedStringAtIndex(e,t){var r=e&o;return this._ensureString(t,r),this._strings[t][r]}setComputedStringAtIndex(e,t,r){var i=e&o;this._ensureString(t,i),this._strings[t][i]=r}getXMin(e){return this._bounds[4*(e&o)]}getYMin(e){return this._bounds[4*(e&o)+1]}getXMax(e){return this._bounds[4*(e&o)+2]}getYMax(e){return this._bounds[4*(e&o)+3]}setBounds(e,t){var r=t.readHydratedGeometry();if(!r||!r.coords.length)return!1;var i=1/0,s=1/0,a=-1/0,l=-1/0;r.forEachVertex(((e,t)=>{i=Math.min(i,e),s=Math.min(s,t),a=Math.max(a,e),l=Math.max(l,t)}));var h=e&o;return n(this._bounds,4*h+4,0),this._bounds[4*h]=i,this._bounds[4*h+1]=s,this._bounds[4*h+2]=a,this._bounds[4*h+3]=l,!0}}},572:function(e,t,r){"use strict";t.a=class{constructor(e,t,r){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=r}get width(){return this.pixelBlock?this.pixelBlock.width:0}get height(){return this.pixelBlock?this.pixelBlock.height:0}render(e){var t=this.pixelBlock;if(t){var r=this.filter({pixelBlock:t}),i=r.pixelBlock.getAsRGBA(),s=e.createImageData(r.pixelBlock.width,r.pixelBlock.height);s.data.set(i),e.putImageData(s,0,0)}}getRenderedRasterPixels(){var e=this.filter({pixelBlock:this.pixelBlock});return{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},573:function(e,t,r){"use strict";var i=r(7),s=r(82),a=r(80),n=r(89),o=(r(81),r(88),r(85)),l=r(84),h=(r(83),r(86),r(87),r(94)),c=r(97),u=r(112),d=r(99),f=r(276),p=r(130),m=r(100),_=r(105),g=r(125),v=r(234),y=r(167),x=r(122),b=r(444),O=r(553),w=r(365),S=r(464),j=r(400),M=r(151);function T(e,t,r){if(!e.allDirty)if(null!=e.from&&null!=e.count){var i=Math.min(e.from,t),s=Math.max(e.from+e.count,t+r)-i;e.from=i,e.count=s}else e.from=t,e.count=r}var E=class{constructor(){this._dirties=Object(M.e)((()=>({indices:{from:null,count:null,allDirty:!1}})),(()=>({vertices:{from:null,count:null,allDirty:!1}})))}hasDirty(){for(var e of this._dirties)if(null!==e.data.indices.count||e.data.indices.allDirty)return!0;return!1}markAllClean(){for(var e of this._dirties)for(var t in e.data.indices.from=null,e.data.indices.count=null,e.data.indices.allDirty=!1,e.buffers)e.buffers[t].data.vertices.from=null,e.buffers[t].data.vertices.count=null,e.buffers[t].data.vertices.allDirty=!1}markAllDirty(){for(var e of this._dirties)for(var t in e.data.indices.allDirty=!0,e.buffers)e.buffers[t].data.vertices.allDirty=!0}forEach(e){for(var t=0;t<this._dirties.length;++t){var r=this._dirties[t],i={};for(var s in r.buffers){var a=r.buffers[s].data.vertices;(a.allDirty||null!=a.from&&null!=a.count&&a.count>0)&&(i[s]=a)}var n,o=r.data.indices;((n=o.allDirty||null!=o.from&&null!=o.count&&o.count>0?{indices:o,vertices:i}:{indices:null,vertices:i}).indices||Object.keys(n).length>0)&&e(n,t)}}markDirtyIndices(e,t,r){T(this._dirties[e].data.indices,t,r)}markDirtyVertices(e,t,r,i){T(this._dirties[e].buffers[t].data.vertices,r,i)}};class C{constructor(e){this._largestRange=null,this._parent=e,this._updateLargestRange()}get largestRange(){return this._largestRange}rangeCreated(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}rangeResized(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}findBestRange(e){for(var t=this._parent._freeHead,r=null;null!==t;)t.count>=e&&(!r||t.count-e<r.count-e)&&(r=t),t=t.next;return r}findAdjacentRanges(e,t){for(var r=!0,i=!1,s=null,a=this._parent._freeHead;r&&!i;){var n=null!==s?s.from+s.count:0,o=null!==a?a.from:this._parent._size;e>=n&&e+t<=o?(r=!1,i=!0):null!==a?(s=a,a=a.next):r=!1}return[s,a]}_updateLargestRange(){for(var e=null,t=this._parent._freeHead;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}class I{constructor(e,t){this._allocated=0,this._size=e,this._freeHead=e>0?{from:0,count:e,prev:null,next:null}:null,this._bookKeeper=t||new C(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}allocate(e){var t=this._bookKeeper.findBestRange(e);if(null===t)return-1;var r=t.from,i=t.count;if(t.from+=e,t.count-=e,this._bookKeeper.rangeResized(t,r,i),this._allocated+=e,0===t.count){var s=null!==t.prev?this._freeHead:t.next;I._removeRange(t),this._freeHead=s}return r}free(e,t){var[r,i]=this._bookKeeper.findAdjacentRanges(e,t),s={from:e,count:t,prev:r,next:i};if(null!==r&&(r.next=s),null!==i&&(i.prev=s),this._bookKeeper.rangeCreated(s),this._allocated-=t,null!==i&&s.from+s.count===i.from){var a=s.from,n=s.count;I._fuse(s,i),I._removeRange(i),this._bookKeeper.rangeResized(s,a,n),this._bookKeeper.rangeResized(i,void 0,0)}if(null!==r&&r.from+r.count===s.from){var o=r.from,l=r.count;I._fuse(r,s),I._removeRange(s),this._bookKeeper.rangeResized(r,o,l),this._bookKeeper.rangeResized(s,void 0,0)}this._freeHead=null!==s.prev?this._freeHead:s}get fragmentation(){var e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}static _removeRange(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}static _fuse(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}var P=["FILL","LINE","MARKER","TEXT","LABEL"];class L{constructor(e,t,r,i){for(var s in this._strides=e,this._displayList=t,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=r,e)for(var a in this._freeListsAndStorage[s]={vtxFreeList:i?new I(i):null,idxFreeList:i?new I(i):null,vertexBuffers:{},indexBuffer:i?new Uint32Array(i):null},e[s])this._freeListsAndStorage[s].vertexBuffers[a]={data:i?Object(M.b)(i,e[s][a]):null,stride:e[s][a]}}static fromTileData(e,t){var r=function(e){for(var t=e.getStrides(),r={},i=0;i<t.length;i++)r[P[i]]=t[i];return r}(e),i=[0,0,0,0,0],s=[0,0,0,0,0],a=e.tileDisplayData.displayObjects;for(var n of a)for(var o of n.displayRecords)i[o.geometryType]=Math.max(i[o.geometryType],o.vertexFrom+o.vertexCount),s[o.geometryType]=Math.max(s[o.geometryType],o.indexFrom+o.indexCount);for(var l=new L(r,e.tileDisplayData.displayList,t,null),h=0;h<e.tileBufferData.geometries.length;++h){var c=i[h],u=s[h],d=e.tileBufferData.geometries[h],f=P[h],p=l._storageFor(f),m=e.tileBufferData.geometries[h].indexBuffer,_=void 0;for(var g in p.indexBuffer=m,p.idxFreeList=new I(m.length),p.idxFreeList.allocate(u),d.vertexBuffer){var v=e.tileBufferData.geometries[h].vertexBuffer[g];p.vertexBuffers[g].data=v.data,p.vertexBuffers[g].stride=v.stride;var y=Object(M.p)(v.stride),x=v.data.length*y/v.stride;_||(_=x)}p.vtxFreeList=new I(_),p.vtxFreeList.allocate(c)}return l}delete(e){var t=P[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}setMeshData(e,t,r,i,s){var a,n,o=P[e.geometryType];e.meshData=null,void 0===e.vertexFrom?(n=t.vertexCount,a=this._allocateVertices(o,n)):t.vertexCount>e.vertexCount?(this._freeVertices(o,e.vertexFrom,e.vertexCount),n=t.vertexCount,a=this._allocateVertices(o,n)):t.vertexCount===e.vertexCount?(a=e.vertexFrom,n=e.vertexCount):(this._freeVertices(o,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),a=e.vertexFrom,n=t.vertexCount);var l,h,c,u=!0;if(void 0===e.indexFrom?(l=s,c=t.indexCount,h=this._allocateIndices(o,c)):t.indexCount>e.indexCount?(l=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom,e.indexCount),c=t.indexCount,h=this._allocateIndices(o,c)):t.indexCount===e.indexCount?(u=!1,h=e.indexFrom,c=e.indexCount):(l=this._displayList.removeFromList(e),this._freeIndices(o,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),h=e.indexFrom,c=t.indexCount),-1!==a&&-1!==h){var d=this._storageFor(o);if(Object(M.d)(a,h,d.vertexBuffers,d.indexBuffer,t,r,i),e.vertexFrom=a,e.indexFrom=h,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap)for(var f in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,f,e.vertexFrom,e.vertexCount);return u&&this._displayList.addToList(e,l),!0}return-1!==a&&this._freeVertices(o,a,n),-1!==h&&this._freeIndices(o,h,c),e.setMeshDataFromBuffers(t,r,i),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}tryAddMeshData(e,t){var r=t.vertexBuffer,i=t.indexBuffer,s=P[e.geometryType],a=this._allocateVertices(s,e.vertexCount);if(-1===a)return this._freeVertices(s,a,e.vertexCount),!1;var n=this._allocateIndices(s,e.indexCount);if(-1===n)return this._freeVertices(s,a,e.vertexCount),this._freeIndices(s,n,e.indexCount),!1;var o=this._storageFor(s);if(Object(M.d)(a,n,o.vertexBuffers,o.indexBuffer,e,r,i),e.vertexFrom=a,e.indexFrom=n,this._dirtyMap)for(var l in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,l,a,e.vertexCount);return this._displayList.addToList(e),!0}_allocateVertices(e,t){var r=this._storageFor(e),i=r.vtxFreeList.allocate(t);return-1===i||r.vtxFreeList.fragmentation>.5?-1:i}_freeVertices(e,t,r){this._storageFor(e).vtxFreeList.free(t,r)}_freeIndices(e,t,r){this._storageFor(e).idxFreeList.free(t,r)}_allocateIndices(e,t){var r=this._storageFor(e),i=r.idxFreeList.allocate(t);return-1===i||r.idxFreeList.fragmentation>.5?-1:i}_storageFor(e){return this._freeListsAndStorage[e]}_stridesFor(e,t){return this._strides[e][t]}}var k=L,R=(r(110),r(208),r(325)),N=r(326);r(192);var A=class{constructor(e){this.geometryMap=Object(M.e)((()=>({indexBuffer:R.a.createIndex(e,35044),vao:null})),((t,r)=>({vertexBuffer:R.a.createVertex(e,M.a[r])})))}dispose(){for(var e=0;e<5;e++){var t=this.geometryMap[e];if(t)for(var r in t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose(),t.buffers)t.buffers[r]&&t.buffers[r].data.vertexBuffer.dispose()}}get(e){var t=this.geometryMap[e];return{draw(e,r,i,s,a){if(!t.data.vao){var n={};for(var o in t.buffers)n[o]=t.buffers[o].data.vertexBuffer;t.data.vao=new N.a(e,i,r,n,t.data.indexBuffer)}var l=t.data.vao;e.bindVAO(l),e.drawElements(4,a,5125,Uint32Array.BYTES_PER_ELEMENT*s),e.bindVAO(null)}}}has(e){return null!=this.geometryMap[e]}upload(e,t){t.forEach(((t,r)=>{this._upload(t,r,e)}))}_upload(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){var i=e.vertices;for(var s in i){var a=i[s];a.allDirty?this._uploadVertices(r,t,s):null!=a.from&&null!=a.count&&this._uploadVertices(r,t,s,a.from,a.count)}}}_uploadVertices(e,t,r,i,s){var a=this.geometryMap[t];if(a){var n=e.geometries[t].vertexBuffer[r];if(n){var o=n.stride,l=n.data.buffer;a.buffers[r]&&l.byteLength>0&&(null!=i&&null!=s?a.buffers[r].data.vertexBuffer.setSubData(l,i*o,i*o,(i+s)*o):a.buffers[r].data.vertexBuffer.setData(l))}}}_uploadIndices(e,t,r,i){var s=this.geometryMap[t];if(s){var a=e.geometries[t].indexBuffer.buffer;s.data.indexBuffer&&a.byteLength>0&&(null!=r&&null!=i?s.data.indexBuffer.setSubData(a,4*r,4*r,4*(r+i)):s.data.indexBuffer.setData(a))}}},z=r(554);class D extends z.a{constructor(){super(...arguments),this._data=null,this._displayList=null,this._lastCommitTime=0,this._hasData=!1,this._invalidated=!1,this._wglBuffers=null,this._dirtyMap=new E}destroy(){super.destroy(),this.clear()}get hasData(){return!!this._hasData}get displayObjects(){var e;return null!=(e=this._displayObjects)?e:[]}getGeometry(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}getDisplayList(){return this._displayList}patch(e){if(!0===e.clear)return this.clear(),void(this._hasData=!1);var t=e.addOrUpdate,r=e.remove;!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(),this._dirtyMap=new E,this._dispRecStore=k.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||r.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}commit(e){e.time&&e.time===this._lastCommitTime||(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new A(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}clear(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}_doPatchData(e){this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=k.fromTileData(this._data,this._dirtyMap)),this.requestRender()}_patchData(e){var t=!0,r=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],i=(e.remove||[]).slice();for(var s of r)null!=s.insertAfter&&i.push(s.id);for(var a of i){var n=this._data.tileDisplayData.displayObjectRegistry.get(a);if(n){for(var o of(this._data.tileDisplayData.displayList.removeFromList(n.displayRecords),n.displayRecords))this._dispRecStore.delete(o);this._data.tileDisplayData.displayObjectRegistry.delete(a);var l=this._data.tileDisplayData.displayObjects.indexOf(n);this._data.tileDisplayData.displayObjects.splice(l,1)}}for(var h of r){var c=void 0,u=this._data.tileDisplayData.displayObjectRegistry.get(h.id);if(u){var d=u.displayRecords;u.set(h),u.displayRecords=d;for(var f=u.displayRecords.length,p=0;p<f;++p){var m=u.displayRecords[p],_=h.displayRecords[p];(p>=h.displayRecords.length||m.geometryType!==_.geometryType||m.symbolLevel!==_.symbolLevel||m.zOrder!==_.zOrder||m.materialKey!==_.materialKey)&&(this._dispRecStore.delete(u.displayRecords[p]),p<h.displayRecords.length&&(u.displayRecords[p]=void 0))}u.displayRecords.length=h.displayRecords.length}else{var g=void 0;(u=h.copy()).displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(h.id,u);var v=this._data.tileDisplayData.displayObjects;if(null!=u.insertAfter)if(c={},u.insertAfter>=0){var y=this._data.tileDisplayData.displayObjectRegistry.get(u.insertAfter);y?(g=v.indexOf(y)+1)<v.length?v.splice(g,0,u):(v.push(u),g=v.length):(v.push(u),g=v.length)}else v.unshift(u),g=0;else v.push(u),g=v.length;if(c)for(var x=h.displayRecords.length>0?1:0,b=0,O=g-1;O>=0&&b<x;--O)for(var w=v[O].displayRecords.length-1;w>=0&&b<x;--w){var S=v[O].displayRecords[w],j=this._data.tileDisplayData.displayList.getDPInfoType();c[j]||(c[j]=S,++b)}}for(var M=h.displayRecords.length,T=0;T<M;++T){var E=h.displayRecords[T],C=u.displayRecords[T];C?(C.meshData=E.meshData,C.materialKey=E.materialKey):((C=E.copy()).vertexFrom=void 0,C.indexFrom=void 0,u.displayRecords[T]=C);var I=E.geometryType,P=this._data.tileDisplayData.displayList.getDPInfoType(),L=e.addOrUpdate.tileBufferData.geometries[I],k=L.vertexBuffer,R=L.indexBuffer,N=void 0;c&&(N=c[P]?this._data.tileDisplayData.displayList.splitAfter(c[P]):-1),t=this._dispRecStore.setMeshData(C,E,k,R,N)&&t,c&&null!=C.indexFrom&&null!=C.indexFrom&&(c[P]=C)}}return t}}var F=r(519);var V=class{constructor(){this._byGeometryType=null}get satisfied(){return!this._byGeometryType}reset(){this._byGeometryType=null}verticesFor(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}indicesFor(e){return this._byGeometryType?this._byGeometryType[e].indices:0}needMore(e,t,r){if(t||r){this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);var i=this._byGeometryType[e];i.vertices+=t,i.indices+=r}}};class G{constructor(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}clone(){for(var e=new G,t=0;t<this.geometries.length;t++){var r=this.geometries[t],i=e.geometries[t];for(var s in i.indexBuffer=r.indexBuffer.slice(),i.vertexBuffer={},r.vertexBuffer){var{data:a,stride:n}=r.vertexBuffer[s];i.vertexBuffer[s]={data:a.slice(),stride:n}}}return e}static deserialize(e){for(var t=new G,r=0;r<5;++r)for(var i in t.geometries[r].indexBuffer=new Uint32Array(e.geometries[r].indexBuffer),t.geometries[r].vertexBuffer={},e.geometries[r].vertexBuffer)t.geometries[r].vertexBuffer[i]={data:Object(M.c)(e.geometries[r].vertexBuffer[i].data,e.geometries[r].vertexBuffer[i].stride),stride:e.geometries[r].vertexBuffer[i].stride};return t}serialize(){for(var e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},t=0;t<5;++t)for(var r in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[r]={data:this.geometries[t].vertexBuffer[r].data.buffer,stride:this.geometries[t].vertexBuffer[r].stride};return e}getBuffers(){for(var e=[],t=0;t<5;++t)for(var r in e.push(this.geometries[t].indexBuffer.buffer),this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[r].data.buffer);return e}}var B=G;var U=class{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(e,t,r){for(var i in e)this.vertexData.set(i,e[i]);for(var s in this.vertexData)null===e[s]&&this.vertexData.delete(s);this.vertexCount=t,this.indexData=r}};class W{constructor(e,t,r,i=0,s=0){this.id=e,this.geometryType=t,this.materialKey=r,this.minZoom=i,this.maxZoom=s,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){var e=new W(this.id,this.geometryType,this.materialKey);return e.vertexFrom=this.vertexFrom,e.vertexCount=this.vertexCount,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e.zOrder=this.zOrder,e.symbolLevel=this.symbolLevel,e.meshData=this.meshData,e.minZoom=this.minZoom,e.maxZoom=this.maxZoom,e}setMeshDataFromBuffers(e,t,r){var i=new U;for(var s in t){for(var a=t[s].stride,n=t[s].data,o=[],l=Object(M.p)(a),h=0;h<a*e.vertexCount/l;++h)o[h]=n[h+a*e.vertexFrom/l];i.vertexData.set(s,o)}i.indexData.length=0;for(var c=0;c<e.indexCount;++c)i.indexData[c]=r[c+e.indexFrom]-e.vertexFrom;i.vertexCount=e.vertexCount,this.meshData=i}readMeshDataFromBuffers(e,t){for(var r in this.meshData?this.meshData.clear():this.meshData=new U,e){for(var i=e[r].stride,s=e[r].data,a=[],n=Object(M.p)(i),o=0;o<i*this.vertexCount/n;++o)a[o]=s[o+i*this.vertexFrom/n];this.meshData.vertexData.set(r,a)}this.meshData.indexData.length=0;for(var l=0;l<this.indexCount;++l)this.meshData.indexData[l]=t[l+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(e,t,r,i){for(var s in t)for(var a=t[s].stride,n=this.meshData.vertexData.get(s),o=t[s].data,l=Object(M.p)(a),h=0;h<a*this.meshData.vertexCount/l;++h)o[h+a*e/l]=n[h];for(var c=0;c<this.meshData.indexData.length;++c)i[c+r]=this.meshData.indexData[c]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(e,t,r){var i=0,s=0;for(var a of e)a.writeMeshDataToBuffers(i,t,s,r),i+=a.vertexCount,s+=a.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}static deserialize(e,t){var r=e.readInt32(),i=e.readInt32(),s=new W(t.id,r,i);return s.vertexFrom=e.readInt32(),s.vertexCount=e.readInt32(),s.indexFrom=e.readInt32(),s.indexCount=e.readInt32(),s.minZoom=e.readInt32(),s.maxZoom=e.readInt32(),s}}var q=W;function H(e,t){if(null!==t){for(var r of(e.push(t.length),t))r.serialize(e);return e}e.push(0)}class X{constructor(e){this.insertAfter=null,this.id=e,this.displayRecords=[]}copy(){var e=new X(this.id);return e.set(this),e}clone(){var e=new X(this.id);return e.displayRecords=this.displayRecords.map((e=>e.clone())),e.insertAfter=this.insertAfter,e}set(e){this.id=e.id,this.displayRecords=e.displayRecords,this.insertAfter=e.insertAfter}serialize(e){return e.push(this.id),H(e,this.displayRecords),e}static deserialize(e){var t=e.readInt32(),r=new X(t),i={id:t};return r.displayRecords=function(e,t,r){for(var i=e.readInt32(),s=new Array(i),a=0;a<s.length;a++)s[a]=t.deserialize(e,r);return s}(e,q,i),r}}var Y=X,K=r(127);function Z(e,t,r,...i){t<e.length?e.splice(t,r,...i):e.push(...i)}var J=new Map;J.set(K.c.MAP,[K.d.FILL,K.d.LINE,K.d.MARKER,K.d.TEXT]),J.set(K.c.LABEL,[K.d.LABEL]),J.set(K.c.LABEL_ALPHA,[K.d.LABEL]);class Q{constructor(){this.symbolLevels=[]}replay(e,t,r){for(var i of this.symbolLevels)for(var s of i.zLevels){var a=s.geometryDPInfo.unified;if(a){var n=function(i){var s=e.painter.getGeometryBrush(i.geometryType),a=t.getGeometry(i.geometryType),n={geometryType:i.geometryType,materialKey:i.materialKey,indexFrom:i.indexFrom,indexCount:i.indexCount,draw:(e,t,r)=>{a.draw(e,t,r,i.indexFrom,i.indexCount)}};s.prepareState(e,t),s.drawGeometry(e,t,n,r)};for(var o of a)n(o)}}}get empty(){return!this.symbolLevels||0===this.symbolLevels.length}clear(){this.symbolLevels.length=0}addToList(e,t){if(Array.isArray(e))for(var r of e)this._addToList(r,t);else this._addToList(e,t)}removeFromList(e){Array.isArray(e)||(e=[e]);var t=null;for(var r of e)t=this._removeFromList(r);return t}clone(){var e=new Q;for(var t of this.symbolLevels)e.symbolLevels.push(t.clone());return e}splitAfter(e){for(var t=this._getDisplayList(e.symbolLevel,e.zOrder),r=t.length,i=e.indexFrom+e.indexCount,s=0;s<r;++s){var a=t[s];if(a.geometryType===e.geometryType&&i>a.indexFrom&&i<=a.indexFrom+a.indexCount){if(i<a.indexFrom+a.indexCount){var n=new $;n.geometryType=a.geometryType,n.materialKey=a.materialKey,n.indexFrom=i,n.indexCount=a.indexFrom+a.indexCount-i,t.splice(s+1,0,n),a.indexCount=i-a.indexFrom}return s}}}_addToList(e,t){var r=e.symbolLevel,i=e.zOrder,s=this._getDisplayList(r,i),a=null!=t?t:s.length-1,n=a>=0&&a<s.length?s[a]:null;if(null!==n&&n.materialKey===e.materialKey&&n.indexFrom+n.indexCount===e.indexFrom&&n.geometryType===e.geometryType)n.indexCount+=e.indexCount;else{var o=new $;o.indexFrom=e.indexFrom,o.indexCount=e.indexCount,o.materialKey=e.materialKey,o.geometryType=e.geometryType,Z(s,a+1,0,o)}}_removeFromList(e){for(var t,r=e.symbolLevel,i=e.zOrder,s=this._getDisplayList(r,i),a=s.length,n=0;n<a;++n){var o=s[n];if(e.indexFrom+e.indexCount>o.indexFrom&&e.indexFrom<o.indexFrom+o.indexCount&&o.geometryType===e.geometryType){t=n;break}}if(void 0!==t){var l=s[t];if(e.indexFrom===l.indexFrom)return l.indexCount-=e.indexCount,l.indexFrom+=e.indexCount,0===l.indexCount&&Z(s,t,1),t-1;if(e.indexFrom+e.indexCount===l.indexFrom+l.indexCount)return l.indexCount-=e.indexCount,0===l.indexCount?(Z(s,t,1),t-1):t;var h=l.indexFrom,c=e.indexFrom-l.indexFrom,u=e.indexCount,d=l.indexFrom+l.indexCount-(e.indexFrom+e.indexCount);l.indexCount=c;var f=new $;return f.geometryType=l.geometryType,f.materialKey=l.materialKey,f.indexFrom=h+c+u,f.indexCount=d,Z(s,t+1,0,f),t}return null}_getDisplayList(e,t){for(var r,i,s=this.symbolLevels.length,a=0;a<s;a++)if(this.symbolLevels[a].symbolLevel===e){r=this.symbolLevels[a];break}r||((r=new re).symbolLevel=e,this.symbolLevels.push(r));for(var n=r.zLevels.length,o=0;o<n;o++)if(r.zLevels[o].zLevel===t){i=r.zLevels[o];break}return i||((i=new te).geometryDPInfo=new ee,i.zLevel=t,r.zLevels.push(i)),i.geometryDPInfo.unified||(i.geometryDPInfo.unified=[]),i.geometryDPInfo.unified}getDPInfoType(){return"unified"}}class ${constructor(){this.materialKey=null,this.indexFrom=0,this.indexCount=0}clone(){var e=new $;return e.geometryType=this.geometryType,e.materialKey=this.materialKey,e.indexFrom=this.indexFrom,e.indexCount=this.indexCount,e}}class ee{constructor(){this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}clone(){var e=new ee;return e.fill=this.fill&&this.fill.map((e=>e.clone())),e.line=this.line&&this.line.map((e=>e.clone())),e.marker=this.marker&&this.marker.map((e=>e.clone())),e.text=this.text&&this.text.map((e=>e.clone())),e.label=this.label&&this.label.map((e=>e.clone())),e.unified=this.unified&&this.unified.map((e=>e.clone())),e}}class te{constructor(){this.geometryDPInfo=new ee}clone(){var e=new te;return e.zLevel=this.zLevel,e.geometryDPInfo=this.geometryDPInfo.clone(),e}}class re{constructor(){this.zLevels=[]}clone(){var e=new re;for(var t of(e.symbolLevel=this.symbolLevel,this.zLevels))e.zLevels.push(t.clone());return e}}var ie=Q;class se{constructor(){}get displayObjectRegistry(){if(!this._displayObjectRegistry)for(var e of(this._displayObjectRegistry=new Map,this.displayObjects))this._displayObjectRegistry.set(e.id,e);return this._displayObjectRegistry}get displayList(){return this._displayList}computeDisplayList(){for(var e of(this._displayList=new ie,this.displayObjects))for(var t of e.displayRecords)this._displayList.addToList(t)}clone(){var e=new se;return this.displayObjects&&(e.displayObjects=this.displayObjects.map((e=>e.clone()))),e}serialize(e){return H(e,this.displayObjects),e}_deserializeObjects(e){for(var t=e.readInt32(),r=new Array(t),i=new Map,s=0;s<r.length;++s){var a=Y.deserialize(e);r[s]=a,i.set(a.id,a)}this.displayObjects=r,this._displayList=null,this._displayObjectRegistry=i}static deserialize(e){var t=new se;return t._deserializeObjects(e),t}}var ae=se;class ne{constructor(e,t){this.data=e,this.stride=t}static decode(e){var t=Object(M.c)(e.data,e.stride),r=e.stride;return new ne(t,r)}static fromVertexVector(e){var t=Object(M.c)(e.data.buffer(),e.stride),r=e.stride;return new ne(t,r)}}class oe{constructor(e,t,r){this.geometryType=e,this.indexBuffer=new Uint32Array(t),this.namedBuffers=r}static decode(e){var t=e.geometryType,r=e.indexBuffer,i={};for(var s in e.namedBuffers)i[s]=ne.decode(e.namedBuffers[s]);return new oe(t,r,i)}static fromVertexData(e,t){var r=e.indices,i=Object(M.c)(e.vertices,e.stride),s=e.stride,a={geometry:new ne(i,s)};return new oe(t,r,a)}static fromVertexVectors(e){var t=e.geometryType,r=e.indexVector.buffer(),i={};for(var s in e.namedVectors)i[s]=ne.fromVertexVector(e.namedVectors[s]);return new oe(t,r,i)}}var le=r(381);class he{constructor(e,t){this.data=e,this.stride=t}get vertexCount(){var e=this.stride/4,t=this.data.length/e;return t!==(0|t)&&console.debug("Corrupted stride"),t}transfer(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}class ce{constructor(e,t,r=!1){this.geometryType=e,this.indexVector=new le.a(Uint32Array,6*t),this.namedVectors={};var i=Object(M.l)(e,r);for(var s in i){var a=i[s],n=void 0;switch(a%4){case 0:case 2:n=new le.a(Uint32Array,a*t);break;case 1:case 3:n=new le.a(Uint8Array,a*t)}this.namedVectors[s]=new he(n,a)}}get(e){return this.namedVectors[e].data}getVector(e){return this.namedVectors[e]}transfer(e,t){var r=this.indexVector.buffer(),i={};for(var s in t.push(r),this.namedVectors){var a=this.namedVectors[s];i[s]={},a.transfer(i[s],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()}intoBuffers(){var e=oe.fromVertexVectors(this);return this.destroy(),e}destroy(){this.indexVector=null,this.namedVectors=null}}var ue=new V,de=new V;function fe(e,t){var r={};for(var i in e){var s={data:Object(M.b)(t,e[i]),stride:e[i]};r[i]=s}return r}class pe{constructor(){this.tileDisplayData=null,this.tileBufferData=null}reshuffle(){ue.reset();var e=function(e){var t=[[],[],[],[],[]],r=e;for(var i of r)for(var s of i.displayRecords)t[s.geometryType].push(s);return t}(this.tileDisplayData.displayObjects);for(var t of e)for(var r of t)r&&ue.needMore(r.geometryType,r.meshData?r.meshData.vertexCount:r.vertexCount,r.meshData?r.meshData.indexData.length:r.indexCount);for(var i=e.length,s=new B,a=0;a<i;++a){s.geometries[a].indexBuffer=new Uint32Array(Math.round(1.5*ue.indicesFor(a)));var n=[];for(var o in this.tileBufferData.geometries[a].vertexBuffer)n.push(this.tileBufferData.geometries[a].vertexBuffer[o].stride);var l=pe._computeVertexAlignment(n),h=Math.round(1.5*ue.verticesFor(a)),c=pe._align(h,l);for(var u in this.tileBufferData.geometries[a].vertexBuffer){var d=this.tileBufferData.geometries[a].vertexBuffer[u].stride;s.geometries[a].vertexBuffer[u]={stride:d,data:Object(M.b)(c,d)}}}de.reset(),this.tileDisplayData.displayList.clear();for(var f=0;f<i;++f){var p=e[f];for(var m of p){if(m.meshData)m.writeMeshDataToBuffers(de.verticesFor(f),s.geometries[f].vertexBuffer,de.indicesFor(f),s.geometries[f].indexBuffer),m.meshData=null;else{var _=this.tileBufferData.geometries[f].vertexBuffer,g=this.tileBufferData.geometries[f].indexBuffer,v=s.geometries[f].vertexBuffer,y=s.geometries[f].indexBuffer,x=de.verticesFor(f),b=de.indicesFor(f);Object(M.d)(x,b,v,y,m,_,g),m.vertexFrom=x,m.indexFrom=b}de.needMore(f,m.vertexCount,m.indexCount)}}for(var O of this.tileDisplayData.displayObjects)this.tileDisplayData.displayList.addToList(O.displayRecords);this.tileBufferData=s}getStrides(){for(var e=[],t=0;t<this.tileBufferData.geometries.length;++t){var r=this.tileBufferData.geometries[t];for(var i in e[t]={},r.vertexBuffer)e[t][i]=r.vertexBuffer[i].stride}return e}clone(){var e=new pe;return e.tileBufferData=this.tileBufferData.clone(),e.tileDisplayData=this.tileDisplayData.clone(),e}_guessSize(){for(var{displayObjects:e}=this.tileDisplayData,t=Math.min(e.length,4),r=0,i=0;i<t;i++)r=Math.max(r,e[i].displayRecords.length);return 2*(12*e.length+e.length*r*40)}serialize(){var e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new le.a(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}static fromVertexData(e){var t=[],r={},i=new Map;return Object(M.g)((s=>{var a=e.data[s];if(Object(n.k)(a)){for(var o=F.a.from(a.records).getCursor();o.next();){var l=o.id,h=o.materialKey,c=o.insertAfter,u=o.indexFrom,d=o.indexCount,f=o.vertexFrom,p=o.vertexCount;if(!i.has(l)){var m=new Y(l);m.insertAfter=c,i.set(l,m),t.push(m)}var _=i.get(l),g=new q(l,s,h);g.indexFrom=u,g.indexCount=d,g.vertexFrom=f,g.vertexCount=p,_.displayRecords.push(g)}r[s]=oe.fromVertexData(a,s)}else r[s]=new ce(s,0).intoBuffers()})),t.sort(((e,t)=>e.id-t.id)),pe.fromMeshData({displayObjects:t,vertexBuffersMap:r})}static fromMeshData(e){var t=new pe,r=new ae,i=new B;for(var s in r.displayObjects=e.displayObjects,e.vertexBuffersMap){var a=e.vertexBuffersMap[s];i.geometries[s].indexBuffer=a.indexBuffer,i.geometries[s].vertexBuffer=a.namedBuffers}return t.tileDisplayData=r,t.tileBufferData=i,t}static bind(e,t){var r=new pe;return r.tileDisplayData=e,r.tileBufferData=t,r}static create(e,t){var r=new pe;r.tileDisplayData=new ae,r.tileDisplayData.displayObjects=e;var i=[0,0,0,0,0],s=[0,0,0,0,0],a=[[],[],[],[],[]];for(var n of e)for(var o of n.displayRecords)a[o.geometryType].push(o),i[o.geometryType]+=o.meshData.vertexCount,s[o.geometryType]+=o.meshData.indexData.length;for(var l=new B,h=function(e){return[e.fill||{},e.line||{},e.icon||{},e.text||{},e.label||{}]}(t),c=0;c<5;c++){var u=new Uint32Array(s[c]),d=fe(h[c],i[c]);q.writeAllMeshDataToBuffers(a[c],d,u),l.geometries[c]={indexBuffer:u,vertexBuffer:d}}return r.tileBufferData=l,r}static _align(e,t){var r=e%t;return 0===r?e:e+(t-r)}static _computeVertexAlignment(e){var t=!1,r=!1;for(var i of e)i%4==2?t=!0:i%4!=0&&(r=!0);return r?4:t?2:1}}var me=r(366),_e=r(561),ge=r(337),ve=r(360),ye=r(562),xe=r(452),be=r(557),Oe=r(563),we=r(168),Se=r(407),je=r(496);class Me extends je.a{constructor(e,t){super(e,t,null)}static from(e){var t=Se.a.createInstance(),r=[],i=e.filter((e=>!!e.geometry));for(var s of i){var a=Object(m.c)(s.geometry);Object(we.e)(r,[s],a,!1,!1,"uid")}return new Me(t,r)}get geometryType(){var e=this._current;return e?e.geometryType:null}get insertAfter(){return this._current.insertAfter}readGraphic(){return this._current}getCursor(){return this.copy()}copy(){var e=new Me(this.instance,this._features);return this.copyInto(e),e}}var Te=r(555),Ee=r(91),Ce=r(309),Ie=r(371),Pe=r(117),Le=r(243),ke=r(236),Re=r(420),Ne=r(411),Ae=r(178),ze=r(311),De=new Ae.a,Fe=new Ae.a,Ve="esriGeometryPolyline";function Ge(e){e.coords.length=0,e.lengths.length=0}class Be{constructor(){this.bounds=Object(g.i)(),this.graphic=null,this.size=[0,0,0,0]}static acquire(e=null,t,r,i,s,a){var n;return 0===Be._pool.length?n=new Be:(n=Be._pool.pop(),this._set.delete(n)),n.acquire(e,t,r,i,s,a),n}static release(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}static getCentroidQuantized(e,t){if(Object(m.g)(e.geometry)){var r=e.symbol;if(Object(n.j)(r))return null;if(Object(ge.j)(r.type)||Object(ge.l)(r.type)){var i=Object(Ne.a)(e.geometry);return Object(ze.b)(t,{},{x:i[0],y:i[1]},!1,!1)}}return null}acquire(e=null,t,r,i,s,a){e&&this.set(e,t,r,i,s,a)}release(){this.graphic=null,this.symbolResource=null,this.geometry=null}get symbol(){return this.symbolResource.symbol}set(e,t,r,i,s,a){this.graphic=e,this.geometry=r,this.symbolResource=t,this.updateBounds(i,s,a)}updateBounds(e,t,r){Object(ge.c)(this.bounds,this.size,this.symbolResource,this.geometry,e,t,r)}getGeometryQuantized(e){if(Object(m.g)(this.geometry)){var t=this.geometry.rings;if(1===t.length&&2===t[0].length)return Object(ze.a)(e,{paths:[[t[0][0],t[0][1]]]})}else if(Object(m.h)(this.geometry))return Ge(De),Ge(Fe),Object(we.h)(De,this.geometry),Object(we.q)(Fe,De,this.geometry.hasZ,this.geometry.hasM,Ve,e.scale[0]),Object(we.u)(De,Fe,this.geometry.hasZ,this.geometry.hasM,Ve,e),Object(we.o)(De,this.geometry.hasZ,this.geometry.hasM);return Object(ze.a)(e,this.geometry)}}Be._pool=[],Be._set=new Set;var Ue=Be,We={minX:0,minY:0,maxX:0,maxY:0},qe=Object(g.i)(),He=[],Xe=1e-5;function Ye(e,t,r,i,s){return We.minX=t,We.minY=r,We.maxX=i,We.maxY=s,e.search(We)}var Ke=class{constructor(e,t,r,i,s,n){this._graphics=i,this._onAdd=s,this._onRemove=n,this._index=Object(Re.a)(9,Object(a.a)("csp-restrictions")?e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}):[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new Map,this._currentLevel=-1/0,this._tileInfoView=e,this._uidFieldName=r;var o=e.getClosestInfoForScale(t);o&&(this._currentLevel=o.level,this._resolution=this._tileInfoView.getTileResolution(o.level));var l=e.spatialReference;this._metersPerUnit=Object(u.i)(l)?Object(Pe.e)(e.spatialReference):1}hitTest(e,t,r,i,s){e=Object(ke.b)(e,this._tileInfoView.spatialReference);var a=.5*i*r;qe[0]=e-a,qe[1]=t-a,qe[2]=e+a,qe[3]=t+a;var n=.5*i*(r+ge.a),o=Ye(this._index,e-n,t-n,e+n,t+n);if(!o||0===o.length)return[];var l,h={x:e,y:t},c=[];for(var u of o)if(u.graphic.visible)switch(Object(m.c)(u.geometry)){case"esriGeometryPoint":var d=u.symbol;if(!d)continue;var f=u.geometry,{x:p,y:v}=f,y=i*this._metersPerUnit,x=void 0;switch(d.type){case"esriTS":x=Object(ge.f)(p,v,d,u.size,i,s);break;case"expanded-cim":x=Object(ge.d)(p,v,d,i,y,s);break;case"esriSMS":case"esriPMS":x=Object(ge.e)(p,v,d,i,y,s)}Object(Ce.g)(x,h)&&c.push(u);break;case"esriGeometryPolyline":var b=u.symbol;if(!b||!b.layers.length)continue;var O=b.layers[0];l=1.5*i*window.devicePixelRatio*Object(_.h)(O.width),Object(ge.k)(u.geometry,e,t,l)&&c.push(u);break;case"esriGeometryEnvelope":var w=u.geometry,S=Object(g.n)(w.xmin,w.ymin,w.xmax,w.ymax);Object(g.p)(S,qe)&&c.push(u);break;case"esriGeometryPolygon":if(Object(Ce.g)(u.geometry,h)){c.push(u);break}var j=Object(Ie.b)(u.geometry);if(Math.abs(j.ymax-j.ymin)<5*i||Math.abs(j.xmax-j.xmin)<5*i){var M=Object(g.n)(j.xmin,j.ymin,j.xmax,j.ymax);Object(g.p)(M,qe)&&c.push(u)}break;case"esriGeometryMultipoint":var T=u.symbol;if(!T)continue;for(var E=u.geometry.points,C=void 0,I=0;I<E.length;I++)if(C="esriTS"===T.type?Object(ge.f)(E[I][0],E[I][1],T,u.size,i,s):Object(ge.e)(E[I][0],E[I][1],T,i,i*this._metersPerUnit,s),Object(Ce.g)(C,h)){c.push(u);break}}return c.sort(((e,t)=>{var r=Object(ge.h)(e.graphic),i=Object(ge.h)(t.graphic);return r===i?t.zorder-e.zorder:r-i})),c.map((e=>e.graphic))}getGraphicsData(e,t,r){var i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort(((e,t)=>e.zorder-t.zorder)),i[0].insertAfter=-1;for(var s=1;s<i.length;s++)i[s].insertAfter=i[s-1].graphic.uid;i.sort(((e,t)=>e.graphic.uid-t.graphic.uid)),r.sort(((e,t)=>e.uid-t.uid));var a,n=0,o=0,l=[],h={originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]};for(var c of r){for(o=-2;n<i.length;)if(a=i[n],n++,c.uid===a.graphic.uid){o=a.insertAfter;break}if(a.geometry&&-2!==o){var u=a.getGeometryQuantized(h),d=Object(Ee.a)({},a.graphic.attributes);d[this._uidFieldName]=c.uid,null==a.groupId&&(a.groupId=e.createTemplateGroup(a.symbol,null)),l.push({centroid:Ue.getCentroidQuantized(a,h),geometry:u,attributes:d,symbol:a.symbol,groupId:a.groupId,insertAfter:o,zorder:a.zorder})}}return l.sort(((e,t)=>e.zorder-t.zorder)),l}queryTileData(e,t){var{bounds:r,resolution:i}=t,s=this._searchForItems(t),a=[];return this._createTileGraphics(a,e,s,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]}),a}has(e){return this._itemByGraphic.has(e)}getBounds(e){return this._itemByGraphic.has(e)?this._itemByGraphic.get(e).bounds:null}addOrModify(e,t,r){if(e){this.has(e)&&this.remove(e),this._onAdd(e);var i=Ue.acquire(e,t,r,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference);return this._itemByGraphic.set(e,i),r&&this._index.insert(i),i.bounds}}remove(e){if(this._itemByGraphic.has(e)){this._onRemove(e);var t=this._itemByGraphic.get(e);this._index.remove(t),this._itemByGraphic.delete(e)}}updateZ(){for(var e,t,r=this._graphics.items,i=0;i<r.length;i++)t=r[i],(e=this._itemByGraphic.get(t))&&(e.zorder=i)}update(e,t,r){var i=this._itemByGraphic.get(e);i.groupId=null;var s=Object(g.c)(i.bounds);return i.size[0]=i.size[1]=0,this._index.remove(i),i.set(e,t,r,this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),r&&this._index.insert(i),{oldBounds:s,newBounds:i.bounds}}updateLevel(e){if(this._currentLevel!==e){this._currentLevel=e;var t=this._tileInfoView.getTileResolution(e);this._resolution=t,this._index.clear(),He.length=0,this._itemByGraphic.forEach((e=>{e.updateBounds(this._resolution,this._resolution*this._metersPerUnit,this._tileInfoView.spatialReference),e.geometry&&He.push(e)})),this._index.load(He)}}clear(){this._itemByGraphic.clear(),this._index.clear()}_createTileGraphics(e,t,r,i){var s,a,n,o,l=this._uidFieldName;r.sort(((e,t)=>e.zorder-t.zorder));for(var h=0;h<r.length;h++){s=(n=r[h]).graphic,a=n.getGeometryQuantized(i),o=0===h?-1:r[h-1].graphic.uid;var c=Object(Ee.a)({},n.graphic.attributes);c[l]=s.uid,null==n.groupId&&(n.groupId=t.createTemplateGroup(n.symbol,null)),e.push({centroid:Ue.getCentroidQuantized(n,i),geometry:a,attributes:c,symbol:n.symbol,groupId:n.groupId,insertAfter:o,zorder:n.zorder})}}_searchForItems(e){var t=this._tileInfoView.spatialReference,r=e.bounds;if(t.isWrappable){var[i,s]=Object(Le.c)(t),a=Math.abs(r[2]-s)<Xe,n=Math.abs(r[0]-i)<Xe;if((!a||!n)&&(a||n)){var o,l=e.resolution;o=Object(g.i)(a?[i,r[1],i+l*ge.a,r[3]]:[s-l*ge.a,r[1],s,r[3]]);var h=Ye(this._index,r[0],r[1],r[2],r[3]),c=Ye(this._index,o[0],o[1],o[2],o[3]);return[...new Set([...h,...c])]}}return Ye(this._index,r[0],r[1],r[2],r[3])}},Ze=r(266),Je=e=>{var t=class extends(Object(Ze.a)(e)){constructor(){super(...arguments),this.graphics=null,this.renderer=null,this.view=null}};return Object(s.a)([Object(o.b)()],t.prototype,"graphics",void 0),Object(s.a)([Object(o.b)()],t.prototype,"renderer",void 0),Object(s.a)([Object(o.b)()],t.prototype,"updating",void 0),Object(s.a)([Object(o.b)()],t.prototype,"view",void 0),t=Object(s.a)([Object(l.a)("esri.views.layers.GraphicsView")],t)};function Qe(e,t,r){if(r.has(e))return r.get(e);var i={tile:t,addedOrModified:[],removed:[]};return r.set(e,i),i}var $e=class extends(Je(Object(y.b)(c.a))){constructor(e){super(e),this._storage=new Oe.a,this._displayIds=new Map,this._tiles=new Map,this._graphicStoreUpdate=!1,this._graphicsSet=new Set,this._matcher=Promise.resolve(null),this._tileUpdateSet=new Set,this._tilesToUpdate=new Map,this._graphicIdToAbortController=new Map,this._attached=!1,this._highlightIds=new Map,this._updatingGraphicsTimer=null,this._hashToExpandedSymbol=new Map,this._hashTpExpandedSymbolPromise=new Map,this._processing=!1,this._needsProcessing=!1,this._pendingUpdate={added:new Set,updated:new Set,removed:new Set},this.lastUpdateId=-1,this.updateRequested=!1,this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}_createMatcher(e,t){if(e){var r=Object(ve.a)({indexCount:0,fields:{}},"feature",e);this._matcher=Object(ye.a)(r,t,null)}}_createDisplayId(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}initialize(){this._tileStore=new Te.a(this.view.featuresTilingScheme),this._attributeStore=new me.a({type:"local",initialize:e=>Promise.resolve(this.container.attributeView.initialize(e)),update:e=>this.container.attributeView.requestUpdate(e),render:()=>this.container.requestRender()},Object(b.a)());this._graphicStore=new Ke(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(e=>{this._createDisplayId(e.uid),this._setFilterState(e.uid,e.visible)}),(e=>{var t=this._displayIds.get(e.uid);this._displayIds.delete(e.uid),this._storage.releaseDisplayId(t)}));var e=new xe.a(this.container.getMaterialItems.bind(this.container),!0);this._createMatcher(this.renderer,e),this._meshFactory=new be.a(null,this.uid,e),this._templateStore=e,this.watch("renderer",(t=>{for(var r of(this._createMatcher(t,e),this.graphics))this._pendingUpdate.updated.add(r);this.requestUpdate()})),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",(()=>{this.graphics.items.length>0&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]}),this.handles.add(this.graphics.on("change",(e=>this._graphicsChangeHandler(e))),"graphics"),this._attached=!0,this.notifyChange("updating")}))}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null}get updating(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}hitTest(e,t){if(!this.view||!this.view.position)return Promise.resolve(null);var r=this.view.toMap(Object(_.f)(e,t));return this.searchFeatures(r).then((e=>e&&e.length?e[0]:null))}searchFeatures(e,t=2){var r=this;return Object(i.a)((function*(){return r._graphicStore.hitTest(e.x,e.y,t,r.view.state.resolution,r.view.state.rotation)}))()}update(e){var t=e.state,r=this.view.featuresTilingScheme.getClosestInfoForScale(t.scale).level;if(this._graphicStore.updateLevel(r),this._tileStore.setViewState(t),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}graphicUpdateHandler(e){var{graphic:t,property:r,newValue:i}=e;switch(r){case"attributes":break;case"geometry":case"symbol":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case"visible":this._setFilterState(t.uid,i),this._attributeStore.sendUpdates()}}addHighlight(e){for(var t of e)if(this._highlightIds.has(t)){var r=this._highlightIds.get(t);this._highlightIds.set(t,r+1)}else this._highlightIds.set(t,1);this._updateHighlight()}removeHighlight(e){for(var t of e)if(this._highlightIds.has(t)){var r=this._highlightIds.get(t)-1;0===r?this._highlightIds.delete(t):this._highlightIds.set(t,r)}this._updateHighlight()}_updateHighlight(){var e=Array.from(this._highlightIds.keys()),t=e.map((e=>this._displayIds.get(e)));this._attributeStore.setHighlight(e,t)}_getIntersectingTiles(e){var t=this._graphicStore.getBounds(e);if(!t||0===Object(g.s)(t)||0===Object(g.o)(t))return[];var r=Object(ge.i)(t,this.view.spatialReference);return Object(n.k)(r)?[...this._tileStore.boundsIntersections(r[0]),...this._tileStore.boundsIntersections(r[1])]:this._tileStore.boundsIntersections(t)}_updateTile(e){var t=this;return Object(i.a)((function*(){var r=e.tile,i=t._getGraphicsData(t._templateStore,r,e.addedOrModified),s=yield t._processGraphics(r,i);return t._patchTile(r.key,{type:"update",addOrUpdate:s,remove:e.removed,end:!0,clear:!1}),s}))()}_patchTile(e,t){if(this._tiles.has(e)){var r=this._tiles.get(e);this.container.onTileData(r,t),this.container.requestRender()}}_graphicsChangeHandler(e){for(var t of e.added)this._pendingUpdate.added.add(t);for(var r of e.moved)this._pendingUpdate.added.add(r);for(var i of e.removed)this._pendingUpdate.added.has(i)?this._pendingUpdate.added.delete(i):this._pendingUpdate.removed.add(i);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getGraphicsToUpdate(){var e={added:[],removed:[],updated:[]};if(!this.graphics)return e;var t=this._pendingUpdate;for(var r of this.graphics.items)t.added.has(r)?e.added.push(r):t.updated.has(r)&&e.updated.push(r);for(var i of t.removed)this._graphicStore.has(i)&&e.removed.push(i);return t.added.clear(),t.removed.clear(),t.updated.clear(),e}_updateGraphics(){var e=this;return Object(i.a)((function*(){e._processing=!0;var{added:t,removed:r,updated:i}=e._getGraphicsToUpdate(),s=e._tilesToUpdate;try{if(!e._graphicStoreUpdate){var a=e.view.state,n=e.view.featuresTilingScheme.getClosestInfoForScale(a.scale).level;e._graphicStore.updateLevel(n),e._tileStore.setViewState(a)}for(var o=[],l=new Array(t.length+r.length),h=0;h<i.length;h++){var c=i[h],u=e._getIntersectingTiles(c);for(var d of u)Qe(d.id,d,s).removed.push(e._displayIds.get(c.uid));o.push(e._updateGraphic(c,null)),l[h]=c}for(var f,p=i.length,m=0;m<t.length;m++){var _=t[m];l[p+m]=_,e._graphicsSet.add(_),o.push(e._addGraphic(_))}for(var g of r){e._abortProcessingGraphic(g.uid);var v=e._getIntersectingTiles(g);for(var y of v)Qe(y.id,y,s).removed.push(e._displayIds.get(g.uid));e._graphicsSet.delete(g),e._graphicStore.remove(g)}e._flipUpdatingGraphics(),yield Promise.all(o);for(var x=0;x<l.length;x++){f=l[x];var b=e._getIntersectingTiles(f);for(var O of b)Qe(O.id,O,s).addedOrModified.push(f)}e._graphicStore.updateZ();var w=[];for(var[S,j]of s)w.push(e._updateTile(j));yield Promise.all(w)}catch(E){}for(var M of r){var T=yield e._getSymbolForGraphic(M,{});T&&e._hashToExpandedSymbol.delete(T.hash())}s.clear(),e.notifyChange("updating"),e._processing=!1,e._needsProcessing&&(e._needsProcessing=!1,e._updateGraphics())}))()}_getArcadeInfo(e){var t=(e.attributes?Object.keys(e.attributes):[]).map((t=>({name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"})));return Object(n.j)(e.geometry)?null:{geometryType:Object(m.c)(e.geometry),spatialReference:d.a.fromJSON(e.geometry.spatialReference),fields:t}}_getSymbolForGraphic(e,t){var r=this;return Object(i.a)((function*(){return Object(n.k)(e.symbol)?e.symbol:Object(n.k)(r.renderer)?r.renderer.getSymbolAsync(e,{scale:r.view.scale,abortOptions:t}):r._getNullSymbol(e)}))()}_getSymbolResources(e,t){var r=this;return Object(i.a)((function*(){if(!r.container.stage)return Promise.resolve(null);var i=yield r._getSymbolForGraphic(e,t),s=i.hash(),a=r._hashToExpandedSymbol.get(s);if(!a){var n=r._hashTpExpandedSymbolPromise.get(s);if(n)a=yield n;else{var o=r._getArcadeInfo(e),l=Object(ve.c)(i);n=Object(S.a)(l,o,t),r._hashTpExpandedSymbolPromise.set(s,n);try{a=yield n,r._hashTpExpandedSymbolPromise.delete(s),r._hashToExpandedSymbol.set(s,a)}catch(m){r._hashTpExpandedSymbolPromise.delete(s),Object(h.u)(m)}}}if("esriTS"===a.type){for(var c=[],[u]=Object(w.a)(a.text),d=0;d<u.length;d++)c.push(u.charCodeAt(d));var f={symbol:a,id:0,glyphIds:c},[{mosaicItem:p}]=yield r.container.getMaterialItems([f]);return{symbol:a,mosaicItem:p}}return{symbol:a,mosaicItem:null}}))()}_projectAndNormalizeGeometry(e,t){var r=this;return Object(i.a)((function*(){if(Object(n.j)(e.geometry)||"mesh"===e.geometry.type)return Promise.resolve(null);var i=e.geometry;if(Object(m.g)(i)){var s=i.rings;i.rings=s}else if(Object(m.h)(i)){var a=i.paths;i.paths=a}else if(Object(m.d)(i)){var o=yield r._getSymbolForGraphic(e,t);i=Object(ge.j)(o.type)||Object(ge.l)(o.type)?i.center:p.a.fromExtent(i)}yield Object(j.a)(i.spatialReference,r.view.spatialReference);var l=Object(O.a)(i),h=Object(j.b)(l,i.spatialReference,r.view.spatialReference);return Object(f.a)(h),h}))()}_onTileUpdate(e){var t=Object(u.d)(this.view.spatialReference);if(e.added&&e.added.length>0)for(var r of e.added)this._addNewTile(r,t);if(e.removed&&e.removed.length>0)for(var i of e.removed)this._removeTile(i.key)}_addGraphic(e){var t=this;return Object(i.a)((function*(){t._abortProcessingGraphic(e.uid);var r=Object(h.d)();t._graphicIdToAbortController.set(e.uid,r);var i={signal:r.signal};try{yield t._addOrUpdateGraphic(e,i),t._graphicIdToAbortController.delete(e.uid)}catch(s){if(t._graphicIdToAbortController.delete(e.uid),!Object(h.m)(s))throw s}}))()}_updateGraphic(e,t){var r=this;return Object(i.a)((function*(){var i=r._projectAndNormalizeGeometry(e,t),s=r._getSymbolResources(e,t),[a,n]=yield Promise.all([i,s]);r._graphicStore.addOrModify(e,n,a)}))()}_addOrUpdateGraphic(e,t){var r=this;return Object(i.a)((function*(){var i=r._projectAndNormalizeGeometry(e,t),s=r._getSymbolResources(e,t);try{var[a,n]=yield Promise.all([i,s]);r._addProjectedGraphic(e,n,a)}catch(o){if(!Object(h.m)(o))throw o}}))()}_addProjectedGraphic(e,t,r){this._graphicsSet.has(e)&&this._graphicStore.addOrModify(e,t,r)}_addTile(e){var t=this.view.featuresTilingScheme.getTileBounds(Object(g.i)(),e),r=new D(e,t);return this._tiles.set(e,r),this.container.addChild(r),r}_addNewTile(e,t){var r=this._addTile(e.key),i=this._graphicStore.queryTileData(this._templateStore,e);if(t){var s=Math.round((t.valid[1]-t.valid[0])/e.resolution);for(var a of i)a.geometry&&(Object(m.f)(a.geometry)||Object(m.e)(a.geometry))&&this._wrapPoints(a,s)}var n=e.key;this._tileUpdateSet.add(e.key),this.notifyChange("updating"),this._processGraphics(e,i).then((e=>{var t={type:"update",clear:!1,addOrUpdate:e,remove:[],end:!0};r.patch(t),this._tileUpdateSet.delete(n),this.notifyChange("updating")})).catch((e=>{if(this._tileUpdateSet.delete(n),this.notifyChange("updating"),!Object(h.m)(e))throw e}))}_removeTile(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}}_setFilterState(e,t){var r=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(r,0,0,i|(t?x.i:0))}_getGraphicsData(e,t,r){var i=Object(u.d)(this.view.spatialReference),s=this._graphicStore.getGraphicsData(e,t,r);if(i){var a=Math.round((i.valid[1]-i.valid[0])/t.resolution);for(var n of s)n.geometry&&(Object(m.f)(n.geometry)||Object(m.e)(n.geometry))&&this._wrapPoints(n,a)}return s}_wrapPoints(e,t){var r=e.geometry;Object(m.e)(r)?this._wrapMultipoint(r,t):this._wrapPoint(e,t)}_wrapMultipoint(e,t){var r=e.points,i=[],s=0,a=0;for(var[n,o]of r){if(i.push([n+s,o]),s=0,t===ge.b){var l=5*ge.a;n+a<l?(i.push([t,0]),s=-t):n+a>ge.b-l&&(i.push([-t,0]),s=t)}else n+a<-ge.a?(i.push([t,0]),s=-t):n+a>ge.b+ge.a&&(i.push([-t,0]),s=t);a+=n}e.points=i}_wrapPoint(e,t){var r=e.geometry;if(t===ge.b){var i=5*ge.a;r.x<i?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>ge.b-i&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}else r.x<-ge.a?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>ge.b+ge.a&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}_processGraphics(e,t,r){var s=this;return Object(i.a)((function*(){if(!t||!t.length||!s._meshFactory)return null;var i=Me.from(t),a=s._meshFactory,n=yield s._matcher;return yield a.analyzeGraphics(i,n,null,null,r),s._attributeStore.sendUpdates(),s._processAnalyzedGraphics(e,i)}))()}_processAnalyzedGraphics(e,t){for(var r=this._meshFactory,i=t.getApproximateSize(),s=t.getCursor(),a={features:i,records:i,metrics:0},n=new _e.a(e.key.id,a,!1,!1,!1);s.next();){var o=s.readGraphic();o.insertAfter=-1===o.insertAfter?-1:this._displayIds.get(o.insertAfter),o.displayId=this._displayIds.get(o.attributes[this.uid]),r.writeGraphic(n,s)}var l=e.tileInfoView.tileInfo.isWrappable,h=n.serialize(l);if(1!==h.length)return new pe;var c=h[0].message;return pe.fromVertexData(c)}_abortProcessingGraphic(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}_getNullSymbol(e){var t=e.geometry;return Object(m.h)(t)?v.d:Object(m.g)(t)||Object(m.d)(t)?v.c:v.b}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((()=>{this._updatingGraphicsTimer=null,this.notifyChange("updating")}),160),this.notifyChange("updating")}};Object(s.a)([Object(o.b)({constructOnly:!0})],$e.prototype,"requestUpdateCallback",void 0),Object(s.a)([Object(o.b)()],$e.prototype,"container",void 0),Object(s.a)([Object(o.b)({constructOnly:!0})],$e.prototype,"graphics",void 0),Object(s.a)([Object(o.b)()],$e.prototype,"updating",null),Object(s.a)([Object(o.b)()],$e.prototype,"view",void 0),Object(s.a)([Object(o.b)()],$e.prototype,"updateRequested",void 0);var et=$e=Object(s.a)([Object(l.a)("esri.views.2d.layers.support.GraphicsView2D")],$e);t.a=et},589:function(e,t,r){"use strict";var i=r(558);class s extends i.a{constructor(e){super(e)}get hasLabels(){return!1}get labelsVisible(){return!1}onTileData(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){e.clear(),this.contains(e)||this.addChild(e)}_renderChildren(e,t){for(var r of this.children)r.isReady&&r.hasData&&(r.commit(e),e.context.setStencilFunction(514,r.stencilRef,255),r._displayList.replay(e,r,t))}}t.a=s},590:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));r(80);var i=r(305),s=r(395),a=r(238),n=(r(208),r(263),r(205)),o=(r(192),r(415)),l=r(572);function h(e,t,r){var i={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return t&&r&&(i.width=t,i.height=r),new n.a(e,i)}class c extends o.a{constructor(e=null,t,r=!0){super(),this.requestRenderOnSourceChangedEnabled=r,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.transforms={dvs:Object(s.b)()},this.blendFunction=t,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){this._source=e,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}setTransform(e){var t=Object(i.e)(this.transforms.dvs),[r,s]=e.toScreenNoRotation([0,0],this.x,this.y),n=this.resolution/this.pixelRatio/e.resolution,o=n*this.width,l=n*this.height,h=Math.PI*this.rotation/180;Object(i.a)(t,t,Object(a.b)(r,s)),Object(i.a)(t,t,Object(a.b)(o/2,l/2)),Object(i.i)(t,t,-h),Object(i.a)(t,t,Object(a.b)(-o/2,-l/2)),Object(i.f)(t,t,Object(a.b)(o,l)),Object(i.g)(this.transforms.dvs,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind({context:e},t){this._texture&&e.bindTexture(this._texture,t)}updateTexture({context:e}){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(this._textureInvalidated){this._textureInvalidated=!1,this._texture||(this.source?this._texture=h(e,this.sourceWidth,this.sourceHeight):this._texture=h(e));var r=this.source;if(r){if(this._texture.resize(this.sourceWidth,this.sourceHeight),function(e){return e&&"render"in e}(r))if(r instanceof l.a){var i=r.getRenderedRasterPixels();this._texture.setData(i.renderedRasterPixels)}else this._texture.setData(function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}(r));else(function(e){return e&&!("render"in e)})(r)&&this._texture.setData(r);this.ready()}else this._texture.setData(null)}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}},602:function(e,t,r){"use strict";var i=r(127),s=r(589);class a extends s.a{renderChildren(e){this.attributeView.bindTextures(e.context),this.children.some((e=>e.hasData))&&(super.renderChildren(e),e.drawPhase===i.c.MAP&&this._renderChildren(e),e.drawPhase===i.c.HIGHLIGHT&&this._renderHighlight(e))}_renderHighlight(e){var{painter:t}=e,r=t.effects.highlight;r.bind(e),this._renderChildren(e,r.defines),r.draw(e),r.unbind()}}t.a=a},697:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var i=r(127),s=r(636),a=r(510);class n extends a.a{get requiresDedicatedFBO(){return this.children.some((e=>"additive"===e.blendFunction))}prepareRenderPasses(e){var t=e.registerRenderPass({name:"bitmap",brushes:[s.a.bitmap],target:()=>this.children,drawPhase:i.c.MAP});return[...super.prepareRenderPasses(e),t]}}},905:function(e,t,r){"use strict";r.d(t,"a",(function(){return O})),r.d(t,"b",(function(){return g})),r.d(t,"c",(function(){return x})),r.d(t,"d",(function(){return _})),r.d(t,"e",(function(){return v}));var i=r(7),s=r(92),a=r(159),n=r(83),o=r(99),l=r(210),h=r(169),c=r(160),u=r(106),d=r(244),f=r(146),p=r(279),m={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function _(e){var t=e.folders||[],r=t.slice(),i=new Map,a=new Map,n=new Map,o=new Map,l=new Map,h={esriGeometryPoint:a,esriGeometryPolyline:n,esriGeometryPolygon:o};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{var t=Object(s.a)(e);t.featureSet.features=[];var r=e.featureSet.geometryType;i.set(r,t);var l=e.layerDefinition.objectIdField;"esriGeometryPoint"===r?y(a,l,e.featureSet.features):"esriGeometryPolyline"===r?y(n,l,e.featureSet.features):"esriGeometryPolygon"===r&&y(o,l,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{l.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((i=>{var s=function(e,t,r){var i=function(e,t){var r;return t.some((t=>t.id===e&&(r=t,!0))),r}(e,r);return i&&(i.parentFolderId=t,i.networkLink=i),i}(i,t.id,e.networkLinks);s&&r.push(s)}))})),r.forEach((e=>{e.featureInfos&&(e.points=Object(s.a)(i.get("esriGeometryPoint")),e.polylines=Object(s.a)(i.get("esriGeometryPolyline")),e.polygons=Object(s.a)(i.get("esriGeometryPolygon")),e.mapImages=[],e.featureInfos.map((t=>{switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":var r=h[t.type].get(t.id);r&&e[m[t.type]].featureSet.features.push(r);break;case"GroundOverlay":var i=l.get(t.id);i&&e.mapImages.push(i)}})),e.fullExtent=O([e]))}));var c=O(r);return{folders:t,sublayers:r,extent:c}}function g(e,t,r,i){var s=c.b&&c.b.findCredential(e);e=Object(n.e)(e,{token:s&&s.token});var o=a.a.kmlServiceUrl;return Object(u.default)(o,{query:{url:e,model:"simple",folders:"",refresh:0!==r||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:i})}function v(e,t,r=null,i=[]){var s=[],a={},n=t.sublayers,o=t.folders.map((e=>e.id));return n.forEach((t=>{var n=new e;if(r?n.read(t,r):n.read(t),i.length&&o.indexOf(n.id)>-1&&(n.visible=-1!==i.indexOf(n.id)),a[t.id]=n,null!=t.parentFolderId&&-1!==t.parentFolderId){var l=a[t.parentFolderId];l.sublayers||(l.sublayers=[]),l.sublayers.unshift(n)}else s.unshift(n)})),s}function y(e,t,r){r.forEach((r=>{e.set(r.attributes[t],r)}))}function x(e){return b.apply(this,arguments)}function b(){return(b=Object(i.a)((function*(e){var t=f.default.fromJSON(e.featureSet).features,r=e.layerDefinition,i=Object(d.a)(r.drawingInfo.renderer),s=h.a.fromJSON(e.popupInfo),a=[];for(var n of t){var o=yield i.getSymbolAsync(n);n.symbol=o,n.popupTemplate=s,n.visible=!0,a.push(n)}return a}))).apply(this,arguments)}function O(e){var t=Object(p.d)(),r=Object(p.d)(p.a);for(var i of e){if(i.polygons&&i.polygons.featureSet&&i.polygons.featureSet.features)for(var s of i.polygons.featureSet.features)Object(l.b)(t,s.geometry),Object(p.g)(r,t);if(i.polylines&&i.polylines.featureSet&&i.polylines.featureSet.features)for(var a of i.polylines.featureSet.features)Object(l.b)(t,a.geometry),Object(p.g)(r,t);if(i.points&&i.points.featureSet&&i.points.featureSet.features)for(var n of i.points.featureSet.features)Object(l.b)(t,n.geometry),Object(p.g)(r,t);if(i.mapImages)for(var h of i.mapImages)Object(l.b)(t,h.extent),Object(p.g)(r,t)}return Object(p.f)(r,p.a)?null:{xmin:r[0],ymin:r[1],zmin:r[2],xmax:r[3],ymax:r[4],zmax:r[5],spatialReference:o.a.WGS84}}}}]);
//# sourceMappingURL=79.3088c2fb.chunk.js.map