(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[38,231,285],{1080:function(e,t,n){"use strict";n.d(t,"a",(function(){return k})),n.d(t,"b",(function(){return C}));var r=n(81),i=n(119),a=(n(79),n(122)),s=n(160),o=n(188),c=n(85),l=n(83),u=(n(84),n(80),n(82)),h=n(455),d=(n(98),n(183)),p=n(87),m=n(112),b=n(885),f=n(501),g=n(264),y=n(105),O=n(716),_=n(204),v=n(110),j=n(134),x=n(125);function E(e,t){const n=new v.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function w(e,t,n){const r=new j.a({paths:e,spatialReference:t});return n&&Object(g.i)(r),r}function T(e,t,n,r=!0){const i=Object(p.a)(e);i.forEach((e=>{const t=e[0],n=e[e.length-1];Object(d.c)(t,n)&&1!==e.length||e.push(e[0])}));let a=new x.a({rings:i,spatialReference:t});return a.rings.forEach((e=>{Object(g.g)(e,!1,!1)||e.reverse()})),n&&Object(g.i)(a),r&&a.isSelfIntersecting&&Object(y.l)(t)&&(a=Object(f.simplify)(a)),a}function S(e,t,n){const r=t.mapToLocalMultiple(e),i=[],a={x:r[0].x,y:r[0].y},s=r[1].x,o=r[1].y,l=Math.round(s-a.x),u=Math.round(o-a.y),h=Math.max(Math.abs(l),Math.abs(u));if(n){const e={x:a.x+h,y:a.y+h},t={x:a.x-h,y:a.y-h};i.push(Object(O.b)(e.x,t.y),Object(O.b)(t.x,t.y),Object(O.b)(t.x,e.y),Object(O.b)(e.x,e.y))}else{const e={x:l>0?a.x+h:a.x-h,y:u>0?a.y+h:a.y-h};i.push(Object(O.b)(a.x,a.y),Object(O.b)(e.x,a.y),Object(O.b)(e.x,e.y),Object(O.b)(a.x,e.y))}return T([Object(c.g)(i.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function M(e,t,n,r){const i=t.mapToLocalMultiple(e);let a=null,s=null;if(n)a=i[0],s=i[1];else{const e=i[0],t=i[1],n=Math.round(t.x-e.x),r=Math.round(t.y-e.y),o=Math.max(Math.abs(n),Math.abs(r));a=Object(O.b)(n>0?e.x+o/2:e.x-o/2,r>0?e.y+o/2:e.y-o/2),s=Object(O.b)(Math.abs(n)>Math.abs(r)?a.x-o/2:a.x,Math.abs(n)>Math.abs(r)?a.y:a.y-o/2)}const o=t.localToMap(a),l=t.localToMap(s);if(Object(c.j)(o)||Object(c.j)(l))return null;t.doUnnormalization&&Object(g.j)([[o,l]],t.spatialReference);const u=E(o,t.spatialReference),h=E(l,t.spatialReference),d=Object(m.f)(t.spatialReference);let p=0;if(Object(y.l)(t.spatialReference))p=d*Object(f.distance)(u,h,null);else{const e=a.x-s.x,t=a.y-s.y;p=d*Math.sqrt(e*e+t*t)*(r||1)}const _=new b.a({center:u,radius:p,radiusUnit:"meters",spatialReference:t.spatialReference});return T(_.rings,_.spatialReference,!1)}var I=n(562);let k=class extends(Object(s.b)(a.a.EventedMixin(I.a))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new h.a({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.complete()}destroy(){this.drawOperation=Object(c.e)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Object(c.e)(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new i.a({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add(Object(o.c)((()=>{Object(c.k)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=Object(c.e)(this._graphic))})),R)}_destroyAllVisualisations(){this.handles.remove(A.outline),this.handles.remove(A.regularVertices),this.handles.remove(A.activeVertex),this.handles.remove(R)}_getCreateOperationGeometry(e={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,n=this.drawOperation.committedVertices,r=n.slice();Object(c.k)(t)&&r.push(this.drawOperation.coordinateHelper.pointToArray(t));const i=Object(c.k)(t)?this.drawOperation.coordinateHelper.pointToArray(t):n.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null},s=r.length,o=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=n,a.activeVertex=i,a.full=this.drawOperation.coordinateHelper.arrayToPoint(r[0]);break;case"multipoint":a.regularVertices=n,a.activeVertex=i,s>0&&(a.full=function(e,t){return new _.a({points:e,spatialReference:t})}(r,o));break;case"polyline":a.regularVertices=n,a.activeVertex=i,s>0&&(a.full=w([r],o,l));break;case"polygon":a.regularVertices=n,a.activeVertex=i,s>0&&(a.full=T([r],o,l,!0));break;case"circle":if(s>0){const t=Object(O.a)(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],n=t.makeMapPoint(e[0]+V*this.view.resolution,e[1]);a.full=M([e,n],t,!0)}else 2===s&&(a.full=this.forceUniformSize?M(r,t,this.centered):function(e,t,n){const r=t.mapToLocalMultiple(e),i=r[0],a=r[1],s=Math.round(a.x-i.x),o=Math.round(a.y-i.y),l=Object(O.b)(n?i.x:i.x+s/2,n?i.y:i.y+o/2),u=n?s:s/2,h=n?o:o/2,d=[],p=2*Math.PI/60;for(let c=0;c<60;c++){const e=Math.cos(c*p),t=Math.sin(c*p),n=Object(O.b)(u*e+l.x,h*t+l.y);d.push(n)}return d.push(d[0]),T([Object(c.g)(d.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}(r,t,this.centered))}break;case"rectangle":if(s>0){const t=Object(O.a)(this.view,r[0]);if(1===s&&e.operationComplete){const e=r[0],n=t.makeMapPoint(e[0]+V*this.view.resolution,e[1]);a.full=S([e,n],t,!0)}else 2===s&&(a.full=this.forceUniformSize?S(r,t,this.centered):function(e,t,n){let r=t.mapToLocalMultiple(e);if(1===r.length){const e=48,t=r[0];r=[Object(O.b)(t.x-e,t.y+e),Object(O.b)(t.x+e,t.y-e),Object(O.b)(t.x+e,t.y-e),Object(O.b)(t.x-e,t.y+e)]}const i=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y};if(n){const e=Math.round(s.x-a.x),t=Math.round(s.y-a.y);i.push(Object(O.b)(a.x-e,a.y-t),Object(O.b)(s.x,a.y-t),Object(O.b)(s.x,s.y),Object(O.b)(a.x-e,s.y))}else i.push(Object(O.b)(a.x,a.y),Object(O.b)(s.x,a.y),Object(O.b)(s.x,s.y),Object(O.b)(a.x,s.y));return T([Object(c.g)(i.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}(r,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":s>1&&(a.outline=w([r],o,l));break;case"circle":case"rectangle":Object(c.k)(a.full)&&"polygon"===a.full.type&&(a.outline=T(a.full.rings,o,l))}return a}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});Object(c.k)(e)&&(t=new i.a({geometry:e.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer,...this.graphicProperties}))}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();Object(c.j)(e)?this._destroyAllVisualisations():(Object(c.k)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),A.outline):this.handles.remove(A.outline),Object(c.k)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),A.regularVertices):this.handles.remove(A.regularVertices),Object(c.k)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),A.activeVertex):this.handles.remove(A.activeVertex),Object(c.k)(e.full)?Object(c.j)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(R))}};Object(r.a)([Object(l.b)({value:!0})],k.prototype,"centered",null),Object(r.a)([Object(l.b)({nonNullable:!0})],k.prototype,"defaultZ",void 0),Object(r.a)([Object(l.b)()],k.prototype,"drawOperation",void 0),Object(r.a)([Object(l.b)({value:!0})],k.prototype,"enabled",null),Object(r.a)([Object(l.b)({value:!0})],k.prototype,"forceUniformSize",null),Object(r.a)([Object(l.b)({constructOnly:!0})],k.prototype,"geometryType",void 0),Object(r.a)([Object(l.b)()],k.prototype,"graphic",null),Object(r.a)([Object(l.b)({constructOnly:!0})],k.prototype,"graphicProperties",void 0),Object(r.a)([Object(l.b)()],k.prototype,"graphicSymbol",void 0),Object(r.a)([Object(l.b)({constructOnly:!0})],k.prototype,"hasZ",void 0),Object(r.a)([Object(l.b)({constructOnly:!0})],k.prototype,"mode",void 0),Object(r.a)([Object(l.b)()],k.prototype,"snappingManager",void 0),Object(r.a)([Object(l.b)()],k.prototype,"snapToScene",void 0),Object(r.a)([Object(l.b)({readOnly:!0})],k.prototype,"type",void 0),Object(r.a)([Object(l.b)({readOnly:!0})],k.prototype,"updating",null),Object(r.a)([Object(l.b)({constructOnly:!0,nonNullable:!0})],k.prototype,"view",void 0),k=Object(r.a)([Object(u.a)("esri.views.draw.DrawGraphicTool")],k);const R="create-operation-graphic",A={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function C(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const V=48},1340:function(e,t,n){"use strict";n.r(t),n.d(t,"DrawGraphicTool2D",(function(){return _}));var r=n(81),i=(n(98),n(119)),a=n(188),s=n(85),o=n(83),c=(n(79),n(84),n(80),n(82)),l=n(798),u=(n(139),n(358)),h=n(292);const d=new u.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),p=new h.a({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),m=new h.a({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var b=n(1080),f=n(815),g=n(800),y=n(110),O=n(204);let _=class extends b.a{constructor(e){super(e),this._visualElementGraphics={outline:null,regularVertices:null,activeVertex:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:Object(s.t)(e.activeLineSymbol,d),regularVertices:Object(s.t)(e.regularVerticesSymbol,p),activeVertex:Object(s.t)(e.activeVertexSymbol,m),fill:Object(s.s)(e.activeFillSymbol)}}initializeGraphic(e){return Object(s.k)(this._visualElementSymbols.fill)&&(e.symbol=this._visualElementSymbols.fill),null}makeDrawOperation(){const e=this.view;return new f.a({view:e,manipulators:this.manipulators,geometryType:Object(b.b)(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new g.b(e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new l.a(this.internalGraphicsLayer)})}onActiveVertexChanged(e){const[t,n]=e,r=new y.a({x:t,y:n,spatialReference:this.drawOperation.spatialReference});return Object(s.k)(this._visualElementGraphics.activeVertex)?(this._visualElementGraphics.activeVertex.geometry=r,null):(this._visualElementGraphics.activeVertex=new i.a({geometry:r,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(v),Object(a.c)((()=>{Object(s.k)(this._visualElementGraphics.activeVertex)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=Object(s.e)(this._visualElementGraphics.activeVertex))})))}onOutlineChanged(e){const t=e.clone();if("polyline"===t.type){const e=t.paths[t.paths.length-1];e.splice(0,e.length-2)}return Object(s.k)(this._visualElementGraphics.outline)?(this._visualElementGraphics.outline.geometry=t,null):(this._visualElementGraphics.outline=new i.a({geometry:t,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.outline),this.internalGraphicsLayer.graphics.sort(v),Object(a.c)((()=>{Object(s.k)(this._visualElementGraphics.outline)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.outline),this._visualElementGraphics.outline=Object(s.e)(this._visualElementGraphics.outline))})))}onRegularVerticesChanged(e){const t=new O.a({points:e,spatialReference:this.drawOperation.spatialReference});return Object(s.k)(this._visualElementGraphics.regularVertices)?(this._visualElementGraphics.regularVertices.geometry=t,null):(this._visualElementGraphics.regularVertices=new i.a({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(v),Object(a.c)((()=>{Object(s.k)(this._visualElementGraphics.regularVertices)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=Object(s.e)(this._visualElementGraphics.regularVertices))})))}};function v(e,t){var n,r,i,a;return(null!=(n=null==(r=e.attributes)?void 0:r.displayOrder)?n:-1/0)-(null!=(i=null==(a=t.attributes)?void 0:a.displayOrder)?i:-1/0)}Object(r.a)([Object(o.b)()],_.prototype,"activeFillSymbol",void 0),Object(r.a)([Object(o.b)({readOnly:!0})],_.prototype,"type",void 0),Object(r.a)([Object(o.b)({constructOnly:!0,nonNullable:!0})],_.prototype,"view",void 0),_=Object(r.a)([Object(c.a)("esri.views.2d.interactive.draw.DrawGraphicTool2D")],_)},310:function(e,t,n){"use strict";n.d(t,"a",(function(){return _})),n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return v})),n.d(t,"e",(function(){return j})),n.d(t,"f",(function(){return x})),n.d(t,"g",(function(){return E}));var r=n(85),i=n(95);const a=(e,t,n)=>[t,n],s=(e,t,n)=>[t,n,e[2]],o=(e,t,n)=>[t,n,e[2],e[3]];function c(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function u({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function h(e,t,n){const r=[];let i,a,s,o;for(let c=0;c<n.length;c++){const h=n[c];c>0?(s=l(e,h[0]),o=u(e,h[1]),s===i&&o===a||(r.push(t(h,s-i,o-a)),i=s,a=o)):(i=l(e,h[0]),a=u(e,h[1]),r.push(t(h,i,a)))}return r.length>0?r:null}function d({scale:e,translate:t},n){return n*e[0]+t[0]}function p({scale:e,translate:t},n){return t[1]-n*e[1]}function m(e,t,n){const r=new Array(n.length);if(!n.length)return r;const[i,a]=e.scale;let s=d(e,n[0][0]),o=p(e,n[0][1]);r[0]=t(n[0],s,o);for(let c=1;c<n.length;c++){const e=n[c];s+=e[0]*i,o-=e[1]*a,r[c]=t(e,s,o)}return r}function b(e,t,n){const r=new Array(n.length);for(let i=0;i<n.length;i++)r[i]=m(e,t,n[i]);return r}function f(e,t,n,r,i){return t.points=function(e,t,n,r){return h(e,n?r?o:s:r?s:a,t)}(e,n.points,r,i),t}function g(e,t,n,r,i){return t.x=l(e,n.x),t.y=u(e,n.y),t!==n&&(r&&(t.z=n.z),i&&(t.m=n.m)),t}function y(e,t,n,r,i){const c=function(e,t,n,r){const i=[],c=n?r?o:s:r?s:a;for(let a=0;a<t.length;a++){const n=h(e,c,t[a]);n&&n.length>=3&&i.push(n)}return i.length?i:null}(e,n.rings,r,i);return c?(t.rings=c,t):null}function O(e,t,n,r,i){const c=function(e,t,n,r){const i=[],c=n?r?o:s:r?s:a;for(let a=0;a<t.length;a++){const n=h(e,c,t[a]);n&&n.length>=2&&i.push(n)}return i.length?i:null}(e,n.paths,r,i);return c?(t.paths=c,t):null}function _(e,t){return e&&t?Object(i.f)(t)?g(e,{},t,!1,!1):Object(i.h)(t)?O(e,{},t,!1,!1):Object(i.g)(t)?y(e,{},t,!1,!1):Object(i.e)(t)?f(e,{},t,!1,!1):Object(i.d)(t)?function(e,t,n,r,i){return t.xmin=l(e,n.xmin),t.ymin=u(e,n.ymin),t.xmax=l(e,n.xmax),t.ymax=u(e,n.ymax),t!==n&&(r&&(t.zmin=n.zmin,t.zmax=n.zmax),i&&(t.mmin=n.mmin,t.mmax=n.mmax)),t}(e,{},t,!1,!1):null:null}function v(e,t,n,i,c){return Object(r.k)(n)&&(t.points=function(e,t,n,r){return m(e,n?r?o:s:r?s:a,t)}(e,n.points,i,c)),t}function j(e,t,n,i,a){return Object(r.j)(n)||(t.x=d(e,n.x),t.y=p(e,n.y),t!==n&&(i&&(t.z=n.z),a&&(t.m=n.m))),t}function x(e,t,n,i,c){return Object(r.k)(n)&&(t.rings=function(e,t,n,r){return b(e,n?r?o:s:r?s:a,t)}(e,n.rings,i,c)),t}function E(e,t,n,i,c){return Object(r.k)(n)&&(t.paths=function(e,t,n,r){return b(e,n?r?o:s:r?s:a,t)}(e,n.paths,i,c)),t}},318:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return l}));var r=n(171);function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function a(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5];let c=n*a-r*i;return c?(c=1/c,e[0]=a*c,e[1]=-r*c,e[2]=-i*c,e[3]=n*c,e[4]=(i*o-a*s)*c,e[5]=(r*s-n*o)*c,e):null}function s(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=n[0],u=n[1],h=n[2],d=n[3],p=n[4],m=n[5];return e[0]=r*l+a*u,e[1]=i*l+s*u,e[2]=r*h+a*d,e[3]=i*h+s*d,e[4]=r*p+a*m+o,e[5]=i*p+s*m+c,e}function o(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=Math.sin(n),u=Math.cos(n);return e[0]=r*u+a*l,e[1]=i*u+s*l,e[2]=r*-l+a*u,e[3]=i*-l+s*u,e[4]=o,e[5]=c,e}function c(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=n[0],u=n[1];return e[0]=r*l,e[1]=i*l,e[2]=a*u,e[3]=s*u,e[4]=o,e[5]=c,e}function l(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],c=t[5],l=n[0],u=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=s,e[4]=r*l+a*u+o,e[5]=i*l+s*u+c,e}function u(e,t){const n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function h(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function d(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}const p=s,m=d;Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:i,set:function(e,t,n,r,i,a,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=s,e},invert:a,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:s,rotate:o,scale:c,translate:l,fromRotation:u,fromScaling:h,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},subtract:d,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],c=e[5],l=t[0],u=t[1],h=t[2],d=t[3],p=t[4],m=t[5];return Math.abs(n-l)<=r.a*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-u)<=r.a*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-h)<=r.a*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-d)<=r.a*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-p)<=r.a*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-m)<=r.a*Math.max(1,Math.abs(c),Math.abs(m))},mul:p,sub:m})},373:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return h})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return p})),n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return l})),n.d(t,"h",(function(){return u}));n(543),n(79);var r=n(85),i=(n(321),n(234),n(93),n(267)),a=n(123);n(310),n(172),n(155),n(399);class s{constructor(e,t,n){this.uid=e,this.geometry=t,this.attributes=n,this.visible=!0,this.objectId=null,this.centroid=null}}function o(e){return Object(r.k)(e.geometry)}class c{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function l(e,t,n,r){return{x:e,y:t,z:n,hasZ:null!=n,hasM:!1,spatialReference:r,type:"point"}}function u(e){if(Object(r.j)(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const n of e.paths)t+=n.length;return t}case"polygon":{let t=0;for(const n of e.rings)t+=n.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function h(e,t){switch(Object(i.h)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let n=0;n<e.paths.length;n++)Object(i.l)(t,e.paths[n],e.hasZ);break;case"polygon":for(let n=0;n<e.rings.length;n++)Object(i.l)(t,e.rings[n],e.hasZ);break;case"multipoint":Object(i.l)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function d(e,t){switch(Object(a.m)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let n=0;n<e.paths.length;n++)Object(a.p)(t,e.paths[n]);break;case"polygon":for(let n=0;n<e.rings.length;n++)Object(a.p)(t,e.rings[n]);break;case"multipoint":Object(a.p)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Object(i.f)(),Object(a.l)()},399:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(79),n(85);function r(e,t){return!!i(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function i(e,t){return e===t||e&&t&&e.equals(t)}},400:function(e,t,n){"use strict";n.d(t,"a",(function(){return j})),n.d(t,"b",(function(){return O})),n.d(t,"c",(function(){return _})),n.d(t,"d",(function(){return h})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return v})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return b})),n.d(t,"i",(function(){return g})),n.d(t,"j",(function(){return y})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return m}));n(188);var r=n(87),i=n(107),a=n(85),s=n(102),o=n(101),c=n(178),l=n(592);function u(e,t){return e.events.on("drag",function(e,t){let n=null,r=null;return i=>{if("cancel"===i.action)return void(Object(a.k)(r)&&(r.execute({action:"cancel"}),n=null,r=null));const s={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};"start"===i.action&&Object(a.j)(n)&&(n=new j,r=new j,t(e,n,r,i.pointerType,s)),Object(a.k)(n)&&n.execute(s),"end"===i.action&&Object(a.k)(n)&&(n=null,r=null)}}(e,t))}function h(e,t){const n=[e.x,e.y,e.z],r=t,i=[Math.cos(r),Math.sin(r)],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(0===a)return null;i[0]/=a,i[1]/=a;const s=e=>{const t=(e.x-n[0])*i[0]+(e.y-n[1])*i[1];e.x=n[0]+t*i[0],e.y=n[1]+t*i[1]};return e=>(s(e.mapStart),s(e.mapEnd),e)}function d(e,t){let n=null;return r=>{if("start"===r.action&&(n=function(e,t,n){const r=e.geometry;if(Object(a.j)(r))return null;if("mesh"===r.type)return function(e,t,n,r){if(Object(a.k)(t.transform))return function(e,t,n,r){const i=p(n.getOriginPoint(t.spatialReference),r),s=t.spatialReference;return Object(a.j)(i)?null:{move:(t,r,u)=>{const h=Object(l.d)(i.clone(),t,r,u);if(h.spatialReference.equals(s))n.origin=Object(o.g)(h.x,h.y,h.z);else{const e=Object(c.k)(h,s);Object(a.k)(e)&&(n.origin=Object(o.g)(e.x,e.y,e.z))}e.notifyGeometryChanged()}}}(e,t,t.transform,n);if(!t.spatialReference.equals(n))return null;let i=0,s=0,u=0;return{move:(n,a,o)=>{const c=n-i,l=a-s,h=o-u;if(c||l||h){const d=t.origin.clone().offset(c,l,h);t.centerAt(d,{geographic:1===r}),e.notifyGeometryChanged(),i=n,s=a,u=o}}}}(e,r,t,n);const i=p(r,t),s=r.spatialReference;return Object(a.j)(i)?null:{move:(t,n,r)=>{const a=Object(l.d)(i.clone(),t,n,r);a.spatialReference.equals(s)?e.geometry=a:e.geometry=Object(c.k)(a,s)}}}(e,r.mapStart.spatialReference,t)),Object(a.j)(n))return null;const i=r.mapEnd.x-r.mapStart.x,s=r.mapEnd.y-r.mapStart.y,u=r.mapEnd.z-r.mapStart.z;return n.move(i,s,u),{...r,translationX:i,translationY:s,translationZ:u}}}function p(e,t){return Object(a.j)(e)?null:e.spatialReference.equals(t)?e.clone():Object(c.k)(e,t)}function m(e,t=null,n){let r=null;const i=Object(a.k)(t)&&!e.spatialReference.equals(t)?e=>Object(a.k)(e)?Object(c.k)(e,t):e:e=>e,s={exclude:[],...n};return t=>{if("start"===t.action&&(r=i(e.toMap(t.screenStart,s))),Object(a.j)(r))return null;const n=i(e.toMap(t.screenEnd,s));return Object(a.k)(n)?{...t,mapStart:r,mapEnd:n}:null}}function b(e,t){const n=e.map((e=>Object(a.s)(d(e,t)))).filter((e=>Object(a.k)(e)));return e=>{const t=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,i=e.mapEnd.z-e.mapStart.z;return n.forEach((t=>t(e))),{...e,translationX:t,translationY:r,translationZ:i}}}function f(e,t){const n=new Map;for(const i of t)n.set(i,Object(r.a)(e[i]));return t=>(n.forEach(((t,n)=>{e[n]=t})),t)}function g(e){return Object(a.k)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){const n=Object(a.k)(t.transform)?t.transform.clone():null,r=t.vertexAttributes.clonePositional();return i=>(t.transform=n,t.vertexAttributes=r,e.notifyGeometryChanged(),i)}(e,e.geometry):f(e,["geometry"])}function y(e){const t=e.map((e=>Object(a.s)(g(e)))).filter((e=>Object(a.k)(e)));return e=>(t.forEach((t=>t(e))),e)}function O(){let e=0,t=0,n=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z);const i=r.mapEnd.x-e,a=r.mapEnd.y-t,s=r.mapEnd.z-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:i,mapDeltaY:a,mapDeltaZ:s,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function _(){let e=0,t=0;return n=>{"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);const r=n.screenEnd.x-e,i=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:i}}}function v(e,t){let n=null,r=0,a=0;return o=>{if("start"===o.action&&(n=e.toScreen(t),n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=o.screenStart.x-n.x,a=o.screenStart.y-n.y)),null==n)return null;const c=Object(i.f)(o.screenEnd.x-r,0,e.width),l=Object(i.f)(o.screenEnd.y-a,0,e.height),u=Object(s.f)(c,l);return o.screenStart=n,o.screenEnd=u,o}}class j{constructor(){this.execute=()=>{}}next(e,t=new j){return Object(a.k)(e)&&(this.execute=n=>{const r=e(n);Object(a.k)(r)&&t.execute(r)}),t}}},456:function(e,t,n){"use strict";n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return M}));var r=n(81),i=n(91),a=n(80),s=n(85),o=n(357),c=n(180),l=n(89),u=n(370),h=n(109),d=n(83),p=(n(79),n(84),n(82)),m=n(523),b=n(554);const f=a.a.getLogger("esri.views.support.Scheduler");var g,y;(y=g||(g={})).RESOURCE_CONTROLLER="schedule",y.SLIDE="slide",y.STREAM_DATA_LOADER="stream loader",y.ELEVATION_QUERY="elevation query",y.TERRAIN_SURFACE="terrain",y.SURFACE_GEOMETRY_UPDATES="surface geometry updates",y.GRAPHICS_CORE="Graphics3D",y.I3S_CONTROLLER="I3S",y.POINT_CLOUD_LAYER="point cloud",y.FEATURE_TILE_FETCHER="feature fetcher",y.OVERLAY="overlay",y.STAGE="stage",y.GRAPHICS_DECONFLICTOR="graphics deconflictor",y.FILTER_VISIBILITY="Graphics3D filter visibility",y.SCALE_VISIBILITY="Graphics3D scale visibility",y.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",y.POINT_OF_INTEREST_FREQUENT="POI frequent",y.POINT_OF_INTEREST_INFREQUENT="POI infrequent",y.LABELER="labeler",y.FEATURE_QUERY_ENGINE="feature query",y.FEATURE_TILE_TREE="feature tile tree",y.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",y.ELEVATION_ALIGNMENT="elevation alignment",y.TEXT_TEXTURE_ATLAS="text texture atlas",y.TEXTURE_UNLOAD="texture unload",y.LINE_OF_SIGHT_TOOL="line of sight tool",y.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",y.ELEVATION_PROFILE="elevation profile",y.SNAPPING="snapping",y.SHADOW_ACCUMULATOR="shadow accumulator",y[y.TEST_PRIO=1]="TEST_PRIO";const O=new Map([[g.RESOURCE_CONTROLLER,0],[g.SLIDE,0],[g.STREAM_DATA_LOADER,0],[g.ELEVATION_QUERY,0],[g.TERRAIN_SURFACE,1],[g.SURFACE_GEOMETRY_UPDATES,1],[g.GRAPHICS_CORE,2],[g.I3S_CONTROLLER,2],[g.POINT_CLOUD_LAYER,2],[g.FEATURE_TILE_FETCHER,2],[g.OVERLAY,4],[g.STAGE,4],[g.GRAPHICS_DECONFLICTOR,4],[g.FILTER_VISIBILITY,4],[g.SCALE_VISIBILITY,4],[g.FRUSTUM_VISIBILITY,4],[g.POINT_OF_INTEREST_FREQUENT,6],[g.POINT_OF_INTEREST_INFREQUENT,30],[g.LABELER,8],[g.FEATURE_QUERY_ENGINE,8],[g.FEATURE_TILE_TREE,16],[g.FEATURE_TILE_TREE_ACTIVE,0],[g.ELEVATION_ALIGNMENT,12],[g.TEXT_TEXTURE_ATLAS,12],[g.TEXTURE_UNLOAD,12],[g.LINE_OF_SIGHT_TOOL,16],[g.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[g.SNAPPING,0],[g.SHADOW_ACCUMULATOR,30]]);function _(e){return O.has(e)?O.get(e):"number"==typeof e?e:1}const v=Object(u.a)(6.5),j=Object(u.a)(1),x=Object(u.a)(30),E=Object(u.a)(1e3/30),w=Object(u.a)(100);var T,S;!function(e){let t=class extends i.a{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new o.a("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=1,this._tasks=new c.a,this._runQueue=new c.a,this._load=0,this._idleStateCallbacks=new c.a,this._idleUpdatesStartFired=!1,this._maxReschedule=k,this._forceTask=!1,this._debug=!1,this._debugHandle=Object(h.a)(b.a,"SCHEDULER_LOG_SLOW_TASKS",(e=>this._debug=e)),this._budget=new a(e.nowFunc);for(const r of Object.keys(g))this.performanceInfo.tasks.set(g[r],new o.a(g[r]));let t;const n=this;this._test={get state(){return Object(s.j)(t)?n._state:t},set state(e){t=e},FRAME_SAFETY_BUDGET:v,INTERACTING_BUDGET:E,IDLE_BUDGET:w,get budget(){return n._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,t){const r=_(e),i=new n(this,e,t,r);return this._tasks.push(i),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o.a(e)),i}registerIdleStateCallbacks(e,t){const n={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(n),2===this.state&&this._idleUpdatesStartFired&&n.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(n),set idleBegin(e){r._idleUpdatesStartFired&&(n.idleEnd(),2===r._state&&e()),n.idleBegin=e},set idleEnd(e){n.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return Object(s.j)(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=v,n=e.frameDuration,r=j;switch(this.state){case 2:t=Object(u.a)(0),n=Object(u.a)(Math.max(w,e.frameDuration)),r=x;break;case 1:n=Object(u.a)(Math.max(E,e.frameDuration))}return n=Object(u.a)(n-e.elapsedFrameTime-t),2!==this.state&&n<j&&!this._forceTask?(this._forceTask=!0,!1):(n=Object(u.a)(Math.max(n,r)),this._budget.reset(n,this.state),this._maxReschedule=k,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(Object(u.a)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return S.SCHEDULED;let t=S.IDLE;return this._tasks.forAll((n=>{n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=S.READY:t!==S.READY&&(t=S.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((n=>{n.name===e&&(t+=n.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,n)=>{t+=e>1?` ${e}x ${n}`:` ${n}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((n=>{if(n.needsUpdate&&0!==n.schedulePriority&&0!==n.basePriority)switch(e=!0,t=Math.max(t,n.basePriority),n.schedulePriority){case 1:n.schedulePriority=0,this._runQueue.push(n);break;default:--n.schedulePriority}})),!e)return this.updating=!1,!1;this._maxReschedule===k&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const n=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)}catch(t){f.error(`Exception in task "${r.name}"`,t)}r.schedulePriority=r.basePriority;const i=this._budget.now()-n;if(r.runtime+=i,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",r.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(g))this._frameTaskTimes.set(g[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};Object(r.a)([Object(d.b)()],t.prototype,"updating",void 0),Object(r.a)([Object(d.b)()],t.prototype,"nowFunc",void 0),t=Object(r.a)([Object(p.a)("esri.views.support.Scheduler")],t),e.Scheduler=t;let n=class extends i.a{constructor(e,t,n,r){super({}),this._scheduler=e,this.name=t,this._basePriority=r,this.runtime=0,this._queue=new m.a,this.updating=!1,this.schedulePriority=this._basePriority,this.task=Object(s.k)(n)?n:{running:!1,runTask:e=>this.processQueue(e)}}normalizeCtorArgs(){return{}}remove(){this.processQueue(M),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=_(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,n){return this.updating=!0,this._queue.push(e,t,n)}reschedule(e,t,n){return this.updating=!0,this._queue.unshift(e,t,n)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};Object(r.a)([Object(d.b)()],n.prototype,"updating",void 0),n=Object(r.a)([Object(p.a)("esri.views.support.SchedulerTask")],n);class a{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=a}(T||(T={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(S||(S={}));const M=(()=>{const e=new T.Budget((()=>performance.now()));return e.enabled=!1,e})();const I=new class{remove(){}processQueue(){}schedule(e,t,n){try{if(Object(l.n)(t)){const e=Object(l.e)();return n?Promise.resolve(n(e)):Promise.reject(e)}return Object(l.x)(e())}catch(r){return Promise.reject(r)}}reschedule(e,t,n){return this.schedule(e,t,n)}},k=Number.MAX_SAFE_INTEGER},485:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return p})),n.d(t,"d",(function(){return I})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return h})),n.d(t,"g",(function(){return R})),n.d(t,"h",(function(){return l}));var r=n(304),i=n(384),a=n(101),s=n(171),o=n(111),c=n(226);function l(e,t,n){n*=.5;const r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function u(e,t){const n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>s.a?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function h(e,t,n){const r=t[0],i=t[1],a=t[2],s=t[3],o=n[0],c=n[1],l=n[2],u=n[3];return e[0]=r*u+s*o+i*l-a*c,e[1]=i*u+s*c+a*o-r*l,e[2]=a*u+s*l+r*c-i*o,e[3]=s*u-r*o-i*c-a*l,e}function d(e,t,n,r){const i=t[0],a=t[1],o=t[2],c=t[3];let l,u,h,d,p,m=n[0],b=n[1],f=n[2],g=n[3];return u=i*m+a*b+o*f+c*g,u<0&&(u=-u,m=-m,b=-b,f=-f,g=-g),1-u>s.a?(l=Math.acos(u),h=Math.sin(l),d=Math.sin((1-r)*l)/h,p=Math.sin(r*l)/h):(d=1-r,p=r),e[0]=d*i+p*m,e[1]=d*a+p*b,e[2]=d*o+p*f,e[3]=d*c+p*g,e}function p(e,t){const n=t[0],r=t[1],i=t[2],a=t[3],s=n*n+r*r+i*i+a*a,o=s?1/s:0;return e[0]=-n*o,e[1]=-r*o,e[2]=-i*o,e[3]=a*o,e}function m(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function b(e,t){const n=t[0]+t[4]+t[8];let r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);const i=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*a+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*i+a]-t[3*a+i])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e}function f(e,t,n,r){const i=.5*Math.PI/180;t*=i,n*=i,r*=i;const a=Math.sin(t),s=Math.cos(t),o=Math.sin(n),c=Math.cos(n),l=Math.sin(r),u=Math.cos(r);return e[0]=a*c*u-s*o*l,e[1]=s*o*u+a*c*l,e[2]=s*c*l-a*o*u,e[3]=s*c*u+a*o*l,e}const g=c.c,y=c.l,O=c.a,_=h,v=c.b,j=c.d,x=c.j,E=c.e,w=E,T=c.f,S=T,M=c.k,I=c.g,k=c.h;function R(e,t,n){const r=Object(o.h)(t,n);return r<-.999999?(Object(o.g)(A,C,t),Object(o.y)(A)<1e-6&&Object(o.g)(A,V,t),Object(o.r)(A,A),l(e,A,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Object(o.g)(A,t,n),e[0]=A[0],e[1]=A[1],e[2]=A[2],e[3]=1+r,M(e,e))}const A=Object(a.e)(),C=Object(a.g)(1,0,0),V=Object(a.g)(0,1,0);const P=Object(i.b)(),G=Object(i.b)();const L=Object(r.b)();Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:l,getAxisAngle:u,multiply:h,rotateX:function(e,t,n){n*=.5;const r=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c+s*o,e[1]=i*c+a*o,e[2]=a*c-i*o,e[3]=s*c-r*o,e},rotateY:function(e,t,n){n*=.5;const r=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c-a*o,e[1]=i*c+s*o,e[2]=a*c+r*o,e[3]=s*c-i*o,e},rotateZ:function(e,t,n){n*=.5;const r=t[0],i=t[1],a=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*o,e[1]=i*c-r*o,e[2]=a*c+s*o,e[3]=s*c-a*o,e},calculateW:function(e,t){const n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},slerp:d,random:function(e){const t=Object(s.b)(),n=Object(s.b)(),r=Object(s.b)(),i=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*n),e[1]=i*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},invert:p,conjugate:m,fromMat3:b,fromEuler:f,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:g,set:y,add:O,mul:_,scale:v,dot:j,lerp:x,length:E,len:w,squaredLength:T,sqrLen:S,normalize:M,exactEquals:I,equals:k,rotationTo:R,sqlerp:function(e,t,n,r,i,a){return d(P,t,i,a),d(G,n,r,a),d(e,P,G,2*a*(1-a)),e},setAxes:function(e,t,n,r){const i=L;return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=r[0],i[4]=r[1],i[7]=r[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],M(e,b(e,i))}})},501:function(e,t,n){"use strict";n.r(t),n.d(t,"buffer",(function(){return S})),n.d(t,"clip",(function(){return o})),n.d(t,"contains",(function(){return l})),n.d(t,"convexHull",(function(){return v})),n.d(t,"crosses",(function(){return u})),n.d(t,"cut",(function(){return c})),n.d(t,"densify",(function(){return L})),n.d(t,"difference",(function(){return j})),n.d(t,"disjoint",(function(){return f})),n.d(t,"distance",(function(){return h})),n.d(t,"equals",(function(){return d})),n.d(t,"extendedSpatialReferenceInfo",(function(){return s})),n.d(t,"flipHorizontal",(function(){return V})),n.d(t,"flipVertical",(function(){return P})),n.d(t,"generalize",(function(){return G})),n.d(t,"geodesicArea",(function(){return z})),n.d(t,"geodesicBuffer",(function(){return M})),n.d(t,"geodesicDensify",(function(){return F})),n.d(t,"geodesicLength",(function(){return H})),n.d(t,"intersect",(function(){return E})),n.d(t,"intersects",(function(){return p})),n.d(t,"isSimple",(function(){return O})),n.d(t,"nearestCoordinate",(function(){return I})),n.d(t,"nearestVertex",(function(){return k})),n.d(t,"nearestVertices",(function(){return R})),n.d(t,"offset",(function(){return T})),n.d(t,"overlaps",(function(){return g})),n.d(t,"planarArea",(function(){return D})),n.d(t,"planarLength",(function(){return U})),n.d(t,"relate",(function(){return y})),n.d(t,"rotate",(function(){return C})),n.d(t,"simplify",(function(){return _})),n.d(t,"symmetricDifference",(function(){return x})),n.d(t,"touches",(function(){return m})),n.d(t,"union",(function(){return w})),n.d(t,"within",(function(){return b}));var r=n(522),i=n(502);function a(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function s(e){return r.G.extendedSpatialReferenceInfo(e)}function o(e,t){return r.G.clip(i.hydratedAdapter,a(e),e,t)}function c(e,t){return r.G.cut(i.hydratedAdapter,a(e),e,t)}function l(e,t){return r.G.contains(i.hydratedAdapter,a(e),e,t)}function u(e,t){return r.G.crosses(i.hydratedAdapter,a(e),e,t)}function h(e,t,n){return r.G.distance(i.hydratedAdapter,a(e),e,t,n)}function d(e,t){return r.G.equals(i.hydratedAdapter,a(e),e,t)}function p(e,t){return r.G.intersects(i.hydratedAdapter,a(e),e,t)}function m(e,t){return r.G.touches(i.hydratedAdapter,a(e),e,t)}function b(e,t){return r.G.within(i.hydratedAdapter,a(e),e,t)}function f(e,t){return r.G.disjoint(i.hydratedAdapter,a(e),e,t)}function g(e,t){return r.G.overlaps(i.hydratedAdapter,a(e),e,t)}function y(e,t,n){return r.G.relate(i.hydratedAdapter,a(e),e,t,n)}function O(e){return r.G.isSimple(i.hydratedAdapter,a(e),e)}function _(e){return r.G.simplify(i.hydratedAdapter,a(e),e)}function v(e,t=!1){return r.G.convexHull(i.hydratedAdapter,a(e),e,t)}function j(e,t){return r.G.difference(i.hydratedAdapter,a(e),e,t)}function x(e,t){return r.G.symmetricDifference(i.hydratedAdapter,a(e),e,t)}function E(e,t){return r.G.intersect(i.hydratedAdapter,a(e),e,t)}function w(e,t=null){return r.G.union(i.hydratedAdapter,a(e),e,t)}function T(e,t,n,s,o,c){return r.G.offset(i.hydratedAdapter,a(e),e,t,n,s,o,c)}function S(e,t,n,s=!1){return r.G.buffer(i.hydratedAdapter,a(e),e,t,n,s)}function M(e,t,n,s,o,c){return r.G.geodesicBuffer(i.hydratedAdapter,a(e),e,t,n,s,o,c)}function I(e,t,n=!0){return r.G.nearestCoordinate(i.hydratedAdapter,a(e),e,t,n)}function k(e,t){return r.G.nearestVertex(i.hydratedAdapter,a(e),e,t)}function R(e,t,n,s){return r.G.nearestVertices(i.hydratedAdapter,a(e),e,t,n,s)}function A(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function C(e,t,n){var i;if(null==e)throw new Error("Illegal Argument Exception");const a=e.spatialReference;if(null==(n=null!=(i=n)?i:A(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(r.G.rotate(e,t,n));return s.spatialReference=a,s}function V(e,t){var n;if(null==e)throw new Error("Illegal Argument Exception");const i=e.spatialReference;if(null==(t=null!=(n=t)?n:A(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r.G.flipHorizontal(e,t));return a.spatialReference=i,a}function P(e,t){var n;if(null==e)throw new Error("Illegal Argument Exception");const i=e.spatialReference;if(null==(t=null!=(n=t)?n:A(e)))throw new Error("Illegal Argument Exception");const a=e.constructor.fromJSON(r.G.flipVertical(e,t));return a.spatialReference=i,a}function G(e,t,n,s){return r.G.generalize(i.hydratedAdapter,a(e),e,t,n,s)}function L(e,t,n){return r.G.densify(i.hydratedAdapter,a(e),e,t,n)}function F(e,t,n,s=0){return r.G.geodesicDensify(i.hydratedAdapter,a(e),e,t,n,s)}function D(e,t){return r.G.planarArea(i.hydratedAdapter,a(e),e,t)}function U(e,t){return r.G.planarLength(i.hydratedAdapter,a(e),e,t)}function z(e,t,n){return r.G.geodesicArea(i.hydratedAdapter,a(e),e,t,n)}function H(e,t,n){return r.G.geodesicLength(i.hydratedAdapter,a(e),e,t,n)}},502:function(e,t,n){"use strict";n.r(t),n.d(t,"hydratedAdapter",(function(){return c}));var r=n(99),i=n(204),a=n(110),s=n(125),o=n(134);const c={convertToGEGeometry:function(e,t){if(null==t)return null;let n="cache"in t?t.cache._geVersion:void 0;return null==n&&(n=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=n)),n},exportPoint:function(e,t,n){const r=e.hasZ(t),i=e.hasM(t),s=new a.a({x:e.getPointX(t),y:e.getPointY(t),spatialReference:n});return r&&(s.z=e.getPointZ(t)),i&&(s.m=e.getPointM(t)),s.cache._geVersion=t,s},exportPolygon:function(e,t,n){const r=new s.a({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return r.cache._geVersion=t,r},exportPolyline:function(e,t,n){const r=new o.a({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:n});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,n){const r=new i.a({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:n});return r.cache._geVersion=t,r},exportExtent:function(e,t,n){const i=e.hasZ(t),a=e.hasM(t),s=new r.a({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:n});if(i){const n=e.getZExtent(t);s.zmin=n.vmin,s.zmax=n.vmax}if(a){const n=e.getMExtent(t);s.mmin=n.vmin,s.mmax=n.vmax}return s.cache._geVersion=t,s}}},523:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(89);class i{constructor(){this._tasks=new Array}get length(){return this._tasks.length}push(e,t,n){return new Promise(((r,i)=>this._tasks.push(new a(r,i,e,t,n))))}unshift(e,t,n){return new Promise(((r,i)=>this._tasks.unshift(new a(r,i,e,t,n))))}process(){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const t=Object(r.n)(e.signal);if(t&&!e.abortCallback)e.reject(Object(r.e)());else{const n=t?e.abortCallback(Object(r.e)()):e.callback();Object(r.o)(n)?n.then(e.resolve,e.reject):e.resolve(n)}}catch(a){e.reject(a)}return!0}cancelAll(){const e=Object(r.e)();for(const t of this._tasks)if(t.abortCallback){const n=t.abortCallback(e);t.resolve(n)}else t.reject(e);this._tasks.length=0}}class a{constructor(e,t,n,r,i){this.resolve=e,this.reject=t,this.callback=n,this.signal=r,this.abortCallback=i}}},543:function(e,t,n){"use strict";function r(e){return 32+e.length}function i(e){if(!e)return 0;let t=32;for(const n in e)if(e.hasOwnProperty(n)){const i=e[n];switch(typeof i){case"string":t+=r(i);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function a(e,t){return 32+e.length*t}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}))},554:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(81),i=n(91),a=n(83),s=(n(79),n(84),n(80),n(82));let o=class extends i.a{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};Object(r.a)([Object(a.b)()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Object(r.a)([Object(a.b)()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=Object(r.a)([Object(s.a)("esri.views.support.DebugFlags")],o);const c=new o},562:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(81),i=n(91),a=n(80),s=n(85),o=n(89),c=n(83),l=(n(79),n(84),n(82)),u=n(595),h=n(636);const d=a.a.getLogger("esri.views.interactive.InteractiveToolBase");let p=class extends i.a{constructor(e){super(e),this.toolState="pending",this.completed=!1,this.manipulators=new h.a,this.updating=!1,this.automaticManipulatorSelection=!0,this._creationStartedResolver=Object(o.g)(),this._creationFinishedResolver=Object(o.g)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._set("visible",e),e||this.active&&(this.view.activeTool=null),this.attached&&(e?this._show():this._hide())}set editable(e){this._set("editable",e),this.manipulators.isToolEditable=e,this._updateManipulatorAttachment(),this.notifyChange("editable"),this.onEditableChange()}get attached(){return this._get("attached")}get created(){return"created"===this.toolState}get cursor(){return null}attach(){this.attached?d.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):d.error("Tool isn't currently attached. Ignoring detach request.")}activate(){Object(s.j)(this.view)?d.error("Can't activate tool if view is not defined."):this.active?d.warn("Tool is already active, ignoring activation request."):(Object(u.b)(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.active?this.onDeactivate():d.warn("Tool is not active, ignoring deactivation request.")}handleInputEvent(e){this.attached?this.onInputEvent(e):d.warn("handleInputEvent() called on detached tool")}handleInputEventAfter(e){this.attached?this.onInputEventAfter(e):d.warn("handleInputEventAfter() called on detached tool")}destroy(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)}whenCreationStarted(){return this._creationStartedResolver.promise}when(){return this._creationFinishedResolver.promise}rejectCreation(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}onActivate(){}onDeactivate(){}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}startToolCreation(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}}complete(){this.finishToolCreation(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible&&this.editable?this.manipulators.attach():this.manipulators.detach()}};Object(r.a)([Object(c.b)()],p.prototype,"toolState",void 0),Object(r.a)([Object(c.b)({constructOnly:!0})],p.prototype,"view",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"active",null),Object(r.a)([Object(c.b)({value:!0})],p.prototype,"visible",null),Object(r.a)([Object(c.b)({value:!0})],p.prototype,"editable",null),Object(r.a)([Object(c.b)({value:!1,readOnly:!0})],p.prototype,"attached",null),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"created",null),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"completed",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"manipulators",void 0),Object(r.a)([Object(c.b)({readOnly:!0})],p.prototype,"updating",void 0),Object(r.a)([Object(c.b)()],p.prototype,"cursor",null),Object(r.a)([Object(c.b)()],p.prototype,"automaticManipulatorSelection",void 0),p=Object(r.a)([Object(l.a)("esri.views.interactive.InteractiveToolBase")],p)},636:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(103),i=n(85);class a{constructor(){this._isToolEditable=!0,this._manipulators=new r.a,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){return this.addMany([e],t)[0]}addMany(e,t=0){return e.map((e=>{const n=this._nextManipulatorId++,r={id:n,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r),n}))}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.getItemAt(n).manipulator===t){const e=this._manipulators.splice(n,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this._manipulators.forEach((({manipulator:e})=>{e.destroy&&e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let n=null,r=Number.MAX_VALUE;return this._manipulators.forEach((({id:a,manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const c=s.intersectionDistance(e,t);Object(i.k)(c)&&c<r&&(r=c,n={id:a,manipulator:s})})),n}findById(e){if(Object(i.j)(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}},647:function(e,t,n){"use strict";function r(){return[1,0,0,1,0,0]}function i(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));Object.freeze({__proto__:null,create:r,clone:i,fromValues:function(e,t,n,r,i,a){return[e,t,n,r,i,a]},createView:function(e,t){return new Float64Array(e,t,6)}})},652:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));const r=["freehand","hybrid","click"],i="click"},682:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return h}));var r=n(104);const i={main:new r.a([255,127,0]),selected:new r.a([255,255,255]),outline:new r.a([0,0,0,.5]),selectedOutline:new r.a([255,255,255]),hoverOutline:new r.a([255,255,255]),secondary:new r.a([255,255,255]),secondaryOutline:new r.a([100,100,100]),transparent:new r.a([0,0,0,0])};function a(e,t){if(t)for(const n in t)e[n]=t[n]}class s{constructor(e){this.size=8,this.hoverSize=10,this.color=i.main,this.hoverColor=i.main,this.outlineColor=i.outline,this.hoverOutlineColor=i.hoverOutline,a(this,e)}}class o{constructor(e){this.color=i.secondary,this.hoverColor=i.main,a(this,e)}}class c{constructor(e){this.color=i.transparent,this.hoverColor=i.transparent,this.outlineColor=i.main,this.hoverOutlineColor=i.main,this.stagedColor=i.transparent,this.stagedOutlineColor=i.secondary,a(this,e)}}class l{constructor(e){this.vertex=new s,this.midpoint=new s({color:i.secondary,outlineColor:i.secondaryOutline,size:6}),this.selected=new s({color:i.selected,hoverColor:i.selected,hoverOutlineColor:i.hoverOutline}),a(this,e)}}class u{constructor(e){this.center=new s({color:i.secondaryOutline}),this.fill=new c,this.line=new o,this.vertex=new s({color:i.selected,outlineColor:i.main,hoverColor:i.selected,hoverOutlineColor:i.secondaryOutline}),a(this,e)}}const h=new class{constructor(e){this.reshapeGraphics=new l,this.transformGraphics=new u,a(this,e)}}},684:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(85),i=n(89),a=n(399),s=n(400),o=n(609),c=n(456);class l{constructor(){this.next=new s.a}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:n,snappingContext:l,updatingHandles:u}){if(Object(r.j)(n))return e=>e;let h=null,d=null;const p=()=>{h=Object(r.a)(h),n.doneSnapping(),Object(r.k)(d)&&d.frameTask.remove(),d=null};return t.next((e=>(p(),e))),this.next=new s.a,t=>{if(!e(t))return t;if(h=Object(r.a)(h),"start"===t.action){const e="3d"===n.view.type?n.view.resourceController.scheduler.registerTask(c.b.SNAPPING):c.a;d={context:new o.a({editGeometryOperations:l.editGeometryOperations,elevationInfo:l.elevationInfo,pointer:l.pointer,vertexHandle:Object(r.k)(t.info)?t.info.handle:null,excludeFeature:l.excludeFeature,visualizer:l.visualizer}),originalPos:Object(r.k)(t.snapOrigin)?l.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(Object(r.k)(d)){const e=d.context.coordinateHelper.vectorToDehydratedPoint(d.context.coordinateHelper.arrayToVector([d.originalPos.x,d.originalPos.y,d.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const r=t.mapStart.x-d.originalPos.x,s=t.mapStart.y-d.originalPos.y,o={...t,action:"udpate"},c=d.context,l=n.update(e,d.context);if(t.mapEnd.x=l.x+r,t.mapEnd.y=l.y+s,"end"!==t.action){const t=d.frameTask;h=Object(i.h)((async i=>{const u=await t.schedule((()=>n.snap(e,c,i)),i);if(u.valid){const e=await t.schedule((()=>u.apply()),i);Object(a.a)(e,l)||(o.mapEnd.x=e.x+r,o.mapEnd.y=e.y+s,this.next.execute(o))}})),u.addPromise(h.promise)}}return"end"===t.action&&p(),t}}}},716:function(e,t,n){"use strict";n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return d}));n(98);var r=n(85),i=n(318),a=n(647),s=n(485),o=n(384),c=n(111),l=n(101),u=n(110);function h(e,t,n=null){return Object(r.k)(n)?[e,t,n]:[e,t]}function d(e,t,n=null){return Object(r.k)(n)?{x:e,y:t,z:n}:{x:e,y:t}}class p{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return Object(r.g)(e.map((e=>this.mapToLocal(e))))}get doUnnormalization(){return!1}}class m extends p{constructor(e,t,n=null){super(t),this.defaultZ=n,this.transform=Object(a.b)(),this.transformInv=Object(a.b)(),this.transform=Object(a.a)(e),Object(i.a)(this.transformInv,this.transform)}makeMapPoint(e,t){return h(e,t,this.defaultZ)}mapToLocal(e){return d(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return h(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class b extends p{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=Object(l.e)(),this.tangentFrameUpWS=Object(l.e)(),this.tangentFrameRightWS=Object(l.e)(),this.tangentFrameForwardWS=Object(l.e)(),this.localFrameRightWS=Object(l.e)(),this.localFrameUpWS=Object(l.e)(),this.worldToLocalTransform=Object(o.b)(),this.localToWorldTransform=Object(o.b)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const r=Object(l.e)();Object(c.e)(r,this.tangentFrameForwardWS,Object(c.h)(n,this.tangentFrameForwardWS)),Object(c.j)(this.localFrameRightWS,n,r),Object(c.r)(this.localFrameRightWS,this.localFrameRightWS),Object(c.g)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Object(s.g)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Object(s.c)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return h(e,t,this.defaultZ)}mapToLocal(e){const t=Object(l.e)();this.view.renderCoordsHelper.toRenderCoords(new u.a({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Object(c.u)(t,t,this.worldToLocalTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r.k)(n)?d(n.x/this.scale,n.y/this.scale):null}localToMap(e){const t=Object(l.e)();this.view.renderCoordsHelper.toRenderCoords(new u.a({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Object(c.u)(t,t,this.localToWorldTransform);const n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return Object(r.k)(n)?h(n.x,n.y,this.defaultZ):null}}function f(e,t){if("2d"===e.type)return new m(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const n=t.length>2?new u.a({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new u.a({x:t[0],y:t[1],spatialReference:e.spatialReference});return new b(e,n)}return null}},798:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));n(98);var r=n(119),i=(n(139),n(188)),a=n(102),s=n(146),o=n(215),c=n(101),l=n(682),u=n(572),h=n(902),d=n(292),p=n(237),m=n(358),b=n(110),f=n(134);class g extends h.a{constructor(e){super(),this.graphicsLayer=e}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new b.a({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.coordinateHelper.spatialReference}),_)}visualizePoint(e,t){return this._visualizeSnappingIndicator(new b.a({x:e.point[0],y:e.point[1],spatialReference:t.coordinateHelper.spatialReference}),v)}visualizeLine(e,t){return this._visualizeSnappingIndicator(new f.a({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),j)}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new f.a({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),x)}visualizeRightAngleQuad(e,t){return this._visualizeSnappingIndicator(new f.a({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.coordinateHelper.spatialReference}),S(e))}_visualizeSnappingIndicator(e,t){const n=new r.a({geometry:e,symbol:t});return this.graphicsLayer.add(n),Object(i.c)((()=>{this.graphicsLayer.remove(n)}))}}const y=l.a.main.toArray(),O=[...l.a.main.toRgb(),100],_=new d.a({outline:new p.a({width:1.5,color:y}),size:15,color:[0,0,0,0]}),v=new d.a({outline:{width:.5,color:[0,0,0,1]},size:10,color:y}),j=new m.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Object(a.i)(u.a.lineHintWidthTarget),color:y}]}}}),x=new m.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:y}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:y}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),E=e=>new m.a({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Object(a.i)(u.a.rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Object(a.i)(u.a.rightAngleHintOutlineSize),color:y},{type:"CIMSolidFill",enable:!0,color:O}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),w=E(45),T=E(225),S=(()=>{const e=Object(o.a)(),t=Object(o.a)(),n=Object(c.e)();return r=>(Object(s.a)(e,r.centerVertex,r.previousVertex),Object(s.a)(t,r.nextVertex,r.previousVertex),Object(s.g)(n,e,t),n[2]<0?w:T)})()},800:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return c}));var r=n(85),i=n(102),a=n(373),s=n(338);class o{constructor(e,t,n,r=null){this.elevationInfo=e,this.defaultZ=t,this.view=n,this.excludeGraphics=r}screenToMap(e){if(Object(r.k)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(i.g)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(Object(i.g)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return Object(r.k)(t)&&(t.z=void 0),t}mapToScreen(e){const t=Object(a.g)(e.x,e.y,Object(s.a)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class c{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return Object(r.k)(t)&&(t.z=Object(s.g)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return Object(r.k)(this.elevationInfo)&&(t=Object(a.g)(e.x,e.y,Object(s.a)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class l{constructor(e){this.view=e,this.screenToMap=t=>e.toMap(t),this.mapToScreen=t=>e.toScreen(t)}}},815:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var r=n(81),i=n(122),a=n(160),s=n(87),o=n(85),c=n(89),l=n(102),u=n(83),h=(n(84),n(79),n(80),n(82)),d=n(399);class p{constructor({grabbableForEvent:e}){this.events=new i.a,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}var m=n(652),b=n(683),f=n(400),g=n(517),y=n(596),O=n(609),_=n(684),v=n(456);let j=class extends(i.a.EventedMixin(a.a)){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingPipeline=new _.a,this._snappingTask=null,this._stagedVertex=null,this.snapToSceneEnabled=null,Object(o.j)(e.elevationInfo)&&(this.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0})}initialize(){var e,t;this.coordinateHelper=Object(b.a)(this.hasZ,this.hasM,this.view.spatialReference);const n="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=n?n.registerTask(v.b.SNAPPING):v.a;const r="viewingMode"in this.view.state?this.view.state.viewingMode:2,i="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new y.a(new g.c(i,this.coordinateHelper,r)),this._activeComponent=new g.a(this.spatialReference,r),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),n=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:n,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:n,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:n,vertices:t})}}))),this._manipulator=new p({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(e=>this._onImmediateClick(e))),this._manipulator.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e)))])}destroy(){this._editGeometryOperations=Object(o.e)(this._editGeometryOperations),this._frameTask=Object(o.r)(this._frameTask)}get _snappingEnabled(){return Object(o.k)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}set drawingMode(e){this._set("drawingMode",null!=e?e:m.a)}get hasStagedVertex(){return Object(o.k)(this._stagedVertex)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return Object(o.k)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get spatialReference(){return this.view.spatialReference}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if(Object(o.j)(e))this.discardStagedVertex();else if(!Object(o.k)(this._stagedVertex)||!Object(d.a)(this._stagedVertex,e)){if(Object(o.j)(this._stagedVertex))this._stagedVertex=Object(s.a)(e);else{if(Object(d.a)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return Object(o.k)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingTask=Object(o.a)(this._snappingTask),Object(o.k)(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;Object(o.a)(this._snappingTask),Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();const n="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"})}discardStagedVertex(){this._stagedVertex=null}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Object(f.e)(e,((e,t,n,r)=>{const i="touch"===r&&this._snappingEnabled;!this.isCompleted&&i&&(t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||i&&0===this.numVertices)&&this.commitStagedVertex()),e))).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>i,cancel:n,snappingManager:this.snappingManager,snappingContext:new O.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:r,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((e=>(i&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e))),n.next((()=>{i&&Object(o.k)(this.snappingManager)&&this.snappingManager.doneSnapping()})))}))}_createManipulatorDragPipelineFreehand(e){return Object(f.e)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return Object(f.e)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}_getDrawSurface(){if(Object(o.j)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;Object(o.k)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),Object(o.k)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),Object(o.k)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const n=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&n>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_onHold(e){Object(o.a)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(this._manipulator.dragging)return;const t=this._activeComponent,n=this._closeOnClickVertexIndex(e.screenPoint);if(Object(o.k)(n))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();const r=this._screenToMap(e.screenPoint);if(Object(o.k)(r))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),this.complete());break;case"click":case"hybrid":this._snappingTask=Object(o.a)(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(r)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){if(Object(o.a)(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=Object(l.f)(e.x,e.y),n=this._closeOnClickVertexIndex(t);if(Object(o.k)(n)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:n,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[n].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const n=this._screenToMap(t);if(this._manipulator.cursor=Object(o.k)(n)?"crosshair":null,Object(o.k)(n))if(Object(o.k)(this.snappingManager)){const t=this.snappingManager,r=new O.a({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=t.update(n,r),this._snappingTask=Object(c.h)((async e=>{const i=await this._frameTask.schedule((()=>t.snap(n,r,e)),e);i.valid&&await this._frameTask.schedule((()=>{this.stagedVertex=i.apply()}),e)})),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=n}e.stopPropagation()}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),Object(o.j)(e))return null;const n=this._screenToMap(t.screenEnd);return Object(o.k)(n)?{...t,mapStart:e,mapEnd:n}:null}}_vertexWithinPointerDistance(e,t){const n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!Object(o.k)(n)&&function(e,t,n){const r=e.x-t.x,i=e.y-t.y;return r*r+i*i<=n}(n,t,25)}};Object(r.a)([Object(u.b)()],j.prototype,"defaultZ",void 0),Object(r.a)([Object(u.b)({value:m.a})],j.prototype,"drawingMode",null),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"elevationDrawSurface",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"elevationInfo",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"geometryType",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"hasM",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"hasZ",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"manipulators",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"drawSurface",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"snappingManager",void 0),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"snappingVisualizer",void 0),Object(r.a)([Object(u.b)()],j.prototype,"snapToSceneEnabled",void 0),Object(r.a)([Object(u.b)({readOnly:!0})],j.prototype,"updating",null),Object(r.a)([Object(u.b)({constructOnly:!0})],j.prototype,"view",void 0),j=Object(r.a)([Object(h.a)("esri.views.draw.DrawOperation")],j)}}]);
//# sourceMappingURL=38.2447b127.chunk.js.map