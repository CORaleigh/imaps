(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[37],{1172:function(e,t,a){"use strict";a.r(t),a.d(t,"applyEdits",(function(){return y})),a.d(t,"isEditableLayer",(function(){return m}));var r=a(7),n=a.n(r),s=a(10),i=a(16),d=a(21),u=a(6),o=a(20),l=a(11),p=a(40),c=a(72),h=a(353);function m(e){var t,a;return!0===(null==e||null==(t=e.capabilities)||null==(a=t.operations)?void 0:a.supportsEditing)&&e&&(!("editingEnabled"in e)||e.editingEnabled)}function f(e){return e&&null!=e.applyEdits}function y(e,t,a,r){return b.apply(this,arguments)}function b(){return(b=Object(i.a)(n.a.mark((function e(t,a,r,s){var i,u,o,l,p,c,h,m;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={edits:r,result:new Promise((function(e,t){i=e,u=t}))},t.emit("apply-edits",o),e.prev=2,e.next=5,g(t,a,r,s);case 5:return l=e.sent,p=l.results,c=l.edits,m={edits:c,addedFeatures:(h=function(e){return e.filter((function(e){return!e.error})).map(d.a)})(p.addFeatureResults),updatedFeatures:h(p.updateFeatureResults),deletedFeatures:h(p.deleteFeatureResults),addedAttachments:h(p.addAttachmentResults),updatedAttachments:h(p.updateAttachmentResults),deletedAttachments:h(p.deleteAttachmentResults)},e.abrupt("return",((m.addedFeatures.length||m.updatedFeatures.length||m.deletedFeatures.length||m.addedAttachments.length||m.updatedAttachments.length||m.deletedAttachments.length)&&t.emit("edits",m),i(m),p));case 13:throw e.prev=13,e.t0=e.catch(2),u(e.t0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,13]])})))).apply(this,arguments)}function g(e,t,a,r){return w.apply(this,arguments)}function w(){return(w=Object(i.a)(n.a.mark((function e(t,a,r,s){var i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.load();case 2:if(f(a)){e.next=4;break}return e.abrupt("return",Promise.reject(new o.a("".concat(t.type,"-layer:no-editing-support"),"Layer source does not support applyEdits capability",{layer:t})));case 4:if(t.editingEnabled){e.next=6;break}throw new o.a("".concat(t.type,"-layer:editing-disabled"),"Editing is disabled for layer",{layer:t});case 6:return e.next=8,F(t,r,s);case 8:if(!((i=e.sent).addFeatures.length||i.updateFeatures.length||i.deleteFeatures.length||i.addAttachments.length||i.updateAttachments.length||i.deleteAttachments.length)){e.next=17;break}return e.t1=i,e.next=13,a.applyEdits(i,s);case 13:e.t2=e.sent,e.t0={edits:e.t1,results:e.t2},e.next=18;break;case 17:e.t0={edits:i,results:{addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}};case 18:return e.abrupt("return",e.t0);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,a){var r=t&&(t.addFeatures||t.updateFeatures||t.deleteFeatures),n=t&&(t.addAttachments||t.updateAttachments||t.deleteAttachments);if(!t||!r&&!n)throw new o.a("".concat(e.type,"-layer:missing-parameters"),"'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!e.capabilities.data.isVersioned&&a&&a.gdbVersion)throw new o.a("".concat(e.type,"-layer:invalid-parameter"),"'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");if(!e.capabilities.editing.supportsRollbackOnFailure&&a&&a.rollbackOnFailureEnabled)throw new o.a("".concat(e.type,"-layer:invalid-parameter"),"This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");if(!e.capabilities.editing.supportsGlobalId&&a&&a.globalIdUsed)throw new o.a("".concat(e.type,"-layer:invalid-parameter"),"This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!e.capabilities.editing.supportsGlobalId&&n)throw new o.a("".concat(e.type,"-layer:invalid-parameter"),"'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((!a||!a.globalIdUsed)&&n)throw new o.a("".concat(e.type,"-layer:invalid-parameter"),"When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true");var i=Object(s.a)({},t);if(i.addFeatures=t&&p.a.isCollection(t.addFeatures)?t.addFeatures.toArray():i.addFeatures||[],i.updateFeatures=t&&p.a.isCollection(t.updateFeatures)?t.updateFeatures.toArray():i.updateFeatures||[],i.deleteFeatures=t&&p.a.isCollection(t.deleteFeatures)?t.deleteFeatures.toArray():i.deleteFeatures||[],i.addFeatures.length&&!e.capabilities.operations.supportsAdd)throw new o.a("".concat(e.type,"-layer:unsupported-operation"),"Layer does not support adding features.");if(i.updateFeatures.length&&!e.capabilities.operations.supportsUpdate)throw new o.a("".concat(e.type,"-layer:unsupported-operation"),"Layer does not support updating features.");if(i.deleteFeatures.length&&!e.capabilities.operations.supportsDelete)throw new o.a("".concat(e.type,"-layer:unsupported-operation"),"Layer does not support deleting features.");i.addAttachments=i.addAttachments||[],i.updateAttachments=i.updateAttachments||[],i.deleteAttachments=i.deleteAttachments||[],i.addFeatures=i.addFeatures.map(E),i.updateFeatures=i.updateFeatures.map(E);var d=a&&a.globalIdUsed;return i.addFeatures.forEach((function(t){return function(e,t,a){A(e,t,a)}(t,e,d)})),i.updateFeatures.forEach((function(t){return function(e,t,a){if(A(e,t,a),"geometry"in e&&Object(u.k)(e.geometry)&&!t.capabilities.editing.supportsGeometryUpdate)throw new o.a("".concat(t.type,"-layer:unsupported-operation"),"Layer does not support geometry updates.")}(t,e,d)})),i.deleteFeatures.forEach((function(t){return function(e,t,a){A(e,t,a)}(t,e,d)})),i.addAttachments.forEach((function(t){return v(t,e)})),i.updateAttachments.forEach((function(t){return v(t,e)})),function(e){return I.apply(this,arguments)}(i)}function A(e,t,a){if(a){if("attributes"in e&&!e.attributes[t.globalIdField])throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"Feature should have 'globalId' when 'globalIdUsed' is true");if(!("attributes"in e)&&!e.globalId)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"'globalId' of the feature should be passed when 'globalIdUsed' is true")}if("geometry"in e&&Object(u.k)(e.geometry)){if(e.geometry.hasZ&&!1===t.capabilities.data.supportsZ)throw new o.a("".concat(t.type,"-layer:z-unsupported"),"Layer does not support z values while feature has z values.");if(e.geometry.hasM&&!1===t.capabilities.data.supportsM)throw new o.a("".concat(t.type,"-layer:m-unsupported"),"Layer does not support m values while feature has m values.")}}function v(e,t){var a=e.feature,r=e.attachment;if(!a||"attributes"in a&&!a.attributes[t.globalIdField])throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"Attachment should have reference to a feature with 'globalId'");if(!("attributes"in a)&&!a.globalId)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"Attachment should have reference to 'globalId' of the parent feature");if(!r.globalId)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"Attachment should have 'globalId'");if(!r.data&&!r.uploadId)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"Attachment should have 'data' or 'uploadId'");if(!(r.data instanceof File&&r.data.name)&&!r.name)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!t.capabilities.editing.supportsUploadWithItemId&&r.uploadId)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"==typeof r.data){var n=Object(l.i)(r.data);if(n&&!n.isBase64)throw new o.a("".concat(t.type,"-layer:invalid-parameter"),"Attachment 'data' should be a Blob, File or Base64 encoded string")}}function I(){return(I=Object(i.a)(n.a.mark((function e(t){var a,r,s,i,d,u;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.addFeatures,r=t.updateFeatures,s=a.concat(r).map((function(e){return e.geometry})),e.next=5,Object(h.a)(s);case 5:return i=e.sent,d=a.length,u=r.length,e.abrupt("return",(i.slice(0,d).forEach((function(e,a){t.addFeatures[a].geometry=e})),i.slice(d,d+u).forEach((function(e,a){t.updateFeatures[a].geometry=e})),t));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){var t=new c.a;return e.attributes||(e.attributes={}),t.geometry=e.geometry,t.attributes=e.attributes,t}}}]);
//# sourceMappingURL=37.969b00a5.chunk.js.map