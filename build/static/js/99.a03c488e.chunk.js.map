{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/TileLayerView.js","../node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js"],"names":["i","c","e","t","a","o","this","layer","Promise","reject","s","type","get","allSublayers","toArray","filter","r","minScale","maxScale","popupTemplate","popupEnabled","visible","p","map","createQuery","event","renderer","geometry","createFetchPopupFeaturesQueryGeometry","getRequiredFields","outFields","queryFeatures","features","then","concat","value","Boolean","prototype","w","getLogger","d","_","arguments","_tileStrategy","_fetchQueue","tileInfo","spatialReference","equals","view","watch","refresh","addResolvingPromise","resampling","pause","state","update","resume","notifyChange","tileServers","_tileInfoView","n","fullExtent","tileInfoView","concurrency","length","process","fetchTile","u","cachePolicy","acquireTile","releaseTile","requestUpdate","container","requestRender","destroy","clear","removeAllChildren","updateRequested","suspended","reset","tiles","forEach","_enqueueTileFetch","_bitmapView","createTile","bitmap","getTileCoords","key","x","y","resolution","getTileResolution","size","width","height","addChild","abort","id","removeChild","once","tilemapCache","signal","_fetchImage","l","_createBlankImage","fetchAvailabilityUpsample","level","row","col","h","_resampleImage","has","push","source","error","timestamp","refreshTimestamp","getLODInfoAt","getXForColumn","m","getYForRow","f","g","Math","round","getContext","drawImage","document","createElement","I","xoffset","max","abs","yoffset","stops","maxSize","minSize","floor","pointerType","visualVariables","symbol","uniqueValueInfos","classBreakInfos","overlayPixelSizeInMapUnits","basemapSpatialReference","xmin","min","ymin","xmax","ymax","toMap","intersects"],"mappings":"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","file":"static/js/99.a03c488e.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{eachAlways as p}from\"../../core/promiseUtils.js\";import{calculateTolerance as a}from\"../../renderers/support/clickToleranceUtils.js\";const i=i=>{let c=class extends i{async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)return Promise.reject(new s(\"tilelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:o}));if(\"tile\"!==o.type)return Promise.reject(new s(\"tilelayerview:fetchPopupFeatures\",\"Layer type should be 'tile'\",{type:o.type}));const i=this.get(\"view.scale\"),c=o.allSublayers.toArray().filter((e=>{const r=0===e.minScale||i<=e.minScale,t=0===e.maxScale||i>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return p(c.map((async o=>{const s=o.createQuery(),p=r(t)?t.event:null,i=a({renderer:o.renderer,event:p});s.geometry=this.createFetchPopupFeaturesQueryGeometry(e,i),s.outFields=await o.popupTemplate.getRequiredFields();return(await o.queryFeatures(s)).features}))).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}};return e([t()],c.prototype,\"layer\",void 0),c=e([o(\"esri.layers.mixins.TileLayerView\")],c),c};export default i;export{i as TileLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{isNone as t}from\"../../../core/maybe.js\";import i from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as l}from\"../../../core/promiseUtils.js\";import o from\"../tiling/TileKey.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";import n from\"../tiling/TileInfoView.js\";import c from\"../tiling/TileQueue.js\";import u from\"../tiling/TileStrategy.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as p}from\"../../support/drapedUtils.js\";import{TileLayerView as f}from\"../../layers/TileLayerView.js\";import{LayerView2DMixin as g}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as y}from\"./BitmapTileLayerView2D.js\";const w=i.getLogger(\"esri.views.2d.layers.TileLayerView2D\"),d=[0,0];let _=class extends(f(h(y(g(m))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,t=e&&e.spatialReference;let i;t||(i=new a(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer})),t.equals(this.view.spatialReference)||(i=new a(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this layer does not meet the requirements of the view\",{layer:this.layer})),this.watch(\"resampling\",(()=>{this.refresh()})),i&&this.addResolvingPromise(Promise.reject(i))}get resampling(){return!(\"resampling\"in this.layer)||!1!==this.layer.resampling}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=\"tileServers\"in this.layer?this.layer.tileServers:null;this._tileInfoView=new n(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new c({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new u({cachePolicy:\"keep\",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return p(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(d,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,i){const r=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,s=!t(i)&&i.signal;if(!r)try{return await this._fetchImage(e,s)}catch(m){if(!l(m)&&!this.resampling)return this._createBlankImage();throw m}const a=new o(0,0,0,0);let h;try{if(await r.fetchAvailabilityUpsample(e.level,e.row,e.col,a,{signal:s}),a.level!==e.level&&!this.resampling)return this._createBlankImage();h=await this._fetchImage(a,s)}catch(m){if(l(m))throw m;h=await this._fetchImage(e,s)}const{level:n,row:c,col:u}=a;return this.resampling&&n!==e.level?this._resampleImage(h,n,c,u,e.level,e.row,e.col):h}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(t){l(t)||w.error(t)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{timestamp:this.refreshTimestamp,signal:t})}_resampleImage(e,t,i,r,s,a,l){const o=this._tileInfoView.tileInfo.size,h=this._tileInfoView.getTileResolution(t),n=this._tileInfoView.getTileResolution(s);let c=this._tileInfoView.getLODInfoAt(s);const u=c.getXForColumn(l),m=c.getYForRow(a);c=this._tileInfoView.getLODInfoAt(t);const p=c.getXForColumn(r),f=c.getYForRow(i),g=Math.round((u-p)/h),y=Math.round(-(m-f)/h),w=Math.round(o[0]*(n/h)),d=Math.round(o[1]*(n/h)),_=this._createBlankImage();return _.getContext(\"2d\").drawImage(e,g,y,w,d,0,0,o[0],o[1]),_}_createBlankImage(){const e=this._tileInfoView.tileInfo.size,t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}};e([r()],_.prototype,\"resampling\",null),_=e([s(\"esri.views.2d.layers.TileLayerView2D\")],_);var I=_;export default I;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":""}