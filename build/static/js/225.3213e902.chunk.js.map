{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js"],"names":["f","d","arguments","_handles","l","_tileStrategy","_fetchQueue","_tileRequests","Map","layer","this","activeLayer","tileMatrixSetId","tileMatrixSet","e","_getTileMatrixSetBySpatialReference","id","pause","state","update","resume","notifyChange","t","i","tileInfo","spatialReference","s","fullExtent","clone","isWebMercator","r","isWGS84","_tileInfoView","o","h","tileInfoView","process","fetchTile","u","cachePolicy","acquireTile","releaseTile","add","watch","_refresh","removeAll","destroy","clear","requestUpdate","a","updateRequested","suspended","length","_bitmapView","createTile","bitmap","getTileCoords","key","x","y","resolution","getTileResolution","size","width","height","fulfilled","promise","push","then","source","once","addChild","catch","finally","set","get","abort","delete","removeChild","level","row","col","reset","tiles","forEach","requestRender","view","tileMatrixSets","find","wkid","indexOf","p","c","n","prototype","readOnly","m"],"mappings":"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","file":"static/js/225.3213e902.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{geographicToWebMercator as r}from\"../../../geometry/support/webMercatorUtils.js\";import l from\"../../../core/Handles.js\";import{RefreshableLayerView as a}from\"../../layers/RefreshableLayerView.js\";import o from\"../tiling/TileInfoView.js\";import h from\"../tiling/TileQueue.js\";import u from\"../tiling/TileStrategy.js\";import n from\"../../layers/LayerView.js\";import{LayerView2DMixin as c}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as p}from\"./BitmapTileLayerView2D.js\";const f=[102113,102100,3857,3785,900913];let d=class extends(a(p(c(n)))){constructor(){super(...arguments),this._handles=new l,this._tileStrategy=null,this._fetchQueue=null,this._tileRequests=new Map,this.layer=null}get tileMatrixSet(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=this.layer.activeLayer,t=this.tileMatrixSet;if(!t)return;const i=t.tileInfo.spatialReference;let s=e.fullExtent&&e.fullExtent.clone();i.isWebMercator?s=r(s):i.isWGS84||(s=t.fullExtent),this._tileInfoView=new o(t.tileInfo,s),this._fetchQueue=new h({tileInfoView:this._tileInfoView,process:e=>this.fetchTile(e)}),this._tileStrategy=new u({cachePolicy:\"keep\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this._handles.add(this.watch([\"layer.activeLayer.styleId\",\"tileMatrixSet\"],(()=>this._refresh()))),super.attach()}detach(){super.detach(),this._handles.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}async doRefresh(){this.updateRequested||this.suspended||this._refresh()}isUpdating(){return this._fetchQueue.length>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;[i.x,i.y]=this._tileInfoView.getTileCoords([0,0],t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._tileInfoView.getTileCoords(i,t.key);const r={id:e.id,fulfilled:!1,promise:this._fetchQueue.push(t.key).then((e=>{t.bitmap.source=e,t.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(t)})).catch((e=>{s(e)||(t.bitmap.source=null,t.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(t))}))};return r.promise.finally((()=>r.fulfilled=!0)),this._tileRequests.set(t,r),this.requestUpdate(),t}releaseTile(e){const t=this._tileRequests.get(e);t.fulfilled||this._fetchQueue.abort(t.id),this._tileRequests.delete(e),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e){return this.layer.fetchTile(e.level,e.row,e.col)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}_refresh(){this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>{if(!e.bitmap.source)return;e.bitmap.source=null;const t={id:e.key.id,fulfilled:!1,promise:this._fetchQueue.push(e.key).then((t=>{e.bitmap.source=t,e.requestRender(),this.notifyChange(\"updating\")}))};t.promise.then((()=>t.fulfilled=!0),(()=>t.fulfilled=!0)),this._tileRequests.set(e,t)})),this.notifyChange(\"updating\")}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>e.tileInfo.spatialReference.wkid===t.wkid));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>f.indexOf(e.tileInfo.spatialReference.wkid)>-1))),i}};e([t()],d.prototype,\"suspended\",void 0),e([t({readOnly:!0})],d.prototype,\"tileMatrixSet\",null),d=e([i(\"esri.views.2d.layers.WMTSLayerView2D\")],d);var m=d;export default m;\n"],"sourceRoot":""}