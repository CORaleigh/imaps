(this.webpackJsonpimaps=this.webpackJsonpimaps||[]).push([[9,243],{1051:function(e,t,a){"use strict";a.d(t,"a",(function(){return y})),a.d(t,"b",(function(){return m}));var i,n,r,o,s,c,l=a(33),u=a(35),h=a(541),p=a(246),d=a(201),b=a(250),v=a(248),f=a(572),g=a(547);function m(e){var t=new p.a;return t.include(h.a,{linearDepth:!1}),t.include(g.a,e),t.include(f.a,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add(Object(u.a)(i||(i=Object(l.a)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      gl_Position = transformPosition(proj, view, vpos);\n  "])))),e.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(Object(u.a)(n||(n=Object(l.a)(["\n    vec4 vpos2 = transformPosition(proj, view, auxpos1);\n    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *= gl_Position.w;\n    "])),e.stippleIntegerRepeatsEnabled?"stipplePatternUv = floor(stipplePatternUv + 0.5);":""))),t.vertex.code.add(Object(u.a)(r||(r=Object(l.a)(["\n  }\n  "])))),4===e.output&&t.include(b.a),t.include(d.a,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(Object(u.a)(o||(o=Object(l.a)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",u.a.float(v.c),0===e.output?Object(u.a)(s||(s=Object(l.a)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?Object(u.a)(c||(c=Object(l.a)(["outputHighlight();"]))):"")),t}var y=Object.freeze({__proto__:null,build:m})},1053:function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return c}));var i,n,r=a(33),o=a(35),s=a(246);function c(){var e=new s.a;return e.extensions.add("GL_OES_standard_derivatives"),e.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.attributes.add("position","vec3"),e.attributes.add("uv0","vec2"),e.varyings.add("vUV","vec2"),e.vertex.code.add(Object(o.a)(i||(i=Object(r.a)(["\n    void main(void) {\n      vUV = uv0;\n      gl_Position = proj * view * vec4(position, 1.0);\n    }\n  "])))),e.fragment.uniforms.add("backgroundColor","vec4").add("gridColor","vec4").add("ratio","float").add("gridWidth","float"),e.fragment.code.add(Object(o.a)(n||(n=Object(r.a)(["\n    void main() {\n      const float LINE_WIDTH = 1.0;\n\n      vec2 uvScaled = vUV * gridWidth;\n      vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n      vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n\n      // mask aliasing along edges\n      grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n      grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n\n      float gridFade = max(grid.x, grid.y);\n\n      float gridAlpha = gridColor.a * gridFade;\n\n      // premultiply alpha in output\n      gl_FragColor =\n        vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n        vec4(gridColor.rgb, 1.0) * gridAlpha;\n    }\n  "])))),e}var l=Object.freeze({__proto__:null,build:c})},1054:function(e,t,a){"use strict";a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return v}));var i,n,r,o=a(33),s=a(35),c=a(541),l=a(246),u=a(354),h=a(201),p=a(298),d=a(248),b=a(296);function v(e){var t=new l.a;return t.include(c.a,{linearDepth:!1}),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.uniforms.add("textureCoordinateScaleFactor","vec2"),t.vertex.code.add(Object(s.a)(i||(i=Object(o.a)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(h.a,e),e.multipassTerrainEnabled&&(t.fragment.include(p.a),t.include(b.b,e)),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("opacity","float"),t.varyings.add("vTexCoord","vec2"),7===e.output?t.fragment.code.add(Object(s.a)(n||(n=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",s.a.float(d.b))):(t.fragment.include(u.a),t.fragment.code.add(Object(s.a)(r||(r=Object(o.a)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",s.a.float(d.b),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var f=Object.freeze({__proto__:null,build:v})},1101:function(e,t,a){"use strict";a.r(t),a.d(t,"createCircle",(function(){return M})),a.d(t,"createEllipse",(function(){return w})),a.d(t,"createMultipoint",(function(){return m})),a.d(t,"createPoint",(function(){return g})),a.d(t,"createPolygon",(function(){return O})),a.d(t,"createPolyline",(function(){return y})),a.d(t,"createRectangle",(function(){return _})),a.d(t,"createSquare",(function(){return j})),a.d(t,"makeMapPoint",(function(){return f}));var i=a(21),n=a(6),r=a(107),o=a(56),s=a(43),c=a(203),l=a(143),u=a(95),h=a(97),p=(a(78),a(62)),d=a(595),b=a(404),v=a(575);function f(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(n.k)(a)?[e,t,a]:[e,t]}function g(e,t){var a=new s.a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(a.z=e[2]),a}function m(e,t){return new c.a({points:e,spatialReference:t})}function y(e,t,a){var i=new h.a({paths:e,spatialReference:t});return a&&Object(l.i)(i),i}function O(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=Object(i.a)(e);s.forEach((function(e){var t=e[0],a=e[e.length-1];Object(r.c)(t,a)&&1!==e.length||e.push(e[0])}));var c=new u.a({rings:s,spatialReference:t});return c.rings.forEach((function(e){Object(l.g)(e,!1,!1)||e.reverse()})),a&&Object(l.i)(c),n&&c.isSelfIntersecting&&Object(o.i)(t)&&(c=Object(b.simplify)(c)),c}function j(e,t,a){var i=t.mapToLocalMultiple(e),r=[],o={x:i[0].x,y:i[0].y},s=i[1].x,c=i[1].y,l=Math.round(s-o.x),u=Math.round(c-o.y),h=Math.max(Math.abs(l),Math.abs(u));if(a){var p={x:o.x+h,y:o.y+h},d={x:o.x-h,y:o.y-h};r.push(Object(v.b)(p.x,d.y),Object(v.b)(d.x,d.y),Object(v.b)(d.x,p.y),Object(v.b)(p.x,p.y))}else{var b={x:l>0?o.x+h:o.x-h,y:u>0?o.y+h:o.y-h};r.push(Object(v.b)(o.x,o.y),Object(v.b)(b.x,o.y),Object(v.b)(b.x,b.y),Object(v.b)(o.x,b.y))}return O([Object(n.g)(r.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function _(e,t,a){var i=t.mapToLocalMultiple(e);if(1===i.length){var r=48,o=i[0];i=[Object(v.b)(o.x-r,o.y+r),Object(v.b)(o.x+r,o.y-r),Object(v.b)(o.x+r,o.y-r),Object(v.b)(o.x-r,o.y+r)]}var s=[],c={x:i[0].x,y:i[0].y},l={x:i[1].x,y:i[1].y};if(a){var u=Math.round(l.x-c.x),h=Math.round(l.y-c.y);s.push(Object(v.b)(c.x-u,c.y-h),Object(v.b)(l.x,c.y-h),Object(v.b)(l.x,l.y),Object(v.b)(c.x-u,l.y))}else s.push(Object(v.b)(c.x,c.y),Object(v.b)(l.x,c.y),Object(v.b)(l.x,l.y),Object(v.b)(c.x,l.y));return O([Object(n.g)(s.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function M(e,t,a,i){var r=t.mapToLocalMultiple(e),s=null,c=null;if(a)s=r[0],c=r[1];else{var u=r[0],h=r[1],f=Math.round(h.x-u.x),m=Math.round(h.y-u.y),y=Math.max(Math.abs(f),Math.abs(m));s=Object(v.b)(f>0?u.x+y/2:u.x-y/2,m>0?u.y+y/2:u.y-y/2),c=Object(v.b)(Math.abs(f)>Math.abs(m)?s.x-y/2:s.x,Math.abs(f)>Math.abs(m)?s.y:s.y-y/2)}var j=t.localToMap(s),_=t.localToMap(c);if(Object(n.j)(j)||Object(n.j)(_))return null;t.doUnnormalization&&Object(l.j)([[j,_]],t.spatialReference);var M=g(j,t.spatialReference),w=g(_,t.spatialReference),k=Object(p.f)(t.spatialReference),x=0;if(Object(o.i)(t.spatialReference))x=k*Object(b.distance)(M,w,null);else{var S=s.x-c.x,A=s.y-c.y;x=k*Math.sqrt(S*S+A*A)*(i||1)}var E=new d.a({center:M,radius:x,radiusUnit:"meters",spatialReference:t.spatialReference});return O(E.rings,E.spatialReference,!1)}function w(e,t,a){for(var i=t.mapToLocalMultiple(e),r=i[0],o=i[1],s=Math.round(o.x-r.x),c=Math.round(o.y-r.y),l=Object(v.b)(a?r.x:r.x+s/2,a?r.y:r.y+c/2),u=a?s:s/2,h=a?c:c/2,p=[],d=2*Math.PI/60,b=0;b<60;b++){var f=Math.cos(b*d),g=Math.sin(b*d),m=Object(v.b)(u*f+l.x,h*g+l.y);p.push(m)}return p.push(p[0]),O([Object(n.g)(p.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!1)}},1230:function(e,t,a){"use strict";a.r(t),a.d(t,"DrawOperation",(function(){return i.a})),a.d(t,"DrawGraphicTool",(function(){return Pe})),a.d(t,"GraphicMoveTool",(function(){return Ct})),a.d(t,"GraphicReshapeTool",(function(){return Nt})),a.d(t,"GraphicTransformTool",(function(){return na})),a.d(t,"ExtentTransformTool",(function(){return an}));var i=a(579),n=a(10),r=a(2),o=a(3),s=a(4),c=a(5),l=a(0),u=a(14),h=a(6),p=a(12),d=a(17),b=a(1),v=a(8),f=(a(11),a(18),a(19),a(70)),g=a(72),m=a(25),y=a(99),O=a(303),j=a(149),_=a(530),M=a(545),w=a(575),k=a(39),x=a(38),S=a(189),A=a(92),E=a(980),P={main:new x.a([255,127,0]),selected:new x.a([255,255,255]),staged:new x.a([12,207,255]),outline:new x.a([0,0,0,.5]),selectedOutline:new x.a([255,255,255])},D=.3;function G(e,t){var a=e.clone();return a.a*=t,a}function C(e,t){var a=e.clone(),i=Object(S.b)(a);i.s*=t;var n=Object(S.e)(i);return a.r=n.r,a.g=n.g,a.b=n.b,a}function R(e,t){if(t)for(var a in t)e[a]=t[a]}var T=function e(t){Object(r.a)(this,e),this.color=P.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,R(this,t)},I=function(){function e(t){Object(r.a)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=P.main,this.outlineColor=P.outline,this.renderOccluded=16,this.hoverOutlineColor=P.selectedOutline,R(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e,t){var a=this[e];t.setParameterValues({color:N(a),transparent:"color"!==e||a.a<1,renderOccluded:this.renderOccluded})}}]),e}(),V=function e(t){Object(r.a)(this,e),this.vertex=new I({color:P.main,outlineColor:P.outline}),this.edge=new I({color:C(G(P.main,2/3),.5),outlineColor:G(P.outline,.5),size:8,collisionPadding:8}),this.selected=new I({color:P.selected,outlineColor:P.outline}),R(this,t)},z=function(){function e(t){Object(r.a)(this,e),this.color=P.selected,this.width=1.5,this.stipplePattern=Object(E.b)([5,5]),this.stippleOffColor=P.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=P.selected,this.renderOccluded=4,R(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e){e.color=N(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=N(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=N(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),H=function(){function e(t){Object(r.a)(this,e),this.color=P.selected,this.size=4,this.outlineSize=1,this.outlineColor=P.outline,this.shape="square",R(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e){e.color=N(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=N(this.outlineColor),e.primitive=this.shape}}]),e}(),B=function(){function e(t){Object(r.a)(this,e),this.innerColor=P.selected,this.innerWidth=1,this.glowColor=P.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=D,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=P.main,R(this,t)}return Object(o.a)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a={glowColor:x.a.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:x.a.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=a:e.laserlineStyle=a}}]),e}(),F=function e(t){Object(r.a)(this,e),this.outline=new z({color:P.outline,renderOccluded:8,stippleOffColor:P.selected,stipplePattern:Object(E.b)([5,5]),width:1.5,innerWidth:0}),this.staged=new z({color:P.selected,renderOccluded:8,innerColor:P.staged,stippleOffColor:P.outline,stipplePattern:Object(E.b)([5,5]),width:1.5}),this.shadowStyle=new B({globalAlpha:D,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:1}),R(this,t)},q=function e(t){Object(r.a)(this,e),this.outline=new H({color:P.selected,outlineColor:P.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new B({globalAlpha:D,glowColor:P.main,glowFalloff:1.5,glowWidth:6,innerColor:P.selected,innerWidth:1,radius:2}),R(this,t)},L=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this)).extensionType=2,R(Object(k.a)(i),e),i}return a}(z),U=function e(t){Object(r.a)(this,e),this.lineGraphics=new F,this.pointGraphics=new q,this.heightPlane=new B({globalAlpha:D,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:1}),this.heightBox=new B({globalAlpha:D,glowColor:P.main,glowFalloff:8,glowWidth:8,innerColor:P.selected,innerWidth:0,heightFillColor:P.main}),this.zVerticalLine=new L({color:G(P.main,.5),falloff:2,innerColor:G(P.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,R(this,t)};function N(e){return Object(A.g)(x.a.toUnitRGBA(e))}var Z=new(function(){function e(t){Object(r.a)(this,e),this.visualElements=new U,this.reshapeManipulators=new V,this.zManipulator=new T,R(this,t)}return Object(o.a)(e,[{key:"colorToVec4",value:function(e){return N(e)}}]),e}()),W=a(15),X=a(26),Y=a(13),Q=a(130),J=a(83),K=a(161),$=a(221),ee=a(173),te=a(226),ae=a(564),ie=a(366),ne=a(253),re=a(82),oe=a(110),se=a(529),ce=a(227),le=function(){function e(t,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0;Object(r.a)(this,e),this.data=t,this.material=a,this.layerUid=i,this.graphicUid=n,this.boundingSphere=Object(A.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=o,this.material=a,this.origin=null,this.transformation=null,this.calculateShaderTransformation=c,s&&this.updateTransformation(s,l),this.castShadow=u}return Object(o.a)(e,[{key:"updateTransformation",value:function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.computeBoundingSphere(e,t,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this.shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t,a){Object(h.j)(this.boundingInfo)||(t=t||Object(ne.f)(e),Object(Y.l)(a,this.boundingInfo.getCenter(),e),a[3]=this.boundingInfo.getBSRadius()*t)}},{key:"hasShaderTransformation",get:function(){return Object(h.k)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return Object(h.j)(this.calculateShaderTransformation)?Object(h.r)(this.transformation,oe.a):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=Object(oe.b)()),Object(re.c)(this.shaderTransformation,this.calculateShaderTransformation(Object(h.r)(this.transformation,oe.a))),this.shaderTransformationDirty=!1),this.shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&(Object(h.k)(this.transformation)&&Object(Y.l)(e,e,this.transformation),!0);var t=this.indices.get("position"),a=this.vertexAttributes.get("position");return!!Object(te.c)(a,t,e)&&(Object(h.k)(this.transformation)&&Object(Y.l)(e,e,this.transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new se.a(0),t=this.instanceParameters;return t.highlights=Object(ce.b)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=Object(ce.f)(t.highlights,e)}}]),e}(),ue=a(1115),he=a(552),pe=a(622),de=a(31),be=a(179),ve=function(){function e(t){Object(r.a)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return Object(o.a)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return Object(h.k)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?Object(h.j)(this._resources)||(this.ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?Object(h.j)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources();this._resources={layerView:new fe({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},this._syncGeometriesToRenderer();var a=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;a&&a.registerDrapeSource(this._resources.layerView)}},{key:"_destroyResources",value:function(){var e;if(!Object(h.j)(this._resources)){this.ensureRenderGeometriesRemoved();var t=null==(e=this.resourceFactory.view.basemapTerrain)?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this.ensureRenderGeometriesAdded():this.ensureRenderGeometriesRemoved()}},{key:"ensureRenderGeometriesRemoved",value:function(){var e;!Object(h.j)(this._resources)&&null!=(e=this.resourceFactory.view)&&e.basemapTerrain&&this._resources.geometriesAdded&&(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.removeGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!1)}},{key:"ensureRenderGeometriesAdded",value:function(){Object(h.j)(this._resources)||this._resources.geometriesAdded||(this.resourceFactory.view.basemapTerrain.overlayManager.renderer.addGeometries(this._resources.external.geometries,this._resources.layerView,2),this._resources.geometriesAdded=!0)}}]),e}(),fe=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).drapeSourceType=1,i}return a}(Object(be.a)(de.a));Object(l.a)([Object(b.b)({constructOnly:!0})],fe.prototype,"view",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],fe.prototype,"drapeSourceType",void 0),fe=Object(l.a)([Object(v.a)("DrapedVisualElementLayerView")],fe);var ge=function(){function e(t){var a=this;Object(r.a)(this,e),this.view=null,this._attachmentOrigin=Object(ee.d)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new f.a,this._isDraped=!1,this._geometry=null,this._width=1,this._color=Object($.c)(1,0,1,1),this._innerWidth=0,this._innerColor=Object($.c)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this.resources=new pe.a({view:t.view,createResources:function(e){return a.createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,a.recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new ve({view:t.view,createResources:function(){return a.createDrapedResources()},recreateGeometry:function(e){e.geometries=a.createRenderGeometriesDraped(e.material),a.attachmentOriginChanged()}});var i=!0;for(var n in this._laserline=new he.a({view:t.view}),t)n in this?"attached"===n?i=t[n]:this[n]=t[n]:console.error("Cannot set unknown property",n);this.attached=i}return Object(o.a)(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&Object(h.k)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this.updateAttached(e)}},{key:"updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this.attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this.updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(J.g)(e,this._color)||(Object(J.c)(this._color,e),this.updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(J.g)(e,this._innerColor)||(Object(J.c)(this._innerColor,e),this.updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(h.k)(e)!==Object(h.k)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this.updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&Object(J.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?Object($.a)(e):null,this.updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,Object(h.k)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=Object(h.k)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;Object(Y.v)(Oe,0,0,0);var t,a=0,i=Object(W.a)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=n.vertexAttributes.get("position"),o=n.indices.get("position"),s=Object(h.q)(this.resources.resources).material.isClosed(r.data,o);Object(te.a)(r,o,s,ye)&&(Object(Y.e)(Oe,Oe,ye),a++)}}catch(c){i.e(c)}finally{i.f()}return 0===a?null:(Object(Y.d)(Oe,Oe,1/a),this.view.renderCoordsHelper.fromRenderCoords(Oe,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"updateMaterial",value:function(){Object(h.k)(this.resources.resources)&&this.resources.resources.material.setParameterValues(this.materialParameters),Object(h.k)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameterValues(this.materialParameters)}},{key:"isClosed",get:function(){return Object(h.k)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",stippleIntegerRepeats:!0,polygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&8===this._renderOccluded?4:this._renderOccluded}},{key:"recreateGeometry",value:function(e,t,a){var i,n=this.createRenderGeometries(),r=Object(W.a)(n);try{for(r.s();!(i=r.n()).done;){var o=i.value;e.addGeometry(o,t),a.push(o)}}catch(s){r.e(s)}finally{r.f()}this.attachmentOriginChanged()}},{key:"attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"createResources",value:function(e){var t=new ie.a(this.materialParameters),a=[];return this.recreateGeometry(e,t,a),{material:t,geometries:a,forEach:function(e){e(t),a.forEach(e)}}}},{key:"createDrapedResources",value:function(){var e=new ie.a(this.materialParameters);return{material:e,geometries:this.createRenderGeometriesDraped(e)}}},{key:"createRenderGeometriesDraped",value:function(e){var t=this.geometry;if(Object(h.j)(t))return[];var a,i=Object(ue.c)(t,this.view.basemapTerrain.spatialReference),n=[],r=Object(W.a)(i.lines);try{for(r.s();!(a=r.n()).done;){var o=a.value.position,s={attributeData:{position:o},removeDuplicateStartEnd:this.isClosed?1:0},c=new le(Object(ue.a)(s),e),l=Object(K.e)(me);Object(K.h)(l,o),Object(J.l)(c.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),n.push(c)}}catch(u){r.e(u)}finally{r.f()}return n}},{key:"calculateMapBounds",value:function(e){if(Object(h.j)(this.resources.resources))return!1;var t,a=this.view.renderCoordsHelper,i=Object(W.a)(this.resources.resources.geometries);try{for(i.s();!(t=i.n()).done;){var n=t.value.vertexAttributes.get("position"),r=new Float64Array(n.data.length);Object(Q.k)(n.data,a.spatialReference,0,r,this.view.spatialReference,0,n.data.length/3),Object(K.h)(e,r)}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"createRenderGeometries",value:function(){var e=this.geometry;if(Object(h.j)(e))return[];var t,a=Object(ue.b)(e,this.view.elevationProvider,this.view.renderCoordsHelper,ae.a.fromElevationInfo(this.elevationInfo)),i=[],n=[],r=Object(W.a)(a.lines);try{for(r.s();!(t=r.n()).done;){var o=t.value,s=o.position,c={attributeData:{position:s,mapPosition:o.mapPosition},removeDuplicateStartEnd:this.isClosed?1:0};i.push(Object(ue.a)(c)),n.push(s)}}catch(l){r.e(l)}finally{r.f()}return this._laserline.pathVerticalPlane=n,i}}]),e}(),me=Object(K.d)(),ye=Object(X.e)(),Oe=Object(X.e)(),je=a(274),_e=(a(143),a(444),a(592),a(559));Object(X.e)();var Me=a(362),we=a(1121),ke=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).view=null,i._renderOccluded=4,i._vertices=null,i._spatialReference=null,i._color=Z.colorToVec4(Z.reshapeManipulators.vertex.color),i._size=Z.reshapeManipulators.vertex.size,i._outlineColor=Z.colorToVec4(Z.reshapeManipulators.vertex.outlineColor),i._outlineSize=Z.reshapeManipulators.vertex.outlineSize,i._elevationInfo=null,i.applyProps(e),i}return Object(o.a)(a,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial(),this.updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){Object(J.g)(e,this._color)||(Object(J.c)(this._color,e),this.updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this.updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){Object(J.g)(e,this._outlineColor)||(Object(J.c)(this._outlineColor,e),this.updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSize:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSize:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameterValues(this.vertexMaterialParameters)}},{key:"updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameterValues(this.vertexOutlineMaterialParameters)}},{key:"createRenderGeometries",value:function(){var e=this.vertices;if(Object(h.j)(e)||0===e.length)return[];for(var t=function(e,t,a,i,n){var r=new Float64Array(3*e.length),o=new Float64Array(r.length);e.forEach((function(e,t){r[3*t+0]=e[0],r[3*t+1]=e[1],r[3*t+2]=e.length>2?e[2]:0}));var s=Object(_e.b)(r,t,0,o,0,r,0,r.length/3,a,i,n),c=null!=s;return{numVertices:e.length,position:r,mapPosition:o,projectionSuccess:c,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ae.a.fromElevationInfo(this.elevationInfo)),a=[],i=t.numVertices,n=t.position,r=0;r<i;++r){var o=Object(Y.v)(xe,n[3*r+0],n[3*r+1],n[3*r+2]),s=Se(.5,o),c=Se(.5,o);a.push({vertexGeometry:s,vertexOutlineGeometry:c})}return a}},{key:"createGeometries",value:function(e){var t,a=this.createRenderGeometries(),i=Object(W.a)(a);try{for(i.s();!(t=i.n()).done;){var n=t.value,r=n.vertexGeometry,o=n.vertexOutlineGeometry;e.addGeometry(r,this.vertexMaterial),e.addGeometry(o,this.vertexOutlineMaterial)}}catch(s){i.e(s)}finally{i.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new we.a(Object(n.a)(Object(n.a)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:2,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new we.a(Object(n.a)(Object(n.a)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),a}(Me.a),xe=Object(X.e)();function Se(e,t){return je.a.createSphereGeometry(e,16,16,{offset:t})}var Ae=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).tracking=!1,i.displaying=!1,i.isDraped=!1,i}return a}(f.a.EventedAccessor);Object(l.a)([Object(b.b)({constructOnly:!0})],Ae.prototype,"graphic",void 0),Object(l.a)([Object(b.b)()],Ae.prototype,"tracking",void 0),Object(l.a)([Object(b.b)()],Ae.prototype,"displaying",void 0),Object(l.a)([Object(b.b)()],Ae.prototype,"isDraped",void 0),Ae=Object(l.a)([Object(v.a)("esri.views.3d.layers.graphics.GraphicState")],Ae);var Ee=a(1101),Pe=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).drawOperation=null,i._createGraphic=null,i._createGraphicState=null,i._outlineVisualElement=null,i._verticesVisualElement=null,i._stagedVerticesVisualElement=null,i.hasZ=!0,i.defaultZ=0,i.elevationInfo=null,i.snapToScene=!1,i.snappingManager=null,i.mode=null,i.geometryType=null,i.type="draw-3d",i}return Object(o.a)(a,[{key:"initialize",value:function(){var e=this,t=Object(h.r)(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this._internalGraphicsLayer=new O.a({elevationInfo:t,listMode:"hide",internal:!0}),this.view.map.layers.add(this._internalGraphicsLayer),this.drawOperation=new i.a({view:this.view,manipulators:this.manipulators,geometryType:De(this.geometryType),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,snappingDrawSurface:new _.b(this.view,t,[this._internalGraphicsLayer]),elevationDrawSurface:new _.a(t,this.defaultZ,this.view,this._internalGraphicsLayer),hasM:!1,elevationInfo:t,snappingManager:this.snappingManager}),this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))}},{key:"destroy",value:function(){this.drawOperation.destroy(),this.drawOperation=null,this._destroyAllVisualisations(),this.view.map.remove(this._internalGraphicsLayer),this._set("view",null)}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"_getCreateGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==this.drawOperation)return null;var a=Object(h.k)(e)?e:this.drawOperation.hasStagedVertex?this.drawOperation.numVertices-1:null,i=this.drawOperation.vertices;if(0===i.length)return null;var n=this.drawOperation.spatialReference,r=i,o=r.slice(),s=[];Object(h.k)(a)&&(o.splice(a,1),s.push(r[a]));var c={regularVertices:null,stagedVertices:null,full:null,outline:null},l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":c.regularVertices=o,c.stagedVertices=s,c.full=this.drawOperation.coordinateHelper.createPointFromArray(i[0]);break;case"polyline":c.regularVertices=o,c.stagedVertices=s,r.length>0&&(c.full=Object(Ee.createPolyline)([r],n,l));break;case"polygon":c.regularVertices=o,c.stagedVertices=s,r.length>0&&(c.full=Object(Ee.createPolygon)([r],n,l,!0));break;case"circle":if(r.length>0){var u=Object(w.a)(this.view,i[0]);if(1===r.length&&t){var p=r[0],d=u.makeMapPoint(p[0]+Ge*this.view.resolution,p[1]);c.full=Object(Ee.createCircle)([p,d],u,!0)}else 2===r.length&&(c.full=this.forceUniformSize?Object(Ee.createCircle)(i,u,this.centered):Object(Ee.createEllipse)(i,u,this.centered))}break;case"rectangle":if(r.length>0){var b=Object(w.a)(this.view,i[0]);if(1===r.length&&t){var v=r[0],f=b.makeMapPoint(v[0]+Ge*this.view.resolution,v[1]);c.full=Object(Ee.createSquare)([v,f],b,!0)}else 2===r.length&&(c.full=this.forceUniformSize?Object(Ee.createSquare)(i,b,this.centered):Object(Ee.createRectangle)(i,b,this.centered))}break;default:return null}switch(this.geometryType){case"point":break;case"polyline":r.length>1&&(c.outline=Object(Ee.createPolyline)([r],n,l));break;case"polygon":r.length>1&&(c.outline=Object(Ee.createPolygon)([r],n,l));break;case"circle":case"rectangle":Object(h.k)(c.full)&&"polygon"===c.full.type&&(c.outline=Object(Ee.createPolygon)(c.full.rings,n,l))}return c}},{key:"_destroyAllVisualisations",value:function(){this._destroyCreateGraphic(),this._destroyOutlineVisualElement(),this._destroyVerticesVisualElement(),this._destroyStagedVerticesVisualElement()}},{key:"_destroyCreateGraphic",value:function(){Object(h.k)(this._createGraphic)&&(this._internalGraphicsLayer.remove(this._createGraphic),this._createGraphic.destroy(),this._createGraphic=null),this._createGraphicState=null,this.handles.remove(Ce)}},{key:"_destroyOutlineVisualElement",value:function(){Object(h.k)(this._outlineVisualElement)&&(this._outlineVisualElement.destroy(),this._outlineVisualElement=null)}},{key:"_destroyVerticesVisualElement",value:function(){Object(h.k)(this._verticesVisualElement)&&(this._verticesVisualElement.destroy(),this._verticesVisualElement=null)}},{key:"_destroyStagedVerticesVisualElement",value:function(){Object(h.k)(this._stagedVerticesVisualElement)&&(this._stagedVerticesVisualElement.destroy(),this._stagedVerticesVisualElement=null)}},{key:"_updateCreateGraphic",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=this._getCreateGeometry(t);if(Object(h.j)(a))this._destroyAllVisualisations();else{var i=this._internalGraphicsLayer.elevationInfo;Object(h.k)(a.outline)?Object(h.j)(this._outlineVisualElement)?(this._outlineVisualElement=new ge({view:this.view,geometry:a.outline,elevationInfo:Object(h.q)(i),isDraped:Object(h.k)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===Object(j.c)(this.hasZ,i),attached:!1}),Z.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),Z.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0):this._outlineVisualElement.geometry=a.outline:this._destroyOutlineVisualElement(),Object(h.k)(a.regularVertices)?Object(h.j)(this._verticesVisualElement)?(this._verticesVisualElement=new ke({view:this.view,spatialReference:this.view.spatialReference,vertices:a.regularVertices,elevationInfo:Object(h.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:Z.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0):this._verticesVisualElement.vertices=a.regularVertices:this._destroyVerticesVisualElement(),Object(h.k)(a.stagedVertices)?Object(h.j)(this._stagedVerticesVisualElement)?(this._stagedVerticesVisualElement=new ke({view:this.view,spatialReference:this.view.spatialReference,vertices:a.stagedVertices,elevationInfo:Object(h.q)(this._internalGraphicsLayer.elevationInfo),renderOccluded:Z.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._stagedVerticesVisualElement.color=Z.colorToVec4(Z.reshapeManipulators.selected.color),this._stagedVerticesVisualElement.attached=!0):this._stagedVerticesVisualElement.vertices=a.stagedVertices:this._destroyStagedVerticesVisualElement(),Object(h.k)(a.full)?Object(h.j)(this._createGraphic)?(this._createGraphic=new g.a({geometry:a.full,symbol:this.createGraphicSymbol}),this._internalGraphicsLayer.add(this._createGraphic),this.view.maskOccludee(this._createGraphic),this._createGraphicState=new Ae({graphic:this._createGraphic}),this.handles.add([this.view.trackGraphicState(this._createGraphicState),Object(m.a)(this._createGraphicState,"isDraped",(function(t){Object(h.k)(e._outlineVisualElement)&&(e._outlineVisualElement.isDraped=t)}))],Ce),this.notifyChange("createGraphic")):this._createGraphic.geometry=a.full:this._destroyCreateGraphic()}}},{key:"createGraphic",get:function(){return this._createGraphic}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"centered",set:function(e){this._set("centered",e),this._updateCreateGraphic()}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateCreateGraphic()}},{key:"reset",value:function(){}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"getVertexCoords",value:function(){return this.drawOperation.vertices}},{key:"onVertexAdd",value:function(e){this._updateCreateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateCreateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateCreateGraphic(),this.emit("vertex-update",e)}},{key:"onCursorUpdate",value:function(e){this._updateCreateGraphic(1===e.vertices.length?e.vertices[0].vertexIndex:null),this.emit("cursor-update",e)}},{key:"onComplete",value:function(e){this._updateCreateGraphic();var t=null;if(this.drawOperation.isCompleted){var a=this._getCreateGeometry(null,!0);Object(h.k)(a)&&(t=new g.a({geometry:a.full,symbol:this.createGraphicSymbol}))}this.emit("complete",Object(n.a)({graphic:t},e))}}]),a}(Object(y.b)(f.a.EventedMixin(M.a)));function De(e){switch(e){case"point":case"polyline":case"polygon":return e;case"circle":case"rectangle":return"segment";default:return null}}Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Pe.prototype,"view",void 0),Object(l.a)([Object(b.b)()],Pe.prototype,"createGraphicSymbol",void 0),Object(l.a)([Object(b.b)()],Pe.prototype,"createGraphic",null),Object(l.a)([Object(b.b)({value:!0})],Pe.prototype,"enabled",null),Object(l.a)([Object(b.b)({value:!0})],Pe.prototype,"centered",null),Object(l.a)([Object(b.b)({value:!0})],Pe.prototype,"forceUniformSize",null),Object(l.a)([Object(b.b)({constructOnly:!0})],Pe.prototype,"hasZ",void 0),Object(l.a)([Object(b.b)({nonNullable:!0})],Pe.prototype,"defaultZ",void 0),Object(l.a)([Object(b.b)({constructOnly:!0})],Pe.prototype,"elevationInfo",void 0),Object(l.a)([Object(b.b)()],Pe.prototype,"snapToScene",void 0),Object(l.a)([Object(b.b)()],Pe.prototype,"snappingManager",void 0),Object(l.a)([Object(b.b)({constructOnly:!0})],Pe.prototype,"mode",void 0),Object(l.a)([Object(b.b)({constructOnly:!0})],Pe.prototype,"geometryType",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],Pe.prototype,"type",void 0),Pe=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.draw3D.DrawTool")],Pe);var Ge=48,Ce="create-graphic",Re=a(137),Te=a(40),Ie=a(49),Ve=a(126),ze=a(365),He=a(333),Be=a(331),Fe=a(571),qe=a(518),Le=a(923),Ue=a(625);function Ne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(j.d)(e);return"on-the-ground"!==t.mode&&!(Object(h.j)(e.geometry)||!e.geometry.hasZ)}var Ze=a(46),We=a(584),Xe=a(916),Ye=function(){function e(){Object(r.a)(this,e),this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return Object(o.a)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,a){if(0===a&&(t.zManipulator=e),e instanceof Xe.a&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),Object(h.j)(t.firstGrabbedXY)&&e.grabbing&&1===a&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=1,a){case 0:t.grabbingState|=2;break;case 1:t.grabbingState|=4}}))}}]),e}();function Qe(e){var t=e.view,a=e.graphic,i=new Ae({graphic:a}),n=function(e,t){var a=e.view,i=e.graphic,n=new ge({view:a,geometry:Ke(i)?i.geometry:null,elevationInfo:Object(j.d)(i),attached:!1});Z.visualElements.lineGraphics.shadowStyle.apply(n);var r=function(){n.attached=t.displaying};Z.visualElements.lineGraphics.outline.apply(n);var o=[t.watch("displaying",r),t.watch("isDraped",(function(e){return n.isDraped=e})),t.on("changed",(function(){return n.geometry=Ke(i)?i.geometry:null})),Object(Re.a)(n)];return r(),{visualElement:n,remove:function(){return Object(Re.b)(o).remove()}}}(e,i),r=[n,Je(e,n.visualElement,i),t.maskOccludee(a),t.trackGraphicState(i)];return{visualElement:n.visualElement,remove:function(){return Object(Re.b)(r).remove()}}}function Je(e,t,a){var i=e.graphic,n=e.view,r=[],o=Object(j.d)(i),s="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,c=new Ye,l=new We.a({view:n,extensionType:Z.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Z.visualElements.pointGraphics.shadowStyle.apply(l);var u=Object(Ze.f)(Z.visualElements.heightPlaneAngleCutoff),p=new he.a({view:n,attached:!1,angleCutoff:u});Z.visualElements.heightPlane.apply(p);var d=1,b=1,v=function(){if(c.update(e),!a.displaying||s&&(a.isDraped||!Ke(i)||!i.geometry.hasZ))return t.laserlineEnabled=!1,l.attached=!1,void(p.attached=!1);t.laserlineEnabled=!0;var n=4&c.grabbingState?Z.visualElements.laserlineAlphaMultiplier:1;n!==d&&(d=n,Z.visualElements.lineGraphics.shadowStyle.apply(t,n),Z.visualElements.pointGraphics.shadowStyle.apply(l,n));var r=2&c.grabbingState?Z.visualElements.laserlineAlphaMultiplier:1;r!==b&&(b=r,Z.visualElements.heightPlane.apply(p,r)),function(e,t){var a=1===t.numSelected?t.firstSelected:t.numSelected>1&&Object(h.k)(t.firstGrabbedXY)?t.firstGrabbedXY:null;Object(h.k)(a)?(e.setStartEndFromWorldDownAtLocation(a.renderLocation),e.attached=!0):e.attached=!1}(l,c),function(e,t,a,i){if(i.numSelected>0){Object(Y.v)($e,0,0,0);var n=0;e.forEachManipulator((function(e,t){1===t&&e.selected&&e instanceof Xe.a&&(Object(Y.e)($e,$e,e.renderLocation),n++)})),n>0?(a.heightManifoldTarget=Object(Y.d)($e,$e,1/n),a.attached=!0):a.attached=!1}else{var r=t.attachmentOrigin;Object(h.k)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,$e)?(a.heightManifoldTarget=$e,a.attached=!0):a.attached=!1}}(e,t,p,c)};Z.visualElements.zVerticalLine.apply(l),r.push(a.on("changed",v),a.watch("displaying",v),t.events.on("attachment-origin-changed",v),Object(Re.a)(l),Object(Re.a)(p));var f=[],g=function(){Object(Re.b)(f).remove(),f.length=0,e.forEachManipulator((function(e){return f.push(e.events.on("grab-changed",v))})),e.forEachManipulator((function(e){return f.push(e.events.on("select-changed",v))})),v()};return g(),r.push(e.onManipulatorsChanged(g),Object(Re.d)((function(){return Object(Re.b)(f)}))),Object(Re.b)(r)}function Ke(e){return Object(h.k)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var $e=Object(X.e)(),et=a(105),tt=a(532);function at(e){var t=e.view,a=e.graphic,i=new Ae({graphic:a}),n=[],r=function(e,t,a){var i=e.view,n=e.graphic,r=new tt.a({view:i,geometry:it(n)?n.geometry:null,elevationInfo:Object(j.d)(n),attached:!1});return function(e,t,a,i){var n=function(){return t.attached=a.displaying};(function(e,t,a,i){var n=e.view,r=e.graphic,o=null,s=function(){Object(h.k)(o)&&(o.remove(),o=null),a.isDraped&&it(r)&&(o=function(e,t,a){var i=e.elevationProvider.spatialReference;Object(Q.o)(t,nt,i);var n=nt[0],r=nt[1];return e.elevationProvider.on("elevation-change",(function(e){Object(et.h)(e.extent,n,r)&&a()}))}(n,r.geometry,(function(){t.geometry=r.geometry})))},c=function(){s(),t.geometry=it(r)?r.geometry:null};i.push(a.on("changed",c),Object(Re.d)((function(){return o}))),c()})(e,t,a,i),Z.visualElements.pointGraphics.outline.apply(t),i.push(Object(m.a)(a,"displaying",n))}(e,r,t,a),a.push(Object(Re.a)(r)),r}(e,i,n);return function(e,t,a,i){var n=e.view,r=e.graphic,o=new We.a({view:n,extensionType:Z.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});Z.visualElements.zVerticalLine.apply(o);var s=new he.a({view:n,intersectsLineInfinite:!0,attached:!1});Z.visualElements.pointGraphics.shadowStyle.apply(s);var c=Object(Ze.f)(Z.visualElements.heightPlaneAngleCutoff),l=new he.a({view:n,attached:!1,angleCutoff:c});Z.visualElements.heightPlane.apply(l);var u=Object(j.d)(e.graphic),h=ae.a.fromElevationInfo(u),p="on-the-ground"===u.mode||!u.offset&&"absolute-height"!==u.mode,d=new Ye,b=1,v=1,f=function(){d.update(e);var a=p&&(t.isDraped||!it(r)||!r.geometry.hasZ),c=!0;if(!a&&it(r)){var u=r.geometry,f=Object(_e.c)(r.geometry,n.elevationProvider,h,n.renderCoordsHelper);Object(Y.v)(nt,u.x,u.y,f),Object(Q.r)(nt,u.spatialReference,nt,n.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(nt),s.intersectsWorldUpAtLocation=nt}else c=!1;var g=2&d.grabbingState?Z.visualElements.laserlineAlphaMultiplier:1;g!==b&&(b=g,Z.visualElements.heightPlane.apply(l,g));var m=Object(K.e)(rt);!a&&t.displaying&&i.calculateMapBounds(m)&&Object(Q.r)(Object(K.m)(m,nt),n.spatialReference,nt,n.renderCoordsHelper.spatialReference)?(l.heightManifoldTarget=nt,l.attached=!0):l.attached=!1;var y=4&d.grabbingState?Z.visualElements.laserlineAlphaMultiplier:1;y!==v&&(v=y,Z.visualElements.pointGraphics.shadowStyle.apply(s,y));var O=c&&t.displaying&&!a;s.attached=O,o.attached=O};a.push(t.watch(["displaying","isDraped"],f),t.on("changed",f)),e.forEachManipulator((function(e){a.push(e.events.on("grab-changed",f))})),a.push(Object(Re.a)(s)),a.push(Object(Re.a)(o)),a.push(Object(Re.a)(l)),f()}(e,i,n,r),n.push(t.trackGraphicState(i)),{visualElement:r,remove:function(){Object(Re.b)(n).remove()}}}function it(e){return Object(h.k)(e.geometry)&&"point"===e.geometry.type}var nt=Object(X.e)(),rt=Object(K.d)();function ot(e){switch(Object(h.q)(e.graphic.geometry).type){case"point":return at(e);case"polygon":case"polyline":return Qe(e);default:return null}}var st=[1,.5,0],ct=70,lt=Math.ceil(ct/3*2),ut=160,ht=5*Math.PI/12,pt=1*Math.PI/3;function dt(e,t,a){var i=e.graphic,n=function(e,a){return t({action:e,graphic:i,dxScreen:a.screenDeltaX,dyScreen:a.screenDeltaY})};return a((function(e,t,a){var r=t.next((function(e){return"start"===e.action&&n("start",e),e})).next(Object(Be.g)(i)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&n("update",e);break;case"end":n("end",e)}return e}));return a.next(Object(Be.i)(i)).next((function(){n("end",{screenDeltaX:0,screenDeltaY:0})})),r}))}function bt(e){if(Object(h.j)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var a=t[0],i=t[1];return Math.atan2(i[1]-a[1],i[0]-a[0])}var vt=function(){function e(){Object(r.a)(this,e),this._available=!0}return Object(o.a)(e,[{key:"location",set:function(e){this.forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this.forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this.forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this.forEachManipulator3D((function(t){return t.available=e}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(a){!t&&e(a)&&(t=!0)})),t}},{key:"forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,a){t instanceof Xe.a&&e(t,a)}))}}]),e}(),ft=a(53),gt=a(553),mt=a(917),yt=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this))._handles=new Ie.a,i._arrowManipulatorInfos=new Array,i._opaqueMaterial=i.createMaterial(),i._transparentMaterial=i.createMaterial(.5),i._angle=0,i._scale=1,i._radius=ct,i._updateAfterDrag=!1,i.events=new f.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i._createManipulators(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(o.a)(a,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles.removeAll(),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){this._arrowManipulatorInfos.map((function(t){var a=t.manipulator;return e(a,1)}))}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=t.graphic,r=Object(j.d)(n),o=Object(h.q)(n.geometry).spatialReference;return dt(t,a,(function(t){return i.createDragPipeline((function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)}),r,o,n)}))}},{key:"createDragPipeline",value:function(e,t,a,i){var r=this;return Object(Re.b)(this._arrowManipulatorInfos.map((function(o,s){var c=o.manipulator;return Object(Be.e)(c,(function(o,c,l,u,h){var p=c.next((function(e){return Object(n.a)(Object(n.a)({},e),{},{manipulatorType:1})})).next(Object(Be.f)(r._view,o.elevationAlignedLocation)).next(Object(mt.c)(r._view,o.elevationAlignedLocation,t,a,i)).next(Object(Be.d)(o.location,r.angle+(s+1)*Math.PI*.5)).next(Object(Be.c)());e(o,p,l,u,h)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var a=e.manipulator,i=e.transform,n=this._radius/ct,r=54*n,o=Math.sqrt(r*r*3/4),s=je.a.createExtrudedTriangle(o,r/2,r/2,.02);je.a.transformInPlace(s,Object(re.t)(ft.a.get(),Object(Y.v)(ft.d.get(),0,-o/3,0))),a.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:2},{geometry:s,material:this._transparentMaterial,stateMask:1}],a.radius=o/3*2*1.2;var c=Object(re.i)(ft.a.get());Object(re.u)(c,t*Math.PI/2);var l=Object(re.i)(ft.a.get());Object(re.t)(l,Object(Y.v)(ft.d.get(),0,100*n,0)),Object(re.l)(i,c,l)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=Object(re.i)(ft.a.get());Object(re.q)(t,t,e,Object(X.g)(0,0,1));var a=Object(re.o)(ft.a.get(),Object(Y.v)(ft.d.get(),this.displayScale,this.displayScale,this.displayScale)),i=Object(re.i)(ft.a.get());Object(re.l)(i,a,t);var n,r=Object(W.a)(this._arrowManipulatorInfos);try{for(r.s();!(n=r.n()).done;){var o=n.value,s=Object(re.l)(ft.a.get(),i,o.transform);o.manipulator.modelTransform=s}}catch(c){r.e(c)}finally{r.f()}}},{key:"_createArrowManipulator",value:function(e){var t=this,a=new Xe.a({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(X.g)(0,0,1)}}),i={manipulator:a,transform:Object(oe.b)()};return this._updateArrowManipulator(i,e),this._handles.add(a.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),i}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=x.a.toUnitRGBA(P.main);return t[3]*=e,new gt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),a}(vt),Ot=function(){function e(){Object(r.a)(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new Be.a,this._enabled=!1}return Object(o.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(h.k)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,a=this.snap(this.lastDragEvent.screenEnd);if(Object(h.k)(a)){var i={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?a:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(i)}}this._enabled=e}},{key:"snap",value:function(e){var t=Object(h.k)(this.view)?this.view.toMap(e,{exclude:[]}):null;return Object(h.k)(t)&&Object(h.k)(this.view)&&(t.z=Object(j.f)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var a=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(a.lastDragEvent="end"!==e.action?Object(n.a)({},e):null,a._enabled){var t=a.snap(e.screenEnd);return Object(h.k)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),jt=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this))._handles=new Ie.a,i._snapToScene=new Ot,i._discMaterial=i._createMaterial(),i._discMaterialTransparent=i._createMaterial(.5),i._scale=1,i._radius=ct,i._view=e.view,i._tool=e.tool,null!=e.snapToScene&&(i.snapToScene=e.snapToScene),null!=e.radius&&(i._radius=e.radius),i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(o.a)(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=t.graphic,r=Object(j.d)(n),o=Object(h.q)(n.geometry).spatialReference;return dt(t,a,(function(t){return i.createDragPipeline((function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)}),r,o,n)}))}},{key:"createDragPipeline",value:function(e,t,a,i){var r=this,o=this._view;return Object(Be.e)(this._manipulator,(function(s,c,l,u,h){var p=c.next(Object(Be.f)(o,s.elevationAlignedLocation)).next(Object(mt.c)(o,s.elevationAlignedLocation,t,a,i)).next(r._snapToScene.createDragEventPipelineStep(o,t),r._snapToScene.next).next((function(e){return Object(n.a)(Object(n.a)({},e),{},{manipulatorType:1})})).next(Object(Be.c)());e(s,p,l,u,h)}))}},{key:"_updateManipulatorTransform",value:function(){var e=Object(re.o)(ft.a.get(),Object(Y.v)(ft.d.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new Xe.a({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:Object(X.g)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=je.a.createCylinderGeometry(.02,1,128,Object(X.g)(0,0,1),Object(X.g)(0,0,0)),t=Object(re.o)(Object(oe.b)(),Object(X.g)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:2},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:1}],this._manipulator.radius=this._radius/ct*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=x.a.toUnitRGBA(P.main);return t[3]*=e,new gt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),a}(vt),_t=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this))._handles=new Ie.a,i._radius=ct,i.events=new f.a,i._tool=e.tool,i._view=e.view,null!=e.radius&&(i._radius=e.radius),i.createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(o.a)(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,0)}},{key:"createGraphicDragPipeline",value:function(e,t,a){var i=this,n=Object(h.q)(t.graphic.geometry).spatialReference;return dt(t,a,(function(t){return i.createDragPipeline((function(a,i,n,r,o){return t(a,e(a,i,n,r,o),n)}),n)}))}},{key:"createDragPipeline",value:function(e,t){var a=this._view;return Object(Be.e)(this._manipulator,(function(i,r,o,s,c){var l=r.next((function(e){return Object(n.a)(Object(n.a)({},e),{},{manipulatorType:0})})).next(Object(mt.g)(a,i.renderLocation,t)).next(Object(Be.c)());e(i,l,o,s,c)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this.updateManipulator())}},{key:"updateManipulator",value:function(){var e=this._radius/ct,t=Z.zManipulator.height*e,a=Z.zManipulator.coneHeight*e,i=Z.zManipulator.coneWidth*e,n=Z.zManipulator.width*e,r=[Object(X.g)(0,0,0),Object(X.g)(0,0,t)],o=je.a.createTubeGeometry(r,n/2,16,!1),s=je.a.createConeGeometry(a,i/2,16,!1),c=[Object(X.g)(0,0,0),Object(X.g)(0,0,t+a)],l=function(e){var a=Object(oe.b)();return Object(re.s)(a,a,[0,0,t]),Object(re.e)(a,a,Math.PI/2),a}(),u=function(e,t){var a=Object(S.a)(Z.zManipulator.color,t);return[a.r/255,a.g/255,a.b/255,Z.zManipulator.color.a*e]},h=Object(Le.c)(u(1,.25),1),p=Object(Le.c)(u(1,0),1),d=Object(Le.c)(u(.7,0),Z.zManipulator.renderOccluded),b=Object(Le.c)(u(.85,0),Z.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:s,transform:l,material:h,stateMask:1},{geometry:o,material:h,stateMask:1},{geometry:s,transform:l,material:p,stateMask:2},{geometry:o,material:p,stateMask:2},{geometry:s,transform:l,material:d,stateMask:1},{geometry:o,material:d,stateMask:1},{geometry:s,transform:l,material:b,stateMask:2},{geometry:o,material:b,stateMask:2}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}},{key:"createManipulator",value:function(){var e=this,t=new Xe.a({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var a=e._view.state.camera,i=Mt;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,i);var n=Object(Y.z)(a.eye,i),r=a.computeRenderPixelSizeAtDist(n),o=Object(Y.i)(wt,i,a.eye);Object(Y.q)(o,o);var s=kt;e._view.renderCoordsHelper.worldUpAtPosition(Mt,s);var c=Math.abs(Object(Y.g)(o,s)),l=Object(Y.f)(wt,o,s),u=Object(Y.f)(wt,l,s),h=Object(Ze.d)(c,.01,1),p=1-Math.sqrt(1-h*h)/h/a.fullWidth,d=e._radius/ct,b=Z.zManipulator.width*d;Object(Y.d)(u,Object(Y.q)(u,u),(1/p-1)*n+r*b),t[12]-=wt[0],t[13]-=wt[1],t[14]-=wt[2]},this._manipulator=t,this.updateManipulator()}}]),a}(vt),Mt=Object(X.e)(),wt=Object(X.e)(),kt=Object(X.e)(),xt=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;Object(r.a)(this,a),(i=t.call(this))._handles=new Ie.a,i._angleDeferred=null,i._interactive=!0;var n=e.tool,o=e.view,s=e.snapToScene,c=e.radius;return i._view=o,i.xyManipulation=new jt({tool:n,view:o,snapToScene:s,radius:c}),i.xyAxisManipulation=new yt({tool:n,view:o,radius:c}),i.zManipulation=new _t({tool:n,view:o,radius:c}),i.xyManipulation.available=e.xyAvailable,i.xyAxisManipulation.available=e.xyAxisAvailable,i.zManipulation.available=e.zAvailable,i.autoHideXYAxis(),i.forEachManipulator((function(e){i._handles.add(e.events.on("grab-changed",(function(){return i.updateManipulatorInteractivity()})))})),i}return Object(o.a)(a,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,a){return Object(Re.b)([this.xyManipulation.createGraphicDragPipeline((function(t,a,i,n,r){return e(0,t,a,i,n,r)}),t,a),this.xyAxisManipulation.createGraphicDragPipeline((function(t,a,i,n,r){return e(1,t,a,i,n,r)}),t,a),this.zManipulation.createGraphicDragPipeline((function(t,a,i,n,r){return e(2,t,a,i,n,r)}),t,a)])}},{key:"createDragPipeline",value:function(e,t,a,i){return Object(Re.b)([this.xyManipulation.createDragPipeline((function(t,a,i,n,r){return e(0,t,a,i,n,r)}),t,a,i),this.xyAxisManipulation.createDragPipeline((function(t,a,i,n,r){return e(1,t,a,i,n,r)}),t,a,i),this.zManipulation.createDragPipeline((function(t,a,i,n,r){return e(2,t,a,i,n,r)}),a)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this.updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,1)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,1)})),this.zManipulation.forEachManipulator((function(t){return e(t,0)}))}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,a=this.xyManipulation;if(!Object(u.a)("esri-mobile")){var i=[];a.forEachManipulator((function(e){return i.push(e)})),t.forEachManipulator((function(e){return i.push(e)}));for(var n=function(){var a=[];e.xyAxisVisible?Object(h.k)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return a.push(e.disableDisplay())})),e._handles.remove(St),e._handles.add(a,St)},r=0,o=i;r<o.length;r++){var s=o[r];this._handles.add(s.events.on("focus-changed",n))}this._view.inputManager&&this._handles.add(this._view.inputManager.watch("latestPointerType",n)),n()}}},{key:"updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(a){a.interactive=!t&&e._interactive||a.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=Object(h.k)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?lt:ct}}]),a}(vt),St="disable-xy-axis-display",At=a(908),Et=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this))._handles=new Ie.a,i._view=e.view,i._tool=e.tool,i._graphicState=e.graphicState,i._createManipulator(),i.forEachManipulator((function(e){return i._tool.manipulators.add(e)})),i}return Object(o.a)(a,[{key:"destroy",value:function(){var e=this;this._handles.destroy(),this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,1)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return dt(this._graphicState,e,(function(e){return t.createDragPipeline(e)}))}},{key:"createDragPipeline",value:function(e){var t=this._view,a=this._graphicState.graphic,i=Object(h.k)(a.geometry)?a.geometry.spatialReference:null;return Object(Be.e)(this._manipulator,(function(n,r,o,s,c){var l=r.next(Object(mt.d)(c,t,a,i)).next(Object(Be.b)()).next(Object(Be.c)());e(n,l,o,s,c)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new At.a({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),a}(vt),Pt=function e(t){Object(r.a)(this,e),this.allGraphics=t,this.type="graphic-move-start"},Dt=function e(t,a,i){Object(r.a)(this,e),this.dx=t,this.dy=a,this.allGraphics=i,this.type="graphic-move"},Gt=function e(t){Object(r.a)(this,e),this.allGraphics=t,this.type="graphic-move-stop"},Ct=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).graphics=new Te.a,i.enableZ=!0,i.type="move-3d",i._toolHandles=new Ie.a,i._handles=new Ie.a,i.snappingPipeline=new Fe.a,i}return Object(o.a)(a,[{key:"initialize",value:function(){var e=this;this._toolHandles.add([this.graphics.on("change",(function(){return e._refreshManipulators()}))]),this._refreshManipulators()}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._toolHandles.destroy(),this._toolHandles=null,this.graphics.removeAll(),this._set("view",null)}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this._handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return 0===Object(Ue.a)(e)})).map((function(e){return new Rt(e)}));t.length&&(this.createManipulators(t),this.createVisualElements(t),this._handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this.updateMoveManipulation(t))}},{key:"createManipulators",value:function(e){var t,a=this,i=Object(W.a)(e);try{var r=function(){var i=t.value,r=i.state;i.manipulationXY=new Et({tool:a,view:a.view,graphicState:r}),i.manipulationXY.forEachManipulator((function(e){return a._handles.add(e.events.on("immediate-click",(function(e){a.emit("immediate-click",Object(n.a)(Object(n.a)({},e),{},{graphic:r.graphic})),e.stopPropagation()})))})),a._handles.add(i.manipulationXY.createDragPipeline((function(t,i,n,r){return a.buildDragEventPipeline(e,0,t,i,n,r)})))};for(i.s();!(t=i.n()).done;)r()}catch(o){i.e(o)}finally{i.f()}this.createMoveManipulation(e)}},{key:"createMoveManipulation",value:function(e){var t=this,a=new xt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?xt.radiusForSymbol(e[0].graphic.symbol):ct});this._moveManipulation=a,a.elevationInfo={mode:"absolute-height",offset:0},a.forEachManipulator((function(e){t._handles.add(e.events.on("immediate-click",(function(i){a.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",Object(n.a)(Object(n.a)({},i),{},{graphic:t.graphics.getItemAt(0)})),i.stopPropagation()})))}));var i,r=function(){return t.updateMoveManipulation(e)},o=Object(W.a)(e);try{for(o.s();!(i=o.n()).done;){var s=i.value;this._handles.add([s.state.on("changed",r),s.state.watch("displaying",r)])}}catch(l){o.e(l)}finally{o.f()}var c=e[e.length-1];this._handles.add(c.state.on("changed",(function(){return t.updateMoveManipulationAngle(c)}))),this._handles.add(a.createDragPipeline((function(a,i,n,r,o){return t.buildDragEventPipeline(e,a,i,n,r,o)}),Object(j.d)(c.graphic),Object(h.q)(c.graphic.geometry).spatialReference,c.graphic)),this.updateMoveManipulationAngle(c)}},{key:"createVisualElements",value:function(e){var t,a=this,i=Object(W.a)(e);try{var n=function(){var i=t.value,n=i.graphic,r=ot({view:a.view,graphic:n,forEachManipulator:function(e){i.manipulationXY.forEachManipulator(e),a._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return Object(Re.c)()}});i.geometryRepresentation=r.visualElement,i.geometryRepresentation instanceof ge&&a._handles.add([i.geometryRepresentation.events.on("attachment-origin-changed",(function(){i.state.isDraped||a.updateMoveManipulation(e)})),i.state.watch("isDraped",(function(){return a.updateMoveManipulation(e)}))]),a._handles.add(r)};for(i.s();!(t=i.n()).done;)n()}catch(r){i.e(r)}finally{i.f()}}},{key:"updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return bt(e.graphic.geometry)}}},{key:"updateMoveManipulation",value:function(e){var t,a=Object(ee.d)(0,0,0,this.view.spatialReference),i=0,n=!1,r=this._moveManipulation,o=Object(W.a)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(s.state.displaying){var c=s.state.graphic;this.enableZ&&Ne(c)&&(n=!0);var l=s.geometryRepresentation instanceof ge&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Object(Le.f)(this.view,c);Object(h.k)(l)&&(a.x+=l.x,a.y+=l.y,a.z+=l.z,i++)}}}catch(u){o.e(u)}finally{o.f()}i>0?(a.x/=i,a.y/=i,a.z/=i,r.location=a,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=n):r.available=!1}},{key:"buildDragEventPipeline",value:function(e,t,a,i,n,r){var o=this,s=[],c=[],l=null,u=null,h=function(){var e,t=Object(W.a)(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(a){t.e(a)}finally{t.f()}s.length=0,c.length=0,l=null,u=null,o._moveManipulation.interactive=!0};if(1===e.length&&0===t){var p=e[0].graphic;i=this.buildSnappingPipelineSteps(p,Object(j.d)(p),i,n,r)}var d=i.next((function(t){if("start"===t.action){s.length=0,c.length=0;var i,n=Object(W.a)(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;r.dragging||!r.manipulationXY.hasManipulator(a)&&r.manipulationXY.grabbing||(s.push(r),c.push(r.graphic),r.dragging=!0)}}catch(h){n.e(h)}finally{n.f()}if(0!==c.length&&(o._moveManipulation.interactive=!1,l=Object(Be.h)(c),u=Object(Be.j)(c),o.emit("graphic-move-start",new Pt(c)),o.destroyed))return null}return 0!==c.length?t:null})).next((function(e){return l(e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),a=o.view.toScreen(e.mapEnd),i=a.x-t.x,n=a.y-t.y;if(o.emit("graphic-move",new Dt(i,n,c)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new Gt(c)),o.destroyed)return null;h()}}));return n.next((function(e){return u(e)})).next((function(){if(o.emit("graphic-move-stop",new Gt(c)),o.destroyed)return null;h()})),d}},{key:"buildSnappingPipelineSteps",value:function(e,t,a,i,r){var o=this,s=e.geometry;if(Object(h.j)(s)||"point"!==s.type)return a;var c=new He.a({elevationInfo:t,pointer:r,geometry:new ze.a(Ve.c.fromGeometry(s,this.view.viewingMode),"point"),visualizer:new qe.a,excludeFeature:e}),l=this.snappingManager;return a.next((function(t){var a=s.clone();return a.z=Object(j.a)(o.view,a,Object(j.d)(e),{mode:"absolute-height",offset:0}),Object(n.a)(Object(n.a)({},t),{},{snapOrigin:c.coordinateHelper.fromPoint(a)})})).next(this.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:l,cancel:i}),this.snappingPipeline.next)}}]),a}(f.a.EventedMixin(M.a));Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"view",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],Ct.prototype,"graphics",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Ct.prototype,"enableZ",void 0),Object(l.a)([Object(b.b)({constructOnly:!0})],Ct.prototype,"snappingManager",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],Ct.prototype,"type",void 0),Ct=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Ct);var Rt=function(){function e(t){Object(r.a)(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Ae({graphic:t})}return Object(o.a)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),Tt=a(502),It=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._vertexManipulatorMaterial=Object(Le.c)(Z.colorToVec4(Z.reshapeManipulators.vertex.color),Z.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorOutlineMaterial=Object(Le.d)(Z.colorToVec4(Z.reshapeManipulators.vertex.outlineColor),Z.reshapeManipulators.vertex.renderOccluded),i._vertexManipulatorHoverOutlineMaterial=Object(Le.d)(Z.colorToVec4(Z.reshapeManipulators.vertex.hoverOutlineColor),Z.reshapeManipulators.vertex.renderOccluded),i._edgeManipulatorMaterial=Object(Le.c)(Z.colorToVec4(Z.reshapeManipulators.edge.color),Z.reshapeManipulators.edge.renderOccluded),i._edgeManipulatorOutlineMaterial=Object(Le.d)(Z.colorToVec4(Z.reshapeManipulators.edge.outlineColor),Z.reshapeManipulators.edge.renderOccluded),i._selectedManipulatorMaterial=Object(Le.c)(Z.colorToVec4(Z.reshapeManipulators.selected.color),Z.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorOutlineMaterial=Object(Le.d)(Z.colorToVec4(Z.reshapeManipulators.selected.outlineColor),Z.reshapeManipulators.selected.renderOccluded),i._selectedManipulatorHoverOutlineMaterial=Object(Le.d)(Z.colorToVec4(Z.reshapeManipulators.selected.hoverOutlineColor),Z.reshapeManipulators.selected.renderOccluded),i._selectedIndex=0,i._vertexManipulatorGeometry=null,i._vertexManipulatorOutlineGeometry=null,i._edgeManipulatorGeometry=null,i._edgeManipulatorOutlineGeometry=null,i._handles=new Ie.a,i._manipulatorHandles=new Ie.a,i._manipulatorInfos=[],i._reshapeHelper=null,i._graphicMoveManipulation=null,i._moveManipulation=null,i._numGrabbing=0,i._numDragging=0,i._reshapeEventState=0,i._outlineVisualElement=null,i.tool=null,i.outputGeometry=null,i._snappingPipeline=new Fe.a,i._snappingPipelineHandle=new Fe.a,i._vertexLaserLineVisualElement=null,i}return Object(o.a)(a,[{key:"initialize",value:function(){var e=this,t=new Ae({graphic:this.graphic});this._graphicState=t,this._handles.add([t.watch("displaying",(function(t){var a,i=Object(W.a)(e._manipulatorInfos);try{for(i.s();!(a=i.n()).done;){a.value.manipulator.available=t}}catch(n){i.e(n)}finally{i.f()}})),this.view.trackGraphicState(t)])}},{key:"destroy",value:function(){this._clear(),this._handles.destroy()}},{key:"inputGeometry",get:function(){return Object(h.k)(this._reshapeHelper)?this._reshapeHelper.geometry:null},set:function(e){this._recreateManipulators(e)}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZ",get:function(){return this.tool.enableZ}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.handle.type}));this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_clear",value:function(){this._moveManipulation=Object(h.e)(this._moveManipulation),this._graphicMoveManipulation=Object(h.e)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[],this._reshapeHelper=Object(h.e)(this._reshapeHelper),this._numGrabbing=0,this._numDragging=0}},{key:"_recreateManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;if(this._clear(),!Object(h.j)(e)){Object(h.e)(this._reshapeHelper),this._reshapeHelper=new Ut(Ve.c.fromGeometry(e,this.view.viewingMode),e.type);var t,a=Object(j.d)(this.graphic),i=Object(W.a)(this._reshapeHelper.editGeometry.components);try{for(i.s();!(t=i.n()).done;){var n,r=t.value,o=Object(W.a)(r.vertices);try{for(o.s();!(n=o.n()).done;){var s=n.value;this._createPerVertexManipulator(s,a)}}catch(p){o.e(p)}finally{o.f()}var c,l=Object(W.a)(r.edges);try{for(l.s();!(c=l.n()).done;){var u=c.value;this._createPerVertexManipulator(u,a)}}catch(p){l.e(p)}finally{l.f()}}}catch(p){i.e(p)}finally{i.f()}this._createGraphicMoveManipulators(a)}}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"!==t.action){var a,i=[],n=this._manipulatorInfos.some((function(e){return"vertex"===e.handle.type&&e.manipulator.selected})),r=1===e&&n,o=Object(h.q)(this._reshapeHelper),s=Object(W.a)(this._manipulatorInfos);try{for(s.s();!(a=s.n()).done;){var c=a.value;"vertex"===c.handle.type&&(c.manipulator.grabbing||r&&!c.manipulator.selected||(Object(h.q)(o).moveVertices([c.handle],t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ),i.push(c.handle.pos),this._updateManipulatorPosition(c)))}}catch(d){s.e(d)}finally{s.f()}if(0!==i.length){var l,u=0,p=Object(W.a)(this._manipulatorInfos);try{for(p.s();!(l=p.n()).done;){"vertex"===l.value.handle.type&&u++}}catch(d){p.e(d)}finally{p.f()}if(this.outputGeometry=o.geometry,i.length===u){if(this._updateEventState(1),this.destroyed)return;if(this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic}),this.destroyed)return}else{if(this._updateEventState(2),this.destroyed)return;if(this.emit("reshape",{type:"reshape",mover:this.graphic}),this.destroyed)return}}}}},{key:"isMultiVertexSelection",value:function(){var e,t=0,a=Object(W.a)(this._manipulatorInfos);try{for(a.s();!(e=a.n()).done;){var i=e.value;zt(i)&&i.manipulator.selected&&t++}}catch(n){a.e(n)}finally{a.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(2),!this.destroyed){var t=e.mapDeltaX,a=e.mapDeltaY,i=e.mapDeltaZ;if(t||a||i){var n,r=[],o=Object(W.a)(this._manipulatorInfos);try{for(o.s();!(n=o.n()).done;){var s=n.value;zt(s)&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&r.push(s)}}catch(f){o.e(f)}finally{o.f()}for(var c=Object(h.q)(this._reshapeHelper),l=0,u=r;l<u.length;l++){var p=u[l];c.moveVertices([p.handle],t,a,i)}this.outputGeometry=c.geometry;for(var d=0,b=r;d<b.length;d++){var v=b[d];this._updateManipulatorPosition(v)}this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case 1:switch(this._reshapeEventState){case 0:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case 2:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case 2:switch(this._reshapeEventState){case 0:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case 1:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this;this._graphicMoveManipulation=new Et({tool:this.tool,view:this.view,graphicState:this._graphicState}),this.enableMoveGraphic?this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,a,i){a.next((function(e){return t._trackNumDragging(e)})).next((function(e){t._perGraphicManipulatorDragAction(0,e)})),i.next(t._cancelDragOperation())}))):this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null})),this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click"),e.stopPropagation()}))])})),this._moveManipulation=new xt({tool:this.tool,view:this.view,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ne(this.graphic),snapToScene:!1,radius:xt.radiusForSymbol(this.graphic.symbol)}),this._moveManipulation.forEachManipulator((function(e){t._handles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(a){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click"),a.stopPropagation()}))])})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var a=Object(h.q)(this.graphic.geometry).spatialReference;this._handles.add([this._moveManipulation.createDragPipeline((function(a,i,r,o,s){var c=r.next((function(e){return t._trackNumDragging(e)})).next((function(e){var a=t._manipulatorInfos.filter((function(e){return zt(e)&&e.manipulator.selected}));return 1===e.manipulatorType&&1===a.length?Object(n.a)(Object(n.a)({},e),{},{info:a[0],snapOrigin:a[0].handle.pos}):Object(n.a)(Object(n.a)({},e),{},{info:null})})).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:o,snappingManager:t.tool.snappingManager,snappingContext:new He.a({geometry:Object(h.q)(t._reshapeHelper),elevationInfo:e,pointer:s,excludeFeature:t.graphic,visualizer:new qe.a})}),t._snappingPipelineHandle.next).next(Object(Be.b)()).next((function(e){return t._perGraphicManipulatorDragAction(1,e),e}));return o.next(t._cancelDragOperation()),c}),e,a,this.graphic),Object(m.a)(this._graphicState,"displaying",(function(){t._updateMoveManipulationPosition()})),this._graphicState.on("changed",(function(){return t._updateMoveManipulationPosition()})),Object(m.a)(this._graphicState,"isDraped",(function(){var e="align-move-manipulation";t._graphicState.isDraped?t._handles.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),e):t._handles.remove(e)}))]),this._updateMoveManipulationPosition();var i=ot({view:this.view,graphic:this.graphic,forEachManipulator:function(e){if(!t.destroyed){Object(h.k)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var a,i=Object(W.a)(t._manipulatorInfos);try{for(i.s();!(a=i.n()).done;){e(a.value.manipulator,1)}}catch(n){i.e(n)}finally{i.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});this._outlineVisualElement=i.visualElement instanceof ge?i.visualElement:null,Object(h.k)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){t._graphicState.isDraped||t._updateMoveManipulationPosition()})),this._graphicState.watch("isDraped",(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(i)}},{key:"_createPerVertexManipulator",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(j.d)(this.graphic);if(Object(h.j)(this._vertexManipulatorGeometry)||Object(h.j)(this._vertexManipulatorOutlineGeometry)){var i=Z.reshapeManipulators.vertex,r=i.size/2,o=r+i.collisionPadding,s=r/o;this._vertexManipulatorGeometry=je.a.createSphereGeometry(s,16,16);var c=(r+i.outlineSize)/o;this._vertexManipulatorOutlineGeometry=je.a.createSphereGeometry(c,16,16)}if(Object(h.j)(this._edgeManipulatorGeometry)||Object(h.j)(this._edgeManipulatorOutlineGeometry)){var l=Z.reshapeManipulators.edge,u=l.size/2,p=u+l.collisionPadding,d=u/p;this._edgeManipulatorGeometry=je.a.createSphereGeometry(d,16,16);var b=(u+l.outlineSize)/p;this._edgeManipulatorOutlineGeometry=je.a.createSphereGeometry(b,16,16)}var v=new Xe.a({view:this.view,renderObjects:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:4|Bt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:5|Bt.Vertex},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Bt.Vertex},{geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:6|Bt.Edge},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:6|Bt.Edge},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:5|Bt.Edge},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:5|Bt.Edge},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:8},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:9},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:10}],elevationInfo:a,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(v,e,a);var f="edge"===e.type?{manipulator:v,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:v,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(f),this.manipulators.add(v),this._updateManipulatorPosition(f),"edge"===f.type){var g=this._getManipulatorInfoFromHandle(f.handle.left).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)})),m=this._getManipulatorInfoFromHandle(f.handle.right).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)}));f.locationUpdateHandle=Object(Re.b)([g,m]),this._manipulatorHandles.add(f.locationUpdateHandle,v)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(v,!0),v);var y=Object(Be.e)(v,(function(e,i,r,o){i.next((function(e){return t._trackNumDragging(e)})).next((function(e){if(Ht(f)){var a=t._splitEdgeManipulator(f);return Object(n.a)(Object(n.a)({},e),{},{info:a,snapOrigin:a.handle.pos})}return Object(n.a)(Object(n.a)({},e),{},{info:f,snapOrigin:f.handle.pos})})).next(Object(Be.f)(t.view,e.elevationAlignedLocation)).next(Object(mt.e)(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t.isMultiVertexSelection()},cancel:r,snappingManager:t.tool.snappingManager,snappingContext:new He.a({geometry:Object(h.q)(t._reshapeHelper),elevationInfo:a,pointer:o,excludeFeature:t.graphic,visualizer:new qe.a})}),t._snappingPipeline.next).next(Object(Be.b)()).next((function(e){t._perVertexManipulatorDragAction(e)})),r.next(t._cancelDragOperation())}));return this._manipulatorHandles.add(y,v),this._manipulatorHandles.add([v.events.on("immediate-click",(function(e){return t._manipulatorClickCallback(e,f)})),v.events.on("select-changed",(function(){f.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()}))]),this.emit("manipulators-changed"),v}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(){var e=this,t=Object(h.k)(this._reshapeHelper)?this._reshapeHelper.geometry.clone():null;return function(){switch(e._numDragging--,e.inputGeometry=t,e.outputGeometry=t,Object(h.k)(e.tool.snappingManager)&&e.tool.snappingManager.doneSnapping(),e._reshapeEventState){case 0:break;case 1:e.emit("move",{type:"move",dx:0,dy:0,mover:e.graphic});break;case 2:e.emit("reshape",{type:"reshape",mover:e.graphic})}e.destroyed||e._updateEventState(0)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,a){switch(t.type){case"vertex":e.state=Bt.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=Z.reshapeManipulators.vertex.size/2+Z.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=a;break;case"edge":e.state=Bt.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=Z.reshapeManipulators.edge.size/2+Z.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"===a.mode?a:{mode:"absolute-height",offset:0}}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var a=this;return e.events.on("grab-changed",(function(i){if("start"===i.action)t&&a._updateSelection(e),a._numGrabbing++;else if(a._numGrabbing--,a._updateEventState(0),a.destroyed)return;a._moveManipulation.interactive=!a._numGrabbing}))}},{key:"_clearSelection",value:function(){var e,t=Object(W.a)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var a=e.value;a.manipulator.grabbing||(a.manipulator.selected=!1)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,a=Object(W.a)(this._manipulatorInfos);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(e===i.handle)return i}}catch(n){a.e(n)}finally{a.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=Object(h.q)(this._reshapeHelper);if("vertex"===e.handle.type)e.manipulator.location=t.editGeometry.coordinateHelper.toPoint(e.handle.pos,qt),e.manipulator.grabbing&&Object(h.k)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.handle.type){var a=this._getManipulatorInfoFromHandle(e.handle.left).manipulator,i=this._getManipulatorInfoFromHandle(e.handle.right).manipulator;if(Object(h.k)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var n=a.location,r=i.location,o=n.x+.5*(r.x-n.x),s=n.y+.5*(r.y-n.y),c=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=Object(ee.d)(o,s,c,t.geometry.spatialReference)}else Object(Y.h)(Lt,a.renderLocation,i.renderLocation,.5),e.manipulator.renderLocation=Lt}}}},{key:"_splitEdgeManipulator",value:function(e){var t=Object(h.q)(this._reshapeHelper),a=Object(h.q)(t.splitEdge(e.handle,.5).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var i=e;i.handle=a,i.type="vertex";var n=Object(j.d)(this.graphic);this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,n),a.left&&this._createPerVertexManipulator(a.left),a.right&&this._createPerVertexManipulator(a.right),this.outputGeometry=t.geometry,this._updateManipulatorPosition(i),this._updateSelection(e.manipulator);var r=this._updateEventState(2),o=t.editGeometry.coordinateHelper.toArray(i.handle.pos),s=t.editGeometry.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:s,vertexIndex:Object(h.q)(a.index)}],added:o}),r&&this._updateEventState(0),i}},{key:"_updateMoveManipulationPosition",value:function(){var e=this,t=ft.d.get();Object(Y.v)(t,0,0,0);var a,i=0,n=!1,r=null,o=null,s=Object(W.a)(this._manipulatorInfos);try{for(s.s();!(a=s.n()).done;){var c=a.value;zt(c)&&(c.manipulator.selected?(i++,Object(Y.e)(t,t,c.manipulator.renderLocation),Object(h.j)(r)||c.selectedIndex>r.selectedIndex?(o=r,r=c):(Object(h.j)(o)||c.selectedIndex>o.selectedIndex)&&(o=c)):n=!0)}}catch(f){s.e(f)}finally{s.f()}if(0!==i){var l=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=l,this._moveManipulation.xyAxisManipulation.available=l,this._moveManipulation.zManipulation.available=l&&this.enableZ&&Ne(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=l&&1!==i}else{var u=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=u,this._moveManipulation.xyAxisManipulation.available=u,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=u,this._moveManipulation.zManipulation.available=u&&this.enableZ&&Ne(this.graphic)}if(0!==i){var p=0;if(Object(h.k)(r)){var d=r.handle.pos,b=Object(h.k)(o)?o.handle.pos:r.handle.left&&r.handle.left.left?r.handle.left.left.pos:null,v=!Object(h.k)(o)&&r.handle.right&&r.handle.right.right?r.handle.right.right.pos:null;b&&v?this._moveManipulation.xyAxisManipulation.available=!1:b?p=Vt(b,d):v&&(p=Vt(d,v))}this._moveManipulation.angle=p,this._moveManipulation.radius=lt}else this._moveManipulation.angleDeferred=function(){return bt(Object(h.q)(e.graphic.geometry))},this._moveManipulation.radius=xt.radiusForSymbol(this.graphic.symbol);0!==i&&n?(Object(Y.d)(t,t,1/i),qt.spatialReference=Object(h.q)(this._reshapeHelper).geometry.spatialReference,qt.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(t,qt),this._moveManipulation.elevationAlignedLocation=qt):Object(h.k)(this._outlineVisualElement)&&!this._graphicState.isDraped&&Object(h.k)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Object(Le.g)(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,a=[],i=Object(h.q)(this._reshapeHelper),n=Object(W.a)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("vertex"===r.handle.type&&i.canRemoveVertex()){a.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.left)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.right));var o=Object(h.q)(i.removeVertices([r.handle]).removedVertices[0].createdEdge);o&&this._createPerVertexManipulator(o)}}}catch(l){n.e(l)}finally{n.f()}if(a.length>0){var s=a.map((function(e){var t=i.editGeometry.components.indexOf(e.component);return{coordinates:i.editGeometry.coordinateHelper.toArray(e.pos),componentIndex:t,vertexIndex:Object(h.q)(e.index)}}));this.outputGeometry=i.geometry;var c=this._updateEventState(2);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map((function(e){return e.coordinates})),vertices:s}),this.destroyed)return;if(c&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.handle.type&&(t.manipulator.selected=!t.manipulator.selected),"vertex"===t.handle.type&&2===e.button&&this._removeVertices([t]),Ht(t)&&0===e.button&&this._splitEdgeManipulator(t),e.stopPropagation()}}]),a}(f.a.EventedAccessor);function Vt(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function zt(e){return"vertex"===e.handle.type}function Ht(e){return"edge"===e.handle.type}Object(l.a)([Object(b.b)({constructOnly:!0})],It.prototype,"tool",void 0),Object(l.a)([Object(b.b)()],It.prototype,"inputGeometry",null),Object(l.a)([Object(b.b)()],It.prototype,"outputGeometry",void 0),It=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],It);var Bt,Ft,qt=Object(ee.d)(0,0,null,null),Lt=Object(X.e)();(Ft=Bt||(Bt={})).Vertex=16,Ft.Edge=32;var Ut=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e,i){var n;return Object(r.a)(this,a),(n=t.call(this,e,i)).type=i,n._geometry=null,n}return Object(o.a)(a,[{key:"geometry",get:function(){if(this._dirty){switch(this.type){case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}}]),a}(ze.a),Nt=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._handles=new Ie.a,i._reshapeOperation=null,i._internalGeometryUpdate=!1,i.enableZ=!0,i.enableMoveGraphic=!0,i.type="reshape-3d",i.snappingManager=null,i}return Object(o.a)(a,[{key:"destroy",value:function(){this._handles.removeAll(),this._reshapeOperation=Object(h.e)(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}},{key:"selectionManagementDisabled",get:function(){return!0}},{key:"_updateGeometry",value:function(){var e=this.graphic.geometry;0!==Object(Tt.a)(this.graphic)||!Object(h.k)(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0===Object(Tt.a)(this.graphic)){var t=this.watch("graphic.geometry",(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),!0);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_onReshapeGeometryChanged",value:function(){Object(h.j)(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}},{key:"initialize",value:function(){var e=this;this._reshapeOperation=new It({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),this._reshapeOperation.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),this._reshapeOperation.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),this._reshapeOperation.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),this._reshapeOperation.on("immediate-click",(function(){return e.emit("immediate-click")})),Object(m.a)(this,"graphic",(function(){e._updateGraphic()}),!0)])}},{key:"beforeUndo",value:function(){Object(h.k)(this.snappingManager)&&this.snappingManager.doneSnapping()}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager}}}]),a}(f.a.EventedMixin(M.a));Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Nt.prototype,"view",void 0),Object(l.a)([Object(b.b)({constructOnly:!0})],Nt.prototype,"graphic",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Nt.prototype,"enableZ",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],Nt.prototype,"enableMoveGraphic",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],Nt.prototype,"type",void 0),Object(l.a)([Object(b.b)({constructOnly:!0})],Nt.prototype,"snappingManager",void 0),Nt=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Nt);var Zt,Wt,Xt=a(61),Yt=a(32),Qt=a(124),Jt=a(37),Kt=a(55);(Wt=Zt||(Zt={})).ScaleIn=32,Wt.ScaleOut=64,Wt.RotateLeft=128,Wt.RotateRight=256,Wt.Unlocked=1024,Wt.DelayedFocused=2048,Wt.TouchInput=32768;var $t=function(){function e(t){var a=this;Object(r.a)(this,e),this.mode=null,this._handles=new Ie.a,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new f.a,this.getFocused=function(){return a.ringManipulator.focused},this.getScale=function(){return Object(h.k)(a._scaleRotateDragData)&&"scale"===a._scaleRotateDragData.mode?a._scaleRotateDragData.scale:1},this.tool=t.tool,this.mode=t.mode,this.createManipulator(),this.updateDragState(),this.updateManipulatorTransform()}return Object(o.a)(e,[{key:"destroy",value:function(){Object(h.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles.removeAll(),this.tool.manipulators.remove(this.ringManipulator),this.ringManipulator=null}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var a=Object(Qt.a)({update:function(a){var i=a.deltaTime;e.update(i)&&t.cancelActiveAnimation()}});this._activeAnimation=Object(n.a)(Object(n.a)({},e),{},{frameTask:a})}},{key:"cancelActiveAnimation",value:function(){Object(h.k)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation.destroy(),this._activeAnimation=null)}},{key:"forEachManipulator",value:function(e){e(this.ringManipulator,4)}},{key:"createManipulator",value:function(){var e=this;this.ringManipulator=this.createRingManipulator(),this.tool.manipulators.add(this.ringManipulator);var t=this.ringManipulator,a=this.tool.graphicState.graphic,i=Object(Be.e)(t,(function(t,i,n){e._scaleRotateDragData=null;var r=function(e,t){var a=e.allLayerViews.find((function(e){return e.layer===t.layer}));if(Object(h.j)(t.symbol))return null;var i=t.symbol;return{symbolLayers:i.symbolLayers.map((function(e){var t=null;return"object"===e.type&&(t=e.heading),{heading:t,size:a.getSymbolLayerSize(i,e)}})).toArray()}}(e.tool.view,a);if(Object(h.j)(r))return e.updateDragState(),null;var o={mode:"none",origin:Object(X.d)(t.renderLocation),angle:0,startAngle:e.tool.symbolRotationAngle,angleDir:0,scale:1,scaleDir:0,startSymbolData:r};e._scaleRotateDragData=o,e.updateDragState();var s=ft.d.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,s),i.next(Object(mt.f)(e.tool.view,Kt.e.fromPositionAndNormal(t.renderLocation,s))).next((function(t){var i=Kt.e.normal(t.plane),n=Object(Le.a)(t.renderStart,t.renderEnd,o.origin,i),r=ne.c.shortestSignedDiff(o.angle,n);o.angleDir=Object(Ze.d)(o.angleDir+r,-.3,.3),o.angle=n;var s=function(e,t){var a=Object(Y.i)(ft.d.get(),t.renderStart,e.origin),i=Object(Y.i)(ft.d.get(),t.renderEnd,e.origin),n=Object(Y.o)(a),r=Object(Y.o)(i);return 0===n?0:r/n}(o,t),c=s-o.scale;if(o.scaleDir=Object(Ze.d)(o.scaleDir+c,-.2,.2),o.scale=s,e.onScaleChanged(),"none"===o.mode){var l=e.mode||function(e,t,a,i){var n=e.renderStart,r=e.renderEnd,o=ea(n,i,ft.d.get()),s=ea(r,i,ft.d.get());if(Object(Y.k)(o,s)<100)return null;var c=Object(Y.i)(ft.d.get(),n,a),l=Object(Y.f)(ft.d.get(),c,t),u=n,h=Object(Y.e)(ft.d.get(),u,l),p=ea(a,i,ft.d.get()),d=o,b=ea(h,i,ft.d.get()),v=Object(Y.i)(ft.d.get(),b,d),f=Object(Y.i)(ft.d.get(),o,p),g=Kt.f.wrap(d,v),m=Kt.f.wrap(p,f);return Kt.f.distance2(g,s)<Kt.f.distance2(m,s)?"rotate":"scale"}(t,t.plane,o.origin,e.tool.view.state.camera);if(Object(h.k)(l)){switch(l){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:a,angle:Object(Ze.q)(o.angle)});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:a,xScale:o.scale,yScale:o.scale})}o.mode=l}}if(e.updateDragState(),Object(h.k)(a.symbol)){var u=a.symbol.clone(),p=0,d=1;switch(o.mode){default:case"none":break;case"scale":d=o.scale;break;case"rotate":p=o.angle}e.applySymbolData(u,o.startSymbolData,p,d),a.symbol=u,e.updateManipulatorTransform()}switch(t.action){case"start":case"update":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:a,angle:Object(Ze.q)(o.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:a,xScale:o.scale,yScale:o.scale})}break;case"end":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:a,angle:Object(Ze.q)(o.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:a,xScale:o.scale,yScale:o.scale});break;default:case"none":}}"end"===t.action&&(e.startAnimation(ta(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null,e.updateDragState())})),n.next(Object(Be.l)(a)).next((function(){if(Object(h.k)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:a,angle:Object(Ze.q)(e._scaleRotateDragData.startAngle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:a,xScale:1,yScale:1})}e.startAnimation(ta(e,(function(){return e.onScaleChanged()}))),e._scaleRotateDragData=null}}))}));this._handles.add(i),this._handles.add([this.ringManipulator.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t){var a=0,i=null,n=function(){return!1};return{start:function(){i=e.getFocused,e.getFocused=n,a=0,t()},update:function(e){return a+=e,!i()||a>200?1:0},destroy:function(){e.getFocused=i,t()}}}(e,(function(){return e.updateDelayedFocusedState()}))):e.updateDelayedFocusedState()})),this.ringManipulator.events.on("immediate-click",(function(e){e.stopPropagation()})),Object(m.a)(this.tool.graphicState,"displaying",(function(t){return e.ringManipulator.available=t})),this.tool.graphicState.on("changed",(function(){return Object(Le.g)(e.tool.view,e.ringManipulator,a)}))]),Object(Le.g)(this.tool.view,this.ringManipulator,a)}},{key:"onScaleChanged",value:function(){this.events.emit("scale-changed"),this.updateManipulatorTransform()}},{key:"updateDelayedFocusedState",value:function(){this.ringManipulator.updateStateEnabled(Zt.DelayedFocused,this.getFocused())}},{key:"updateDragState",value:function(){if(this.ringManipulator.updateStateEnabled(Zt.Unlocked,!(Object(h.k)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),Object(h.k)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this.ringManipulator.updateStateEnabled(Zt.ScaleIn|Zt.ScaleOut,!1),this.ringManipulator.updateStateEnabled(Zt.RotateLeft,this._scaleRotateDragData.angleDir<0),this.ringManipulator.updateStateEnabled(Zt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this.ringManipulator.updateStateEnabled(Zt.RotateLeft|Zt.RotateRight,!1),this.ringManipulator.updateStateEnabled(Zt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this.ringManipulator.updateStateEnabled(Zt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this.ringManipulator.updateStateEnabled(Zt.ScaleIn|Zt.ScaleOut|Zt.RotateLeft|Zt.RotateRight,!1)}},{key:"updateManipulatorTransform",value:function(){var e=Object(re.i)(ft.a.get()),t=this.tool.symbolRotationAngle;Object(re.q)(e,e,t,Object(X.g)(0,0,1));var a=this.getScale(),i=Object(re.o)(ft.a.get(),Object(Y.v)(ft.d.get(),a,a,a)),n=Object(re.i)(ft.a.get());Object(re.l)(n,i,e),this.ringManipulator.modelTransform=n}},{key:"createRingManipulator",value:function(){for(var e=function(e,t,a){for(var i=[],n=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<n+1;r++){var o=e+r*(t-e)/n;i.push(Object(X.g)(a*Math.cos(o),a*Math.sin(o),0))}return i},t=function(t){return e(0,2*Math.PI,t)},a=function(e,t){return je.a.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},i=t(ut),n=a(i,24),r={left:[],right:[]},o=[],s=0;s<2;s++){var c=s*Math.PI-Math.PI/4,l=Math.PI/2-ht,u=c+l,h=c+Math.PI/2-l,p=e(u,h,190),d=a(p,9);o.push(p),o.push(e(u,h,201)),r.left.push(d),r.right.push(d);for(var b=0;b<2;b++){var v=0===b,f=Object(oe.b)();if(v){Object(re.r)(f,f,[1,-1,1]),Object(re.q)(f,f,-u,[0,0,1]);var g=Math.round(.2*(p.length-1));f[12]=p[g][0],f[13]=p[g][1],f[14]=p[g][2]}else{Object(re.q)(f,f,h,[0,0,1]);var m=Math.round(.8*(p.length-1));f[12]=p[m][0],f[13]=p[m][1],f[14]=p[m][2]}var y=je.a.createExtrudedTriangle(60,0,23,.5);je.a.transformInPlace(y,f),(v?r.left:r.right).push(y)}}for(var O=[],_=0;_<2;_++){var M=_*Math.PI-Math.PI/4,w=Math.PI/2-pt,k=M+w,x=M+Math.PI/2-w,S=e(k,x,213);O.push(a(S,9))}var A=t(190),E=t(213),P=a(A,9),D=a(E,9),G=t(130),C=t(107),R=a(G,9),T=a(C,9),I=this.createMaterial(),V=this.createMaterial(.66),z=this.createMaterial(.5),H=this.createMaterial(.33),B=[{geometry:n,material:I,stateMask:Zt.DelayedFocused},{geometry:n,material:z,stateMask:0}];this.mode&&"scale"!==this.mode||(B=B.concat([{geometry:O,material:I,stateMask:Zt.DelayedFocused|Zt.Unlocked},{geometry:P,material:V,stateMask:Zt.DelayedFocused|Zt.ScaleIn},{geometry:D,material:H,stateMask:Zt.DelayedFocused|Zt.ScaleIn},{geometry:R,material:V,stateMask:Zt.DelayedFocused|Zt.ScaleOut},{geometry:T,material:H,stateMask:Zt.DelayedFocused|Zt.ScaleOut}])),this.mode&&"rotate"!==this.mode||(B=B.concat([{geometry:r.right,material:I,stateMask:Zt.DelayedFocused|Zt.Unlocked},{geometry:r.left,material:I,stateMask:Zt.DelayedFocused|Zt.RotateLeft},{geometry:r.right,material:I,stateMask:Zt.DelayedFocused|Zt.RotateRight}]));var F=[i].concat(o);return new Xe.a({view:this.tool.view,renderObjects:B,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:Object(j.d)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:F,direction:Object(X.g)(0,0,1)}})}},{key:"createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[].concat(Object(Yt.a)(st),[e]);return new gt.a({color:t,transparent:1!==e,cullFace:2,renderOccluded:2})}},{key:"applySymbolData",value:function(e,t,a,i){var n=this;e.symbolLayers.forEach((function(e,r){var o=t.symbolLayers[r],s=o.heading,c=o.size;"object"===e.type&&(e.heading=(Object(h.k)(s)?s:0)-Object(Xt.c)(a),Object(h.k)(c)&&"width"in c&&(c.width=n.enforceNonZeroSize(c.width),c.height=n.enforceNonZeroSize(c.height),c.depth=n.enforceNonZeroSize(c.depth),e.width=c.width*i,e.depth=c.depth*i,e.height=c.height*i))}))}},{key:"enforceNonZeroSize",value:function(e){return e||this.tool.view.state.camera.computeRenderPixelSizeAt(this.ringManipulator.renderLocation)}},{key:"test",get:function(){return{ringManipulator:this.ringManipulator}}}]),e}();function ea(e,t,a){var i=t.projectToRenderScreen(e,Object(Jt.a)(aa)),n=t.renderToScreen(i,ia);return Object(Y.v)(a,n[0],n[1],0)}function ta(e,t){var a=null,i=1,n=function(){return i};return{start:function(){i=e.getScale(),a=e.getScale,e.getScale=n,t()},update:function(e){return i+=((i+1)/2-i)*Math.min(3*e,1),t(),Math.abs(i-1)<.01?1:0},destroy:function(){e.getScale=a,t()}}}var aa=Object(X.e)(),ia=Object(Jt.g)(),na=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i.type="transform-3d",i.handles=new Ie.a,i.scaleRotate=null,i.snappingPipeline=new Fe.a,i}return Object(o.a)(a,[{key:"initialize",value:function(){var e=this;this.graphicState=new Ae({graphic:this.graphic}),this.moveManipulation=new xt({tool:this,view:this.view,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ne(this.graphic),radius:xt.radiusForSymbol(this.graphic.symbol)}),this.moveManipulation.forEachManipulator((function(t){return e.handles.add(t.events.on("immediate-click",(function(e){return e.stopPropagation()})))})),this.moveManipulation.elevationInfo=Object(j.d)(this.graphic);var t=this.graphic.geometry;if(this.moveManipulation.createGraphicDragPipeline((function(a,i,n,r,o){return Object(h.k)(t)&&"point"===t.type&&0===a&&(n=n.next(e.snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new He.a({elevationInfo:Object(j.d)(e.graphic),pointer:o,geometry:new ze.a(Ve.c.fromGeometry(t,e.view.viewingMode),"point"),visualizer:new qe.a,excludeFeature:e.graphic}),snappingManager:e.snappingManager,cancel:r}),e.snappingPipeline.next)),n}),this.graphicState,(function(t){var a=t.action,i={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(a){case"start":e.emit("graphic-translate-start",i);break;case"update":e.emit("graphic-translate",i);break;case"end":e.emit("graphic-translate-stop",i)}})),this.moveManipulation.angle=this.symbolRotationAngle,this.enableScaling||this.enableRotation){var a=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this.scaleRotate=new $t({tool:this,mode:a}),this.handles.add(this.scaleRotate.events.on("scale-changed",(function(){return e.onScaleChanged()})))}this.handles.add([ot({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(Re.c)()}}),this.graphic.watch("symbol",(function(){return e.updateMoveAngle()})),this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.hideManipulatorsForGraphicState(),this.view.watch("scale",(function(){return e.updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this.onGeometryChanged()}},{key:"forEachManipulator",value:function(e){this.moveManipulation.forEachManipulator(e),Object(h.k)(this.scaleRotate)&&this.scaleRotate.forEachManipulator(e)}},{key:"hideManipulatorsForGraphicState",value:function(){var e=this;return this.graphicState.watch("displaying",(function(t){e.forEachManipulator((function(e){return e.available=t})),e.moveManipulation.zManipulation.available=t&&e.enableZ&&Ne(e.graphic)}))}},{key:"destroy",value:function(){this.handles.destroy(),this.moveManipulation.destroy(),this.scaleRotate=Object(h.e)(this.scaleRotate),this._set("view",null),this._set("graphic",null)}},{key:"snapToScene",set:function(e){this.moveManipulation&&(this.moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"symbolRotationAngle",get:function(){var e=this.graphic.symbol;if(e){var t=e.symbolLayers.find((function(e){return"object"===e.type})),a=t&&t.heading||0;return Object(Xt.d)(-a)}return 0}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){Object(h.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onHide",value:function(){Object(h.k)(this.scaleRotate)&&this.scaleRotate.cancelActiveAnimation()}},{key:"onScaleChanged",value:function(){if(!Object(h.j)(this.scaleRotate)){var e=this.scaleRotate.getScale();this.moveManipulation.displayScale=e}}},{key:"updateMoveAngle",value:function(){"local"===this.view.viewingMode||this.view.scale<1e6?this.moveManipulation.angle=this.symbolRotationAngle:this.moveManipulation.angle=0}},{key:"onGeometryChanged",value:function(){Object(Le.g)(this.view,this.moveManipulation,this.graphic)}},{key:"test",get:function(){return{discManipulator:this.moveManipulation.xyManipulation.test.discManipulator,ringManipulator:Object(h.k)(this.scaleRotate)?this.scaleRotate.test.ringManipulator:null,arrowManipulators:this.moveManipulation.xyAxisManipulation.test.arrowManipulators}}}]),a}(f.a.EventedMixin(M.a));Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],na.prototype,"view",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],na.prototype,"graphic",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],na.prototype,"enableZ",void 0),Object(l.a)([Object(b.b)()],na.prototype,"enableRotation",void 0),Object(l.a)([Object(b.b)()],na.prototype,"enableScaling",void 0),Object(l.a)([Object(b.b)({value:!1})],na.prototype,"snapToScene",null),Object(l.a)([Object(b.b)({constructOnly:!0})],na.prototype,"snappingManager",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],na.prototype,"type",void 0),na=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],na);var ra=a(62),oa=a(58),sa=a(34),ca=a(578),la=(a(29),a(183),a(43)),ua=(a(78),a(514)),ha=a(232),pa=a(156),da=a(115),ba=a(79),va=a(360),fa=a(195),ga=a(277),ma=a(311),ya=a(516),Oa=a(30),ja=a(28),_a=a(249),Ma=a(252),wa=a(66),ka=a(251),xa=a(247),Sa=a(109),Aa=a(223),Ea=a(201),Pa=a(250),Da=a(169),Ga=a(1051),Ca=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e,i){var n;return Object(r.a)(this,a),(n=t.call(this,e,i)).stipplePattern=null,n.stippleTextureBind=null,n.stippleTextureRepository=e.stippleTextureRepository,n}return Object(o.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),i=this.configuration,n=t.build({output:i.output,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled});return new xa.a(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),ka.a)}},{key:"dispose",value:function(){Object(Oa.a)(Object(ja.a)(a.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t,a){if(Aa.a.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.stipplePattern!==t.stipplePattern){var i=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,i),this.stipplePattern=i}if(this.configuration.stippleEnabled){var n=Object(h.k)(this.stippleTextureBind)?this.stippleTextureBind(e,0)*a.camera.pixelRatio:1;this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/n),this.program.setUniform2f("ndcToPixel",a.camera.fullViewport[2]/2,a.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",t.color),this.program.setUniform1f("alphaCoverage",Math.min(1,t.width*a.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var r=Object(h.q)(t.stippleOffColor);this.program.setUniform4f("stippleOffColor",r[0],r[1],r[2],r.length>3?r[3]:1)}4===this.configuration.output&&Pa.a.bindOutputHighlight(e,this.program,a)}},{key:"bindDraw",value:function(e){Aa.a.bindView(this.program,e),Ea.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"initializePipeline",value:function(){var e=this.configuration,t=Object(Sa.e)(770,1,771,771),a=function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(Sa.d)({blending:a,depthTest:Da.b,depthWrite:i,colorWrite:Sa.b,stencilWrite:e.sceneHasOcludees?Da.h:null,stencilTest:e.sceneHasOcludees?t?Da.d:Da.c:null})};return 0===e.output?(this._occludeePipelineState=a(!0,e.transparent||e.stippleEnabled?t:null,Sa.c),a(!1,e.transparent||e.stippleEnabled?t:null,Sa.c)):a(!1)}},{key:"primitiveType",get:function(){return 1}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),a}(Ma.a);Ca.shader=new _a.a(Ga.a,(function(){return a.e(238).then(a.bind(null,1221))}));var Ra=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.apply(this,arguments)).output=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleIntegerRepeatsEnabled=!1,e.sceneHasOcludees=!1,e}return a}(wa.a);Object(l.a)([Object(wa.b)({count:8})],Ra.prototype,"output",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"vertexColors",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"transparent",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"stippleEnabled",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"stippleOffColorEnabled",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"stippleIntegerRepeatsEnabled",void 0),Object(l.a)([Object(wa.b)()],Ra.prototype,"sceneHasOcludees",void 0);var Ta=p.a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),Ia=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e,Ha)).techniqueConfig=new Ra,i}return Object(o.a)(a,[{key:"getTechniqueConfig",value:function(e){this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.transparent=this.params.color[3]<1||this.params.width<1;var t=Object(h.k)(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=t,this.techniqueConfig.stippleOffColorEnabled=t&&Object(h.k)(this.params.stippleOffColor),this.techniqueConfig.stippleIntegerRepeatsEnabled=t&&this.params.stippleIntegerRepeats,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.params}},{key:"intersect",value:function(e,t,a,i,n,r,o,s,c){c?Object(fa.d)(e,i,r,1,o):this.intersectLineGeometry(e,t,a,i,o)}},{key:"intersectLineGeometry",value:function(e,t,a,i,n){if(i.options.selectionMode&&!Object(ce.d)(t))if(Object(ba.g)(a)){var r=e.vertexAttributes.get("position").data,o=i.camera,s=Qa;Object(sa.c)(s,i.point);Object(Y.v)(Ja[0],s[0]-2,s[1]+2,0),Object(Y.v)(Ja[1],s[0]+2,s[1]+2,0),Object(Y.v)(Ja[2],s[0]+2,s[1]-2,0),Object(Y.v)(Ja[3],s[0]-2,s[1]-2,0);for(var c=0;c<4;c++)if(!o.unprojectFromRenderScreen(Ja[c],Ka[c]))return;Kt.e.fromPoints(o.eye,Ka[0],Ka[1],$a),Kt.e.fromPoints(o.eye,Ka[1],Ka[2],ei),Kt.e.fromPoints(o.eye,Ka[2],Ka[3],ti),Kt.e.fromPoints(o.eye,Ka[3],Ka[0],ai);for(var l=Number.MAX_VALUE,u=0;u<r.length-5;u+=3)if(Ba[0]=r[u]+a[12],Ba[1]=r[u+1]+a[13],Ba[2]=r[u+2]+a[14],Fa[0]=r[u+3]+a[12],Fa[1]=r[u+4]+a[13],Fa[2]=r[u+5]+a[14],!(Kt.e.signedDistance($a,Ba)<0&&Kt.e.signedDistance($a,Fa)<0||Kt.e.signedDistance(ei,Ba)<0&&Kt.e.signedDistance(ei,Fa)<0||Kt.e.signedDistance(ti,Ba)<0&&Kt.e.signedDistance(ti,Fa)<0||Kt.e.signedDistance(ai,Ba)<0&&Kt.e.signedDistance(ai,Fa)<0)){if(o.projectToRenderScreen(Ba,Ua),o.projectToRenderScreen(Fa,Na),Ua[2]<0&&Na[2]>0){Object(Y.i)(qa,Ba,Fa);var h=o.frustum,p=-Kt.e.signedDistance(h[4],Ba)/Object(Y.g)(qa,Kt.e.normal(h[4]));Object(Y.d)(qa,qa,p),Object(Y.e)(Ba,Ba,qa),o.projectToRenderScreen(Ba,Ua)}else if(Ua[2]>0&&Na[2]<0){Object(Y.i)(qa,Fa,Ba);var d=o.frustum,b=-Kt.e.signedDistance(d[4],Fa)/Object(Y.g)(qa,Kt.e.normal(d[4]));Object(Y.d)(qa,qa,b),Object(Y.e)(Fa,Fa,qa),o.projectToRenderScreen(Fa,Na)}else if(Ua[2]<0&&Na[2]<0)continue;Ua[2]=0,Na[2]=0;var v=Kt.d.distance2(Kt.d.fromPoints(Ua,Na,Xa),s);v<l&&(l=v,Object(Y.j)(Za,Ba),Object(Y.j)(Wa,Fa))}var f=i.rayBeginPoint,g=i.rayEndPoint;if(l<4){var m=Number.MAX_VALUE;if(Kt.d.closestLineSegmentPoint(Kt.d.fromPoints(Za,Wa,Xa),Kt.d.fromPoints(f,g,Ya),La)){Object(Y.i)(La,La,f);var y=Object(Y.o)(La);Object(Y.d)(La,La,1/y),m=y/Object(Y.n)(f,g)}n(m,La)}}else Ta.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var a=e.vertexAttributes;if(!a)return!1;var i=a.get("position");return Object(te.a)(i,null,!1,t)}},{key:"createBufferWriter",value:function(){var e=this.params.vertexColors?ya.b:ya.c;return Object(h.j)(this.params.stipplePattern)?new ya.a(e):new za(e.clone().vec3f("auxpos1"))}},{key:"getGLMaterial",value:function(e){return 0===e.output||4===e.output?new Va(e):void 0}}]),a}(ga.a),Va=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).updateParameters(),i}return Object(o.a)(a,[{key:"updateParameters",value:function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(Ca,this.material.getTechniqueConfig(this.output),this.technique)}},{key:"beginSlot",value:function(e){return 3===e}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters())}},{key:"ensureParameters",value:function(e){0===this.output&&this._updateOccludeeState(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.getPassParameters(),t)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),a}(va.a),za=function(){function e(t){Object(r.a)(this,e),this.vertexBufferLayout=t}return Object(o.a)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,a,i){Object(ma.c)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,a,i),this.writeAuxpos1(e,t,a,i)}},{key:"writeAuxpos1",value:function(e,t,a,i){var n=a.getField("auxpos1",da.u),r=t.indices.get("position"),o=t.vertexAttributes.get("position").data,s=e.transformation,c=n.typedBufferStride,l=n.typedBuffer;i*=c;for(var u=0;u<r.length;u+=2)for(var h=3*r[u],p=o[h],d=o[h+1],b=o[h+2],v=s[0]*p+s[4]*d+s[8]*b+s[12],f=s[1]*p+s[5]*d+s[9]*b+s[13],g=s[2]*p+s[6]*d+s[10]*b+s[14],m=0;m<2;++m)l[i]=v,l[i+1]=f,l[i+2]=g,i+=c}}]),e}(),Ha=Object(n.a)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1},ga.b),Ba=Object(X.e)(),Fa=Object(X.e)(),qa=Object(X.e)(),La=Object(X.e)(),Ua=Object(Jt.e)(),Na=Object(Jt.e)(),Za=Object(X.e)(),Wa=Object(X.e)(),Xa=Kt.d.create(),Ya=Kt.d.create(),Qa=Object(X.e)(),Ja=[Object(Jt.e)(),Object(Jt.e)(),Object(Jt.e)(),Object(Jt.e)()],Ka=[Object(X.e)(),Object(X.e)(),Object(X.e)(),Object(X.e)()],$a=Kt.e.create(),ei=Kt.e.create(),ti=Kt.e.create(),ai=Kt.e.create(),ii=(a(1052),Object(u.a)("mac"),Math.cos(Object(Ze.f)(45)),Math.cos(Object(Ze.f)(5)),[1,.5,0]),ni=([].concat(ii,[.7]),[].concat(ii,[.5]),[].concat(ii,[1])),ri=[1,1,1,1],oi=[1,.8,.6,1],si=[1,.93,.86,1],ci=[].concat(ii,[1]),li=[].concat(ii,[1]),ui=40,hi=a(588),pi=a(1053),di=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get().build();return new xa.a(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),ka.a)}},{key:"bindPass",value:function(e,t,a){Aa.a.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.program.setUniform4fv("backgroundColor",t.backgroundColor),this.program.setUniform4fv("gridColor",t.gridColor),this.program.setUniform1f("gridWidth",t.gridWidth)}},{key:"bindDraw",value:function(e){Aa.a.bindView(this.program,e)}},{key:"initializePipeline",value:function(){return Object(Sa.d)({blending:Object(Sa.e)(1,1,771,771),depthTest:{func:513},colorWrite:Sa.b})}}]),a}(Ma.a);di.shader=new _a.a(pi.a,(function(){return a.e(241).then(a.bind(null,1222))}));var bi=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){return Object(r.a)(this,a),t.call(this,e,fi)}return Object(o.a)(a,[{key:"intersect",value:function(e,t,a,i,n,r,o){return Object(fa.e)(e,t,i,n,r,void 0,o)}},{key:"createBufferWriter",value:function(){return new ya.a(ya.d)}},{key:"getGLMaterial",value:function(e){return 0===e.output?new vi(e):void 0}}]),a}(ga.a),vi=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).technique=new di(i.techniqueRep.constructionContext,null),i.updateParameters(),i}return Object(o.a)(a,[{key:"updateParameters",value:function(){}},{key:"beginSlot",value:function(e){return 8===e}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.technique.bindPass(e,this.material.params,t)}}]),a}(va.a);Object(l.a)([Object(hi.c)()],vi.prototype,"technique",void 0);var fi=Object(n.a)({backgroundColor:[1,0,0,.5],gridColor:[0,1,0,.5],gridWidth:4},ga.b),gi=(Me.a,a(591)),mi=a(154),yi=a(296),Oi=a(1054),ji=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"initializeProgram",value:function(e){var t=a.shader.get(),i=this.configuration,n=t.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new xa.a(e.rctx,n.generateSource("vertex"),n.generateSource("fragment"),ka.a)}},{key:"bindPass",value:function(e,t,a){Aa.a.bindProjectionMatrix(this.program,a.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),a.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",a.camera.nearFar),this.program.setUniform2fv("inverseViewport",a.inverseViewport),Object(yi.a)(this.program,e,a))}},{key:"bindDraw",value:function(e){Aa.a.bindView(this.program,e),Ea.a.bindUniformsWithOrigin(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e,t){var a=this.configuration,i=3===e,n=2===e;return Object(Sa.d)({blending:0!==a.output&&7!==a.output||!a.transparent?null:i?_i:Object(mi.a)(e),culling:function(e){return 0!==e&&{face:1===e?1028:1029,mode:2305}}(a.cullFace),depthTest:{func:Object(mi.b)(e)},depthWrite:i?a.writeDepth&&Sa.c:Object(mi.c)(e),colorWrite:Sa.b,stencilWrite:a.sceneHasOcludees?Da.h:null,stencilTest:a.sceneHasOcludees?t?Da.d:Da.c:null,polygonOffset:i||n?null:Object(mi.g)(a.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e){return e?this._occludeePipelineState:this.pipeline}}]),a}(Ma.a);ji.shader=new _a.a(Oi.a,(function(){return a.e(234).then(a.bind(null,1223))}));var _i=Object(Sa.f)(1,771),Mi=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!0,e}return a}(wa.a);Object(l.a)([Object(wa.b)({count:8})],Mi.prototype,"output",void 0),Object(l.a)([Object(wa.b)({count:3})],Mi.prototype,"cullFace",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"slicePlaneEnabled",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"transparent",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"enableOffset",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"writeDepth",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"sceneHasOcludees",void 0),Object(l.a)([Object(wa.b)({count:4})],Mi.prototype,"transparencyPassType",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"multipassTerrainEnabled",void 0),Object(l.a)([Object(wa.b)()],Mi.prototype,"cullAboveGround",void 0);var wi,ki=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e,Si)).supportsEdges=!0,i.techniqueConfig=new Mi,i}return Object(o.a)(a,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<mi.e,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!t||t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,a,i,n,r,o){Object(fa.e)(e,t,i,n,r,void 0,o)}},{key:"getGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output?new xi(e):void 0}},{key:"createBufferWriter",value:function(){return new ya.a(ya.d)}}]),a}(ga.a),xi=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,Object(n.a)(Object(n.a)({},e),e.material.params))).updateParameters(),i}return Object(o.a)(a,[{key:"updateParameters",value:function(e){var t=this.material.params;this.updateTexture(t.textureId),this.technique=this.techniqueRep.acquireAndReleaseExisting(ji,this.material.getTechniqueConfig(this.output,e),this.technique)}},{key:"beginSlot",value:function(e){return 4===this.output?3===e:e===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}},{key:"ensureParameters",value:function(e){0!==this.output&&7!==this.output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){e.bindProgram(this.technique.program),this.bindTexture(e,this.technique.program),this.bindTextureScale(e,this.technique.program),this.technique.bindPass(e,this.material.params,t)}},{key:"getPipelineState",value:function(e,t){return this.technique.getPipelineState(t)}}]),a}(gi.a),Si=Object(n.a)({transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0},ga.b),Ai=a(21),Ei=a(52),Pi=a(981),Di=a(22),Gi=wi=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).type="plane",i.position=null,i.heading=0,i.tilt=0,i.width=10,i.height=10,i}return Object(o.a)(a,[{key:"clone",value:function(){return new wi({position:Object(Ai.a)(this.position),heading:this.heading,tilt:this.tilt,width:this.width,height:this.height})}},{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&Object(h.k)(this.position)&&Object(h.k)(e.position)&&this.position.equals(e.position)&&this.width===e.width&&this.height===e.height}}]),a}(Di.a);Object(l.a)([Object(b.b)({readOnly:!0,json:{read:!1,write:!0}})],Gi.prototype,"type",void 0),Object(l.a)([Object(b.b)({type:la.a}),Object(Pi.a)()],Gi.prototype,"position",void 0),Object(l.a)([Object(b.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(Pi.a)(),Object(Ei.a)((function(e){return ne.b.normalize(Object(d.i)(e),0,!0)}))],Gi.prototype,"heading",void 0),Object(l.a)([Object(b.b)({type:Number,nonNullable:!0,range:{min:0,max:360}}),Object(Pi.a)(),Object(Ei.a)((function(e){return ne.b.normalize(Object(d.i)(e),0,!0)}))],Gi.prototype,"tilt",void 0),Object(l.a)([Object(b.b)({type:Number,nonNullable:!0}),Object(Pi.a)()],Gi.prototype,"width",void 0),Object(l.a)([Object(b.b)({type:Number,nonNullable:!0}),Object(Pi.a)()],Gi.prototype,"height",void 0);Gi=wi=Object(l.a)([Object(v.a)("esri.widgets.Slice.SlicePlane")],Gi),p.a.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function Ci(e,t){switch(t){case 0:return{basis:e.basis1,direction:1,position:Object(Y.e)(ft.d.get(),e.origin,e.basis1),edge:t};case 1:return{basis:e.basis2,direction:1,position:Object(Y.e)(ft.d.get(),e.origin,e.basis2),edge:t};case 2:return{basis:e.basis1,direction:-1,position:Object(Y.i)(ft.d.get(),e.origin,e.basis1),edge:t};case 3:return{basis:e.basis2,direction:-1,position:Object(Y.i)(ft.d.get(),e.origin,e.basis2),edge:t}}}function Ri(e){var t=Object(Y.o)(e.basis1),a=Object(Y.o)(e.basis2);return.3*Math.min(t,a)}function Ti(e){return Ri(e)}function Ii(e){return 0!==e.direction[0]&&0!==e.direction[1]}function Vi(e,t){var a=Ii(t),i=a?[Object(X.g)(1,0,0),Object(X.g)(0,0,0),Object(X.g)(0,1,0)]:[Object(X.g)(1,0,0),Object(X.g)(-1,0,0)],n=je.a.createPolylineGeometry(i),r=[].concat(Object(Yt.a)(ii),[1]),o=a?4:1,s=2*o,c=function(e){return e>1?function(e){return new ie.a({color:r,width:e,renderOccluded:4})}(e):new Ia({color:r,renderOccluded:4})},l=[{geometry:n,material:c(o),stateMask:1|Ni},{geometry:n,material:c(s),stateMask:2|Ni},{geometry:n,material:c(1),stateMask:Zi}],u=new Xe.a({view:e,renderObjects:l,collisionType:{type:"line",paths:[i]},autoScaleRenderObjects:!1,worldSized:!0,radius:a?6:4,idHint:a?1:2});return u.state=Ni,u}function zi(e,t,a){var i=function(i){var n=(i?t:e).slice(0),r=Object(Y.i)(ft.d.get(),n[0],n[1]);Object(Y.q)(r,r);var o=Object(Y.i)(ft.d.get(),n[n.length-1],n[n.length-2]);if(Object(Y.q)(o,o),a.padding>0){var s=Object(Y.d)(Object(X.e)(),o,-a.padding);if(n[n.length-1]=Object(Y.e)(s,s,n[n.length-1]),a.bothEnds){var c=Object(Y.d)(Object(X.e)(),r,-a.padding);n[0]=Object(Y.e)(c,c,n[0])}}var l=i?a.tipFocusMultiplier:1,u=a.tipLength*(a.focusTipLength?l:1),p=a.tipRadius*l,d=Object(re.i)(ft.a.get());if(a.padding>0){var b=u/4,v=Object(Y.v)(ft.d.get(),0,b,0),f=1+a.padding/b;Object(re.s)(d,d,v),Object(re.r)(d,d,Object(Y.v)(ft.d.get(),f,f,f)),Object(re.s)(d,d,Object(Y.d)(v,v,-1/f))}var g=Object(re.i)(Object(oe.b)()),m=Object(X.g)(0,1,0),y=Object(re.p)(Object(oe.b)(),Object(ua.d)(ft.b.get(),m,o));y[12]=n[n.length-1][0],y[13]=n[n.length-1][1],y[14]=n[n.length-1][2],Object(re.l)(y,y,d);var O,j,_=[{part:"tube",geometry:Hi(a.tubeRadius*(i?a.tubeFocusMultiplier:1)+a.padding,a.flat,n),transform:g}];if(Object(h.k)(a.flat)?O=je.a.createExtrudedTriangle(u,p,p,a.flat.thickness):(O=je.a.createConeGeometry(u,p,24,!1,!1,!0),j=je.a.createConeGeometry(u,p,24,!1,!0,!1)),_.push({part:"tip",geometry:O,transform:y}),j&&_.push({part:"cap",geometry:j,transform:y}),a.bothEnds){var M=Object(re.p)(Object(oe.b)(),Object(ua.d)(ft.b.get(),m,r));M[12]=n[0][0],M[13]=n[0][1],M[14]=n[0][2],Object(re.l)(M,M,d),_.push({part:"tip",geometry:O,transform:M}),j&&_.push({part:"cap",geometry:j,transform:M})}return _};return{normal:i(!1),focused:i(!0)}}function Hi(e,t,a){var i=[];if(Object(h.k)(t))i.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var n=0;n<12;n++){var r=n/12*2*Math.PI;i.push([Math.cos(r)*e,Math.sin(r)*e])}return je.a.createPathExtrusionGeometry(i,a,[],[],!1)}function Bi(e,t){var a=Object(Y.i)(Object(X.e)(),e[e.length-1],e[e.length-2]);if(Object(Y.q)(a,a),Object(Y.d)(a,a,12),Object(Y.e)(a,a,e[e.length-1]),t){var i=Object(Y.i)(Object(X.e)(),e[0],e[1]);return Object(Y.q)(i,i),Object(Y.d)(i,i,12),Object(Y.e)(i,i,e[0]),[i].concat(Object(Yt.a)(e),[a])}return[].concat(Object(Yt.a)(e),[a])}function Fi(e,t){return Object(ha.b)(t,e.basis2,e.basis1)+Ui}var qi=16,Li=32,Ui=(Kt.f.create(),Math.PI/2),Ni=16,Zi=32,Wi=function(){function e(){Object(r.a)(this,e),this.lastDragEvent=null,this.next=new Be.a,this._enabled=!1}return Object(o.a)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&Object(h.k)(this.lastDragEvent)){var t=Object(n.a)(Object(n.a)({},this.lastDragEvent),{},{action:"update"});e&&this.adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?Object(n.a)({},t):null,e._enabled&&e.adjustScaleFactors(t),t}}},{key:"adjustScaleFactors",value:function(e){var t=Ii(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{adjustScaleFactors:function(t){return e.adjustScaleFactors(t)}}}}]),e}(),Xi=a(309),Yi=a(616),Qi=a(617),Ji=a(618);function Ki(e,t){return en(e,t,!1)}function $i(e,t){return en(e,t,!0)}function en(e,t,a){if(e instanceof Xi.b){if(e.operation instanceof Yi.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,i=Object(X.g)(a*e.dx,a*e.dy,a*e.dz);Object(Y.e)(t.origin,t.origin,i)}(e.operation,t,a),!0;if(e.operation instanceof Qi.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;Object(Y.c)(t.basis1,t.basis1,X.b,a),Object(Y.c)(t.basis2,t.basis2,X.b,a)}(e.operation,t,a),!0;if(e.operation instanceof Ji.a)return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a?1/e.factor1:e.factor1,n=a?1/e.factor2:e.factor2;Object(Y.d)(t.basis1,t.basis1,i),Object(Y.d)(t.basis2,t.basis2,n),tn(t.origin,e.origin,e.axis1,i),tn(t.origin,e.origin,e.axis2,n)}(e.operation,t,a),!0}return!1}function tn(e,t,a,i){var n=ft.c.get(),r=Object(sa.d)(n,e,t),o=Object(sa.a)(n,a,Object(sa.g)(a,r));Object(sa.o)(e,e,o,i-1)}var an=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).enableZ=!0,i.enableRotation=!0,i.enableScaling=!0,i._preserveAspectRatio=new Wi,i.grabbing=!1,i.inputState=null,i.type="transform-3d",i.handles=new Ie.a,i.moveZManipulator=null,i.resizeManipulators=null,i.rotateManipulator=null,i.attachmentOrigin=null,i.outlineVisualElement=null,i.mapBounds=Kt.a.create(),i.mapBoundsStart=Kt.a.create(),i.displayBounds=Kt.a.create(),i.displayBoundsStart=Kt.a.create(),i.displayBoundsMarginStart=0,i.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],i}return Object(o.a)(a,[{key:"initialize",value:function(){var e=this;this.graphicState=new Ae({graphic:this.graphic});var t=this.graphic.geometry;this.reshapeHelper=new Ut(Ve.c.fromGeometry(t,this.view.viewingMode),t.type),this.graphicMoveManipulation=new Et({tool:this,view:this.view,graphicState:this.graphicState}),this.handles.add(this._createMoveXYGraphicDragPipeline()),this.moveZManipulator=function(e){var t=0===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)?ui:0,a=[Object(X.g)(t,0,-24),Object(X.g)(t,0,24)],i=Bi(a,!0),n=function(e,t){return zi(a,a,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},r=n(0,!1),o=n(2.25,!0),s=new gt.a({color:ri,cullFace:2,renderOccluded:16}),c=new gt.a({color:oi,cullFace:2,renderOccluded:16}),l=new gt.a({color:si,cullFace:2,renderOccluded:16}),u=new gt.a({color:li,transparent:!0,writeDepth:!1,cullFace:1,renderOccluded:2}),h=je.a.createPolylineGeometry([[t,0,0],[t-ui,0,0]]),p=je.a.createPolylineGeometry([[t,0,0],[t-ui,0,0]]),d=new Ia({color:ci,renderOccluded:4});return new Xe.a({view:e,renderObjects:[].concat(Object(Yt.a)(r.normal.map((function(e){var t=e.part,a=e.geometry,i=e.transform;return{geometry:a,material:"tip"===t?s:"cap"===t?c:l,transform:i,stateMask:1|qi}}))),Object(Yt.a)(o.normal.map((function(e){var t=e.geometry,a=e.transform;return{geometry:t,material:u,transform:a,stateMask:1|qi}}))),[{geometry:h,material:d,stateMask:1|qi|Li}],Object(Yt.a)(r.focused.map((function(e){var t=e.part,a=e.geometry,i=e.transform;return{geometry:a,material:"tip"===t?s:"cap"===t?c:l,transform:i,stateMask:2|qi}}))),Object(Yt.a)(o.focused.map((function(e){var t=e.geometry,a=e.transform;return{geometry:t,material:u,transform:a,stateMask:2|qi}}))),[{geometry:p,material:d,stateMask:2|qi|Li}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[i]},collisionPriority:1,radius:11,state:qi})}(this.view,0),this.moveZManipulator.state|=Li,this.handles.add(this.watch("enableZ",(function(){return e.updateManipulatorAvailability(e.moveZManipulator,0)}))),this.handles.add(this._createMoveZDragPipeline()),this.manipulators.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((function(t){var a=Vi(e.view,t);return e.handles.add(e.watch("enableScaling",(function(){return e.updateManipulatorAvailability(a,2)}))),a.events.on("grab-changed",(function(t){return e._onResizeGrab(t)})),e.handles.add(e._createResizeDragPipeline(a,t)),a})),this.manipulators.addMany(this.resizeManipulators),this.rotateManipulatorTexture=new ca.a("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAQ3wAAEN8BdFVeMAAAArhQTFRF/34A/34A/20A/34A/30A/1UA/34AR3BM/34A/34A/30A/34A/3wA/30A/wAA/8mV//79/4AG/4AC/////4AA/34A//Xs/3EA/34A/30A/4AA/3gA/4AA//jx/4AA/34A/30A/3wA/30A/3QA/34A/4AA/+nT/30A/4QM/4MK//r2/59B/8+h//Hi/34A/4gT//fv/5Uu/9q4//r2/+TK/4wc//38/5Yv/34A/30A/4AA/7+A/+nU/4EI/34A/3wA//fu/9Gk/30A/9ex/34A//7+//jw/30A//z5/+fQ/9/B/4cR/5Mq//fv//38/82d//n0/+LG//37//Xt/30A/7Vt/40e/50//30A/34A/65h/6tZ/+DB/6VN/4sZ/7Bi//79/8+f/+LH/4AE/30A/6BC/9/A/5Al/+rX/4AA/8WN/4AA/7Zw/+3a/6hT/3wA/34A/3sA/3wA/4AA/3wA/3oA/4AA/4AA//Xt/6lW/8uX/5k0//Pn/719/+7d//Po/6BF/8+g//v2/8eR/5Qs/4AA/8WN/71+/30A//ny/+rV/8eP/+fQ//Tq/4AA/30A/7dy/34A/7Vv/+vY/8uZ/3sA/6ZR/4kX/+rW/6hS//v4/8mT/9Oo/9Oq//79/6NK/6JH/8eR/7Vu/+bN/5k3/9q2//Xs//37/8yb/34A/7p5//78//jx/+bN/7x7/7Nr/+/h/4QO/48j/61d//jw/508/9Wr/82b/65e/6xc/7h0/6BE/4AA/65g/30A/5w6/30A/6NL/+nU/4AA/8iT//Ll/3wA//Tp/9Km/9q2/+3c//v4/8OJ/3oA/9Cj//r1/7p2/6VP/+7d/+DE//z6/+LF//Hj//n0//r1/5o5/9av/+PH/+vZ/+XM//Po/6hV/928/8SL/9at/+7e/7p3/+zZ/+3b////JwwhsQAAAOd0Uk5TgH0Hb2oDUwB3fz9HKXgBtf6BgP4qYe0JdXYSEQjzOkU5RmYLawraL4OC9pK75kGF8IzI99OH/I1naD6q24J5SPC8YsRj/vIr+tfOhIvx/bj10fzvfKKIklpbnpvNloae/bnSgXCTzYrdBrFApN+ZUmUbVBpAGVIY7pq1juqp4euUuveyjCiwqi3z3LHY7CwzpFGj3rc4mIbcmPizvsD8lZSzo9aPx+77uE+n/PLVqKLlg4mc8ZHAt52cpZMCnTGQdJbaMrTnUOu9xuD5rzC89aaX4tD60Of09pDC0d7V6pnLsMHip9/g/7fLIQAAA8lJREFUWMOll/VbGzEYx0NpaWkLpQVW3GUbMHzYYMhgA7axMQeGbeiE4XN3d3d3d3d3d9/u31iba7nkLlfunr2/wPNN3k+TS/IKkPOYv1NTQ7y1wspKYR1vo3Ty55sHiGq9SmoLMLOVqhqFAiReAYBoAV4SAQB9FwXgNcUofXuAYBdg0RRr7C0B3HqAdi3djR+gtgMCLGUpD8C+OxBoKnsSQGYDBJuNjAuQDTOPRgogDJVxACvaBj+XCFmDPQvA7H+449sRAgi+OKAnM/KGomrhP9smRgWFhR0PejBrOIkwHwW4MecX15Wi3sWCIVEDKMY6ZIRwAHbuCAC5Px+NDpUxDhRuDv05CGcGcItRw98bp289RHGsdIuWRXhiBuhdGVFjWjNFsIeTcICLhwnQhdF090yTZ9J/DntGOzKEPkNwgpIGSJD3+9s815OifoVuyDVI6wrTwsxqVgX+NCUQ4IVIY9p+7W8hIp9ab1LHx2IEHwiQMsJYZrnRVdjUpGhaPoLHKCOgHhE+IZ/sO77fkAharsXUZgNABbBLxJz8C5xwjSZ4huMXGqA7qCiL+vIyoq+JMIZ17BNo/FNUS5ADf1v2DdPN/vZc8/NV9dfRrIFQCOiXjEb7QOAkPIx0pJ/HclRTg1HCAeA2BPTH7hJoEAEYnA8/Iyq1AD8RANANLqE3oowDI8UAzkLASkSxBgoxgCQImIsorsBKDGAnBGgQZaA4QAkElGEAUVs4CgGbsC2I+ojnIOAi9hFFHWM5BNzAjlFERgS6BUb/XicQqQ404XOKf/w5zwsYBBcQhEqJ2GPSji5/TVHZvIBqCFiNPyb0OX8oNU7ILLC4gPxI/DmjAQXEwClLcon+xalwtAjV4vGQBsbSSWCXluDfiX5JmdNR0dsAaESFIjqa5SRzowm9OmoPpraywjqIPU1PW3WS5d97qinnhXPCOpZYwDFTSO23CK0ytJrOtLzvCiGxSLDn8NicC/eG7jZJZ+6nmkP9FFJqQ5OrwfKYbNonuzIjZ3EWkyp2EJOrXI+Xt/N6UWR7dBD3v25O7/Kr+MDayUT/O9tZHzaYKXHSWUeet5Hj3lmj5S9x0CKLtqoZeI0ybf9gi0WWnJufdAWbF9Jn9+xm2gUd92aq8UJTRU5mcZciO5Fflje71L0LRBmn1EWKbSFGKLbllw8I96+TETsWX4Hutt58Lc8cQUkipSd/0+Xu3L6/s/v/tX3L2ms8PZQW9uGq9BDQ+tb4SMnuUp8aoc13s28Cu/lO8G4V0b0bLFCdaONHt/9+LYnqQL55/wAoaTsIDs69HgAAAABJRU5ErkJggg==",{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&this.view._stage.add(this.rotateManipulatorTexture),this.rotateManipulator=function(e,t){var a=new ki({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:16}),i=40,n=27*1.1,r=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new pa.a([["position",{size:3,data:[i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1]}]],[["position",t],["uv0",t]])},o=je.a.createPolylineGeometry([[0,0,0],[13,0,0]]),s=je.a.createPolylineGeometry([[0,0,0],[i-n,0,0]]),c=new Ia({color:ni,renderOccluded:4}),l=[{geometry:r(27),material:a,stateMask:1|qi},{geometry:o,material:c,stateMask:1|qi},{geometry:r(n),material:a,stateMask:2|qi},{geometry:s,material:c,stateMask:2|qi}];return new Xe.a({view:e,renderObjects:l,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},collisionPriority:1,radius:13.5,state:qi})}(this.view,this.rotateManipulatorTexture),this.handles.add(this.watch("enableRotation",(function(){return e.updateManipulatorAvailability(e.rotateManipulator,3)}))),this.rotateManipulator.events.on("grab-changed",(function(t){e._onRotateGrab(t)})),this.handles.add(this._createRotateDragPipeline(this.rotateManipulator)),this.manipulators.add(this.rotateManipulator),this.calculateMapBounds(),this.updateDisplayBounds(this.mapBounds);var a=ot({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e.forEachManipulator(t)},onManipulatorsChanged:function(){return Object(Re.c)()}});this.outlineVisualElement=a.visualElement instanceof ge?a.visualElement:null,Object(h.k)(this.outlineVisualElement)&&this.handles.add(this.outlineVisualElement.events.on("attachment-origin-changed",(function(){return e.updateDisplayBounds(e.mapBounds)}))),this.handles.add(a),this.handles.add([this.graphicState.on("changed",(function(){return e.onGeometryChanged()})),this.graphicState.watch("displaying",(function(){return e.updateAllManipulatorAvailability()})),Object(m.a)(this.graphicState,"isDraped",(function(){return e.graphicDrapedChanged()})),this.view.trackGraphicState(this.graphicState)]);var i=this.view.pointsOfInterest;i&&this.handles.add(i.focus.watch("location",(function(){return e.updateDisplayBounds(e.mapBounds)})));var r=function(t){e.handles.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e.updateAllManipulatorAvailability()})))};this.forEachManipulator(r),this.graphicMoveManipulation.forEachManipulator(r);var o=function(t,a){e.handles.add(t.events.on("immediate-click",(function(t){1===a&&e.emit("immediate-click",Object(n.a)(Object(n.a)({},t),{},{graphic:e.graphic})),t.stopPropagation()})))};this.forEachManipulator(o),this.graphicMoveManipulation.forEachManipulator(o),this.onGeometryChanged(),this.updateAllManipulatorAvailability()}},{key:"graphicDrapedChanged",value:function(){var e=this;this.handles.remove(nn),this.updateDisplayBounds(this.mapBounds),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(function(t){Object(h.k)(e.attachmentOrigin)&&Object(et.h)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e.updateDisplayBounds(e.mapBounds)})),nn)}},{key:"updateAllManipulatorAvailability",value:function(){var e=this;this.forEachManipulator((function(t,a){return e.updateManipulatorAvailability(t,a)}))}},{key:"updateManipulatorAvailability",value:function(e,t){var a=this.graphicState.displaying,i=this.grabbing&&!e.grabbing;e.interactive=!i;var n=this.enableZ&&Ne(this.graphic);switch(t){case 3:e.available=a&&this.enableRotation;break;case 2:e.available=a&&(this.enableScaling||this.enableRotation||n),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Ni:Zi;break;case 0:e.available=a&&n;break;default:e.available=a}}},{key:"forEachManipulator",value:function(e){this.resizeManipulators.forEach((function(t){return e(t,2)})),e(this.rotateManipulator,3),e(this.moveZManipulator,0)}},{key:"destroy",value:function(){this.view._stage&&this.view._stage.remove(this.rotateManipulatorTexture),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.reshapeHelper.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"reset",value:function(){}},{key:"onDetach",value:function(){this.mapBounds=null,this.displayBounds=null}},{key:"onGeometryChanged",value:function(){this.updateDisplayBounds(this.mapBounds)}},{key:"calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.reshapeHelper.editGeometry,a=t.components[0].edges[0],i=Object(sa.d)(ft.c.get(),a.left.pos,a.right.pos);Object(sa.e)(i,i);var n=Object(h.r)(Object(Le.f)(this.view,this.graphic),e.extent.center),r=on*this.view.pixelSizeAt(n),o=this.view.spatialReference;o!==e.spatialReference&&(r*=Object(ra.f)(o)/Object(ra.f)(e.spatialReference)),function(e,t,a,i){i||(i=Kt.a.create());var n=Object(sa.r)(ft.c.get(),e[1],-e[0]),r=Object(sa.r)(ft.c.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=Object(sa.r)(ft.c.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s=ft.c.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var a=t.pos;Object(sa.r)(s,Object(sa.g)(e,a),Object(sa.g)(n,a)),Object(sa.t)(r,r,s),Object(sa.u)(o,o,s)}))}));var c=1e-6,l=Object(sa.r)(ft.c.get(),o[0]-r[0]<c?a/2:0,o[1]-r[1]<c?a/2:0);Object(sa.d)(r,r,l),Object(sa.h)(o,o,l),Object(sa.a)(i.basis1,e,(o[0]-r[0])/2),Object(sa.a)(i.basis2,n,(o[1]-r[1])/2),Object(sa.r)(i.origin,r[0]*e[0]+r[1]*n[0],r[0]*e[1]+r[1]*n[1]),Object(sa.h)(i.origin,i.origin,i.basis1),Object(sa.h)(i.origin,i.origin,i.basis2)}(i,t,r,this.mapBounds)}},{key:"updateDisplayBounds",value:function(e){var t=this.graphic.geometry,a=Object(h.k)(this.outlineVisualElement)&&!this.graphicState.isDraped&&Object(h.k)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Object(Le.f)(this.view,this.graphic);this.attachmentOrigin=Object(h.r)(a,t.extent.center);var i=Object(h.k)(a)?a.z:Object(_e.c)(e.origin,this.view.elevationProvider,ae.a.fromElevationInfo(Object(j.d)(this.graphic)),this.view.renderCoordsHelper),n=Kt.a.copy(e);Object(Y.v)(n.origin,e.origin[0],e.origin[1],i),function(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0;n||(n=Kt.a.create()),t.toRenderCoords(e.origin,a,n.origin);var r=ft.d.get();Object(Y.e)(r,e.origin,e.basis1),Object(Y.e)(r,r,e.basis2),t.toRenderCoords(r,a,r);var o=ft.d.get();Object(Y.e)(o,e.origin,e.basis1),Object(Y.i)(o,o,e.basis2),t.toRenderCoords(o,a,o);var s=ft.d.get();Object(Y.i)(s,e.origin,e.basis1),Object(Y.i)(s,s,e.basis2),t.toRenderCoords(s,a,s);var c=ft.d.get();Object(Y.i)(c,e.origin,e.basis1),Object(Y.e)(c,c,e.basis2),t.toRenderCoords(c,a,c);var l=Object(Y.h)(ft.d.get(),r,o,.5);Object(Y.i)(l,l,n.origin);var u=Object(Y.h)(ft.d.get(),s,c,.5);Object(Y.i)(u,n.origin,u),Object(Y.h)(n.basis1,l,u,.5);var h=Object(Y.h)(ft.d.get(),c,r,.5);Object(Y.i)(h,h,n.origin);var p=Object(Y.h)(ft.d.get(),o,s,.5);Object(Y.i)(p,n.origin,p),Object(Y.h)(n.basis2,h,p,.5);var d=Object(Y.f)(ft.d.get(),n.basis1,n.basis2),b=Object(Y.f)(d,d,n.basis1);Object(Y.q)(b,b),Object(Y.d)(n.basis2,b,Object(Y.g)(n.basis2,b)),Object(Y.d)(n.basis1,n.basis1,1+i/Object(Y.o)(n.basis1)),Object(Y.d)(n.basis2,n.basis2,1+i/Object(Y.o)(n.basis2)),Kt.a.updateUnboundedPlane(n)}(n,this.view.renderCoordsHelper,t.spatialReference,this.displayBoundsMargin(),this.displayBounds),this.updateManipulators()}},{key:"displayBoundsMargin",value:function(){var e=this.view.pointsOfInterest,t=e?e.focus.location:this.reshapeHelper.geometry.extent.center;return rn*this.view.pixelSizeAt(t)}},{key:"_createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline((function(t,a,i){return e.applyGraphicMoveSteps(a,i)}))}},{key:"_createMoveZDragPipeline",value:function(){var e=this,t=this.view,a=this.reshapeHelper.geometry.spatialReference;return Object(Be.e)(this.moveZManipulator,(function(i,n,r){var o=Object(X.d)(i.renderLocation),s=n.next(Object(mt.g)(t,o,a)).next(Object(Be.c)());e.applyGraphicMoveSteps(s,r)}))}},{key:"applyGraphicMoveSteps",value:function(e,t){var a=this,i=e.next((function(e){return"start"===e.action&&(a.inputState={type:"move"},Kt.a.copy(a.mapBounds,a.mapBoundsStart),a.emit("graphic-translate-start",{graphic:a.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next(Object(Be.b)()).next(this._moveDragUpdateGeometry()).next((function(e){var t={graphic:a.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&a.emit("graphic-translate",t);break;case"end":a.inputState=null,a.emit("graphic-translate-stop",t)}return e}));return t.next((function(){Object(h.k)(a.inputState)&&a.emit("graphic-translate-stop",{graphic:a.graphic,dxScreen:0,dyScreen:0}),a.cancel()})),i}},{key:"_moveDragUpdateGeometry",value:function(){var e=this;return function(t){if(Object(h.j)(e.inputState)||"move"!==e.inputState.type)return t;var a,i=[],n=Object(W.a)(e.reshapeHelper.editGeometry.components);try{for(n.s();!(a=n.n()).done;){var r=a.value;i.push.apply(i,Object(Yt.a)(r.vertices))}}catch(s){n.e(s)}finally{n.f()}var o="start"===t.action?0:1;return Ki(e.reshapeHelper.moveVertices(i,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o),e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_onResizeGrab",value:function(e){if("start"===e.action){var t=this._calculatePickRay(e.screenPoint);Kt.e.intersectRay(this.displayBounds.plane,t,ft.d.get())&&(Kt.a.copy(this.displayBounds,this.displayBoundsStart),Kt.a.copy(this.mapBounds,this.mapBoundsStart),this.displayBoundsMarginStart=this.displayBoundsMargin(),this.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var a=this;return Object(Be.e)(e,(function(e,i,r){Object(h.j)(a.inputState)||(i.next((function(e){return"start"===e.action&&a.emit("graphic-scale-start",{graphic:a.graphic,xScale:1,yScale:1}),e})).next(Object(mt.f)(a.view,a.displayBoundsStart.plane)).next((function(e){return Object(n.a)(Object(n.a)({},e),{},{handle:t})})).next(a._resizeDragRenderPlaneToFactors()).next(a._preserveAspectRatio.createDragEventPipelineStep(),a._preserveAspectRatio.next).next(a._resizeDragUpdateGeometry()).next((function(e){var t={graphic:a.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":a.emit("graphic-scale",t);break;case"end":a.inputState=null,a.emit("graphic-scale-stop",t)}return e})),r.next((function(){Object(h.k)(a.inputState)&&a.emit("graphic-scale-stop",{graphic:a.graphic,xScale:1,yScale:1}),a.cancel()})))}))}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var a=e.displayBoundsStart,i=t.handle.direction,r=e.displayBoundsMargin(),o=e.displayBoundsMarginStart,s=Object(Y.j)(ft.d.get(),a.origin);Object(Y.b)(s,s,a.basis1,-i[0]),Object(Y.b)(s,s,a.basis2,-i[1]);var c=Object(Y.i)(ft.d.get(),t.renderEnd,s),l=Object(Y.i)(ft.d.get(),t.renderStart,s),u=Ii(t.handle),h=Ti(a),p=Ti(e.displayBounds)/h,d=function(e,t){if(0===e)return 1;var a=Object(Y.o)(t),i=.5*e*Object(Y.g)(t,c)/a,n=i<0?-1:1;u&&(i+=(a-.5*e*Object(Y.g)(t,l)/a)*n*p);var s=a<1.5*o?1:sn;return a=Math.max(a-o,sn),n>0&&(i-=r),n*Math.max(n*(i/a),s)};return Object(n.a)(Object(n.a)({},t),{},{factor1:d(i[0],a.basis1),factor2:d(i[1],a.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var a=Object(Y.j)(Object(X.e)(),e.mapBoundsStart.origin);Object(Y.b)(a,a,e.mapBoundsStart.basis1,-t.handle.direction[0]),Object(Y.b)(a,a,e.mapBoundsStart.basis2,-t.handle.direction[1]);var i=Object(sa.r)(Object(oa.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);Object(sa.e)(i,i);var n,r=[],o=Object(W.a)(e.reshapeHelper.editGeometry.components);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push.apply(r,Object(Yt.a)(s.vertices))}}catch(u){o.e(u)}finally{o.f()}var c="start"===t.action?0:1,l=e.reshapeHelper.scaleVertices(r,e.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(a),i,t.factor1,t.factor2,c,1);return Kt.a.copy(e.mapBoundsStart,e.mapBounds),Ki(l,e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,a,i){var n=t.worldUpAtPosition(e.origin,ft.d.get()),r=ft.d.get();switch(a){case 1:Object(Y.j)(r,n);break;case 2:Object(Y.j)(r,e.basis1)}return Kt.e.fromPositionAndNormal(e.origin,r,i)}(this.displayBounds,this.view.renderCoordsHelper,1,Kt.e.create()),a=this._calculatePickRay(e.screenPoint);Kt.e.intersectRay(t,a,ft.d.get())&&(Kt.a.copy(this.displayBounds,this.displayBoundsStart),Kt.a.copy(this.mapBounds,this.mapBoundsStart),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this;return Object(Be.e)(e,(function(e,a,i){var n=t.inputState;Object(h.j)(n)||(a.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next(Object(mt.f)(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdateGeometry()).next((function(e){var a={graphic:t.graphic,angle:Object(Ze.q)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",a);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",a)}return e})),i.next((function(){Object(h.k)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t.cancel()})))}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(a){var i=Kt.e.normal(e.rotatePlane),r=Object(Le.a)(a.renderStart,a.renderEnd,t.displayBounds.origin,i);return Object(n.a)(Object(n.a)({},a),{},{rotateAxis:i,rotateAngle:r})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var a,i=Object(Y.j)(Object(X.e)(),e.mapBoundsStart.origin),n=[],r=Object(W.a)(e.reshapeHelper.editGeometry.components);try{for(r.s();!(a=r.n()).done;){var o=a.value;n.push.apply(n,Object(Yt.a)(o.vertices))}}catch(l){r.e(l)}finally{r.f()}var s="start"===t.action?0:1,c=e.reshapeHelper.rotateVertices(n,e.reshapeHelper.editGeometry.coordinateHelper.fromXYZ(i),t.rotateAngle,s,1);return Kt.a.copy(e.mapBoundsStart,e.mapBounds),Ki(c,e.mapBounds),e.graphic.geometry=e.reshapeHelper.geometry,t}}},{key:"_calculatePickRay",value:function(e){var t=Kt.f.create(),a=Object(Jt.j)(e);return Kt.f.fromScreen(this.view.state.camera,a,t),Object(Y.q)(t.direction,t.direction),t}},{key:"updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return Object(Le.b)(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,ft.a.get());(function(e,t,a,i){var n=i.worldUpAtPosition(a.origin,ft.d.get()),r=Ci(a,0),o=Object(re.i)(ft.a.get());Object(re.g)(o,o,r.edge*Math.PI/2),Object(re.e)(o,o,-Fi(a,n)),Object(re.l)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=r.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this.updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((function(a,i){!function(e,t,a,i){var n=Object(Y.o)(i.basis1),r=Object(Y.o)(i.basis2),o=Ri(i),s=Ti(i),c=Object(Y.v)(ft.d.get(),0,0,0);Object(Y.e)(c,Object(Y.d)(ft.d.get(),i.basis1,t.direction[0]),Object(Y.d)(ft.d.get(),i.basis2,t.direction[1])),Object(Y.e)(c,i.origin,c);var l=0,u=1;if(Ii(t))1===t.direction[0]&&-1===t.direction[1]?l=Ui:1===t.direction[0]&&1===t.direction[1]?l=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(l=3*Math.PI/2),u=s;else{var h=0!==t.direction[0]?1:2;l=1===h?Ui:0,u=(1===h?r:n)-o}var p=Object(re.i)(ft.a.get());Object(re.g)(p,p,l),Object(re.r)(p,p,Object(Y.v)(ft.d.get(),u,u,u)),Object(re.l)(p,a,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=c}(a,e.resizeHandles[i],t,e.displayBounds)}))}}},{key:"updateZMoveHandle",value:function(e,t){var a=this.displayBounds,i={basis:a.basis1,direction:-1,position:Object(Y.i)(ft.d.get(),a.origin,a.basis1),edge:2},n=ft.a.get();Object(re.g)(n,t,i.edge*Math.PI/2),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=i.position}},{key:"cancel",value:function(){var e=this.reshapeHelper.editGeometry.lastOperation;Object(h.j)(e)||(this.reshapeHelper.undo(),this.graphic.geometry=this.reshapeHelper.geometry,$i(e,this.mapBounds),this.updateDisplayBounds(this.mapBounds),this.inputState=null)}},{key:"canUndo",value:function(){return this.reshapeHelper.canUndo}},{key:"undo",value:function(){if(Object(h.k)(this.inputState))this.view.activeTool=null;else if(this.canUndo()){var e=this.reshapeHelper.undo();this.graphic.geometry=this.reshapeHelper.geometry,$i(Object(h.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}},{key:"canRedo",value:function(){return this.reshapeHelper.canRedo}},{key:"redo",value:function(){if(this.canRedo()){var e=this.reshapeHelper.redo();this.graphic.geometry=this.reshapeHelper.geometry,Ki(Object(h.q)(e),this.mapBounds),this.updateDisplayBounds(this.mapBounds)}}}]),a}(f.a.EventedMixin(M.a));Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],an.prototype,"view",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],an.prototype,"graphic",void 0),Object(l.a)([Object(b.b)({constructOnly:!0,nonNullable:!0})],an.prototype,"enableZ",void 0),Object(l.a)([Object(b.b)()],an.prototype,"enableRotation",void 0),Object(l.a)([Object(b.b)()],an.prototype,"enableScaling",void 0),Object(l.a)([Object(b.b)()],an.prototype,"preserveAspectRatio",null),Object(l.a)([Object(b.b)()],an.prototype,"grabbing",void 0),Object(l.a)([Object(b.b)()],an.prototype,"inputState",void 0),Object(l.a)([Object(b.b)({readOnly:!0})],an.prototype,"type",void 0),an=Object(l.a)([Object(v.a)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],an);var nn="draped-elevation-changes",rn=10,on=80,sn=1e-6},863:function(e,t,a){"use strict";function i(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function n(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,a=0,i=0;i<e.length;i++){var n=e[i].size;"number"==typeof n&&(t+=n,a++)}return t/a}(e.stops):t}function r(e,t){if(!t)return e;var a=t.filter((function(e){return"size"===e.type})).map((function(t){var a=t.maxSize,i=t.minSize;return(n(a,e)+n(i,e))/2})),i=0,r=a.length;if(0===r)return e;for(var o=0;o<r;o++)i+=a[o];var s=Math.floor(i/r);return Math.max(s,e)}function o(e){var t=e&&e.renderer,a="touch"===(e&&e.event&&e.event.pointerType)?9:6;if(!t)return a;var n="visualVariables"in t?r(a,t.visualVariables):a;if("simple"===t.type)return i(n,t.symbol);if("unique-value"===t.type){var o=n;return t.uniqueValueInfos.forEach((function(e){o=i(o,e.symbol)})),o}if("class-breaks"===t.type){var s=n;return t.classBreakInfos.forEach((function(e){s=i(s,e.symbol)})),s}return t.type,n}a.d(t,"a",(function(){return o}))},873:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return c}));var i=a(6),n=a(57),r=(a(78),a(62)),o=a(863);function s(e,t,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new n.a;if("2d"===a.type)o=t*a.resolution;else if("3d"===a.type){var c=a.overlayPixelSizeInMapUnits(e),l=a.basemapSpatialReference;o=Object(i.k)(l)&&!l.equals(a.spatialReference)?Object(r.f)(l)/Object(r.f)(a.spatialReference):t*c}var u=e.x-o,h=e.y-o,p=e.x+o,d=e.y+o,b=a.spatialReference;return s.xmin=Math.min(u,p),s.ymin=Math.min(h,d),s.xmax=Math.max(u,p),s.ymax=Math.max(h,d),s.spatialReference=b,s}function c(e,t,a){var n=a.toMap(e);return!Object(i.j)(n)&&s(n,Object(o.a)(),a,l).intersects(t)}var l=new n.a},908:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var i=a(2),n=a(3),r=a(4),o=a(5),s=a(0),c=(a(14),a(6)),l=a(12),u=(a(17),a(1)),h=a(8),p=(a(11),a(18),a(19),a(31)),d=a(70),b=a(37),v=a(26),f=a(13),g=a(130),m=a(438),y=a(538),O=a(34),j=a(149),_=a(873),M=l.a.getLogger("esri.views.interactive.GraphicManipulator"),w=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).layer=null,n.interactive=!0,n.selectable=!1,n.grabbable=!0,n.dragging=!1,n.cursor=null,n.events=new d.a.EventEmitter,n._circleCollisionCache=null,n._graphicSymbolChangedHandle=null,n._originalSymbol=null,n}return Object(n.a)(a,[{key:"graphic",set:function(e){"mesh"!==Object(c.i)(e.geometry,"type")?(this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()):M.error("Mesh geometries are not supported")}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=Object(j.e)(this.graphic),a=e?e.offset:0;return new m.a({mode:t,offset:a})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var a=t.geometry;if(Object(c.j)(a))return null;var i=this._get("focusedSymbol"),n=Object(c.k)(i)?i:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,a,n):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),Object(c.k)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),Object(c.k)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=this.graphic.watch("symbol",(function(t){Object(c.k)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&Object(c.k)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),!0)}},{key:"detachSymbolChanged",value:function(){Object(c.k)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&Object(c.k)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,a,i){if(i=i||Object(y.e)(a),Object(c.j)(i))return null;var n=this._circleCollisionCache;if("point"!==a.type||"simple-marker"!==i.type)return Object(_.b)(t,a,e)?1:null;if(Object(c.j)(n)||!n.originalPoint.equals(a)){var r=a,o=e.spatialReference;if(Object(g.b)(r.spatialReference,o)){var s=Object(g.j)(r,o);n={originalPoint:r.clone(),mapPoint:s,radiusPx:Object(b.h)(i.size)},this._circleCollisionCache=n}}if(Object(c.k)(n)){var l=Object(b.j)(t,x),u=e.toScreen(n.mapPoint),h=n.radiusPx,p=u.x+Object(b.h)(i.xoffset),d=u.y-Object(b.h)(i.yoffset);return Object(O.j)(l,[p,d])<h*h?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,a){var i=e.toMap(t,{include:[a]});return i&&Object(g.o)(i,k,e.renderSpatialReference)?Object(f.n)(k,e.state.camera.eye):null}}]),a}(p.a);Object(s.a)([Object(u.b)({constructOnly:!0,nonNullable:!0})],w.prototype,"graphic",null),Object(s.a)([Object(u.b)({readOnly:!0})],w.prototype,"elevationInfo",null),Object(s.a)([Object(u.b)({constructOnly:!0,nonNullable:!0})],w.prototype,"view",void 0),Object(s.a)([Object(u.b)({value:null})],w.prototype,"focusedSymbol",null),Object(s.a)([Object(u.b)({constructOnly:!0})],w.prototype,"layer",void 0),Object(s.a)([Object(u.b)()],w.prototype,"interactive",void 0),Object(s.a)([Object(u.b)()],w.prototype,"selectable",void 0),Object(s.a)([Object(u.b)()],w.prototype,"grabbable",void 0),Object(s.a)([Object(u.b)({value:!1})],w.prototype,"grabbing",null),Object(s.a)([Object(u.b)()],w.prototype,"dragging",void 0),Object(s.a)([Object(u.b)()],w.prototype,"hovering",null),Object(s.a)([Object(u.b)({value:!1})],w.prototype,"selected",null),Object(s.a)([Object(u.b)()],w.prototype,"cursor",void 0),w=Object(s.a)([Object(h.a)("esri.views.interactive.GraphicManipulator")],w);var k=Object(v.e)(),x=Object(b.g)()},981:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var i=a(7),n=a.n(i),r=a(16),o=a(10),s=a(15),c=a(6),l=a(174),u=a(1),h=a(583),p=a(11),d=a(18),b=a(120),v=a(19),f=a(122);function g(e){var t=Object(c.k)(e)&&e.origins?e.origins:[void 0];return function(a,i){var n,r=function(e,t,a){if(Object(c.k)(e)&&"resource"===e.type)return function(e,t,a){var i=Object(l.b)(t,a);return{type:String,read:function(e,t,a){var n=Object(f.d)(e,t,a);return i.type===String?n:"function"==typeof i.type?new i.type({url:n}):void 0},write:{writer:function(t,n,r,s){if(!s||!s.resources)return"string"==typeof t?void(n[r]=Object(f.e)(t,s)):void(n[r]=t.write({},s));var l=function(e){return Object(c.j)(e)?null:"string"==typeof e?e:e.url}(t),u=l?Object(f.e)(l,Object(o.a)(Object(o.a)({},s),{},{verifyItemRelativeUrls:s&&s.verifyItemRelativeUrls?{writtenUrls:s.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),1):null,d=i.type!==String&&(!Object(h.a)(this)||s&&s.origin&&this.originIdOf(a)>Object(b.d)(s.origin));s&&s.portalItem&&Object(c.k)(u)&&!Object(p.s)(u)?d?function(e,t,a,i,n,r,o,s){var c=o.portalItem.resourceFromPath(i),l=O(a,i,o);Object(v.a)(l)===Object(p.n)(c.path)?(y(e,t,c,l,o.resources.toUpdate),n[r]=i):m(e,t,a,i,n,r,o,s)}(this,a,t,u,n,r,s,e):function(e,t,a,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[a]=e}(u,n,r,s):s&&s.portalItem&&(Object(c.j)(u)||Object(c.k)(Object(f.b)(u))||Object(p.t)(u)||d)?m(this,a,t,u,n,r,s,e):n[r]=u}}}}(e,t,a);switch(Object(c.k)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:f.c.read,write:f.c.write}}}(e,a,i),d=Object(s.a)(t);try{for(d.s();!(n=d.n()).done;){var g=n.value,j=Object(u.c)(a,g,i);for(var _ in r)j[_]=r[_]}}catch(M){d.e(M)}finally{d.f()}}}function m(e,t,a,i,n,r,o,s){var l=Object(d.a)(),u=O(a,i,o),h=Object(p.y)(Object(c.i)(s,"prefix"),l),b="".concat(h,".").concat(Object(v.a)(u)),f=o.portalItem.resourceFromPath(b);Object(p.t)(i)&&o.resources.pendingOperations.push(function(e){return j.apply(this,arguments)}(i).then((function(e){f.path="".concat(h,".").concat(Object(v.a)(e)),n[r]=f.itemRelativeUrl})).catch((function(){}))),y(e,t,f,u,o.resources.toAdd),n[r]=f.itemRelativeUrl}function y(e,t,a,i,n){n.push({resource:a,content:i,finish:function(a){!function(e,t,a){"string"==typeof e[t]?e[t]=a.url:e[t].url=a.url}(e,t,a)}})}function O(e,t,a){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(a))],{type:"application/json"})}function j(){return(j=Object(r.a)(n.a.mark((function e(t){var i,r,o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(a.bind(null,54));case 2:return i=e.sent.default,e.next=5,i(t,{responseType:"blob"});case 5:return r=e.sent,o=r.data,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=9.e8f0988a.chunk.js.map