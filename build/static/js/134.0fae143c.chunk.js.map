{"version":3,"sources":["../node_modules/@arcgis/core/symbols/cim/Rasterizer.js","../node_modules/@arcgis/core/symbols/cim/TextRasterizer.js","../node_modules/@arcgis/core/symbols/cim/CIMSymbolRasterizer.js","../node_modules/@arcgis/core/symbols/support/previewCIMSymbol.js"],"names":["o","this","_rasterizationCanvas","e","s","document","createElement","type","t","rasterizeSimpleFill","style","r","size","image","Uint32Array","buffer","sdf","simplePattern","anchorX","anchorY","rasterizeSimpleLine","cap","m","l","f","a","fromSimpleMarker","n","fromCIMHatchFill","frame","xmin","ymax","xmax","ymin","markerPlacement","fromCIMInsidePolygon","i","rasterize","c","h","p","y","u","width","height","getContext","ImageData","putImageData","setAttribute","drawImage","getImageData","Uint8Array","data","oldColor","length","newColor","Math","round","Uint8ClampedArray","_textRasterizationCanvas","setFontProperties","parameters","textLines","split","lineHeight","computeLineHeight","computeTextWidth","renderedLineHeight","pixelRatio","renderedHaloSize","halo","renderedWidth","renderedHeight","fillStyle","slice","toString","color","haloStyle","d","textAlign","g","renderHalo","globalCompositeOperation","fillText","x","premultiplyColors","_haloRasterizationCanvas","clearRect","strokeStyle","lineJoin","renderHaloEmulated","renderHaloNative","globalAlpha","lineWidth","strokeText","font","weight","family","textBaseline","horizontalAlignment","max","measureText","push","cos","PI","sin","Legend","Preview","targetSize","referenceSize","scaleFactor","M","fill","legend","geometry","rings","canvasPaths","preview","stroke","paths","I","Object","keys","map","name","alias","z","symbol","P","materialHash","cim","materialOverrides","analyzedCIM","hash","_spatialReference","_avoidSDF","_resourceCache","Map","_rasterizer","_textRasterizer","_pictureMarkerCache","centroid","analyzeCIMSymbol","attributes","rasterizeCIMSymbol","geometryType","spatialReference","fields","fetchPictureMarkerResource","text","indexOf","textCase","Promise","all","get","url","responseType","signal","set","_getRasterizedResource","offsetX","offsetY","rotation","rotateClockwise","angle","verticalAlignment","rotateClockWise","rasterizedResource","getSymbolImage","C","min","createImageData","rasterizedImage","_imageDataToCanvas","save","translate","rotate","restore","imageData","anchorPosition","_imageDataCanvas","_getPictureResource","_rasterizePictureResource","_embedCIMLayerInVectorMarker","JSON","stringify","rasterizeJSONResource","_rasterizeTextResource","anchorPoint","preserveOutlineWidth","has","window","devicePixelRatio","fontName","decoration","outlineColor","outlineSize","rasterizeText","abs","createPattern","setTransform","m11","m12","m21","m22","m41","m42","beginPath","moveTo","lineTo","closePath","apply","_imageTo32Array","markerGraphics","symbolLayers","maxSize","node","opacity","cimOptions","feature","fieldMap","clone","rasterizeCIMSymbolAsync","b","w","D","scale","ceil","Image","src","toDataURL","appendChild"],"mappings":"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","file":"static/js/134.0fae143c.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{resampleHermite as e}from\"./utils.js\";import r from\"./Rect.js\";import{SymbolHelper as t,CIMSymbolHelper as a}from\"./CIMSymbolHelper.js\";import{getSDFInfo as n,buildSDF as i}from\"./SDFHelper.js\";const s=512;class o{dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(e,s,o){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),\"simple-fill\"===e.type||\"esriSFS\"===e.type){const[r,a,n]=t.rasterizeSimpleFill(this._rasterizationCanvas,e.style,s);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if(\"simple-line\"===e.type||\"esriSLS\"===e.type){const[r,a,n]=t.rasterizeSimpleLine(e.style,e.cap);return{size:[a,n],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let m,l,f;if(\"simple-marker\"===e.type||\"esriSMS\"===e.type||\"line-marker\"===e.type?(m=a.fromSimpleMarker(e),f=n(m)):\"CIMHatchFill\"===e.type?(m=a.fromCIMHatchFill(e),l=new r(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):e.markerPlacement&&\"CIMMarkerPlacementInsidePolygon\"===e.markerPlacement.type?(m=a.fromCIMInsidePolygon(e),l=new r(m.frame.xmin,-m.frame.ymax,m.frame.xmax-m.frame.xmin,m.frame.ymax-m.frame.ymin)):(m=e,f=n(m)),f&&!o){const[e,r,t]=i(f);return e?{size:[r,t],image:new Uint32Array(e.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[c,h,p,y,u]=a.rasterize(this._rasterizationCanvas,m,l,!o);return c?{size:[h,p],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:y,anchorY:u}:null}rasterizeImageResource(r,t,a,n){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement(\"canvas\")),this._rasterizationCanvas.width=r,this._rasterizationCanvas.height=t;const i=this._rasterizationCanvas.getContext(\"2d\");a instanceof ImageData?i.putImageData(a,0,0):(a.setAttribute(\"width\",`${r}px`),a.setAttribute(\"height\",`${t}px`),i.drawImage(a,0,0,r,t));const o=i.getImageData(0,0,r,t),m=new Uint8Array(o.data);if(n)for(const e of n)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[r,t,a,n]=e.oldColor,[i,s,o,l]=e.newColor;if(r===i&&t===s&&a===o&&n===l)continue;for(let e=0;e<m.length;e+=4)r===m[e]&&t===m[e+1]&&a===m[e+2]&&n===m[e+3]&&(m[e]=i,m[e+1]=s,m[e+2]=o,m[e+3]=l)}let l;for(let e=0;e<m.length;e+=4)l=m[e+3]/255,m[e]=m[e]*l,m[e+1]=m[e+1]*l,m[e+2]=m[e+2]*l;let f=m,c=r,h=t;const p=s;if(c>=p||h>=p){const a=c/h;a>1?(c=p,h=Math.round(p/a)):(h=p,c=Math.round(p*a)),f=new Uint8Array(4*c*h);const n=new Uint8ClampedArray(f.buffer);e(m,r,t,n,c,h,!1)}return{size:[r,t],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}export default o;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{pt2px as t}from\"../../core/screenUtils.js\";function e(t){return`rgb(${t.slice(0,3).toString()})`}function i(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class r{constructor(){}rasterizeText(t,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement(\"canvas\"));const o=this._textRasterizationCanvas,n=o.getContext(\"2d\");this.setFontProperties(n,r),this.parameters=r,this.textLines=t.split(/\\r?\\n/),this.lineHeight=this.computeLineHeight();const a=this.computeTextWidth(n,r),h=this.lineHeight*this.textLines.length;o.width=a,o.height=h,this.renderedLineHeight=Math.round(this.lineHeight*r.pixelRatio),this.renderedHaloSize=r.halo.size*r.pixelRatio,this.renderedWidth=a*r.pixelRatio,this.renderedHeight=h*r.pixelRatio,this.fillStyle=i(r.color),this.haloStyle=e(r.halo.color);const l=this.renderedLineHeight,d=this.renderedHaloSize;this.setFontProperties(n,r);const c=s(n.textAlign,this.renderedWidth)+d,g=d;let f=0,p=0;d>0&&this.renderHalo(n,c,g,f,p,r),p+=g,f+=c;for(const e of this.textLines)n.globalCompositeOperation=\"destination-out\",n.fillStyle=\"rgb(0, 0, 0)\",n.fillText(e,f,p),n.globalCompositeOperation=\"source-over\",n.fillStyle=this.fillStyle,n.fillText(e,f,p),p+=l;const u=n.getImageData(0,0,this.renderedWidth,this.renderedHeight),x=new Uint8Array(u.data);if(r.premultiplyColors){let t;for(let e=0;e<x.length;e+=4)t=x[e+3]/255,x[e]=x[e]*t,x[e+1]=x[e+1]*t,x[e+2]=x[e+2]*t}return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(x.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}renderHalo(t,e,i,r,s,o){const n=this.renderedWidth,a=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement(\"canvas\")),this._haloRasterizationCanvas.width=n,this._haloRasterizationCanvas.height=a;const h=this._haloRasterizationCanvas,l=h.getContext(\"2d\");l.clearRect(0,0,n,a),this.setFontProperties(l,o),l.fillStyle=this.haloStyle,l.strokeStyle=this.haloStyle;const d=this.renderedHaloSize<3;l.lineJoin=d?\"miter\":\"round\",d?this.renderHaloEmulated(l,e,i):this.renderHaloNative(l,e,i),t.globalAlpha=this.parameters.halo.color[3],t.drawImage(h,0,0,n,a,r,s,n,a),t.globalAlpha=1}renderHaloEmulated(t,e,i){const r=this.renderedLineHeight,s=this.renderedHaloSize;for(const n of this.textLines){for(const[r,a]of o)t.fillText(n,e+s*r,i+s*a);i+=r}}renderHaloNative(t,e,i){const r=this.renderedLineHeight,s=this.renderedHaloSize;for(const o of this.textLines){const n=2*s,a=5,h=.1;for(let r=0;r<a;r++){const s=1-(a-1)*h+r*h;t.lineWidth=s*n,t.strokeText(o,e,i)}i+=r}}setFontProperties(e,i){const r=i.font,s=`${r.style} ${r.weight} ${t(i.size*i.pixelRatio)}px ${r.family}, sans-serif`;let o;switch(e.font=s,e.textBaseline=\"top\",i.horizontalAlignment){case\"left\":o=\"left\";break;case\"right\":o=\"right\";break;case\"center\":o=\"center\";break;default:o=\"left\"}e.textAlign=o}computeTextWidth(t,e){let i=0;for(const s of this.textLines)i=Math.max(i,t.measureText(s).width);const r=e.font;return(\"italic\"===r.style||\"oblique\"===r.style||\"string\"==typeof r.weight&&(\"bold\"===r.weight||\"bolder\"===r.weight)||\"number\"==typeof r.weight&&r.weight>600)&&(i+=.3*t.measureText(\"A\").width),i+=2*this.parameters.halo.size,Math.round(i)}computeLineHeight(){const t=1.275*this.parameters.size;return Math.round(t+2*this.parameters.halo.size)}}function s(t,e){return\"center\"===t?.5*e:\"right\"===t?e:0}const o=[];{const t=16;for(let e=0;e<360;e+=360/t)o.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}export default r;export{r as TextRasterizer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{numericHash as e}from\"../../core/string.js\";import{throwIfAborted as t}from\"../../core/promiseUtils.js\";import{getJsonType as r,isPolygon as a,isPolyline as i}from\"../../geometry/support/jsonUtils.js\";import{pt2px as s}from\"../../core/screenUtils.js\";import o from\"../support/Symbol3DAnchorPosition2D.js\";import n from\"../../request.js\";import{createLabelOverrideFunction as c,evaluateValueOrFunction as l,colorToArray as m}from\"./utils.js\";import{scaleCIMMarker as h}from\"../support/cimSymbolUtils.js\";import{analyzeCIMSymbol as f,analyzeCIMResource as g}from\"./cimAnalyzer.js\";import y from\"./Rasterizer.js\";import{TextRasterizer as u}from\"./TextRasterizer.js\";var p;!function(e){e.Legend=\"legend\",e.Preview=\"preview\"}(p||(p={}));const d=(e,t,r)=>{if(e&&e.targetSize){let a;if(r){const t=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);a=e.targetSize/s(t)}else a=e.targetSize/t.referenceSize;return a}return e&&e.scaleFactor?e.scaleFactor:1},M={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:-2,ymin:2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}};class C{constructor(e,t){this._spatialReference=e,this._avoidSDF=t,this._resourceCache=new Map,this._rasterizer=new y,this._textRasterizer=new u,this._pictureMarkerCache=new Map}async rasterizeCIMSymbolAsync(e,t,a,i,s,o,n,c){i=i||(t?null!=t.centroid?\"esriGeometryPolygon\":r(t.geometry):null)||z(e);const l=await this.analyzeCIMSymbol(e,t?I(t.attributes):null,a,i,c);return this.rasterizeCIMSymbol(l,t,i,s,o,n)}async analyzeCIMSymbol(e,r,a,i,s){const o=[],n=r?{geometryType:i,spatialReference:this._spatialReference,fields:r}:null;let l;await f(e.data,n,o,this._avoidSDF),t(s);for(const t of o)\"CIMPictureMarker\"!==t.cim.type&&\"CIMPictureFill\"!==t.cim.type&&\"CIMPictureStroke\"!==t.cim.type||(l||(l=[]),l.push(this.fetchPictureMarkerResource(t,s))),a&&\"text\"===t.type&&\"string\"==typeof t.text&&t.text.indexOf(\"[\")>-1&&(t.text=c(a,t.text,t.cim.textCase));return l&&await Promise.all(l),o}async fetchPictureMarkerResource(e,t){const r=e.materialHash;if(!this._pictureMarkerCache.get(r)){const a=(await n(e.cim.url,{responseType:\"image\",signal:t&&t.signal})).data;this._pictureMarkerCache.set(r,a)}}rasterizeCIMSymbol(e,t,r,a,i,s){const o=[];for(const n of e){a&&\"function\"==typeof a.scaleFactor&&(a.scaleFactor=a.scaleFactor(t,i,s));const e=this._getRasterizedResource(n,t,r,a,i,s);if(!e)continue;let c=0,m=e.anchorX||0,h=e.anchorY||0,f=!1,g=0,y=0;if(\"esriGeometryPoint\"===r){const e=d(a,n,null);if(g=l(n.offsetX,t,i,s)*e||0,y=l(n.offsetY,t,i,s)*e||0,\"marker\"===n.type)c=l(n.rotation,t,i,s)||0,f=!!n.rotateClockwise&&n.rotateClockwise;else if(\"text\"===n.type){if(c=l(n.angle,t,i,s)||0,void 0!==n.horizontalAlignment)switch(n.horizontalAlignment){case\"left\":m=-.5;break;case\"right\":m=.5;break;default:m=0}if(void 0!==n.verticalAlignment)switch(n.verticalAlignment){case\"top\":h=.5;break;case\"bottom\":h=-.5;break;case\"baseline\":h=-.25;break;default:h=0}}}null!=e&&o.push({angle:c,rotateClockWise:f,anchorX:m,anchorY:h,offsetX:g,offsetY:y,rasterizedResource:e})}return this.getSymbolImage(o)}getSymbolImage(e){const t=document.createElement(\"canvas\"),r=t.getContext(\"2d\");let a=0,i=0,n=0,c=0;const l=[];for(let o=0;o<e.length;o++){const t=e[o],m=t.rasterizedResource;if(!m)continue;const h=m.size,f=t.offsetX,g=t.offsetY,y=t.anchorX,u=t.anchorY,p=t.rotateClockWise||!1;let d=t.angle,M=s(f)-h[0]*(.5+y),C=s(g)-h[1]*(.5+u),I=M+h[0],z=C+h[1];if(d){p&&(d=-d);const e=Math.sin(d*Math.PI/180),t=Math.cos(d*Math.PI/180),r=M*t-C*e,a=M*e+C*t,i=M*t-z*e,s=M*e+z*t,o=I*t-z*e,n=I*e+z*t,c=I*t-C*e,l=I*e+C*t;M=Math.min(r,i,o,c),C=Math.min(a,s,n,l),I=Math.max(r,i,o,c),z=Math.max(a,s,n,l)}a=M<a?M:a,i=C<i?C:i,n=I>n?I:n,c=z>c?z:c;const P=r.createImageData(m.size[0],m.size[1]);P.data.set(new Uint8ClampedArray(m.image.buffer));const x={offsetX:f,offsetY:g,rotateClockwise:p,angle:d,rasterizedImage:P,anchorX:y,anchorY:u};l.push(x)}t.width=n-a,t.height=c-i;const m=-a,h=c;for(let o=0;o<l.length;o++){const e=l[o],t=this._imageDataToCanvas(e.rasterizedImage),a=e.rasterizedImage.width,i=e.rasterizedImage.height,n=m-a*(.5+e.anchorX),c=h-i*(.5-e.anchorY);if(e.angle){const a=(360-e.angle)*Math.PI/180;r.save(),r.translate(s(e.offsetX),-s(e.offsetY)),r.translate(m,h),r.rotate(a),r.translate(-m,-h),r.drawImage(t,n,c),r.restore()}else r.drawImage(t,n+s(e.offsetX),c-s(e.offsetY))}const f=new o({x:m/t.width-.5,y:h/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:f}}_imageDataToCanvas(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\"));const t=this._imageDataCanvas,r=t.getContext(\"2d\");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t}_imageTo32Array(e,t,r){this._imageDataCanvas||(this._imageDataCanvas=document.createElement(\"canvas\"));const a=this._imageDataCanvas,i=a.getContext(\"2d\");return a.width=t,a.height=r,i.drawImage(e,0,0,t,r),new Uint32Array(i.getImageData(0,0,t,r).data.buffer)}_getRasterizedResource(t,r,a,i,s,o){let n,c,m,f;if(\"esriGeometryPolyline\"===a||\"esriGeometryPolygon\"===a){const h=i&&i.style?i.style:p.Legend,f=\"esriGeometryPolyline\"===a?M.stroke[h]:M.fill[h];if(\"line\"===t.type){if(\"CIMSolidStroke\"!==t.cim.type){if(\"CIMPictureStroke\"===t.cim.type){const e=l(t.width,r,s,o),{image:a,width:i,height:n}=this._getPictureResource(t,e);return this._rasterizePictureResource(t,a,i,n,f,e)}return null}({analyzedCIM:n,hash:m}=P(t,r,s,o)),c=this._embedCIMLayerInVectorMarker(n,f)}else if(\"marker\"===t.type){if(\"CIMPictureMarker\"===t.cim.type)return null;if(\"CIMVectorMarker\"!==t.cim.type)return null;t.cim.offsetX=l(t.offsetX,r,s,o),t.cim.offsetY=l(t.offsetY,r,s,o),t.cim.rotation=l(t.rotation,r,s,o),t.cim.markerPlacement=t.markerPlacement,({analyzedCIM:n}=P(t,r,s,o)),m=e(JSON.stringify(n)).toString(),c=this._embedCIMLayerInVectorMarker(n,f)}else{if(\"text\"===t.type)return null;if(\"fill\"===t.type){if(\"CIMHatchFill\"===t.cim.type||\"CIMVectorMarker\"===t.cim.type||\"CIMPictureMarker\"===t.cim.type||\"CIMPictureFill\"===t.cim.type){const e=t.cim.size||t.cim.height;let a,i,c;if(\"CIMPictureMarker\"===t.cim.type||\"CIMPictureFill\"===t.cim.type)({image:a,width:i,height:c}=this._getPictureResource(t,e));else{({analyzedCIM:n,hash:m}=P(t,r,s,o));const e=this._rasterizer.rasterizeJSONResource(n,1,this._avoidSDF);a=e.image,i=e.size[0],c=e.size[1]}return this._rasterizePictureResource(t,a,i,c,f,null)}if(\"CIMSolidFill\"!==t.cim.type)return null;({analyzedCIM:n,hash:m}=P(t,r,s,o)),c=this._embedCIMLayerInVectorMarker(n,f)}}}else{if(\"text\"===t.type)return f=this._rasterizeTextResource(t,r,i,s,o),f;({analyzedCIM:n,hash:m}=P(t,r,s,o));const e=d(i,t,null);if(\"CIMPictureMarker\"===t.cim.type){const a=l(t.size,r,s,o)*e,{image:i,width:n,height:c}=this._getPictureResource(t,a);return f={image:i,size:[n,c],sdf:!1,simplePattern:!1,anchorX:t.anchorPoint?t.anchorPoint.x:0,anchorY:t.anchorPoint?t.anchorPoint.y:0},f}h(n,e,{preserveOutlineWidth:!1}),c=n}m+=a,i&&(m+=JSON.stringify(i));const g=this._resourceCache;return g.has(m)?g.get(m):(f=this._rasterizer.rasterizeJSONResource(c,window.devicePixelRatio||1,this._avoidSDF),g.set(m,f),f)}_rasterizeTextResource(e,t,r,a,i){const s=d(r,e,null),o=l(e.text,t,a,i);if(!o||0===o.length)return null;const n=l(e.fontName,t,a,i),c=l(e.style,t,a,i),h=l(e.weight,t,a,i),f=l(e.decoration,t,a,i),g=l(e.size,t,a,i)*s,y=l(e.horizontalAlignment,t,a,i),u=l(e.verticalAlignment,t,a,i),p=m(l(e.color,t,a,i)),M=m(l(e.outlineColor,t,a,i)),C={color:p,size:g,horizontalAlignment:y,verticalAlignment:u,font:{family:n,style:c,weight:h,decoration:f},halo:{size:l(e.outlineSize,t,a,i)||0,color:M,style:c},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(o,C)}_rasterizePictureResource(e,t,r,o,n,c){const l=document.createElement(\"canvas\"),m=l.getContext(\"2d\");l.height=s(Math.max(Math.abs(n.frame.ymax-n.frame.ymin),c)),l.width=s(Math.abs(n.frame.xmax-n.frame.xmin));const h=m.createImageData(r,o);h.data.set(new Uint8ClampedArray(t.buffer));const f=this._imageDataToCanvas(h),g=m.createPattern(f,\"repeat\"),y=Math.cos((-e.cim.rotation||0)*Math.PI/180),u=Math.sin((-e.cim.rotation||0)*Math.PI/180);g.setTransform({m11:y,m12:u,m21:-u,m22:y,m41:s(e.cim.offsetX)||0,m42:s(e.cim.offsetY)||0});const p=n.canvasPaths;let d,M,C;a(p)?(d=p.rings,m.fillStyle=g,M=m.fill,C=[\"evenodd\"]):i(p)&&(d=p.paths,m.strokeStyle=g,m.lineWidth=c,M=m.stroke,d[0][0][1]=l.height/2,d[0][1][1]=l.height/2),m.beginPath();for(const a of d){const e=a?a.length:0;if(e>1){let t=a[0];m.moveTo(s(t[0]),s(t[1]));for(let r=1;r<e;++r)t=a[r],m.lineTo(s(t[0]),s(t[1]));m.closePath()}}M.apply(m,C);const I=m.getImageData(0,0,l.width,l.height),z=new Uint8Array(I.data);return{size:[l.width,l.height],image:new Uint32Array(z.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_getPictureResource(e,t){const r=this._pictureMarkerCache.get(e.materialHash);if(!r)return null;const a=r.height/r.width,i=t?a>1?s(t):s(t)/a:r.width,o=t?a>1?s(t)*a:s(t):r.height;return{image:this._imageTo32Array(r,i,o),width:i,height:o}}_embedCIMLayerInVectorMarker(e,t){const r=a(t.geometry)?\"CIMPolygonSymbol\":\"CIMLineSymbol\";return{type:\"CIMVectorMarker\",frame:t.frame,markerGraphics:[{type:\"CIMMarkerGraphic\",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}}}function I(e){return(e?Object.keys(e):[]).map((t=>({name:t,alias:t,type:\"string\"==typeof e[t]?\"esriFieldTypeString\":\"esriFieldTypeDouble\"})))}function z(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case\"CIMPointSymbol\":case\"CIMTextSymbol\":return\"esriGeometryPoint\";case\"CIMLineSymbol\":return\"esriGeometryPolyline\";case\"CIMPolygonSymbol\":return\"esriGeometryPolygon\";default:return null}}function P(e,t,r,a){let i,s;if(\"function\"==typeof e.materialHash){i=(0,e.materialHash)(t,r,a),s=g(e.cim,e.materialOverrides)}else i=e.materialHash,s=e.cim;return{analyzedCIM:s,hash:i}}export{C as CIMSymbolRasterizer,p as GeometryStyle};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.19/esri/copyright.txt for details.\n*/\nimport{px2pt as t}from\"../../core/screenUtils.js\";import{getCIMSymbolSize as e,scaleCIMSymbolTo as a}from\"./cimSymbolUtils.js\";import{CIMSymbolRasterizer as l}from\"../cim/CIMSymbolRasterizer.js\";const i=new l(null,!0),o=120;async function n(l,n={}){const{size:s,maxSize:c,node:m,opacity:r}=n,y=n.cimOptions||n,{feature:d,fieldMap:h,geometryType:p,style:u}=y,g=e(l),f=Math.min(null!=s?s:g,null!=c?c:t(o));f!==g&&(l=l.clone(),a(l,f,{preserveOutlineWidth:!0}));let M=3;l&&l.data&&l.data.symbol&&\"CIMPointSymbol\"!==l.data.symbol.type&&(M=1);const b=await i.rasterizeCIMSymbolAsync(l,d,h,p,{scaleFactor:M,style:u}),w=document.createElement(\"canvas\");w.width=b.imageData.width,w.height=b.imageData.height;w.getContext(\"2d\").putImageData(b.imageData,0,0);let C=w.width/M,D=w.height/M;if(null!=s&&(null==(null==n?void 0:n.scale)||(null==n?void 0:n.scale))){const t=C/D;C=t<=1?Math.ceil(f*t):f,D=t<=1?f:Math.ceil(f/t)}const I=new Image(C,D);return I.src=w.toDataURL(),null!=r&&(I.style.opacity=`${r}`),m&&m.appendChild(I),I}export{n as previewCIMSymbol};\n"],"sourceRoot":""}